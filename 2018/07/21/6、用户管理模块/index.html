<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 6、用户管理模块 · Eureka-Home</title><meta name="description" content="6、用户管理模块 - Eureka"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Eureka-Home"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">6、用户管理模块</h1><div class="post-info">Jul 21, 2018</div><div class="post-content"><p>用户模块<br><a id="more"></a></p>
<h2 id="1、门户用户登陆-user-login-do"><a href="#1、门户用户登陆-user-login-do" class="headerlink" title="1、门户用户登陆 /user/login.do"></a>1、门户用户登陆 /user/login.do</h2><h4 id="request"><a href="#request" class="headerlink" title="request"></a>request</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username,password</span><br></pre></td></tr></table></figure>
<h4 id="fail"><a href="#fail" class="headerlink" title="fail"></a>fail</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;密码错误&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="success"><a href="#success" class="headerlink" title="success"></a>success</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: 12,</span><br><span class="line">        &quot;username&quot;: &quot;aaa&quot;,</span><br><span class="line">        &quot;email&quot;: &quot;aaa@163.com&quot;,</span><br><span class="line">        &quot;phone&quot;: null,</span><br><span class="line">        &quot;role&quot;: 0,</span><br><span class="line">        &quot;createTime&quot;: 1479048325000,</span><br><span class="line">        &quot;updateTime&quot;: 1479048325000</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个api在登陆错误时只返回<code>status</code>和<code>msg</code>，不返回<code>data</code>。在登陆成功时，返回<code>status</code>和<code>data</code>。</p>
<p>首先对于这个统一的相应进行一个封装<code>ServerReponse</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span>  </span><br><span class="line"><span class="meta">@JsonSerialize</span>(include = JsonSerialize.Inclusion.NON_NULL)<span class="comment">//json序列化时，null的对象,key会消失</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerResponse</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6819559706322722855L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> status;<span class="comment">//状态码</span></span><br><span class="line">    <span class="keyword">private</span> String msg;<span class="comment">//提示信息</span></span><br><span class="line">    <span class="keyword">private</span> T data;<span class="comment">//数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//几个私有的构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ServerResponse</span><span class="params">(<span class="keyword">int</span> status)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ServerResponse</span><span class="params">(<span class="keyword">int</span> status,T data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ServerResponse</span><span class="params">(<span class="keyword">int</span> status,String msg,T data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ServerResponse</span><span class="params">(<span class="keyword">int</span> status,String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断是否成功</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSuccess</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.status == ResponseEnum.SUCCESS.getCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回成功的几个方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;<span class="function">ServerResponse&lt;T&gt; <span class="title">createBySuccess</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerResponse&lt;&gt;(ResponseEnum.SUCCESS.getCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;<span class="function">ServerResponse&lt;T&gt; <span class="title">createBySuccessMessage</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerResponse&lt;&gt;(ResponseEnum.SUCCESS.getCode(),msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;<span class="function">ServerResponse&lt;T&gt; <span class="title">createBySuccess</span><span class="params">(T data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerResponse&lt;&gt;(ResponseEnum.SUCCESS.getCode(),data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;<span class="function">ServerResponse&lt;T&gt; <span class="title">createBySuccess</span><span class="params">(String msg,T data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerResponse&lt;&gt;(ResponseEnum.SUCCESS.getCode(),msg,data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回失败的几个方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;<span class="function">ServerResponse&lt;T&gt; <span class="title">createByError</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerResponse&lt;&gt;(ResponseEnum.ERROR.getCode(),ResponseEnum.ERROR.getDesc());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;<span class="function">ServerResponse&lt;T&gt; <span class="title">createByErrorMessage</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerResponse&lt;&gt;(ResponseEnum.ERROR.getCode(),msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;<span class="function">ServerResponse&lt;T&gt; <span class="title">createByErrorCodeMessage</span><span class="params">(<span class="keyword">int</span> code,String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerResponse&lt;&gt;(code,msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于其中几个状态，用一个枚举的类来表示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ResponseEnum &#123;</span><br><span class="line">    <span class="comment">//成功</span></span><br><span class="line">    SUCCESS(<span class="number">0</span>,<span class="string">"SUCCESS"</span>),</span><br><span class="line">    <span class="comment">//失败</span></span><br><span class="line">    ERROR(<span class="number">1</span>,<span class="string">"ERROR"</span>),</span><br><span class="line">    <span class="comment">//需要登陆</span></span><br><span class="line">    NEED_LOGIN(<span class="number">10</span>,<span class="string">"NEED_LOGIN"</span>),</span><br><span class="line">    <span class="comment">//参数错误</span></span><br><span class="line">    ILLEGAL_ARGUMENT(<span class="number">2</span>,<span class="string">"ILLEGAL_ARGUMENT"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String desc;</span><br><span class="line"></span><br><span class="line">    ResponseEnum(<span class="keyword">int</span> code,String desc)&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面就是登陆的<code>controller</code>方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"login.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">login</span><span class="params">(String username, String password, HttpSession session)</span></span>&#123;</span><br><span class="line">    ServerResponse&lt;User&gt; response = userService.login(username,password);</span><br><span class="line">    <span class="keyword">if</span>(response.isSuccess())&#123;</span><br><span class="line">        <span class="comment">//登陆成功，就将其放入session中</span></span><br><span class="line">        session.setAttribute(Constants.CURRENT_USER,response.getData());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>service</code>层是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**用户校验 SELECT count(1) from mmall_user where username = #&#123;username&#125;*/</span></span><br><span class="line">    <span class="keyword">int</span> resultCount = userMapper.checkUsername(username);</span><br><span class="line">    <span class="keyword">if</span>(resultCount == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"用户名不存在"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//密码登陆md5</span></span><br><span class="line">    String md5Password = MD5Util.MD5EncodeUtf8(password);</span><br><span class="line">    <span class="comment">/**登陆  SELECT &lt;include refid="Base_Column_List"/&gt; from mmall_user WHERE username = #&#123;username&#125; and password = #&#123;password&#125; */</span></span><br><span class="line">    User user = userMapper.selectLogin(username,md5Password);</span><br><span class="line">    <span class="keyword">if</span>(user == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"密码错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setPassword(StringUtils.EMPTY);</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createBySuccess(<span class="string">"登陆成功"</span>,user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中,MD5加密工具类是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MD5Util</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">byteArrayToHexString</span><span class="params">(<span class="keyword">byte</span> b[])</span> </span>&#123;</span><br><span class="line">        StringBuffer resultSb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; b.length; i++)</span><br><span class="line">            resultSb.append(byteToHexString(b[i]));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultSb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">byteToHexString</span><span class="params">(<span class="keyword">byte</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = b;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">0</span>)</span><br><span class="line">            n += <span class="number">256</span>;</span><br><span class="line">        <span class="keyword">int</span> d1 = n / <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">int</span> d2 = n % <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> hexDigits[d1] + hexDigits[d2];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回大写MD5</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> origin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> charsetname</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">MD5Encode</span><span class="params">(String origin, String charsetname)</span> </span>&#123;</span><br><span class="line">        String resultString = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            resultString = <span class="keyword">new</span> String(origin);</span><br><span class="line">            MessageDigest md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">            <span class="keyword">if</span> (charsetname == <span class="keyword">null</span> || <span class="string">""</span>.equals(charsetname))</span><br><span class="line">                resultString = byteArrayToHexString(md.digest(resultString.getBytes()));</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                resultString = byteArrayToHexString(md.digest(resultString.getBytes(charsetname)));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resultString.toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">MD5EncodeUtf8</span><span class="params">(String origin)</span> </span>&#123;</span><br><span class="line">        origin = origin + PropertiesUtil.getProperty(<span class="string">"password.salt"</span>, <span class="string">""</span>);</span><br><span class="line">        <span class="keyword">return</span> MD5Encode(origin, <span class="string">"utf-8"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String hexDigits[] = &#123;<span class="string">"0"</span>, <span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>,</span><br><span class="line">            <span class="string">"6"</span>, <span class="string">"7"</span>, <span class="string">"8"</span>, <span class="string">"9"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2、门户用户注册-user-regiser-do"><a href="#2、门户用户注册-user-regiser-do" class="headerlink" title="2、门户用户注册/user/regiser.do"></a>2、门户用户注册/user/regiser.do</h2><h4 id="request-1"><a href="#request-1" class="headerlink" title="request"></a>request</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username,password,email,phone,question,answer</span><br></pre></td></tr></table></figure>
<h4 id="fail-1"><a href="#fail-1" class="headerlink" title="fail"></a>fail</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;用户已存在&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="success-1"><a href="#success-1" class="headerlink" title="success"></a>success</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;msg&quot;: &quot;校验成功&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注册的<code>controller</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"register.do"</span>,method = RequestMethod.GET)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">register</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.register(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的<code>service</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">register</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line"><span class="comment">//用户校验老方法：</span></span><br><span class="line"><span class="comment">//int resultCount = userMapper.checkUsername(user.getUsername());</span></span><br><span class="line"><span class="comment">//  if(resultCount &gt; 0)&#123;</span></span><br><span class="line"><span class="comment">//      return ServerResponse.createByErrorMessage("用户名已存在");</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line">    ServerResponse validResponse = <span class="keyword">this</span>.checkValid(user.getUsername(),Constants.USERNAME);</span><br><span class="line">    <span class="comment">//如果返回成功，说明用户名不存在</span></span><br><span class="line">    <span class="keyword">if</span>(!validResponse.isSuccess())&#123;</span><br><span class="line">        <span class="keyword">return</span> validResponse;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//邮箱校验老方法：</span></span><br><span class="line"><span class="comment">//resultCount = userMapper.checkEmail(user.getEmail());</span></span><br><span class="line"><span class="comment">//  if(resultCount &gt; 0)&#123;</span></span><br><span class="line"><span class="comment">//      return ServerResponse.createByErrorMessage("邮箱已存在");</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line">    validResponse = <span class="keyword">this</span>.checkValid(user.getEmail(),Constants.EMAIL);</span><br><span class="line">    <span class="comment">//如果返回成功，说明邮箱不存在</span></span><br><span class="line">    <span class="keyword">if</span>(!validResponse.isSuccess())&#123;</span><br><span class="line">        <span class="keyword">return</span> validResponse;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//默认是普通用户</span></span><br><span class="line">    user.setRole(Constants.Role.ROLE_CUSTOMER);</span><br><span class="line">    <span class="comment">//MD5加密</span></span><br><span class="line">    user.setPassword(MD5Util.MD5EncodeUtf8(user.getPassword()));</span><br><span class="line">    <span class="keyword">int</span> resultCount = userMapper.insert(user);</span><br><span class="line">    <span class="keyword">if</span>(resultCount == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"注册失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createBySuccessMessage(<span class="string">"注册成功"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里设置默认角色用到一个轻量的常量类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Role</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ROLE_CUSTOMER = <span class="number">0</span>;<span class="comment">//普通用户</span></span><br><span class="line">    <span class="keyword">int</span> ROLE_ADMIN = <span class="number">1</span>;<span class="comment">//管理员</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先判断注册输入的用户名是否已经存在，然后再判断邮箱是否已经存在。这里复用了用户校验的一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/check_valid.<span class="keyword">do</span>?str=admin&amp;type=username就是检查用户名</span><br></pre></td></tr></table></figure>
<h4 id="request-2"><a href="#request-2" class="headerlink" title="request"></a>request</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str,type</span><br><span class="line">str可以是用户名也可以是email。对应的type是username和email</span><br></pre></td></tr></table></figure>
<h4 id="fail-2"><a href="#fail-2" class="headerlink" title="fail"></a>fail</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;用户已存在&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="success-2"><a href="#success-2" class="headerlink" title="success"></a>success</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;msg&quot;: &quot;校验成功&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">checkValid</span><span class="params">(String str,String type)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isNotBlank(type))&#123;</span><br><span class="line">        <span class="keyword">if</span> (Constants.USERNAME.equals(type))&#123;</span><br><span class="line">            <span class="keyword">int</span> resultCount = userMapper.checkUsername(str);</span><br><span class="line">            <span class="keyword">if</span>(resultCount &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"用户名已存在"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Constants.EMAIL.equals(type))&#123;</span><br><span class="line">            <span class="keyword">int</span> resultCount = userMapper.checkEmail(str);</span><br><span class="line">            <span class="keyword">if</span>(resultCount &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"邮箱已存在"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createBySuccessMessage(<span class="string">"校验成功"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里用到常量类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EMAIL = <span class="string">"email"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String USERNAME = <span class="string">"username"</span>;</span><br></pre></td></tr></table></figure>
<p>这里还直接封装为一个api:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">检验用户是否有效：/user/check_valid.do</span><br></pre></td></tr></table></figure>
<p>对应的controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"check_valid.do"</span>,method = RequestMethod.GET)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">checkValid</span><span class="params">(String str,String type)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.checkValid(str,type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3、门户用户登出"><a href="#3、门户用户登出" class="headerlink" title="3、门户用户登出"></a>3、门户用户登出</h2><h4 id="request-3"><a href="#request-3" class="headerlink" title="request"></a>request</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无</span><br></pre></td></tr></table></figure>
<h4 id="fail-3"><a href="#fail-3" class="headerlink" title="fail"></a>fail</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;服务端异常&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="success-3"><a href="#success-3" class="headerlink" title="success"></a>success</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;msg&quot;: &quot;退出成功&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"logout.do"</span>,method = RequestMethod.GET)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">logout</span><span class="params">(HttpSession session)</span></span>&#123;</span><br><span class="line">    session.removeAttribute(Constants.CURRENT_USER);</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createBySuccess();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-获取登录用户信息-user-get-user-info-do"><a href="#4-获取登录用户信息-user-get-user-info-do" class="headerlink" title="4.获取登录用户信息 /user/get_user_info.do"></a>4.获取登录用户信息 /user/get_user_info.do</h2><h4 id="request-4"><a href="#request-4" class="headerlink" title="request"></a>request</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无参</span><br></pre></td></tr></table></figure>
<h4 id="fail-4"><a href="#fail-4" class="headerlink" title="fail"></a>fail</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;用户未登录,无法获取当前用户信息&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="success-4"><a href="#success-4" class="headerlink" title="success"></a>success</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: 12,</span><br><span class="line">        &quot;username&quot;: &quot;aaa&quot;,</span><br><span class="line">        &quot;email&quot;: &quot;aaa@163.com&quot;,</span><br><span class="line">        &quot;phone&quot;: null,</span><br><span class="line">        &quot;role&quot;: 0,</span><br><span class="line">        &quot;createTime&quot;: 1479048325000,</span><br><span class="line">        &quot;updateTime&quot;: 1479048325000</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>controller</code>层的方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"get_user_info.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">getUserInfo</span><span class="params">(HttpSession session)</span></span>&#123;</span><br><span class="line">    User user = (User)session.getAttribute(Constants.CURRENT_USER);</span><br><span class="line">    <span class="keyword">if</span>(user!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createBySuccess(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"用户未登陆，无法获取当前用户的信息"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="5-忘记密码-user-forget-get-question-do"><a href="#5-忘记密码-user-forget-get-question-do" class="headerlink" title="5.忘记密码 /user/forget_get_question.do"></a>5.忘记密码 /user/forget_get_question.do</h2><p>request<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localhost:8080/user/forget_get_question.do?username=geely</span><br><span class="line">参数：username</span><br></pre></td></tr></table></figure></p>
<p>fail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;该用户未设置找回密码问题&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>sucess<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;data&quot;: &quot;这里是问题&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>问题的<code>controller</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"forget_get_question.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse <span class="title">forgetGetQuestion</span><span class="params">(String username)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.selectQuestion(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对应的<code>service</code>是:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public ServerResponse selectQuestion(String username)&#123;</span><br><span class="line">    ServerResponse validReponse = checkValid(username,Constants.USERNAME);</span><br><span class="line">    if(validReponse.isSuccess())&#123;</span><br><span class="line">        return ServerResponse.createByErrorMessage(&quot;用户不存在&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //SELECT question from mmall_user where username = #&#123;username&#125;  </span><br><span class="line">    String question = userMapper.selectQuestionByUsername(username);</span><br><span class="line">    if(StringUtils.isNotBlank(question))&#123;</span><br><span class="line">        return ServerResponse.createBySuccess(question);</span><br><span class="line">    &#125;</span><br><span class="line">    return ServerResponse.createByErrorMessage(&quot;找回密码的问题是空的&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="6-提交问题答案-user-forget-check-answer-do"><a href="#6-提交问题答案-user-forget-check-answer-do" class="headerlink" title="6.提交问题答案 /user/forget_check_answer.do"></a>6.提交问题答案 /user/forget_check_answer.do</h2><p>request<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username,question,answer</span><br></pre></td></tr></table></figure></p>
<p>fail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;问题答案错误&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>success<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;data&quot;: &quot;531ef4b4-9663-4e6d-9a20-fb56367446a5&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个api的主要功能是判断回答是否正确，正确的话返回<code>token</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"forget_check_answer.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">forgetCheckAnswer</span><span class="params">(String username,String question,String answer)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.checkAnswer(username,question,answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应点<code>service</code>是：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">checkAnswer</span><span class="params">(String username,String question,String answer)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> resultCount = userMapper.checkAnswer(username,question,answer);</span><br><span class="line">    <span class="keyword">if</span>(resultCount &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//说明问题及答案都是正确的，都是对应到这个用户的</span></span><br><span class="line">        String forgetToken = UUID.randomUUID().toString();</span><br><span class="line">        TokenCache.setKey(TokenCache.TOKEN_PREFIX+username,forgetToken);</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createBySuccess(forgetToken);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"问题的答案错误"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里将<code>token</code>值放入一个缓存中，设置过期时间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenCache</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(TokenCache.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOKEN_PREFIX = <span class="string">"token_"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//LRU算法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LoadingCache&lt;String,String&gt; localCache = CacheBuilder.newBuilder().initialCapacity(<span class="number">1000</span>).maximumSize(<span class="number">10000</span>).expireAfterAccess(<span class="number">12</span>, TimeUnit.HOURS)</span><br><span class="line">            .build(<span class="keyword">new</span> CacheLoader&lt;String, String&gt;() &#123;</span><br><span class="line">                <span class="comment">//默认的数据加载实现,当调用get取值的时候,如果key没有对应的值,就调用这个方法进行加载.</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">load</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"null"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setKey</span><span class="params">(String key,String value)</span></span>&#123;</span><br><span class="line">        localCache.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getKey</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        String value = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            value = localCache.get(key);</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"null"</span>.equals(value))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            logger.error(<span class="string">"localCache get error"</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-忘记密码的重设密码-user-forget-reset-password-do"><a href="#7-忘记密码的重设密码-user-forget-reset-password-do" class="headerlink" title="7.忘记密码的重设密码 /user/forget_reset_password.do"></a>7.忘记密码的重设密码 /user/forget_reset_password.do</h2><p>request<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username,passwordNew,forgetToken</span><br></pre></td></tr></table></figure></p>
<p>fail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;修改密码操作失效&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>success<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;msg&quot;: &quot;修改密码成功&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>检查答案是否正确的<code>controller</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"forget_reset_password.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">forgetRestPassword</span><span class="params">(String username,String passwordNew,String forgetToken)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.forgetRestPassword(username,passwordNew,forgetToken);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的service是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public ServerResponse&lt;String&gt; forgetRestPassword(String username,String passwordNew,String forgetToken)&#123;</span><br><span class="line">    //1、校验参数是否为空</span><br><span class="line">    if(StringUtils.isBlank(forgetToken))&#123;</span><br><span class="line">        return ServerResponse.createByErrorMessage(&quot;参数错误，token需要传递&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //2、校验username</span><br><span class="line">    ServerResponse validReponse = checkValid(username,Constants.USERNAME);</span><br><span class="line">    if(validReponse.isSuccess())&#123;</span><br><span class="line">        return ServerResponse.createByErrorMessage(&quot;用户不存在&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //3、获取token</span><br><span class="line">    String token = TokenCache.getKey(TokenCache.TOKEN_PREFIX+username);</span><br><span class="line">    if(StringUtils.isBlank(token))&#123;</span><br><span class="line">        return ServerResponse.createByErrorMessage(&quot;token无效或者过期&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //4、判断token是否一致</span><br><span class="line">    if(StringUtils.equals(token,forgetToken))&#123;</span><br><span class="line">        String md5Password = MD5Util.MD5EncodeUtf8(passwordNew);</span><br><span class="line">        int resultCount = userMapper.updatePasswordByUsername(username,md5Password);</span><br><span class="line">        if(resultCount&gt;0)&#123;</span><br><span class="line">            return ServerResponse.createBySuccessMessage(&quot;修改密码成功&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        return ServerResponse.createByErrorMessage(&quot;token错误，请重新获取&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return ServerResponse.createByErrorMessage(&quot;修改密码失败&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="8-登录中状态重置密码-user-reset-password-do"><a href="#8-登录中状态重置密码-user-reset-password-do" class="headerlink" title="8.登录中状态重置密码 /user/reset_password.do"></a>8.登录中状态重置密码 /user/reset_password.do</h2><p>request<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwordOld,passwordNew</span><br></pre></td></tr></table></figure></p>
<p>fail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;旧密码输入错误&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>success<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;msg&quot;: &quot;修改密码成功&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>controller</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"reset_password.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;String&gt; <span class="title">resetPassword</span><span class="params">(HttpSession session,String passwordOld,String passwordNew)</span></span>&#123;</span><br><span class="line">    User user = (User)session.getAttribute(Constants.CURRENT_USER);</span><br><span class="line">    <span class="keyword">if</span>(user==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"用户未登陆"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userService.resetPassword(passwordOld,passwordNew,user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的<code>service</code>是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public ServerResponse&lt;String&gt; resetPassword(String passwordOld, String passwordNew,User user)&#123;</span><br><span class="line">    int resultCount = userMapper.checkPassword(MD5Util.MD5EncodeUtf8(passwordOld),user.getId());</span><br><span class="line">    if(resultCount==0)&#123;</span><br><span class="line">        return ServerResponse.createByErrorMessage(&quot;旧密码错误&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setPassword(MD5Util.MD5EncodeUtf8(passwordNew));</span><br><span class="line">    int updateResult = userMapper.updateByPrimaryKeySelective(user);</span><br><span class="line">    if(updateResult&gt;0)&#123;</span><br><span class="line">        return ServerResponse.createBySuccessMessage(&quot;更新密码成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return ServerResponse.createByErrorMessage(&quot;更新密码失败&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="9-登录状态更新个人信息-user-update-information-do"><a href="#9-登录状态更新个人信息-user-update-information-do" class="headerlink" title="9.登录状态更新个人信息 /user/update_information.do"></a>9.登录状态更新个人信息 /user/update_information.do</h2><p>request<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">email,phone,question,answer</span><br></pre></td></tr></table></figure></p>
<p>fail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;用户未登录&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>success<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;msg&quot;: &quot;更新个人信息成功&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>controller</code>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"update_information.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">update_information</span><span class="params">(HttpSession session,User user)</span></span>&#123;</span><br><span class="line">    User currentUser = (User)session.getAttribute(Constants.CURRENT_USER);</span><br><span class="line">    <span class="keyword">if</span>(currentUser==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"用户未登陆"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setId(currentUser.getId());</span><br><span class="line">    user.setUsername(currentUser.getUsername());</span><br><span class="line">    ServerResponse&lt;User&gt; response = userService.updateInfo(user);</span><br><span class="line">    <span class="keyword">if</span>(response.isSuccess())&#123;</span><br><span class="line">        session.setAttribute(Constants.CURRENT_USER,response.getData());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对应<code>service</code>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">updateInfo</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> resulCount = userMapper.checkEmailByUserId(user.getEmail(),user.getId());</span><br><span class="line">    <span class="keyword">if</span>(resulCount&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"email已经存在，请更换email，再尝试更新"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    User updateUser = <span class="keyword">new</span> User();</span><br><span class="line">    updateUser.setId(user.getId());</span><br><span class="line">    updateUser.setEmail(user.getEmail());</span><br><span class="line">    updateUser.setPhone(user.getPhone());</span><br><span class="line">    updateUser.setQuestion(user.getQuestion());</span><br><span class="line">    updateUser.setAnswer(user.getAnswer());</span><br><span class="line">    <span class="keyword">int</span> updateCount = userMapper.updateByPrimaryKeySelective(updateUser);</span><br><span class="line">    <span class="keyword">if</span>(updateCount &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createBySuccess(<span class="string">"更新信息成功"</span>,updateUser);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"更新信息失败"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在更新邮箱的时候，要先判断邮箱是否被其他用户使用了。</p>
<h2 id="10-获取当前登录用户的详细信息，并强制登录-user-get-information-do"><a href="#10-获取当前登录用户的详细信息，并强制登录-user-get-information-do" class="headerlink" title="10.获取当前登录用户的详细信息，并强制登录 /user/get_information.do"></a>10.获取当前登录用户的详细信息，并强制登录 /user/get_information.do</h2><p>request<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无参</span><br></pre></td></tr></table></figure></p>
<p>fail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 10,</span><br><span class="line">    &quot;msg&quot;: &quot;用户未登录,无法获取当前用户信息,status=10,强制登录&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>success<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: 1,</span><br><span class="line">        &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">        &quot;password&quot;: &quot;&quot;,</span><br><span class="line">        &quot;email&quot;: &quot;admin@163.com&quot;,</span><br><span class="line">        &quot;phone&quot;: &quot;13800138000&quot;,</span><br><span class="line">        &quot;question&quot;: &quot;question&quot;,</span><br><span class="line">        &quot;answer&quot;: &quot;answer&quot;,</span><br><span class="line">        &quot;role&quot;: 1,</span><br><span class="line">        &quot;createTime&quot;: 1478422605000,</span><br><span class="line">        &quot;updateTime&quot;: 1491305256000</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>controller</code>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"get_infomation.do"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">get_infomation</span><span class="params">(HttpSession session)</span></span>&#123;</span><br><span class="line">    User currentUser = (User)session.getAttribute(Constants.CURRENT_USER);</span><br><span class="line">    <span class="keyword">if</span>(currentUser==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorCodeMessage(ResponseEnum.NEED_LOGIN.getCode(),ResponseEnum.NEED_LOGIN.getDesc());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> userService.getInfomation(currentUser.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对应的<code>service</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">getInfomation</span><span class="params">(Integer userId)</span></span>&#123;</span><br><span class="line">    User user = userMapper.selectByPrimaryKey(userId);</span><br><span class="line">    <span class="keyword">if</span>(user==<span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"找不到当前用户"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    user.setPassword(StringUtils.EMPTY);</span><br><span class="line">    <span class="keyword">return</span> ServerResponse.createBySuccess(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="11-后台管理员登录"><a href="#11-后台管理员登录" class="headerlink" title="11.后台管理员登录"></a>11.后台管理员登录</h2><p>request<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String username,</span><br><span class="line">String password</span><br></pre></td></tr></table></figure></p>
<p>fail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 1,</span><br><span class="line">    &quot;msg&quot;: &quot;密码错误&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>success<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: 0,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: 12,</span><br><span class="line">        &quot;username&quot;: &quot;aaa&quot;,</span><br><span class="line">        &quot;email&quot;: &quot;aaa@163.com&quot;,</span><br><span class="line">        &quot;phone&quot;: null,</span><br><span class="line">        &quot;role&quot;: 0,</span><br><span class="line">        &quot;createTime&quot;: 1479048325000,</span><br><span class="line">        &quot;updateTime&quot;: 1479048325000</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>controller</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/manage/user/"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserManageController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"login.do"</span>,method = RequestMethod.POST)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerResponse&lt;User&gt; <span class="title">login</span><span class="params">(String username, String password, HttpSession session)</span></span>&#123;</span><br><span class="line">        ServerResponse&lt;User&gt; response = userService.login(username,password);</span><br><span class="line">        <span class="keyword">if</span>(response.isSuccess())&#123;</span><br><span class="line">            User user = response.getData();</span><br><span class="line">            <span class="keyword">if</span>(user.getRole() == Constants.Role.ROLE_ADMIN)&#123;</span><br><span class="line">                session.setAttribute(Constants.CURRENT_USER,user);</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> ServerResponse.createByErrorMessage(<span class="string">"不是管理员，无法登陆"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/07/21/7.@Import/" class="prev">上一篇</a><a href="/2018/07/21/6、二分搜索树（上）/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2019 <a href="http://yoursite.com">Eureka</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>