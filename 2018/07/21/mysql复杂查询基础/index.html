<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> mysql复杂查询基础 · Eureka-Home</title><meta name="description" content="mysql复杂查询基础 - Eureka"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Eureka-Home"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/sunweiguo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">mysql复杂查询基础</h1><div class="post-info">Jul 21, 2018</div><div class="post-content"><p>这是我自己的关于mysql基础的学习笔记，想想还是贴在这里了，主要还是看之前的《sql必知必会》。<br><a id="more"></a></p>
<h3 id="1、新建student-teacher-course-score四张表-建表以及准备基本数据："><a href="#1、新建student-teacher-course-score四张表-建表以及准备基本数据：" class="headerlink" title="1、新建student,teacher,course,score四张表,建表以及准备基本数据："></a>1、新建student,teacher,course,score四张表,建表以及准备基本数据：</h3><ul>
<li>student:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`student`</span>(</span><br><span class="line"><span class="string">`Sid`</span>  <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'学生id'</span>,</span><br><span class="line"><span class="string">`Sname`</span>  <span class="built_in">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'学生姓名'</span>,</span><br><span class="line"><span class="string">`Ssex`</span>  <span class="built_in">varchar</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'学生性别'</span>,</span><br><span class="line"><span class="string">`Sbirthday`</span>  datetime <span class="literal">NULL</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'学生出生日期'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`S_id`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(Sname,Ssex,Sbirthday) <span class="keyword">VALUES</span>(<span class="string">"赵蕾"</span>,<span class="string">"男"</span>,<span class="string">"1990-01-01 00:00:00"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(Sname,Ssex,Sbirthday) <span class="keyword">VALUES</span>(<span class="string">"毕竟"</span>,<span class="string">"男"</span>,<span class="string">"1990-11-01 00:00:00"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(Sname,Ssex,Sbirthday) <span class="keyword">VALUES</span>(<span class="string">"卖你"</span>,<span class="string">"男"</span>,<span class="string">"1990-05-01 00:00:00"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(Sname,Ssex,Sbirthday) <span class="keyword">VALUES</span>(<span class="string">"机器"</span>,<span class="string">"男"</span>,<span class="string">"1990-08-01 00:00:00"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(Sname,Ssex,Sbirthday) <span class="keyword">VALUES</span>(<span class="string">"电话"</span>,<span class="string">"女"</span>,<span class="string">"1991-01-01 00:00:00"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(Sname,Ssex,Sbirthday) <span class="keyword">VALUES</span>(<span class="string">"没事"</span>,<span class="string">"女"</span>,<span class="string">"1992-01-01 00:00:00"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(Sname,Ssex,Sbirthday) <span class="keyword">VALUES</span>(<span class="string">"请问"</span>,<span class="string">"女"</span>,<span class="string">"1989-01-01 00:00:00"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student(Sname,Ssex,Sbirthday) <span class="keyword">VALUES</span>(<span class="string">"阿三"</span>,<span class="string">"女"</span>,<span class="string">"1990-01-01 00:00:00"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>teacher:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`teacher`</span> (</span><br><span class="line"><span class="string">`Tid`</span>  <span class="built_in">bigint</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'老师id'</span>,</span><br><span class="line"><span class="string">`Tname`</span>  <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'老师姓名'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`Tid`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher(Tname) <span class="keyword">VALUES</span>(<span class="string">"张三"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher(Tname) <span class="keyword">VALUES</span>(<span class="string">"李四"</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher(Tname) <span class="keyword">VALUES</span>(<span class="string">"王五"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>course:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`course`</span> (</span><br><span class="line"><span class="string">`Cid`</span>  <span class="built_in">bigint</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'课程id'</span>,</span><br><span class="line"><span class="string">`Cname`</span>  <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'课程名称'</span>,</span><br><span class="line"><span class="string">`Tid`</span>  <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'老师id'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`Cid`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course(Cname,Tid) <span class="keyword">VALUES</span>(<span class="string">"语文"</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course(Cname,Tid) <span class="keyword">VALUES</span>(<span class="string">"数学"</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course(Cname,Tid) <span class="keyword">VALUES</span>(<span class="string">"英语"</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>score:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">注意这里的Sid和Cid是联合主键，分别代表学生id和课程id</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`score`</span> (</span><br><span class="line"><span class="string">`Sid`</span>  <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'学生id'</span>,</span><br><span class="line"><span class="string">`Cid`</span>  <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'课程id'</span>,</span><br><span class="line"><span class="string">`score`</span>  <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'分数'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`Sid`</span>, <span class="string">`Cid`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">80.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">90.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">99.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="number">1</span>,<span class="number">70.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">60.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="number">3</span>,<span class="number">80.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="number">1</span>,<span class="number">80.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="number">2</span>,<span class="number">80.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="number">3</span>,<span class="number">80.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">4</span>,<span class="number">1</span>,<span class="number">50.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">4</span>,<span class="number">2</span>,<span class="number">30.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">4</span>,<span class="number">3</span>,<span class="number">20.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">5</span>,<span class="number">1</span>,<span class="number">76.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">5</span>,<span class="number">2</span>,<span class="number">87.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">6</span>,<span class="number">1</span>,<span class="number">31.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">6</span>,<span class="number">3</span>,<span class="number">37.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">7</span>,<span class="number">2</span>,<span class="number">89.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score(<span class="keyword">Sid</span>,Cid,score) <span class="keyword">VALUES</span>(<span class="number">7</span>,<span class="number">3</span>,<span class="number">98.0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="2、简单的查询"><a href="#2、简单的查询" class="headerlink" title="2、简单的查询"></a>2、简单的查询</h3><ul>
<li>where …  and … </li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#名字是赵蕾并且性别是男的数据</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student s <span class="keyword">where</span> s.Sname=<span class="string">"赵蕾"</span> <span class="keyword">AND</span> s.Ssex=<span class="string">"男"</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>where … or …  </li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#名字是赵蕾或者性别是男的数据</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student s <span class="keyword">where</span> s.Sname=<span class="string">"赵蕾"</span> <span class="keyword">OR</span> s.Ssex=<span class="string">"男"</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>distinct 不重复的数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> s.Ssex <span class="keyword">FROM</span> student s</span><br></pre></td></tr></table></figure>
<ul>
<li>order by 排序</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#升序</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student s <span class="keyword">ORDER</span> <span class="keyword">BY</span> s.Sbirthday <span class="keyword">ASC</span></span><br><span class="line"></span><br><span class="line">#降序</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student s <span class="keyword">ORDER</span> <span class="keyword">BY</span> s.Sbirthday <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line">#多个条件，顺序匹配</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student s <span class="keyword">ORDER</span> <span class="keyword">BY</span> s.Sbirthday <span class="keyword">DESC</span>,s.Sid <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>
<ul>
<li>模糊查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student s <span class="keyword">WHERE</span> s.Sname <span class="keyword">LIKE</span> <span class="string">'赵%'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>limit (偏移位置，查询数量)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> student s <span class="keyword">ORDER</span> <span class="keyword">BY</span> s.Sbirthday <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">3</span></span><br></pre></td></tr></table></figure>
<ul>
<li>max min sum avg count等函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(s.score) <span class="keyword">from</span> score s </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(s.score) <span class="keyword">from</span> score s </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(s.score) <span class="keyword">from</span> score s </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(s.score) <span class="keyword">from</span> score s</span><br></pre></td></tr></table></figure>
<ul>
<li>in,not in</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> score s <span class="keyword">WHERE</span> s.score <span class="keyword">IN</span> (<span class="number">80</span>,<span class="number">90</span>,<span class="number">99</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> score s <span class="keyword">WHERE</span> s.score <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">80</span>,<span class="number">90</span>,<span class="number">99</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>between</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> score s <span class="keyword">WHERE</span> s.score <span class="keyword">BETWEEN</span> <span class="number">90</span> <span class="keyword">AND</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>
<ul>
<li>联合查询</li>
</ul>
<p>查询学生分别考多少分<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s.Sname,sc.score <span class="keyword">from</span> student s,score sc <span class="keyword">WHERE</span> s.Sid = sc.Sid</span><br></pre></td></tr></table></figure></p>
<p>查询单科最高分数的那个学生<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s.Sname,sc.score <span class="keyword">from</span> student s,score sc <span class="keyword">WHERE</span> s.Sid = sc.Sid</span><br><span class="line"><span class="keyword">AND</span> sc.score = (<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(score.score) <span class="keyword">FROM</span> score)</span><br></pre></td></tr></table></figure></p>
<p>再把对应的老师也调出来,老的方式进行表的连接,用了子查询，查出最高分的那个人<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	s.Sname,</span><br><span class="line">	sc.score,</span><br><span class="line">	t.Tname</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student s,</span><br><span class="line">	score sc,</span><br><span class="line">	teacher t,</span><br><span class="line">	course c</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	s.Sid = sc.Sid</span><br><span class="line"><span class="keyword">AND</span> sc.Cid = c.Cid</span><br><span class="line"><span class="keyword">AND</span> c.Tid = t.Tid</span><br><span class="line"><span class="keyword">AND</span> sc.score = (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		<span class="keyword">MAX</span>(score.score)</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		score</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>group by</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#查询每门学科的平均分</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sc.score),c.Cname <span class="keyword">FROM</span> score sc,course c <span class="keyword">WHERE</span> sc.Cid=c.Cid <span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.Cid</span><br><span class="line"></span><br><span class="line">#分组之后的筛选，用<span class="keyword">having</span>把平均分大于<span class="number">70</span>的一条显示出来</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sc.score),c.Cname <span class="keyword">FROM</span> score sc,course c <span class="keyword">WHERE</span> sc.Cid=c.Cid <span class="keyword">GROUP</span> <span class="keyword">BY</span> sc.Cid <span class="keyword">HAVING</span> <span class="keyword">AVG</span>(sc.score)&gt;<span class="number">70</span></span><br><span class="line"></span><br><span class="line">#<span class="keyword">having</span>和<span class="keyword">where</span>区别</span><br><span class="line">#<span class="keyword">having</span>与<span class="keyword">where</span>类似，可以筛选数据，<span class="keyword">where</span>后的表达式怎么写，<span class="keyword">having</span>后就怎么写</span><br><span class="line">#<span class="keyword">where</span>针对表中的列发挥作用，查询数据</span><br><span class="line">#<span class="keyword">having</span>对查询结果中的列发挥作用，筛选数据</span><br></pre></td></tr></table></figure>
<ul>
<li>join</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#用join代替上面的老语法</span><br><span class="line"><span class="keyword">SELECT</span> s.Sname,sc.score,t.Tname <span class="keyword">from</span> student s <span class="keyword">JOIN</span> teacher t <span class="keyword">JOIN</span> score sc <span class="keyword">JOIN</span> course c</span><br><span class="line"><span class="keyword">WHERE</span> sc.Sid=s.Sid <span class="keyword">AND</span> sc.Cid=c.Cid <span class="keyword">AND</span> c.Tid=t.Tid <span class="keyword">AND</span> sc.score = (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		<span class="keyword">MAX</span>(score.score)</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		score</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">#两种外连接：左连接和右连接，左连接就是左边表全出来，右边不符合的就以空显示出来；</span><br><span class="line">#右连接也是如此。</span><br><span class="line"><span class="keyword">SELECT</span> s.Sname,sc.score <span class="keyword">from</span> student s <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sc <span class="keyword">on</span> s.Sid = sc.Sid</span><br><span class="line">此时发现<span class="number">8</span>号阿三这位姑娘显示出来了，但是分数为<span class="literal">null</span>。</span><br></pre></td></tr></table></figure>
<ul>
<li>case when:类似于swith..case..</li>
</ul>
<p>先查出每个学生每门成绩是多少：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	s.Sname,</span><br><span class="line">	c.Cname,</span><br><span class="line">	sc.score</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student s</span><br><span class="line"><span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.Sid = sc.Sid</span><br><span class="line"><span class="keyword">JOIN</span> course c <span class="keyword">ON</span> c.Cid = sc.Cid</span><br></pre></td></tr></table></figure>
<p>将90以上置为优秀，80-90分之间为良好，80以下为勉强<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	s.Sname,</span><br><span class="line">	c.Cname,</span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> sc.score&gt;<span class="number">90</span> <span class="keyword">THEN</span> <span class="string">'优秀'</span> </span><br><span class="line"><span class="keyword">WHEN</span> sc.score <span class="keyword">BETWEEN</span> <span class="number">80</span> <span class="keyword">AND</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="string">'良好'</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">'勉强'</span> <span class="keyword">END</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student s</span><br><span class="line"><span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.Sid = sc.Sid</span><br><span class="line"><span class="keyword">JOIN</span> course c <span class="keyword">ON</span> c.Cid = sc.Cid</span><br></pre></td></tr></table></figure></p>
<p>行转列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"> s.Sname,</span><br><span class="line"><span class="keyword">CASE</span> sc.Cid <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> sc.score <span class="keyword">end</span> <span class="keyword">AS</span> <span class="string">'语文'</span>,</span><br><span class="line"><span class="keyword">CASE</span> sc.Cid <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> sc.score <span class="keyword">end</span> <span class="keyword">AS</span> <span class="string">'数学'</span>,</span><br><span class="line"><span class="keyword">CASE</span> sc.Cid <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> sc.score <span class="keyword">end</span> <span class="keyword">AS</span> <span class="string">'英语'</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student s</span><br><span class="line"><span class="keyword">JOIN</span> score sc <span class="keyword">ON</span> s.Sid = sc.Sid</span><br><span class="line"><span class="keyword">JOIN</span> course c <span class="keyword">ON</span> c.Cid = sc.Cid</span><br></pre></td></tr></table></figure>
<ul>
<li>子查询</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#分为三种：where型子查询、from型子查询、exists型子查询</span><br></pre></td></tr></table></figure>
<ul>
<li>union</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#用于合并两个或多个 SELECT 语句的结果集，并消去表中任何重复行。如果允许重复的值，请使用 UNION ALL。</span><br><span class="line">#UNION 内部的 SELECT 语句必须拥有相同数量的列，列也必须拥有相似的数据类型。</span><br></pre></td></tr></table></figure>
<h3 id="3、mysql中四种隔离机制"><a href="#3、mysql中四种隔离机制" class="headerlink" title="3、mysql中四种隔离机制"></a>3、mysql中四种隔离机制</h3><ul>
<li>未提交读(<code>Read Uncommitted</code>)：允许脏读，也就是可能读取到其他会话中未提交事务修改的数据</li>
<li>提交读(<code>Read Committed</code>)：只能读取到已经提交的数据。Oracle等多数数据库默认都是该级别 (不重复读)</li>
<li>可重复读(<code>Repeated Read</code>)：可重复读。在同一个事务内的查询都是事务开始时刻一致的，InnoDB默认级别。在SQL标准中，该隔离级别消除了不可重复读，但是还存在幻象读。在mysql中，是默认的隔离机制，并且解决了在插入数据时产生的幻影读的问题。</li>
<li>串行读(<code>Serializable</code>)：完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞。效率比较低。</li>
</ul>
<p><code>mysql</code>中，默认的引擎是<code>InnoDB</code>默认是可重复读的（<code>REPEATABLE READ</code>），支持事务。</p>
<p>还有一种是<code>MyISAM</code>引擎，不支持事务，对于不修改的数据效率查询比较高。</p>
<p>名词解释：</p>
<ul>
<li><strong>脏读</strong>: 脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。</li>
<li><strong>不可重复读</strong>:是指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。</li>
<li><strong>可重复读</strong>:两个事务，一个事务中修改提交了，另一个事务整个过程不受其影响。</li>
<li><strong>幻读</strong>:第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。<br>简而言之就是一个事务中增加了一条记录，另一个事务中一开始没读到，然后想插入同样的记录的时候报错了，因为重复了。</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2018/07/21/mysql最基础知识小结/" class="prev">PREV</a><a href="/2018/07/21/maven/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 <a href="http://yoursite.com">Eureka</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>