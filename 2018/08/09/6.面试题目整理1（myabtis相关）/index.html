<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>6.面试题目整理1（myabtis相关） | Eureka-Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="面试题目整理1（myabtis相关）。">
<meta name="keywords" content="面试">
<meta property="og:type" content="article">
<meta property="og:title" content="6.面试题目整理1（myabtis相关）">
<meta property="og:url" content="http://yoursite.com/2018/08/09/6.面试题目整理1（myabtis相关）/index.html">
<meta property="og:site_name" content="Eureka-Home">
<meta property="og:description" content="面试题目整理1（myabtis相关）。">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://p9l5rzdf0.bkt.clouddn.com/sql%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E5%9B%A001.png">
<meta property="og:updated_time" content="2018-08-09T00:56:49.837Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="6.面试题目整理1（myabtis相关）">
<meta name="twitter:description" content="面试题目整理1（myabtis相关）。">
<meta name="twitter:image" content="http://p9l5rzdf0.bkt.clouddn.com/sql%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E5%9B%A001.png">
  
    <link rel="alternate" href="/atom.xml" title="Eureka-Home" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Eureka-Home</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">学习技术一口吃不成胖子，慢慢走，每天只要进步一丢丢！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-6.面试题目整理1（myabtis相关）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/09/6.面试题目整理1（myabtis相关）/" class="article-date">
  <time datetime="2018-08-09T00:47:24.262Z" itemprop="datePublished">2018-08-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      6.面试题目整理1（myabtis相关）
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>面试题目整理1（myabtis相关）。<br><a id="more"></a></p>
<h2 id="1-为什么参数化SQL查询可以防止SQL注入"><a href="#1-为什么参数化SQL查询可以防止SQL注入" class="headerlink" title="1. 为什么参数化SQL查询可以防止SQL注入?"></a>1. 为什么参数化SQL查询可以防止SQL注入?</h2><p><img src="http://p9l5rzdf0.bkt.clouddn.com/sql%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E5%9B%A001.png" alt="image"></p>
<h2 id="2-和-的区别是什么？"><a href="#2-和-的区别是什么？" class="headerlink" title="2. #{}和${}的区别是什么？"></a>2. #{}和${}的区别是什么？</h2><p>标准的答案是：==#{}是预编译处理，${}是字符串替换==。mybatis在处理#{}时，会将sql中的#{}替换为?号，调用PreparedStatement的set方法来赋值；mybatis在处理${}时，就是把${}替换成变量的值。使用#{}可以有效的防止SQL注入，提高系统安全性。</p>
<p>对于这个题目我感觉要抓住两点：</p>
<p>（1）<strong>$符号一般用来当作占位符</strong>，常使用Linux脚本的人应该对此有更深的体会吧。既然是占位符，当然就是被用来替换的。知道了这点就能很容易区分$和#，从而不容易记错了。</p>
<p>（2）<strong>预编译的机制</strong>。预编译是提前对SQL语句进行预编译，而其后注入的参数将不会再进行SQL编译。我们知道，SQL注入是发生在编译的过程中，因为恶意注入了某些特殊字符，最后被编译成了恶意的执行操作。而预编译机制则可以很好的防止SQL注入。</p>
<h2 id="3-数据库连接中断如何处理？"><a href="#3-数据库连接中断如何处理？" class="headerlink" title="3. 数据库连接中断如何处理？"></a>3. 数据库连接中断如何处理？</h2><h4 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h4><p>我们知道，数据库的访问底层是通过tcp实现的，如果数据库链接中断，那么应用程序是不知道的，是探测不出的，那么程序会卡住，一直在等待，会等待吓人的几十分钟，这种情况会把人郁闷死，真不如及时来个弹框，告诉用户系统暂时无法使用，让用户离开呢。所以，面对数据库连接中断的异常，该怎么设置mybatis呢？</p>
<h4 id="答案："><a href="#答案：" class="headerlink" title="答案："></a>答案：</h4><p>要想吃透这个问题，要明白链接中断产生的原因。这里面会涉及到网络通信的问题。==在数据库链接中，connection操作可不是计算1+1这样的形式，它的底层是个循环处理过程，既然是循环处理过程那么自然就跟时间扯上关系了==.</p>
<p>跟时间有关的设置有：<code>max_idle_time</code>，<code>connect_timeout</code>。<code>max_idle_time</code>表明最大的空闲时间，超过这个时间socket就会关闭，这样操作系统会省心省力一些，毕竟操作系统维持一个socket也是花费不少精力的。<code>connect_timeout</code>表明链接的超时时间，我们知道，网络环境就是跟潮水一样，一波一波的，总是在波动，即使数据库服务器活的杠杠的，但是因为网络用塞，客户端仍然连不上服务器端，这个时候就要设置timeout，别一直傻等着。</p>
<h2 id="4-数据库插入重复如何处理"><a href="#4-数据库插入重复如何处理" class="headerlink" title="4. 数据库插入重复如何处理"></a>4. 数据库插入重复如何处理</h2><h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><p>在开发过程中，经常遇到插入重复的现象，这种情况该如何解决呢？</p>
<h4 id="答案：-1"><a href="#答案：-1" class="headerlink" title="答案："></a>答案：</h4><p>插入的过程一般都是分两步的：先判断是否存在记录，没有存在则插入否则不插入。如果存在并发操作，那么同时进行了第一步，然后大家都发现没有记录，然后都插入了数据从而造成数据的重复。解决插入重复的思路可以是这样的：</p>
<p>（1）判断数据库是否有数据，有的话则无所作为。没有数据的话，则进行下面第2步</p>
<p>（2）向redis set key，其中只有一个操作a会成功，其他并发的操作b和c会失败的</p>
<p>（3）上面set key 成功的操作a，开始执行插入数据操作，无论是否插入数据成功，都在最后del key。【注】插入不成功可以多尝试几次，增加成功的概率。</p>
<p>（4）上面set key 失败的操作b和c，sleep一下，然后再判断数据库是否有数据，有数据则无所做为，没有数据则重复上面的set key，此时是b和c在竞争，失败者则无所作为，成功者则开始插入数据，然后无论插入成功还是失败则都要del key。【注】既然是并发了，本身就是异常情况，就没有必要考虑用户体验了，就可以多sleep一会儿也无妨，不过对于单线程多事件处理的开发模式不要sleep太久。</p>
<p>总之，上面的过程就是：线程a 线程b 线程c，同时插入数据。如果线程a拿到锁之后，让它插入数据，它插入成功了，那么线程b 线程c啥也不用做；它插入失败了，线程b 线程c则抢锁，谁抢到了谁插入数据，不管最后是否成功，程序走到此步就可以了，已经完成了既定两个目标：执行插入，不重复插入。</p>
<h2 id="5-事务执行过程中宕机的应对处理方式"><a href="#5-事务执行过程中宕机的应对处理方式" class="headerlink" title="5. 事务执行过程中宕机的应对处理方式"></a>5. 事务执行过程中宕机的应对处理方式</h2><h4 id="问题：-1"><a href="#问题：-1" class="headerlink" title="问题："></a>问题：</h4><p>数据库插入百万级数据的时候，还没操作完，但是把服务器重启了，数据库会继续执行吗？ 还是直接回滚了？</p>
<h4 id="答案：-2"><a href="#答案：-2" class="headerlink" title="答案："></a>答案：</h4><p>不会自动继续执行，不会自动直接回滚，但是可以人工手动选择继续执行或者直接回滚，依据是事务日志。</p>
<p><strong>事务开启时，事务中的操作，都会先写入存储引擎的日志缓冲中，在事务提交之前，这些缓冲的日志都需要提前刷新到磁盘上持久化，这就是人们口中常说的“日志先行”(Write-Ahead Logging)。</strong></p>
<p>日志分为两种类型：<code>redo log</code>和<code>undo log</code>.</p>
<p>（1）redo log</p>
<p>在系统启动的时候，就已经为<code>redo log</code>分配了一块连续的存储空间，以顺序追加的方式记录<code>redo log</code>，通过顺序io来改善性能。所有的事务共享<code>redo log</code>的存储空间，它们的<code>redo log</code>按语句的执行顺序，依次交替的记录在一起。如下一个简单示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">记录1：&lt;trx1, insert...&gt;</span><br><span class="line">记录2：&lt;trx2, delete...&gt;</span><br><span class="line">记录3：&lt;trx3, update...&gt;</span><br><span class="line">记录4：&lt;trx1, update...&gt;</span><br><span class="line">记录5：&lt;trx3, insert...&gt;</span><br></pre></td></tr></table></figure>
<p>此时如果数据库崩溃或者宕机，那么当系统重启进行恢复时，就可以根据<code>redo log</code>中记录的日志，把数据库恢复到崩溃前的一个状态。未完成的事务，可以继续提交，也可以选择回滚，这基于恢复的策略而定。</p>
<p>（2）undo log</p>
<p><code>undo log</code>主要为事务的回滚服务。在事务执行的过程中，除了记录<code>redo log</code>，还会记录一定量的<code>undo log</code>。<code>undo log</code>记录了数据在每个操作前的状态，如果事务执行过程中需要回滚，就可以根据<code>undo log</code>进行回滚操作。单个事务的回滚，只会回滚当前事务做的操作，并不会影响到其他的事务做的操作。</p>
<p>以下是<code>undo+redo</code>事务的简化过程，假设有2个数值，分别为A和B，值为1，2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">start transaction;</span><br><span class="line">记录 A=1 到undo log;</span><br><span class="line">update A = 3；</span><br><span class="line">记录 A=3 到redo log；</span><br><span class="line">记录 B=2 到undo log；</span><br><span class="line">update B = 4；</span><br><span class="line">记录B = 4 到redo log；</span><br><span class="line">将redo log刷新到磁盘</span><br><span class="line">commit</span><br></pre></td></tr></table></figure>
<p>在1-8的任意一步系统宕机，事务未提交，该事务就不会对磁盘上的数据做任何影响。如果在8-9之间宕机，恢复之后可以选择回滚，也可以选择继续完成事务提交，因为此时<code>redo log</code>已经持久化。若在9之后系统宕机，内存映射中变更的数据还来不及刷回磁盘，那么系统恢复之后，可以根据<code>redo log</code>把数据刷回磁盘。所以，<code>redo log</code>其实保障的是事务的持久性和一致性，而<code>undo log</code>则保障了事务的原子性。</p>
<h2 id="6-Java客户端中的一个Connection问题"><a href="#6-Java客户端中的一个Connection问题" class="headerlink" title="6. Java客户端中的一个Connection问题"></a>6. Java客户端中的一个Connection问题</h2><h4 id="问题：-2"><a href="#问题：-2" class="headerlink" title="问题："></a>问题：</h4><p>Java客户端中的一个Connection是不是在MySQL中就对应一个线程来处理这个连接呢？</p>
<h4 id="答案：-3"><a href="#答案：-3" class="headerlink" title="答案："></a>答案：</h4><p>不是。凡是从线程思考问题的人，一般都是被Java技术的多线程思想所禁锢了，其实==在高性能服务器端端开发底层往往靠io复用来处理==，这种模式就是：==单线程+事件处理机制==。在MySQL里面往往有一个主线程，这是单线程（与Java中处处强调多线程的思想有点不同哦），它不断的循环查看是否有socket是否有读写事件，如果有读写事件，再从线程池里面找个工作线程处理这个socket的读写事件，完事之后工作线程会回到线程池。所以：Java客户端中的一个Connection不是在MySQL中就对应一个线程来处理这个链接，而是由监听socket的主线程+线程池里面固定数目的工作线程来处理的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/09/6.面试题目整理1（myabtis相关）/" data-id="cjoocvehp006pg4w6olxj3rgl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/面试/">面试</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/08/09/7.面试题目整理2（redis相关）/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          7.面试题目整理2（redis相关）
        
      </div>
    </a>
  
  
    <a href="/2018/08/09/5.Http的简单介绍/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">5.Http的简单介绍</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java基础/">java基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java容器/">java容器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java并发基础/">java并发基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java并发进阶/">java并发进阶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java虚拟机/">java虚拟机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql多数据源/">mysql多数据源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis学习/">redis学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring学习/">spring学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/剑指Offer/">剑指Offer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/单车后台系统实战/">单车后台系统实战</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微信点餐系统/">微信点餐系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术短文杂记/">技术短文杂记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构与算法/">数据结构与算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深入分析Java-Web技术内幕/">深入分析Java Web技术内幕</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电商项目实战/">电商项目实战</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/秒杀系统实战/">秒杀系统实战</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算机网络及其他/">计算机网络及其他</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Mysql/" style="font-size: 14px;">Mysql</a> <a href="/tags/java基础/" style="font-size: 16.67px;">java基础</a> <a href="/tags/java容器/" style="font-size: 16.67px;">java容器</a> <a href="/tags/java并发基础/" style="font-size: 16px;">java并发基础</a> <a href="/tags/java并发进阶/" style="font-size: 17.33px;">java并发进阶</a> <a href="/tags/java虚拟机/" style="font-size: 16.67px;">java虚拟机</a> <a href="/tags/leetcode/" style="font-size: 15.33px;">leetcode</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/mysql多数据源/" style="font-size: 10px;">mysql多数据源</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/redis学习/" style="font-size: 15.33px;">redis学习</a> <a href="/tags/spring学习/" style="font-size: 19.33px;">spring学习</a> <a href="/tags/剑指Offer/" style="font-size: 20px;">剑指Offer</a> <a href="/tags/单车后台系统实战/" style="font-size: 18px;">单车后台系统实战</a> <a href="/tags/微信点餐系统/" style="font-size: 14.67px;">微信点餐系统</a> <a href="/tags/技术短文杂记/" style="font-size: 11.33px;">技术短文杂记</a> <a href="/tags/数据结构与算法/" style="font-size: 13.33px;">数据结构与算法</a> <a href="/tags/深入分析Java-Web技术内幕/" style="font-size: 10px;">深入分析Java Web技术内幕</a> <a href="/tags/电商项目实战/" style="font-size: 18.67px;">电商项目实战</a> <a href="/tags/秒杀系统实战/" style="font-size: 13.33px;">秒杀系统实战</a> <a href="/tags/计算机网络及其他/" style="font-size: 13.33px;">计算机网络及其他</a> <a href="/tags/设计模式/" style="font-size: 12px;">设计模式</a> <a href="/tags/随笔/" style="font-size: 10.67px;">随笔</a> <a href="/tags/面试/" style="font-size: 12.67px;">面试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/10/21/spring多数据源实现读写分离/">spring多数据源实现读写分离</a>
          </li>
        
          <li>
            <a href="/2018/10/19/navicate新建查询报错问题记录/">navicate新建查询报错问题记录</a>
          </li>
        
          <li>
            <a href="/2018/09/24/对于工厂模式的理解/">对于工厂模式的理解</a>
          </li>
        
          <li>
            <a href="/2018/09/24/三、设计模式-抽象工厂模式/">三、设计模式-抽象工厂模式</a>
          </li>
        
          <li>
            <a href="/2018/09/24/二、设计模式-工厂方法模式/">二、设计模式-工厂方法模式</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Eureka<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>