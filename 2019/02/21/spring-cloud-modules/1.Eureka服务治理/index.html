<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 1.Eureka服务治理 · fossi</title><meta name="description" content="1.Eureka服务治理 - fossi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="https://sunweiguo.github.io/tags/" target="_blank" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="http://bloghello.oursnail.cn/test.html" target="_blank" class="nav-list-link">爱情</a></li><li class="nav-list-item"><a href="https://github.com/sunweiguo" target="_blank" class="nav-list-link">GIT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">1.Eureka服务治理</h1><div class="post-meta"><span class="post-time">Feb 21, 2019</span></div><div class="post-content"><p>在上一系列中，我们以最简单的业务场景急速入门了微服务，当然了，忽略了很多的细节，作为入门是可以的，但是真正使用的时候，还是需要了解很多额外的使用知识，所以本系列就孕育而生，即在上一系列的基础上继续强化，加深对spring cloud的使用理解。本章首先还是介绍eureka服务注册和发现组件，因为它是微服务的基石。</p>
<a id="more"></a>
<p>关于<code>Eureka</code>的基本使用，在另外一篇文章中详细介绍了：<a href="https://sunweiguo.github.io/2019/02/21/weather-for-spring-cloud/7.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%B3%A8%E5%86%8C%E5%92%8C%E5%8F%91%E7%8E%B0/" target="_blank" rel="noopener">7.天气预报系统-微服务的注册和发现</a>，不再赘述。本章学习如何搭建一个<code>eureka</code>高可用集群。</p>
<h2><font color="#337ab7">一、前言</font></h2>
<p>首先来看看<code>Eureka</code>高可用的架构。</p>
<p><img src="http://bloghello.oursnail.cn/eureka%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84.png" alt="image"></p>
<p>其中，续约是指：服务端维持一个有过期时间的服务列表，当客户端访问一次，我就刷新一下过期时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 90秒不来续约就剔除</span><br><span class="line">lease-expiration-duration-in-seconds: 90</span><br><span class="line"># 每隔30秒自动续约一次</span><br><span class="line">lease-renewal-interval-in-seconds: 30</span><br></pre></td></tr></table></figure>
<p>在客户端也可以设置一个定时任务，每隔多长时间去请求一下服务器，刷新一下服务列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 默认每隔30去请求一下服务器</span><br><span class="line">registry-fetch-interval-seconds: 30</span><br></pre></td></tr></table></figure>
<h2><font color="#337ab7">二、总结</font></h2>
<p><code>Eureka</code>包含两个组件：<code>Eureka Server</code> 和 <code>Eureka Client</code>，它们的作用如下：</p>
<ul>
<li><code>Eureka Client</code>是一个Java客户端，用于简化与<code>Eureka Server</code>的交互；</li>
<li><code>Eureka Server</code>提供服务发现的能力，各个微服务启动时，会通过<code>Eureka Client</code>向<code>Eureka Server</code>进行注册自己的信息（例如网络信息），<code>Eureka Server</code>会存储该服务的信息；</li>
<li>微服务启动后，会周期性地向<code>Eureka Server</code>发送心跳（默认周期为30秒）以续约自己的信息。如果<code>Eureka Server</code>在一定时间内没有接收到某个微服务节点的心跳，<code>Eureka Server</code>将会注销该微服务节点（默认90秒）；</li>
<li>每个<code>Eureka Server</code>同时也是<code>Eureka Client</code>，多个<code>Eureka Server</code>之间通过复制的方式完成服务注册表的同步；</li>
<li><code>Eureka Client</code>会缓存<code>Eureka Server</code>中的信息。即使所有的<code>Eureka Server</code>节点都宕掉，服务消费者依然可以使用缓存中的信息找到服务提供者。</li>
</ul>
<h2><font color="#337ab7">三、集群配置</font></h2>
<p>Server1端配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8761</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: eureka</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:8762/eureka</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: eureka-server</span><br></pre></td></tr></table></figure>
<p>Server2端配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8762</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: eureka</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:8761/eureka</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: eureka-server</span><br></pre></td></tr></table></figure>
<p>就是说两个<code>server</code>互相注册。形成一个<code>server</code>集群。</p>
<p>client1配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8080</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: eureka-client</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:8761/eureka,http://localhost:8762/eureka</span><br></pre></td></tr></table></figure>
<p>client2也是如此。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8081</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: eureka-client</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:8761/eureka,http://localhost:8762/eureka</span><br></pre></td></tr></table></figure>
<p>分别启动之后，我们会看到效果：</p>
<p><img src="http://bloghello.oursnail.cn/eureka%E9%9B%86%E7%BE%A4%E6%95%88%E6%9E%9C.png" alt="image"></p>
<p>关于本系列的所有代码，将按照1-10的章节依次存放在：<a href="https://github.com/sunweiguo/swgBook-for-spring-cloud/tree/master/spring-cloud-modules" target="_blank" rel="noopener">https://github.com/sunweiguo/swgBook-for-spring-cloud/tree/master/spring-cloud-modules</a> 后面不再赘述。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2019/02/21/spring-cloud-modules/2.Ribbon客户端负载均衡/" class="prev">PRVE</a><a href="/2019/02/21/weather-for-spring-cloud/11.天气预报系统-熔断机制/" class="next">NEXT</a></div><div id="container"></div><link rel="stylesheet" href="https://jjeejj.github.io/css/gitment.css">
<script src="https://jjeejj.github.io/js/gitment.js"></script><script>var gitment = new Gitment({
    id: 'Thu Feb 21 2019 13:22:47 GMT+0800',
    owner: 'sunweiguo',
    repo: 'sunweiguo.github.io',
    oauth: {
        client_id: '56c422eddebac740f021',
        client_secret: 'fd1b1eff6dd6efc61b2a09650840be7aaab787fd',
    },
})
gitment.render('container')</script><div class="copyright"><p>© 2019 - 2020 <a href="http://yoursite.com">fossi</a>,苏ICP备17064972号.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-134836068-1",'auto');ga('send','pageview');</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>