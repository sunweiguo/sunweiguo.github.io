<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Javaå¦‚ä½•æ‰§è¡Œä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åº]]></title>
    <url>%2F2019%2F02%2F03%2Fjava-basic%2FJava%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E4%B8%80%E4%B8%AA%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E7%A8%8B%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJAVAå·ç§°ï¼šä¸€æ¬¡ç¼–è¯‘å¤šå¤„è¿è¡Œã€‚è¿™å°±ç¦»ä¸å¼€å­—èŠ‚ç æ–‡ä»¶å’Œè™šæ‹Ÿæœºå•¦ï¼é‚£ä¹ˆï¼Œè™šæ‹Ÿæœºåˆ°åº•æ˜¯å¦‚ä½•åŽ»æ‰§è¡Œä¸€ä¸ªç®€å•çš„ç¨‹åºçš„å‘¢ï¼Ÿç†è§£äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥ç†è§£javaæ—¶å¦‚ä½•åšåˆ°å¹³å°æ— å…³çš„äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æžåˆ†æžã€‚ é¦–å…ˆï¼Œå†™ä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åºï¼š 123456789public class Main &#123; public static void main(String[] args) &#123; int i=1,j=5; i++; ++j; System.out.println(i); System.out.println(j); &#125;&#125; è¿è¡Œä¹‹åŽçš„ç»“æžœæƒ³å¿…å°±ä¸€ç›®äº†ç„¶ï¼Œæˆ‘ä»¬å°±é€šè¿‡è¿™ä¸ªç¨‹åºæ¥åˆ†æžåˆ†æžåˆ°åº•æ˜¯æ€Žä¹ˆæ‰§è¡Œè¿™ä¸ªç¨‹åºé¢çš„ã€‚ é¦–å…ˆå‘¢ï¼Œjavaç¨‹åºçš„æ‰§è¡Œç»åŽ†ç¼–è¯‘ï¼Œç¼–è¯‘æˆç³»ç»Ÿèƒ½è¯†åˆ«çš„æ–‡ä»¶ï¼Œè¿™é‡Œçš„ç³»ç»Ÿå¯¹åº”javaè¯­è¨€å°±æ˜¯JVMï¼Œå³JAVAè™šæ‹Ÿæœºã€‚JVMåœ¨è¯†åˆ«ä¹‹åŽï¼Œå†åŽ»ä¸Žæˆ‘ä»¬çœŸæ­£çš„æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’å’Œå¤„ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œä¸€ä¸ª.javaç¨‹åºï¼Œå¿…é¡»è¦å…ˆè¿›è¡Œç¼–è¯‘ã€‚åˆå­¦è€…éƒ½ä¼šå­¦ä¹ ä¸€ä¸ªæŒ‡ä»¤å«åšjavacï¼š æˆ‘ä»¬ä¼šå‘çŽ°è·¯å¾„ä¸‹é¢å°±ä¼šå¤šä¸€ä¸ª.classæ–‡ä»¶ï¼Œè¿™å°±æ˜¯ç¼–è¯‘ä¹‹åŽçš„æ–‡ä»¶ã€‚ç›´æŽ¥ç‚¹å¼€ï¼š 123456789101112131415161718//// Source code recreated from a .class file by IntelliJ IDEA// (powered by Fernflower decompiler)//public class Main &#123; public Main() &#123; &#125; public static void main(String[] var0) &#123; byte var1 = 1; byte var2 = 5; int var3 = var1 + 1; int var4 = var2 + 1; System.out.println(var3); System.out.println(var4); &#125;&#125; æˆ‘ä»¬çœ‹ç¬¬ä¸€è¡Œæ³¨é‡Šï¼Œè¯´çš„æ˜¯ç¼–è¯‘åŽçš„æ–‡ä»¶å·²ç»è‡ªåŠ¨è¢«IDEAåç¼–è¯‘äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜èƒ½çœ‹å¾—æ‡‚ã€‚çœŸæ­£çš„æ–‡ä»¶æ˜¯ï¼š 12345æ¼±å£• 4          &lt;init&gt; ()V Code LineNumberTable main ([Ljava/lang/String;)V SourceFile Main.java         Main java/lang/Object java/lang/System out Ljava/io/PrintStream; java/io/PrintStream println (I)V !            *? ?       E   &lt;=??? ? ? ? ? æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®žæ˜¯ä¸€å †ä¹±ç ï¼Œæ ¹æœ¬çœ‹ä¸æ‡‚ã€‚è€Œåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œclassæ–‡ä»¶æ˜¯ä¸€ç§8ä½å­—èŠ‚çš„äºŒè¿›åˆ¶æµæ–‡ä»¶ã€‚æ”¾åœ¨sublimeä¸­å¯ä»¥çœ‹åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä»¥16è¿›åˆ¶æ˜¾ç¤ºï¼Œåœ¨JAVAè™šæ‹Ÿæœºä¸­å°†æ¥äº†è§£è¿™å„æ–‡ä»¶çš„å«ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå•è¯æ˜¯cafe babeï¼Œè¡¨æ˜Žè¿™æ˜¯ä¸€ä¸ªclasså­—èŠ‚ç æ–‡ä»¶ï¼‰ï¼š é‚£ä¹ˆæˆ‘ä»¬æƒ³çœ‹çœ‹.classä¸­çš„ä¿¡æ¯ï¼Œè¿˜æ˜¯éœ€è¦åç¼–è¯‘ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç”¨javapæŒ‡ä»¤æ¥åšã€‚å¦‚æžœæˆ‘ä»¬å¯¹å…¶ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥å…ˆæ‰§è¡Œjavap -helpæ¥äº†è§£äº†è§£ã€‚ 12345678910111213141516171819ç”¨æ³•: javap &lt;options&gt; &lt;classes&gt;å…¶ä¸­, å¯èƒ½çš„é€‰é¡¹åŒ…æ‹¬: -help --help -? è¾“å‡ºæ­¤ç”¨æ³•æ¶ˆæ¯ -version ç‰ˆæœ¬ä¿¡æ¯ -v -verbose è¾“å‡ºé™„åŠ ä¿¡æ¯ -l è¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨ -public ä»…æ˜¾ç¤ºå…¬å…±ç±»å’Œæˆå‘˜ -protected æ˜¾ç¤ºå—ä¿æŠ¤çš„/å…¬å…±ç±»å’Œæˆå‘˜ -package æ˜¾ç¤ºç¨‹åºåŒ…/å—ä¿æŠ¤çš„/å…¬å…±ç±» å’Œæˆå‘˜ (é»˜è®¤) -p -private æ˜¾ç¤ºæ‰€æœ‰ç±»å’Œæˆå‘˜ -c å¯¹ä»£ç è¿›è¡Œåæ±‡ç¼– -s è¾“å‡ºå†…éƒ¨ç±»åž‹ç­¾å -sysinfo æ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„ç±»çš„ ç³»ç»Ÿä¿¡æ¯ (è·¯å¾„, å¤§å°, æ—¥æœŸ, MD5 æ•£åˆ—) -constants æ˜¾ç¤ºæœ€ç»ˆå¸¸é‡ -classpath &lt;path&gt; æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½® -cp &lt;path&gt; æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½® -bootclasspath &lt;path&gt; è¦†ç›–å¼•å¯¼ç±»æ–‡ä»¶çš„ä½ç½® æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæœ‰ä¸€ä¸ª-cæ˜¯è¿›è¡Œåæ±‡ç¼–ï¼Œé‚£ä¹ˆå°±ç”¨å®ƒè¯•è¯•: 123456789101112131415161718192021222324252627E:\JavaBasic\src&gt;javap -c Main.classCompiled from &quot;Main.java&quot;public class Main &#123; public Main(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: iconst_1 1: istore_1 2: iconst_5 3: istore_2 4: iinc 1, 1 7: iinc 2, 1 10: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 13: iload_1 14: invokevirtual #3 // Method java/io/PrintStream.println:(I)V 17: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 20: iload_2 21: invokevirtual #3 // Method java/io/PrintStream.println:(I)V 24: return&#125; é‚£ä¹ˆè¿™åæ±‡ç¼–å‡ºæ¥çš„ä¸œè¥¿æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯ä¸€è¿žä¸²çš„æŒ‡ä»¤ï¼Œå…¶å®žè¿™äº›æ˜¯åŠ è½½classæ–‡ä»¶æ—¶çœŸæ­£æ‰§è¡Œçš„javaè™šæ‹ŸæœºæŒ‡ä»¤ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å«ä¹‰å§ï¼ ä»”ç»†çœ‹çœ‹ï¼Œå…¶å®žå‘çŽ°å¹¶ä¸ç¥žç§˜ï¼Œä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œæ˜¯ä¸€ä¸ªå…¥æ ˆå‡ºæ ˆçš„è¿‡ç¨‹ã€‚okï¼Œå¤§ä½“äº†è§£äº†å­—èŠ‚ç æ–‡ä»¶æ˜¯ä»€ä¹ˆä»¥åŠé‡Œé¢çš„æŒ‡ä»¤å«ä¹‰ä¹‹åŽï¼Œæˆ‘ä»¬å¯¹javaå¦‚ä½•æ‰§è¡Œå®ƒå·²ç»å¤§ä½“æ¸…æ¥šäº†ã€‚ä¸‹é¢æ‰§è¡Œä¸€ä¸‹ï¼š é‚£ä¹ˆå¦‚ä½•è¿è¡Œå‘¢ï¼Ÿ å…¶å®žè¿™æ˜¯åºŸè¯ï¼Œåˆå­¦javaå…¶å®žæ˜¯java Mainè¿è¡Œçš„ï¼š 1234E:\JavaBasic\src&gt;java Main26 è¿™ä¸ªæ—¶å€™ï¼Œclassæ–‡ä»¶å¯ä»¥ç§»æ¤åˆ°ä»»ä½•å¹³å°ä¸ŠåŽ»ï¼Œæ¯”å¦‚ç›´æŽ¥ä¸Šä¼ åˆ°linuxä¸Šï¼Œåªè¦JDKæˆ–è€…JREçŽ¯å¢ƒç±»ä¼¼å³å¯ï¼Œå°±å¯ä»¥ç›´æŽ¥è¿è¡Œäº†ï¼Œä¸éœ€è¦ç¼–è¯‘ï¼Œä¹Ÿä¸éœ€è¦å…³å¿ƒæ˜¯ä»€ä¹ˆç³»ç»Ÿã€‚è¿™å°±åšåˆ°äº†ä¸€æ¬¡ç¼–è¯‘åˆ°å¤„è¿è¡Œã€‚ ä¸‹é¢æ€»ç»“ä¸€ä¸‹ï¼š Javaæºç é¦–å…ˆè¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå†ç”±ä¸åŒå¹³å°çš„JVMè¿›è¡Œè§£æžï¼ŒJAVAè¯­è¨€åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œæ—¶ä¸éœ€è¦è¿›è¡Œé‡æ–°ç¼–è¯‘ï¼ŒJAVAè™šæ‹Ÿæœºåœ¨æ‰§è¡Œå­—èŠ‚ç çš„æ—¶å€™ï¼ŒæŠŠå­—èŠ‚ç è½¬æ¢ä¸ºå…·ä½“å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤ï¼Œç„¶åŽå„ç§æ“ä½œç³»ç»Ÿå°±å¯ä»¥æ­£ç¡®è¯†åˆ«äº†ã€‚è¿™å°±æ˜¯JAVAå¦‚ä½•æ‰§è¡Œä»£ç å’Œå¹³å°æ— å…³æ€§çš„åŽŸå› ã€‚]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽRedisä¸€äº›é‡è¦çš„é¢è¯•ç‚¹]]></title>
    <url>%2F2019%2F02%2F02%2Fredis%2F%E5%85%B3%E4%BA%8ERedis%E4%B8%80%E4%BA%9B%E9%87%8D%E8%A6%81%E7%9A%84%E9%9D%A2%E8%AF%95%E7%82%B9%2F</url>
    <content type="text"><![CDATA[è¿™é‡Œæ•´ç†ä¸€äº›é¢è¯•é¢˜ç›®ï¼Œå¾ˆå¤šå·²ç»åœ¨å‰é¢çš„æ–‡ç« ä¸­è¯¦ç»†è¯´æ˜Žäº†ï¼Œè¿™é‡Œç®—æ˜¯æ€»ç»“ä¸€ä¸‹ã€‚ä¹Ÿè¡¥å……äº†ä¸€ç‚¹æ–°çš„çŸ¥è¯†ã€‚ Redisæœ‰å“ªäº›æ•°æ®ç»“æž„ï¼Ÿ å­—ç¬¦ä¸² Stringã€å­—å…¸ Hash ã€åˆ—è¡¨ List ã€é›†åˆ Set ã€æœ‰åºé›†åˆ SortedSetã€‚ å¦‚æžœä½ æ˜¯Redisä¸­é«˜çº§ç”¨æˆ·ï¼Œè¿˜éœ€è¦åŠ ä¸Šä¸‹é¢å‡ ç§æ•°æ®ç»“æž„HyperLogLogã€Geoã€Pub/Subã€‚ Stringç±»åž‹çš„åº•å±‚æ•°æ®ç»“æž„ Redis æ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ•°æ®åº“, æ•°æ®åº“çš„å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€é›†åˆã€åˆ—è¡¨ç­‰å¤šç§ç±»åž‹çš„å¯¹è±¡ï¼Œ è€Œæ•°æ®åº“çš„é”®åˆ™æ€»æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ã€‚ å¯¹äºŽé‚£äº›åŒ…å«å­—ç¬¦ä¸²å€¼çš„å­—ç¬¦ä¸²å¯¹è±¡æ¥è¯´ï¼Œ æ¯ä¸ªå­—ç¬¦ä¸²å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ª sds å€¼ã€‚ â€œåŒ…å«å­—ç¬¦ä¸²å€¼çš„å­—ç¬¦ä¸²å¯¹è±¡â€ï¼Œè¿™ç§è¯´æ³•åˆå¬ä¸ŠåŽ»å¯èƒ½ä¼šæœ‰ç‚¹å¥‡æ€ªï¼Œ ä½†æ˜¯åœ¨ Redis ä¸­ï¼Œ ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡é™¤äº†å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²å€¼ä¹‹å¤–ï¼Œ è¿˜å¯ä»¥ä¿å­˜ long ç±»åž‹çš„å€¼ï¼Œ æ‰€ä»¥ä¸ºäº†ä¸¥è°¨èµ·è§ï¼Œ è¿™é‡Œéœ€è¦å¼ºè°ƒä¸€ä¸‹ï¼š å½“å­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œ å®ƒåŒ…å«çš„æ‰æ˜¯ sds å€¼ï¼Œ å¦åˆ™çš„è¯ï¼Œ å®ƒå°±æ˜¯ä¸€ä¸ª long ç±»åž‹çš„å€¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ ä»¥ä¸‹å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ•°æ®åº“é”®å€¼å¯¹ï¼Œ è¿™ä¸ªé”®å€¼å¯¹çš„é”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼Œ å®ƒä»¬éƒ½åŒ…å«ä¸€ä¸ª sds å€¼ï¼š 12345redis&gt; SET book &quot;Mastering C++ in 21 days&quot;OKredis&gt; GET book&quot;Mastering C++ in 21 days&quot; ç›®å‰æ¥è¯´ï¼Œ åªè¦è®°ä½è¿™ä¸ªäº‹å®žå³å¯ï¼š åœ¨ Redis ä¸­ï¼Œ å®¢æˆ·ç«¯ä¼ å…¥æœåŠ¡å™¨çš„åè®®å†…å®¹ã€ aof ç¼“å­˜ã€ è¿”å›žç»™å®¢æˆ·ç«¯çš„å›žå¤ï¼Œ ç­‰ç­‰ï¼Œ è¿™äº›é‡è¦çš„å†…å®¹éƒ½æ˜¯ç”± sds ç±»åž‹æ¥ä¿å­˜çš„ã€‚ åœ¨ C è¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²å¯ä»¥ç”¨ä¸€ä¸ª \0 ç»“å°¾çš„ char æ•°ç»„æ¥è¡¨ç¤ºã€‚ æ¯”å¦‚è¯´ï¼Œ hello world åœ¨ C è¯­è¨€ä¸­å°±å¯ä»¥è¡¨ç¤ºä¸º &quot;hello world\0&quot; ã€‚ è¿™ç§ç®€å•çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½èƒ½æ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯ï¼Œå®ƒå¹¶ä¸èƒ½é«˜æ•ˆåœ°æ”¯æŒé•¿åº¦è®¡ç®—å’Œè¿½åŠ ï¼ˆappendï¼‰è¿™ä¸¤ç§æ“ä½œï¼š æ¯æ¬¡è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ï¼ˆstrlen(s)ï¼‰çš„å¤æ‚åº¦ä¸º Î¸(N) ã€‚ å¯¹å­—ç¬¦ä¸²è¿›è¡Œ N æ¬¡è¿½åŠ ï¼Œå¿…å®šéœ€è¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œ N æ¬¡å†…å­˜é‡åˆ†é…ï¼ˆreallocï¼‰ã€‚ åœ¨ Redis å†…éƒ¨ï¼Œ å­—ç¬¦ä¸²çš„è¿½åŠ å’Œé•¿åº¦è®¡ç®—å¾ˆå¸¸è§ï¼Œ è€Œ APPEND å’Œ STRLEN æ›´æ˜¯è¿™ä¸¤ç§æ“ä½œï¼Œåœ¨ Redis å‘½ä»¤ä¸­çš„ç›´æŽ¥æ˜ å°„ï¼Œ è¿™ä¸¤ä¸ªç®€å•çš„æ“ä½œä¸åº”è¯¥æˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆã€‚ å¦å¤–ï¼Œ Redis é™¤äº†å¤„ç†å­—ç¬¦ä¸²ä¹‹å¤–ï¼Œ è¿˜éœ€è¦å¤„ç†å•çº¯çš„å­—èŠ‚æ•°ç»„ï¼Œ ä»¥åŠæœåŠ¡å™¨åè®®ç­‰å†…å®¹ï¼Œ æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œ Redis çš„å­—ç¬¦ä¸²è¡¨ç¤ºè¿˜åº”è¯¥æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼š ç¨‹åºä¸åº”å¯¹å­—ç¬¦ä¸²é‡Œé¢ä¿å­˜çš„æ•°æ®åšä»»ä½•å‡è®¾ï¼Œ æ•°æ®å¯ä»¥æ˜¯ä»¥ \0 ç»“å°¾çš„ C å­—ç¬¦ä¸²ï¼Œ ä¹Ÿå¯ä»¥æ˜¯å•çº¯çš„å­—èŠ‚æ•°ç»„ï¼Œ æˆ–è€…å…¶ä»–æ ¼å¼çš„æ•°æ®ã€‚ è€ƒè™‘åˆ°è¿™ä¸¤ä¸ªåŽŸå› ï¼Œ Redis ä½¿ç”¨ sds ç±»åž‹æ›¿æ¢äº† C è¯­è¨€çš„é»˜è®¤å­—ç¬¦ä¸²è¡¨ç¤ºï¼š sds æ—¢å¯é«˜æ•ˆåœ°å®žçŽ°è¿½åŠ å’Œé•¿åº¦è®¡ç®—ï¼Œ åŒæ—¶æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚ åœ¨å‰é¢çš„å†…å®¹ä¸­ï¼Œ æˆ‘ä»¬ä¸€ç›´å°† sds ä½œä¸ºä¸€ç§æŠ½è±¡æ•°æ®ç»“æž„æ¥è¯´æ˜Žï¼Œ å®žé™…ä¸Šï¼Œ å®ƒçš„å®žçŽ°ç”±ä»¥ä¸‹ä¸¤éƒ¨åˆ†ç»„æˆï¼š 1234567891011121314typedef char *sds;struct sdshdr &#123; // buf å·²å ç”¨é•¿åº¦ int len; // buf å‰©ä½™å¯ç”¨é•¿åº¦ int free; // å®žé™…ä¿å­˜å­—ç¬¦ä¸²æ•°æ®çš„åœ°æ–¹ char buf[];&#125;; å…¶ä¸­ï¼Œç±»åž‹ sds æ˜¯ char * çš„åˆ«åï¼ˆaliasï¼‰ï¼Œè€Œç»“æž„ sdshdr åˆ™ä¿å­˜äº† len ã€ free å’Œ buf ä¸‰ä¸ªå±žæ€§ã€‚ ä½œä¸ºä¾‹å­ï¼Œä»¥ä¸‹æ˜¯æ–°åˆ›å»ºçš„ï¼ŒåŒæ ·ä¿å­˜ hello world å­—ç¬¦ä¸²çš„ sdshdr ç»“æž„ï¼š 12345struct sdshdr &#123; len = 11; free = 0; buf = &quot;hello world\0&quot;; // buf çš„å®žé™…é•¿åº¦ä¸º len + 1&#125;; é€šè¿‡ len å±žæ€§ï¼Œ sdshdr å¯ä»¥å®žçŽ°å¤æ‚åº¦ä¸º Î¸(1) çš„é•¿åº¦è®¡ç®—æ“ä½œã€‚ å¦ä¸€æ–¹é¢ï¼Œ é€šè¿‡å¯¹ buf åˆ†é…ä¸€äº›é¢å¤–çš„ç©ºé—´ï¼Œ å¹¶ä½¿ç”¨ free è®°å½•æœªä½¿ç”¨ç©ºé—´çš„å¤§å°ï¼Œ sdshdr å¯ä»¥è®©æ‰§è¡Œè¿½åŠ æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°å¤§å¤§å‡å°‘ã€‚ ä¸ºäº†æ˜“äºŽç†è§£ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª Redis æ‰§è¡Œå®žä¾‹ä½œä¸ºä¾‹å­ï¼Œè§£é‡Šä¸€ä¸‹ï¼Œå½“æ‰§è¡Œä»¥ä¸‹ä»£ç æ—¶ï¼Œ Redis å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼š 12345678redis&gt; SET msg "hello world"OKredis&gt; APPEND msg " again!"(integer) 18redis&gt; GET msg"hello world again!" é¦–å…ˆï¼Œ SET å‘½ä»¤åˆ›å»ºå¹¶ä¿å­˜ hello world åˆ°ä¸€ä¸ª sdshdr ä¸­ï¼Œè¿™ä¸ª sdshdr çš„å€¼å¦‚ä¸‹ï¼š 12345struct sdshdr &#123; len = 11; free = 0; buf = "hello world\0";&#125; å½“æ‰§è¡Œ APPEND å‘½ä»¤æ—¶ï¼Œç›¸åº”çš„ sdshdr è¢«æ›´æ–°ï¼Œå­—ç¬¦ä¸² &quot; again!&quot; ä¼šè¢«è¿½åŠ åˆ°åŽŸæ¥çš„ â€œhello worldâ€ ä¹‹åŽï¼š 12345struct sdshdr &#123; len = 18; free = 18; buf = "hello world again!\0 "; // ç©ºç™½çš„åœ°æ–¹ä¸ºé¢„åˆ†é…ç©ºé—´ï¼Œå…± 18 + 18 + 1 ä¸ªå­—èŠ‚&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ ä¿å­˜ â€œhello world again!â€ å…±éœ€è¦ 18 + 1 ä¸ªå­—èŠ‚ï¼Œ ä½†ç¨‹åºå´ä¸ºæˆ‘ä»¬åˆ†é…äº† 18 + 18 + 1 = 37 ä¸ªå­—èŠ‚ â€”â€” è¿™æ ·ä¸€æ¥ï¼Œ å¦‚æžœå°†æ¥å†æ¬¡å¯¹åŒä¸€ä¸ª sdshdr è¿›è¡Œè¿½åŠ æ“ä½œï¼Œ åªè¦è¿½åŠ å†…å®¹çš„é•¿åº¦ä¸è¶…è¿‡ free å±žæ€§çš„å€¼ï¼Œ é‚£ä¹ˆå°±ä¸éœ€è¦å¯¹ buf è¿›è¡Œå†…å­˜é‡åˆ†é…ã€‚ è¿™ç§åˆ†é…ç­–ç•¥ä¼šæµªè´¹å†…å­˜å—ï¼Ÿ æ‰§è¡Œè¿‡ APPEND å‘½ä»¤çš„å­—ç¬¦ä¸²ä¼šå¸¦æœ‰é¢å¤–çš„é¢„åˆ†é…ç©ºé—´ï¼Œ è¿™äº›é¢„åˆ†é…ç©ºé—´ä¸ä¼šè¢«é‡Šæ”¾ï¼Œ é™¤éžè¯¥å­—ç¬¦ä¸²æ‰€å¯¹åº”çš„é”®è¢«åˆ é™¤ï¼Œ æˆ–è€…ç­‰åˆ°å…³é—­ Redis ä¹‹åŽï¼Œ å†æ¬¡å¯åŠ¨æ—¶é‡æ–°è½½å…¥çš„å­—ç¬¦ä¸²å¯¹è±¡å°†ä¸ä¼šæœ‰é¢„åˆ†é…ç©ºé—´ã€‚ å› ä¸ºæ‰§è¡Œ APPEND å‘½ä»¤çš„å­—ç¬¦ä¸²é”®æ•°é‡é€šå¸¸å¹¶ä¸å¤šï¼Œ å ç”¨å†…å­˜çš„ä½“ç§¯é€šå¸¸ä¹Ÿä¸å¤§ï¼Œ æ‰€ä»¥è¿™ä¸€èˆ¬å¹¶ä¸ç®—ä»€ä¹ˆé—®é¢˜ã€‚ å¦ä¸€æ–¹é¢ï¼Œ å¦‚æžœæ‰§è¡Œ APPEND æ“ä½œçš„é”®å¾ˆå¤šï¼Œ è€Œå­—ç¬¦ä¸²çš„ä½“ç§¯åˆå¾ˆå¤§çš„è¯ï¼Œ é‚£å¯èƒ½å°±éœ€è¦ä¿®æ”¹ Redis æœåŠ¡å™¨ï¼Œ è®©å®ƒå®šæ—¶é‡Šæ”¾ä¸€äº›å­—ç¬¦ä¸²é”®çš„é¢„åˆ†é…ç©ºé—´ï¼Œ ä»Žè€Œæ›´æœ‰æ•ˆåœ°ä½¿ç”¨å†…å­˜ã€‚ å½“ç„¶ï¼Œ sds ä¹Ÿå¯¹æ“ä½œçš„æ­£ç¡®å®žçŽ°æå‡ºäº†è¦æ±‚ â€”â€” æ‰€æœ‰å¤„ç† sdshdr çš„å‡½æ•°ï¼Œéƒ½å¿…é¡»æ­£ç¡®åœ°æ›´æ–° len å’Œ free å±žæ€§ï¼Œå¦åˆ™å°±ä¼šé€ æˆ bug ã€‚ æ›´å¤šå‚è§ï¼šç®€å•åŠ¨æ€å­—ç¬¦ä¸² ä»Žæµ·é‡æ•°æ®ä¸­æŸ¥è¯¢æŸä¸€å›ºå®šå‰ç¼€çš„key ä½¿ç”¨keysæŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ã€‚ å¯¹æ–¹æŽ¥ç€è¿½é—®ï¼šå¦‚æžœè¿™ä¸ªredisæ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ è¿™ä¸ªæ—¶å€™ä½ è¦å›žç­”rediså…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼šredisçš„å•çº¿ç¨‹çš„ã€‚keysæŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡žä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨scanæŒ‡ä»¤ï¼ŒscanæŒ‡ä»¤å¯ä»¥æ— é˜»å¡žçš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚çŽ‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡åŽ»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æŽ¥ç”¨keysæŒ‡ä»¤é•¿ã€‚ åŸºäºŽæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼Œéœ€è¦ä½¿ç”¨ä¸Šä¸€æ¬¡æ¸¸æ ‡å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚æ¸¸æ ‡ä¸º0çš„æ—¶å€™ä»£è¡¨å¼€å§‹æˆ–ç»“æŸã€‚ 1234#æ¨¡å¼scan cursor match pattern count#ç¤ºä¾‹scan 0 match k* count 10 Redisåšå¼‚æ­¥é˜Ÿåˆ— ä¸€èˆ¬ä½¿ç”¨listç»“æž„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ã€‚å½“lpopæ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“sleepä¸€ä¼šå†é‡è¯•ã€‚ å¦‚æžœå¯¹æ–¹è¿½é—®å¯ä¸å¯ä»¥ä¸ç”¨sleepå‘¢ï¼Ÿlistè¿˜æœ‰ä¸ªæŒ‡ä»¤å«blpopï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»å¡žä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚ å¦‚æžœå¯¹æ–¹è¿½é—®èƒ½ä¸èƒ½ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡å‘¢ï¼Ÿä½¿ç”¨pub/subä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®žçŽ°1:Nçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ å¦‚æžœå¯¹æ–¹è¿½é—®pub/subæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿåœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚rabbitmqç­‰ã€‚ å¦‚æžœå¯¹æ–¹è¿½é—®rediså¦‚ä½•å®žçŽ°å»¶æ—¶é˜Ÿåˆ—ï¼Ÿæˆ‘ä¼°è®¡çŽ°åœ¨ä½ å¾ˆæƒ³æŠŠé¢è¯•å®˜ä¸€æ£’æ‰“æ­»å¦‚æžœä½ æ‰‹ä¸Šæœ‰ä¸€æ ¹æ£’çƒæ£çš„è¯ï¼Œæ€Žä¹ˆé—®çš„è¿™ä¹ˆè¯¦ç»†ã€‚ä½†æ˜¯ä½ å¾ˆå…‹åˆ¶ï¼Œç„¶åŽç¥žæ€è‡ªè‹¥çš„å›žç­”é“ï¼šä½¿ç”¨sortedsetï¼Œæ‹¿æ—¶é—´æˆ³ä½œä¸ºscoreï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸ºkeyè°ƒç”¨zaddæ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨zrangebyscoreæŒ‡ä»¤èŽ·å–Nç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚ å¦‚æžœæœ‰å¤§é‡çš„keyéœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ å¦‚æžœå¤§é‡çš„keyè¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡äºŽé›†ä¸­ï¼Œåˆ°è¿‡æœŸçš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œrediså¯èƒ½ä¼šå‡ºçŽ°çŸ­æš‚çš„å¡é¡¿çŽ°è±¡ã€‚ä¸€èˆ¬éœ€è¦åœ¨æ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—è¿‡æœŸæ—¶é—´åˆ†æ•£ä¸€äº›ã€‚ Rediså¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ bgsaveåšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼Œaofåšå¢žé‡æŒä¹…åŒ–ã€‚å› ä¸ºbgsaveä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œä¸å¤Ÿå®žæ—¶ï¼Œåœ¨åœæœºçš„æ—¶å€™ä¼šå¯¼è‡´å¤§é‡ä¸¢å¤±æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦aofæ¥é…åˆä½¿ç”¨ã€‚åœ¨rediså®žä¾‹é‡å¯æ—¶ï¼Œä¼šä½¿ç”¨bgsaveæŒä¹…åŒ–æ–‡ä»¶é‡æ–°æž„å»ºå†…å­˜ï¼Œå†ä½¿ç”¨aofé‡æ”¾è¿‘æœŸçš„æ“ä½œæŒ‡ä»¤æ¥å®žçŽ°å®Œæ•´æ¢å¤é‡å¯ä¹‹å‰çš„çŠ¶æ€ã€‚ å¯¹æ–¹è¿½é—®é‚£å¦‚æžœçªç„¶æœºå™¨æŽ‰ç”µä¼šæ€Žæ ·ï¼Ÿå–å†³äºŽaofæ—¥å¿—syncå±žæ€§çš„é…ç½®ï¼Œå¦‚æžœä¸è¦æ±‚æ€§èƒ½ï¼Œåœ¨æ¯æ¡å†™æŒ‡ä»¤æ—¶éƒ½syncä¸€ä¸‹ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯åœ¨é«˜æ€§èƒ½çš„è¦æ±‚ä¸‹æ¯æ¬¡éƒ½syncæ˜¯ä¸çŽ°å®žçš„ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨å®šæ—¶syncï¼Œæ¯”å¦‚1s1æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¤šå°±ä¼šä¸¢å¤±1sçš„æ•°æ®ã€‚ å¯¹æ–¹è¿½é—®bgsaveçš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ ç»™å‡ºä¸¤ä¸ªè¯æ±‡å°±å¯ä»¥äº†ï¼Œforkå’Œcowã€‚forkæ˜¯æŒ‡redisé€šè¿‡åˆ›å»ºå­è¿›ç¨‹æ¥è¿›è¡Œbgsaveæ“ä½œï¼ŒcowæŒ‡çš„æ˜¯copy on writeï¼Œå­è¿›ç¨‹åˆ›å»ºåŽï¼Œçˆ¶å­è¿›ç¨‹å…±äº«æ•°æ®æ®µï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ï¼Œå†™è„çš„é¡µé¢æ•°æ®ä¼šé€æ¸å’Œå­è¿›ç¨‹åˆ†ç¦»å¼€æ¥ã€‚ Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨pipelineï¼Ÿ å¯ä»¥å°†å¤šæ¬¡IOå¾€è¿”çš„æ—¶é—´ç¼©å‡ä¸ºä¸€æ¬¡ï¼Œå‰ææ˜¯pipelineæ‰§è¡Œçš„æŒ‡ä»¤ä¹‹é—´æ²¡æœ‰å› æžœç›¸å…³æ€§ã€‚ä½¿ç”¨redis-benchmarkè¿›è¡ŒåŽ‹æµ‹çš„æ—¶å€™å¯ä»¥å‘çŽ°å½±å“redisçš„QPSå³°å€¼çš„ä¸€ä¸ªé‡è¦å› ç´ æ˜¯pipelineæ‰¹æ¬¡æŒ‡ä»¤çš„æ•°ç›®ã€‚ Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ Rediså¯ä»¥ä½¿ç”¨ä¸»ä»ŽåŒæ­¥ï¼Œä»Žä»ŽåŒæ­¥ã€‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡bgsaveï¼Œå¹¶åŒæ—¶å°†åŽç»­ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜bufferï¼Œå¾…å®ŒæˆåŽå°†rdbæ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æŽ¥å—å®ŒæˆåŽå°†rdbé•œåƒåŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®ŒæˆåŽï¼Œå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚ æ˜¯å¦ä½¿ç”¨è¿‡Redisé›†ç¾¤ï¼Œé›†ç¾¤çš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ Redis Sentinalç€çœ¼äºŽé«˜å¯ç”¨ï¼Œåœ¨masterå®•æœºæ—¶ä¼šè‡ªåŠ¨å°†slaveæå‡ä¸ºmasterï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚ Redis Clusterç€çœ¼äºŽæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ªrediså†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨Clusterè¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚ æ•´ç†è‡ªï¼š å¤©ä¸‹æ— éš¾è¯•ä¹‹Redisé¢è¯•é¢˜åˆéš¾å¤§å…¨]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‡ ç§ä¸»æµç¼“å­˜æ¡†æž¶ä»‹ç»]]></title>
    <url>%2F2019%2F02%2F02%2Fredis%2F%E5%87%A0%E7%A7%8D%E4%B8%BB%E6%B5%81%E7%BC%93%E5%AD%98%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬åäºŒç¯‡æ–‡ç« ã€‚æœ¬æ–‡å¯¹Guava Cache,Memcacheä»¥åŠredisè¿›è¡Œç®€å•ä»‹ç»å’Œå¯¹æ¯”ã€‚ ç¼“å­˜ç‰¹å¾ ç¼“å­˜éƒ½ä¼šæ¶‰åŠï¼šå‘½ä¸­çŽ‡ã€æœ€å¤§å…ƒç´ ã€æ¸…ç©ºç­–ç•¥(FIFO,LFU,LRU,è¿‡æœŸæ—¶é—´ï¼Œéšæœº) å½±å“ç¼“å­˜å‘½ä¸­çŽ‡å› ç´  ä¸šåŠ¡åœºæ™¯å’Œä¸šåŠ¡éœ€æ±‚ï¼šé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ ç¼“å­˜çš„è®¾è®¡(ç²’åº¦å’Œç­–ç•¥)ï¼šç¼“å­˜ç²’åº¦è¶Šå°ï¼Œå‘½ä¸­çŽ‡è¶Šé«˜ ç¼“å­˜å®¹é‡(ç»å¸¸ç”¨LRU)å’ŒåŸºç¡€è®¾æ–½(æ˜¯å¦å¯æ‰©å±•ï¼Œé¿å…ç¼“å­˜å¤±æ•ˆ-ä¸€è‡´æ€§hashç®—æ³•å’Œå‡ ç‚¹å†—ä½™) ç¼“å­˜åˆ†ç±» æœ¬åœ°ç¼“å­˜ï¼šç¼–ç¨‹å®žçŽ°ï¼ˆæˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡ã€é™æ€å˜é‡ï¼‰ã€Guava Cache åˆ†å¸ƒå¼ç¼“å­˜ï¼šMemcacheï¼ŒRedis æœ¬åœ°ç¼“å­˜ï¼šå„åº”ç”¨ä¹‹é—´æ— æ³•å¾ˆå¥½åœ°å…±äº«ï¼Œä¸Žåº”ç”¨æœ¬èº«è€¦åˆè¿‡ç´§ï¼›è€Œåˆ†å¸ƒå¼ç¼“å­˜ï¼Œæœ¬èº«å°±æ˜¯ç‹¬ç«‹çš„åº”ç”¨ï¼Œå„ç‹¬ç«‹åº”ç”¨ä¹‹é—´å…±äº«ç¼“å­˜ã€‚ Guava Cache è®¾è®¡æ€æƒ³ç±»ä¼¼äºŽjdk1.7ä¸­çš„ConcurrentHashMapï¼Œä¹Ÿæ˜¯ç”¨å¤šä¸ªsegmentsçš„ç»†ç²’åº¦é”ï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŒæ—¶ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯çš„éœ€æ±‚ã€‚ ä¸‹é¢æ•°æ®å­˜å‚¨å°±æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ï¼Œå¦å¤–ï¼Œéœ€è¦å¤„ç†ç¼“å­˜è¿‡æœŸã€åŠ¨æ€åŠ è½½ç­‰ç®—æ³•é€»è¾‘ï¼Œæ‰€ä»¥éœ€è¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯æ¥å®žçŽ°è¿™äº›æ“ä½œã€‚ ä¸»è¦å®žçŽ°çš„åŠŸèƒ½æœ‰ï¼šè‡ªåŠ¨å°†èŠ‚ç‚¹åŠ å…¥åˆ°ç¼“å­˜ç»“æž„ä¸­ï¼Œå½“ç¼“å­˜çš„æ•°æ®è¶…è¿‡è®¾ç½®çš„æœ€å¤§å€¼æ—¶ï¼Œç”¨LRUç®—æ³•æ¥ç§»é™¤ã€‚ä»–å…·å¤‡æ ¹æ®èŠ‚ç‚¹ä¸Šæ¬¡è¢«è®¿é—®æˆ–è€…å†™å…¥çš„æ—¶é—´æ¥è®¡ç®—ä»–çš„è¿‡æœŸæœºåˆ¶ã€‚ memcache memcacheç®€å•è®¤è¯† memcacheæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼çš„å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œå®ƒåœ¨å†…å­˜é‡Œç»´æŠ¤ä¸€ä¸ªç»Ÿä¸€çš„å·¨å¤§çš„hashè¡¨ã€‚èƒ½ç”¨æ¥ç¼“å­˜å„ç§æ ¼å¼çš„æ•°æ®ï¼ŒåŒ…æ‹¬å›¾åƒã€è§†é¢‘ã€æ–‡ä»¶ä»¥åŠæ•°æ®åº“æ£€ç´¢ç­‰ç»“æžœ. memcacheæ˜¯ä»¥å®ˆæŠ¤ç¨‹åºæ–¹å¼è¿è¡ŒäºŽä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ä¸­ï¼Œéšæ—¶ä¼šæŽ¥æ”¶å®¢æˆ·çš„è¿žæŽ¥å’Œæ“ä½œã€‚ å­˜åœ¨memcacheä¸­çš„å¯¹è±¡å®žé™…æ”¾ç½®åœ¨å†…å­˜ä¸­ï¼Œè¿™ä¹Ÿæ˜¯memcacheå¦‚æ­¤é«˜æ•ˆçš„åŽŸå› ã€‚ æœ¬èº«æ˜¯ä¸æä¾›åˆ†å¸ƒå¼çš„è§£å†³æ–¹æ¡ˆçš„ã€‚åˆ†å¸ƒå¼æ˜¯åœ¨å®¢æˆ·ç«¯å®žçŽ°çš„ï¼Œé€šè¿‡å®¢æˆ·ç«¯çš„è·¯ç”±æ¥å¤„ç†è¾¾åˆ°åˆ†å¸ƒå¼çš„ç›®çš„ã€‚ åº”ç”¨æœåŠ¡å™¨æ¯æ¬¡åœ¨å­˜å‚¨æŸä¸ªkeyå’Œvalueçš„æ—¶å€™ï¼Œé€šè¿‡æŸç§ç®—æ³•æŠŠkeyæ˜ å°„åˆ°æŸå°æœåŠ¡å™¨ä¸Šã€‚ ä¸€è‡´æ€§hashç®—æ³• å®¢æˆ·ç«¯å®žçŽ°åˆ†å¸ƒå¼ï¼šä¸€è‡´æ€§hashç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•å·²ç»è¯¦ç»†ä»‹ç»è¿‡äº†ã€‚ memcacheä¸€äº›ç‰¹æ€§ Memcachedå•è¿›ç¨‹åœ¨32ä½ç³»ç»Ÿä¸­æœ€å¤§ä½¿ç”¨å†…å­˜ä¸º2Gï¼Œè‹¥åœ¨64ä½ç³»ç»Ÿåˆ™æ²¡æœ‰é™åˆ¶,è¿™æ˜¯ç”±äºŽ32ä½ç³»ç»Ÿé™åˆ¶å•è¿›ç¨‹æœ€å¤šå¯ä½¿ç”¨2Gå†…å­˜,è¦ä½¿ç”¨æ›´å¤šå†…å­˜ï¼Œå¯ä»¥åˆ†å¤šä¸ªç«¯å£å¼€å¯å¤šä¸ªMemcachedè¿›ç¨‹ã€‚ 32 ä½å¯»å€ç©ºé—´åªæœ‰ 4GB å¤§å°ï¼ŒäºŽæ˜¯ 32 ä½åº”ç”¨ç¨‹åºè¿›ç¨‹æœ€å¤§åªèƒ½ç”¨åˆ° 4GB çš„å†…å­˜ã€‚ç„¶è€Œï¼Œé™¤äº†åº”ç”¨ç¨‹åºæœ¬èº«è¦ç”¨å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¹Ÿéœ€è¦ä½¿ç”¨ã€‚åº”ç”¨ç¨‹åºä½¿ç”¨çš„å†…å­˜ç©ºé—´åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼Œæ¯ä¸ª 32 ä½ç¨‹åºçš„ç”¨æˆ·ç©ºé—´å¯ç‹¬äº«å‰ 2GB ç©ºé—´ï¼ˆæŒ‡é’ˆå€¼ä¸ºæ­£æ•°ï¼‰ï¼Œè€Œå†…æ ¸ç©ºé—´ä¸ºæ‰€æœ‰è¿›ç¨‹å…±äº« 2GB ç©ºé—´ï¼ˆæŒ‡é’ˆå€¼ä¸ºè´Ÿæ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œ32 ä½åº”ç”¨ç¨‹åºå®žé™…èƒ½å¤Ÿè®¿é—®çš„å†…å­˜åœ°å€ç©ºé—´æœ€å¤šåªæœ‰ 2GBã€‚ æœ€å¤§30å¤©çš„æ•°æ®è¿‡æœŸæ—¶é—´ï¼Œè®¾ç½®ä¸ºæ°¸ä¹…ä¹Ÿä¼šåœ¨è¿™ä¸ªæ—¶é—´è¿‡æœŸã€‚æœ€é•¿é”®é•¿ä¸º250å­—èŠ‚ï¼Œå¤§äºŽè¯¥é•¿åº¦æ— æ³•å­˜å‚¨ã€‚æœ€å¤§åŒæ—¶è¿žæŽ¥æ•°æ˜¯200; memcacheæ˜¯ä¸€ç§æ— é˜»å¡žçš„socketé€šä¿¡æ–¹å¼æœåŠ¡ï¼ŒåŸºäºŽlibeventåº“ï¼ŒçŠ¹è±«æ— é˜»å¡žé€šä¿¡ï¼Œå¯¹å†…å­˜è¯»å†™é€Ÿåº¦éžå¸¸å¿«ã€‚ ä¸é€‚ç”¨memcachedçš„ä¸šåŠ¡åœºæ™¯ï¼Ÿ ç¼“å­˜å¯¹è±¡çš„å¤§å°å¤§äºŽ1MB è™šæ‹Ÿä¸»æœºä¸è®©è¿è¡ŒmemcachedæœåŠ¡ keyçš„é•¿åº¦å¤§äºŽ250å­—ç¬¦ éœ€è¦æŒä¹…åŒ– ä¸èƒ½å¤ŸéåŽ†memcachedä¸­æ‰€æœ‰çš„itemï¼Ÿ è¿™ä¸ªæ“ä½œçš„é€Ÿåº¦ç›¸å¯¹ç¼“æ…¢ä¸”é˜»å¡žå…¶ä»–çš„æ“ä½œ memcacheå¦‚ä½•åˆ†é…å†…å­˜ï¼Ÿ è¿™å¼ å›¾ç‰‡é‡Œé¢æ¶‰åŠäº†slab_classã€slabã€pageã€chunkå››ä¸ªæ¦‚å¿µï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ï¼š MemCacheå°†å†…å­˜ç©ºé—´åˆ†ä¸ºä¸€ç»„slab æ¯ä¸ªslabä¸‹åˆæœ‰è‹¥å¹²ä¸ªpageï¼Œæ¯ä¸ªpageé»˜è®¤æ˜¯1Mï¼Œå¦‚æžœä¸€ä¸ªslabå ç”¨100Må†…å­˜çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªslabä¸‹åº”è¯¥æœ‰100ä¸ªpage æ¯ä¸ªpageé‡Œé¢åŒ…å«ä¸€ç»„chunkï¼Œchunkæ˜¯çœŸæ­£å­˜æ”¾æ•°æ®çš„åœ°æ–¹ï¼ŒåŒä¸€ä¸ªslabé‡Œé¢çš„chunkçš„å¤§å°æ˜¯å›ºå®šçš„ æœ‰ç›¸åŒå¤§å°chunkçš„slabè¢«ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç§°ä¸ºslab_class é‚£ä¹ˆæ˜¯å…·ä½“å¦‚ä½•åˆ†é…çš„å‘¢ï¼Ÿ MemCacheä¸­çš„valueè¿‡æ¥å­˜æ”¾çš„åœ°æ–¹æ˜¯ç”±valueçš„å¤§å°å†³å®šçš„ï¼Œvalueæ€»æ˜¯ä¼šè¢«å­˜æ”¾åˆ°ä¸Žchunkå¤§å°æœ€æŽ¥è¿‘çš„ä¸€ä¸ªslabä¸­ï¼Œæ¯”å¦‚slab[1]çš„chunkå¤§å°ä¸º80å­—èŠ‚ã€slab[2]çš„chunkå¤§å°ä¸º100å­—èŠ‚ã€slab[3]çš„chunkå¤§å°ä¸º128å­—èŠ‚ï¼ˆç›¸é‚»slabå†…çš„chunkåŸºæœ¬ä»¥1.25ä¸ºæ¯”ä¾‹è¿›è¡Œå¢žé•¿ï¼ŒMemCacheå¯åŠ¨æ—¶å¯ä»¥ç”¨-fæŒ‡å®šè¿™ä¸ªæ¯”ä¾‹ï¼‰ï¼Œé‚£ä¹ˆè¿‡æ¥ä¸€ä¸ª88å­—èŠ‚çš„valueï¼Œè¿™ä¸ªvalueå°†è¢«æ”¾åˆ°2å·slabä¸­ã€‚ æ”¾slabçš„æ—¶å€™ï¼Œé¦–å…ˆslabè¦ç”³è¯·å†…å­˜ï¼Œç”³è¯·å†…å­˜æ˜¯ä»¥pageä¸ºå•ä½çš„ï¼Œæ‰€ä»¥åœ¨æ”¾å…¥ç¬¬ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œæ— è®ºå¤§å°ä¸ºå¤šå°‘ï¼Œéƒ½ä¼šæœ‰1Må¤§å°çš„pageè¢«åˆ†é…ç»™è¯¥slabã€‚ç”³è¯·åˆ°pageåŽï¼Œslabä¼šå°†è¿™ä¸ªpageçš„å†…å­˜æŒ‰chunkçš„å¤§å°è¿›è¡Œåˆ‡åˆ†ï¼Œè¿™æ ·å°±å˜æˆäº†ä¸€ä¸ªchunkæ•°ç»„ï¼Œæœ€åŽä»Žè¿™ä¸ªchunkæ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ªç”¨äºŽå­˜å‚¨æ•°æ®ã€‚ å¦‚æžœè¿™ä¸ªslabä¸­æ²¡æœ‰chunkå¯ä»¥åˆ†é…äº†æ€Žä¹ˆåŠžï¼Œå¦‚æžœMemCacheå¯åŠ¨æ²¡æœ‰è¿½åŠ -Mï¼ˆç¦æ­¢LRUï¼Œè¿™ç§æƒ…å†µä¸‹å†…å­˜ä¸å¤Ÿä¼šæŠ¥Out Of Memoryé”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆMemCacheä¼šæŠŠè¿™ä¸ªslabä¸­æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„chunkä¸­çš„æ•°æ®æ¸…ç†æŽ‰ï¼Œç„¶åŽæ”¾ä¸Šæœ€æ–°çš„æ•°æ®ã€‚ MemCacheçš„å†…å­˜åˆ†é…chunké‡Œé¢ä¼šæœ‰å†…å­˜æµªè´¹ï¼Œ88å­—èŠ‚çš„valueåˆ†é…åœ¨128å­—èŠ‚ï¼ˆç´§æŽ¥ç€å¤§çš„ç”¨ï¼‰çš„chunkä¸­ï¼Œå°±æŸå¤±äº†30å­—èŠ‚ï¼Œä½†æ˜¯è¿™ä¹Ÿé¿å…äº†ç®¡ç†å†…å­˜ç¢Žç‰‡çš„é—®é¢˜ MemCacheçš„LRUç®—æ³•ä¸æ˜¯é’ˆå¯¹å…¨å±€çš„ï¼Œæ˜¯é’ˆå¯¹slabçš„ è¯¥å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆMemCacheå­˜æ”¾çš„valueå¤§å°æ˜¯é™åˆ¶çš„ï¼Œå› ä¸ºä¸€ä¸ªæ–°æ•°æ®è¿‡æ¥ï¼Œslabä¼šå…ˆä»¥pageä¸ºå•ä½ç”³è¯·ä¸€å—å†…å­˜ï¼Œç”³è¯·çš„å†…å­˜æœ€å¤šå°±åªæœ‰1Mï¼Œæ‰€ä»¥valueå¤§å°è‡ªç„¶ä¸èƒ½å¤§äºŽ1Mäº† æœ€åŽå†æ€»ç»“ä¸€ä¸‹memcache MemCacheä¸­å¯ä»¥ä¿å­˜çš„itemæ•°æ®é‡æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œåªè¦å†…å­˜è¶³å¤Ÿ MemCacheå•è¿›ç¨‹åœ¨32ä½æœºä¸­æœ€å¤§ä½¿ç”¨å†…å­˜ä¸º2Gï¼Œ64ä½æœºåˆ™æ²¡æœ‰é™åˆ¶ Keyæœ€å¤§ä¸º250ä¸ªå­—èŠ‚ï¼Œè¶…è¿‡è¯¥é•¿åº¦æ— æ³•å­˜å‚¨ å•ä¸ªitemæœ€å¤§æ•°æ®æ˜¯1MBï¼Œè¶…è¿‡1MBçš„æ•°æ®ä¸äºˆå­˜å‚¨ MemCacheæœåŠ¡ç«¯æ˜¯ä¸å®‰å…¨çš„ï¼Œæ¯”å¦‚å·²çŸ¥æŸä¸ªMemCacheèŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æŽ¥telnetè¿‡åŽ»ï¼Œå¹¶é€šè¿‡flush_allè®©å·²ç»å­˜åœ¨çš„é”®å€¼å¯¹ç«‹å³å¤±æ•ˆ ä¸èƒ½å¤ŸéåŽ†MemCacheä¸­æ‰€æœ‰çš„itemï¼Œå› ä¸ºè¿™ä¸ªæ“ä½œçš„é€Ÿåº¦ç›¸å¯¹ç¼“æ…¢ä¸”ä¼šé˜»å¡žå…¶ä»–çš„æ“ä½œ MemCacheçš„é«˜æ€§èƒ½æºè‡ªäºŽä¸¤é˜¶æ®µå“ˆå¸Œç»“æž„ï¼šç¬¬ä¸€é˜¶æ®µåœ¨å®¢æˆ·ç«¯ï¼Œé€šè¿‡Hashç®—æ³•æ ¹æ®Keyå€¼ç®—å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼›ç¬¬äºŒé˜¶æ®µåœ¨æœåŠ¡ç«¯ï¼Œé€šè¿‡ä¸€ä¸ªå†…éƒ¨çš„Hashç®—æ³•ï¼ŒæŸ¥æ‰¾çœŸæ­£çš„itemå¹¶è¿”å›žç»™å®¢æˆ·ç«¯ã€‚ä»Žå®žçŽ°çš„è§’åº¦çœ‹ï¼ŒMemCacheæ˜¯ä¸€ä¸ªéžé˜»å¡žçš„ã€åŸºäºŽäº‹ä»¶çš„æœåŠ¡å™¨ç¨‹åº MemCacheè®¾ç½®æ·»åŠ æŸä¸€ä¸ªKeyå€¼çš„æ—¶å€™ï¼Œä¼ å…¥expireä¸º0è¡¨ç¤ºè¿™ä¸ªKeyå€¼æ°¸ä¹…æœ‰æ•ˆï¼Œè¿™ä¸ªKeyå€¼ä¹Ÿä¼šåœ¨30å¤©ä¹‹åŽå¤±æ•ˆ redis redisç‰¹ç‚¹ æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ã€‚ æ”¯æŒæ›´å¤šçš„æ•°æ®ç»“æž„ æ”¯æŒæ•°æ®å¤‡ä»½ æ€§èƒ½æžé«˜ï¼Œè¯»å¯ä»¥è¾¾åˆ°11ä¸‡æ¬¡æ¯ç§’ï¼›å†™è¾¾åˆ°8ä¸‡1åƒæ¬¡æ¯ç§’ redisæ‰€æœ‰æ“ä½œéƒ½æ˜¯åŽŸå­æ€§ï¼Œå¹¶ä¸”æ”¯æŒå‡ ä¸ªæ“ä½œä¸€èµ·çš„åŽŸå­æ€§ æ”¯æŒå‘å¸ƒ-è®¢é˜…åŠŸèƒ½ redisé€‚ç”¨åœºæ™¯ å–æœ€æ–°nä¸ªæ•°æ®ã€æŽ’è¡Œæ¦œ ç²¾å‡†è¿‡æœŸæ—¶é—´ è®¡æ•°å™¨ å”¯ä¸€æ€§æ£€æŸ¥ å®žæ—¶ç³»ç»Ÿã€åžƒåœ¾ç³»ç»Ÿã€ç¼“å­˜ç­‰ redis VS memcache å½“æåˆ°rediså°±é—®memcacheï¼Œå½“æåˆ°memcacheå°±æåˆ°redisï¼Œè¯´æ˜Žè¿™ä¸¤è€…ç”¨çš„éƒ½ååˆ†å¹¿æ³›ï¼Œrediså·ç§°â€œå¼ºåŒ–ç‰ˆmemcachedâ€ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«åˆ°åº•æ˜¯å•¥å‘¢ï¼Ÿ åŸºæœ¬å‘½ä»¤ memcacheæ”¯æŒçš„å‘½ä»¤å¾ˆå°‘ï¼Œå› ä¸ºä»–åªæ”¯æŒStringçš„æ“ä½œï¼Œé€šè®¯åè®®åŒ…æ‹¬æ–‡æœ¬æ ¼å¼å’ŒäºŒè¿›åˆ¶æ ¼å¼ï¼Œç”¨äºŽæ»¡è¶³ç®€å•ç½‘ç»œå®¢æˆ·ç«¯å·¥å…·ï¼ˆå¦‚telnetï¼‰å’Œå¯¹æ€§èƒ½è¦æ±‚æ›´é«˜çš„å®¢æˆ·ç«¯çš„ä¸åŒéœ€æ±‚ï¼›redisæ“ä½œç±»ä¼¼ï¼Œåªæ˜¯æ•°æ®ç»“æž„æ›´å¤æ‚ä»¥æ”¯æŒæ›´å¤šçš„ç‰¹æ€§ï¼Œå¦‚å‘å¸ƒè®¢é˜…ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚redisçš„å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šè®¯åè®®å®Œå…¨é‡‡ç”¨æ–‡æœ¬æ ¼å¼(Redis ClusteræœåŠ¡ç«¯èŠ‚ç‚¹ä¹‹é—´é€šè®¯é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼)ã€‚ äº‹åŠ¡ redisé€šè¿‡multi / watch / execç­‰å‘½ä»¤å¯ä»¥æ”¯æŒäº‹åŠ¡çš„æ¦‚å¿µï¼ŒåŽŸå­æ€§çš„æ‰§è¡Œä¸€æ‰¹å‘½ä»¤; memcache:å³ä½¿åœ¨å¤šçº¿ç¨‹æ¨¡å¼ï¼Œæ‰€æœ‰çš„å‘½ä»¤éƒ½æ˜¯åŽŸå­çš„ï¼›å‘½ä»¤åºåˆ—ä¸æ˜¯åŽŸå­çš„ã€‚åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ‚¨ä¹Ÿå¯èƒ½è¦†å†™äº†ä¸€ä¸ªè¢«å…¶ä»–è¿›ç¨‹setçš„itemã€‚memcached 1.2.5ä»¥åŠæ›´é«˜ç‰ˆæœ¬ï¼Œæä¾›äº†getså’Œcaså‘½ä»¤ï¼Œå®ƒä»¬å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜ã€‚å¦‚æžœæ‚¨ä½¿ç”¨getså‘½ä»¤æŸ¥è¯¢æŸä¸ªkeyçš„itemï¼Œmemcachedä¼šç»™æ‚¨è¿”å›žè¯¥itemå½“å‰å€¼çš„å”¯ä¸€æ ‡è¯†ã€‚å¦‚æžœæ‚¨è¦†å†™äº†è¿™ä¸ªitemå¹¶æƒ³æŠŠå®ƒå†™å›žåˆ°memcachedä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡caså‘½ä»¤æŠŠé‚£ä¸ªå”¯ä¸€æ ‡è¯†ä¸€èµ·å‘é€ç»™ memcachedã€‚å¦‚æžœè¯¥itemå­˜æ”¾åœ¨memcachedä¸­çš„å”¯ä¸€æ ‡è¯†ä¸Žæ‚¨æä¾›çš„ä¸€è‡´ï¼Œæ‚¨çš„å†™æ“ä½œå°†ä¼šæˆåŠŸã€‚å¦‚æžœå¦ä¸€ä¸ªè¿›ç¨‹åœ¨è¿™æœŸé—´ä¹Ÿä¿®æ”¹äº†è¿™ä¸ª itemï¼Œé‚£ä¹ˆè¯¥itemå­˜æ”¾åœ¨memcachedä¸­çš„å”¯ä¸€æ ‡è¯†å°†ä¼šæ”¹å˜ï¼Œæ‚¨çš„å†™æ“ä½œå°±ä¼šå¤±è´¥ã€‚ æ•°æ®å¤‡ä»½ï¼Œæœ‰æ•ˆæ€§ï¼ŒæŒä¹…åŒ–ç­‰ memcachedä¸ä¿è¯å­˜å‚¨çš„æ•°æ®çš„æœ‰æ•ˆæ€§ï¼Œslabå†…éƒ¨åŸºäºŽLRUä¹Ÿä¼šè‡ªåŠ¨æ·˜æ±°æ—§æ•°æ®;memcachedä¹Ÿä¸åšæ•°æ®çš„æŒä¹…åŒ–å·¥ä½œ; rediså¯ä»¥ä»¥master-slaveçš„æ–¹å¼é…ç½®æœåŠ¡å™¨ï¼ŒslaveèŠ‚ç‚¹å¯¹æ•°æ®è¿›è¡Œreplicaå¤‡ä»½ï¼ŒslaveèŠ‚ç‚¹ä¹Ÿå¯ä»¥å……å½“read onlyçš„èŠ‚ç‚¹åˆ†æ‹…æ•°æ®è¯»å–çš„å·¥ä½œ;rediså†…å»ºæ”¯æŒä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼Œsnapshotå¿«ç…§å’ŒAOFå¢žé‡Logæ–¹å¼ã€‚ æ€§èƒ½ memcachedè‡ªèº«å¹¶ä¸ä¸»åŠ¨å®šæœŸæ£€æŸ¥å’Œæ ‡è®°å“ªäº›æ•°æ®éœ€è¦è¢«æ·˜æ±°ï¼Œåªæœ‰å½“å†æ¬¡è¯»å–ç›¸å…³æ•°æ®æ—¶æ‰æ£€æŸ¥æ—¶é—´æˆ³ï¼Œæˆ–è€…å½“å†…å­˜ä¸å¤Ÿä½¿ç”¨éœ€è¦ä¸»åŠ¨æ·˜æ±°æ•°æ®æ—¶è¿›ä¸€æ­¥æ£€æŸ¥LRUæ•°æ®ã€‚ redisä¸ºäº†å‡å°‘å¤§é‡å°æ•°æ®CMDæ“ä½œçš„ç½‘ç»œé€šè®¯æ—¶é—´å¼€é”€ RTT (Round Trip Time)ï¼Œæ”¯æŒpipelineå’ŒscriptæŠ€æœ¯ã€‚ é›†ç¾¤ memcachedçš„æœåŠ¡å™¨ç«¯äº’ç›¸å®Œå…¨ç‹¬ç«‹ï¼Œå®¢æˆ·ç«¯é€šå¸¸é€šè¿‡å¯¹é”®å€¼åº”ç”¨hashç®—æ³•å†³å®šæ•°æ®çš„åˆ†åŒºï¼Œä¸ºäº†å‡å°‘æœåŠ¡å™¨çš„å¢žå‡å¯¹hashç»“æžœçš„å½±å“ï¼Œå¯¼è‡´å¤§é¢ç§¯çš„ç¼“å­˜å¤±æ•ˆï¼Œå¤šæ•°å®¢æˆ·ç«¯å®žçŽ°äº†ä¸€è‡´æ€§hashç®—æ³•ã€‚ redis3.0å·²ç»æ”¯æŒæœåŠ¡ç«¯é›†ç¾¤äº†ã€‚ æ€§èƒ½å¯¹æ¯” ç”±äºŽredisåªä½¿ç”¨å•æ ¸ï¼Œè€Œmemcachedå¯ä»¥ä½¿ç”¨å¤šæ ¸ï¼Œæ‰€ä»¥å¹³å‡æ¯ä¸€ä¸ªæ ¸ä¸Šredisåœ¨å­˜å‚¨å°æ•°æ®æ—¶æ¯”memcachedæ€§èƒ½æ›´é«˜ã€‚è€Œåœ¨100kä»¥ä¸Šçš„æ•°æ®ä¸­ï¼Œmemcachedæ€§èƒ½è¦é«˜äºŽredisï¼Œè™½ç„¶redisæœ€è¿‘ä¹Ÿåœ¨å­˜å‚¨å¤§æ•°æ®çš„æ€§èƒ½ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯æ¯”èµ·memcachedï¼Œè¿˜æ˜¯ç¨æœ‰é€Šè‰² å†…å­˜ä½¿ç”¨æ•ˆçŽ‡ ä½¿ç”¨ç®€å•çš„key-valueå­˜å‚¨çš„è¯ï¼Œmemcachedçš„å†…å­˜åˆ©ç”¨çŽ‡æ›´é«˜ï¼Œè€Œå¦‚æžœredisé‡‡ç”¨hashç»“æž„æ¥åškey-valueå­˜å‚¨ï¼Œç”±äºŽå…¶ç»„åˆå¼çš„åŽ‹ç¼©ï¼Œå…¶å†…å­˜åˆ©ç”¨çŽ‡ä¼šé«˜äºŽmemcachedã€‚å¦å¤–ï¼Œmemcachedä½¿ç”¨é¢„åˆ†é…çš„å†…å­˜æ± çš„æ–¹å¼ï¼Œå¸¦æ¥ä¸€å®šç¨‹åº¦çš„ç©ºé—´æµªè´¹ å¹¶ä¸”åœ¨å†…å­˜ä»ç„¶æœ‰å¾ˆå¤§ç©ºé—´æ—¶ï¼Œæ–°çš„æ•°æ®ä¹Ÿå¯èƒ½ä¼šè¢«å‰”é™¤ï¼Œè€Œredisä½¿ç”¨çŽ°åœºç”³è¯·å†…å­˜çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®ï¼Œä¸ä¼šå‰”é™¤ä»»ä½•éžä¸´æ—¶æ•°æ® redisæ›´é€‚åˆä½œä¸ºå­˜å‚¨è€Œä¸æ˜¯cacheã€‚ redisæ”¯æŒæœåŠ¡å™¨ç«¯çš„æ•°æ®æ“ä½œ redisç›¸æ¯”memcachedæ¥è¯´ï¼Œæ‹¥æœ‰æ›´å¤šçš„æ•°æ®ç»“æž„å’Œå¹¶æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œï¼Œé€šå¸¸åœ¨memcachedé‡Œï¼Œä½ éœ€è¦å°†æ•°æ®æ‹¿åˆ°å®¢æˆ·ç«¯æ¥è¿›è¡Œç±»ä¼¼çš„ä¿®æ”¹å†setå›žåŽ»ã€‚è¿™å¤§å¤§å¢žåŠ äº†ç½‘ç»œIOçš„æ¬¡æ•°å’Œæ•°æ®ä½“ç§¯ã€‚åœ¨redisä¸­ï¼Œè¿™äº›å¤æ‚çš„æ“ä½œé€šå¸¸å’Œä¸€èˆ¬çš„GET/SETä¸€æ ·é«˜æ•ˆã€‚æ‰€ä»¥ï¼Œå¦‚æžœéœ€è¦ç¼“å­˜èƒ½å¤Ÿæ”¯æŒæ›´å¤æ‚çš„ç»“æž„å’Œæ“ä½œï¼Œé‚£ä¹ˆredisä¼šæ˜¯ä¸é”™çš„é€‰æ‹© ä½•æ—¶åº”è¯¥ä½¿ç”¨memcache: é¦–å…ˆå°±æ˜¯å¯¹å°åž‹é™æ€æ•°æ®è¿›è¡Œç¼“å­˜å¤„ç†ï¼Œæœ€å…·ä»£è¡¨æ€§çš„ä¾‹å­å°±æ˜¯HTMLä»£ç ç‰‡æ®µã€‚è¿™æ˜¯å› ä¸ºmemcachedåœ¨å¤„ç†å…ƒæ•°æ®æ—¶æ‰€æ¶ˆè€—çš„å†…å­˜èµ„æºç›¸å¯¹æ›´å°‘. åœ¨ä»¥å‰ï¼Œredis3.0ç‰ˆæœ¬ä¹‹å‰ï¼Œmemcachedåœ¨æ¨ªå‘æ‰©å±•æ–¹é¢ä¹Ÿæ¯”redisæ›´å…·ä¼˜åŠ¿ã€‚ç”±äºŽå…¶åœ¨è®¾è®¡ä¸Šçš„æ€è·¯å€¾å‘ä»¥åŠç›¸å¯¹æ›´ä¸ºç®€å•çš„åŠŸèƒ½è®¾ç½®ï¼Œmemcachedåœ¨å®žçŽ°æ‰©å±•æ—¶çš„éš¾åº¦æ¯”redisä½Žå¾—å¤šã€‚ ä½•æ—¶åº”è¯¥ä½¿ç”¨redisï¼š å…¶ä»–åœºæ™¯éƒ½å¯ä»¥ç”¨redisæ¥æ›¿æ¢ã€‚ ç›¸æ¯”äºŽæ­¦æ–­çš„LRU(å³æœ€ä½Žè¿‘æœŸä½¿ç”¨é‡)ç®—æ³•ï¼Œrediså…è®¸ç”¨æˆ·æ›´ä¸ºç²¾å‡†åœ°è¿›è¡Œç»†åŒ–æŽ§åˆ¶ï¼Œåˆ©ç”¨å…­ç§ä¸åŒå›žæ”¶ç­–ç•¥ç¡®åˆ‡æé«˜ç¼“å­˜èµ„æºçš„å®žé™…åˆ©ç”¨çŽ‡ã€‚redisè¿˜é‡‡ç”¨æ›´ä¸ºå¤æ‚çš„å†…å­˜ç®¡ç†ä¸Žå›žæ”¶å¯¹è±¡å¤‡é€‰æ–¹æ¡ˆã€‚ memcachedå°†é”®åé™åˆ¶åœ¨250å­—èŠ‚ï¼Œå€¼ä¹Ÿè¢«é™åˆ¶åœ¨ä¸è¶…è¿‡1MBï¼Œä¸”åªé€‚ç”¨äºŽæ™®é€šå­—ç¬¦ä¸²ã€‚redisåˆ™å°†é”®åä¸Žå€¼çš„æœ€å¤§ä¸Šé™å„è‡ªè®¾å®šä¸º512MBï¼Œä¸”æ”¯æŒäºŒè¿›åˆ¶æ ¼å¼ã€‚ å®ƒæ‰€ä¿å­˜çš„æ•°æ®å…·å¤‡é€æ˜ŽåŒ–ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨èƒ½å¤Ÿç›´æŽ¥å¯¹è¿™äº›æ•°æ®è¿›è¡Œæ“ä½œ. redisè¿˜æä¾›å¯é€‰è€Œä¸”èƒ½å¤Ÿå…·ä½“è°ƒæ•´çš„æ•°æ®æŒä¹…æ€§æ–¹æ¡ˆ redisèƒ½å¤Ÿæä¾›å¤åˆ¶åŠŸèƒ½ã€‚å¤åˆ¶åŠŸèƒ½æ—¨åœ¨å¸®åŠ©ç¼“å­˜ä½“ç³»å®žçŽ°é«˜å¯ç”¨æ€§é…ç½®æ–¹æ¡ˆï¼Œä»Žè€Œåœ¨é­é‡æ•…éšœçš„æƒ…å†µä¸‹ç»§ç»­ä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸é—´æ–­çš„ç¼“å­˜æœåŠ¡ã€‚ ä½¿ç”¨redisçš„æ­£ç¡®å§¿åŠ¿ï¼š è¦è¿›è¡Œmaster-slaveé…ç½®ï¼Œå‡ºçŽ°æœåŠ¡æ•…éšœæ—¶å¯ä»¥æ”¯æŒåˆ‡æ¢ã€‚ åœ¨masterä¾§ç¦ç”¨æ•°æ®æŒä¹…åŒ–ï¼Œåªéœ€åœ¨slaveä¸Šé…ç½®æ•°æ®æŒä¹…åŒ–ã€‚ ç‰©ç†å†…å­˜+è™šæ‹Ÿå†…å­˜ä¸è¶³ï¼Œè¿™ä¸ªæ—¶å€™dumpä¸€ç›´æ­»ç€ï¼Œæ—¶é—´ä¹…äº†æœºå™¨æŒ‚æŽ‰ã€‚è¿™ä¸ªæƒ…å†µå°±æ˜¯ç¾éš¾ã€‚ å½“redisç‰©ç†å†…å­˜ä½¿ç”¨è¶…è¿‡å†…å­˜æ€»å®¹é‡çš„3/5æ—¶å°±ä¼šå¼€å§‹æ¯”è¾ƒå±é™©äº†ï¼Œå°±å¼€å§‹åšswap,å†…å­˜ç¢Žç‰‡å¤§ã€‚ å½“è¾¾åˆ°æœ€å¤§å†…å­˜æ—¶ï¼Œä¼šæ¸…ç©ºå¸¦æœ‰è¿‡æœŸæ—¶é—´çš„keyï¼Œå³ä½¿keyæœªåˆ°è¿‡æœŸæ—¶é—´ã€‚ redisä¸ŽDBåŒæ­¥å†™çš„é—®é¢˜ï¼Œå…ˆå†™DBï¼ŒåŽå†™redisï¼Œå› ä¸ºå†™å†…å­˜åŸºæœ¬ä¸Šæ²¡æœ‰é—®é¢˜ã€‚]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisäº‹åŠ¡]]></title>
    <url>%2F2019%2F02%2F02%2Fredis%2FRedis%E4%BA%8B%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬åä¸€ç¯‡æ–‡ç« ã€‚è¯¦ç»†æŽ¢è®¨redisäº‹åŠ¡çš„ç”¨æ³•å’ŒåŽŸç†ã€‚ redis äº‹åŠ¡æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆï¼Œè‡³å°‘æ˜¯ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å‘½ä»¤ï¼Œredis äº‹åŠ¡ä¿è¯è¿™äº›å‘½ä»¤è¢«æ‰§è¡Œæ—¶ä¸­é—´ä¸ä¼šè¢«ä»»ä½•å…¶ä»–æ“ä½œæ‰“æ–­ã€‚ äº‹åŠ¡åŸºæœ¬è®¤è¯† å½“å®¢æˆ·ç«¯å¤„äºŽéžäº‹åŠ¡çŠ¶æ€ä¸‹æ—¶ï¼Œ æ‰€æœ‰å‘é€ç»™æœåŠ¡å™¨ç«¯çš„å‘½ä»¤éƒ½ä¼šç«‹å³è¢«æœåŠ¡å™¨æ‰§è¡Œã€‚ ä½†æ˜¯ï¼Œ å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åŽï¼Œ æœåŠ¡å™¨åœ¨æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤æ—¶ï¼Œ ä¸ä¼šç«‹å³æ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯å°†è¿™äº›å‘½ä»¤å…¨éƒ¨æ”¾è¿›ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—é‡Œï¼Œ ç„¶åŽè¿”å›ž QUEUED ï¼Œ è¡¨ç¤ºå‘½ä»¤å·²å…¥é˜Ÿã€‚ äº‹åŠ¡æ‰§è¡Œ å‰é¢è¯´åˆ°ï¼Œ å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åŽï¼Œ å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤å°±ä¼šè¢«æ”¾è¿›äº‹åŠ¡é˜Ÿåˆ—é‡Œã€‚ ä½†å…¶å®žå¹¶ä¸æ˜¯æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¼šè¢«æ”¾è¿›äº‹åŠ¡é˜Ÿåˆ—ï¼Œ å…¶ä¸­çš„ä¾‹å¤–å°±æ˜¯ EXEC ã€ DISCARD ã€ MULTI å’Œ WATCH è¿™å››ä¸ªå‘½ä»¤ â€”â€” å½“è¿™å››ä¸ªå‘½ä»¤ä»Žå®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œ å®ƒä»¬ä¼šåƒå®¢æˆ·ç«¯å¤„äºŽéžäº‹åŠ¡çŠ¶æ€ä¸€æ ·ï¼Œ ç›´æŽ¥è¢«æœåŠ¡å™¨æ‰§è¡Œï¼š å¦‚æžœå®¢æˆ·ç«¯æ­£å¤„äºŽäº‹åŠ¡çŠ¶æ€ï¼Œ é‚£ä¹ˆå½“ EXEC å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œ æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯æ‰€ä¿å­˜çš„äº‹åŠ¡é˜Ÿåˆ—ï¼Œ ä»¥å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ–¹å¼æ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼š æœ€å…ˆå…¥é˜Ÿçš„å‘½ä»¤æœ€å…ˆæ‰§è¡Œï¼Œ è€Œæœ€åŽå…¥é˜Ÿçš„å‘½ä»¤æœ€åŽæ‰§è¡Œã€‚ äº‹åŠ¡åŸºæœ¬å‘½ä»¤ä»‹ç» é™¤äº† EXEC ä¹‹å¤–ï¼Œ æœåŠ¡å™¨åœ¨å®¢æˆ·ç«¯å¤„äºŽäº‹åŠ¡çŠ¶æ€æ—¶ï¼Œ ä¸åŠ å…¥åˆ°äº‹åŠ¡é˜Ÿåˆ—è€Œç›´æŽ¥æ‰§è¡Œçš„å¦å¤–ä¸‰ä¸ªå‘½ä»¤æ˜¯ DISCARD ã€ MULTI å’Œ WATCH ã€‚ DISCARD å‘½ä»¤ç”¨äºŽå–æ¶ˆä¸€ä¸ªäº‹åŠ¡ï¼Œ å®ƒæ¸…ç©ºå®¢æˆ·ç«¯çš„æ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—ï¼Œ ç„¶åŽå°†å®¢æˆ·ç«¯ä»Žäº‹åŠ¡çŠ¶æ€è°ƒæ•´å›žéžäº‹åŠ¡çŠ¶æ€ï¼Œ æœ€åŽè¿”å›žå­—ç¬¦ä¸² OK ç»™å®¢æˆ·ç«¯ï¼Œ è¯´æ˜Žäº‹åŠ¡å·²è¢«å–æ¶ˆã€‚ Redis çš„äº‹åŠ¡æ˜¯ä¸å¯åµŒå¥—çš„ï¼Œ å½“å®¢æˆ·ç«¯å·²ç»å¤„äºŽäº‹åŠ¡çŠ¶æ€ï¼Œ è€Œå®¢æˆ·ç«¯åˆå†å‘æœåŠ¡å™¨å‘é€ MULTI æ—¶ï¼Œ æœåŠ¡å™¨åªæ˜¯ç®€å•åœ°å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé”™è¯¯ï¼Œ ç„¶åŽç»§ç»­ç­‰å¾…å…¶ä»–å‘½ä»¤çš„å…¥é˜Ÿã€‚ MULTI å‘½ä»¤çš„å‘é€ä¸ä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œ ä¹Ÿä¸ä¼šä¿®æ”¹äº‹åŠ¡é˜Ÿåˆ—ä¸­å·²æœ‰çš„æ•°æ®ã€‚ WATCH åªèƒ½åœ¨å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹å‰æ‰§è¡Œï¼Œ åœ¨äº‹åŠ¡çŠ¶æ€ä¸‹å‘é€ WATCH å‘½ä»¤ä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯ï¼Œ ä½†å®ƒä¸ä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œ ä¹Ÿä¸ä¼šä¿®æ”¹äº‹åŠ¡é˜Ÿåˆ—ä¸­å·²æœ‰çš„æ•°æ®ï¼ˆå’Œå‰é¢å¤„ç† MULTI çš„æƒ…å†µä¸€æ ·ï¼‰ã€‚ æ­£å¸¸æƒ…å†µ 123multi//å¼€å¯äº‹åŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤å…ˆä¸æ‰§è¡Œï¼Œå…ˆæš‚æ—¶ä¿å­˜èµ·æ¥set key val//å‘½ä»¤å…¥é˜Ÿexec//æäº¤äº‹åŠ¡ï¼ˆæ‰§è¡Œå‘½ä»¤ï¼‰ å¼‚å¸¸æƒ…å†µ 1234multi//å¼€å¯äº‹åŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤å…ˆä¸æ‰§è¡Œï¼Œå…ˆæš‚æ—¶ä¿å­˜èµ·æ¥set key val//æ­£å¸¸å‘½ä»¤å…¥é˜Ÿset key//é”™è¯¯å‘½ä»¤ï¼Œç›´æŽ¥æŠ¥é”™exec//äº‹åŠ¡è¢«ä¸¢å¼ƒï¼Œæäº¤å¤±è´¥ ä¾‹å¤–æƒ…å†µ 1234multi//å¼€å¯äº‹åŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤å…ˆä¸æ‰§è¡Œï¼Œå…ˆæš‚æ—¶ä¿å­˜èµ·æ¥set key val//æ­£å¸¸å‘½ä»¤å…¥é˜Ÿincr key//è™½ç„¶å­—ç¬¦ä¸²ä¸èƒ½å¢žä¸€ï¼Œä½†æ˜¯ä¸æŠ¥é”™ï¼Œå…¥é˜Ÿexec//è‡ªå¢žä¼šå¤±è´¥ï¼Œä½†æ˜¯keyè¢«è®¾ç½®æˆåŠŸäº†ï¼Œæ•´ä¸ªäº‹åŠ¡æ²¡æœ‰å›žæ»š æ”¾å¼ƒäº‹åŠ¡ 123multi//å¼€å¯äº‹åŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤å…ˆä¸æ‰§è¡Œï¼Œå…ˆæš‚æ—¶ä¿å­˜èµ·æ¥set key val//æ­£å¸¸å‘½ä»¤å…¥é˜Ÿdiscard ä¹è§‚é” ä¹è§‚é”ï¼šæ¯æ¬¡æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹è¯¥æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰åŽ»æ›´æ–°è¿™æ¡æ•°æ®ï¼Œä¸€èˆ¬ä½¿ç”¨ç‰ˆæœ¬å·è¿›è¡Œåˆ¤æ–­ï¼Œä¹è§‚é”ä½¿ç”¨äºŽè¯»å¤šå†™å°‘çš„åº”ç”¨ç±»åž‹ï¼Œè¿™æ ·å¯ä»¥æé«˜åžåé‡ã€‚ ä¹è§‚é”å¤§å¤šæƒ…å†µæ˜¯æ ¹æ®æ•°æ®ç‰ˆæœ¬å·(version)çš„æœºåˆ¶å®žçŽ°çš„ï¼Œä½•ä¸ºæ•°æ®ç‰ˆæœ¬ï¼Ÿå³ä¸ºæ•°æ®å¢žåŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œåœ¨åŸºäºŽæ•°æ®åº“è¡¨çš„ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“æ·»åŠ ä¸€ä¸ªversionå­—æ®µæ¥å®žçŽ°è¯»å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ­¤ç‰ˆæœ¬å·ä¸€èµ·è¯»å‡ºï¼Œä¹‹åŽæ›´æ–°æ—¶ï¼Œå¯¹æ­¤ç‰ˆæœ¬å·åŠ 1ï¼Œæ­¤æ—¶å°†æäº¤æ•°æ®çš„ç‰ˆæœ¬å·ä¸Žæ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬å·è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æžœæäº¤çš„æ•°æ®ç‰ˆæœ¬å·å¤§äºŽæ•°æ®åº“è¡¨çš„å½“å‰ç‰ˆæœ¬ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ï¼Œä¸äºˆæ›´æ–°ã€‚ A B è¯»å‡ºç‰ˆæœ¬å·ä¸º1ï¼Œæ“ä½œ Aæ“ä½œæ—¶ï¼Œè¯»å‡ºç‰ˆæœ¬å·ä¹Ÿä¸º1ï¼Œè¿›è¡ŒæŸä¸ªæ“ä½œ(ä¿®æ”¹) æ‰§è¡Œä¿®æ”¹ï¼Œversion+1=2ï¼Œå› ä¸º2&gt;1ï¼Œæ‰€ä»¥æ›´æ–° â€¦ â€¦ æ‰§è¡Œä¿®æ”¹ï¼Œversion+1=2ï¼Œå‘çŽ°æ•°æ®åº“è®°å½•çš„ç‰ˆæœ¬ä¹Ÿä¸º2ï¼Œ2=2,æ›´æ–°å¤±è´¥ watchæœºåˆ¶ WATCH å‘½ä»¤ç”¨äºŽåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰ç›‘è§†ä»»æ„æ•°é‡çš„é”®ï¼š å½“è°ƒç”¨ EXEC å‘½ä»¤æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œ å¦‚æžœä»»æ„ä¸€ä¸ªè¢«ç›‘è§†çš„é”®å·²ç»è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹äº†ï¼Œ é‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡ä¸å†æ‰§è¡Œï¼Œ ç›´æŽ¥è¿”å›žå¤±è´¥ã€‚ 123456set k1 1 //è®¾ç½®k1å€¼ä¸º1watch k1 //ç›‘è§†k1(å…¶ä»–å®¢æˆ·ç«¯ä¸èƒ½ä¿®æ”¹k1å€¼)set k1 2 //è®¾ç½®k1å€¼ä¸º2multi //å¼€å§‹äº‹åŠ¡set k1 3 //ä¿®æ”¹k1å€¼ä¸º3exex //æäº¤äº‹åŠ¡ï¼Œk1å€¼ä»ä¸º2ï¼Œå› ä¸ºäº‹åŠ¡å¼€å§‹ä¹‹å‰k1å€¼è¢«ä¿®æ”¹äº† watchæœºåˆ¶ä¸¾ä¾‹ å¤§å®¶å¯èƒ½çŸ¥é“redisæä¾›äº†åŸºäºŽincrå‘½ä»¤æ¥æ“ä½œä¸€ä¸ªæ•´æ•°åž‹æ•°å€¼çš„åŽŸå­é€’å¢žï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡è®¾å¦‚æžœredisæ²¡æœ‰è¿™ä¸ªincrå‘½ä»¤ï¼Œæˆ‘ä»¬è¯¥æ€Žä¹ˆå®žçŽ°è¿™ä¸ªincrçš„æ“ä½œå‘¢ï¼Ÿ æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æƒ³è¦å¯¹ä¸€ä¸ªæ•´å½¢æ•°å€¼åšä¿®æ”¹æ˜¯è¿™ä¹ˆåšçš„(ä¼ªä»£ç å®žçŽ°)ï¼š 123val = GET mykeyval = val + 1SET mykey $val ä½†æ˜¯ä¸Šè¿°çš„ä»£ç ä¼šå‡ºçŽ°ä¸€ä¸ªé—®é¢˜,å› ä¸ºä¸Šé¢å§æ­£å¸¸çš„ä¸€ä¸ªincr(åŽŸå­é€’å¢žæ“ä½œ)åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†,é‚£ä¹ˆåœ¨å¤šçº¿ç¨‹(åˆ†å¸ƒå¼)çŽ¯å¢ƒä¸­ï¼Œè¿™ä¸ªæ“ä½œå°±æœ‰å¯èƒ½ä¸å†å…·æœ‰åŽŸå­æ€§äº†ã€‚ ç ”ç©¶è¿‡javaçš„jucåŒ…çš„äººåº”è¯¥éƒ½çŸ¥é“casï¼Œé‚£ä¹ˆredisä¹Ÿæä¾›äº†è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ï¼Œå°±æ˜¯åˆ©ç”¨watchå‘½ä»¤æ¥å®žçŽ°çš„ã€‚ å…·ä½“åšæ³•å¦‚ä¸‹: 123456WATCH mykeyval = GET mykeyval = val + 1MULTISET mykey $valEXEC å’Œæ­¤å‰ä»£ç ä¸åŒçš„æ˜¯ï¼Œæ–°ä»£ç åœ¨èŽ·å–mykeyçš„å€¼ä¹‹å‰å…ˆé€šè¿‡WATCHå‘½ä»¤ç›‘æŽ§äº†è¯¥é”®ï¼Œæ­¤åŽåˆå°†setå‘½ä»¤åŒ…å›´åœ¨äº‹åŠ¡ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„ä¿è¯æ¯ä¸ªè¿žæŽ¥åœ¨æ‰§è¡ŒEXECä¹‹å‰ï¼Œå¦‚æžœå½“å‰è¿žæŽ¥èŽ·å–çš„mykeyçš„å€¼è¢«å…¶å®ƒè¿žæŽ¥çš„å®¢æˆ·ç«¯ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“å‰è¿žæŽ¥çš„EXECå‘½ä»¤å°†æ‰§è¡Œå¤±è´¥ã€‚è¿™æ ·è°ƒç”¨è€…åœ¨åˆ¤æ–­è¿”å›žå€¼åŽå°±å¯ä»¥èŽ·æ‚‰valæ˜¯å¦è¢«é‡æ–°è®¾ç½®æˆåŠŸã€‚ ç”±äºŽWATCHå‘½ä»¤çš„ä½œç”¨åªæ˜¯å½“è¢«ç›‘æŽ§çš„é”®å€¼è¢«ä¿®æ”¹åŽé˜»æ­¢ä¹‹åŽä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œï¼Œè€Œä¸èƒ½ä¿è¯å…¶ä»–å®¢æˆ·ç«¯ä¸ä¿®æ”¹è¿™ä¸€é”®å€¼ï¼Œæ‰€ä»¥åœ¨ä¸€èˆ¬çš„æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦åœ¨EXECæ‰§è¡Œå¤±è´¥åŽé‡æ–°æ‰§è¡Œæ•´ä¸ªå‡½æ•°ã€‚ æ‰§è¡ŒEXECå‘½ä»¤åŽä¼šå–æ¶ˆå¯¹æ‰€æœ‰é”®çš„ç›‘æŽ§ï¼Œå¦‚æžœä¸æƒ³æ‰§è¡Œäº‹åŠ¡ä¸­çš„å‘½ä»¤ä¹Ÿå¯ä»¥ä½¿ç”¨UNWATCHå‘½ä»¤æ¥å–æ¶ˆç›‘æŽ§ã€‚ watchæœºåˆ¶åŽŸç† WATCH å‘½ä»¤çš„å®žçŽ° åœ¨æ¯ä¸ªä»£è¡¨æ•°æ®åº“çš„ redis.h/redisDb ç»“æž„ç±»åž‹ä¸­ï¼Œ éƒ½ä¿å­˜äº†ä¸€ä¸ª watched_keys å­—å…¸ï¼Œ å­—å…¸çš„é”®æ˜¯è¿™ä¸ªæ•°æ®åº“è¢«ç›‘è§†çš„é”®ï¼Œ è€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œ é“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰ç›‘è§†è¿™ä¸ªé”®çš„å®¢æˆ·ç«¯ã€‚ æ¯”å¦‚è¯´ï¼Œä»¥ä¸‹å­—å…¸å°±å±•ç¤ºäº†ä¸€ä¸ª watched_keys å­—å…¸çš„ä¾‹å­ï¼š å…¶ä¸­ï¼Œ é”® key1 æ­£åœ¨è¢« client2 ã€ client5 å’Œ client1 ä¸‰ä¸ªå®¢æˆ·ç«¯ç›‘è§†ï¼Œ å…¶ä»–ä¸€äº›é”®ä¹Ÿåˆ†åˆ«è¢«å…¶ä»–åˆ«çš„å®¢æˆ·ç«¯ç›‘è§†ç€ã€‚ WATCH å‘½ä»¤çš„ä½œç”¨ï¼Œ å°±æ˜¯å°†å½“å‰å®¢æˆ·ç«¯å’Œè¦ç›‘è§†çš„é”®åœ¨ watched_keys ä¸­è¿›è¡Œå…³è”ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æžœå½“å‰å®¢æˆ·ç«¯ä¸º client10086 ï¼Œ é‚£ä¹ˆå½“å®¢æˆ·ç«¯æ‰§è¡Œ WATCH key1 key2 æ—¶ï¼Œ å‰é¢å±•ç¤ºçš„ watched_keys å°†è¢«ä¿®æ”¹æˆè¿™ä¸ªæ ·å­ï¼š é€šè¿‡ watched_keys å­—å…¸ï¼Œ å¦‚æžœç¨‹åºæƒ³æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦è¢«ç›‘è§†ï¼Œ é‚£ä¹ˆå®ƒåªè¦æ£€æŸ¥å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªé”®å³å¯ï¼› å¦‚æžœç¨‹åºè¦èŽ·å–ç›‘è§†æŸä¸ªé”®çš„æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œ é‚£ä¹ˆåªè¦å–å‡ºé”®çš„å€¼ï¼ˆä¸€ä¸ªé“¾è¡¨ï¼‰ï¼Œ ç„¶åŽå¯¹é“¾è¡¨è¿›è¡ŒéåŽ†å³å¯ã€‚ WATCH çš„è§¦å‘ åœ¨ä»»ä½•å¯¹æ•°æ®åº“é”®ç©ºé—´ï¼ˆkey spaceï¼‰è¿›è¡Œä¿®æ”¹çš„å‘½ä»¤æˆåŠŸæ‰§è¡Œä¹‹åŽ ï¼ˆæ¯”å¦‚ FLUSHDB ã€ SET ã€ DEL ã€ LPUSH ã€ SADD ã€ ZREM ï¼Œè¯¸å¦‚æ­¤ç±»ï¼‰ï¼Œ multi.c/touchWatchedKey å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ â€”â€” å®ƒæ£€æŸ¥æ•°æ®åº“çš„ watched_keys å­—å…¸ï¼Œ çœ‹æ˜¯å¦æœ‰å®¢æˆ·ç«¯åœ¨ç›‘è§†å·²ç»è¢«å‘½ä»¤ä¿®æ”¹çš„é”®ï¼Œ å¦‚æžœæœ‰çš„è¯ï¼Œ ç¨‹åºå°†æ‰€æœ‰ç›‘è§†è¿™ä¸ª/è¿™äº›è¢«ä¿®æ”¹é”®çš„å®¢æˆ·ç«¯çš„ REDIS_DIRTY_CAS é€‰é¡¹æ‰“å¼€ï¼š å½“å®¢æˆ·ç«¯å‘é€ EXEC å‘½ä»¤ã€è§¦å‘äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œ æœåŠ¡å™¨ä¼šå¯¹å®¢æˆ·ç«¯çš„çŠ¶æ€è¿›è¡Œæ£€æŸ¥ï¼š å¦‚æžœå®¢æˆ·ç«¯çš„ REDIS_DIRTY_CAS é€‰é¡¹å·²ç»è¢«æ‰“å¼€ï¼Œé‚£ä¹ˆè¯´æ˜Žè¢«å®¢æˆ·ç«¯ç›‘è§†çš„é”®è‡³å°‘æœ‰ä¸€ä¸ªå·²ç»è¢«ä¿®æ”¹äº†ï¼Œäº‹åŠ¡çš„å®‰å…¨æ€§å·²ç»è¢«ç ´åã€‚æœåŠ¡å™¨ä¼šæ”¾å¼ƒæ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ï¼Œç›´æŽ¥å‘å®¢æˆ·ç«¯è¿”å›žç©ºå›žå¤ï¼Œè¡¨ç¤ºäº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚ å¦‚æžœ REDIS_DIRTY_CAS é€‰é¡¹æ²¡æœ‰è¢«æ‰“å¼€ï¼Œé‚£ä¹ˆè¯´æ˜Žæ‰€æœ‰ç›‘è§†é”®éƒ½å®‰å…¨ï¼ŒæœåŠ¡å™¨æ­£å¼æ‰§è¡Œäº‹åŠ¡ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ•°æ®åº“çš„ watched_keys å­—å…¸å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æžœæŸä¸ªå®¢æˆ·ç«¯å¯¹ key1 è¿›è¡Œäº†ä¿®æ”¹ï¼ˆæ¯”å¦‚æ‰§è¡Œ DEL key1 ï¼‰ï¼Œ é‚£ä¹ˆæ‰€æœ‰ç›‘è§† key1 çš„å®¢æˆ·ç«¯ï¼Œ åŒ…æ‹¬ client2 ã€ client5 å’Œ client1 çš„ REDIS_DIRTY_CAS é€‰é¡¹éƒ½ä¼šè¢«æ‰“å¼€ï¼Œ å½“å®¢æˆ·ç«¯ client2 ã€ client5 å’Œ client1 æ‰§è¡Œ EXEC çš„æ—¶å€™ï¼Œ å®ƒä»¬çš„äº‹åŠ¡éƒ½ä¼šä»¥å¤±è´¥å‘Šç»ˆã€‚ æœ€åŽï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯ç»“æŸå®ƒçš„äº‹åŠ¡æ—¶ï¼Œæ— è®ºäº‹åŠ¡æ˜¯æˆåŠŸæ‰§è¡Œï¼Œè¿˜æ˜¯å¤±è´¥ï¼Œ watched_keys å­—å…¸ä¸­å’Œè¿™ä¸ªå®¢æˆ·ç«¯ç›¸å…³çš„èµ„æ–™éƒ½ä¼šè¢«æ¸…é™¤ã€‚ äº‹åŠ¡çš„ ACID æ€§è´¨ Redis äº‹åŠ¡ä¿è¯äº†å…¶ä¸­çš„ä¸€è‡´æ€§ï¼ˆå¶å°”ä¹Ÿæœ‰å¯èƒ½ä¸ä¸€è‡´ï¼‰å’Œéš”ç¦»æ€§ï¼Œä½†å¹¶ä¸ä¿è¯åŽŸå­æ€§å’ŒæŒä¹…æ€§ã€‚ åŽŸå­æ€§ï¼ˆAtomicityï¼‰ å•ä¸ª Redis å‘½ä»¤çš„æ‰§è¡Œæ˜¯åŽŸå­æ€§çš„ï¼Œä½† Redis æ²¡æœ‰åœ¨äº‹åŠ¡ä¸Šå¢žåŠ ä»»ä½•ç»´æŒåŽŸå­æ€§çš„æœºåˆ¶ï¼Œæ‰€ä»¥ Redis äº‹åŠ¡çš„æ‰§è¡Œå¹¶ä¸æ˜¯åŽŸå­æ€§çš„ã€‚ å¦‚æžœä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½è¢«æˆåŠŸåœ°æ‰§è¡Œï¼Œé‚£ä¹ˆç§°è¿™ä¸ªäº‹åŠ¡æ‰§è¡ŒæˆåŠŸã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æžœ Redis æœåŠ¡å™¨è¿›ç¨‹åœ¨æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­è¢«åœæ­¢ â€”â€” æ¯”å¦‚æŽ¥åˆ° KILL ä¿¡å·ã€å®¿ä¸»æœºå™¨åœæœºï¼Œç­‰ç­‰ï¼Œé‚£ä¹ˆäº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚ å½“äº‹åŠ¡å¤±è´¥æ—¶ï¼ŒRedis ä¹Ÿä¸ä¼šè¿›è¡Œä»»ä½•çš„é‡è¯•æˆ–è€…å›žæ»šåŠ¨ä½œã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ Redis çš„ä¸€è‡´æ€§é—®é¢˜å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†æ¥è®¨è®ºï¼šå…¥é˜Ÿé”™è¯¯ã€æ‰§è¡Œé”™è¯¯ã€Redis è¿›ç¨‹è¢«ç»ˆç»“ã€‚ å‰é¢ä¸¤è€…ä¸Šé¢å·²ç»è®¨è®ºè¿‡äº†ï¼Œè¿™é‡Œå†é‡å¤ä¸€ä¸‹. å…¥é˜Ÿé”™è¯¯ å…¥é˜Ÿé”™è¯¯ä¸€èˆ¬æ˜¯é”™è¯¯çš„å‘½ä»¤(ä¸è€ƒè™‘èƒ½ä¸èƒ½æ‰§è¡Œï¼Œå‘½ä»¤æœ¬èº«å°±æ˜¯é”™è¯¯çš„)ï¼Œå¸¦æœ‰ä¸æ­£ç¡®å…¥é˜Ÿå‘½ä»¤çš„äº‹åŠ¡ä¸ä¼šè¢«æ‰§è¡Œï¼Œä¹Ÿä¸ä¼šå½±å“æ•°æ®åº“çš„ä¸€è‡´æ€§ï¼› æ‰§è¡Œé”™è¯¯ å¦‚æžœå‘½ä»¤åœ¨äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œæ¯”å¦‚è¯´ï¼Œå¯¹ä¸€ä¸ªä¸åŒç±»åž‹çš„ key æ‰§è¡Œäº†é”™è¯¯çš„æ“ä½œï¼Œ é‚£ä¹ˆ Redis åªä¼šå°†é”™è¯¯åŒ…å«åœ¨äº‹åŠ¡çš„ç»“æžœä¸­ï¼Œ è¿™ä¸ä¼šå¼•èµ·äº‹åŠ¡ä¸­æ–­æˆ–æ•´ä¸ªå¤±è´¥ï¼Œä¸ä¼šå½±å“å·²æ‰§è¡Œäº‹åŠ¡å‘½ä»¤çš„ç»“æžœï¼Œä¹Ÿä¸ä¼šå½±å“åŽé¢è¦æ‰§è¡Œçš„äº‹åŠ¡å‘½ä»¤ï¼Œ æ‰€ä»¥å®ƒå¯¹äº‹åŠ¡çš„ä¸€è‡´æ€§ä¹Ÿæ²¡æœ‰å½±å“ã€‚ Redis è¿›ç¨‹è¢«ç»ˆç»“ å¦‚æžœ Redis æœåŠ¡å™¨è¿›ç¨‹åœ¨æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­è¢«å…¶ä»–è¿›ç¨‹ç»ˆç»“ï¼Œæˆ–è€…è¢«ç®¡ç†å‘˜å¼ºåˆ¶æ€æ­»ï¼Œé‚£ä¹ˆæ ¹æ® Redis æ‰€ä½¿ç”¨çš„æŒä¹…åŒ–æ¨¡å¼ï¼Œå¯èƒ½æœ‰ä»¥ä¸‹æƒ…å†µå‡ºçŽ°ï¼š å†…å­˜æ¨¡å¼ï¼šå¦‚æžœ Redis æ²¡æœ‰é‡‡å–ä»»ä½•æŒä¹…åŒ–æœºåˆ¶ï¼Œé‚£ä¹ˆé‡å¯ä¹‹åŽçš„æ•°æ®åº“æ€»æ˜¯ç©ºç™½çš„ï¼Œæ‰€ä»¥æ•°æ®æ€»æ˜¯ä¸€è‡´çš„ã€‚ RDB æ¨¡å¼ï¼šåœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼ŒRedis ä¸ä¼šä¸­æ–­äº‹åŠ¡åŽ»æ‰§è¡Œä¿å­˜ RDB çš„å·¥ä½œï¼Œåªæœ‰åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹åŽï¼Œä¿å­˜ RDB çš„å·¥ä½œæ‰æœ‰å¯èƒ½å¼€å§‹ã€‚æ‰€ä»¥å½“ RDB æ¨¡å¼ä¸‹çš„ Redis æœåŠ¡å™¨è¿›ç¨‹åœ¨äº‹åŠ¡ä¸­é€”è¢«æ€æ­»æ—¶ï¼Œäº‹åŠ¡å†…æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸ç®¡æˆåŠŸäº†å¤šå°‘ï¼Œéƒ½ä¸ä¼šè¢«ä¿å­˜åˆ° RDB æ–‡ä»¶é‡Œã€‚æ‰€ä»¥æ˜¾ç„¶ä¼šé€ æˆä¸ä¸€è‡´ AOF æ¨¡å¼ï¼šå› ä¸ºä¿å­˜ AOF æ–‡ä»¶çš„å·¥ä½œåœ¨åŽå°çº¿ç¨‹è¿›è¡Œï¼Œæ‰€ä»¥å³ä½¿æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œçš„ä¸­é€”ï¼Œä¿å­˜ AOF æ–‡ä»¶çš„å·¥ä½œä¹Ÿå¯ä»¥ç»§ç»­è¿›è¡Œ,å¦‚æžœäº‹åŠ¡è¯­å¥æœªå†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œé‚£ä¹ˆæ˜¾ç„¶æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºäº‹åŠ¡é‡Œçš„æ“ä½œå…¨éƒ¨å¤±è´¥ï¼›å¦‚æžœäº‹åŠ¡çš„éƒ¨åˆ†è¯­å¥è¢«å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œå¹¶ä¸” AOF æ–‡ä»¶è¢«æˆåŠŸä¿å­˜ï¼Œé‚£ä¹ˆä¸å®Œæ•´çš„äº‹åŠ¡æ‰§è¡Œä¿¡æ¯å°±ä¼šé—ç•™åœ¨ AOF æ–‡ä»¶é‡Œï¼Œå½“é‡å¯ Redis æ—¶ï¼Œç¨‹åºä¼šæ£€æµ‹åˆ° AOF æ–‡ä»¶å¹¶ä¸å®Œæ•´ï¼ŒRedis ä¼šé€€å‡ºï¼Œå¹¶æŠ¥å‘Šé”™è¯¯ã€‚éœ€è¦ä½¿ç”¨ redis-check-aof å·¥å…·å°†éƒ¨åˆ†æˆåŠŸçš„äº‹åŠ¡å‘½ä»¤ç§»é™¤ä¹‹åŽï¼Œæ‰èƒ½å†æ¬¡å¯åŠ¨æœåŠ¡å™¨ã€‚è¿˜åŽŸä¹‹åŽçš„æ•°æ®æ€»æ˜¯ä¸€è‡´çš„ï¼Œè€Œä¸”æ•°æ®ä¹Ÿæ˜¯æœ€æ–°çš„ï¼ˆç›´åˆ°äº‹åŠ¡æ‰§è¡Œä¹‹å‰ä¸ºæ­¢ï¼‰ã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰ Redis æ˜¯å•è¿›ç¨‹ç¨‹åºï¼Œå¹¶ä¸”å®ƒä¿è¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œä¸ä¼šå¯¹äº‹åŠ¡è¿›è¡Œä¸­æ–­ï¼Œäº‹åŠ¡å¯ä»¥è¿è¡Œç›´åˆ°æ‰§è¡Œå®Œæ‰€æœ‰äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒRedis çš„äº‹åŠ¡æ˜¯æ€»æ˜¯å¸¦æœ‰éš”ç¦»æ€§çš„ã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰ åœ¨å•çº¯çš„å†…å­˜æ¨¡å¼ä¸‹ï¼Œäº‹åŠ¡è‚¯å®šæ˜¯ä¸æŒä¹…çš„ã€‚ åœ¨ RDB æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å™¨å¯èƒ½åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹åŽã€RDB æ–‡ä»¶æ›´æ–°ä¹‹å‰çš„è¿™æ®µæ—¶é—´å®•æœºï¼Œæ‰€ä»¥ RDB æ¨¡å¼ä¸‹çš„ Redis äº‹åŠ¡ä¹Ÿæ˜¯ä¸æŒä¹…çš„ã€‚ åœ¨ AOF çš„â€œæ€»æ˜¯ SYNC â€æ¨¡å¼ä¸‹ï¼Œäº‹åŠ¡çš„æ¯æ¡å‘½ä»¤åœ¨æ‰§è¡ŒæˆåŠŸä¹‹åŽï¼Œéƒ½ä¼šç«‹å³è°ƒç”¨ fsync æˆ– fdatasync å°†äº‹åŠ¡æ•°æ®å†™å…¥åˆ° AOF æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™ç§ä¿å­˜æ˜¯ç”±åŽå°çº¿ç¨‹è¿›è¡Œçš„ï¼Œä¸»çº¿ç¨‹ä¸ä¼šé˜»å¡žç›´åˆ°ä¿å­˜æˆåŠŸï¼Œæ‰€ä»¥ä»Žå‘½ä»¤æ‰§è¡ŒæˆåŠŸåˆ°æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¹‹é—´ï¼Œè¿˜æ˜¯æœ‰ä¸€æ®µéžå¸¸å°çš„é—´éš”ï¼ŒæœåŠ¡å™¨ä¹Ÿæœ‰å¯èƒ½å‡ºçŽ°é—®é¢˜ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼ä¸‹çš„äº‹åŠ¡ä¹Ÿæ˜¯ä¸æŒä¹…çš„ã€‚ éƒ½æ˜¯ä¸æŒä¹…çš„ã€‚ æ€»ç»“ MULTI å‘½ä»¤çš„æ‰§è¡Œæ ‡è®°ç€äº‹åŠ¡çš„å¼€å§‹ å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åŽï¼Œ æœåŠ¡å™¨åœ¨æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤æ—¶ï¼Œ ä¸ä¼šç«‹å³æ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯å°†è¿™äº›å‘½ä»¤å…¨éƒ¨æ”¾è¿›ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—é‡Œï¼Œ ç„¶åŽè¿”å›ž QUEUED ï¼Œ è¡¨ç¤ºå‘½ä»¤å·²å…¥é˜Ÿ Redis çš„äº‹åŠ¡ä¿è¯äº† ACID ä¸­çš„ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼ˆå¶å°”ä¹Ÿæœ‰å¯èƒ½ä¸ä¸€è‡´ï¼‰å’Œéš”ç¦»æ€§ï¼ˆIï¼‰ï¼Œä½†å¹¶ä¸ä¿è¯åŽŸå­æ€§ï¼ˆAï¼‰å’ŒæŒä¹…æ€§ï¼ˆDï¼‰ã€‚ ä¸åŠ å…¥åˆ°äº‹åŠ¡é˜Ÿåˆ—è€Œç›´æŽ¥æ‰§è¡Œçš„å››ä¸ªå‘½ä»¤ä¸ºï¼šEXEC ã€ DISCARD ã€ MULTI å’Œ WATCH DISCARD å‘½ä»¤ç”¨äºŽå–æ¶ˆä¸€ä¸ªäº‹åŠ¡ Redis çš„äº‹åŠ¡æ˜¯ä¸å¯åµŒå¥—çš„ WATCH åªèƒ½åœ¨å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹å‰æ‰§è¡Œ WATCHæœºåˆ¶çš„åŽŸç† å‚è€ƒï¼š äº‹åŠ¡ redisçš„äº‹åŠ¡å’Œwatch]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisç¼“å­˜æ›´æ–°]]></title>
    <url>%2F2019%2F02%2F02%2Fredis%2FRedis%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬åç¯‡æ–‡ç« ã€‚redisç¼“å­˜æ›´æ–°ç­–ç•¥å­¦ä¹ ã€‚ æ›´æ–°ç¼“å­˜çš„çš„Design Patternæœ‰å››ç§ï¼šCache aside, Read through, Write through, Write behind cachingï¼Œæˆ‘ä»¬ä¸‹é¢ä¸€ä¸€æ¥çœ‹ä¸€ä¸‹è¿™å››ç§Patternã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆä¸è®¨è®ºæ›´æ–°ç¼“å­˜å’Œæ›´æ–°æ•°æ®è¿™ä¸¤ä¸ªäº‹æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„äº‹ï¼Œæˆ–æ˜¯ä¼šæœ‰å¤±è´¥çš„å¯èƒ½ï¼Œæˆ‘ä»¬å…ˆå‡è®¾æ›´æ–°æ•°æ®åº“å’Œæ›´æ–°ç¼“å­˜éƒ½å¯ä»¥æˆåŠŸçš„æƒ…å†µï¼ˆæˆ‘ä»¬å…ˆæŠŠæˆåŠŸçš„ä»£ç é€»è¾‘å…ˆå†™å¯¹ï¼‰ã€‚ å…ˆæ¥çœ‹çœ‹ç¼“å­˜å¯èƒ½å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œç›®çš„æ˜¯çªå‡ºç¼“å­˜ä½¿ç”¨ç­–ç•¥é€‰æ‹©çš„é‡è¦æ€§ã€‚ 1.ç¼“å­˜ç©¿é€ ç¼“å­˜ç©¿é€æ˜¯è¯´è®¿é—®ä¸€ä¸ªç¼“å­˜ä¸­æ²¡æœ‰çš„æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ã€‚ è§£å†³æ–¹æ¡ˆæ˜¯ï¼š ç¼“å­˜ç©ºå¯¹è±¡ã€‚å¦‚æžœç¼“å­˜æœªå‘½ä¸­ï¼Œè€Œæ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰è¿™ä¸ªå¯¹è±¡ï¼Œåˆ™å¯ä»¥ç¼“å­˜ä¸€ä¸ªç©ºå¯¹è±¡åˆ°ç¼“å­˜ã€‚å¦‚æžœä½¿ç”¨Redisï¼Œè¿™ç§keyéœ€è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„æ—¶é—´ï¼Œä»¥é˜²å†…å­˜æµªè´¹ã€‚ ç¼“å­˜é¢„æµ‹ã€‚é¢„æµ‹keyæ˜¯å¦å­˜åœ¨ã€‚å¦‚æžœç¼“å­˜çš„é‡ä¸å¤§å¯ä»¥ä½¿ç”¨hashæ¥åˆ¤æ–­ï¼Œå¦‚æžœé‡å¤§å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥åšåˆ¤æ–­ã€‚é‡‡ç”¨å¸ƒéš†ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„BitSetä¸­ï¼Œä¸å­˜åœ¨çš„æ•°æ®å°†ä¼šè¢«æ‹¦æˆªæŽ‰ï¼Œä»Žè€Œé¿å…äº†å¯¹å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢åŽ‹åŠ›ã€‚ 2.ç¼“å­˜å¹¶å‘ å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®ä¸€ä¸ªæ²¡æœ‰åœ¨cacheä¸­çš„æ•°æ®ï¼Œè¿™æ—¶æ¯ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šæ‰§è¡Œä»ŽDBåŠ è½½æ•°æ®setåˆ°ç¼“å­˜ï¼Œå°±ä¼šé€ æˆç¼“å­˜å¹¶å‘ã€‚ ç¼“å­˜é¢„çƒ­ã€‚æå‰æŠŠæ‰€æœ‰é¢„æœŸçš„çƒ­æ•°æ®åŠ åˆ°ç¼“å­˜ã€‚å®šä½çƒ­æ•°æ®è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„äº‹æƒ…ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„æœåŠ¡è®¿é—®æƒ…å†µåŽ»è¯„ä¼°ã€‚è¿™ä¸ªæ–¹æ¡ˆåªèƒ½å‡è½»ç¼“å­˜å¹¶å‘çš„å‘ç”Ÿæ¬¡æ•°ä¸èƒ½å…¨éƒ¨æŠµåˆ¶ã€‚ ç¼“å­˜åŠ é”ã€‚ å¦‚æžœå¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ä¸å­˜åœ¨çš„ç¼“å­˜æ—¶ï¼Œåœ¨æ‰§è¡ŒåŠ è½½æ•°æ®å¹¶setç¼“å­˜è¿™ä¸ªé€»è¾‘ä¹‹å‰å…ˆåŠ é”ï¼Œåªèƒ½è®©ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œè¿™æ®µé€»è¾‘ã€‚ 3.ç¼“å­˜é›ªå´© ç¼“å­˜é›ªå´©æ˜¯ç¼“å­˜æœåŠ¡æš‚æ—¶ä¸èƒ½æä¾›æœåŠ¡ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½ç›´æŽ¥è®¿é—®DBã€‚ è§£å†³æ–¹æ¡ˆï¼š æž„å»ºé«˜å¯ç”¨çš„ç¼“å­˜ç³»ç»Ÿã€‚ç›®å‰å¸¸ç”¨çš„ç¼“å­˜ç³»ç»ŸRediså’ŒMemcacheéƒ½æ”¯æŒé«˜å¯ç”¨çš„éƒ¨ç½²æ–¹å¼ï¼Œæ‰€ä»¥éƒ¨ç½²çš„æ—¶å€™ä¸é˜²å…ˆè€ƒè™‘æ˜¯å¦è¦ä»¥é«˜å¯ç”¨çš„é›†ç¾¤æ–¹å¼éƒ¨ç½²ã€‚ é™æµã€‚Netflixçš„Hystrixæ˜¯éžå¸¸ä¸é”™çš„å·¥å…·ï¼Œåœ¨ç”¨ç¼“å­˜æ—¶ä¸å¦¨æ­é…å®ƒæ¥ä½¿ç”¨ã€‚ 4.Cache Aside Pattern ä¸€ç§é”™è¯¯çš„åšæ³•æ˜¯ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œç„¶åŽå†æ›´æ–°æ•°æ®åº“ï¼Œè€ŒåŽç»­çš„æ“ä½œä¼šæŠŠæ•°æ®å†è£…è½½çš„ç¼“å­˜ä¸­ã€‚è¯•æƒ³ï¼Œä¸¤ä¸ªå¹¶å‘æ“ä½œï¼Œä¸€ä¸ªæ˜¯æ›´æ–°æ“ä½œï¼Œå¦ä¸€ä¸ªæ˜¯æŸ¥è¯¢æ“ä½œï¼Œæ›´æ–°æ“ä½œåˆ é™¤ç¼“å­˜åŽï¼ŒæŸ¥è¯¢æ“ä½œæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œå…ˆæŠŠè€æ•°æ®è¯»å‡ºæ¥åŽæ”¾åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åŽæ›´æ–°æ“ä½œæ›´æ–°äº†æ•°æ®åº“ã€‚äºŽæ˜¯ï¼Œåœ¨ç¼“å­˜ä¸­çš„æ•°æ®è¿˜æ˜¯è€çš„æ•°æ®ï¼Œå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯è„çš„ï¼Œç›´åˆ°è¿™ä¸ªç¼“å­˜å¤±æ•ˆä¸ºæ­¢ã€‚ Cache Aside Patternæ˜¯æœ€å¸¸ç”¨æœ€å¸¸ç”¨çš„patternäº†ã€‚å…¶å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä»Žcacheå–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™ä»Žæ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåŽï¼Œæ”¾åˆ°ç¼“å­˜ä¸­ã€‚ å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä»Žcacheä¸­å–æ•°æ®ï¼Œå–åˆ°åŽè¿”å›žã€‚ æ›´æ–°ï¼šå…ˆæŠŠæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒæˆåŠŸåŽï¼Œå†è®©ç¼“å­˜å¤±æ•ˆã€‚ æ³¨æ„ï¼Œæˆ‘ä»¬çš„æ›´æ–°æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼ŒæˆåŠŸåŽï¼Œè®©ç¼“å­˜å¤±æ•ˆã€‚é‚£ä¹ˆï¼Œè¿™ç§æ–¹å¼æ˜¯å¦å¯ä»¥æ²¡æœ‰æ–‡ç« å‰é¢æåˆ°è¿‡çš„é‚£ä¸ªé—®é¢˜å‘¢ï¼Ÿ ä¸€ä¸ªæ˜¯æŸ¥è¯¢æ“ä½œï¼Œä¸€ä¸ªæ˜¯æ›´æ–°æ“ä½œçš„å¹¶å‘ï¼Œé¦–å…ˆï¼Œæ²¡æœ‰äº†åˆ é™¤cacheæ•°æ®çš„æ“ä½œäº†ï¼Œè€Œæ˜¯å…ˆæ›´æ–°äº†æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæ­¤æ—¶ï¼Œç¼“å­˜ä¾ç„¶æœ‰æ•ˆï¼Œæ‰€ä»¥ï¼Œå¹¶å‘çš„æŸ¥è¯¢æ“ä½œæ‹¿çš„æ˜¯æ²¡æœ‰æ›´æ–°çš„æ•°æ®ï¼Œä½†æ˜¯ï¼Œæ›´æ–°æ“ä½œé©¬ä¸Šè®©ç¼“å­˜çš„å¤±æ•ˆäº†ï¼ŒåŽç»­çš„æŸ¥è¯¢æ“ä½œå†æŠŠæ•°æ®ä»Žæ•°æ®åº“ä¸­æ‹‰å‡ºæ¥ã€‚è€Œä¸ä¼šåƒæ–‡ç« å¼€å¤´çš„é‚£ä¸ªé€»è¾‘äº§ç”Ÿçš„é—®é¢˜ï¼ŒåŽç»­çš„æŸ¥è¯¢æ“ä½œä¸€ç›´éƒ½åœ¨å–è€çš„æ•°æ®ã€‚ ä½†è¿˜æ˜¯å­˜åœ¨é—®é¢˜çš„ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæ˜¯è¯»æ“ä½œï¼Œä½†æ˜¯æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œç„¶åŽå°±åˆ°æ•°æ®åº“ä¸­å–æ•°æ®ï¼Œæ­¤æ—¶æ¥äº†ä¸€ä¸ªå†™æ“ä½œï¼Œå†™å®Œæ•°æ®åº“åŽï¼Œè®©ç¼“å­˜å¤±æ•ˆï¼Œç„¶åŽï¼Œä¹‹å‰çš„é‚£ä¸ªè¯»æ“ä½œå†æŠŠè€çš„æ•°æ®æ”¾è¿›åŽ»ï¼Œæ‰€ä»¥ï¼Œä¼šé€ æˆè„æ•°æ®ã€‚ä¸è¿‡ï¼Œå®žé™…ä¸Šå‡ºçŽ°çš„æ¦‚çŽ‡å¯èƒ½éžå¸¸ä½Ž. æ‰€ä»¥ï¼Œè¿™ä¹Ÿå°±æ˜¯Quoraä¸Šçš„é‚£ä¸ªç­”æ¡ˆé‡Œè¯´çš„ï¼Œè¦ä¹ˆé€šè¿‡2PCæˆ–æ˜¯Paxosåè®®ä¿è¯ä¸€è‡´æ€§ï¼Œè¦ä¹ˆå°±æ˜¯æ‹¼å‘½çš„é™ä½Žå¹¶å‘æ—¶è„æ•°æ®çš„æ¦‚çŽ‡ï¼Œè€ŒFacebookä½¿ç”¨äº†è¿™ä¸ªé™ä½Žæ¦‚çŽ‡çš„çŽ©æ³•ï¼Œå› ä¸º2PCå¤ªæ…¢ï¼Œè€ŒPaxoså¤ªå¤æ‚ã€‚å½“ç„¶ï¼Œæœ€å¥½è¿˜æ˜¯ä¸ºç¼“å­˜è®¾ç½®ä¸Šè¿‡æœŸæ—¶é—´ã€‚ 5.Read/Write Through Pattern Read Throughï¼šè¯»å–æ•°æ®çš„æ—¶å€™å¦‚æžœå½“å‰ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œæƒ¯å¸¸çš„æ“ä½œéƒ½æ˜¯åº”ç”¨ç¨‹åºåŽ»DBåŠ è½½æ•°æ®ï¼Œç„¶åŽåŠ å…¥åˆ°ç¼“å­˜ä¸­ã€‚Read Throughä¸Žä¹‹ä¸åŒçš„æ˜¯æˆ‘ä»¬ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºè‡ªå·±åŠ è½½æ•°æ®äº†ï¼Œç¼“å­˜å±‚ä¼šå¸®å¿™åšä»¶äº‹ã€‚ Write Throughï¼šæ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æžœå‘½ä¸­ç¼“å­˜ï¼Œåˆ™å…ˆæ›´æ–°ç¼“å­˜ç„¶åŽç¼“å­˜åœ¨è´Ÿè´£æŠŠæ•°æ®æ›´æ–°åˆ°æ•°æ®åº“ï¼›å¦‚æžœæ²¡æœ‰å‘½ä¸­ç¼“å­˜åˆ™ç›´æŽ¥æ›´æ–°æ•°æ®åº“ã€‚ è¿™ç§æ–¹å¼ç¼“å­˜å±‚ç›´æŽ¥å±è”½äº†DBï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦æ›´ç¼“å­˜æ‰“äº¤é“ã€‚ä¼˜ç‚¹æ˜¯åº”ç”¨é€»è¾‘ç®€å•äº†ï¼Œè€Œä¸”æ›´é«˜æ•ˆäº†ï¼›ç¼ºç‚¹æ˜¯ç¼“å­˜å±‚çš„å®žçŽ°ç›¸å¯¹å¤æ‚ä¸€äº›ã€‚ 6.Write Back Pattern Write Backå¥—è·¯ï¼Œä¸€å¥è¯´å°±æ˜¯ï¼Œåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªæ›´æ–°ç¼“å­˜ï¼Œä¸æ›´æ–°æ•°æ®åº“ï¼Œè€Œæˆ‘ä»¬çš„ç¼“å­˜ä¼šå¼‚æ­¥åœ°æ‰¹é‡æ›´æ–°æ•°æ®åº“ã€‚è¿™ä¸ªè®¾è®¡çš„å¥½å¤„å°±æ˜¯è®©æ•°æ®çš„I/Oæ“ä½œé£žå¿«æ— æ¯”ï¼ˆå› ä¸ºç›´æŽ¥æ“ä½œå†…å­˜å˜› ï¼‰ï¼Œå› ä¸ºå¼‚æ­¥ï¼Œwrite backgè¿˜å¯ä»¥åˆå¹¶å¯¹åŒä¸€ä¸ªæ•°æ®çš„å¤šæ¬¡æ“ä½œï¼Œæ‰€ä»¥æ€§èƒ½çš„æé«˜æ˜¯ç›¸å½“å¯è§‚çš„ã€‚ ä½†æ˜¯ï¼Œå…¶å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œæ•°æ®ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œè€Œä¸”å¯èƒ½ä¼šä¸¢å¤±ï¼ˆæˆ‘ä»¬çŸ¥é“Unix/Linuxéžæ­£å¸¸å…³æœºä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªäº‹ï¼‰ã€‚åœ¨è½¯ä»¶è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šä¸å¯èƒ½åšå‡ºä¸€ä¸ªæ²¡æœ‰ç¼ºé™·çš„è®¾è®¡ï¼Œå°±åƒç®—æ³•è®¾è®¡ä¸­çš„æ—¶é—´æ¢ç©ºé—´ï¼Œç©ºé—´æ¢æ—¶é—´ä¸€ä¸ªé“ç†ï¼Œæœ‰æ—¶å€™ï¼Œå¼ºä¸€è‡´æ€§å’Œé«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨å’Œé«˜æ€§æ€§æ˜¯æœ‰å†²çªçš„ã€‚ å¦å¤–ï¼ŒWrite Backå®žçŽ°é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºä»–éœ€è¦trackæœ‰å“ªæ•°æ®æ˜¯è¢«æ›´æ–°äº†çš„ï¼Œéœ€è¦åˆ·åˆ°æŒä¹…å±‚ä¸Šã€‚æ“ä½œç³»ç»Ÿçš„write backä¼šåœ¨ä»…å½“è¿™ä¸ªcacheéœ€è¦å¤±æ•ˆçš„æ—¶å€™ï¼Œæ‰ä¼šè¢«çœŸæ­£æŒä¹…èµ·æ¥ï¼Œæ¯”å¦‚ï¼Œå†…å­˜ä¸å¤Ÿäº†ï¼Œæˆ–æ˜¯è¿›ç¨‹é€€å‡ºäº†ç­‰æƒ…å†µï¼Œè¿™åˆå«lazy writeã€‚ 7.å®žé™…ä½¿ç”¨çš„ä¸€äº›ç­–ç•¥ ä¸šåŠ¡æ–¹ï¼ˆè°ƒç”¨è€…ï¼‰æ›´æ–° ä¼ ç»Ÿä¸Šï¼Œæ›´æ–°ç¼“å­˜éƒ½æ˜¯ç”±ä¸šåŠ¡æ–¹æ¥åšï¼Œä¹Ÿå°±æ˜¯ç”±è°ƒç”¨è€…è´Ÿè´£æ›´æ–°DBå’Œç¼“å­˜ã€‚ DBä¸­é—´ä»¶ç›‘å¬DBå˜åŒ–ï¼Œæ›´æ–°ç¼“å­˜ çŽ°åœ¨æœ‰ç§æ–°çš„åŠžæ³•å°±æ˜¯åˆ©ç”¨DBä¸­é—´ä»¶ç›‘å¬DBå˜åŒ–ï¼ˆæ¯”å¦‚é˜¿é‡Œçš„Canalä¸­é—´ä»¶ï¼Œç‚¹è¯„çš„Pumaï¼‰ï¼Œä»Žè€Œå¯¹ç¼“å­˜è¿›è¡Œæ›´æ–°ã€‚ è¿™ç§åŠžæ³•çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼šæŠŠç¼“å­˜çš„æ›´æ–°é€»è¾‘ï¼Œå’Œä¸šåŠ¡é€»è¾‘è§£è—•ã€‚ä¸šåŠ¡åªæ›´æ–°DBï¼Œç¼“å­˜çš„æ›´æ–°è¢«æ”¾åœ¨å¦å¤–ä¸€ä¸ªä¸“é—¨çš„ç³»ç»Ÿé‡Œé¢ã€‚ 8.æ€»ç»“ ä¸€å¥è¯ï¼Œæ— è®ºè°å…ˆè°åŽï¼Œåªè¦æ›´æ–°ç¼“å­˜å’Œæ›´æ–°DBä¸æ˜¯åŽŸå­çš„ï¼Œå°±å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´ã€‚ æ€»ä¹‹ï¼Œåªæ˜¯ä»Žå®žé™…ä¸šåŠ¡æ¥è®²ï¼Œä¸€èˆ¬ç¼“å­˜ä¹Ÿéƒ½æ˜¯ä¿æŒâ€œæœ€ç»ˆä¸€è‡´æ€§â€œï¼Œè€Œä¸æ˜¯å’ŒDBçš„å¼ºä¸€è‡´æ€§ã€‚ å¹¶ä¸”ä¸€èˆ¬å»ºè®®å…ˆæ›´æ–°DBï¼Œå†æ›´æ–°ç¼“å­˜ï¼Œä¼˜å…ˆä¿è¯DBæ•°æ®æ­£ç¡®ã€‚ 9.ä¸€è‡´æ€§é—®é¢˜ ä¸Šé¢ï¼Œæˆ‘ä»¬æ²¡æœ‰è€ƒè™‘ç¼“å­˜ï¼ˆCacheï¼‰å’ŒæŒä¹…å±‚ï¼ˆRepositoryï¼‰çš„æ•´ä½“äº‹åŠ¡çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæ›´æ–°CacheæˆåŠŸï¼Œæ›´æ–°æ•°æ®åº“å¤±è´¥äº†æ€Žä¹ˆå—ï¼Ÿæˆ–æ˜¯åè¿‡æ¥ã€‚å…³äºŽè¿™ä¸ªäº‹ï¼Œå¦‚æžœä½ éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œä½ éœ€è¦ä½¿ç”¨â€œä¸¤é˜¶æ®µæäº¤åè®®â€â€”â€”prepare, commit/rollback.åŽç»­å†æŽ¢è®¨ã€‚ å‚è€ƒ1ï¼šhttps://coolshell.cn/articles/17416.html å‚è€ƒ2ï¼šhttps://www.jianshu.com/p/3c111e4719b8 å‚è€ƒ3ï¼šç¼“å­˜æ›´æ–°ç­–ç•¥/ç¼“å­˜ç©¿é€/ç¼“å­˜é›ªå´©]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisç¼“å­˜è®¾è®¡ä¸Žä¼˜åŒ–]]></title>
    <url>%2F2019%2F02%2F01%2Fredis%2F%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E4%B8%8E%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬ä¹ç¯‡æ–‡ç« ã€‚ä»‹ç»redisç¼“å­˜ä¸­ ä¸€äº›é‡è¦çš„é—®é¢˜ã€‚ 1. ç¼“å­˜æ”¶ç›Šå’Œæˆæœ¬ 1.1 æ”¶ç›Š åŠ é€Ÿè¯»å†™ é™ä½ŽåŽç«¯è´Ÿè½½(é™ä½Žmysqlè´Ÿè½½) 1.2 æˆæœ¬ æ•°æ®ä¸ä¸€è‡´ï¼šç¼“å­˜å±‚å’Œæ•°æ®å±‚æœ‰æ—¶é—´çª—å£ä¸ä¸€è‡´ï¼Œå’Œæ›´æ–°ç­–ç•¥æœ‰å…³ ä»£ç ç»´æŠ¤æˆæœ¬ï¼šå¤šäº†ä¸€å±‚ç¼“å­˜é€»è¾‘ è¿ç»´æˆæœ¬ï¼šä¾‹å¦‚redis cluster 1.3 ä½¿ç”¨åœºæ™¯ é™ä½ŽåŽç«¯è´Ÿè½½ï¼šå¯¹äºŽé«˜æ¶ˆè€—çš„SQLï¼šjoinç»“æžœé›†ã€åˆ†ç»„ç»Ÿè®¡ç»“æžœï¼›å¯¹è¿™äº›ç»“æžœè¿›è¡Œç¼“å­˜ã€‚ åŠ é€Ÿè¯·æ±‚å“åº” å¤§é‡å†™åˆå¹¶ä¸ºæ‰¹é‡å†™ï¼šå¦‚è®¡æ•°å™¨å…ˆredisç´¯åŠ å†æ‰¹é‡å†™å…¥DB 2. ç¼“å­˜çš„æ›´æ–°ç­–ç•¥ LRU/LFU/FIFOç®—æ³•å‰”é™¤ï¼šä¾‹å¦‚maxmemory-policy FIFO(first in first out) å…ˆè¿›å…ˆå‡ºç­–ç•¥ï¼Œæœ€å…ˆè¿›å…¥ç¼“å­˜çš„æ•°æ®åœ¨ç¼“å­˜ç©ºé—´ä¸å¤Ÿçš„æƒ…å†µä¸‹ï¼ˆè¶…å‡ºæœ€å¤§å…ƒç´ é™åˆ¶ï¼‰ä¼šè¢«ä¼˜å…ˆè¢«æ¸…é™¤æŽ‰ï¼Œä»¥è…¾å‡ºæ–°çš„ç©ºé—´æŽ¥å—æ–°çš„æ•°æ®ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒç¼“å­˜å…ƒç´ çš„åˆ›å»ºæ—¶é—´ã€‚åœ¨æ•°æ®å®žæ•ˆæ€§è¦æ±‚åœºæ™¯ä¸‹å¯é€‰æ‹©è¯¥ç±»ç­–ç•¥ï¼Œä¼˜å…ˆä¿éšœæœ€æ–°æ•°æ®å¯ç”¨ã€‚ LFU(less frequently used) æœ€å°‘ä½¿ç”¨ç­–ç•¥ï¼Œæ— è®ºæ˜¯å¦è¿‡æœŸï¼Œæ ¹æ®å…ƒç´ çš„è¢«ä½¿ç”¨æ¬¡æ•°åˆ¤æ–­ï¼Œæ¸…é™¤ä½¿ç”¨æ¬¡æ•°è¾ƒå°‘çš„å…ƒç´ é‡Šæ”¾ç©ºé—´ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒå…ƒç´ çš„hitCountï¼ˆå‘½ä¸­æ¬¡æ•°ï¼‰ã€‚åœ¨ä¿è¯é«˜é¢‘æ•°æ®æœ‰æ•ˆæ€§åœºæ™¯ä¸‹ï¼Œå¯é€‰æ‹©è¿™ç±»ç­–ç•¥ã€‚ LRU(least recently used) æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥ï¼Œæ— è®ºæ˜¯å¦è¿‡æœŸï¼Œæ ¹æ®å…ƒç´ æœ€åŽä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶é—´æˆ³ï¼Œæ¸…é™¤æœ€è¿œä½¿ç”¨æ—¶é—´æˆ³çš„å…ƒç´ é‡Šæ”¾ç©ºé—´ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒå…ƒç´ æœ€è¿‘ä¸€æ¬¡è¢«getä½¿ç”¨æ—¶é—´ã€‚åœ¨çƒ­ç‚¹æ•°æ®åœºæ™¯ä¸‹è¾ƒé€‚ç”¨ï¼Œä¼˜å…ˆä¿è¯çƒ­ç‚¹æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚ è¶…æ—¶å‰”é™¤ï¼šä¾‹å¦‚expire ä¸»åŠ¨æ›´æ–°ï¼šå¼€å‘æŽ§åˆ¶ç”Ÿå‘½å‘¨æœŸï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼Œæ—¶é—´é—´éš”æ¯”è¾ƒçŸ­ï¼‰ ä½Žä¸€è‡´æ€§ï¼šæœ€å¤§å†…å­˜å’Œæ·˜æ±°ç­–ç•¥ é«˜ä¸€è‡´æ€§ï¼šè¶…æ—¶å‰”é™¤å’Œä¸»åŠ¨æ›´æ–°ç»“åˆï¼Œæœ€å¤§å†…å­˜å’Œæ·˜æ±°ç­–ç•¥å…œåº•ã€‚ 3. ç¼“å­˜ç²’åº¦æŽ§åˆ¶ 3.1 ç¼“å­˜ç²’åº¦æŽ§åˆ¶ä¸‰ä¸ªè§’åº¦ é€šç”¨æ€§ï¼šå…¨é‡å±žæ€§æ›´å¥½(æ·»åŠ åˆ é™¤å±žæ€§ä¸éœ€è¦æ”¹ä¸œè¥¿) å ç”¨ç©ºé—´ï¼šéƒ¨åˆ†å±žæ€§æ›´å¥½ ä»£ç ç»´æŠ¤ï¼šè¡¨é¢ä¸Šå…¨é‡å±žæ€§æ›´å¥½(æ·»åŠ åˆ é™¤å±žæ€§ä¸éœ€è¦æ”¹ä¸œè¥¿) 4. ç¼“å­˜ç©¿é€ä¼˜åŒ– 4.1 å®šä¹‰ å¤§é‡è¯·æ±‚ä¸å‘½ä¸­,ç¼“å­˜å·²ç»æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ï¼š 4.2 äº§ç”ŸåŽŸå›  ä¸šåŠ¡ä»£ç è‡ªèº«é—®é¢˜ æ¶æ„æ”»å‡»ã€çˆ¬è™«ç­‰ 4.3 å¦‚ä½•å‘çŽ° ä¸šåŠ¡å“åº”æ—¶é—´ ä¸šåŠ¡æœ¬èº«é—®é¢˜ ç›¸å…³æŒ‡æ ‡ï¼šæ€»è°ƒç”¨æ•°ã€ç¼“å­˜å±‚å‘½ä¸­æ•°ã€å­˜å‚¨å±‚å‘½ä¸­æ•° 4.4 è§£å†³æ–¹æ¡ˆ æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºå¯¹è±¡ å­˜åœ¨çš„é—®é¢˜ éœ€è¦æ›´å¤šçš„é”®:æ¶æ„æ”»å‡»ã€çˆ¬è™«ä¼šæœ‰å¾ˆå¤šä¹±ä¸ƒå…«ç³Ÿçš„é”®ï¼Œå½“é‡å¾ˆå¤§æ—¶ï¼Œä¼šæœ‰é£Žé™©ï¼Œæ‰€ä»¥ä¼šå¯¹è¿™ç§ç©ºå¯¹è±¡è®¾ç½®ç¼“å­˜æ—¶é—´æŽ§åˆ¶é£Žé™© ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚æ•°æ®â€œçŸ­æœŸâ€ä¸ä¸€è‡´ï¼šç¼“å­˜äº†ç©ºå¯¹è±¡ï¼Œä½†æ˜¯å½“ä¸šåŠ¡æ¢å¤äº†ï¼ŒçœŸå®žæ•°æ®åˆå­˜åœ¨äºŽDBä¸­äº†ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªç©ºå¯¹è±¡è¿‡æœŸæ—¶é—´å†…ï¼Œå–åˆ°çš„ä»ç„¶æ˜¯ç©ºå¯¹è±¡ï¼Œé€ æˆçŸ­æœŸå†…æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚è§£å†³ï¼šå¯ä»¥è®¢é˜…æ¶ˆæ¯ï¼Œå½“æ¢å¤æ­£å¸¸åŽæŽ¥å—åˆ°æ¶ˆæ¯ï¼Œç„¶åŽåˆ·æ–°ç¼“å­˜ã€‚ æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆª ä»€ä¹ˆæ˜¯Bloom Filterï¼Ÿ å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„, â€œa space-efficient probabilistic data structureâ€ã€‚å®ƒå®žé™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶çŸ¢é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºŽæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆçŽ‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«çŽ‡å’Œåˆ é™¤å›°éš¾ã€‚ å¦‚æžœæƒ³åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªé›†åˆé‡Œï¼Œä¸€èˆ¬æƒ³åˆ°çš„æ˜¯å°†é›†åˆä¸­æ‰€æœ‰å…ƒç´ ä¿å­˜èµ·æ¥ï¼Œç„¶åŽé€šè¿‡æ¯”è¾ƒç¡®å®šã€‚é“¾è¡¨ã€æ ‘ã€æ•£åˆ—è¡¨ï¼ˆåˆå«å“ˆå¸Œè¡¨ï¼ŒHash tableï¼‰ç­‰ç­‰æ•°æ®ç»“æž„éƒ½æ˜¯è¿™ç§æ€è·¯ã€‚ä½†æ˜¯éšç€é›†åˆä¸­å…ƒç´ çš„å¢žåŠ ï¼Œæˆ‘ä»¬éœ€è¦çš„å­˜å‚¨ç©ºé—´è¶Šæ¥è¶Šå¤§ã€‚åŒæ—¶æ£€ç´¢é€Ÿåº¦ä¹Ÿè¶Šæ¥è¶Šæ…¢ï¼Œä¸Šè¿°ä¸‰ç§ç»“æž„çš„æ£€ç´¢æ—¶é—´å¤æ‚åº¦åˆ†åˆ«ä¸ºO(n),O(log n),O(n/k)ã€‚ å¸ƒéš†è¿‡æ»¤å™¨çš„åŽŸç†æ˜¯ï¼Œå½“ä¸€ä¸ªå…ƒç´ è¢«åŠ å…¥é›†åˆæ—¶ï¼Œé€šè¿‡Kä¸ªæ•£åˆ—å‡½æ•°å°†è¿™ä¸ªå…ƒç´ æ˜ å°„æˆä¸€ä¸ªä½æ•°ç»„ä¸­çš„Kä¸ªç‚¹ï¼ŒæŠŠå®ƒä»¬ç½®ä¸º1ã€‚ ä¼˜ç‚¹ï¼šç›¸æ¯”äºŽå…¶å®ƒçš„æ•°æ®ç»“æž„ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åœ¨ç©ºé—´å’Œæ—¶é—´æ–¹é¢éƒ½æœ‰å·¨å¤§çš„ä¼˜åŠ¿ã€‚å¸ƒéš†è¿‡æ»¤å™¨å­˜å‚¨ç©ºé—´å’Œæ’å…¥/æŸ¥è¯¢æ—¶é—´éƒ½æ˜¯å¸¸æ•°ï¼ˆOï¼ˆkï¼‰ï¼‰ã€‚å¦å¤–, æ•£åˆ—å‡½æ•°ç›¸äº’ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œæ–¹ä¾¿ç”±ç¡¬ä»¶å¹¶è¡Œå®žçŽ°ã€‚å¸ƒéš†è¿‡æ»¤å™¨ä¸éœ€è¦å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œåœ¨æŸäº›å¯¹ä¿å¯†è¦æ±‚éžå¸¸ä¸¥æ ¼çš„åœºåˆæœ‰ä¼˜åŠ¿ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥è¡¨ç¤ºå…¨é›†ï¼Œå…¶å®ƒä»»ä½•æ•°æ®ç»“æž„éƒ½ä¸èƒ½ï¼›kå’Œmç›¸åŒï¼Œä½¿ç”¨åŒä¸€ç»„æ•£åˆ—å‡½æ•°çš„ä¸¤ä¸ªå¸ƒéš†è¿‡æ»¤å™¨çš„äº¤å¹¶å·®è¿ç®—å¯ä»¥ä½¿ç”¨ä½æ“ä½œè¿›è¡Œã€‚ ç¼ºç‚¹ï¼šä½†æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„ç¼ºç‚¹å’Œä¼˜ç‚¹ä¸€æ ·æ˜Žæ˜¾ã€‚è¯¯ç®—çŽ‡æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚éšç€å­˜å…¥çš„å…ƒç´ æ•°é‡å¢žåŠ ï¼Œè¯¯ç®—çŽ‡éšä¹‹å¢žåŠ ã€‚ä½†æ˜¯å¦‚æžœå…ƒç´ æ•°é‡å¤ªå°‘ï¼Œåˆ™ä½¿ç”¨æ•£åˆ—è¡¨è¶³çŸ£ã€‚å¦å¤–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸èƒ½ä»Žå¸ƒéš†è¿‡æ»¤å™¨ä¸­åˆ é™¤å…ƒç´ ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°æŠŠä½æ•°ç»„å˜æˆæ•´æ•°æ•°ç»„ï¼Œæ¯æ’å…¥ä¸€ä¸ªå…ƒç´ ç›¸åº”çš„è®¡æ•°å™¨åŠ 1,è¿™æ ·åˆ é™¤å…ƒç´ æ—¶å°†è®¡æ•°å™¨å‡æŽ‰å°±å¯ä»¥äº†ã€‚ç„¶è€Œè¦ä¿è¯å®‰å…¨åœ°åˆ é™¤å…ƒç´ å¹¶éžå¦‚æ­¤ç®€å•ã€‚é¦–å…ˆæˆ‘ä»¬å¿…é¡»ä¿è¯åˆ é™¤çš„å…ƒç´ çš„ç¡®åœ¨å¸ƒéš†è¿‡æ»¤å™¨é‡Œé¢ã€‚è¿™ä¸€ç‚¹å•å‡­è¿™ä¸ªè¿‡æ»¤å™¨æ˜¯æ— æ³•ä¿è¯çš„ã€‚å¦å¤–è®¡æ•°å™¨å›žç»•ä¹Ÿä¼šé€ æˆé—®é¢˜ã€‚åœ¨é™ä½Žè¯¯ç®—çŽ‡æ–¹é¢ï¼Œæœ‰ä¸å°‘å·¥ä½œï¼Œä½¿å¾—å‡ºçŽ°äº†å¾ˆå¤šå¸ƒéš†è¿‡æ»¤å™¨çš„å˜ç§ã€‚ æ£€ç´¢æ—¶ï¼Œæˆ‘ä»¬åªè¦çœ‹çœ‹è¿™äº›ç‚¹æ˜¯ä¸æ˜¯éƒ½æ˜¯1å°±ï¼ˆå¤§çº¦ï¼‰çŸ¥é“é›†åˆä¸­æœ‰æ²¡æœ‰å®ƒäº†ï¼šå¦‚æžœè¿™äº›ç‚¹æœ‰ä»»ä½•ä¸€ä¸ª0ï¼Œåˆ™è¢«æ£€å…ƒç´ ä¸€å®šä¸åœ¨ï¼›å¦‚æžœéƒ½æ˜¯1ï¼Œåˆ™è¢«æ£€å…ƒç´ å¾ˆå¯èƒ½åœ¨ã€‚è¿™å°±æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„åŸºæœ¬æ€æƒ³ã€‚ Bloom Filteråº”ç”¨åœºæ™¯ï¼Ÿ ç”¨Redisçš„Bitmapä½œä¸ºä½æ•°ç»„æž„å»ºèµ·æ¥çš„å¯æ‰©å±•çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚ Rediså®žçŽ°çš„å¸ƒéš†è¿‡æ»¤å™¨å¦‚ä½•å¿«é€Ÿæœ‰æ•ˆåˆ é™¤æ•°æ®ï¼Ÿï¼šEXPIRE â€œbitmapçš„keyå€¼â€ 0 4.5 è§£å†³æ–¹æ¡ˆå¯¹æ¯” 5. æ— åº•æ´žé—®é¢˜ä¼˜åŒ– 5.1 é—®é¢˜æè¿° 2010å¹´ï¼Œfacebookæœ‰äº†3000ä¸ªMemcacheèŠ‚ç‚¹ å‘çŽ°é—®é¢˜ï¼š&quot;åŠ &quot;æœºå™¨æ€§èƒ½æ²¡èƒ½æå‡ï¼Œåè€Œä¸‹é™ 5.2 é—®é¢˜åŽŸå›  å½“å­˜åœ¨çš„èŠ‚ç‚¹å¼‚å¸¸å¤šçš„æ—¶å€™ï¼ŒIOçš„ä»£ä»·å·²ç»è¶…è¿‡æ•°æ®ä¼ è¾“ï¼Œä¸Šæ–‡æåˆ°çš„facebookçš„èŠ‚ç‚¹å·²ç»è¶…è¿‡3000ä¸ªï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å†å¢žåŠ èŠ‚ç‚¹å·²ç»æ²¡æ³•å†æé«˜æ•ˆçŽ‡äº†ã€‚ 5.3 é—®é¢˜è§£å†³â€”ä¼˜åŒ–IO å‘½ä»¤æœ¬èº«çš„æ•ˆçŽ‡ï¼šä¾‹å¦‚sqlä¼˜åŒ–ï¼Œå‘½ä»¤ä¼˜åŒ– ç½‘ç»œæ¬¡æ•°ï¼šå‡å°‘é€šä¿¡æ¬¡æ•° é™ä½ŽæŽ¥å…¥æˆæœ¬:é•¿è¿ž/è¿žæŽ¥æ± ,NIOç­‰ã€‚ IOè®¿é—®åˆå¹¶:O(n)åˆ°O(1)è¿‡ç¨‹:æ‰¹é‡æŽ¥å£(mget)ï¼Œå°±æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»çš„å¯¹äºŽmgetçš„å››ä¸ªæ–¹æ¡ˆã€‚ 6. ç¼“å­˜é›ªå´©ä¼˜åŒ– 6.1 ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ ä»Žä¸‹å›¾å¯ä»¥å¾ˆæ¸…æ™°å‡ºä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼šç”±äºŽç¼“å­˜å±‚æ‰¿è½½ç€å¤§é‡è¯·æ±‚ï¼Œæœ‰æ•ˆçš„ä¿æŠ¤äº†å­˜å‚¨å±‚ï¼Œä½†æ˜¯å¦‚æžœç¼“å­˜å±‚ç”±äºŽæŸäº›åŽŸå› æ•´ä½“ä¸èƒ½æä¾›æœåŠ¡ï¼ŒäºŽæ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¾¾åˆ°å­˜å‚¨å±‚ï¼Œå­˜å‚¨å±‚çš„è°ƒç”¨é‡ä¼šæš´å¢žï¼Œé€ æˆå­˜å‚¨å±‚ä¹Ÿä¼šæŒ‚æŽ‰çš„æƒ…å†µã€‚ ç¼“å­˜é›ªå´©çš„è‹±æ–‡åŽŸæ„æ˜¯ stampeding herdï¼ˆå¥”é€ƒçš„é‡Žç‰›ï¼‰ï¼ŒæŒ‡çš„æ˜¯ç¼“å­˜å±‚å®•æŽ‰åŽï¼Œæµé‡ä¼šåƒå¥”é€ƒçš„é‡Žç‰›ä¸€æ ·ï¼Œæ‰“å‘åŽç«¯å­˜å‚¨ã€‚ 6.2 å¦‚ä½•é˜²æ­¢ç¼“å­˜é›ªå´©ï¼Ÿ ä¿è¯ç¼“å­˜å±‚æœåŠ¡é«˜å¯ç”¨æ€§ã€‚ å’Œé£žæœºéƒ½æœ‰å¤šä¸ªå¼•æ“Žä¸€æ ·ï¼Œå¦‚æžœç¼“å­˜å±‚è®¾è®¡æˆé«˜å¯ç”¨çš„ï¼Œå³ä½¿ä¸ªåˆ«èŠ‚ç‚¹ã€ä¸ªåˆ«æœºå™¨ã€ç”šè‡³æ˜¯æœºæˆ¿å®•æŽ‰ï¼Œä¾ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œä¾‹å¦‚å‰é¢ä»‹ç»è¿‡çš„ Redis Sentinel å’Œ Redis Cluster éƒ½å®žçŽ°äº†é«˜å¯ç”¨ã€‚ ä¾èµ–éš”ç¦»ç»„ä»¶ä¸ºåŽç«¯é™æµå¹¶é™çº§ æ— è®ºæ˜¯ç¼“å­˜å±‚è¿˜æ˜¯å­˜å‚¨å±‚éƒ½ä¼šæœ‰å‡ºé”™çš„æ¦‚çŽ‡ï¼Œå¯ä»¥å°†å®ƒä»¬è§†åŒä¸ºèµ„æºã€‚ä½œä¸ºå¹¶å‘é‡è¾ƒå¤§çš„ç³»ç»Ÿï¼Œå‡å¦‚æœ‰ä¸€ä¸ªèµ„æºä¸å¯ç”¨ï¼Œå¯èƒ½ä¼šé€ æˆçº¿ç¨‹å…¨éƒ¨ hang åœ¨è¿™ä¸ªèµ„æºä¸Šï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚é™çº§åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­æ˜¯éžå¸¸æ­£å¸¸çš„ï¼šæ¯”å¦‚æŽ¨èæœåŠ¡ä¸­ï¼Œå¦‚æžœä¸ªæ€§åŒ–æŽ¨èæœåŠ¡ä¸å¯ç”¨ï¼Œå¯ä»¥é™çº§è¡¥å……çƒ­ç‚¹æ•°æ®ï¼Œä¸è‡³äºŽé€ æˆå‰ç«¯é¡µé¢æ˜¯å¼€å¤©çª—ã€‚ åœ¨å®žé™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹é‡è¦çš„èµ„æº ( ä¾‹å¦‚ Redisã€ MySQLã€ Hbaseã€å¤–éƒ¨æŽ¥å£ ) éƒ½è¿›è¡Œéš”ç¦»ï¼Œè®©æ¯ç§èµ„æºéƒ½å•ç‹¬è¿è¡Œåœ¨è‡ªå·±çš„çº¿ç¨‹æ± ä¸­ï¼Œå³ä½¿ä¸ªåˆ«èµ„æºå‡ºçŽ°äº†é—®é¢˜ï¼Œå¯¹å…¶ä»–æœåŠ¡æ²¡æœ‰å½±å“ã€‚ä½†æ˜¯çº¿ç¨‹æ± å¦‚ä½•ç®¡ç†ï¼Œæ¯”å¦‚å¦‚ä½•å…³é—­èµ„æºæ± ï¼Œå¼€å¯èµ„æºæ± ï¼Œèµ„æºæ± é˜€å€¼ç®¡ç†ï¼Œè¿™äº›åšèµ·æ¥è¿˜æ˜¯ç›¸å½“å¤æ‚çš„ï¼Œè¿™é‡ŒæŽ¨èä¸€ä¸ª Java ä¾èµ–éš”ç¦»å·¥å…· Hystrixã€‚è¶…å‡ºèŒƒå›´äº†ã€‚ä¸å†èµ˜è¿°ã€‚ 7. çƒ­ç‚¹keyé‡å»ºä¼˜åŒ– 7.1 é—®é¢˜ çƒ­ç‚¹key( ä¾‹å¦‚ä¸€ä¸ªçƒ­é—¨çš„å¨±ä¹æ–°é—»ï¼‰+è¾ƒé•¿çš„é‡å»ºæ—¶é—´ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚è®¡ç®—ï¼Œä¾‹å¦‚å¤æ‚çš„ SQLã€å¤šæ¬¡ IOã€å¤šä¸ªä¾èµ–ç­‰ï¼‰ å°±æ˜¯è¯´åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼ŒæŸä¸ªkeyåœ¨ç¼“å­˜ä¸­é‡å»ºæ—¶é—´å¤ªé•¿ï¼Œä»¥è‡³äºŽé«˜å¹¶å‘ä¸‹ç¼“å­˜æŸ¥ä¸åˆ°ï¼Œéƒ½åŽ»DBè¿›è¡ŒæŸ¥è¯¢ã€‚å¯¹äºŽDBåŽ‹åŠ›å¾ˆå¤§ï¼Œå¹¶ä¸”å“åº”æ—¶é—´é•¿ã€‚ ä¸‰ä¸ªç›®æ ‡ï¼šè¦å‡å°‘ç¼“å­˜é‡å»ºæ¬¡æ•°ã€æ•°æ®å°½å¯èƒ½ä¸€è‡´ã€å‡å°‘æ½œåœ¨å±é™©ã€‚ ä¸¤ä¸ªè§£å†³ï¼šäº’æ–¥é”ã€æ°¸è¿œä¸è¿‡æœŸ 7.2 äº’æ–¥é”â€”setex,setnx å­˜åœ¨é—®é¢˜ï¼šæœ‰ç­‰å¾…æ—¶é—´ã€‚ ä¼ªä»£ç ï¼š (1) ä»Ž Redis èŽ·å–æ•°æ®ï¼Œå¦‚æžœå€¼ä¸ä¸ºç©ºï¼Œåˆ™ç›´æŽ¥è¿”å›žå€¼ï¼Œå¦åˆ™æ‰§è¡Œ (2.1) å’Œ (2.2)ã€‚ (2) å¦‚æžœ set(nx å’Œ ex) ç»“æžœä¸º trueï¼Œè¯´æ˜Žæ­¤æ—¶æ²¡æœ‰å…¶ä»–çº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹æ‰§è¡Œç¼“å­˜æž„å»ºé€»è¾‘ã€‚ (2.2) å¦‚æžœ setnx(nx å’Œ ex) ç»“æžœä¸º falseï¼Œè¯´æ˜Žæ­¤æ—¶å·²ç»æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨æ‰§è¡Œæž„å»ºç¼“å­˜çš„å·¥ä½œï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°†ä¼‘æ¯æŒ‡å®šæ—¶é—´ ( ä¾‹å¦‚è¿™é‡Œæ˜¯ 50 æ¯«ç§’ï¼Œå–å†³äºŽæž„å»ºç¼“å­˜çš„é€Ÿåº¦ ) åŽï¼Œé‡æ–°æ‰§è¡Œå‡½æ•°ï¼Œç›´åˆ°èŽ·å–åˆ°æ•°æ®ã€‚ 7.3 æ°¸è¿œä¸è¿‡æœŸ è¿™é‡Œæˆ‘æƒ³äº†å¾ˆä¹…åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Œï¼Œï¼Œæˆ‘æ„Ÿè§‰è¿™æ˜¯ä¸€ä¸ªåœºæ™¯ï¼šä¿è¯æ•°æ®çš„å®šæœŸæ›´æ–°ã€‚å¯¹äºŽçƒ­ç‚¹key,æ— éžæ˜¯å¹¶å‘ç‰¹åˆ«å¤§å¹¶ä¸”é‡å»ºç¼“å­˜æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå¦‚æžœç›´æŽ¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆæ—¶é—´åˆ°çš„æ—¶å€™ï¼Œå·¨å¤§çš„è®¿é—®é‡ä¼šåŽ‹è¿«åˆ°æ•°æ®åº“ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å®žé™…ä¸Šï¼Œæ˜¯ä¸ç»™ä»–è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½†æ˜¯ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ€Žä¹ˆåšåˆ°å®šæ—¶æ›´æ–°å‘¢ï¼Ÿè¿™é‡Œçš„æ–¹æ¡ˆæ˜¯ç»™çƒ­ç‚¹keyçš„valå¢žåŠ ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´å­—æ®µï¼Œå¹¶å‘è®¿é—®çš„æ—¶å€™ï¼Œåˆ¤æ–­è¿™ä¸ªé€»è¾‘å­—æ®µçš„æ—¶é—´å€¼æ˜¯å¦å¤§äºŽå½“å‰æ—¶é—´ï¼Œå¤§äºŽäº†è¯´æ˜Žè¦å¯¹ç¼“å­˜è¿›è¡Œæ›´æ–°äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œä¾ç„¶è®©æ‰€æœ‰çº¿ç¨‹è®¿é—®è€çš„ç¼“å­˜ï¼Œå› ä¸ºç¼“å­˜å¹¶æ²¡æœ‰è®¾ç½®è¿‡æœŸï¼Œä½†æ˜¯å¦å¼€ä¸€ä¸ªçº¿ç¨‹å¯¹ç¼“å­˜è¿›è¡Œé‡æž„ã€‚ç­‰é‡æž„æˆåŠŸï¼Œå³æ‰§è¡Œäº†redis setæ“ä½œä¹‹åŽï¼Œæ‰€æœ‰çš„çº¿ç¨‹å°±å¯ä»¥è®¿é—®åˆ°é‡æž„åŽçš„ç¼“å­˜ä¸­çš„æ–°çš„å†…å®¹äº†ã€‚ä¸çŸ¥é“æˆ‘çš„ç†è§£æ˜¯ä¸æ˜¯æ­£ç¡®ã€‚ â€œæ°¸è¿œä¸è¿‡æœŸâ€åŒ…å«ä¸¤å±‚æ„æ€ï¼š ä»Žç¼“å­˜å±‚é¢æ¥çœ‹ï¼Œç¡®å®žæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºçŽ°çƒ­ç‚¹ key è¿‡æœŸåŽäº§ç”Ÿçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯â€œç‰©ç†â€ä¸è¿‡æœŸã€‚ ä»ŽåŠŸèƒ½å±‚é¢æ¥çœ‹ï¼Œä¸ºæ¯ä¸ª value è®¾ç½®ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œå½“å‘çŽ°è¶…è¿‡é€»è¾‘è¿‡æœŸæ—¶é—´åŽï¼Œä¼šä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹åŽ»æž„å»ºç¼“å­˜ã€‚ 2018/6/19 å·è¡¥å……ï¼šç‰©ç†ä¸Šç¼“å­˜ç¡®å®žæ˜¯ä¸è¿‡æœŸçš„ï¼Œä¿è¯æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½è®¿é—®åˆ°ï¼Œä½†æ˜¯æœ‰å¯èƒ½æ˜¯è€çš„æ•°æ®ï¼›é€»è¾‘ä¸Šç»™ value å¢žåŠ è¿‡æœŸæ—¶é—´ï¼Œå¦‚æžœå½“è¿‡æœŸæ—¶é—´è¶…è¿‡å½“å‰æ—¶é—´(æ¯ä¸€ä¸ªçº¿ç¨‹æ‹¿ç¼“å­˜æ•°æ®çš„æ—¶å€™éƒ½ä¼šåˆ¤æ–­ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œä»ç„¶ä½¿ç”¨äº’æ–¥é”ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å‘çŽ°è¿‡æœŸæ—¶é—´è¶…è¿‡å½“å‰æ—¶é—´äº†ï¼Œé‚£ä¹ˆé”ä½ï¼Œå¦å¼€ä¸€ä¸ªçº¿ç¨‹åŽ»å®Œæˆæ•°æ®é‡å»º)ï¼Œæ–°å¼€ä¸€ä¸ªçº¿ç¨‹åŽ»æž„å»ºç¼“å­˜ï¼Œæž„å»ºæˆåŠŸä¹‹åŽï¼Œè®¾ç½®æ–°å†…å®¹åˆ°ç¼“å­˜ä¸­å¹¶ä¸”åˆ é™¤è€ç¼“å­˜ï¼Œå°±å®Œæˆäº†çƒ­ç‚¹ key çš„é‡å»ºã€‚ ä¼ªä»£ç å®žçŽ°ï¼š ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis-Clusterç†è®ºè¯¦è§£]]></title>
    <url>%2F2019%2F02%2F01%2Fredis%2FRedis-Cluster%E7%90%86%E8%AE%BA%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬å…«ç¯‡æ–‡ç« ã€‚ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ äº†redis sentinelï¼ŒçŸ¥é“äº†å®ƒæ˜¯redisé«˜å¯ç”¨çš„ä¸€ç§å®žçŽ°æ–¹æ¡ˆã€‚ä½†æ˜¯é¢å¯¹è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œä¸€å°masteræ˜¯ä¸€å®šä¸èƒ½è§£å†³é—®é¢˜çš„ï¼Œredis 3.0ç»™æˆ‘ä»¬å¸¦æ¥äº†æœåŠ¡ç«¯é›†ç¾¤æ–¹æ¡ˆï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ 1. æ•°æ®åˆ†åŒº é›†ç¾¤ï¼Œé‚£ä¹ˆå°±ä¼šæ¶‰åŠåˆ°æ•°æ®æ˜¯å¦‚ä½•åˆ†ç‰‡çš„ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼šé¡ºåºåˆ†åŒºå’Œå“ˆå¸Œåˆ†åŒº ä¸¤è€…å¯¹æ¯”ï¼š ç›´æŽ¥hashå–æ¨¡è¿›è¡Œæ•°æ®åˆ†ç‰‡æ—¶ï¼Œå½“èŠ‚ç‚¹å¢žåŠ ï¼Œä¼šæœ‰å¾ˆå¤šæ•°æ®å‘½ä¸­ä¸äº†ï¼Œéœ€è¦é‡æ–°æ˜ å°„ã€‚å¦‚æžœå¤§å¤šæ•°æ•°æ®åœ¨å¢žåŠ æˆ–è€…å‡å°‘èŠ‚ç‚¹ä¹‹åŽè¿›è¡Œè¿ç§»çš„è¯ï¼Œå¯¹äºŽæ€§èƒ½å½±å“æ˜¯å¾ˆå¤§çš„ï¼Œå› ä¸ºæ•°æ®è¿ç§»ï¼Œé‚£ä¹ˆç¼“å­˜ä¸­çŽ°åœ¨æ˜¯æ— æ³•å‘½ä¸­çš„ï¼Œå¿…é¡»åŽ»æ•°æ®åº“å–ï¼Œæ˜¯ç¾éš¾æ€§çš„è¡Œä¸ºã€‚ æ—©æœŸçš„åšæ³•å°±æ˜¯è¿™æ ·ï¼Œåœ¨å®¢æˆ·ç«¯hashå–ä½™èŠ‚ç‚¹ä¸ªæ•°æ¥è¿›è¡Œæ•°æ®åˆ†ç‰‡ã€‚å¦‚æžœéžè¦è¿™æ ·ï¼Œé‡‡å–ç¿»å€æ‰©å®¹ä¼šç¨å¾®å¥½ä¸€ç‚¹ï¼Œè¿ç§»æ•°æ®é‡ä¼šå°ä¸€ç‚¹ã€‚ä¸è¿‡æ— è®ºå¦‚ä½•ï¼Œè¿™ç§æ–¹å¼åœ¨å¤§æ•°æ®é‡æƒ…å†µä¸‹æ˜¯ä¸å¯è¡Œçš„ã€‚ 2. ä¸€è‡´æ€§hashç®—æ³• å¯¹äºŽä¸Šé¢æåˆ°çš„ç›´æŽ¥hashå–ä½™çš„æ–¹å¼ï¼Œä¼šå¯¼è‡´å¤§é‡æ•°æ®çš„è¿ç§»ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼ï¼Œåœ¨å¢žåŠ æˆ–å‡å°‘èŠ‚ç‚¹æ—¶ï¼Œåªæœ‰å°‘éƒ¨åˆ†æ•°æ®è¿ç§»å‘¢ï¼Ÿ é’ˆå¯¹ä¸€è‡´æ€§hashç®—æ³•ï¼Œå·²ç»åœ¨ç®€æ˜Žç†è§£ä¸€è‡´æ€§hashç®—æ³•ä¸­è¯¦ç»†è¯´æ˜Žäº†ï¼Œä¸å†èµ˜è¿°ã€‚ å¯¹äºŽredis 3.0ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥å®žçŽ°æ•°æ®åˆ†ç‰‡ã€‚åœ¨redis 3.0ä¹‹åŽï¼Œå°±ä¸éœ€è¦å®¢æˆ·ç«¯æ¥å®žçŽ°åˆ†ç‰‡ç®—æ³•äº†ï¼Œè€Œæ˜¯ç›´æŽ¥ç»™æˆ‘ä»¬æä¾›äº†æœåŠ¡ç«¯é›†ç¾¤æ–¹æ¡ˆredis cluster. 3. è™šæ‹Ÿæ§½ redis clusterå¼•å…¥æ§½çš„æ¦‚å¿µï¼Œä¸€å®šè¦ä¸Žä¸€è‡´æ€§hashçš„æ§½åŒºåˆ†ï¼è¿™é‡Œæ¯ä¸€ä¸ªæ§½æ˜ å°„ä¸€ä¸ªæ•°æ®é›†ã€‚ CRC16(key) &amp; 16383 è¿™é‡Œè®¡ç®—ç»“æžœå‘é€ç»™redis clusterä»»æ„ä¸€ä¸ªredisèŠ‚ç‚¹ï¼Œè¿™ä¸ªredisèŠ‚ç‚¹å‘çŽ°ä»–æ˜¯å±žäºŽè‡ªå·±ç®¡è¾–èŒƒå›´çš„ï¼Œé‚£å°±å°†å®ƒæ”¾è¿›åŽ»ï¼›ä¸å±žäºŽä»–çš„æ§½èŒƒå›´çš„è¯ï¼Œç”±äºŽredisä¹‹é—´æ˜¯ç›¸äº’é€šä¿¡çš„ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯çŸ¥é“å…¶ä»–redisèŠ‚ç‚¹çš„æ§½çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆä¼šå‘Šè¯‰ä»–åŽ»é‚£ä¸ªredisèŠ‚ç‚¹åŽ»çœ‹çœ‹ã€‚ é‚£ä¹ˆå°±å®žçŽ°äº†æœåŠ¡ç«¯å¯¹äºŽæ§½ã€èŠ‚ç‚¹ã€æ•°æ®çš„ç®¡ç†ã€‚ å½“masterèŠ‚ç‚¹å¢žåŠ æ—¶ï¼Œå³æ‰©å®¹æ—¶ï¼Œå¯¹äºŽä»¥ä¸Šä¸¤ç§æ–¹æ¡ˆï¼Œéƒ½ä¼šå‡ºçŽ°æ•°æ®è¿ç§»ï¼Œé‚£ä¹ˆåªèƒ½ä½œä¸ºç¼“å­˜åœºæ™¯ä½¿ç”¨ã€‚ä½†æ˜¯redis clusterï¼Œç”±äºŽæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤çš„æ§½çš„èŒƒå›´æ˜¯å›ºå®šçš„ï¼Œå½“æœ‰æ–°åŠ å…¥çš„èŠ‚ç‚¹æ—¶ï¼Œæ˜¯ä¸ä¼šå¹²æ‰°åˆ°å…¶ä»–èŠ‚ç‚¹çš„æ§½çš„ï¼Œå¿…é¡»æ˜¯ä»¥å‰çš„èŠ‚ç‚¹å°†ä½¿ç”¨æ§½çš„æƒåˆ©åˆ†é…ç»™ä½ ï¼Œå¹¶ä¸”å°†æ•°æ®åˆ†é…ç»™ä½ ï¼Œè¿™æ ·ï¼Œæ–°çš„èŠ‚ç‚¹æ‰ä¼šçœŸæ­£æ‹¥æœ‰è¿™äº›æ§½å’Œæ•°æ®ã€‚è¿™ç§å®žçŽ°è¿˜å¤„äºŽåŠè‡ªåŠ¨çŠ¶æ€ï¼Œéœ€è¦äººå·¥ä»‹å…¥ã€‚-----ä¸»è¦çš„æ€æƒ³æ˜¯ï¼šæ§½åˆ°é›†ç¾¤èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»è¦æ”¹å˜ï¼Œä¸å˜çš„æ˜¯é”®åˆ°æ§½çš„æ˜ å°„å…³ç³». Redisé›†ç¾¤ï¼Œè¦ä¿è¯16384ä¸ªæ§½å¯¹åº”çš„nodeéƒ½æ­£å¸¸å·¥ä½œï¼Œå¦‚æžœæŸä¸ªnodeå‘ç”Ÿæ•…éšœï¼Œé‚£å®ƒè´Ÿè´£çš„slotsä¹Ÿå°±å¤±æ•ˆï¼Œæ•´ä¸ªé›†ç¾¤å°†ä¸èƒ½å·¥ä½œã€‚ä¸ºäº†å¢žåŠ é›†ç¾¤çš„å¯è®¿é—®æ€§ï¼Œå®˜æ–¹æŽ¨èçš„æ–¹æ¡ˆæ˜¯å°†nodeé…ç½®æˆä¸»ä»Žç»“æž„ï¼Œå³ä¸€ä¸ªmasterä¸»èŠ‚ç‚¹ï¼ŒæŒ‚nä¸ªslaveä»ŽèŠ‚ç‚¹ã€‚è¿™æ—¶ï¼Œå¦‚æžœä¸»èŠ‚ç‚¹å¤±æ•ˆï¼ŒRedis Clusterä¼šæ ¹æ®é€‰ä¸¾ç®—æ³•ä»ŽslaveèŠ‚ç‚¹ä¸­é€‰æ‹©ä¸€ä¸ªä¸Šå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œæ•´ä¸ªé›†ç¾¤ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚ 4. æŸä¸ªMasteråˆæ€Žä¹ˆçŸ¥é“æŸä¸ªæ§½è‡ªå·±æ˜¯ä¸æ˜¯æ‹¥æœ‰å‘¢ï¼Ÿ MasterèŠ‚ç‚¹ç»´æŠ¤ç€ä¸€ä¸ª16384/8å­—èŠ‚çš„ä½åºåˆ—ï¼ŒMasterèŠ‚ç‚¹ç”¨bitæ¥æ ‡è¯†å¯¹äºŽæŸä¸ªæ§½è‡ªå·±æ˜¯å¦æ‹¥æœ‰ã€‚æ¯”å¦‚å¯¹äºŽç¼–å·ä¸º1çš„æ§½ï¼ŒMasteråªè¦åˆ¤æ–­åºåˆ—çš„ç¬¬äºŒä½ï¼ˆç´¢å¼•ä»Ž0å¼€å§‹ï¼‰æ˜¯ä¸æ˜¯ä¸º1å³å¯ã€‚ å¦‚ä¸Šé¢çš„åºåˆ—ï¼Œè¡¨ç¤ºå½“å‰Masteræ‹¥æœ‰ç¼–å·ä¸º1ï¼Œ134çš„æ§½ã€‚é›†ç¾¤åŒæ—¶è¿˜ç»´æŠ¤ç€æ§½åˆ°é›†ç¾¤èŠ‚ç‚¹çš„æ˜ å°„ï¼Œæ˜¯ç”±é•¿åº¦ä¸º16384ç±»åž‹ä¸ºèŠ‚ç‚¹çš„æ•°ç»„å®žçŽ°çš„ï¼Œæ§½ç¼–å·ä¸ºæ•°ç»„çš„ä¸‹æ ‡ï¼Œæ•°ç»„å†…å®¹ä¸ºé›†ç¾¤èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆå¿«åœ°é€šè¿‡æ§½ç¼–å·æ‰¾åˆ°è´Ÿè´£è¿™ä¸ªæ§½çš„èŠ‚ç‚¹ã€‚ä½åºåˆ—è¿™ä¸ªç»“æž„å¾ˆç²¾å·§ï¼Œå³ä¸æµªè´¹å­˜å‚¨ç©ºé—´ï¼Œæ“ä½œèµ·æ¥åˆå¾ˆä¾¿æ·ã€‚ å…·ä½“å‚ç…§ï¼šhttp://blog.jobbole.com/103258/ ,è¿˜æåˆ°äº†slotè¿ç§»çš„ä¸€äº›ç»†èŠ‚ã€‚ 5. redisèŠ‚ç‚¹ä¹‹é—´å¦‚ä½•é€šä¿¡çš„ï¼Ÿ gossipåè®®ï¼šèŠ‚ç‚¹ä¹‹é—´å½¼æ­¤ä¸æ–­é€šä¿¡äº¤æ¢ä¿¡æ¯ï¼Œä¸€æ®µæ—¶é—´åŽæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šçŸ¥é“é›†ç¾¤å®Œæ•´çš„ä¿¡æ¯ã€‚ èŠ‚ç‚¹ä¸ŽèŠ‚ç‚¹ä¹‹é—´é€šè¿‡äºŒè¿›åˆ¶åè®®è¿›è¡Œé€šä¿¡ã€‚ å®¢æˆ·ç«¯å’Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´é€šä¿¡å’Œé€šå¸¸ä¸€æ ·ï¼Œé€šè¿‡æ–‡æœ¬åè®®è¿›è¡Œã€‚ é›†ç¾¤èŠ‚ç‚¹ä¸ä¼šä»£ç†æŸ¥è¯¢ã€‚ 6. é›†ç¾¤ä¼¸ç¼© è¿™é‡Œ6385ä¸ºæ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œä¸€å¼€å§‹æ˜¯æ²¡æœ‰æ§½çš„ï¼Œæ‰€ä»¥è¿›è¡Œslotçš„è¿ç§»ã€‚ é›†ç¾¤ä¼¸ç¼©ï¼šæ§½å’Œæ•°æ®åœ¨èŠ‚ç‚¹ä¹‹é—´çš„ç§»åŠ¨ã€‚ è¿ç§»æ•°æ®çš„æµç¨‹å›¾ï¼š è¿ç§»keyå¯ä»¥ç”¨pipelineè¿›è¡Œæ‰¹é‡çš„è¿ç§»ã€‚ å¯¹äºŽæ‰©å®¹ï¼ŒåŽŸç†å·²ç»å¾ˆæ¸…æ™°äº†ï¼Œè‡³äºŽå…·ä½“æ“ä½œï¼Œç½‘ä¸Šå¾ˆå¤šã€‚è‡³äºŽç¼©å®¹ï¼Œä¹Ÿæ˜¯å…ˆæ‰‹åŠ¨å®Œæˆæ•°æ®è¿ç§»ï¼Œå†å…³é—­redisã€‚ 7. å®¢æˆ·ç«¯è·¯ç”± 7.1 movedé‡å®šå‘ å…¶ä¸­ï¼Œæ§½ç›´æŽ¥å‘½ä¸­çš„è¯ï¼Œå°±ç›´æŽ¥è¿”å›žæ§½ç¼–å·ï¼š æ§½ä¸å‘½ä¸­ï¼Œè¿”å›žå¸¦æç¤ºä¿¡æ¯çš„å¼‚å¸¸ï¼Œå®¢æˆ·ç«¯éœ€è¦é‡æ–°å‘é€ä¸€æ¡å‘½ä»¤ï¼š å¯¹äºŽå‘½ä»¤è¡Œçš„å®žéªŒï¼Œç”¨redis-cliåŽ»è¿žæŽ¥é›†ç¾¤ï¼š redis -c -p 7000:åŠ ä¸Š-cï¼Œè¡¨ç¤ºä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡ä¸å‘½ä¸­çš„æƒ…å†µä¸‹è‡ªåŠ¨è·³è½¬åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼š å¦‚æžœä¸åŠ -cçš„è¯ï¼Œä¼šè¿”å›žmovedå¼‚å¸¸ï¼Œä¸ä¼šè‡ªåŠ¨è·³è½¬ï¼š 7.2 aské‡å®šå‘ åœ¨æ‰©å®¹ç¼©å®¹çš„æ—¶å€™ï¼Œç”±äºŽéœ€è¦éåŽ†è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰çš„keyç„¶åŽè¿›è¡Œè¿ç§»ï¼Œæ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå¯¹å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚å› ä¸ºå‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œå®¢æˆ·ç«¯è®¿é—®æŸä¸ªkeyï¼ŒèŠ‚ç‚¹å‘Šè¯‰å®¢æˆ·ç«¯è¿™ä¸ªkeyåœ¨æºèŠ‚ç‚¹ï¼Œå½“æˆ‘ä»¬å†åŽ»æºèŠ‚ç‚¹è®¿é—®çš„æ—¶å€™ï¼Œå´å‘çŽ°keyå·²ç»è¿ç§»åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚ 7.3 movedé‡å®šå‘å’Œaské‡å®šå‘å¯¹æ¯” ä¸¤è€…éƒ½æ˜¯å®¢æˆ·ç«¯çš„é‡å®šå‘ movedï¼šæ§½å·²ç»ç¡®å®šè½¬ç§» ask:æ§½è¿˜åœ¨è¿ç§»ä¸­ é—®é¢˜ï¼šå¦‚æžœèŠ‚ç‚¹ä¼—å¤šï¼Œé‚£ä¹ˆè®©å®¢æˆ·ç«¯éšæœºè®¿é—®èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æŽ¥å‘½ä¸­çš„æ¦‚çŽ‡åªæœ‰ç™¾åˆ†ä¹‹ä¸€ï¼Œè¿˜æœ‰å°±æ˜¯å‘ç”Ÿaskå¼‚å¸¸æ—¶ï¼ˆå³èŠ‚ç‚¹æ­£åœ¨è¿ç§»æ—¶ï¼‰å®¢æˆ·ç«¯å¦‚ä½•è¿˜èƒ½é«˜æ•ˆè¿è½¬ï¼Ÿ æ€»ç»“ä¸€å¥è¯å°±æ˜¯redis clusterçš„å®¢æˆ·ç«¯çš„å®žçŽ°ä¼šæ›´å¤æ‚ã€‚ 8. smartå®¢æˆ·ç«¯ 8.1 è¿½æ±‚ç›®æ ‡ è¿½æ±‚æ€§èƒ½ï¼Œä¸ä¼šä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œè€Œæ˜¯ç›´è¿žå¯¹åº”èŠ‚ç‚¹ã€‚éœ€è¦å¯¹movedå¼‚å¸¸å’Œaskå¼‚å¸¸åšå…¼å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦æœ‰ä¸€ä¸ªè¿™ä¸ªè¯­è¨€å¯¹åº”çš„å®¢æˆ·ç«¯æ¥é«˜æ•ˆå®žçŽ°æŸ¥æ‰¾ç­‰æ“ä½œã€‚ 8.2 smartåŽŸç† ä»Žé›†ç¾¤ä¸­é€‰ä¸€ä¸ªå¯è¿è¡ŒèŠ‚ç‚¹ï¼Œä½¿ç”¨cluster slotsåˆå§‹åŒ–æ§½å’ŒèŠ‚ç‚¹æ˜ å°„ å°†slotä¸ŽnodeèŠ‚ç‚¹çš„ç»“æžœæ˜ å°„åˆ°æœ¬åœ°ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºJedisPool å‡†å¤‡æ‰§è¡Œå‘½ä»¤ ç¬¬ä¸€æ­¥ä¸­å°†slotä¸ŽnodeèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»æ”¾åœ¨äº†mapä¸­ï¼Œå½¢æˆä¸€ä¸ªæ˜ å°„å…³ç³»ï¼›keyæ˜¯é€šè¿‡CRC16ç®—æ³•å†å–ä½™å¾—åˆ°slotï¼Œæ‰€ä»¥keyä¸Žslotçš„æ˜ å°„å…³ç³»ä¹Ÿæ˜¯ç¡®å®šçš„ã€‚æˆ‘ä»¬å°±å¯ä»¥ç›´æŽ¥å‘é€å‘½ä»¤ã€‚åªè¦åŽé¢é›†ç¾¤æ²¡æœ‰å‘ç”Ÿæ•°æ®è¿ç§»ï¼Œé‚£ä¹ˆå°±ä¼šè¿žæŽ¥æˆåŠŸã€‚ä½†æ˜¯å¦‚æžœåœ¨è¿žæŽ¥çš„æ—¶å€™å‡ºçŽ°äº†è¿žæŽ¥å‡ºé”™ï¼Œè¯´æ˜Žè¿™ä¸ªkeyå·²ç»è¿ç§»åˆ°å…¶ä»–çš„nodeä¸Šäº†ã€‚å¦‚æžœå‘çŽ°keyä¸åœåœ°è¿ç§»ï¼Œè¶…è¿‡5æ¬¡å°±æŠ¥é”™ã€‚ åœ¨å‘ç”Ÿmovedå¼‚å¸¸çš„æ—¶å€™ï¼Œåˆ™éœ€è¦åˆ·æ–°ç¼“å­˜ï¼Œå³ä¸€å¼€å§‹ç»´æŠ¤çš„mapã€‚ æœ‰ä¸€ä¸ªæƒ…å†µæ¯”è¾ƒå…¨çš„å›¾ï¼š java redis clusterå®¢æˆ·ç«¯ï¼šjedisClusteråŸºæœ¬ä½¿ç”¨â€“ä¼ªä»£ç  jedisClusterå†…éƒ¨å·²ç»å°è£…å¥½æ± çš„å€Ÿè¿˜æ“ä½œç­‰ã€‚ å…ˆå†™ä¸€ä¸ªJedisClusterFactory: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import redis.clients.jedis.HostAndPort;import redis.clients.jedis.JedisCluster;import redis.clients.jedis.JedisPoolConfig;import java.io.IOException;import java.util.HashSet;import java.util.List;import java.util.Set;public class JedisClusterFactory &#123; private JedisCluster jedisCluster; private List&lt;String&gt; hostPortList; //è¶…æ—¶æ—¶é—´ private int timeout; public void init()&#123; //è¿™é‡Œå¯ä»¥è®¾ç½®ç›¸å…³å‚æ•° JedisPoolConfig jedisPoolConfig = new JedisPoolConfig(); //ä»Žé…ç½®æ–‡ä»¶ä¸­è¯»å–ip:portçš„å‚æ•°æ”¾è¿›Setä¸­ Set&lt;HostAndPort&gt; nodeSet = new HashSet&lt;HostAndPort&gt;(); for(String hostPort : hostPortList)&#123; String[] arr = hostPort.split(":"); if(arr.length != 2)&#123; continue; &#125; nodeSet.add(new HostAndPort(arr[0],Integer.parseInt(arr[1]))); &#125; try &#123; jedisCluster = new JedisCluster(nodeSet,timeout,jedisPoolConfig); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; public void destory()&#123; if(jedisCluster != null)&#123; try &#123; jedisCluster.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public JedisCluster getJedisCluster() &#123; return jedisCluster; &#125; //springæ³¨å…¥hostPortListå’Œtimeout public void setHostPortList(List&lt;String&gt; hostPortList) &#123; this.hostPortList = hostPortList; &#125; public void setTimeout(int timeout) &#123; this.timeout = timeout; &#125;&#125; hostPortList æ”¾å…¥spring beanä¸­ï¼Œspringè‡ªåŠ¨å®Œæˆæ³¨å…¥ã€‚ 8.3 å¤šèŠ‚ç‚¹å‘½ä»¤å®žçŽ° æœ‰çš„æ—¶å€™æˆ‘ä»¬æƒ³æ“ä½œæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ã€‚å¦‚ä½•å®žçŽ°å‘¢ï¼Ÿ 8.4 æ‰¹é‡æ“ä½œ mget,msetå¿…é¡»åœ¨ä¸€ä¸ªæ§½ã€‚è¿™ä¸ªæ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼Œä¸€èˆ¬æ˜¯ä¸èƒ½ä¿è¯çš„ï¼Œé‚£ä¹ˆå¦‚ä½•å®žçŽ°æ‰¹é‡çš„æ“ä½œå‘¢ï¼Ÿ Redis Clusterçš„è¡Œä¸ºå’ŒRedis çš„å•èŠ‚ç‚¹ä¸åŒï¼Œç”šè‡³å’Œä¸€ä¸ªSentinel ç›‘æŽ§çš„ä¸»ä»Žæ¨¡å¼ä¹Ÿä¸ä¸€æ ·ã€‚ä¸»è¦åŽŸå› æ˜¯é›†ç¾¤è‡ªåŠ¨åˆ†ç‰‡ï¼Œå°†ä¸€ä¸ªkey æ˜ å°„åˆ°16384ä¸ªæ§½ä¸­çš„ä¸€ä¸ªï¼Œè¿™äº›æ§½åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚å› æ­¤æ“ä½œå¤šä¸ªkey çš„å‘½ä»¤å¿…é¡»ä¿è¯æ‰€æœ‰çš„key éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæ§½ä¸Šï¼Œé¿å…è·¨æ§½æ‰§è¡Œé”™è¯¯ã€‚æ›´è¿›ä¸€æ­¥è¯´ï¼Œä»ŠåŽä¸€ä¸ªå•ç‹¬çš„é›†ç¾¤èŠ‚ç‚¹ï¼ŒåªæœåŠ¡äºŽä¸€ç»„ä¸“ç”¨çš„keysï¼Œè¯·æ±‚ä¸€ä¸ªå‘½ä»¤åˆ°ä¸€ä¸ªServerï¼Œåªèƒ½å¾—åˆ°è¯¥Server ä¸Šæ‹¥æœ‰keys çš„å¯¹åº”ç»“æžœã€‚ä¸€ä¸ªéžå¸¸ç®€å•çš„ä¾‹å­æ˜¯æ‰§è¡ŒKEYSå‘½ä»¤ï¼Œå½“å‘å¸ƒè¯¥å‘½ä»¤åˆ°é›†ç¾¤çŽ¯å¢ƒä¸­çš„æŸä¸ªèŠ‚æ—¶ï¼Œåªèƒ½å¾—åˆ°è¯¥èŠ‚ç‚¹ä¸Šæ‹¥æœ‰çš„keysï¼Œè€Œä¸æ˜¯é›†ç¾¤ä¸­æ‰€æœ‰çš„keysã€‚æ‰€ä»¥è¦å¾—åˆ°é›†ç¾¤ä¸­æ‰€æœ‰çš„keysï¼Œå¿…é¡»ä»Žé›†ç¾¤çš„æ‰€æœ‰ä¸»èŠ‚ç‚¹ä¸ŠèŽ·å–æ‰€æœ‰çš„keysã€‚ å¯¹äºŽåˆ†æ•£åœ¨redisé›†ç¾¤ä¸­ä¸åŒèŠ‚ç‚¹çš„æ•°æ®ï¼Œæˆ‘ä»¬å¦‚ä½•æ¯”è¾ƒé«˜æ•ˆåœ°æ‰¹é‡èŽ·å–æ•°æ®å‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ä¸²è¡Œmgetâ€“åŽŸå§‹æ–¹æ¡ˆï¼Œæ•´ä¸€ä¸ªforå¾ªçŽ¯ ä¸²è¡ŒIO å¯¹keyè¿›è¡ŒRCR16å’Œå–ä½™æ“ä½œå¾—åˆ°slotï¼Œå°†slotsæŒ‰ç…§èŠ‚ç‚¹è¿›è¡Œåˆ†æ‰¹ä¼ é€ï¼š å¹¶è¡ŒIO hash_tag ä¸åšä»»ä½•æ”¹å˜çš„è¯ï¼Œhashä¹‹åŽå°±æ¯”è¾ƒå‡åŒ€åœ°æ•£åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼š é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½åƒä½¿ç”¨å•æœºredisä¸€æ ·ï¼Œä¸€æ¬¡IOå°†æ‰€æœ‰çš„keyå–å‡ºæ¥å‘¢ï¼Ÿhash-tagæä¾›äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œå¦‚æžœå°†ä¸Šè¿°çš„keyæ”¹ä¸ºå¦‚ä¸‹ï¼Œä¹Ÿå°±æ˜¯ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥ç›¸åŒçš„å†…å®¹ï¼Œé‚£ä¹ˆè¿™äº›keyå°±ä¼šåˆ°æŒ‡å®šçš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ åœ¨mgetçš„æ—¶å€™åªéœ€è¦åœ¨ä¸€å°æœºå™¨ä¸ŠåŽ»å³å¯ã€‚ å¯¹æ¯” æ–¹æ¡ˆä¸‰æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬ä¸ç”¨ï¼›æ–¹æ¡ˆå››å¯èƒ½ä¼šå‡ºçŽ°æ•°æ®å€¾æ–œï¼Œä¹Ÿä¸ç”¨ã€‚æ–¹æ¡ˆä¸€åœ¨keyå°çš„æ—¶å€™å¯ä»¥ç”¨ï¼›æ–¹æ¡ˆäºŒç›¸å¯¹æ¥è¯´æœ‰ä¸€ç‚¹ä¼˜åŠ¿ï¼› ä¸ºä»€ä¹ˆè¯´æ˜¯ä¸€ç‚¹ä¼˜åŠ¿å‘¢ï¼Ÿpipelineæ‰¹é‡å¤„ç†ä¸åº”è¯¥æ¯”ä¸²è¡Œå¤„ç†å¥½å¾ˆå¤šå—ï¼Ÿ http://xiezefan.me/2015/12/13/redis_cluster_research_2/ http://trumandu.github.io/2016/05/09/RedisClusteræž„å»ºæ‰¹é‡æ“ä½œæŽ¢è®¨/ 9. æ•…éšœè½¬ç§» 9.1 æ•…éšœå‘çŽ° é€šè¿‡ping/pongæ¶ˆæ¯å®žçŽ°æ•…éšœå‘çŽ°ï¼šä¸éœ€è¦sentinel åˆ†ä¸ºä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ ä¸»è§‚ä¸‹çº¿ï¼š å®¢è§‚ä¸‹çº¿ï¼š pfailæ¶ˆæ¯å°±æ˜¯ä¸»è§‚ä¸‹çº¿çš„ä¿¡æ¯ï¼Œç»´æŠ¤åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œé“¾è¡¨ä¸­åŒ…å«äº†æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å¯¹å…¶ä»–èŠ‚ç‚¹æ‰€æœ‰çš„ä¸»è§‚ä¿¡æ¯ï¼Œæ˜¯æœ‰æ—¶é—´å‘¨æœŸçš„ï¼Œä¸ºäº†é˜²æ­¢å¾ˆæ—©ä»¥å‰çš„ä¸»è§‚ä¸‹çº¿ä¿¡æ¯è¿˜æ®‹ç•™åœ¨è¿™é‡Œã€‚å¯¹è¿™ä¸ªé“¾è¡¨è¿›è¡Œåˆ†æžï¼Œç¬¦åˆæ¡ä»¶å°±å°è¯•å®¢è§‚ä¸‹çº¿ã€‚ 9.2 æ•…éšœæ¢å¤ ä»ŽèŠ‚ç‚¹æŽ¥æ”¶åˆ°ä»–çš„ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿çš„é€šçŸ¥ï¼Œåˆ™è¿›è¡Œæ•…éšœæ¢å¤çš„æ“ä½œã€‚ èµ„æ ¼æ£€æŸ¥ é€‰å–å‡ºç¬¦åˆæ¡ä»¶çš„ä»ŽèŠ‚ç‚¹ï¼šå½“ä»ŽèŠ‚ç‚¹å’Œæ•…éšœä¸»èŠ‚ç‚¹çš„æ–­çº¿æ—¶é—´å¤ªé•¿ï¼Œä¼šè¢«å–æ¶ˆèµ„æ ¼ã€‚ å‡†å¤‡é€‰ä¸¾æ—¶é—´ å°±æ˜¯ä¸ºäº†ä¿è¯åç§»é‡å¤§çš„ä»ŽèŠ‚ç‚¹ä¼˜å…ˆè¢«é€‰ä¸¾æŠ•ç¥¨ é€‰ä¸¾æŠ•ç¥¨ æ›¿æ¢ä¸»èŠ‚ç‚¹ è¿™äº›æ‰€æœ‰æ­¥éª¤åŠ èµ·æ¥ï¼Œå·®ä¸å¤šåå‡ ç§’å·¦å³ã€‚æœ€åŽå¦‚æžœæ•…éšœèŠ‚ç‚¹åˆæ¢å¤åŠŸèƒ½äº†ï¼Œå°±ç§°ä¸ºæ–°çš„Masterçš„slaveèŠ‚ç‚¹ã€‚ 10. å¸¸è§é—®é¢˜ 10.1 é›†ç¾¤å®Œæ•´æ€§ cluster-require-full-coverageé»˜è®¤ä¸ºyes - è¦æ±‚æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨æœåŠ¡ï¼Œé›†ç¾¤ä¸­16384ä¸ªæ§½å…¨éƒ¨å¯ç”¨ï¼šä¿è¯é›†ç¾¤å®Œæ•´æ€§ - èŠ‚ç‚¹æ•…éšœæˆ–è€…æ­£åœ¨æ•…éšœè½¬ç§»ï¼š`(error)CLUSTERDOWN the cluster is down` ä½†æ˜¯å¤§å¤šæ•°ä¸šåŠ¡éƒ½æ— æ³•å®¹å¿ã€‚éœ€è¦å°†cluster-require-full-coverageè®¾ç½®ä¸ºno 10.2 å¸¦å®½æ¶ˆè€— æ¶ˆæ¯å‘é€é¢‘çŽ‡ï¼šèŠ‚ç‚¹å‘çŽ°ä¸Žå…¶ä»–èŠ‚ç‚¹æœ€åŽé€šä¿¡æ—¶é—´è¶…è¿‡cluster-node-timeout/2æ—¶ä¼šç›´æŽ¥å‘é€Pingæ¶ˆæ¯ æ¶ˆæ¯æ•°æ®é‡ï¼šslotsæ§½æ•°ç»„(2kç©ºé—´)å’Œæ•´ä¸ªé›†ç¾¤1ã€10çš„çŠ¶æ€æ•°æ®(10ä¸ªèŠ‚ç‚¹çŠ¶æ€æ•°æ®çº¦10k) èŠ‚ç‚¹éƒ¨ç½²çš„æœºå™¨è§„æ¨¡ï¼šè¿›åŽ»åˆ†å¸ƒçš„æœºå™¨è¶Šå¤šä¸”æ¯å°æœºå™¨åˆ’åˆ†çš„èŠ‚ç‚¹æ•°è¶Šå‡åŒ€ï¼Œåˆ™é›†ç¾¤å†…æ•´ä½“çš„å¯ç”¨å¸¦å®½è¶Šé«˜ã€‚ ä¼˜åŒ–ï¼šé¿å…â€œå¤§â€é›†ç¾¤ï¼Œï¼šé¿å…å¤šä¸šåŠ¡ä½¿ç”¨ä¸€ä¸ªé›†ç¾¤ï¼Œå¤§ä¸šåŠ¡å¯ç”¨å¤šé›†ç¾¤ï¼›cluster-node-timeoutæ—¶é—´è®¾ç½®è¦æ³¨æ„æ˜¯å¸¦å®½å’Œæ•…éšœè½¬ç§»é€Ÿåº¦çš„å‡è¡¡ï¼›å°½é‡å‡åŒ€åˆ†é…åˆ°å¤šæœºå™¨ä¸Šï¼šä¿è¯é«˜å¯ç”¨å’Œå¸¦å®½ã€‚ 10.3 PubSubå¹¿æ’­ é—®é¢˜ï¼špublishåœ¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹å¹¿æ’­ï¼šåŠ é‡å¸¦å®½ã€‚ è§£å†³ï¼šå•ç‹¬â€œèµ°â€ä¸€å¥—redis sentinelã€‚å°±æ˜¯é’ˆå¯¹ç›®æ ‡çš„å‡ ä¸ªèŠ‚ç‚¹æž„å»ºredis sentinelï¼Œåœ¨è¿™ä¸ªé‡Œé¢å®žçŽ°å¹¿æ’­ã€‚ 10.4 æ•°æ®å€¾æ–œ èŠ‚ç‚¹å’Œæ§½åˆ†é…ä¸å‡åŒ€ ./redis-trib.rb info ip:portæŸ¥çœ‹èŠ‚ç‚¹ã€æ§½ã€é”®å€¼åˆ†å¸ƒ æ…Žç”¨rebalanceå‘½ä»¤ ä¸åŒæ§½ä½å¯¹åº”é”®æ•°é‡å·®å¼‚è¾ƒå¤§ CRC16æ­£å¸¸æƒ…å†µä¸‹æ¯”è¾ƒå‡åŒ€ å¯èƒ½å­˜åœ¨hash_tag cluster countKeysinslot {slot}èŽ·å–æ§½å¯¹åº”é”®å€¼ä¸ªæ•° åŒ…å«bigkey ä¾‹å¦‚å¤§å­—ç¬¦ä¸²ã€å‡ ç™¾ä¸‡çš„å…ƒç´ çš„hashã€setç­‰ åœ¨ä»ŽèŠ‚ç‚¹ä¸Šæ‰§è¡Œ:redis-cli --bigkeysæ¥æŸ¥çœ‹bigkeyæƒ…å†µ ä¼˜åŒ–ï¼šä¼˜åŒ–æ•°æ®ç»“æž„ å†…å­˜ç›¸å…³é…ç½®ä¸ä¸€è‡´ å› ä¸ºæŸç§æƒ…å†µä¸‹ï¼ŒæŸä¸ªèŠ‚ç‚¹å¯¹hashæˆ–è€…Setè¿™ç§æ•°æ®ç»“æž„è¿›è¡Œäº†å•ç‹¬çš„ä¼˜åŒ–ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹éƒ½æ²¡æœ‰é…ç½®ï¼Œä¼šå‡ºçŽ°é…ç½®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ 10.5 è¯·æ±‚å€¾æ–œ çƒ­ç‚¹keyï¼šé‡è¦çš„keyæˆ–è€…bigkey ä¼˜åŒ–ï¼šé¿å…bigkey;çƒ­é”®ä¸ä½¿ç”¨hash_tagï¼›å½“ä¸€è‡´æ€§ä¸é«˜æ—¶ï¼Œå¯ä»¥ç”¨æœ¬åœ°ç¼“å­˜+MQ 10.6 è¯»å†™åˆ†ç¦» åªè¯»è¿žæŽ¥ï¼šé›†ç¾¤æ¨¡å¼çš„ä»ŽèŠ‚ç‚¹ä¸æŽ¥å—ä»»ä½•è¯»å†™è¯·æ±‚ é‡å®šå‘åˆ°è´Ÿè´£æ§½çš„ä¸»èŠ‚ç‚¹(å¯¹ä»ŽèŠ‚ç‚¹è¿›è¡Œè¯»ï¼Œéƒ½æ˜¯é‡å®šå‘åˆ°ä¸»èŠ‚ç‚¹å†è¿”å›žä¿¡æ¯) readonlyå‘½ä»¤å¯ä»¥è¯»ï¼šè¿žæŽ¥çº§åˆ«å‘½ä»¤(æ¯æ¬¡é‡æ–°è¿žæŽ¥éƒ½è¦å†™ä¸€æ¬¡) ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œredis cluster é»˜è®¤slave ä¹Ÿæ˜¯ä¸èƒ½è¯»çš„ï¼Œå¦‚æžœè¦è¯»å–ï¼Œéœ€è¦æ‰§è¡Œ readonlyï¼Œå°±å¯ä»¥äº†ã€‚ è¯»å†™åˆ†ç¦»ï¼šæ›´åŠ å¤æ‚ï¼ˆæˆæœ¬å¾ˆé«˜ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ï¼‰ åŒæ ·çš„é—®é¢˜ï¼šå¤åˆ¶å»¶è¿Ÿã€è¯»å–è¿‡æœŸæ•°æ®ã€ä»ŽèŠ‚ç‚¹æ•…éšœ ä¿®æ”¹å®¢æˆ·ç«¯ 10.7 æ•°æ®è¿ç§» åˆ†ä¸ºç¦»çº¿è¿ç§»å’Œåœ¨çº¿è¿ç§»(å”¯å“ä¼šredis-migrate-toolå’Œè±Œè±†èšredis-port)ã€‚ å®˜æ–¹çš„æ–¹å¼ï¼šåªèƒ½ä»Žå•æœºè¿ç§»åˆ°é›†ç¾¤ã€ä¸æ”¯æŒåœ¨çº¿è¿ç§»ã€ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ ã€å•çº¿ç¨‹è¿ç§»å½±å“é€Ÿåº¦ ./redis-trib.rb import --from æºip:port --copy ç›®æ ‡ip:port åŠ å…¥åœ¨è¿ç§»æ—¶å†å¾€æºredisæ’å…¥å‡ æ¡æ•°æ®ï¼Œè¿™å‡ æ¡æ•°æ®ä¼šä¸¢å¤±(ä¸¢å¤±ä¸€éƒ¨åˆ†) 10.8 é›†ç¾¤vså•æœº é›†ç¾¤ä¹Ÿæœ‰ä¸€å®šçš„é™åˆ¶ï¼š åˆ†å¸ƒå¼redisä¸ä¸€å®šæ˜¯å¥½çš„ï¼š 11. ç®€å•æ€»ç»“]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®€æ˜Žç†è§£ä¸€è‡´æ€§hashç®—æ³•]]></title>
    <url>%2F2019%2F02%2F01%2Fmiscellany%2F15%E7%AE%80%E6%98%8E%E7%90%86%E8%A7%A3%E4%B8%80%E8%87%B4%E6%80%A7hash%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­ï¼Œå¯¹æœºå™¨çš„æ·»åŠ åˆ é™¤ï¼Œæˆ–è€…æœºå™¨æ•…éšœåŽè‡ªåŠ¨è„±ç¦»é›†ç¾¤è¿™äº›æ“ä½œæ˜¯åˆ†å¸ƒå¼é›†ç¾¤ç®¡ç†æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚å¦‚æžœé‡‡ç”¨å¸¸ç”¨çš„hash(object)%Nç®—æ³•ï¼Œé‚£ä¹ˆåœ¨æœ‰æœºå™¨æ·»åŠ æˆ–è€…åˆ é™¤åŽï¼Œå¾ˆå¤šåŽŸæœ‰çš„æ•°æ®å°±æ— æ³•æ‰¾åˆ°äº†ï¼Œè¿™æ ·ä¸¥é‡çš„è¿åäº†å•è°ƒæ€§åŽŸåˆ™ã€‚æŽ¥ä¸‹æ¥ä¸»è¦è®²è§£ä¸€ä¸‹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å¦‚ä½•è®¾è®¡çš„ã€‚ çŽ¯å½¢Hashç©ºé—´ æŒ‰ç…§å¸¸ç”¨çš„hashç®—æ³•æ¥å°†å¯¹åº”çš„keyå“ˆå¸Œåˆ°ä¸€ä¸ªå…·æœ‰2^32 æ¬¡æ–¹ä¸ªæ¡¶çš„ç©ºé—´ä¸­ï¼Œå³0~(2^32)-1çš„æ•°å­—ç©ºé—´ä¸­ã€‚çŽ°åœ¨æˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ•°å­—å¤´å°¾ç›¸è¿žï¼Œæƒ³è±¡æˆä¸€ä¸ªé—­åˆçš„çŽ¯å½¢ã€‚å¦‚ä¸‹å›¾ æŠŠæ•°æ®é€šè¿‡ä¸€å®šçš„hashç®—æ³•å¤„ç†åŽæ˜ å°„åˆ°çŽ¯ä¸Š çŽ°åœ¨æˆ‘ä»¬å°†object1ã€object2ã€object3ã€object4å››ä¸ªå¯¹è±¡é€šè¿‡ç‰¹å®šçš„Hashå‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„keyå€¼ï¼Œç„¶åŽæ•£åˆ—åˆ°HashçŽ¯ä¸Šã€‚å¦‚ä¸‹å›¾ï¼š 1234Hash(object1) = key1ï¼›Hash(object2) = key2ï¼›Hash(object3) = key3ï¼›Hash(object4) = key4ï¼› å°†æœºå™¨é€šè¿‡hashç®—æ³•æ˜ å°„åˆ°çŽ¯ä¸Š åœ¨é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åˆ†å¸ƒå¼é›†ç¾¤ä¸­å°†æ–°çš„æœºå™¨åŠ å…¥ï¼Œå…¶åŽŸç†æ˜¯é€šè¿‡ä½¿ç”¨ä¸Žå¯¹è±¡å­˜å‚¨ä¸€æ ·çš„Hashç®—æ³•å°†æœºå™¨ä¹Ÿæ˜ å°„åˆ°çŽ¯ä¸­ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹å¯¹æœºå™¨çš„hashè®¡ç®—æ˜¯é‡‡ç”¨æœºå™¨çš„IPæˆ–è€…æœºå™¨å”¯ä¸€çš„åˆ«åä½œä¸ºè¾“å…¥å€¼ï¼‰ï¼Œç„¶åŽä»¥é¡ºæ—¶é’ˆçš„æ–¹å‘è®¡ç®—ï¼Œå°†æ‰€æœ‰å¯¹è±¡å­˜å‚¨åˆ°ç¦»è‡ªå·±æœ€è¿‘çš„æœºå™¨ä¸­ã€‚ å‡è®¾çŽ°åœ¨æœ‰NODE1ï¼ŒNODE2ï¼ŒNODE3ä¸‰å°æœºå™¨ï¼Œé€šè¿‡Hashç®—æ³•å¾—åˆ°å¯¹åº”çš„KEYå€¼ï¼Œæ˜ å°„åˆ°çŽ¯ä¸­ï¼Œå…¶ç¤ºæ„å›¾å¦‚ä¸‹ï¼š 123Hash(NODE1) = KEY1;Hash(NODE2) = KEY2;Hash(NODE3) = KEY3; é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹å‡ºå¯¹è±¡ä¸Žæœºå™¨å¤„äºŽåŒä¸€å“ˆå¸Œç©ºé—´ä¸­ï¼Œè¿™æ ·æŒ‰é¡ºæ—¶é’ˆè½¬åŠ¨object1å­˜å‚¨åˆ°äº†NODE1ä¸­ï¼Œobject3å­˜å‚¨åˆ°äº†NODE2ä¸­ï¼Œobject2ã€object4å­˜å‚¨åˆ°äº†NODE3ä¸­ã€‚åœ¨è¿™æ ·çš„éƒ¨ç½²çŽ¯å¢ƒä¸­ï¼ŒhashçŽ¯æ˜¯ä¸ä¼šå˜æ›´çš„ï¼Œå› æ­¤ï¼Œé€šè¿‡ç®—å‡ºå¯¹è±¡çš„hashå€¼å°±èƒ½å¿«é€Ÿçš„å®šä½åˆ°å¯¹åº”çš„æœºå™¨ä¸­ï¼Œè¿™æ ·å°±èƒ½æ‰¾åˆ°å¯¹è±¡çœŸæ­£çš„å­˜å‚¨ä½ç½®äº†ã€‚ æœºå™¨çš„åˆ é™¤ä¸Žæ·»åŠ  æ™®é€šhashæ±‚ä½™ç®—æ³•æœ€ä¸ºä¸å¦¥çš„åœ°æ–¹å°±æ˜¯åœ¨æœ‰æœºå™¨çš„æ·»åŠ æˆ–è€…åˆ é™¤ä¹‹åŽä¼šç…§æˆå¤§é‡çš„å¯¹è±¡å­˜å‚¨ä½ç½®å¤±æ•ˆï¼Œè¿™æ ·å°±å¤§å¤§çš„ä¸æ»¡è¶³å•è°ƒæ€§äº†ã€‚ä¸‹é¢æ¥åˆ†æžä¸€ä¸‹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚ èŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰çš„åˆ é™¤ ä»¥ä¸Šé¢çš„åˆ†å¸ƒä¸ºä¾‹ï¼Œå¦‚æžœNODE2å‡ºçŽ°æ•…éšœè¢«åˆ é™¤äº†ï¼Œé‚£ä¹ˆæŒ‰ç…§é¡ºæ—¶é’ˆè¿ç§»çš„æ–¹æ³•ï¼Œobject3å°†ä¼šè¢«è¿ç§»åˆ°NODE3ä¸­ï¼Œè¿™æ ·ä»…ä»…æ˜¯object3çš„æ˜ å°„ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œå…¶å®ƒçš„å¯¹è±¡æ²¡æœ‰ä»»ä½•çš„æ”¹åŠ¨ã€‚å¦‚ä¸‹å›¾ï¼š èŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰çš„æ·»åŠ  å¦‚æžœå¾€é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹NODE4ï¼Œé€šè¿‡å¯¹åº”çš„å“ˆå¸Œç®—æ³•å¾—åˆ°KEY4ï¼Œå¹¶æ˜ å°„åˆ°çŽ¯ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š é€šè¿‡æŒ‰é¡ºæ—¶é’ˆè¿ç§»çš„è§„åˆ™ï¼Œé‚£ä¹ˆobject2è¢«è¿ç§»åˆ°äº†NODE4ä¸­ï¼Œå…¶å®ƒå¯¹è±¡è¿˜ä¿æŒè¿™åŽŸæœ‰çš„å­˜å‚¨ä½ç½®ã€‚é€šè¿‡å¯¹èŠ‚ç‚¹çš„æ·»åŠ å’Œåˆ é™¤çš„åˆ†æžï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨ä¿æŒäº†å•è°ƒæ€§çš„åŒæ—¶ï¼Œè¿˜æ˜¯æ•°æ®çš„è¿ç§»è¾¾åˆ°äº†æœ€å°ï¼Œè¿™æ ·çš„ç®—æ³•å¯¹åˆ†å¸ƒå¼é›†ç¾¤æ¥è¯´æ˜¯éžå¸¸åˆé€‚çš„ï¼Œé¿å…äº†å¤§é‡æ•°æ®è¿ç§»ï¼Œå‡å°äº†æœåŠ¡å™¨çš„çš„åŽ‹åŠ›ã€‚ å¹³è¡¡æ€§ æ ¹æ®ä¸Šé¢çš„å›¾è§£åˆ†æžï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ»¡è¶³äº†å•è°ƒæ€§å’Œè´Ÿè½½å‡è¡¡çš„ç‰¹æ€§ä»¥åŠä¸€èˆ¬hashç®—æ³•çš„åˆ†æ•£æ€§ï¼Œä½†è¿™è¿˜å¹¶ä¸èƒ½å½“åšå…¶è¢«å¹¿æ³›åº”ç”¨çš„åŽŸç”±ï¼Œå› ä¸ºè¿˜ç¼ºå°‘äº†å¹³è¡¡æ€§ã€‚ä¸‹é¢å°†åˆ†æžä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å¦‚ä½•æ»¡è¶³å¹³è¡¡æ€§çš„ã€‚ hashç®—æ³•æ˜¯ä¸ä¿è¯å¹³è¡¡çš„ï¼Œå¦‚ä¸Šé¢åªéƒ¨ç½²äº†NODE1å’ŒNODE3çš„æƒ…å†µï¼ˆNODE2è¢«åˆ é™¤çš„å›¾ï¼‰ï¼Œobject1å­˜å‚¨åˆ°äº†NODE1ä¸­ï¼Œè€Œobject2ã€object3ã€object4éƒ½å­˜å‚¨åˆ°äº†NODE3ä¸­ï¼Œè¿™æ ·å°±ç…§æˆäº†éžå¸¸ä¸å¹³è¡¡çš„çŠ¶æ€ã€‚åœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œä¸ºäº†å°½å¯èƒ½çš„æ»¡è¶³å¹³è¡¡æ€§ï¼Œå…¶å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹ã€‚ â€œè™šæ‹ŸèŠ‚ç‚¹â€ï¼ˆ virtual node ï¼‰æ˜¯å®žé™…èŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰åœ¨ hash ç©ºé—´çš„å¤åˆ¶å“ï¼ˆ replica ï¼‰ï¼Œä¸€å®žé™…ä¸ªèŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰å¯¹åº”äº†è‹¥å¹²ä¸ªâ€œè™šæ‹ŸèŠ‚ç‚¹â€ï¼Œè¿™ä¸ªå¯¹åº”ä¸ªæ•°ä¹Ÿæˆä¸ºâ€œå¤åˆ¶ä¸ªæ•°â€ï¼Œâ€œè™šæ‹ŸèŠ‚ç‚¹â€åœ¨ hash ç©ºé—´ä¸­ä»¥hashå€¼æŽ’åˆ—ã€‚ ä»¥ä¸Šé¢åªéƒ¨ç½²äº†NODE1å’ŒNODE3çš„æƒ…å†µï¼ˆNODE2è¢«åˆ é™¤çš„å›¾ï¼‰ä¸ºä¾‹ï¼Œä¹‹å‰çš„å¯¹è±¡åœ¨æœºå™¨ä¸Šçš„åˆ†å¸ƒå¾ˆä¸å‡è¡¡ï¼ŒçŽ°åœ¨æˆ‘ä»¬ä»¥2ä¸ªå‰¯æœ¬ï¼ˆå¤åˆ¶ä¸ªæ•°ï¼‰ä¸ºä¾‹ï¼Œè¿™æ ·æ•´ä¸ªhashçŽ¯ä¸­å°±å­˜åœ¨äº†4ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œæœ€åŽå¯¹è±¡æ˜ å°„çš„å…³ç³»å›¾å¦‚ä¸‹ï¼š æ ¹æ®ä¸Šå›¾å¯çŸ¥å¯¹è±¡çš„æ˜ å°„å…³ç³»ï¼šobject1-&gt;NODE1-1ï¼Œobject2-&gt;NODE1-2ï¼Œobject3-&gt;NODE3-2ï¼Œobject4-&gt;NODE3-1ã€‚é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹çš„å¼•å…¥ï¼Œå¯¹è±¡çš„åˆ†å¸ƒå°±æ¯”è¾ƒå‡è¡¡äº†ã€‚é‚£ä¹ˆåœ¨å®žé™…æ“ä½œä¸­ï¼ŒçœŸæ­£çš„å¯¹è±¡æŸ¥è¯¢æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿå¯¹è±¡ä»Žhashåˆ°è™šæ‹ŸèŠ‚ç‚¹åˆ°å®žé™…èŠ‚ç‚¹çš„è½¬æ¢å¦‚ä¸‹å›¾ï¼š â€œè™šæ‹ŸèŠ‚ç‚¹â€çš„hashè®¡ç®—å¯ä»¥é‡‡ç”¨å¯¹åº”èŠ‚ç‚¹çš„IPåœ°å€åŠ æ•°å­—åŽç¼€çš„æ–¹å¼ã€‚ä¾‹å¦‚å‡è®¾NODE1çš„IPåœ°å€ä¸º192.168.1.100ã€‚å¼•å…¥â€œè™šæ‹ŸèŠ‚ç‚¹â€å‰ï¼Œè®¡ç®— cache A çš„ hash å€¼ï¼š 1Hash(â€œ192.168.1.100â€); å¼•å…¥â€œè™šæ‹ŸèŠ‚ç‚¹â€åŽï¼Œè®¡ç®—â€œè™šæ‹ŸèŠ‚â€ç‚¹NODE1-1å’ŒNODE1-2çš„hashå€¼ä¸ºï¼š 12Hash(â€œ192.168.1.100#1â€); // NODE1-1Hash(â€œ192.168.1.100#2â€); // NODE1-2 æ•´ç†è‡ªï¼š äº”åˆ†é’Ÿç†è§£ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis-Sentinelå®žçŽ°é«˜å¯ç”¨è¯»å†™åˆ†ç¦»]]></title>
    <url>%2F2019%2F02%2F01%2Fredis%2FRedis-Sentinel%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬ä¸ƒç¯‡æ–‡ç« ã€‚Redis Sentinel æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªæž¶æž„ä¸­è¿è¡Œå¤šä¸ª Sentinel è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹ä½¿ç”¨æµè¨€åè®®ï¼ˆgossip protocols)æ¥æŽ¥æ”¶å…³äºŽä¸»æœåŠ¡å™¨æ˜¯å¦ä¸‹çº¿çš„ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨æŠ•ç¥¨åè®®ï¼ˆagreement protocolsï¼‰æ¥å†³å®šæ˜¯å¦æ‰§è¡Œè‡ªåŠ¨æ•…éšœè¿ç§»ï¼Œä»¥åŠé€‰æ‹©å“ªä¸ªä»ŽæœåŠ¡å™¨ä½œä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚ è™½ç„¶ Redis Sentinel æ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯æ‰§è¡Œæ–‡ä»¶ redis-sentinel ï¼Œä½†å®žé™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis æœåŠ¡å™¨ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ä¸€ä¸ªæ™®é€š Redis æœåŠ¡å™¨æ—¶é€šè¿‡ç»™å®š â€“sentinel é€‰é¡¹æ¥å¯åŠ¨ Redis Sentinel ã€‚ å¯åŠ¨æ–¹å¼ä¸€ï¼šä½¿ç”¨sentinelå¯æ‰§è¡Œæ–‡ä»¶ redis-sentinel ç¨‹åºæ¥å¯åŠ¨ Sentinel ç³»ç»Ÿï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 1redis-sentinel /path/to/sentinel.conf sentinelåªæ˜¯è¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„redisæœåŠ¡å™¨ï¼Œä½ å¯ä»¥ç”¨å¯åŠ¨redisæœåŠ¡çš„å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªè¿è¡Œåœ¨ Sentinel æ¨¡å¼ä¸‹çš„ Redis æœåŠ¡å™¨ï¼š 1redis-server /path/to/sentinel.conf --sentinel 1. redis sentinel é¦–å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ redis sentinelï¼Œä¸­æ–‡ç¿»è¯‘æ˜¯rediså“¨å…µã€‚é¡¾åæ€ä¹‰ï¼Œå“¨å…µæ˜¯ç«™å²—ç›‘ç£çªå‘æƒ…å†µçš„ï¼Œé‚£ä¹ˆè¿™é‡Œå…·ä½“çš„åŠŸèƒ½ä¸Šå¾ˆç±»ä¼¼ï¼š ç›‘æŽ§ï¼šSentinel ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ä¸»æœåŠ¡å™¨å’Œä»ŽæœåŠ¡å™¨æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ æé†’ï¼šå½“è¢«ç›‘æŽ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºçŽ°é—®é¢˜æ—¶ï¼ŒSentinel å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚ è‡ªåŠ¨æ•…éšœè¿ç§»ï¼šå½“ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼ŒSentinel ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä¸­ä¸€ä¸ªä»ŽæœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œå¹¶è®©å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä»–ä»ŽæœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ï¼›å½“å®¢æˆ·ç«¯è¯•å›¾è¿žæŽ¥å¤±æ•ˆçš„ä¸»æœåŠ¡å™¨æ—¶ï¼Œé›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›žæ–°ä¸»æœåŠ¡å™¨çš„åœ°å€ï¼Œä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨æ–°ä¸»æœåŠ¡å™¨ä»£æ›¿å¤±æ•ˆæœåŠ¡å™¨ã€‚ å…¶ä¸­æ€»ç»“ä¸€ä¸‹æ•…éšœè½¬ç§»çš„åŸºæœ¬åŽŸç†ï¼š å¤šä¸ªsentinelå‘çŽ°å¹¶ç¡®è®¤masteræœ‰é—®é¢˜ é€‰ä¸¾å‡ºä¸€ä¸ªsentinelä½œä¸ºé¢†å¯¼ é€‰å‡ºä¸€ä¸ªå¯ä»¥æˆä¸ºæ–°çš„masterçš„slave é€šçŸ¥å…¶ä»–çš„slaveç§°ä¸ºæ–°çš„masterçš„slave é€šçŸ¥å®¢æˆ·ç«¯ä¸»ä»Žå˜åŒ– ç­‰å¾…è€çš„masterå¤æ´»ç§°ä¸ºæ–°çš„masterçš„slave ä¹Ÿæ”¯æŒå¤šä¸ªmaster-slaveç»“æž„ï¼š 2. å®‰è£…ä¸Žé…ç½® é…ç½®å¼€å¯ä¸»ä»ŽèŠ‚ç‚¹ é…ç½®å¼€å¯sentinelç›‘æŽ§ä¸»èŠ‚ç‚¹ï¼ˆsentinelæ˜¯ç‰¹æ®Šçš„redisï¼‰ å®žé™…åº”è¯¥å¤šå°æœºå™¨ï¼Œä½†æ˜¯æ¼”ç¤ºæ–¹ä¾¿ï¼Œåªç”¨ä¸€å°æœºå™¨æ¥æ­å»º è¯¦ç»†é…ç½®èŠ‚ç‚¹ æœ¬åœ°å®‰è£…çš„ç»“æž„å›¾ï¼š å¯¹äºŽmaster:redis-7000.confé…ç½®ï¼š 12345port 7000daemonize yespidfile /usr/local/redis/data/redis-7000.pidlogfile &quot;7000.log&quot;dir &quot;/usr/local/redis/data&quot; å¯¹äºŽslave:redis-7001å’Œredis-7002é…ç½®ï¼š 123456port 7001daemonize yespidfile /usr/local/redis/data/redis-7001.pidlogfile &quot;7001.log&quot;dir &quot;/usr/local/redis/data&quot;slaveof 127.0.0.1 7000 å¯åŠ¨redisæœåŠ¡ï¼š 1redis-server ../config/redis-7000.conf è®¿é—®7000ç«¯å£çš„master redis: 1redis-cli -p 7000 info replication æ˜¾ç¤ºä»–æœ‰ä¸¤ä¸ªä»ŽèŠ‚ç‚¹ï¼š 12345678910# Replicationrole:masterconnected_slaves:2slave0:ip=127.0.0.1,port=7002,state=online,offset=99550,lag=1slave1:ip=127.0.0.1,port=7001,state=online,offset=99816,lag=0master_repl_offset:99816repl_backlog_active:1repl_backlog_size:1048576repl_backlog_first_byte_offset:2repl_backlog_histlen:99815 å¯¹äºŽsentinelä¸»è¦é…ç½®ï¼š master sentinel config: 123456port 26379daemonize yesdir &quot;/usr/local/redis/data&quot;logfile &quot;26379.log&quot;sentinel monitor mymaster 127.0.0.1 7000 2... å¯åŠ¨redis sentinel: 1redis-sentinel ../config/redis-sentinel-26379.conf è®¿é—®26379 redis sentinel master: 1redis-cli -p 26379 info sentinel æ˜¾ç¤ºï¼š 123456# Sentinelsentinel_masters:1sentinel_tilt:0sentinel_running_scripts:0sentinel_scripts_queue_length:0master0:name=mymaster,status=ok,address=127.0.0.1:7000,slaves=2,sentinels=3 1æŸ¥çœ‹è¿™å…­ä¸ªè¿›ç¨‹æ˜¯å¦éƒ½èµ·æ¥äº†ï¼šps -ef | grep redis æ³¨æ„ï¼Œå¦‚æžœä¸Šé¢æ˜¯é…ç½®åœ¨è™šæ‹Ÿæœºçš„è¯ï¼Œéœ€è¦å°†127.0.0.1æ”¹ä¸ºè™šæ‹Ÿæœºçš„ipï¼Œè¦ä¸ç„¶æ‰¾ä¸ç€ã€‚ 3. æ•…éšœè½¬ç§»æ¼”ç»ƒ 3.1 javaå®¢æˆ·ç«¯ç¨‹åº JedisSentinelPoolåªæ˜¯ä¸€ä¸ªé…ç½®ä¸­å¿ƒï¼Œä¸éœ€è¦å…·ä½“è¿žæŽ¥æŸä¸ªredisï¼Œæ³¨æ„å®ƒä¸æ˜¯ä»£ç†ã€‚ 1234567891011121314151617181920212223242526272829303132333435private Logger logger = LoggerFactory.getLogger(AppTest.class);@Testpublic void test4()&#123; //å“¨å…µé…ç½®ï¼Œæˆ‘ä»¬è®¿é—®redisï¼Œå°±é€šè¿‡sentinelæ¥è®¿é—® String masername = "mymaster"; Set&lt;String&gt; sentinels = new HashSet&lt;&gt;(); sentinels.add("10.128.24.176:26379"); sentinels.add("10.128.24.176:26380"); sentinels.add("10.128.24.176:26381"); JedisSentinelPool sentinelPool = new JedisSentinelPool(masername,sentinels); //ä¸€ä¸ªwhileæ­»å¾ªçŽ¯ï¼Œæ¯éš”ä¸€ç§’å¾€masterå¡žå…¥ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”æ—¥å¿—æ‰“å° while (true)&#123; Jedis jedis = null; try&#123; jedis = sentinelPool.getResource(); int index = new Random().nextInt(100000); String key = "k-" + index; String value = "v-" + index; jedis.set(key,value); logger.info("&#123;&#125; value is &#123;&#125;",key,jedis.get(key)); TimeUnit.MILLISECONDS.sleep(1000); &#125;catch (Exception e)&#123; logger.error(e.getMessage(),e); &#125;finally &#123; if(jedis != null)&#123; jedis.close(); &#125; &#125; &#125;&#125; mavenä¾èµ–æ˜¯ï¼š 123456789101112131415161718&lt;!--jedis--&gt;&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;!--slf4jæ—¥å¿—æŽ¥å£--&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.6&lt;/version&gt;&lt;/dependency&gt;&lt;!--logbackæ—¥å¿—å®žçŽ°--&gt;&lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.1.1&lt;/version&gt;&lt;/dependency&gt; å¯åŠ¨ç¨‹åºï¼Œå‘çŽ°æ˜¯æ­£å¸¸å†™å…¥ï¼š 123456789101112131416:16:01.424 [main] INFO com.njupt.swg.AppTest - k-54795 value is v-5479516:16:02.426 [main] INFO com.njupt.swg.AppTest - k-55630 value is v-5563016:16:03.429 [main] INFO com.njupt.swg.AppTest - k-70642 value is v-7064216:16:04.430 [main] INFO com.njupt.swg.AppTest - k-42978 value is v-4297816:16:05.431 [main] INFO com.njupt.swg.AppTest - k-96297 value is v-9629716:16:06.433 [main] INFO com.njupt.swg.AppTest - k-4220 value is v-422016:16:07.435 [main] INFO com.njupt.swg.AppTest - k-34103 value is v-3410316:16:08.436 [main] INFO com.njupt.swg.AppTest - k-9177 value is v-917716:16:09.437 [main] INFO com.njupt.swg.AppTest - k-24389 value is v-2438916:16:10.439 [main] INFO com.njupt.swg.AppTest - k-32325 value is v-3232516:16:11.440 [main] INFO com.njupt.swg.AppTest - k-68538 value is v-6853816:16:12.441 [main] INFO com.njupt.swg.AppTest - k-36233 value is v-3623316:16:13.443 [main] INFO com.njupt.swg.AppTest - k-305 value is v-30516:16:14.444 [main] INFO com.njupt.swg.AppTest - k-59279 value is v-59279 æˆ‘ä»¬å°†çŽ°åœ¨çš„ç«¯å£ä¸º7000çš„redis master ç»™killæŽ‰ kill -9 masterçš„pid æˆ‘ä»¬ä¼šå‘çŽ°ï¼šå®¢æˆ·ç«¯æŠ¥å¼‚å¸¸ï¼Œä½†æ˜¯åœ¨å¤§æ¦‚åå‡ ç§’ä¹‹åŽï¼Œå°±ç»§ç»­æ­£å¸¸å¡žå€¼äº†ã€‚åŽŸå› æ˜¯æœåŠ¡ç«¯çš„å“¨å…µæœºåˆ¶çš„é€‰ä¸¾matseréœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚ 4. ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡ 4.1 æ¯10ç§’æ¯ä¸ªsentinelå¯¹masterå’Œslaveæ‰§è¡ŒInfo å‘çŽ°slaveèŠ‚ç‚¹ ç¡®è®¤ä¸»ä»Žå…³ç³» 4.2 æ¯2ç§’æ¯ä¸ªsentinelé€šè¿‡masterèŠ‚ç‚¹çš„channeläº¤æ¢ä¿¡æ¯(pub/sub) é€šè¿‡__sentinel__:helloè¿›è¡Œé¢‘é“äº¤äº’ äº¤äº’å¯¹èŠ‚ç‚¹çš„â€œçœ‹æ³•â€å’Œè‡ªèº«ä¿¡æ¯ 4.3 æ¯1ç§’æ¯ä¸ªsentinelå¯¹å…¶ä»–sentinelå’Œredisæ‰§è¡Œping å¿ƒè·³ç›‘æµ‹ï¼Œå¤±è´¥åˆ¤å®šä¾æ® 5. ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ å¯¹äºŽä¹‹å‰çš„Sentinelé…ç½®æ–‡ä»¶ä¸­æœ‰ä¸¤æ¡é…ç½®ï¼š ç›‘æŽ§master redisèŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¯å½“è¶…è¿‡ä¸¤ä¸ªsentinelè®¤ä¸ºmasteræŒ‚äº†ï¼Œåˆ™è®¤ä¸ºmasteræŒ‚äº†ã€‚ sentinel monitor &lt;masterName&gt; &lt;masterIp&gt; &lt;msterPort&gt; &lt;quorum&gt; sentinel monitor mymaster 127.0.0.1 6379 2 è¿™é‡Œæ˜¯æ¯ç§’sentineléƒ½ä¼šåŽ»Pingå‘¨å›´çš„master redisï¼Œè¶…è¿‡30ç§’æ²¡æœ‰ä»»ä½•å“åº”ï¼Œè¯´æ˜Žå…¶æŒ‚äº†ã€‚ sentinel down-after-milliseconds &lt;masterName&gt; &lt;timeout&gt; sentinel down-after-milliseconds mymaster 300000 5.1 ä¸»è§‚ä¸‹çº¿ ä¸»è§‚ä¸‹çº¿ï¼šæ¯ä¸ªsentinelèŠ‚ç‚¹å¯¹RedisèŠ‚ç‚¹å¤±è´¥çš„â€œåè§â€ è¿™æ˜¯ä¸€ç§ä¸»è§‚ä¸‹çº¿ã€‚å› ä¸ºåœ¨å¤æ‚çš„ç½‘ç»œçŽ¯å¢ƒä¸‹ï¼Œè¿™ä¸ªsentinelä¸Žè¿™ä¸ªmasterä¸é€šï¼Œä½†æ˜¯masterä¸Žå…¶ä»–çš„sentineléƒ½æ˜¯é€šçš„å‘¢ï¼Ÿæ‰€ä»¥æ˜¯ä¸€ç§â€œåè§â€ è¿™æ˜¯ä¾é çš„ç¬¬ä¸‰ç§å®šæ—¶ï¼šæ¯ç§’åŽ»pingä¸€ä¸‹å‘¨å›´çš„sentinelå’Œredisã€‚å¯¹äºŽslave redis,å¯ä»¥ä½¿ç”¨è¿™ä¸ªä¸»è§‚ä¸‹çº¿ï¼Œå› ä¸ºä»–ä¸éœ€è¦è¿›è¡Œæ•…éšœè½¬ç§»ã€‚ 5.2 å®¢è§‚ä¸‹çº¿ å®¢è§‚ä¸‹çº¿ï¼šæ‰€æœ‰sentinelèŠ‚ç‚¹å¯¹master RedisèŠ‚ç‚¹å¤±è´¥â€œè¾¾æˆå…±è¯†â€ï¼ˆè¶…è¿‡quorumä¸ªåˆ™ç»Ÿä¸€ï¼‰ è¿™æ˜¯ä¾é çš„ç¬¬äºŒç§å®šæ—¶ï¼šæ¯ä¸¤ç§’ï¼Œsentinelä¹‹é—´è¿›è¡Œâ€œå•†é‡â€ï¼Œä¼ é€’çš„æ¶ˆæ¯æ˜¯:sentinel is-master-down-by-addr å¯¹äºŽmaster redisçš„ä¸‹çº¿ï¼Œå¿…é¡»è¦è¾¾æˆå…±è¯†æ‰å¯ä»¥ï¼Œå› ä¸ºæ¶‰åŠæ•…éšœè½¬ç§»ï¼Œä»…ä»…ä¾é ä¸€ä¸ªsentinelåˆ¤æ–­æ˜¯ä¸å¤Ÿçš„ã€‚ 6. é¢†å¯¼è€…é€‰ä¸¾ åŽŸå› ï¼šåªæœ‰ä¸€ä¸ªsentinelèŠ‚ç‚¹å®Œæˆæ•…éšœè½¬ç§» é€‰ä¸¾ï¼šé€šè¿‡sentinel is-master-down-by-addrå‘½ä»¤éƒ½å¸Œæœ›æˆä¸ºé¢†å¯¼è€… æ¯ä¸ªåšä¸»è§‚ä¸‹çº¿çš„sentinelèŠ‚ç‚¹å‘å…¶ä»–sentinelèŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè¦æ±‚å°†å®ƒè®¾ç½®ä¸ºé¢†å¯¼è€… æ”¶åˆ°å‘½ä»¤çš„sentinelèŠ‚ç‚¹å¦‚æžœè¿˜æ²¡æœ‰åŒæ„è¿‡å…¶ä»–semtinelèŠ‚ç‚¹å‘é€çš„å‘½ä»¤ï¼Œé‚£ä¹ˆå°†åŒæ„è¯¥è¯·æ±‚ï¼Œå¦åˆ™æ‹’ç» å¦‚æžœè¯¥sentinelèŠ‚ç‚¹å‘çŽ°è‡ªå·±çš„ç¥¨æ•°å·²ç»è¶…è¿‡sentinelé›†åˆåŠæ•°å¹¶ä¸”è¶…è¿‡quorumï¼Œé‚£ä¹ˆå®ƒå°†æˆä¸ºé¢†å¯¼è€…ã€‚ å¦‚æžœæ­¤è¿‡ç¨‹ä¸­å¤šä¸ªsentinelèŠ‚ç‚¹æˆä¸ºäº†é¢†å¯¼è€…ï¼Œé‚£ä¹ˆå°†ç­‰å¾…ä¸€æ®µæ—¶é—´é‡æ–°è¿›è¡Œé€‰ä¸¾ 7. æ•…éšœè½¬ç§» ä»ŽslaveèŠ‚ç‚¹ä¸­é€‰å‡ºä¸€ä¸ªâ€œåˆé€‚çš„â€èŠ‚ç‚¹ä½œä¸ºæ–°çš„masterèŠ‚ç‚¹ å¯¹ä¸Šè¿°çš„slaveèŠ‚ç‚¹æ‰§è¡Œâ€œslaveof no oneâ€å‘½ä»¤ä½¿å…¶æˆä¸ºmasterèŠ‚ç‚¹ å‘å‰©ä½™çš„slaveèŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè®©å®ƒä»¬æˆä¸ºæ–°masterèŠ‚ç‚¹çš„slaveèŠ‚ç‚¹ï¼Œå¤åˆ¶è§„åˆ™å’Œparallel-syncså‚æ•°ä¸€æ · æ›´æ–°å¯¹åŽŸæ¥çš„masterèŠ‚ç‚¹é…ç½®ä¸ºslaveï¼Œå¹¶ä¿æŒç€å¯¹å…¶â€œå…³æ³¨â€ï¼Œå½“æ¢å¤åŽå‘½ä»¤ä»–åŽ»å¤åˆ¶æ–°çš„masterèŠ‚ç‚¹ é‚£ä¹ˆï¼Œå¦‚ä½•é€‰æ‹©â€œåˆé€‚â€çš„slaveèŠ‚ç‚¹å‘¢ï¼Ÿ é€‰æ‹©slave-priority(slaveèŠ‚ç‚¹ä¼˜å…ˆçº§)æœ€é«˜çš„slaveèŠ‚ç‚¹ï¼Œå¦‚æžœå­˜åœ¨åˆ™è¿”å›žï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ã€‚ é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„slaveèŠ‚ç‚¹(å¤åˆ¶å¾—æœ€å®Œæ•´)ï¼Œå¦‚æžœå­˜åœ¨åˆ™è¿”å›žï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ é€‰æ‹©run_idæœ€å°çš„slaveèŠ‚ç‚¹(æœ€æ—©çš„èŠ‚ç‚¹) 8. èŠ‚ç‚¹ä¸‹çº¿ ä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼šsentinel failover &lt;masterName&gt; ä»ŽèŠ‚ç‚¹ä¸‹çº¿è¦æ³¨æ„è¯»å†™åˆ†ç¦»é—®é¢˜ã€‚ 9. æ€»ç»“ä¸Žæ€è€ƒ redis sentinelæ˜¯redisé«˜å¯ç”¨å®žçŽ°æ–¹æ¡ˆï¼šæ•…éšœå‘çŽ°ã€æ•…éšœè‡ªåŠ¨è½¬ç§»ã€é…ç½®ä¸­å¿ƒã€å®¢æˆ·ç«¯é€šçŸ¥ã€‚ redis sentinelä»Žredis2.8ç‰ˆæœ¬æ‰æ­£å¼ç”Ÿäº§å¯ç”¨ï¼Œä¹‹å‰ç‰ˆæœ¬ä¸å¯ç”Ÿäº§ç”¨ã€‚ å°½å¯èƒ½åœ¨ä¸åŒç‰©ç†æœºä¸Šéƒ¨ç½²redis sentinelæ‰€æœ‰èŠ‚ç‚¹ã€‚ redis sentinelä¸­çš„sentinelèŠ‚ç‚¹ä¸ªæ•°åº”è¯¥å¤§äºŽç­‰äºŽ3ä¸”æœ€å¥½æ˜¯å¥‡æ•°ã€‚ redis sentinelä¸­çš„æ•°æ®èŠ‚ç‚¹å’Œæ™®é€šæ•°æ®èŠ‚ç‚¹æ²¡æœ‰åŒºåˆ«ã€‚æ¯ä¸ªsentinelèŠ‚ç‚¹åœ¨æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªrediså®žä¾‹ï¼Œåªä¸è¿‡å’Œredisæ•°æ®èŠ‚ç‚¹ä¸åŒçš„æ˜¯ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ç›‘æŽ§redisæ•°æ®èŠ‚ç‚¹ å®¢æˆ·ç«¯åˆå§‹åŒ–æ—¶è¿žæŽ¥çš„æ˜¯sentinelèŠ‚ç‚¹é›†åˆï¼Œä¸å†æ˜¯å…·ä½“çš„redisèŠ‚ç‚¹ï¼Œä½†sentinelåªæ˜¯é…ç½®ä¸­å¿ƒä¸æ˜¯ä»£ç†ã€‚ redis sentinelé€šè¿‡ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡å®žçŽ°äº†sentinelèŠ‚ç‚¹å¯¹äºŽä¸»èŠ‚ç‚¹ã€ä»ŽèŠ‚ç‚¹ã€å…¶ä½™sentinelèŠ‚ç‚¹çš„ç›‘æŽ§ã€‚ redis sentinelåœ¨å¯¹èŠ‚ç‚¹åšå¤±è´¥åˆ¤å®šæ—¶åˆ†ä¸ºä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ã€‚ çœ‹æ‡‚redis sentinelæ•…éšœè½¬ç§»æ—¥å¿—å¯¹äºŽredis sentinelä»¥åŠé—®é¢˜æŽ’æŸ¥éžå¸¸æœ‰ç”¨ã€‚ redis sentinelå®žçŽ°è¯»å†™åˆ†ç¦»é«˜å¯ç”¨å¯ä»¥ä¾èµ–sentinelèŠ‚ç‚¹çš„æ¶ˆæ¯é€šçŸ¥ï¼ŒèŽ·å–redisæ•°æ®èŠ‚ç‚¹çš„çŠ¶æ€å˜åŒ–ã€‚ redis sentinelå¯ä»¥å®žçŽ°é«˜å¯ç”¨çš„è¯»å†™åˆ†ç¦»ï¼Œé«˜å¯ç”¨ä½“çŽ°åœ¨æ•…éšœè½¬ç§»ï¼Œé‚£ä¹ˆå®žçŽ°é«˜å¯ç”¨çš„åŸºç¡€å°±æ˜¯è¦æœ‰ä»ŽèŠ‚ç‚¹ï¼Œä¸»ä»ŽèŠ‚ç‚¹è¿˜å®žçŽ°äº†è¯»å†™åˆ†ç¦»ï¼Œå‡å°‘masterçš„åŽ‹åŠ›ã€‚ä½†æ˜¯å¦‚æžœæ˜¯ä»ŽèŠ‚ç‚¹ä¸‹çº¿äº†ï¼Œsentinelæ˜¯ä¸ä¼šå¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»çš„ï¼Œå¹¶ä¸”è¿žæŽ¥ä»ŽèŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¹Ÿæ— æ³•èŽ·å–åˆ°æ–°çš„å¯ç”¨ä»ŽèŠ‚ç‚¹ï¼Œè€Œè¿™äº›é—®é¢˜åœ¨Clusterä¸­éƒ½å¾—åˆ°äº†æœ‰æ•ˆçš„è§£å†³ã€‚ å¯¹äºŽæ€§èƒ½æé«˜ã€å®¹é‡æ‰©å±•çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ¯”è¾ƒæŽ¨èçš„æ˜¯ä½¿ç”¨é›†ç¾¤ï¼Œå°±æ˜¯ä¸‹é¢è®¨è®ºçš„redis cluster!]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°å€¼è®¡ç®—ç²¾åº¦ä¸¢å¤±é—®é¢˜]]></title>
    <url>%2F2019%2F01%2F31%2Fmiscellany%2F14%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æ— è®ºåœ¨ä»€ä¹ˆä¸šåŠ¡ä¸­ï¼Œé’±æ˜¯éžå¸¸é‡è¦çš„ä¸œè¥¿ï¼Œå¯¹è´¦çš„æ—¶å€™ä¸€å®šè¦å¯¹çš„ä¸Šï¼Œä¸èƒ½è¿™è¾¹å°‘ä¸€åˆ†é‚£è¾¹å¤šä¸€åˆ†ã€‚å¯¹äºŽæ•°å€¼çš„è®¡ç®—ï¼Œå°¤å…¶æ˜¯å°æ•°ï¼Œdoubleå’Œdoubleéƒ½æ˜¯ç¦æ­¢ä½¿ç”¨çš„ã€‚ é˜¿é‡Œå¼ºåˆ¶è¦æ±‚å­˜æ”¾å°æ•°æ—¶ä½¿ç”¨ decimalï¼Œç¦æ­¢ä½¿ç”¨ float å’Œ doubleã€‚ è¯´æ˜Žï¼šfloat å’Œ double åœ¨å­˜å‚¨çš„æ—¶å€™ï¼Œå­˜åœ¨ç²¾åº¦æŸå¤±çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½åœ¨å€¼çš„æ¯”è¾ƒæ—¶ï¼Œå¾—åˆ°ä¸æ­£ç¡®çš„ç»“æžœã€‚å¦‚æžœå­˜å‚¨çš„æ•°æ®èŒƒå›´è¶…è¿‡ decimal çš„èŒƒå›´ï¼Œå»ºè®®å°†æ•°æ®æ‹†æˆæ•´æ•°å’Œå°æ•°åˆ†å¼€å­˜å‚¨ã€‚ å¤„ç†æ–¹å¼å¯ä»¥ä¸ºï¼šmysql å¯ä»¥ç”¨ decimal ï¼Œå¦‚æžœä½ æ˜¯ç”¨ javaï¼Œ åœ¨å•†ä¸šè®¡ç®—ä¸­æˆ‘ä»¬è¦ç”¨ java.math.BigDecimalï¼Œæ³¨æ„ï¼šå¦‚æžœéœ€è¦ç²¾ç¡®è®¡ç®—ï¼Œéžè¦ç”¨Stringæ¥å¤Ÿé€ BigDecimalä¸å¯ï¼ é‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ ä¸€ä¸ªä¾‹å­è¯´æ˜Ž åºŸè¯ä¸å¤šè¯´ï¼Œä¸Šå›¾ï¼š é—®é¢˜åŽŸå›  æ— è®ºæ˜¯æˆ‘ä»¬æœ¬æ–‡æåˆ°çš„doubleï¼Œè¿˜æ˜¯floatï¼Œéƒ½æ˜¯æµ®ç‚¹æ•°ã€‚ åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæµ®ç‚¹ï¼ˆè‹±è¯­ï¼šfloating pointï¼Œç¼©å†™ä¸ºFPï¼‰æ˜¯ä¸€ç§å¯¹äºŽå®žæ•°çš„è¿‘ä¼¼å€¼æ•°å€¼è¡¨çŽ°æ³•ï¼Œç”±ä¸€ä¸ªæœ‰æ•ˆæ•°å­—ï¼ˆå³å°¾æ•°ï¼‰åŠ ä¸Šå¹‚æ•°æ¥è¡¨ç¤ºï¼Œé€šå¸¸æ˜¯ä¹˜ä»¥æŸä¸ªåŸºæ•°çš„æ•´æ•°æ¬¡æŒ‡æ•°å¾—åˆ°ã€‚ä»¥è¿™ç§è¡¨ç¤ºæ³•è¡¨ç¤ºçš„æ•°å€¼ï¼Œç§°ä¸ºæµ®ç‚¹æ•°ï¼ˆfloating-point numberï¼‰ã€‚ å…¶å®žæˆ‘è§‰å¾—å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œè®¡ç®—æœºè®¡ç®—åŠ å‡ä¹˜é™¤å•Šï¼Œéƒ½æ˜¯ç”¨çš„åŠ æ³•å™¨ï¼Œå®žè´¨éƒ½æ˜¯äºŒè¿›åˆ¶çš„åŠ æ³•å¤„ç†ã€‚é‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸€ä¸ªäºŒè¿›åˆ¶è¡¨ç¤ºçš„é—®é¢˜ã€‚è¯•æƒ³ï¼Œ4ï¼Œ2ï¼Œ8ä¹‹æµéƒ½æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Œå¯ä»¥å®Œç¾Žç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œè®¡ç®—å½“ç„¶ä¸ä¼šå‡ºçŽ°é—®é¢˜ã€‚å¯¹äºŽ0ï¼Œ1ï¼Œ3ï¼Œ5ä¹‹ç±»ä¹Ÿéƒ½å¯ä»¥ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥ï¼Œæ­£æ•°è‚¯å®šæ˜¯æ²¡é—®é¢˜çš„ã€‚ ä½†æ˜¯å¯¹äºŽå°æ•°å‘¢ï¼Ÿ1ã€0.5ã€0.25é‚£éƒ½æ˜¯å¯ä»¥è½¬æ¢æˆäºŒè¿›åˆ¶çš„å°æ•°ï¼Œå¦‚åè¿›åˆ¶çš„0.1ï¼Œå°±æ— æ³•ç”¨äºŒè¿›åˆ¶å‡†ç¡®çš„è¡¨ç¤ºå‡ºæ¥ã€‚å› æ­¤åªèƒ½ä½¿ç”¨è¿‘ä¼¼å€¼çš„æ–¹å¼è¡¨è¾¾ã€‚ å¦‚æžœæˆ‘ä»¬å°è¯•ç€æŠŠ10è¿›åˆ¶çš„0.1è½¬åŒ–æˆäºŒè¿›åˆ¶ï¼Œä¼šæ€Žä¹ˆè½¬å‘¢ï¼Ÿ åœ¨åè¿›åˆ¶ä¸­ï¼Œ0.1å¦‚ä½•è®¡ç®—å‡ºæ¥çš„å‘¢ï¼Ÿ 0.1 = 1 Ã· 10 é‚£ä¹ˆäºŒè¿›åˆ¶ä¸­ä¹Ÿæ˜¯åŒç†ï¼š 1 Ã· 1010 æˆ‘ä»¬å›žåˆ°å°å­¦çš„è¯¾å ‚ï¼Œæ¥åˆ—ç«–å¼å§ï¼š 123456789101112131415 0.000110011... ------------------1010 ) 1 0000 1010 ------ 1100 1010 ---- 10000 1010 ----- 1100 1010 ---- 10 å¾ˆæ˜¾ç„¶ï¼Œé™¤ä¸å°½ï¼Œé™¤å‡ºäº†ä¸€ä¸ªæ— é™å¾ªçŽ¯å°æ•°ï¼šäºŒè¿›åˆ¶çš„ 0.0001100110011â€¦ é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºè¿™ä¸ªæ— é™ä¸å¾ªçŽ¯çš„å°æ•°å‘¢ï¼Ÿåªèƒ½è€ƒè™‘æŒ‰ç…§ä¸åŒçš„ç²¾åº¦ä¿ç†ä¸åŒçš„ä½æ•°ã€‚ æˆ‘ä»¬çŸ¥é“floatæ˜¯å•ç²¾åº¦çš„ï¼Œdoubleæ˜¯åŒç²¾åº¦çš„ã€‚ä¸åŒçš„ç²¾åº¦ï¼Œå…¶å®žå°±æ˜¯ä¿ç•™çš„æœ‰æ•ˆæ•°å­—ä½æ•°ä¸åŒï¼Œä¿ç•™çš„ä½æ•°è¶Šå¤šï¼Œç²¾åº¦è¶Šé«˜ã€‚ æ‰€ä»¥ï¼Œæµ®ç‚¹æ•°åœ¨Javaä¸­æ˜¯æ— æ³•ç²¾ç¡®è¡¨ç¤ºçš„ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æµ®ç‚¹æ•°è½¬æ¢æˆäºŒè¿›åˆ¶æ˜¯ä¸€ä¸ªæ— é™ä¸å¾ªçŽ¯çš„å°æ•°ï¼Œåªèƒ½é€šè¿‡ä¿ç•™ç²¾åº¦çš„æ–¹å¼è¿›è¡Œè¿‘ä¼¼è¡¨ç¤ºã€‚ é—®é¢˜çš„è§£å†³ String æž„é€ æ–¹æ³•æ˜¯å®Œå…¨å¯é¢„çŸ¥çš„ï¼šå†™å…¥ newBigDecimal(&quot;0.1&quot;) å°†åˆ›å»ºä¸€ä¸ª BigDecimalï¼Œå®ƒæ­£å¥½ç­‰äºŽé¢„æœŸçš„ 0.1ã€‚å› æ­¤ï¼Œæ¯”è¾ƒè€Œè¨€ï¼Œé€šå¸¸å»ºè®®ä¼˜å…ˆä½¿ç”¨Stringæž„é€ æ–¹æ³•ã€‚ ä½¿ç”¨BigDecimal(String val)ï¼ 123456789101112131415161718192021222324252627//åŠ æ³•public static BigDecimal add(double v1, double v2)&#123; BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.add(b2);&#125;//å‡æ³•public static BigDecimal sub(double v1,double v2)&#123; BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.subtract(b2);&#125;//ä¹˜æ³•public static BigDecimal mul(double v1,double v2)&#123; BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.multiply(b2);&#125;//é™¤æ³•public static BigDecimal div(double v1,double v2)&#123; BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.divide(b2,2,BigDecimal.ROUND_HALF_UP);//å››èˆäº”å…¥,ä¿ç•™2ä½å°æ•°,åº”å¯¹é™¤ä¸å°½çš„æƒ…å†µ&#125; é‚£ä¹ˆï¼Œä¸Šé¢çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜å°±è¿Žåˆƒè€Œè§£äº†ã€‚ä½†æ˜¯é™¤ä¸å°½æ€Žä¹ˆåŠžï¼Ÿæ¯”å¦‚10.0é™¤ä»¥è¿™é‡Œçš„3.0ï¼Œä¿ç•™å°æ•°ç‚¹åŽä¸‰ä½æœ‰æ•ˆæ•°å­—ï¼š é‚£ä¹ˆï¼Œæ¯ä¸ªç”¨æˆ·å¾—åˆ°çš„éƒ½æ˜¯3.333å…ƒï¼Œä¸‰ä¸ªç”¨æˆ·åŠ èµ·æ¥æ˜¯å¾—ä¸åˆ°10å—é’±çš„ã€‚ å¯¹äºŽé™¤æ³•ï¼Œå§‹ç»ˆä¼šäº§ç”Ÿé™¤ä¸å°½çš„æƒ…å†µæ€Žä¹ˆåŠžï¼Ÿæœ‰ä¸ªè¯å«è½§å·® ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸¾ä¸ªç®€å•ä¾‹å­ã€‚å‡å¦‚çŽ°åœ¨éœ€è¦æŠŠ10å…ƒåˆ†æˆ3åˆ†ï¼Œå¦‚æžœæ˜¯10é™¤ä»¥3è¿™ä¹ˆé™¤ï¼Œä¼šå‘çŽ°ä¸º3.33333æ— ç©·å°½çš„3ã€‚è¿™äº›æ•°å­—å®Œå…¨æ— æ³•åœ¨ç¨‹åºæˆ–æ•°æ®åº“ä¸­è¿›è¡Œç²¾ç¡®çš„å­˜å‚¨ã€‚ ç®€å•ç†è§£å°±æ˜¯ï¼Œå½“é™¤ä¸å°½æˆ–éœ€åŽ»é™¤å°æ•°ç‚¹çš„æ—¶å€™ï¼Œå‰é¢çš„n-1ç¬”ï¼ˆè¿™é‡Œn=3ï¼‰åšå››èˆäº”å…¥ã€‚æœ€åŽä¸€ç¬”åšå…œåº•ï¼ˆæ€»é‡‘é¢å‡åŽ»å‰é¢n-1ç¬”ä¹‹å’Œï¼‰ã€‚è¿™æ ·ä¿è¯æ€»é‡‘é¢çš„ä¸ä¼šä¸¢å¤±ã€‚ æ¯”å¦‚10å—é’±ï¼Œä¸‰ä¸ªç”¨æˆ·åˆ†ï¼Œå‰é¢ä¸¤ä¸ªç”¨æˆ·åªèƒ½å„åˆ†åˆ°3ã€‚333å—é’±ï¼Œæœ€åŽä¸€ä¸ªç”¨æˆ·åˆ†åˆ°3.334å—é’±ã€‚ä¿è¯æ€»é¢ä¸å˜ã€‚ è‡³äºŽåŽŸç†ï¼Œæœ‰ä¸€ç‚¹ç‚¹æ•°å­¦åŒ–ï¼Œä»¥åŽå†ä½œæŽ¢è®¨å§ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisä¸»ä»Žå¤åˆ¶]]></title>
    <url>%2F2019%2F01%2F31%2Fredis%2FRedis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬å…­ç¯‡æ–‡ç« ã€‚ä»‹ç»redisä¸»ä»Žå¤åˆ¶åŠŸèƒ½å®žçŽ°åŽŸç†ã€‚ä½œä¸ºé«˜å¯ç”¨çš„åŸºç¡€ï¼Œäº†è§£ä¸€ä¸‹å…¶ä¸­çš„é—¨é“æ˜¯æœ‰å¿…è¦çš„ã€‚ 1.å•æœºæœ‰ä»€ä¹ˆé—®é¢˜ æœºå™¨æ•…éšœ å®¹é‡ç“¶é¢ˆ QPSç“¶é¢ˆ 2. ä¸»ä»Žå¤åˆ¶çš„ä½œç”¨ æ•°æ®å‰¯æœ¬ æ‰©å±•è¯»æ€§èƒ½ï¼Œslaveä¸“é—¨ç”¨æ¥è¯» ä¸€ä¸ªmasterå¯ä»¥æœ‰å¤šä¸ªslaveï¼Œä¸€ä¸ªsalveåªèƒ½æœ‰ä¸€ä¸ªmaster 3. ä¸¤ç§å®žçŽ°æ–¹å¼ æ–¹å¼ä¸€ï¼šslaveofå‘½ä»¤ slaveof masterIp masterPort slaveof no one(ä¸ä¼šæ¸…é™¤åŽŸæ¥åŒæ­¥çš„æ•°æ®ï¼Œè€Œæ˜¯æ–°çš„æ•°æ®ä¸ä¼šå†åŒæ­¥ç»™ä»–) æ–¹å¼äºŒï¼šé…ç½® ä¿®æ”¹æŸä¸€è¡Œçš„é…ç½®ï¼šslaveof ip port ä»ŽèŠ‚ç‚¹åªåšè¯»æ“ä½œï¼šslave-read-only yes å¯¹æ¯” å‘½ä»¤çš„ä¼˜ç‚¹ï¼šä¸éœ€è¦é‡å¯ å‘½ä»¤çš„ç¼ºç‚¹ï¼šä¸ä¾¿äºŽç®¡ç† é…ç½®çš„ä¼˜ç‚¹ï¼šç»Ÿä¸€é…ç½® é…ç½®çš„ç¼ºç‚¹ï¼šéœ€è¦é‡å¯ ä¸€ä¸ªåœºæ™¯ï¼Œå‡å¦‚6380æ˜¯6379çš„ä¸€ä¸ªä»ŽèŠ‚ç‚¹ï¼Œç„¶åŽå°†6380æ‰§è¡Œsalveof no oneï¼Œç„¶åŽæ’å…¥ä¸€äº›æ–°çš„æ•°æ®ï¼›å†é‡æ–°å˜æˆ6379çš„ä»ŽèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé‡Œé¢çš„æ–°æ•°æ®ä¼šè¢«æ¸…é™¤æŽ‰ã€‚ æŸ¥çœ‹run_id redis-cli -p 6379 info server | grep run 4. å…¨é‡å¤åˆ¶ å…¨é‡å¤åˆ¶å¼€é”€ bgsaveæ—¶é—´ rdbç½‘ç»œä¼ è¾“æ—¶é—´ ä»ŽèŠ‚ç‚¹æ¸…ç©ºæ•°æ®çš„æ—¶é—´ ä»ŽèŠ‚ç‚¹åŠ è½½RDBçš„æ—¶é—´ å¯èƒ½çš„AOFé‡å†™æ—¶é—´ å­˜åœ¨çš„é—®é¢˜ æ—¶é—´å¼€é”€æ¯”è¾ƒå¤§ å¦‚æžœmasterå’Œslaveä¹‹é—´ç½‘ç»œæ‰°åŠ¨ç”šè‡³æ–­å¼€ï¼Œé‚£ä¹ˆmasteræ­¤é—´æ›´æ–°çš„æ•°æ®å¯¹äºŽslaveæ˜¯ä¸çŸ¥é“çš„ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å†è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œä½†æ˜¯æ˜¾ç„¶ï¼Œæ¶ˆè€—å¤ªå¤§äº†ã€‚ 5. éƒ¨åˆ†å¤åˆ¶ 6. å¼€å‘ä¸Žè¿ç»´çš„é—®é¢˜ è¯»å†™åˆ†ç¦» masteråªåšå†™æ“ä½œï¼Œslaveæ¥åšè¯»æ“ä½œï¼Œæ¥åˆ†æ‘Šæµé‡ã€‚ä½†æ˜¯ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼š å¤åˆ¶æ•°æ®å»¶è¿Ÿ è¯»åˆ°è¿‡æœŸæ•°æ® ä»ŽèŠ‚ç‚¹æ•…éšœ ä¸»ä»Žé…ç½®ä¸ä¸€è‡´ ä¾‹å¦‚maxmemoryä¸ä¸€è‡´ï¼šä¸¢å¤±æ•°æ® æ•°æ®ç»“æž„ä¼˜åŒ–å‚æ•°ï¼šå†…å­˜ä¸ä¸€è‡´ è§„é¿å…¨é‡å¤åˆ¶ ç¬¬ä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼šä¸å¯é¿å…â€”å°ä¸»èŠ‚ç‚¹(maxmemroyä¸è¦å¤ªå¤§)æˆ–è€…åœ¨ä½Žå³°æ—¶è¿›è¡Œæ“ä½œ èŠ‚ç‚¹run_idä¸åŒ¹é…ï¼ˆä¸»èŠ‚ç‚¹é‡å¯ï¼Œé‚£ä¹ˆmasterçš„run_idä¼šå‘ç”Ÿå˜åŒ–ï¼Œslaveå‘çŽ°å…¶run_idå˜åŒ–ï¼Œä¼šè¿›è¡Œå…¨é‡å¤åˆ¶ï¼‰ï¼›æˆ‘ä»¬å¯ä»¥ç”¨æ•…éšœè½¬ç§»ï¼Œä¾‹å¦‚å“¨å…µæˆ–é›†ç¾¤æ¥é¿å…å…¨é‡å¤åˆ¶ã€‚ å¤åˆ¶ç§¯åŽ‹ç¼“å†²åŒºä¸è¶³(ç½‘ç»œä¸­æ–­ï¼Œéƒ¨åˆ†å¤åˆ¶æ— æ³•æ»¡è¶³)ï¼Œå¯ä»¥å¢žå¤§å¤åˆ¶ç¼“å†²åŒºé…ç½®sizeï¼Œç½‘ç»œå¢žå¼º è§„é¿å¤åˆ¶é£Žæš´ æ¦‚å¿µï¼šä¸»èŠ‚ç‚¹å®•æœºé€ æˆå¤§é‡çš„å…¨é‡å¤åˆ¶ å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£Žæš´ï¼šä¸»èŠ‚ç‚¹é‡å¯ï¼Œå¤šä»ŽèŠ‚ç‚¹å¤åˆ¶ï¼›è§£å†³ï¼šæ›´æ¢å¤åˆ¶æ‹“æ‰‘ å•æœºå™¨å¤åˆ¶é£Žæš´ï¼šæœºå™¨å®•æœºåŽï¼ˆè¯¥æœºå™¨å…¨æ˜¯Materï¼‰ï¼Œå¤§é‡å…¨é‡å¤åˆ¶ã€‚è§£å†³ï¼šmasteråˆ†æ•£å¤šæœºå™¨ã€‚ è¯´åˆ°åº•ï¼Œè¿˜æ˜¯éœ€è¦æœ‰ä¸€ç§é«˜å¯ç”¨çš„å®žçŽ°æ–¹å¼ï¼Œåœ¨masterå‡ºçŽ°æ•…éšœä¹‹åŽï¼Œå¦‚ä½•è‡ªåŠ¨å®žçŽ°ä»Žslaveæ™‹å‡ä¸ºmasterç»§ç»­ä½¿ç”¨.è€Œä¸æ˜¯ä¸€ç›´æ­»å®ˆç€åŽŸæ¥è€çš„masterä¸æ”¾ï¼Œå› ä¸ºè€çš„masterå•¥æ—¶å€™æ¢å¤ä¸çŸ¥é“ï¼Œæ¢å¤äº†å¯èƒ½ä¼šé€ æˆå¤åˆ¶é£Žæš´ï¼Œæ—¢ç„¶ä»ŽèŠ‚ç‚¹æœ¬æ¥æ˜¯ä¸€ç›´ä¸ŽmasterèŠ‚ç‚¹ä¿æŒå°½é‡çš„åŒæ­¥çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸å°†æ•°æ®æœ€æ–°çš„ä»ŽèŠ‚ç‚¹å‡çº§ä¸ºä¸»èŠ‚ç‚¹å‘¢ï¼Ÿä¸‹ä¸€ç« ç»§ç»­æ¥åˆ†æžã€‚]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RedisæŒä¹…åŒ–]]></title>
    <url>%2F2019%2F01%2F31%2Fredis%2FRedis%E6%8C%81%E4%B9%85%E5%8C%96%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬äº”ç¯‡æ–‡ç« ã€‚rediså¤„ç†æ•°æ®éƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œæ‰€ä»¥é€Ÿåº¦ç‰¹åˆ«å¿«ï¼ŒåŒæ ·ï¼Œå®ƒä¹Ÿå¯ä»¥æ”¯æŒæŒä¹…åŒ–ï¼Œè¿™é‡Œæ³¨æ„ï¼Œå¹¶ä¸æ˜¯è¯´redisè¦æ¥å……å½“mysqlé‚£ç§è§’è‰²ï¼Œå…¶å®žæ›´å¤šçš„æ˜¯ä¸ºäº†åœ¨å´©æºƒçš„æ—¶å€™å¿«é€Ÿæ¢å¤ä»¥åŠä¸»ä»Žå¤åˆ¶è¿™æ ·çš„åŠŸèƒ½ã€‚redisçš„æŒä¹…åŒ–ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯RDBï¼Œä¸€ç§æ˜¯AOFï¼Œå¯¹äºŽä»–ä»¬çš„åŽŸç†å’ŒåŒºåˆ«éƒ½æ˜¯æ¯”è¾ƒé‡è¦çš„é¢è¯•è€ƒå¯Ÿç‚¹ï¼Œéœ€è¦æŽŒæ¡ã€‚ 1. ä»€ä¹ˆæ˜¯æŒä¹…åŒ– redisæ‰€æœ‰æ•°æ®ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œå¯¹æ•°æ®çš„æ›´æ–°å°†å¼‚æ­¥åœ°ä¿å­˜åˆ°ç£ç›˜ä¸­ã€‚ 2. æŒä¹…åŒ–çš„æ–¹å¼ å¿«ç…§â€”mysql dumpæˆ–è€…redis rdb å†™æ—¥å¿—â€”mysql binlogæˆ–è€…hbase glogæˆ–è€…redis aof 3. RDB ä»€ä¹ˆæ˜¯RDB è§¦å‘æœºåˆ¶ä¸‰ç§ä¸»è¦æ–¹å¼ save(åŒæ­¥æŒä¹…åŒ–ï¼Œä¼šé€ æˆredisä¸»çº¿ç¨‹çš„é˜»å¡žï¼Œä¸æŽ¨èä½¿ç”¨) saveæ˜¯åŒæ­¥çš„ï¼Œå½“ä¿å­˜çš„æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œå¯èƒ½é€ æˆredisçš„é˜»å¡žï¼Œå³å®¢æˆ·ç«¯è®¿é—®redisè¢«é˜»å¡žã€‚ ä»–çš„æ–‡ä»¶ç­–ç•¥æ˜¯ï¼šå¦‚æžœå­˜åœ¨è€çš„RDBæ–‡ä»¶ï¼Œåˆ™æ–°çš„æ›¿æ¢è€çš„ã€‚å¤æ‚åº¦ä¸ºO(n)ã€‚ bgsave(å¼‚æ­¥ï¼Œforkä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸ä¼šé€ æˆä¸»çº¿ç¨‹çš„é˜»å¡ž) ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œforkæ˜¯æ¯”è¾ƒå¿«çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä¼šæ…¢ï¼Œè¿™æ—¶ä¼šé˜»å¡žredisã€‚åªè¦forkä¸æ…¢ï¼Œå®¢æˆ·ç«¯ä¸ä¼šè¢«é˜»å¡žã€‚ ä»–çš„æ–‡ä»¶ç­–ç•¥å’Œå¤æ‚åº¦ä¸Žsaveæ˜¯ä¸€æ ·çš„ã€‚ saveå’Œbgsaveä¸¤è€…å¯¹æ¯”ï¼š è‡ªåŠ¨ redisçš„è‡ªåŠ¨ä¿å­˜çš„é»˜è®¤é…ç½®æ˜¯ï¼š é…ç½® seconds changes save 900 1 save 300 10 save 60 10000 å°±æ˜¯è¯´ï¼Œåœ¨60ç§’å†…æ”¹å˜äº†10000æ¡æ•°æ®ï¼Œå°±è‡ªåŠ¨ä¿å­˜ï¼›åœ¨300ç§’å†…æœ‰10æ¡æ”¹å˜æ‰è‡ªåŠ¨ä¿å­˜ï¼›900ç§’å†…æœ‰1ä¸€æ¡æ”¹å˜å°±ä¿å­˜ã€‚ RDBæ€»ç»“ RDBæ˜¯Rediså†…å­˜åˆ°ç¡¬ç›˜çš„å¿«ç…§ï¼Œç”¨äºŽæŒä¹…åŒ–ã€‚ saveé€šå¸¸ä¼šé˜»å¡žredisã€‚ bgsaveä¸ä¼šé˜»å¡žredisï¼Œä½†æ˜¯ä¼šforkæ–°è¿›ç¨‹ã€‚ saveè‡ªåŠ¨é…ç½®æ»¡è¶³ä»»ä¸€å°±ä¼šè¢«æ‰§è¡Œã€‚ æœ‰äº›è§¦å‘æœºåˆ¶ä¸å®¹å¿½è§†ã€‚ 4. AOF RDBé—®é¢˜ å…¨é‡æ•°æ®å­˜å…¥ç£ç›˜ O(n)æ•°æ®çš„å¤‡ä»½ï¼Œå¾ˆè€—æ—¶é—´ï¼›å¯¹äºŽbgsaveæ¥è¯´ï¼Œfork()æ˜¯ä¸€ä¸ªå¾ˆæ¶ˆè€—å†…å­˜çš„æ“ä½œï¼›å°†æ•°æ®å…¨å†™åˆ°ç¡¬ç›˜ï¼Œå¿…ç„¶å¯¹ç¡¬ç›˜IOå ç”¨å¾ˆå¤§ã€‚ å®•æœºä¸¢å¤±æ•°æ®å¤š è¿˜æœ‰ä¸€ç‚¹æ˜¯ï¼šæŸä¸ªæ—¶é—´ç‚¹å®•æœºï¼Œé‚£ä¹ˆåœ¨æŸä¸ªæ—¶é—´æ®µçš„æ•°æ®å°±ä¸¢å¤±äº†ã€‚ AOFåŽŸç† å°†å¯¹redisçš„æ“ä½œè¿½åŠ åˆ°aofæ–‡ä»¶ä¸­ã€‚å½“rediså®•æœºä¹‹åŽï¼Œä½¿ç”¨aofæ¢å¤æ‰€æœ‰çš„æ“ä½œç»§è€Œå®žçŽ°æ•°æ®çš„æ¢å¤ã€‚ AOFä¸‰ç§ç­–ç•¥ always everysec rediså‡ºçŽ°æ•…éšœï¼Œæœ‰å¯èƒ½ä¸¢å¤±ä¸€ç§’çš„æ•°æ®ã€‚redisé»˜è®¤æ–¹å¼ã€‚ no ä¸‰ç§ç­–ç•¥çš„æ¯”è¾ƒ AOFé‡å†™ å¥½å¤„æ˜¯ï¼šå‡å°‘ç¡¬ç›˜å ç”¨ã€å‡å°‘æ•°æ®ä¸¢å¤± ä¸‹é¢æ˜¯AOFçš„bgrewirteaofçš„è¿‡ç¨‹ï¼š æ³¨æ„ï¼šè¿™é‡Œçš„é‡å†™å¹¶ä¸æ˜¯ä¸Šé¢æ¼”ç¤ºçš„ï¼Œå°†åŽŸæ¥çš„aofæ–‡ä»¶è¿›è¡Œé‡å†™ï¼Œè€Œæ˜¯æ ¹æ®redisçŽ°åœ¨çš„å†…å­˜æ•°æ®è¿›è¡Œä¸€æ¬¡å›žæº¯ã€‚ aofé‡å†™æµç¨‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œå­è¿›ç¨‹åœ¨æ‰§è¡Œ AOF é‡å†™æ—¶ï¼Œä¸»è¿›ç¨‹éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå·¥ä½œï¼š 1.å¤„ç†å‘½ä»¤è¯·æ±‚ï¼› 2.å°†å†™å‘½ä»¤è¿½åŠ åˆ°çŽ°æœ‰çš„ AOF æ–‡ä»¶ä¸­ï¼› 3.å°†å†™å‘½ä»¤è¿½åŠ åˆ° AOF é‡å†™ç¼“å­˜ä¸­ã€‚ å¦‚æ­¤å¯ä»¥ä¿è¯ï¼š çŽ°æœ‰çš„AOFåŠŸèƒ½ç»§ç»­æ‰§è¡Œï¼Œå³ä½¿ AOF é‡å†™æœŸé—´å‘ç”Ÿåœæœºï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ•°æ®ä¸¢å¤±ï¼› æ‰€æœ‰å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹çš„å‘½ä»¤éƒ½ä¼šè¢«è®°å½•åˆ° AOF é‡å†™ç¼“å­˜ä¸­ã€‚ å½“å­è¿›ç¨‹å®Œæˆå¯¹ AOF æ–‡ä»¶é‡å†™ä¹‹åŽï¼Œå®ƒä¼šå‘çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªå®Œæˆä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æŽ¥åˆ°è¯¥å®Œæˆä¿¡å·ä¹‹åŽï¼Œä¼šè°ƒç”¨ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å®Œæˆä»¥ä¸‹å·¥ä½œï¼š(é˜»å¡ž) å°† AOF é‡å†™ç¼“å­˜ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼›(çŽ°æœ‰ AOF æ–‡ä»¶ã€æ–°çš„ AOF æ–‡ä»¶å’Œæ•°æ®åº“ä¸‰è€…çš„çŠ¶æ€å°±å®Œå…¨ä¸€è‡´äº†) å¯¹æ–°çš„ AOF æ–‡ä»¶è¿›è¡Œæ”¹åï¼Œè¦†ç›–åŽŸæœ‰çš„ AOF æ–‡ä»¶ã€‚(æ‰§è¡Œå®Œæ¯•åŽï¼Œç¨‹åºå°±å®Œæˆäº†æ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶çš„æ›¿æ¢) å½“è¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œä¸»è¿›ç¨‹å°±å¯ä»¥ç»§ç»­åƒå¾€å¸¸ä¸€æ ·æŽ¥æ”¶å‘½ä»¤è¯·æ±‚äº†ã€‚åœ¨æ•´ä¸ª AOF åŽå°é‡å†™è¿‡ç¨‹ä¸­ï¼Œåªæœ‰æœ€åŽçš„â€œä¸»è¿›ç¨‹å†™å…¥å‘½ä»¤åˆ°AOFç¼“å­˜â€å’Œâ€œå¯¹æ–°çš„ AOF æ–‡ä»¶è¿›è¡Œæ”¹åï¼Œè¦†ç›–åŽŸæœ‰çš„ AOF æ–‡ä»¶â€è¿™ä¸¤ä¸ªæ­¥éª¤ä¼šé€ æˆä¸»è¿›ç¨‹é˜»å¡žï¼Œåœ¨å…¶ä»–æ—¶å€™ï¼Œ AOF åŽå°é‡å†™éƒ½ä¸ä¼šå¯¹ä¸»è¿›ç¨‹é€ æˆé˜»å¡žï¼Œè¿™å°† AOF é‡å†™å¯¹æ€§èƒ½é€ æˆçš„å½±å“é™åˆ°æœ€ä½Žã€‚ å°ç»“ï¼š AOF é‡å†™çš„ç›®çš„æ˜¯è½»é‡åœ°ä¿å­˜æ•°æ®åº“çŠ¶æ€ï¼Œæ•´ä¸ªé‡å†™è¿‡ç¨‹åŸºæœ¬ä¸Šä¸å½±å“ Redis ä¸»è¿›ç¨‹å¤„ç†å‘½ä»¤è¯·æ±‚ï¼› AOFåœ¨rediså®•æœºçš„æ—¶å€™æœ€å¤šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ï¼Œæ¯”RDBè¦å¥½ä¸€ç‚¹ï¼Œå¹¶ä¸”å¯è¯»æ€§é«˜ï¼ŒåŸºæœ¬ä¸Šèƒ½çœ‹å¾—æ‡‚ AOF é‡å†™å…¶å®žæ˜¯ä¸€ä¸ªæœ‰æ­§ä¹‰çš„åå­—ï¼Œå®žé™…ä¸Šé‡å†™å·¥ä½œæ˜¯é’ˆå¯¹æ•°æ®åº“çš„å½“å‰å€¼æ¥è¿›è¡Œçš„ï¼Œé‡å†™è¿‡ç¨‹ä¸­ä¸ä¼šè¯»å†™ã€ä¹Ÿä¸é€‚ç”¨åŽŸæ¥çš„ AOF æ–‡ä»¶ï¼› AOF å¯ä»¥ç”±ç”¨æˆ·æ‰‹åŠ¨è§¦å‘ï¼Œä¹Ÿå¯ä»¥ç”±æœåŠ¡å™¨è‡ªåŠ¨è§¦å‘ã€‚ 5. æŒä¹…åŒ–çš„å–èˆå’Œé€‰æ‹© RDBå’ŒAOFå¯¹æ¯” å¯ä»¥çœ‹å‡ºï¼Œä¸–ç•Œä¸Šæ²¡æœ‰å®Œç¾Žçš„ä¸œè¥¿ï¼Œåªæœ‰åˆé€‚çš„ä¸œè¥¿ã€‚AOFåŒæ ·å­˜åœ¨ä¸€äº›é—®é¢˜ï¼šAOFæ–‡ä»¶çš„ä½“ç§¯é€šå¸¸è¦å¤§äºŽRDBæ–‡ä»¶çš„ä½“ç§¯ã€ä¸”æ¢å¤é€Ÿåº¦æ…¢ã€‚ RDBæœ€ä½³ç­–ç•¥ â€œå…³â€ï¼šå»ºè®®å…³é—­ï¼Œä½†æ˜¯åŽé¢ä¸»ä»Žå¤åˆ¶åŠŸèƒ½æ˜¯éœ€è¦ä»–çš„ï¼Œå› ä¸ºéœ€è¦ä¸»èŠ‚ç‚¹æ‰§è¡Œdbsaveï¼Œç„¶åŽå°†rdbæ–‡ä»¶ä¼ ç»™ä»ŽèŠ‚ç‚¹ã€‚æ‰€ä»¥è¯´ï¼Œå…³ä¸æ˜¯æ°¸ä¹…å…³ã€‚ â€œé›†ä¸­ç®¡ç†â€ï¼šè™½ç„¶RDBå¾ˆé‡ï¼Œä½†æ˜¯å¯¹äºŽæ•°æ®å¤‡ä»½æ˜¯å¾ˆé‡è¦çš„ï¼ŒæŒ‰ç…§å°æ—¶æˆ–è€…å¤©é›†ä¸­åœ°è¿›è¡Œå¤‡ä»½æ¯”è¾ƒå¥½ï¼Œå› ä¸ºä»–çš„æ–‡ä»¶å¾ˆå°ï¼Œåˆ©äºŽä¼ è¾“ã€‚ â€œä¸»ä»Žï¼Œä»Žå¼€â€ï¼šæœ‰æ—¶å€™ä»ŽèŠ‚ç‚¹æ‰“å¼€è¿™ä¸ªåŠŸèƒ½æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œä½†æ˜¯å¤‡ä»½å¤ªé¢‘ç¹ï¼Œå–å†³äºŽå®žé™…çš„åœºæ™¯ã€‚ AOFæœ€ä½³ç­–ç•¥ â€œå¼€â€ï¼šå»ºè®®æ‰“å¼€ï¼Œå¦‚æžœä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªæ™®é€šç¼“å­˜ï¼Œå¯¹äºŽæ•°æ®è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œè¿™æ¬¡æ•°æ®ä¸¢äº†ï¼Œä¸‹æ¬¡å¯ä»¥ä»Žæ•°æ®åº“å–(æ•°æ®åº“åŽ‹åŠ›ä¸æ˜¯å¾ˆå¤§)ï¼Œè¿™ç§æƒ…å†µå°±å»ºè®®å…³é—­ï¼Œå› ä¸ºAOFè¿˜æ˜¯æœ‰æ€§èƒ½å¼€é”€çš„ã€‚ â€œeverysecâ€ Redis4 Redis 4.0 æ–°å¢žäº† RDB-AOF æ··åˆæŒä¹…åŒ–æ ¼å¼ï¼Œ è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„åŠŸèƒ½ï¼Œ åœ¨å¼€å¯äº†è¿™ä¸ªåŠŸèƒ½ä¹‹åŽï¼Œ AOF é‡å†™äº§ç”Ÿçš„æ–‡ä»¶å°†åŒæ—¶åŒ…å« RDB æ ¼å¼çš„å†…å®¹å’Œ AOF æ ¼å¼çš„å†…å®¹ï¼Œ å…¶ä¸­ RDB æ ¼å¼çš„å†…å®¹ç”¨äºŽè®°å½•å·²æœ‰çš„æ•°æ®ï¼Œ è€Œ AOF æ ¼å¼çš„å†…å­˜åˆ™ç”¨äºŽè®°å½•æœ€è¿‘å‘ç”Ÿäº†å˜åŒ–çš„æ•°æ®ï¼Œ è¿™æ · Redis å°±å¯ä»¥åŒæ—¶å…¼æœ‰ RDB æŒä¹…åŒ–å’Œ AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹ â€”â€” æ—¢èƒ½å¤Ÿå¿«é€Ÿåœ°ç”Ÿæˆé‡å†™æ–‡ä»¶ï¼Œ ä¹Ÿèƒ½å¤Ÿåœ¨å‡ºçŽ°é—®é¢˜æ—¶ï¼Œ å¿«é€Ÿåœ°è½½å…¥æ•°æ®ã€‚ RDBå’ŒAOFå…±å­˜çš„æƒ…å†µä¸‹å¦‚ä½•æ¢å¤æ•°æ®ï¼š ä¼˜ç‚¹ï¼š æ··åˆæŒä¹…åŒ–ç»“åˆäº†RDBæŒä¹…åŒ– å’Œ AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹, ç”±äºŽç»å¤§éƒ¨åˆ†éƒ½æ˜¯RDBæ ¼å¼ï¼ŒåŠ è½½é€Ÿåº¦å¿«ï¼ŒåŒæ—¶ç»“åˆAOFï¼Œå¢žé‡çš„æ•°æ®ä»¥AOFæ–¹å¼ä¿å­˜äº†ï¼Œæ•°æ®æ›´å°‘çš„ä¸¢å¤±ã€‚ ç¼ºç‚¹ï¼š å…¼å®¹æ€§å·®ï¼Œä¸€æ—¦å¼€å¯äº†æ··åˆæŒä¹…åŒ–ï¼Œåœ¨4.0ä¹‹å‰ç‰ˆæœ¬éƒ½ä¸è¯†åˆ«è¯¥aofæ–‡ä»¶ï¼ŒåŒæ—¶ç”±äºŽå‰éƒ¨åˆ†æ˜¯RDBæ ¼å¼ï¼Œé˜…è¯»æ€§è¾ƒå·® ç­–ç•¥æ˜¯ï¼š 6. æ€»ç»“ http://www.ywnds.com/?p=4876]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥NginxåŽŸç†]]></title>
    <url>%2F2019%2F01%2F30%2Fmiscellany%2F13%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Nginx%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[Nginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼ŒåŠç”µå­é‚®ä»¶ï¼ˆIMAP/POP3ï¼‰ä»£ç†æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªéžå¸¸é«˜æ•ˆçš„åå‘ä»£ç†ã€è´Ÿè½½å¹³è¡¡ä¸­é—´ä»¶ã€‚æ˜¯éžå¸¸å¸¸ç”¨çš„web server.æˆ‘ä»¬éœ€è¦ç†è§£å®ƒçš„åŽŸç†ï¼Œæ‰èƒ½è¾¾åˆ°æ¸¸åˆƒæœ‰ä½™çš„ç¨‹åº¦ã€‚ æœ¬ç¯‡æ–‡ç« éœ€è¦å¯¹Nginxæœ‰åŸºæœ¬çš„ä½¿ç”¨ä»¥åŠå¯¹IOå¤ç”¨æ¨¡åž‹æœ‰ä¸€å®šçš„äº†è§£ã€‚æ–‡ç« æ¯”è¾ƒé•¿ã€‚ 1.æ­£å‘ä»£ç†å’Œåå‘ä»£ç† æ­£å‘ä»£ç†çš„å·¥ä½œåŽŸç†å°±åƒä¸€ä¸ªè·³æ¿ï¼Œæ¯”å¦‚ï¼šæˆ‘è®¿é—®ä¸äº†google.comï¼Œä½†æ˜¯æˆ‘èƒ½è®¿é—®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨Aï¼ŒAèƒ½è®¿é—®google.comï¼ŒäºŽæ˜¯æˆ‘å…ˆè¿žä¸Šä»£ç†æœåŠ¡å™¨Aï¼Œå‘Šè¯‰ä»–æˆ‘éœ€è¦google.comçš„å†…å®¹ï¼ŒAå°±åŽ»å–å›žæ¥ï¼Œç„¶åŽè¿”å›žç»™æˆ‘ã€‚ä»Žç½‘ç«™çš„è§’åº¦ï¼Œåªåœ¨ä»£ç†æœåŠ¡å™¨æ¥å–å†…å®¹çš„æ—¶å€™æœ‰ä¸€æ¬¡è®°å½•ï¼Œæœ‰æ—¶å€™å¹¶ä¸çŸ¥é“æ˜¯ç”¨æˆ·çš„è¯·æ±‚ï¼Œä¹Ÿéšè—äº†ç”¨æˆ·çš„èµ„æ–™ï¼Œè¿™å–å†³äºŽä»£ç†å‘Šä¸å‘Šè¯‰ç½‘ç«™ã€‚ åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æŽ¥å—internetä¸Šçš„è¿žæŽ¥è¯·æ±‚ï¼Œç„¶åŽå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»ŽæœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æžœè¿”å›žç»™internetä¸Šè¯·æ±‚è¿žæŽ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨çŽ°ä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚ ç®€å•æ¥è¯´ï¼š æ­£å‘ä»£ç†æ˜¯ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯è°ï¼Œä»£ç†æ˜¯ä¸€ä¸ªè·³æ¿ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªè·³æ¿æ¥è®¿é—®åˆ°å¯¹åº”çš„å†…å®¹ã€‚ åå‘ä»£ç†æ˜¯ä¸çŸ¥é“æœåŠ¡ç«¯æ˜¯è°ï¼Œç”¨æˆ·çš„è¯·æ±‚è¢«è½¬å‘åˆ°å†…éƒ¨çš„æŸå°æœåŠ¡å™¨åŽ»å¤„ç†ã€‚ 2.åŸºæœ¬çš„å·¥ä½œæµç¨‹ ç”¨æˆ·é€šè¿‡åŸŸåå‘å‡ºè®¿é—®WebæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œè¯¥åŸŸåè¢«DNSæœåŠ¡å™¨è§£æžä¸ºåå‘ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼› åå‘ä»£ç†æœåŠ¡å™¨æŽ¥å—ç”¨æˆ·çš„è¯·æ±‚ï¼› åå‘ä»£ç†æœåŠ¡å™¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­æŸ¥æ‰¾è¯·æ±‚çš„å†…å®¹ï¼Œæ‰¾åˆ°åŽç›´æŽ¥æŠŠå†…å®¹å‘é€ç»™ç”¨æˆ·ï¼› å¦‚æžœæœ¬åœ°ç¼“å­˜é‡Œæ²¡æœ‰ç”¨æˆ·æ‰€è¯·æ±‚çš„ä¿¡æ¯å†…å®¹ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ä¼šä»£æ›¿ç”¨æˆ·å‘æºæœåŠ¡å™¨è¯·æ±‚åŒæ ·çš„ä¿¡æ¯å†…å®¹ï¼Œå¹¶æŠŠä¿¡æ¯å†…å®¹å‘ç»™ç”¨æˆ·ï¼Œå¦‚æžœä¿¡æ¯å†…å®¹æ˜¯ç¼“å­˜çš„è¿˜ä¼šæŠŠå®ƒä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚ 3.ä¼˜ç‚¹ ä¿æŠ¤äº†çœŸå®žçš„webæœåŠ¡å™¨ï¼Œä¿è¯äº†webæœåŠ¡å™¨çš„èµ„æºå®‰å…¨ èŠ‚çº¦äº†æœ‰é™çš„IPåœ°å€èµ„æº å‡å°‘WEBæœåŠ¡å™¨åŽ‹åŠ›ï¼Œæé«˜å“åº”é€Ÿåº¦(ç¼“å­˜åŠŸèƒ½) è¯·æ±‚çš„ç»Ÿä¸€æŽ§åˆ¶ï¼ŒåŒ…æ‹¬è®¾ç½®æƒé™ã€è¿‡æ»¤è§„åˆ™ç­‰ å®žçŽ°è´Ÿè½½å‡è¡¡ åŒºåˆ†åŠ¨æ€å’Œé™æ€å¯ç¼“å­˜å†…å®¹ â€¦ 4.ä½¿ç”¨åœºæ™¯ Nginxä½œä¸ºHttpä»£ç†ã€åå‘ä»£ç† Nginxä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ Ip hashç®—æ³•ï¼Œå¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„ipè¿›è¡Œhashæ“ä½œï¼Œç„¶åŽæ ¹æ®hashç»“æžœå°†åŒä¸€ä¸ªå®¢æˆ·ç«¯ipçš„è¯·æ±‚åˆ†å‘ç»™åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥è§£å†³sessionä¸å…±äº«çš„é—®é¢˜ã€‚ Nginxä½œä¸ºWebç¼“å­˜ 5.Nginxçš„Master-Workeræ¨¡å¼ å¯åŠ¨NginxåŽï¼Œå…¶å®žå°±æ˜¯åœ¨80ç«¯å£å¯åŠ¨äº†SocketæœåŠ¡è¿›è¡Œç›‘å¬ï¼Œå¦‚å›¾æ‰€ç¤ºï¼ŒNginxæ¶‰åŠMasterè¿›ç¨‹å’ŒWorkerè¿›ç¨‹ã€‚ 6.Masterè¿›ç¨‹çš„ä½œç”¨æ˜¯ï¼Ÿ è¯»å–å¹¶éªŒè¯é…ç½®æ–‡ä»¶nginx.confï¼›ç®¡ç†workerè¿›ç¨‹ï¼› æŽ¥æ”¶æ¥è‡ªå¤–ç•Œçš„ä¿¡å· å‘å„workerè¿›ç¨‹å‘é€ä¿¡å· ç›‘æŽ§workerè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå½“workerè¿›ç¨‹é€€å‡ºåŽ(å¼‚å¸¸æƒ…å†µä¸‹)ï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„workerè¿›ç¨‹ 7.Workerè¿›ç¨‹çš„ä½œç”¨æ˜¯ï¼Ÿ æ¯ä¸€ä¸ªWorkerè¿›ç¨‹éƒ½ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹ï¼ˆé¿å…çº¿ç¨‹åˆ‡æ¢ï¼‰ï¼Œå¤„ç†è¿žæŽ¥å’Œè¯·æ±‚ï¼›æ³¨æ„Workerè¿›ç¨‹çš„ä¸ªæ•°ç”±é…ç½®æ–‡ä»¶å†³å®šï¼Œä¸€èˆ¬å’ŒCPUä¸ªæ•°ç›¸å…³ï¼ˆæœ‰åˆ©äºŽè¿›ç¨‹åˆ‡æ¢ï¼‰ï¼Œé…ç½®å‡ ä¸ªå°±æœ‰å‡ ä¸ªWorkerè¿›ç¨‹ã€‚ æ€è€ƒï¼šNginxå¦‚ä½•åšåˆ°çƒ­éƒ¨ç½²ï¼Ÿ æ‰€è°“çƒ­éƒ¨ç½²ï¼Œå°±æ˜¯é…ç½®æ–‡ä»¶nginx.confä¿®æ”¹åŽï¼Œä¸éœ€è¦stop Nginxï¼Œä¸éœ€è¦ä¸­æ–­è¯·æ±‚ï¼Œå°±èƒ½è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ï¼ˆnginx -s reload é‡æ–°åŠ è½½/nginx -tæ£€æŸ¥é…ç½®/nginx -s stopï¼‰ é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬å·²ç»çŸ¥é“workerè¿›ç¨‹è´Ÿè´£å¤„ç†å…·ä½“çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå¦‚æžœæƒ³è¾¾åˆ°çƒ­éƒ¨ç½²çš„æ•ˆæžœï¼Œå¯ä»¥æƒ³è±¡ï¼š æ–¹æ¡ˆä¸€ï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶nginx.confåŽï¼Œä¸»è¿›ç¨‹masterè´Ÿè´£æŽ¨é€ç»™wokerè¿›ç¨‹æ›´æ–°é…ç½®ä¿¡æ¯ï¼Œwokerè¿›ç¨‹æ”¶åˆ°ä¿¡æ¯åŽï¼Œæ›´æ–°è¿›ç¨‹å†…éƒ¨çš„çº¿ç¨‹ä¿¡æ¯ã€‚ï¼ˆæœ‰ç‚¹volatileçš„å‘³é“ï¼‰ æ–¹æ¡ˆäºŒï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶nginx.confåŽï¼Œé‡æ–°ç”Ÿæˆæ–°çš„workerè¿›ç¨‹ï¼Œå½“ç„¶ä¼šä»¥æ–°çš„é…ç½®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼Œè€Œä¸”æ–°çš„è¯·æ±‚å¿…é¡»éƒ½äº¤ç»™æ–°çš„workerè¿›ç¨‹ï¼Œè‡³äºŽè€çš„workerè¿›ç¨‹ï¼Œç­‰æŠŠé‚£äº›ä»¥å‰çš„è¯·æ±‚å¤„ç†å®Œæ¯•åŽï¼ŒkillæŽ‰å³å¯ã€‚ Nginxé‡‡ç”¨çš„å°±æ˜¯æ–¹æ¡ˆäºŒæ¥è¾¾åˆ°çƒ­éƒ¨ç½²çš„ï¼ æ€è€ƒï¼šNginxå¦‚ä½•åšåˆ°é«˜å¹¶å‘ä¸‹çš„é«˜æ•ˆå¤„ç†ï¼Ÿ ä¸Šæ–‡å·²ç»æåŠNginxçš„workerè¿›ç¨‹ä¸ªæ•°ä¸ŽCPUç»‘å®šã€workerè¿›ç¨‹å†…éƒ¨åŒ…å«ä¸€ä¸ªçº¿ç¨‹é«˜æ•ˆå›žçŽ¯å¤„ç†è¯·æ±‚ï¼Œè¿™çš„ç¡®æœ‰åŠ©äºŽæ•ˆçŽ‡ï¼Œä½†è¿™æ˜¯ä¸å¤Ÿçš„ã€‚ ä½œä¸ºä¸“ä¸šçš„ç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å¯ä»¥å¼€ä¸€ä¸‹è„‘æ´žï¼šBIO/NIO/AIOã€å¼‚æ­¥/åŒæ­¥ã€é˜»å¡ž/éžé˜»å¡žâ€¦ è¦åŒæ—¶å¤„ç†é‚£ä¹ˆå¤šçš„è¯·æ±‚ï¼Œè¦çŸ¥é“ï¼Œæœ‰çš„è¯·æ±‚éœ€è¦å‘ç”ŸIOï¼Œå¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå¦‚æžœç­‰ç€å®ƒï¼Œå°±ä¼šæ‹–æ…¢workerçš„å¤„ç†é€Ÿåº¦ã€‚ Nginxé‡‡ç”¨äº†Linuxçš„epollæ¨¡åž‹ï¼Œepollæ¨¡åž‹åŸºäºŽäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œå®ƒå¯ä»¥ç›‘æŽ§å¤šä¸ªäº‹ä»¶æ˜¯å¦å‡†å¤‡å®Œæ¯•ï¼Œå¦‚æžœOKï¼Œé‚£ä¹ˆæ”¾å…¥epollé˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ã€‚workeråªéœ€è¦ä»Žepollé˜Ÿåˆ—å¾ªçŽ¯å¤„ç†å³å¯ã€‚ æ€è€ƒï¼šNginxæŒ‚äº†æ€Žä¹ˆåŠžï¼Ÿ Nginxæ—¢ç„¶ä½œä¸ºå…¥å£ç½‘å…³ï¼Œå¾ˆé‡è¦ï¼Œå¦‚æžœå‡ºçŽ°å•ç‚¹é—®é¢˜ï¼Œæ˜¾ç„¶æ˜¯ä¸å¯æŽ¥å—çš„ã€‚ ç­”æ¡ˆæ˜¯ï¼šKeepalived+Nginxå®žçŽ°é«˜å¯ç”¨ã€‚ Keepalivedæ˜¯ä¸€ä¸ªé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ç”¨æ¥é˜²æ­¢æœåŠ¡å™¨å•ç‚¹å‘ç”Ÿæ•…éšœï¼Œå¯ä»¥é€šè¿‡å’ŒNginxé…åˆæ¥å®žçŽ°WebæœåŠ¡çš„é«˜å¯ç”¨ã€‚ï¼ˆå…¶å®žï¼ŒKeepalivedä¸ä»…ä»…å¯ä»¥å’ŒNginxé…åˆï¼Œè¿˜å¯ä»¥å’Œå¾ˆå¤šå…¶ä»–æœåŠ¡é…åˆï¼‰ Keepalived+Nginxå®žçŽ°é«˜å¯ç”¨çš„æ€è·¯ï¼š ç¬¬ä¸€ï¼šè¯·æ±‚ä¸è¦ç›´æŽ¥æ‰“åˆ°Nginxä¸Šï¼Œåº”è¯¥å…ˆé€šè¿‡Keepalivedï¼ˆè¿™å°±æ˜¯æ‰€è°“è™šæ‹ŸIPï¼ŒVIPï¼‰ ç¬¬äºŒï¼šKeepalivedåº”è¯¥èƒ½ç›‘æŽ§Nginxçš„ç”Ÿå‘½çŠ¶æ€ï¼ˆæä¾›ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„è„šæœ¬ï¼Œå®šæœŸæ£€æŸ¥Nginxè¿›ç¨‹çŠ¶æ€ï¼Œè¿›è¡Œæƒé‡å˜åŒ–,ä»Žè€Œå®žçŽ°Nginxæ•…éšœåˆ‡æ¢ï¼‰ 6.nginx.conf ç¬¬ä¸€ï¼šlocationå¯ä»¥è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œåº”è¯¥æ³¨æ„æ­£åˆ™çš„å‡ ç§å½¢å¼ä»¥åŠä¼˜å…ˆçº§ã€‚ï¼ˆè¿™é‡Œä¸å±•å¼€ï¼‰ ç¬¬äºŒï¼šNginxèƒ½å¤Ÿæé«˜é€Ÿåº¦çš„å…¶ä¸­ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ï¼šåŠ¨é™åˆ†ç¦»ï¼Œå°±æ˜¯æŠŠé™æ€èµ„æºæ”¾åˆ°Nginxä¸Šï¼Œç”±Nginxç®¡ç†ï¼ŒåŠ¨æ€è¯·æ±‚è½¬å‘ç»™åŽç«¯ã€‚ ç¬¬ä¸‰ï¼šæˆ‘ä»¬å¯ä»¥åœ¨Nginxä¸‹æŠŠé™æ€èµ„æºã€æ—¥å¿—æ–‡ä»¶å½’å±žåˆ°ä¸åŒåŸŸåä¸‹ï¼ˆä¹Ÿå³æ˜¯ç›®å½•ï¼‰ï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ç»´æŠ¤ã€‚ ç¬¬å››ï¼šNginxå¯ä»¥è¿›è¡ŒIPè®¿é—®æŽ§åˆ¶ï¼Œæœ‰äº›ç”µå•†å¹³å°ï¼Œå°±å¯ä»¥åœ¨Nginxè¿™ä¸€å±‚ï¼Œåšä¸€ä¸‹å¤„ç†ï¼Œå†…ç½®ä¸€ä¸ªé»‘åå•æ¨¡å—ï¼Œé‚£ä¹ˆå°±ä¸å¿…ç­‰è¯·æ±‚é€šè¿‡Nginxè¾¾åˆ°åŽç«¯åœ¨è¿›è¡Œæ‹¦æˆªï¼Œè€Œæ˜¯ç›´æŽ¥åœ¨Nginxè¿™ä¸€å±‚å°±å¤„ç†æŽ‰ã€‚ é™¤äº†å¯ä»¥æ˜ å°„é™æ€èµ„æºï¼Œä¸Šé¢å·²ç»è¯´äº†ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ¥ä½¿ç”¨ã€‚ æ‰€è°“åå‘ä»£ç†ï¼Œå¾ˆç®€å•ï¼Œå…¶å®žå°±æ˜¯åœ¨locationè¿™ä¸€æ®µé…ç½®ä¸­çš„rootæ›¿æ¢æˆproxy_passå³å¯ã€‚rootè¯´æ˜Žæ˜¯é™æ€èµ„æºï¼Œå¯ä»¥ç”±Nginxè¿›è¡Œè¿”å›žï¼›è€Œproxy_passè¯´æ˜Žæ˜¯åŠ¨æ€è¯·æ±‚ï¼Œéœ€è¦è¿›è¡Œè½¬å‘ï¼Œæ¯”å¦‚ä»£ç†åˆ°Tomcatä¸Šã€‚ åå‘ä»£ç†ï¼Œä¸Šé¢å·²ç»è¯´äº†ï¼Œè¿‡ç¨‹æ˜¯é€æ˜Žçš„ï¼Œæ¯”å¦‚è¯´request -&gt; Nginx -&gt; Tomcatï¼Œé‚£ä¹ˆå¯¹äºŽTomcatè€Œè¨€ï¼Œè¯·æ±‚çš„IPåœ°å€å°±æ˜¯Nginxçš„åœ°å€ï¼Œè€ŒéžçœŸå®žçš„requeståœ°å€ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚ä¸è¿‡å¥½åœ¨Nginxä¸ä»…ä»…å¯ä»¥åå‘ä»£ç†è¯·æ±‚ï¼Œè¿˜å¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®HTTP HEADERã€‚ è´Ÿè½½å‡è¡¡ã€upstreamã€‘ ä¸Šé¢çš„åå‘ä»£ç†ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡proxy_passæ¥æŒ‡å®šTomcatçš„åœ°å€ï¼Œå¾ˆæ˜¾ç„¶æˆ‘ä»¬åªèƒ½æŒ‡å®šä¸€å°Tomcatåœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚æžœæƒ³æŒ‡å®šå¤šå°æ¥è¾¾åˆ°è´Ÿè½½å‡è¡¡å‘¢ï¼Ÿ ç¬¬ä¸€ï¼Œé€šè¿‡upstreamæ¥å®šä¹‰ä¸€ç»„Tomcatï¼Œå¹¶æŒ‡å®šè´Ÿè½½ç­–ç•¥ï¼ˆIPHASHã€åŠ æƒè®ºè°ƒã€æœ€å°‘è¿žæŽ¥ï¼‰ï¼Œå¥åº·æ£€æŸ¥ç­–ç•¥ï¼ˆNginxå¯ä»¥ç›‘æŽ§è¿™ä¸€ç»„Tomcatçš„çŠ¶æ€ï¼‰ç­‰ã€‚ ç¬¬äºŒï¼Œå°†proxy_passæ›¿æ¢æˆupstreamæŒ‡å®šçš„å€¼å³å¯ã€‚ è´Ÿè½½å‡è¡¡å¯èƒ½å¸¦æ¥çš„é—®é¢˜ï¼Ÿ è´Ÿè½½å‡è¡¡æ‰€å¸¦æ¥çš„æ˜Žæ˜¾çš„é—®é¢˜æ˜¯ï¼Œä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥åˆ°A serverï¼Œä¹Ÿå¯ä»¥åˆ°B serverï¼Œè¿™å®Œå…¨ä¸å—æˆ‘ä»¬çš„æŽ§åˆ¶ï¼Œå½“ç„¶è¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œåªæ˜¯æˆ‘ä»¬å¾—æ³¨æ„çš„æ˜¯ï¼šç”¨æˆ·çŠ¶æ€çš„ä¿å­˜é—®é¢˜ï¼Œå¦‚Sessionä¼šè¯ä¿¡æ¯ï¼Œä¸èƒ½åœ¨ä¿å­˜åˆ°æœåŠ¡å™¨ä¸Šã€‚ 7.æƒŠç¾¤çŽ°è±¡ å®šä¹‰ï¼šæƒŠç¾¤æ•ˆåº”å°±æ˜¯å½“ä¸€ä¸ªfdçš„äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæ‰€æœ‰ç­‰å¾…è¿™ä¸ªfdçš„çº¿ç¨‹æˆ–è¿›ç¨‹éƒ½è¢«å”¤é†’ã€‚ Nginxçš„IOé€šå¸¸ä½¿ç”¨epollï¼Œepollå‡½æ•°ä½¿ç”¨äº†I/Oå¤ç”¨æ¨¡åž‹ã€‚ä¸ŽI/Oé˜»å¡žæ¨¡åž‹æ¯”è¾ƒï¼ŒI/Oå¤ç”¨æ¨¡åž‹çš„ä¼˜åŠ¿åœ¨äºŽå¯ä»¥åŒæ—¶ç­‰å¾…å¤šä¸ªï¼ˆè€Œä¸åªæ˜¯ä¸€ä¸ªï¼‰å¥—æŽ¥å­—æè¿°ç¬¦å°±ç»ªã€‚Nginxçš„epollå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š masterè¿›ç¨‹å…ˆå»ºå¥½éœ€è¦listençš„socketåŽï¼Œç„¶åŽå†forkå‡ºå¤šä¸ªwokerè¿›ç¨‹ï¼Œè¿™æ ·æ¯ä¸ªworkè¿›ç¨‹éƒ½å¯ä»¥åŽ»acceptè¿™ä¸ªsocket å½“ä¸€ä¸ªclientè¿žæŽ¥åˆ°æ¥æ—¶ï¼Œæ‰€æœ‰acceptçš„workè¿›ç¨‹éƒ½ä¼šå—åˆ°é€šçŸ¥ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥acceptæˆåŠŸï¼Œå…¶å®ƒçš„åˆ™ä¼šacceptå¤±è´¥ï¼ŒNginxæä¾›äº†ä¸€æŠŠå…±äº«é”accept_mutexæ¥ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªworkè¿›ç¨‹åœ¨acceptè¿žæŽ¥ï¼Œä»Žè€Œè§£å†³æƒŠç¾¤é—®é¢˜ å½“ä¸€ä¸ªworkerè¿›ç¨‹acceptè¿™ä¸ªè¿žæŽ¥åŽï¼Œå°±å¼€å§‹è¯»å–è¯·æ±‚ï¼Œè§£æžè¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚ï¼Œäº§ç”Ÿæ•°æ®åŽï¼Œå†è¿”å›žç»™å®¢æˆ·ç«¯ï¼Œæœ€åŽæ‰æ–­å¼€è¿žæŽ¥ï¼Œè¿™æ ·ä¸€ä¸ªå®Œæˆçš„è¯·æ±‚å°±ç»“æŸäº† 8.Nginxæž¶æž„åŠå·¥ä½œæµç¨‹ NginxçœŸæ­£å¤„ç†è¯·æ±‚ä¸šåŠ¡çš„æ˜¯Workerä¹‹ä¸‹çš„çº¿ç¨‹ã€‚workerè¿›ç¨‹ä¸­æœ‰ä¸€ä¸ªngx_worker_process_cycle()å‡½æ•°ï¼Œæ‰§è¡Œæ— é™å¾ªçŽ¯ï¼Œä¸æ–­å¤„ç†æ”¶åˆ°çš„æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶è¿›è¡Œå¤„ç†ï¼Œç›´åˆ°æ•´ä¸ªNginxæœåŠ¡è¢«åœæ­¢ã€‚ å½“ä¸€ä¸ª worker è¿›ç¨‹åœ¨ accept() è¿™ä¸ªè¿žæŽ¥ä¹‹åŽï¼Œå°±å¼€å§‹è¯»å–è¯·æ±‚ï¼Œè§£æžè¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚ï¼Œäº§ç”Ÿæ•°æ®åŽï¼Œå†è¿”å›žç»™å®¢æˆ·ç«¯ï¼Œæœ€åŽæ‰æ–­å¼€è¿žæŽ¥ï¼Œä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ã€‚ä¸€ä¸ªè¯·æ±‚ï¼Œå®Œå…¨ç”± worker è¿›ç¨‹æ¥å¤„ç†ï¼Œè€Œä¸”åªèƒ½åœ¨ä¸€ä¸ª worker è¿›ç¨‹ä¸­å¤„ç†ã€‚ è¿™æ ·åšå¸¦æ¥çš„å¥½å¤„ï¼š èŠ‚çœé”å¸¦æ¥çš„å¼€é”€ã€‚æ¯ä¸ª worker è¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸å…±äº«èµ„æºï¼Œä¸éœ€è¦åŠ é”ã€‚åŒæ—¶åœ¨ç¼–ç¨‹ä»¥åŠé—®é¢˜æŸ¥ä¸Šæ—¶ï¼Œä¹Ÿä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ ç‹¬ç«‹è¿›ç¨‹ï¼Œå‡å°‘é£Žé™©ã€‚é‡‡ç”¨ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå¯ä»¥è®©äº’ç›¸ä¹‹é—´ä¸ä¼šå½±å“ï¼Œä¸€ä¸ªè¿›ç¨‹é€€å‡ºåŽï¼Œå…¶å®ƒè¿›ç¨‹è¿˜åœ¨å·¥ä½œï¼ŒæœåŠ¡ä¸ä¼šä¸­æ–­ï¼Œmaster è¿›ç¨‹åˆ™å¾ˆå¿«é‡æ–°å¯åŠ¨æ–°çš„ worker è¿›ç¨‹ã€‚å½“ç„¶ï¼Œworker è¿›ç¨‹çš„ä¹Ÿèƒ½å‘ç”Ÿæ„å¤–é€€å‡ºã€‚ 9.nginxä¸ºä»€ä¹ˆé«˜æ€§èƒ½ å› ä¸ºnginxæ˜¯å¤šè¿›ç¨‹å•çº¿ç¨‹çš„ä»£è¡¨ï¼Œå¤šè¿›ç¨‹æ¨¡åž‹æ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹åªèƒ½å¤„ç†ä¸€è·¯IOï¼Œé‚£ä¹ˆ Nginxæ˜¯å¦‚ä½•å¤„ç†å¤šè·¯IOå‘¢ï¼Ÿ å¦‚æžœä¸ä½¿ç”¨ IO å¤šè·¯å¤ç”¨ï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼ŒåŒæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯”å¦‚æ‰§è¡Œ accept()ï¼Œå¦‚æžœæ²¡æœ‰è¿žæŽ¥è¿‡æ¥ï¼Œé‚£ä¹ˆç¨‹åºä¼šé˜»å¡žåœ¨è¿™é‡Œï¼Œç›´åˆ°æœ‰ä¸€ä¸ªè¿žæŽ¥è¿‡æ¥ï¼Œæ‰èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ è€Œå¤šè·¯å¤ç”¨ï¼Œå…è®¸æˆ‘ä»¬åªåœ¨äº‹ä»¶å‘ç”Ÿæ—¶æ‰å°†æŽ§åˆ¶è¿”å›žç»™ç¨‹åºï¼Œè€Œå…¶ä»–æ—¶å€™å†…æ ¸éƒ½æŒ‚èµ·è¿›ç¨‹ï¼Œéšæ—¶å¾…å‘½ã€‚ æ ¸å¿ƒï¼šNginxé‡‡ç”¨çš„ IOå¤šè·¯å¤ç”¨æ¨¡åž‹epoll epollé€šè¿‡åœ¨Linuxå†…æ ¸ä¸­ç”³è¯·ä¸€ä¸ªç®€æ˜“çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆæ–‡ä»¶ç³»ç»Ÿä¸€èˆ¬ç”¨ä»€ä¹ˆæ•°æ®ç»“æž„å®žçŽ°ï¼ŸB+æ ‘ï¼‰ï¼Œå…¶å·¥ä½œæµç¨‹åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š è°ƒç”¨ int epoll_create(int size)å»ºç«‹ä¸€ä¸ªepollå¯¹è±¡ï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ªeventpollç»“æž„ä½“ï¼Œç”¨äºŽå­˜æ”¾é€šè¿‡epoll_ctl()å‘epollå¯¹è±¡ä¸­æ·»åŠ è¿›æ¥çš„äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶éƒ½ä¼šæŒ‚è½½åœ¨çº¢é»‘æ ‘ä¸­ã€‚ è°ƒç”¨ int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event) åœ¨ epoll å¯¹è±¡ä¸­ä¸º fd æ³¨å†Œäº‹ä»¶ï¼Œæ‰€æœ‰æ·»åŠ åˆ°epollä¸­çš„äº‹ä»¶éƒ½ä¼šä¸Žè®¾å¤‡é©±åŠ¨ç¨‹åºå»ºç«‹å›žè°ƒå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç›¸åº”çš„äº‹ä»¶å‘ç”Ÿæ—¶ä¼šè°ƒç”¨è¿™ä¸ªsockfdçš„å›žè°ƒæ–¹æ³•ï¼Œå°†sockfdæ·»åŠ åˆ°eventpoll ä¸­çš„åŒé“¾è¡¨ è°ƒç”¨ int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout) æ¥ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼Œtimeout ä¸º -1 æ—¶ï¼Œè¯¥è°ƒç”¨ä¼šé˜»å¡žç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿ è¿™æ ·ï¼Œæ³¨å†Œå¥½äº‹ä»¶ä¹‹åŽï¼Œåªè¦æœ‰ fd ä¸Šäº‹ä»¶å‘ç”Ÿï¼Œepoll_wait() å°±èƒ½æ£€æµ‹åˆ°å¹¶è¿”å›žç»™ç”¨æˆ·ï¼Œç”¨æˆ·å°±èƒ½â€éžé˜»å¡žâ€œåœ°è¿›è¡Œ I/O äº†ã€‚ epoll() ä¸­å†…æ ¸åˆ™ç»´æŠ¤ä¸€ä¸ªé“¾è¡¨ï¼Œepoll_wait ç›´æŽ¥æ£€æŸ¥é“¾è¡¨æ˜¯ä¸æ˜¯ç©ºå°±çŸ¥é“æ˜¯å¦æœ‰æ–‡ä»¶æè¿°ç¬¦å‡†å¤‡å¥½äº†ã€‚ï¼ˆepoll ä¸Ž select ç›¸æ¯”æœ€å¤§çš„ä¼˜ç‚¹æ˜¯ä¸ä¼šéšç€ sockfd æ•°ç›®å¢žé•¿è€Œé™ä½Žæ•ˆçŽ‡ï¼Œä½¿ç”¨ select() æ—¶ï¼Œå†…æ ¸é‡‡ç”¨è½®è®­çš„æ–¹æ³•æ¥æŸ¥çœ‹æ˜¯å¦æœ‰fd å‡†å¤‡å¥½ï¼Œå…¶ä¸­çš„ä¿å­˜ sockfd çš„æ˜¯ç±»ä¼¼æ•°ç»„çš„æ•°æ®ç»“æž„ fd_setï¼Œkey ä¸º fdï¼Œvalue ä¸º 0 æˆ–è€… 1ã€‚ï¼‰ èƒ½è¾¾åˆ°è¿™ç§æ•ˆæžœï¼Œæ˜¯å› ä¸ºåœ¨å†…æ ¸å®žçŽ°ä¸­ epoll æ˜¯æ ¹æ®æ¯ä¸ª sockfd ä¸Šé¢çš„ä¸Žè®¾å¤‡é©±åŠ¨ç¨‹åºå»ºç«‹èµ·æ¥çš„å›žè°ƒå‡½æ•°å®žçŽ°çš„ã€‚é‚£ä¹ˆï¼ŒæŸä¸ª sockfd ä¸Šçš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¸Žå®ƒå¯¹åº”çš„å›žè°ƒå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œæ¥æŠŠè¿™ä¸ª sockfd åŠ å…¥é“¾è¡¨ï¼Œå…¶ä»–å¤„äºŽâ€œç©ºé—²çš„â€çŠ¶æ€çš„åˆ™ä¸ä¼šã€‚åœ¨è¿™ç‚¹ä¸Šï¼Œepoll å®žçŽ°äº†ä¸€ä¸ªâ€ä¼ªâ€AIOã€‚ä½†æ˜¯å¦‚æžœç»å¤§éƒ¨åˆ†çš„ I/O éƒ½æ˜¯â€œæ´»è·ƒçš„â€ï¼Œæ¯ä¸ª socket ä½¿ç”¨çŽ‡å¾ˆé«˜çš„è¯ï¼Œepollæ•ˆçŽ‡ä¸ä¸€å®šæ¯” select é«˜ï¼ˆå¯èƒ½æ˜¯è¦ç»´æŠ¤é˜Ÿåˆ—å¤æ‚ï¼‰ã€‚ å¯ä»¥çœ‹å‡ºï¼Œå› ä¸ºä¸€ä¸ªè¿›ç¨‹é‡Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹åŒæ—¶åªèƒ½åšä¸€ä»¶äº‹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¸æ–­åœ°åˆ‡æ¢æ¥â€œåŒæ—¶â€å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚ ä¾‹å­ï¼šNginx ä¼šæ³¨å†Œä¸€ä¸ªäº‹ä»¶ï¼šâ€œå¦‚æžœæ¥è‡ªä¸€ä¸ªæ–°å®¢æˆ·ç«¯çš„è¿žæŽ¥è¯·æ±‚åˆ°æ¥äº†ï¼Œå†é€šçŸ¥æˆ‘â€ï¼Œæ­¤åŽåªæœ‰è¿žæŽ¥è¯·æ±‚åˆ°æ¥ï¼ŒæœåŠ¡å™¨æ‰ä¼šæ‰§è¡Œ accept() æ¥æŽ¥æ”¶è¯·æ±‚ã€‚åˆæ¯”å¦‚å‘ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ PHP-FPMï¼‰è½¬å‘è¯·æ±‚ï¼Œå¹¶ç­‰å¾…è¯·æ±‚è¿”å›žæ—¶ï¼Œè¿™ä¸ªå¤„ç†çš„ worker ä¸ä¼šåœ¨è¿™é˜»å¡žï¼Œå®ƒä¼šåœ¨å‘é€å®Œè¯·æ±‚åŽï¼Œæ³¨å†Œä¸€ä¸ªäº‹ä»¶ï¼šâ€œå¦‚æžœç¼“å†²åŒºæŽ¥æ”¶åˆ°æ•°æ®äº†ï¼Œå‘Šè¯‰æˆ‘ä¸€å£°ï¼Œæˆ‘å†å°†å®ƒè¯»è¿›æ¥â€ï¼ŒäºŽæ˜¯è¿›ç¨‹å°±ç©ºé—²ä¸‹æ¥ç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚ è¿™æ ·ï¼ŒåŸºäºŽ å¤šè¿›ç¨‹+epollï¼Œ Nginx ä¾¿èƒ½å®žçŽ°é«˜å¹¶å‘ã€‚ 10.å‡ ç§è´Ÿè½½å‡è¡¡çš„ç®—æ³•ä»‹ç» è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åŽç«¯æœåŠ¡å™¨ï¼Œå¦‚æžœåŽç«¯æœåŠ¡å™¨downæŽ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ weight æŒ‡å®šè½®è¯¢å‡ çŽ‡ï¼Œweightå’Œè®¿é—®æ¯”çŽ‡æˆæ­£æ¯”ï¼Œç”¨äºŽåŽç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ip_hash æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æžœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®åŒä¸€ä¸ªåŽç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚ä½†æ˜¯ä¸èƒ½è§£å†³å®•æœºé—®é¢˜ã€‚ å‰ä¸‰ç§æ˜¯nginxè‡ªå¸¦çš„ï¼Œç›´æŽ¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å³å¯ä½¿ç”¨ã€‚ fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰ æŒ‰åŽç«¯æœåŠ¡å™¨çš„ç›¸åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œç›¸åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰ æŒ‰è®¿é—®urlçš„hashç»“æžœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåŽç«¯æœåŠ¡å™¨ï¼ŒåŽç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ 11.åŸºäºŽä¸åŒå±‚æ¬¡çš„è´Ÿè½½å‡è¡¡ ä¸ƒå±‚å°±æ˜¯åŸºäºŽURLç­‰åº”ç”¨å±‚ä¿¡æ¯çš„è´Ÿè½½å‡è¡¡ï¼› åŒç†ï¼Œè¿˜æœ‰åŸºäºŽMACåœ°å€çš„äºŒå±‚è´Ÿè½½å‡è¡¡å’ŒåŸºäºŽIPåœ°å€çš„ä¸‰å±‚è´Ÿè½½å‡è¡¡ã€‚ æ¢å¥è¯è¯´: äºŒå±‚è´Ÿè½½å‡è¡¡ä¼šé€šè¿‡ä¸€ä¸ªè™šæ‹ŸMACåœ°å€æŽ¥å—è¯·æ±‚ï¼Œç„¶åŽå†åˆ†é…åˆ°çœŸæ˜¯çš„MACåœ°å€ï¼› ä¸‰å±‚è´Ÿè½½å‡è¡¡ä¼šé€šè¿‡ä¸€ä¸ªè™šæ‹ŸIPåœ°å€æŽ¥æ”¶è¯·æ±‚ï¼Œç„¶åŽå†åˆ†é…åˆ°çœŸå®žçš„IPåœ°å€ï¼› å››å±‚é€šè¿‡è™šæ‹Ÿçš„URLæˆ–ä¸»æœºåæŽ¥æ”¶è¯·æ±‚ï¼Œç„¶åŽå†åˆ†é…åˆ°çœŸæ˜¯çš„æœåŠ¡å™¨ã€‚ æ‰€è°“çš„å››åˆ°ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯åœ¨å¯¹åŽå°çš„æœåŠ¡å™¨è¿›è¡Œè´Ÿè½½å‡è¡¡æ—¶ï¼Œä¾æ®å››å±‚çš„ä¿¡æ¯æˆ–ä¸ƒå±‚çš„ä¿¡æ¯æ¥å†³å®šæ€Žä¹ˆæ ·è½¬å‘æµé‡ã€‚ æ¯”å¦‚å››å±‚çš„è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯é€šè¿‡å‘å¸ƒä¸‰å±‚çš„IPåœ°å€ï¼ˆVIPï¼‰ï¼Œç„¶åŽåŠ å››å±‚çš„ç«¯å£å·ï¼Œæ¥å†³å®šå“ªäº›æµé‡éœ€è¦åšè´Ÿè½½å‡è¡¡ï¼Œå¯¹éœ€è¦å¤„ç†çš„æµé‡è¿›è¡ŒNATå¤„ç†ï¼Œè½¬å‘è‡³åŽå°æœåŠ¡å™¨ï¼Œå¹¶è®°å½•ä¸‹è¿™ä¸ªTCPæˆ–è€…UDPçš„æµé‡æ˜¯ç”±å“ªå°æœåŠ¡å™¨å¤„ç†çš„ï¼ŒåŽç»­è¿™ä¸ªè¿žæŽ¥çš„æ‰€æœ‰æµé‡éƒ½åŒæ ·è½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨å¤„ç†ã€‚ ä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯åœ¨å››å±‚çš„åŸºç¡€ä¸Šï¼ˆæ²¡æœ‰å››å±‚æ˜¯ç»å¯¹ä¸å¯èƒ½æœ‰ä¸ƒå±‚çš„ï¼‰ï¼Œå†è€ƒè™‘åº”ç”¨å±‚çš„ç‰¹å¾ï¼Œæ¯”å¦‚åŒä¸€ä¸ªWebæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œé™¤äº†æ ¹æ®VIPåŠ 80ç«¯å£è¾¨åˆ«æ˜¯å¦éœ€è¦å¤„ç†çš„æµé‡ï¼Œè¿˜å¯æ ¹æ®ä¸ƒå±‚çš„URLã€æµè§ˆå™¨ç±»åˆ«ã€è¯­è¨€æ¥å†³å®šæ˜¯å¦è¦è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœä½ çš„WebæœåŠ¡å™¨åˆ†æˆä¸¤ç»„ï¼Œä¸€ç»„æ˜¯ä¸­æ–‡è¯­è¨€çš„ï¼Œä¸€ç»„æ˜¯è‹±æ–‡è¯­è¨€çš„ï¼Œé‚£ä¹ˆä¸ƒå±‚è´Ÿè½½å‡è¡¡å°±å¯ä»¥å½“ç”¨æˆ·æ¥è®¿é—®ä½ çš„åŸŸåæ—¶ï¼Œè‡ªåŠ¨è¾¨åˆ«ç”¨æˆ·è¯­è¨€ï¼Œç„¶åŽé€‰æ‹©å¯¹åº”çš„è¯­è¨€æœåŠ¡å™¨ç»„è¿›è¡Œè´Ÿè½½å‡è¡¡å¤„ç†ã€‚ è´Ÿè½½å‡è¡¡å™¨é€šå¸¸ç§°ä¸ºå››å±‚äº¤æ¢æœºæˆ–ä¸ƒå±‚äº¤æ¢æœºã€‚å››å±‚äº¤æ¢æœºä¸»è¦åˆ†æžIPå±‚åŠTCP/UDPå±‚ï¼Œå®žçŽ°å››å±‚æµé‡è´Ÿè½½å‡è¡¡ã€‚ä¸ƒå±‚äº¤æ¢æœºé™¤äº†æ”¯æŒå››å±‚è´Ÿè½½å‡è¡¡ä»¥å¤–ï¼Œè¿˜æœ‰åˆ†æžåº”ç”¨å±‚çš„ä¿¡æ¯ï¼Œå¦‚HTTPåè®®URIæˆ–Cookieä¿¡æ¯ã€‚ è´Ÿè½½å‡è¡¡è®¾å¤‡ä¹Ÿå¸¸è¢«ç§°ä¸º&quot;å››åˆ°ä¸ƒå±‚äº¤æ¢æœº&quot;ï¼Œé‚£ä¹ˆå››å±‚å’Œä¸ƒå±‚ä¸¤è€…åˆ°åº•åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ ç¬¬ä¸€ï¼ŒæŠ€æœ¯åŽŸç†ä¸Šçš„åŒºåˆ«ã€‚ æ‰€è°“å››å±‚è´Ÿè½½å‡è¡¡ï¼Œä¹Ÿå°±æ˜¯ä¸»è¦é€šè¿‡æŠ¥æ–‡ä¸­çš„ç›®æ ‡åœ°å€å’Œç«¯å£ï¼Œå†åŠ ä¸Šè´Ÿè½½å‡è¡¡è®¾å¤‡è®¾ç½®çš„æœåŠ¡å™¨é€‰æ‹©æ–¹å¼ï¼Œå†³å®šæœ€ç»ˆé€‰æ‹©çš„å†…éƒ¨æœåŠ¡å™¨ã€‚ æ‰€è°“ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œä¹Ÿç§°ä¸ºâ€œå†…å®¹äº¤æ¢â€ï¼Œä¹Ÿå°±æ˜¯ä¸»è¦é€šè¿‡æŠ¥æ–‡ä¸­çš„çœŸæ­£æœ‰æ„ä¹‰çš„åº”ç”¨å±‚å†…å®¹ï¼Œå†åŠ ä¸Šè´Ÿè½½å‡è¡¡è®¾å¤‡è®¾ç½®çš„æœåŠ¡å™¨é€‰æ‹©æ–¹å¼ï¼Œå†³å®šæœ€ç»ˆé€‰æ‹©çš„å†…éƒ¨æœåŠ¡å™¨ã€‚ ç¬¬äºŒï¼Œåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚ ä¸ƒå±‚åº”ç”¨è´Ÿè½½çš„å¥½å¤„ï¼Œæ˜¯ä½¿å¾—æ•´ä¸ªç½‘ç»œæ›´&quot;æ™ºèƒ½åŒ–&quot;ã€‚ä¾‹å¦‚è®¿é—®ä¸€ä¸ªç½‘ç«™çš„ç”¨æˆ·æµé‡ï¼Œå¯ä»¥é€šè¿‡ä¸ƒå±‚çš„æ–¹å¼ï¼Œå°†å¯¹å›¾ç‰‡ç±»çš„è¯·æ±‚è½¬å‘åˆ°ç‰¹å®šçš„å›¾ç‰‡æœåŠ¡å™¨å¹¶å¯ä»¥ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ï¼›å°†å¯¹æ–‡å­—ç±»çš„è¯·æ±‚å¯ä»¥è½¬å‘åˆ°ç‰¹å®šçš„æ–‡å­—æœåŠ¡å™¨å¹¶å¯ä»¥ä½¿ç”¨åŽ‹ç¼©æŠ€æœ¯ã€‚ å¦å¤–ä¸€ä¸ªå¸¸å¸¸è¢«æåˆ°åŠŸèƒ½å°±æ˜¯å®‰å…¨æ€§ã€‚ 12.æ€»ç»“ ç†è§£æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„æ¦‚å¿µ nginxçš„ä¼˜ç‚¹å’Œä½¿ç”¨åœºæ™¯ masterå’Œworkä¸¤ç§è¿›ç¨‹çš„ä½œç”¨ å¦‚ä½•çƒ­éƒ¨ç½² Nginxå•ç‚¹æ•…éšœçš„é¢„é˜² æ˜ å°„é™æ€æ–‡ä»¶ã€åå‘ä»£ç†è·³è½¬åˆ°åŽç«¯æœåŠ¡å™¨å¤„ç†çš„å†™æ³• æƒŠç¾¤çŽ°è±¡ Nginx é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹ï¼ˆå•çº¿ç¨‹ï¼‰ &amp; å¤šè·¯IOå¤ç”¨æ¨¡åž‹(åº•å±‚ä¾é epollå®žçŽ°) å‡ ç§è´Ÿè½½å‡è¡¡çš„ç®—æ³• å››å±‚çš„è´Ÿè½½å‡è¡¡å’Œä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡]]></content>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisä¸ºä»€ä¹ˆå¿«]]></title>
    <url>%2F2019%2F01%2F30%2Fredis%2FRedis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬å››ç¯‡æ–‡ç« ï¼Œæœ¬æ–‡ä¸»è¦æ”»å…‹é¢è¯•é¢˜-Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ã€‚è¿™å°±æ¶‰åŠRedisçš„çº¿ç¨‹æ¨¡åž‹å•¦ã€‚ å®Œå…¨åŸºäºŽå†…å­˜ Redisæ˜¯çº¯å†…å­˜æ•°æ®åº“ï¼Œç›¸å¯¹äºŽè¯»å†™ç£ç›˜ï¼Œè¯»å†™å†…å­˜çš„é€Ÿåº¦å°±ä¸æ˜¯å‡ å€å‡ åå€äº†ï¼Œä¸€èˆ¬ï¼ŒhashæŸ¥æ‰¾å¯ä»¥è¾¾åˆ°æ¯ç§’ç™¾ä¸‡æ¬¡çš„æ•°é‡çº§ã€‚ å¤šè·¯å¤ç”¨IO â€œå¤šè·¯â€æŒ‡çš„æ˜¯å¤šä¸ªç½‘ç»œè¿žæŽ¥ï¼Œâ€œå¤ç”¨â€æŒ‡çš„æ˜¯å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚é‡‡ç”¨å¤šè·¯ I/O å¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªè¿žæŽ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œIOçš„æ—¶é—´æ¶ˆè€—ï¼‰ã€‚ Redisä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼Ÿ å› ä¸ºCPUä¸æ˜¯Redisçš„ç“¶é¢ˆã€‚Redisçš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®žçŽ°ï¼Œè€Œä¸”CPUä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚ ä¸ºä»€ä¹ˆ Redis ä¸­è¦ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨è¿™ç§æŠ€æœ¯å‘¢ï¼Ÿ é¦–å…ˆï¼ŒRedis æ˜¯è·‘åœ¨å•çº¿ç¨‹ä¸­çš„ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æŒ‰ç…§é¡ºåºçº¿æ€§æ‰§è¡Œçš„ï¼Œä½†æ˜¯ç”±äºŽè¯»å†™æ“ä½œç­‰å¾…ç”¨æˆ·è¾“å…¥æˆ–è¾“å‡ºéƒ½æ˜¯é˜»å¡žçš„ï¼Œæ‰€ä»¥ I/O æ“ä½œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¾€å¾€ä¸èƒ½ç›´æŽ¥è¿”å›žï¼Œè¿™ä¼šå¯¼è‡´æŸä¸€æ–‡ä»¶çš„ I/O é˜»å¡žå¯¼è‡´æ•´ä¸ªè¿›ç¨‹æ— æ³•å¯¹å…¶å®ƒå®¢æˆ·æä¾›æœåŠ¡ï¼Œè€Œ I/O å¤šè·¯å¤ç”¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå‡ºçŽ°çš„ã€‚ å‡è®¾ä½ æ˜¯ä¸€ä¸ªè€å¸ˆï¼Œè®©30ä¸ªå­¦ç”Ÿè§£ç­”ä¸€é“é¢˜ç›®ï¼Œç„¶åŽæ£€æŸ¥å­¦ç”Ÿåšçš„æ˜¯å¦æ­£ç¡®ï¼Œä½ æœ‰ä¸‹é¢å‡ ä¸ªé€‰æ‹©ï¼š ç¬¬ä¸€ç§é€‰æ‹©ï¼šæŒ‰é¡ºåºé€ä¸ªæ£€æŸ¥ï¼Œå…ˆæ£€æŸ¥Aï¼Œç„¶åŽæ˜¯Bï¼Œä¹‹åŽæ˜¯Cã€Dã€‚ã€‚ã€‚è¿™ä¸­é—´å¦‚æžœæœ‰ä¸€ä¸ªå­¦ç”Ÿå¡ä¸»ï¼Œå…¨ç­éƒ½ä¼šè¢«è€½è¯¯ã€‚è¿™ç§æ¨¡å¼å°±å¥½æ¯”ï¼Œä½ ç”¨å¾ªçŽ¯æŒ¨ä¸ªå¤„ç†socketï¼Œæ ¹æœ¬ä¸å…·æœ‰å¹¶å‘èƒ½åŠ›ã€‚ ç¬¬äºŒç§é€‰æ‹©ï¼šä½ åˆ›å»º30ä¸ªåˆ†èº«ï¼Œæ¯ä¸ªåˆ†èº«æ£€æŸ¥ä¸€ä¸ªå­¦ç”Ÿçš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€‚ è¿™ç§ç±»ä¼¼äºŽä¸ºæ¯ä¸€ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å¤„ç†è¿žæŽ¥ã€‚ ç¬¬ä¸‰ç§é€‰æ‹©ï¼Œä½ ç«™åœ¨è®²å°ä¸Šç­‰ï¼Œè°è§£ç­”å®Œè°ä¸¾æ‰‹ã€‚è¿™æ—¶Cã€Dä¸¾æ‰‹ï¼Œè¡¨ç¤ºä»–ä»¬è§£ç­”é—®é¢˜å®Œæ¯•ï¼Œä½ ä¸‹åŽ»ä¾æ¬¡æ£€æŸ¥Cã€Dçš„ç­”æ¡ˆï¼Œç„¶åŽç»§ç»­å›žåˆ°è®²å°ä¸Šç­‰ã€‚æ­¤æ—¶Eã€Aåˆä¸¾æ‰‹ï¼Œç„¶åŽåŽ»å¤„ç†Eå’ŒAã€‚ã€‚ã€‚ ç¬¬ä¸‰ç§å°±æ˜¯IOå¤ç”¨æ¨¡åž‹ï¼ŒLinuxä¸‹çš„selectã€pollå’Œepollå°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚å°†ç”¨æˆ·socketå¯¹åº”çš„fdæ³¨å†Œè¿›epollï¼Œç„¶åŽepollå¸®ä½ ç›‘å¬å“ªäº›socketä¸Šæœ‰æ¶ˆæ¯åˆ°è¾¾ï¼Œè¿™æ ·å°±é¿å…äº†å¤§é‡çš„æ— ç”¨æ“ä½œã€‚æ­¤æ—¶çš„socketåº”è¯¥é‡‡ç”¨éžé˜»å¡žæ¨¡å¼ã€‚è¿™æ ·ï¼Œæ•´ä¸ªè¿‡ç¨‹åªåœ¨è°ƒç”¨selectã€pollã€epollè¿™äº›è°ƒç”¨çš„æ—¶å€™æ‰ä¼šé˜»å¡žï¼Œæ”¶å‘å®¢æˆ·æ¶ˆæ¯æ˜¯ä¸ä¼šé˜»å¡žçš„ï¼Œæ•´ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å°±è¢«å……åˆ†åˆ©ç”¨èµ·æ¥ï¼Œè¿™å°±æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œæ‰€è°“çš„reactoræ¨¡å¼ã€‚ æ‰€ä»¥ï¼ŒI/Oå¤šè·¯å¤ç”¨çš„æœ¬è´¨æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼ˆç³»ç»Ÿå†…æ ¸ç¼“å†²I/Oæ•°æ®ï¼‰ï¼Œè®©å•ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚ è¿™é‡Œè¿˜æ¶‰åŠä¸€ä¸ªåè¯ï¼šfdæ–‡ä»¶æè¿°ç¬¦ã€‚ Linux ç³»ç»Ÿä¸­ï¼ŒæŠŠä¸€åˆ‡éƒ½çœ‹åšæ˜¯æ–‡ä»¶ï¼Œå½“è¿›ç¨‹æ‰“å¼€çŽ°æœ‰æ–‡ä»¶æˆ–åˆ›å»ºæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›žä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ–‡ä»¶æè¿°ç¬¦å°±æ˜¯å†…æ ¸ä¸ºäº†é«˜æ•ˆç®¡ç†å·²è¢«æ‰“å¼€çš„æ–‡ä»¶æ‰€åˆ›å»ºçš„ç´¢å¼•ï¼Œç”¨æ¥æŒ‡å‘è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰€æœ‰æ‰§è¡ŒI/Oæ“ä½œçš„ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ã€‚ redisçš„çº¿ç¨‹æ¨¡åž‹ï¼Ÿ Redis æœåŠ¡é‡‡ç”¨ Reactor çš„æ–¹å¼æ¥å®žçŽ°æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ã€‚ æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨æ¨¡å—åŒæ—¶ç›‘å¬å¤šä¸ª FDï¼Œå½“ acceptã€readã€write å’Œ close æ–‡ä»¶äº‹ä»¶äº§ç”Ÿæ—¶ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šå›žè°ƒ FD ç»‘å®šçš„äº‹ä»¶å¤„ç†å™¨ã€‚ è™½ç„¶æ•´ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯åœ¨å•çº¿ç¨‹ä¸Šè¿è¡Œçš„ï¼Œä½†æ˜¯é€šè¿‡ I/O å¤šè·¯å¤ç”¨æ¨¡å—çš„å¼•å…¥ï¼Œå®žçŽ°äº†åŒæ—¶å¯¹å¤šä¸ª FD è¯»å†™çš„ç›‘æŽ§ï¼Œæé«˜äº†ç½‘ç»œé€šä¿¡æ¨¡åž‹çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¿è¯æ•´ä¸ª Redis æœåŠ¡å®žçŽ°çš„ç®€å•ã€‚ ä¸Šé¢ç®€å•ç†è§£å°±æ˜¯ï¼šå¤šä¸ªç½‘ç»œè¿žæŽ¥å¹¶å‘è¯»å†™redisçš„æ—¶å€™ï¼Œå…ˆå°†å¯¹åº”çš„fdæ³¨å†Œåˆ°epollä¸Šï¼ŒI/Oå¤šè·¯å¤ç”¨æ¨¡å—ä¼šç›‘å¬è¿™äº›ç½‘ç»œè¯·æ±‚çš„æƒ…å†µï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªç½‘ç»œè¿žæŽ¥äº§ç”Ÿäº†acceptã€readã€write å’Œ close æ–‡ä»¶äº‹ä»¶ï¼ŒI/Oå¤šè·¯å¤ç”¨æ¨¡å—å°±ä¼šå‘æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä¼ é€é‚£äº›äº§ç”Ÿäº†äº‹ä»¶çš„ç½‘ç»œè¿žæŽ¥ã€‚ å½“ç„¶äº†ï¼Œä¸Šé¢çš„æ–‡ä»¶äº‹ä»¶å¯èƒ½ä¼šå¹¶å‘äº§ç”Ÿï¼Œè¿™æ—¶çš„ç­–ç•¥æ˜¯ï¼Œå°†æ‰€æœ‰äº§ç”Ÿäº‹ä»¶çš„å¥—æŽ¥å­—ï¼ˆå¯¹åº”ä¸Šé¢çš„ç½‘ç»œè¿žæŽ¥ï¼‰éƒ½å…¥é˜Ÿåˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢ï¼Œ ç„¶åŽé€šè¿‡è¿™ä¸ªé˜Ÿåˆ—ï¼Œ ä»¥æœ‰åºï¼ˆsequentiallyï¼‰ã€åŒæ­¥ï¼ˆsynchronouslyï¼‰ã€æ¯æ¬¡ä¸€ä¸ªå¥—æŽ¥å­—çš„æ–¹å¼å‘æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä¼ é€å¥—æŽ¥å­—ï¼š å½“ä¸Šä¸€ä¸ªå¥—æŽ¥å­—äº§ç”Ÿçš„äº‹ä»¶è¢«å¤„ç†å®Œæ¯•ä¹‹åŽï¼ˆè¯¥å¥—æŽ¥å­—ä¸ºäº‹ä»¶æ‰€å…³è”çš„äº‹ä»¶å¤„ç†å™¨æ‰§è¡Œå®Œæ¯•ï¼‰ï¼Œ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ‰ä¼šç»§ç»­å‘æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä¼ é€ä¸‹ä¸€ä¸ªå¥—æŽ¥å­—ã€‚å†çœ‹çœ‹ä¸‹å›¾ï¼Œä¸Žä¸Šå›¾ä½¿ä¸€æ ·çš„ï¼š æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨æŽ¥æ”¶ I/O å¤šè·¯å¤ç”¨ç¨‹åºä¼ æ¥çš„å¥—æŽ¥å­—ï¼Œ å¹¶æ ¹æ®å¥—æŽ¥å­—äº§ç”Ÿçš„äº‹ä»¶çš„ç±»åž‹ï¼Œ è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚ æœåŠ¡å™¨ä¼šä¸ºæ‰§è¡Œä¸åŒä»»åŠ¡çš„å¥—æŽ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ï¼Œ è¿™äº›å¤„ç†å™¨æ˜¯ä¸€ä¸ªä¸ªå‡½æ•°ï¼Œ å®ƒä»¬å®šä¹‰äº†æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ æœåŠ¡å™¨åº”è¯¥æ‰§è¡Œçš„åŠ¨ä½œã€‚ æ•´ä¸ªæ¨¡å—ä½¿ Redis èƒ½ä»¥å•è¿›ç¨‹è¿è¡Œçš„åŒæ—¶æœåŠ¡æˆåƒä¸Šä¸‡ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œé¿å…äº†ç”±äºŽå¤šè¿›ç¨‹åº”ç”¨çš„å¼•å…¥å¯¼è‡´ä»£ç å®žçŽ°å¤æ‚åº¦çš„æå‡ï¼Œå‡å°‘äº†å‡ºé”™çš„å¯èƒ½æ€§ï¼Œå•çº¿ç¨‹è¿˜å‡å°‘çº¿ç¨‹åˆ‡æ¢å’Œè°ƒåº¦ï¼Œå®žçŽ°æ›´åŠ ç®€å• æœ€åŽæ€»ç»“ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆredisæ¯”è¾ƒå¿«å¤§æ¦‚æ€è·¯é€šä¿—çš„è¯´å°±æ˜¯ï¼šRedisæ˜¯çº¯å†…å­˜æ•°æ®åº“ï¼Œè¯»å–å¿«ï¼Œç“¶é¢ˆåœ¨äºŽIOä¸Šï¼Œå¦‚æžœä½¿ç”¨é˜»å¡žå¼IOï¼Œå› ä¸ºæ˜¯å•çº¿ç¨‹çš„ç¼˜æ•…ï¼Œå°±ä¼šåœæ­¢ç­‰å¾…ã€‚æ‰€ä»¥é‡‡ç”¨IOå¤šè·¯å¤ç”¨ç›‘å¬æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ï¼Œå°†å¯¹redisçš„å¼€å…³è¯»å†™æ¢æˆäº‹ä»¶ï¼ŒåŠ å…¥é˜Ÿåˆ—è¿›è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†ï¼Œåžåé‡æ¯”è¾ƒå¤§ã€‚ IOå¤ç”¨æ¨¡åž‹çš„é€‰æ‹© å› ä¸º Redis éœ€è¦åœ¨å¤šä¸ªå¹³å°ä¸Šè¿è¡Œï¼ŒåŒæ—¶ä¸ºäº†æœ€å¤§åŒ–æ‰§è¡Œçš„æ•ˆçŽ‡ä¸Žæ€§èƒ½ï¼Œæ‰€ä»¥ä¼šæ ¹æ®ç¼–è¯‘å¹³å°çš„ä¸åŒé€‰æ‹©ä¸åŒçš„ I/O å¤šè·¯å¤ç”¨å‡½æ•°ä½œä¸ºå­æ¨¡å—ï¼Œæä¾›ç»™ä¸Šå±‚ç»Ÿä¸€çš„æŽ¥å£ï¼› å› ä¸º select å‡½æ•°æ˜¯ä½œä¸º POSIX æ ‡å‡†ä¸­çš„ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨ä¸åŒç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿä¸Šéƒ½ä¼šå®žçŽ°ï¼Œæ‰€ä»¥å°†å…¶ä½œä¸ºä¿åº•æ–¹æ¡ˆï¼š Redis ä¼šä¼˜å…ˆé€‰æ‹©æ—¶é—´å¤æ‚åº¦ä¸º O(1) çš„ I/O å¤šè·¯å¤ç”¨å‡½æ•°ä½œä¸ºåº•å±‚å®žçŽ°ï¼ŒåŒ…æ‹¬ Solaries 10 ä¸­çš„ evportã€Linux ä¸­çš„ epoll å’Œ macOS/FreeBSD ä¸­çš„ kqueueï¼Œä¸Šè¿°çš„è¿™äº›å‡½æ•°éƒ½ä½¿ç”¨äº†å†…æ ¸å†…éƒ¨çš„ç»“æž„ï¼Œå¹¶ä¸”èƒ½å¤ŸæœåŠ¡å‡ åä¸‡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ ä½†æ˜¯å¦‚æžœå½“å‰ç¼–è¯‘çŽ¯å¢ƒæ²¡æœ‰ä¸Šè¿°å‡½æ•°ï¼Œå°±ä¼šé€‰æ‹© select ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆï¼Œç”±äºŽå…¶åœ¨ä½¿ç”¨æ—¶ä¼šæ‰«æå…¨éƒ¨ç›‘å¬çš„æè¿°ç¬¦ï¼Œæ‰€ä»¥å…¶æ—¶é—´å¤æ‚åº¦è¾ƒå·® O(n)ï¼Œå¹¶ä¸”åªèƒ½åŒæ—¶æœåŠ¡ 1024 ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥ä¸€èˆ¬å¹¶ä¸ä¼šä»¥ select ä½œä¸ºç¬¬ä¸€æ–¹æ¡ˆä½¿ç”¨ã€‚ reidsåœ¨linuxä¸‹çš„å®‰è£… Rediså¯¹äºŽLinuxæ˜¯å®˜æ–¹æ”¯æŒçš„ï¼Œå®‰è£…èµ·æ¥ä¹Ÿéžå¸¸åœ°ç®€å•ï¼Œç›´æŽ¥ç¼–è¯‘æºç ç„¶åŽè¿›è¡Œå®‰è£…å³å¯ã€‚ è¿™é‡Œä»¥centosä¸ºä¾‹ï¼Œå¤§æ¦‚è¯´ä¸€ä¸‹æ­¥éª¤ï¼š ä¸‹è½½redisç¼–è¯‘å·¥å…·:yum install gccå’Œyum install g++ è§£åŽ‹redis.tar.gzæ–‡ä»¶ï¼Œè¿›åŽ»ä¹‹åŽè¿›è¡Œç¼–è¯‘:make ç„¶åŽå®‰è£…ï¼šmake install PREFIX=/usr/local/redis å®‰è£…æˆåŠŸä¹‹åŽè¿›å…¥/usr/local/redis/binä¸‹å¯åŠ¨redis ./redis-server]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rediså…¶ä»–çš„åŠŸèƒ½ä»‹ç»]]></title>
    <url>%2F2019%2F01%2F29%2Fredis%2FRedis%E5%85%B6%E4%BB%96%E7%9A%84%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»redisä¸€äº›å…¶ä»–çš„åŠŸèƒ½ã€‚é‡åˆ°æŸäº›åœºæ™¯çš„æ—¶å€™å¯ä»¥æƒ³åˆ°redisæ˜¯ä¸æ˜¯å¯ä»¥å®žçŽ°ã€‚ ä¸€ã€æ…¢æŸ¥è¯¢æ—¥å¿— 1.1 ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢æ—¥å¿— æ…¢æŸ¥è¯¢æ—¥å¿—å¸®åŠ©å¼€å‘å’Œè¿ç»´äººå‘˜å®šä½ç³»ç»Ÿå­˜åœ¨çš„æ…¢æ“ä½œã€‚æ…¢æŸ¥è¯¢æ—¥å¿—å°±æ˜¯ç³»ç»Ÿåœ¨å‘½ä»¤æ‰§è¡Œå‰åŽè®¡ç®—æ¯æ¡å‘½ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œå½“è¶…è¿‡é¢„è®¾é˜€å€¼ï¼Œå°±å°†è¿™æ¡å‘½ä»¤çš„ç›¸å…³ä¿¡æ¯ï¼ˆæ…¢æŸ¥è¯¢IDï¼Œå‘ç”Ÿæ—¶é—´æˆ³ï¼Œè€—æ—¶ï¼Œå‘½ä»¤çš„è¯¦ç»†ä¿¡æ¯ï¼‰è®°å½•ä¸‹æ¥ã€‚ 1.2 redisä¸€æ¡å‘½ä»¤ç®€å•çš„ç”Ÿå‘½å‘¨æœŸ æ…¢æŸ¥è¯¢åªä¼šå‡ºçŽ°åœ¨ã€3.æ‰§è¡Œå‘½ä»¤ã€‘è¿™ä¸ªé˜¶æ®µï¼Œå³æ…¢æŸ¥è¯¢åªè®°å½•å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œå¹¶ä¸åŒ…æ‹¬å‘½ä»¤æŽ’é˜Ÿæ—¶é—´å’Œç½‘ç»œä¼ è¾“æ—¶é—´ã€‚ 1.3 æ…¢æŸ¥è¯¢é…ç½®å‚æ•° æ…¢æŸ¥è¯¢çš„é¢„è®¾é˜€å€¼ slowlog-log-slower-than slowlog-log-slower-thanå‚æ•°å°±æ˜¯é¢„è®¾é˜€å€¼ï¼Œå•ä½æ˜¯å¾®ç§’,é»˜è®¤å€¼æ˜¯10000ï¼Œå¦‚æžœä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡10000å¾®å¦™(10æ¯«ç§’)ï¼Œé‚£ä¹ˆå®ƒå°†è¢«è®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ å¦‚æžœslowlog-log-slower-thançš„å€¼æ˜¯0ï¼Œåˆ™ä¼šè®°å½•æ‰€æœ‰å‘½ä»¤ã€‚ å¦‚æžœslowlog-log-slower-thançš„å€¼å°äºŽ0ï¼Œåˆ™ä»»ä½•å‘½ä»¤éƒ½ä¸ä¼šè®°å½•æ—¥å¿—ã€‚ redisçš„æ“ä½œä¸€èˆ¬æ˜¯å¾®å¦™çº§ï¼Œslowlog-log-slower-thanä¸è¦è®¾ç½®å¤ªå¤§ï¼Œä¸€èˆ¬è®¾ç½®ä¸º1æ¯«ç§’ã€‚æ”¯æŒåŠ¨æ€è®¾ç½®ã€‚ æ…¢æŸ¥è¯¢æ—¥å¿—çš„é•¿åº¦slowlog-max-len slowlog-max-lenåªæ˜¯è¯´æ˜Žäº†æ…¢æŸ¥è¯¢æ—¥å¿—æœ€å¤šå­˜å‚¨å¤šå°‘æ¡ã€‚ Redisä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œshowlog-max-lenå°±æ˜¯åˆ—è¡¨çš„æœ€å¤§é•¿åº¦ã€‚ å½“æ…¢æŸ¥è¯¢æ—¥å¿—å·²ç»åˆ°è¾¾åˆ—è¡¨çš„æœ€å¤§é•¿åº¦æ—¶ï¼Œåˆæœ‰æ…¢æŸ¥è¯¢æ—¥å¿—è¦è¿›å…¥åˆ—è¡¨ï¼Œåˆ™æœ€æ—©æ’å…¥åˆ—è¡¨çš„æ—¥å¿—å°†ä¼šè¢«ç§»å‡ºåˆ—è¡¨ï¼Œæ–°æ—¥å¿—è¢«æ’å…¥åˆ—è¡¨çš„æœ«å°¾ã€‚ é»˜è®¤æ˜¯128ï¼Œä½†æ˜¯slowlog-max-lenä¸è¦è®¾ç½®å¤ªå°ï¼Œå¯ä»¥è®¾ç½®ä¸º1000ä»¥ä¸Š. æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œæ…¢æŸ¥è¯¢è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œå¯ä»¥å®šæœŸæ‰§è¡Œslow getå‘½ä»¤å°†æ…¢æŸ¥è¯¢æ—¥å¿—æŒä¹…åŒ–åˆ°å…¶ä»–å­˜å‚¨ä¸­ã€‚ç„¶åŽåˆ¶ä½œå¯è§†åŒ–ç•Œé¢æŸ¥è¯¢ã€‚ äºŒã€pipeline 2.1 ä¸ºä»€ä¹ˆä¼šå‡ºçŽ°Pipeline ç”¨æ™®é€šçš„getå’Œsetï¼Œå¦‚æžœåŒæ—¶éœ€è¦æ‰§è¡Œå¤§é‡çš„å‘½ä»¤ï¼Œé‚£å°±æ˜¯ç­‰å¾…ä¸Šä¸€æ¡å‘½ä»¤åº”ç­”åŽå†æ‰§è¡Œï¼Œè¿™ä¸­é—´ä¸ä»…ä»…å¤šäº†RTTï¼ˆRound Time Tripï¼‰ï¼Œè€Œä¸”è¿˜é¢‘ç¹çš„è°ƒç”¨ç³»ç»ŸIOï¼Œå‘é€ç½‘ç»œè¯·æ±‚ã€‚ å¯¹äºŽå¤šæ¡å‘½ä»¤ä¸æ˜¯æœ‰mgetå’Œmsetå—ï¼Ÿç¡®å®žå¯¹äºŽä¸€æ‰¹çš„getå’Œsetå¯ä»¥ç”¨mgetå’Œmsetï¼Œä½†æ˜¯å®ƒçš„é—®é¢˜åœ¨äºŽå¦‚æžœæˆ‘ä»¬éœ€è¦åŒæ—¶ä¼ è¾“getå’Œhgetå‘¢ï¼Ÿæ­¤æ—¶pipeline(æµæ°´çº¿)å°±å‡ºçŽ°äº†ã€‚ æ‰€ä»¥æµæ°´çº¿è§£å†³çš„é—®é¢˜æ˜¯Næ¡å‘½ä»¤ç½‘ç»œé€šä¿¡çš„å‡å°‘ã€‚ ä¸ºä»€ä¹ˆè¯´ç½‘ç»œè€—è´¹æ—¶é—´å¤§å‘¢ï¼Ÿè¿™é‡Œç»™å‡ºä¸€ä¸ªæžç«¯çš„ä¾‹å­ã€‚ pipelineä¸ŽåŽŸç”ŸMæ“ä½œçš„å¯¹æ¯”ã€‚ åŽŸç”ŸMæ“ä½œæ˜¯ä¸€ä¸ªåŽŸå­æ“ä½œã€‚ pipelineéžåŽŸå­å‘½ä»¤ã€‚ å½“æŸä¸ªå‘½ä»¤çš„æ‰§è¡Œéœ€è¦ä¾èµ–å‰ä¸€ä¸ªå‘½ä»¤çš„è¿”å›žç»“æžœæ—¶ï¼Œæ— æ³•ä½¿ç”¨pipelineã€‚ 12mset a â€œa1â€ b â€œbâ€ c â€œc1â€ mget a b c mgetå’Œmsetå‘½ä»¤ä¹Ÿæ˜¯ä¸ºäº†å‡å°‘ç½‘ç»œè¿žæŽ¥å’Œä¼ è¾“æ—¶é—´æ‰€è®¾ç½®çš„ï¼Œå…¶æœ¬è´¨å’Œpipelineçš„åº”ç”¨åŒºåˆ«ä¸å¤§ï¼Œä½†æ˜¯åœ¨ç‰¹å®šåœºæ™¯ä¸‹åªèƒ½ç”¨pipelineå®žçŽ°ï¼Œä¾‹å¦‚ï¼š 12get aset b â€˜1â€™ pipelineé€‚åˆæ‰§è¡Œè¿™ç§è¿žç»­ï¼Œä¸”æ— ç›¸å…³æ€§çš„å‘½ä»¤ã€‚ 2.2 ä¸€ä¸ªdemo æ­å»ºä¸€ä¸ªquickstartçš„mavenå·¥ç¨‹ã€‚è¿‡ç¨‹ç•¥ã€‚ å¼•å…¥ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt; ç›´æŽ¥å†å•å…ƒæµ‹è¯•ä¸­è¿›è¡Œæµ‹è¯•ï¼šæ™®é€šçš„ç›´æŽ¥hset 10000æ¡æ•°æ®ï¼š 1234567891011@Testpublic void test1()&#123; Jedis jedis = new Jedis("127.0.0.1",6379); long before = System.currentTimeMillis(); for(int i=0;i&lt;10000;i++)&#123; jedis.hset("hashkey"+i,"filed"+i,"value"+i); &#125; long after = System.currentTimeMillis(); System.out.println("ä¸€å…±è€—æ—¶: "+(after-before)+"ms");&#125; è¿è¡Œç»“æžœï¼š ä¸€å…±è€—æ—¶: 1526ms ä½†æ˜¯ç”¨pipelineåŽï¼š 123456789101112131415@Testpublic void test2()&#123; Jedis jedis = new Jedis("127.0.0.1",6379); long before = System.currentTimeMillis(); //åˆ†ä¸º10æ¬¡æ‰¹é‡å‘é€ for(int i=0;i&lt;10;i++)&#123; Pipeline pipeline = jedis.pipelined(); for(int j=1000*i;j&lt;(i+1)*1000;j++)&#123; pipeline.hset("hashkey:"+j,"field:"+j,"value:"+j); &#125; pipeline.syncAndReturnAll(); &#125; long after = System.currentTimeMillis(); System.out.println("ä½¿ç”¨pipelineä¸€å…±è€—æ—¶: "+(after-before)+"ms");&#125; è¿è¡Œç»“æžœï¼šä½¿ç”¨pipelineä¸€å…±è€—æ—¶: 139ms å¯ä»¥é¢„è§ï¼Œå¯¹äºŽæ›´å¤šçš„ä¼ è¾“æ¬¡æ•°ï¼Œpipelineçš„ä¼˜åŠ¿å°†è¶Šæ¥è¶Šæ˜Žæ˜¾ã€‚ä½†æ˜¯pipelineæ¯æ¬¡åªèƒ½ä½œç”¨åœ¨ä¸€ä¸ªredisèŠ‚ç‚¹ä¸Šã€‚ ä¸‰ã€å‘å¸ƒè®¢é˜… 3.1 è§’è‰² å‘å¸ƒè€…----é¢‘é“----è®¢é˜…è€… 3.2 æ¨¡åž‹ æ³¨æ„ï¼Œæ–°è®¢é˜…çš„ï¼Œæ˜¯ä¸èƒ½æ”¶åˆ°ä¹‹å‰çš„æ¶ˆæ¯çš„ã€‚ è®¢é˜…è€…1ï¼šsubscribe mytopic è®¢é˜…è€…2ï¼šsubscribe mytopic è®¢é˜…è€…3ï¼šsubscribe mytopic å‘å¸ƒè€…ï¼špublish mytopic â€œhelloâ€ ç¼ºç‚¹æ˜¯ä¸èƒ½ä¿è¯æ¶ˆæ¯å¯è¾¾ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ä¼ è¾¾æ¯”è¾ƒä¿éšœã€‚ ä¸Žå‘å¸ƒè®¢é˜…æ¨¡åž‹å¾ˆç±»ä¼¼çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æ¨¡åž‹ã€‚ åªæœ‰ä¸€ä¸ªæ˜¯å¯ä»¥æ”¶åˆ°æ¶ˆæ¯çš„ã€‚ å››ã€bitMap 4.1 ä½å›¾æ˜¯ä»€ä¹ˆ å°±æ˜¯é€šè¿‡ä¸€ä¸ªbitä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€,å…¶ä¸­çš„keyå°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº«ã€‚æˆ‘ä»¬çŸ¥é“8ä¸ªbitå¯ä»¥ç»„æˆä¸€ä¸ªByteï¼Œæ‰€ä»¥bitmapæœ¬èº«ä¼šæžå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚ Bitmapä¸æ˜¯ä¸€ä¸ªç¡®åˆ‡çš„æ•°æ®ç±»åž‹ï¼Œè€Œæ˜¯åŸºäºŽStringç±»åž‹å®šä¹‰çš„ä¸€ç³»åˆ—é¢å‘ä½æ“ä½œçš„æ–¹æ³•ã€‚å› ä¸ºStringæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„å¹¶ä¸”å®ƒä»¬çš„æœ€å¤§é•¿åº¦æ˜¯512MBï¼Œ æ‰€ä»¥Stringç±»åž‹å¾ˆåˆé€‚åŽ»ä½œä¸ºä¸€ä¸ª2^32é•¿åº¦çš„ä½æ•°ç»„ã€‚ æ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œ set hello big é‚£ä¹ˆè¿™ä¸ªbigå…¶å®žæ˜¯è¿™ä¸ªå½¢æ€ï¼š æ‰§è¡Œgetbit hello 0 å¾—åˆ°0ï¼› æ‰§è¡Œgetbit hello 1 å¾—åˆ°1 setbit hello 7 1ï¼Œé‚£ä¹ˆå†get hello å°†å¾—åˆ°cig 4.2 ä½å›¾æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ ä½å›¾é™¤äº†getbitå’Œsetbitä¹‹å¤–ï¼Œè¿˜æœ‰bitcount key [start end]ï¼Œå°±æ˜¯èŽ·å–æ‰§è¡ŒèŒƒå›´å†…çš„1çš„ä¸ªæ•°ã€‚ bitopä½œç”¨æ˜¯åšå¤šä¸ªBitmapçš„and,or,not,xoræ“ä½œã€‚ ä»¥ä¸€ä¸ªåœºæ™¯ä¸ºä¾‹ï¼šæ—¥æ´»è·ƒç”¨æˆ· æ¯æ¬¡ç”¨æˆ·ç™»å½•æ—¶ä¼šæ‰§è¡Œä¸€æ¬¡redis.setbit(daily_active_users, user_id, 1) å› ä¸ºæ—¥æ´»è·ƒç”¨æˆ·æ¯å¤©éƒ½å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦æ¯å¤©åˆ›å»ºä¸€ä¸ªæ–°çš„bitmapã€‚æˆ‘ä»¬ç®€å•åœ°æŠŠæ—¥æœŸï¼ˆå¹´æœˆæ—¥ï¼‰æ·»åŠ åˆ°keyåŽé¢ï¼Œä»¥åŽå°±å¯ä»¥æ ¹æ®å¹´æœˆæ—¥è¿™ä¸ªkeyæ‰¾åˆ°æŸå¤©æ´»è·ƒç”¨æˆ·ã€‚å®žçŽ°äº†è¿™ä¸ªåŠŸèƒ½ã€‚ ç¬¬äºŒä¸ªåœºæ™¯ï¼šç”¨æˆ·ç­¾åˆ°æƒ…å†µ å°†é‚£å¤©æ‰€ä»£è¡¨çš„ç½‘ç«™çš„ä¸Šçº¿æ—¥ä½œä¸ºoffsetå‚æ•°ï¼Œ æ¯”å¦‚,å¦‚æžœä»Šå¤©æ˜¯ç½‘ç«™ä¸Šçº¿çš„ç¬¬100å¤©,è€Œç”¨æˆ·$uid=10001åœ¨ä»Šå¤©é˜…è§ˆè¿‡ç½‘ç«™, é‚£ä¹ˆæ‰§è¡Œå‘½ä»¤SETBIT peter 100 1. å¦‚æžœæ˜Žå¤©$uid=10001ä¹Ÿç»§ç»­é˜…è§ˆç½‘ç«™,é‚£ä¹ˆæ‰§è¡Œå‘½ä»¤SETBIT peter 101 1 ,ä»¥æ­¤ç±»æŽ¨. ä»”ç»†æƒ³æƒ³ï¼Œç”¨ä½å›¾ï¼Œä¸€å¤©ç­¾åˆ°ä¸€æ¬¡åªè¦å ä¸€ä¸ªbitï¼Œ8å¤©æ‰å ä¸€ä¸ªå­—èŠ‚ã€‚é‚£ä¹ˆä¸€å¹´è¿™ä¸ªç”¨æˆ·ç­¾åˆ°å çš„æ•°æ®æ˜¯365/8=45.625ä¸ªå­—èŠ‚.å¦‚æžœä¸ç”¨ä½å›¾å®žçŽ°ï¼Œä¿å­˜ä¸€æ¡è®°å½•å°†è¿œè¿œå¤§äºŽä¸€ä¸ªæ¯”ç‰¹å§ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œå·®è·å°†ä¼šç‰¹åˆ«å¤§ã€‚ äº”ã€hyperLogLog åŸºäºŽHyperLogLogç®—æ³•ï¼šæžå°ç©ºé—´å®Œæˆç‹¬ç«‹æ•°é‡ç»Ÿè®¡ã€‚æœ¬è´¨è¿˜æ˜¯å­—ç¬¦ä¸²ã€‚ pfadd key element [element...]:å‘hyperloglogæ·»åŠ å…ƒç´  pfcount key [key...]:è®¡ç®—hyperloglogçš„ç‹¬ç«‹æ€»æ•° pfmerge destkey sourcekey [sourcekey...]:åˆå¹¶å¤šä¸ªhyperloglog apiä¾‹å­ ä¸ºä»€ä¹ˆè¦ç”¨hyperLogLogå‘¢ æˆ‘ä»¬ä¸Šé¢ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä»–çš„åŠŸèƒ½ç±»ä¼¼äºŽåŽ»é‡ï¼Œç»Ÿè®¡å‡ºæ‰€æœ‰ä¸ä¸€æ ·å…ƒç´ çš„ä¸ªæ•°ã€‚ ä»–çš„ä¼˜ç‚¹æ˜¯ï¼šå ç”¨å†…å­˜æžå°ã€‚ ç¼ºç‚¹ä¹Ÿæœ‰ï¼š ä»–å¯èƒ½ä¼šå‡ºé”™ï¼Œé”™è¯¯çŽ‡ä¸º0.81%ï¼Œçœ‹ä½ æ˜¯å¦èƒ½å¤Ÿå®¹å¿é”™è¯¯äº† ä¸èƒ½æ‹¿åˆ°å•æ¡æ•°æ® å…­ã€geo å­˜å‚¨ç»çº¬åº¦ã€è®¡ç®—ä¸¤åœ°è·ç¦»ã€èŒƒå›´è®¡ç®—ç­‰ã€‚ æåˆ°LBS(Location Based Service)ï¼ŒåŸºäºŽä½ç½®çš„æœåŠ¡ã€‚æˆ‘ç«‹å³æƒ³èµ·Mongodbçš„GEOå®žçŽ°åœ°ç†åæ ‡æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œå…·ä½“ä»‹ç»ä¸ºåœ°ç†ä½ç½®é™„è¿‘æŸ¥è¯¢çš„GEOHASHè§£å†³æ–¹æ¡ˆã€‚ mongodbæœ€å¤§çš„ç‰¹ç‚¹æ˜¯çµæ´»ï¼Œå› ä¸ºå…¶æ•°æ®æ˜¯ä»¥jsonçš„æ ¼å¼å­˜å‚¨ï¼Œæ‰€ä»¥å­—æ®µéšæ—¶å¯ä»¥å¢žåŠ æˆ–å‡å°‘ï¼›Redisçš„ç‰¹ç‚¹æ˜¯å¿«ï¼Œé€‚åˆå•ä¸€çš„ï¼Œç®€å•çš„ï¼Œå¤§é‡æ•°æ®çš„å­˜å‚¨ï¼›HBaseæˆ‘æ²¡æœ‰åšæ·±å…¥ç ”ç©¶ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å¤§ï¼Œé€‚åˆåšç¦»çº¿ç¼“å­˜ã€‚åœ¨å¤„ç†ç¤¾äº¤è¿™ç§å…³ç³»å¤æ‚çš„æ•°æ®å­˜å‚¨æ—¶ï¼Œä¾ç„¶è¿˜æ˜¯éœ€è¦ç”¨mysqlè¿™ç§å…³ç³»åž‹æ•°æ®åº“ï¼Œnosqlå¹¶ä¸èƒ½å®Œå…¨æ›¿ä»£ã€‚ ä¸ƒã€æ€»ç»“ é¦–å…ˆæ˜¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥å®šæ—¶åœ°æŒä¹…åŒ–ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªå¯è§†åŒ–é¡µé¢è¿›è¡Œç›‘æµ‹ã€‚ pipelineè§£å†³çš„æ˜¯å¯¹æ²¡æœ‰ç›¸äº’ä¾èµ–çš„æ“ä½œçš„æ‰¹é‡æ‰§è¡Œï¼Œå‡å°‘ç½‘ç»œä¼ è¾“å’ŒIOæ—¶é—´ã€‚ä½†æ˜¯å‘¢ï¼Œéœ€è¦æ³¨æ„ä¸€èˆ¬åªèƒ½å¾€ä¸€ä¸ªèŠ‚ç‚¹æ”¾æ•°æ®ï¼Œé¢å¯¹é›†ç¾¤çš„æ—¶å€™ï¼Œå°±éœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥äº†ã€‚msetã€mgetï¼Œç›®å‰åªæ”¯æŒå…·æœ‰ç›¸åŒslotå€¼çš„keyæ‰§è¡Œæ‰¹é‡æ“ä½œã€‚åŽæ–‡å†è®²ã€‚ å¯ä»¥å®žçŽ°å‘å¸ƒè®¢é˜…æ¨¡åž‹ä»¥åŠæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†æ˜¯æ¶ˆæ¯æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸èƒ½ä¿è¯æ¶ˆæ¯ä¸€å®šé€è¾¾ï¼Œæ‰€ä»¥éœ€è¦ç”¨ä¸“ä¸šçš„MQæ¥å®žçŽ°ã€‚ ä½å›¾ï¼Œå¯ä»¥å®žçŽ°æžå°çš„ç©ºé—´å®Œæˆå¯¹å¤§é‡ç”¨æˆ·ä¿¡æ¯çš„ç»Ÿè®¡ã€‚ åœ°ç†åæ ‡æœåŠ¡]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RedisåŸºæœ¬æ•°æ®ç»“æž„å’Œæ“ä½œ]]></title>
    <url>%2F2019%2F01%2F29%2Fredis%2FRedis%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»rediså¦‚ä½•å¯åŠ¨ï¼Œä»¥åŠåŸºæœ¬çš„é”®å‘½ä»¤å’Œäº”ç§åŸºæœ¬æ•°æ®ç±»åž‹çš„æ“ä½œã€‚éƒ¨åˆ†å›¾ç‰‡å¯èƒ½çœ‹ä¸æ¸…æ¥šï¼Œå¯ä»¥æ‹–åˆ°æ–°çª—å£æ‰“å¼€ã€‚ ä¸€ã€å¯åŠ¨æ–¹å¼ æˆ‘çš„çŽ¯å¢ƒæ˜¯windowsï¼Œé‚£ä¹ˆç›´æŽ¥è¿›å…¥redisçš„è§£åŽ‹ç›®å½•ä¸­ï¼Œåˆ†åˆ«æ‰§è¡Œredis-server.exeå’Œredis-cli.exeä¸¤ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºã€‚ä¹Ÿå¯ä»¥é€šè¿‡cmdå¯åŠ¨ï¼š ä¸è¦ç›´æŽ¥ç”¨crtl+Cå…³é—­serverï¼Œåœ¨linuxä¸‹ï¼Œç›´æŽ¥åœæŽ‰serverçš„è¯ï¼Œä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ã€‚æ­£ç¡®çš„åšæ³•æ˜¯åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ redis-cli.exe shutdown è¿˜å¯ä»¥æŒ‡å®šç«¯å£å¯åŠ¨ï¼š./redis-server.exe --port 6380 é‚£ä¹ˆå¯¹åº”å®¢æˆ·ç«¯è¿žæŽ¥ä¹Ÿè¦æŒ‡å®šç›¸åº” çš„ç«¯å£æ‰èƒ½è¿žæŽ¥ã€‚å…³é—­æœåŠ¡ç«¯ä¹Ÿè¦æŒ‡å®šç›¸åº”çš„ç«¯å£æ‰è¡Œï¼š -hæŒ‡å®šè¿œç¨‹redisçš„ip é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨,å¯ä»¥åœ¨ä¸‹é¢è¿™ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šç«¯å£å·ï¼š ç»“åˆé…ç½®æ–‡ä»¶å¯åŠ¨: è¿˜å¯ä»¥è®¾ç½®å¯†ç ï¼š é‚£ä¹ˆå®¢æˆ·ç«¯è¿žæŽ¥å°±å¿…é¡»è¦å¯†ç éªŒè¯äº†ï¼š äºŒã€å‘½ä»¤ 1ã€åŸºç¡€å‘½ä»¤ info:æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ select (0-15)ï¼Œredisä¸€å…±æœ‰16ä¸ªå·¥ä½œåŒºé—´ï¼Œä¸€èˆ¬é»˜è®¤ä»Ž0å¼€å§‹ï¼Œåˆ°15. flushdbï¼šæ¸…ç©ºå½“å‰é€‰æ‹©çš„ç©ºé—´ flushallï¼šæ¸…ç©ºæ‰€æœ‰ dbsizeï¼šå½“å‰ç©ºé—´é‡Œé¢key-valueé”®å€¼å¯¹çš„æ•°ç›® saveï¼šäººå·¥å®žçŽ°redisçš„æŒä¹…åŒ– quitï¼šé€€å‡º 2ã€é”®å‘½ä»¤ del keyæˆåŠŸè¿”å›ž1ï¼Œå¤±è´¥è¿”å›ž0. exits key ttlå’Œexpire type key æŸ¥çœ‹keyçš„ç±»åž‹ randomkey: rename oldkey newkey å¦‚æžœæ˜¯é‡å‘½åä¸ºå·²ç»å­˜åœ¨çš„keyå‘¢ï¼Ÿ renamenx: ä¸‰ã€redisæ•°æ®ç»“æž„ 1ã€Stringå­—ç¬¦ä¸² setex&amp;psetex getrange&amp;getset mset&amp;mget&amp;strlen setnx&amp;msetnx æ•°å€¼æ“ä½œ 2ã€hash 3ã€list 4ã€set 5ã€sorted set]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆæ­¥è®¤è¯†Redis]]></title>
    <url>%2F2019%2F01%2F29%2Fredis%2F%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86Redis%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦ä»Žæ„Ÿæ€§å±‚é¢æ¥è®¤è¯†ä¸€ä¸‹è¿™ä¸ªå¼€å‘ä¸­çš„å® å„¿ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆåº”ç”¨ï¼Œåªè¦æœ‰ç‚¹ç”¨æˆ·é‡çš„ï¼Œä¸ä¸Šredisæ˜¯ä¸å¯èƒ½çš„ã€‚ä½œä¸ºå½“ä»Šæœ€ä¼˜ç§€çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œæ²¡æœ‰ç†ç”±ä¸åŽ»æ·±å…¥äº†è§£å®ƒï¼ ä¸€ã€redisæ˜¯ä»€ä¹ˆ rediså¾ˆå¿«ï¼Œå®˜æ–¹å®£ç§°QPS(æ¯ç§’æŸ¥è¯¢çŽ‡)è¾¾10ä¸‡ã€‚ Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å•è¿›ç¨‹å•çº¿ç¨‹ã€å¯åŸºäºŽå†…å­˜äº¦å¯æŒä¹…åŒ–ã€ä¸€ä¸ªé«˜æ€§èƒ½çš„key-valueæ•°æ®åº“ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ä¸€ä¸ªç¼“å­˜æ•°æ®åº“ï¼ŒåŸºäºŽå†…å­˜ï¼Œä¹Ÿå¯ä»¥æŒä¹…åŒ–ï¼Œé€Ÿåº¦è´¼å¿«ï¼Œå‡ ä¹Žæ‰€æœ‰äº’è”ç½‘å…¬å¸éƒ½åœ¨ä½¿ç”¨ã€‚ æœ‰çš„åˆå­¦è€…å¯èƒ½çœ‹åˆ°æ•°æ®åº“è¿™ä¸ªå­—çœ¼ï¼Œå°±æŠŠä»–å½’ç±»äºŽmysqlä¹‹ç±»ï¼Œå…¶å®žä¸æ˜¯ï¼Œmysqlæ˜¯ä¸€ç§å…³ç³»åž‹æ•°æ®åº“ï¼Œæ˜¯å­˜åœ¨ç£ç›˜ä¸­çš„ã€‚æ ¸å¿ƒçš„æ•°æ®æ˜¯ä¸€å®šè¦è½åœ°åˆ°mysqlä¹‹ç±»çš„æ•°æ®åº“ä¸­çš„ã€‚rediså…¶å®žä½¿ç”¨æœ€å¤šçš„åŠŸèƒ½æ˜¯ç¼“å­˜ï¼Œæ—¢ç„¶èƒ½å­˜ä¸œè¥¿ï¼Œé‚£ä¹ˆå¿…ç„¶ä¹Ÿæœ‰æ•°æ®åº“çš„åŠŸèƒ½ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šé€ æˆæ•°æ®çš„ç¼ºå¤±ã€‚æ‰€ä»¥ï¼Œæ•°æ®ä¸€å®šæ˜¯è¦è½å…¥æ•°æ®åº“æ‰ä¿é™©ï¼Œrediså¯ä»¥ä½œä¸ºç¼“å­˜ï¼Œç¼“å­˜çƒ­ç‚¹æ•°æ®æˆ–è€…åªè¯»æ•°æ®ï¼Œæé«˜æ€§èƒ½å¹¶ä¿æŠ¤æ•°æ®åº“ã€‚ äºŒã€ä¸ºä»€ä¹ˆè¦ç”¨redis å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç¼“å­˜ä¸­é—´ä»¶ã€‚é‚£ä¹ˆå¿…ç„¶ä¸€å¤§åŠŸèƒ½æ˜¯ä½œä¸ºç¼“å­˜ä½¿ç”¨ã€‚é‚£ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜å‘¢ï¼Ÿç›´æŽ¥ä»Žæ•°æ®åº“æŸ¥ä¸å°±è¡Œäº†ç ï¼Ÿ åœ¨å®žé™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œç”¨æˆ·é‡ä¸€ä¸Šæ¥ï¼Œæ•°æ®åº“æ˜¯åƒä¸æ¶ˆçš„ã€‚æ•°æ®åº“æ˜¯æ€§èƒ½çš„ä¸€å¤§ç“¶é¢ˆï¼Œå¦‚æžœä¸é‡‡å–æŽªæ–½ï¼Œç”¨æˆ·çš„æ“ä½œå°†å¡åœ¨æ•°æ®åº“å¤„ç†è¿™ä¸€å—ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´ä¸å¯ç”¨ã€‚ é‚£ä¹ˆï¼Œæ­¤æ—¶ï¼ŒåŠ å…¥ç¼“å­˜ï¼Œæ¯”å¦‚å•†åŸŽé¦–é¡µæœ‰å¾ˆå¤šå¾ˆå¤šå†…å®¹ï¼Œè¿™äº›å†…å®¹ä¸å¯èƒ½ç»å¸¸å˜åŒ–ï¼Œè‡³å°‘ä¹Ÿè¦ä¸¤ä¸‰å¤©å§ï¼Ÿæ‰€ä»¥ï¼Œå¯ä»¥å°†è¿™äº›æ•°æ®æ”¾åˆ°redisä¸­ï¼Œç”¨æˆ·è¿›å•†åŸŽä¹‹åŽï¼Œæ•°æ®ç›´æŽ¥ä»Žredisä¸­èŽ·å–å³å¯ã€‚é€Ÿåº¦æžå¿«ï¼Œæé«˜äº†ç”¨æˆ·çš„ä½“éªŒã€‚ æ—¢ç„¶æ˜¯ç¼“å­˜ï¼Œé‚£ä¹ˆå¿…å®šä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ‰€ä»¥ç¼“å­˜æœ€é€‚åˆäºŽè¯»å¤šå†™å°‘çš„æƒ…å†µï¼Œå½“ç„¶å•¦ï¼Œè¦ä¿®æ”¹ç¼“å­˜è‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¦æ³¨æ„çƒ­ç‚¹keyçš„é—®é¢˜ï¼Œæ¯”å¦‚å¾®åšæœ€ç«çš„ä¸€ç‰‡æ–°é—»ï¼Œæ­¤æ—¶æœ‰å‡ ç™¾ä¸‡äººå†çœ‹ï¼Œä½ å´è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œè‚¯å®šæ˜¯è¦æ³¨æ„ç‚¹ä»€ä¹ˆä¸œè¥¿æ‰è¡Œçš„ï¼ŒåŽç»­çš„æ–‡ç« ä¼šè®²åˆ°å¦‚ä½•å¤„ç†çƒ­ç‚¹keyä¿®æ”¹çš„é—®é¢˜ã€‚ ä¸‰ã€Redisä¸Žå…¶ä»–key-valueå­˜å‚¨æœ‰ä»€ä¹ˆä¸åŒ è¿™é‡Œå…ˆç®€å•è¯´è¯´ï¼ŒåŽé¢ä¼šæœ‰æ–‡ç« è¯¦ç»†æ¯”ä»·ä¸€ä¸‹ã€‚ å¤šæ ·çš„æ•°æ®ç»“æž„å’ŒåŽŸå­æ€§æ“ä½œ Redisæœ‰ç€æ›´ä¸ºå¤æ‚çš„æ•°æ®ç»“æž„å¹¶ä¸”æä¾›å¯¹ä»–ä»¬çš„åŽŸå­æ€§æ“ä½œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸åŒäºŽå…¶ä»–æ•°æ®åº“çš„è¿›åŒ–è·¯å¾„ã€‚redisä¸­çš„å•ä¸ªå‘½ä»¤éƒ½æ˜¯åŽŸå­æ€§çš„ï¼Œä»€ä¹ˆæ˜¯åŽŸå­æ€§ï¼Œå°±æ˜¯è¯¥å‘½ä»¤ä¸å¯åˆ†å‰²ã€‚ è¿è¡ŒäºŽå†…å­˜+æŒä¹…åŒ–äºŽç£ç›˜ Redisè¿è¡Œåœ¨å†…å­˜ä¸­ä½†æ˜¯å¯ä»¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥åœ¨å¯¹ä¸åŒæ•°æ®é›†è¿›è¡Œé«˜é€Ÿè¯»å†™æ—¶éœ€è¦æƒè¡¡å†…å­˜ï¼Œå› ä¸ºæ•°æ®é‡ä¸èƒ½å¤§äºŽç¡¬ä»¶å†…å­˜ã€‚å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œ ç›¸æ¯”åœ¨ç£ç›˜ä¸Šç›¸åŒçš„å¤æ‚çš„æ•°æ®ç»“æž„ï¼Œåœ¨å†…å­˜ä¸­æ“ä½œèµ·æ¥éžå¸¸ç®€å•ï¼Œè¿™æ ·Rediså¯ä»¥åšå¾ˆå¤šå†…éƒ¨å¤æ‚æ€§å¾ˆå¼ºçš„äº‹æƒ…ã€‚ åŒæ—¶ï¼Œåœ¨ç£ç›˜æ ¼å¼æ–¹é¢ä»–ä»¬æ˜¯ç´§å‡‘çš„ä»¥è¿½åŠ çš„æ–¹å¼äº§ç”Ÿçš„ï¼Œå› ä¸ºä»–ä»¬å¹¶ä¸éœ€è¦è¿›è¡Œéšæœºè®¿é—®ã€‚ æ³¨ï¼šæˆ‘ä»¬è¦çŸ¥é“ï¼Œå¯¹äºŽç£ç›˜çš„é¡ºåºè®¿é—®é€Ÿåº¦æ˜¯è¿œå¤§äºŽéšæœºè®¿é—®çš„ã€‚è¿™ç§åœ¨ç¡¬ç›˜ä¸Šé¡ºåºè¿½åŠ æ•ˆçŽ‡å¾ˆé«˜ã€‚ å››ã€redisç‰¹ç‚¹ é€Ÿåº¦å¿«ï¼š åŸºäºŽå†…å­˜,è¿™æ˜¯å¿«çš„æœ€ä¸»è¦åŽŸå› ã€‚ æŒä¹…åŒ–ï¼š å¯ä»¥åŒæ­¥æˆ–å¼‚æ­¥ä¿å­˜åˆ°ç£ç›˜ä¸­ å¤šç§æ•°æ®ç»“æž„ï¼š é™¤äº†äº”ç§åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œè¿˜æ”¯æŒä½å›¾ã€HyperLogLogï¼ŒGEOç­‰ æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å®¢æˆ·ç«¯ï¼š javaï¼Œpythonï¼Œrubyï¼ŒLuaâ€¦ åŠŸèƒ½ä¸°å¯Œï¼š å¯ä»¥å®žçŽ°å‘å¸ƒ-è®¢é˜…ï¼Œæ”¯æŒäº‹åŠ¡ã€Luaè„šæœ¬ ç®€å•ï¼š ä¸ä¾èµ–ä¸Žå¤–éƒ¨åº“ã€å•çº¿ç¨‹æ¨¡åž‹ ä¸»ä»Žå¤åˆ¶ï¼š ä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®åˆ°ä»ŽæœåŠ¡å™¨ï¼Œæ˜¯é«˜å¯ç”¨çš„åŸºç¡€ é«˜å¯ç”¨ã€åˆ†å¸ƒå¼ï¼š é«˜å¯ç”¨ï¼šredis-Sentinel(v2.8ç‰ˆæœ¬)ï¼›åˆ†å¸ƒå¼ï¼šredis-cluster(v3.0ç‰ˆæœ¬) äº”ã€rediså…¸åž‹åº”ç”¨åœºæ™¯ ç¼“å­˜ç³»ç»Ÿï¼šè¿™ä¸ªå°±ä¸å¤šè¯´äº†ï¼Œredisä½œä¸ºé«˜é€Ÿç¼“å­˜æ˜¯å…¶ä¸»è¦å­˜åœ¨ä»·å€¼ã€‚ è®¡æ•°å™¨ï¼šå› ä¸ºæ˜¯åŽŸå­æ“ä½œincr+å•çº¿ç¨‹ï¼Œä½œä¸ºè®¡æ•°å™¨æ°¸è¿œä¸ä¼šå‡ºé”™ æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼šæ•°æ®ç»“æž„listå¯ä»¥å®žçŽ°è¿™ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ æŽ’è¡Œæ¦œï¼šæœ‰åºé›†åˆsorted setå°±å¯ä»¥å®žçŽ° ç¤¾äº¤ç½‘ç»œï¼šredisä¸Žç¤¾äº¤ç½‘ç»œå°±æ˜¯ä¸€å®¶ï¼Œéžå¸¸æ–¹ä¾¿ç”¨setå°±èƒ½å®žçŽ°è¯¸å¦‚å…±åŒå¥½å‹è¿™äº›åŠŸèƒ½ã€‚ å…­ã€redisä¼˜åŠ¿ ç¼“å­˜ç®¡ç†ï¼šå¯ä»¥åœ¨å¿…è¦æ—¶å°†æ— æ•ˆçš„æ—§æ•°æ®ä»Žå†…å­˜ä¸­åˆ é™¤ï¼Œä¸ºæ–°æ•°æ®è…¾å‡ºæ–°çš„ç©ºé—´ æä¾›æ›´å¤§çš„çµæ´»æ€§ï¼šredisæ”¯æŒå¤šç§ç±»åž‹ï¼Œå¹¶ä¸”é‡‡ç”¨key-value çš„å½¢å¼å­˜å‚¨ï¼Œkeyå’Œvalueçš„å¤§å°é™åˆ¶éƒ½æ˜¯512Mb,ä¸Žç¼–ç æ— å…³ï¼Œæ‰€ä»¥æ•°æ®å®‰å…¨ã€‚ä½†æ˜¯memcachedé™åˆ¶keyæœ€å¤§ä¸º250å­—èŠ‚ï¼Œvalueä¸º1MBï¼Œå†µä¸”åªæ”¯æŒStringç±»åž‹ã€‚ redisæä¾›ä¸»ä»Žå¤åˆ¶ï¼šå®žçŽ°é«˜å¯ç”¨çš„cacheç³»ç»Ÿï¼Œæ”¯æŒé›†ç¾¤ä¸­å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚ æ•°æ®æŒä¹…åŒ–ï¼šrediså¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å°†æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§„é¿ç¼“å­˜ä¸­çš„æ•°æ®ä¸ç¨³å®šçš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨é‡å¯æœåŠ¡å™¨æ—¶æœ€å¿«çš„æ¢å¤ç¼“å­˜ä¸­æ‰€éœ€çš„æ•°æ®ï¼Œæé«˜äº†æ•ˆçŽ‡çš„åŒæ—¶å‡è½»äº†ä¸»æ•°æ®åº“ç³»ç»Ÿçš„å¼€é”€ã€‚ ä¸Žä¼ ç»Ÿçš„Memcachedç›¸æ¯”ï¼Œä¼˜åŠ¿è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œä¸¤è€…çš„å…·ä½“å¯¹æ¯”æˆ‘ä¼šåœ¨åŽç»­çš„æ–‡ç« ä¸­è¯¦ç»†è¯´æ˜Žã€‚è¿™é‡Œæ³¨æ„å­˜åœ¨å³åˆç†ï¼ŒMemcachedä¹Ÿæœ‰ä¸å¯æ›¿ä»£çš„é€‚ç”¨åœºæ™¯ï¼š å­˜å‚¨ä¸€äº›ç²’åº¦æ¯”è¾ƒå°çš„é™æ€æ•°æ®ï¼Œæ¯”å¦‚ä¸€äº›htmlç‰‡æ®µï¼ŒMemcachedä¾¿æ˜¯æˆ‘ä»¬æ›´å¥½çš„é€‰æ‹©ã€‚ç›¸å¯¹äºŽredisè€Œè¨€ï¼ŒMemcachedçš„å…ƒæ•°æ®metadataæ›´å°äº›ï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è®²å¯¹äºŽæ•°æ®å­˜å‚¨ç®¡ç†çš„æ€§èƒ½æ›´é«˜ï¼Œé¢å¤–å¼€é”€æ›´å°ã€‚ Memcachedçš„ç‰¹ç‚¹ï¼šMemcachedå”¯ä¸€æ”¯æŒçš„æ•°æ®ç±»åž‹æ˜¯String,æ‰€ä»¥æ›´é€‚åˆå­˜å‚¨åªè¯»æ•°æ®ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¹¶ä¸ä¼šå› ä¸ºé¢å¤–çš„å¤„ç†é€ æˆé¢å¤–çš„å¼€é”€ã€‚æ¯•ç«ŸMemcachedæ¯æ¬¡æ›´æ–°ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œéƒ½éœ€è¦é‡å¤æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼šèŽ·å–æ•´ä¸ªå­—ç¬¦ä¸²-&gt;ååºåˆ—åŒ–ä¸ºå¯¹è±¡-&gt;ä¿®æ”¹å…¶ä¸­çš„å€¼-&gt;å†æ¬¡åºåˆ—åŒ–è¯¥å¯¹è±¡-&gt;åœ¨ç¼“å­˜ä¸­å°†æ•´ä¸ªå­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ–°å­—ç¬¦ä¸²ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ›´æ–°å­˜å‚¨æ•°æ®å°±ä¼šæœ‰æ›´é«˜çš„æ¶ˆè€—ï¼Œå¯èƒ½å°±ä¸æ˜¯æˆ‘ä»¬çš„æœ€ä½³é€‰æ‹©äº†ã€‚ ä¸ƒã€æ€»ç»“ åªè¦è®°ä½redisä¸‰ä¸ªå…³é”®å­—ï¼šå¿«ã€æŒä¹…åŒ–ã€é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åœ°ç†ä½ç½®é™„è¿‘æŸ¥è¯¢çš„GEOHASHè§£å†³æ–¹æ¡ˆ]]></title>
    <url>%2F2019%2F01%2F29%2Fmiscellany%2F12%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E9%99%84%E8%BF%91%E6%9F%A5%E8%AF%A2%E7%9A%84GEOHASH%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%2F</url>
    <content type="text"><![CDATA[åœ°ç†ä½ç½®é™„è¿‘æŸ¥è¯¢çš„GEOHASHè§£å†³æ–¹æ¡ˆ 1.éœ€æ±‚åœºæ™¯ çŽ°ä»Šäº’è”ç½‘ç¡®å®žä»Žæ–¹æ–¹é¢é¢å½±å“æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚çŽ°åœ¨æˆ‘ä»¬å¯ä»¥è¶³ä¸å‡ºæˆ·å°±èƒ½ä¹°åˆ°æˆ‘ä»¬å¿ƒä»ªçš„è¡£æœï¼Œæ‰¾åˆ°é™„è¿‘çš„ç¾Žé£Ÿã€‚å½“æˆ‘ä»¬ç‚¹å¼€ä¸€ä¸ªå¤–å–çš„appå°±èƒ½çœ‹åˆ°è‡ªå·±é™„è¿‘çš„é¤åŽ…ï¼Œé‚£æˆ‘ä»¬æœ‰æ²¡æœ‰æƒ³è¿‡è¿™æ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ 2.å°è¯•è§£å†³ é¦–å…ˆæˆ‘ä»¬èƒ½æƒ³åˆ°çš„å°±æ˜¯æŠŠæ‰€æœ‰é¤åŽ…çš„ç»çº¬åº¦å­˜ä¸‹æ¥ ç„¶åŽå½“ç”¨æˆ·é€‰æ‹©é™„è¿‘é¤åŽ…æ—¶ æˆ‘ä»¬å…ˆèŽ·å–ç”¨æˆ·çš„ç»çº¬åº¦ï¼Œç„¶åŽåˆ°æ•°æ®åº“ä¸­æŸ¥å‡ºæ‰€æœ‰çš„ç»çº¬åº¦ï¼Œä¾æ¬¡è®¡ç®—å®ƒä»¬å’Œç”¨æˆ·é—´çš„è·ç¦»ã€‚ æœ€åŽæ ¹æ®ç”¨æˆ·è¾“å…¥çš„è·ç¦»èŒƒå›´è¿‡æ»¤å‡ºåˆé€‚çš„é¤åŽ…ï¼Œå¹¶æ ¹æ®è·ç¦»åšä¸€ä¸ªå‡åºæŽ’åˆ—ã€‚ è¿™æ ·è²Œä¼¼èƒ½æŸ¥å‡ºé™„è¿‘çš„é¤åŽ…ï¼Œä½†æ˜¯é¤åŽ…çš„æ•°é‡è¿™ä¹ˆå¤šï¼Œç›´æŽ¥å…¨æŸ¥å‡ºæ¥å†…å­˜ä¹Ÿè¦çˆ†æŽ‰ï¼Œå³ä½¿åˆ†æ‰¹å¤„ç†è®¡ç®—é‡ä¹Ÿååˆ†å¤§ã€‚è¿™æ ·ç”¨æˆ·ç­‰å¾…çš„æ—¶é—´å°±ä¼šç‰¹åˆ«é•¿ã€‚é‚£æœ‰ä»€ä¹ˆåŠžæ³•èƒ½å‡å°‘æˆ‘ä»¬çš„è®¡ç®—é‡å‘¢ï¼Ÿ å…¶å®žå¾ˆç®€å•ï¼Œæˆ‘ä»¬åº”è¯¥åªè®¡ç®—ç”¨æˆ·å…³å¿ƒçš„é‚£ä¸€ç‰‡æ•°æ®ï¼Œè€Œä¸æ˜¯è®¡ç®—æ‰€æœ‰çš„ã€‚ä¾‹å¦‚ç”¨æˆ·åœ¨åŒ—äº¬ï¼Œé‚£å®Œå…¨æ²¡å¿…è¦è®¡ç®—æµ·å—ï¼Œé»‘é¾™æ±Ÿï¼Œæ–°ç–†ï¼Œæµ™æ±Ÿç­‰å…¶å®ƒåœ°åŒºçš„æ•°æ®ã€‚å¦‚æžœæˆ‘ä»¬èƒ½å¿«é€Ÿå®šä½åˆ°åŒ—äº¬ç”šè‡³æŸä¸ªåŒºï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è®¡ç®—é‡å°†å¤§å¤§å‡å°‘ã€‚æˆ‘ä»¬å‘çŽ°è¿™å…¶å®žå°±æ˜¯ç´¢å¼•çš„åŠŸèƒ½ï¼Œä½†æ˜¯MySQLå¯¹è¿™ç§äºŒç»´çš„åœ°ç†ä½ç½®çš„ç´¢å¼•æ”¯æŒå¹¶ä¸å‹å¥½ï¼ˆmongodbæœ‰ç›´æŽ¥çš„åœ°ç†ä½ç½®ç´¢å¼•ï¼‰ï¼Œå®ƒå¯¹ä¸€ç»´çš„åƒå­—ç¬¦ä¸²è¿™æ ·çš„æ”¯æŒå¾ˆå¥½ã€‚é‚£å¦‚æžœæˆ‘ä»¬çš„æ•°æ®åœ¨MySQLä¸­ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½å°†æˆ‘ä»¬çš„äºŒç»´åæ ‡è½¬æ¢ä¸ºä¸€ç§å¯æ¯”è¾ƒçš„å­—ç¬¦ä¸²å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„geohashç®—æ³•ã€‚ 3.åŸºæœ¬æ€æƒ³ geohashç®€å•æ¥è¯´å°±æ˜¯å°†ä¸€ä¸ªåœ°ç†åæ ‡è½¬æ¢ä¸ºä¸€ä¸ªå¯æ¯”è¾ƒçš„å­—ç¬¦ä¸²çš„ç®—æ³•ã€‚ä¸è¿‡ç”Ÿæˆçš„å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªçŸ©å½¢çš„èŒƒå›´ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç‚¹ã€‚ æ¯”å¦‚è¥¿äºŒæ——åœ°é“é™„è¿‘è¿™ä¸€ç‰‡çŸ©å½¢åŒºåŸŸå°±å¯ä»¥ç”¨wx4eyu82è¿™ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¹¶ä¸”è¶Šé å‰çš„ç¼–ç è¡¨ç¤ºé¢èŒƒå›´è¶Šå¤§ï¼Œæ¯”å¦‚ä¸­å›½ç»å¤§éƒ¨åˆ†åœ°åŒºå¯ä»¥ç”¨wè¿™ä¸ªå­—æ¯è¡¨ç¤ºçš„çŸ©å½¢åŒºåŸŸå†…ã€‚åƒwx4eyu82è¡¨ç¤ºçš„åŒºåŸŸä¸€å®šåœ¨wx4eè¡¨ç¤ºçš„åŒºåŸŸèŒƒå›´å†…ã€‚åˆ©ç”¨è¿™äº›ç‰¹æ€§æˆ‘ä»¬å°±å¯ä»¥å®žçŽ°é™„è¿‘é¤åŽ…çš„åŠŸèƒ½äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›æŸ¥çœ‹è¥¿äºŒæ——åœ°é“é™„è¿‘çš„é¤åŽ…å°±å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼šselect * from table where geohash like 'wx4eyu82%'; è¿™æ ·å°±å¯ä»¥åˆ©ç”¨ç´¢å¼•ï¼Œå¿«é€ŸæŸ¥è¯¢å‡ºç›¸å…³é¤åŽ…çš„ä¿¡æ¯äº†ã€‚å¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥ç”¨wx4eyu82ä¸ºkeyï¼Œé¤åŽ…ä¿¡æ¯ä¸ºvalueåšç¼“å­˜ã€‚ é€šè¿‡ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬çŸ¥é“äº†GeoHashå°±æ˜¯ä¸€ç§å°†ç»çº¬åº¦è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿å¾—åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸²å‰ç¼€åŒ¹é…è¶Šå¤šçš„è·ç¦»è¶Šè¿‘. 4.GeoHashç®—æ³•çš„æ­¥éª¤ é¦–å…ˆæˆ‘ä»¬å°†ç»åº¦å’Œçº¬åº¦éƒ½å•ç‹¬è½¬æ¢ä¸ºä¸€ä¸ªäºŒè¿›åˆ¶ç¼–ç  å¾—åˆ°ç»åº¦å’Œçº¬åº¦çš„äºŒè¿›åˆ¶ç¼–ç åŽï¼Œæˆ‘ä»¬æŒ‰ç…§å¥‡æ•°ä½æ”¾çº¬åº¦ï¼Œå¶æ•°ä¸ºæ”¾ç»åº¦çš„è§„åˆ™ï¼ˆæˆ‘ä»¬è¿™é‡Œå¥‡æ•°å¶æ•°ä¸‹æ ‡æ˜¯ä»Ž0å¼€å§‹ï¼‰å°†å®ƒä»¬åˆæˆä¸€ä¸ªäºŒè¿›åˆ¶ç¼–ç  æœ€åŽæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªäºŒè¿›åˆ¶ç¼–ç è½¬æ¢ä¸ºbase32ç¼–ç  ä¸¾ä¾‹ åœ°çƒçº¬åº¦åŒºé—´æ˜¯[-90,90]ï¼Œ åŒ—æµ·å…¬å›­çš„çº¬åº¦æ˜¯39.928167ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢ç®—æ³•å¯¹çº¬åº¦39.928167è¿›è¡Œé€¼è¿‘ç¼–ç : åŒºé—´[-90,90]è¿›è¡ŒäºŒåˆ†ä¸º[-90,0),[0,90]ï¼Œç§°ä¸ºå·¦å³åŒºé—´ï¼Œå¯ä»¥ç¡®å®š39.928167å±žäºŽå³åŒºé—´[0,90]ï¼Œç»™æ ‡è®°ä¸º1ï¼› æŽ¥ç€å°†åŒºé—´[0,90]è¿›è¡ŒäºŒåˆ†ä¸º [0,45),[45,90]ï¼Œå¯ä»¥ç¡®å®š39.928167å±žäºŽå·¦åŒºé—´ [0,45)ï¼Œç»™æ ‡è®°ä¸º0ï¼› é€’å½’ä¸Šè¿°è¿‡ç¨‹39.928167æ€»æ˜¯å±žäºŽæŸä¸ªåŒºé—´[a,b]ã€‚éšç€æ¯æ¬¡è¿­ä»£åŒºé—´[a,b]æ€»åœ¨ç¼©å°ï¼Œå¹¶è¶Šæ¥è¶Šé€¼è¿‘39.928167ï¼› å¦‚æžœç»™å®šçš„çº¬åº¦xï¼ˆ39.928167ï¼‰å±žäºŽå·¦åŒºé—´ï¼Œåˆ™è®°å½•0ï¼Œå¦‚æžœå±žäºŽå³åŒºé—´åˆ™è®°å½•1ï¼Œè¿™æ ·éšç€ç®—æ³•çš„è¿›è¡Œä¼šäº§ç”Ÿä¸€ä¸ªåºåˆ—1011100ï¼Œåºåˆ—çš„é•¿åº¦è·Ÿç»™å®šçš„åŒºé—´åˆ’åˆ†æ¬¡æ•°æœ‰å…³ã€‚ é€šè¿‡ä¸Šè¿°è®¡ç®—ï¼Œçº¬åº¦äº§ç”Ÿçš„ç¼–ç ä¸º10111 00011ï¼Œç»åº¦äº§ç”Ÿçš„ç¼–ç ä¸º11010 01011ã€‚å¶æ•°ä½æ”¾ç»åº¦ï¼Œå¥‡æ•°ä½æ”¾çº¬åº¦ï¼ŒæŠŠ2ä¸²ç¼–ç ç»„åˆç”Ÿæˆæ–°ä¸²ï¼š11100 11101 00100 01111ã€‚ æœ€åŽä½¿ç”¨ç”¨0-9ã€b-zï¼ˆåŽ»æŽ‰a, i, l, oï¼‰è¿™32ä¸ªå­—æ¯è¿›è¡Œbase32ç¼–ç ï¼Œé¦–å…ˆå°†11100 11101 00100 01111è½¬æˆåè¿›åˆ¶ï¼Œå¯¹åº”ç€28ã€29ã€4ã€15ï¼Œåè¿›åˆ¶å¯¹åº”çš„ç¼–ç å°±æ˜¯wx4gã€‚ 5.ç¼ºé™·-geohashçš„è¾¹ç•Œé—®é¢˜ æ¯”å¦‚çº¢è‰²çš„ç‚¹æ˜¯æˆ‘ä»¬çš„ä½ç½®ï¼Œç»¿è‰²çš„ä¸¤ä¸ªç‚¹åˆ†åˆ«æ˜¯é™„è¿‘çš„ä¸¤ä¸ªé¤é¦†ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¼šå‘çŽ°è·ç¦»è¾ƒè¿œé¤é¦†çš„GeoHashç¼–ç ä¸Žæˆ‘ä»¬ä¸€æ ·ï¼ˆå› ä¸ºåœ¨åŒä¸€ä¸ªGeoHashåŒºåŸŸå—ä¸Šï¼‰ï¼Œè€Œè¾ƒè¿‘é¤é¦†çš„GeoHashç¼–ç ä¸Žæˆ‘ä»¬ä¸ä¸€è‡´ã€‚ ç›®å‰æ¯”è¾ƒé€šè¡Œçš„åšæ³•å°±æ˜¯æˆ‘ä»¬ä¸ä»…èŽ·å–å½“å‰æˆ‘ä»¬æ‰€åœ¨çš„çŸ©å½¢åŒºåŸŸï¼Œè¿˜èŽ·å–å‘¨å›´8ä¸ªçŸ©å½¢å—ä¸­çš„ç‚¹ã€‚é‚£ä¹ˆæ€Žæ ·å®šä½å‘¨å›´8ä¸ªç‚¹å‘¢ï¼Ÿå…³é”®å°±æ˜¯éœ€è¦èŽ·å–å‘¨å›´8ä¸ªç‚¹çš„ç»çº¬åº¦ï¼Œé‚£æˆ‘ä»¬å·²ç»çŸ¥é“è‡ªå·±çš„ç»çº¬åº¦ï¼Œåªéœ€è¦ç”¨è‡ªå·±çš„ç»çº¬åº¦å‡åŽ»æœ€å°åˆ’åˆ†å•ä½çš„ç»çº¬åº¦å°±è¡Œã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“ç»çº¬åº¦çš„èŒƒå›´,åˆçŸ¥é“éœ€è¦åˆ’åˆ†çš„æ¬¡æ•°ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å°±èƒ½è®¡ç®—å‡ºæœ€å°åˆ’åˆ†å•ä½çš„ç»çº¬åº¦ã€‚ 6.å‡ ç§å®žçŽ°geohashæ–¹æ¡ˆçš„å¯¹æ¯” 6.1æ”¯æŒäºŒç»´ç´¢å¼•çš„å­˜å‚¨æ•°æ®åº“ï¼šmongodb mongoDBæ”¯æŒäºŒç»´ç©ºé—´ç´¢å¼•,ä½¿ç”¨ç©ºé—´ç´¢å¼•,mongoDBæ”¯æŒä¸€ç§ç‰¹æ®ŠæŸ¥è¯¢,å¦‚æŸåœ°å›¾ç½‘ç«™ä¸Šå¯ä»¥æŸ¥æ‰¾ç¦»ä½ æœ€è¿‘çš„å’–å•¡åŽ…,é“¶è¡Œç­‰ä¿¡æ¯ã€‚è¿™ä¸ªä½¿ç”¨mongoDBçš„ç©ºé—´ç´¢å¼•ç»“åˆç‰¹æ®Šçš„æŸ¥è¯¢æ–¹æ³•å¾ˆå®¹æ˜“å®žçŽ°ã€‚ APIç›´æŽ¥æ”¯æŒï¼Œå¾ˆæ–¹ä¾¿ æ”¯æŒæŒ‰ç…§è·ç¦»æŽ’åºï¼Œå¹¶æ”¯æŒåˆ†é¡µã€‚æ”¯æŒå¤šæ¡ä»¶ç­›é€‰ã€‚ å¯æ»¡è¶³å®žæ—¶æ€§éœ€æ±‚ã€‚ èµ„æºå ç”¨å¤§ï¼Œæ•°æ®é‡è¾¾åˆ°ç™¾ä¸‡çº§è¯·æµé‡åœ¨10wå·¦å³æŸ¥è¯¢é€Ÿåº¦æ˜Žæ˜¾ä¸‹é™ã€‚ 6.2å‡çº§Mysqlè‡³5.7ï¼Œæ”¯æŒGeohash MySQL 5.7.5 å¢žåŠ äº†å¯¹GeoHashçš„æ”¯æŒï¼Œæä¾›äº†ä¸€ç³»åˆ—geohashçš„å‡½æ•°ï¼Œä½†æ˜¯å…¶å®žMysqlå¹¶æ²¡æœ‰æä¾›ç±»ä¼¼mogodbç±»åž‹nearè¿™æ ·çš„å‡½æ•°ï¼Œä»…ä»…æä¾›äº†ä¸€äº›ç»çº¬åº¦è½¬hashã€hashå–ç»çº¬åº¦çš„ä¸€äº›å‡½æ•°ã€‚ ä¼˜ç‚¹:å‡½æ•°ç›´æŽ¥è°ƒç”¨ï¼Œç”Ÿæˆç›®æ ‡hashã€æ ¹æ®hashèŽ·å–ç»çº¬åº¦ã€‚ ç¼ºç‚¹ï¼šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢å‡½æ•°ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†å‘¨è¾¹8ç‚¹çš„é—®é¢˜ï¼Œéœ€è¦è¡¥å……geoçš„ç®—æ³• 6.3Redis Commands: Geography Edition GEO ç‰¹æ€§åœ¨ Redis 3.2 ç‰ˆå‘å¸ƒï¼Œ è¿™ä¸ªåŠŸèƒ½å¯ä»¥å°†ç”¨æˆ·ç»™å®šçš„åœ°ç†ä½ç½®ä¿¡æ¯å‚¨å­˜èµ·æ¥ï¼Œ å¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œæ“ä½œï¼ŒGEOé€šè¿‡å¦‚ä¸‹å‘½ä»¤æ¥å®ŒæˆGEOéœ€æ±‚. å‘½ä»¤ æè¿° geoadd æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªç»çº¬åº¦åœ°ç†ä½ç½® georadius èŽ·å–æŒ‡å®šèŒƒå›´å†…çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å¢žåŠ å‚æ•°withdistanceç›´æŽ¥ç®—å‡ºè·ç¦»ï¼Œä¹Ÿå¯ä»¥å¢žåŠ å‚æ•°descending/ascending è¿›è¡Œè·ç¦»æŽ’åº georadiusbymember é€šè¿‡æŒ‡å®šçš„å¯¹è±¡ï¼ŒèŽ·å–å…¶å‘¨è¾¹å¯¹è±¡ geoencode è½¬æ¢ä¸ºgeohashï¼Œ52-bitï¼ŒåŒæ—¶è¿”å›žè¯¥åŒºåŸŸæœ€å°è§’çš„geohash,æœ€å¤§è§’çš„geohashï¼ŒåŠä¸­å¿ƒç‚¹ geodecode åŒä¸Šé€†æ“ä½œ ä¼˜ç‚¹:æ•ˆçŽ‡é«˜ï¼ŒAPIä¸°å¯Œ ç¼ºç‚¹ï¼š3.2ç‰ˆæœ¬æ˜¯å¦ç¨³å®šï¼Ÿ é¢è¯•çš„æ—¶å€™ï¼Œé—®åˆ°geohashç®—æ³•ä»¥åŠæŠ€æœ¯é€‰åž‹å¤§æ¦‚ä¹Ÿèƒ½è¯´ä¸€è¯´äº†â€¦ æœ¬æ–‡ç« å€Ÿé‰´å¾ˆå¤šä¼˜ç§€æ–‡ç« ï¼Œä¸ƒæ‹¼å…«å‡‘è€Œå‡ºã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¡¥ç çš„å‰ä¸–ä»Šç”Ÿ]]></title>
    <url>%2F2019%2F01%2F29%2Fjava-basic%2F%E8%A1%A5%E7%A0%81%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºå¦‚ä½•æ¥ä¿å­˜è´Ÿæ•°å‘¢ï¼Ÿå…¶å®žåªè¦è¾¾åˆ°è¿™æ ·çš„ç›®çš„ï¼šæ­£æ•°è´Ÿæ•°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†å³å¯ï¼Œä½†æ˜¯ï¼Œæ­£å¦‚äººç±»ç”¨+1å’Œ-1æ¥è¡¨ç¤ºå¯ä»¥æé«˜æ•ˆçŽ‡ä¸€æ ·ï¼Œä¹Ÿå¾—æœ‰ä¸€ä¸ªæ¯”è¾ƒé€‚å½“çš„é€‚åˆæˆ‘ä»¬çš„è®¡ç®—æœºè¯†åˆ«çš„ä¸€ä¸ªæ–¹å¼ã€‚ä¸‹é¢æ¥è¯¦ç»†è®²è§£ã€‚ é—®é¢˜çš„ç”±æ¥ ä¸‹é¢ä¸ºäº†è¡¨ç¤ºæ–¹ä¾¿ï¼Œå…ˆå‡è®¾å­˜å‚¨ä¸€ä¸ªæ•´åž‹æ•°å­—ç”¨4ä¸ªbitã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œ+2åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶çš„0010ï¼Œé‚£ä¹ˆ-2æ€Žä¹ˆè¡¨ç¤ºå‘¢ï¼Ÿ å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¯ä»¥å°†ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆbitï¼‰ä¸“é—¨è§„å®šä¸ºç¬¦å·ä½ï¼Œå®ƒç­‰äºŽ0æ—¶å°±è¡¨ç¤ºæ­£æ•°ï¼Œç­‰äºŽ1æ—¶å°±è¡¨ç¤ºè´Ÿæ•°ã€‚æ¯”å¦‚ï¼Œåœ¨8ä½æœºä¸­ï¼Œè§„å®šæ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ä¸ºç¬¦å·ä½ã€‚é‚£ä¹ˆï¼Œ+2å°±æ˜¯0010ï¼Œè€Œ-8åˆ™æ˜¯1010ã€‚ æ›´å¤šçš„ä¾‹å­å¦‚ä¸‹ï¼š è¿™å°±æ˜¯ç›´æŽ¥ç”¨åŽŸç çš„æ–¹å¼æ¥å­˜å‚¨ï¼Œè™½ç„¶è¯´è¿™ç§æ–¹å¼ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œæ¯•ç«Ÿæ¯ä¸ªæ•°æˆ‘éƒ½å”¯ä¸€æ ‡è¯†äº†ã€‚ ä½†æ˜¯è¿™ç§æ–¹å¼å­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›+1å’Œ-1ç›¸åŠ ä¸º0ï¼Œä½†æ˜¯é€šè¿‡è¿™ä¸ªæ–¹å¼ç®—å‡ºæ¥çš„æ˜¯ï¼š0001+1001=1010 (-2)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‰ç…§æ­£å¸¸ä¸€æ­¥å¤´çš„æ–¹å¼å¾—ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æžœã€‚ ä¸ºäº†è§£å†³äº†â€œæ­£è´Ÿç›¸åŠ ç­‰äºŽ0â€çš„é—®é¢˜ï¼Œäººä»¬å‘æ˜Žäº†åç ã€‚ åç  â€œåç â€è¡¨ç¤ºæ–¹å¼æ˜¯ç”¨æ¥å¤„ç†è´Ÿæ•°çš„ï¼Œç¬¦å·ä½ç½®ä¸å˜ï¼Œå…¶ä½™ä½ç½®ç›¸åã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬å†æ¥ç®—ä¸€ä¸‹+1å’Œ-1ç›¸åŠ ï¼Œå˜æˆäº†0001+1110=1111ï¼Œåˆšå¥½åç è¡¨ç¤ºæ–¹å¼ä¸­ï¼Œ1111è±¡å¾-0ã€‚ æ­¤æ—¶ï¼Œå¥½åƒæ˜¯è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å‘çŽ°ï¼Œ0è¿™ä¸ªæ—¶å€™æœ‰äº†ä¸¤ç§è¡¨è¾¾ï¼š0000å’Œ1111ã€‚ å³åœ¨ç”¨åç è¡¨ç¤ºçš„æƒ…å†µä¸‹ï¼Œ0ç«Ÿç„¶å¯ä»¥ç”¨ä¸¤ä¸ªå€¼æ¥è¡¨ç¤ºï¼Œè¿™æ˜¾ç„¶ä¸å¥½å§ã€‚æ¯•ç«Ÿ+0å’Œ-0å°±æ˜¯åŒä¸€ä¸ªçŽ©æ„å•Šã€‚ è¿™ä¸ªæ—¶å€™è¡¥ç é—ªäº®ç™»åœºã€‚ è¡¥ç  å¾ˆç®€å•ï¼Œåœ¨åˆšæ‰åç çš„åŸºç¡€ä¸ŠåŠ 1ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬è¿™é‡Œå‡å®šæ•´å½¢åªæœ‰4ä½ã€‚é‚£ä¹ˆ-0è¡¨ç¤ºä¸º1111+1=10000ï¼Œæ˜¾ç„¶æº¢å‡ºäº†ï¼Œå°±éœ€è¦ä¸¢å¼ƒæœ€é«˜ä½ï¼Œå˜æˆ0000. æ­¤æ—¶ï¼Œç¥žå¥‡åœ°å‘çŽ°ï¼Œè¾¾åˆ°äº†ç»Ÿä¸€ï¼Œ+0å’Œ-0éƒ½æ˜¯ç”¨0000æ¥è¡¨ç¤ºäº†ã€‚ æ­¤æ—¶ï¼Œä¹Ÿæ»¡è¶³æ­£è´Ÿæ•°ç›¸åŠ ä¸º0çš„æ¡ä»¶ã€‚æ¯”å¦‚+2ä¸º0010ï¼Œ-2ä¸º1110.æ­¤æ—¶ä¸¤è€…ç›¸åŠ ä¸ºï¼š0010+1110=(0)0000ï¼Œä¸¢æŽ‰æœ€é«˜ä½å°±æ˜¯0000 é‚£ä¹ˆå¯¹äºŽæ™®é€šæƒ…å†µï¼Œæ¯”å¦‚7+(-4)å‘¢?å³0111+1100=0011ï¼Œå°±æ˜¯3ã€‚OKï¼Œå¤§åŠŸå‘Šæˆã€‚ è¡¥ç æ€Žä¹ˆæ±‚ ä¸Šé¢å·²ç»è¯´çš„å¾ˆè¯¦ç»†å•¦ï¼Œæ¯”å¦‚-4ï¼Œå°±æ˜¯åœ¨4(0100)çš„åŸºç¡€ä¸Šå–å(1011)å†åŠ ä¸€(1100). ä¸Šé¢ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆè¦ç”¨è¡¥ç ã€‚å³ä¿è¯äº†å¯¹ç§°çš„æ­£è´Ÿæ•°ç›¸åŠ ä¸º0å¹¶ä¸”0åªæœ‰ä¸€ç§è¡¨ç¤ºæ–¹å¼ã€‚ è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹å°±æ˜¯ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œ7-4å…¶å®žæˆ‘ä»¬éƒ½æ˜¯è½¬æ¢æˆ7+(-4)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è®¡ç®—æœºä¸­ï¼Œå‡æ³•éƒ½æ˜¯ç”¨åŠ æ³•çš„é€»è¾‘å®žçŽ°çš„ã€‚ å³ï¼šä¸€å¥—åŠ æ³•çš„ç”µè·¯å®žçŽ°åŠ å‡æ³•ã€‚æ­¤å¤–ï¼Œä¹˜æ³•å’Œé™¤æ³•å…¶å®žéƒ½æ˜¯åŠ æ³•è¿™å¥—ç”µè·¯å®žçŽ°çš„ã€‚ è¡¥ç çš„æœ¬è´¨ è¿™é‡Œå‡è®¾å­˜å‚¨ä¸€ä¸ªæ•´åž‹ç”¨8ä¸ªbitã€‚ è¦å°†æ­£æ•°è½¬æˆå¯¹åº”çš„è´Ÿæ•°ï¼Œå…¶å®žåªè¦ç”¨0å‡åŽ»è¿™ä¸ªæ•°å°±å¯ä»¥äº†ã€‚æ¯”å¦‚ï¼Œ-8å…¶å®žå°±æ˜¯0-8ã€‚ åˆ™8çš„äºŒè¿›åˆ¶æ˜¯00001000ï¼Œ-8å°±å¯ä»¥ç”¨ä¸‹é¢çš„å¼å­æ±‚å‡ºï¼š 123 ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ å› ä¸º00000000ï¼ˆè¢«å‡æ•°ï¼‰å°äºŽ0000100ï¼ˆå‡æ•°ï¼‰ï¼Œæ‰€ä»¥ä¸å¤Ÿå‡ã€‚è¯·å›žå¿†ä¸€ä¸‹å°å­¦ç®—æœ¯ï¼Œå¦‚æžœè¢«å‡æ•°çš„æŸä¸€ä½å°äºŽå‡æ•°ï¼Œæˆ‘ä»¬æ€Žä¹ˆåŠžï¼Ÿå¾ˆç®€å•ï¼Œé—®ä¸Šä¸€ä½å€Ÿ1å°±å¯ä»¥äº†ã€‚ æ‰€ä»¥ï¼Œ0000000ä¹Ÿé—®ä¸Šä¸€ä½å€Ÿäº†1ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¢«å‡æ•°å…¶å®žæ˜¯100000000ï¼Œç®—å¼ä¹Ÿå°±æ”¹å†™æˆï¼š 1234ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼ï¼ï¼ è¿›ä¸€æ­¥è§‚å¯Ÿï¼Œå¯ä»¥å‘çŽ°100000000 = 11111111 + 1ï¼Œæ‰€ä»¥ä¸Šé¢çš„å¼å­å¯ä»¥æ‹†æˆä¸¤ä¸ªï¼š 1234567 ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ï¼‘ï¼‘ï¼‘ï¼‘ï¼ï¼‘ï¼‘ï¼‘ï¼‹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼ï¼ï¼ é€šè¿‡è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±ä»Žæ•°å­¦ä¸ŠçŸ¥é“äº†ä¸ºä»€ä¹ˆè¡¥ç æ˜¯å–ååŠ ä¸€äº†ã€‚ ä½ çœ‹ï¼Œæ±‚ä»»ä½•ä¸€ä¸ªè´Ÿæ•°ï¼Œéƒ½æ˜¯0-æ­£æ•°ï¼Œé‚£ä¹ˆå°±ç”¨å€Ÿä½çš„æ€æƒ³æ¥ï¼Œåˆ™å˜æˆ100000000ã€‚ 100000000åˆ™å¯ä»¥åˆ†è§£ä¸º11111111+00000001ã€‚ æ­¤æ—¶æ±‚è´Ÿæ•°çš„è¿‡ç¨‹å°±å°±å˜æˆ11111111-X+1 è€Œå…ˆç”¨11111111æ¥å‡è¿™ä¸ªæ­£æ•°ï¼Œè¿™ä¸ªç»“æžœå°±æ˜¯å¯¹æ­£æ•°å–åã€‚ æ­¤æ—¶å†åŠ ä¸Šå¦å¤–ä¸€ä¸ª1. è¿™ä¸Žæˆ‘ä»¬æ±‚è¡¥ç çš„è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆè¦è¿™æ ·æ±‚è¡¥ç ã€‚ è¯æ˜Ž(å¯ä¸çœ‹) å°†ä¸Šé¢çš„ç‰¹ä¾‹æŠ½è±¡ä¸€ä¸‹ï¼Œç”¨ç»Ÿä¸€è¡¨è¾¾å¼æ¥è¯æ˜Žä¸€ä¸‹ã€‚ æˆ‘ä»¬è¦è¯æ˜Žçš„æ˜¯ï¼ŒX-Yæˆ–X+(-Y)å¯ä»¥ç”¨XåŠ ä¸ŠYçš„è¡¥ç å®Œæˆã€‚ Yçš„è¡¥ç ç­‰äºŽ(11111111-Y)+1ã€‚æ‰€ä»¥ï¼ŒXåŠ ä¸ŠYè¡¥ç ï¼Œå°±ç­‰äºŽï¼š 1X + (11111111-Y) + 1 æˆ‘ä»¬å‡å®šè¿™ä¸ªç®—å¼çš„ç»“æžœç­‰äºŽZï¼Œå³ 1Z = X + (11111111-Y) + 1 æŽ¥ä¸‹æ¥ï¼Œåˆ†æˆä¸¤ç§æƒ…å†µè®¨è®ºã€‚ ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚æžœXå°äºŽYï¼Œé‚£ä¹ˆZæ˜¯ä¸€ä¸ªè´Ÿæ•°ã€‚ ç”±Yçš„è¡¥ç ç­‰äºŽ(11111111-Y)+1ï¼Œæ ‡è®°ä¸ºF=(11111111-Y)+1,é‚£ä¹ˆå¦‚ä½•æ ¹æ®Fé€†å‘æ±‚Yå‘¢ï¼Ÿ 1Y=1111111-(F-1) OK,å› ä¸ºæ­¤æ—¶Zæ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œé‚£ä¹ˆZè¿›è¡Œè¡¥ç çš„é€†è¿ç®—å°±å¯ä»¥æ±‚å‡ºå®ƒçš„ç»å¯¹å€¼ï¼Œå³æ­£æ•°ã€‚å†åŠ ä¸€ä¸ªç¬¦å·ï¼Œä¸¤è€…ç›¸ç­‰ã€‚ 1Z = -[11111111-(Z-1)] = -[11111111-(X + (11111111-Y) + 1-1)] = X - Y ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æžœXå¤§äºŽY è¿™æ„å‘³ç€Zè‚¯å®šå¤§äºŽ11111111ï¼Œä½†æ˜¯æˆ‘ä»¬è§„å®šäº†è¿™æ˜¯8ä½æœºï¼Œæœ€é«˜çš„ç¬¬9ä½æ˜¯æº¢å‡ºä½ï¼Œå¿…é¡»è¢«èˆåŽ»ï¼Œè¿™ç›¸å½“äºŽå‡åŽ»100000000ã€‚æ‰€ä»¥ï¼Œ 1Z = Z - 100000000 = X + (11111111-Y) + 1 - 100000000 = X - Y è¿™å°±è¯æ˜Žäº†ï¼Œåœ¨æ­£å¸¸çš„åŠ æ³•è§„åˆ™ä¸‹ï¼Œå¯ä»¥åˆ©ç”¨2çš„è¡¥ç å¾—åˆ°æ­£æ•°ä¸Žè´Ÿæ•°ç›¸åŠ çš„æ­£ç¡®ç»“æžœã€‚æ¢è¨€ä¹‹ï¼Œè®¡ç®—æœºåªè¦éƒ¨ç½²åŠ æ³•ç”µè·¯å’Œè¡¥ç ç”µè·¯ï¼Œå°±å¯ä»¥å®Œæˆæ‰€æœ‰æ•´æ•°çš„åŠ æ³•ã€‚ æœ¬æ–‡æ•´ç†è‡ªï¼š å…³äºŽ2çš„è¡¥ç  çŸ¥ä¹Žç¬¬ä¸€æ¡è¯„è®º]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootä½¿ç”¨logbackå®žçŽ°æ—¥å¿—æŒ‰å¤©æ»šåŠ¨]]></title>
    <url>%2F2019%2F01%2F28%2Fmiscellany%2F11SpringBoot%E4%BD%BF%E7%94%A8logback%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E6%8C%89%E5%A4%A9%E6%BB%9A%E5%8A%A8%2F</url>
    <content type="text"><![CDATA[æ—¥å¿—æ˜¯ä»»ä½•ä¸€ä¸ªç³»ç»Ÿéƒ½å¿…å¤‡çš„ä¸œè¥¿ï¼Œæ—¥å¿—çš„é‡è¦ç¨‹åº¦ä¸æ¯«ä¸äºšäºŽä»£ç ã€‚è€Œspringbootä¸­ç»å¸¸ä½¿ç”¨çš„æ˜¯logbackï¼Œé‚£ä¹ˆä»Šå¤©æˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸€ä¸‹åœ¨springbootä¸‹å¦‚ä½•é…ç½®logbackæ—¥å¿—ã€‚ç†è§£äº†è¿™é‡Œçš„é…ç½®ï¼Œå¯¹äºŽä»»ä½•çš„æ—¥å¿—éƒ½æ˜¯ä¸€æ ·çš„ã€‚ éœ€æ±‚ æ—¥å¿—æŒ‰å¤©æ»šåŠ¨åˆ†å‰² infoå’Œerroræ—¥å¿—è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ ä¸ºä»€ä¹ˆä½¿ç”¨Logback Logbackæ˜¯Log4jçš„å‡çº§ç‰ˆï¼Œä½œè€…ä¸ºåŒä¸€ä¸ªäººï¼Œä½œè€…ä¸æƒ³å†åŽ»æ”¹Log4jï¼Œæ‰€ä»¥å†™äº†Logback ä½¿ç”¨æ—¥å¿—æ¡†æž¶çš„æœ€ä½³å®žè·µæ˜¯é€‰æ‹©ä¸€æ¬¾æ—¥å¿—é—¨é¢+ä¸€æ¬¾æ—¥å¿—å®žçŽ°ï¼Œè¿™é‡Œé€‰æ‹©Slf4j+Logback,Slf4jä½œè€…ä¹Ÿæ˜¯Logbackçš„ä½œè€… SpringBootä»Ž1.4ç‰ˆæœ¬å¼€å§‹ï¼Œå†…ç½®çš„æ—¥å¿—æ¡†æž¶å°±æ˜¯Logback Logbackåœ¨SpringBootä¸­é…ç½®æ–¹å¼ä¸€ å¯ä»¥ç›´æŽ¥åœ¨applicatin.propertiesæˆ–è€…application.ymlä¸­é…ç½® ä»¥åœ¨application.ymlä¸­é…ç½®ä¸ºä¾‹ 123456logging: pattern: console: "%d - %msg%n" file: /var/log/tomcat/sell.log level: com.imooc.LoggerTest: debug å¯ä»¥å‘çŽ°ï¼Œè¿™ç§é…ç½®æ–¹å¼ç®€å•ï¼Œä½†èƒ½å®žçŽ°çš„åŠŸèƒ½ä¹Ÿå¾ˆå±€é™ï¼Œåªèƒ½ å®šåˆ¶è¾“å‡ºæ ¼å¼ è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„ æŒ‡å®šæŸä¸ªåŒ…ä¸‹çš„æ—¥å¿—çº§åˆ« å¦‚æžœéœ€è¦å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™å°±å¾—ç”¨ç¬¬äºŒç§é…ç½®äº† Logbackåœ¨SpringBootä¸­é…ç½®æ–¹å¼äºŒ åœ¨resourceç›®å½•ä¸‹æ–°å»ºlogback-spring.xml, å†…å®¹å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;configuration&gt; &lt;!--æ‰“å°åˆ°æŽ§åˆ¶å°çš„æ ¼å¼--&gt; &lt;appender name="consoleLog" class="ch.qos.logback.core.ConsoleAppender"&gt; &lt;layout class="ch.qos.logback.classic.PatternLayout"&gt; &lt;pattern&gt; %d - %msg%n &lt;/pattern&gt; &lt;/layout&gt; &lt;/appender&gt; &lt;!--é™¤äº†errorçº§åˆ«çš„æ—¥å¿—æ–‡ä»¶ä¿å­˜æ ¼å¼ä»¥åŠæ»šåŠ¨ç­–ç•¥--&gt; &lt;appender name="fileInfoLog" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;!--è¿‡æ»¤å™¨ï¼Œå°†errorçº§åˆ«è¿‡æ»¤æŽ‰--&gt; &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;DENY&lt;/onMatch&gt; &lt;onMismatch&gt;ACCEPT&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder&gt; &lt;pattern&gt; %msg%n &lt;/pattern&gt; &lt;/encoder&gt; &lt;!--æ»šåŠ¨ç­–ç•¥--&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;!--è·¯å¾„--&gt; &lt;fileNamePattern&gt;/var/log/tomcat/sell/info.%d.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;!--errorçº§åˆ«æ—¥å¿—æ–‡ä»¶ä¿å­˜æ ¼å¼ä»¥åŠæ»šåŠ¨ç­–ç•¥--&gt; &lt;appender name="fileErrorLog" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;!--åªè®©errorçº§åˆ«çš„æ—¥å¿—è¿›æ¥--&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;/filter&gt; &lt;encoder&gt; &lt;pattern&gt; %msg%n &lt;/pattern&gt; &lt;/encoder&gt; &lt;!--æ»šåŠ¨ç­–ç•¥--&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;!--è·¯å¾„--&gt; &lt;fileNamePattern&gt;/var/log/tomcat/sell/error.%d.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;root level="info"&gt; &lt;appender-ref ref="consoleLog" /&gt; &lt;appender-ref ref="fileInfoLog" /&gt; &lt;appender-ref ref="fileErrorLog" /&gt; &lt;/root&gt;&lt;/configuration&gt; æ¯ä¸€ä¸ªappenderä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ—¥å¿—å¤„ç†ç­–ç•¥ã€‚ ç¬¬ä¸€ä¸ªappenderçš„name=&quot;consoleLog&quot;, åå­—æ˜¯è‡ªå·±éšæ„å–çš„ï¼Œå–è¿™ä¸ªåå­—ï¼Œè¡¨ç¤ºè¿™ä¸ªç­–ç•¥ç”¨äºŽæŽ§åˆ¶å°çš„æ—¥å¿—ã€‚ æˆ‘ä»¬é‡ç‚¹çœ‹ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªappender,å› ä¸ºè¦æŠŠinfoå’Œerroræ—¥å¿—è¾“å…¥åˆ°ä¸åŒæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†åˆ«å»ºäº†ä¸¤ä¸ªappenderã€‚ rollingPolicyæ˜¯æ»šåŠ¨ç­–ç•¥ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®æŒ‰æ—¶é—´æ»šåŠ¨ filteræ˜¯æ—¥å¿—çš„è¿‡æ»¤æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨fileInfoLogé‡Œåšäº†å¦‚ä¸‹è¿‡æ»¤ 123&lt;level&gt;ERROR&lt;/level&gt;&lt;onMatch&gt;DENY&lt;/onMatch&gt;&lt;onMismatch&gt;ACCEPT&lt;/onMismatch&gt; ä¸Šè¿°ä»£ç ç¿»è¯‘ä¹‹åŽï¼šæ‹¦æˆªERRORçº§åˆ«çš„æ—¥å¿—ã€‚å¦‚æžœåŒ¹é…åˆ°äº†ï¼Œåˆ™ç¦ç”¨å¤„ç†ã€‚å¦‚æžœä¸åŒ¹é…ï¼Œåˆ™æŽ¥å—ï¼Œå¼€å§‹å¤„ç†æ—¥å¿—ã€‚ é‚£æœ‰çš„åŒå­¦è¦é—®äº†ï¼Œä¸èƒ½è¿™æ ·å†™å— 1&lt;level&gt;INFO&lt;/level&gt; è¿™æ ·ä¸æ˜¯åªæ‹¦æˆªINFOæ—¥å¿—äº†å—ï¼Ÿ ä¸å¯¹ï¼ è¿™å°±å¾—è¯´ä¸€ä¸‹æ—¥å¿—çº§åˆ«äº† DEBUG -&gt;INFO -&gt; WARN -&gt;ERROR å¦‚æžœä½ è®¾ç½®çš„æ—¥å¿—çº§åˆ«æ˜¯INFOï¼Œé‚£ä¹ˆæ˜¯ä¼šæ‹¦æˆªERRORæ—¥å¿—çš„å“¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœç›´æŽ¥å†™infoï¼Œé‚£ä¹ˆå¤§äºŽç­‰äºŽinfoçº§åˆ«çš„æ—¥å¿—éƒ½ä¼šå†™è¿›åŽ»ï¼Œè¿èƒŒäº†æˆ‘ä»¬çš„éœ€æ±‚ã€‚ æ•´ç†è‡ªï¼š http://www.imooc.com/article/19005]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlé¢è¯•é«˜é¢‘ç†è®ºçŸ¥è¯†]]></title>
    <url>%2F2019%2F01%2F27%2Fmysql%2Fmysql%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86%2F</url>
    <content type="text"><![CDATA[æ•´ç†ä¸€äº›é¢è¯•é¢˜ï¼Œç®€å•çœ‹çœ‹ã€‚ ç›®å½• æ•°æ®åº“ä¸‰èŒƒå¼ äº‹åŠ¡ mysqlæ•°æ®åº“é»˜è®¤æœ€å¤§è¿žæŽ¥æ•° åˆ†é¡µ è§¦å‘å™¨ å­˜å‚¨è¿‡ç¨‹ ç”¨jdbcæ€Žä¹ˆè°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼Ÿ å¯¹jdbcçš„ç†è§£ å†™ä¸€ä¸ªç®€å•çš„jdbcçš„ç¨‹åºã€‚å†™ä¸€ä¸ªè®¿é—®oracleæ•°æ®çš„jdbcç¨‹åº JDBCä¸­çš„PreparedStatementç›¸æ¯”Statementçš„å¥½å¤„ æ•°æ®åº“è¿žæŽ¥æ± ä½œç”¨ é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“Ž æ•°æ®åº“ä¼˜åŒ–-ç´¢å¼• æ•°æ®åº“ä¼˜åŒ–-åˆ†è¡¨ æ•°æ®åº“ä¼˜åŒ–-è¯»å†™åˆ†ç¦» æ•°æ®åº“ä¼˜åŒ–-ç¼“å­˜ æ•°æ®åº“ä¼˜åŒ–-sqlè¯­å¥ä¼˜åŒ–çš„æŠ€å·§ jdbcæ‰¹é‡æ’å…¥å‡ ç™¾ä¸‡æ•°æ®æ€Žä¹ˆå®žçŽ° èšç°‡ç´¢å¼•å’Œéžèšç°‡ç´¢å¼• sqlæ³¨å…¥é—®é¢˜ mysqlæ‚²è§‚é”å’Œä¹è§‚é” 1. æ•°æ®åº“ä¸‰èŒƒå¼ 1.1 èŒƒå¼æ˜¯ä»€ä¹ˆ èŒƒå¼å°±æ˜¯è§„èŒƒï¼Œè¦æ»¡è¶³ç¬¬äºŒèŒƒå¼å¿…é¡»å…ˆæ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œè¦æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œå¿…é¡»è¦å…ˆæ»¡è¶³ç¬¬äºŒèŒƒå¼ã€‚ 1NF(ç¬¬ä¸€èŒƒå¼)ï¼šåˆ—æ•°æ®ä¸å¯åˆ†å‰²ï¼Œå³ä¸€åˆ—ä¸èƒ½æœ‰å¤šä¸ªå€¼ 2NF(ç¬¬äºŒèŒƒå¼)ï¼šä¸»é”®(æ¯ä¸€è¡Œéƒ½æœ‰å”¯ä¸€æ ‡è¯†) 3NF(ç¬¬ä¸‰èŒƒå¼)ï¼šå¤–é”®(è¡¨ä¸­ä¸åŒ…å«å·²åœ¨å…¶ä»–è¡¨ä¸­åŒ…å«çš„éžä¸»å…³é”®ä¿¡æ¯) 1.2 åä¸‰èŒƒå¼ åä¸‰èŒƒå¼ï¼šæœ‰æ—¶ä¸ºäº†æ•ˆçŽ‡ï¼Œå¯ä»¥è®¾ç½®é‡å¤æˆ–è€…æŽ¨å¯¼å‡ºçš„å­—æ®µï¼Œä¾‹å¦‚ï¼šè®¢å•æ€»ä»·æ ¼è®¢å•é¡¹çš„å•ä»·ï¼Œè¿™ä¸ªè®¢å•æ€»ä»·è™½ç„¶å¯ä»¥ç”±è®¢å•é¡¹è®¡ç®—å‡ºæ¥ï¼Œä½†æ˜¯å½“è®¢å•æ•°ç›®åºžå¤§æ—¶ï¼Œæ•ˆçŽ‡æ¯”è¾ƒä½Žï¼Œæ‰€ä»¥è®¢å•çš„æ€»ä»·è¿™ä¸ªå­—æ®µæ˜¯å¿…è¦çš„ã€‚ 2. äº‹åŠ¡ 2.1 å«ä¹‰ äº‹åŠ¡æ—¶å¹¶å‘æŽ§åˆ¶çš„å•ä½ï¼Œæ˜¯ç”¨æˆ·å®šä¹‰çš„ä¸€ä¸ªæ“ä½œåºåˆ—ï¼Œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšï¼Œæ˜¯ä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚ 2.2 äº‹åŠ¡çš„å››ä¸ªç‰¹å¾(ACIDç‰¹æ€§) åŽŸå­æ€§ï¼šè¡¨ç¤ºäº‹åŠ¡å†…æ“ä½œä¸å¯åˆ†å‰² ä¸€è‡´æ€§ï¼šè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ï¼Œè‹¥åŽé¢å¤±è´¥ï¼Œå‰é¢åˆ™å›žæ»š éš”ç¦»æ€§ï¼šä¸€ä¸ªäº‹åŠ¡å¼€å§‹äº†ï¼Œä¸è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰° æŒä¹…æ€§ï¼šäº‹åŠ¡å¼€å§‹äº†ï¼Œå°±ä¸èƒ½çªç„¶ç»ˆæ­¢ 3. mysqlæ•°æ®åº“é»˜è®¤æœ€å¤§è¿žæŽ¥æ•° 3.1 ä¸ºä»€ä¹ˆéœ€è¦æœ€å¤§è¿žæŽ¥æ•° ç‰¹å®šæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“åªèƒ½æ”¯æŒä¸€å®šæ•°ç›®åŒæ—¶è¿žæŽ¥ï¼Œè¿™æ—¶éœ€è¦æˆ‘ä»¬è®¾ç½®æœ€å¤§è¿žæŽ¥æ•°ï¼ˆæœ€å¤šåŒæ—¶æœåŠ¡å¤šå°‘è¿žæŽ¥ï¼‰ã€‚åœ¨æ•°æ®åº“å®‰è£…æ—¶ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„æœ€å¤§è¿žæŽ¥æ•°ã€‚ my.iniä¸­max_connections=100 4. åˆ†é¡µ 4.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ†é¡µï¼Ÿ åœ¨å¾ˆå¤šæ•°æ®æ—¶ï¼Œä¸å¯èƒ½å®Œå…¨æ˜¾ç¤ºæ•°æ®ã€‚è¿›è¡Œåˆ†æ®µæ˜¾ç¤º. 4.2 mysqlå¦‚ä½•åˆ†é¡µ 12String sql = "select * from students order by id limit " + pageSize*(pageNumber-1) + "," + pageSize; 4.3 oracleåˆ†é¡µ æ˜¯ä½¿ç”¨äº†ä¸‰å±‚åµŒå¥—æŸ¥è¯¢ã€‚ 1234String sql = &quot;select * from &quot; + (select *,rownum rid from (select * from students order by postime desc) where rid&lt;=&quot; + pagesize*pagenumber + &quot;) as t&quot; + &quot;where t&gt;&quot; + pageSize*(pageNumber-1); 5. è§¦å‘å™¨ ç•¥ã€‚ 6. å­˜å‚¨è¿‡ç¨‹ 6.1 æ•°æ®åº“å­˜å‚¨è¿‡ç¨‹å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š 1ã€å­˜å‚¨è¿‡ç¨‹åªåœ¨åˆ›å»ºæ—¶è¿›è¡Œç¼–è¯‘ï¼Œä»¥åŽæ¯æ¬¡æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹éƒ½ä¸éœ€å†é‡æ–°ç¼–è¯‘ï¼Œè€Œä¸€èˆ¬ SQL è¯­å¥æ¯æ‰§è¡Œä¸€æ¬¡å°±ç¼–è¯‘ä¸€æ¬¡ï¼Œå› æ­¤ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹å¯ä»¥å¤§å¤§æé«˜æ•°æ®åº“æ‰§è¡Œé€Ÿåº¦ã€‚ 2ã€é€šå¸¸ï¼Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘éœ€è¦å¤šæ¡ SQL è¯­å¥ã€‚è¿™äº›è¯­å¥è¦åˆ†åˆ«åœ°ä»Žå®¢æˆ·æœºå‘é€åˆ°æœåŠ¡å™¨ï¼Œå½“å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ“ä½œå¾ˆå¤šæ—¶ï¼Œå°†äº§ç”Ÿå¤§é‡çš„ç½‘ç»œä¼ è¾“ã€‚å¦‚æžœå°†è¿™äº›æ“ä½œæ”¾åœ¨ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œé‚£ä¹ˆå®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œä¼ è¾“å°±ä¼šå¤§å¤§å‡å°‘ï¼Œé™ä½Žäº†ç½‘ç»œè´Ÿè½½ã€‚ 3ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»ºä¸€æ¬¡ä¾¿å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œä»Žè€Œå¯ä»¥å‡å°‘æ•°æ®åº“å¼€å‘äººå‘˜çš„å·¥ä½œé‡ã€‚ 4ã€å®‰å…¨æ€§é«˜ï¼Œå­˜å‚¨è¿‡ç¨‹å¯ä»¥å±è”½å¯¹åº•å±‚æ•°æ®åº“å¯¹è±¡çš„ç›´æŽ¥è®¿é—®ï¼Œä½¿ç”¨ EXECUTE æƒé™è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œæ— éœ€æ‹¥æœ‰è®¿é—®åº•å±‚æ•°æ®åº“å¯¹è±¡çš„æ˜¾å¼æƒé™ã€‚ 6.2 å®šä¹‰å­˜å‚¨è¿‡ç¨‹: 12345678create procedure insert_Student (_name varchar(50),_age int ,out _id int)begin insert into student value(null,_name,_age); select max(stuId) into _id from student;end;call insert_Student('wfz',23,@id);select @id; 7. ç”¨jdbcæ€Žä¹ˆè°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼Ÿ è´¾çæ¬²æ‰§äº‹ åŠ è½½é©±åŠ¨ èŽ·å–è¿žæŽ¥ è®¾ç½®å‚æ•° æ‰§è¡Œ é‡Šæ”¾è¿žæŽ¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import java.sql.CallableStatement;import java.sql.Connection;import java.sql.DriverManager;import java.sql.SQLException;import java.sql.Types;public class JdbcTest &#123; /** * @param args */ public static void main(String[] args) &#123; // TODO Auto-generated method stub Connection cn = null; CallableStatement cstmt = null; try &#123; //è¿™é‡Œæœ€å¥½ä¸è¦è¿™ä¹ˆå¹²ï¼Œå› ä¸ºé©±åŠ¨åå†™æ­»åœ¨ç¨‹åºä¸­äº† Class.forName("com.mysql.jdbc.Driver"); //å®žé™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œåº”ç”¨DataSourceæ•°æ®ï¼Œå¦‚æžœç”¨æ¡†æž¶ï¼Œ //è¿™ä¸ªæ•°æ®æºä¸éœ€è¦æˆ‘ä»¬ç¼–ç åˆ›å»ºï¼Œæˆ‘ä»¬åªéœ€Datasource ds = context.lookup() //cn = ds.getConnection(); cn = DriverManager.getConnection("jdbc:mysql:///test","root","root"); cstmt = cn.prepareCall("&#123;call insert_Student(?,?,?)&#125;"); cstmt.registerOutParameter(3,Types.INTEGER); cstmt.setString(1, "wangwu"); cstmt.setInt(2, 25); cstmt.execute(); //getç¬¬å‡ ä¸ªï¼Œä¸åŒçš„æ•°æ®åº“ä¸ä¸€æ ·ï¼Œå»ºè®®ä¸å†™ System.out.println(cstmt.getString(3)); &#125; catch (Exception e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; finally &#123; /*try&#123;cstmt.close();&#125;catch(Exception e)&#123;&#125; try&#123;cn.close();&#125;catch(Exception e)&#123;&#125;*/ try &#123; if(cstmt != null) cstmt.close(); if(cn != null) cn.close(); &#125; catch (SQLException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; &#125; 8. å¯¹jdbcçš„ç†è§£ Java database connection javaæ•°æ®åº“è¿žæŽ¥.æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(mysql oracleç­‰)æ˜¯å¾ˆå¤šï¼Œæ¯ä¸ªæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ”¯æŒçš„å‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ã€‚ Javaåªå®šä¹‰æŽ¥å£ï¼Œè®©æ•°æ®åº“åŽ‚å•†è‡ªå·±å®žçŽ°æŽ¥å£ï¼Œå¯¹äºŽæˆ‘ä»¬è€…è€Œè¨€ã€‚åªéœ€è¦å¯¼å…¥å¯¹åº”åŽ‚å•†å¼€å‘çš„å®žçŽ°å³å¯ã€‚ç„¶åŽä»¥æŽ¥å£æ–¹å¼è¿›è¡Œè°ƒç”¨.(mysql + mysqlé©±åŠ¨ï¼ˆå®žçŽ°ï¼‰+jdbc) 9. å†™ä¸€ä¸ªç®€å•çš„jdbcçš„ç¨‹åºã€‚å†™ä¸€ä¸ªè®¿é—®oracleæ•°æ®çš„jdbcç¨‹åº è´¾çæ¬²æ‰§äº‹ åŠ è½½é©±åŠ¨(com.mysql.jdbc.Driver,oracle.jdbc.driver.OracleDriver) å–è¿žæŽ¥(DriverManager.getConnection(url,usernam,passord)) è®¾ç½®å‚æ•° Statement PreparedStatement cstmt.setXXX(index, value); æ‰§è¡Œ executeQuery executeUpdate é‡Šæ”¾è¿žæŽ¥(æ˜¯å¦è¿žæŽ¥è¦ä»Žå°åˆ°å¤§ï¼Œå¿…é¡»æ”¾åˆ°finnaly) 10. JDBCä¸­çš„PreparedStatementç›¸æ¯”Statementçš„å¥½å¤„ å¤§å¤šæ•°æˆ‘ä»¬éƒ½ä½¿ç”¨PreparedStatementä»£æ›¿Statement 1ï¼šPreparedStatementæ˜¯é¢„ç¼–è¯‘çš„ï¼Œæ¯”Statementé€Ÿåº¦å¿« 2ï¼šä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ è™½ç„¶ç”¨PreparedStatementæ¥ä»£æ›¿Statementä¼šä½¿ä»£ç å¤šå‡ºå‡ è¡Œ,ä½†è¿™æ ·çš„ä»£ç æ— è®ºä»Žå¯è¯»æ€§è¿˜æ˜¯å¯ç»´æŠ¤æ€§ä¸Šæ¥è¯´.éƒ½æ¯”ç›´æŽ¥ç”¨Statementçš„ä»£ç é«˜å¾ˆå¤šæ¡£æ¬¡ï¼š 123456789stmt.executeUpdate("insert into tb_name (col1,col2,col2,col4) values('"+var1+"','"+var2+"',"+var3+",'"+var4+"')"); perstmt = con.prepareStatement("insert into tb_name (col1,col2,col2,col4) values (?,?,?,?)");perstmt.setString(1,var1);perstmt.setString(2,var2);perstmt.setString(3,var3);perstmt.setString(4,var4);perstmt.executeUpdate(); 3ï¼šå®‰å…¨æ€§ PreparedStatementå¯ä»¥é˜²æ­¢SQLæ³¨å…¥æ”»å‡»ï¼Œè€ŒStatementå´ä¸èƒ½ã€‚ æ¯”å¦‚è¯´ï¼š String sql = â€œselect * from tb_name where name= 'â€+varname+&quot;â€™ and passwd=â€™&quot;+varpasswd+&quot;â€™&quot;; å¦‚æžœæˆ‘ä»¬æŠŠ[' or '1' = '1]ä½œä¸ºvarpasswdä¼ å…¥è¿›æ¥.ç”¨æˆ·åéšæ„,çœ‹çœ‹ä¼šæˆä¸ºä»€ä¹ˆ? select * from tb_name = â€˜éšæ„â€™ and passwd = â€˜â€™ or â€˜1â€™ = â€˜1â€™; å› ä¸º'1'='1'è‚¯å®šæˆç«‹ï¼Œæ‰€ä»¥å¯ä»¥ä»»ä½•é€šè¿‡éªŒè¯ã€‚ æ›´æœ‰ç”šè€…ï¼šæŠŠ[';drop table tb_name;]ä½œä¸ºvarpasswdä¼ å…¥è¿›æ¥,åˆ™ï¼š select * from tb_name = â€˜éšæ„â€™ and passwd = â€˜â€™;drop table tb_name; æœ‰äº›æ•°æ®åº“æ˜¯ä¸ä¼šè®©ä½ æˆåŠŸçš„ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šæ•°æ®åº“å°±å¯ä»¥ä½¿è¿™äº›è¯­å¥å¾—åˆ°æ‰§è¡Œã€‚ è€Œå¦‚æžœä½ ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ä½ ä¼ å…¥çš„ä»»ä½•å†…å®¹å°±ä¸ä¼šå’ŒåŽŸæ¥çš„è¯­å¥å‘ç”Ÿä»»ä½•åŒ¹é…çš„å…³ç³»ï¼Œåªè¦å…¨ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ä½ å°±ç”¨ä¸ç€å¯¹ä¼ å…¥çš„æ•°æ®åšä»»ä½•è¿‡è™‘ã€‚è€Œå¦‚æžœä½¿ç”¨æ™®é€šçš„statement,æœ‰å¯èƒ½è¦å¯¹dropç­‰åšè´¹å°½å¿ƒæœºçš„åˆ¤æ–­å’Œè¿‡è™‘ã€‚ 11. æ•°æ®åº“è¿žæŽ¥æ± ä½œç”¨ 1ã€é™å®šæ•°æ®åº“çš„ä¸ªæ•°ï¼Œä¸ä¼šå¯¼è‡´ç”±äºŽæ•°æ®åº“è¿žæŽ¥è¿‡å¤šå¯¼è‡´ç³»ç»Ÿè¿è¡Œç¼“æ…¢æˆ–å´©æºƒ 2ã€æ•°æ®åº“è¿žæŽ¥ä¸éœ€è¦æ¯æ¬¡éƒ½åŽ»åˆ›å»ºæˆ–é”€æ¯ï¼ŒèŠ‚çº¦äº†èµ„æº 3ã€æ•°æ®åº“è¿žæŽ¥ä¸éœ€è¦æ¯æ¬¡éƒ½åŽ»åˆ›å»ºï¼Œå“åº”æ—¶é—´æ›´å¿«ã€‚ 12. é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“Ž åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„å­˜å‚¨å¼•æ“Ž myisam / innodb/ memory MyISAMå­˜å‚¨å¼•æ“Ž å¦‚æžœè¡¨å¯¹äº‹åŠ¡è¦æ±‚ä¸é«˜ï¼ŒåŒæ—¶æ˜¯ä»¥æŸ¥è¯¢å’Œæ·»åŠ ä¸ºä¸»çš„ï¼Œæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨myisamå­˜å‚¨å¼•æ“Ž. æ¯”å¦‚ bbs ä¸­çš„ å‘å¸–è¡¨ï¼Œå›žå¤è¡¨. INNODBå­˜å‚¨å¼•æ“Ž: å¯¹äº‹åŠ¡è¦æ±‚é«˜ï¼Œä¿å­˜çš„æ•°æ®éƒ½æ˜¯é‡è¦æ•°æ®ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨INNODB,æ¯”å¦‚è®¢å•è¡¨ï¼Œè´¦å·è¡¨. Memory å­˜å‚¨ æˆ‘ä»¬æ•°æ®å˜åŒ–é¢‘ç¹ï¼Œä¸éœ€è¦å…¥åº“ï¼ŒåŒæ—¶åˆé¢‘ç¹çš„æŸ¥è¯¢å’Œä¿®æ”¹ï¼Œæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨memory, é€Ÿåº¦æžå¿«. MyISAM å’Œ INNODBçš„åŒºåˆ«(ä¸»è¦) äº‹åŠ¡å®‰å…¨ myisamä¸æ”¯æŒäº‹åŠ¡è€Œinnodbæ”¯æŒ æŸ¥è¯¢å’Œæ·»åŠ é€Ÿåº¦ myisamä¸ç”¨æ”¯æŒäº‹åŠ¡å°±ä¸ç”¨è€ƒè™‘åŒæ­¥é”ï¼ŒæŸ¥æ‰¾å’Œæ·»åŠ å’Œæ·»åŠ çš„é€Ÿåº¦å¿« æ”¯æŒå…¨æ–‡ç´¢å¼• myisamæ”¯æŒinnodbä¸æ”¯æŒ é”æœºåˆ¶ myisamæ”¯æŒè¡¨é”è€Œinnodbæ”¯æŒè¡Œé”(äº‹åŠ¡) å¤–é”® MyISAM ä¸æ”¯æŒå¤–é”®ï¼Œ INNODBæ”¯æŒå¤–é”®. (é€šå¸¸ä¸è®¾ç½®å¤–é”®ï¼Œé€šå¸¸æ˜¯åœ¨ç¨‹åºä¸­ä¿è¯æ•°æ®çš„ä¸€è‡´) ä¸‹é¢æ˜¯æ•°æ®åº“çš„ä¼˜åŒ–æ‰‹æ®µï¼Œä½†æ˜¯åªæ˜¯è¡¨é¢ï¼Œéœ€è¦ä»¥åŽå†å¥½å¥½æŽ¢ç©¶ åœ¨é¡¹ç›®è‡ªéªŒé¡¹ç›®è½¬æµ‹è¯•ä¹‹å‰ï¼Œåœ¨å¯åŠ¨mysqlæ•°æ®åº“æ—¶å¼€å¯æ…¢æŸ¥è¯¢ï¼Œå¹¶ä¸”æŠŠæ‰§è¡Œæ…¢çš„è¯­å¥å†™åˆ°æ—¥å¿—ä¸­ï¼Œåœ¨è¿è¡Œä¸€å®šæ—¶é—´åŽã€‚é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ‰¾åˆ°æ…¢æŸ¥è¯¢è¯­å¥ã€‚ 1234567891011121314151617181920212223242526272829show variables like '%slow%'; #æŸ¥çœ‹MySQLæ…¢æŸ¥è¯¢æ˜¯å¦å¼€å¯set global slow_query_log=ON; #å¼€å¯MySQLæ…¢æŸ¥è¯¢åŠŸèƒ½show variables like "long_query_time"; #æŸ¥çœ‹MySQLæ…¢æŸ¥è¯¢æ—¶é—´è®¾ç½®ï¼Œé»˜è®¤10ç§’set global long_query_time=5; #ä¿®æ”¹ä¸ºè®°å½•5ç§’å†…çš„æŸ¥è¯¢select sleep(6); #æµ‹è¯•MySQLæ…¢æŸ¥è¯¢show variables like "%slow%"; #æŸ¥çœ‹MySQLæ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„show global status like '%slow%'; #æŸ¥çœ‹MySQLæ…¢æŸ¥è¯¢çŠ¶æ€æˆ–è€…vi /etc/my.cnf #ç¼–è¾‘ï¼Œåœ¨[mysqld]æ®µæ·»åŠ ä»¥ä¸‹ä»£ç slow-query-log = on #å¼€å¯MySQLæ…¢æŸ¥è¯¢åŠŸèƒ½slow_query_log_file = /var/run/mysqld/mysqld-slow.log #è®¾ç½®MySQLæ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„long_query_time = 5 #ä¿®æ”¹ä¸ºè®°å½•5ç§’å†…çš„æŸ¥è¯¢ï¼Œé»˜è®¤ä¸è®¾ç½®æ­¤å‚æ•°ä¸ºè®°å½•10ç§’å†…çš„æŸ¥è¯¢log-queries-not-using-indexes = on #è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢:wq! #ä¿å­˜é€€å‡ºservice mysqld restart #é‡å¯MySQLæœåŠ¡ 13. æ•°æ®åº“ä¼˜åŒ–-ç´¢å¼• 13.1 ç´¢å¼•çš„æ¦‚å¿µ ç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©DBMSé«˜æ•ˆèŽ·å–æ•°æ®çš„æ•°æ®ç»“æž„ã€‚ 13.2 ç´¢å¼•æœ‰å“ªäº› åˆ†ç±»ï¼šæ™®é€šç´¢å¼•/å”¯ä¸€ç´¢å¼•/ä¸»é”®ç´¢å¼•/å…¨æ–‡ç´¢å¼• æ™®é€šç´¢å¼•:å…è®¸é‡å¤çš„å€¼å‡ºçŽ° å”¯ä¸€ç´¢å¼•:é™¤äº†ä¸èƒ½æœ‰é‡å¤çš„è®°å½•å¤–ï¼Œå…¶å®ƒå’Œæ™®é€šç´¢å¼•ä¸€æ ·(ç”¨æˆ·åã€ç”¨æˆ·èº«ä»½è¯ã€email,tel) ä¸»é”®ç´¢å¼•ï¼šæ˜¯éšç€è®¾å®šä¸»é”®è€Œåˆ›å»ºçš„ï¼Œä¹Ÿå°±æ˜¯æŠŠæŸä¸ªåˆ—è®¾ä¸ºä¸»é”®çš„æ—¶å€™ï¼Œæ•°æ®åº“å°±ä¼šçµ¦æ”¹åˆ—åˆ›å»ºç´¢å¼•ã€‚è¿™å°±æ˜¯ä¸»é”®ç´¢å¼•.å”¯ä¸€ä¸”æ²¡æœ‰nullå€¼ å…¨æ–‡ç´¢å¼•:ç”¨æ¥å¯¹è¡¨ä¸­çš„æ–‡æœ¬åŸŸ(charï¼Œvarcharï¼Œtext)è¿›è¡Œç´¢å¼•ï¼Œ å…¨æ–‡ç´¢å¼•é’ˆå¯¹MyIsam explain select * from articles where match(title,body) against(â€˜databaseâ€™);ã€ä¼šä½¿ç”¨å…¨æ–‡ç´¢å¼•ã€‘ 13.3 ä½¿ç”¨ç´¢å¼•çš„æ³¨æ„äº‹é¡¹ ç´¢å¼•å¼Šç«¯ å ç”¨ç£ç›˜ç©ºé—´ã€‚ å¯¹dml(æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤)æ“ä½œæœ‰å½±å“ï¼Œå˜æ…¢ã€‚ ä½¿ç”¨åœºæ™¯ï¼š è‚¯å®šåœ¨whereæ¡ä»¶ç»å¸¸ä½¿ç”¨,å¦‚æžœä¸åšæŸ¥è¯¢å°±æ²¡æœ‰æ„ä¹‰ è¯¥å­—æ®µçš„å†…å®¹ä¸æ˜¯å”¯ä¸€çš„å‡ ä¸ªå€¼(sex) å­—æ®µå†…å®¹ä¸æ˜¯é¢‘ç¹å˜åŒ–. æ³¨æ„äº‹é¡¹ å¯¹äºŽåˆ›å»ºçš„å¤šåˆ—ç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ï¼‰ï¼Œä¸æ˜¯ä½¿ç”¨çš„ç¬¬ä¸€éƒ¨åˆ†å°±ä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚ 123alter table dept add index my_ind (dname,loc); // dname å·¦è¾¹çš„åˆ—,locå°±æ˜¯å³è¾¹çš„åˆ—explain select * from dept where dname='aaa'\G ä¼šä½¿ç”¨åˆ°ç´¢å¼•explain select * from dept where loc='aaa'\G å°±ä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼• å¯¹äºŽä½¿ç”¨likeçš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å¦‚æžœæ˜¯%aaaä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼•è€Œaaa%ä¼šä½¿ç”¨åˆ°ç´¢å¼•ã€‚ 12explain select * from dept where dname like '%aaa'\Gä¸èƒ½ä½¿ç”¨ç´¢å¼•explain select * from dept where dname like 'aaa%'\Gä½¿ç”¨ç´¢å¼•. æ‰€ä»¥åœ¨likeæŸ¥è¯¢æ—¶ï¼Œâ€˜å…³é”®å­—â€™çš„æœ€å‰é¢ä¸èƒ½ä½¿ç”¨% æˆ–è€… _è¿™æ ·çš„å­—ç¬¦ï¼Œå¦‚æžœä¸€å®šè¦å‰é¢æœ‰å˜åŒ–çš„å€¼ï¼Œåˆ™è€ƒè™‘ä½¿ç”¨ å…¨æ–‡ç´¢å¼•-&gt;sphinx. ç´¢å¼•åˆ—æŽ’åº MySQLæŸ¥è¯¢åªä½¿ç”¨ä¸€ä¸ªç´¢å¼•ï¼Œå› æ­¤å¦‚æžœwhereå­å¥ä¸­å·²ç»ä½¿ç”¨äº†ç´¢å¼•çš„è¯ï¼Œé‚£ä¹ˆorder byä¸­çš„åˆ—æ˜¯ä¸ä¼šä½¿ç”¨ç´¢å¼•çš„ã€‚å› æ­¤æ•°æ®åº“é»˜è®¤æŽ’åºå¯ä»¥ç¬¦åˆè¦æ±‚çš„æƒ…å†µä¸‹ä¸è¦ä½¿ç”¨æŽ’åºæ“ä½œï¼›å°½é‡ä¸è¦åŒ…å«å¤šä¸ªåˆ—çš„æŽ’åºï¼Œå¦‚æžœéœ€è¦æœ€å¥½ç»™è¿™äº›åˆ—åˆ›å»ºå¤åˆç´¢å¼•ã€‚ å¦‚æžœåˆ—ç±»åž‹æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¸€å®šè¦åœ¨æ¡ä»¶ä¸­å°†æ•°æ®ä½¿ç”¨å¼•å·å¼•ç”¨èµ·æ¥ã€‚å¦åˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚ 123expain select * from dept where dname=â€™111â€™;expain select * from dept where dname=111;ï¼ˆæ•°å€¼è‡ªåŠ¨è½¬å­—ç¬¦ä¸²ï¼‰expain select * from dept where dname=qqq;æŠ¥é”™ ä¹Ÿå°±æ˜¯ï¼Œå¦‚æžœåˆ—æ˜¯å­—ç¬¦ä¸²ç±»åž‹ï¼Œæ— è®ºæ˜¯ä¸æ˜¯å­—ç¬¦ä¸²æ•°å­—å°±ä¸€å®šè¦ç”¨ â€˜â€™ æŠŠå®ƒåŒ…æ‹¬èµ·æ¥. å¦‚æžœmysqlä¼°è®¡ä½¿ç”¨å…¨è¡¨æ‰«æè¦æ¯”ä½¿ç”¨ç´¢å¼•å¿«ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚ è¡¨é‡Œé¢åªæœ‰ä¸€æ¡è®°å½• ç´¢å¼•ä¸ä¼šåŒ…å«æœ‰NULLå€¼çš„åˆ— åªè¦åˆ—ä¸­åŒ…å«æœ‰NULLå€¼éƒ½å°†ä¸ä¼šè¢«åŒ…å«åœ¨MySQLç´¢å¼•ä¸­ï¼Œå¤åˆç´¢å¼•ä¸­åªè¦æœ‰ä¸€åˆ—å«æœ‰NULLå€¼ï¼Œé‚£ä¹ˆè¿™ä¸€åˆ—å¯¹äºŽæ­¤å¤åˆç´¢å¼•å°±æ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ•°æ®åº“è®¾è®¡æ—¶ä¸è¦è®©å­—æ®µçš„é»˜è®¤å€¼ä¸ºNULLã€‚ ä½¿ç”¨çŸ­ç´¢å¼• å¯¹ä¸²åˆ—è¿›è¡Œç´¢å¼•ï¼Œå¦‚æžœå¯èƒ½åº”è¯¥æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæœ‰ä¸€ä¸ªCHAR(255)çš„åˆ—ï¼Œå¦‚æžœåœ¨å‰10ä¸ªæˆ–20ä¸ªå­—ç¬¦å†…ï¼Œå¤šæ•°å€¼æ˜¯æƒŸä¸€çš„ï¼Œé‚£ä¹ˆå°±ä¸è¦å¯¹æ•´ä¸ªåˆ—è¿›è¡Œç´¢å¼•ã€‚çŸ­ç´¢å¼•ä¸ä»…å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦è€Œä¸”å¯ä»¥èŠ‚çœç£ç›˜ç©ºé—´å’ŒI/Oæ“ä½œã€‚ ä¸è¦åœ¨åˆ—ä¸Šè¿›è¡Œè¿ç®—ï¼Œä¸ä½¿ç”¨NOT INå’Œ&lt;&gt;æ“ä½œï¼Œä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚ 14. æ•°æ®åº“ä¼˜åŒ–-åˆ†è¡¨ åˆ†è¡¨åˆ†ä¸ºæ°´å¹³(æŒ‰è¡Œ)åˆ†è¡¨å’Œåž‚ç›´(æŒ‰åˆ—)åˆ†è¡¨ æ°´å¹³åˆ†è¡¨æƒ…å½¢ï¼š æ ¹æ®ç»éªŒï¼ŒMysqlè¡¨æ•°æ®ä¸€èˆ¬è¾¾åˆ°ç™¾ä¸‡çº§åˆ«ï¼ŒæŸ¥è¯¢æ•ˆçŽ‡ä¼šå¾ˆä½Žï¼Œå®¹æ˜“é€ æˆè¡¨é”ï¼Œç”šè‡³å †ç§¯å¾ˆå¤šè¿žæŽ¥ï¼Œç›´æŽ¥æŒ‚æŽ‰ï¼›æ°´å¹³åˆ†è¡¨èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦è¾ƒå°‘è¿™äº›åŽ‹åŠ›ã€‚ åž‚ç›´åˆ†è¡¨æƒ…å½¢ï¼š å¦‚æžœä¸€å¼ è¡¨ä¸­æŸä¸ªå­—æ®µå€¼éžå¸¸å¤š(é•¿æ–‡æœ¬ã€äºŒè¿›åˆ¶ç­‰)ï¼Œè€Œä¸”åªæœ‰åœ¨å¾ˆå°‘çš„æƒ…å†µä¸‹ä¼šæŸ¥è¯¢ã€‚è¿™æ—¶å€™å°±å¯ä»¥æŠŠå­—æ®µå¤šä¸ªå•ç‹¬æ”¾åˆ°ä¸€ä¸ªè¡¨ï¼Œé€šè¿‡å¤–é”®å…³è”èµ·æ¥ã€‚è€ƒè¯•è¯¦æƒ…ï¼Œä¸€èˆ¬æˆ‘ä»¬åªå…³æ³¨åˆ†æ•°ï¼Œä¸å…³æ³¨è¯¦æƒ…ã€‚ æ°´å¹³åˆ†è¡¨ç­–ç•¥ï¼š 1.æŒ‰æ—¶é—´åˆ†è¡¨ è¿™ç§åˆ†è¡¨æ–¹å¼æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå½“æ•°æ®æœ‰è¾ƒå¼ºçš„å®žæ•ˆæ€§ï¼Œå¦‚å¾®åšå‘é€è®°å½•ã€å¾®ä¿¡æ¶ˆæ¯è®°å½•ç­‰ï¼Œè¿™ç§æ•°æ®å¾ˆå°‘æœ‰ç”¨æˆ·ä¼šæŸ¥è¯¢å‡ ä¸ªæœˆå‰çš„æ•°æ®ï¼Œå¦‚éœ€è¦å°±å¯ä»¥æŒ‰æœˆåˆ†è¡¨ã€‚ 2.æŒ‰åŒºé—´èŒƒå›´åˆ†è¡¨ ä¸€èˆ¬åœ¨æœ‰ä¸¥æ ¼çš„è‡ªå¢židéœ€æ±‚ä¸Šï¼Œå¦‚æŒ‰ç…§user_idæ°´å¹³åˆ†è¡¨ï¼š 123table_1 user_idä»Ž1~100w table_2 user_idä»Ž101~200w table_3 user_idä»Ž201~300w 3.hashåˆ†è¡¨ é€šè¿‡ä¸€ä¸ªåŽŸå§‹ç›®æ ‡çš„IDæˆ–è€…åç§°é€šè¿‡ä¸€å®šçš„hashç®—æ³•è®¡ç®—å‡ºæ•°æ®å­˜å‚¨è¡¨çš„è¡¨åï¼Œç„¶åŽè®¿é—®ç›¸åº”çš„è¡¨ã€‚ 15. æ•°æ®åº“ä¼˜åŒ–-è¯»å†™åˆ†ç¦» ä¸€å°æ•°æ®åº“æ”¯æŒçš„æœ€å¤§å¹¶å‘è¿žæŽ¥æ•°æ˜¯æœ‰é™çš„ï¼Œå¦‚æžœç”¨æˆ·å¹¶å‘è®¿é—®å¤ªå¤šã€‚ä¸€å°æœåŠ¡å™¨æ»¡è¶³ä¸è¦è¦æ±‚æ˜¯å°±å¯ä»¥é›†ç¾¤å¤„ç†ã€‚Mysqlçš„é›†ç¾¤å¤„ç†æŠ€æœ¯æœ€å¸¸ç”¨çš„å°±æ˜¯è¯»å†™åˆ†ç¦»ã€‚ ä¸»ä»ŽåŒæ­¥ æ•°æ®åº“æœ€ç»ˆä¼šæŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå¦‚æžœé›†ç¾¤å¿…é¡»ç¡®ä¿æ¯ä¸ªæ•°æ®åº“æœåŠ¡å™¨çš„æ•°æ®æ˜¯ä¸€ç›´çš„ã€‚èƒ½æ”¹å˜æ•°æ®åº“æ•°æ®çš„æ“ä½œéƒ½å¾€ä¸»æ•°æ®åº“åŽ»å†™ï¼Œè€Œå…¶ä»–çš„æ•°æ®åº“ä»Žä¸»æ•°æ®åº“ä¸ŠåŒæ­¥æ•°æ®ã€‚ è¯»å†™åˆ†ç¦» ä½¿ç”¨è´Ÿè½½å‡è¡¡æ¥å®žçŽ°å†™çš„æ“ä½œéƒ½å¾€ä¸»æ•°æ®åŽ»ï¼Œè€Œè¯»çš„æ“ä½œå¾€ä»ŽæœåŠ¡å™¨åŽ»ã€‚ 16. æ•°æ®åº“ä¼˜åŒ–-ç¼“å­˜ ä»€ä¹ˆæ˜¯ç¼“å­˜ åœ¨æŒä¹…å±‚(dao)å’Œæ•°æ®åº“(db)ä¹‹é—´æ·»åŠ ä¸€ä¸ªç¼“å­˜å±‚ï¼Œå¦‚æžœç”¨æˆ·è®¿é—®çš„æ•°æ®å·²ç»ç¼“å­˜èµ·æ¥æ—¶ï¼Œåœ¨ç”¨æˆ·è®¿é—®æ—¶ç›´æŽ¥ä»Žç¼“å­˜ä¸­èŽ·å–ï¼Œä¸ç”¨è®¿é—®æ•°æ®åº“ã€‚è€Œç¼“å­˜æ˜¯åœ¨æ“ä½œå†…å­˜çº§ï¼Œè®¿é—®é€Ÿåº¦å¿«ã€‚ ä½œç”¨ å‡å°‘æ•°æ®åº“æœåŠ¡å™¨åŽ‹åŠ›ï¼Œå‡å°‘è®¿é—®æ—¶é—´ã€‚ Javaä¸­å¸¸ç”¨çš„ç¼“å­˜æœ‰ hibernateçš„äºŒçº§ç¼“å­˜ã€‚è¯¥ç¼“å­˜ä¸èƒ½å®Œæˆåˆ†å¸ƒå¼ç¼“å­˜ã€‚ å¯ä»¥ä½¿ç”¨redis(memcaheç­‰)æ¥ä½œä¸ºä¸­å¤®ç¼“å­˜ã€‚å¯¹ç¼“å­˜çš„æ•°æ®è¿›è¡Œé›†ä¸­å¤„ç† 17. æ•°æ®åº“ä¼˜åŒ–-sqlè¯­å¥ä¼˜åŒ–çš„æŠ€å·§ DDLä¼˜åŒ– é€šè¿‡ç¦ç”¨ç´¢å¼•æ¥æä¾›å¯¼å…¥æ•°æ®æ€§èƒ½ï¼Œè¿™ä¸ªæ“ä½œä¸»è¦é’ˆå¯¹çŽ°æœ‰æ•°æ®åº“çš„è¡¨è¿½åŠ æ•°æ® 123456//åŽ»é™¤é”®alter table test3 DISABLE keys;//æ‰¹é‡æ’å…¥æ•°æ®insert into test3 ***//æ¢å¤é”®alter table test3 ENABLE keys; å…³é—­å”¯ä¸€æ ¡éªŒ 12set unique_checks=0 å…³é—­set unique_checks=1 å¼€å¯ ä¿®æ”¹äº‹åŠ¡æäº¤æ–¹å¼(å¯¼å…¥)ï¼ˆå˜å¤šæ¬¡æäº¤ä¸ºä¸€æ¬¡ï¼‰ 123set autocommit=0 å…³é—­//æ‰¹é‡æ’å…¥set autocommit=1 å¼€å¯ DMLä¼˜åŒ–ï¼ˆå˜å¤šæ¬¡æäº¤ä¸ºä¸€æ¬¡ï¼‰ 12345insert into test values(1,2);insert into test values(1,3);insert into test values(1,4);//åˆå¹¶å¤šæ¡ä¸ºä¸€æ¡insert into test values(1,2),(1,3),(1,4) DQLä¼˜åŒ– Order byä¼˜åŒ– å¤šç”¨ç´¢å¼•æŽ’åº æ™®é€šç»“æžœæŽ’åºï¼ˆéžç´¢å¼•æŽ’åºï¼‰Filesort group byä¼˜åŒ– ä½¿ç”¨order by null,å–æ¶ˆé»˜è®¤æŽ’åº ç­‰ç­‰ç­‰ç­‰â€¦ 18. jdbcæ‰¹é‡æ’å…¥å‡ ç™¾ä¸‡æ•°æ®æ€Žä¹ˆå®žçŽ° 1ã€å˜å¤šæ¬¡æäº¤ä¸ºä¸€æ¬¡ 2ã€ä½¿ç”¨æ‰¹é‡æ“ä½œ 3ã€åƒè¿™æ ·çš„æ‰¹é‡æ’å…¥æ“ä½œèƒ½ä¸ä½¿ç”¨ä»£ç æ“ä½œå°±ä¸ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¥å®žçŽ° mysqlä¼˜åŒ–æ‰‹æ®µä»‹ç»åˆ°è¿™é‡Œã€‚ 19. èšç°‡ç´¢å¼•å’Œéžèšç°‡ç´¢å¼• ç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•å’Œéžèšç°‡ç´¢å¼•ã€‚ â€œèšç°‡ç´¢å¼•â€ ä»¥ä¸€æœ¬è‹±æ–‡è¯¾æœ¬ä¸ºä¾‹ï¼Œè¦æ‰¾ç¬¬8è¯¾ï¼Œç›´æŽ¥ç¿»ä¹¦ï¼Œè‹¥å…ˆç¿»åˆ°ç¬¬5è¯¾ï¼Œåˆ™å¾€åŽç¿»ï¼Œå†ç¿»åˆ°ç¬¬10è¯¾ï¼Œåˆ™åˆå¾€å‰ç¿»ã€‚è¿™æœ¬ä¹¦æœ¬èº«å°±æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œå³â€œèšç°‡ç´¢å¼•â€ã€‚ â€œéžèšç°‡ç´¢å¼•â€ å¦‚æžœè¦æ‰¾&quot;fireâ€è¿™ä¸ªå•è¯ï¼Œä¼šç¿»åˆ°ä¹¦åŽé¢çš„é™„å½•ï¼Œè¿™ä¸ªé™„å½•æ˜¯æŒ‰å­—æ¯æŽ’åºçš„ï¼Œæ‰¾åˆ°Få­—æ¯é‚£ä¸€å—ï¼Œå†æ‰¾åˆ°&quot;fireâ€ï¼Œå¯¹åº”çš„ä¼šæ˜¯å®ƒåœ¨ç¬¬å‡ è¯¾ã€‚è¿™ä¸ªé™„å½•ï¼Œä¸ºâ€œéžèšç°‡ç´¢å¼•â€ã€‚ ç”±æ­¤å¯è§ï¼Œèšç°‡ç´¢å¼•ï¼Œç´¢å¼•çš„é¡ºåºå°±æ˜¯æ•°æ®å­˜æ”¾çš„é¡ºåºï¼Œæ‰€ä»¥ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸€å¼ æ•°æ®è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚ èšç°‡ç´¢å¼•è¦æ¯”éžèšç°‡ç´¢å¼•æŸ¥è¯¢æ•ˆçŽ‡é«˜å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯èŒƒå›´æŸ¥è¯¢çš„æ—¶å€™ã€‚æ‰€ä»¥ï¼Œè‡³äºŽèšç°‡ç´¢å¼•åˆ°åº•åº”è¯¥ä¸ºä¸»é”®ï¼Œè¿˜æ˜¯å…¶ä»–å­—æ®µï¼Œè¿™ä¸ªå¯ä»¥å†è®¨è®ºã€‚ 1ã€MYSQLçš„ç´¢å¼• mysqlä¸­ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“Žå¯¹ç´¢å¼•çš„å®žçŽ°æ–¹å¼ä¸åŒï¼Œå¤§è‡´è¯´ä¸‹MyISAMå’ŒInnoDBä¸¤ç§å­˜å‚¨å¼•æ“Žã€‚ MyISAMå­˜å‚¨å¼•æ“Žçš„ç´¢å¼•å®žçŽ° MyISAMçš„B+Treeçš„å¶å­èŠ‚ç‚¹ä¸Šçš„dataï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯æ•°æ®å­˜æ”¾çš„åœ°å€ã€‚ä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ²¡å•¥åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•ä¸­çš„keyä¸€å®šå¾—æ˜¯å”¯ä¸€çš„ã€‚è¿™é‡Œçš„ç´¢å¼•éƒ½æ˜¯éžèšç°‡ç´¢å¼•ã€‚ MyISAMè¿˜é‡‡ç”¨åŽ‹ç¼©æœºåˆ¶å­˜å‚¨ç´¢å¼•ï¼Œæ¯”å¦‚ï¼Œç¬¬ä¸€ä¸ªç´¢å¼•ä¸ºâ€œherâ€ï¼Œç¬¬äºŒä¸ªç´¢å¼•ä¸ºâ€œhereâ€ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªç´¢å¼•ä¼šè¢«å­˜å‚¨ä¸ºâ€œ3,eâ€ï¼Œè¿™æ ·çš„ç¼ºç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„ç´¢å¼•åªèƒ½é‡‡ç”¨é¡ºåºæŸ¥æ‰¾ã€‚ InnoDBå­˜å‚¨å¼•æ“Žçš„ç´¢å¼•å®žçŽ° InnoDB çš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼ŒB+Treeçš„å¶å­èŠ‚ç‚¹ä¸Šçš„dataå°±æ˜¯æ•°æ®æœ¬èº«ï¼Œkeyä¸ºä¸»é”®ï¼Œè¿™æ˜¯èšç°‡ç´¢å¼•ã€‚éžèšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹ä¸Šçš„dataæ˜¯ä¸»é”® (æ‰€ä»¥èšç°‡ç´¢å¼•çš„keyï¼Œä¸èƒ½è¿‡é•¿)ã€‚ä¸ºä»€ä¹ˆå­˜æ”¾çš„ä¸»é”®ï¼Œè€Œä¸æ˜¯è®°å½•æ‰€åœ¨åœ°å€å‘¢ï¼Œç†ç”±ç›¸å½“ç®€å•ï¼Œå› ä¸ºè®°å½•æ‰€åœ¨åœ°å€å¹¶ä¸èƒ½ä¿è¯ä¸€å®šä¸ä¼šå˜ï¼Œä½†ä¸»é”®å¯ä»¥ä¿è¯ã€‚ è‡³äºŽä¸ºä»€ä¹ˆä¸»é”®é€šå¸¸å»ºè®®ä½¿ç”¨è‡ªå¢židå‘¢ï¼Ÿ 2.èšç°‡ç´¢å¼• èšç°‡ç´¢å¼•çš„æ•°æ®çš„ç‰©ç†å­˜æ”¾é¡ºåºä¸Žç´¢å¼•é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œå³ï¼šåªè¦ç´¢å¼•æ˜¯ç›¸é‚»çš„ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®ä¸€å®šä¹Ÿæ˜¯ç›¸é‚»åœ°å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„ã€‚å¦‚æžœä¸»é”®ä¸æ˜¯è‡ªå¢židï¼Œé‚£ä¹ˆå¯ä»¥æƒ³ è±¡ï¼Œå®ƒä¼šå¹²äº›ä»€ä¹ˆï¼Œä¸æ–­åœ°è°ƒæ•´æ•°æ®çš„ç‰©ç†åœ°å€ã€åˆ†é¡µï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶ä»–ä¸€äº›æŽªæ–½æ¥å‡å°‘è¿™äº›æ“ä½œï¼Œä½†å´æ— æ³•å½»åº•é¿å…ã€‚ä½†ï¼Œå¦‚æžœæ˜¯è‡ªå¢žçš„ï¼Œé‚£å°±ç®€å•äº†ï¼Œå®ƒåªéœ€è¦ä¸€ é¡µä¸€é¡µåœ°å†™ï¼Œç´¢å¼•ç»“æž„ç›¸å¯¹ç´§å‡‘ï¼Œç£ç›˜ç¢Žç‰‡å°‘ï¼Œæ•ˆçŽ‡ä¹Ÿé«˜ã€‚ èšç°‡ç´¢å¼•ä¸ä½†åœ¨æ£€ç´¢ä¸Šå¯ä»¥å¤§å¤§æ»´æé«˜æ•ˆçŽ‡ï¼Œåœ¨æ•°æ®è¯»å–ä¸Šä¹Ÿä¸€æ ·ã€‚æ¯”å¦‚ï¼šéœ€è¦æŸ¥è¯¢f~tçš„æ‰€æœ‰å•è¯ã€‚ ä¸€ä¸ªä½¿ç”¨MyISAMçš„ä¸»ç´¢å¼•ï¼Œä¸€ä¸ªä½¿ç”¨InnoDBçš„èšç°‡ç´¢å¼•ã€‚ä¸¤ç§ç´¢å¼•çš„B+Treeæ£€ç´¢æ—¶é—´ä¸€æ ·ï¼Œä½†è¯»å–æ—¶å´æœ‰äº†å·®å¼‚ã€‚ å› ä¸ºMyISAMçš„ä¸»ç´¢å¼•å¹¶éžèšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆä»–çš„æ•°æ®çš„ç‰©ç†åœ°å€å¿…ç„¶æ˜¯å‡Œä¹±çš„ï¼Œæ‹¿åˆ°è¿™äº›ç‰©ç†åœ°å€ï¼ŒæŒ‰ç…§åˆé€‚çš„ç®—æ³•è¿›è¡ŒI/Oè¯»å–ï¼ŒäºŽæ˜¯å¼€å§‹ä¸åœçš„å¯»é“ä¸åœçš„æ—‹è½¬ã€‚èšç°‡ç´¢å¼•åˆ™åªéœ€ä¸€æ¬¡I/Oã€‚ ä¸è¿‡ï¼Œå¦‚æžœæ¶‰åŠåˆ°å¤§æ•°æ®é‡çš„æŽ’åºã€å…¨è¡¨æ‰«æã€countä¹‹ç±»çš„æ“ä½œçš„è¯ï¼Œè¿˜æ˜¯MyISAMå ä¼˜åŠ¿äº›ï¼Œå› ä¸ºç´¢å¼•æ‰€å ç©ºé—´å°ï¼Œè¿™äº›æ“ä½œæ˜¯éœ€è¦åœ¨å†…å­˜ä¸­å®Œæˆçš„ã€‚ é‰´äºŽèšç°‡ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢æ•ˆçŽ‡ï¼Œå¾ˆå¤šäººè®¤ä¸ºä½¿ç”¨ä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•å¤ªå¤šæµªè´¹ï¼Œæ¯•ç«Ÿå‡ ä¹Žä¸ä¼šä½¿ç”¨ä¸»é”®è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚ä½†è‹¥å†è€ƒè™‘åˆ°èšç°‡ç´¢å¼•çš„å­˜å‚¨ï¼Œå°±ä¸å¥½å®šè®ºäº†ã€‚ 20. sqlæ³¨å…¥é—®é¢˜ 20.1 ä»€ä¹ˆæ˜¯sqlæ³¨å…¥ sqlæ³¨å…¥å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œæ˜¯ä¸€ç§å¸¸è§çš„æ”»å‡»æ–¹å¼ï¼Œæ”»å‡»è€…åœ¨ç•Œé¢çš„è¡¨å•ä¿¡æ¯æˆ–urlä¸Šè¾“å…¥ä¸€äº›å¥‡æ€ªçš„sqlç‰‡æ®µï¼Œä¾‹å¦‚â€œor â€˜1â€™=â€™1â€™â€è¿™æ ·çš„è¯­å¥ï¼Œæœ‰å¯èƒ½å…¥ä¾µå‚æ•°æ ¡éªŒä¸è¶³çš„åº”ç”¨ç¨‹åºã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­éœ€è¦åšä¸€äº›å·¥ä½œï¼Œæ¥é˜²å¤‡è¿™æ ·çš„æ”»å‡»æ–¹å¼ã€‚åœ¨ä¸€äº›å®‰å…¨æ€§å¾ˆé«˜çš„åº”ç”¨ä¸­ï¼Œæ¯”å¦‚é“¶è¡Œè½¯ä»¶ï¼Œç»å¸¸ä½¿ç”¨å°†sqlè¯­å¥å…¨éƒ¨æ›¿æ¢ä¸ºå­˜å‚¨è¿‡ç¨‹è¿™æ ·çš„æ–¹å¼ï¼Œæ¥é˜²æ­¢sqlæ³¨å…¥ï¼Œè¿™å½“ç„¶æ˜¯ä¸€ç§å¾ˆå®‰å…¨çš„æ–¹å¼ï¼Œä½†æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­ï¼Œå¯èƒ½ä¸éœ€è¦è¿™ç§æ­»æ¿çš„æ–¹å¼ã€‚ 20.2 PrepareStatementè§£å†³SQLæ³¨å…¥çš„é—®é¢˜ åœ¨ä½¿ç”¨JDBCçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨PrepareStatementè¿›è¡Œé¢„å¤„ç†ï¼Œé¢„å¤„ç†çš„ä¼˜åŠ¿å°±æ˜¯é¢„é˜²ç»å¤§å¤šæ•°çš„SQLæ³¨å…¥ï¼›è€Œä¸”é’ˆå¯¹å¤šæ¬¡æ“ä½œæ•°æ®åº“çš„æƒ…å†µï¼Œå¯ä»¥æžå¤§çš„æé«˜è®¿é—®æ•°æ®åº“çš„æ•ˆçŽ‡ã€‚ é‚£ä¸ºä»€ä¹ˆå®ƒè¿™æ ·å¤„ç†å°±èƒ½é¢„é˜²SQLæ³¨å…¥æé«˜å®‰å…¨æ€§å‘¢ï¼Ÿå…¶å®žæ˜¯å› ä¸ºSQLè¯­å¥åœ¨ç¨‹åºè¿è¡Œå‰å·²ç»è¿›è¡Œäº†é¢„ç¼–è¯‘ã€‚åœ¨ç¨‹åºè¿è¡Œæ—¶ç¬¬ä¸€æ¬¡æ“ä½œæ•°æ®åº“ä¹‹å‰ï¼ŒSQLè¯­å¥å·²ç»è¢«æ•°æ®åº“åˆ†æžï¼Œç¼–è¯‘å’Œä¼˜åŒ–ï¼Œå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ä¹Ÿä¼šç¼“å­˜ä¸‹æ¥å¹¶å…è®¸æ•°æ®åº“ä»¥å‚æ•°åŒ–çš„å½¢å¼è¿›è¡ŒæŸ¥è¯¢ã€‚å½“è¿è¡Œæ—¶åŠ¨æ€åœ°æŠŠå‚æ•°ä¼ ç»™PreprareStatementæ—¶ï¼Œå³ä½¿å‚æ•°é‡Œæœ‰æ•æ„Ÿå­—ç¬¦å¦‚ or â€˜1=1â€™ï¼Œæ•°æ®åº“ä¹Ÿä¼šä½œä¸ºä¸€ä¸ªå‚æ•°ä¸€ä¸ªå­—æ®µçš„å±žæ€§å€¼æ¥å¤„ç†è€Œä¸ä¼šä½œä¸ºä¸€ä¸ªSQLæŒ‡ä»¤ã€‚å¦‚æ­¤ï¼Œå°±èµ·åˆ°äº†SQLæ³¨å…¥çš„ä½œç”¨äº†ï¼ 20.3 MyBatiså¦‚ä½•é˜²æ­¢sqlæ³¨å…¥ mybatisæ¡†æž¶ä½œä¸ºä¸€æ¬¾åŠè‡ªåŠ¨åŒ–çš„æŒä¹…å±‚æ¡†æž¶ï¼Œå…¶sqlè¯­å¥éƒ½è¦æˆ‘ä»¬è‡ªå·±æ¥æ‰‹åŠ¨ç¼–å†™ï¼Œè¿™ä¸ªæ—¶å€™å½“ç„¶éœ€è¦é˜²æ­¢sqlæ³¨å…¥ã€‚å…¶å®žMybatisçš„sqlæ˜¯ä¸€ä¸ªå…·æœ‰â€œè¾“å…¥+è¾“å‡ºâ€åŠŸèƒ½ï¼Œç±»ä¼¼äºŽå‡½æ•°çš„ç»“æž„ï¼Œå¦‚ä¸‹ï¼š 12345&lt;select id=â€œgetBlogByIdâ€œ resultType=â€œBlogâ€œ parameterType=â€intâ€&gt; select id,title,author,content from blog where id=#&#123;id&#125; &lt;/select&gt; è¿™é‡Œï¼ŒparameterTypeæ ‡ç¤ºäº†è¾“å…¥çš„å‚æ•°ç±»åž‹ï¼ŒresultTypeæ ‡ç¤ºäº†è¾“å‡ºçš„å‚æ•°ç±»åž‹ã€‚å›žåº”ä¸Šæ–‡ï¼Œå¦‚æžœæˆ‘ä»¬æƒ³é˜²æ­¢sqlæ³¨å…¥ï¼Œç†æ‰€å½“ç„¶åœ°è¦åœ¨è¾“å…¥å‚æ•°ä¸Šä¸‹åŠŸå¤«ã€‚ä¸Šé¢ä»£ç ä¸­â€œ#{id}â€å³è¾“å…¥å‚æ•°åœ¨sqlä¸­æ‹¼æŽ¥çš„éƒ¨åˆ†ï¼Œä¼ å…¥å‚æ•°åŽï¼Œæ‰“å°å‡ºæ‰§è¡Œçš„sqlè¯­å¥ï¼Œä¼šçœ‹åˆ°sqlæ˜¯è¿™æ ·çš„ï¼š select id,title,author,content from blog where id = ? ä¸ç®¡è¾“å…¥ä»€ä¹ˆå‚æ•°ï¼Œæ‰“å°å‡ºçš„sqléƒ½æ˜¯è¿™æ ·çš„ã€‚è¿™æ˜¯å› ä¸ºmybatiså¯ç”¨äº†é¢„ç¼–è¯‘åŠŸèƒ½ï¼Œåœ¨sqlæ‰§è¡Œå‰ï¼Œä¼šå…ˆå°†ä¸Šé¢çš„sqlå‘é€ç»™æ•°æ®åº“è¿›è¡Œç¼–è¯‘ï¼Œæ‰§è¡Œæ—¶ï¼Œç›´æŽ¥ä½¿ç”¨ç¼–è¯‘å¥½çš„sqlï¼Œæ›¿æ¢å ä½ç¬¦â€œï¼Ÿâ€å°±å¯ä»¥äº†ã€‚å› ä¸ºsqlæ³¨å…¥åªèƒ½å¯¹ç¼–è¯‘è¿‡ç¨‹èµ·ä½œç”¨ï¼Œæ‰€ä»¥è¿™æ ·çš„æ–¹å¼å°±å¾ˆå¥½åœ°é¿å…äº†sqlæ³¨å…¥çš„é—®é¢˜ã€‚ mybatisæ˜¯å¦‚ä½•åšåˆ°sqlé¢„ç¼–è¯‘çš„å‘¢ï¼Ÿå…¶å®žåœ¨æ¡†æž¶åº•å±‚ï¼Œæ˜¯jdbcä¸­çš„PreparedStatementç±»åœ¨èµ·ä½œç”¨ï¼ŒPreparedStatementæ˜¯æˆ‘ä»¬å¾ˆç†Ÿæ‚‰çš„Statementçš„å­ç±»ï¼Œå®ƒçš„å¯¹è±¡åŒ…å«äº†ç¼–è¯‘å¥½çš„sqlè¯­å¥ã€‚è¿™ç§â€œå‡†å¤‡å¥½â€çš„æ–¹å¼ä¸ä»…èƒ½æé«˜å®‰å…¨æ€§ï¼Œè€Œä¸”åœ¨å¤šæ¬¡æ‰§è¡Œä¸€ä¸ªsqlæ—¶ï¼Œèƒ½å¤Ÿæé«˜æ•ˆçŽ‡ï¼ŒåŽŸå› æ˜¯sqlå·²ç¼–è¯‘å¥½ï¼Œå†æ¬¡æ‰§è¡Œæ—¶æ— éœ€å†ç¼–è¯‘ã€‚ è¡¥å…… 12345&lt;select id=â€œorderBlogâ€œ resultType=â€œBlogâ€œ parameterType=â€mapâ€&gt; select id,title,author,content from blog order by $&#123;orderParam&#125; &lt;/select&gt; ä»”ç»†è§‚å¯Ÿï¼Œå†…è”å‚æ•°çš„æ ¼å¼ç”±â€œ#{xxx}â€å˜ä¸ºäº†${xxx}ã€‚å¦‚æžœæˆ‘ä»¬ç»™å‚æ•°â€œorderParamâ€èµ‹å€¼ä¸ºâ€idâ€,å°†sqlæ‰“å°å‡ºæ¥ï¼Œæ˜¯è¿™æ ·çš„ï¼š select id,title,author,content from blog order by id æ˜¾ç„¶ï¼Œè¿™æ ·æ˜¯æ— æ³•é˜»æ­¢sqlæ³¨å…¥çš„ã€‚åœ¨mybatisä¸­ï¼Œâ€${xxx}â€è¿™æ ·æ ¼å¼çš„å‚æ•°ä¼šç›´æŽ¥å‚ä¸Žsqlç¼–è¯‘ï¼Œä»Žè€Œä¸èƒ½é¿å…æ³¨å…¥æ”»å‡»ã€‚ä½†æ¶‰åŠåˆ°åŠ¨æ€è¡¨åå’Œåˆ—åæ—¶ï¼Œåªèƒ½ä½¿ç”¨â€œ${xxx}â€è¿™æ ·çš„å‚æ•°æ ¼å¼ï¼Œæ‰€ä»¥ï¼Œè¿™æ ·çš„å‚æ•°éœ€è¦æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰‹å·¥è¿›è¡Œå¤„ç†æ¥é˜²æ­¢æ³¨å…¥ã€‚ 21. mysqlæ‚²è§‚é”å’Œä¹è§‚é” 21.1 æ‚²è§‚é” æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡åŽ»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ æ‚²è§‚é”ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œã€‚ Java synchronized å°±å±žäºŽæ‚²è§‚é”çš„ä¸€ç§å®žçŽ°ï¼Œæ¯æ¬¡çº¿ç¨‹è¦ä¿®æ”¹æ•°æ®æ—¶éƒ½å…ˆèŽ·å¾—é”ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ“ä½œæ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šè¢«blockã€‚ 21.2 ä¹è§‚é” ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡åŽ»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æäº¤æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰åŽ»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚ä¹è§‚é”é€‚ç”¨äºŽè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ï¼Œè¿™æ ·å¯ä»¥æé«˜åžåé‡ã€‚ ä¹è§‚é”ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚ ä¹è§‚é”ä¸€èˆ¬æ¥è¯´æœ‰ä»¥ä¸‹2ç§æ–¹å¼ï¼š ä½¿ç”¨æ•°æ®ç‰ˆæœ¬ï¼ˆVersionï¼‰è®°å½•æœºåˆ¶å®žçŽ°ï¼Œè¿™æ˜¯ä¹è§‚é”æœ€å¸¸ç”¨çš„ä¸€ç§å®žçŽ°æ–¹å¼ã€‚ä½•è°“æ•°æ®ç‰ˆæœ¬ï¼Ÿå³ä¸ºæ•°æ®å¢žåŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢žåŠ ä¸€ä¸ªæ•°å­—ç±»åž‹çš„ version å­—æ®µæ¥å®žçŽ°ã€‚å½“è¯»å–æ•°æ®æ—¶ï¼Œå°†versionå­—æ®µçš„å€¼ä¸€åŒè¯»å‡ºï¼Œæ•°æ®æ¯æ›´æ–°ä¸€æ¬¡ï¼Œå¯¹æ­¤versionå€¼åŠ ä¸€ã€‚å½“æˆ‘ä»¬æäº¤æ›´æ–°çš„æ—¶å€™ï¼Œåˆ¤æ–­æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯ä¸Žç¬¬ä¸€æ¬¡å–å‡ºæ¥çš„versionå€¼è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æžœæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ä¸Žç¬¬ä¸€æ¬¡å–å‡ºæ¥çš„versionå€¼ç›¸ç­‰ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚ ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ã€‚ä¹è§‚é”å®šçš„ç¬¬äºŒç§å®žçŽ°æ–¹å¼å’Œç¬¬ä¸€ç§å·®ä¸å¤šï¼ŒåŒæ ·æ˜¯åœ¨éœ€è¦ä¹è§‚é”æŽ§åˆ¶çš„tableä¸­å¢žåŠ ä¸€ä¸ªå­—æ®µï¼Œåç§°æ— æ‰€è°“ï¼Œå­—æ®µç±»åž‹ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆtimestampï¼‰, å’Œä¸Šé¢çš„versionç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™æ£€æŸ¥å½“å‰æ•°æ®åº“ä¸­æ•°æ®çš„æ—¶é—´æˆ³å’Œè‡ªå·±æ›´æ–°å‰å–åˆ°çš„æ—¶é—´æˆ³è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æžœä¸€è‡´åˆ™OKï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚ Java JUCä¸­çš„atomicåŒ…å°±æ˜¯ä¹è§‚é”çš„ä¸€ç§å®žçŽ°ï¼ŒAtomicInteger é€šè¿‡CASï¼ˆCompare And Setï¼‰æ“ä½œå®žçŽ°çº¿ç¨‹å®‰å…¨çš„è‡ªå¢žã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤æ‚æŸ¥è¯¢è®­ç»ƒ]]></title>
    <url>%2F2019%2F01%2F27%2Fmysql%2F%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2%E8%AE%AD%E7%BB%83%2F</url>
    <content type="text"><![CDATA[å¯¹ä¸€äº›åœºæ™¯è¿›è¡Œsqlçš„ä¸€äº›è®­ç»ƒã€‚ 1ã€æŸ¥è¯¢è¯­æ–‡æˆç»©æ¯”æ•°å­¦æˆç»©å¥½çš„å­¦ç”Ÿçš„å­¦å· 1234567891011121ã€æ‹¿åˆ°è¯­æ–‡ç§‘ç›®çš„æ‰€æœ‰åˆ†æ•°idå’Œåˆ†æ•°ï¼šSELECT Sid,score from score WHERE Cid=12ã€æ‹¿åˆ°æ•°å­¦ç§‘ç›®çš„æ‰€æœ‰åˆ†æ•°idå’Œåˆ†æ•°ï¼šSELECT Sid,score FROM score WHERE Cid=23ã€æ‰¾åˆ°åŒä¸€ä¸ªå­¦ç”Ÿå¯¹åº”çš„è¯­æ–‡åˆ†æ•°æ¯”æ•°å­¦åˆ†æ•°é«˜çš„äººï¼šSELECT a.Sid from (SELECT Sid,score from score WHERE Cid=1) a, (SELECT Sid,score FROM score WHERE Cid=2) bWHERE a.score&gt;b.score and a.Sid=b.Sid 2ã€æŸ¥è¯¢å¹³å‡æˆç»©å¤§äºŽ60åˆ†çš„åŒå­¦çš„å­¦å·å’Œå¹³å‡æˆç»© 123456789SELECT sc.Sid, AVG(sc.score)FROM score scGROUP BY sc.SidHAVING AVG(sc.score) &gt; 60 3ã€æŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦å·ã€å§“åã€é€‰è¯¾æ•°ã€æ€»æˆç»© 12345678910SELECT st.Sid AS 'å­¦å·', st.Sname AS 'å­¦ç”Ÿå§“å', COUNT(sc.Cid) AS 'é€‰è¯¾æ•°', SUM(sc.score) AS 'æ€»åˆ†'FROM student stJOIN score sc ON st.Sid = sc.SidGROUP BY st.Sid 4ã€æŸ¥è¯¢å§“â€œçŽ‹â€çš„è€å¸ˆçš„ä¸ªæ•° 123456SELECT count(te.Tname)FROM teacher teWHERE te.Tname LIKE 'çŽ‹%' 5ã€æŸ¥è¯¢æ²¡å­¦è¿‡â€œçŽ‹äºŒâ€è€å¸ˆè¯¾çš„åŒå­¦çš„å­¦å·ã€å§“å 123456789101112131415161718192021#1ã€æ‰¾å‡ºæ‰€æœ‰å­¦ç”Ÿå¯¹åº”çš„å­¦å·å’Œè€å¸ˆSELECT st.Sid,te.Tname from student stJOIN score sc ON st.Sid = sc.SidJOIN course co on sc.Cid = co.CidJOIN teacher te ON co.Tid = te.Tid#2ã€æ‰¾åˆ°æ‰€æœ‰è€å¸ˆæ˜¯çŽ‹äº”çš„å­¦ç”Ÿidå’Œå§“åSELECT st.Sid,st.Sname,te.Tname from student stJOIN score sc ON st.Sid = sc.SidJOIN course co on sc.Cid = co.CidJOIN teacher te ON co.Tid = te.TidWHERE te.Tname='çŽ‹äº”'#3ã€æœ€åŽå°†çŽ‹äº”çš„å…¨éƒ¨å‰”é™¤ï¼Œå°±æ˜¯æ²¡æœ‰å­¦çŽ‹äº”è¯¾çš„å­¦ç”Ÿä¿¡æ¯SELECT st.Sid,st.Sname from student st WHERE st.Sid NOT IN(SELECT st.Sid from student stJOIN score sc ON st.Sid = sc.SidJOIN course co on sc.Cid = co.CidJOIN teacher te ON co.Tid = te.TidWHERE te.Tname='çŽ‹äº”') 6ã€æŸ¥è¯¢å­¦è¿‡â€œè¯­æ–‡â€å¹¶ä¸”ä¹Ÿå­¦è¿‡â€œæ•°å­¦â€è¯¾ç¨‹çš„åŒå­¦çš„å­¦å·ã€å§“å 1234567891011121314#1ã€æ‰¾åˆ°å­¦è¿‡"è¯­æ–‡"çš„å­¦ç”ŸSELECT st.Sid from student st JOIN score sc ON st.Sid = sc.Sid AND sc.Cid = 1#2ã€åœ¨å­¦è¿‡è¯­æ–‡çš„å­¦ç”Ÿä¸­å†æ‰¾å‡ºå­¦æ•°å­¦çš„å­¦ç”ŸSELECT st.Sid,st.Sname from student st JOIN score sc ON st.Sid = sc.Sid AND sc.Cid = 2AND st.Sid IN(SELECT st.Sid from student st JOIN score sc ON st.Sid = sc.Sid AND sc.Cid = 1) 7ã€æŸ¥è¯¢è¯¾ç¨‹ç¼–å·â€œæ•°å­¦â€çš„æˆç»©æ¯”è¯¾ç¨‹ç¼–å·â€œè¯­æ–‡â€è¯¾ç¨‹ä½Žçš„æ‰€æœ‰åŒå­¦çš„å­¦å·ã€å§“å 1234567891011121314151617#1ã€å…ˆæ‰¾åˆ°è¯¾ç¨‹ä¸ºè¯­æ–‡çš„æ‰€æœ‰äººçš„åˆ†æ•°SELECT * from score sc WHERE sc.Cid=1#2ã€å…ˆæ‰¾åˆ°è¯¾ç¨‹ä¸ºæ•°å­¦çš„æ‰€æœ‰äººçš„åˆ†æ•°SELECT * from score sc WHERE sc.Cid=2#3ã€æ‰¾åˆ°è¯­æ–‡æ¯”æ•°å­¦æˆç»©å¥½çš„å­¦ç”Ÿçš„æˆç»©SELECT * FROM (SELECT * from score sc WHERE sc.Cid=1) sc1,(SELECT * from score sc WHERE sc.Cid=2) sc2WHERE sc1.score&gt;sc2.score AND sc1.Sid=sc2.Sid#4ã€å°†å­¦ç”Ÿä¿¡æ¯å†æ‹¿å‡ºæ¥SELECT st.Sid,st.Sname from student st WHERE st.Sid IN(SELECT sc1.Sid FROM (SELECT * from score sc WHERE sc.Cid=1) sc1,(SELECT * from score sc WHERE sc.Cid=2) sc2WHERE sc1.score&gt;sc2.score AND sc1.Sid=sc2.Sid) 8ã€æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹æˆç»©å°äºŽ60åˆ†çš„åŒå­¦çš„å­¦å·ã€å§“å 123SELECT DISTINCT st.Sid,st.Sname from student stJOIN score sc on st.Sid = sc.SidWHERE sc.score&lt;60 9ã€æŸ¥è¯¢æ²¡æœ‰å­¦å…¨æ‰€æœ‰è¯¾çš„åŒå­¦çš„å­¦å·ã€å§“å 12345678910#1ã€ç»Ÿè®¡å‡ºæ‰€æœ‰å­¦ç”Ÿå­¦ä¹ çš„è¯¾ç¨‹æ•°SELECT COUNT(sc.Cid) from student stJOIN score sc on st.Sid=sc.SidGROUP BY sc.Sid#2ã€æ¯ä¸ªå­¦ç”Ÿå­¦ä¹ çš„è¯¾ç¨‹æ•°å°äºŽæ€»è¯¾ç¨‹æ•°ï¼Œè¯´æ˜Žæ²¡æœ‰å­¦å…¨SELECT st.Sid,st.Sname from student stJOIN score sc on st.Sid=sc.SidGROUP BY sc.SidHAVING COUNT(sc.Cid)&lt;(SELECT count(*) FROM course) 10ã€ æŸ¥è¯¢è‡³å°‘æœ‰ä¸€é—¨è¯¾ä¸Žå­¦å·ä¸ºâ€œ1â€çš„åŒå­¦æ‰€å­¦ç›¸åŒçš„åŒå­¦çš„å­¦å·å’Œå§“å 12345678#1ã€æ‰¾å‡ºå­¦å·ä¸º1çš„å­¦ç”Ÿæ‰€å­¦çš„è¯¾ç¨‹idSELECT sc.Cid from student st,score sc WHERE st.Sid=sc.Sid AND st.Sid=1#2ã€ä»ŽæŸ¥è¯¢ç»“æžœæ¥çœ‹æ˜¯é€‰æ‹©äº†è¯­æ–‡ï¼ˆ1ï¼‰å’Œæ•°å­¦ï¼ˆ2ï¼‰SELECT DISTINCT st.Sid,st.Sname from student st,score sc WHERE st.Sid=sc.SidAND sc.Cid IN( SELECT sc.Cid from student st,score sc WHERE st.Sid=sc.Sid AND st.Sid=1) 11ã€æŸ¥è¯¢å’Œâ€œ1â€å·çš„åŒå­¦å­¦ä¹ çš„è¯¾ç¨‹å®Œå…¨ç›¸åŒçš„å…¶ä»–åŒå­¦å­¦å·å’Œå§“å 12345678910111213141516171819202122232425#1ã€æ‰¾åˆ°2å·åŒå­¦æ‰€æœ‰å­¦çš„è¯¾ç¨‹SELECT sc.Cid from student stJOIN score sc on st.Sid=sc.SidWHERE st.Sid=2#2ã€æ‰¾åˆ°æœ‰è·Ÿä»–å­¦çš„ä¸ä¸€æ ·çš„å­¦ç”ŸSELECT DISTINCT st.Sid,st.Sname from student st,score sc WHERE st.Sid=sc.SidAND sc.Cid not in ( SELECT sc.Cid from student st JOIN score sc on st.Sid=sc.Sid WHERE st.Sid=1)#3ã€å†æ‰¾å‡ºä¸€æ ·çš„å­¦ç”Ÿï¼Œå¹¶ä¸”å°†ä»–è‡ªå·±å‰”é™¤SELECT DISTINCT st.Sid,st.Sname from student st,score sc WHERE st.Sid=sc.SidAND st.Sid not in( SELECT DISTINCT st.Sid from student st,score sc WHERE st.Sid=sc.Sid AND sc.Cid not in ( SELECT sc.Cid from student st JOIN score sc on st.Sid=sc.Sid WHERE st.Sid=1 ))AND st.Sid!=1 12ã€æŒ‰å¹³å‡æˆç»©ä»Žé«˜åˆ°ä½Žæ˜¾ç¤ºæ‰€æœ‰å­¦ç”Ÿçš„ä¸‰é—¨çš„è¯¾ç¨‹æˆç»©,æŒ‰å¦‚ä¸‹å½¢å¼æ˜¾ç¤ºï¼š å­¦ç”ŸID,è¯­æ–‡,æ•°å­¦,è‹±è¯­,æœ‰æ•ˆè¯¾ç¨‹æ•°,æœ‰æ•ˆå¹³å‡åˆ† 123456789101112131415161718#1ã€æ ¹æ®å­¦ç”Ÿidåˆ†ç»„ï¼ŒæŒ‰ç…§å­¦ç”Ÿçš„å¹³å‡æˆç»©æŽ’åºSELECT *FROM student stJOIN score sc ON st.Sid=sc.SidGROUP BY st.SidORDER BY AVG(sc.score)#2ã€æŒ‰ç…§è¦æ±‚æ˜¾ç¤ºSELECT st.Sid AS 'å­¦ç”Ÿid',(SELECT score from score WHERE Cid=1 and st.Sid=Sid) AS 'è¯­æ–‡',(SELECT score from score WHERE Cid=2 and st.Sid=Sid) AS 'æ•°å­¦',(SELECT score from score WHERE Cid=3 and st.Sid=Sid) AS 'è‹±è¯­',COUNT(*) AS 'æœ‰æ•ˆè¯¾ç¨‹æ•°',AVG(sc.score) AS 'å¹³å‡åˆ†'FROM student stJOIN score sc ON st.Sid=sc.SidGROUP BY st.SidORDER BY AVG(sc.score) 13ã€æŸ¥è¯¢å„ç§‘æˆç»©æœ€é«˜å’Œæœ€ä½Žçš„åˆ†ï¼šä»¥å¦‚ä¸‹å½¢å¼æ˜¾ç¤ºï¼šè¯¾ç¨‹IDï¼Œæœ€é«˜åˆ†ï¼Œæœ€ä½Žåˆ† 12345SELECT sc.Cid,MAX(sc.score) AS 'æœ€é«˜åˆ†',MIN(sc.score) AS 'æœ€ä½Žåˆ†' from student stJOIN score sc on st.Sid=sc.SidGROUP BY sc.Cid 14ã€æ£€ç´¢â€œè¯­æ–‡â€è¯¾ç¨‹åˆ†æ•°å°äºŽ60ï¼ŒæŒ‰åˆ†æ•°é™åºæŽ’åˆ—çš„åŒå­¦å­¦å· 1234SELECT st.Sid,st.Sname from student stJOIN score sc ON st.Sid=sc.SidWHERE sc.score&lt;60 AND sc.Cid=1ORDER BY sc.score DESC 15ã€æŸ¥è¯¢ä¸¤é—¨ä»¥ä¸Šä¸åŠæ ¼è¯¾ç¨‹çš„åŒå­¦çš„å­¦å·åŠå…¶å¹³å‡æˆç»© 12345678910111213141516#1ã€å…ˆæŸ¥è¯¢å‡ºæŒ‚ç§‘è¶…è¿‡ä¸¤é—¨çš„å­¦ç”ŸidSELECT sc.Sid from score sc WHERE sc.score&lt;60 GROUP BY sc.Sid HAVING count(*)&gt;2#2ã€å†ç›¸åº”åœ°æŸ¥å‡ºå­¦ç”Ÿçš„ä¿¡æ¯SELECT st.Sid,AVG(sc.score) from student stJOIN score sc on st.Sid=sc.SidWHERE st.Sid in( SELECT sc.Sid from score sc WHERE sc.score&lt;60 GROUP BY sc.Sid HAVING count(*)&gt;2)GROUP BY st.Sid 16ã€æŸ¥è¯¢æ²¡å­¦è¿‡â€œçŽ‹äº”â€è€å¸ˆè®²æŽˆçš„ä»»ä¸€é—¨è¯¾ç¨‹çš„å­¦ç”Ÿå§“å 123456789101112131415#1ã€æŸ¥å‡ºæŠ¥åçŽ‹äº”è€å¸ˆè¯¾ç¨‹çš„å­¦ç”ŸidSELECT st.Sid from student stJOIN score sc on st.Sid=sc.SidJOIN course co on sc.Cid=co.CidJOIN teacher te on co.Tid=te.TidWHERE te.Tname="çŽ‹äº”"#3ã€æ‰¾å‡ºæ²¡æœ‰ä¸ŠçŽ‹äº”è€å¸ˆè¯¾çš„å­¦ç”Ÿæ˜¯å“ªäº›SELECT * from student st WHERE st.Sid not in(SELECT st.Sid from student stJOIN score sc on st.Sid=sc.SidJOIN course co on sc.Cid=co.CidJOIN teacher te on co.Tid=te.TidWHERE te.Tname="çŽ‹äº”") 17ã€æŸ¥è¯¢é€‰ä¿®å…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”Ÿ 12345678910#1ã€æŸ¥å‡ºæ¯ä¸ªå­¦ç”Ÿé€‰ä¿®çš„è¯¾ç¨‹æ•°SELECT st.Sid,st.Sname,count(sc.Cid) from student stJOIN score sc on st.Sid=sc.SidGROUP BY sc.Sid#2ã€å†æ‰¾å‡ºæ•°é‡ç­‰äºŽå…¨éƒ¨è¯¾ç¨‹çš„å­¦ç”ŸSELECT st.Sid,st.Sname,count(sc.Cid) from student stJOIN score sc on st.Sid=sc.SidGROUP BY sc.SidHAVING count(sc.Cid)=(SELECT count(*) FROM course) 18ã€æŸ¥è¯¢å…¨éƒ¨å­¦ç”Ÿéƒ½é€‰ä¿®çš„è¯¾ç¨‹çš„è¯¾ç¨‹å·å’Œè¯¾ç¨‹å 12345#1ã€åœ¨åˆ†æ•°è¡¨ä¸­æ‰¾å‡ºæ¯ç§è¯¾ç¨‹çš„é€‰ä¿®äººæ•°SELECT sc.Cid,count(sc.Cid) from score sc GROUP BY sc.Cid#2ã€äººæ•°ç­‰äºŽ7(8å·å­¦ç”Ÿæ— ä»»ä½•å‚ä¸Ž)è¯´æ˜Žæ‰€æœ‰äººéƒ½é€‰äº†SELECT * from course co where co.Cid=(SELECT sc.Cid from score sc GROUP BY sc.Cid HAVING count(sc.Cid) = 7) 19ã€æ£€ç´¢è‡³å°‘é€‰ä¿®ä¸¤é—¨è¯¾ç¨‹çš„å­¦ç”Ÿå­¦å· 12345678910#1ã€å…ˆé€‰å‡ºæ¯ä¸ªå­¦ç”Ÿé€‰ç§€çš„è¯¾ç¨‹SELECT count(sc.Cid) from student stJOIN score sc on sc.Sid=st.Sidgroup by sc.Sid#2ã€å†é€‰å‡ºé€‰ç§€è¯¾ç¨‹è¶…è¿‡2é—¨çš„å­¦ç”ŸSELECT st.Sid,st.Sname from student stJOIN score sc on sc.Sid=st.Sidgroup by sc.SidHAVING count(sc.Cid)&gt;=2 20ã€ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹çš„å­¦ç”Ÿé€‰ä¿®äººæ•° 1234#1ã€ç»Ÿè®¡å‡ºæ¯é—¨é€‰ç§€çš„å­¦ç”Ÿæ•°SELECT count(sc.Sid) from student stJOIN score sc on sc.Sid=st.SidGROUP BY sc.Cid]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SQLå¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹æç‚¼]]></title>
    <url>%2F2019%2F01%2F27%2Fmysql%2FSQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å¯¹ã€Šmysqlå¿…çŸ¥å¿…ä¼šã€‹çš„çŸ¥è¯†æç‚¼ã€‚ ä¸€ã€åŸºç¡€ æ¨¡å¼å®šä¹‰äº†æ•°æ®å¦‚ä½•å­˜å‚¨ã€å­˜å‚¨ä»€ä¹ˆæ ·çš„æ•°æ®ä»¥åŠæ•°æ®å¦‚ä½•åˆ†è§£ç­‰ä¿¡æ¯ï¼Œæ•°æ®åº“å’Œè¡¨éƒ½æœ‰æ¨¡å¼ã€‚ ä¸»é”®çš„å€¼ä¸å…è®¸ä¿®æ”¹ï¼Œä¹Ÿä¸å…è®¸å¤ç”¨ï¼ˆä¸èƒ½ä½¿ç”¨å·²ç»åˆ é™¤çš„ä¸»é”®å€¼èµ‹ç»™æ–°æ•°æ®è¡Œçš„ä¸»é”®ï¼‰ã€‚ SQLï¼ˆStructured Query Language)ï¼Œæ ‡å‡† SQL ç”± ANSI æ ‡å‡†å§”å‘˜ä¼šç®¡ç†ï¼Œä»Žè€Œç§°ä¸º ANSI SQLã€‚å„ä¸ª DBMS éƒ½æœ‰è‡ªå·±çš„å®žçŽ°ï¼Œå¦‚ PL/SQLã€Transact-SQL ç­‰ã€‚ SQL è¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯æ•°æ®åº“è¡¨åã€åˆ—åå’Œå€¼æ˜¯å¦åŒºåˆ†ä¾èµ–äºŽå…·ä½“çš„ DBMS ä»¥åŠé…ç½®ã€‚ SQL æ”¯æŒä»¥ä¸‹ä¸‰ç§æ³¨é‡Šï¼š 12345# æ³¨é‡ŠSELECT *FROM mytable; -- æ³¨é‡Š/* æ³¨é‡Š1 æ³¨é‡Š2 */ äºŒã€åˆ›å»ºè¡¨ 123456CREATE TABLE mytable ( id INT NOT NULL AUTO_INCREMENT, col1 INT NOT NULL DEFAULT 1, col2 VARCHAR(45) NULL, col3 DATE NULL, PRIMARY KEY (`id`)); ä¸‰ã€ä¿®æ”¹è¡¨ æ·»åŠ åˆ— 12ALTER TABLE mytableADD col CHAR(20); åˆ é™¤åˆ— 12ALTER TABLE mytableDROP COLUMN col; åˆ é™¤è¡¨ 1DROP TABLE mytable; å››ã€æ’å…¥ æ™®é€šæ’å…¥ 12INSERT INTO mytable(col1, col2)VALUES(val1, val2); æ’å…¥æ£€ç´¢å‡ºæ¥çš„æ•°æ® 123INSERT INTO mytable1(col1, col2)SELECT col1, col2FROM mytable2; å°†ä¸€ä¸ªè¡¨çš„å†…å®¹æ’å…¥åˆ°ä¸€ä¸ªæ–°è¡¨ 12CREATE TABLE newtable ASSELECT * FROM mytable; äº”ã€æ›´æ–° 123UPDATE mytableSET col = valWHERE id = 1; å…­ã€åˆ é™¤ 12DELETE FROM mytableWHERE id = 1; TRUNCATE TABLE å¯ä»¥æ¸…ç©ºè¡¨ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤æ‰€æœ‰è¡Œã€‚ 1TRUNCATE TABLE mytable; ä½¿ç”¨æ›´æ–°å’Œåˆ é™¤æ“ä½œæ—¶ä¸€å®šè¦ç”¨ WHERE å­å¥ï¼Œä¸ç„¶ä¼šæŠŠæ•´å¼ è¡¨çš„æ•°æ®éƒ½ç ´åã€‚å¯ä»¥å…ˆç”¨ SELECT è¯­å¥è¿›è¡Œæµ‹è¯•ï¼Œé˜²æ­¢é”™è¯¯åˆ é™¤ã€‚ ä¸ƒã€æŸ¥è¯¢ DISTINCT ç›¸åŒå€¼åªä¼šå‡ºçŽ°ä¸€æ¬¡ã€‚å®ƒä½œç”¨äºŽæ‰€æœ‰åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰åˆ—çš„å€¼éƒ½ç›¸åŒæ‰ç®—ç›¸åŒã€‚ 12SELECT DISTINCT col1, col2FROM mytable; LIMIT é™åˆ¶è¿”å›žçš„è¡Œæ•°ã€‚å¯ä»¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ·å§‹è¡Œï¼Œä»Ž 0 å¼€å§‹ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿”å›žçš„æ€»è¡Œæ•°ã€‚ è¿”å›žå‰ 5 è¡Œï¼š 123SELECT *FROM mytableLIMIT 5; 123SELECT *FROM mytableLIMIT 0, 5; è¿”å›žç¬¬ 3 ~ 5 è¡Œï¼š 123SELECT *FROM mytableLIMIT 2, 3; å…«ã€æŽ’åº ASC ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰ DESC ï¼šé™åº å¯ä»¥æŒ‰å¤šä¸ªåˆ—è¿›è¡ŒæŽ’åºï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªåˆ—æŒ‡å®šä¸åŒçš„æŽ’åºæ–¹å¼ï¼š 123SELECT *FROM mytableORDER BY col1 DESC, col2 ASC; ä¹ã€è¿‡æ»¤ ä¸è¿›è¡Œè¿‡æ»¤çš„æ•°æ®éžå¸¸å¤§ï¼Œå¯¼è‡´é€šè¿‡ç½‘ç»œä¼ è¾“äº†å¤šä½™çš„æ•°æ®ï¼Œä»Žè€Œæµªè´¹äº†ç½‘ç»œå¸¦å®½ã€‚å› æ­¤å°½é‡ä½¿ç”¨ SQL è¯­å¥æ¥è¿‡æ»¤ä¸å¿…è¦çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¼ è¾“æ‰€æœ‰çš„æ•°æ®åˆ°å®¢æˆ·ç«¯ä¸­ç„¶åŽç”±å®¢æˆ·ç«¯è¿›è¡Œè¿‡æ»¤ã€‚ 123SELECT *FROM mytableWHERE col IS NULL; ä¸‹è¡¨æ˜¾ç¤ºäº† WHERE å­å¥å¯ç”¨çš„æ“ä½œç¬¦ æ“ä½œç¬¦ è¯´æ˜Ž = ç­‰äºŽ &lt; å°äºŽ &gt; å¤§äºŽ &lt;&gt; != ä¸ç­‰äºŽ &lt;= !&gt; å°äºŽç­‰äºŽ &gt;= !&lt; å¤§äºŽç­‰äºŽ BETWEEN åœ¨ä¸¤ä¸ªå€¼ä¹‹é—´ IS NULL ä¸º NULL å€¼ åº”è¯¥æ³¨æ„åˆ°ï¼ŒNULL ä¸Ž 0ã€ç©ºå­—ç¬¦ä¸²éƒ½ä¸åŒã€‚ AND å’Œ OR ç”¨äºŽè¿žæŽ¥å¤šä¸ªè¿‡æ»¤æ¡ä»¶ã€‚ä¼˜å…ˆå¤„ç† ANDï¼Œå½“ä¸€ä¸ªè¿‡æ»¤è¡¨è¾¾å¼æ¶‰åŠåˆ°å¤šä¸ª AND å’Œ OR æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ () æ¥å†³å®šä¼˜å…ˆçº§ï¼Œä½¿å¾—ä¼˜å…ˆçº§å…³ç³»æ›´æ¸…æ™°ã€‚ IN æ“ä½œç¬¦ç”¨äºŽåŒ¹é…ä¸€ç»„å€¼ï¼Œå…¶åŽä¹Ÿå¯ä»¥æŽ¥ä¸€ä¸ª SELECT å­å¥ï¼Œä»Žè€ŒåŒ¹é…å­æŸ¥è¯¢å¾—åˆ°çš„ä¸€ç»„å€¼ã€‚ NOT æ“ä½œç¬¦ç”¨äºŽå¦å®šä¸€ä¸ªæ¡ä»¶ã€‚ åã€é€šé…ç¬¦ é€šé…ç¬¦ä¹Ÿæ˜¯ç”¨åœ¨è¿‡æ»¤è¯­å¥ä¸­ï¼Œä½†å®ƒåªèƒ½ç”¨äºŽæ–‡æœ¬å­—æ®µã€‚ % åŒ¹é… &gt;=0 ä¸ªä»»æ„å­—ç¬¦ï¼› \_ åŒ¹é… ==1 ä¸ªä»»æ„å­—ç¬¦ï¼› [ ] å¯ä»¥åŒ¹é…é›†åˆå†…çš„å­—ç¬¦ï¼Œä¾‹å¦‚ [ab] å°†åŒ¹é…å­—ç¬¦ a æˆ–è€… bã€‚ç”¨è„±å­—ç¬¦ ^ å¯ä»¥å¯¹å…¶è¿›è¡Œå¦å®šï¼Œä¹Ÿå°±æ˜¯ä¸åŒ¹é…é›†åˆå†…çš„å­—ç¬¦ã€‚ ä½¿ç”¨ Like æ¥è¿›è¡Œé€šé…ç¬¦åŒ¹é…ã€‚ 123SELECT *FROM mytableWHERE col LIKE '[^AB]%'; -- ä¸ä»¥ A å’Œ B å¼€å¤´çš„ä»»æ„æ–‡æœ¬ ä¸è¦æ»¥ç”¨é€šé…ç¬¦ï¼Œé€šé…ç¬¦ä½äºŽå¼€å¤´å¤„åŒ¹é…ä¼šéžå¸¸æ…¢ã€‚ åä¸€ã€è®¡ç®—å­—æ®µ åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šå®Œæˆæ•°æ®çš„è½¬æ¢å’Œæ ¼å¼åŒ–çš„å·¥ä½œå¾€å¾€æ¯”å®¢æˆ·ç«¯ä¸Šå¿«å¾—å¤šï¼Œå¹¶ä¸”è½¬æ¢å’Œæ ¼å¼åŒ–åŽçš„æ•°æ®é‡æ›´å°‘çš„è¯å¯ä»¥å‡å°‘ç½‘ç»œé€šä¿¡é‡ã€‚ è®¡ç®—å­—æ®µé€šå¸¸éœ€è¦ä½¿ç”¨ AS æ¥å–åˆ«åï¼Œå¦åˆ™è¾“å‡ºçš„æ—¶å€™å­—æ®µåä¸ºè®¡ç®—è¡¨è¾¾å¼ã€‚ 12SELECT col1 * col2 AS aliasFROM mytable; CONCAT() ç”¨äºŽè¿žæŽ¥ä¸¤ä¸ªå­—æ®µã€‚è®¸å¤šæ•°æ®åº“ä¼šä½¿ç”¨ç©ºæ ¼æŠŠä¸€ä¸ªå€¼å¡«å……ä¸ºåˆ—å®½ï¼Œå› æ­¤è¿žæŽ¥çš„ç»“æžœä¼šå‡ºçŽ°ä¸€äº›ä¸å¿…è¦çš„ç©ºæ ¼ï¼Œä½¿ç”¨ TRIM() å¯ä»¥åŽ»é™¤é¦–å°¾ç©ºæ ¼ã€‚ 12SELECT CONCAT(TRIM(col1), '(', TRIM(col2), ')') AS concat_colFROM mytable; åäºŒã€å‡½æ•° æ±‡æ€» å‡½ æ•° è¯´ æ˜Ž AVG() è¿”å›žæŸåˆ—çš„å¹³å‡å€¼ COUNT() è¿”å›žæŸåˆ—çš„è¡Œæ•° MAX() è¿”å›žæŸåˆ—çš„æœ€å¤§å€¼ MIN() è¿”å›žæŸåˆ—çš„æœ€å°å€¼ SUM() è¿”å›žæŸåˆ—å€¼ä¹‹å’Œ AVG() ä¼šå¿½ç•¥ NULL è¡Œã€‚ ä½¿ç”¨ DISTINCT å¯ä»¥è®©æ±‡æ€»å‡½æ•°å€¼æ±‡æ€»ä¸åŒçš„å€¼ã€‚ 12SELECT AVG(DISTINCT col1) AS avg_colFROM mytable; æ–‡æœ¬å¤„ç† å‡½æ•° è¯´æ˜Ž LEFT() å·¦è¾¹çš„å­—ç¬¦ RIGHT() å³è¾¹çš„å­—ç¬¦ LOWER() è½¬æ¢ä¸ºå°å†™å­—ç¬¦ UPPER() è½¬æ¢ä¸ºå¤§å†™å­—ç¬¦ LTRIM() åŽ»é™¤å·¦è¾¹çš„ç©ºæ ¼ RTRIM() åŽ»é™¤å³è¾¹çš„ç©ºæ ¼ LENGTH() é•¿åº¦ SOUNDEX() è½¬æ¢ä¸ºè¯­éŸ³å€¼ å…¶ä¸­ï¼Œ SOUNDEX() å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å…¶è¯­éŸ³è¡¨ç¤ºçš„å­—æ¯æ•°å­—æ¨¡å¼ã€‚ 123SELECT *FROM mytableWHERE SOUNDEX(col1) = SOUNDEX('apple') æ—¥æœŸå’Œæ—¶é—´å¤„ç† æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DD æ—¶é—´æ ¼å¼ï¼šHH:MM:SS å‡½ æ•° è¯´ æ˜Ž AddDate() å¢žåŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰ AddTime() å¢žåŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰ CurDate() è¿”å›žå½“å‰æ—¥æœŸ CurTime() è¿”å›žå½“å‰æ—¶é—´ Date() è¿”å›žæ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ† DateDiff() è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·® Date_Add() é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•° Date_Format() è¿”å›žä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸² Day() è¿”å›žä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ† DayOfWeek() å¯¹äºŽä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›žå¯¹åº”çš„æ˜ŸæœŸå‡  Hour() è¿”å›žä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ† Minute() è¿”å›žä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ† Month() è¿”å›žä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ† Now() è¿”å›žå½“å‰æ—¥æœŸå’Œæ—¶é—´ Second() è¿”å›žä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ† Time() è¿”å›žä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ† Year() è¿”å›žä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ† 1mysql&gt; SELECT NOW(); 12018-4-14 20:25:11 æ•°å€¼å¤„ç† å‡½æ•° è¯´æ˜Ž SIN() æ­£å¼¦ COS() ä½™å¼¦ TAN() æ­£åˆ‡ ABS() ç»å¯¹å€¼ SQRT() å¹³æ–¹æ ¹ MOD() ä½™æ•° EXP() æŒ‡æ•° PI() åœ†å‘¨çŽ‡ RAND() éšæœºæ•° åä¸‰ã€åˆ†ç»„ åˆ†ç»„å°±æ˜¯æŠŠå…·æœ‰ç›¸åŒçš„æ•°æ®å€¼çš„è¡Œæ”¾åœ¨åŒä¸€ç»„ä¸­ã€‚ å¯ä»¥å¯¹åŒä¸€åˆ†ç»„æ•°æ®ä½¿ç”¨æ±‡æ€»å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æ±‚åˆ†ç»„æ•°æ®çš„å¹³å‡å€¼ç­‰ã€‚ æŒ‡å®šçš„åˆ†ç»„å­—æ®µé™¤äº†èƒ½æŒ‰è¯¥å­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿä¼šè‡ªåŠ¨æŒ‰è¯¥å­—æ®µè¿›è¡ŒæŽ’åºã€‚ 123SELECT col, COUNT(*) AS numFROM mytableGROUP BY col; GROUP BY è‡ªåŠ¨æŒ‰åˆ†ç»„å­—æ®µè¿›è¡ŒæŽ’åºï¼ŒORDER BY ä¹Ÿå¯ä»¥æŒ‰æ±‡æ€»å­—æ®µæ¥è¿›è¡ŒæŽ’åºã€‚ 1234SELECT col, COUNT(*) AS numFROM mytableGROUP BY colORDER BY num; WHERE è¿‡æ»¤è¡Œï¼ŒHAVING è¿‡æ»¤åˆ†ç»„ï¼Œè¡Œè¿‡æ»¤åº”å½“å…ˆäºŽåˆ†ç»„è¿‡æ»¤ã€‚ 12345SELECT col, COUNT(*) AS numFROM mytableWHERE col &gt; 2GROUP BY colHAVING num &gt;= 2; åˆ†ç»„è§„å®šï¼š GROUP BY å­å¥å‡ºçŽ°åœ¨ WHERE å­å¥ä¹‹åŽï¼ŒORDER BY å­å¥ä¹‹å‰ï¼› é™¤äº†æ±‡æ€»å­—æ®µå¤–ï¼ŒSELECT è¯­å¥ä¸­çš„æ¯ä¸€å­—æ®µéƒ½å¿…é¡»åœ¨ GROUP BY å­å¥ä¸­ç»™å‡ºï¼› NULL çš„è¡Œä¼šå•ç‹¬åˆ†ä¸ºä¸€ç»„ï¼› å¤§å¤šæ•° SQL å®žçŽ°ä¸æ”¯æŒ GROUP BY åˆ—å…·æœ‰å¯å˜é•¿åº¦çš„æ•°æ®ç±»åž‹ã€‚ åå››ã€å­æŸ¥è¯¢ å­æŸ¥è¯¢ä¸­åªèƒ½è¿”å›žä¸€ä¸ªå­—æ®µçš„æ•°æ®ã€‚ å¯ä»¥å°†å­æŸ¥è¯¢çš„ç»“æžœä½œä¸º WHRER è¯­å¥çš„è¿‡æ»¤æ¡ä»¶ï¼š 1234SELECT *FROM mytable1WHERE col1 IN (SELECT col2 FROM mytable2); ä¸‹é¢çš„è¯­å¥å¯ä»¥æ£€ç´¢å‡ºå®¢æˆ·çš„è®¢å•æ•°é‡ï¼Œå­æŸ¥è¯¢è¯­å¥ä¼šå¯¹ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ£€ç´¢å‡ºçš„æ¯ä¸ªå®¢æˆ·æ‰§è¡Œä¸€æ¬¡ï¼š 123456SELECT cust_name, (SELECT COUNT(*) FROM Orders WHERE Orders.cust_id = Customers.cust_id) AS orders_numFROM CustomersORDER BY cust_name; åäº”ã€è¿žæŽ¥ è¿žæŽ¥ç”¨äºŽè¿žæŽ¥å¤šä¸ªè¡¨ï¼Œä½¿ç”¨ JOIN å…³é”®å­—ï¼Œå¹¶ä¸”æ¡ä»¶è¯­å¥ä½¿ç”¨ ON è€Œä¸æ˜¯ WHEREã€‚ è¿žæŽ¥å¯ä»¥æ›¿æ¢å­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ¯”å­æŸ¥è¯¢çš„æ•ˆçŽ‡ä¸€èˆ¬ä¼šæ›´å¿«ã€‚ å¯ä»¥ç”¨ AS ç»™åˆ—åã€è®¡ç®—å­—æ®µå’Œè¡¨åå–åˆ«åï¼Œç»™è¡¨åå–åˆ«åæ˜¯ä¸ºäº†ç®€åŒ– SQL è¯­å¥ä»¥åŠè¿žæŽ¥ç›¸åŒè¡¨ã€‚ å†…è¿žæŽ¥ å†…è¿žæŽ¥åˆç§°ç­‰å€¼è¿žæŽ¥ï¼Œä½¿ç”¨ INNER JOIN å…³é”®å­—ã€‚ 123SELECT A.value, B.valueFROM tablea AS A INNER JOIN tableb AS BON A.key = B.key; å¯ä»¥ä¸æ˜Žç¡®ä½¿ç”¨ INNER JOINï¼Œè€Œä½¿ç”¨æ™®é€šæŸ¥è¯¢å¹¶åœ¨ WHERE ä¸­å°†ä¸¤ä¸ªè¡¨ä¸­è¦è¿žæŽ¥çš„åˆ—ç”¨ç­‰å€¼æ–¹æ³•è¿žæŽ¥èµ·æ¥ã€‚ 123SELECT A.value, B.valueFROM tablea AS A, tableb AS BWHERE A.key = B.key; åœ¨æ²¡æœ‰æ¡ä»¶è¯­å¥çš„æƒ…å†µä¸‹è¿”å›žç¬›å¡å°”ç§¯ã€‚ è‡ªè¿žæŽ¥ è‡ªè¿žæŽ¥å¯ä»¥çœ‹æˆå†…è¿žæŽ¥çš„ä¸€ç§ï¼Œåªæ˜¯è¿žæŽ¥çš„è¡¨æ˜¯è‡ªèº«è€Œå·²ã€‚ ä¸€å¼ å‘˜å·¥è¡¨ï¼ŒåŒ…å«å‘˜å·¥å§“åå’Œå‘˜å·¥æ‰€å±žéƒ¨é—¨ï¼Œè¦æ‰¾å‡ºä¸Ž Jim å¤„åœ¨åŒä¸€éƒ¨é—¨çš„æ‰€æœ‰å‘˜å·¥å§“åã€‚ å­æŸ¥è¯¢ç‰ˆæœ¬ 123456SELECT nameFROM employeeWHERE department = ( SELECT department FROM employee WHERE name = "Jim"); è‡ªè¿žæŽ¥ç‰ˆæœ¬ 1234SELECT e1.nameFROM employee AS e1 INNER JOIN employee AS e2ON e1.department = e2.department AND e2.name = "Jim"; è‡ªç„¶è¿žæŽ¥ è‡ªç„¶è¿žæŽ¥æ˜¯æŠŠåŒååˆ—é€šè¿‡ç­‰å€¼æµ‹è¯•è¿žæŽ¥èµ·æ¥çš„ï¼ŒåŒååˆ—å¯ä»¥æœ‰å¤šä¸ªã€‚ å†…è¿žæŽ¥å’Œè‡ªç„¶è¿žæŽ¥çš„åŒºåˆ«ï¼šå†…è¿žæŽ¥æä¾›è¿žæŽ¥çš„åˆ—ï¼Œè€Œè‡ªç„¶è¿žæŽ¥è‡ªåŠ¨è¿žæŽ¥æ‰€æœ‰åŒååˆ—ã€‚ 12SELECT A.value, B.valueFROM tablea AS A NATURAL JOIN tableb AS B; å¤–è¿žæŽ¥ å¤–è¿žæŽ¥ä¿ç•™äº†æ²¡æœ‰å…³è”çš„é‚£äº›è¡Œã€‚åˆ†ä¸ºå·¦å¤–è¿žæŽ¥ï¼Œå³å¤–è¿žæŽ¥ä»¥åŠå…¨å¤–è¿žæŽ¥ï¼Œå·¦å¤–è¿žæŽ¥å°±æ˜¯ä¿ç•™å·¦è¡¨æ²¡æœ‰å…³è”çš„è¡Œã€‚ æ£€ç´¢æ‰€æœ‰é¡¾å®¢çš„è®¢å•ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿˜æ²¡æœ‰è®¢å•ä¿¡æ¯çš„é¡¾å®¢ã€‚ 123SELECT Customers.cust_id, Orders.order_numFROM Customers LEFT OUTER JOIN OrdersON Customers.cust_id = Orders.cust_id; customers è¡¨ï¼š cust_id cust_name 1 a 2 b 3 c orders è¡¨ï¼š order_id cust_id 1 1 2 1 3 3 4 3 ç»“æžœï¼š cust_id cust_name order_id 1 a 1 1 a 2 3 c 3 3 c 4 2 b Null åå…­ã€ç»„åˆæŸ¥è¯¢ ä½¿ç”¨ UNION æ¥ç»„åˆä¸¤ä¸ªæŸ¥è¯¢ï¼Œå¦‚æžœç¬¬ä¸€ä¸ªæŸ¥è¯¢è¿”å›ž M è¡Œï¼Œç¬¬äºŒä¸ªæŸ¥è¯¢è¿”å›ž N è¡Œï¼Œé‚£ä¹ˆç»„åˆæŸ¥è¯¢çš„ç»“æžœä¸€èˆ¬ä¸º M+N è¡Œã€‚ æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ã€è¡¨è¾¾å¼å’Œèšé›†å‡½æ•°ã€‚ é»˜è®¤ä¼šåŽ»é™¤ç›¸åŒè¡Œï¼Œå¦‚æžœéœ€è¦ä¿ç•™ç›¸åŒè¡Œï¼Œä½¿ç”¨ UNION ALLã€‚ åªèƒ½åŒ…å«ä¸€ä¸ª ORDER BY å­å¥ï¼Œå¹¶ä¸”å¿…é¡»ä½äºŽè¯­å¥çš„æœ€åŽã€‚ 1234567SELECT colFROM mytableWHERE col = 1UNIONSELECT colFROM mytableWHERE col =2; åä¸ƒã€è§†å›¾ è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œä¹Ÿå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œç´¢å¼•æ“ä½œã€‚ å¯¹è§†å›¾çš„æ“ä½œå’Œå¯¹æ™®é€šè¡¨çš„æ“ä½œä¸€æ ·ã€‚ è§†å›¾å…·æœ‰å¦‚ä¸‹å¥½å¤„ï¼š ç®€åŒ–å¤æ‚çš„ SQL æ“ä½œï¼Œæ¯”å¦‚å¤æ‚çš„è¿žæŽ¥ï¼› åªä½¿ç”¨å®žé™…è¡¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼› é€šè¿‡åªç»™ç”¨æˆ·è®¿é—®è§†å›¾çš„æƒé™ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼› æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚ 1234CREATE VIEW myview ASSELECT Concat(col1, col2) AS concat_col, col3*col4 AS compute_colFROM mytableWHERE col5 = val; åå…«ã€å­˜å‚¨è¿‡ç¨‹ å­˜å‚¨è¿‡ç¨‹å¯ä»¥çœ‹æˆæ˜¯å¯¹ä¸€ç³»åˆ— SQL æ“ä½œçš„æ‰¹å¤„ç†ï¼› ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„ï¼š ä»£ç å°è£…ï¼Œä¿è¯äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼› ä»£ç å¤ç”¨ï¼› ç”±äºŽæ˜¯é¢„å…ˆç¼–è¯‘ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚ å‘½ä»¤è¡Œä¸­åˆ›å»ºå­˜å‚¨è¿‡ç¨‹éœ€è¦è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œå› ä¸ºå‘½ä»¤è¡Œæ˜¯ä»¥ ; ä¸ºç»“æŸç¬¦ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¹ŸåŒ…å«äº†åˆ†å·ï¼Œå› æ­¤ä¼šé”™è¯¯æŠŠè¿™éƒ¨åˆ†åˆ†å·å½“æˆæ˜¯ç»“æŸç¬¦ï¼Œé€ æˆè¯­æ³•é”™è¯¯ã€‚ åŒ…å« inã€out å’Œ inout ä¸‰ç§å‚æ•°ã€‚ ç»™å˜é‡èµ‹å€¼éƒ½éœ€è¦ç”¨ select into è¯­å¥ã€‚ æ¯æ¬¡åªèƒ½ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œä¸æ”¯æŒé›†åˆçš„æ“ä½œã€‚ 123456789101112delimiter //create procedure myprocedure( out ret int ) begin declare y int; select sum(col1) from mytable into y; select y*y into ret; end //delimiter ; 12call myprocedure(@ret);select @ret; åä¹ã€æ¸¸æ ‡ åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨æ¸¸æ ‡å¯ä»¥å¯¹ä¸€ä¸ªç»“æžœé›†è¿›è¡Œç§»åŠ¨éåŽ†ã€‚ æ¸¸æ ‡ä¸»è¦ç”¨äºŽäº¤äº’å¼åº”ç”¨ï¼Œå…¶ä¸­ç”¨æˆ·éœ€è¦å¯¹æ•°æ®é›†ä¸­çš„ä»»æ„è¡Œè¿›è¡Œæµè§ˆå’Œä¿®æ”¹ã€‚ ä½¿ç”¨æ¸¸æ ‡çš„å››ä¸ªæ­¥éª¤ï¼š å£°æ˜Žæ¸¸æ ‡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰å®žé™…æ£€ç´¢å‡ºæ•°æ®ï¼› æ‰“å¼€æ¸¸æ ‡ï¼› å–å‡ºæ•°æ®ï¼› å…³é—­æ¸¸æ ‡ï¼› 1234567891011121314151617181920delimiter //create procedure myprocedure(out ret int) begin declare done boolean default 0; declare mycursor cursor for select col1 from mytable; # å®šä¹‰äº†ä¸€ä¸ª continue handlerï¼Œå½“ sqlstate '02000' è¿™ä¸ªæ¡ä»¶å‡ºçŽ°æ—¶ï¼Œä¼šæ‰§è¡Œ set done = 1 declare continue handler for sqlstate '02000' set done = 1; open mycursor; repeat fetch mycursor into ret; select ret; until done end repeat; close mycursor; end // delimiter ; äºŒåã€è§¦å‘å™¨ è§¦å‘å™¨ä¼šåœ¨æŸä¸ªè¡¨æ‰§è¡Œä»¥ä¸‹è¯­å¥æ—¶è€Œè‡ªåŠ¨æ‰§è¡Œï¼šDELETEã€INSERTã€UPDATEã€‚ è§¦å‘å™¨å¿…é¡»æŒ‡å®šåœ¨è¯­å¥æ‰§è¡Œä¹‹å‰è¿˜æ˜¯ä¹‹åŽè‡ªåŠ¨æ‰§è¡Œï¼Œä¹‹å‰æ‰§è¡Œä½¿ç”¨ BEFORE å…³é”®å­—ï¼Œä¹‹åŽæ‰§è¡Œä½¿ç”¨ AFTER å…³é”®å­—ã€‚BEFORE ç”¨äºŽæ•°æ®éªŒè¯å’Œå‡€åŒ–ï¼ŒAFTER ç”¨äºŽå®¡è®¡è·Ÿè¸ªï¼Œå°†ä¿®æ”¹è®°å½•åˆ°å¦å¤–ä¸€å¼ è¡¨ä¸­ã€‚ INSERT è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º NEW çš„è™šæ‹Ÿè¡¨ã€‚ 1234CREATE TRIGGER mytrigger AFTER INSERT ON mytableFOR EACH ROW SELECT NEW.col into @result;SELECT @result; -- èŽ·å–ç»“æžœ DELETE è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„ã€‚ UPDATE è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º NEW å’Œä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œå…¶ä¸­ NEW æ˜¯å¯ä»¥è¢«ä¿®æ”¹åœ°ï¼Œè€Œ OLD æ˜¯åªè¯»çš„ã€‚ MySQL ä¸å…è®¸åœ¨è§¦å‘å™¨ä¸­ä½¿ç”¨ CALL è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚ äºŒåä¸€ã€äº‹åŠ¡å¤„ç† åŸºæœ¬æœ¯è¯­ï¼š äº‹åŠ¡ï¼ˆtransactionï¼‰æŒ‡ä¸€ç»„ SQL è¯­å¥ï¼› å›žé€€ï¼ˆrollbackï¼‰æŒ‡æ’¤é”€æŒ‡å®š SQL è¯­å¥çš„è¿‡ç¨‹ï¼› æäº¤ï¼ˆcommitï¼‰æŒ‡å°†æœªå­˜å‚¨çš„ SQL è¯­å¥ç»“æžœå†™å…¥æ•°æ®åº“è¡¨ï¼› ä¿ç•™ç‚¹ï¼ˆsavepointï¼‰æŒ‡äº‹åŠ¡å¤„ç†ä¸­è®¾ç½®çš„ä¸´æ—¶å ä½ç¬¦ï¼ˆplaceholderï¼‰ï¼Œä½ å¯ä»¥å¯¹å®ƒå‘å¸ƒå›žé€€ï¼ˆä¸Žå›žé€€æ•´ä¸ªäº‹åŠ¡å¤„ç†ä¸åŒï¼‰ã€‚ ä¸èƒ½å›žé€€ SELECT è¯­å¥ï¼Œå›žé€€ SELECT è¯­å¥ä¹Ÿæ²¡æ„ä¹‰ï¼›ä¹Ÿä¸èƒ½å›žé€€ CREATE å’Œ DROP è¯­å¥ã€‚ MySQL çš„äº‹åŠ¡æäº¤é»˜è®¤æ˜¯éšå¼æäº¤ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥å°±æŠŠè¿™æ¡è¯­å¥å½“æˆä¸€ä¸ªäº‹åŠ¡ç„¶åŽè¿›è¡Œæäº¤ã€‚å½“å‡ºçŽ° START TRANSACTION è¯­å¥æ—¶ï¼Œä¼šå…³é—­éšå¼æäº¤ï¼›å½“ COMMIT æˆ– ROLLBACK è¯­å¥æ‰§è¡ŒåŽï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å…³é—­ï¼Œé‡æ–°æ¢å¤éšå¼æäº¤ã€‚ é€šè¿‡è®¾ç½® autocommit ä¸º 0 å¯ä»¥å–æ¶ˆè‡ªåŠ¨æäº¤ï¼Œç›´åˆ° autocommit è¢«è®¾ç½®ä¸º 1 æ‰ä¼šæäº¤ï¼›autocommit æ ‡è®°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿žæŽ¥è€Œä¸æ˜¯é’ˆå¯¹æœåŠ¡å™¨çš„ã€‚ å¦‚æžœæ²¡æœ‰è®¾ç½®ä¿ç•™ç‚¹ï¼ŒROLLBACK ä¼šå›žé€€åˆ° START TRANSACTION è¯­å¥å¤„ï¼›å¦‚æžœè®¾ç½®äº†ä¿ç•™ç‚¹ï¼Œå¹¶ä¸”åœ¨ ROLLBACK ä¸­æŒ‡å®šè¯¥ä¿ç•™ç‚¹ï¼Œåˆ™ä¼šå›žé€€åˆ°è¯¥ä¿ç•™ç‚¹ã€‚ 1234567START TRANSACTION// ...SAVEPOINT delete1// ...ROLLBACK TO delete1// ...COMMIT äºŒåäºŒã€å­—ç¬¦é›† åŸºæœ¬æœ¯è¯­ï¼š å­—ç¬¦é›†ä¸ºå­—æ¯å’Œç¬¦å·çš„é›†åˆï¼› ç¼–ç ä¸ºæŸä¸ªå­—ç¬¦é›†æˆå‘˜çš„å†…éƒ¨è¡¨ç¤ºï¼› æ ¡å¯¹å­—ç¬¦æŒ‡å®šå¦‚ä½•æ¯”è¾ƒï¼Œä¸»è¦ç”¨äºŽæŽ’åºå’Œåˆ†ç»„ã€‚ é™¤äº†ç»™è¡¨æŒ‡å®šå­—ç¬¦é›†å’Œæ ¡å¯¹å¤–ï¼Œä¹Ÿå¯ä»¥ç»™åˆ—æŒ‡å®šï¼š 123CREATE TABLE mytable(col VARCHAR(10) CHARACTER SET latin COLLATE latin1_general_ci )DEFAULT CHARACTER SET hebrew COLLATE hebrew_general_ci; å¯ä»¥åœ¨æŽ’åºã€åˆ†ç»„æ—¶æŒ‡å®šæ ¡å¯¹ï¼š 123SELECT *FROM mytableORDER BY col COLLATE latin1_general_ci; äºŒåä¸‰ã€æƒé™ç®¡ç† MySQL çš„è´¦æˆ·ä¿¡æ¯ä¿å­˜åœ¨ mysql è¿™ä¸ªæ•°æ®åº“ä¸­ã€‚ 12USE mysql;SELECT user FROM user; åˆ›å»ºè´¦æˆ· 1CREATE USER myuser IDENTIFIED BY 'mypassword'; æ–°åˆ›å»ºçš„è´¦æˆ·æ²¡æœ‰ä»»ä½•æƒé™ã€‚ ä¿®æ”¹è´¦æˆ·å 1RENAME myuser TO newuser; åˆ é™¤è´¦æˆ· 1DROP USER myuser; æŸ¥çœ‹æƒé™ 1SHOW GRANTS FOR myuser; æŽˆäºˆæƒé™ 1GRANT SELECT, INSERT ON mydatabase.* TO myuser; è´¦æˆ·ç”¨ username@host çš„å½¢å¼å®šä¹‰ï¼Œusername@% ä½¿ç”¨çš„æ˜¯é»˜è®¤ä¸»æœºåã€‚ åˆ é™¤æƒé™ 1REVOKE SELECT, INSERT ON mydatabase.* FROM myuser; GRANT å’Œ REVOKE å¯åœ¨å‡ ä¸ªå±‚æ¬¡ä¸ŠæŽ§åˆ¶è®¿é—®æƒé™ï¼š æ•´ä¸ªæœåŠ¡å™¨ï¼Œä½¿ç”¨ GRANT ALL å’Œ REVOKE ALLï¼› æ•´ä¸ªæ•°æ®åº“ï¼Œä½¿ç”¨ ON database.\*ï¼› ç‰¹å®šçš„è¡¨ï¼Œä½¿ç”¨ ON database.tableï¼› ç‰¹å®šçš„åˆ—ï¼› ç‰¹å®šçš„å­˜å‚¨è¿‡ç¨‹ã€‚ æ›´æ”¹å¯†ç  å¿…é¡»ä½¿ç”¨ Password() å‡½æ•° 1SET PASSWROD FOR myuser = Password('new_password'); è½¬è‡ªï¼š SQL]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“äº‹åŠ¡æ ¸å¿ƒé—®é¢˜]]></title>
    <url>%2F2019%2F01%2F27%2Fmysql%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»Žäº‹åŠ¡å¼•å‡ºäº†Mysql InnoDB RRéš”ç¦»çº§åˆ«ä¸‹æ˜¯å¦‚ä½•é˜²æ­¢å¹»è¯»çš„ã€‚ 1. æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ æœ€é‡è¦çš„æ˜¯ACIDç‰¹æ€§ã€‚ åŽŸå­æ€§(Atomicity)ï¼šäº‹åŠ¡è¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥ ä¸€è‡´æ€§(Consistency)ï¼šå…³ç³»åž‹æ•°æ®åº“æœ‰å¾ˆå¤šçº¦æŸï¼Œäº‹åŠ¡å‰åŽéƒ½è¦æ»¡è¶³è¿™äº›çº¦æŸ(ä¸ä»…ä»…æ˜¯æ•°æ®åº“ç‰©ç†çº¦æŸï¼Œè¿˜åŒ…æ‹¬å†…éƒ¨é€»è¾‘ä¸Šçš„ä¸€äº›å‡è®¾) éš”ç¦»æ€§(Isolation)ï¼šä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç‹¬ç«‹ï¼Œä¸èƒ½äº’ç›¸å¹²æ‰° æŒä¹…æ€§(Durability)ï¼šäº‹åŠ¡æ‰§è¡ŒæˆåŠŸä¹‹åŽç»“æžœå¯ä»¥æŒä¹…åŒ–ï¼Œæ°¸ä¹…å­˜å‚¨ä¸‹æ¥(redoæ—¥å¿—) å¯¹äºŽä¸€è‡´æ€§ï¼Œå¯èƒ½è§£é‡Šæ¯”è¾ƒæŠ½è±¡ï¼Œä»–çš„å®žé™…å«ä¹‰æ˜¯ï¼šæ•°æ®åº“çš„æ•°æ®åº”æ»¡è¶³å®Œæ•´æ€§çº¦æŸã€‚æ‹¿è½¬è´¦ä¸šåŠ¡æ¥è¯´ï¼Œå‡è®¾ç”¨æˆ·Aå’Œç”¨æˆ·Bä¸€å…±æœ‰2000å—é’±ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´æ— è®ºå¦‚ä½•è½¬è´¦ï¼Œæ€»å…±çš„é’±åº”è¯¥éƒ½æ˜¯2000. 2. äº‹åŠ¡å¹¶å‘è®¿é—®å¼•èµ·çš„é—®é¢˜ æ›´æ–°ä¸¢å¤±-mysqlæ‰€æœ‰äº‹åŠ¡éš”ç¦»çº§åˆ«åœ¨æ•°æ®åº“å±‚é¢å‡å¯é¿å… å–æ¬¾äº‹åŠ¡ å­˜æ¬¾äº‹åŠ¡ å¼€å§‹äº‹åŠ¡ å¼€å§‹äº‹åŠ¡ æŸ¥è¯¢ä½™é¢ä¸º100å…ƒ æ—  æ—  æŸ¥è¯¢ä½™é¢ä¸º100å…ƒ æ—  å­˜å…¥20ï¼Œä½™é¢å˜ä¸º120å…ƒ æ—  æäº¤äº‹åŠ¡ å–å‡º10å…ƒï¼Œä½™é¢æ”¹ä¸º90å…ƒ æ—  å›žæ»šäº‹åŠ¡ï¼Œä½™é¢æ¢å¤ä¸º100å…ƒ æ›´æ–°ä¸¢å¤± è„è¯»é—®é¢˜-ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ® ä¸å¯é‡å¤è¯»-äº‹åŠ¡Aå¤šæ¬¡è¯»å–æ•°æ®ï¼Œæœªæäº¤æ•°æ®ï¼Œæ­¤æ—¶äº‹åŠ¡Bæäº¤æ–°çš„æ•°æ®ï¼Œå¯¼è‡´Aå¤šæ¬¡è¯»å–æ•°æ®æœŸé—´æ•°æ®ä¸ä¸€è‡´ï¼Œä¸æ»¡è¶³éš”ç¦»æ€§ å¹»è¯»-äº‹åŠ¡Aå—åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥æ–°çš„ä¸€è¡Œæˆ–è€…åˆ é™¤ä¸€è¡Œçš„å½±å“ï¼Œå¯¼è‡´å¹»è§‰ ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹: åŒæ ·çš„æ¡ä»¶çš„select, ä½ è¯»å–è¿‡çš„æ•°æ®, å†æ¬¡è¯»å–å‡ºæ¥å‘çŽ°å€¼ä¸ä¸€æ ·äº† å¹»è¯»çš„é‡ç‚¹åœ¨äºŽæ–°å¢žæˆ–è€…åˆ é™¤: åŒæ ·çš„æ¡ä»¶çš„select, ç¬¬1æ¬¡å’Œç¬¬2æ¬¡è¯»å‡ºæ¥çš„è®°å½•æ•°ä¸ä¸€æ · å…·ä½“å¯ä»¥è‡ªå·±è®¾ç½®ä¸åŒçš„éš”ç¦»çº§åˆ«è¿›è¡Œæ¼”ç¤ºã€‚ 3. äº‹åŠ¡çš„éš”ç¦»çº§åˆ« Read uncommittedï¼šè¯»åˆ°å…¶ä»–äº‹åŠ¡æœªcommitçš„å€¼ Read committedï¼šè§£å†³äº†è„è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¼šè¯»åˆ°å…¶ä»–äº‹åŠ¡commitçš„å€¼ï¼Œè¯»ä¸¤æ¬¡å¯èƒ½ä¼šè¯»åˆ°ä¸¤ä¸ªå€¼ï¼Œæ‰€ä»¥åˆå«ä¸å¯é‡å¤è¯» Repeatable Readï¼šè§£å†³äº†ä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œå¯é‡å¤è¯»ï¼Œåˆ«äººcommitå¯¹æˆ‘æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯å¯¹äºŽåˆ«çš„äº‹åŠ¡æ’å…¥æ“ä½œï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¹»è¯» Serializableï¼šä¸²è¡ŒåŒ–ï¼Œå½“å‘ç”Ÿä¸¤ä¸ªäº‹åŠ¡åŒæ—¶æäº¤ï¼Œç»“æžœåªå¯èƒ½æœ‰ä¸€ä¸ªï¼Œç›¸å½“äºŽä¸²è¡Œæ‰§è¡ŒåŽçš„æŸä¸ªç»“æžœ çº§åˆ«è¶Šæ¥è¶Šé«˜ï¼Œå®‰å…¨æ€§ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œä½†æ˜¯ä½†æ˜¯æ€§èƒ½è¶Šæ¥è¶Šä½Žã€‚è¯´æ˜Žä¸€ä¸‹ï¼Œå‡ºçŽ°å¹»è¯»åªæ˜¯é’ˆå¯¹è¿™ç§Repeatable Readéš”ç¦»çº§åˆ«ï¼Œä½†æ˜¯InnoDBå·²ç»ä¸å­˜åœ¨å¹»è¯»é—®é¢˜äº†ï¼Œå¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿä¸»è¦æ˜¯ç”¨next-keyé”æ¥è§£å†³ï¼Œä¸‹æ–‡ä¼šè®²åˆ°ã€‚ 4. å½“å‰è¯»å’Œå¿«ç…§è¯» 4.1 å½“å‰è¯» è¯»å–çš„éƒ½æ˜¯å½“å‰æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨è¯»çš„æ—¶å€™å¯¹å…¶åŠ é”ï¼Œä¸å…è®¸å…¶ä»–äº‹åŠ¡è¿›è¡Œä¿®æ”¹æ“ä½œã€‚ select ... lock in share modeï¼ˆå…±äº«é”ï¼‰ä»¥åŠ select ... for updateã€updateã€deleteã€insertï¼ˆæŽ’ä»–é”ï¼‰è¿™äº›æ“ä½œéƒ½æ˜¯å½“å‰è¯»ã€‚ ä¸ºä»€ä¹ˆå°† æ’å…¥/æ›´æ–°/åˆ é™¤ æ“ä½œï¼Œéƒ½å½’ä¸ºå½“å‰è¯»ï¼Ÿå¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ª æ›´æ–° æ“ä½œï¼Œåœ¨æ•°æ®åº“ä¸­çš„æ‰§è¡Œæµç¨‹ï¼š ä»Žå›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªUpdateæ“ä½œçš„å…·ä½“æµç¨‹ã€‚å½“Update SQLè¢«å‘ç»™MySQLåŽï¼ŒMySQL Serverä¼šæ ¹æ®whereæ¡ä»¶ï¼Œå‘å‡ºcurrent read è¯»å–ç¬¬ä¸€æ¡æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œç„¶åŽInnoDBå¼•æ“Žä¼šå°†ç¬¬ä¸€æ¡è®°å½•è¿”å›žï¼Œå¹¶åŠ é” (current read)ã€‚ å¾…MySQL Serveræ”¶åˆ°è¿™æ¡åŠ é”çš„è®°å½•ä¹‹åŽï¼Œä¼šå†å‘èµ·ä¸€ä¸ªUpdateè¯·æ±‚ï¼Œæ›´æ–°è¿™æ¡è®°å½•ã€‚ ä¸€æ¡è®°å½•æ“ä½œå®Œæˆï¼Œå†è¯»å–ä¸‹ä¸€æ¡è®°å½•ï¼Œç›´è‡³æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒUpdateæ“ä½œå†…éƒ¨ï¼Œå°±åŒ…å«äº†ä¸€ä¸ªå½“å‰è¯»ã€‚ 4.2 å¿«ç…§è¯» ä¸åŠ é”çš„éžé˜»å¡žè¯»ï¼Œç®€å•çš„selectï¼ˆå‰ææ˜¯äº‹åŠ¡çº§åˆ«ä¸æ˜¯serializableï¼Œå› ä¸ºåœ¨serializableçº§åˆ«ä¸‹éƒ½æ˜¯ä¸²è¡Œè¯»ï¼Œæ™®é€šçš„selectä¹Ÿä¼šé€€åŒ–ä¸ºå½“å‰è¯»å³select ... lock in share modeï¼‰ å¿«ç…§è¯»çš„å®žçŽ°æ˜¯åŸºäºŽå¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ï¼ˆMVCCï¼‰å®žçŽ°ï¼Œæ—¨åœ¨æé«˜æ€§èƒ½ã€‚æœ‰å¯èƒ½è¯»åˆ°çš„ä¸æ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ã€‚ï¼ˆåˆ›å»ºå¿«ç…§çš„æ—¶æœºå†³å®šäº†è¯»åˆ°çš„æ•°æ®çš„ç‰ˆæœ¬ï¼Œå¦‚æžœäº‹åŠ¡Aå…ˆå¿«ç…§è¯»ï¼Œäº‹åŠ¡Bä¿®æ”¹ï¼Œé‚£ä¹ˆäº‹åŠ¡Aå†å¿«ç…§è¯»å°±è¿˜æ˜¯æ›´æ–°å‰çš„ç‰ˆæœ¬ï¼Œäº‹åŠ¡Açš„å½“å‰è¯»ä¼šè¯»åˆ°æœ€æ–°çš„æ•°æ®ï¼›è€Œå½“äº‹åŠ¡Bå…ˆæ›´æ–°ï¼Œäº‹åŠ¡Aå†å¿«ç…§è¯»ï¼Œå°±ä¼šè¯»åˆ°æ•°æ®æœ€æ–°ç‰ˆæœ¬äº†ï¼‰ 4.3 MVCC MVCCåœ¨MySQLçš„InnoDBä¸­çš„å®žçŽ° åœ¨InnoDBä¸­ï¼Œä¼šåœ¨æ¯è¡Œæ•°æ®åŽæ·»åŠ ä¸¤ä¸ªé¢å¤–çš„éšè—çš„å€¼æ¥å®žçŽ°MVCCï¼Œè¿™ä¸¤ä¸ªå€¼ä¸€ä¸ªè®°å½•è¿™è¡Œæ•°æ®ä½•æ—¶è¢«åˆ›å»ºï¼Œå¦å¤–ä¸€ä¸ªè®°å½•è¿™è¡Œæ•°æ®ä½•æ—¶è¿‡æœŸï¼ˆæˆ–è€…è¢«åˆ é™¤ï¼‰ã€‚ åœ¨å®žé™…æ“ä½œä¸­ï¼Œå­˜å‚¨çš„å¹¶ä¸æ˜¯æ—¶é—´ï¼Œè€Œæ˜¯äº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œæ¯å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œäº‹åŠ¡çš„ç‰ˆæœ¬å·å°±ä¼šé€’å¢žã€‚ åœ¨å¯é‡è¯»Repeatable readsäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼š SELECTæ—¶ï¼Œè¯»å–åˆ›å»ºç‰ˆæœ¬å·&lt;=å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œåˆ é™¤ç‰ˆæœ¬å·ä¸ºç©ºæˆ–&gt;å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ã€‚ INSERTæ—¶ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œçš„åˆ›å»ºç‰ˆæœ¬å· DELETEæ—¶ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œçš„åˆ é™¤ç‰ˆæœ¬å· UPDATEæ—¶ï¼Œæ’å…¥ä¸€æ¡æ–°çºªå½•ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œåˆ›å»ºç‰ˆæœ¬å·ï¼ŒåŒæ—¶ä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·åˆ°åŽŸæ¥åˆ é™¤çš„è¡Œ é€šè¿‡MVCCï¼Œè™½ç„¶æ¯è¡Œè®°å½•éƒ½éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œæ›´å¤šçš„è¡Œæ£€æŸ¥å·¥ä½œä»¥åŠä¸€äº›é¢å¤–çš„ç»´æŠ¤å·¥ä½œï¼Œä½†å¯ä»¥å‡å°‘é”çš„ä½¿ç”¨ï¼Œå¤§å¤šæ•°è¯»æ“ä½œéƒ½ä¸ç”¨åŠ é”ï¼Œè¯»æ•°æ®æ“ä½œå¾ˆç®€å•ï¼Œæ€§èƒ½å¾ˆå¥½ï¼Œå¹¶ä¸”ä¹Ÿèƒ½ä¿è¯åªä¼šè¯»å–åˆ°ç¬¦åˆæ ‡å‡†çš„è¡Œï¼Œä¹Ÿåªé”ä½å¿…è¦è¡Œã€‚ è¯´ç™½äº†ï¼Œå°±æ˜¯ä¹è§‚é”çš„ä¸€ç§å®žçŽ°ã€‚å…åŽ»äº†åŠ é”è§£é”çš„è¿‡ç¨‹ï¼Œå¯¹äºŽè¯»å¤šå†™å°‘çš„åœºæ™¯ç‰¹åˆ«é€‚ç”¨ã€‚ 5. RCï¼ŒRRçº§åˆ«ä¸‹çš„InnoDBéžé˜»å¡žè¯»ï¼ˆå¿«ç…§è¯»ï¼‰å¦‚ä½•å®žçŽ° é€šè¿‡æ•°æ®è¡Œé‡Œçš„DB_TRX_IDã€DB_ROLL_PTRã€DB_ROW_IDè¿™ä¸‰ä¸ªå­—æ®µ DB_TRX_IDï¼Œæœ€åŽä¸€æ¬¡ä¿®æ”¹æœ¬è¡Œäº‹åŠ¡çš„ID DB_ROLL_PTRï¼Œå³å›žæ»šæŒ‡é’ˆ,ä¸Žundoæ—¥å¿—é…åˆ DB_ROW_IDï¼Œéšç€æ–°è¡Œæ’å…¥è€Œå•è°ƒé€’å¢žçš„è¡Œå·ï¼ˆinnoDBä¸­å¦‚æžœæ—¢æ²¡æœ‰ä¸»é”®ç´¢å¼•ä¹Ÿæ²¡æœ‰å”¯ä¸€ç´¢å¼•çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšè—ä¸»é”®ï¼Œå°±æ˜¯è¿™ä¸ªçŽ©æ„ï¼‰ è¿™ä¸‰ä¸ªå­—æ®µç»“åˆundoæ—¥å¿—ï¼Œè¿™ä¸ªæ—¥å¿—é‡Œé¢è®°å½•çš„éƒ½æ˜¯è€ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¿™æ ·ï¼Œå¿«ç…§è¯»å°±å¯ä»¥è¯»å‡ºé€‚åˆçš„ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®å‡ºæ¥ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œæ—¥å¿—æ˜¯éžå¸¸é‡è¦çš„ä¸œè¥¿ï¼Œå¯ä»¥è¯´å…¶é‡è¦æ€§æ˜¯å¤§äºŽæ•°æ®æœ¬èº«çš„ï¼Œå› ä¸ºæ•°æ®ä¸¢å¤±å¯ä»¥é€šè¿‡æ—¥å¿—æ‰¾å›žæ¥ï¼Œä½†æ˜¯æ—¥å¿—ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆä»¥åŽæ•°æ®åº“å‡ºçŽ°å´©æºƒç­‰å°±éº»çƒ¦äº†ã€‚ 6. æ—¥å¿— æ•°æ®åº“æ•°æ®å­˜æ”¾çš„æ–‡ä»¶ç§°ä¸ºdata fileï¼›æ—¥å¿—æ–‡ä»¶ç§°ä¸ºlog fileï¼›æ•°æ®åº“æ•°æ®æ˜¯æœ‰ç¼“å­˜çš„ï¼Œå¦‚æžœæ²¡æœ‰ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½å†™æˆ–è€…è¯»ç‰©ç†diskï¼Œé‚£æ€§èƒ½å°±å¤ªä½Žä¸‹äº†ã€‚æ•°æ®åº“æ•°æ®çš„ç¼“å­˜ç§°ä¸ºdata bufferï¼Œæ—¥å¿—ï¼ˆredoï¼‰ç¼“å­˜ç§°ä¸ºlog bufferï¼›æ—¢ç„¶æ•°æ®åº“æ•°æ®æœ‰ç¼“å­˜ï¼Œå°±å¾ˆéš¾ä¿è¯ç¼“å­˜æ•°æ®ï¼ˆè„æ•°æ®ï¼‰ä¸Žç£ç›˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚æ¯”å¦‚æŸæ¬¡æ•°æ®åº“æ“ä½œï¼š 1update driver_info set driver_status = 2 where driver_id = 10001; æ›´æ–°driver_statuså­—æ®µçš„æ•°æ®ä¼šå­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œç­‰å¾…å­˜å‚¨å¼•æ“Žå°†driver_statusåˆ·æ–°data_fileï¼Œå¹¶è¿”å›žç»™ä¸šåŠ¡æ–¹æ›´æ–°æˆåŠŸã€‚å¦‚æžœæ­¤æ—¶æ•°æ®åº“å®•æœºï¼Œç¼“å­˜ä¸­çš„æ•°æ®å°±ä¸¢å¤±äº†ï¼Œä¸šåŠ¡æ–¹å´ä»¥ä¸ºæ›´æ–°æˆåŠŸäº†ï¼Œæ•°æ®ä¸ä¸€è‡´ï¼Œä¹Ÿæ²¡æœ‰æŒä¹…åŒ–å­˜å‚¨ã€‚ ä¸Šé¢çš„é—®é¢˜å°±å¯ä»¥é€šè¿‡äº‹åŠ¡çš„ACIDç‰¹æ€§æ¥ä¿è¯ã€‚ 12345BEGIN transï¼›update driver_info set driver_status = 2 where driver_id = 10001;COMMIT; è¿™æ ·æ‰§è¡ŒåŽï¼Œæ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚ä¸šåŠ¡æ–¹çš„è¿”å›žå’Œæ•°æ®åº“data fileä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚è¦ä¿è¯è¿™æ ·çš„ç‰¹æ€§è¿™å°±ä¸å¾—ä¸è¯´å­˜å‚¨å¼•æ“Žinnodbçš„redoå’Œundoæ—¥å¿—ã€‚ 6.1 undoæ˜¯å•¥ undoæ—¥å¿—ç”¨äºŽå­˜æ”¾æ•°æ®ä¿®æ”¹è¢«ä¿®æ”¹å‰çš„å€¼ï¼Œå‡è®¾ä¿®æ”¹ tba è¡¨ä¸­ id=2çš„è¡Œæ•°æ®ï¼ŒæŠŠName=â€˜Bâ€™ ä¿®æ”¹ä¸ºName = â€˜B2â€™ ï¼Œé‚£ä¹ˆundoæ—¥å¿—å°±ä¼šç”¨æ¥å­˜æ”¾Name='Bâ€™çš„è®°å½•ï¼Œå¦‚æžœè¿™ä¸ªä¿®æ”¹å‡ºçŽ°å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨undoæ—¥å¿—æ¥å®žçŽ°å›žæ»šæ“ä½œï¼Œä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚ å¯¹æ•°æ®çš„å˜æ›´æ“ä½œï¼Œä¸»è¦æ¥è‡ª INSERT UPDATE DELETEï¼Œè€ŒUNDO LOGä¸­åˆ†ä¸ºä¸¤ç§ç±»åž‹ï¼Œä¸€ç§æ˜¯ INSERT_UNDOï¼ˆINSERTæ“ä½œï¼Œäº‹åŠ¡æäº¤åŽå¯ä»¥ç«‹å³ä¸¢å¼ƒï¼‰ï¼Œè®°å½•æ’å…¥çš„å”¯ä¸€é”®å€¼ï¼›ä¸€ç§æ˜¯ UPDATE_UNDOï¼ˆåŒ…å«UPDATEåŠDELETEæ“ä½œï¼‰ï¼Œè®°å½•ä¿®æ”¹çš„å”¯ä¸€é”®å€¼ä»¥åŠold columnè®°å½•ã€‚ 6.2 redoæ˜¯å•¥ å­˜å‚¨å¼•æ“Žä¹Ÿä¼šä¸ºredo undoæ—¥å¿—å¼€è¾Ÿå†…å­˜ç¼“å­˜ç©ºé—´ï¼Œlog bufferã€‚ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶ç§°ä¸ºlog fileï¼Œæ˜¯é¡ºåºè¿½åŠ çš„ï¼Œæ€§èƒ½éžå¸¸é«˜ï¼Œæ³¨ï¼šç£ç›˜çš„é¡ºåºå†™æ€§èƒ½æ¯”å†…å­˜çš„å†™æ€§èƒ½å·®ä¸äº†å¤šå°‘ã€‚ redoæ—¥å¿—è®°å½•äº‹åŠ¡æ‰§è¡ŒåŽçš„çŠ¶æ€ï¼Œç”¨æ¥æ¢å¤æœªå†™å…¥data fileçš„å·²æˆåŠŸäº‹åŠ¡æ›´æ–°çš„æ•°æ®ã€‚ä¾‹å¦‚æŸä¸€äº‹åŠ¡çš„äº‹åŠ¡åºå·ä¸ºT1ï¼Œå…¶å¯¹æ•°æ®Xè¿›è¡Œä¿®æ”¹ï¼Œè®¾Xçš„åŽŸå€¼æ˜¯5ï¼Œä¿®æ”¹åŽçš„å€¼ä¸º15ï¼Œé‚£ä¹ˆUndoæ—¥å¿—ä¸º&lt;T1, X, 5&gt;ï¼ŒRedoæ—¥å¿—ä¸º&lt;T1, X, 15&gt;ã€‚ æ¢³ç†ä¸‹äº‹åŠ¡æ‰§è¡Œçš„å„ä¸ªé˜¶æ®µï¼š å†™undoæ—¥å¿—åˆ°log bufferï¼› æ‰§è¡Œäº‹åŠ¡ï¼Œå¹¶å†™redoæ—¥å¿—åˆ°log bufferï¼› å¦‚æžœinnodb_flush_log_at_trx_commit=1ï¼Œåˆ™å°†redoæ—¥å¿—å†™åˆ°log fileï¼Œå¹¶åˆ·æ–°è½ç›˜ã€‚ æäº¤äº‹åŠ¡ã€‚ é‚£redoæ—¥å¿—æ˜¯å†™è¿›åŽ»äº†ï¼Œä½†æ˜¯æ•°æ®å‘¢ï¼Ÿ åœ¨æ•°æ®åº“çš„ä¸–ç•Œé‡Œï¼Œæ•°æ®ä»Žæ¥éƒ½ä¸é‡è¦ï¼Œæ—¥å¿—æ‰æ˜¯æœ€é‡è¦çš„ï¼Œæœ‰äº†æ—¥å¿—å°±æœ‰äº†ä¸€åˆ‡ã€‚ å› ä¸ºdata bufferä¸­çš„æ•°æ®ä¼šåœ¨åˆé€‚çš„æ—¶é—´ ç”±å­˜å‚¨å¼•æ“Žå†™å…¥åˆ°data fileï¼Œå¦‚æžœåœ¨å†™å…¥ä¹‹å‰ï¼Œæ•°æ®åº“å®•æœºäº†ï¼Œæ ¹æ®è½ç›˜çš„redoæ—¥å¿—ï¼Œå®Œå…¨å¯ä»¥å°†äº‹åŠ¡æ›´æ”¹çš„æ•°æ®æ¢å¤ã€‚å¥½äº†ï¼Œçœ‹å‡ºæ—¥å¿—çš„é‡è¦æ€§äº†å§ã€‚å…ˆæŒä¹…åŒ–æ—¥å¿—çš„ç­–ç•¥å«åšWrite Ahead Logï¼Œå³é¢„å†™æ—¥å¿—ã€‚ 6.3 Undo + Redoäº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹ å‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®ï¼Œå€¼åˆ†åˆ«ä¸º1,2ï¼Œå¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡çš„æ“ä½œå†…å®¹ä¸ºï¼šæŠŠ1ä¿®æ”¹ä¸º3ï¼Œ2ä¿®æ”¹ä¸º4ï¼Œé‚£ä¹ˆå®žé™…çš„è®°å½•å¦‚ä¸‹ï¼ˆç®€åŒ–ï¼‰ï¼š äº‹åŠ¡å¼€å§‹. è®°å½•A=1åˆ°undo log buffer. ä¿®æ”¹A=3. è®°å½•A=3åˆ°redo log buffer. è®°å½•B=2åˆ°undo log buffer. ä¿®æ”¹B=4. è®°å½•B=4åˆ°redo log buffer. å°†redo logå†™å…¥ç£ç›˜ã€‚ äº‹åŠ¡æäº¤ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ2ï¼Œ4ï¼Œ5ï¼Œ7ï¼Œ8éƒ½æ˜¯æ–°å¢žæ“ä½œï¼Œä½†æ˜¯2ï¼Œ4ï¼Œ5ï¼Œ7éƒ½æ˜¯ç¼“å†²åˆ°bufferåŒºï¼Œåªæœ‰8æ˜¯ç£ç›˜IOæ“ä½œã€‚ä¸ºäº†ä¿è¯Redo Logæœ‰è¾ƒå¥½çš„IOæ€§èƒ½ï¼Œè®¾è®¡ä¸€èˆ¬æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å°½é‡ä¿æŒRedo Logå­˜å‚¨åœ¨ä¸€æ®µè¿žç»­çš„ç©ºé—´ä¸Šã€‚å› æ­¤åœ¨ç³»ç»Ÿç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶å°±ä¼šå°†æ—¥å¿—æ–‡ä»¶çš„ç©ºé—´å®Œå…¨åˆ†é…ã€‚ ä»¥é¡ºåºè¿½åŠ çš„æ–¹å¼è®°å½•Redo Log,é€šè¿‡é¡ºåºIOæ¥æ”¹å–„æ€§èƒ½ã€‚ æ‰¹é‡å†™å…¥æ—¥å¿—ã€‚æ—¥å¿—å¹¶ä¸æ˜¯ç›´æŽ¥å†™å…¥æ–‡ä»¶ï¼Œè€Œæ˜¯å…ˆå†™å…¥redo log buffer.å½“éœ€è¦å°†æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜æ—¶ (å¦‚äº‹åŠ¡æäº¤),å°†è®¸å¤šæ—¥å¿—ä¸€èµ·å†™å…¥ç£ç›˜. å¹¶å‘çš„äº‹åŠ¡å…±äº«Redo Logçš„å­˜å‚¨ç©ºé—´ï¼Œå®ƒä»¬çš„Redo LogæŒ‰è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œä¾æ¬¡äº¤æ›¿çš„è®°å½•åœ¨ä¸€èµ·ï¼Œ ä»¥å‡å°‘æ—¥å¿—å ç”¨çš„ç©ºé—´ã€‚ä¾‹å¦‚,Redo Logä¸­çš„è®°å½•å†…å®¹å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š è®°å½•1: &lt;trx1, insert â€¦&gt; è®°å½•2: &lt;trx2, update â€¦&gt; è®°å½•3: &lt;trx1, delete â€¦&gt; è®°å½•4: &lt;trx3, update â€¦&gt; è®°å½•5: &lt;trx2, insert â€¦&gt; å› ä¸ºä¸Šä¸€æ¡çš„åŽŸå› ,å½“ä¸€ä¸ªäº‹åŠ¡å°†Redo Logå†™å…¥ç£ç›˜æ—¶ï¼Œä¹Ÿä¼šå°†å…¶ä»–æœªæäº¤çš„äº‹åŠ¡çš„æ—¥å¿—å†™å…¥ç£ç›˜ Redo Logä¸Šåªè¿›è¡Œé¡ºåºè¿½åŠ çš„æ“ä½œï¼Œå½“ä¸€ä¸ªäº‹åŠ¡éœ€è¦å›žæ»šæ—¶ï¼Œå®ƒçš„Redo Logè®°å½•ä¹Ÿä¸ä¼šä»ŽRedo Logä¸­åˆ é™¤æŽ‰ã€‚ 6.4 å›žæ»š å‰é¢è¯´åˆ°æœªæäº¤çš„äº‹åŠ¡å’Œå›žæ»šäº†çš„äº‹åŠ¡ä¹Ÿä¼šè®°å½•Redo Logï¼Œå› æ­¤åœ¨è¿›è¡Œæ¢å¤æ—¶,è¿™äº›äº‹åŠ¡è¦è¿›è¡Œç‰¹æ®Šçš„çš„å¤„ç†ã€‚æœ‰2ç§ä¸åŒçš„æ¢å¤ç­–ç•¥ï¼š è¿›è¡Œæ¢å¤æ—¶ï¼Œåªé‡åšå·²ç»æäº¤äº†çš„äº‹åŠ¡ã€‚ è¿›è¡Œæ¢å¤æ—¶ï¼Œé‡åšæ‰€æœ‰äº‹åŠ¡åŒ…æ‹¬æœªæäº¤çš„äº‹åŠ¡å’Œå›žæ»šäº†çš„äº‹åŠ¡ã€‚ç„¶åŽé€šè¿‡Undo Logå›žæ»šé‚£äº›æœªæäº¤çš„äº‹åŠ¡ã€‚ MySQLæ•°æ®åº“InnoDBå­˜å‚¨å¼•æ“Žä½¿ç”¨äº†ç¬¬äºŒä¸ªç­–ç•¥ã€‚ InnoDBå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯» è¡¨è±¡åŽŸå› :å¿«ç…§è¯»ï¼ˆéžé˜»å¡žè¯»ï¼‰â€“ä¼ªMVCC å†…åœ¨åŽŸå› ï¼šnext-keyé”ï¼ˆè¡Œé”+gapé”ï¼‰ 6.5 next-keyé” åœ¨ RR çº§åˆ«ä¸‹ï¼Œå¦‚æžœæŸ¥è¯¢æ¡ä»¶èƒ½ä½¿ç”¨ä¸Šå”¯ä¸€ç´¢å¼•ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æŸ¥è¯¢æ¡ä»¶ï¼Œé‚£ä¹ˆä»…åŠ è¡Œé”ï¼Œå¦‚æžœæ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œé‚£ä¹ˆå°±ä¼šç»™è¿™ä¸ªèŒƒå›´åŠ ä¸Š gap é”æˆ–è€… next-keyé” (è¡Œé”+gapé”)ã€‚ é‚£ä¹ˆgapé”å•¥æ—¶å€™å‡ºçŽ°å‘¢ï¼Ÿ ä½¿ç”¨ä¸»é”®ç´¢å¼•æˆ–è€…å”¯ä¸€ç´¢å¼•æ—¶ï¼š å¦‚æžœwhereæ¡ä»¶å…¨éƒ¨å‘½ä¸­ï¼Œåˆ™ä¸ä¼šç”¨Gapé”ï¼Œåªä¼šåŠ è®°å½•é” å¦‚æžœwhereæ¡ä»¶éƒ¨åˆ†å‘½ä¸­æˆ–è€…å…¨ä¸å‘½ä¸­ï¼Œåˆ™ä¼šåŠ Gapé” åœ¨èµ°éžå”¯ä¸€ç´¢å¼•æˆ–è€…ä¸èµ°ç´¢å¼•çš„å½“å‰è¯»ä¸­ï¼Œä¹Ÿä¼šå‡ºçŽ°Gapé”ã€‚å¯¹äºŽä¸èµ°ç´¢å¼•çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±ä¼šé”ä½æ•´å¼ è¡¨ã€‚ æ€»ç»“ä¸€ä¸‹ï¼šåªæœ‰å¯¹å”¯ä¸€ç´¢å¼•+å…¨éƒ¨å‘½ä¸­æ‰ä¸ä¼šåŠ gapé”ã€‚ å…·ä½“æ¥ä¸ªä¾‹å­è¯´æ˜Žé—´éš™é”å¦‚ä½•å·¥ä½œã€‚ 7. ä¾‹å­-èµ°å”¯ä¸€ç´¢å¼• 7.1 å‡†å¤‡å·¥ä½œ æœ‰è¿™æ ·ä¸€ä¸ªè¡¨testï¼Œå…¶ä¸­nameä¸ºä¸»é”®ï¼Œidä¸ºå”¯ä¸€é”®ã€‚ 123456CREATE TABLE `test` ( `name` varchar(11) primary key, `id` int, unique KEY `id` (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into test(name,id) values ("f",1), ("h",2), ("b",3), ("a",5), ("c",6),("d",9); name id f 1 h 2 b 3 a 5 c 6 d 9 é¦–å…ˆéªŒè¯ä¸€ä¸‹ä½¿ç”¨ä¸»é”®ç´¢å¼•æˆ–è€…å”¯ä¸€ç´¢å¼•æ—¶ä¼šæ€Žä¹ˆæ ·ã€‚ 7.2 ç¬¬ä¸€ç§æƒ…å†µï¼šå”¯ä¸€ç´¢å¼•+å‘½ä¸­æ‰€æœ‰æ•°æ® session1æ‰§è¡Œ 1delete from test where id = 3; session2æ‰§è¡Œï¼š 1insert into test(name,id) values("swg",4); æ­¤æ—¶ç”±äºŽidæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¹¶ä¸”æ˜¯å‘½ä¸­çš„ï¼Œæ‰€ä»¥åªæ˜¯å¯¹è¿™ä¸€è¡ŒåŠ æŽ’ä»–é”ï¼Œè€Œæ²¡æœ‰åŠ gapé”ï¼Œæ‰€ä»¥session2æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ï¼Œä¸èƒ½è¢«é˜»å¡žã€‚ 7.3 ç¬¬ä¸€ç§æƒ…å†µï¼šå”¯ä¸€ç´¢å¼•+ä¸å‘½ä¸­æ•°æ® session1æ‰§è¡Œ 1delete from test where id = 7; session2æ‰§è¡Œï¼š 1insert into test(name,id) values("swg",8); æ­¤æ—¶session2ä¼šé˜»å¡žä½ï¼Œè¯æ˜Žid=7å‘¨å›´åŠ äº†gapé”ã€‚gapé”çš„èŒƒå›´éµä»Žå·¦å¼€å³é—­çš„åŽŸåˆ™ï¼Œè¿™é‡Œå°±æ˜¯(6,7ï¼‰ä»¥åŠ(7,9)éƒ½ä¼šè¢«é”ä½ã€‚åŠ ä¸Šrecordé”ç»„æˆnext-keyé”ï¼Œæ‰€ä»¥next-keyé”çš„èŒƒå›´æ˜¯(6,7]ä»¥åŠ(7,9]è¿™ä¸ªèŒƒå›´ã€‚ 7.4 ç¬¬ä¸‰ç§æƒ…å†µï¼šå”¯ä¸€ç´¢å¼•+ä¸å‘½ä¸­æ‰€æœ‰æ•°æ® session1æ‰§è¡Œ 1select * from test where id in (5,7,9) lock in share mode; è¿™é‡Œæ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œ5å’Œ9éƒ½æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯7ä¸å­˜åœ¨ï¼Œå³éƒ¨åˆ†æ•°æ®ä¸å­˜åœ¨ã€‚ session2æ‰§è¡Œï¼š 1234567insert into test(name,id) values("swg",4);&lt;!--å¯ä»¥--&gt;insert into test(name,id) values("swg",7);&lt;!--ä¸å¯ä»¥--&gt;insert into test(name,id) values("swg",8);&lt;!--ä¸å¯ä»¥--&gt;insert into test(name,id) values("swg",10);&lt;!--å¯ä»¥--&gt; é‚£ä¹ˆå¯¹äºŽ(5,9]çš„èŒƒå›´å†…å°±é˜»å¡žä½äº†ï¼Œé‚£ä¹ˆéƒ¨åˆ†å‘½ä¸­å°±æ˜¯éƒ¨åˆ†åŠ gapé”ã€‚ 7.5 ç¬¬å››ç§æƒ…å†µï¼šå”¯ä¸€ç´¢å¼•+å‘½ä¸­æ‰€æœ‰æ•°æ® session1æ‰§è¡Œ 1select * from test where id in (5,6,9) lock in share mode; è¿™é‡Œå…¨éƒ¨å‘½ä¸­ï¼Œé‚£ä¹ˆ session2æ‰§è¡Œï¼š 123insert into test(name,id) values("swg",7);&lt;!--å¯ä»¥--&gt;insert into test(name,id) values("swg",8);&lt;!--å¯ä»¥--&gt; è¿™ä¸ªæ—¶å€™å°±ä¸ä¼šåŠ gapé”äº†ã€‚ 8. ä¾‹å­-ä¸èµ°å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸èµ°ç´¢å¼• ä¸‹é¢æ¥çœ‹çœ‹ä¸èµ°éžå”¯ä¸€ç´¢å¼•çš„å½“å‰è¯»æ˜¯ä»€ä¹ˆæƒ…å†µã€‚ æ­¤æ—¶è¡¨çš„æ•°æ®ä¸ºï¼š name id h 2 c 6 b 9 d 9 f 11 a 15 æŠŠidä¸Šçš„å”¯ä¸€ç´¢å¼•æ¢æˆäº†æ™®é€šç´¢å¼•ã€‚ 8.1 ç¬¬äº”ç§æƒ…å†µï¼šéžå”¯ä¸€ç´¢å¼• session1æ‰§è¡Œ 1delete from test where id = 9; session2æ‰§è¡Œï¼š 1insert into test(name,id) values("swg",9); æ­¤æ—¶session2æ˜¯ä¼šè¢«blockä½çš„ã€‚gapçš„èŒƒå›´æ˜¯(6,9]ä»¥åŠ(9,11]. 12345insert into test(name,id) values("swg",5);&lt;!--å¯ä»¥--&gt;insert into test(name,id) values("swg",7);&lt;!--ä¸å¯ä»¥--&gt;insert into test(name,id) values("swg",12);&lt;!--å¯ä»¥--&gt; ä¸Šé¢çš„åŽŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³åªè¦æ˜¯6å’Œ11ä¹‹é—´çš„æ•°ï¼Œä¸åŒ…å«ä¸´ç•Œå€¼çš„æ—¶å€™ï¼Œæ— è®ºæ’å…¥ä»€ä¹ˆæ•°æ®ï¼Œéƒ½æ˜¯ä¼šé˜»å¡žçš„ã€‚ ä½†æ˜¯å…³äºŽä¸´ç•Œå€¼6å’Œ11ï¼Œè¿™é‡Œå°±æ¯”è¾ƒç‰¹æ®Šäº†ï¼Œå› ä¸ºéœ€è¦åŠ ä¸Šä¸»é”®çš„å€¼æ‰èƒ½è¿›è¡Œç²¾å‡†çš„åˆ¤æ–­ã€‚ 123insert into test(name,id) values(&quot;bb&quot;,6);&lt;!--å¯ä»¥--&gt;insert into test(name,id) values(&quot;dd&quot;,6);&lt;!--ä¸å¯ä»¥--&gt; è¿™æ˜¯ä»€ä¹ˆåŽŸå› å‘¢ï¼Ÿ æˆ‘ä»¬å°†æ•°æ®ç”»æˆå›¾ï¼š è¿™é‡Œçš„gapåŒºé—´å¯èƒ½æ˜¯(è´Ÿæ— ç©·ï¼Œ2],(2,6],(6,9],(9,11],(11,15],(15,æ­£æ— ç©·) æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œidä¸º6çš„è¡Œï¼Œå¯¹åº”çš„nameä¸ºc(ä¸è¦å¿˜è®°nameæ˜¯ä¸»é”®ï¼Œä¸»é”®æŒ‰ç…§é¡ºåºæŽ’åº)ï¼Œé‚£ä¹ˆä¸»é”®ä¸­å°±æ˜¯æŒ‰ç…§å­—æ¯è¡¨çš„é¡ºåºè¿›è¡ŒæŽ’åˆ—çš„ï¼ˆASCIIç ï¼‰ï¼Œå¦‚æžœæ’å…¥çš„nameå°äºŽcï¼Œé‚£ä¹ˆå°±ä¸åœ¨gapçš„èŒƒå›´å†…(c,)ï¼Œå°±å¯ä»¥æ’å…¥ï¼Œä½†æ˜¯ddåœ¨gapçš„èŒƒå›´å†…,æ‰€ä»¥å°±ä¼šé˜»å¡žä½ã€‚ 8.2 ç¬¬äº”ç§æƒ…å†µï¼šä¸èµ°ç´¢å¼• è¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰çš„é—´éš™éƒ½ä¼šåŠ ä¸Šé—´éš™é”ï¼Œé‚£ä¹ˆå°±æ˜¯é”è¡¨äº†ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é”æ¨¡å—]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2F%E9%94%81%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[æœ¬ç« å¯¹è¡Œé”è¡¨æ‰€ã€å…±äº«é”æŽ’ä»–é”è¿›è¡Œè¯¦ç»†è¯´æ˜Žã€‚è¿™æ˜¯æ•°æ®åº“é”çš„æ ¸å¿ƒçŸ¥è¯†ã€‚ MySQLä¸­å‡ ç§é‡è¦çš„é”æ¦‚å¿µ å…±äº«é”ï¼ˆSï¼‰å’Œ æŽ’ä»–é”ï¼ˆXï¼‰ InnoDB å®žçŽ°äº†æ ‡å‡†çš„è¡Œçº§é”ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼šå…±äº«é”ï¼ˆç®€ç§° s é”ï¼‰ã€æŽ’å®ƒé”ï¼ˆç®€ç§° x é”ï¼‰ å…±äº«é”å…è®¸æŒé”äº‹åŠ¡è¯»å–ä¸€è¡Œ æŽ’å®ƒé”å…è®¸æŒé”äº‹åŠ¡æ›´æ–°æˆ–è€…åˆ é™¤ä¸€è¡Œ å¦‚æžœäº‹åŠ¡ T1 æŒæœ‰è¡Œ r çš„ s é”ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡ T2 è¯·æ±‚ r çš„é”æ—¶ï¼Œä¼šåšå¦‚ä¸‹å¤„ç†ï¼š T2 è¯·æ±‚ s é”ç«‹å³è¢«å…è®¸ï¼Œç»“æžœ T1 T2 éƒ½æŒæœ‰ r è¡Œçš„ s é” T2 è¯·æ±‚ x é”ä¸èƒ½è¢«ç«‹å³å…è®¸ å¦‚æžœ T1 æŒæœ‰ r çš„ x é”ï¼Œé‚£ä¹ˆ T2 è¯·æ±‚ r çš„ xã€s é”éƒ½ä¸èƒ½è¢«ç«‹å³å…è®¸ï¼ŒT2 å¿…é¡»ç­‰å¾…T1é‡Šæ”¾ x é”æ‰è¡Œã€‚ æ„å‘é” innodbçš„æ„å‘é”ä¸»è¦ç”¨æˆ·å¤šç²’åº¦çš„é”å¹¶å­˜çš„æƒ…å†µã€‚æ¯”å¦‚äº‹åŠ¡Aè¦åœ¨ä¸€ä¸ªè¡¨ä¸ŠåŠ Sé”ï¼Œå¦‚æžœè¡¨ä¸­çš„ä¸€è¡Œå·²è¢«äº‹åŠ¡BåŠ äº†Xé”ï¼Œé‚£ä¹ˆè¯¥é”çš„ç”³è¯·ä¹Ÿåº”è¢«é˜»å¡žã€‚å¦‚æžœè¡¨ä¸­çš„æ•°æ®å¾ˆå¤šï¼Œé€è¡Œæ£€æŸ¥é”æ ‡å¿—çš„å¼€é”€å°†å¾ˆå¤§ï¼Œç³»ç»Ÿçš„æ€§èƒ½å°†ä¼šå—åˆ°å½±å“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨è¡¨çº§ä¸Šå¼•å…¥æ–°çš„é”ç±»åž‹æ¥è¡¨ç¤ºå…¶æ‰€å±žè¡Œçš„åŠ é”æƒ…å†µï¼Œè¿™å°±å¼•å‡ºäº†â€œæ„å‘é”â€çš„æ¦‚å¿µã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœè¡¨ä¸­è®°å½•1äº¿ï¼Œäº‹åŠ¡AæŠŠå…¶ä¸­æœ‰å‡ æ¡è®°å½•ä¸Šäº†è¡Œé”äº†ï¼Œè¿™æ—¶äº‹åŠ¡Béœ€è¦ç»™è¿™ä¸ªè¡¨åŠ è¡¨çº§é”ï¼Œå¦‚æžœæ²¡æœ‰æ„å‘é”çš„è¯ï¼Œé‚£å°±è¦åŽ»è¡¨ä¸­æŸ¥æ‰¾è¿™ä¸€äº¿æ¡è®°å½•æ˜¯å¦ä¸Šé”äº†ã€‚å¦‚æžœå­˜åœ¨æ„å‘é”ï¼Œé‚£ä¹ˆå‡å¦‚äº‹åŠ¡ï¼¡åœ¨æ›´æ–°ä¸€æ¡è®°å½•ä¹‹å‰ï¼Œå…ˆåŠ æ„å‘é”ï¼Œå†åŠ ï¼¸é”ï¼Œäº‹åŠ¡Bå…ˆæ£€æŸ¥è¯¥è¡¨ä¸Šæ˜¯å¦å­˜åœ¨æ„å‘é”ï¼Œå­˜åœ¨çš„æ„å‘é”æ˜¯å¦ä¸Žè‡ªå·±å‡†å¤‡åŠ çš„é”å†²çªï¼Œå¦‚æžœæœ‰å†²çªï¼Œåˆ™ç­‰å¾…ç›´åˆ°äº‹åŠ¡ï¼¡é‡Šæ”¾ï¼Œè€Œæ— é¡»é€æ¡è®°å½•åŽ»æ£€æµ‹ã€‚äº‹åŠ¡ï¼¢æ›´æ–°è¡¨æ—¶ï¼Œå…¶å®žæ— é¡»çŸ¥é“åˆ°åº•å“ªä¸€è¡Œè¢«é”äº†ï¼Œå®ƒåªè¦çŸ¥é“åæ­£æœ‰ä¸€è¡Œè¢«é”äº†å°±è¡Œäº†ã€‚ è¯´ç™½äº†æ„å‘é”çš„ä¸»è¦ä½œç”¨æ˜¯å¤„ç†è¡Œé”å’Œè¡¨é”ä¹‹é—´çš„çŸ›ç›¾ï¼Œèƒ½å¤Ÿæ˜¾ç¤ºâ€œæŸä¸ªäº‹åŠ¡æ­£åœ¨æŸä¸€è¡Œä¸ŠæŒæœ‰äº†é”ï¼Œæˆ–è€…å‡†å¤‡åŽ»æŒæœ‰é”â€ æ„å‘æŽ’å®ƒé”ï¼ˆç®€ç§° IX é”ï¼‰è¡¨æ˜Žä¸€ä¸ªäº‹åŠ¡æ„å›¾åœ¨æŸä¸ªè¡¨ä¸­è®¾ç½®æŸäº›è¡Œçš„ x é” æ„å‘å…±äº«é”ï¼ˆç®€ç§° IS é”ï¼‰è¡¨æ˜Žä¸€ä¸ªäº‹åŠ¡æ„å›¾åœ¨æŸä¸ªè¡¨ä¸­è®¾ç½®æŸäº›è¡Œçš„ s é” ä¾‹å¦‚ï¼Œ SELECT ... LOCK IN SHARE MODE è®¾ç½®ä¸€ä¸ª IS é”, SELECT ... FOR UPDATE è®¾ç½®ä¸€ä¸ª IX é”ã€‚ æ„å‘é”çš„åŽŸåˆ™å¦‚ä¸‹ï¼š ä¸€ä¸ªäº‹åŠ¡å¿…é¡»å…ˆæŒæœ‰è¯¥è¡¨ä¸Šçš„ IS æˆ–è€…æ›´å¼ºçš„é”æ‰èƒ½æŒæœ‰è¯¥è¡¨ä¸­æŸè¡Œçš„ S é” ä¸€ä¸ªäº‹åŠ¡å¿…é¡»å…ˆæŒæœ‰è¯¥è¡¨ä¸Šçš„ IX é”æ‰èƒ½æŒæœ‰è¯¥è¡¨ä¸­æŸè¡Œçš„ X é” next-keyé” InnoDBæœ‰ä¸‰ç§è¡Œé”çš„ç®—æ³•ï¼š Record Lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚åˆ†ä¸ºS Lockå’ŒX Lock Gap Lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚GAPé”çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åŒä¸€äº‹åŠ¡çš„ä¸¤æ¬¡å½“å‰è¯»ï¼Œå‡ºçŽ°å¹»è¯»çš„æƒ…å†µã€‚ Next-Key Lockï¼š1+2ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚å¯¹äºŽè¡Œçš„æŸ¥è¯¢ï¼Œéƒ½æ˜¯é‡‡ç”¨è¯¥æ–¹æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯è§£å†³å¹»è¯»çš„é—®é¢˜ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œmysqlçš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼Œå¹¶ä¸”innodb_locks_unsafe_for_binlogå‚æ•°ä¸º0ï¼Œè¿™æ—¶é»˜è®¤é‡‡ç”¨next-key locksã€‚æ‰€è°“Next-Key Locksï¼Œå°±æ˜¯Record lockå’Œgap lockçš„ç»“åˆï¼Œå³é™¤äº†é”ä½è®°å½•æœ¬èº«ï¼Œè¿˜è¦å†é”ä½ç´¢å¼•ä¹‹é—´çš„é—´éš™ã€‚ ä¾‹å­ï¼šå‡è®¾ä¸€ä¸ªç´¢å¼•åŒ…å«å€¼ 10,11,13å’Œ20ï¼Œç´¢å¼•ä¸Šå¯èƒ½çš„NK é”åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªåŒºé—´ï¼ˆæ³¨æ„å¼€é—­åŒºé—´ï¼‰ 12345(negative infinity, 10](10, 11](11, 13](13, 20](20, positive infinity) Innodbä½¿ç”¨NK é”æ¥è¿›è¡Œç´¢å¼•æœç´¢å’Œæ‰«æï¼Œé˜»æ­¢äº†å¹»è¯»ã€‚ é—´éš™é”åœ¨Innodbä¸­æ˜¯è¢«â€œåè¶³çš„æŠ‘åˆ¶â€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä»¬åªé˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥åˆ°é—´éš™ä¸­ï¼Œä»–ä»¬ä¸é˜»æ­¢å…¶ä»–äº‹ç‰©åœ¨åŒä¸€ä¸ªé—´éš™ä¸ŠèŽ·å¾—é—´éš™é”ã€‚ ä¸‹ç¯‡æ–‡ç« ä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚ MyISAMå’ŒInnoDBå…³äºŽé”æ–¹é¢çš„åŒºåˆ« ç»“è®ºï¼š MyISAMé»˜è®¤ä½¿ç”¨çš„æ˜¯è¡¨çº§é”ï¼Œä¸æ”¯æŒè¡Œçº§é” InnoDBé»˜è®¤ä½¿ç”¨çš„æ˜¯è¡Œçº§é”ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é” æ‰€è°“è¡¨çº§é”ï¼Œå°±æ˜¯é”ä½æ•´å¼ è¡¨ã€‚å¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºçŽ°æ­»é”ï¼Œé”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚çŽ‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½Žã€‚ MyISAMåœ¨æ‰§è¡Œselectçš„æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªè¡¨å…±äº«è¯»é”ï¼Œå½“è¿›è¡Œæ›´æ–°ç­‰æ“ä½œçš„æ—¶å€™ä¼šäº§ç”Ÿè¡¨ç‹¬å å†™é”ï¼ˆæŽ’ä»–é”ï¼‰ã€‚æ‰€ä»¥ï¼š myISAMè¡¨çš„è¯»æ“ä½œï¼Œä¸ä¼šé˜»å¡žå…¶ä»–ç”¨æˆ·å¯¹åŒä¸€ä¸ªè¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡žå¯¹åŒä¸€ä¸ªè¡¨çš„å†™è¯·æ±‚ã€‚ myISAMè¡¨çš„å†™æ“ä½œï¼Œä¼šé˜»å¡žå…¶ä»–ç”¨æˆ·å¯¹åŒä¸€ä¸ªè¡¨çš„è¯»å’Œå†™æ“ä½œã€‚ myISAMè¡¨çš„è¯»ã€å†™æ“ä½œä¹‹é—´ã€ä»¥åŠå†™æ“ä½œä¹‹é—´æ˜¯ä¸²è¡Œçš„ã€‚ è¿™é‡Œçš„è¯»æ˜¯å…±äº«é”ï¼Œä¹Ÿå¯ä»¥å°†å…¶å˜ä¸ºæŽ’ä»–é”ï¼Œè¯­æ³•æ˜¯select â€¦ for update ä¸Šé¢è¯´å®Œäº†MyISAMçš„è¡¨é”ï¼Œä¸‹é¢è¦è¯´è¯´InnoDBå•¦ã€‚InnoDBæ”¯æŒè¡Œçº§é”ã€‚ æ‰€è°“è¡Œçº§é”ï¼Œå°±æ˜¯é”ä½ä¸€è¡Œæ•°æ®ã€‚å¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºçŽ°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚çŽ‡æœ€ä½Žï¼Œå¹¶å‘æ€§ä¹Ÿæœ€é«˜ã€‚ SELECT â€¦ LOCK IN SHARE MODE å’Œ SELECT â€¦ FOR UPDATE å¦‚æžœä½ åœ¨æŸ¥è¯¢æ•°æ®ï¼Œç„¶åŽåœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œæ’å…¥æˆ–è€…ä¿®æ”¹ç›¸å…³çš„æ•°æ®ï¼Œå¸¸è§„çš„ select è¯­å¥ä¸ä¼šæä¾›è¶³å¤Ÿçš„ä¿æŠ¤ã€‚å…¶ä»–çš„äº‹åŠ¡å¯ä»¥ä¿®æ”¹æˆ–è€…åˆ é™¤ä½ æ­£åœ¨æŸ¥è¯¢çš„è¡Œã€‚InnoDB æ”¯æŒä¸¤ç§å¯ä»¥æä¾›å®‰å…¨æœºåˆ¶çš„è¯»å–é”ï¼š SELECT ... LOCK IN SHARE MODE SELECT ... FOR UPDATE SELECT â€¦ LOCK IN SHARE MODE åœ¨è¯»å–çš„è¡Œä¸Šè®¾ç½®ä¸€ä¸ªå…±äº«é”ï¼Œå…¶ä»–çš„sessionå¯ä»¥è¯»è¿™äº›è¡Œï¼Œä½†åœ¨ä½ çš„äº‹åŠ¡æäº¤ä¹‹å‰ä¸å¯ä»¥ä¿®æ”¹å®ƒä»¬ã€‚å¦‚æžœè¿™äº›è¡Œé‡Œæœ‰è¢«å…¶ä»–çš„è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡ä¿®æ”¹ï¼Œä½ çš„æŸ¥è¯¢ä¼šç­‰åˆ°é‚£ä¸ªäº‹åŠ¡ç»“æŸä¹‹åŽä½¿ç”¨æœ€æ–°çš„å€¼ã€‚ ç´¢å¼•æœç´¢é‡åˆ°çš„è®°å½•ï¼ŒSELECT â€¦ FOR UPDATE ä¼šé”ä½è¡ŒåŠä»»ä½•å…³è”çš„ç´¢å¼•æ¡ç›®ï¼Œå’Œä½ å¯¹é‚£äº›è¡Œæ‰§è¡Œ update è¯­å¥ç›¸åŒã€‚å…¶ä»–çš„äº‹åŠ¡ä¼šè¢«é˜»å¡žåœ¨æ¯”å¦‚æ‰§è¡Œ update æ“ä½œï¼ŒèŽ·å–å…±äº«é”ï¼Œæˆ–ä»ŽæŸäº›äº‹åŠ¡éš”ç¦»çº§åˆ«è¯»å–æ•°æ®ç­‰æ“ä½œã€‚ ä½¿ç”¨ SELECT FOR UPDATE ä¸º update æ“ä½œé”å®šè¡Œï¼Œåªé€‚ç”¨äºŽ autocommit è¢«ç¦ç”¨ï¼ˆå½“ä½¿ç”¨ START TRANSACTION å¼€å§‹äº‹åŠ¡æˆ–è€…è®¾ç½® autocommit ä¸º0æ—¶ï¼‰ã€‚å¦‚æžœ autocommit å·²å¯ç”¨ï¼Œç¬¦åˆè§„èŒƒçš„è¡Œä¸ä¼šè¢«é”å®šã€‚ ä»¥ä¸Šæ˜¯å¯¹å®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘è§£è¯»ã€‚ SELECT â€¦ LOCK IN SHARE MODE ï¼šå…±äº«é”(Sé”, share locks)ã€‚å…¶ä»–äº‹åŠ¡å¯ä»¥è¯»å–æ•°æ®ï¼Œä½†ä¸èƒ½å¯¹è¯¥æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œç›´åˆ°æ‰€æœ‰çš„å…±äº«é”è¢«é‡Šæ”¾ã€‚ å¦‚æžœäº‹åŠ¡å¯¹æŸè¡Œæ•°æ®åŠ ä¸Šå…±äº«é”ä¹‹åŽï¼Œå¯è¿›è¡Œè¯»å†™æ“ä½œï¼›å…¶ä»–äº‹åŠ¡å¯ä»¥å¯¹è¯¥æ•°æ®åŠ å…±äº«é”ï¼Œä½†ä¸èƒ½åŠ æŽ’ä»–é”ï¼Œä¸”åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚ SELECT â€¦ FOR UPDATEï¼šæŽ’ä»–é”(Xé”, exclusive locks)ã€‚å¦‚æžœäº‹åŠ¡å¯¹æ•°æ®åŠ ä¸ŠæŽ’ä»–é”ä¹‹åŽï¼Œåˆ™å…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹è¯¥æ•°æ®åŠ ä»»ä½•çš„é”ã€‚èŽ·å–æŽ’ä»–é”çš„äº‹åŠ¡æ—¢èƒ½è¯»å–æ•°æ®ï¼Œä¹Ÿèƒ½ä¿®æ”¹æ•°æ®ã€‚ æ³¨ï¼šæ™®é€š select è¯­å¥é»˜è®¤ä¸åŠ é”ï¼Œè€ŒCUDæ“ä½œé»˜è®¤åŠ æŽ’ä»–é”ã€‚ å½“å‰äº‹åŠ¡èŽ·å–å…±äº«é”åŽï¼Œå¯ä»¥è¯»å†™ï¼Œå…¶ä»–äº‹åŠ¡æ˜¯å¦å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œå’ŒèŽ·å–å…±äº«é”ï¼šå¯ä»¥è¯»ï¼Œå¯ä»¥èŽ·å–å…±äº«é”ï¼Œä¸å¯ä»¥å†™ ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶èŽ·å–å…±äº«é”åŽï¼Œæ˜¯å¦å¯ä»¥è¿›è¡Œupdateæ“ä½œï¼šä¸å¯ä»¥ å½“å‰äº‹åŠ¡èŽ·å–æŽ’ä»–é”åŽï¼Œå…¶ä»–äº‹åŠ¡æ˜¯å¦å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œå’ŒèŽ·å–å…±äº«é”ï¼šå…¶ä»–äº‹åŠ¡å¯ä»¥è¯»ï¼Œä¸å¯ä»¥èŽ·å–å…±äº«é”ï¼Œä¸å¯ä»¥å†™ æ˜¯å¦å¯å¯¹ä¸€æ¡æ•°æ®åŠ å¤šä¸ªæŽ’ä»–é”ï¼šä¸å¯ä»¥ è¡Œé”å’Œç´¢å¼•çš„å…³ç³»ï¼šæŸ¥è¯¢å­—æ®µæœªåŠ ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ã€æ™®é€šç´¢å¼•ç­‰ï¼‰æ—¶ï¼Œä½¿ç”¨è¡¨é” æ³¨ï¼šInnoDBè¡Œçº§é”åŸºäºŽç´¢å¼•å®žçŽ°ã€‚ æœªåŠ ç´¢å¼•æ—¶ï¼Œä¸¤ç§è¡Œé”æƒ…å†µä¸ºï¼ˆä½¿ç”¨è¡¨é”ï¼‰ï¼š äº‹åŠ¡1èŽ·å–æŸè¡Œæ•°æ®å…±äº«é”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„å…±äº«é”ï¼Œä¸å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„æŽ’ä»–é” äº‹åŠ¡1èŽ·å–æŸè¡Œæ•°æ®æŽ’ä»–é”ï¼Œå…¶ä»–äº‹åŠ¡ä¸å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„å…±äº«é”ã€æŽ’ä»–é” åŠ ç´¢å¼•åŽï¼Œä¸¤ç§è¡Œé”ä¸ºï¼ˆä½¿ç”¨è¡Œé”ï¼‰ï¼š äº‹åŠ¡1èŽ·å–æŸè¡Œæ•°æ®å…±äº«é”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„æŽ’ä»–é” äº‹åŠ¡1èŽ·å–æŸè¡Œæ•°æ®æŽ’ä»–é”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„å…±äº«é”ã€æŽ’ä»–é” ç´¢å¼•æ•°æ®é‡å¤çŽ‡å¤ªé«˜ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼šå½“è¡¨ä¸­ç´¢å¼•å­—æ®µæ•°æ®é‡å¤çŽ‡å¤ªé«˜ï¼Œåˆ™MySQLå¯èƒ½ä¼šå¿½ç•¥ç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ­¤æ—¶ä½¿ç”¨è¡¨é”ã€‚å¯ä½¿ç”¨ force index å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•ã€‚ æ€»ç»“ï¼ˆå¾ˆé‡è¦ï¼‰ MyISAMé»˜è®¤ä½¿ç”¨çš„æ˜¯è¡¨çº§é”ï¼Œä¸æ”¯æŒè¡Œçº§é” æ‰§è¡Œselectçš„æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªè¡¨å…±äº«è¯»é” å½“è¿›è¡Œæ›´æ–°ç­‰æ“ä½œçš„æ—¶å€™ä¼šäº§ç”Ÿè¡¨ç‹¬å å†™é”ï¼ˆæŽ’ä»–é”ï¼‰ è¯»ä¸ä¼šé˜»å¡žå…¶ä»–sessionçš„è¯»ä»¥åŠèŽ·å–è¡¨å…±äº«è¯»é” å†™ä¼šé˜»å¡žå…¶ä»–sessionè¯»å’Œå†™æ“ä½œ å†™ä¸Žè¯»ä¹‹é—´æ˜¯ä¸²è¡Œçš„ InnoDBé»˜è®¤ä½¿ç”¨çš„æ˜¯è¡Œçº§é”ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é” InnoDB æ”¯æŒä¸¤ç§å¯ä»¥æä¾›å®‰å…¨æœºåˆ¶çš„è¯»å–é”ï¼šSELECT â€¦ LOCK IN SHARE MODEä»¥åŠSELECT â€¦ FOR UPDATE SELECT â€¦ LOCK IN SHARE MODE åœ¨è¯»å–çš„è¡Œä¸Šè®¾ç½®ä¸€ä¸ªå…±äº«é” SELECT â€¦ FOR UPDATEï¼šæŽ’ä»–é” ä¸€ä¸ªsessionå¯¹æŸä¸€è¡Œä¸Šå…±äº«é”ï¼Œå…¶ä»–çš„sessionå¯ä»¥è¯»è¿™è¡Œï¼Œä¹Ÿå¯ä»¥èŽ·å–å…±äº«é”ï¼Œä½†æ˜¯ä¸å…è®¸å†™ï¼Œæ›´ä¸å…è®¸èŽ·å–å†™é”ã€‚å¯¹äºŽå…¶ä»–è¡Œï¼Œå¯ä»¥è¯»å†™å…¶ä»–è¡Œæ•°æ®ä¹Ÿå¯ä»¥ä¸Šè¯»å†™é”ã€‚ ä¸€ä¸ªsessionå¯¹æŸä¸€è¡Œä¸ŠæŽ’ä»–é”ï¼Œå…¶ä»–çš„sessionåˆ™ä¸èƒ½åŠ ä»»ä½•é”ï¼ŒåŒ…æ‹¬å…±äº«é”ã€‚å…è®¸è¯»è¿™ä¸€è¡Œï¼Œä½†æ˜¯ä¸èƒ½å†™ã€‚å…è®¸å¯¹å…¶ä»–è¡Œæ•°æ®è¿›è¡Œè¯»å†™ä»¥åŠä¸Šè¯»å†™é”ã€‚ InnoDBä¸­è¡Œçº§é”åŸºäºŽç´¢å¼•å®žçŽ°ï¼Œæ‰€ä»¥åœ¨ä¸åŠ ç´¢å¼•çš„æ—¶å€™ï¼Œè¿™ä¸¤è€…ä¸Šçš„å…¶å®žéƒ½æ˜¯è¡¨é”ï¼›åŠ ä¸Šç´¢å¼•ä¹‹åŽï¼Œä½¿ç”¨è¡Œé”ã€‚ ä»¥ä¸Šçš„å†…å®¹éƒ½æ˜¯ä»Žåšå®¢ï¼šhttps://blog.csdn.net/u012099869/article/details/52778728 ä¸­æ•´ç†è€Œæ¥ï¼Œå…·ä½“çš„å®žéªŒä¹Ÿåœ¨ä»–çš„åšå®¢ä¸­è¿›è¡Œäº†è¯¦ç»†çš„å±•ç¤ºã€‚ MyISAMé€‚åˆåœºæ™¯ é¢‘ç¹æ‰§è¡Œå…¨è¡¨countè¯­å¥(MyISAMå·²ç»ç”¨ä¸€ä¸ªè¡¨ä¿å­˜äº†è¡Œæ•°) å¯¹æ•°æ®è¿›è¡Œå¢žåˆ æ”¹çš„é¢‘çŽ‡ä¸é«˜ï¼ŒæŸ¥è¯¢éžå¸¸é¢‘ç¹ æ²¡æœ‰äº‹åŠ¡ InnoDBé€‚åˆåœºæ™¯ æ•°æ®å¢žåˆ æ”¹æŸ¥éƒ½ç›¸å½“é¢‘ç¹ å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè¦æ±‚æ”¯æŒäº‹åŠ¡]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽç´¢å¼•å¤±æ•ˆå’Œè”åˆç´¢å¼•]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2F%E5%85%B3%E4%BA%8E%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%92%8C%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%2F</url>
    <content type="text"><![CDATA[ç†è§£æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…ç´¢å¼•å¤±æ•ˆã€‚ ç´¢å¼•å¤±æ•ˆ æŸ¥è¯¢æ¡ä»¶åŒ…å«or å½“orå·¦å³æŸ¥è¯¢å­—æ®µåªæœ‰ä¸€ä¸ªæ˜¯ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å¤±æ•ˆï¼Œexplainæ‰§è¡Œè®¡åˆ’key=nullï¼›åªæœ‰å½“orå·¦å³æŸ¥è¯¢å­—æ®µå‡ä¸ºç´¢å¼•æ—¶ï¼Œæ‰ä¼šç”Ÿæ•ˆï¼› ç»„åˆç´¢å¼•ï¼Œä¸æ˜¯ä½¿ç”¨ç¬¬ä¸€åˆ—ç´¢å¼•ï¼Œç´¢å¼•å¤±æ•ˆ å¦‚æžœselect * from key1=1 and key2= 2;å»ºç«‹ç»„åˆç´¢å¼•ï¼ˆkey1ï¼Œkey2ï¼‰; select * from key1 = 1;ç»„åˆç´¢å¼•æœ‰æ•ˆï¼› select * from key1 = 1 and key2= 2;ç»„åˆç´¢å¼•æœ‰æ•ˆï¼› select * from key2 = 2;ç»„åˆç´¢å¼•å¤±æ•ˆï¼›ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŽŸåˆ™ like ä»¥%å¼€å¤´ ä½¿ç”¨likeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå½“%åœ¨å‰ç¼€æ—¶ï¼Œç´¢å¼•å¤±æ•ˆï¼› å¦‚ä½•åˆ—ç±»åž‹æ˜¯å­—ç¬¦ä¸²ï¼Œwhereæ—¶ä¸€å®šç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ å½“å…¨è¡¨æ‰«æé€Ÿåº¦æ¯”ç´¢å¼•é€Ÿåº¦å¿«æ—¶ï¼Œmysqlä¼šä½¿ç”¨å…¨è¡¨æ‰«æï¼Œæ­¤æ—¶ç´¢å¼•å¤±æ•ˆ æœ€å·¦å‰ç¼€åŽŸåˆ™ å»ºç«‹ä»¥ä¸‹sqlï¼š 123456789CREATE TABLE IF NOT EXISTS `test_index`( `id` int(4) NOT NULL AUTO_INCREMENT, `a` int(4) NOT NULL DEFAULT '0', `b` int(4) NOT NULL DEFAULT '0', `c` int(4) NOT NULL DEFAULT '0', `data` int(4) NOT NULL DEFAULT '0', PRIMARY KEY (`id`), KEY `union_index` (`a`,`b`,`c`))ENGINE=InnoDB ROW_FORMAT=DYNAMIC DEFAULT CHARSET=binary; æµ‹è¯•çš„mysqlç‰ˆæœ¬æ˜¯ 5.7. é¦–å…ˆä»¥åˆ—aä½œä¸ºæ¡ä»¶æŸ¥è¯¢æ•°æ®ï¼Œæˆ‘ä»¬çœ‹åˆ° type: ref è¡¨ç¤ºå¼•ç”¨æŸ¥æ‰¾, key_len: 4 è¡¨ç¤ºç´¢å¼•é•¿åº¦ä¸º4ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ä¸Šäº†ç´¢å¼•æ¥è¿›è¡ŒæŸ¥æ‰¾: 123456789101112131415explain select data from test_index where a = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 4 ref: const rows: 70 filtered: 100.00 Extra: NULL1 row in set, 1 warning (0.01 sec) ç„¶åŽä»¥åˆ—bä½œä¸ºæ¡ä»¶æŸ¥è¯¢æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°type: ALLè¡¨ç¤ºå…¨è¡¨æŸ¥æ‰¾, key_len: NULL è¡¨ç¤ºæ²¡æœ‰ç´¢å¼•ï¼Œä¹Ÿå°±è¯´æ˜Žå¦‚æžœåªä½¿ç”¨bä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œä¸èƒ½åˆ©ç”¨ç´¢å¼•æ¥åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦. 123456789101112131415explain select data from test_index where b = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: ALLpossible_keys: NULL key: NULL key_len: NULL ref: NULL rows: 716173 filtered: 10.00 Extra: Using where1 row in set, 1 warning (0.00 sec) æŽ¥ç€ä»¥åˆ—cä½œä¸ºæ¡ä»¶æŸ¥è¯¢æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°type: ALLè¡¨ç¤ºå…¨è¡¨æŸ¥æ‰¾, key_len: NULL è¡¨ç¤ºæ²¡æœ‰ç´¢å¼•ï¼Œæƒ…å†µä¸Žç”¨bä½œä¸ºæ¡ä»¶ä¸€æ ·ï¼Œåªä½¿ç”¨cä½œä¸ºæŸ¥è¯¢æ¡ä»¶ä¹Ÿä¸èƒ½åˆ©ç”¨ç´¢å¼•æ¥åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦ 123456789101112131415explain select data from test_index where c = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: ALLpossible_keys: NULL key: NULL key_len: NULL ref: NULL rows: 716173 filtered: 10.00 Extra: Using where1 row in set, 1 warning (0.00 sec) çŽ°åœ¨æ¥æµ‹ä¸€ä¸‹ä½¿ç”¨aã€bä½œä¸ºæ¡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬çœ‹åˆ° type: ref è¡¨ç¤ºå¼•ç”¨æŸ¥æ‰¾, key_len: 8 è¡¨ç¤ºç´¢å¼•é•¿åº¦ä¸º8ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åˆ©ç”¨ä¸Šäº†aã€bè”åˆç´¢å¼•æ¥è¿›è¡ŒæŸ¥æ‰¾ 123456789101112131415explain select data from test_index where a = 1 and b = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 8 ref: const,const rows: 1 filtered: 100.00 Extra: NULL1 row in set, 1 warning (0.00 sec) ç´§æŽ¥ç€æ¥æµ‹ä¸€ä¸‹ä½¿ç”¨aã€cä½œä¸ºæ¡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬çœ‹åˆ° type: ref è¡¨ç¤ºå¼•ç”¨æŸ¥æ‰¾, key_len: 4 è¡¨ç¤ºç´¢å¼•é•¿åº¦ä¸º4ï¼Œè¿™å°±å¥‡æ€ªäº†ï¼ŒæŒ‰ç…§æœ€å·¦åŽŸåˆ™æ¥è¯´ï¼Œaã€cä¸Šæ˜¯ä¸ä¼šå»ºç«‹ç´¢å¼•çš„ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ç´¢å¼•é•¿åº¦å‘¢ï¼Ÿå…¶å®žä¸Žaã€bä¸Šçš„ç´¢å¼•ä¸€æ¯”è¾ƒæˆ‘ä»¬å°±èƒ½å‘çŽ°ï¼Œaã€cä¸Šçš„ç´¢å¼•é•¿åº¦åªæœ‰4ï¼Œè€Œä¸”å•ç‹¬çš„cä¸Šæ˜¯æ²¡æœ‰ç´¢å¼•çš„ï¼Œæ‰€ä»¥4å­—èŠ‚é•¿åº¦çš„ç´¢å¼•åªèƒ½æ˜¯aä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç§æƒ…å†µæˆ‘ä»¬åªä½¿ç”¨äº†aåˆ—ä¸Šçš„ç´¢å¼•æ¥è¿›è¡ŒæŸ¥æ‰¾ 123456789101112131415explain select data from test_index where a = 1 and c = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 4 ref: const rows: 70 filtered: 10.00 Extra: Using index condition1 row in set, 1 warning (0.00 sec) ä¸ºäº†è¿›ä¸€æ­¥éªŒè¯ä¸Šé¢çš„æƒ³æ³•ï¼Œè¿™ä¸€æ¬¡æµ‹ä¸€ä¸‹ä½¿ç”¨bã€cä½œä¸ºæ¡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬çœ‹åˆ° type: ALL è¡¨ç¤ºå…¨è¡¨æŸ¥æ‰¾, key_len: NULL è¡¨ç¤ºæ²¡æœ‰ç´¢å¼•å¯ä»¥ä½¿ç”¨ï¼ŒæŒ‰ç…§æœ€å·¦åŽŸåˆ™æ¥è¯´ï¼Œbåˆ—ä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œcåˆ—ä¸Šä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼ŒåŒæ—¶bã€cçš„ä¸Šä¹Ÿä¸å­˜åœ¨è”åˆç´¢å¼•ï¼Œæ‰€ä»¥ä½¿ç”¨bã€cä½œä¸ºæŸ¥è¯¢æ¡ä»¶æ—¶æ— æ³•åˆ©ç”¨è”åˆç´¢å¼• 123456789101112131415explain select data from test_index where b = 1 and c = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: ALLpossible_keys: NULL key: NULL key_len: NULL ref: NULL rows: 716173 filtered: 1.00 Extra: Using where1 row in set, 1 warning (0.00 sec) æµ‹è¯•å®Œä¸¤ä¸ªæ¡ä»¶çš„æƒ…å†µï¼ŒæŽ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹ä½¿ç”¨aã€bã€cä½œä¸ºæ¡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬çœ‹åˆ° type: ref è¡¨ç¤ºå¼•ç”¨æŸ¥æ‰¾, key_len: 12 è¡¨ç¤ºç´¢å¼•é•¿åº¦ä¸º12ï¼Œè¿™å®Œå…¨ç¬¦åˆè”åˆç´¢å¼•çš„æœ€å·¦åŽŸåˆ™ï¼ŒåŒæ—¶ä½¿ç”¨3ä¸ªæ¡ä»¶æŸ¥è¯¢å¯ä»¥åˆ©ç”¨è”åˆç´¢å¼• 123456789101112131415explain select data from test_index where a = 1 and b = 1 and c = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 12 ref: const,const,const rows: 1 filtered: 100.00 Extra: NULL1 row in set, 1 warning (0.00 sec) ä¸‹é¢è¿™ç§æƒ…å†µä¹Ÿèƒ½åˆ©ç”¨aã€bä¸Šçš„è”åˆç´¢å¼•ï¼Œç´¢å¼•é•¿åº¦ä¸º8 123456789101112131415explain select data from test_index where b = 1 and a = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 8 ref: const,const rows: 1 filtered: 100.00 Extra: NULL1 row in set, 1 warning (0.00 sec) å†æ¥è¯•è¯•è¿™ç§æƒ…å†µï¼ŒæŒ‰ç…§æœ€å·¦åŽŸåˆ™ï¼Œcä¸Šæ²¡æœ‰å»ºç«‹ç´¢å¼•ï¼Œaä¸Šæœ‰ç´¢å¼•ï¼Œcã€aæ²¡æœ‰å»ºç«‹è”åˆç´¢å¼•ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨aä¸Šçš„ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼Œç»“æžœç´¢å¼•é•¿åº¦åªæœ‰4ï¼ŒéªŒè¯äº†æˆ‘ä»¬çš„æƒ³æ³•ï¼Œè”åˆæŸ¥è¯¢æ¡ä»¶ä½¿ç”¨ç´¢å¼•æ—¶æ»¡è¶³â€œäº¤æ¢å¾‹â€ 123456789101112131415explain select data from test_index where c = 1 and a = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 4 ref: const rows: 70 filtered: 10.00 Extra: Using index condition1 row in set, 1 warning (0.00 sec) è”åˆç´¢å¼•æ€»ç»“ è”åˆç´¢å¼•çš„æœ€å·¦åŽŸåˆ™å°±æ˜¯å»ºç«‹ç´¢å¼•KEY union_index (a,b,c)æ—¶ï¼Œç­‰äºŽå»ºç«‹äº†(a)ã€(a,b)ã€(a,b,c)ä¸‰ä¸ªç´¢å¼•ï¼Œä»Žå½¢å¼ä¸Šçœ‹å°±æ˜¯ç´¢å¼•å‘å·¦ä¾§èšé›†ï¼Œæ‰€ä»¥å«åšæœ€å·¦åŽŸåˆ™ï¼Œå› æ­¤æœ€å¸¸ç”¨çš„æ¡ä»¶åº”è¯¥æ”¾åˆ°è”åˆç´¢å¼•çš„ç»„å·¦ä¾§ã€‚ **å¯¹äºŽ&quot;=&quot;å’Œ&quot;in&quot;å¯ä»¥ä¹±åºã€‚**åˆ©ç”¨è”åˆç´¢å¼•åŠ é€ŸæŸ¥è¯¢æ—¶ï¼Œè”åˆæŸ¥è¯¢æ¡ä»¶ç¬¦åˆâ€œäº¤æ¢å¾‹â€ï¼Œä¹Ÿå°±æ˜¯where a = 1 and b = 1 ç­‰ä»·äºŽ where b = 1 and a = 1ã€‚è¿™å½’åŠŸäºŽmysqlæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ŒmysqlæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šåˆ¤æ–­çº æ­£è¿™æ¡sqlè¯­å¥è¯¥ä»¥ä»€ä¹ˆæ ·çš„é¡ºåºæ‰§è¡Œæ•ˆçŽ‡æœ€é«˜ï¼Œæœ€åŽæ‰ç”ŸæˆçœŸæ­£çš„æ‰§è¡Œè®¡åˆ’ã€‚ mysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&lt;,&gt;,between,like)å°±åœæ­¢åŒ¹é…ã€‚æ¯”å¦‚a=3 and b=4 and c&gt;5 and d=6ï¼Œå¦‚æžœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ã€‚å¦‚æžœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚ å¯¹äºŽæœ€å·¦åŒ¹é…åŽŸåˆ™çš„ç†è§£ mysqlç´¢å¼•æœ€å·¦åŒ¹é…åŽŸåˆ™çš„ç†è§£?â€“æ²ˆæ°çš„å›žç­” å…¶å®žæˆ‘è§‰å¾—åªè¦ç†è§£ä¸€ç‚¹å°±æ˜¯ï¼Œåªè¦æœ‰æœ€å·¦è¾¹çš„ç´¢å¼•å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªç´¢å¼•ç»“æž„ä¸€å®šæ˜¯æŒ‰ç…§æœ€å·¦ç´¢å¼•å…ƒç´ æŽ’åºçš„ï¼ŒåŽåºçš„ç´¢å¼•å…ƒç´ ä¹Ÿæ˜¯ä¾èµ–äºŽæœ€å·¦å…ƒç´ ä¹‹åŽæ‰æœ‰å¯èƒ½å˜å¾—æœ‰æ„ä¹‰ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLè°ƒä¼˜]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2FMySQL%E8%B0%83%E4%BC%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»‹ç»æœ€åŸºæœ¬çš„sqlè°ƒä¼˜æ‰‹æ®µã€‚ æ ¹æ®æ…¢æ—¥å¿—å®šä½æ…¢æŸ¥è¯¢sql 12&lt;!--è¿™é‡Œæ˜¯ç”¨æ¨¡ç³ŠæŸ¥è¯¢æŸ¥å‡ºå…³äºŽæŸ¥è¯¢çš„ä¸€äº›é…ç½®é¡¹--&gt;show variables like '%query%' æˆ‘ä»¬å…³æ³¨slow_query_logï¼šOFFï¼Œè¡¨ç¤ºæ…¢æŸ¥è¯¢å¤„äºŽå…³é—­çŠ¶æ€ã€‚å…³æ³¨long_query_timeï¼šè¶…å‡ºè¿™ä¸ªæ—¶é—´å°±æ˜¯æ…¢æŸ¥è¯¢ï¼Œè®°å½•åˆ°slow_query_log_fileæ–‡ä»¶ä¸­ã€‚ 1show status like '%slow_queries%' è¿™ä¸€å¥ä½œç”¨æ˜¯ç»Ÿè®¡æ…¢æŸ¥è¯¢çš„æ•°é‡ã€‚ å¦‚ä½•æ‰“å¼€æ…¢æŸ¥è¯¢å‘¢ï¼Ÿ 1234&lt;!--æ‰“å¼€æ…¢æŸ¥è¯¢--&gt;set global slow_query_log = on;&lt;!--æ…¢æŸ¥è¯¢çš„æ ‡å‡†æ˜¯1ç§’--&gt;set global long_query_time = 1; æ³¨æ„è¦é‡å¯ä¸€ä¸‹å®¢æˆ·ç«¯ã€‚æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œé‡å¯æœåŠ¡ç«¯å°±æ°¸ä¹…ä¿ç•™äº†ã€‚ explainåˆ†æžæ…¢æ—¥å¿— ä¸Šä¸€æ­¥æ—¶æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚ä¸‹é¢è¦è¿›è¡Œåˆ†æžã€‚ 1explain select ... å¯¹è¿™ä¸ªå‘½ä»¤è¿›è¡Œåˆ†æžã€‚æœ‰ä¸¤ä¸ªå…³é”®å­—æ®µï¼š typeï¼šè¡¨ç¤ºmysqlæ‰¾åˆ°æ•°æ®è¡Œçš„æ–¹å¼ï¼Œä¸‹é¢çš„é¡ºåºæ˜¯ç”±å¿«åˆ°æ…¢ï¼š system&gt;const&gt; eq_ref&gt;ref&gt;fulltext&gt;ref_or_null&gt;index_merge&gt;unique_subquery&gt;index_subquery&gt;range&gt;index&gt;all å…¶ä¸­indexå’Œallä¸ºå…¨è¡¨æ‰«æã€‚è¯´æ˜Žéœ€è¦ä¼˜åŒ–ã€‚ extraï¼š using_filesortï¼šè¡¨ç¤ºMySQLä¼šå¯¹ç»“æžœä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨ç´¢å¼•æŽ’åºï¼Œè€Œä¸æ˜¯ä»Žè¡¨é‡ŒæŒ‰ç´¢å¼•æ¬¡åºè¯»åˆ°ç›¸å…³å†…å®¹ã€‚å¯èƒ½åœ¨å†…å­˜æˆ–è€…ç£ç›˜ä¸Šè¿›è¡ŒæŽ’åºã€‚MqSQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æŽ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æŽ’åºâ€ using temporaryï¼šè¡¨ç¤ºMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æžœæŽ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äºŽæŽ’åºorder by å’Œåˆ†ç»„æŸ¥è¯¢ group byã€‚ å½“extraä¸­å‡ºçŽ°ä»¥ä¸Šä¸¤é¡¹æ„å‘³ç€MYSQLæ ¹æœ¬ä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œæ•ˆçŽ‡ä¼šå—åˆ°é‡å¤§å½±å“ï¼Œåº”å°½å¯èƒ½å¯¹æ­¤è¿›è¡Œä¼˜åŒ–ã€‚ ä¿®æ”¹sqlæˆ–è€…å°½é‡è®©sqlèµ°ç´¢å¼• ä¸Šä¸€æ­¥åˆ†æžå®Œä¹‹åŽï¼Œå°±è¦é‡‡å–ä¸€å®šçš„æŽªæ–½æ¥ä¿®æ­£ã€‚ å¦‚æžœæ˜¯æ²¡æœ‰åŠ ç´¢å¼•ï¼Œå¯ä»¥å¯¹å…¶åŠ ä¸Šç´¢å¼•ã€‚extraå°±ä¼šå˜æˆusing indexï¼Œè¡¨ç¤ºèµ°äº†ç´¢å¼•ã€‚ ç´¢å¼•æ˜¯è¶Šå¤šè¶Šå¥½å— æ•°æ®é‡å°çš„è¡¨ä¸éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œå»ºç«‹ä¼šå¢žåŠ é¢å¤–çš„ç´¢å¼•å¼€é”€ æ•°æ®å˜æ›´éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œå› æ­¤æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€æ›´å¤šçš„ç»´æŠ¤æˆæœ¬ æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€ä¹Ÿéœ€è¦æ›´å¤šçš„ç©ºé—´ å¯ä»¥ç†è§£ä¸ºï¼Œä¸€ä¸ªå‡ é¡µçš„å®£ä¼ æ‰‹å†Œ å¯¹äºŽå‡ é¡µçš„å®£ä¼ æ‰‹å†Œæˆ‘ä»¬è¿˜éœ€è¦å»ºç«‹ä¸€ä¸ªç›®å½•å—ï¼Ÿ å˜æ›´è¿™ä¸ªå°çš„å®£ä¼ æ‰‹å†Œé‡Œé¢çš„ç« èŠ‚è¿˜è¦ä¿®æ”¹ç›®å½•ä¸æ˜¯æ›´çƒ¦å—ï¼Ÿ ä¸€ä¸ªå®£ä¼ æ‰‹å†Œå†…å®¹å°±ä¸¤é¡µï¼Œç»“æžœä½ çš„ç›®å½•å°±å äº†ä¸€é¡µï¼Œè¿™åˆç†å—ï¼Ÿ]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLç´¢å¼•å…¨é¢è§£è¯»]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2FMySQL%E7%B4%A2%E5%BC%95%E5%85%A8%E9%9D%A2%E8%A7%A3%E8%AF%BB%2F</url>
    <content type="text"><![CDATA[å½»åº•ç†è§£MySQLçš„å­˜å‚¨å¼•æ“Žæ•°æ®ç»“æž„ä»¥åŠèšé›†ç´¢å¼•ã€‚ 1.ä¸ºä»€ä¹ˆéœ€è¦ç´¢å¼• å¦‚æžœä¸ç”¨ç´¢å¼•ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æ–¹æ¡ˆæ˜¯ï¼šå°†æ•°æ®å…¨éƒ¨æˆ–è€…åˆ†æ‰¹æ¬¡åœ°åŠ è½½åˆ°å†…å­˜ï¼Œå› ä¸ºæ•°æ®æ˜¯ä»¥é¡µçš„å½¢å¼å­˜å‚¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è½®è¯¢è¿™äº›é¡µï¼Œæ‰¾å‡ºæœ‰æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚ åœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œæ˜¾ç„¶æ˜¯ä¼šéžå¸¸æ…¢çš„ã€‚å› ä¸ºå®ƒè¦è¿›è¡Œå…¨è¡¨çš„æ‰«æã€‚ è€Œç´¢å¼•çš„çµæ„Ÿæ¥æºäºŽå­—å…¸ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ–°åŽå­—å…¸å‰é¢æœ‰æŒ‰ç…§æ‹¼éŸ³æˆ–è€…æŒ‰åæ—éƒ¨é¦–æŽ’åºçš„ä¸€ä¸ªåˆ—è¡¨é¡µï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ°æ ¹æ®è¿™ä¸ªç´¢å¼•ç›®å½•è¿…é€Ÿå®šä½åˆ°æŸå‡ é¡µï¼Œç„¶åŽæˆ‘ä»¬åˆ°è¿™ä¸ªæŸå‡ é¡µæ‰¾ä¸€ä¸‹å°±å¯ä»¥æ‰¾åˆ°äº†ã€‚ä¸éœ€è¦å…¨è¡¨æ‰«æã€‚ 2.ç´¢å¼•çš„æ•°æ®ç»“æž„ 2.1 äºŒå‰æŸ¥æ‰¾æ ‘ä¸Šé˜µ äºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹ç‚¹ï¼š äºŒåˆ†æœç´¢æ ‘æœ¬è´¨ä¸Šæ˜¯ä¸€æ£µäºŒå‰æ ‘ã€‚ä¸éœ€è¦æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ã€‚ æ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼å¤§äºŽå·¦å­©å­ æ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼å°äºŽå³å­©å­ ä»¥å·¦å³å­©å­ä¸ºæ ¹çš„å­æ ‘ä»ä¸ºäºŒåˆ†æœç´¢æ ‘ äºŒå‰æŸ¥æ‰¾æ ‘æœ‰ç‚¹å¾ˆæ˜Žæ˜¾ï¼Œæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ªæ•°æ®åªéœ€è¦O(logn)çš„æ—¶é—´ã€‚ä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªè‡´å‘½é—®é¢˜ï¼š æˆ‘ä»¬æœ‰æ—¶ä¼šåˆ é™¤å¢žåŠ æ•°æ®ï¼Œæžçš„ä¸å¥½ï¼Œä¼šæŠŠä»–æ¶åŒ–æˆä¸€ä¸ªé“¾è¡¨ã€‚ ä½†æ˜¯æœ‰çš„åŒå­¦è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çº¢é»‘æ ‘ä¹‹ç±»çš„æ•°æ®ç»“æž„æ¥ç»´æŒä½å¹³è¡¡äºŒå‰æ ‘çš„ç‰¹æ€§ï¼Œè¿™æ ·ä¸å°±å¥½äº†å—ï¼Ÿ è¿™é‡Œè¿˜å­˜åœ¨å¦ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯IOã€‚æˆ‘ä»¬çŸ¥é“ä»Žç£ç›˜æŸ¥è¯¢æ•°æ®ï¼Œå½±å“æ€§èƒ½çš„å…³é”®ç‚¹æ˜¯iOçš„æ¬¡æ•°ï¼Œç„¶åŽè¿™ç§ä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸¤ä¸ªå­©å­ï¼Œåœ¨æµ·é‡æ•°æ®é‡Œï¼ŒIOçš„æ¬¡æ•°è¿˜æ˜¯å¤ªå¤šï¼Œå½±å“æ€§èƒ½ã€‚ æˆ‘ä»¬è¿™ä¸ªæ—¶å€™å°±çŸ¥é“äº†æ–¹å‘ï¼Œæˆ‘ä»¬æƒ³æ‰¾ä¸€ä¸ªæ•°æ®ç»“æž„ï¼Œå®ƒæ—¢åŒ…å«äº†äºŒå‰æ ‘çš„ä¼˜ç‚¹ï¼Œè¿˜è¦æ˜¯å¹³è¡¡çš„æ ‘ï¼Œè¿˜èƒ½ä½¿æ ‘çš„é«˜åº¦å˜çŸ®ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ›´å¤šçš„æ•°æ®ã€‚ 2.2 BTreeä¸Šé˜µ Bæ•°åˆå«å¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ã€‚Mé˜¶ä»£è¡¨ä¸€ä¸ªæ ‘èŠ‚ç‚¹æœ€å¤šæœ‰å¤šå°‘ä¸ªæŸ¥æ‰¾è·¯å¾„ï¼ŒM=Mè·¯,å½“M=2åˆ™æ˜¯2å‰æ ‘,M=3åˆ™æ˜¯3å‰ æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š æ ¹èŠ‚ç‚¹è‡³å°‘åŒ…å«ä¸¤ä¸ªå­©å­ æŽ’åºæ–¹å¼ï¼šæ‰€æœ‰èŠ‚ç‚¹å…³é”®å­—æ˜¯æŒ‰é€’å¢žæ¬¡åºæŽ’åˆ—ï¼Œå¹¶éµå¾ªå·¦å°å³å¤§åŽŸåˆ™ å­èŠ‚ç‚¹æ•°ï¼šæ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å«mä¸ªå­©å­(m&gt;=2)ï¼›é™¤æ ¹èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹å¤–ï¼Œå…¶ä»–æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ceil(m/2)ä¸ªå­©å­ å…³é”®å­—æ•°ï¼šæžèŠ‚ç‚¹çš„å…³é”®å­—æ•°é‡å¤§äºŽç­‰äºŽceil(m/2)-1ä¸ªä¸”å°äºŽç­‰äºŽm-1ä¸ªï¼ˆåˆ†åˆ«æ¯”å­©å­æ•°å°‘ä¸€ä¸ªï¼‰ æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½ä½äºŽåŒä¸€å±‚ï¼Œå³æ‰€æœ‰å¶å­èŠ‚ç‚¹é«˜åº¦éƒ½ä¸€æ · æˆ‘ä»¬ç»“åˆè¿™ä¸ªå›¾æ¥ç†è§£ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ª3è·¯Bæ ‘ï¼Œæ ¹èŠ‚ç‚¹æœ‰3ä¸ªå­©å­ï¼Œæœ‰2ä¸ªå…³é”®å­—ã€‚æ ¹æ®è§„åˆ™ï¼Œå­èŠ‚ç‚¹æ•°æœ€å¤šä¸ºmä¸ªå³3ä¸ªï¼Œæœ€å°‘ä¸ºceil(1.5)ä¸ªå³2ä¸ªï¼›å…³é”®å­—æ•°æœ€å¤šä¸ºm-1ä¸ªå³2ä¸ªï¼Œæœ€å°‘ä¸ºäºŽceil(1.5)-1ä¸ªå³1ä¸ª. é‚£ä¹ˆæˆ‘ä»¬è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œå…³é”®å­—è¿™é‡Œæœ€å¤šä¸º2ä¸ªï¼Œæ‰€ä»¥å¤§äºŽ2å°±è¦è¿›è¡Œæ‹†åˆ†ã€‚ å¦‚ä½•æ‹†åˆ†å‘¢ï¼Ÿæ‹¿ä¸ªä¾‹å­æ¥ï¼š å®šä¹‰ä¸€ä¸ª5é˜¶æ ‘ï¼ˆå¹³è¡¡5è·¯æŸ¥æ‰¾æ ‘;ï¼‰ï¼ŒçŽ°åœ¨æˆ‘ä»¬è¦æŠŠ3ã€8ã€31ã€11ã€23ã€29ã€50ã€28 è¿™äº›æ•°å­—æž„å»ºå‡ºä¸€ä¸ª5é˜¶æ ‘å‡ºæ¥; é‚£ä¹ˆå…³é”®å­—æœ€å¤šä¸º4ä¸ªï¼Œè¶…è¿‡4ä¸ªå°±æ‹†åˆ†ã€‚ å…ˆæ’å…¥ 3ã€8ã€31ã€11 å†æ’å…¥23ã€29 å†æ’å…¥50ã€28 å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„æµç¨‹ã€‚æ€»ä¹‹è¦ç»´æŠ¤ä¸€ä¸ªä»Žå·¦åˆ°å³é€æ¸å¢žå¤§çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å¹³è¡¡çš„ã€‚(å¤§æ¦‚å¿½ç•¥é‡Œé¢å¯èƒ½å­˜åœ¨çš„ä¸€äº›å°é”™è¯¯ï¼Œç†è§£å…¶ä¸­æ„æ€å³å¯) å¯¹äºŽåˆ é™¤ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¦æ»¡è¶³ä»¥ä¸Šçš„ç‰¹æ€§æ‰è¡Œï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚ å¯¹Bæ ‘æ€»ç»“ä¸€ä¸‹ï¼š Bæ ‘ç›¸å¯¹äºŽå¹³è¡¡äºŒå‰æ ‘çš„ä¸åŒæ˜¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„å…³é”®å­—å¢žå¤šäº†ï¼Œç‰¹åˆ«æ˜¯åœ¨Bæ ‘åº”ç”¨åˆ°æ•°æ®åº“ä¸­çš„æ—¶å€™ï¼Œæ•°æ®åº“å……åˆ†åˆ©ç”¨äº†ç£ç›˜å—çš„åŽŸç†ï¼ˆç£ç›˜æ•°æ®å­˜å‚¨æ˜¯é‡‡ç”¨å—çš„å½¢å¼å­˜å‚¨çš„ï¼Œæ¯ä¸ªå—çš„å¤§å°ä¸º4Kï¼Œæ¯æ¬¡IOè¿›è¡Œæ•°æ®è¯»å–æ—¶ï¼ŒåŒä¸€ä¸ªç£ç›˜å—çš„æ•°æ®å¯ä»¥ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼‰æŠŠèŠ‚ç‚¹å¤§å°é™åˆ¶å’Œå……åˆ†ä½¿ç”¨åœ¨ç£ç›˜å¿«å¤§å°èŒƒå›´ï¼›æŠŠæ ‘çš„èŠ‚ç‚¹å…³é”®å­—å¢žå¤šåŽæ ‘çš„å±‚çº§æ¯”åŽŸæ¥çš„äºŒå‰æ ‘å°‘äº†ï¼Œå‡å°‘æ•°æ®æŸ¥æ‰¾çš„æ¬¡æ•°å’Œå¤æ‚åº¦; 2.3 B+æ ‘ æ˜¯Bæ ‘çš„å˜ä½“ï¼Œå…¶å®šä¹‰åŸºæœ¬ä¸Šä¸ŽBæ ‘æ˜¯å·®ä¸å¤šçš„ã€‚é™¤äº†ï¼š éžå¶å­èŠ‚ç‚¹çš„å­æ ‘æŒ‡é’ˆä¸Žå…³é”®å­—ä¸ªæ•°ç›¸åŒ éžå¶å­èŠ‚ç‚¹ä»…ç”¨æ¥ç´¢å¼•ï¼Œæ•°æ®éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­ æ‰€æœ‰å¶å­èŠ‚ç‚¹å‡æœ‰ä¸€ä¸ªé“¾æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹ è¿™å°±æ˜¯B+æ ‘ç›¸å¯¹äºŽBæ ‘çš„æ”¹è¿›çš„å‡ ä¸ªç‚¹ã€‚ ç”±äºŽæ•°æ®å­˜åœ¨å¶å­èŠ‚ç‚¹ï¼Œä¼˜ç‚¹æ˜¯éžå¶å­èŠ‚ç‚¹ä¿å­˜çš„å…³é”®å­—æ›´å¤šäº†ï¼Œæ ‘çš„é«˜åº¦å°±ä¼šæ›´çŸ®ã€‚ 2.4 æ€»ç»“ B+æ ‘æ›´é€‚åˆç”¨æ¥åšå­˜å‚¨ç´¢å¼•ï¼š B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½Žï¼ˆå› ä¸ºå†…éƒ¨ä¸å­˜æ”¾æ•°æ®ï¼Œä¸€æ¬¡æ€§è¯»å–çš„å…³é”®å­—æ›´å¤šï¼ŒIOæ¬¡æ•°é™ä½Žï¼‰ B+æ ‘çš„æŸ¥è¯¢æ•ˆçŽ‡æ›´åŠ ç¨³å®šï¼ˆä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾éƒ½è¦åˆ°å¶å­èŠ‚ç‚¹ï¼Œå¯¼è‡´æ¯ä¸ªæŸ¥è¯¢éƒ½å·®ä¸å¤šï¼‰ B+æ ‘æœ‰åˆ©äºŽå¯¹æ•°æ®åº“æ‰«æï¼ˆéåŽ†å¶å­èŠ‚ç‚¹å°±å¯ä»¥ç›´æŽ¥æ‰«ææ•´ä¸ªè¡¨ï¼Œè¿™ä¸ªé€‚åˆåšèŒƒå›´æŸ¥è¯¢ï¼‰ 2.5 Hashç´¢å¼•ä¹Ÿå¯ä»¥è€ƒè™‘ä¸€ä¸‹ Hashç»“æž„å¯ä»¥ä¸€æ¬¡æ€§åœ°å®šä½åˆ°å“åº”ä½ç½®ã€‚å¦‚æžœé‡åˆ°ç¢°æ’žçš„æƒ…å†µï¼Œåªéœ€è¦éåŽ†é“¾è¡¨å³å¯ã€‚é‚£ä¹ˆæ€§èƒ½è¿™ä¹ˆé«˜ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç”¨Hashç´¢å¼•å‘¢ï¼Ÿ å®ƒä¹Ÿæœ‰ç¼ºç‚¹ï¼š åªèƒ½åšç­‰å€¼æ“ä½œï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ hashç´¢å¼•ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºå­˜å‚¨ï¼Œæ— æ³•ä½¿ç”¨äºŽæŽ’åºã€‚ ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢ï¼ˆæ¯”å¦‚ç»„åˆç´¢å¼•ï¼Œhashç´¢å¼•æ˜¯å¯¹è¿™å‡ ä¸ªç´¢å¼•ä¸€èµ·hashè®¡ç®—çš„ï¼Œè€Œæˆ‘ä»¬ç”¨ç»„åˆç´¢å¼•ä¸­çš„éƒ¨åˆ†ç´¢å¼•æ—¶å°±æ— æ³•ç”¨äº†ï¼‰ ä¸èƒ½é¿å…è¡¨æ‰«æï¼ˆä¼šå‡ºçŽ°hashså†²çªï¼Œå¿…ç„¶è¦æ‰«æé‡Œé¢å…·ä½“çš„æ•°æ®æ‰è¡Œï¼‰ é‡åˆ°å¤§é‡hashå€¼ç›¸ç­‰çš„æ—¶å€™æ€§èƒ½ä¸ä¸€å®šæ¯”Bæ ‘é«˜(åŒä¸Š) 3. èšé›†ç´¢å¼• 3.1 ä»€ä¹ˆæ˜¯èšé›†ç´¢å¼• åœ¨èšé›†ç´¢å¼•ä¸­ï¼Œè¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸Žé”®å€¼çš„é€»è¾‘ï¼ˆç´¢å¼•ï¼‰é¡ºåºç›¸åŒã€‚ä¸€ä¸ªè¡¨åªèƒ½åŒ…å«ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚ å¦‚æžœæŸç´¢å¼•ä¸æ˜¯èšé›†ç´¢å¼•ï¼Œåˆ™è¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸Žé”®å€¼çš„é€»è¾‘é¡ºåºä¸åŒ¹é…ã€‚ä¸Žéžèšé›†ç´¢å¼•ç›¸æ¯”ï¼Œèšé›†ç´¢å¼•é€šå¸¸æä¾›æ›´å¿«çš„æ•°æ®è®¿é—®é€Ÿåº¦ã€‚ 3.2 MyISAMå’ŒInnoDBç´¢å¼•å®žçŽ° ç¬¬ä¸€ä¸ªä¸åŒæ˜¯ï¼šInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚è€ŒMyISAMçš„ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€çš„ã€‚ MyISAMå¼•æ“Žä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æž„ï¼Œå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ï¼Œæ˜¯æ²¡æœ‰ä»»ä½•é¡ºåºè€Œè¨€çš„ï¼Œæ‰€ä»¥MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéžèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸ŽInnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚ MyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æžœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åŽä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚ åœ¨MyISAMä¸­ï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æž„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„keyå¯ä»¥é‡å¤ã€‚ InnoDBä¹Ÿä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æž„ã€‚InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œå³ InnoDB è¡¨æ˜¯åŸºäºŽèšç°‡ç´¢å¼•å»ºç«‹çš„ã€‚ MyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ï¼ˆè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡åœ¨dataç›®å½•ä¸‹æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶éªŒè¯ã€‚Innodbæ¯ä¸€ä¸ªæ•°æ®åº“åªæœ‰ä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼Œè€ŒMyisamåˆ™æœ‰ä¸‰ä¸ªï¼ˆæ•°æ®æ–‡ä»¶ã€ç´¢å¼•æ–‡ä»¶ã€è¡¨ç»“æž„æ–‡ä»¶ï¼‰ï¼‰ã€‚ è€Œåœ¨InnoDBä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æž„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚ ä¸Šå›¾æ˜¯InnoDBä¸»ç´¢å¼•ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æ•°æ®æ–‡ä»¶ï¼‰çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ç§ç´¢å¼•å«åšèšé›†ç´¢å¼•ã€‚èšé›†ç´¢å¼•çš„ç¡®å®šè§„åˆ™ä¸ºï¼š è‹¥ä¸€ä¸ªä¸»é”®è¢«å®šä¹‰ï¼Œè¯¥ä¸»é”®åˆ™ä½œä¸ºèšé›†ç´¢å¼• è‹¥æ²¡æœ‰ä¸»é”®è¢«å®šä¹‰ï¼Œè¯¥è¡¨çš„ç¬¬ä¸€ä¸ªå”¯ä¸€éžç©ºç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼• è‹¥ä¸Šè¿°éƒ½æ‰¾ä¸åˆ°ï¼Œinnodbå†…éƒ¨ä¼šç”Ÿæˆä¸€ä¸ªéšè—ä¸»é”®(èšé›†ç´¢å¼•) éžä¸»é”®ç´¢å¼•å­˜å‚¨ç›¸å…³é”®ä½å’Œå…¶å¯¹åº”çš„ä¸»é”®å€¼ï¼ŒåŒ…å«ä¸¤æ¬¡æŸ¥æ‰¾ ç¬¬äºŒä¸ªä¸ŽMyISAMç´¢å¼•çš„ä¸åŒæ˜¯InnoDBçš„è¾…åŠ©ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚ æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚ èšé›†ç´¢å¼•è¿™ç§å®žçŽ°æ–¹å¼ä½¿å¾—æŒ‰ä¸»é”®çš„æœç´¢ååˆ†é«˜æ•ˆï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•èŽ·å¾—ä¸»é”®ï¼Œç„¶åŽç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢èŽ·å¾—è®°å½•ã€‚ äº†è§£ä¸åŒå­˜å‚¨å¼•æ“Žçš„ç´¢å¼•å®žçŽ°æ–¹å¼å¯¹äºŽæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éžå¸¸æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚çŸ¥é“äº†InnoDBçš„ç´¢å¼•å®žçŽ°åŽï¼Œå°±å¾ˆå®¹æ˜“æ˜Žç™½ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚å†ä¾‹å¦‚ï¼Œç”¨éžå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œéžå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½Žæ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢žå­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹© 4. æ€»ç»“ æœ¬æ–‡é¦–å…ˆä»‹ç»çš„æ˜¯ä¸ºä»€ä¹ˆè¦ç´¢å¼•ã€‚è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ã€‚ ç„¶åŽä»‹ç»äº†å‡ ç§æ•°æ®ç»“æž„ï¼šäºŒå‰æœç´¢æ ‘ã€äºŒå‰å¹³è¡¡æ ‘ã€Bæ ‘ä»¥åŠB+æ ‘ã€‚ä¸€æ­¥ä¸€æ­¥å¼•å‡ºä¸ºä»€ä¹ˆæœ€ç»ˆæ˜¯B+æ ‘ã€‚é¢è¯•çš„æ—¶å€™å°±çœ‹è§£å†³ï¼šä¸ºä»€ä¹ˆä¸èƒ½ç”¨äºŒå‰æœç´¢æ ‘ã€ä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘ã€Bæ ‘å’ŒB+æ ‘å„è‡ªçš„æ•°æ®ç»“æž„ç‰¹ç‚¹ã€B+æ ‘çš„ä¼˜ç‚¹ æœ€åŽä»‹ç»äº†èšé›†ç´¢å¼•ï¼Œå› ä¸ºè¿™æ˜¯MyISAMä¸ŽInnoDBç´¢å¼•ç»“æž„æœ€å¤§çš„ä¸åŒã€‚ ä¹‹å‰è¿˜æ˜¯ä¸èƒ½å¤ªå‡†ç¡®ç†è§£èšé›†ç´¢å¼•ï¼Œè¿™ä¸¤ç§å­˜å‚¨å¼•æ“Žéƒ½æ˜¯ä»¥B+æ ‘æ•°æ®ç»“æž„å»ºç«‹ç´¢å¼•ç»“æž„çš„ï¼Œä½†æ˜¯InnoDBæœ¬èº«è¿™ä¸ªB+æ ‘å°±ä½œä¸ºäº†ç´¢å¼•æ–‡ä»¶ï¼Œå³ç´¢å¼•ä¸Žæ•°æ®æ˜¯æ”¾åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥é€»è¾‘ä¸Šè¿™æ ·æŽ’çš„æ•°æ®ï¼Œå®ƒç‰©ç†ä¸Šä¹Ÿæ˜¯è¿™ä¹ˆæŽ’ã€‚ è€ŒMyISAMçš„ç´¢å¼•ç»“æž„(B+æ ‘)ä¸Žæ•°æ®æ˜¯åˆ†ç¦»çš„ï¼Œè™½ç„¶B+æ ‘å¯èƒ½æ˜¯æŒ‰ç…§ä¸»é”®æœ‰åºåœ°ç»„ç»‡ï¼Œä½†æ˜¯è¡¨çš„æ•°æ®åœ¨å¦ä¸€ä¸ªåœ°æ–¹æ˜¯éšæœºæ”¾çš„ï¼Œæ‰¾æ•°æ®æ˜¯æ ¹æ®åœ°å€æ¥æ‰¾å³å¯ï¼Œæ‰€ä»¥è¿™ç§ç»“æž„å°±ä¸æ˜¯èšé›†çš„ã€‚ ç†è§£äº†è¿™ä¸ªï¼Œä¸‹é¢å°±éžå¸¸å¥½ç†è§£äº†ï¼ŒInnoDBè¿™ä¸ªB+æ ‘ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¶å­èŠ‚ç‚¹çš„æ ¸å¿ƒæ•°æ®å°±æ˜¯ä¸»é”®ã€‚æ‰€ä»¥æ˜¯æŒ‰ç…§ä¸»é”®é€’å¢žçš„æ–¹å¼è¿›è¡ŒæŽ’åˆ—ã€‚è¿™æ ·å­ï¼Œæ— è®ºæ˜¯æŒ‰ç…§ä¸»é”®æŽ’åºè¿˜æ˜¯èŒƒå›´æœç´¢ï¼Œéƒ½ä¼šéžå¸¸åœ°å¿«ã€‚ é‚£ä¹ˆå¦‚æžœæ˜¯éžä¸»é”®ç´¢å¼•çš„è¾…åŠ©ç´¢å¼•å‘¢ï¼ŸInnoDBåªèƒ½é€šè¿‡ä¸¤æ¬¡æŸ¥è¯¢æ¥å®žçŽ°äº†ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥æ˜¯æ ¹æ®è¿™ä¸ªè¾…åŠ©ç´¢å¼•æ‰¾åˆ°å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­çš„ä¸»é”®å€¼ï¼Œç„¶åŽæ ¹æ®ä¸»é”®å†åŽ»ä¸»é”®ç´¢å¼•ä¸­åŽ»æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ã€‚ è€ŒMyISAMç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•å°±åŒºåˆ«ä¸å¤§äº†ã€‚éƒ½æ˜¯å•ç‹¬ä¸€ä¸ªç´¢å¼•ç»“æž„ï¼Œç„¶åŽæ ¹æ®æœ€åŽå¶å­èŠ‚ç‚¹ä¸­çš„è¯¥æ¡æ•°æ®çš„åœ°å€åŽ»æ‰¾ã€‚ ä¸Šé¢è¯´çš„æŒ‰ç…§ä¸»é”®æŽ’åˆ—ï¼Œå°±æ˜¯è¿™é‡Œæ‰€è°“çš„èšé›†ç´¢å¼•å•¦ã€‚å½“ç„¶äº†ï¼Œå¦‚æžœæ²¡æœ‰æŒ‡å®šä¸»é”®ï¼Œä¼šæŒ‰ç…§ä¸Šé¢æ‰€è¯´çš„è§„åˆ™åŽ»æž„å»ºèšé›†ç´¢å¼•ã€‚ é‚£ä¹ˆï¼Œé¢è¯•çš„æ—¶å€™ï¼Œå°±å¯ä»¥åº”å¯¹InnoDBä¸ŽMyISAMç´¢å¼•ç»“æž„çš„å„è‡ªçš„å®žçŽ°å’Œä¸åŒç‚¹å•¦ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“ç´¢å¼•å…¥é—¨]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­æé«˜æ€§èƒ½çš„ä¸€å¤§åˆ©å™¨ã€‚æœ¬ç¯‡å…¥é—¨ç´¢å¼•çš„åŸºæœ¬çŸ¥è¯†ã€‚ 1. ä»€ä¹ˆæ˜¯ç´¢å¼• åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æž„ï¼Œè¿™äº›æ•°æ®ç»“æž„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æž„ä¸Šå®žçŽ°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ç§æ•°æ®ç»“æž„ï¼Œå°±æ˜¯ç´¢å¼•ã€‚ 2. ä¸ºä»€ä¹ˆè¦ç”¨ç´¢å¼• ç´¢å¼•ä¸»è¦å°±æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢é€Ÿåº¦ç”¨çš„ã€‚ 3. ç´¢å¼•çš„ä¸€äº›ç¼ºç‚¹ ç¬¬ä¸€ï¼Œåˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œè¿™ç§æ—¶é—´éšç€æ•°æ®é‡çš„å¢žåŠ è€Œå¢žåŠ ã€‚ ç¬¬äºŒï¼Œç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œå¦‚æžœè¦å»ºç«‹èšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆéœ€è¦çš„ç©ºé—´å°±ä¼šæ›´å¤§ã€‚ ç¬¬ä¸‰ï¼Œå½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢žåŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œè¿™æ ·å°±é™ä½Žäº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚ 4. å“ªäº›å­—æ®µé€‚åˆç”¨ç´¢å¼• åœ¨ç»å¸¸éœ€è¦æœç´¢çš„åˆ—ä¸Šï¼Œå¯ä»¥åŠ å¿«æœç´¢çš„é€Ÿåº¦ï¼› åœ¨ä½œä¸ºä¸»é”®çš„åˆ—ä¸Šï¼Œå¼ºåˆ¶è¯¥åˆ—çš„å”¯ä¸€æ€§å’Œç»„ç»‡è¡¨ä¸­æ•°æ®çš„æŽ’åˆ—ç»“æž„ï¼› åœ¨ç»å¸¸ç”¨åœ¨è¿žæŽ¥çš„åˆ—ä¸Šï¼Œè¿™äº›åˆ—ä¸»è¦æ˜¯ä¸€äº›å¤–é”®ï¼Œå¯ä»¥åŠ å¿«è¿žæŽ¥çš„é€Ÿåº¦ï¼› åœ¨ç»å¸¸éœ€è¦æ ¹æ®èŒƒå›´è¿›è¡Œæœç´¢çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æŽ’åºï¼Œå…¶æŒ‡å®šçš„èŒƒå›´æ˜¯è¿žç»­çš„ï¼› åœ¨ç»å¸¸éœ€è¦æŽ’åºçš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æŽ’åºï¼Œè¿™æ ·æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æŽ’åºï¼ŒåŠ å¿«æŽ’åºæŸ¥è¯¢æ—¶é—´ï¼› åœ¨ç»å¸¸ä½¿ç”¨åœ¨WHEREå­å¥ä¸­çš„åˆ—ä¸Šé¢åˆ›å»ºç´¢å¼•ï¼ŒåŠ å¿«æ¡ä»¶çš„åˆ¤æ–­é€Ÿåº¦ã€‚ï¼ˆè¿™åŒä¸€ï¼‰ 5. ä¸åº”è¯¥åˆ›å»ºç´¢å¼•çš„çš„è¿™äº›åˆ—å…·æœ‰ä¸‹åˆ—ç‰¹ç‚¹ ç¬¬ä¸€ï¼Œå¯¹äºŽé‚£äº›åœ¨æŸ¥è¯¢ä¸­å¾ˆå°‘ä½¿ç”¨æˆ–è€…å‚è€ƒçš„åˆ—ä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ—¢ç„¶è¿™äº›åˆ—å¾ˆå°‘ä½¿ç”¨åˆ°ï¼Œå› æ­¤æœ‰ç´¢å¼•æˆ–è€…æ— ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ç›¸åï¼Œç”±äºŽå¢žåŠ äº†ç´¢å¼•ï¼Œåè€Œé™ä½Žäº†ç³»ç»Ÿçš„ç»´æŠ¤é€Ÿåº¦å’Œå¢žå¤§äº†ç©ºé—´éœ€æ±‚ã€‚ ç¬¬äºŒï¼Œå¯¹äºŽé‚£äº›åªæœ‰å¾ˆå°‘æ•°æ®å€¼çš„åˆ—ä¹Ÿä¸åº”è¯¥å¢žåŠ ç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºï¼Œç”±äºŽè¿™äº›åˆ—çš„å–å€¼å¾ˆå°‘ï¼Œä¾‹å¦‚äººäº‹è¡¨çš„æ€§åˆ«åˆ—ï¼Œåœ¨æŸ¥è¯¢çš„ç»“æžœä¸­ï¼Œç»“æžœé›†çš„æ•°æ®è¡Œå äº†è¡¨ä¸­æ•°æ®è¡Œçš„å¾ˆå¤§æ¯”ä¾‹ï¼Œå³éœ€è¦åœ¨è¡¨ä¸­æœç´¢çš„æ•°æ®è¡Œçš„æ¯”ä¾‹å¾ˆå¤§ã€‚å¢žåŠ ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æ˜Žæ˜¾åŠ å¿«æ£€ç´¢é€Ÿåº¦ã€‚ ç¬¬ä¸‰ï¼Œå¯¹äºŽé‚£äº›å®šä¹‰ä¸ºtext, imageå’Œbitæ•°æ®ç±»åž‹çš„åˆ—ä¸åº”è¯¥å¢žåŠ ç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºï¼Œè¿™äº›åˆ—çš„æ•°æ®é‡è¦ä¹ˆç›¸å½“å¤§ï¼Œè¦ä¹ˆå–å€¼å¾ˆå°‘ã€‚ ç¬¬å››ï¼Œå½“ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºŽæ£€ç´¢æ€§èƒ½æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºï¼Œä¿®æ”¹æ€§èƒ½å’Œæ£€ç´¢æ€§èƒ½æ˜¯äº’ç›¸çŸ›ç›¾çš„ã€‚å½“å¢žåŠ ç´¢å¼•æ—¶ï¼Œä¼šæé«˜æ£€ç´¢æ€§èƒ½ï¼Œä½†æ˜¯ä¼šé™ä½Žä¿®æ”¹æ€§èƒ½ã€‚å½“å‡å°‘ç´¢å¼•æ—¶ï¼Œä¼šæé«˜ä¿®æ”¹æ€§èƒ½ï¼Œé™ä½Žæ£€ç´¢æ€§èƒ½ã€‚å› æ­¤ï¼Œå½“ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºŽæ£€ç´¢æ€§èƒ½æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚ 6. ç´¢å¼•çš„åˆ†ç±» B-Tree ç´¢å¼•ï¼Œ Hash ç´¢å¼•ï¼Œ Fulltext ç´¢å¼•å’ŒR-Tree ç´¢å¼• æœ€ä¸»è¦å…³å¿ƒçš„æ˜¯B-Tree ç´¢å¼•ã€‚ä¸‹é¢å†æä¸€ä¸‹èšé›†ç´¢å¼•ï¼Œå› ä¸ºè¿™æ˜¯innodbæœ€ä¸»è¦çš„ç»„ç»‡æ–¹å¼ã€‚ åœ¨èšé›†ç´¢å¼•ä¸­ï¼Œè¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸Žé”®å€¼çš„é€»è¾‘ï¼ˆç´¢å¼•ï¼‰é¡ºåºç›¸åŒã€‚ä¸€ä¸ªè¡¨åªèƒ½åŒ…å«ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚ å¦‚æžœæŸç´¢å¼•ä¸æ˜¯èšé›†ç´¢å¼•ï¼Œåˆ™è¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸Žé”®å€¼çš„é€»è¾‘é¡ºåºä¸åŒ¹é…ã€‚ä¸Žéžèšé›†ç´¢å¼•ç›¸æ¯”ï¼Œèšé›†ç´¢å¼•é€šå¸¸æä¾›æ›´å¿«çš„æ•°æ®è®¿é—®é€Ÿåº¦ã€‚ ä¸‹ä¸€èŠ‚ä¼šè¯¦ç»†è®²åˆ°InnoDBå’ŒMyISAMçš„ç´¢å¼•å®žçŽ°æ–¹å¼ï¼Œä»–ä»¬æœ€å¤§çš„åŒºåˆ«å°±æ˜¯InnoDBæ˜¯èšé›†ç´¢å¼•ï¼Œè€ŒMyISAMä¸æ˜¯ã€‚ 7. å±€éƒ¨æ€§åŽŸç†ä¸Žç£ç›˜é¢„è¯» ç”±äºŽå­˜å‚¨ä»‹è´¨çš„ç‰¹æ€§ï¼Œç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œå†åŠ ä¸Šæœºæ¢°è¿åŠ¨è€—è´¹ï¼Œç£ç›˜çš„å­˜å–é€Ÿåº¦å¾€å¾€æ˜¯ä¸»å­˜çš„å‡ ç™¾åˆ†ä¹‹ä¸€ï¼Œå› æ­¤ä¸ºäº†æé«˜æ•ˆçŽ‡ï¼Œè¦å°½é‡å‡å°‘ç£ç›˜I/Oã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ï¼Œå³ä½¿åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œç£ç›˜ä¹Ÿä¼šä»Žè¿™ä¸ªä½ç½®å¼€å§‹ï¼Œé¡ºåºå‘åŽè¯»å–ä¸€å®šé•¿åº¦çš„æ•°æ®æ”¾å…¥å†…å­˜ã€‚è¿™æ ·åšçš„ç†è®ºä¾æ®æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è‘—åçš„å±€éƒ¨æ€§åŽŸç†ï¼šå½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚ç¨‹åºè¿è¡ŒæœŸé—´æ‰€éœ€è¦çš„æ•°æ®é€šå¸¸æ¯”è¾ƒé›†ä¸­ã€‚ ç”±äºŽç£ç›˜é¡ºåºè¯»å–çš„æ•ˆçŽ‡å¾ˆé«˜ï¼ˆä¸éœ€è¦å¯»é“æ—¶é—´ï¼Œåªéœ€å¾ˆå°‘çš„æ—‹è½¬æ—¶é—´ï¼‰ï¼Œå› æ­¤å¯¹äºŽå…·æœ‰å±€éƒ¨æ€§çš„ç¨‹åºæ¥è¯´ï¼Œé¢„è¯»å¯ä»¥æé«˜I/Oæ•ˆçŽ‡ã€‚ é¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µï¼ˆpageï¼‰çš„æ•´å€æ•°ã€‚é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿žç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œé¡µå¾—å¤§å°é€šå¸¸ä¸º4kï¼‰ï¼Œä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚å½“ç¨‹åºè¦è¯»å–çš„æ•°æ®ä¸åœ¨ä¸»å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå‘ç£ç›˜å‘å‡ºè¯»ç›˜ä¿¡å·ï¼Œç£ç›˜ä¼šæ‰¾åˆ°æ•°æ®çš„èµ·å§‹ä½ç½®å¹¶å‘åŽè¿žç»­è¯»å–ä¸€é¡µæˆ–å‡ é¡µè½½å…¥å†…å­˜ä¸­ï¼Œç„¶åŽå¼‚å¸¸è¿”å›žï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚ 8.Bæ ‘/B+æ ‘ æƒ³è¦ç†è§£ç´¢å¼•åŽŸç†å¿…é¡»æ¸…æ¥šä¸€ç§æ•°æ®ç»“æž„ã€Œå¹³è¡¡æ ‘ã€(éžäºŒå‰)ï¼Œä¹Ÿå°±æ˜¯B treeæˆ–è€… B+ treeï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼šâ€œå¹³è¡¡æ ‘ï¼Œå¹³è¡¡æ ‘ï¼Œå¹³è¡¡æ ‘â€ã€‚å½“ç„¶ï¼Œ æœ‰çš„æ•°æ®åº“ä¹Ÿä½¿ç”¨å“ˆå¸Œæ¡¶ä½œç”¨ç´¢å¼•çš„æ•°æ®ç»“æž„ ï¼Œ ç„¶è€Œï¼Œ ä¸»æµçš„RDBMSéƒ½æ˜¯æŠŠå¹³è¡¡æ ‘å½“åšæ•°æ®è¡¨é»˜è®¤çš„ç´¢å¼•æ•°æ®ç»“æž„çš„ã€‚ æˆ‘ä»¬å¹³æ—¶å»ºè¡¨çš„æ—¶å€™éƒ½ä¼šä¸ºè¡¨åŠ ä¸Šä¸»é”®ï¼Œ åœ¨æŸäº›å…³ç³»æ•°æ®åº“ä¸­ï¼Œ å¦‚æžœå»ºè¡¨æ—¶ä¸æŒ‡å®šä¸»é”®ï¼Œæ•°æ®åº“ä¼šæ‹’ç»å»ºè¡¨çš„è¯­å¥æ‰§è¡Œã€‚ äº‹å®žä¸Šï¼Œ ä¸€ä¸ªåŠ äº†ä¸»é”®çš„è¡¨ï¼Œå¹¶ä¸èƒ½è¢«ç§°ä¹‹ä¸ºã€Œè¡¨ã€ã€‚ä¸€ä¸ªæ²¡åŠ ä¸»é”®çš„è¡¨ï¼Œå®ƒçš„æ•°æ®æ— åºçš„æ”¾ç½®åœ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œä¸€è¡Œä¸€è¡Œçš„æŽ’åˆ—çš„å¾ˆæ•´é½ï¼Œ è·Ÿæˆ‘è®¤çŸ¥ä¸­çš„ã€Œè¡¨ã€å¾ˆæŽ¥è¿‘ã€‚ å¦‚æžœç»™è¡¨ä¸Šäº†ä¸»é”®ï¼Œé‚£ä¹ˆè¡¨åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨ç»“æž„å°±ç”±æ•´é½æŽ’åˆ—çš„ç»“æž„è½¬å˜æˆäº†æ ‘çŠ¶ç»“æž„ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„ã€Œå¹³è¡¡æ ‘ã€ç»“æž„ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ•´ä¸ªè¡¨å°±å˜æˆäº†ä¸€ä¸ªç´¢å¼•ã€‚æ²¡é”™ï¼Œ å†è¯´ä¸€éï¼Œ æ•´ä¸ªè¡¨å˜æˆäº†ä¸€ä¸ªç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ã€Œèšé›†ç´¢å¼•ã€ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œ ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªã€Œèšé›†ç´¢å¼•ã€ï¼Œå› ä¸ºä¸»é”®çš„ä½œç”¨å°±æ˜¯æŠŠã€Œè¡¨ã€çš„æ•°æ®æ ¼å¼è½¬æ¢æˆã€Œç´¢å¼•ï¼ˆå¹³è¡¡æ ‘ï¼‰ã€çš„æ ¼å¼æ”¾ç½®ã€‚ ä¸Šå›¾å°±æ˜¯å¸¦æœ‰ä¸»é”®çš„è¡¨ï¼ˆèšé›†ç´¢å¼•ï¼‰çš„ç»“æž„å›¾ã€‚å…¶ä¸­æ ‘çš„æ‰€æœ‰ç»“ç‚¹ï¼ˆåº•éƒ¨é™¤å¤–ï¼‰çš„æ•°æ®éƒ½æ˜¯ç”±ä¸»é”®å­—æ®µä¸­çš„æ•°æ®æž„æˆï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æˆ‘ä»¬æŒ‡å®šä¸»é”®çš„idå­—æ®µã€‚æœ€ä¸‹é¢éƒ¨åˆ†æ˜¯çœŸæ­£è¡¨ä¸­çš„æ•°æ®ã€‚ å‡å¦‚æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªSQLè¯­å¥ï¼š select * from table where id = 1256; é¦–å…ˆæ ¹æ®ç´¢å¼•å®šä½åˆ°1256è¿™ä¸ªå€¼æ‰€åœ¨çš„å¶ç»“ç‚¹ï¼Œç„¶åŽå†é€šè¿‡å¶ç»“ç‚¹å–åˆ°idç­‰äºŽ1256çš„æ•°æ®è¡Œã€‚ è¿™é‡Œä¸è®²è§£å¹³è¡¡æ ‘çš„è¿è¡Œç»†èŠ‚ï¼Œ ä½†æ˜¯ä»Žä¸Šå›¾èƒ½çœ‹å‡ºï¼Œæ ‘ä¸€å…±æœ‰ä¸‰å±‚ï¼Œ ä»Žæ ¹èŠ‚ç‚¹è‡³å¶èŠ‚ç‚¹åªéœ€è¦ç»è¿‡ä¸‰æ¬¡æŸ¥æ‰¾å°±èƒ½å¾—åˆ°ç»“æžœã€‚å¦‚ä¸‹å›¾ è¿™ä¸€èŠ‚å…ˆå¯¹ç´¢å¼•å…¥ä¸ªé—¨ï¼Œå…³äºŽB+æ ‘ä»¥åŠèšé›†ç´¢å¼•ä¸‹ç¯‡æ–‡ç« æ¥å…·ä½“åˆ†æžã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»åž‹æ•°æ®åº“]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2F%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç©ºçš„é¢è¯•é¢˜ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹å¦‚ä½•å›žç­”ã€‚ å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»åž‹æ•°æ®åº“ æˆ‘ä»¬è€ƒè™‘å¼€å‘ä¸€ä¸ªæ•°æ®åº“æœ€é‡è¦çš„æ¨¡å—æ˜¯ä»€ä¹ˆã€‚é¦–å…ˆæ•°æ®å­˜å‚¨æ˜¯å…¶æ ¸å¿ƒåŠŸèƒ½ã€‚å› æ­¤ä¼šæœ‰ä¸€ä¸ªå­˜å‚¨æ¨¡å—æ¥å­˜å‚¨æ•°æ®ã€‚ä»‹è´¨ä¸»è¦æ˜¯ç¡¬ç›˜ã€‚ å¯æ˜¯ï¼Œå…‰æœ‰å­˜å‚¨æ˜¯ä¸è¡Œçš„ã€‚æˆ‘ä»¬éœ€è¦æœ‰ä»¥ä¸‹ç¨‹åºæ¨¡å—å¯¹æ•°æ®è¿›è¡Œç»„ç»‡ã€‚ å­˜å‚¨ç®¡ç† æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®çš„æ ¼å¼å’Œæ–‡ä»¶çš„åˆ†éš”è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ï¼Œé€šè¿‡é€»è¾‘çš„å½¢å¼æ¥ç»„åˆå’Œè¡¨ç¤ºå‡ºæ¥ã€‚ æˆ‘ä»¬çŸ¥é“ç¨‹åºå¤„ç†ï¼Œéœ€è¦å°†æ•°æ®å…ˆåŠ è½½åˆ°å†…å­˜ä¸­åŽ»ï¼Œä¸å¯èƒ½ç›´æŽ¥åœ¨ç¡¬ç›˜ä¸Šè¿›è¡Œå¤„ç†ã€‚ æˆ‘ä»¬é€šè¿‡ioè¯»å–ç£ç›˜æ•°æ®ï¼Œç£ç›˜çš„ioæ˜¯éžå¸¸è€—æ—¶çš„ï¼Œæ‰€ä»¥ç¡¬ç›˜ä»¥é¡µçš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œæ ¹æ®å±€éƒ¨æ€§åŽŸç†ï¼Œå¾€å¾€ç”¨æˆ·è¦æŸ¥è¯¢çš„æ•°æ®å‘¨å›´çš„æ•°æ®ä¹Ÿä¼šè¢«æŸ¥è¯¢åˆ°ï¼Œæ‰€ä»¥å–æ•°æ®éƒ½æ˜¯ä»¥é¡µä¸ºå•ä½æŸ¥å–å¤šä¸ªæ•°æ®ï¼Œæé«˜æ•ˆçŽ‡ã€‚ ç¼“å­˜æœºåˆ¶ ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ï¼Œä¸€æ¬¡IOä¸ä¼šåªå–ç”¨æˆ·æ‰€éœ€è¦çš„ä¸€ç‚¹æ•°æ®ï¼Œæ‰€ä»¥ä¼šæ¶‰åŠåˆ°ç¼“å­˜ï¼Œç¼“å­˜å¯èƒ½ä¼šä¸å¤Ÿæ”¾ï¼Œé‚£å°±æ¶‰åŠä¸€äº›ç¼“å­˜æ·˜æ±°çš„ç®—æ³•ï¼Œæ¯”å¦‚æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯LRUç®—æ³•ã€‚ SQLè§£æž å°†SQLè¿›è¡Œç¼–è¯‘æ‰§è¡Œã€‚å¦‚ä½•æé«˜SQLè§£æžæ•ˆçŽ‡å‘¢ï¼Ÿå¯èƒ½ä¹Ÿç”¨ç¼“å­˜ï¼Œç¼“å­˜å¥½SQLè§£æžåŽçš„ç»“æžœï¼Œä¸‹æ¬¡å†æ‰§è¡Œä¸€æ ·çš„SQLå°±å¯ä»¥å…åŽ»è§£æžçš„è¿‡ç¨‹ã€‚ æ—¥å¿—ç®¡ç† è¦è®°å½•SQLæ“ä½œï¼Œæ–¹ä¾¿ä¸»ä»ŽåŒæ­¥ã€ç¾éš¾æ¢å¤ç­‰ã€‚è¿™é‡Œè¦äº†è§£ä¸€ä¸‹binlog. æƒé™åˆ’åˆ† å°±æ˜¯æƒé™ã€‚ å®¹ç¾æœºåˆ¶ è¦å¯¹å¼‚å¸¸æƒ…å†µåšå¥½å‡†å¤‡ï¼Œæ¯”å¦‚æ•°æ®åº“æŒ‚äº†æ€Žä¹ˆåŠžã€‚ ç´¢å¼•ç®¡ç† ä¼˜åŒ–æ•°æ®åº“æ‰§è¡Œæ•ˆçŽ‡ã€‚ é”æ¨¡å— ä½¿å¾—æ•°æ®åº“æ”¯æŒå¹¶å‘æ“ä½œã€‚ æ€»ç»“ äº†è§£äº†ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹è¿™ä¸ªé—®é¢˜åšä¸€ä¸ªç®€å•çš„æ€»ç»“æ€§å›žç­”äº†ï¼Œå¦‚ä½•è®¾è®¡å…³ç³»åž‹æ•°æ®åº“å‘¢ï¼Ÿé¦–å…ˆæ•°æ®åº“æœ‰ä¸€ä¸ªå­˜å‚¨çš„åŠŸèƒ½ï¼Œä½¿å¾—å®ƒèƒ½å­˜å‚¨åœ¨æ¯”å¦‚æœºæ¢°ç¡¬ç›˜æˆ–è€…å›ºæ€ç¡¬ç›˜ä¸Šé¢ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­˜å‚¨ç®¡ç†æ¨¡å—æ¥æ˜ å°„ç¨‹åºé€»è¾‘ä¸Žç‰©ç†åœ°å€ï¼Œå®žçŽ°å­˜å‚¨ç®¡ç†ã€‚è¿˜éœ€è¦ç¼“å­˜æœºåˆ¶ï¼Œå¯¹ä¸€äº›æ•°æ®è¿›è¡Œç¼“å­˜æé«˜æ•ˆçŽ‡ï¼Œå¹¶ä¸”ç¼“å­˜ä¸èƒ½å¤ªå¤§ï¼Œå¿…é¡»é…å¤‡ç¼“å­˜æ·˜æ±°æœºåˆ¶ï¼›ç„¶åŽéœ€è¦ä¸€ä¸ªSQLè§£æžæ¨¡å—ï¼Œæ¥è§£æžSQLï¼›ç„¶åŽéœ€è¦æ—¥å¿—ç®¡ç†æ¥æä¾›ä¸»ä»Žèµ‹å€¼ã€ä¸»ä»ŽåŒæ­¥ç­‰åŠŸèƒ½ï¼›è¿˜éœ€è¦ä¸€ä¸ªæƒé™åˆ’åˆ†æ¨¡å—ï¼Œæ¥æä¾›ç»™å¤šç”¨æˆ·ä½¿ç”¨åœºæ™¯ï¼›è¿˜éœ€è¦å®¹ç¾æœºåˆ¶é¢å¯¹å¼‚å¸¸æƒ…å†µï¼›æœ€åŽï¼Œä¸ºäº†æé«˜æ•°æ®æŸ¥è¯¢æ•ˆçŽ‡éœ€è¦æœ‰ç´¢å¼•ç®¡ç†æ¨¡å—ï¼›ä¸ºäº†æ”¯æŒå¹¶å‘æ“ä½œéœ€è¦æœ‰é”æ¨¡å—ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[deleteå’Œtruncateä»¥åŠdropåŒºåˆ«]]></title>
    <url>%2F2019%2F01%2F25%2Fmysql%2Fdelete%E5%92%8Ctruncate%E4%BB%A5%E5%8F%8Adrop%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[è¿™ä¸ªé¢˜ç›®æˆ‘è‡ªå·±ä¹Ÿè¢«é—®è¿‡ï¼Œè¿™é‡Œç®€å•æ•´ç†ä¸€ä¸‹ã€‚ å…ˆæ¥ä¸ªæ€»ç»“ï¼š dropç›´æŽ¥åˆ æŽ‰è¡¨ï¼› truncateåˆ é™¤çš„æ˜¯è¡¨ä¸­çš„æ•°æ®ï¼Œå†æ’å…¥æ•°æ®æ—¶è‡ªå¢žé•¿çš„æ•°æ®idåˆé‡æ–°ä»Ž1å¼€å§‹ï¼› deleteåˆ é™¤è¡¨ä¸­æ•°æ®ï¼Œå¯ä»¥åœ¨åŽé¢æ·»åŠ whereå­—å¥ã€‚ æ—¥å¿—æ˜¯å¦è®°å½• DELETEè¯­å¥æ‰§è¡Œåˆ é™¤æ“ä½œçš„è¿‡ç¨‹æ˜¯æ¯æ¬¡ä»Žè¡¨ä¸­åˆ é™¤ä¸€è¡Œï¼Œå¹¶ä¸”åŒæ—¶å°†è¯¥è¡Œçš„åˆ é™¤æ“ä½œä½œä¸ºäº‹åŠ¡è®°å½•åœ¨æ—¥å¿—ä¸­ä¿å­˜ä»¥ä¾¿è¿›è¡Œè¿›è¡Œå›žæ»šæ“ä½œã€‚ TRUNCATE TABLE åˆ™ä¸€æ¬¡æ€§åœ°ä»Žè¡¨ä¸­åˆ é™¤æ‰€æœ‰çš„æ•°æ®å¹¶ä¸æŠŠå•ç‹¬çš„åˆ é™¤æ“ä½œè®°å½•è®°å…¥æ—¥å¿—ä¿å­˜ï¼Œåˆ é™¤è¡Œæ˜¯ä¸èƒ½æ¢å¤çš„ã€‚å¹¶ä¸”åœ¨åˆ é™¤çš„è¿‡ç¨‹ä¸­ä¸ä¼šæ¿€æ´»ä¸Žè¡¨æœ‰å…³çš„åˆ é™¤è§¦å‘å™¨ã€‚æ‰§è¡Œé€Ÿåº¦å¿«ã€‚ æ˜¯å¦å¯ä»¥å›žæ»š delete è¿™ä¸ªæ“ä½œä¼šè¢«æ”¾åˆ° rollback segment ä¸­,äº‹åŠ¡æäº¤åŽæ‰ç”Ÿæ•ˆã€‚truncateã€dropæ˜¯DLLï¼ˆdata define language),æ“ä½œç«‹å³ç”Ÿæ•ˆï¼ŒåŽŸæ•°æ®ä¸æ”¾åˆ° rollback segment ä¸­ï¼Œä¸èƒ½å›žæ»š. æ‰€ä»¥åœ¨æ²¡æœ‰å¤‡ä»½æƒ…å†µä¸‹ï¼Œè°¨æ…Žä½¿ç”¨ drop ä¸Ž truncateã€‚ è¡¨å’Œç´¢å¼•å çš„ç©ºé—´ å½“è¡¨è¢« TRUNCATE åŽï¼Œè¿™ä¸ªè¡¨å’Œç´¢å¼•æ‰€å ç”¨çš„ç©ºé—´ä¼šæ¢å¤åˆ°åˆå§‹å¤§å°ã€‚ è€Œ DELETE æ“ä½œä¸ä¼šå‡å°‘è¡¨æˆ–ç´¢å¼•æ‰€å ç”¨çš„ç©ºé—´ã€‚ dropè¯­å¥å°†è¡¨æ‰€å ç”¨çš„ç©ºé—´å…¨é‡Šæ”¾æŽ‰ã€‚ TRUNCATE å’Œ DELETE åªåˆ é™¤æ•°æ®ï¼Œè€Œ DROP åˆ™åˆ é™¤æ•´ä¸ªè¡¨ï¼ˆç»“æž„å’Œæ•°æ®ï¼‰ æ‰€ä»¥ä»Žå¹²å‡€ç¨‹åº¦ï¼Œdrop &gt; truncate &gt; delete okï¼Œå·®ä¸å¤šäº†ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlæœ€åŸºç¡€çŸ¥è¯†å°ç»“]]></title>
    <url>%2F2019%2F01%2F25%2Fmysql%2Fmysql%E6%9C%80%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»‹ç»å…³äºŽæ•°æ®åº“çš„æœ€æœ€æœ€æœ€åŸºæœ¬çš„ä¸€äº›è¯­æ³•çŸ¥è¯†ï¼Œå¦‚æžœè¿™äº›éƒ½ä¸ç†Ÿæ‚‰ï¼Œå»ºè®®å¤šå¤šç»ƒä¹ ï¼Œå› ä¸ºåŽç»­çš„æ–‡ç« ä¼šæ¯”è¾ƒæ·±å…¥åŽŸç†ã€‚ ä¸€ã€DDLè¯­å¥ 1ã€åˆ›å»ºæ•°æ®åº“ï¼šcreate database dbname; 2ã€åˆ é™¤æ•°æ®åº“ï¼šdrop database dbname; 3ã€åˆ›å»ºè¡¨ï¼šcreate table tname; 4ã€åˆ é™¤è¡¨ï¼šdrop table tname; 5ã€ä¿®æ”¹è¡¨ï¼šç•¥ï¼Œæ‡’å¾—çœ‹ äºŒã€DMLè¯­å¥ æ’å…¥ï¼š 1insert into table(å­—æ®µ1ï¼Œå­—æ®µ2ï¼Œ...) values (value1,value2,...) , (value3,value4,..) æ›´æ–°ï¼š 1update table set å­—æ®µ=value where ... åˆ é™¤ï¼š 1delete from table where ... è¿™é‡Œè¦æ³¨æ„ä¸‹deleteå’Œtruncateä»¥åŠdropä¸‰è€…çš„åŒºåˆ«ï¼Œä¸‹ç¯‡æ–‡ç« è¯¦è§£ã€‚ å•è¡¨æŸ¥è¯¢ï¼š 1select å­—æ®µ from table è¿žè¡¨æŸ¥è¯¢æ–¹å¼1ï¼š 1select åˆ«å1.å­—æ®µ,åˆ«å2.å­—æ®µ from table1 åˆ«å1,table2 åˆ«å2 where ... è¿žè¡¨æŸ¥è¯¢æ–¹å¼2ï¼š 1select åˆ«å1.å­—æ®µ,åˆ«å2.å­—æ®µ from table1 åˆ«å1 join table2 åˆ«å2 on ... è¿™æ˜¯å…¨è¿žæŽ¥ï¼Œè¿™é‡Œå°±è¦äº†è§£ä¸€ä¸‹ç¬›å¡å„¿ç§¯ï¼Œç®€å•æ¥è¯´ï¼Œæœ€åŽè¡Œæ•°æ˜¯å·¦è¾¹è¡¨çš„å‡½æ•°ä¹˜ä»¥å³è¾¹è¡¨çš„è¡Œæ•°ã€‚è¯¦ç»†çš„å¯ä»¥è‡ªè¡Œgoogle. æŸ¥è¯¢ä¸é‡å¤çš„è®°å½•ï¼š 1select distinct å­—æ®µ from table ... æŽ’åºï¼šé»˜è®¤æ˜¯å‡åº 1select å­—æ®µ from table where ... order by ... asc/desc limitï¼šä¸»è¦ç”¨äºŽåˆ†é¡µ 1select * from table where ... order by ... asc/desc limit èµ·å§‹åç§»ä½ç½®ï¼Œæ˜¾ç¤ºæ¡æ•° èšåˆï¼š 1select count(*)/avg(..)/sum(...)/max(...)/min(...) from table group by ... having .... æ³¨æ„è¿™é‡Œçš„havingå’Œwhereçš„åŒºåˆ«ï¼šwhereæ˜¯å¯¹è¡¨ç»“æžœè¿›è¡Œç­›é€‰ï¼Œhaving æ˜¯å¯¹æŸ¥è¯¢ç»“æžœè¿›è¡Œç­›é€‰ï¼Œä¸Žgroup by åˆç”¨ å·¦è¿žæŽ¥å’Œå³è¿žæŽ¥ å·¦è¿žæŽ¥æ„æ€å°±æ˜¯å·¦è¡¨ä¸­çš„è®°å½•éƒ½åœ¨ï¼Œå³è¡¨æ²¡æœ‰åŒ¹é…é¡¹å°±ä»¥nullæ˜¾ç¤ºã€‚è®°å½•æ•°ç­‰äºŽå·¦è¡¨çš„è¡Œæ•°ã€‚ å³è¿žæŽ¥ä¸Žä¹‹åŒç†ï¼Œå°½é‡è½¬ä¸ºå·¦è¿žæŽ¥åšã€‚ å­æŸ¥è¯¢ï¼š 1select * from table where ... in (select ....) æ‰€è°“å­æŸ¥è¯¢å°±æ˜¯æ ¹æ®å¦ä¸€ä¸ªselectçš„ç»“æžœå†è¿›è¡Œç­›é€‰ï¼Œå¸¸ç”¨çš„æ˜¯in,not in,=,!=,exits,not exits union ä¸»è¦ç”¨äºŽä¸¤å¼ è¡¨ä¸­çš„æ•°æ®çš„åˆå¹¶ï¼š 1select å­—æ®µ from table1 union all select å­—æ®µ from table2 è¦æƒ³ä¸é‡å¤ç”¨union]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€äº›å¸¸è§çš„é¢è¯•é¢˜]]></title>
    <url>%2F2019%2F01%2F25%2Fnetwork%2F8.%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%2F</url>
    <content type="text"><![CDATA[å¯¹è¿™ä¸€å—æ•´ç†ä¸€äº›å¸¸è§çš„é¢è¯•é¢˜ã€‚ 1.TCPä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ è¿™éƒ¨åˆ†ç•¥ã€‚å‰é¢å·²ç»è¯´çš„å¾ˆè¯¦ç»†ï¼ŒåŒ…æ‹¬æ¡æ‰‹ä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡ã€ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡ï¼Œä¸ºä»€ä¹ˆæŒ¥æ‰‹è¦ç­‰2MSLçš„æ—¶é—´ã€‚ 2.å¸¸è§çš„HTTPçŠ¶æ€ç åŠå…¶å«ä¹‰ 200 OKï¼šæ­£å¸¸è¿”å›žä¿¡æ¯ 400 Bad Reqestï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£ 401 Unauthorizedï¼šè¯·æ±‚æœªç»æŽˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ç å¿…é¡»ä¸ŽWWW-AuthenticateæŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨ 403 Forbiddenï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡ 404 Not Foundï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ 500 Internal Server Errorï¼šæœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯ 503 Server Unavilableï¼šæœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åŽå¯èƒ½æ¢å¤æ­£å¸¸ 3.Getè¯·æ±‚å’ŒPostè¯·æ±‚çš„åŒºåˆ« HttpæŠ¥æ–‡å±‚é¢ï¼šGETå°†è¯·æ±‚ä¿¡æ¯æ”¾åœ¨URLï¼ŒPOSTåˆ™æ”¾åœ¨æŠ¥æ–‡ä½“ä¸­ æ•°æ®åº“å±‚é¢ï¼šGETç¬¦åˆå¹‚ç­‰æ€§å’Œå®‰å…¨æ€§(æŸ¥è¯¢ä¸ä¼šæ”¹å˜æ•°æ®åº“)ï¼ŒPOSTä¸ç¬¦åˆ å…¶ä»–å±‚é¢ï¼šGETå¯ä»¥è¢«ç¼“å­˜ã€è¢«å­˜å‚¨ä¸ºä¹¦ç­¾ï¼Œè€ŒPOSTä¸è¡Œ 4.Cookieå’ŒSessionçš„åŒºåˆ« å¯¹äºŽsessionï¼Œå­—é¢ä¸Šç†è§£æ˜¯ä¼šè¯ï¼Œå¯ä»¥ç†è§£ä¸ºç”¨æˆ·ä¸ŽæœåŠ¡ç«¯ä¸€å¯¹ä¸€çš„äº¤äº’ã€‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µã€‚ ä½†æ˜¯æˆ‘ä»¬å¸¸è¯´çš„sessionå…¶å®žæ˜¯è¿™é‡ŒæŠ½è±¡æ¦‚å¿µçš„ä¸€ç§å®žçŽ°æ–¹å¼ç½¢äº†ï¼Œæˆ‘è§‰å¾—æ²¡æœ‰å¿…è¦å’¬æ–‡åš¼å­—ï¼Œä¸‹é¢ç›´æŽ¥ä»Žé¢è¯•è§’åº¦æ¥åˆ†æžä¸€ä¸‹ã€‚ ç”±äºŽHTTPåè®®æ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦è®°å½•ç”¨æˆ·çš„çŠ¶æ€æ—¶ï¼Œå°±éœ€è¦ç”¨æŸç§æœºåˆ¶æ¥è¯†å…·ä½“çš„ç”¨æˆ·ï¼Œè¿™ä¸ªæœºåˆ¶å°±æ˜¯Session.å…¸åž‹çš„åœºæ™¯æ¯”å¦‚è´­ç‰©è½¦ï¼Œå½“ä½ ç‚¹å‡»ä¸‹å•æŒ‰é’®æ—¶ï¼Œç”±äºŽHTTPåè®®æ— çŠ¶æ€ï¼Œæ‰€ä»¥å¹¶ä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œæ‰€ä»¥æœåŠ¡ç«¯è¦ä¸ºç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºäº†ç‰¹å®šçš„Sessionï¼Œç”¨ç”¨äºŽæ ‡è¯†è¿™ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”è·Ÿè¸ªç”¨æˆ·ï¼Œè¿™æ ·æ‰çŸ¥é“è´­ç‰©è½¦é‡Œé¢æœ‰å‡ æœ¬ä¹¦ã€‚ è¿™ä¸ªSessionæ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ï¼Œæœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªå”¯ä¸€æ ‡è¯†å¯¹åº”ä¸€ä¸ªç”¨æˆ·ã€‚åœ¨æœåŠ¡ç«¯ä¿å­˜Sessionçš„æ–¹æ³•å¾ˆå¤šï¼Œå†…å­˜ã€æ•°æ®åº“ã€æ–‡ä»¶éƒ½æœ‰ã€‚ æœåŠ¡ç«¯è§£å†³äº†ç”¨æˆ·æ ‡è¯†é—®é¢˜ï¼Œä½†æ˜¯æœåŠ¡ç«¯æ€Žä¹ˆçŸ¥é“æ­¤æ—¶æ“ä½œæµè§ˆå™¨çš„ç”¨æˆ·æ˜¯è°å‘¢ï¼Ÿ è¿™ä¸ªæ—¶å€™Cookieå°±ç™»åœºäº†ã€‚æ¯æ¬¡HTTPè¯·æ±‚çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šå‘é€ç›¸åº”çš„Cookieä¿¡æ¯åˆ°æœåŠ¡ç«¯ã€‚ å®žé™…ä¸Šå¤§å¤šæ•°çš„åº”ç”¨éƒ½æ˜¯ç”¨ Cookie æ¥å®žçŽ°Sessionè·Ÿè¸ªçš„ï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºSessionçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šåœ¨HTTPåè®®ä¸­å‘Šè¯‰å®¢æˆ·ç«¯(æ”¾åœ¨å“åº”å¤´ä¸­è¿”å›ž)ï¼Œéœ€è¦åœ¨ Cookie é‡Œé¢è®°å½•ä¸€ä¸ªSession IDï¼Œä»¥åŽæ¯æ¬¡è¯·æ±‚(è¯·æ±‚å¤´)æŠŠè¿™ä¸ªä¼šè¯IDå‘é€åˆ°æœåŠ¡å™¨ï¼Œæˆ‘å°±çŸ¥é“ä½ æ˜¯è°äº†ã€‚ æœ‰äººé—®ï¼Œå¦‚æžœå®¢æˆ·ç«¯çš„æµè§ˆå™¨ç¦ç”¨äº† Cookie æ€Žä¹ˆåŠžï¼Ÿä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ä¸€ç§å«åšURLé‡å†™çš„æŠ€æœ¯æ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼Œå³æ¯æ¬¡HTTPäº¤äº’ï¼ŒURLåŽé¢éƒ½ä¼šè¢«é™„åŠ ä¸Šä¸€ä¸ªè¯¸å¦‚ sid=xxxxx è¿™æ ·çš„å‚æ•°ï¼ŒæœåŠ¡ç«¯æ®æ­¤æ¥è¯†åˆ«ç”¨æˆ·ã€‚ Cookieå…¶å®žè¿˜å¯ä»¥ç”¨åœ¨ä¸€äº›æ–¹ä¾¿ç”¨æˆ·çš„åœºæ™¯ä¸‹ï¼Œè®¾æƒ³ä½ æŸæ¬¡ç™»é™†è¿‡ä¸€ä¸ªç½‘ç«™ï¼Œä¸‹æ¬¡ç™»å½•çš„æ—¶å€™ä¸æƒ³å†æ¬¡è¾“å…¥è´¦å·äº†ï¼Œæ€Žä¹ˆåŠžï¼Ÿè¿™ä¸ªä¿¡æ¯å¯ä»¥å†™åˆ°Cookieé‡Œé¢ï¼Œè®¿é—®ç½‘ç«™çš„æ—¶å€™ï¼Œç½‘ç«™é¡µé¢çš„è„šæœ¬å¯ä»¥è¯»å–è¿™ä¸ªä¿¡æ¯ï¼Œå°±è‡ªåŠ¨å¸®ä½ æŠŠç”¨æˆ·åç»™å¡«äº†ï¼Œèƒ½å¤Ÿæ–¹ä¾¿ä¸€ä¸‹ç”¨æˆ·ã€‚è¿™ä¹Ÿæ˜¯Cookieåç§°çš„ç”±æ¥ï¼Œç»™ç”¨æˆ·çš„ä¸€ç‚¹ç”œå¤´ã€‚ æ€»ç»“ï¼š Sessionæ˜¯åœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¸€ä¸ªæ•°æ®ç»“æž„ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥ä¿å­˜åœ¨é›†ç¾¤ã€æ•°æ®åº“ã€æ–‡ä»¶ä¸­ï¼› Cookieæ˜¯å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å®žçŽ°Sessionçš„ä¸€ç§æ–¹å¼ã€‚ ä¸‹é¢è¯´ä¸€ä¸‹å¾ˆå¸¸è§çš„ä¸€ç§å†™æ³•ã€‚æ¯”å¦‚åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘æ­¤æ—¶ç™»é™†ä½ çš„ç½‘ç«™äº†ï¼Œä½ å¯ä»¥å°†æˆ‘çš„ä¿¡æ¯ä¿å­˜åœ¨sessionä¸­ï¼š 12User currentUserInfo = userService.getUserByUsernameAndPasswd(username,password);session.setAttribute("currentUser",currentUserInfo); ä¸‹æ¬¡ï¼Œæˆ‘å°±å¯ä»¥åœ¨æˆ‘ä»¬ä¹‹é—´çš„ä¼šè¯ä¸­éšæ—¶èŽ·å–æˆ‘çš„ä¸ªäººä¿¡æ¯ï¼š 1User currentUser = session.getAttribute("currentUser"); å…¶å®žè¿™äº›å°±æ˜¯åˆ©ç”¨å­˜æ”¾åœ¨Cookieä¸­çš„JSESSIONIDæ¥å®žçŽ°çš„ã€‚ 5.HTTPå’ŒHRTTPSçš„å…³ç³» æ¥è¯´ä¸€ä¸‹SSL(Security Sockets Layerï¼Œå®‰å…¨å¥—æŽ¥å±‚) ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®® æ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–çš„APIï¼ŒSSL3.0ä¹‹åŽæ›´åä¸ºTLS é‡‡ç”¨èº«ä»½éªŒè¯å’Œæ•°æ®åŠ å¯†ä¿è¯ç½‘ç»œé€šä¿¡çš„å®‰å…¨å’Œæ•°æ®çš„å®Œæ•´æ€§ HTTPSæ•°æ®ä¼ è¾“æµç¨‹ï¼š æµè§ˆå™¨å°†æ”¯æŒçš„åŠ å¯†ç®—æ³•ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ æœåŠ¡å™¨é€‰æ‹©ä¸€å¥—æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†ç®—æ³•ï¼Œä»¥è¯ä¹¦çš„å½¢å¼å›žå‘æµè§ˆå™¨ æµè§ˆå™¨éªŒè¯è¯ä¹¦åˆæ³•æ€§ï¼Œå¹¶ç»“åˆè¯ä¹¦å…¬é’¥åŠ å¯†ä¿¡æ¯å‘ç»™æœåŠ¡å™¨ æœåŠ¡å™¨ä½¿ç”¨ç§é’¥è§£å¯†ä¿¡æ¯ï¼ŒéªŒè¯å“ˆå¸Œï¼ŒåŠ å¯†å“åº”æ¶ˆæ¯å›žå‘æµè§ˆå™¨ æµè§ˆå™¨è§£å¯†å“åº”æ¶ˆæ¯ï¼Œå¹¶å¯¹æ¶ˆæ¯è¿›è¡ŒéªŒè¯ï¼Œä¹‹åŽè¿›è¡ŒåŠ å¯†äº¤äº’æ•°æ® è¿™ä¸ªä¹Ÿå°±ä¸èµ˜è¿°äº†ï¼Œä¸‹é¢ç›´æŽ¥è¯´è¯´åŒºåˆ«ã€‚ HTTPSéœ€è¦åˆ°CAç”³è¯·è¯ä¹¦ï¼ŒHTTPä¸éœ€è¦ HTTPSå¯†æ–‡ä¼ è¾“ï¼ŒHTTPæ˜Žæ–‡ä¼ è¾“ è¿žæŽ¥æ–¹å¼ä¸åŒï¼ŒHTTPSé»˜è®¤ä½¿ç”¨443ç«¯å£ï¼ŒHTTPä½¿ç”¨80ç«¯å£ HTTPS=HTTP+åŠ å¯†+è®¤è¯+å®Œæ•´æ€§ä¿æŠ¤ï¼Œæ›´å®‰å…¨ ä½†æ˜¯ä»ç„¶å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼š æµè§ˆå™¨é»˜è®¤å¡«å……http://ï¼Œè¯·æ±‚éœ€è¦è¿›è¡Œè·³è½¬ï¼Œæœ‰è¢«åŠ«æŒçš„é£Žé™© å¯ä»¥ä½¿ç”¨HSTS(HTTP Strict Transport Security)ä¼˜åŒ–ï¼ˆè¿™ä¸ªè¿˜ä¸æœªä¸»æµï¼Œé¢è¯•é—®çš„å°‘ï¼‰ Socketç®€ä»‹ æˆ‘ä»¬çŸ¥é“ï¼Œè¿›ç¨‹ä¸Žè¿›ç¨‹ç›´æŽ¥çš„é€šä¿¡æœ€åŸºæœ¬çš„è¦æ±‚æ˜¯ï¼šå¯ä»¥å”¯ä¸€ç¡®å®šè¿›ç¨‹ã€‚ åœ¨æœ¬åœ°è¿›ç¨‹é€šä¿¡ä¸­ï¼Œå¯ä»¥ç”¨PIDæ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ã€‚ ä½†æ˜¯PIDåªåœ¨æœ¬åœ°å”¯ä¸€ï¼Œç½‘ç»œä¸­PIDå†²çªçš„å‡ çŽ‡è¿˜æ˜¯å­˜åœ¨çš„ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œåˆ°IPå±‚å°±å¯ä»¥å”¯ä¸€å®šä½åˆ°ä¸€å°ä¸»æœºäº†ï¼ŒTCPå±‚(tcpåè®®+ç«¯å£å·)å¯ä»¥å”¯ä¸€å®šä½ä¸€å°ä¸»æœºä¸­çš„ä¸€ä¸ªè¿›ç¨‹ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ipåœ°å€+åè®®+ç«¯å£å·å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€å°ä¸»æœºçš„ä¸€ä¸ªè¿›ç¨‹ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡socketè¿›è¡Œç½‘ç»œé€šä¿¡äº†ã€‚ socketæ˜¯å¯¹TCP/IPåè®®çš„æŠ½è±¡ï¼Œæ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–å¼€æ”¾çš„æŽ¥å£ã€‚ socketèµ·æºäºŽunixï¼Œè€Œunixæ˜¯éµä»Žä¸€åˆ‡çš†æ–‡ä»¶çš„å“²å­¦ã€‚Socketæ˜¯ä¸€ç§åŸºäºŽä»Žæ‰“å¼€ã€è¯»/å†™ã€å…³é—­çš„æ¨¡å¼å®žçŽ°çš„ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å„è‡ªç»´æŠ¤ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿žæŽ¥å»ºç«‹åŽï¼Œå¯ä»¥ä¾›å¯¹æ–¹è¯»å–æˆ–è€…è¯»å–å¯¹æ–¹å†…å®¹ã€‚ socketç›¸å…³é¢˜ç›® ç¼–å†™ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å­—ç¬¦ä¸²ä¹‹åŽæ‰“å°åˆ°å‘½ä»¤è¡Œä¸Šï¼Œç„¶åŽå‘å®¢æˆ·ç«¯è¿”å›žè¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæœ€åŽï¼Œå®¢æˆ·ç«¯è¾“å‡ºæœåŠ¡ç«¯è¿”å›žçš„è¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ†åˆ«ç”¨TCPå’ŒUDPä¸¤ç§æ–¹å¼åŽ»å®žçŽ°ã€‚ ä»£ç åœ°å€ï¼šhttps://github.com/sunweiguo/TcpAndUdp/]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAåŸºç¡€æ ¸å¿ƒ-ç†è§£ç±»ã€å¯¹è±¡ã€é¢å‘å¯¹è±¡ç¼–ç¨‹ã€é¢å‘æŽ¥å£ç¼–ç¨‹]]></title>
    <url>%2F2019%2F01%2F24%2Fjava-basic%2FJAVA%E5%9F%BA%E7%A1%80%E6%A0%B8%E5%BF%83-%E7%90%86%E8%A7%A3%E7%B1%BB%E3%80%81%E5%AF%B9%E8%B1%A1%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E3%80%81%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯ç±»ï¼Œä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Œä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä»€ä¹ˆæ˜¯é¢å‘æŽ¥å£ç¼–ç¨‹ã€‚å­¦ä¹ é¢å‘å¯¹è±¡æ€æƒ³çš„è¯­è¨€ï¼Œæ¯”å¦‚javaï¼Œç¬¬ä¸€å…³å¯èƒ½å°±æ˜¯è¦ç†è§£è¿™äº›æ¦‚å¿µã€‚ä¸‹é¢å°±æ¥å¥½å¥½ç¢ç£¨ä¸€ä¸‹ã€‚ ç±»å’Œå¯¹è±¡çš„æ¦‚å¿µ é¦–å…ˆæ€»ç»“ä¸€ä¸‹ï¼šç±»æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯¹è±¡å°±æ˜¯ç”¨è¿™ä¸ªæ¨¡æ¿åˆ›é€ å‡ºæ¥çš„ä¸œè¥¿ã€‚ æ¯”å¦‚ï¼Œç”·å­©ï¼Œä»–å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œç”·çš„å°±è¡Œï¼Œé‚£ä¹ˆå¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯å…·ä½“æŸä¸ªç”·å­©ï¼Œæ¯”å¦‚ç”·å­©BOBï¼Œç”·å­©fourColor. è¯·çœ‹ä¸‹é¢ä¸€å¼ å›¾ï¼š ç”·å­©å¥³å­©æ˜¯æ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µï¼Œæ˜¯æ¨¡æ¿ï¼Œå·¦è¾¹ä¸€æŽ’å°±æ˜¯å…¶å…·ä½“çš„ä¸€äº›å¯¹è±¡ã€‚ä½ çœ‹é•¿çš„éƒ½ä¸ä¸€æ ·ï¼Œæœ‰çš„é»‘ï¼Œæœ‰çš„ç™½ï¼Œæœ‰çš„é«˜ï¼Œæœ‰çš„çŸ®ï¼Œå›½å®¶åœ°åŒºä¹Ÿä¸ä¸€æ ·ã€‚ä½†æ˜¯ä»–ä»¬éƒ½å±žäºŽç”·å­©æˆ–è€…å¥³å­©ã€‚ é‚£ä¹ˆåŒç†ï¼Œäººå°±æ˜¯ä¸€ä¸ªç±»ï¼Œç”·å­©å¥³å­©å°±æ˜¯äººçš„å­ç±»ï¼Œå› ä¸ºäººå¯èƒ½ä¸ä»…åŒ…æ‹¬ç”·å­©å¥³å­©ï¼Œè¿˜åŒ…æ‹¬ç¬¬ä¸‰æ€§åˆ«è¿™ä¸ªç±»ã€‚ è¿™é‡Œè¿˜å¼•å‡ºäº†JAVAç‰¹æ€§ä¸­çš„ç»§æ‰¿ã€‚ç»§æ‰¿ç®€å•ç†è§£å°±æ˜¯çˆ¶ç±»æœ‰çš„ä¸œè¥¿(è®¿é—®çº§åˆ«ä¸èƒ½æ˜¯private)çš„ï¼Œé‚£éƒ½æ˜¯ä½ çš„ã€‚æ¯”å¦‚ä½ è€çˆ¸çš„æˆ¿å­ï¼Œå°±æ˜¯å±žäºŽä½ çš„ï¼Œä½ å‡ºå…¥è‡ªç”±ã€‚ äººè¿˜å¯ä»¥åˆ†ä¸ºèƒ–äººå’Œç˜¦äººè¿™ä¸ªå­ç±»ã€‚æ‰€ä»¥åªè¦æ˜¯æŠ½è±¡çš„æ¨¡æ¿ï¼Œå°±æ˜¯ä¸€ä¸ªç±»ã€‚ å¯¹è±¡ï¼šå¯¹è±¡æ˜¯ç±»çš„ä¸€ä¸ªå®žä¾‹ï¼ˆå¯¹è±¡ä¸æ˜¯æ‰¾ä¸ªå¥³æœ‹å‹ï¼‰ï¼Œæœ‰çŠ¶æ€å’Œè¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä¸€æ¡ç‹—æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„çŠ¶æ€æœ‰ï¼šé¢œè‰²ã€åå­—ã€å“ç§ï¼›è¡Œä¸ºæœ‰ï¼šæ‘‡å°¾å·´ã€å«ã€åƒç­‰ã€‚ ç±»ï¼šç±»æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå®ƒæè¿°ä¸€ç±»å¯¹è±¡çš„è¡Œä¸ºå’ŒçŠ¶æ€ã€‚ ä¸‹é¢å°±æ‹¿ç‹—è¿™ä¸ªç±»æ¥è¯´äº‹ã€‚ç‹—æ˜¯åŠ¨ç‰©è¿™ä¸ªç±»çš„å­ç±»ã€‚ Javaä¸­åˆ›å»ºç±» æž„é€ å™¨æ–¹æ³•è¯´æ˜Ž éœ€è¦åˆ›é€ ä¸€ä¸ªç±»å¯¹è±¡å‡ºæ¥çš„æ—¶å€™ï¼Œè¦ç”¨åˆ°è¿™ä¸ªç±»çš„æž„é€ å™¨æ–¹æ³•ï¼Œé‚£ä¹ˆå•¥æ˜¯æž„é€ å™¨æ–¹æ³•å‘¢ï¼Ÿæž„é€ å™¨æ–¹æ³•å°±æ˜¯åˆ›é€ ç±»æ—¶çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå’Œç±»åŒåçš„æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨é‡Œé¢å†™è‡ªå·±çš„ä»£ç  1234567891011121314151617181920//æ¨¡ç‰ˆclass ç±»åç§° &#123; è®¿é—®æƒé™ æž„é€ æ–¹æ³•åç§°()&#123; &#125;&#125;//ä¾‹å­public class Dog&#123; //æž„é€ æ–¹æ³•ä¸€ public Dog()&#123; System.out.println("nothing to do..."); &#125; //æž„é€ æ–¹æ³•äºŒ public Dog(String name)&#123; //è¿™é‡Œå°±å¯ä»¥ç»™æ¯æ¡newå‡ºæ¥çš„å¯¹è±¡(ç‹—)åˆå§‹åŒ–ä¸€ä¸ªåå­— System.out.println("hi,my name is "+name); &#125;&#125; ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå®Œæ•´çš„ç±» 1234567891011121314151617181920212223242526272829//æ¨¡ç‰ˆclass ç±»åç§° &#123; //æž„é€ å™¨æ–¹æ³• //å£°æ˜Žæˆå‘˜å˜é‡---è¿™ä¸ªå˜é‡å±žäºŽè¿™ä¸ªç±» //å£°æ˜Žæˆå‘˜æ–¹æ³• //åœ¨æ–¹æ³•é‡Œé¢å®šä¹‰çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼ŒåŒºåˆ«äºŽæˆå‘˜å˜é‡&#125;//ä¾‹å­public class Dog &#123; //æž„é€ æ–¹æ³•ä¸€ public Dog()&#123; System.out.println("nothing to do..."); &#125; //æž„é€ æ–¹æ³•äºŒ public Dog(String name)&#123; //è¿™é‡Œå°±å¯ä»¥ç»™æ¯æ¡newå‡ºæ¥çš„å¯¹è±¡(ç‹—)åˆå§‹åŒ–ä¸€ä¸ªåå­— System.out.println("hi,my name is "+name); &#125; //ç‹—çš„é¢œè‰²--æˆå‘˜å±žæ€§ public String color;//ä¸€èˆ¬æ˜¯privateï¼Œèµ‹å€¼ç”¨setæ–¹æ³•ï¼Œå–å€¼ç”¨getæ–¹æ³•ï¼Œè¿™é‡Œåªæ˜¯æ¼”ç¤º //ç‹—çš„è¡Œä¸ºï¼Œå®ƒä¼šå«---æˆå‘˜æ–¹æ³• private void say()&#123; int i = 0;//å±€éƒ¨å˜é‡ System.out.println("æˆ‘ä¼šå«ï¼šæ±ªæ±ªæ±ª~"); &#125;&#125; åˆ›å»ºå¯¹è±¡ è¯­æ³•ï¼š ç±»å å¯¹è±¡å = new ç±»å() ; ä¸¾ä¾‹ï¼š 12Dog fourcolor ; // å…ˆå£°æ˜Žä¸€ä¸ª Dog ç±»çš„å¯¹è±¡ fourcolorfourcolor = new Dog(&quot;fourcolor&quot;) ; // ç”¨ new å…³é”®å­—å®žä¾‹åŒ– Dog çš„å¯¹è±¡ fourcolor,æ­¤æ—¶è°ƒç”¨æž„é€ æ–¹æ³•äºŒ é€šè¿‡Dogè¿™ä¸ªç±»å¯ä»¥åˆ›é€ å‡ºfourcolorå¯¹è±¡.ä¸‹é¢æˆ‘æ‰èƒ½æ“ä½œè¿™ä¸ªå¯¹è±¡ï¼š 1234//è®©å®ƒçš„é¢œè‰²ä¸ºé»‘è‰²fourcolor.color = &quot;black&quot;;//è®©å®ƒå«fourcolor.say(); é¢å‘å¯¹è±¡ åœ¨ç†è§£äº†ä»€ä¹ˆæ˜¯ç±»ï¼Œä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Œå°±å¯ä»¥æ¥è¯´è¯´é¢å‘å¯¹è±¡åˆ°åº•æ˜¯ä»€ä¹ˆäº†ã€‚ å…ˆæ¥è¯´è¯´é¢å‘è¿‡ç¨‹ï¼Œå¤§å®¶éƒ½å­¦ä¹ è¿‡Cè¯­è¨€ã€‚Cè¯­è¨€å°±æ˜¯å…¸åž‹çš„é¢å‘è¿‡ç¨‹çš„è¯­è¨€ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šè¦æŠŠå¤§è±¡è£…è¿›å†°ç®±é‡Œï¼Œè¿™ä»¶äº‹ï¼Œé¢å‘è¿‡ç¨‹çš„ç¨‹åºå‘˜æ˜¯è¿™æ ·æ€è€ƒçš„ï¼š æŠŠå†°ç®±é—¨å„¿æ‰“å¼€ã€‚ æŠŠå¤§è±¡è£…è¿›åŽ»ã€‚ æŠŠå†°ç®±é—¨å„¿å…³ä¸Šã€‚ ä¸Šé¢çš„æ¯ä¸€ä»¶äº‹éƒ½ç”¨ä¸€ä¸ªå‡½æ•°æ¥å®žçŽ°ã€‚æŠ½è±¡ä¸ºä¸‹é¢ä¸‰ä¸ªå‡½æ•°ï¼š openTheDoor()ï¼› pushElephant()ï¼› closeTheDoor()ï¼› è¿™æ ·ä¸æŒºå¥½çš„å—ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨é¢å‘è¿‡ç¨‹çš„è¿™ç§æ€ç»´æ¥ç¼–ç¨‹å‘¢ï¼Œè¿˜è¦æžå‡ºä»€ä¹ˆé¢å‘å¯¹è±¡æ¥ã€‚ éœ€æ±‚åˆæ¥å•¦ï¼š ã€Œæˆ‘è¦æŠŠå¤§è±¡è£…å¾®æ³¢ç‚‰é‡Œã€ ã€Œæˆ‘è¦æŠŠç‹®å­ä¹Ÿè£…å†°ç®±é‡Œã€ ã€Œæˆ‘è¦æŠŠå¤§è±¡è£…å†°ç®±ï¼Œä½†æ˜¯é—¨åˆ«å…³ï¼Œæ•žç€å°±è¡Œã€ è¿™ä¸ªæ—¶å€™ï¼Œé¢å‘è¿‡ç¨‹çš„ç¨‹åºå‘˜å°±æ‚²å‰§äº†ï¼Œæ¥ä¸€ä¸ªéœ€æ±‚æˆ‘å°±å†™ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘è¿˜èƒ½ä¸‹ç­å—ï¼Ÿ é¢å‘å¯¹è±¡ä»Žå¦ä¸€ä¸ªè§’åº¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒæŠ›å¼ƒäº†å‡½æ•°ï¼ŒæŠŠã€Œå¯¹è±¡ã€ä½œä¸ºç¨‹åºçš„åŸºæœ¬å•å…ƒã€‚ é¢å‘å¯¹è±¡çš„ä¸–ç•Œé‡Œï¼Œåˆ°å¤„éƒ½æ˜¯å¯¹è±¡ã€‚å³ï¼šä¸‡ç‰©çš†å¯¹è±¡ã€‚ æ¯”å¦‚äººè¿™ä¸ªç±»ï¼Œæ¯ä¸ªå…·ä½“çš„äºº(å¯¹è±¡)éƒ½è¦æœ‰è¿™æ ·çš„å±žæ€§ï¼šèº«é«˜ã€ä½“é‡ã€å¹´é¾„ã€‚æ¯ä¸ªäººéƒ½æœ‰è¿™æ ·çš„è¡Œä¸ºï¼šåƒé¥­ã€ç¡è§‰ã€ä¸ŠåŽ•æ‰€ã€‚ é‚£ä¹ˆï¼Œè¿™äº›é€šç”¨çš„å±žæ€§+æ–¹æ³•å¯ä»¥æž„å»ºä¸€ä¸ªæ¨¡æ¿ï¼šäººè¿™ä¸ªç±»ã€‚å› ä¸ºæ¯ä¸ªå…·ä½“çš„äººï¼ˆå¯¹è±¡ï¼‰éƒ½éœ€è¦è¿™äº›åŸºæœ¬çš„ä¸œè¥¿ã€‚å½“ç„¶äº†ï¼Œæ¯ä¸ªäººå…·ä½“ä»€ä¹ˆèº«é«˜ã€ä»€ä¹ˆä½“é‡ã€åƒä»€ä¹ˆéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ¯ä¸ªå¯¹è±¡ä¸€èˆ¬éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚ä½†æ˜¯æ¨¡æ¿æ˜¯ä¸€æ ·çš„ã€‚ é‚£ä¹ˆï¼Œå›žåˆ°åˆšæ‰çš„éœ€æ±‚ï¼Œé¢å‘å¯¹è±¡æ˜¯å¦‚ä½•æ€è€ƒè¿™ä»¶äº‹çš„å‘¢ï¼Ÿ å‘å†°ç®±ä¸‹è¾¾ã€Œå¼€é—¨ã€çš„å‘½ä»¤ã€‚ å‘å¤§è±¡ä¸‹è¾¾ã€Œè¿›å†°ç®±ã€çš„å‘½ä»¤ã€‚ å‘å†°ç®±ä¸‹è¾¾ã€Œå…³é—¨ã€çš„å‘½ä»¤ã€‚ å°±æ˜¯è¯´ï¼Œæˆ‘ä¸ç”¨äº²è‡ªç®¡å¼€é—¨çš„ç»†èŠ‚ï¼Œæˆ‘åªè¦å«ä»–å¼€é—¨å³å¯ã€‚ æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡ï¼Œåº”è¯¥æ˜¯åˆšåˆšå¥½èƒ½åšå®Œå®ƒèƒ½åšçš„äº‹æƒ…ï¼Œä¸å¤šåšï¼Œä¸å°‘åšã€‚å¤šåšäº†å®¹æ˜“è€¦åˆï¼Œå„ç§åŠŸèƒ½æ‚ç³…åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œã€‚æ¯”å¦‚æˆ‘æœ‰ä¸€ä¸ªå¯¹è±¡å«ã€Œæ±½è½¦ã€ï¼Œå¯ä»¥ã€Œè¡Œé©¶ã€ï¼Œå¯ä»¥ã€Œè½½äººã€ï¼ŒçŽ°åœ¨çš„éœ€æ±‚æ˜¯è¦å®žçŽ°ã€Œè½½äººé£žè¡Œã€ï¼Œå°±ä¸èƒ½é‡ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æ–°å®šä¹‰ä¸€ä¸ªå¯¹è±¡ã€Œé£žæœºã€æ¥åšã€‚å¦‚æžœä½ ç»™ã€Œæ±½è½¦ã€æ’ä¸Šäº†ç¿…è†€ï¼Œèµ‹äºˆäº†å®ƒã€Œé£žè¡Œã€çš„èƒ½åŠ›ï¼Œé‚£ä¹ˆæ–°æ¥çš„åŒå­¦é¢å¯¹ä½ çš„ä»£ç å°±ä¼šèŽ«åå…¶å¦™ï¼Œæ— ä»Žä¸‹æ‰‹ã€‚ ä½†æ˜¯ä¸ç¦è¦é—®ï¼šæ€Žä¹ˆå®žçŽ°è¿™ç§ä¸‹è¾¾å‘½ä»¤å°±å¯ä»¥è‡ªåŠ¨åŽ»æ‰§è¡Œçš„æ•ˆæžœå‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œæˆ‘æ€Žä¹ˆçŸ¥é“å®ƒæœ‰è¿™ä¸ªåŠŸèƒ½å•Šï¼ é¢å‘æŽ¥å£ç¼–ç¨‹ çŽ°åœ¨æˆ‘ä»¬æŠŠã€Œæ•°æ®ã€å’Œã€Œè¡Œä¸ºã€éƒ½å°è£…åˆ°äº†å¯¹è±¡é‡Œï¼Œç›¸å½“äºŽå¯¹è±¡æˆäº†ä¸€ä¸ªé»‘åŒ£å­ï¼Œé‚£æˆ‘ä»¬æ€Žä¹ˆçŸ¥é“å¯¹è±¡å…·æœ‰ä»€ä¹ˆæ ·çš„èƒ½åŠ›å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜çš„å…³é”®å°±æ˜¯æŽ¥å£ã€‚ å› ä¸ºæ— è®ºæ˜¯æŠŠå¤§è±¡è£…è¿›æ´—è¡£æœºè¿˜æ˜¯å†°ç®±ï¼Œéƒ½è¦æ±‚æ´—è¡£æœºæˆ–è€…å†°ç®±æœ‰å¼€é—¨å’Œå…³é—¨çš„åŠŸèƒ½ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠ½è±¡å‡ºæ¥ä¸€ä¸ªæŽ¥å£ï¼šã€è‡ªåŠ¨é—¨ã€‘ã€‚è¿™ä¸ªæŽ¥å£é‡Œé¢å®šä¹‰ä¸¤ä¸ªèƒ½åŠ›ï¼šã€å¼€é—¨ã€‘å’Œã€å…³é—¨ã€‘ã€‚ è®©æ´—è¡£æœºã€å†°ç®±ã€å¾®æ³¢ç‚‰è¿™äº›å¸¦é—¨çš„ä¸œè¥¿å…¨éƒ¨å®žçŽ°ã€è‡ªåŠ¨é—¨ã€‘æŽ¥å£ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæ¯ä¸ªå…·ä½“çš„å®žçŽ°å¯èƒ½ç•¥æœ‰ä¸åŒï¼Œæ¯”å¦‚å†°ç®±å¼€é—¨æ˜¯å¾€å¤–æ‹½ï¼Œä½†æ˜¯æ´—è¡£æœºå¼€é—¨å¯èƒ½æ˜¯å¾€ä¸Šç¿»ç›–å­ã€‚ æ­¤æ—¶ï¼Œæˆ‘æœ‰ä¸€ä¸ªéœ€æ±‚ï¼ŒæŠŠå¤§è±¡æ”¾è¿›å†°ç®±ã€‚æˆ‘ä¸€çœ‹ï¼Œå†°ç®±å®žçŽ°äº†ã€è‡ªåŠ¨é—¨ã€‘è¿™ä¸ªæŽ¥å£ï¼Œé‡Œé¢æœ‰ã€å¼€é—¨ã€‘å’Œã€å…³é—¨ã€‘ä¸¤ä¸ªæ–¹æ³•ï¼Œokï¼Œæˆ‘çŸ¥é“å†°ç®±æ˜¯å¯ä»¥å¼€é—¨å’Œå…³é—¨äº†ï¼Œé‚£å°±å¥½åŠžäº†ã€‚æˆ‘ç›´æŽ¥ä¸‹è¾¾å‘½ä»¤å³å¯ã€‚è¿˜æ˜¯è·Ÿä¸Šé¢ä¸€æ ·çš„æ­¥éª¤. å‘å†°ç®±ä¸‹è¾¾ã€Œå¼€é—¨ã€çš„å‘½ä»¤ã€‚ å‘å¤§è±¡ä¸‹è¾¾ã€Œè¿›å†°ç®±ã€çš„å‘½ä»¤ã€‚ å‘å†°ç®±ä¸‹è¾¾ã€Œå…³é—¨ã€çš„å‘½ä»¤ã€‚ æ­¤æ—¶ï¼Œéœ€è¦å°†ç‹®å­ä¹Ÿè£…å†°ç®±é‡Œã€‚é‚£è¿˜æ˜¯ä¸€æ ·ï¼š å‘å†°ç®±ä¸‹è¾¾ã€Œå¼€é—¨ã€çš„å‘½ä»¤ã€‚ å‘ç‹®å­ä¸‹è¾¾ã€Œè¿›å†°ç®±ã€çš„å‘½ä»¤ã€‚ å‘å†°ç®±ä¸‹è¾¾ã€Œå…³é—¨ã€çš„å‘½ä»¤ã€‚ æ­¤æ—¶ï¼Œæˆ‘è¦æŠŠå¤§è±¡è£…å†°ç®±ï¼Œä½†æ˜¯é—¨åˆ«å…³ï¼Œæ•žç€å°±è¡Œï¼Œé‚£å°±ï¼š å‘å†°ç®±ä¸‹è¾¾ã€Œå¼€é—¨ã€çš„å‘½ä»¤ã€‚ å‘å¤§è±¡ä¸‹è¾¾ã€Œè¿›å†°ç®±ã€çš„å‘½ä»¤ã€‚ æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿå†°ç®±ä¹Ÿå¯ä»¥æ¢ï¼Œæˆ‘å¯ä»¥æ¢æˆä»»ä½•ä¸œè¥¿ï¼Œåªè¦å®žçŽ°äº†è¿™ä¸ªæŽ¥å£ï¼Œè¿™äº›ä¸œè¥¿å°±éƒ½æœ‰è¿™äº›èƒ½åŠ›ï¼Œé‚£æˆ‘æ‰ä¸ç®¡é‡Œé¢åˆ°åº•æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Œç›´æŽ¥ä¸‹è¾¾ã€å¼€é—¨ã€‘ã€å…³é—¨ã€‘å‘½ä»¤å³å¯ã€‚ è¿™ä¹Ÿå¼•å…¥äº†JAVAç‰¹æ€§ä¸­å¦ä¸€ä¸ªç‰¹æ€§ï¼šå°è£…ã€‚å¤–ç•Œä¸çŸ¥é“é‡Œé¢å®žçŽ°ç»†èŠ‚ï¼Œåªéœ€è¦çŸ¥é“å®ƒçš„åŠŸèƒ½å’Œå…¥å‚å³å¯ã€‚ è¿™å°±æ˜¯é¢å‘è¿‡ç¨‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹çš„åŒºåˆ«ï¼Œä¹Ÿé¡ºå¸¦åœ°ç†è§£äº†ä»€ä¹ˆæ˜¯é¢å‘æŽ¥å£ç¼–ç¨‹ã€‚è¿™æ˜¯å­¦ä¹ JAVAæœ€åŸºç¡€ä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„ç‚¹ã€‚ æ•´ç†è‡ªï¼š https://tryenough.com/java05 http://www.woshipm.com/pmd/294180.html]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå­—ç¬¦ä¸²æ ¸å¿ƒä¸€ç½‘æ‰“å°½]]></title>
    <url>%2F2019%2F01%2F23%2Fjava-basic%2Fjava%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%B8%E5%BF%83%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD%2F</url>
    <content type="text"><![CDATA[å¯¹å­—ç¬¦ä¸²ä¸­æœ€æ ¸å¿ƒçš„ç‚¹ï¼šå¯¹è±¡åˆ›å»ºå’ŒåŠ¨æ€åŠ å…¥å¸¸é‡æ± è¿™äº›ç‚¹è¿›è¡Œæ·±å…¥åˆ†æžã€‚ æ¯”å¦‚æœ‰ä¸¤ä¸ªé¢è¯•é¢˜ï¼š Q1ï¼šString s = new String(&quot;abc&quot;); å®šä¹‰äº†å‡ ä¸ªå¯¹è±¡ã€‚ Q2ï¼šå¦‚ä½•ç†è§£Stringçš„internæ–¹æ³•ï¼Ÿ A1ï¼šå¯¹äºŽé€šè¿‡ new äº§ç”Ÿçš„å¯¹è±¡ï¼Œä¼šå…ˆåŽ»å¸¸é‡æ± æ£€æŸ¥æœ‰æ²¡æœ‰ â€œabcâ€ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œå…ˆåœ¨å¸¸é‡æ± åˆ›å»ºä¸€ä¸ª â€œabcâ€ å¯¹è±¡ï¼Œç„¶åŽåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå¸¸é‡æ± ä¸­æ­¤ â€œabcâ€ å¯¹è±¡çš„æ‹·è´å¯¹è±¡ã€‚æ‰€ä»¥ç­”æ¡ˆæ˜¯ï¼šä¸€ä¸ªæˆ–ä¸¤ä¸ªã€‚å¦‚æžœå¸¸é‡æ± ä¸­åŽŸæ¥æ²¡æœ‰ â€abcâ€, å°±æ˜¯ä¸¤ä¸ªã€‚å¦‚æžœåŽŸæ¥çš„å¸¸é‡æ± ä¸­å­˜åœ¨â€œabcâ€æ—¶ï¼Œå°±æ˜¯ä¸€ä¸ªã€‚ A2ï¼šå½“ä¸€ä¸ªStringå®žä¾‹è°ƒç”¨intern()æ–¹æ³•æ—¶ï¼ŒJVMä¼šæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç›¸åŒUnicodeçš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¦‚æžœæœ‰ï¼Œåˆ™è¿”å›žå…¶çš„å¼•ç”¨ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­å¢žåŠ ä¸€ä¸ªUnicodeç­‰äºŽstrçš„å­—ç¬¦ä¸²å¹¶è¿”å›žå®ƒçš„å¼•ç”¨ï¼› å­—é¢é‡å’Œè¿è¡Œæ—¶å¸¸é‡æ±  JVMä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ï¼Œåœ¨å®žä¾‹åŒ–å­—ç¬¦ä¸²å¸¸é‡çš„æ—¶å€™è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ã€‚ä¸ºäº†å‡å°‘åœ¨JVMä¸­åˆ›å»ºçš„å­—ç¬¦ä¸²çš„æ•°é‡ï¼Œå­—ç¬¦ä¸²ç±»ç»´æŠ¤äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ã€‚ åœ¨JVMè¿è¡Œæ—¶åŒºåŸŸçš„æ–¹æ³•åŒºä¸­ï¼Œæœ‰ä¸€å—åŒºåŸŸæ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚ äº†è§£è¿‡JVMå°±ä¼šçŸ¥é“ï¼Œåœ¨javaä»£ç è¢«javacç¼–è¯‘ä¹‹åŽï¼Œæ–‡ä»¶ç»“æž„ä¸­æ˜¯åŒ…å«ä¸€éƒ¨åˆ†Constant poolçš„ã€‚æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š 123public static void main(String[] args) &#123; String s = "abc";&#125; ç»è¿‡ç¼–è¯‘åŽï¼Œå¸¸é‡æ± å†…å®¹å¦‚ä¸‹ï¼š 1234567891011Constant pool: #1 = Methodref #4.#20 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = String #21 // abc #3 = Class #22 // StringDemo #4 = Class #23 // java/lang/Object ... #16 = Utf8 s .. #21 = Utf8 abc #22 = Utf8 StringDemo #23 = Utf8 java/lang/Object ä¸Šé¢çš„Classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå†…å®¹ï¼š 123#16 = Utf8 s#21 = Utf8 abc#22 = Utf8 StringDemo ä¸Šé¢å‡ ä¸ªå¸¸é‡ä¸­ï¼Œså°±æ˜¯å‰é¢æåˆ°çš„ç¬¦å·å¼•ç”¨ï¼Œè€Œabcå°±æ˜¯å‰é¢æåˆ°çš„å­—é¢é‡ã€‚è€ŒClassæ–‡ä»¶ä¸­çš„å¸¸é‡æ± éƒ¨åˆ†çš„å†…å®¹ï¼Œä¼šåœ¨è¿è¡ŒæœŸè¢«è¿è¡Œæ—¶å¸¸é‡æ± åŠ è½½è¿›åŽ»ã€‚ new Stringåˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ ä¸‹é¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ†æžä¸‹String s = new String(&quot;abc&quot;);åˆ›å»ºå¯¹è±¡æƒ…å†µäº†ã€‚ è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œåœ¨ç¼–è¯‘æœŸï¼Œç¬¦å·å¼•ç”¨så’Œå­—é¢é‡abcä¼šè¢«åŠ å…¥åˆ°Classæ–‡ä»¶çš„å¸¸é‡æ± ä¸­ã€‚ç”±äºŽæ˜¯newçš„æ–¹å¼ï¼Œåœ¨ç±»åŠ è½½æœŸé—´ï¼Œå…ˆåŽ»å¸¸é‡æ± æ£€æŸ¥æœ‰æ²¡æœ‰ â€œabcâ€ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œå…ˆåœ¨å¸¸é‡æ± åˆ›å»ºä¸€ä¸ª â€œabcâ€ å¯¹è±¡ã€‚ åœ¨è¿è¡ŒæœŸé—´ï¼Œåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå¸¸é‡æ± ä¸­æ­¤ â€œabcâ€ å¯¹è±¡çš„æ‹·è´å¯¹è±¡ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± çš„åŠ¨æ€æ‰©å±• ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨æ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€éƒ¨åˆ†æ¥æºï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚é‚£ä¹ˆè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå¯ä»¥åœ¨è¿è¡ŒæœŸåƒè¿è¡Œæ—¶å¸¸é‡æ± ä¸­å¢žåŠ å¸¸é‡ã€‚é‚£å°±æ˜¯Stringçš„internæ–¹æ³•ã€‚ å½“ä¸€ä¸ªStringå®žä¾‹è°ƒç”¨intern()æ–¹æ³•æ—¶ï¼ŒJVMä¼šæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç›¸åŒUnicodeçš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¦‚æžœæœ‰ï¼Œåˆ™è¿”å›žå…¶çš„å¼•ç”¨ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­å¢žåŠ ä¸€ä¸ªUnicodeç­‰äºŽstrçš„å­—ç¬¦ä¸²å¹¶è¿”å›žå®ƒçš„å¼•ç”¨ï¼› intern()æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œç¬¬ä¸€ä¸ªæ˜¯å°†å­—ç¬¦ä¸²å­—é¢é‡æ”¾å…¥å¸¸é‡æ± ï¼ˆå¦‚æžœæ± æ²¡æœ‰çš„è¯ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯è¿”å›žè¿™ä¸ªå¸¸é‡çš„å¼•ç”¨ã€‚ ä¸€ä¸ªä¾‹å­ï¼š 123456789String s1 = "hello world";String s2 = new String("hello world");System.out.println("s==s1:"+(s==s1));String s3 = new String("hello world").intern();System.out.println("s==s2:"+(s==s2)); è¿è¡Œç»“æžœæ˜¯ï¼š 12s1==s2:falses2==s3:true ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸ºString s1 = &quot;hello world&quot;;å’ŒString s3 = new String(&quot;hello world&quot;).intern();åšçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ï¼ˆä½†å®žé™…æœ‰äº›åŒºåˆ«ï¼Œè¿™é‡Œæš‚ä¸å±•å¼€ï¼‰ã€‚éƒ½æ˜¯å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åŽå°†å…¶å­—ç¬¦ä¸²å­—é¢é‡ä¿å­˜åœ¨å¸¸é‡æ± ä¸­ï¼Œå¹¶æŠŠè¿™ä¸ªå­—é¢é‡çš„å¼•ç”¨è¿”å›žç»™å®šä¹‰å¥½çš„å¯¹è±¡å¼•ç”¨ã€‚ å¯¹äºŽString s3 = new String(&quot;hello world&quot;).intern();ï¼Œåœ¨ä¸è°ƒinternæƒ…å†µï¼Œs3æŒ‡å‘çš„æ˜¯JVMåœ¨å †ä¸­åˆ›å»ºçš„é‚£ä¸ªå¯¹è±¡çš„å¼•ç”¨çš„ï¼ˆå¦‚s2ï¼‰ã€‚ä½†æ˜¯å½“æ‰§è¡Œäº†internæ–¹æ³•æ—¶ï¼Œs3å°†æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„é‚£ä¸ªå­—ç¬¦ä¸²å¸¸é‡ã€‚ ç”±äºŽs1å’Œs3éƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—é¢é‡çš„å¼•ç”¨ï¼Œæ‰€ä»¥s1==s3ã€‚ä½†æ˜¯ï¼Œs2çš„å¼•ç”¨æ˜¯å †ä¸­çš„å¯¹è±¡ï¼Œæ‰€ä»¥s2!=s1ã€‚ internçš„æ­£ç¡®ç”¨æ³• ä¸çŸ¥é“ï¼Œä½ æœ‰æ²¡æœ‰å‘çŽ°ï¼Œåœ¨String s3 = new String(&quot;abc&quot;).intern();ä¸­ï¼Œå…¶å®žinternæ˜¯å¤šä½™çš„ï¼Ÿ å› ä¸ºå°±ç®—ä¸ç”¨internï¼Œâ€œabc&quot;ä½œä¸ºä¸€ä¸ªå­—é¢é‡ä¹Ÿä¼šè¢«åŠ è½½åˆ°Classæ–‡ä»¶çš„å¸¸é‡æ± â€&quot;ï¼Œè¿›è€ŒåŠ å…¥åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä¸ºå•¥è¿˜è¦å¤šæ­¤ä¸€ä¸¾å‘¢ï¼Ÿåˆ°åº•ä»€ä¹ˆåœºæ™¯ä¸‹æ‰ä¼šç”¨åˆ°internå‘¢? åœ¨è§£é‡Šè¿™ä¸ªä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä»¥ä¸‹ä»£ç ï¼š 1234String s1 = "hello";String s2 = "world";String s3 = s1 + s2;String s4 = "hello" + "world"; åœ¨ç»è¿‡åç¼–è¯‘åŽï¼Œå¾—åˆ°ä»£ç å¦‚ä¸‹ï¼š 1234String s1 = "hello";String s2 = "world";String s3 = (new StringBuilder()).append(s1).append(s2).toString();String s4 = "helloworld"; è¿™å°±æ˜¯é˜¿é‡Œå·´å·´æ–‡æ¡£é‡Œä¸ºä»€ä¹ˆè§„å®šå¾ªçŽ¯æ‹¼æŽ¥å­—ç¬¦ä¸²ä¸å‡†ä½¿ç”¨&quot;+&quot;è€Œå¿…é¡»ä½¿ç”¨StringBuilderï¼Œå› ä¸ºåç¼–è¯‘å‡ºçš„å­—èŠ‚ç æ–‡ä»¶æ˜¾ç¤ºæ¯æ¬¡å¾ªçŽ¯éƒ½ä¼š new å‡ºä¸€ä¸ª StringBuilder å¯¹è±¡ï¼Œç„¶åŽè¿›è¡Œappend æ“ä½œï¼Œæœ€åŽé€šè¿‡ toString æ–¹æ³•è¿”å›ž String å¯¹è±¡ï¼Œé€ æˆå†…å­˜èµ„æºæµªè´¹ã€‚ ä¸æ°å½“çš„æ–¹å¼å½¢å¦‚ï¼š 1234String str = "start";for (int i = 0; i &lt; 100; i++) &#123; str = str + "hello";&#125; å¥½äº†ï¼Œè¨€å½’æ­£ä¼ ï¼Œå¯ä»¥å‘çŽ°ï¼ŒåŒæ ·æ˜¯å­—ç¬¦ä¸²æ‹¼æŽ¥ï¼Œs3å’Œs4åœ¨ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åŽçš„å®žçŽ°æ–¹å¼å¹¶ä¸ä¸€æ ·ã€‚s3è¢«è½¬åŒ–æˆStringBuilderåŠappendï¼Œè€Œs4è¢«ç›´æŽ¥æ‹¼æŽ¥æˆæ–°çš„å­—ç¬¦ä¸²ã€‚ å¦‚æžœä½ æ„Ÿå…´è¶£ï¼Œä½ è¿˜èƒ½å‘çŽ°ï¼ŒString s4 = s1 + s2; ç»è¿‡ç¼–è¯‘ä¹‹åŽï¼Œå¸¸é‡æ± ä¸­æ˜¯æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å¸¸é‡çš„åˆ†åˆ«æ˜¯ helloã€worldï¼ˆå…¶å®žhelloå’Œworldæ˜¯String s1 = &quot;hello&quot;;å’ŒString s2 = &quot;world&quot;;å®šä¹‰å‡ºæ¥çš„ï¼‰ï¼Œæ‹¼æŽ¥ç»“æžœhelloworldå¹¶ä¸åœ¨å¸¸é‡æ± ä¸­ã€‚ å¦‚æžœä»£ç åªæœ‰String s4 = &quot;hello&quot; + &quot;world&quot;;ï¼Œé‚£ä¹ˆå¸¸é‡æ± ä¸­å°†åªæœ‰helloworldè€Œæ²¡æœ‰helloå’Œ worldã€‚ ç©¶å…¶åŽŸå› ï¼Œæ˜¯å› ä¸ºå¸¸é‡æ± è¦ä¿å­˜çš„æ˜¯å·²ç¡®å®šçš„å­—é¢é‡å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºŽå­—ç¬¦ä¸²çš„æ‹¼æŽ¥ï¼Œçº¯å­—é¢é‡å’Œå­—é¢é‡çš„æ‹¼æŽ¥ï¼Œä¼šæŠŠæ‹¼æŽ¥ç»“æžœä½œä¸ºå¸¸é‡ä¿å­˜åˆ°å­—ç¬¦ä¸²ã€‚ å¦‚æžœåœ¨å­—ç¬¦ä¸²æ‹¼æŽ¥ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•°æ˜¯éžå­—é¢é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªå˜é‡çš„è¯ï¼Œæ•´ä¸ªæ‹¼æŽ¥æ“ä½œä¼šè¢«ç¼–è¯‘æˆStringBuilder.appendï¼Œè¿™ç§æƒ…å†µç¼–è¯‘å™¨æ˜¯æ— æ³•çŸ¥é“å…¶ç¡®å®šå€¼çš„ã€‚åªæœ‰åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šã€‚ é‚£ä¹ˆï¼Œæœ‰äº†è¿™ä¸ªç‰¹æ€§äº†ï¼Œinternå°±æœ‰ç”¨æ­¦ä¹‹åœ°äº†ã€‚é‚£å°±æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºä¸­ç”¨åˆ°çš„å­—ç¬¦ä¸²æ˜¯åªæœ‰åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šçš„ï¼Œåœ¨ç¼–è¯‘æœŸæ˜¯æ— æ³•ç¡®å®šçš„ï¼Œé‚£ä¹ˆä¹Ÿå°±æ²¡åŠžæ³•åœ¨ç¼–è¯‘æœŸè¢«åŠ å…¥åˆ°å¸¸é‡æ± ä¸­ã€‚ è¿™æ—¶å€™ï¼Œå¯¹äºŽé‚£ç§å¯èƒ½ç»å¸¸ä½¿ç”¨çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨internè¿›è¡Œå®šä¹‰ï¼Œæ¯æ¬¡JVMè¿è¡Œåˆ°è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šç›´æŽ¥æŠŠå¸¸é‡æ± ä¸­è¯¥å­—é¢å€¼çš„å¼•ç”¨è¿”å›žï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å¤§é‡å­—ç¬¦ä¸²å¯¹è±¡çš„åˆ›å»ºäº†ã€‚ æ€»ç»“ ç¬¬ä¸€ç§æƒ…å†µï¼š 12String str1 = "abc"; System.out.println(str1 == "abc"); æ ˆä¸­å¼€è¾Ÿä¸€å—ç©ºé—´å­˜æ”¾å¼•ç”¨str1ï¼› Stringæ± ä¸­å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œå­˜æ”¾Stringå¸¸é‡&quot;abc&quot;ï¼› å¼•ç”¨str1æŒ‡å‘æ± ä¸­Stringå¸¸é‡&quot;abc&quot;ï¼› str1æ‰€æŒ‡ä»£çš„åœ°å€å³å¸¸é‡&quot;abc&quot;æ‰€åœ¨åœ°å€ï¼Œè¾“å‡ºä¸ºtrue ç¬¬äºŒç§æƒ…å†µï¼š 12String str2 = new String("abc"); System.out.println(str2 == "abc"); æ ˆä¸­å¼€è¾Ÿä¸€å—ç©ºé—´å­˜æ”¾å¼•ç”¨str2ï¼› å †ä¸­å¼€è¾Ÿä¸€å—ç©ºé—´å­˜æ”¾ä¸€ä¸ªæ–°å»ºçš„Stringå¯¹è±¡&quot;abc&quot;ï¼› å¼•ç”¨str2æŒ‡å‘å †ä¸­çš„æ–°å»ºçš„Stringå¯¹è±¡&quot;abc&quot;ï¼› str2æ‰€æŒ‡ä»£çš„å¯¹è±¡åœ°å€ä¸ºå †ä¸­åœ°å€ï¼Œè€Œå¸¸é‡&quot;abc&quot;åœ°å€åœ¨æ± ä¸­ï¼Œè¾“å‡ºä¸ºfalseï¼› ç¬¬ä¸‰ã€å››ç§æƒ…å†µ 1234567891011121314//ï¼ˆ3ï¼‰String str1 = "a"ï¼›String str2 = "b"ï¼›String str3 = str1 + "b"ï¼›//str1 å’Œ str2 æ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†ã€‚//str3 ä¸­æœ‰ä¸ª str1 æ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨ç¼–è¯‘æœŸç¡®å®šã€‚//åˆå› ä¸ºStringæ˜¯ final ç±»åž‹çš„ï¼Œæ‰€ä»¥åœ¨ str1 + "b" çš„æ—¶å€™å®žé™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œåœ¨æŠŠæ–°å¯¹è±¡çš„å¼•ç”¨ä¼ ç»™str3ã€‚//ï¼ˆ4ï¼‰final String str1 = "a"ï¼›String str2 = "b"ï¼›String str3 = str1 + "b"ï¼›//è¿™é‡Œå’Œ(3)çš„ä¸åŒå°±æ˜¯ç»™ str1 åŠ ä¸Šäº†ä¸€ä¸ªfinalï¼Œè¿™æ ·str1å°±å˜æˆäº†ä¸€ä¸ªå¸¸é‡ã€‚//è¿™æ · str3 å°±å¯ä»¥åœ¨ç¼–è¯‘æœŸä¸­å°±ç¡®å®šäº† è¿™é‡Œçš„ç»†èŠ‚åœ¨ä¸Šé¢å·²ç»è¯¦ç»†è¯´æ˜Žäº†ã€‚ ç¬¬äº”ç§æƒ…å†µ 1234String str1 = "ab"ï¼›String str2 = new String("ab");System.out.println(str1== str2);//falseSystem.out.println(str2.intern() == str1);//true æ•´ç†è‡ªï¼š æˆ‘ç»ˆäºŽæžæ¸…æ¥šäº†å’ŒStringæœ‰å…³çš„é‚£ç‚¹äº‹å„¿ https://www.jianshu.com/p/2624036c9daa]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå­—ç¬¦ä¸²]]></title>
    <url>%2F2019%2F01%2F23%2Fjava-basic%2Fjava%E5%AD%97%E7%AC%A6%E4%B8%B2%2F</url>
    <content type="text"><![CDATA[å…³äºŽjavaå­—ç¬¦ä¸²ä¸å¯å˜ç‰¹æ€§çš„æ·±å…¥ç†è§£ã€‚ ä»€ä¹ˆæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Ÿ ä¼—æ‰€å‘¨çŸ¥ï¼Œ åœ¨Javaä¸­ï¼Œ Stringç±»æ˜¯ä¸å¯å˜çš„ã€‚é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ˜¯ä¸å¯å˜çš„å¯¹è±¡å‘¢ï¼Ÿ å¯ä»¥è¿™æ ·è®¤ä¸ºï¼šå¦‚æžœä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å®ƒåˆ›å»ºå®Œæˆä¹‹åŽï¼Œä¸èƒ½å†æ”¹å˜å®ƒçš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯ä¸å¯å˜çš„ã€‚ä¸èƒ½æ”¹å˜çŠ¶æ€çš„æ„æ€æ˜¯ï¼Œä¸èƒ½æ”¹å˜å¯¹è±¡å†…çš„æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»åž‹çš„å€¼ä¸èƒ½æ”¹å˜ï¼Œå¼•ç”¨ç±»åž‹çš„å˜é‡ä¸èƒ½æŒ‡å‘å…¶ä»–çš„å¯¹è±¡ï¼Œå¼•ç”¨ç±»åž‹æŒ‡å‘çš„å¯¹è±¡çš„çŠ¶æ€ä¹Ÿä¸èƒ½æ”¹å˜ã€‚ åŒºåˆ†å¯¹è±¡å’Œå¯¹è±¡çš„å¼•ç”¨ å¯¹äºŽJavaåˆå­¦è€…ï¼Œ å¯¹äºŽStringæ˜¯ä¸å¯å˜å¯¹è±¡æ€»æ˜¯å­˜æœ‰ç–‘æƒ‘ã€‚çœ‹ä¸‹é¢ä»£ç ï¼š 12345String s = "ABCabc"; System.out.println("s = " + s); s = "123456"; System.out.println("s = " + s); æ‰“å°ç»“æžœ: 12s = ABCabcs = 123456 é¦–å…ˆåˆ›å»ºä¸€ä¸ª String å¯¹è±¡ s ï¼Œç„¶åŽè®© s çš„å€¼ä¸º ABCabc ï¼Œ ç„¶åŽåˆè®© s çš„å€¼ä¸º 123456 ã€‚ ä»Žæ‰“å°ç»“æžœå¯ä»¥çœ‹å‡ºï¼Œs çš„å€¼ç¡®å®žæ”¹å˜äº†ã€‚é‚£ä¹ˆæ€Žä¹ˆè¿˜è¯´ String å¯¹è±¡æ˜¯ä¸å¯å˜çš„å‘¢ï¼Ÿ å…¶å®žè¿™é‡Œå­˜åœ¨ä¸€ä¸ªè¯¯åŒºï¼šsåªæ˜¯ä¸€ä¸ªStringå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚ å¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯ä¸€å—å†…å­˜åŒºï¼Œæˆå‘˜å˜é‡è¶Šå¤šï¼Œè¿™å—å†…å­˜åŒºå çš„ç©ºé—´è¶Šå¤§ã€‚ å¼•ç”¨åªæ˜¯ä¸€ä¸ª4å­—èŠ‚çš„æ•°æ®ï¼Œé‡Œé¢å­˜æ”¾äº†å®ƒæ‰€æŒ‡å‘çš„å¯¹è±¡çš„åœ°å€ï¼Œé€šè¿‡è¿™ä¸ªåœ°å€å¯ä»¥è®¿é—®å¯¹è±¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œs åªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå®ƒæŒ‡å‘äº†ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œå½“ s=â€œ123456â€; è¿™å¥ä»£ç æ‰§è¡Œè¿‡ä¹‹åŽï¼Œåˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡â€œ123456â€ï¼Œ è€Œå¼•ç”¨sé‡æ–°æŒ‡å‘äº†è¿™ä¸ªæ–°çš„å¯¹è±¡ï¼ŒåŽŸæ¥çš„å¯¹è±¡â€œABCabcâ€è¿˜åœ¨å†…å­˜ä¸­å­˜åœ¨ï¼Œå¹¶æ²¡æœ‰æ”¹å˜ã€‚å†…å­˜ç»“æž„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸ºä»€ä¹ˆStringå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Ÿ è¦ç†è§£ String çš„ä¸å¯å˜æ€§ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹ String ç±»ä¸­éƒ½æœ‰å“ªäº›æˆå‘˜å˜é‡ã€‚ åœ¨JDK1.6ä¸­ï¼ŒString çš„æˆå‘˜å˜é‡æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š 1234567891011121314public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; /** The value is used for character storage. */ private final char value[]; /** The offset is the first index of the storage that is used. */ private final int offset; /** The count is the number of characters in the String. */ private final int count; /** Cache the hash code for the string */ private int hash; // Default to 0 åœ¨JDK1.7å’Œ1.8ä¸­ï¼ŒString ç±»åšäº†ä¸€äº›æ”¹åŠ¨ï¼Œä¸»è¦æ˜¯æ”¹å˜äº†substringæ–¹æ³•æ‰§è¡Œæ—¶çš„è¡Œä¸ºï¼Œè¿™å’Œæœ¬æ–‡çš„ä¸»é¢˜ä¸ç›¸å…³ã€‚JDK1.7ä¸­ String ç±»çš„ä¸»è¦æˆå‘˜å˜é‡å°±å‰©ä¸‹äº†ä¸¤ä¸ªï¼š 1234567public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; /** The value is used for character storage. */ private final char value[]; /** Cache the hash code for the string */ private int hash; // Default to 0 ç”±ä»¥ä¸Šçš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ åœ¨Javaä¸­ String ç±»å…¶å®žå°±æ˜¯å¯¹å­—ç¬¦æ•°ç»„çš„å°è£…ã€‚ JDK6ä¸­ï¼Œ valueæ˜¯Stringå°è£…çš„æ•°ç»„ï¼Œoffsetæ˜¯Stringåœ¨è¿™ä¸ªvalueæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®ï¼Œcountæ˜¯Stringæ‰€å çš„å­—ç¬¦çš„ä¸ªæ•°ã€‚ åœ¨JDK7ä¸­ï¼Œåªæœ‰ä¸€ä¸ªvalueå˜é‡ï¼Œä¹Ÿå°±æ˜¯valueä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å±žäºŽStringè¿™ä¸ªå¯¹è±¡çš„ã€‚è¿™ä¸ªæ”¹å˜ä¸å½±å“æœ¬æ–‡çš„è®¨è®ºã€‚ é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªhashæˆå‘˜å˜é‡ï¼Œæ˜¯è¯¥ String å¯¹è±¡çš„å“ˆå¸Œå€¼çš„ç¼“å­˜ï¼Œè¿™ä¸ªæˆå‘˜å˜é‡ä¹Ÿå’Œæœ¬æ–‡çš„è®¨è®ºæ— å…³ã€‚åœ¨Javaä¸­ï¼Œæ•°ç»„ä¹Ÿæ˜¯å¯¹è±¡ã€‚ æ‰€ä»¥valueä¹Ÿåªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªçœŸæ­£çš„æ•°ç»„å¯¹è±¡ã€‚å…¶å®žæ‰§è¡Œäº† 1String s = â€œABCabc"; è¿™å¥ä»£ç ä¹‹åŽï¼ŒçœŸæ­£çš„å†…å­˜å¸ƒå±€åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š valueï¼Œoffsetå’Œcountè¿™ä¸‰ä¸ªå˜é‡éƒ½æ˜¯privateçš„ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›setValueï¼Œ setOffsetå’ŒsetCountç­‰å…¬å…±æ–¹æ³•æ¥ä¿®æ”¹è¿™äº›å€¼ï¼Œæ‰€ä»¥åœ¨Stringç±»çš„å¤–éƒ¨æ— æ³•ä¿®æ”¹Stringã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½ä¿®æ”¹ï¼Œ å¹¶ä¸”åœ¨Stringç±»çš„å¤–éƒ¨ä¸èƒ½è®¿é—®è¿™ä¸‰ä¸ªæˆå‘˜ã€‚ æ­¤å¤–ï¼Œvalueï¼Œoffsetå’Œcountè¿™ä¸‰ä¸ªå˜é‡éƒ½æ˜¯finalçš„ï¼Œ ä¹Ÿå°±æ˜¯è¯´åœ¨ String ç±»å†…éƒ¨ï¼Œä¸€æ—¦è¿™ä¸‰ä¸ªå€¼åˆå§‹åŒ–äº†ï¼Œ ä¹Ÿä¸èƒ½è¢«æ”¹å˜ã€‚æ‰€ä»¥å¯ä»¥è®¤ä¸º String å¯¹è±¡æ˜¯ä¸å¯å˜çš„äº†ã€‚ é‚£ä¹ˆåœ¨ String ä¸­ï¼Œæ˜Žæ˜Žå­˜åœ¨ä¸€äº›æ–¹æ³•ï¼Œè°ƒç”¨ä»–ä»¬å¯ä»¥å¾—åˆ°æ”¹å˜åŽçš„å€¼ã€‚è¿™äº›æ–¹æ³•åŒ…æ‹¬substringï¼Œ replaceï¼Œ replaceAllï¼Œ toLowerCaseç­‰ã€‚ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š 1234String a = "ABCabc"; System.out.println("a = " + a); //ABCabca = a.replace('A', 'a'); System.out.println("a = " + a); //aBCabc é‚£ä¹ˆaçš„å€¼çœ‹ä¼¼æ”¹å˜äº†ï¼Œå…¶å®žä¹Ÿæ˜¯åŒæ ·çš„è¯¯åŒºã€‚å†æ¬¡è¯´æ˜Žï¼Œ aåªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œ ä¸æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåœ¨è°ƒç”¨a.replace('A', 'a')æ—¶ï¼Œ æ–¹æ³•å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œå¹¶æŠŠè¿™ä¸ªå¿ƒçš„å¯¹è±¡é‡æ–°èµ‹ç»™äº†å¼•ç”¨aã€‚Stringä¸­replaceæ–¹æ³•çš„æºç å¯ä»¥è¯´æ˜Žé—®é¢˜ï¼š 1234567891011121314151617181920212223242526public String replace(char oldChar, char newChar) &#123; if (oldChar != newChar) &#123; int len = value.length; int i = -1; char[] val = value; /* avoid getfield opcode */ while (++i &lt; len) &#123; if (val[i] == oldChar) &#123; break; &#125; &#125; if (i &lt; len) &#123; char buf[] = new char[len]; for (int j = 0; j &lt; i; j++) &#123; buf[j] = val[j]; &#125; while (i &lt; len) &#123; char c = val[i]; buf[i] = (c == oldChar) ? newChar : c; i++; &#125; return new String(buf, true);//newå‡ºäº†æ–°çš„Stringå¯¹è±¡ &#125; &#125; return this;&#125; Stringå¯¹è±¡çœŸçš„ä¸å¯å˜å—ï¼Ÿ ä»Žä¸Šæ–‡å¯çŸ¥Stringçš„æˆå‘˜å˜é‡æ˜¯private final çš„ï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–ä¹‹åŽä¸å¯æ”¹å˜ã€‚é‚£ä¹ˆåœ¨è¿™å‡ ä¸ªæˆå‘˜ä¸­ï¼Œ valueæ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸ºä»–æ˜¯ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„å¯¹è±¡ã€‚ valueæ˜¯finalä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´finalä¸èƒ½å†æŒ‡å‘å…¶ä»–æ•°ç»„å¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘èƒ½æ”¹å˜valueæŒ‡å‘çš„æ•°ç»„å—ï¼Ÿ æ¯”å¦‚å°†æ•°ç»„ä¸­çš„æŸä¸ªä½ç½®ä¸Šçš„å­—ç¬¦å˜ä¸ºä¸‹åˆ’çº¿â€œ_â€ã€‚ è‡³å°‘åœ¨æˆ‘ä»¬è‡ªå·±å†™çš„æ™®é€šä»£ç ä¸­ä¸èƒ½å¤Ÿåšåˆ°ï¼Œå› ä¸ºæˆ‘ä»¬æ ¹æœ¬ä¸èƒ½å¤Ÿè®¿é—®åˆ°è¿™ä¸ªvalueå¼•ç”¨ï¼Œæ›´ä¸èƒ½é€šè¿‡è¿™ä¸ªå¼•ç”¨åŽ»ä¿®æ”¹æ•°ç»„ã€‚ é‚£ä¹ˆç”¨ä»€ä¹ˆæ–¹å¼å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜å‘¢ï¼Ÿ æ²¡é”™ï¼Œç”¨åå°„ï¼Œ å¯ä»¥åå°„å‡ºStringå¯¹è±¡ä¸­çš„valueå±žæ€§ï¼Œ è¿›è€Œæ”¹å˜é€šè¿‡èŽ·å¾—çš„valueå¼•ç”¨æ”¹å˜æ•°ç»„çš„ç»“æž„ã€‚ä¸‹é¢æ˜¯å®žä¾‹ä»£ç ï¼š 123456789101112131415161718192021public static void testReflection() throws Exception &#123; //åˆ›å»ºå­—ç¬¦ä¸²"Hello World"ï¼Œ å¹¶èµ‹ç»™å¼•ç”¨s String s = "Hello World"; System.out.println("s = " + s); //Hello World //èŽ·å–Stringç±»ä¸­çš„valueå­—æ®µ Field valueFieldOfString = String.class.getDeclaredField("value"); //æ”¹å˜valueå±žæ€§çš„è®¿é—®æƒé™ valueFieldOfString.setAccessible(true); //èŽ·å–så¯¹è±¡ä¸Šçš„valueå±žæ€§çš„å€¼ char[] value = (char[]) valueFieldOfString.get(s); //æ”¹å˜valueæ‰€å¼•ç”¨çš„æ•°ç»„ä¸­çš„ç¬¬5ä¸ªå­—ç¬¦ value[5] = '_'; System.out.println("s = " + s); //Hello_World &#125; åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œså§‹ç»ˆå¼•ç”¨çš„åŒä¸€ä¸ª String å¯¹è±¡ï¼Œä½†æ˜¯å†åå°„å‰åŽï¼Œè¿™ä¸ª String å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡åå°„æ˜¯å¯ä»¥ä¿®æ”¹æ‰€è°“çš„â€œä¸å¯å˜â€å¯¹è±¡çš„ã€‚ä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬ä¸è¿™ä¹ˆåšã€‚ è¿™ä¸ªåå°„çš„å®žä¾‹è¿˜å¯ä»¥è¯´æ˜Žä¸€ä¸ªé—®é¢˜ï¼šå¦‚æžœä¸€ä¸ªå¯¹è±¡ï¼Œä»–ç»„åˆçš„å…¶ä»–å¯¹è±¡çš„çŠ¶æ€æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å¾ˆå¯èƒ½ä¸æ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¾‹å¦‚ä¸€ä¸ªCarå¯¹è±¡ï¼Œå®ƒç»„åˆäº†ä¸€ä¸ªWheelå¯¹è±¡ï¼Œè™½ç„¶è¿™ä¸ªWheelå¯¹è±¡å£°æ˜Žæˆäº†private final çš„ï¼Œä½†æ˜¯è¿™ä¸ªWheelå¯¹è±¡å†…éƒ¨çš„çŠ¶æ€å¯ä»¥æ”¹å˜ï¼Œ é‚£ä¹ˆå°±ä¸èƒ½å¾ˆå¥½çš„ä¿è¯Carå¯¹è±¡ä¸å¯å˜ã€‚ å‚è€ƒï¼š https://blog.csdn.net/zhangjg_blog/article/details/18319521]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Integeræ‹†ç®±å’Œè£…ç®±]]></title>
    <url>%2F2019%2F01%2F23%2Fjava-basic%2FInteger%E6%8B%86%E7%AE%B1%E5%92%8C%E8%A3%85%E7%AE%B1%2F</url>
    <content type="text"><![CDATA[ç”±äºŽç¬”è¯•ç»å¸¸é‡åˆ°ï¼Œæ‰€ä»¥è¿™é‡Œæ•´ç†ä¸€ä¸‹ã€‚å°†Integerè¿™ä¸€å—ä¸€ç½‘æ‰“å°½ã€‚ æ‹†ç®±å’Œè£…ç®± è¿™é‡Œä»¥é¢è¯•ç¬”è¯•ç»å¸¸å‡ºçŽ°çš„Integerç±»åž‹ä¸ºä¾‹ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public static void main(String[] args) &#123; /*ç¬¬ä¸€ç»„*/ Integer i = new Integer(128); Integer i2 = 128; System.out.println(i == i2); Integer i3 = new Integer(127); Integer i4 = 127; System.out.println(i3 == i4); /*ç¬¬äºŒç»„*/ Integer i5 = 128; Integer i6 = 128; System.out.println(i5 == i6); Integer i7 = 127; Integer i8 = 127; System.out.println(i7 == i8); /*ç¬¬ä¸‰ç»„*/ Integer i9 = new Integer(128); int i10 = 128; System.out.println(i9 == i10); Integer i11 = new Integer(127); int i12 = 127; System.out.println(i11== i12); /*ç¬¬å››ç»„*/ Integer i13 = new Integer(128); Integer i14 = Integer.valueOf(128); System.out.println(i13 == i14); Integer i15 = new Integer(127); Integer i16 = Integer.valueOf(127); System.out.println(i13 == i14); /*ç¬¬äº”ç»„*/ Integer i17 = Integer.valueOf(128); Integer i18 = 128; System.out.println(i17 == i18); Integer i19 = Integer.valueOf(127); Integer i20 = 127; System.out.println(i19 == i20);&#125; æ‰§è¡Œç»“æžœä¸ºï¼š 1234567891011121314falsefalsefalsetruetruetruefalsefalsefalsetrue ç¿»å¼€æºç (jdk8)ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç§æœ‰çš„é™æ€ç±»ï¼Œå«åšæ•´å½¢ç¼“å­˜ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç¼“å­˜æŸäº›æ•´åž‹å€¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒé»˜è®¤å°†-127-128ä¹‹é—´æ•°å­—å°è£…æˆå¯¹è±¡ï¼Œæ”¾è¿›ä¸€ä¸ªå¸¸é‡æ± ä¸­ï¼Œä»¥åŽå®šä¹‰ç±»ä¼¼äºŽInteger a = 1é‡Œé¢çš„aå°±å¯ä»¥ç›´æŽ¥ä»Žè¿™ä¸ªå¸¸é‡æ± ä¸­å–å¯¹è±¡å³å¯ï¼Œä¸éœ€è¦é‡æ–°new 123456789101112131415161718192021222324252627282930313233private static class IntegerCache &#123; static final int low = -128; static final int high; static final Integer cache[]; static &#123; // high value may be configured by property int h = 127; String integerCacheHighPropValue = sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high"); if (integerCacheHighPropValue != null) &#123; try &#123; int i = parseInt(integerCacheHighPropValue); i = Math.max(i, 127); // Maximum array size is Integer.MAX_VALUE h = Math.min(i, Integer.MAX_VALUE - (-low) -1); &#125; catch( NumberFormatException nfe) &#123; // If the property cannot be parsed into an int, ignore it. &#125; &#125; high = h; cache = new Integer[(high - low) + 1]; int j = low; for(int k = 0; k &lt; cache.length; k++) cache[k] = new Integer(j++); // range [-128, 127] must be interned (JLS7 5.1.7) assert IntegerCache.high &gt;= 127; &#125; private IntegerCache() &#123;&#125;&#125; å¯¹äºŽInteger.valueOf(): 12345public static Integer valueOf(int i) &#123; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i);&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¹Ÿæ˜¯å…ˆçœ‹çœ‹æ˜¯ä¸æ˜¯åœ¨-127åˆ°128ä¹‹é—´çš„èŒƒå›´ï¼Œæ˜¯çš„è¯å°±ä»Ž cache ä¸­å–å‡ºç›¸åº”çš„ Integer å¯¹è±¡å³å¯ã€‚ ç¬¬ä¸€ç»„ä¸­ ç¬¬ä¸€ç§æƒ…å†µï¼Œi æ˜¯åˆ›å»ºçš„ä¸€ä¸ªIntegerçš„å¯¹è±¡ï¼Œå–å€¼æ˜¯128ã€‚i2 æ˜¯è¿›è¡Œè‡ªåŠ¨è£…ç®±çš„å®žä¾‹ï¼Œå› ä¸ºè¿™é‡Œè¶…å‡ºäº†-128åˆ°127çš„èŒƒå›´ï¼Œæ‰€ä»¥æ˜¯åˆ›å»ºäº†æ–°çš„Integerå¯¹è±¡ã€‚ç”±äºŽ==æ¯”è¾ƒçš„æ˜¯åœ°å€ï¼Œæ‰€ä»¥ä¸¤è€…å¿…ç„¶ä¸ä¸€æ ·ã€‚ ç¬¬äºŒç§æƒ…å†µå°±ä¸ä¸€æ ·äº†ï¼Œi4æ˜¯ä¸éœ€è¦è‡ªå·±newï¼Œè€Œæ˜¯å¯ä»¥ç›´æŽ¥ä»Žç¼“å­˜ä¸­å–ï¼Œä½†æ˜¯i3æ˜¯newå‡ºæ¥çš„ï¼Œåœ°å€è¿˜æ˜¯ä¸ä¸€æ ·ã€‚ ç¬¬äºŒç»„ä¸­ ç¬¬ä¸€ç§æƒ…å†µæ˜¯éƒ½è¶…å‡ºèŒƒå›´äº†ï¼Œæ‰€ä»¥éƒ½è¦è‡ªå·±åˆ†åˆ«åŽ»newï¼Œæ‰€ä»¥ä¸ä¸€æ · ç¬¬äºŒç§æƒ…å†µæ˜¯åœ¨èŒƒå›´å†…ï¼Œéƒ½åŽ»ç¼“å­˜ä¸­å–ï¼Œå®žé™…ä¸Šéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä¸€æ · ç¬¬ä¸‰ç»„ä¸­ i10å’Œi12éƒ½æ˜¯intåž‹ï¼Œi9å’Œi11ä¸Žå®ƒä»¬æ¯”è¾ƒçš„æ—¶å€™éƒ½è¦è‡ªåŠ¨æ‹†ç®±ï¼Œæ‰€ä»¥æ¯”è¾ƒçš„æ˜¯æ•°å€¼ï¼Œæ‰€ä»¥éƒ½ä¸€æ · ç¬¬å››ç»„ä¸­ ä¸Žç¬¬ä¸€ç»„åŽŸç†ä¸€æ · å››äº”ç»„ä¸­ ä¸Žç¬¬äºŒç»„åŽŸç†ä¸€æ · æ‰€ä»¥å•Šï¼Œnew Integer()æ˜¯æ¯æ¬¡éƒ½ç›´æŽ¥newå¯¹è±¡å‡ºæ¥ï¼Œè€ŒInteger.valueOf()å¯èƒ½ä¼šç”¨åˆ°ç¼“å­˜ï¼Œæ‰€ä»¥åŽè€…æ•ˆçŽ‡é«˜ä¸€ç‚¹ã€‚ æ€»ç»“ int å’Œ Integer åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œ Integer ä¼šè¿›è¡Œæ‹†ç®±ï¼Œè½¬ä¸º int å€¼ä¸Žint` è¿›è¡Œæ¯”è¾ƒã€‚ Integer ä¸Ž Integer æ¯”è¾ƒçš„æ—¶å€™ï¼Œç”±äºŽç›´æŽ¥èµ‹å€¼çš„æ—¶å€™ä¼šè¿›è¡Œè‡ªåŠ¨çš„è£…ç®±ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦æ³¨æ„ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯ -128&lt;= x&lt;=127 çš„æ•´æ•°ï¼Œå°†ä¼šç›´æŽ¥ç¼“å­˜åœ¨ IntegerCache ä¸­ï¼Œé‚£ä¹ˆå½“èµ‹å€¼åœ¨è¿™ä¸ªåŒºé—´çš„æ—¶å€™ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„ Integer å¯¹è±¡ï¼Œè€Œæ˜¯ä»Žç¼“å­˜ä¸­èŽ·å–å·²ç»åˆ›å»ºå¥½çš„ Integer å¯¹è±¡ã€‚äºŒï¼šå½“å¤§äºŽè¿™ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œç›´æŽ¥ new Integer æ¥åˆ›å»º Integer å¯¹è±¡ã€‚ new Integer(1) å’Œ Integer a = 1 ä¸åŒï¼Œå‰è€…ä¼šåˆ›å»ºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨å †ä¸­ï¼Œè€ŒåŽè€…å› ä¸ºåœ¨-128åˆ°127çš„èŒƒå›´å†…ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä»Ž IntegerCache ä¸­èŽ·å–çš„ã€‚é‚£ä¹ˆ Integer a = 128, å¤§äºŽè¯¥èŒƒå›´çš„è¯æ‰ä¼šç›´æŽ¥é€šè¿‡ new Integer(128)åˆ›å»ºå¯¹è±¡ï¼Œè¿›è¡Œè£…ç®±ã€‚]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ€è€ƒ]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F10%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%80%9D%E8%80%83%2F</url>
    <content type="text"><![CDATA[åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ€å¤´ç–¼çš„å°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œå¤„ç†èµ·æ¥ä¸€å®šè¦å°å¿ƒç¿¼ç¿¼ã€‚ç”±äºŽæ²¡æœ‰æ­¤æ–¹é¢å®žæˆ˜ï¼Œæœ¬æ–‡å°±ä»Žç†è®ºä¸Šçœ‹çœ‹æ¯”è¾ƒå¥½çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æ–¹æ¡ˆã€‚ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ ä¼—æ‰€å‘¨çŸ¥ï¼Œæ•°æ®åº“èƒ½å®žçŽ°æœ¬åœ°äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œä½ å¯ä»¥å…è®¸ä¸€ç»„æ“ä½œè¦ä¹ˆå…¨éƒ½æ­£ç¡®æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚è¿™é‡Œç‰¹åˆ«å¼ºè°ƒäº†æœ¬åœ°äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç›®å‰çš„æ•°æ®åº“åªèƒ½æ”¯æŒåŒä¸€ä¸ªæ•°æ®åº“ä¸­çš„äº‹åŠ¡ã€‚ä½†çŽ°åœ¨çš„ç³»ç»Ÿå¾€å¾€é‡‡ç”¨å¾®æœåŠ¡æž¶æž„ï¼Œä¸šåŠ¡ç³»ç»Ÿæ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œå› æ­¤å°±å‡ºçŽ°äº†è·¨å¤šä¸ªæ•°æ®åº“çš„äº‹åŠ¡éœ€æ±‚ï¼Œè¿™ç§äº‹åŠ¡å³ä¸ºâ€œåˆ†å¸ƒå¼äº‹åŠ¡â€ã€‚é‚£ä¹ˆåœ¨ç›®å‰æ•°æ®åº“ä¸æ”¯æŒè·¨åº“äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿ æ¯”å¦‚ç”¨æˆ·ä¸‹å•è¿‡ç¨‹ã€‚å½“æˆ‘ä»¬çš„ç³»ç»Ÿé‡‡ç”¨äº†å¾®æœåŠ¡æž¶æž„åŽï¼Œä¸€ä¸ªç”µå•†ç³»ç»Ÿå¾€å¾€è¢«æ‹†åˆ†æˆå¦‚ä¸‹å‡ ä¸ªå­ç³»ç»Ÿï¼šå•†å“ç³»ç»Ÿã€è®¢å•ç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€ç§¯åˆ†ç³»ç»Ÿç­‰ã€‚æ•´ä¸ªä¸‹å•çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š ç”¨æˆ·é€šè¿‡å•†å“ç³»ç»Ÿæµè§ˆå•†å“ï¼Œä»–çœ‹ä¸­äº†æŸä¸€é¡¹å•†å“ï¼Œä¾¿ç‚¹å‡»ä¸‹å• æ­¤æ—¶è®¢å•ç³»ç»Ÿä¼šç”Ÿæˆä¸€æ¡è®¢å• è®¢å•åˆ›å»ºæˆåŠŸåŽï¼Œæ”¯ä»˜ç³»ç»Ÿæä¾›æ”¯ä»˜åŠŸèƒ½ å½“æ”¯ä»˜å®ŒæˆåŽï¼Œç”±ç§¯åˆ†ç³»ç»Ÿä¸ºè¯¥ç”¨æˆ·å¢žåŠ ç§¯åˆ† ä¸Šè¿°æ­¥éª¤2ã€3ã€4éœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆã€‚å¯¹äºŽä¼ ç»Ÿå•ä½“åº”ç”¨è€Œè¨€ï¼Œå®žçŽ°äº‹åŠ¡éžå¸¸ç®€å•ï¼Œåªéœ€å°†è¿™ä¸‰ä¸ªæ­¥éª¤æ”¾åœ¨ä¸€ä¸ªæ–¹æ³•Aä¸­ï¼Œå†ç”¨Springçš„@Transactionalæ³¨è§£æ ‡è¯†è¯¥æ–¹æ³•å³å¯ã€‚Springé€šè¿‡æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼Œä¿è¯è¿™äº›æ­¥éª¤è¦ä¹ˆå…¨éƒ½æ‰§è¡Œå®Œæˆï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚ä½†åœ¨è¿™ä¸ªå¾®æœåŠ¡æž¶æž„ä¸­ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤æ¶‰åŠä¸‰ä¸ªç³»ç»Ÿï¼Œæ¶‰åŠä¸‰ä¸ªæ•°æ®åº“ï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®åº“å’Œåº”ç”¨ç³»ç»Ÿä¹‹é—´ï¼Œé€šè¿‡æŸé¡¹é»‘ç§‘æŠ€ï¼Œå®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒã€‚ æ–¹æ¡ˆ1ï¼šåŸºäºŽå¯é æ¶ˆæ¯æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ åœ¨ç³»ç»ŸAå¤„ç†ä»»åŠ¡Aå‰ï¼Œé¦–å…ˆå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€ä¸€æ¡æ¶ˆæ¯ æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°åŽå°†è¯¥æ¡æ¶ˆæ¯æŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æŠ•é€’ã€‚æ­¤æ—¶ä¸‹æ¸¸ç³»ç»ŸBä»ç„¶ä¸çŸ¥é“è¯¥æ¡æ¶ˆæ¯çš„å­˜åœ¨ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶æŒä¹…åŒ–æˆåŠŸåŽï¼Œä¾¿å‘ç³»ç»ŸAè¿”å›žä¸€ä¸ªç¡®è®¤åº”ç­”ï¼› ç³»ç»ŸAæ”¶åˆ°ç¡®è®¤åº”ç­”åŽï¼Œåˆ™å¯ä»¥å¼€å§‹å¤„ç†ä»»åŠ¡Aï¼› ä»»åŠ¡Aå¤„ç†å®ŒæˆåŽï¼Œå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€Commitè¯·æ±‚ã€‚è¯¥è¯·æ±‚å‘é€å®ŒæˆåŽï¼Œå¯¹ç³»ç»ŸAè€Œè¨€ï¼Œè¯¥äº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ­¤æ—¶å®ƒå¯ä»¥å¤„ç†åˆ«çš„ä»»åŠ¡äº†ã€‚ ä½†commitæ¶ˆæ¯å¯èƒ½ä¼šåœ¨ä¼ è¾“é€”ä¸­ä¸¢å¤±ï¼Œä»Žè€Œæ¶ˆæ¯ä¸­é—´ä»¶å¹¶ä¸ä¼šå‘ç³»ç»ŸBæŠ•é€’è¿™æ¡æ¶ˆæ¯ï¼Œä»Žè€Œç³»ç»Ÿå°±ä¼šå‡ºçŽ°ä¸ä¸€è‡´æ€§ã€‚è¿™ä¸ªé—®é¢˜ç”±æ¶ˆæ¯ä¸­é—´ä»¶çš„äº‹åŠ¡å›žæŸ¥æœºåˆ¶å®Œæˆï¼Œä¸‹æ–‡ä¼šä»‹ç»ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°CommitæŒ‡ä»¤åŽï¼Œä¾¿å‘ç³»ç»ŸBæŠ•é€’è¯¥æ¶ˆæ¯ï¼Œä»Žè€Œè§¦å‘ä»»åŠ¡Bçš„æ‰§è¡Œï¼› å½“ä»»åŠ¡Bæ‰§è¡Œå®ŒæˆåŽï¼Œç³»ç»ŸBå‘æ¶ˆæ¯ä¸­é—´ä»¶è¿”å›žä¸€ä¸ªç¡®è®¤åº”ç­”ï¼Œå‘Šè¯‰æ¶ˆæ¯ä¸­é—´ä»¶è¯¥æ¶ˆæ¯å·²ç»æˆåŠŸæ¶ˆè´¹ï¼Œæ­¤æ—¶ï¼Œè¿™ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡å®Œæˆã€‚ ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œå¦‚æžœä»»åŠ¡Aå¤„ç†å¤±è´¥ï¼Œé‚£ä¹ˆéœ€è¦è¿›å…¥å›žæ»šæµç¨‹: è‹¥ç³»ç»ŸAåœ¨å¤„ç†ä»»åŠ¡Aæ—¶å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€Rollbackè¯·æ±‚ã€‚å’Œå‘é€Commitè¯·æ±‚ä¸€æ ·ï¼Œç³»ç»ŸAå‘å®Œä¹‹åŽä¾¿å¯ä»¥è®¤ä¸ºå›žæ»šå·²ç»å®Œæˆï¼Œå®ƒä¾¿å¯ä»¥åŽ»åšå…¶ä»–çš„äº‹æƒ…ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°å›žæ»šè¯·æ±‚åŽï¼Œç›´æŽ¥å°†è¯¥æ¶ˆæ¯ä¸¢å¼ƒï¼Œè€Œä¸æŠ•é€’ç»™ç³»ç»ŸBï¼Œä»Žè€Œä¸ä¼šè§¦å‘ç³»ç»ŸBçš„ä»»åŠ¡Bã€‚ ä¸Šé¢æ‰€ä»‹ç»çš„Commitå’ŒRollbackéƒ½å±žäºŽç†æƒ³æƒ…å†µï¼Œä½†åœ¨å®žé™…ç³»ç»Ÿä¸­ï¼ŒCommitå’ŒRollbackæŒ‡ä»¤éƒ½æœ‰å¯èƒ½åœ¨ä¼ è¾“é€”ä¸­ä¸¢å¤±ã€‚é‚£ä¹ˆå½“å‡ºçŽ°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶æ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆå°±æ˜¯è¶…æ—¶è¯¢é—®æœºåˆ¶ã€‚ ç³»ç»ŸAé™¤äº†å®žçŽ°æ­£å¸¸çš„ä¸šåŠ¡æµç¨‹å¤–ï¼Œè¿˜éœ€æä¾›ä¸€ä¸ªäº‹åŠ¡è¯¢é—®çš„æŽ¥å£ï¼Œä¾›æ¶ˆæ¯ä¸­é—´ä»¶è°ƒç”¨ã€‚å½“æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°ä¸€æ¡äº‹åŠ¡åž‹æ¶ˆæ¯åŽä¾¿å¼€å§‹è®¡æ—¶ï¼Œå¦‚æžœåˆ°äº†è¶…æ—¶æ—¶é—´ä¹Ÿæ²¡æ”¶åˆ°ç³»ç»ŸAå‘æ¥çš„Commitæˆ–RollbackæŒ‡ä»¤çš„è¯ï¼Œå°±ä¼šä¸»åŠ¨è°ƒç”¨ç³»ç»ŸAæä¾›çš„äº‹åŠ¡è¯¢é—®æŽ¥å£è¯¢é—®è¯¥ç³»ç»Ÿç›®å‰çš„çŠ¶æ€ã€‚è¯¥æŽ¥å£ä¼šè¿”å›žä¸‰ç§ç»“æžœï¼š æäº¤ è‹¥èŽ·å¾—çš„çŠ¶æ€æ˜¯â€œæäº¤â€ï¼Œåˆ™å°†è¯¥æ¶ˆæ¯æŠ•é€’ç»™ç³»ç»ŸBã€‚ å›žæ»š è‹¥èŽ·å¾—çš„çŠ¶æ€æ˜¯â€œå›žæ»šâ€ï¼Œåˆ™ç›´æŽ¥å°†æ¡æ¶ˆæ¯ä¸¢å¼ƒã€‚ å¤„ç†ä¸­ è‹¥èŽ·å¾—çš„çŠ¶æ€æ˜¯â€œå¤„ç†ä¸­â€ï¼Œåˆ™ç»§ç»­ç­‰å¾…ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶å‘ä¸‹æ¸¸ç³»ç»ŸæŠ•é€’å®Œæ¶ˆæ¯åŽä¾¿è¿›å…¥é˜»å¡žç­‰å¾…çŠ¶æ€ï¼Œä¸‹æ¸¸ç³»ç»Ÿä¾¿ç«‹å³è¿›è¡Œä»»åŠ¡çš„å¤„ç†ï¼Œä»»åŠ¡å¤„ç†å®ŒæˆåŽä¾¿å‘æ¶ˆæ¯ä¸­é—´ä»¶è¿”å›žåº”ç­”ã€‚æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°ç¡®è®¤åº”ç­”åŽä¾¿è®¤ä¸ºè¯¥äº‹åŠ¡å¤„ç†å®Œæ¯•ï¼ å¦‚æžœæ¶ˆæ¯åœ¨æŠ•é€’è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œæˆ–æ¶ˆæ¯çš„ç¡®è®¤åº”ç­”åœ¨è¿”å›žé€”ä¸­ä¸¢å¤±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶åœ¨ç­‰å¾…ç¡®è®¤åº”ç­”è¶…æ—¶ä¹‹åŽå°±ä¼šé‡æ–°æŠ•é€’ï¼Œç›´åˆ°ä¸‹æ¸¸æ¶ˆè´¹è€…è¿”å›žæ¶ˆè´¹æˆåŠŸå“åº”ä¸ºæ­¢ã€‚å½“ç„¶ï¼Œä¸€èˆ¬æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥è®¾ç½®æ¶ˆæ¯é‡è¯•çš„æ¬¡æ•°å’Œæ—¶é—´é—´éš”ï¼Œæ¯”å¦‚ï¼šå½“ç¬¬ä¸€æ¬¡æŠ•é€’å¤±è´¥åŽï¼Œæ¯éš”äº”åˆ†é’Ÿé‡è¯•ä¸€æ¬¡ï¼Œä¸€å…±é‡è¯•3æ¬¡ã€‚å¦‚æžœé‡è¯•3æ¬¡ä¹‹åŽä»ç„¶æŠ•é€’å¤±è´¥ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å°±éœ€è¦äººå·¥å¹²é¢„ã€‚ æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ¡ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—å…·æœ‰äº‹åŠ¡æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œé˜¿é‡Œçš„RocketMQå¯ä»¥å®žçŽ°è¿™ä¸ªç›®æ ‡ã€‚å…¶ä»–çš„MQè¿˜ä¸è¡Œã€‚ æ–¹æ¡ˆ2ï¼šæœ€å¤§åŠªåŠ›é€šçŸ¥ï¼ˆå®šæœŸæ ¡å¯¹ï¼‰ ä¸Šæ¸¸ç³»ç»Ÿåœ¨å®Œæˆä»»åŠ¡åŽï¼Œå‘æ¶ˆæ¯ä¸­é—´ä»¶åŒæ­¥åœ°å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œç¡®ä¿æ¶ˆæ¯ä¸­é—´ä»¶æˆåŠŸæŒä¹…åŒ–è¿™æ¡æ¶ˆæ¯ï¼Œç„¶åŽä¸Šæ¸¸ç³»ç»Ÿå¯ä»¥åŽ»åšåˆ«çš„äº‹æƒ…äº†ï¼› æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°æ¶ˆæ¯åŽè´Ÿè´£å°†è¯¥æ¶ˆæ¯åŒæ­¥æŠ•é€’ç»™ç›¸åº”çš„ä¸‹æ¸¸ç³»ç»Ÿï¼Œå¹¶è§¦å‘ä¸‹æ¸¸ç³»ç»Ÿçš„ä»»åŠ¡æ‰§è¡Œï¼› å½“ä¸‹æ¸¸ç³»ç»Ÿå¤„ç†æˆåŠŸåŽï¼Œå‘æ¶ˆæ¯ä¸­é—´ä»¶åé¦ˆç¡®è®¤åº”ç­”ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶ä¾¿å¯ä»¥å°†è¯¥æ¡æ¶ˆæ¯åˆ é™¤ï¼Œä»Žè€Œè¯¥äº‹åŠ¡å®Œæˆã€‚ ä¸Šé¢æ˜¯ä¸€ä¸ªç†æƒ³åŒ–çš„è¿‡ç¨‹ï¼Œä½†åœ¨å®žé™…åœºæ™¯ä¸­ï¼Œå¾€å¾€ä¼šå‡ºçŽ°å¦‚ä¸‹å‡ ç§æ„å¤–æƒ…å†µï¼š æ¶ˆæ¯ä¸­é—´ä»¶å‘ä¸‹æ¸¸ç³»ç»ŸæŠ•é€’æ¶ˆæ¯å¤±è´¥ ä¸Šæ¸¸ç³»ç»Ÿå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€æ¶ˆæ¯å¤±è´¥ å¯¹äºŽç¬¬ä¸€ç§æƒ…å†µï¼Œæ¶ˆæ¯ä¸­é—´ä»¶å…·æœ‰é‡è¯•æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆæ¯ä¸­é—´ä»¶ä¸­è®¾ç½®æ¶ˆæ¯çš„é‡è¯•æ¬¡æ•°å’Œé‡è¯•æ—¶é—´é—´éš”ï¼Œå¯¹äºŽç½‘ç»œä¸ç¨³å®šå¯¼è‡´çš„æ¶ˆæ¯æŠ•é€’å¤±è´¥çš„æƒ…å†µï¼Œå¾€å¾€é‡è¯•å‡ æ¬¡åŽæ¶ˆæ¯ä¾¿å¯ä»¥æˆåŠŸæŠ•é€’ï¼Œå¦‚æžœè¶…è¿‡äº†é‡è¯•çš„ä¸Šé™ä»ç„¶æŠ•é€’å¤±è´¥ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶ä¸å†æŠ•é€’è¯¥æ¶ˆæ¯ï¼Œè€Œæ˜¯è®°å½•åœ¨å¤±è´¥æ¶ˆæ¯è¡¨ä¸­ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶éœ€è¦æä¾›å¤±è´¥æ¶ˆæ¯çš„æŸ¥è¯¢æŽ¥å£ï¼Œä¸‹æ¸¸ç³»ç»Ÿä¼šå®šæœŸæŸ¥è¯¢å¤±è´¥æ¶ˆæ¯ï¼Œå¹¶å°†å…¶æ¶ˆè´¹ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œå®šæœŸæ ¡å¯¹â€ã€‚ å¦‚æžœé‡å¤æŠ•é€’å’Œå®šæœŸæ ¡å¯¹éƒ½ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå¾€å¾€æ˜¯å› ä¸ºä¸‹æ¸¸ç³»ç»Ÿå‡ºçŽ°äº†ä¸¥é‡çš„é”™è¯¯ï¼Œæ­¤æ—¶å°±éœ€è¦äººå·¥å¹²é¢„ã€‚ å¯¹äºŽç¬¬äºŒç§æƒ…å†µï¼Œéœ€è¦åœ¨ä¸Šæ¸¸ç³»ç»Ÿä¸­å»ºç«‹æ¶ˆæ¯é‡å‘æœºåˆ¶ã€‚å¯ä»¥åœ¨ä¸Šæ¸¸ç³»ç»Ÿå»ºç«‹ä¸€å¼ æœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œå¹¶å°† ä»»åŠ¡å¤„ç†è¿‡ç¨‹ å’Œ å‘æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­æ’å…¥æ¶ˆæ¯ è¿™ä¸¤ä¸ªæ­¥éª¤æ”¾åœ¨ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­å®Œæˆã€‚å¦‚æžœå‘æœ¬åœ°æ¶ˆæ¯è¡¨æ’å…¥æ¶ˆæ¯å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘å›žæ»šï¼Œä¹‹å‰çš„ä»»åŠ¡å¤„ç†ç»“æžœå°±ä¼šè¢«å–æ¶ˆã€‚ å¦‚æžœè¿™ä¸¤æ­¥éƒ½æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆè¯¥æœ¬åœ°äº‹åŠ¡å°±å®Œæˆäº†ã€‚æŽ¥ä¸‹æ¥ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„æ¶ˆæ¯å‘é€è€…ä¸æ–­åœ°å‘é€æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯ï¼Œå¦‚æžœå‘é€å¤±è´¥å®ƒä¼šè¿”å›žé‡è¯•ã€‚å½“ç„¶ï¼Œä¹Ÿè¦ç»™æ¶ˆæ¯å‘é€è€…è®¾ç½®é‡è¯•çš„ä¸Šé™ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¾¾åˆ°é‡è¯•ä¸Šé™ä»ç„¶å‘é€å¤±è´¥ï¼Œé‚£å°±æ„å‘³ç€æ¶ˆæ¯ä¸­é—´ä»¶å‡ºçŽ°ä¸¥é‡çš„é—®é¢˜ï¼Œæ­¤æ—¶ä¹Ÿåªæœ‰äººå·¥å¹²é¢„æ‰èƒ½è§£å†³é—®é¢˜ã€‚ å¯¹äºŽä¸æ”¯æŒäº‹åŠ¡åž‹æ¶ˆæ¯çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¦‚æžœè¦å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡çš„è¯ï¼Œå°±å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚å®ƒèƒ½å¤Ÿé€šè¿‡é‡è¯•æœºåˆ¶+å®šæœŸæ ¡å¯¹å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†ç›¸æ¯”äºŽç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œå®ƒè¾¾åˆ°æ•°æ®ä¸€è‡´æ€§çš„å‘¨æœŸè¾ƒé•¿ï¼Œè€Œä¸”è¿˜éœ€è¦åœ¨ä¸Šæ¸¸ç³»ç»Ÿä¸­å®žçŽ°æ¶ˆæ¯é‡è¯•å‘å¸ƒæœºåˆ¶ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯æˆåŠŸå‘å¸ƒç»™æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œè¿™æ— ç–‘å¢žåŠ äº†ä¸šåŠ¡ç³»ç»Ÿçš„å¼€å‘æˆæœ¬ï¼Œä½¿å¾—ä¸šåŠ¡ç³»ç»Ÿä¸å¤Ÿçº¯ç²¹ï¼Œå¹¶ä¸”è¿™äº›é¢å¤–çš„ä¸šåŠ¡é€»è¾‘æ— ç–‘ä¼šå ç”¨ä¸šåŠ¡ç³»ç»Ÿçš„ç¡¬ä»¶èµ„æºï¼Œä»Žè€Œå½±å“æ€§èƒ½ã€‚ å› æ­¤ï¼Œå°½é‡é€‰æ‹©æ”¯æŒäº‹åŠ¡åž‹æ¶ˆæ¯çš„æ¶ˆæ¯ä¸­é—´ä»¶æ¥å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¦‚RocketMQã€‚è¿˜æœ‰å…¶ä»–çš„ä¸€äº›è§£å†³æ€è·¯ï¼Œè¿™é‡Œå°±æš‚æ—¶åªæè¿°è¿™äº›ã€‚åŽç»­å†å­¦ä¹ ã€‚ å‚è€ƒè‡ªï¼šhttps://juejin.im/post/5aa3c7736fb9a028bb189bca]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åº“å­˜æ‰£å‡é—®é¢˜]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F09%E5%BA%93%E5%AD%98%E6%89%A3%E5%87%8F%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[åº“å­˜æ‰£å‡é—®é¢˜ä¸€ç›´æ˜¯ç§’æ€ä¸­æœ€å…³é”®çš„ä¸€ä¸ªç‚¹ã€‚å¦‚æžœæŠŠæŽ§ä¸å¥½ï¼Œæ‰£æˆè´Ÿæ•°ï¼Œé‚£å¯å°±éº»çƒ¦äº†ï¼Œå¦‚ä¹ˆå¦‚ä½•ä¿è¯ä¸ä¼šå‡ºçŽ°è¶…å–è¿˜èƒ½ä¿è¯æ€§èƒ½å‘¢ï¼Ÿ ä¸€ã€æ‰£å‡åº“å­˜é—®é¢˜åˆ†æž åœ¨æäº¤è®¢å•çš„æ—¶å€™ï¼Œè¦æ‰£å‡åº“å­˜ï¼Œå¯¹äºŽsqlï¼Œæ˜¯è¿™ä¹ˆå†™çš„ï¼š 1update t_stcok set stock = stock-2 where sku_id = 1 é¦–å…ˆè¿™æ¡sqlå­˜åœ¨è¶…å–é—®é¢˜ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå‡æˆè´Ÿæ•°ã€‚å¯èƒ½ä¼šæ”¹æˆå¦‚ä¸‹ï¼š 1update t_stcok set stock = stock-2 where sku_id = 1 and stock &gt; 2 è¿™æ ·å¥½åƒè§£å†³äº†è¶…å–é—®é¢˜ã€‚ä½†æ˜¯å¼•å…¥äº†æ–°çš„é—®é¢˜ã€‚ç”±äºŽåº“å­˜ç‰µæ¶‰è¿›è´§ã€è¡¥è´§ç­‰ç³»ç»Ÿï¼Œæ‰€ä»¥æ˜¯ä¸ªç‹¬ç«‹çš„æœåŠ¡ã€‚ å¹¶ä¸”ï¼Œæ¯”å¦‚æˆ‘æ˜¯é€šè¿‡MQåŽ»é€šçŸ¥åº“å­˜è¿›è¡Œæ‰£å‡åº“å­˜ï¼Œä½†æ˜¯ç”±äºŽç½‘ç»œæŠ–åŠ¨ï¼Œè¯·æ±‚æ‰£å‡åº“å­˜æ²¡æœ‰ç»“æžœï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½éœ€è¦è¿›è¡Œé‡è¯•ã€‚é‡è¯•ä¹‹åŽï¼Œå¯èƒ½æˆåŠŸäº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæœ‰å¯èƒ½è¿™ä¸¤æ¬¡éƒ½æˆåŠŸäº†ã€‚é‚£ä¹ˆï¼Œä¸€ä¸ªç”¨æˆ·ä¹°ä¸€æ ·ä¸œè¥¿ï¼Œä½†æ˜¯åº“å­˜æ‰£äº†ä¸¤éã€‚è¿™å°±æ˜¯å¹‚ç­‰ã€‚å¦‚æžœä¸åšå¹‚ç­‰å¤„ç†ï¼Œé‡è¯•ä¼šå‡ºçŽ°ä¸Šè¿°è¿™ç§è‡´å‘½é—®é¢˜ã€‚ é‚£ä¹ˆå¦‚ä½•åšåˆ°å¹‚ç­‰å‘¢ï¼Ÿ å®žé™…ä¸Šå°±æ˜¯è¿½æ±‚æ•°æ®ä¸€è‡´æ€§ã€‚é‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘é”æ¥ä¿è¯ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œç”¨ä¹è§‚é”æ¥å®žçŽ°ï¼š 123select stock,version from t_stock;if(stock &gt; ç”¨æˆ·è´­ä¹°æ•°é‡) update t_stcok set stock = stock-2 where sku_id = 1 and version = last_version ä½†æ˜¯ï¼Œä¸€æ—¦å‡ºçŽ°å¹¶å‘ï¼Œé‚£ä¹ˆå¯èƒ½è¿™ä¸ªç”¨æˆ·æ˜¯æ‰§è¡Œupdateå¤±è´¥çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦åŽ»é‡è¯•(guava retryæˆ–è€…spring retryéƒ½å¯ä»¥ä¼˜é›…åœ°å®žçŽ°é‡è¯•)ï¼Œç›´åˆ°æˆåŠŸæˆ–è€…åº“å­˜å·²ç»ä¸è¶³ã€‚ é‚£ä¹ˆï¼Œåœ¨å°‘é‡å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä¹è§‚é”ï¼Œè¦ä¸ç„¶ä¼šå¤§é‡å¤±è´¥ï¼Œæ­¤æ—¶éœ€è¦ç”¨æ‚²è§‚é”ï¼š 12select * from t_stock for update;ä¸‹é¢æ‰§è¡Œupdateæ“ä½œã€‚ã€‚ã€‚ åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œç¬¬ä¸€å¥ä¸ºselect for updateï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œæ•°æ®å°±ä¼šè¢«æœ¬çº¿ç¨‹é”ä½ï¼Œæ•´ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæ‰èƒ½å…è®¸å…¶ä»–çº¿ç¨‹è¿›æ¥ã€‚ å­˜åœ¨çš„é—®é¢˜ï¼šä¸€ä¸ªçº¿ç¨‹é”ä½è¿™è¡Œæ•°æ®ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹éƒ½è¦ç­‰å¾…ï¼Œæ•ˆçŽ‡å¾ˆä½Žã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œè¿˜å¯ä»¥æé«˜æ•ˆçŽ‡å‘¢ï¼Ÿ å¯¹äºŽæ‰£å‡åº“å­˜ï¼Œå¾€å¾€æ˜¯å…ˆåœ¨redisä¸­è¿›è¡Œæ‰£å‡åº“å­˜ã€‚redisæ˜¯å•çº¿ç¨‹ï¼Œæ˜¯é«˜é€Ÿä¸²è¡Œæ‰§è¡Œï¼Œä¸å­˜åœ¨å¹¶å‘é—®é¢˜ã€‚ å¦‚æžœæ˜¯å•æœºredisï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ä¿è¯ä¸€æ¬¡æ€§æ‰§è¡Œ: 12345watch stockmultiif stock &gt; count stock = stock - count;exec ä½†æ˜¯ä¸èƒ½åœ¨é›†ç¾¤ä¸­ç”¨ï¼ˆåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šæ—¶ï¼‰ï¼Œæ‰€ä»¥ç”¨watchä¸é€šç”¨ã€‚ rediséƒ½æ˜¯åŽŸå­æ“ä½œï¼Œæ¯”å¦‚è‡ªå¢ž:incrbyï¼Œç”¨è¿™ä¸ªå°±å¯ä»¥åˆ¤æ–­åº“å­˜æ˜¯å¦å¤Ÿã€‚å°±æ˜¯æ‰€è°“çš„redisé¢„å‡åº“å­˜ã€‚ ä½†æ˜¯åœ¨å®žé™…ä¸­ï¼Œåº“å­˜è¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µï¼šåº“å­˜å’Œé”å®šåº“å­˜ã€‚ é”å®šåº“å­˜æ˜¯è¡¨ç¤ºå¤šå°‘ç”¨æˆ·çœŸæ­£ä¸‹å•äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ”¯ä»˜ã€‚é”å®šåº“å­˜+åº“å­˜=æ€»åº“å­˜ï¼Œç­‰ç”¨æˆ·çœŸæ­£æ”¯ä»˜ä¹‹åŽï¼Œå°±å¯ä»¥å°†é”å®šåº“å­˜å‡æŽ‰ã€‚é‚£ä¹ˆï¼Œæ­¤æ—¶ï¼Œredisä¸­éœ€è¦å­˜åº“å­˜å’Œé”å®šåº“å­˜è¿™ä¸¤ä¸ªå€¼ï¼Œä¸Šé¢å•ä¸€çš„åŽŸå­æ“ä½œå°±ä¸è¡Œäº†ã€‚ è§£å†³æ–¹æ¡ˆï¼šredis+lua ä¸ºä»€ä¹ˆè¦ç”¨luaå‘¢ï¼Ÿå¯ä»¥ç”¨luaå°†ä¸€ç³»åˆ—æ“ä½œå°è£…èµ·æ¥æ‰§è¡Œï¼Œè¾“å…¥è‡ªå·±çš„å‚æ•°å³å¯ã€‚luaè„šæœ¬åœ¨redisä¸­æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ã€åŽŸå­æ€§çš„ã€‚ OKï¼Œä¸‹é¢å°±å®žæˆ˜ä¸€æ³¢ï¼šæ ¹æ®skuIdæŸ¥è¯¢ç¼“å­˜ä¸­çš„åº“å­˜å€¼ã€‚ äºŒã€æŸ¥è¯¢åº“å­˜ï¼ˆè®¾ç½®åº“å­˜ï¼‰ é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜Žç¡®ä¸€ç‚¹ï¼Œredisä¸­çš„åº“å­˜åˆå§‹å€¼æ˜¯ç”±åŽå°çš„ç³»ç»Ÿäººå·¥æå‰é…ç½®å¥½çš„ï¼Œåœ¨è¿›è¡Œå•†å“é”€å”®æ—¶ï¼ˆç”¨æˆ·ä¸‹å•æ—¶ï¼‰ï¼Œç›´æŽ¥ä»Žredisä¸­å…ˆè¿›è¡Œåº“å­˜çš„æ‰£å‡ã€‚ è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œæ˜¯åœ¨ç¨‹åºä¸­è¿›è¡Œåˆ¤æ–­ï¼šå¦‚æžœrediså·²ç»æœ‰äº†è¿™ä¸ªåº“å­˜å€¼ï¼Œå°±å°†ä»–æŸ¥è¯¢å‡ºæ¥è¿”å›žï¼›å¦åˆ™ï¼Œå°±åŽ»æ•°æ®åº“æŸ¥è¯¢ï¼Œç„¶åŽå¯¹redisè¿›è¡Œåˆå§‹åŒ–ã€‚ è¿™é‡Œçš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚æžœå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬åˆå§‹åŒ–ä¸¤ä¸ªå€¼ï¼ˆåº“å­˜å€¼å’Œåº“å­˜é”å®šå€¼ï¼‰ï¼Œè¿™é‡Œé‡‡ç”¨luaè„šæœ¬ï¼Œåœ¨luaè„šæœ¬ä¸­å®Œæˆåˆå§‹åŒ–ï¼Œå¹¶ä¸”å¯¹äºŽä¸¤ä¸ªç”¨æˆ·åŒæ—¶è¿›è¡Œåˆå§‹åŒ–åº“å­˜çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨luaä¸­è¿›è¡Œåˆ¤æ–­,å› ä¸ºredisæ˜¯å•çº¿ç¨‹ï¼Œluaä¹Ÿæ˜¯å•çº¿ç¨‹ï¼Œä¸ç”¨æ‹…å¿ƒä¼šåŒæ—¶åˆå§‹åŒ–ä¸¤æ¬¡ã€‚ ä¸‹é¢é¦–å…ˆå†™ä¸€ä¸ªæŽ¥å£ï¼Œæ ¹æ®skuidæŸ¥è¯¢åº“å­˜(åº“å­˜å’Œé”å®šåº“å­˜)ï¼š 123456789101112@RequestMapping("/query/&#123;skuId&#125;")public ApiResult&lt;Stock&gt; queryStock(@PathVariable long skuId)&#123; ApiResult&lt;Stock&gt; result = new ApiResult(Constants.RESP_STATUS_OK,"åº“å­˜æŸ¥è¯¢æˆåŠŸ"); Stock stock = new Stock(); stock.setSkuId(skuId); int stockCount = stockService.queryStock(skuId); stock.setStock(stockCount); result.setData(stock); return result;&#125; serviceå±‚ï¼š 123456789101112131415161718192021222324252627282930@Overridepublic int queryStock(long skuId) &#123; //å…ˆæŸ¥redis Stock stock ; String stockKey = Constants.CACHE_PRODUCT_STOCK+":"+skuId; String stockLockKey = Constants.CACHE_PRODUCT_STOCK_LOCK+":"+skuId; //åªéœ€è¦æŸ¥è¯¢ä¸€ä¸ªå³å¯ï¼Œæ¯”å¦‚æˆ‘è¿™é‡ŒåªæŸ¥è¯¢åº“å­˜å°±è¡Œ Object stockObj = redisTemplate.opsForValue().get(stockKey); Integer stockInRedis = null ; if(stockObj!=null)&#123; stockInRedis = Integer.valueOf(stockObj.toString()); &#125; //æ²¡æœ‰ï¼Œé‚£ä¹ˆæˆ‘å°±éœ€è¦å°†æ•°æ®åº“ä¸­çš„æ•°æ®åˆå§‹åŒ–åˆ°redisä¸­ if(stockInRedis==null)&#123; //åŽ»æ•°æ®åº“æŸ¥è¯¢ ç„¶åŽå¯¹redisè¿›è¡Œåˆå§‹åŒ– stock = stockMapper.selectBySkuId(skuId); //ä¸¤ä¸ªkeyå’Œä¸¤ä¸ªåº“å­˜å€¼é€šè¿‡luaè„šæœ¬å¡žåˆ°redisä¸­ //è¿™é‡Œå¦‚æžœå‘ç”Ÿä¸¤ä¸ªç”¨æˆ·å¹¶å‘åˆå§‹åŒ–redisï¼Œè„šæœ¬ä¸­ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æžœå·²ç»åˆå§‹åŒ–äº†ï¼Œè„šæœ¬å°±ä¼šåœæ­¢æ‰§è¡Œ // è®¾ç½®åº“å­˜ä¸åº”è¯¥åœ¨è¿™é…ç½®ï¼Œåº”è¯¥æ˜¯åŽå°ç®¡ç†ç³»ç»Ÿè¿›è¡Œè®¾ç½®ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™é‡Œredisä¸­åº”è¯¥æ˜¯å¿…ç„¶å­˜åœ¨çš„ //å¦‚æžœæ˜¯åœ¨åŽå°é…ç½®ï¼Œå°±æ²¡æœ‰å¿…è¦è¿™ä¹ˆå¤æ‚äº† redisUtils.skuStockInit(stockKey,stockLockKey,stock.getStock().toString(),stock.getLockStock().toString()); &#125;else&#123; return stockInRedis;//ç¼“å­˜ä¸­æœ‰å°±ç›´æŽ¥è¿”å›ž &#125; //ç¼“å­˜ç»“æžœå¯èƒ½ä¼šè¿”å›žè®¾ç½®ä¸æˆåŠŸï¼Œæ‰€ä»¥è¿˜æ˜¯è¿”å›žæ•°æ®åº“æŸ¥è¯¢ç»“æžœ return stock.getStock();&#125; é‚£ä¹ˆè¿™ä¸ªå·¥å…·ç±»ä¸ºï¼š 123456789101112131415161718192021222324252627282930313233/** * æŸ¥çœ‹redisæ˜¯å¦å·²ç»åˆå§‹åŒ–å¥½åº“å­˜åˆå§‹å€¼ï¼Œæ²¡æœ‰å°±åˆå§‹åŒ– */public static final String STOCK_CACHE_LUA = "local stock = KEYS[1] " + "local stock_lock = KEYS[2] " + "local stock_val = tonumber(ARGV[1]) " + "local stock_lock_val = tonumber(ARGV[2]) " + "local is_exists = redis.call(\"EXISTS\", stock) " + "if is_exists == 1 then " + " return 0 " + "else " + " redis.call(\"SET\", stock, stock_val) " + " redis.call(\"SET\", stock_lock, stock_lock_val) " + " return 1 " + "end"; /** * @Description ç¼“å­˜skuåº“å­˜ ä»¥åŠé”å®šåº“å­˜ */public boolean skuStockInit(String stockKey,String stockLockKey,String stock,String stockLock)&#123; //ç”¨jedisåŽ»æ‰§è¡Œluaè„šæœ¬ è¾“å…¥çš„å‚æ•°è¦æ³¨æ„é¡ºåº éƒ½æ˜¯å†™æ­»çš„ ç¬¬ä¸€ç»„æ˜¯keyï¼Œç¬¬äºŒç»„æ˜¯stock Object result = redisTemplate.execute((RedisCallback&lt;Object&gt;) redisConnection -&gt; &#123; Jedis jedis = (Jedis)redisConnection.getNativeConnection(); return jedis.eval(STOCK_CACHE_LUA, Collections.unmodifiableList(Arrays.asList(stockKey,stockLockKey)) ,Collections.unmodifiableList(Arrays.asList(stock, stockLock))); &#125;); if (EXCUTE_SUCCESS.equals(result)) &#123; return true; &#125; return false;&#125; å¯¹äºŽluaè„šæœ¬è¿›è¡Œç¨å¾®çš„è§£é‡Šä¸€ä¸‹ï¼š 12345678910111213141516171819202122//ç¬¬ä¸€ç»„æ•°æ®æ˜¯keyæ•°ç»„ï¼›ç¬¬äºŒç»„æ•°æ®æ˜¯argsæ•°ç»„ï¼Œæ˜¯ä¸Žkeyæ•°ç»„å¯¹åº”çš„å€¼ï¼Œå°±æ˜¯åº“å­˜//æˆ‘ä»¬è¿™é‡Œç¬¬ä¸€ç»„ä¸º[stockKey,stockLockKey],å°±æ˜¯å­˜åœ¨redisä¸­çš„åå­—ï¼Œè¿™é‡Œæ˜¯åœ¨serviceå±‚ä¸­å®šä¹‰å¥½äº†//ç¬¬äºŒç»„ä¸º[50,0]ï¼Œè¿™ä¸ªå€¼å°±æ˜¯å¯ä»¥ä»Žæ•°æ®åº“è¡¨t_stockä¸­æŸ¥è¯¢å‡ºæ¥çš„//å› ä¸ºæ‰§è¡Œè¿™æ®µluaè„šæœ¬çš„è¯ï¼Œè¯´æ˜Žredisä¸­æ²¡æœ‰ç¼“å­˜çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åŽå°†ç¼“å­˜è®¾ç½®å¥½//luaä¸­å®šä¹‰å˜é‡ç”¨locallocal stock = KEYS[1]local stock_lock = KEYS[2]local stock_val = tonumber(ARGV[1])local stock_lock_val = tonumber(ARGV[2])//å†æŸ¥è¯¢ä¸€éç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œé˜²æ­¢ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥è®¾ç½®ç¼“å­˜//å­˜åœ¨å°±ä¸ç”¨è®¾ç½®ç¼“å­˜äº†ï¼Œå¦åˆ™å°±è®¾ç½®ç¼“å­˜local is_exists = redis.call("EXISTS", stock)if is_exists == 1 then return 0else redis.call("SET", stock, stock_val) redis.call("SET", stock_lock, stock_lock_val) return 1end é‚£ä¹ˆï¼Œå¯åŠ¨å·¥ç¨‹mama-buy-stockï¼šå‡å¦‚æˆ‘åŽ»æŸ¥è¯¢skuId=1çš„å•†å“ï¼š ç¬¬ä¸€æ¬¡åº“å­˜ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šåŽ»æŸ¥è¯¢æ•°æ®åº“ï¼š æˆ‘ä»¬å†æ¥çœ‹çœ‹redisä¸­çš„æ•°æ®ï¼š ä¸‰ã€æ‰£å‡åº“å­˜ ä¸‹é¢æ¥çœ‹çœ‹æ‰£å‡åº“å­˜æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚å› ä¸ºæäº¤è®¢å•åŽï¼Œå¾€å¾€æ˜¯ä¸æ­¢ä¸€ä»¶å•†å“çš„ï¼Œå¾€å¾€è´­ç‰©è½¦å†…æœ‰å¾ˆå¤šä»¶å•†å“ï¼ŒåŒæ—¶è¿‡æ¥ï¼Œå‡è®¾æœ‰äº”ä»¶å•†å“ï¼Œä½†æ˜¯å…¶ä¸­åªæœ‰ä¸€ä»¶æš‚æ—¶æ²¡æœ‰åº“å­˜äº†ï¼Œé‚£ä¹ˆæˆ‘è¿˜æ˜¯å¸Œæœ›å…¶ä»–çš„å››ä»¶å•†å“èƒ½å¤Ÿå–å‡ºåŽ»ï¼Œåªæ˜¯æ²¡æœ‰åº“å­˜çš„å•†å“å°±ä¸ç®—é’±äº†ã€‚æ‰€ä»¥æ‰£å‡åº“å­˜ç”¨ä¸€ä¸ªmapæ¥è£…ï¼Œå³Map&lt;skuId,count&gt; controllerå±‚ï¼š 1234567@RequestMapping("/reduce")public ApiResult&lt;Map&lt;Long,Integer&gt;&gt; reduceStock(@RequestBody List&lt;StockReduce&gt; stockReduceList)&#123; ApiResult result = new ApiResult(Constants.RESP_STATUS_OK,"åº“å­˜æ‰£å‡æˆåŠŸ"); Map&lt;Long,Integer&gt; resultMap = stockService.reduceStock(stockReduceList); result.setData(resultMap); return result;&#125; serviceå±‚ï¼š 1234567891011121314151617181920212223242526272829303132333435@Override@Transactionalpublic Map&lt;Long, Integer&gt; reduceStock(List&lt;StockReduce&gt; stockReduceList) &#123; Map&lt;Long, Integer&gt; resultMap = new HashMap&lt;&gt;(); //éåŽ†åŽ»å‡redisä¸­åº“å­˜ï¼Œå¢žåŠ é”å®šåº“å­˜ stockReduceList.stream().forEach(param -&gt; &#123; String stockKey = Constants.CACHE_PRODUCT_STOCK+":"+param.getSkuId(); String stockLockKey = Constants.CACHE_PRODUCT_STOCK_LOCK+":"+param.getSkuId(); Object result = redisUtils.reduceStock(stockKey, stockLockKey, param.getReduceCount().toString(),//incrbyä¸€ä¸ªè´Ÿæ•°ï¼Œå°±æ˜¯å‡ String.valueOf(Math.abs(param.getReduceCount())));//incrbyä¸€ä¸ªæ­£æ•°ï¼Œå°±æ˜¯åŠ  if(result instanceof Long)&#123; //åº“å­˜ä¸å­˜åœ¨æˆ–è€…ä¸è¶³ æ‰£å‡å¤±è´¥ skuä¸‹å•å¤±è´¥ è®°å½•ä¸‹æ¥ resultMap.put(param.getSkuId(),-1); &#125;else if (result instanceof List)&#123; //æ‰£å‡æˆåŠŸ è®°å½•æ‰£å‡æµæ°´ List resultList = ((List) result); int stockAftChange = ((Long)resultList.get(0)).intValue(); int stockLockAftChange = ((Long) resultList.get(1)).intValue(); StockFlow stockFlow = new StockFlow(); stockFlow.setOrderNo(param.getOrderNo()); stockFlow.setSkuId(param.getSkuId()); stockFlow.setLockStockAfter(stockLockAftChange); stockFlow.setLockStockBefore(stockLockAftChange+param.getReduceCount()); stockFlow.setLockStockChange(Math.abs(param.getReduceCount())); stockFlow.setStockAfter(stockAftChange); stockFlow.setStockBefore(stockAftChange+Math.abs(param.getReduceCount())); stockFlow.setStockChange(param.getReduceCount()); stockFlowMapper.insertSelective(stockFlow); resultMap.put(param.getSkuId(),1); &#125; &#125;); return resultMap;&#125; å¯¹äºŽredisçš„æ“ä½œï¼ŒåŸºæœ¬ä¸Žä¸Šä¸€è‡´ï¼š 12345678910111213141516171819202122232425262728293031323334/** * @Description æ‰£å‡åº“å­˜luaè„šæœ¬ * @Return 0 keyä¸å­˜åœ¨ é”™è¯¯ -1 åº“å­˜ä¸è¶³ è¿”å›žlist æ‰£å‡æˆåŠŸ */public static final String STOCK_REDUCE_LUA= "local stock = KEYS[1]\n" + "local stock_lock = KEYS[2]\n" + "local stock_change = tonumber(ARGV[1])\n" + "local stock_lock_change = tonumber(ARGV[2])\n" + "local is_exists = redis.call(\"EXISTS\", stock)\n" + "if is_exists == 1 then\n" + " local stockAftChange = redis.call(\"INCRBY\", stock,stock_change)\n" + " if(stockAftChange&lt;0) then\n" + " redis.call(\"DECRBY\", stock,stock_change)\n" + " return -1\n" + " else \n" + " local stockLockAftChange = redis.call(\"INCRBY\", stock_lock,stock_lock_change)\n" + " return &#123;stockAftChange,stockLockAftChange&#125;\n" + " end " + "else \n" + " return 0\n" + "end"; public Object reduceStock(String stockKey,String stockLockKey,String stockChange,String stockLockChange)&#123; Object result = redisTemplate.execute((RedisCallback&lt;Object&gt;) redisConnection -&gt; &#123; Jedis jedis = (Jedis)redisConnection.getNativeConnection(); return jedis.eval(STOCK_REDUCE_LUA, Collections.unmodifiableList(Arrays.asList(stockKey,stockLockKey)) ,Collections.unmodifiableList(Arrays.asList(stockChange, stockLockChange))); &#125;); return result;&#125; æ­¤æ—¶ï¼Œä¸€æ—¦æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šå›žæ»šï¼Œä½†æ˜¯redisä¸­æ˜¯æ— æ³•å›žæ»šçš„ã€‚è¿™ä¸ªé—®é¢˜ä¸ç”¨æ‹…å¿ƒï¼Œå› ä¸ºæ•°æ®åº“å‘ç”Ÿå¼‚å¸¸æ˜¯åŠå…¶ä¸¥é‡çš„é—®é¢˜ï¼Œæ˜¯å¾ˆå°‘ä¼šå‘ç”Ÿçš„ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œåªéœ€è¦åŽ»è¿™ä¸ªæµæ°´çš„è¡¨ä¸­åŽ»æŸ¥çœ‹æƒ…å†µï¼Œç„¶åŽåŽ»æ‰§è¡Œè„šæœ¬åŽ»åˆå§‹åŒ–è¿™ä¸ªrediså³å¯ã€‚æ‰€ä»¥æ˜¯å¯ä»¥è¡¥æ•‘çš„ã€‚ ä½†æ˜¯æŽ¥å£çš„å¹‚ç­‰æ€§è¿˜æ²¡æœ‰åšã€‚é‡å¤å°è¯•è°ƒç”¨è¿™ä¸ªæŽ¥å£ï¼ˆé€šå¸¸æ˜¯å‘ç”Ÿåœ¨MQçš„å¤±è´¥é‡ä¼ æœºåˆ¶ï¼Œå®¢æˆ·ç«¯çš„è¿žç»­ç‚¹å‡»ä¸€èˆ¬æ˜¯å¯ä»¥é¿å…çš„ï¼‰ï¼Œå¯èƒ½ä¼šé‡å¤å‡redisåº“å­˜å¹¶ä¸”é‡å¤åœ°åŽ»æ’å…¥æµæ°´è®°å½•ã€‚è¿™ä¸ªé—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ å››ã€redisåˆ†å¸ƒå¼é”æ¥å®žçŽ°å¹‚ç­‰æ€§ ä¸»æµçš„æ–¹æ¡ˆï¼Œæ¯”å¦‚æœ‰ç”¨ä¸€å¼ è¡¨æ¥æŽ§åˆ¶ï¼Œæ¯”å¦‚ä»¥è¿™ä¸ªorderIDä¸ºå”¯ä¸€ä¸»é”®ï¼Œä¸€æ—¦æ’å…¥æˆåŠŸï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªå”¯ä¸€ä¸»é”®çš„å­˜åœ¨ä¸Žå¦åˆ¤æ–­æ˜¯å¦ä¸ºé‡å¤è¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œçš„æ‰£å‡åº“å­˜å’Œæ’å…¥åŽ»é‡è¡¨æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œï¼ŒåŽ»é‡è¡¨ä¸­æœ‰ä¸€ä¸ªå­—æ®µä¸ºorderIdï¼Œå…¨å±€å”¯ä¸€ä¸é‡å¤ï¼Œç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œçº¦æŸï¼Œé‚£ä¹ˆæ’å…¥çš„æ—¶å€™åˆ¤æ–­è¿™ä¸ªåŽ»é‡è¡¨æ˜¯å¦å¯ä»¥æ’å…¥æˆåŠŸï¼Œå¦‚æžœä¸æˆåŠŸï¼Œé‚£ä¹ˆæ•°æ®åº“æ“ä½œå…¨éƒ¨å›žæ»šï¼‰ã€‚ å¯ä»¥ç”¨redisåˆ†å¸ƒå¼é”ç»™è¿™ä¸ªè®¢å•ä¸Šé”ã€‚ä»¥è®¢å•idä¸ºé”ï¼Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹æ¥æ‰£å‡åº“å­˜ï¼Œæ‰€ä»¥ä¸å½±å“æ€§èƒ½ã€‚ é’ˆå¯¹è¿™ä¸ªè®¢å•ï¼Œç¬¬ä¸€æ¬¡è‚¯å®šæ˜¯å¯ä»¥åŽ»æ‰£å‡åº“å­˜çš„ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡å†æŽ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆå°±è¦è¿”å›žå·²ç»æˆåŠŸäº†ï¼Œä¸è¦å†é‡å¤æ‰£å‡ã€‚ å¯¹äºŽreduceStock()è¿™ä¸ªæ–¹æ³•æœ€å‰é¢å¢žåŠ é”ï¼š 123456789//é˜²æ­¢æ‰£å‡åº“å­˜æ—¶MQæ­£å¸¸é‡è¯•æ—¶çš„ä¸å¹‚ç­‰//ä»¥è®¢å•ID åŠ ä¸ªç¼“å­˜é” é˜²æ­¢ç¨‹åºçŸ­æ—¶é—´é‡è¯• é‡å¤æ‰£å‡åº“å­˜ ä¸ç”¨è§£é” è‡ªå·±è¶…æ—¶Long orderNo = stockReduceList.get(0).getOrderNo();boolean lockResult = redisUtils.distributeLock(Constants.ORDER_RETRY_LOCK+orderNo.toString(),orderNo.toString(),300000);if(!lockResult)&#123; //é”å®šå¤±è´¥ é‡å¤æäº¤ è¿”å›žä¸€ä¸ªç©ºmap return Collections.EMPTY_MAP;&#125;... 123456789101112131415161718192021222324252627282930313233343536373839404142private static final String LOCK_SUCCESS = "OK";private static final String SET_IF_NOT_EXIST = "NX";private static final String SET_WITH_EXPIRE_TIME = "PX";private static final Long EXCUTE_SUCCESS = 1L;/**luaè„šæœ¬ åœ¨redisä¸­ luaè„šæœ¬æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ åŽŸå­çš„ */private static final String UNLOCK_LUA= "if redis.call('get', KEYS[1]) == ARGV[1] then " + " return redis.call('del', KEYS[1]) " + "else " + " return 0 " + "end";/** * @Description èŽ·å–åˆ†å¸ƒå¼é” * @Return boolean */public boolean distributeLock(String lockKey, String requestId, int expireTime)&#123; String result = redisTemplate.execute((RedisCallback&lt;String&gt;) redisConnection -&gt; &#123; JedisCommands commands = (JedisCommands)redisConnection.getNativeConnection(); return commands.set(lockKey,requestId,SET_IF_NOT_EXIST,SET_WITH_EXPIRE_TIME,expireTime);//ä¸€æ¡å‘½ä»¤å®žçŽ°setnxå’Œsetexpireè¿™äº›æ“ä½œï¼ŒåŽŸå­æ€§ &#125;); if (LOCK_SUCCESS.equals(result)) &#123; return true; &#125; return false;&#125;/** * @Description é‡Šæ”¾åˆ†å¸ƒå¼é” * @Return boolean */public boolean releaseDistributelock(String lockKey, String requestId)&#123; Object result = redisTemplate.execute((RedisCallback&lt;Object&gt;) redisConnection -&gt; &#123; Jedis jedis = (Jedis)redisConnection.getNativeConnection(); return jedis.eval(UNLOCK_LUA, Collections.singletonList(lockKey), Collections.singletonList(requestId));//luaè„šæœ¬ä¸­åŽŸå­æ€§å®žçŽ°ï¼šgetæŸ¥è¯¢å’Œdeleteåˆ é™¤è¿™ä¸¤ä¸ªæ“ä½œ &#125;); if (EXCUTE_SUCCESS.equals(result)) &#123; return true; &#125; return false;&#125; æ³¨æ„ï¼Œè¿™é‡Œä¸éœ€è¦æˆ‘ä»¬ä¸»åŠ¨åŽ»é‡Šæ”¾åˆ†å¸ƒå¼é”ï¼Œåªè¦è®¾ç½®ä¸€ä¸ªå¤§äºŽé‡è¯•æ—¶é—´çš„è¿‡æœŸæ—¶é—´å³å¯ã€‚è®©å®ƒè‡ªå·±åˆ é™¤ã€‚ æ³¨æ„redisåœ¨é›†ç¾¤ä¸‹åšåˆ†å¸ƒå¼é”ï¼Œæœ€å¥½è¦ç”¨Redissionã€‚è¿™é‡Œå¦‚æžœç”¨äºŽé›†ç¾¤ï¼Œå¦‚ä½•luaè„šæœ¬åœ¨ä¸€ä¸ªäº‹åŠ¡é‡ŒåŒæ—¶æ“ä½œå¤šä¸ªkeyçš„æ—¶å€™ï¼Œå¦‚æžœè¦ä¿è¯è¿™ä¸ªäº‹åŠ¡ç”Ÿæ•ˆï¼Œå°±éœ€è¦ä¿è¯è¿™å‡ ä¸ªkeyéƒ½è¦åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ä½†æ˜¯ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„ä¸¤ä¸ªkeyï¼š 12public static final String CACHE_PRODUCT_STOCK = "product:stock";public static final String CACHE_PRODUCT_STOCK_LOCK = "product:stock:lock"; å› ä¸ºæˆ‘ä»¬è¿™é‡Œè¦åŒæ—¶å¯¹åº“å­˜å’Œé”å®šåº“å­˜è¿™ä¸¤ä¸ªkeyè¿›è¡Œæ“ä½œï¼Œéœ€è¦æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡å†…æ‰§è¡Œï¼Œä¸å¤„ç†çš„è¯ï¼Œä¸€æ—¦ä»–ä»¬ä¸åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆäº‹åŠ¡å°±ä¸ä¼šç”Ÿæ•ˆï¼Œè§£å†³æ–¹æ¡ˆï¼š 12public static final String CACHE_PRODUCT_STOCK = "&#123;product:stock&#125;";public static final String CACHE_PRODUCT_STOCK_LOCK = "&#123;product:stock&#125;:lock"; å¦‚æžœåŠ ä¸ŠèŠ±æ‹¬å·ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œè®¡ç®—hashå€¼çš„æ—¶å€™ï¼Œä»–ä»¬ä¸¤å°±ä¼šæ˜¯ä¸€æ ·çš„ï¼Œä¼šè¢«æŠ•æ”¾åˆ°åŒä¸€ä¸ªslotä¸­ï¼Œè‡ªç„¶å°±ä¿è¯äº†åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ äº”ã€æµ‹è¯•ä¸€ä¸‹]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ELKå¹³å°æ­å»º]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F08ELK%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[å› ä¸ºè¦å®Œæˆäº§å“çš„å…¨æ–‡æœç´¢è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦å‡†å¤‡ä¸€ä¸‹ESçš„çŽ¯å¢ƒã€‚æœ¬èŠ‚å®‰è£…ELKã€‚ ELKç”±Elasticsearchã€Logstashå’ŒKibanaä¸‰éƒ¨åˆ†ç»„ä»¶ç»„æˆã€‚ å‰è¨€ Elasticsearchæ˜¯ä¸ªå¼€æºåˆ†å¸ƒå¼æœç´¢å¼•æ“Žï¼Œå®ƒçš„ç‰¹ç‚¹æœ‰ï¼šåˆ†å¸ƒå¼ï¼Œé›¶é…ç½®ï¼Œè‡ªåŠ¨å‘çŽ°ï¼Œç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ï¼Œç´¢å¼•å‰¯æœ¬æœºåˆ¶ï¼Œrestfulé£Žæ ¼æŽ¥å£ï¼Œå¤šæ•°æ®æºï¼Œè‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰ã€‚ ç®€å•æ¥è¯´ï¼Œä»–æ˜¯ä¸ªå…¨æ–‡æœç´¢å¼•æ“Žï¼Œå¯ä»¥å¿«é€Ÿåœ°å‚¨å­˜ã€æœç´¢å’Œåˆ†æžæµ·é‡æ•°æ®ã€‚ Logstashæ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„å·¥å…·ï¼Œå®ƒå¯ä»¥æŠŠåˆ†æ•£çš„ã€å¤šæ ·åŒ–çš„æ—¥å¿—æ—¥å¿—ï¼Œæˆ–è€…æ˜¯å…¶ä»–æ•°æ®æºçš„æ•°æ®ä¿¡æ¯è¿›è¡Œæ”¶é›†ã€åˆ†æžã€å¤„ç†ï¼Œå¹¶å°†å…¶å­˜å‚¨ä¾›ä»¥åŽä½¿ç”¨ã€‚ Kibanaæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æžå’Œå¯è§†åŒ–å¹³å°ï¼Œè®¾è®¡ç”¨äºŽå’ŒElasticsearchä¸€èµ·å·¥ä½œã€‚ ä½ ç”¨Kibanaæ¥æœç´¢ï¼ŒæŸ¥çœ‹ï¼Œå¹¶å’Œå­˜å‚¨åœ¨Elasticsearchç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œäº¤äº’ã€‚ ä½ å¯ä»¥è½»æ¾åœ°æ‰§è¡Œé«˜çº§æ•°æ®åˆ†æžï¼Œå¹¶ä¸”ä»¥å„ç§å›¾æ ‡ã€è¡¨æ ¼å’Œåœ°å›¾çš„å½¢å¼å¯è§†åŒ–æ•°æ®ã€‚ Kibanaä½¿å¾—ç†è§£å¤§é‡æ•°æ®å˜å¾—å¾ˆå®¹æ˜“ã€‚å®ƒç®€å•çš„ã€åŸºäºŽæµè§ˆå™¨çš„ç•Œé¢ä½¿ä½ èƒ½å¤Ÿå¿«é€Ÿåˆ›å»ºå’Œå…±äº«åŠ¨æ€ä»ªè¡¨æ¿ï¼Œå®žæ—¶æ˜¾ç¤ºElasticsearchæŸ¥è¯¢çš„å˜åŒ–ã€‚ ä¸€ã€å®‰è£…ES 1.1 é¦–å…ˆæ˜¯å®‰è£…JDKï¼š 12345cd /opt/wget --no-cookies --no-check-certificate --header &quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot; &quot;http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz&quot;tar xzf jdk-8u141-linux-x64.tar.gz 1.2 æ·»åŠ çŽ¯å¢ƒå˜é‡ï¼š 123456789101112vim /etc/profileJAVA_HOME=/opt/jdk1.8.0_141JAVA_JRE=$JAVA_HOME/jreCLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/libPATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/binexport JAVA_HOME JRE_HOME CLASS_PATH PATHsource /etc/profilejava -version 1.3 ä¸‹è½½6.2.4ç‰ˆæœ¬ï¼š 123456wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.tar.gztar -xzvf elasticsearch-6.2.4.tar.gztar -zxvf elasticsearch-6.2.4.tar.gzmv elasticsearch-6.2.4 elasticsearch 1.4 é…ç½®sysctl.conf 1234567891011#ä¿®æ”¹sysctlé…ç½®vim /etc/sysctl.conf #æ·»åŠ å¦‚ä¸‹é…ç½®vm.max_map_count=262144 #è®©é…ç½®ç”Ÿæ•ˆsysctl -p #æŸ¥çœ‹é…ç½®çš„æ•°ç›®sysctl -a|grep vm.max_map_count 1.5 elasticsearchä»Ž5.0ç‰ˆæœ¬ä¹‹åŽä¸å…è®¸rootè´¦æˆ·å¯åŠ¨ 1234567891011121314151617181920#æ·»åŠ ç”¨æˆ·adduser dev #è®¾å®šå¯†ç passwd dev #æ·»åŠ æƒé™chown -R dev /opt/elasticsearch #åˆ‡æ¢ç”¨æˆ·su dev #æŸ¥çœ‹å½“å‰ç”¨æˆ·who am i #å¯åŠ¨./elasticsearch/bin/elasticsearch #åŽå°å¯åŠ¨./elasticsearch/bin/elasticsearch -d 1.6 é…ç½®limits.conf 123456789101112131415vim /etc/security/limits.conf æŠŠ* soft nofile 65535* hard nofile 65535 æ”¹ä¸º* soft nofile 65536* hard nofile 65536 #åˆ‡æ¢ç”¨æˆ·su dev #æŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆulimit -Hn 1.7 é…ç½®æ‰€æœ‰ç”¨æˆ·è®¿é—® 1vim /opt/elasticsearch/config/elasticsearch.yml 1.8 æ·»åŠ ä¸€ä¸‹å†…å®¹ 1network.host: 0.0.0.0 1.9 é‡å¯ 12ps -ef | grep elastickill -9 xxxx 1.10 æµ‹è¯•ï¼š 1curl http://localhost:9200/ æ˜¾ç¤ºï¼š 123456789101112131415&#123; &quot;name&quot; : &quot;MmiaBfA&quot;, &quot;cluster_name&quot; : &quot;elasticsearch&quot;, &quot;cluster_uuid&quot; : &quot;zjX-q5PDRLyrWMy5TiBDkw&quot;, &quot;version&quot; : &#123; &quot;number&quot; : &quot;6.2.4&quot;, &quot;build_hash&quot; : &quot;ccec39f&quot;, &quot;build_date&quot; : &quot;2018-04-12T20:37:28.497551Z&quot;, &quot;build_snapshot&quot; : false, &quot;lucene_version&quot; : &quot;7.2.1&quot;, &quot;minimum_wire_compatibility_version&quot; : &quot;5.6.0&quot;, &quot;minimum_index_compatibility_version&quot; : &quot;5.0.0&quot; &#125;, &quot;tagline&quot; : &quot;You Know, for Search&quot;&#125; å°±è¯´æ˜ŽæˆåŠŸäº†ã€‚ äºŒã€å®‰è£…Kibana 6.2.4 1234567wget https://artifacts.elastic.co/downloads/kibana/kibana-6.2.4-linux-x86_64.tar.gztar -zxvf kibana-6.2.4-linux-x86_64.tar.gzmv kibana-6.2.4-linux-x86_64 kibanavim /opt/kibana/config/kibana.yml 2.1 æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 123server.port: 5601server.host: &quot;0.0.0.0&quot;elasticsearch.url: &quot;http://127.0.0.1:9200&quot; 2.2 åˆ‡æ¢åˆ°binç›®å½•ä¸‹ï¼Œå¯åŠ¨å³å¯ã€‚ 12345#ä¸èƒ½å…³é—­ç»ˆç«¯./kibana #å¯å…³é—­ç»ˆç«¯nohup ./kibana &amp; 2.3 å¼€æ”¾é˜²ç«å¢™å’Œå®‰å…¨ç»„å¯¹åº”çš„è¿™ä¸ªç«¯å£ æµè§ˆå™¨è®¿é—®ï¼šhttp://106.14.163.235:5601 çœ‹åˆ°ä¸€ä¸ªæŽ§åˆ¶å°é¡µé¢å°±æˆåŠŸå•¦ã€‚ 2.4 å…³é—­è¿™ä¸ªè¿›ç¨‹ 1234567891011121314ps -ef|grep kibana ps -ef|grep 5601 éƒ½æ‰¾ä¸åˆ° å°è¯• ä½¿ç”¨ fuser -n tcp 5601 kill -9 ç«¯å£ å¯åŠ¨å³å¯ ./kibanaæˆ–è€…åŽ»è¿™ä¸ªç›®å½•ä¸‹çš„.outæ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°çœ‹åˆ°å®ƒå ç”¨çš„pid ä¸‰ã€logstash 1234567891011# ä¸‹è½½wget https://artifacts.elastic.co/downloads/logstash/logstash-6.2.4.tar.gz# è§£åŽ‹tar -zxvf logstash-6.2.4.tar.gz# é‡å‘½åmv logstash-6.2.4.tar.gz logstash# è¿›å…¥cd logstash 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061# æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ æˆ‘è¿™é‡Œæ˜¯mysqltones.confinput &#123; stdin &#123; &#125; jdbc &#123; jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/mama-buy-trade&quot; jdbc_user =&gt; &quot;root&quot; jdbc_password =&gt; &quot;root&quot; jdbc_driver_library =&gt; &quot;/opt/logstash/mysql-connector-java-5.1.46-bin.jar&quot; # the name of the driver class for mysql jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot; jdbc_paging_enabled =&gt; &quot;true&quot; jdbc_page_size =&gt; &quot;50000&quot; # mysqlæ–‡ä»¶, ä¹Ÿå¯ä»¥ç›´æŽ¥å†™SQLè¯­å¥åœ¨æ­¤å¤„ï¼Œå¦‚ä¸‹ï¼š statement =&gt; &quot;SELECT * from t_product&quot; # statement_filepath =&gt; &quot;/opt/logstash/conf/jdbc.sql&quot; # è¿™é‡Œç±»ä¼¼crontab,å¯ä»¥å®šåˆ¶å®šæ—¶æ“ä½œï¼Œæ¯”å¦‚æ¯10åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡åŒæ­¥(åˆ† æ—¶ å¤© æœˆ å¹´) schedule =&gt; &quot;*/10 * * * *&quot; type =&gt; &quot;jdbc&quot; # æ˜¯å¦è®°å½•ä¸Šæ¬¡æ‰§è¡Œç»“æžœ, å¦‚æžœä¸ºçœŸ,å°†ä¼šæŠŠä¸Šæ¬¡æ‰§è¡Œåˆ°çš„ tracking_column å­—æ®µçš„å€¼è®°å½•ä¸‹æ¥,ä¿å­˜åˆ° last_run_metadata_path æŒ‡å®šçš„æ–‡ä»¶ä¸­ record_last_run =&gt; &quot;true&quot; # æ˜¯å¦éœ€è¦è®°å½•æŸä¸ªcolumn çš„å€¼,å¦‚æžœrecord_last_runä¸ºçœŸ,å¯ä»¥è‡ªå®šä¹‰æˆ‘ä»¬éœ€è¦ track çš„ column åç§°ï¼Œæ­¤æ—¶è¯¥å‚æ•°å°±è¦ä¸º true. å¦åˆ™é»˜è®¤ track çš„æ˜¯ timestamp çš„å€¼. use_column_value =&gt; &quot;true&quot; # å¦‚æžœ use_column_value ä¸ºçœŸ,éœ€é…ç½®æ­¤å‚æ•°. track çš„æ•°æ®åº“ column å,è¯¥ column å¿…é¡»æ˜¯é€’å¢žçš„. ä¸€èˆ¬æ˜¯mysqlä¸»é”® tracking_column =&gt; &quot;id&quot; last_run_metadata_path =&gt; &quot;/opt/logstash/conf/last_id&quot; # æ˜¯å¦æ¸…é™¤ last_run_metadata_path çš„è®°å½•,å¦‚æžœä¸ºçœŸé‚£ä¹ˆæ¯æ¬¡éƒ½ç›¸å½“äºŽä»Žå¤´å¼€å§‹æŸ¥è¯¢æ‰€æœ‰çš„æ•°æ®åº“è®°å½• clean_run =&gt; &quot;false&quot; # æ˜¯å¦å°† å­—æ®µ(column) åç§°è½¬å°å†™ lowercase_column_names =&gt; &quot;false&quot; &#125;&#125;# æ­¤å¤„æˆ‘ä¸åšè¿‡æ»¤å¤„ç†filter &#123;&#125;output &#123; # è¾“å‡ºåˆ°elasticsearchçš„é…ç½® elasticsearch &#123; hosts =&gt; [&quot;127.0.0.1:9200&quot;] index =&gt; &quot;jdbc&quot; # å°†&quot;_id&quot;çš„å€¼è®¾ä¸ºmysqlçš„autoidå­—æ®µ document_id =&gt; &quot;%&#123;id&#125;&quot; template_overwrite =&gt; true &#125; # è¿™é‡Œè¾“å‡ºè°ƒè¯•ï¼Œæ­£å¼è¿è¡Œæ—¶å¯ä»¥æ³¨é‡ŠæŽ‰ stdout &#123; codec =&gt; json_lines &#125;&#125; 12# å¯åŠ¨./bin/logstash -f ./mysqltones.conf çœ‹åˆ°è¿™ä¸ªå°±è¯´æ˜ŽæˆåŠŸäº†ï¼š å®‰è£…mysqlæ•°æ®åº“ è¿™ä¸€æ­¥è¦åœ¨æ‰§è¡Œlogstashä¹‹å‰æžå®šï¼Œæˆ‘çš„æ˜¯é˜¿é‡Œäº‘centos7.3ç‰ˆæœ¬ï¼Œmysqlç‰ˆæœ¬æ˜¯5.7ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839# ä¸‹è½½MySQLæºå®‰è£…åŒ…: wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm# å®‰è£…MySQLæºï¼šyum localinstall mysql57-community-release-el7-8.noarch.rpm # æ£€æŸ¥MySQLæºå®‰è£…æƒ…å†µï¼š yum repolist enabled | grep &quot;mysql.*-community.*&quot;# å®‰è£…MySQL: yum install mysql-community-server# å¯åŠ¨MySQL: systemctl start mysqld# æŸ¥çœ‹MySQLçŠ¶æ€: systemctl status mysqld# è®¾ç½®å¼€æœºå¯åŠ¨MySQLï¼šsystemctl enable mysqld systemctl daemon-reload# æŸ¥æ‰¾å¹¶ä¿®æ”¹MySQLé»˜è®¤å¯†ç ï¼ˆæ³¨æ„å¯†ç è¦ç¬¦åˆè§„èŒƒï¼Œå¦åˆ™ä¼šå¤±è´¥ï¼‰ï¼šgrep &apos;temporary password&apos; /var/log/mysqld.log mysql -uroot -p alter user root@localhost identified by &apos;ä½ çš„æ–°å¯†ç &apos;;# è¿œç¨‹è¿žæŽ¥æµ‹è¯•æ·»åŠ è¿œç¨‹è´¦æˆ·ï¼šGRANT ALL PRIVILEGES ON *.* TO &apos;ç”¨æˆ·&apos;@&apos;%&apos; IDENTIFIED BY &apos;å¯†ç &apos; WITH GRANT OPTION;# ç«‹å³ç”Ÿæ•ˆï¼šflush privileges;# é€€å‡ºMySQLï¼šexit# æœ€åŽè¿œç¨‹å°†æ•°æ®ç»™å¯¼å…¥æ•°æ®åº“ å®‰è£…åˆ†è¯å™¨ ik_max_wordæ˜¯åˆ†è¯æ¯”è¾ƒç»†è…»çš„ä¸€æ¬¾ï¼Œæˆ‘ä»¬å°±ç”¨å®ƒæ¥åšåˆ†è¯ï¼Œé¦–å…ˆéœ€è¦å®‰è£…ä¸€ä¸‹ï¼š 12345678# ç›´æŽ¥å®‰è£…./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.2.4/elasticsearch-analysis-ik-6.2.4.zip # é‡æ–°å¯åŠ¨ESps -ef | grep elastickill -9 xxxxsu dev./bin/elasticsearch -d å¯¹è¿™ä¸ªåˆ†è¯å™¨åœ¨kibanaä¸­è¿›è¡Œæµ‹è¯•ï¼š ä¸‹é¢ç»“åˆæ•°æ®åº“æ¨¡æ‹Ÿä¸€ä¸‹ï¼š]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Curator]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F07Curator%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%2F</url>
    <content type="text"><![CDATA[ä»ŽæŠ€æœ¯è§’åº¦å‡ºå‘ï¼Œæ³¨å†Œä¸€ä¸ªç½‘ç«™ï¼Œå†é«˜å¹¶å‘çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å‡ºçŽ°ç”¨æˆ·åé‡å¤è¿™æ ·çš„é—®é¢˜ï¼ˆè™½ç„¶ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå‡ºçŽ°è¿™ç§é—®é¢˜ï¼‰ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿ ä»Žæ•°æ®åº“è§’åº¦ï¼Œå¯¹äºŽå•è¡¨ï¼Œæˆ‘å¯ä»¥ç”¨select .. for updateæ‚²è§‚é”å®žçŽ°ï¼Œæˆ–è€…ç”¨versionè¿™ç§ä¹è§‚é”çš„æ€æƒ³ã€‚ æ›´å¥½çš„æ–¹æ³•æ˜¯å°†è¿™ä¸ªå­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•ï¼Œç”¨æ•°æ®åº“æ¥ä¿è¯ä¸ä¼šé‡å¤ã€‚ä¸€æ—¦æ’å…¥é‡å¤ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºå°±å¯ä»¥æ•èŽ·åˆ°ã€‚ ä½†æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬è¿™é‡Œåˆ†è¡¨äº†ï¼Œä»¥ä¸Šéƒ½æ˜¯é’ˆå¯¹å•è¡¨ï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯é”è¡¨ï¼Œä¸è¡Œï¼Œè®¾ç½®å”¯ä¸€ç´¢å¼•æ˜¯æ²¡æœ‰ç”¨ã€‚æ€Žä¹ˆåŠžå‘¢ï¼Ÿ è§£å†³æ–¹æ¡ˆï¼šç”¨ZKåšä¸€ä¸ªåˆ†å¸ƒå¼é”ã€‚ é¦–å…ˆå‡†å¤‡ä¸€ä¸ªZKå®¢æˆ·ç«¯ï¼Œç”¨çš„æ˜¯Curatoræ¥è¿žæŽ¥æˆ‘ä»¬çš„ZKï¼š 1234567891011121314151617181920@Componentpublic class ZkClient &#123; @Autowired private Parameters parameters; @Bean public CuratorFramework getZkClient()&#123; CuratorFrameworkFactory.Builder builder= CuratorFrameworkFactory.builder() .connectString(parameters.getZkHost()) .connectionTimeoutMs(3000) .retryPolicy(new RetryNTimes(5, 10)); CuratorFramework framework = builder.build(); framework.start(); return framework; &#125;&#125; æ³¨å†Œç”¨ä¸€ä¸ªåˆ†å¸ƒå¼é”æ¥æŽ§åˆ¶ï¼š 1234567891011121314151617181920212223242526272829303132333435@Overridepublic void registerUser(User user) throws Exception &#123; InterProcessLock lock = null; try&#123; lock = new InterProcessMutex(zkClient, Constants.USER_REGISTER_DISTRIBUTE_LOCK_PATH); boolean retry = true; do&#123; if (lock.acquire(3000, TimeUnit.MILLISECONDS))&#123; //æŸ¥è¯¢é‡å¤ç”¨æˆ· User repeatedUser = userMapper.selectByEmail(user.getEmail()); if(repeatedUser!=null)&#123; throw new MamaBuyException("ç”¨æˆ·é‚®ç®±é‡å¤"); &#125; user.setPassword(passwordEncoder.encode(user.getPassword())); user.setNickname("ç ç è´­ç”¨æˆ·"+user.getEmail()); userMapper.insertSelective(user); //è·³å‡ºå¾ªçŽ¯ retry = false; &#125; //å¯ä»¥é€‚å½“ä¼‘æ¯ä¸€ä¼š...ä¹Ÿå¯ä»¥è®¾ç½®é‡å¤æ¬¡æ•°ï¼Œä¸è¦æ— é™å¾ªçŽ¯ &#125;while (retry); &#125;catch (Exception e)&#123; log.error("ç”¨æˆ·æ³¨å†Œå¼‚å¸¸",e); throw e; &#125;finally &#123; if(lock != null)&#123; try &#123; lock.release(); log.info(user.getEmail()+Thread.currentThread().getName()+"é‡Šæ”¾é”"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; æ€è·¯éžå¸¸ç®€å•ï¼Œå°±æ˜¯å…ˆå°è¯•ä¸Šé”ï¼Œå³acquireï¼Œä½†æ˜¯æœ‰å¯èƒ½å¤±è´¥ï¼Œæ‰€ä»¥è¿™é‡Œç”¨ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå³3000msä¹‹å†…ä¸Šä¸äº†é”å°±å¤±è´¥ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªçŽ¯ã€‚æœ€åŽé‡Šæ”¾é”å³å¯ã€‚ okï¼Œè¿™é‡Œè¦æ¥è¯´è¯´ZKå®žçŽ°åˆ†å¸ƒå¼é”äº†ã€‚è¿™é‡Œç”¨äº†å¼€æºå®¢æˆ·ç«¯Curatorï¼Œä»–å¯¹äºŽå®žçŽ°åˆ†å¸ƒå¼é”è¿›è¡Œäº†å°è£…ï¼Œä½†æ˜¯ï¼Œæˆ‘è¿˜æ˜¯æƒ³äº†è§£ä¸€ä¸‹å®ƒçš„å®žçŽ°åŽŸç†ï¼š æ¯ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸ªæ–¹æ³•åŠ é”æ—¶ï¼Œåœ¨zookeeperä¸Šçš„ä¸Žè¯¥æ–¹æ³•å¯¹åº”çš„æŒ‡å®šèŠ‚ç‚¹çš„ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„çž¬æ—¶æœ‰åºèŠ‚ç‚¹ã€‚ åˆ¤æ–­æ˜¯å¦èŽ·å–é”çš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­æœ‰åºèŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ä¸€ä¸ªã€‚ å½“é‡Šæ”¾é”çš„æ—¶å€™ï¼Œåªéœ€å°†è¿™ä¸ªçž¬æ—¶èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚åŒæ—¶ï¼Œå…¶å¯ä»¥é¿å…æœåŠ¡å®•æœºå¯¼è‡´çš„é”æ— æ³•é‡Šæ”¾ï¼Œè€Œäº§ç”Ÿçš„æ­»é”é—®é¢˜ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹å°±æ˜¯Leaderï¼Œè¿›æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸ºé‚£ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯çš„è¯å°±å¯ä»¥èŽ·å–åˆ°é”ï¼Œåä¹‹ä¸è¡Œã€‚ ä¸ºä»€ä¹ˆä¸èƒ½é€šè¿‡å¤§å®¶ä¸€èµ·åˆ›å»ºèŠ‚ç‚¹ï¼Œå¦‚æžœè°æˆåŠŸäº†å°±ç®—èŽ·å–åˆ°äº†é”ã€‚ å¤šä¸ªclientåˆ›å»ºä¸€ä¸ªåŒåçš„èŠ‚ç‚¹ï¼Œå¦‚æžœèŠ‚ç‚¹è°åˆ›å»ºæˆåŠŸé‚£ä¹ˆè¡¨ç¤ºèŽ·å–åˆ°äº†é”ï¼Œåˆ›å»ºå¤±è´¥è¡¨ç¤ºæ²¡æœ‰èŽ·å–åˆ°é”ã€‚ ç­”ï¼šä½¿ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å¯ä»¥ä¿è¯èŽ·å¾—é”çš„å…¬å¹³æ€§ï¼ŒåŠè°å…ˆæ¥è°å°±å…ˆå¾—åˆ°é”ï¼Œè¿™ç§æ–¹å¼æ˜¯éšæœºèŽ·å–é”ï¼Œä¼šé€ æˆæ— åºå’Œé¥¥é¥¿ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Session]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F06Spring%20Session%2F</url>
    <content type="text"><![CDATA[åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨http sessionåŽ»ç®¡ç†ç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯åˆ°äº†åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹ï¼Œæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºsessionå¯¹äºŽä¸åŒçš„æœºå™¨æ˜¯éš”ç¦»çš„ï¼Œè€Œhttpæœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œé‚£ä¹ˆå°±æ— æ³•åˆ¤æ–­å‡ºç”¨æˆ·åœ¨å“ªä¸€ä¸ªæœåŠ¡å™¨ä¸Šç™»é™†çš„ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„åœ°æ–¹å­˜å‚¨ç”¨æˆ·sessionã€‚spring sessionå¯ä»¥åšåˆ°æ— ä»£ç ä¾µå…¥çš„æ–¹å¼å®žçŽ°åˆ†å¸ƒå¼sessionå­˜å‚¨ã€‚ åœ¨spring bootå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å…ˆæ³¨å†Œç›¸åº”beanå¹¶ä¸”æ‰“å¼€ç›¸åº”çš„æ³¨è§£ï¼š 1234567891011121314151617181920212223242526272829@Configuration@EnableRedisHttpSession //(maxInactiveIntervalInSeconds = 604800)//sessionè¶…æ—¶public class HttpSessionConfig &#123; @Autowired private Parameters parameters; @Bean public HttpSessionStrategy httpSessionStrategy()&#123; return new HeaderHttpSessionStrategy(); &#125; @Bean public JedisConnectionFactory connectionFactory()&#123; JedisConnectionFactory connectionFactory = new JedisConnectionFactory(); String redisHost = parameters.getRedisNode().split(":")[0]; int redisPort = Integer.valueOf(parameters.getRedisNode().split(":")[1]); connectionFactory.setTimeout(2000); connectionFactory.setHostName(redisHost); connectionFactory.setPort(redisPort);// connectionFactory.setPassword(parameters.getRedisAuth()); return connectionFactory; &#125;&#125; okï¼Œè¿™æ ·å­å…¶å®žå°±é…ç½®å¥½äº†ï¼Œä¸€å¼€å§‹æˆ‘ä¹Ÿäº‘é‡Œé›¾é‡Œçš„ï¼Œè¿™æ˜¯å•¥çŽ©æ„ï¼Ÿ å…¶å®žå®˜ç½‘çš„æ–‡æ¡£ä¸­è®²çš„æ˜¯æœ€å‡†ç¡®çš„ã€‚æ‰€ä»¥è¿˜æ˜¯å®˜ç½‘çœ‹çœ‹å§ï¼ okï¼Œæ¥spring sessionçš„å®˜ç½‘(https://spring.io/projects/spring-session)æ¥çœ‹çœ‹æŠŠï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹1.3.4GAç‰ˆæœ¬çš„æ–‡æ¡£(https://docs.spring.io/spring-session/docs/1.3.4.RELEASE/reference/html5/#httpsession-rest). spring sessionå¯ä»¥å­˜åœ¨å¾ˆå¤šä»‹è´¨ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æ•°æ®æºï¼Œæ¯”å¦‚redisï¼Œç”šè‡³æ˜¯mongodbç­‰ã€‚ä½†æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯å­˜åœ¨redisä¸­ï¼Œç»“åˆredisçš„è¿‡æœŸæœºåˆ¶æ¥åšã€‚ æ‰€ä»¥å…¶å®žæˆ‘ä»¬åªè¦å…³å¿ƒå¦‚ä½•è·Ÿredisæ•´åˆï¼Œä»¥åŠrestfulæŽ¥å£ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€å¼€å§‹æ–‡æ¡£å°±å‘Šè¯‰æˆ‘ä»¬è¦é…ç½®ä¸€ä¸‹HttpSessionStrategyå’Œå­˜å‚¨ä»‹è´¨ã€‚ä»ŽHttpSessionStrategyè¯­ä¹‰å°±èƒ½å¤§è‡´çœ‹å‡ºé…ç½®çš„æ˜¯å®ƒçš„ç­–ç•¥ï¼Œæ˜¯åŸºäºŽheaderçš„ç­–ç•¥ã€‚è¿™ä¸ªæ˜¯ä»€ä¹ˆæ„æ€ï¼Œä¸‹é¢ä¼šæåˆ°ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹çœ‹æ–‡æ¡£å§ï¼ å¥½äº†ï¼Œæˆ‘ä»¬çŸ¥é“äº†å®ƒçš„åŸºæœ¬åŽŸç†ï¼Œä¸‹é¢æ¥çœ‹çœ‹æ˜¯å¦‚ä½•åœ¨restfulæŽ¥å£ä¸­å®žçŽ°ç”¨æˆ·sessionçš„ç®¡ç†çš„ï¼š ä¹Ÿå°±æ˜¯è¯´è¦æƒ³åœ¨restfulæŽ¥å£åº”ç”¨ä¸­ç”¨è¿™ç§æ–¹å¼ï¼Œç›´æŽ¥å‘Šè¯‰spring session:return new HeaderHttpSessionStrategy();å³å¯ã€‚è¿›å…¥æºç æˆ‘ä»¬å°±ä¼šçŸ¥é“ï¼Œå®ƒé»˜è®¤ç»™è¿™ä¸ªheaderé‡Œé¢æ”¾ç½®çš„ä¸€æ¡ç±»ä¼¼äºŽtokençš„åå­—æ˜¯private String headerName = &quot;x-auth-token&quot;;ã€‚ é‚£ä¹ˆåœ¨ç”¨æˆ·ç™»é™†æˆåŠŸä¹‹åŽï¼Œåˆ°åº•å­˜åˆ°æ˜¯ä»€ä¹ˆå‘¢ï¼Œå…ˆæ¥çœ‹çœ‹å“åº”æ•°æ®çš„headeré‡Œé¢æ˜¯ä»€ä¹ˆï¼š è¿™ä¸€ä¸²æ•°å­—æ­£å¥½å¯ä»¥è·Ÿredisä¸­å¯¹åº”ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¥redisä¸­çœ‹çœ‹åˆ°åº•åœ¨é‡Œé¢å­˜å‚¨äº†å•¥çŽ©æ„ï¼š æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†æƒ³è¦çœ‹åˆ°çš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹redisä¸­å­˜å‚¨çš„ä¸œè¥¿ï¼š spring:sessionæ˜¯é»˜è®¤çš„Redis HttpSessionå‰ç¼€ï¼ˆredisä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨â€™:â€™ä½œä¸ºåˆ†å‰²ç¬¦ï¼‰ æ¯ä¸€ä¸ªsessionéƒ½ä¼šæœ‰ä¸‰ä¸ªç›¸å…³çš„keyï¼Œç¬¬ä¸€ä¸ªkey(spring:session:sessions:37...)æœ€ä¸ºé‡è¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªHASHæ•°æ®ç»“æž„ï¼Œå°†å†…å­˜ä¸­çš„sessionä¿¡æ¯åºåˆ—åŒ–åˆ°äº†redisä¸­ã€‚å¦‚æœ¬é¡¹ç›®ä¸­ç”¨æˆ·ä¿¡æ¯,è¿˜æœ‰ä¸€äº›metaä¿¡æ¯ï¼Œå¦‚åˆ›å»ºæ—¶é—´ï¼Œæœ€åŽè®¿é—®æ—¶é—´ç­‰ã€‚ å¦å¤–ä¸¤ä¸ªkeyï¼Œä¸€ä¸ªæ˜¯spring:session:expirationï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯spring:session:sessions:expiresï¼Œå‰è€…æ˜¯ä¸€ä¸ªSETç±»åž‹ï¼ŒåŽè€…æ˜¯ä¸€ä¸ªSTRINGç±»åž‹ï¼Œå¯èƒ½ä¼šæœ‰è¯»è€…å‘å‡ºè¿™æ ·çš„ç–‘é—®ï¼Œredisè‡ªèº«å°±æœ‰è¿‡æœŸæ—¶é—´çš„è®¾ç½®æ–¹å¼TTLï¼Œä¸ºä»€ä¹ˆè¦é¢å¤–æ·»åŠ ä¸¤ä¸ªkeyæ¥ç»´æŒsessionè¿‡æœŸçš„ç‰¹æ€§å‘¢ï¼Ÿredisæ¸…é™¤è¿‡æœŸkeyçš„è¡Œä¸ºæ˜¯ä¸€ä¸ªå¼‚æ­¥è¡Œä¸ºä¸”æ˜¯ä¸€ä¸ªä½Žä¼˜å…ˆçº§çš„è¡Œä¸ºï¼Œç”¨æ–‡æ¡£ä¸­çš„åŽŸè¯æ¥è¯´ä¾¿æ˜¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´sessionä¸è¢«æ¸…é™¤ã€‚äºŽæ˜¯å¼•å…¥äº†ä¸“é—¨çš„expiresKeyï¼Œæ¥ä¸“é—¨è´Ÿè´£sessionçš„æ¸…é™¤ï¼ŒåŒ…æ‹¬æˆ‘ä»¬è‡ªå·±åœ¨ä½¿ç”¨redisæ—¶ä¹Ÿéœ€è¦å…³æ³¨è¿™ä¸€ç‚¹ã€‚ è¿™æ ·å­ï¼Œå°±å¯ä»¥ç”¨ç‹¬ç«‹çš„redisæ¥å­˜å‚¨ç”¨æˆ·çš„ä¿¡æ¯ï¼Œé€šè¿‡å‰ç«¯ä¼ æ¥çš„headeré‡Œé¢çš„tokenï¼Œå°±å¯ä»¥åˆ°redisæ‹¿å‡ºå½“å‰ç™»é™†ç”¨æˆ·çš„ä¿¡æ¯äº†ã€‚ OKï¼Œåœ¨è§£å†³äº†spring sessionçš„é—®é¢˜ä¹‹åŽï¼Œä¸‹é¢å°±å¯ä»¥æ¥å®žçŽ°ç™»é™†å•¦ï¼š controller: 1234567891011121314@RequestMapping("login")public ApiResult login(@RequestBody @Valid User user, HttpSession session)&#123; ApiResult&lt;UserElement&gt; result = new ApiResult&lt;&gt;(Constants.RESP_STATUS_OK,"ç™»å½•æˆåŠŸ"); UserElement ue= userService.login(user); if(ue != null)&#123; if(session.getAttribute(Constants.REQUEST_USER_SESSION) == null)&#123; session.setAttribute(Constants.REQUEST_USER_SESSION,ue); &#125; result.setData(ue); &#125; return result;&#125; å°±è·Ÿä»¥å‰ä¸€æ ·ï¼Œå°†sessionç›´æŽ¥å­˜è¿›åŽ»å°±å¯ä»¥äº†ã€‚ 12345678910111213141516171819202122@Overridepublic UserElement login(User user) &#123; UserElement ue = null; User userExist = userMapper.selectByEmail(user.getEmail()); if(userExist != null)&#123; //å¯¹å¯†ç ä¸Žæ•°æ®åº“å¯†ç è¿›è¡Œæ ¡éªŒ boolean result = passwordEncoder.matches(user.getPassword(),userExist.getPassword()); if(!result)&#123; throw new MamaBuyException("å¯†ç é”™è¯¯"); &#125;else&#123; //æ ¡éªŒå…¨éƒ¨é€šè¿‡ï¼Œç™»é™†é€šè¿‡ ue = new UserElement(); ue.setUserId(userExist.getId()); ue.setEmail(userExist.getEmail()); ue.setNickname(userExist.getNickname()); ue.setUuid(userExist.getUuid()); &#125; &#125;else &#123; throw new MamaBuyException("ç”¨æˆ·ä¸å­˜åœ¨"); &#125; return ue;&#125;]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼IDç”Ÿæˆç­–ç•¥]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F05%E5%88%86%E5%B8%83%E5%BC%8FID%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹å¦‚ä½•ä¿è¯IDçš„ä¸é‡å¤å‘¢ï¼Ÿä¸€èˆ¬æˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°ç”¨UUIDæ¥å®žçŽ°å˜›ã€‚ä½†æ˜¯UUIDä¸€èˆ¬å¯ä»¥èŽ·å–å½“å‰æ—¶é—´çš„æ¯«ç§’æ•°å†åŠ ç‚¹éšæœºæ•°ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘ä¸‹ä»ç„¶å¯èƒ½é‡å¤ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¦‚æžœæˆ‘è¦ç”¨è¿™ç§UUIDæ¥ç”Ÿæˆåˆ†è¡¨çš„å”¯ä¸€IDçš„è¯ï¼Œé‡å¤ä¸è°ˆï¼Œè¿™ç§éšæœºçš„å­—ç¬¦ä¸²å¯¹äºŽæˆ‘ä»¬çš„innodbå­˜å‚¨å¼•æ“Žçš„æ’å…¥æ•ˆçŽ‡æ˜¯å¾ˆä½Žçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç”Ÿæˆçš„IDå¦‚æžœä½œä¸ºä¸»é”®ï¼Œæœ€å¥½æœ‰ä¸¤ç§ç‰¹æ€§ï¼šåˆ†å¸ƒå¼å”¯ä¸€å’Œæœ‰åºã€‚ å”¯ä¸€æ€§å°±ä¸ç”¨è¯´äº†ï¼Œæœ‰åºä¿è¯äº†å¯¹ç´¢å¼•å­—æ®µçš„æ’å…¥çš„é«˜æ•ˆæ€§ã€‚æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ShardingJDBCçš„åˆ†å¸ƒå¼IDç”Ÿæˆç­–ç•¥æ˜¯å¦‚ä½•ä¿è¯ã€‚ snowflakeç®—æ³• sharding-jdbcçš„åˆ†å¸ƒå¼IDé‡‡ç”¨twitterå¼€æºçš„snowflakeç®—æ³•ï¼Œä¸éœ€è¦ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œè¿™æ ·å…¶æ‰©å±•æ€§å’Œç»´æŠ¤æ€§å¾—åˆ°æœ€å¤§çš„ç®€åŒ–ï¼›ä½†æ˜¯snowflakeç®—æ³•çš„ç¼ºé™·ï¼ˆå¼ºä¾èµ–æ—¶é—´ï¼Œå¦‚æžœæ—¶é’Ÿå›žæ‹¨ï¼Œå°±ä¼šç”Ÿæˆé‡å¤çš„IDï¼‰ã€‚ é›ªèŠ±ç®—æ³•æ˜¯ç”±Twitterå…¬å¸ƒçš„åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆç®—æ³•ï¼Œå®ƒèƒ½å¤Ÿä¿è¯ä¸åŒè¿›ç¨‹ä¸»é”®çš„ä¸é‡å¤æ€§ï¼Œä»¥åŠç›¸åŒè¿›ç¨‹ä¸»é”®çš„æœ‰åºæ€§ã€‚ åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå®ƒé¦–å…ˆæ˜¯é€šè¿‡æ—¶é—´ä½ä¿è¯ä¸é‡å¤ï¼Œå¦‚æžœæ—¶é—´ç›¸åŒåˆ™æ˜¯é€šè¿‡åºåˆ—ä½ä¿è¯ã€‚ åŒæ—¶ç”±äºŽæ—¶é—´ä½æ˜¯å•è°ƒé€’å¢žçš„ï¼Œä¸”å„ä¸ªæœåŠ¡å™¨å¦‚æžœå¤§ä½“åšäº†æ—¶é—´åŒæ­¥ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ä¸»é”®åœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒå¯ä»¥è®¤ä¸ºæ˜¯æ€»ä½“æœ‰åºçš„ï¼Œè¿™å°±ä¿è¯äº†å¯¹ç´¢å¼•å­—æ®µçš„æ’å…¥çš„é«˜æ•ˆæ€§ã€‚ä¾‹å¦‚MySQLçš„Innodbå­˜å‚¨å¼•æ“Žçš„ä¸»é”®ã€‚ ä½¿ç”¨é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ä¸»é”®ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼åŒ…å«4éƒ¨åˆ†ï¼Œä»Žé«˜ä½åˆ°ä½Žä½åˆ†è¡¨ä¸ºï¼š1bitç¬¦å·ä½ã€41bitæ—¶é—´æˆ³ä½ã€10bitå·¥ä½œè¿›ç¨‹ä½ä»¥åŠ12bitåºåˆ—å·ä½ã€‚ é›ªèŠ±ç®—æ³•ä¸»é”®çš„è¯¦ç»†ç»“æž„è§ä¸‹å›¾ã€‚ ç¬¦å·ä½(1bit) é¢„ç•™çš„ç¬¦å·ä½ï¼Œæ’ä¸ºé›¶ã€‚ æ—¶é—´æˆ³ä½(41bit) 41ä½çš„æ—¶é—´æˆ³å¯ä»¥å®¹çº³çš„æ¯«ç§’æ•°æ˜¯2çš„41æ¬¡å¹‚ï¼Œä¸€å¹´æ‰€ä½¿ç”¨çš„æ¯«ç§’æ•°æ˜¯ï¼š365 * 24 * 60 * 60 * 1000ã€‚é€šè¿‡è®¡ç®—å¯çŸ¥ï¼š 1Math.pow(2, 41) / (365 * 24 * 60 * 60 * 1000L); ç»“æžœçº¦ç­‰äºŽ69.73å¹´ã€‚ShardingSphereçš„é›ªèŠ±ç®—æ³•çš„æ—¶é—´çºªå…ƒä»Ž2016å¹´11æœˆ1æ—¥é›¶ç‚¹å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ°2086å¹´ï¼Œç›¸ä¿¡èƒ½æ»¡è¶³ç»å¤§éƒ¨åˆ†ç³»ç»Ÿçš„è¦æ±‚ã€‚ å·¥ä½œè¿›ç¨‹ä½(10bit) è¯¥æ ‡å¿—åœ¨Javaè¿›ç¨‹å†…æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æžœæ˜¯åˆ†å¸ƒå¼åº”ç”¨éƒ¨ç½²åº”ä¿è¯æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„idæ˜¯ä¸åŒçš„ã€‚è¯¥å€¼é»˜è®¤ä¸º0ï¼Œå¯é€šè¿‡è°ƒç”¨é™æ€æ–¹æ³•DefaultKeyGenerator.setWorkerId()è®¾ç½®ã€‚ åºåˆ—å·ä½(12bit) è¯¥åºåˆ—æ˜¯ç”¨æ¥åœ¨åŒä¸€ä¸ªæ¯«ç§’å†…ç”Ÿæˆä¸åŒçš„IDã€‚å¦‚æžœåœ¨è¿™ä¸ªæ¯«ç§’å†…ç”Ÿæˆçš„æ•°é‡è¶…è¿‡4096(2çš„12æ¬¡å¹‚)ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨ä¼šç­‰å¾…åˆ°ä¸‹ä¸ªæ¯«ç§’ç»§ç»­ç”Ÿæˆã€‚ æ—¶é’Ÿå›žæ‹¨ æœåŠ¡å™¨æ—¶é’Ÿå›žæ‹¨ä¼šå¯¼è‡´äº§ç”Ÿé‡å¤åºåˆ—ï¼Œå› æ­¤é»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨æä¾›äº†ä¸€ä¸ªæœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›žæ‹¨æ¯«ç§’æ•°ã€‚ å¦‚æžœæ—¶é’Ÿå›žæ‹¨çš„æ—¶é—´è¶…è¿‡æœ€å¤§å®¹å¿çš„æ¯«ç§’æ•°é˜ˆå€¼ï¼Œåˆ™ç¨‹åºæŠ¥é”™ï¼›å¦‚æžœåœ¨å¯å®¹å¿çš„èŒƒå›´å†…ï¼Œé»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ä¼šç­‰å¾…æ—¶é’ŸåŒæ­¥åˆ°æœ€åŽä¸€æ¬¡ä¸»é”®ç”Ÿæˆçš„æ—¶é—´åŽå†ç»§ç»­å·¥ä½œã€‚ æœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›žæ‹¨æ¯«ç§’æ•°çš„é»˜è®¤å€¼ä¸º0ï¼Œå¯é€šè¿‡è°ƒç”¨é™æ€æ–¹æ³•DefaultKeyGenerator.setMaxTolerateTimeDifferenceMilliseconds()è®¾ç½®ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[springMVCå…¨å±€å¼‚å¸¸+springåŒ…æ‰«æåŒ…éš”ç¦»+springäº‹åŠ¡ä¼ æ’­]]></title>
    <url>%2F2019%2F01%2F22%2Fmiscellany%2F04springMVC%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%2Bspring%E5%8C%85%E6%89%AB%E6%8F%8F%E5%8C%85%E9%9A%94%E7%A6%BB%2Bspring%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%2F</url>
    <content type="text"><![CDATA[åœ¨å¼€å‘ä¸­ï¼ŒspringMVCå…¨å±€å¼‚å¸¸+springåŒ…æ‰«æåŒ…éš”ç¦»+springäº‹åŠ¡ä¼ æ’­è¿™ä¸‰ä¸ªä¸å¯èƒ½ä¸ä¼šé‡åˆ°ã€‚ä¸‹é¢æ¥å¥½å¥½è¯´è¯´ä»–ä»¬å§ã€‚ 1ã€å…¨å±€å¼‚å¸¸å¼•å…¥åŽŸå›  å‡è®¾åœ¨æˆ‘ä»¬çš„login.doçš„controlleræ–¹æ³•ä¸­ç¬¬ä¸€è¡Œå¢žåŠ ä¸€å¥ï¼š 1int i = 1/0; é‡æ–°å¯åŠ¨æœåŠ¡å™¨è¿›è¡Œç”¨æˆ·ç™»å½•æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š 123java.lang.ArithmeticException: / by zero com.swg.controller.portal.UserController.login(UserController.java:37) ...å…¶ä»–çš„å †æ ˆä¿¡æ¯ è¿™äº›ä¿¡æ¯ä¼šç›´æŽ¥æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šï¼Œå¦‚æžœæ˜¯å…³äºŽæ•°æ®åº“çš„é”™è¯¯ï¼ŒåŒæ ·ï¼Œä¼šè¯¦ç»†åœ°å°†æ•°æ®åº“ä¸­çš„å­—æ®µéƒ½æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè¿™å¯¹äºŽæˆ‘ä»¬çš„é¡¹ç›®æ¥è¯´æ˜¯å­˜åœ¨å¾ˆå¤§çš„å®‰å…¨éšæ‚£çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦ç”¨å…¨å±€å¼‚å¸¸æ¥å¤„ç†ï¼Œå¦‚æžœå‘ç”Ÿå¼‚å¸¸ï¼Œæˆ‘ä»¬å°±å¯¹å…¶è¿›è¡Œæ‹¦æˆªï¼Œå¹¶ä¸”åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæˆ‘ä»¬ç»™å‡ºçš„æç¤ºä¿¡æ¯ã€‚ å¯¹äºŽSpringBootï¼Œä¸€èˆ¬å…¨å±€å¼‚å¸¸æ˜¯: 1234567891011121314151617@ControllerAdvice@ResponseBody@Slf4jpublic class ExceptionHandlerAdvice &#123; @ExceptionHandler(Exception.class) public ServerResponse handleException(Exception e)&#123; log.error(e.getMessage(),e); return ServerResponse.createByErrorCodeMessage(Constants.RESP_STATUS_INTERNAL_ERROR,"ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åŽå†è¯•"); &#125; @ExceptionHandler(SnailmallException.class) public ServerResponse handleException(SnailmallException e)&#123; log.error(e.getMessage(),e); return ServerResponse.createByErrorCodeMessage(e.getExceptionStatus(),e.getMessage()); &#125;&#125; 2ã€å¼•å…¥å…¨å±€å¼‚å¸¸ 12345678910111213@Slf4j@Componentpublic class ExceptionResolver implements HandlerExceptionResolver&#123; @Override public ModelAndView resolveException(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) &#123; log.error("exception:&#123;&#125;",httpServletRequest.getRequestURI(),e); ModelAndView mv = new ModelAndView(new MappingJacksonJsonView()); mv.addObject("status",ResponseEnum.ERROR.getCode()); mv.addObject("msg","æŽ¥å£å¼‚å¸¸ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹æ—¥å¿—ä¸­çš„å¼‚å¸¸ä¿¡æ¯"); mv.addObject("data",e.toString()); return mv; &#125;&#125; é‚£ä¹ˆï¼Œå†æ‰§è¡Œç™»é™†æ“ä½œä¹‹åŽï¼Œå°±ä¸ä¼šåœ¨é¡µé¢ä¸Šç›´æŽ¥æ˜¾ç¤ºå¼‚å¸¸ä¿¡æ¯äº†ã€‚æœ‰æ•ˆåœ°å±è”½äº†å…³é”®ä¿¡æ¯ã€‚ 3ã€springå’Œspringmvcé…ç½®æ–‡ä»¶çš„ä¼˜åŒ– 3.1 åŒ…éš”ç¦»ä¼˜åŒ– åœ¨ç¼–å†™å…¨å±€å¼‚å¸¸ä¹‹å‰ï¼Œå…ˆè¿›è¡Œäº†åŒ…éš”ç¦»å’Œä¼˜åŒ–ï¼Œä¸€æœŸä¸­çš„æ‰«æåŒ…çš„å†™æ³•æ˜¯ï¼š 12345&lt;!--spring:--&gt;&lt;context:component-scan base-package="com.swg" annotation-config="true"/&gt;&lt;!--springmvc:--&gt;&lt;context:component-scan base-package="com.swg" annotation-config="true"/&gt; å³springå’Œspringmvcæ‰«æåŒ…ä¸‹é¢çš„æ‰€æœ‰çš„beanå’Œcontroller.ä¼˜åŒ–åŽçš„ä»£ç é…ç½®ï¼š 1234567891011#spring&lt;context:component-scan base-package="com.swg" annotation-config="true"&gt;&lt;!--å°†controllerçš„æ‰«ææŽ’é™¤æŽ‰--&gt; &lt;context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/&gt;&lt;/context:component-scan&gt;#springmvc&lt;context:component-scan base-package="com.swg.controller" annotation-config="true" use-default-filters="false"&gt;&lt;!--æ·»åŠ ç™½åå•ï¼Œåªæ‰«æcontrollerï¼Œæ€»ä¹‹è¦å°†serviceç»™æŽ’é™¤æŽ‰å³å¯--&gt; &lt;context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/&gt;&lt;/context:component-scan&gt; è¿™æ ·åšçš„åŽŸå› æ˜¯ï¼šSpringå’ŒSpringMVCæ˜¯æœ‰çˆ¶å­å®¹å™¨å…³ç³»çš„ï¼Œè€Œä¸”æ­£æ˜¯å› ä¸ºè¿™ä¸ªæ‰å¾€å¾€ä¼šå‡ºçŽ°åŒ…æ‰«æçš„é—®é¢˜ã€‚ é’ˆå¯¹åŒ…æ‰«æåªè¦è®°ä½ä»¥ä¸‹å‡ ç‚¹å³å¯ï¼š springæ˜¯çˆ¶å®¹å™¨ï¼Œspringmvcæ˜¯å­å®¹å™¨ï¼Œå­å®¹å™¨å¯ä»¥è®¿é—®çˆ¶å®¹å™¨çš„bean,çˆ¶å®¹å™¨ä¸èƒ½è®¿é—®å­å®¹å™¨çš„beanã€‚ åªæœ‰é¡¶çº§å®¹å™¨ï¼ˆspringï¼‰æ‰æœ‰åŠ å¼ºçš„äº‹åŠ¡èƒ½åŠ›ï¼Œè€Œspringmvcå®¹å™¨çš„serviceæ˜¯æ²¡æœ‰çš„ã€‚ å¦‚æžœspringmvcä¸é…ç½®åŒ…æ‰«æçš„è¯ï¼Œé¡µé¢404. 3.2 äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ é’ˆå¯¹äº‹åŠ¡ï¼Œä¸å¾—ä¸å±•å¼€è¯´æ˜Žspringäº‹åŠ¡çš„å‡ ç§ä¼ æ’­æœºåˆ¶äº†ã€‚åœ¨ spring çš„ TransactionDefinition æŽ¥å£ä¸­ä¸€å…±å®šä¹‰äº†ä¸ƒç§äº‹åŠ¡ä¼ æ’­å±žæ€§ï¼š PROPAGATION_REQUIRED â€“ æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚è¿™æ˜¯æœ€å¸¸è§çš„é€‰æ‹©ï¼ˆé»˜è®¤ï¼‰ã€‚ PROPAGATION_SUPPORTS â€“ æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éžäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚ PROPAGATION_MANDATORY â€“ æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚ PROPAGATION_REQUIRES_NEW â€“ æ–°å»ºäº‹åŠ¡ï¼Œå¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ PROPAGATION_NOT_SUPPORTED â€“ ä»¥éžäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ PROPAGATION_NEVER â€“ ä»¥éžäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ PROPAGATION_NESTED â€“ å¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™è¿›è¡Œä¸ŽPROPAGATION_REQUIREDç±»ä¼¼çš„æ“ä½œã€‚ 4ã€è¡¥å…… Springé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå¯¹è¿è¡ŒæœŸä¾‹å¤–(RunTimeException)ï¼Œå³uncheckå¼‚å¸¸ï¼Œè¿›è¡Œäº‹åŠ¡å›žæ»šã€‚å¦‚æžœé‡åˆ°checkedå¼‚å¸¸å°±ä¸å›žæ»šã€‚å¦‚ä½•æ”¹å˜é»˜è®¤è§„åˆ™ï¼š è®©checkedä¾‹å¤–ä¹Ÿå›žæ»šï¼šåœ¨æ•´ä¸ªæ–¹æ³•å‰åŠ ä¸Š @Transactional(rollbackFor=Exception.class) è®©uncheckedä¾‹å¤–ä¸å›žæ»šï¼š @Transactional(notRollbackFor=RunTimeException.class) ä¸éœ€è¦äº‹åŠ¡ç®¡ç†çš„(åªæŸ¥è¯¢çš„)æ–¹æ³•ï¼š@Transactional(propagation=Propagation.NOT_SUPPORTED) 5ã€é‚£ä¹ˆä»€ä¹ˆæ˜¯åµŒå¥—äº‹åŠ¡å‘¢ï¼Ÿ åµŒå¥—æ˜¯å­äº‹åŠ¡å¥—åœ¨çˆ¶äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿›å…¥å­äº‹åŠ¡ä¹‹å‰ï¼Œçˆ¶äº‹åŠ¡å»ºç«‹ä¸€ä¸ªå›žæ»šç‚¹ï¼Œå«åšsave pointï¼Œç„¶åŽæ‰§è¡Œå­äº‹åŠ¡ï¼Œè¿™ä¸ªå­äº‹åŠ¡çš„æ‰§è¡Œä¹Ÿç®—æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åŽå­äº‹åŠ¡æ‰§è¡Œç»“æŸï¼Œçˆ¶äº‹åŠ¡ç»§ç»­æ‰§è¡Œã€‚é‡ç‚¹åœ¨äºŽé‚£ä¸ªsave pointï¼Œçœ‹ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š é—®é¢˜1ï¼šå¦‚æžœå­äº‹åŠ¡å›žæ»šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ çˆ¶äº‹åŠ¡ä¼šå›žåˆ°è¿›å…¥å­äº‹åŠ¡å‰å»ºç«‹çš„save pointï¼Œç„¶åŽå°è¯•å…¶ä»–çš„äº‹åŠ¡æˆ–è€…å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ï¼Œçˆ¶äº‹åŠ¡ä¹‹å‰çš„æ“ä½œä¸ä¼šå—åˆ°å½±å“ï¼Œæ›´ä¸ä¼šè‡ªåŠ¨å›žæ»šã€‚ é—®é¢˜2ï¼šå¦‚æžœçˆ¶äº‹åŠ¡å›žæ»šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ çˆ¶äº‹åŠ¡å›žæ»šï¼Œå­äº‹åŠ¡ä¹Ÿä¼šè·Ÿç€å›žæ»šï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºçˆ¶äº‹åŠ¡ç»“æŸä¹‹å‰ï¼Œå­äº‹åŠ¡æ˜¯ä¸ä¼šæäº¤çš„ï¼Œæˆ‘ä»¬è¯´å­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œæ­£æ˜¯è¿™ä¸ªé“ç†/ é—®é¢˜3ï¼šçˆ¶äº‹åŠ¡å…ˆæäº¤ï¼Œç„¶åŽå­äº‹åŠ¡å†æäº¤ï¼›è¿˜æ˜¯å­äº‹åŠ¡å…ˆæäº¤ï¼Œç„¶åŽçˆ¶äº‹åŠ¡å†æäº¤å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ç¬¬äºŒç§æƒ…å†µï¼Œå­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œç”±çˆ¶äº‹åŠ¡åŒæ„æäº¤ã€‚ 6ã€springé…ç½®æ–‡ä»¶çš„ä¸€äº›ç†è§£ï¼š å®¹å™¨ åœ¨Springæ•´ä½“æ¡†æž¶çš„æ ¸å¿ƒæ¦‚å¿µä¸­ï¼Œå®¹å™¨æ˜¯æ ¸å¿ƒæ€æƒ³ï¼Œå°±æ˜¯ç”¨æ¥ç®¡ç†Beançš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„ï¼Œè€Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå®¹å™¨ä¸ä¸€å®šåªæœ‰ä¸€ä¸ªï¼ŒSpringä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªå®¹å™¨ï¼Œè€Œä¸”å®¹å™¨æœ‰ä¸Šä¸‹å±‚å…³ç³»ï¼Œç›®å‰æœ€å¸¸è§çš„ä¸€ç§åœºæ™¯å°±æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å¼•å…¥Springå’ŒSpringMVCè¿™ä¸¤ä¸ªæ¡†æž¶ï¼Œé‚£ä¹ˆå®ƒå…¶å®žå°±æ˜¯ä¸¤ä¸ªå®¹å™¨ï¼ŒSpringæ˜¯çˆ¶å®¹å™¨ï¼ŒSpringMVCæ˜¯å…¶å­å®¹å™¨ï¼Œå¹¶ä¸”åœ¨Springçˆ¶å®¹å™¨ä¸­æ³¨å†Œçš„Beanå¯¹äºŽSpringMVCå®¹å™¨ä¸­æ˜¯å¯è§çš„ï¼Œè€Œåœ¨SpringMVCå®¹å™¨ä¸­æ³¨å†Œçš„Beanå¯¹äºŽSpringçˆ¶å®¹å™¨ä¸­æ˜¯ä¸å¯è§çš„ï¼Œä¹Ÿå°±æ˜¯å­å®¹å™¨å¯ä»¥çœ‹è§çˆ¶å®¹å™¨ä¸­çš„æ³¨å†Œçš„Beanï¼Œåä¹‹å°±ä¸è¡Œã€‚ 1&lt;context:component-scan base-package="com.springmvc.test" /&gt; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„å¦‚ä¸‹æ³¨è§£é…ç½®æ¥å¯¹Beanè¿›è¡Œæ‰¹é‡æ³¨å†Œï¼Œè€Œä¸éœ€è¦å†ç»™æ¯ä¸ªBeanå•ç‹¬ä½¿ç”¨xmlçš„æ–¹å¼è¿›è¡Œé…ç½®ã€‚ ä»ŽSpringæä¾›çš„å‚è€ƒæ‰‹å†Œä¸­æˆ‘ä»¬å¾—çŸ¥è¯¥é…ç½®çš„åŠŸèƒ½æ˜¯æ‰«æé…ç½®çš„base-packageåŒ…ä¸‹çš„æ‰€æœ‰ä½¿ç”¨äº†@Componentæ³¨è§£çš„ç±»ï¼Œå¹¶ä¸”å°†å®ƒä»¬è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼ŒåŒæ—¶ä¹Ÿæ‰«æ@Controllerï¼Œ@Serviceï¼Œ@Respositoryè¿™ä¸‰ä¸ªæ³¨è§£ï¼Œå› ä¸ºä»–ä»¬æ˜¯ç»§æ‰¿è‡ª@Componentã€‚ 1&lt;context:annotation-config/&gt; å…¶å®žæœ‰äº†ä¸Šé¢çš„é…ç½®ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥çœç•¥æŽ‰çš„ï¼Œå› ä¸ºä¸Šé¢çš„é…ç½®ä¼šé»˜è®¤æ‰“å¼€ä»¥ä¸‹é…ç½®ã€‚ä»¥ä¸‹é…ç½®ä¼šé»˜è®¤å£°æ˜Žäº†@Requiredã€@Autowiredã€ @PostConstructã€@PersistenceContextã€@Resourceã€@PreDestroyç­‰æ³¨è§£ã€‚ 1&lt;mvc:annotation-driven /&gt; è¿™ä¸ªæ˜¯SpringMVCå¿…é¡»è¦é…ç½®çš„ï¼Œå› ä¸ºå®ƒå£°æ˜Žäº†@RequestMappingã€@RequestBodyã€@ResponseBodyç­‰ã€‚å¹¶ä¸”ï¼Œè¯¥é…ç½®é»˜è®¤åŠ è½½å¾ˆå¤šçš„å‚æ•°ç»‘å®šæ–¹æ³•ï¼Œæ¯”å¦‚jsonè½¬æ¢è§£æžå™¨ç­‰ã€‚ 7ã€æ€»ç»“ åœ¨å®žé™…å·¥ç¨‹ä¸­ä¼šåŒ…æ‹¬å¾ˆå¤šé…ç½®ï¼Œæˆ‘ä»¬æŒ‰ç…§å®˜æ–¹æŽ¨èæ ¹æ®ä¸åŒçš„ä¸šåŠ¡æ¨¡å—æ¥åˆ’åˆ†ä¸åŒå®¹å™¨ä¸­æ³¨å†Œä¸åŒç±»åž‹çš„Beanï¼šSpringçˆ¶å®¹å™¨è´Ÿè´£æ‰€æœ‰å…¶ä»–éž@Controlleræ³¨è§£çš„Beançš„æ³¨å†Œï¼Œè€ŒSpringMVCåªè´Ÿè´£@Controlleræ³¨è§£çš„Beançš„æ³¨å†Œï¼Œä½¿å¾—ä»–ä»¬å„è´Ÿå…¶è´£ã€æ˜Žç¡®è¾¹ç•Œã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[rediså®žçŽ°åˆ†å¸ƒå¼é”]]></title>
    <url>%2F2019%2F01%2F22%2Fmiscellany%2F03redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%2F</url>
    <content type="text"><![CDATA[ä¸ºäº†è®²è§£redisåˆ†å¸ƒå¼é”ï¼Œæˆ‘å°†å¼•å…¥ä¸€ä¸ªåœºæ™¯ï¼šå®šæ—¶å…³å•ã€‚å› ä¸ºå¾€å¾€è®¢å•æœåŠ¡æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä¹ˆå®šæ—¶å™¨ä¼šåŒæ—¶è§¦å‘è¿™äº›é›†ç¾¤åŽ»å–æ¶ˆè®¢å•ï¼Œæ˜¾ç„¶æ˜¯æµªè´¹æœºå™¨èµ„æºçš„ï¼Œæ‰€ä»¥ç›®çš„æ˜¯ï¼šåªè®©å…¶ä¸­ä¸€å°æœºå™¨åŽ»æ‰§è¡Œå–æ¶ˆè®¢å•å³å¯ã€‚è¿™é‡Œå¯ä»¥ç”¨åˆ†å¸ƒå¼é”æ¥å®žçŽ°ã€‚ é¡¹ç›®æ˜¯ä»Žç»ƒæ‰‹é¡¹ç›®ä¸­æˆªå–å‡ºæ¥çš„ï¼Œæ¡†æž¶æ˜¯åŸºäºŽSSMçš„XMLå½¢å¼æž„æˆï¼Œæ‰€ä»¥ä¸‹é¢è¿˜æ¶‰åŠä¸€ç‚¹XMlå¯¹äºŽå®šæ—¶å™¨spring scheduleçš„é…ç½®å†…å®¹ã€‚ 1ã€å¼•å…¥ç›®æ ‡ å®šæ—¶è‡ªåŠ¨å¯¹è¶…è¿‡ä¸¤ä¸ªå°æ—¶è¿˜æœªæ”¯ä»˜çš„è®¢å•å¯¹å…¶è¿›è¡Œå–æ¶ˆï¼Œå¹¶ä¸”é‡ç½®åº“å­˜ã€‚ 2ã€é…ç½® é¦–å…ˆæ˜¯springé…ç½®æ–‡ä»¶å¼•å…¥spring-schedule 123456xmlns:task="http://www.springframework.org/schema/task"...http://www.springframework.org/schema/taskhttp://www.springframework.org/schema/task/spring-task.xsd...&lt;task:annotation-driven/&gt; è¡¥å……ï¼šé’ˆå¯¹applicationContext-datasource.xmlä¸­çš„dataSourceè¯»å–é…ç½®æ–‡ä»¶çš„ä¿¡æ¯æ— æ³•å±•çŽ°çš„é—®é¢˜ï¼Œåœ¨springçš„é…ç½®æ–‡ä»¶ä¸­å¢žåŠ ä¸€æ¡é…ç½®ï¼š 1&lt;context:property-placeholder location="classpath:datasource.properties"/&gt; 3ã€å®šæ—¶è°ƒåº¦ä»£ç  æ­¤ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼šå®šæ—¶è°ƒç”¨å–æ¶ˆè®¢å•æœåŠ¡ã€‚ 1234567891011121314@Component@Slf4jpublic class CloseOrderTask &#123; @Autowired private OrderService orderService; @Scheduled(cron = "0 */1 * * * ?")//æ¯éš”ä¸€åˆ†é’Ÿæ‰§è¡Œï¼Œä¸€åˆ†é’Ÿçš„æ•´æ•°å€çš„æ—¶å€™æ‰§è¡Œ public void closeOrderTaskV1()&#123; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡å¯åŠ¨"); int hour = Integer.parseInt(PropertiesUtil.getProperty("close.order.task.time.hour","2")); orderService.closeOrder(hour); log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡ç»“æŸ"); &#125;&#125; @Componentä¸€å®šè¦åŠ ï¼Œå¦åˆ™springæ‰«æä¸åˆ°ã€‚ close.order.task.time.hour ä¹Ÿæ˜¯é…ç½®åœ¨snailmall.propertiesä¸­çš„ï¼Œè¿™é‡Œé…ç½®çš„æ˜¯é»˜è®¤çš„2ï¼Œå³ä¸¤ä¸ªå°æ—¶ï¼Œä¸‹è®¢å•è¶…è¿‡ä¸¤ä¸ªå°æ—¶ä»ç„¶ä¸æ”¯ä»˜ï¼Œå°±å–æ¶ˆè¯¥è®¢å•ã€‚ å¯¹äºŽorderServiceé‡Œé¢çš„å…·ä½“æ–¹æ³•ï¼š è¿™é‡Œæ˜¯å…³å•çš„å…·ä½“é€»è¾‘ï¼Œç»†èŠ‚æ˜¯è¡Œé”ã€‚è¿™æ®µä»£ç åªè¦çŸ¥é“ä»–æ˜¯å…·ä½“å…³å•çš„é€»è¾‘å³å¯ï¼Œä¸éœ€è¦ä»”ç»†äº†è§£ä»£ç ã€‚ 1234567891011121314151617181920212223242526@Overridepublic void closeOrder(int hour) &#123; Date closeDateTime = DateUtils.addHours(new Date(),-hour); //æ‰¾åˆ°çŠ¶æ€ä¸ºæœªæ”¯ä»˜å¹¶ä¸”ä¸‹å•æ—¶é—´æ˜¯æ—©äºŽå½“å‰æ£€æµ‹æ—¶é—´çš„ä¸¤ä¸ªå°æ—¶çš„æ—¶é—´,å°±å°†å…¶ç½®ä¸ºå–æ¶ˆ //SELECT &lt;include refid="Base_Column_List"/&gt; from mmall_order WHERE status = #&#123;status&#125; &lt;![CDATA[ and create_time &lt;= #&#123;date&#125; ]]&gt; order by create_time desc List&lt;Order&gt; orderList = orderMapper.selectOrderStatusByCreateTime(Const.OrderStatusEnum.NO_PAY.getCode(),DateTimeUtil.dateToStr(closeDateTime)); for(Order order:orderList)&#123; List&lt;OrderItem&gt; orderItemList = orderItemMapper.getByOrderNo(order.getOrderNo()); for(OrderItem orderItem:orderItemList)&#123; //ä¸€å®šè¦ç”¨ä¸»é”®whereæ¡ä»¶ï¼Œé˜²æ­¢é”è¡¨ã€‚åŒæ—¶å¿…é¡»æ˜¯æ”¯æŒMySQLçš„InnoDB. Integer stock = productMapper.selectStockByProductId(orderItem.getProductId()); if(stock == null)&#123; continue; &#125; //æ›´æ–°äº§å“åº“å­˜ Product product = new Product(); product.setId(orderItem.getProductId()); product.setStock(stock+orderItem.getQuantity()); productMapper.updateByPrimaryKeySelective(product); &#125; //å…³é—­order //UPDATE mmall_order set status = 0 where id = #&#123;id&#125; orderMapper.closeOrderByOrderId(order.getId()); log.info("å…³é—­è®¢å•OrderNo:&#123;&#125;",order.getOrderNo()); &#125;&#125; è¿™æ ·ï¼Œdebugå¯åŠ¨é¡¹ç›®ï¼Œä¸€åˆ†é’ŸåŽå°±ä¼šè‡ªåŠ¨æ‰§è¡ŒcloseOrderTaskV1æ–¹æ³•äº†ã€‚æ‰¾ä¸€ä¸ªæœªæ”¯ä»˜çš„è®¢å•ï¼Œè¿›è¡Œç›¸åº”æµ‹è¯•ã€‚ 4ã€å­˜åœ¨çš„é—®é¢˜ ç»è¿‡å®žéªŒå‘çŽ°ï¼ŒåŒæ—¶éƒ¨ç½²ä¸¤å°tomcatæœåŠ¡å™¨ï¼Œæ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ—¶å€™æ˜¯ä¸¤å°éƒ½åŒæ—¶æ‰§è¡Œçš„ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬é›†ç¾¤çš„ç›®æ ‡ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€å°æœåŠ¡å™¨æ‰§è¡Œè¿™ä¸ªå®šæ—¶ä»»åŠ¡å³å¯ã€‚é‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ˜¯å¼•å…¥redisåˆ†å¸ƒå¼é”ã€‚ rediså®žçŽ°åˆ†å¸ƒå¼é”ï¼Œæ ¸å¿ƒå‘½ä»¤å¼setnxå‘½ä»¤ã€‚æ‰€ä»¥é˜…è¯»ä¸‹é¢ï¼Œæ‚¨éœ€è¦å¯¹redisåˆ†å¸ƒå¼é”çš„åŸºæœ¬å®žçŽ°åŽŸç†å¿…é¡»è¦å…ˆæœ‰ä¸€å®šçš„è®¤è¯†æ‰è¡Œã€‚ 5ã€ç¬¬ä¸€ç§æ–¹æ¡ˆ ç¬¬ä¸€æ­¥ï¼šsetnxè¿›åŽ»ï¼Œå¦‚æžœæˆåŠŸï¼Œè¯´æ˜Žå¡žå…¥redisæˆåŠŸï¼ŒæŠ¢å åˆ°é” ç¬¬äºŒæ­¥ï¼šæŠ¢åˆ°é”ä¹‹åŽï¼Œå…ˆè®¾ç½®ä¸€ä¸‹è¿‡æœŸæ—¶é—´ï¼Œå³åŽé¢å¦‚æžœæ‰§è¡Œä¸åˆ°deleteï¼Œä¹Ÿä¼šå°†è¿™ä¸ªé”è‡ªåŠ¨é‡Šæ”¾æŽ‰ï¼Œé˜²æ­¢æ­»é” ç¬¬ä¸‰æ­¥ï¼šå…³é—­è®¢å•ï¼Œåˆ é™¤redisé” å­˜åœ¨çš„é—®é¢˜ï¼šå¦‚æžœå› ä¸ºtomcatå…³é—­æˆ–tomcatè¿›ç¨‹åœ¨æ‰§è¡ŒcloseOrder()æ–¹æ³•çš„æ—¶å€™ï¼Œå³è¿˜æ²¡æ¥å¾—åŠè®¾ç½®é”çš„è¿‡æœŸæ—¶é—´çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™ä¼šé€ æˆæ­»é”ã€‚éœ€è¦æ”¹è¿›ã€‚ 123456789101112131415161718192021222324252627//ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨çªç„¶å…³é—­tomcatçš„æ—¶å€™æœ‰å¯èƒ½å‡ºçŽ°æ­»é”@Scheduled(cron = "0 */1 * * * ?")//æ¯éš”ä¸€åˆ†é’Ÿæ‰§è¡Œï¼Œä¸€åˆ†é’Ÿçš„æ•´æ•°å€public void closeOrderTaskV2()&#123; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡å¯åŠ¨"); //è®¾ç½®é”ï¼Œvalueæ˜¯ç”¨å½“å‰æ—¶é—´+timeoutè¿›è¡Œè®¾ç½®çš„ long timeout = Long.parseLong(PropertiesUtil.getProperty("lock.timeout")); Long setnxResult = RedisShardPoolUtil.setnx(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,String.valueOf(System.currentTimeMillis()+timeout)); if(setnxResult != null &amp;&amp; setnxResult.intValue() ==1)&#123; //è¯´æ˜Žè¢«å½“å‰çš„tomcatè¿›ç¨‹æŠ¢åˆ°é”ï¼Œä¸‹é¢å°±å¯ä»¥å…³é—­è®¢å• closeOrder(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125;else &#123; log.info("æ²¡æœ‰èŽ·å–åˆ†å¸ƒå¼é”ï¼š&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡ç»“æŸ");&#125;private void closeOrder(String lockName) &#123; //ç»™é”ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå¦‚æžœå› ä¸ºæŸä¸ªåŽŸå› å¯¼è‡´ä¸‹é¢çš„é”æ²¡æœ‰è¢«åˆ é™¤ï¼Œé€ æˆæ­»é” RedisShardPoolUtil.expire(lockName,50); log.info("èŽ·å–&#123;&#125;ï¼ŒThreadName:&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName()); int hour = Integer.parseInt(PropertiesUtil.getProperty("close.order.task.time.hour","2")); orderService.closeOrder(hour); //å…³é—­è®¢å•ä¹‹åŽå°±ç«‹å³åˆ é™¤è¿™ä¸ªé” RedisShardPoolUtil.del(lockName); log.info("é‡Šæ”¾&#123;&#125;ï¼ŒThreadName:&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName()); System.out.println("=============================================");&#125; 6ã€æ”¹è¿› å›¾çœ‹ä¸æ¸…ï¼Œå¯ä»¥é‡æ–°æ‰“å¼€ä¸€ä¸ªçª—å£çœ‹ã€‚å…·ä½“çš„é€»è¾‘ä»£ç ï¼š 12345678910111213141516171819202122232425262728@Scheduled(cron = "0 */1 * * * ?")//æ¯éš”ä¸€åˆ†é’Ÿæ‰§è¡Œï¼Œä¸€åˆ†é’Ÿçš„æ•´æ•°å€public void closeOrderTaskV3()&#123; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡å¯åŠ¨"); //è®¾ç½®é”ï¼Œvalueæ˜¯ç”¨å½“å‰æ—¶é—´+timeoutè¿›è¡Œè®¾ç½®çš„ long timeout = Long.parseLong(PropertiesUtil.getProperty("lock.timeout")); Long setnxResult = RedisShardPoolUtil.setnx(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,String.valueOf(System.currentTimeMillis()+timeout)); if(setnxResult != null &amp;&amp; setnxResult.intValue() ==1)&#123; //è¯´æ˜Žè¢«å½“å‰çš„tomcatè¿›ç¨‹æŠ¢åˆ°é”ï¼Œä¸‹é¢å°±å¯ä»¥å…³é—­è®¢å• closeOrder(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125;else &#123; //åœ¨æ²¡æœ‰æ‹¿åˆ°é”çš„æƒ…å†µä¸‹ï¼Œä¹Ÿè¦è¿›è¡Œç›¸åº”çš„åˆ¤æ–­ï¼Œç¡®ä¿ä¸æ­»é” String lockValueStr = RedisShardPoolUtil.get(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); //å¦‚æžœåˆ¤æ–­é”æ˜¯å­˜åœ¨çš„å¹¶ä¸”çŽ°åœ¨å·²ç»è¶…æ—¶äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™ä¸ªè¿›ç¨‹å°±æœ‰æœºä¼šåŽ»å æœ‰è¿™æŠŠé” if(lockValueStr != null &amp;&amp; System.currentTimeMillis() &gt; Long.parseLong(lockValueStr))&#123; //å½“å‰è¿›ç¨‹è¿›è¡Œget setæ“ä½œï¼Œæ‹¿åˆ°è€çš„keyï¼Œå†å¡žè¿›æ–°çš„è¶…æ—¶æ—¶é—´ String getSetResult = RedisShardPoolUtil.getset(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,String.valueOf(System.currentTimeMillis()+timeout)); //å¦‚æžœæ‹¿åˆ°çš„æ˜¯ç©ºçš„ï¼Œè¯´æ˜Žè€çš„é”å·²ç»é‡Šæ”¾ï¼Œé‚£ä¹ˆå½“å‰è¿›ç¨‹æœ‰æƒå æœ‰è¿™æŠŠé”è¿›è¡Œæ“ä½œï¼› //å¦‚æžœæ‹¿åˆ°çš„ä¸æ˜¯ç©ºçš„ï¼Œè¯´æ˜Žè€çš„é”ä»ç„¶å æœ‰ï¼Œå¹¶ä¸”è¿™æ¬¡getsetæ‹¿åˆ°çš„keyä¸Žä¸Šé¢æŸ¥è¯¢getå¾—åˆ°çš„keyä¸€æ ·çš„è¯ï¼Œè¯´æ˜Žæ²¡æœ‰è¢«å…¶ä»–è¿›ç¨‹åˆ·æ–°ï¼Œé‚£ä¹ˆæœ¬è¿›ç¨‹è¿˜æ˜¯æœ‰æƒå æœ‰è¿™æŠŠé”è¿›è¡Œæ“ä½œ if(getSetResult == null || (getSetResult != null &amp;&amp; StringUtils.equals(lockValueStr,getSetResult)))&#123; closeOrder(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125;else &#123; log.info("æ²¡æœ‰èŽ·å–åˆ†å¸ƒå¼é”ï¼š&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125; &#125;else &#123; log.info("æ²¡æœ‰èŽ·å–åˆ†å¸ƒå¼é”ï¼š&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125; &#125; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡ç»“æŸ");&#125; è¿™æ ·ä¸¤æ¬¡çš„é˜²æ­»é”æŽªæ–½ï¼Œä¸ä»…å¯ä»¥é˜²æ­¢æ­»é”ï¼Œè¿˜å¯ä»¥æé«˜æ•ˆçŽ‡ã€‚ 7ã€æ‰©å±• mysqlå››ç§äº‹åŠ¡éš”ç¦»æœºåˆ¶ read uncommitted:è¯»å–æœªæäº¤å†…å®¹ ä¸¤ä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†æ›´æ–°æ“ä½œï¼Œä½†æ˜¯æ²¡æœ‰æäº¤ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨äº‹åŠ¡å†…å°±ä¼šè¯»åˆ°è¯¥çº¿ç¨‹æœªæäº¤çš„æ•°æ®ã€‚ read committed:è¯»å–æäº¤å†…å®¹ï¼ˆä¸å¯é‡å¤è¯»ï¼‰ é’ˆå¯¹ç¬¬ä¸€ç§æƒ…å†µï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸ä¼šè¯»å–å¦ä¸€ä¸ªçº¿ç¨‹æœªæäº¤çš„æ•°æ®äº†ã€‚ä½†æ˜¯ï¼Œè¯»åˆ°äº†å¦ä¸€ä¸ªçº¿ç¨‹æ›´æ–°åŽæäº¤çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´é‡å¤è¯»è¡¨çš„æ—¶å€™ï¼Œæ•°æ®ä¼šä¸ä¸€è‡´ã€‚æ˜¾ç„¶è¿™ç§æƒ…å†µä¹Ÿæ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥å«ä¸å¯é‡å¤è¯»ã€‚ repeatable read:å¯é‡å¤è¯»ï¼ˆé»˜è®¤ï¼‰ å¯é‡å¤è¯»ï¼Œæ˜¾ç„¶è§£å†³2ä¸­çš„é—®é¢˜ï¼Œå³ä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸ä¼šå†è¯»å–åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æäº¤çš„æ•°æ®ï¼Œä¿è¯äº†è¯¥çº¿ç¨‹åœ¨è¿™ä¸ªäº‹åŠ¡å†…çš„æ•°æ®çš„ä¸€è‡´æ€§ã€‚ å¯¹äºŽæŸäº›æƒ…å†µï¼Œè¿™ç§æ–¹æ¡ˆä¼šå‡ºçŽ°å¹»å½±è¯»ï¼Œä»–å¯¹äºŽæ›´æ–°æ“ä½œæ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„äº†ï¼Œä½†æ˜¯å¯¹äºŽæ’å…¥æ“ä½œï¼Œæœ‰å¯èƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡å†…è¯»åˆ°æ–°æ’å…¥çš„æ•°æ®ï¼ˆä½†æ˜¯MySQLä¸­ç”¨å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶æœºåˆ¶è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œæ‰€ä»¥é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªæœºåˆ¶ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ serializable:åºåˆ—åŒ– ç•¥ã€‚ å­˜å‚¨å¼•æ“Ž MySQLé»˜è®¤ä½¿ç”¨çš„æ˜¯InnoDBï¼Œæ”¯æŒäº‹åŠ¡ã€‚è¿˜æœ‰ä¾‹å¦‚MyISAM,è¿™ç§å­˜å‚¨å¼•æ“Žä¸æ”¯æŒäº‹åŠ¡ï¼Œåªæ”¯æŒåªè¯»æ“ä½œï¼Œåœ¨ç”¨åˆ°æ•°æ®çš„ä¿®æ”¹çš„åœ°æ–¹ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨é»˜è®¤çš„InnoDBå­˜å‚¨å¼•æ“Žã€‚ ç´¢å¼•çš„ä¸€ä¸ªæ³¨æ„ç‚¹ ä¸€èˆ¬ç±»åž‹ä¸ºnormalå’Œuniqueï¼Œç”¨btreeå®žçŽ°ï¼Œå¯¹äºŽè”åˆç´¢å¼•(å­—æ®µ1å’Œå­—æ®µ2)ï¼Œåœ¨æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œä¾‹å¦‚ 1select * from xxx where å­—æ®µ1="xxx" ... æ˜¯å¯ä»¥åˆ©ç”¨åˆ°ç´¢å¼•çš„é«˜æ€§èƒ½æŸ¥è¯¢çš„ï¼Œä½†æ˜¯å¦‚æžœæ˜¯ 1select * from xxx where å­—æ®µ2="xxx" ... æ•ˆçŽ‡è·Ÿæ™®é€šçš„æŸ¥è¯¢æ—¶ä¸€æ ·çš„ï¼Œå› ä¸ºç”¨ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œæœ€å·¦è¾¹çš„é‚£ä¸ªå­—æ®µå¿…é¡»è¦æœ‰ï¼Œå¦åˆ™æ— æ•ˆã€‚ æ‰©å±•çš„å†…å®¹çŸ¥è¯†é¡ºä¾¿æä¸€ä¸‹ï¼Œåœ¨æ•°æ®åº“è¿™ä¸€å—ï¼Œä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redissonå®žçŽ°Redisåˆ†å¸ƒå¼é”åŽŸç†]]></title>
    <url>%2F2019%2F01%2F22%2Fmiscellany%2F02Redisson%E5%AE%9E%E7%8E%B0Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥å®žçŽ°ä¸€ä¸ªredisåˆ†å¸ƒå¼é”ï¼Œä½†æ˜¯å¦‚ä½•ç”¨Redissonä¼˜é›…åœ°å®žçŽ°å‘¢ï¼Ÿæœ¬æ–‡æŽ¢è®¨ä¸€ä¸‹å®ƒçš„åŽŸç†ã€‚ ç”¨Redissonæ¥å®žçŽ°åˆ†å¸ƒå¼é”å¼‚å¸¸åœ°ç®€å•ï¼Œå½¢å¦‚ï¼š è¿˜æ”¯æŒrediså•å®žä¾‹ã€rediså“¨å…µã€redis clusterã€redis master-slaveç­‰å„ç§éƒ¨ç½²æž¶æž„ï¼Œéƒ½å¯ä»¥ç»™ä½ å®Œç¾Žå®žçŽ°ã€‚ åŠ é” åŽŸç†å›¾ï¼š çŽ°åœ¨æŸä¸ªå®¢æˆ·ç«¯è¦åŠ é”ã€‚å¦‚æžœè¯¥å®¢æˆ·ç«¯é¢å¯¹çš„æ˜¯ä¸€ä¸ªredis clusteré›†ç¾¤ï¼Œä»–é¦–å…ˆä¼šæ ¹æ®hashèŠ‚ç‚¹é€‰æ‹©ä¸€å°æœºå™¨ã€‚ç´§æŽ¥ç€ï¼Œå°±ä¼šå‘é€ä¸€æ®µluaè„šæœ¬åˆ°redisä¸Šï¼Œé‚£æ®µluaè„šæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š ä¸ºå•¥è¦ç”¨luaè„šæœ¬å‘¢ï¼Ÿå› ä¸ºä¸€å¤§å¨å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥é€šè¿‡å°è£…åœ¨luaè„šæœ¬ä¸­å‘é€ç»™redisï¼Œä¿è¯è¿™æ®µå¤æ‚ä¸šåŠ¡é€»è¾‘æ‰§è¡Œçš„åŽŸå­æ€§ã€‚ è§£é‡Šä¸€ä¸‹è¿™æ®µè„šæœ¬çš„æ„æ€ã€‚ è¿™é‡Œçš„KEYS[1]ä»£è¡¨çš„æ˜¯ä½ åŠ é”çš„é‚£ä¸ªkeyçš„åå­—ã€‚è¿™ä¸ªkeyå°±æ˜¯æˆ‘ä»¬å¸¸çœ‹åˆ°çš„ï¼š 1RLock lock = redisson.getLock("myLock"); ä¸­çš„myLockï¼Œæˆ‘å°±æ˜¯å¯¹è¿™ä¸ªkeyè¿›è¡ŒåŠ é”ã€‚ è¿™é‡Œçš„ARGV[1]ä»£è¡¨çš„å°±æ˜¯é”keyçš„é»˜è®¤ç”Ÿå­˜æ—¶é—´ï¼Œé»˜è®¤30ç§’ã€‚ARGV[2]ä»£è¡¨çš„æ˜¯åŠ é”çš„å®¢æˆ·ç«¯çš„ID:æ¯”å¦‚8743c9c0-0795-4907-87fd-6c719a6b4586:1 ç¬¬ä¸€æ®µifåˆ¤æ–­è¯­å¥ï¼Œå°±æ˜¯ç›¸å½“äºŽç”¨exists myLockå‘½ä»¤åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æžœä½ è¦åŠ é”çš„é‚£ä¸ªé”keyä¸å­˜åœ¨çš„è¯ï¼Œä½ å°±è¿›è¡ŒåŠ é”ã€‚å¦‚ä½•åŠ é”å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤ï¼šhset myLockã€‚ æ‰§è¡Œå®Œhestä¹‹åŽï¼Œè®¾ç½®äº†ä¸€ä¸ªhashæ•°æ®ç»“æž„ï¼š8743c9c0-0795-4907-87fd-6c719a6b4586:1 1ï¼Œè¿™è¡Œå‘½ä»¤æ‰§è¡ŒåŽï¼Œä¼šå‡ºçŽ°ä¸€ä¸ªç±»ä¼¼ä¸‹é¢çš„æ•°æ®ç»“æž„ï¼š ç´§æŽ¥ç€ä¼šæ‰§è¡Œpexpire myLock 30000å‘½ä»¤ï¼Œè®¾ç½®myLockè¿™ä¸ªé”keyçš„ç”Ÿå­˜æ—¶é—´æ˜¯30ç§’ã€‚å¥½äº†ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œokï¼ŒåŠ é”å®Œæˆäº†ã€‚ é”äº’æ–¥ é‚£ä¹ˆåœ¨è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æžœå®¢æˆ·ç«¯2æ¥å°è¯•åŠ é”ï¼Œæ‰§è¡Œäº†åŒæ ·çš„ä¸€æ®µluaè„šæœ¬ï¼Œä¼šå’‹æ ·å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œç¬¬ä¸€ä¸ªifåˆ¤æ–­ä¼šæ‰§è¡Œexists myLockï¼Œå‘çŽ°myLockè¿™ä¸ªé”keyå·²ç»å­˜åœ¨äº†ã€‚æŽ¥ç€ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œåˆ¤æ–­ä¸€ä¸‹ï¼ŒmyLocké”keyçš„hashæ•°æ®ç»“æž„ä¸­ï¼Œæ˜¯å¦åŒ…å«å®¢æˆ·ç«¯2çš„IDï¼Œä½†æ˜¯æ˜Žæ˜¾ä¸æ˜¯çš„ï¼Œå› ä¸ºé‚£é‡ŒåŒ…å«çš„æ˜¯å®¢æˆ·ç«¯1çš„IDã€‚ æ‰€ä»¥è¿™ä¸ªå®¢æˆ·ç«¯2ä¸¤ä¸ªiféƒ½ä¸èƒ½è¿›å…¥ï¼Œåªèƒ½æ‰§è¡Œæœ€åŽçš„pttl myLockï¼Œè¿”å›žå€¼ä»£è¡¨äº†myLockè¿™ä¸ªé”keyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚æ¯”å¦‚è¿˜å‰©15000æ¯«ç§’çš„ç”Ÿå­˜æ—¶é—´ã€‚æ­¤æ—¶å®¢æˆ·ç«¯2ä¼šè¿›å…¥ä¸€ä¸ªwhileå¾ªçŽ¯ï¼Œä¸åœçš„å°è¯•åŠ é”ã€‚ watch dogè‡ªåŠ¨å»¶æœŸæœºåˆ¶ å®¢æˆ·ç«¯1åŠ é”çš„é”keyé»˜è®¤ç”Ÿå­˜æ—¶é—´æ‰30ç§’ï¼Œå¦‚æžœè¶…è¿‡äº†30ç§’ï¼Œå®¢æˆ·ç«¯1è¿˜æƒ³ä¸€ç›´æŒæœ‰è¿™æŠŠé”ï¼Œæ€Žä¹ˆåŠžå‘¢ï¼Ÿ ç®€å•ï¼åªè¦å®¢æˆ·ç«¯1ä¸€æ—¦åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogçœ‹é—¨ç‹—ï¼Œä»–æ˜¯ä¸€ä¸ªåŽå°çº¿ç¨‹ï¼Œä¼šæ¯éš”10ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æžœå®¢æˆ·ç«¯1è¿˜æŒæœ‰é”keyï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚ å¯é‡å…¥åŠ é”æœºåˆ¶ çœ‹ä¸€ä¸‹ä»£ç ï¼Œç›¸åŒçš„å®¢æˆ·è¿›æ¥ï¼Œä¼šè¿›å…¥ç¬¬äºŒä¸ªifï¼Œä¼šæ‰§è¡Œhincrbyï¼Œå³å¢ž1ï¼Œé‚£ä¹ˆè¿™ä¸ªhashç»“æž„å°±ä¼šå˜æˆï¼š é‡Šæ”¾é” å¦‚æžœæ‰§è¡Œlock.unlock()ï¼Œå°±å¯ä»¥é‡Šæ”¾åˆ†å¸ƒå¼é”ï¼Œæ­¤æ—¶çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿæ˜¯éžå¸¸ç®€å•çš„ã€‚å…¶å®žè¯´ç™½äº†ï¼Œå°±æ˜¯æ¯æ¬¡éƒ½å¯¹myLockæ•°æ®ç»“æž„ä¸­çš„é‚£ä¸ªåŠ é”æ¬¡æ•°å‡1ã€‚å¦‚æžœå‘çŽ°åŠ é”æ¬¡æ•°æ˜¯0äº†ï¼Œè¯´æ˜Žè¿™ä¸ªå®¢æˆ·ç«¯å·²ç»ä¸å†æŒæœ‰é”äº†ï¼Œæ­¤æ—¶å°±ä¼šç”¨ï¼šdel myLockå‘½ä»¤ï¼Œä»Žredisé‡Œåˆ é™¤è¿™ä¸ªkeyã€‚ç„¶åŽå‘¢ï¼Œå¦å¤–çš„å®¢æˆ·ç«¯2å°±å¯ä»¥å°è¯•å®ŒæˆåŠ é”äº†ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„åˆ†å¸ƒå¼é”çš„å¼€æºRedissonæ¡†æž¶çš„å®žçŽ°æœºåˆ¶ã€‚ å­˜åœ¨çš„é—®é¢˜ å…¶å®žä¸Šé¢é‚£ç§æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜ï¼Œå°±æ˜¯å¦‚æžœä½ å¯¹æŸä¸ªredis masterå®žä¾‹ï¼Œå†™å…¥äº†myLockè¿™ç§é”keyçš„valueï¼Œæ­¤æ—¶ä¼šå¼‚æ­¥å¤åˆ¶ç»™å¯¹åº”çš„master slaveå®žä¾‹ã€‚ ä½†æ˜¯å¤åˆ¶çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€æ—¦å‘ç”Ÿredis masterå®•æœºï¼Œä¸»å¤‡åˆ‡æ¢ï¼Œredis slaveå˜ä¸ºäº†redis masterã€‚ å‡è®¾å®¢æˆ·ç«¯1åœ¨redis masterä¸ŠèŽ·å¾—é”ï¼Œç„¶åŽä¸»æœºå®•æœºï¼Œredis slaveæˆä¸ºæ–°çš„redis masterï¼Œä½†æ˜¯è¿˜æœªåŒæ­¥åˆ°redis slaveä¸Šï¼Œä½†æ˜¯å®¢æˆ·ç«¯1å·²ç»è§‰å¾—è‡ªå·±èŽ·å–åˆ°äº†é”ã€‚ æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯2æ¥å°è¯•åŠ é”çš„æ—¶å€™ï¼Œåœ¨æ–°çš„redis masterä¸Šå®Œæˆäº†åŠ é”ï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿå¤šä¸ªå®¢æˆ·ç«¯å®Œæˆå¯¹ä¸€ä¸ªkeyçš„åŠ é”ã€‚è¿™æ—¶ç³»ç»Ÿåœ¨ä¸šåŠ¡è¯­ä¹‰ä¸Šä¸€å®šä¼šå‡ºçŽ°é—®é¢˜ï¼Œå¯¼è‡´å„ç§è„æ•°æ®çš„äº§ç”Ÿã€‚ æ‰€ä»¥è¿™ä¸ªå°±æ˜¯redis clusterï¼Œæˆ–è€…æ˜¯redis master-slaveæž¶æž„çš„ä¸»ä»Žå¼‚æ­¥å¤åˆ¶å¯¼è‡´çš„redisåˆ†å¸ƒå¼é”çš„æœ€å¤§ç¼ºé™·ï¼šåœ¨redis masterå®žä¾‹å®•æœºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å®ŒæˆåŠ é”ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[springäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º]]></title>
    <url>%2F2019%2F01%2F22%2Fmiscellany%2F01%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA%2F</url>
    <content type="text"><![CDATA[ç»å¸¸å¬åˆ°åˆ«äººè¯´äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºå‘¢ï¼Ÿ 1.ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡æ˜¯æŒ‡ï¼šç”±ä¸€ç³»åˆ—æ•°æ®åº“æ“ä½œç»„æˆçš„ä¸€ä¸ªå®Œæ•´çš„é€»è¾‘è¿‡ç¨‹ã€‚ä¾‹å¦‚é“¶è¡Œè½¬å¸ï¼Œä»ŽåŽŸè´¦æˆ·æ‰£é™¤é‡‘é¢ï¼Œä»¥åŠå‘ç›®æ ‡è´¦æˆ·æ·»åŠ é‡‘é¢ï¼Œè¿™ä¸¤ä¸ªæ•°æ®åº“æ“ä½œçš„æ€»å’Œï¼Œæž„æˆä¸€ä¸ªå®Œæ•´çš„é€»è¾‘è¿‡ç¨‹ï¼Œä¸å¯æ‹†åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºä¸€ä¸ªäº‹åŠ¡ï¼Œå…·æœ‰ACIDç‰¹æ€§ã€‚ è¿™é‡Œæ³¨æ„ï¼Œå…¶å®žäº‹åŠ¡å°±æ˜¯æ•°æ®åº“æ‰èƒ½ä¿è¯çš„ï¼Œæ‰€ä»¥æŠ›å¼€æ•°æ®åº“å±‚é¢æ¥è°ˆäº‹åŠ¡æœ¬èº«å°±æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥äº‹åŠ¡çš„æ¦‚å¿µå°±æ˜¯æ•°æ®åº“ä¸€ç³»åˆ—æ“ä½œçš„ä¸€ä¸ªå®Œæ•´å•å…ƒã€‚ 2.ä»€ä¹ˆæ˜¯ACIDï¼Ÿ ACIDæ˜¯æŒ‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿåœ¨å†™å…¥æˆ–æ›´æ–°èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä¿è¯äº‹åŠ¡æ˜¯æ­£ç¡®å¯é çš„ï¼Œæ‰€å¿…é¡»å…·å¤‡çš„å››ä¸ªç‰¹æ€§ï¼šåŽŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚ Atomicityï¼šä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªçŽ¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›žæ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»Žæ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚ Consistencyï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åŽï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾çº¦æŸã€è§¦å‘å™¨ã€çº§è”å›žæ»šç­‰ã€‚ Isolationï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºŽäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš” ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤(Read uncommitted)ã€è¯»æäº¤(read committed)ã€å¯é‡å¤è¯»(repeatable read)å’Œä¸²è¡ŒåŒ–(Serializable)ã€‚ Durabilityï¼šäº‹åŠ¡å¤„ç†ç»“æŸåŽï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ 3.springäº‹åŠ¡ä¼ æ’­è¡Œä¸º åœ¨æˆ‘ä»¬ç”¨SSMå¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å°†äº‹åŠ¡è®¾ç½®åœ¨Serviceå±‚ é‚£ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨Serviceå±‚çš„ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™å®ƒèƒ½å¤Ÿä¿è¯æˆ‘ä»¬çš„è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œçš„æ‰€æœ‰çš„å¯¹æ•°æ®åº“çš„æ›´æ–°æ“ä½œä¿æŒåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œåœ¨äº‹åŠ¡å±‚é‡Œé¢è°ƒç”¨çš„è¿™äº›æ–¹æ³•è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚é‚£ä¹ˆäº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ä¹Ÿæ˜¯ä»Žè¿™é‡Œè¯´èµ·çš„ã€‚ å¦‚æžœä½ åœ¨ä½ çš„`Service`å±‚çš„è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé™¤äº†è°ƒç”¨äº†`Dao`å±‚çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜è°ƒç”¨äº†æœ¬ç±»çš„å…¶ä»–çš„`Service`æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨å…¶ä»–çš„`Service`æ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹åŠ¡æ˜¯æ€Žä¹ˆè§„å®šçš„å‘¢ï¼Œæˆ‘å¿…é¡»ä¿è¯æˆ‘åœ¨æˆ‘æ–¹æ³•é‡Œè°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•ä¸Žæˆ‘æœ¬èº«çš„æ–¹æ³•å¤„åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¦åˆ™å¦‚æžœä¿è¯äº‹ç‰©çš„ä¸€è‡´æ€§ã€‚äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„. åœ¨Springä¸­æœ‰é’ˆå¯¹ä¼ æ’­ç‰¹æ€§çš„å¤šç§é…ç½®æˆ‘ä»¬å¤§å¤šæ•°æƒ…å†µä¸‹åªç”¨å…¶ä¸­çš„ä¸€ç§:PROPGATION_REQUIREDï¼šè¿™ä¸ªé…ç½®é¡¹çš„æ„æ€æ˜¯è¯´å½“æˆ‘è°ƒç”¨serviceå±‚çš„æ–¹æ³•çš„æ—¶å€™å¼€å¯ä¸€ä¸ªäº‹åŠ¡(å…·ä½“è°ƒç”¨é‚£ä¸€å±‚çš„æ–¹æ³•å¼€å§‹åˆ›å»ºäº‹åŠ¡ï¼Œè¦çœ‹ä½ çš„aopçš„é…ç½®),é‚£ä¹ˆåœ¨è°ƒç”¨è¿™ä¸ªserviceå±‚é‡Œé¢çš„å…¶ä»–çš„æ–¹æ³•çš„æ—¶å€™,å¦‚æžœå½“å‰æ–¹æ³•äº§ç”Ÿäº†äº‹åŠ¡å°±ç”¨å½“å‰æ–¹æ³•äº§ç”Ÿçš„äº‹åŠ¡ï¼Œå¦åˆ™å°±åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚è¿™ä¸ªå·¥ä½œä½¿ç”±Springæ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆçš„ã€‚ é»˜è®¤æƒ…å†µä¸‹å½“å‘ç”Ÿ`RuntimeException`çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡æ‰ä¼šå›žæ»šï¼Œæ‰€ä»¥è¦æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æžœä½ åœ¨ç¨‹åºå‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¸‹ï¼Œæœ‰è‡ªå·±çš„å¼‚å¸¸å¤„ç†æœºåˆ¶å®šä¹‰è‡ªå·±çš„`Exception`ï¼Œå¿…é¡»ä»Ž`RuntimeException`ç±»ç»§æ‰¿ï¼Œè¿™æ ·äº‹åŠ¡æ‰ä¼šå›žæ»šï¼ 4.äº‹åŠ¡éš”ç¦»çº§åˆ« 1ã€Serializableï¼šæœ€ä¸¥æ ¼çš„çº§åˆ«ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œèµ„æºæ¶ˆè€—æœ€å¤§ï¼› 2ã€REPEATABLE READï¼šä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼šä¿®æ”¹å·²ç»ç”±å¦ä¸€ä¸ªäº‹åŠ¡è¯»å–ä½†æœªæäº¤ï¼ˆå›žæ»šï¼‰çš„æ•°æ®ã€‚é¿å…äº†â€œè„è¯»å–â€å’Œâ€œä¸å¯é‡å¤è¯»å–â€çš„æƒ…å†µï¼Œä½†æ˜¯å¸¦æ¥äº†æ›´å¤šçš„æ€§èƒ½æŸå¤±ã€‚ 3ã€READ COMMITTED:å¤§å¤šæ•°ä¸»æµæ•°æ®åº“çš„é»˜è®¤äº‹åŠ¡ç­‰çº§ï¼Œä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼šè¯»åˆ°å¦ä¸€ä¸ªå¹¶è¡Œäº‹åŠ¡å·²ä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®ï¼Œé¿å…äº†â€œè„è¯»å–â€ã€‚è¯¥çº§åˆ«é€‚ç”¨äºŽå¤§å¤šæ•°ç³»ç»Ÿã€‚ 4ã€Read Uncommittedï¼šä¿è¯äº†è¯»å–è¿‡ç¨‹ä¸­ä¸ä¼šè¯»å–åˆ°éžæ³•æ•°æ®ã€‚ 5.æ€»ç»“ æœ¬æ–‡çš„é‡ç‚¹æ˜¯åœ¨äºŽç†è§£äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºè¿™ä¸ªæ¦‚å¿µï¼Œä»Žäº‹åŠ¡çš„æ¦‚å¿µï¼Œåˆ°äº‹åŠ¡çš„ACIDä»‹ç»ï¼Œå¼•å‡ºäº‹åŠ¡ä¼ æ’­ä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«è¿™ä¸¤ä¸ªæ¦‚å¿µåŠ ä»¥ç†è§£ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ConcurrentHashMap]]></title>
    <url>%2F2019%2F01%2F22%2Fjava-collection%2F12.ConcurrentHashMap%2F</url>
    <content type="text"><![CDATA[å¯¹äºŽå¹¶å‘åœºæ™¯ä¸‹ï¼ŒæŽ¨èä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ concurrentHashMap ï¼Œè€Œä¸æ˜¯ HashMap æˆ–è€…æ˜¯ HashTable .concurrentHashMapåœ¨JDK7å’ŒJDK8ä¸­çš„å®žçŽ°åŽŸç†æ˜¯ä¸ä¸€æ ·çš„ã€‚æœ¬æ–‡åˆ†åˆ«å¯¹å…¶æ ¸å¿ƒæ€æƒ³å’Œæ–¹æ³•è¿›è¡Œé˜è¿°ã€‚ ä¸€ã€JDK7å®žçŽ° ConcurrentHashMap çš„å†…éƒ¨ç»†åˆ†äº†è‹¥å¹²ä¸ªå°çš„ HashMap ï¼Œç§°ä¹‹ä¸ºæ®µï¼ˆ SEGMENT ï¼‰ã€‚ ConcurrentHashMap æ˜¯ä¸€ä¸ª Segment æ•°ç»„ï¼ŒSegment é€šè¿‡ç»§æ‰¿ ReentrantLock æ¥è¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥æ¯æ¬¡éœ€è¦åŠ é”çš„æ“ä½œé”ä½çš„æ˜¯ä¸€ä¸ª segment ï¼Œè¿™æ ·åªè¦ä¿è¯æ¯ä¸ª Segment æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±å®žçŽ°äº†å…¨å±€çš„çº¿ç¨‹å®‰å…¨ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ç”± Segment æ•°ç»„ã€HashEntry æ•°ç»„ç»„æˆï¼Œå’Œ HashMap ä¸€æ ·ï¼Œä»ç„¶æ˜¯æ•°ç»„åŠ é“¾è¡¨ç»„æˆã€‚ ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”æŠ€æœ¯ï¼Œå…¶ä¸­ Segment ç»§æ‰¿äºŽ ReentrantLockã€‚ä¸ä¼šåƒ HashTable é‚£æ ·ä¸ç®¡æ˜¯ put è¿˜æ˜¯ get æ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç†ï¼Œç†è®ºä¸Š ConcurrentHashMap æ”¯æŒ CurrencyLevel ( Segment æ•°ç»„æ•°é‡)çš„çº¿ç¨‹å¹¶å‘ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚ 1.1 getæ–¹æ³• ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯éžå¸¸é«˜æ•ˆçš„ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”ã€‚ åªéœ€è¦å°† Key é€šè¿‡ Hash ä¹‹åŽå®šä½åˆ°å…·ä½“çš„ Segment ï¼Œå†é€šè¿‡ä¸€æ¬¡ Hash å®šä½åˆ°å…·ä½“çš„å…ƒç´ ä¸Šã€‚ç”±äºŽ HashEntry ä¸­çš„ value å±žæ€§æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡èŽ·å–æ—¶éƒ½æ˜¯æœ€æ–°å€¼. å†…éƒ¨ HashEntry ç±» ï¼š 12345678910111213static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next; HashEntry(int hash, K key, V value, HashEntry&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125;&#125; 1.2 putæ–¹æ³• è™½ç„¶ HashEntry ä¸­çš„ value æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¹¶å‘çš„åŽŸå­æ€§ï¼Œæ‰€ä»¥ put æ“ä½œæ—¶ä»ç„¶éœ€è¦åŠ é”å¤„ç†ã€‚ é¦–å…ˆä¹Ÿæ˜¯é€šè¿‡ Key çš„ Hash å®šä½åˆ°å…·ä½“çš„ Segmentï¼Œåœ¨ put ä¹‹å‰ä¼šè¿›è¡Œä¸€æ¬¡æ‰©å®¹æ ¡éªŒã€‚è¿™é‡Œæ¯” HashMap è¦å¥½çš„ä¸€ç‚¹æ˜¯ï¼šHashMap æ˜¯æ’å…¥å…ƒç´ ä¹‹åŽå†çœ‹æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œæœ‰å¯èƒ½æ‰©å®¹ä¹‹åŽåŽç»­å°±æ²¡æœ‰æ’å…¥å°±æµªè´¹äº†æœ¬æ¬¡æ‰©å®¹(æ‰©å®¹éžå¸¸æ¶ˆè€—æ€§èƒ½)ã€‚ è€Œ ConcurrentHashMap ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯åœ¨å°†æ•°æ®æ’å…¥ä¹‹å‰æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œä¹‹åŽå†åšæ’å…¥æ“ä½œã€‚ 1.3 sizeæ–¹æ³• æ¯ä¸ª Segment éƒ½æœ‰ä¸€ä¸ª volatile ä¿®é¥°çš„å…¨å±€å˜é‡ count ,æ±‚æ•´ä¸ª ConcurrentHashMap çš„ size æ—¶å¾ˆæ˜Žæ˜¾å°±æ˜¯å°†æ‰€æœ‰çš„ count ç´¯åŠ å³å¯ã€‚ä½†æ˜¯ volatile ä¿®é¥°çš„å˜é‡å´ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹çš„åŽŸå­æ€§ï¼Œæ‰€æœ‰ç›´æŽ¥ç´¯åŠ å¾ˆå®¹æ˜“å‡ºçŽ°å¹¶å‘é—®é¢˜ã€‚ ä½†å¦‚æžœæ¯æ¬¡è°ƒç”¨ size æ–¹æ³•å°†å…¶ä½™çš„ä¿®æ”¹æ“ä½œåŠ é”æ•ˆçŽ‡ä¹Ÿå¾ˆä½Žã€‚æ‰€ä»¥åšæ³•æ˜¯å…ˆå°è¯•ä¸¤æ¬¡å°† count ç´¯åŠ ï¼Œå¦‚æžœå®¹å™¨çš„ count å‘ç”Ÿäº†å˜åŒ–å†åŠ é”æ¥ç»Ÿè®¡ sizeã€‚ åœ¨ JDK7 ä¸­ï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆä»–ä¼šä½¿ç”¨ä¸åŠ é”çš„æ¨¡å¼åŽ»å°è¯•å¤šæ¬¡è®¡ç®— ConcurrentHashMap çš„ sizeï¼Œæœ€å¤šä¸‰æ¬¡ï¼Œæ¯”è¾ƒå‰åŽä¸¤æ¬¡è®¡ç®—çš„ç»“æžœï¼Œç»“æžœä¸€è‡´å°±è®¤ä¸ºå½“å‰æ²¡æœ‰å…ƒç´ åŠ å…¥ï¼Œè®¡ç®—çš„ç»“æžœæ˜¯å‡†ç¡®çš„ã€‚ ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯å¦‚æžœç¬¬ä¸€ç§æ–¹æ¡ˆä¸ç¬¦åˆï¼Œä»–å°±ä¼šç»™æ¯ä¸ª Segment åŠ ä¸Šé”ï¼Œç„¶åŽè®¡ç®— ConcurrentHashMap çš„ size è¿”å›žã€‚å…¶æºç å®žçŽ°: 12345678910111213141516171819202122232425262728293031323334353637public int size() &#123; final Segment&lt;K,V&gt;[] segments = this.segments; int size; boolean overflow; // true if size overflows 32 bits long sum; // sum of modCounts long last = 0L; // previous sum int retries = -1; // first iteration isn't retry try &#123; for (;;) &#123; if (retries++ == RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) ensureSegment(j).lock(); // force creation &#125; sum = 0L; size = 0; overflow = false; for (int j = 0; j &lt; segments.length; ++j) &#123; Segment&lt;K,V&gt; seg = segmentAt(segments, j); if (seg != null) &#123; sum += seg.modCount; int c = seg.count; if (c &lt; 0 || (size += c) &lt; 0) overflow = true; &#125; &#125; if (sum == last) break; last = sum; &#125; &#125; finally &#123; if (retries &gt; RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) segmentAt(segments, j).unlock(); &#125; &#125; return overflow ? Integer.MAX_VALUE : size;&#125; å…¶ä¸­ 12// é”ä¹‹å‰é‡è¯•æ¬¡æ•°static final int RETRIES_BEFORE_LOCK = 2; äºŒã€JDK8å®žçŽ° jdk8 ä¸­çš„ ConcurrentHashMap æ•°æ®ç»“æž„å’Œå®žçŽ°ä¸Ž jdk7 è¿˜æ˜¯æœ‰ç€æ˜Žæ˜¾çš„å·®å¼‚ã€‚ å…¶ä¸­æŠ›å¼ƒäº†åŽŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚ ä¹Ÿå°† jdk7 ä¸­å­˜æ”¾æ•°æ®çš„ HashEntry æ”¹ä¸º Nodeï¼Œä½†ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ã€‚ å…¶ä¸­çš„ val next éƒ½ç”¨äº† volatile ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ã€‚ 2.1 putæ–¹æ³• é‡ç‚¹æ¥çœ‹çœ‹ put å‡½æ•°ï¼š æ ¹æ® key è®¡ç®—å‡º hashcode ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚ f å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æžœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚ å¦‚æžœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1,åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚ å¦‚æžœéƒ½ä¸æ»¡è¶³(ä¸éœ€è¦åˆå§‹åŒ–ã€Nodeä¸ä¸ºç©ºã€ä¸éœ€è¦æ‰©å®¹)ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®ã€‚ å¦‚æžœæ•°é‡å¤§äºŽ TREEIFY_THRESHOLD åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ 2.2 getæ–¹æ³• æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hashcode å¯»å€ï¼Œå¦‚æžœå°±åœ¨æ¡¶ä¸Šé‚£ä¹ˆç›´æŽ¥è¿”å›žå€¼ã€‚ å¦‚æžœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼èŽ·å–å€¼ã€‚ éƒ½ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éåŽ†èŽ·å–å€¼ã€‚ 2.3 sizeæ–¹æ³• JDK8 å®žçŽ°ç›¸æ¯” JDK7 ç®€å•å¾ˆå¤šï¼Œåªæœ‰ä¸€ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬ç›´æŽ¥çœ‹ size() ä»£ç ï¼š 123456789101112131415161718192021public int size() &#123; long n = sumCount(); return ((n &lt; 0L) ? 0 : (n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)n); &#125;final long sumCount() &#123; CounterCell[] as = counterCells; CounterCell a; //èŽ·å–baseCountå€¼ long sum = baseCount; //éåŽ†CounterCellæ•°ç»„å…¨éƒ¨åŠ åˆ°baseCountä¸Šï¼Œå®ƒä»¬çš„å’Œå°±æ˜¯size if (as != null) &#123; for (int i = 0; i &lt; as.length; ++i) &#123; if ((a = as[i]) != null) sum += a.value; &#125; &#125; return sum; &#125; å¯èƒ½ä½ ä¼šæœ‰æ‰€ç–‘é—®ï¼ŒConcurrentHashMap ä¸­çš„ baseCount å±žæ€§ä¸å°±æ˜¯è®°å½•çš„æ‰€æœ‰é”®å€¼å¯¹çš„æ€»æ•°å—ï¼Ÿç›´æŽ¥è¿”å›žå®ƒä¸å°±è¡Œäº†å—ï¼Ÿ ä¹‹æ‰€ä»¥æ²¡æœ‰è¿™ä¹ˆåšï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬çš„ addCount æ–¹æ³•ç”¨äºŽ CAS æ›´æ–° baseCountï¼Œä½†å¾ˆæœ‰å¯èƒ½åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆè¿™äº›èŠ‚ç‚¹è™½ç„¶å·²ç»è¢«æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­äº†ï¼Œä½†æ˜¯æ•°é‡å´æ²¡æœ‰è¢«ç»Ÿè®¡ã€‚ è¿˜å¥½ï¼ŒaddCount æ–¹æ³•åœ¨æ›´æ–° baseCount å¤±è´¥çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ fullAddCount å°†è¿™äº›å¤±è´¥çš„ç»“ç‚¹åŒ…è£…æˆä¸€ä¸ª CounterCell å¯¹è±¡ï¼Œä¿å­˜åœ¨ CounterCell æ•°ç»„ä¸­ã€‚é‚£ä¹ˆæ•´å¼ è¡¨å®žé™…çš„ size å…¶å®žæ˜¯ baseCount åŠ ä¸Š CounterCellæ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚ ä¸‰ã€æ€»ç»“ å¹¶å‘æƒ…å†µä¸‹è¯·ä½¿ç”¨concurrentHashMap åœ¨jdk7ä¸­ï¼Œç”¨çš„æ˜¯åˆ†æ®µé”ï¼Œé»˜è®¤æ˜¯12æ®µï¼Œé‚£ä¹ˆå¹¶å‘é‡æœ€å¤šä¹Ÿå°±12. getä¸åŠ é”ï¼Œç¬¬ä¸€æ¬¡hashå®šä½åˆ°segmentï¼Œç¬¬äºŒæ¬¡hashå®šä½åˆ°å…ƒç´ ï¼Œå…ƒç´ å€¼æ˜¯ç”¨volatileä¿è¯å†…å­˜å¯è§æ€§ putéœ€è¦åŠ é”ï¼Œhashå®šä½åˆ°segmentåŽï¼Œå…ˆæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹å†æ’å…¥ã€‚ sizeå…ˆä½¿ç”¨ä¸åŠ é”çš„æ¨¡å¼åŽ»å°è¯•å¤šæ¬¡è®¡ç®—sizeï¼Œæœ€å¤šä¸‰æ¬¡ï¼Œæ¯”è¾ƒå‰åŽä¸¤æ¬¡è®¡ç®—çš„ç»“æžœï¼Œç»“æžœä¸€è‡´å°±è®¤ä¸ºå½“å‰æ²¡æœ‰å…ƒç´ åŠ å…¥ï¼›å¦‚æžœä¸ä¸€è‡´ï¼Œç»™æ¯ä¸ª Segment åŠ ä¸Šé”å†ä¾æ¬¡åŽ»è®¡ç®—ä¸ªæ•° åœ¨jdk8ä¸­ï¼Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ putçš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œç®€å•æ¥è¯´æ˜¯ï¼šå…ˆè®¡ç®—hashå®šä½åˆ°nodeâ€”ã€‹åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ–â€”ã€‹å¦‚æžœnodeä¸ºç©ºåˆ™è¡¨ç¤ºå¯ä»¥æ’å…¥ï¼Œç”¨casæ’å…¥â€”ã€‹åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹â€”ã€‹å¦‚æžœä¸éœ€è¦åˆå§‹åŒ–ã€Nodeä¸ä¸ºç©ºã€ä¸éœ€è¦æ‰©å®¹ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®â€”ã€‹åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ getå°±æ¯”è¾ƒç®€å•ï¼Œç›´æŽ¥æ ¹æ®hashå®šä½åˆ°nodeï¼Œç„¶åŽä»¥é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„æ–¹å¼æ‹¿åˆ° sizeæ–¹æ³•å°±ä¸€ç§æ–¹æ¡ˆï¼šbaseCount+CounterCell[]ä¸­æ‰€æœ‰å…ƒç´  æ•´ç†è‡ªï¼š https://crossoverjie.top/JCSprout/#/thread/ConcurrentHashMap?id=size-æ–¹æ³• https://www.jianshu.com/p/e99e3fcface4]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMapæ­»å¾ªçŽ¯é—®é¢˜]]></title>
    <url>%2F2019%2F01%2F21%2Fjava-collection%2F11.HashMap%E6%AD%BB%E5%BE%AA%E7%8E%AF%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[JDK1.7æˆ–è€…æ›´è€çš„ç‰ˆæœ¬ä¸­åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹æ˜¯ä¼šå­˜åœ¨æ­»å¾ªçŽ¯é—®é¢˜ï¼Œç©¶å…¶åŽŸå› æ˜¯putè¿‡ç¨‹ä¸­çš„resizeæ–¹æ³•åœ¨è°ƒç”¨transferæ–¹æ³•çš„æ—¶å€™å¯¼è‡´çš„æ­»é”ã€‚è¿™æ¬¡æˆ‘ä»¬æ¥çœ‹çœ‹åˆ°åº•æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼ æ ¸å¿ƒæºç  åœ¨JDK8ä¸­ï¼Œå†…éƒ¨å·²ç»è°ƒæ•´ï¼Œè§£å†³äº†æ­»å¾ªçŽ¯é—®é¢˜ï¼Œæ˜¯å¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿå°†JDK7ä¸­å¤´æ’å…¥æ³•æ”¹ä¸ºæœ«ç«¯æ’å…¥ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚å…³äºŽè¿™ä¸ªï¼Œå¯ä»¥æŸ¥çœ‹jdk8æºç ä¸­çš„resizeæ–¹æ³•ã€‚ ä¸Šé¢æåˆ°æ˜¯ç”±äºŽputæ—¶å‡ºçŽ°é—®é¢˜ï¼Œé‚£ä¹ˆå…ˆæ¥åˆ°put()ä¸­çœ‹çœ‹ï¼š æˆ‘ä»¬çœ‹åˆ°ï¼Œputä¸€ä¸ªä¸å­˜åœ¨çš„æ–°å…ƒç´ ï¼Œå¿…ç„¶å¢žåŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¿›å…¥è¿™ä¸ªå¢žåŠ èŠ‚ç‚¹çš„æ–¹æ³•ï¼š æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œéœ€è¦çš„è¯å°±resize: ä¸‹é¢å°±æ˜¯å¯¹é“¾è¡¨æ•°æ®è¿›è¡Œè¿ç§»ï¼š æ ¸å¿ƒçš„ä»£ç å°±æ˜¯è¿™ä¹ˆå¤šï¼Œé¦–å…ˆè¦å¼ºè°ƒä¸€ä¸‹ï¼šä¸¤ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œæ˜¯åˆ†åˆ«å»ºç«‹äº†ä¸¤ä¸ªç‹¬ç«‹çš„æ‰©å®¹åŽçš„æ•°ç»„ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯ä¸¤ä¸ªé•¿åº¦ä¸º4çš„æ•°ç»„ã€‚è€çš„æ•°ç»„ä¸º2ä¸ªæ•°å°±æ˜¯å”¯ä¸€çš„ã€‚æ‰€ä»¥åœ¨ç¬¬ä¸€æ­¥ï¼Œçº¿ç¨‹2è¿è¡Œç»“æŸæ—¶ï¼Œè€çš„æ•°ç»„å…ƒç´ å·²ç»ç©ºäº†ã€‚ ä¸‹é¢å…ˆæ¼”ç¤ºä¸€ä¸‹æ­£å¸¸çš„rehashè¿‡ç¨‹ã€‚ æ­£å¸¸æƒ…å†µ å‡è®¾äº†æˆ‘ä»¬çš„hashç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨ key mod ä¸€ä¸‹æ•°ç»„(hashè¡¨)çš„å¤§å° æœ€ä¸Šé¢çš„æ˜¯old hash è¡¨ï¼Œå…¶ä¸­çš„Hashè¡¨çš„size=2, æ‰€ä»¥key = 3, 7, 5ï¼Œåœ¨mod 2ä»¥åŽéƒ½å†²çªåœ¨table[1]è¿™é‡Œäº†ã€‚ æŽ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯Hashè¡¨ resize æˆ4ï¼Œç„¶åŽæ‰€æœ‰çš„ &lt;key,value&gt; é‡æ–° rehash çš„è¿‡ç¨‹ æ³¨æ„åˆ°ï¼Œåœ¨JDK7ä¸­ï¼Œæ˜¯æŒ‰ç…§å¤´æ’å…¥æ³•ä¾æ¬¡æ’å…¥çš„ã€‚æ‰€ä»¥7æ’åˆ°äº†3å‰é¢ã€‚ å¹¶å‘æƒ…å†µ 1.åˆå§‹æƒ…å†µ å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªçº¿ç¨‹ã€‚æˆ‘ç”¨çº¢è‰²å’Œæµ…è“è‰²æ ‡æ³¨äº†ä¸€ä¸‹ã€‚ å¯¹äºŽç¬¬ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œå®Œè¿™ä¸€è¡Œï¼Œç„¶åŽæŒ‚èµ·ï¼Œæ­¤æ—¶ e å’Œ next éƒ½é™„å¥½å€¼äº†ï¼š è€Œè®©çº¿ç¨‹äºŒæ‰§è¡Œå®Œæˆã€‚äºŽæ˜¯æˆ‘ä»¬æœ‰ä¸‹é¢çš„è¿™ä¸ªæ ·å­ï¼š å› ä¸ºThread1çš„ e æŒ‡å‘äº† key(3) ï¼Œè€Œ next æŒ‡å‘äº† key(7) ï¼Œå…¶åœ¨ Thread2 rehashåŽï¼ŒæŒ‡å‘äº† Thread2 é‡ç»„åŽçš„é“¾è¡¨ã€‚ 2.Thread1è¢«è°ƒåº¦å›žæ¥æ‰§è¡Œ å…ˆæ˜¯æ‰§è¡Œ newTalbe[i] = e ï¼šæ­¤æ—¶çº¿ç¨‹1çš„ç¬¬ä¸‰ä¸ªä½ç½®å°±æ˜¯æŒ‡å‘å…ƒç´ 3; ç„¶åŽæ˜¯ e = nextï¼Œå¯¼è‡´äº† e æŒ‡å‘äº† key(7) ; è€Œä¸‹ä¸€æ¬¡å¾ªçŽ¯çš„ next = e.next å¯¼è‡´äº† next æŒ‡å‘äº† key(3) ; 3.ä¸€åˆ‡å®‰å¥½ çº¿ç¨‹ä¸€æŽ¥ç€å·¥ä½œã€‚æŠŠ key(7) æ‘˜ä¸‹æ¥ï¼Œæ”¾åˆ° newTable[i] çš„ç¬¬ä¸€ä¸ªï¼Œç„¶åŽæŠŠ e å’Œ next å¾€ä¸‹ç§»ã€‚ 4.çŽ¯å½¢é“¾æŽ¥å‡ºçŽ° e.next = newTable[i] å¯¼è‡´ key(3).next æŒ‡å‘äº† key(7) æ³¨æ„ï¼šæ­¤æ—¶çš„ key(7).next å·²ç»æŒ‡å‘äº† key(3)ï¼Œ çŽ¯å½¢é“¾è¡¨å°±è¿™æ ·å‡ºçŽ°äº†ã€‚ è‡ªå·±çš„ç®€å•æ•´ç† è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒç»•çš„ï¼Œç†è§£çš„æœ€å¥½æ–¹å¼å·¦è¾¹æ”¾æºç ï¼Œå³è¾¹æ”¾å›¾ï¼Œä¸­é—´ç”¨è‰ç¨¿çº¸ç”»ä¸€ç”»ã€‚ é‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘åœ¨å¯¹å…¶è¿‡ç¨‹å°½å¯èƒ½åœ°è®²æ˜Žç™½ä¸€ç‚¹ã€‚æˆ‘ä»¬å…ˆç¡®å®š7å’Œ3ä¼šå…¨éƒ¨è½åˆ°æ‰©å®¹åŽçš„ä¸‹æ ‡ä¸º3çš„ä½ç½®(3%4=3,7%4=3)ã€‚ è§„å®šçº¿ç¨‹1å¼€è¾Ÿçš„æ•°ç»„ä¸º arr1 ï¼Œçº¿ç¨‹2å¼€è¾Ÿçš„æ•°ç»„ä¸º arr2; 1. åˆå§‹çŠ¶æ€ çº¿ç¨‹ä¸€ï¼š e -&gt; key3 , next -&gt; key7 çº¿ç¨‹äºŒï¼š æ•°ç»„3å·ä½ç½® arr2[3] -&gt; key7 -&gt; key3 æ³¨æ„æ­¤æ—¶ key7 æŒ‡å‘ key3 . æˆ‘ä»¬è¦æ˜Žç¡®ä¸€ä¸‹ï¼Œå‘ç”Ÿæ­»å¾ªçŽ¯ï¼Œæ˜¯æŒ‡åœ¨putæ“ä½œå®Œæ¯•ä¹‹åŽï¼Œæœ€ç»ˆç”Ÿæˆçš„æ•°ç»„ä¸­æœ‰æ­»å¾ªçŽ¯å¼•ç”¨æ‰è¡Œï¼Œåƒä¸‡ä¸è¦ä¸€å¼€å§‹çœ‹çº¿ç¨‹ä¸€ç§key3æŒ‡å‘key7ï¼Œç„¶åŽçº¿ç¨‹äºŒç§key7æŒ‡å‘key3å°±æ˜¯æ­»å¾ªçŽ¯äº†ã€‚ã€‚ã€‚ 2. çº¿ç¨‹ä¸€ç»§ç»­æ‰§è¡Œ i = 3 e.next = key7,æ­¤æ—¶ e=key3 ,æ‰€ä»¥æ˜¯ key3.next = key7ï¼ˆè¿™æ˜¯çº¿ç¨‹1çš„åˆå§‹çŠ¶æ€å†³å®šçš„ï¼‰ arr1[3] æŒ‡å‘ key3 e ä¸º key7 3.ç”±äºŽeä¸ä¸ºç©ºï¼Œæ‰€ä»¥è¿˜ä¼šå¾ªçŽ¯ï¼š ä¸Šä¸€æ­¥ e ä¸º key7ï¼Œæ‰€ä»¥ next = key7.next ï¼Œåˆ°çº¿ç¨‹2ä¸­ä¸€çœ‹æ˜¯ key3 ï¼Œæ‰€ä»¥ next = key3ï¼ˆçº¿ç¨‹2ä¸­key7.nextå°±æ˜¯key3ï¼‰ i = 3 e.next = key3------æ³¨æ„ï¼Œè¿™é‡Œå°±æ˜¯Key7æŒ‡å‘äº†key3,key7çš„nextå¼•ç”¨ä¸‹é¢æ²¡æœ‰å˜è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œåšä¸€ä¸‹è®°å½•ï¼Œå³key7æŒ‡å‘key3 newTable[3] = key7 e = key3 4.ç”±äºŽeä¸ä¸ºç©ºï¼Œæ‰€ä»¥è¿˜ä¼šå¾ªçŽ¯ï¼š ä¸Šä¸€æ­¥ e=key3 , next=null i=3 key3.next = key7ï¼Œæ³¨æ„,ç”±äºŽkey7å·²ç»æŒ‡å‘äº†key3ï¼Œæ­¤æ—¶key3åˆæŒ‡å‘key7,å‘ç”Ÿæ­»å¾ªçŽ¯ newTable[3] = key3 e = null 5.eä¸ºnullï¼Œè·³å‡ºå¾ªçŽ¯ã€‚ æ­¤æ—¶å‘çŽ°key3åˆæŒ‡å‘äº†key7ã€‚å‘ç”Ÿæ­»å¾ªçŽ¯ã€‚ æ•´ç†è‡ª:https://coolshell.cn/articles/9606.html/comment-page-2#comments]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxé‡è¦çš„ä¸€äº›å‘½ä»¤]]></title>
    <url>%2F2019%2F01%2F21%2Flinux%E9%87%8D%E8%A6%81%E7%9A%84%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[å¾ˆå¤šå‘½ä»¤ä¹‹æ‰€ä»¥é‡è¦ï¼Œæ˜¯å› ä¸ºç”¨å®ƒä»¬ä¼šå¤§å¹…æé«˜å·¥ä½œæ•ˆçŽ‡ã€‚æ‰€ä»¥ï¼Œç†Ÿæ‚‰å®ƒä»¬æ˜¯æˆ‘ä»¬å¿…é¡»è¦åšçš„ä¸€ä»¶äº‹æƒ…ã€‚ä¸‹é¢ç€é‡æå–äº†findã€grepã€ç®¡é“ã€wcã€awkä»¥åŠsedç­‰å‡ ä¸ªå‘½ä»¤æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ã€‚ ä¸€ã€Linuxä½“ç³»ç»“æž„ å¯¹è¿™å¹…å›¾è¿›è¡Œè¯¦ç»†è¯´æ˜Žä¸€ä¸‹ã€‚ ä½“ç³»ç»“æž„ä¸»è¦åˆ†ä¸ºç”¨æˆ·æ€(ç”¨æˆ·ä¸Šå±‚æ´»åŠ¨)å’Œå†…æ ¸æ€ å†…æ ¸ï¼šæœ¬è´¨æ˜¯ä¸€æ®µç®¡ç†è®¡ç®—æœºç¡¬ä»¶è®¾å¤‡çš„ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºç›´æŽ¥ç®¡ç†ç¡¬ä»¶ï¼šåŒ…æ‹¬CPUã€å†…å­˜ç©ºé—´ã€ç¡¬ç›˜æŽ¥å£ã€ç½‘ç»œæŽ¥å£ç­‰ã€‚æ‰€æœ‰çš„è®¡ç®—æœºæ“ä½œéƒ½è¦é€šè¿‡å†…æ ¸æ¥æ“ä½œã€‚ ç³»ç»Ÿè°ƒç”¨ï¼šå†…æ ¸çš„è®¿é—®æŽ¥å£ï¼Œæ˜¯ä¸€ç§ä¸èƒ½å†ç®€åŒ–çš„æ“ä½œ(å¯ä»¥è®¤ä¸ºç³»ç»Ÿè°ƒç”¨å·²ç»æ˜¯æœ€å°çš„åŽŸå­æ“ä½œï¼Œä¸Šå±‚å®Œæˆä¸€ä¸ªåŠŸèƒ½è¦ä¾æ‰˜äºŽè‹¥å¹²ç³»ç»Ÿè°ƒç”¨æ‰èƒ½å®Œæˆ) ç”±äºŽç³»ç»Ÿè°ƒç”¨æ¯”è¾ƒåŸºç¡€ï¼Œè¦å®Œæˆä¸€ä¸ªåŠŸèƒ½éœ€è¦å¾ˆå¤šç³»ç»Ÿè°ƒç”¨ç»„åˆæ‰èƒ½å®žçŽ°ï¼Œå¯¹äºŽç¨‹åºå‘˜æ¥è¯´æ¯”è¾ƒå¤æ‚ã€‚è¿™ä¸ªæ—¶å€™æ€Žä¹ˆåŠžå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è°ƒç”¨å…¬å…±å‡½æ•°åº“ï¼šç³»ç»Ÿè°ƒç”¨çš„ç»„åˆæ‹³ã€‚ç®€åŒ–ç¨‹åºå‘˜æ“ä½œã€‚ Shellä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„åº”ç”¨ç¨‹åºï¼Œæ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œå¯ä»¥ç¼–ç¨‹ã€‚ Shellä¸‹é€šç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šé€šå„ç§åº”ç”¨ï¼Œæ˜¯ä¸Šå±‚å’Œä¸‹å±‚ä¹‹é—´ç²˜åˆçš„èƒ¶æ°´ï¼Œè®©ä¸åŒç¨‹åºå¯ä»¥å•åŒå·¥ä½œã€‚ åœ¨æ²¡æœ‰å›¾å½¢ç•Œé¢ä¹‹å‰ï¼Œç”¨æˆ·é€šè¿‡shellå‘½ä»¤è¡Œæˆ–è€…å¯ç¼–ç¨‹çš„shellè„šæœ¬å¯ä»¥å®Œæˆå¾ˆå¤šäº‹æƒ…ã€‚ äºŒã€å¦‚ä½•æ ¹æ®æ–‡ä»¶åæ£€ç´¢æ–‡ä»¶ find åœ¨æŒ‡å®šç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶ è¯­æ³• find path [options] params 2.1 ç²¾ç¡®æŸ¥æ‰¾æ–‡ä»¶ æ¯”å¦‚æˆ‘åœ¨å½“å‰ç›®å½•(å¯èƒ½åœ¨å­ç›®å½•ä¸‹)ä¸‹æ‰¾ä¸€ä¸ªæ–‡ä»¶å«åštest.javaï¼š 1find -name "test.java" è¿™ä¸ªæŒ‡ä»¤å°±å¯ä»¥åœ¨æœ¬ç›®å½•ä»¥åŠå­ç›®å½•ä¸‹é€’å½’æŸ¥æ‰¾è¿™ä¸ªæ–‡ä»¶äº†ã€‚ å®žä¾‹ï¼šç²¾ç¡®æŸ¥è¯¢åå­—å«snailmall-api-gateway-8080.jarè¿™ä¸ªæ–‡ä»¶ï¼š 2.2 å…¨å±€æœç´¢ å¦‚æžœæ˜¯å…¨å±€æŸ¥æ‰¾ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ— éžæ˜¯ä»Žæ ¹ç›®å½•å¼€å§‹é€’å½’æŸ¥æ‰¾ã€‚ 1find / -name "test.java" å®žä¾‹ï¼šæˆ‘å¯¹è¿™å°æœåŠ¡å™¨å…¨å±€æŸ¥æ‰¾æ–‡ä»¶åä»¥snailmallå¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶ï¼š 2.3 æ¨¡ç³ŠæŸ¥è¯¢ å¦‚æžœæ‰¾ä»¥testæ‰“å¤´çš„æ–‡ä»¶ï¼š 1find -name "test*" å³ç”¨ * é€šé…ç¬¦å°±å¯ä»¥æ¨¡ç³ŠæŸ¥è¯¢åˆ°ä»¥ test æ‰“å¤´çš„æ–‡ä»¶ã€‚ å®žä¾‹ï¼Œæˆ‘çš„è¿™å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†å‡ ä¸ªå…³äºŽå•†åŸŽçš„æœåŠ¡ï¼Œè¿™ä¸ªç›®å½•ä¸‹æˆ‘æ”¾äº†jaråŒ…å’Œç›¸åº”çš„å¯åŠ¨ä¿¡æ¯æ–‡ä»¶ã€‚æˆ‘å¯¹å…¶è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼š 2.4 å¿½ç•¥å¤§å°å†™ 1find -iname "test*" ä¸‰ã€å¦‚ä½•æ ¹æ®æ–‡ä»¶å†…çš„å†…å®¹è¿›è¡Œæ£€ç´¢ 3.1 grepå‘½ä»¤ grep æŸ¥æ‰¾æ–‡ä»¶é‡Œç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸² è¯­æ³•ï¼šgrep [options] pattern file æ¯”å¦‚ test.java ä¸­æœ‰ä¸€å¥è¯æ˜¯ï¼š 1System.out.println("i love java"); é‚£ä¹ˆå¦‚ä½•æŸ¥æ‰¾ test.java ä¸­çš„ java å‘¢ï¼Ÿ 1grep "java" test* è¿™å¥è¯æ„æ€å°±æ˜¯æŸ¥æ‰¾ä»¥ test æ‰“å¤´çš„æ–‡ä»¶ä¸­çš„åŒ…å« java å­—ç¬¦ä¸²æ‰€åœ¨çš„è¡Œã€‚ ç›´æŽ¥è¾“å…¥ï¼š 1grep "hello" ä¼šç­‰å¾…ç”¨æˆ·è¾“å…¥æ–‡æœ¬ã€‚ç„¶åŽå†å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œæ£€ç´¢ã€‚ 3.2 ç®¡é“æ“ä½œç¬¦ | å¯å°†æŒ‡ä»¤è¿žæŽ¥èµ·æ¥ï¼Œå‰ä¸€ä¸ªæŒ‡ä»¤çš„è¾“å‡ºä½œä¸ºåŽä¸€ä¸ªæŒ‡ä»¤çš„è¾“å…¥ã€‚ 1find / | grep "test" ä½œç”¨åŒï¼š 1find / -name "test" æ³¨æ„ï¼š åªæœ‰å‰ä¸€ä¸ªæŒ‡ä»¤æ­£ç¡®æ‰ä¼šå†å¤„ç†ã€‚ ç®¡é“å³è¾¹å‘½ä»¤å¿…é¡»èƒ½æŽ¥æ”¶æ ‡å‡†è¾“å…¥æµï¼Œå¦åˆ™ä¼ é€’è¿‡ç¨‹ä¸­æ•°æ®ä¼šè¢«æŠ›å¼ƒ 3.3 grepç»“åˆç®¡é“ 1grep 'xxx' hello.info å¯ä»¥å°† xxx æ‰€åœ¨çš„è¡Œå…¨éƒ¨ç­›é€‰å‡ºæ¥ï¼Œä½†æ˜¯è¿˜æ˜¯ç‰¹åˆ«å¤šï¼Œæˆ‘æ¯”å¦‚å…³å¿ƒè¿™æ¯ä¸€è¡Œä¸­æŸä¸ªå­—æ®µçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ˜¯ param[xx12]è¿™ç§ä¿¡æ¯ã€‚å¦‚ä½•å®žçŽ°ç­›é€‰å‘¢ï¼Ÿ 1grep 'xxx' hello.info | grep -o 'param\[[0-9a-z]*\]' è¿™æ ·å°±åªæŠŠç±»ä¼¼äºŽ param[xx12] è¿™æ ·çš„ä¿¡æ¯æ¸…æ™°åœ°å±•çŽ°å‡ºæ¥ã€‚ å¦‚ä½•è¿‡æ»¤æŽ‰ä¸è¦çš„ä¿¡æ¯å‘¢ï¼Ÿå¯ä»¥ç”¨ï¼š 1grep -v æ¯”å¦‚æˆ‘ä»¬æŸ¥è¯¢ tomcat è¿›ç¨‹ä¿¡æ¯ï¼š 1ps -ef | grep tomcat æˆ‘ä»¬ä¼šå‘çŽ°ï¼Œä¸ä»… tomcat çš„ä¿¡æ¯å±•çŽ°å‡ºæ¥äº†ï¼Œæ‰§è¡Œ grep å‘½ä»¤æœ¬èº«çš„è¿›ç¨‹ä¿¡æ¯ä¹Ÿå±•ç¤ºå‡ºæ¥äº†ã€‚æˆ‘ä»¬è¦å°†è¿™ä¸ª grep å‘½ä»¤è¿‡æ»¤æŽ‰ï¼Œåªå±•çŽ° tomcat è¿›ç¨‹ä¿¡æ¯ï¼Œå¯ä»¥ï¼š 1ps -ef | grep tomcat | grep -v "grep" è¿™æ ·å°±æŠŠ grep è¿›ç¨‹ä¿¡æ¯è¿‡æ»¤æŽ‰äº†ã€‚ å››ã€å¦‚ä½•å¯¹æ–‡ä»¶å†…å®¹åšç»Ÿè®¡ awk ä¸€æ¬¡è¯»å–ä¸€è¡Œæ–‡æœ¬ï¼ŒæŒ‰è¾“å…¥åˆ†éš”ç¬¦è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡æˆå¤šä¸ªç»„æˆéƒ¨åˆ† å°†åˆ‡ç‰‡ç›´æŽ¥ä¿å­˜å†å†…å»ºçš„å˜é‡ä¸­ï¼Œ$1$2â€¦($0è¡¨ç¤ºè¡Œçš„å…¨éƒ¨) æ”¯æŒå¯¹å•ä¸ªåˆ‡ç‰‡çš„åˆ¤æ–­ï¼Œæ”¯æŒå¾ªçŽ¯åˆ¤æ–­ï¼Œé»˜è®¤åˆ†éš”ç¬¦ä¸ºç©ºæ ¼ è¯­æ³•ï¼šawk [options] â€˜cmdâ€™ file æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶text1.txtï¼š 123456789proto Recv-Q Send-Q Local Address Foreign Address statetcp 0 48 111.34.134.2:ssh 124.213.2.12:12565 ESTABLISHEDtcp 0 48 localhost:mysql 124.213.2.12:12565 ESTABLISHEDudp 0 48 111.34.13.2:s0 124.213.2.12:12565 ESTABLISHEDtcp 0 48 localhost:mysql 124.213.2.12:12565 ESTABLISHEDudp 1 48 localhots:webcac 124.213.2.12:12565 ESTABLISHEDtcp 1 48 111.34.134.2:s1 124.213.2.12:12565 ESTABLISHEDudp 1 48 111.34.134.2:s2 124.213.2.12:12565 ESTABLISHEDudp 0 48 111.34.134.2:s3 124.213.2.12:12565 ESTABLISHED åˆ—å‡ºåˆ‡åˆ†å‡ºæ¥çš„ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—ï¼š 1awk '&#123;print $1,$2&#125;' test1.txt ç»“æžœï¼š ç­›é€‰å‡ºç¬¬ä¸€åˆ—ä¸ºtcpå’Œç¬¬äºŒåˆ—ä¸º1çš„æ‰€åœ¨è¡Œï¼Œå°†è¿™äº›è¡Œæ•°æ®å…¨éƒ¨æ‰“å°å‡ºæ¥ï¼š 1awk '$1="tcp" &amp;&amp; $2==1&#123;print $0&#125;' test1.txt ç»“æžœï¼š æ‰“å°å¸¦æœ‰è¡¨å¤´çš„æ•°æ®ï¼š 1awk '($1="tcp" &amp;&amp; $2==1) || NR==1 &#123;print $0&#125;' test1.txt é»˜è®¤æ˜¯ä»¥ç©ºæ ¼åˆ†éš”ï¼Œé‚£ä¹ˆä»¥é€—å·æˆ–è€…å…¶ä»–ç¬¦å·å¯ä»¥å—ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥ã€‚å¯¹äºŽè¿™æ ·çš„æ–‡ä»¶text2.txtï¼š 12345adas,123wqe,54412321,dddfsdaasd,1235465547,fjigj 1awk -F "," '&#123;print $2&#125;' text2.txt äº”ã€WCç»Ÿè®¡ æœ‰ä¸€ä¸ªæ–‡ä»¶test2.txtï¼Œé‡Œé¢çš„å†…å®¹æ˜¯ï¼š 123swg123eh shwfshsfswg7 121 32n dswg17328 123swg1 2h1jhwjqbsjwqbsh ddddh wg ehdedhd dhsjh å…­ã€sedå‘½ä»¤ sedæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–‡ä»¶å¤„ç†å·¥å…·ï¼Œæœ¬èº«æ˜¯ä¸€ä¸ªç®¡é“å‘½ä»¤ï¼Œä¸»è¦æ˜¯ä»¥è¡Œä¸ºå•ä½è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥å°†æ•°æ®è¡Œè¿›è¡Œæ›¿æ¢ã€åˆ é™¤ã€æ–°å¢žã€é€‰å–ç­‰ç‰¹å®šå·¥ä½œ sed [-n/e/f/r/i] â€˜commandâ€™ è¾“å…¥æ–‡æœ¬ å¸¸ç”¨é€‰é¡¹ï¼š -nâˆ¶ä½¿ç”¨å®‰é™(silent)æ¨¡å¼ã€‚åœ¨ä¸€èˆ¬ sed çš„ç”¨æ³•ä¸­ï¼Œæ‰€æœ‰æ¥è‡ª STDINçš„èµ„æ–™ä¸€èˆ¬éƒ½ä¼šè¢«åˆ—å‡ºåˆ°è¤å¹•ä¸Šã€‚ä½†å¦‚æžœåŠ ä¸Š -n å‚æ•°åŽï¼Œåˆ™åªæœ‰ç»è¿‡sed ç‰¹æ®Šå¤„ç†çš„é‚£ä¸€è¡Œ(æˆ–è€…åŠ¨ä½œ)æ‰ä¼šè¢«åˆ—å‡ºæ¥ã€‚ -eâˆ¶ç›´æŽ¥åœ¨æŒ‡ä»¤åˆ—æ¨¡å¼ä¸Šè¿›è¡Œ sed çš„åŠ¨ä½œç¼–è¾‘ï¼› -fâˆ¶ç›´æŽ¥å°† sed çš„åŠ¨ä½œå†™åœ¨ä¸€ä¸ªæ¡£æ¡ˆå†…ï¼Œ -f filename åˆ™å¯ä»¥æ‰§è¡Œ filename å†…çš„sed åŠ¨ä½œï¼› -râˆ¶sed çš„åŠ¨ä½œæ”¯æ´çš„æ˜¯å»¶ä¼¸åž‹æ­£è§„è¡¨ç¤ºæ³•çš„è¯­æ³•ã€‚(é¢„è®¾æ˜¯åŸºç¡€æ­£è§„è¡¨ç¤ºæ³•è¯­æ³•) -iâˆ¶ç›´æŽ¥ä¿®æ”¹è¯»å–çš„æ¡£æ¡ˆå†…å®¹ï¼Œè€Œä¸æ˜¯ç”±è¤å¹•è¾“å‡ºã€‚ å¸¸ç”¨å‘½ä»¤ï¼š a âˆ¶æ–°å¢žï¼Œ a çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºçŽ°(ç›®å‰çš„ä¸‹ä¸€è¡Œ)ï½ž c âˆ¶å–ä»£ï¼Œ c çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè¿™äº›å­—ä¸²å¯ä»¥å–ä»£ n1,n2 ä¹‹é—´çš„è¡Œï¼ d âˆ¶åˆ é™¤ï¼Œå› ä¸ºæ˜¯åˆ é™¤å•Šï¼Œæ‰€ä»¥ d åŽé¢é€šå¸¸ä¸æŽ¥ä»»ä½•å’šå’šï¼› i âˆ¶æ’å…¥ï¼Œ i çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºçŽ°(ç›®å‰çš„ä¸Šä¸€è¡Œ)ï¼› p âˆ¶åˆ—å°ï¼Œäº¦å³å°†æŸä¸ªé€‰æ‹©çš„èµ„æ–™å°å‡ºã€‚é€šå¸¸ p ä¼šä¸Žå‚æ•° sed -n ä¸€èµ·è¿ä½œï½ž s âˆ¶å–ä»£ï¼Œå¯ä»¥ç›´æŽ¥è¿›è¡Œå–ä»£çš„å·¥ä½œå“©ï¼é€šå¸¸è¿™ä¸ª s çš„åŠ¨ä½œå¯ä»¥æ­é…æ­£è§„è¡¨ç¤ºæ³•ï¼ä¾‹å¦‚ 1,20s/old/new/g å°±æ˜¯å•¦ï¼ è¿™é‡Œæˆ‘å°±ä¸»è¦çœ‹ä¸€ä¸‹æ‰¹é‡æ›¿æ¢è¿™ä¸ªåŠŸèƒ½ã€‚ å¦‚æžœåªæ˜¯ç»™ä¸€ä¸ªæ–‡ä»¶ä¸­çš„è‹¥å¹²å­—ç¬¦ä¸²æ‰¹é‡æ›¿æ¢ï¼Œåªéœ€è¦ï¼š 1sed -i "s/oldstring/newstring/g" filename å¦‚æžœæ˜¯å¯¹æŸä¸€è·¯å¾„ä¸‹å¾ˆå¤šçš„æ–‡ä»¶æ‰¹é‡æ›¿æ¢ï¼š 1sed -i &quot;s/oldstring/newstring/g&quot; `grep oldstring -rl path` å…¶ä¸­ï¼Œoldstringæ˜¯å¾…è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²ï¼Œnewstringæ˜¯å¾…æ›¿æ¢oldstringçš„æ–°å­—ç¬¦ä¸²ï¼Œgrepæ“ä½œä¸»è¦æ˜¯æŒ‰ç…§æ‰€ç»™çš„è·¯å¾„æŸ¥æ‰¾oldstringï¼Œpathæ˜¯æ‰€æ›¿æ¢æ–‡ä»¶çš„è·¯å¾„ï¼› -ié€‰é¡¹æ˜¯ç›´æŽ¥åœ¨æ–‡ä»¶ä¸­æ›¿æ¢ï¼Œä¸åœ¨ç»ˆç«¯è¾“å‡ºï¼› -ré€‰é¡¹æ˜¯æ‰€ç»™çš„pathä¸­çš„ç›®å½•é€’å½’æŸ¥æ‰¾ï¼› -lé€‰é¡¹æ˜¯è¾“å‡ºæ‰€æœ‰åŒ¹é…åˆ°oldstringçš„æ–‡ä»¶ï¼› è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿä¸€ä¸‹ï¼Œå°†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæ‰¹é‡ä¿®æ”¹ï¼š]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç«™ç‚¹æ–‡ç« æ±‡æ€»]]></title>
    <url>%2F2019%2F01%2F21%2F%E7%AB%99%E7%82%B9%E6%96%87%E7%AB%A0%E6%B1%87%E6%80%BB%2F</url>
    <content type="text"><![CDATA[â˜ï¸â˜ï¸â˜ï¸ðŸ”ðŸ”ðŸ”æœ¬æ–‡ä¸ºç½®é¡¶æ–‡ç« ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†å’ŒæŸ¥é˜…ï¼Œåœ¨è¿™é‡Œè¯¦ç»†å±•ç¤ºç›®å½•ç´¢å¼•ï¼Œçœ‹å®Œç´¢å¼•ï¼Œä½ å°±çŸ¥é“æœ¬ç«™çš„å¤§ä½“å†…å®¹å•¦ï¼æˆ‘ç›¸ä¿¡ä¸€å®šä¼šç»™å°ä¼™ä¼´ä»¬ä¸€äº›æ”¶èŽ·ï¼ è®¡ç®—æœºç½‘ç»œðŸ­ðŸ­ðŸ­ è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯å…³äºŽHTTPå’ŒTCPçš„å¿…å¤‡çŸ¥è¯†ã€‚ ã€Šè®¡ç®—æœºç½‘ç»œç›¸å…³ç³»åˆ—ã€‹ï¼š ã€Šä»Žä¸‹åˆ°ä¸Šçœ‹äº”å±‚æ¨¡åž‹ã€‹ ã€Šä»Žä¸Šåˆ°ä¸‹çœ‹äº”å±‚æ¨¡åž‹ã€‹ ã€ŠHTTPçš„å‰ä¸–ä»Šç”Ÿã€‹ ã€ŠTCPåè®®å…¥é—¨ã€‹ ã€ŠTCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ã€‹ ã€ŠHTTPåŸºç¡€çŸ¥è¯†æç‚¼ã€‹ ã€Šä¸€æ­¥ä¸€æ­¥ç†è§£HTTPSã€‹ ã€Šä¸€äº›å¸¸è§çš„é¢è¯•é¢˜ã€‹ JAVAå®¹å™¨ðŸ±ðŸ±ðŸ± è¿™ä¸€éƒ¨åˆ†æ˜¯JAVAå®¹å™¨ä¸€ç³»åˆ—æ–‡ç« ï¼Œä¸»è¦è®²äº†å¸¸ç”¨JAVAå®¹å™¨çš„æºç å’Œä¸€äº›ç‰¹æ€§ï¼Œé¢è¯•å¿…é—®ç‚¹ã€‚ ã€ŠJAVAå®¹å™¨ã€‹ï¼š ã€ŠArrayList/Vectorã€‹ ã€ŠLinkedListã€‹ ã€ŠCopyOnWriteArrayListã€‹ ã€ŠHashCode/Equalsã€‹ ã€ŠHashMapã€‹ ã€ŠHashSetã€‹ ã€ŠLinkedHashMapã€‹ ã€ŠHashMapå’ŒLinkedHashMapéåŽ†æœºåˆ¶ã€‹ ã€ŠHashTableã€‹ ã€ŠLinkedHashSetã€‹ ã€ŠJDK7ä¸­HashMapæ­»å¾ªçŽ¯åŽŸå› å‰–æžã€‹ ã€ŠConcurrentHashMapã€‹ Linux&amp;æ“ä½œç³»ç»ŸðŸ¶ðŸ¶ðŸ¶ ä¸€äº›å¿…å¤‡çš„Liunxç›¸å…³çš„çŸ¥è¯†ç‚¹æ•´ç†ã€‚ ã€ŠLinuxã€‹ï¼š ã€ŠLinuxé¢è¯•é‡è¦å‘½ä»¤ã€‹ ã€Šæ“ä½œç³»ç»Ÿç›¸å…³ã€‹ï¼š ã€Šé¢è¯•-è¿›ç¨‹ä¸Žçº¿ç¨‹ã€‹ JAVAè™šæ‹Ÿæœºç›¸å…³ðŸ¹ðŸ¹ðŸ¹ ä¸»è¦æ˜¯ä»‹ç»JVMç›¸å…³çŸ¥è¯†ã€‚è½»æ¾ä»¥åº”ä»˜é¢è¯•ã€‚ JAVAæ ¸å¿ƒåŸºç¡€çŸ¥è¯†ðŸºðŸºðŸº ä¸»è¦æ˜¯ä»‹ç»æ¯”è¾ƒæ ¸å¿ƒçš„JAVAåŸºç¡€çŸ¥è¯†ï¼Œå±žäºŽJAVAåŸºç¡€è¿›é˜¶ã€‚ ã€ŠIntegeræ‹†ç®±å’Œè£…ç®±ã€‹ ã€ŠStringä¸ºä»€ä¹ˆä¸å¯å˜ã€‹ ã€Šjavaå­—ç¬¦ä¸²æ ¸å¿ƒä¸€ç½‘æ‰“å°½ã€‹ ã€ŠJAVAåŸºç¡€æ ¸å¿ƒ-ç†è§£ç±»ã€å¯¹è±¡ã€é¢å‘å¯¹è±¡ç¼–ç¨‹ã€é¢å‘æŽ¥å£ç¼–ç¨‹ã€‹ ã€Šè¡¥ç çš„å‰ä¸–ä»Šç”Ÿã€‹ ã€Šæ•°å€¼è®¡ç®—ç²¾åº¦ä¸¢å¤±é—®é¢˜ã€‹ JAVAå¤šçº¿ç¨‹ðŸ¸ðŸ¸ðŸ¸ å¤šçº¿ç¨‹è¿™ä¸€å—æ¯”è¾ƒæ£˜æ‰‹ï¼Œä¸”å­¦ä¸”ä¿é‡ã€‚ RedisðŸ¯ðŸ¯ðŸ¯ ç³»ç»Ÿå­¦ä¹ redisçš„ç¬”è®°æ•´ç†ã€‚ ã€ŠRedisã€‹ï¼š ã€Šåˆæ­¥è®¤è¯†Redisã€‹ ã€ŠRedisåŸºæœ¬æ•°æ®ç»“æž„å’Œæ“ä½œã€‹ ã€ŠRediså…¶ä»–çš„åŠŸèƒ½ä»‹ç»ã€‹ ã€ŠRedisä¸ºä»€ä¹ˆå¿«ã€‹ ã€ŠRedisæŒä¹…åŒ–ã€‹ ã€ŠRedisä¸»ä»Žå¤åˆ¶ã€‹ ã€ŠRedis-Sentinelå®žçŽ°é«˜å¯ç”¨è¯»å†™åˆ†ç¦»ã€‹ ã€ŠRedis-Clusterç†è®ºè¯¦è§£ã€‹ ã€ŠRedisç¼“å­˜è®¾è®¡ä¸Žä¼˜åŒ–ã€‹ ã€ŠRedisç¼“å­˜æ›´æ–°é—®é¢˜ã€‹ ã€ŠRedisäº‹åŠ¡ã€‹ ã€Šå‡ ç§ä¸»æµç¼“å­˜æ¡†æž¶ä»‹ç»ã€‹ ã€Šå…³äºŽRedisä¸€äº›é‡è¦çš„é¢è¯•ç‚¹ã€‹ MySQLæ•°æ®åº“ðŸ¨ðŸ¨ðŸ¨ ä½œä¸ºå¿…å¤‡æŠ€èƒ½ï¼Œç”¨æ³•å’ŒåŽŸç†éƒ½è¦ä¼šã€‚ ã€ŠMySQLã€‹ï¼š ã€Šmysqlæœ€åŸºç¡€çŸ¥è¯†å°ç»“ã€‹ ã€ŠSQLå¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹æç‚¼ã€‹ ã€Šå¤æ‚æŸ¥è¯¢è®­ç»ƒã€‹ ã€Šdeleteå’Œtruncateä»¥åŠdropåŒºåˆ«ã€‹ ã€Šå¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»åž‹æ•°æ®åº“ã€‹ ã€Šæ•°æ®åº“ç´¢å¼•å…¥é—¨ã€‹ ã€ŠMySQLç´¢å¼•å…¨é¢è§£è¯»ã€‹ ã€ŠMySQLè°ƒä¼˜ã€‹ ã€Šå…³äºŽç´¢å¼•å¤±æ•ˆå’Œè”åˆç´¢å¼•ã€‹ ã€Šé”æ¨¡å—ã€‹ ã€Šæ•°æ®åº“äº‹åŠ¡æ ¸å¿ƒé—®é¢˜ã€‹ ã€Šmysqlé¢è¯•é«˜é¢‘ç†è®ºçŸ¥è¯†ã€‹ ç®—æ³•ðŸ»ðŸ»ðŸ» ç®—æ³•è¿™ä¸€å—ä¹Ÿæ˜¯é¢è¯•ç—›ç‚¹å’Œéš¾ç‚¹ï¼Œå¤´å‘è¶Šæ¥è¶Šå°‘äº†å‘¢ï¼ SpringðŸ·ðŸ·ðŸ· å¤§åŽ‚å¿…é—®å•Šå•Šå•Šå•Šï¼Œæºç ç»ˆç©¶è¿˜æ˜¯è¦è¯»çš„~ Spring Cloudç›¸å…³ðŸ®ðŸ®ðŸ® è¿™ä¸€å—å°±æ¯”è¾ƒåå®žè·µäº†ã€‚åˆ†å¸ƒå¼ã€‚ã€‚ã€‚è·¯æ¼«æ¼«ã€‚ã€‚ã€‚ ZookeeperðŸ—ðŸ—ðŸ— ä½œä¸ºå½“ä»Šåˆ†å¸ƒå¼åè°ƒä¸­å¿ƒï¼Œæ ¸å¿ƒçš„Paxosç®—æ³•ä½ ä¸æƒ³äº†è§£ä¸€ä¸‹å—ï¼Ÿ æ‚è®°ðŸµðŸµðŸµ åœ¨è¿™ä¸ªæ¿å—ï¼Œä¸åˆ’åˆ†ç±»åˆ«ï¼Œæ–‡ç« å°½å¯èƒ½åœ°ç®€çŸ­ï¼Œä¹Ÿå¯è°“ä¹‹è®°å¿†ç¢Žç‰‡ã€‚ ã€ŠæŠ€æœ¯çŸ­æ–‡æ‚è®°ã€‹ï¼š ã€Šspringäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‹ ã€ŠRedissonå®žçŽ°Redisåˆ†å¸ƒå¼é”åŽŸç†ã€‹ ã€Šrediså®žçŽ°åˆ†å¸ƒå¼é”ã€‹ ã€ŠspringMVCå…¨å±€å¼‚å¸¸+springåŒ…æ‰«æåŒ…éš”ç¦»+springäº‹åŠ¡ä¼ æ’­ã€‹ ã€Šåˆ†å¸ƒå¼IDç”Ÿæˆç­–ç•¥ã€‹ ã€ŠSpring Sessionã€‹ ã€ŠCuratorã€‹ ã€ŠELKå¹³å°æ­å»ºã€‹ ã€Šåº“å­˜æ‰£å‡é—®é¢˜ã€‹ ã€Šåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ€è€ƒã€‹ ã€ŠSpringBootä½¿ç”¨logbackå®žçŽ°æ—¥å¿—æŒ‰å¤©æ»šåŠ¨ã€‹ ã€Šåœ°ç†ä½ç½®é™„è¿‘æŸ¥è¯¢çš„GEOHASHè§£å†³æ–¹æ¡ˆã€‹ ã€Šæ·±å…¥æŽ¢ç©¶NginxåŽŸç†ã€‹ ã€Šç®€æ˜Žç†è§£ä¸€è‡´æ€§hashç®—æ³•ã€‹ å®žæˆ˜ä½œå“ðŸ°ðŸ°ðŸ° è®°å½•ä¸€äº›å®žæˆ˜ä½œå“ï¼Œä»£ç ä¸»è¦å­˜æ”¾åœ¨githubä¸Šã€‚ ã€Šæˆ‘çš„å®žæˆ˜ã€‹ï¼š ã€Šå¿«ä¹èœ—ç‰›å•†åŸŽä»£ç ã€‹ ã€Šç ç è´­åˆ†å¸ƒå¼ç”µå•†å®žæˆ˜ä»£ç ã€‹]]></content>
      <tags>
        <tag>æ±‡æ€»</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedHashSet]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F10.LinkedHashSet%2F</url>
    <content type="text"><![CDATA[HashSet å’Œ LinkedHashSet çš„å…³ç³»ç±»ä¼¼äºŽ HashMap å’Œ LinkedHashMap çš„å…³ç³»ï¼Œå³åŽè€…ç»´æŠ¤åŒå‘é“¾è¡¨ï¼Œå®žçŽ°è¿­ä»£é¡ºåºå¯ä¸ºæ’å…¥é¡ºåºæˆ–æ˜¯è®¿é—®é¡ºåºã€‚æ‰€ä»¥ä¹Ÿå°±è½»æ¾åŠ æ„‰å¿«å¿«é€Ÿäº†è§£ä¸€ä¸‹å³å¯ã€‚ ä»Žæºç ä¸­å¯ä»¥çœ‹åˆ°å…¶ç©ºçš„æž„é€ å‡½æ•°ä¸ºï¼š 123public LinkedHashSet() &#123; super(16, .75f, true);&#125; è¿™ä¸ªsuperå³çˆ¶ç±»æ˜¯HashSetï¼Œä»Žå®ƒçš„ç»§æ‰¿å…³ç³»å°±å¯ä»¥æ˜¾ç„¶çœ‹åˆ°ï¼š 123public class LinkedHashSet&lt;E&gt; extends HashSet&lt;E&gt; implements Set&lt;E&gt;, Cloneable, java.io.Serializable é‚£ä¹ˆHashSetå†…éƒ¨çš„æ•°æ®ç»“æž„å°±æ˜¯ä¸€ä¸ª HashMapï¼Œå…¶æ–¹æ³•çš„å†…éƒ¨å‡ ä¹Žå°±æ˜¯åœ¨è°ƒç”¨ HashMap çš„æ–¹æ³•ã€‚ LinkedHashSet é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯å®ƒæ˜¯ä¸€ä¸ª Set çš„å®žçŽ°ï¼Œæ‰€ä»¥å®ƒå…¶ä¸­å­˜çš„è‚¯å®šä¸æ˜¯é”®å€¼å¯¹ï¼Œè€Œæ˜¯å€¼ã€‚æ­¤å®žçŽ°ä¸Ž HashSet çš„ä¸åŒä¹‹å¤„åœ¨äºŽï¼ŒLinkedHashSet ç»´æŠ¤ç€ä¸€ä¸ªè¿è¡ŒäºŽæ‰€æœ‰æ¡ç›®çš„åŒå‘å¾ªçŽ¯é“¾è¡¨ã€‚ è¿™ä¸€åˆ‡éƒ½ä¸ŽLinkedHashMapç±»ä¼¼ã€‚ LinkedHashSet å†…éƒ¨æœ‰ä¸ªå±žæ€§ accessOrder æŽ§åˆ¶ç€éåŽ†æ¬¡åºã€‚é»˜è®¤æƒ…å†µä¸‹è¯¥å€¼ä¸º false ,å³æŒ‰æ’å…¥æŽ’åºè®¿é—®ã€‚å¦‚æžœå°†è¯¥å€¼è®¾ç½®ä¸º true çš„è¯ï¼Œåˆ™æŒ‰è®¿é—®æ¬¡åºæŽ’åº(å³æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ”¾åœ¨é“¾è¡¨å¤´éƒ¨ï¼Œæœ€è¿‘è®¿é—®çš„åˆ™åœ¨é“¾è¡¨å°¾éƒ¨)ã€‚ ä¸€ã€ ç¤ºä¾‹ HashSetçš„éåŽ†ï¼š 123456789101112public static void main(String[] args) &#123; Set&lt;String&gt; linkedHashSet = new HashSet&lt;&gt;(); linkedHashSet.add("aaa"); linkedHashSet.add("eee"); linkedHashSet.add("ccc"); linkedHashSet.add("bbb"); Iterator&lt;String&gt; it = linkedHashSet.iterator(); while(it.hasNext())&#123; System.out.println(it.next()); &#125;&#125; è¾“å‡ºç»“æžœæ˜¯ï¼š aaa ccc bbb eee LinkedHashSetçš„éåŽ†ï¼š 1234567891011121314public static void main(String[] args) &#123; Set&lt;String&gt; linkedHashSet = new LinkedHashSet&lt;&gt;(); linkedHashSet.add("aaa"); linkedHashSet.add("eee"); linkedHashSet.add("ccc"); linkedHashSet.add("bbb"); linkedHashSet.add(null); Iterator&lt;String&gt; it = linkedHashSet.iterator(); while(it.hasNext())&#123; System.out.println(it.next()); &#125; &#125; è¾“å‡ºç»“æžœæ˜¯ï¼š aaa eee ccc bbb null å¯ä»¥çœ‹åˆ°ä¸Žè¾“å…¥é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hashtable]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F9.HashTable%2F</url>
    <content type="text"><![CDATA[Hashtable æ˜¯ä¸ªè¿‡æ—¶çš„é›†åˆç±»ï¼Œä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ HashMap æ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ ConcurrentHashMap æ›¿æ¢ã€‚ä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬ä¸åŽ»äº†è§£å®ƒçš„ç†ç”±ã€‚æœ€èµ·ç  Hashtable å’Œ HashMap çš„é¢è¯•é¢˜åœ¨é¢è¯•ä¸­ç»å¸¸è¢«é—®åˆ°ã€‚ ä¸€ã€å‰è¨€ Hashtableå’ŒHashMapï¼Œä»Žå­˜å‚¨ç»“æž„å’Œå®žçŽ°æ¥è®²åŸºæœ¬ä¸Šéƒ½æ˜¯ç›¸åŒçš„ã€‚ å®ƒå’ŒHashMapçš„æœ€å¤§çš„ä¸åŒæ˜¯å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦å¤–å®ƒä¸å…è®¸keyå’Œvalueä¸ºnullã€‚ ä¸ºäº†èƒ½åœ¨å“ˆå¸Œè¡¨ä¸­æˆåŠŸåœ°ä¿å­˜å’Œå–å‡ºå¯¹è±¡ï¼Œç”¨ä½œkeyçš„å¯¹è±¡å¿…é¡»å®žçŽ°hashCodeæ–¹æ³•å’Œequalsæ–¹æ³•ã€‚ äºŒã€fail-fastæœºåˆ¶ iteratoræ–¹æ³•è¿”å›žçš„è¿­ä»£å™¨æ˜¯fail-fastçš„ã€‚å¦‚æžœåœ¨è¿­ä»£å™¨è¢«åˆ›å»ºåŽhashtableè¢«ç»“æž„åž‹åœ°ä¿®æ”¹äº†ï¼Œé™¤äº†è¿­ä»£å™¨è‡ªå·±çš„removeæ–¹æ³•ï¼Œè¿­ä»£å™¨ä¼šæŠ›å‡ºä¸€ä¸ªConcurrentModificationExceptionå¼‚å¸¸ã€‚ å› æ­¤ï¼Œé¢å¯¹åœ¨å¹¶å‘çš„ä¿®æ”¹ï¼Œè¿­ä»£å™¨å¹²è„†åˆ©è½çš„å¤±è´¥ï¼Œè€Œä¸æ˜¯å†’é™©çš„ç»§ç»­ã€‚ å…³äºŽè¿™ä¸ªçš„ç†è§£ï¼Œå…¶å®žåœ¨ä¸Šä¸€ç« è®²LinkedHashMapä¸­çš„ç¬¬å…«ç‚¹æåˆ°ï¼š å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒafterNodeAccess() å‡½æ•°ä¸­ï¼Œä¼šä¿®æ”¹modCount,å› æ­¤å½“ä½ æ­£åœ¨accessOrder=trueçš„æ¨¡å¼ä¸‹,è¿­ä»£LinkedHashMapæ—¶ï¼Œå¦‚æžœåŒæ—¶æŸ¥è¯¢è®¿é—®æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´fail-fastï¼Œå› ä¸ºè¿­ä»£çš„é¡ºåºå·²ç»æ”¹å˜ã€‚ ç®€å•è¯´ï¼Œå°±æ˜¯ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åˆ†åˆ«è¿›è¡Œä¿®æ”¹å’ŒéåŽ†æ—¶ï¼Œä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚ é¢è¯•é¢˜ï¼šé›†åˆåœ¨éåŽ†è¿‡ç¨‹ä¸­æ˜¯å¦å¯ä»¥åˆ é™¤å…ƒç´ ï¼Œä¸ºä»€ä¹ˆè¿­ä»£å™¨å°±å¯ä»¥å®‰å…¨åˆ é™¤å…ƒç´ ï¼Ÿ é›†åˆåœ¨ä½¿ç”¨ for å¾ªçŽ¯è¿­ä»£çš„è¿‡ç¨‹ä¸­ä¸å…è®¸ä½¿ç”¨ï¼Œé›†åˆæœ¬èº«çš„ remove æ–¹æ³•åˆ é™¤å…ƒç´ ï¼Œå¦‚æžœè¿›è¡Œé”™è¯¯æ“ä½œå°†ä¼šå¯¼è‡´ ConcurrentModificationException å¼‚å¸¸çš„å‘ç”Ÿ Iterator å¯ä»¥åˆ é™¤è®¿é—®çš„å½“å‰å…ƒç´ (current)ï¼Œä¸€æ—¦åˆ é™¤çš„å…ƒç´ æ˜¯Iterator å¯¹è±¡ä¸­ next æ‰€æ­£åœ¨å¼•ç”¨çš„ï¼Œåœ¨ Iterator åˆ é™¤å…ƒç´ é€šè¿‡ ä¿®æ”¹ modCount ä¸Ž expectedModCount çš„å€¼ï¼Œå¯ä»¥ä½¿ä¸‹æ¬¡åœ¨è°ƒç”¨ remove çš„æ–¹æ³•æ—¶å€™ä¸¤è€…ä»ç„¶ç›¸åŒå› æ­¤ä¸ä¼šæœ‰å¼‚å¸¸äº§ç”Ÿã€‚ è¿­ä»£å™¨çš„fail-fastæœºåˆ¶å¹¶ä¸èƒ½å¾—åˆ°ä¿è¯ï¼Œå®ƒä¸èƒ½å¤Ÿä¿è¯ä¸€å®šå‡ºçŽ°è¯¥é”™è¯¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œfail-fastä¼šå°½æœ€å¤§åŠªåŠ›æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚å› æ­¤ï¼Œä¸ºæé«˜æ­¤ç±»æ“ä½œçš„æ­£ç¡®æ€§è€Œç¼–å†™ä¸€ä¸ªä¾èµ–äºŽæ­¤å¼‚å¸¸çš„ç¨‹åºæ˜¯é”™è¯¯çš„åšæ³•ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼šConcurrentModificationException åº”è¯¥ä»…ç”¨äºŽæ£€æµ‹ bugã€‚ Hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æžœä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„å®žçŽ°æ˜¯ä¸éœ€è¦çš„ï¼ŒæŽ¨èä½¿ç”¨HashMapä»£æ›¿Hashtableã€‚å¦‚æžœéœ€è¦çº¿ç¨‹å®‰å…¨çš„å®žçŽ°ï¼ŒæŽ¨èä½¿ç”¨java.util.concurrent.ConcurrentHashMapä»£æ›¿Hashtableã€‚ äºŒã€ç»§æ‰¿å…³ç³» 123public class Hashtable&lt;K,V&gt; extends Dictionary&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, java.io.Serializable&#123;&#125; extends Dictionary&lt;K,V&gt;ï¼šDictionaryç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨æ¥å­˜å‚¨é”®/å€¼å¯¹ï¼Œä½œç”¨å’ŒMapç±»ç›¸ä¼¼ã€‚ implements Map&lt;K,V&gt;ï¼šå®žçŽ°äº†Mapï¼Œå®žçŽ°äº†Mapä¸­å£°æ˜Žçš„æ“ä½œå’Œdefaultæ–¹æ³•ã€‚ hashMapä»¥åŠTreeMapçš„æºç ï¼Œéƒ½æ²¡æœ‰ç»§æ‰¿äºŽè¿™ä¸ªç±»ã€‚ä¸è¿‡å½“æˆ‘çœ‹åˆ°æ³¨é‡Šä¸­çš„è§£é‡Šä¹Ÿå°±æ˜Žç™½äº†ï¼Œå…¶ Dictionary æºç æ³¨é‡Šæ˜¯è¿™æ ·çš„ï¼šNOTE: This class is obsolete. New implementations should implement the Map interface, rather than extending this class. è¯¥è¯æŒ‡å‡º Dictionary è¿™ä¸ªç±»è¿‡æ—¶äº†ï¼Œæ–°çš„å®žçŽ°ç±»åº”è¯¥å®žçŽ°MapæŽ¥å£ã€‚ ä¸‰ã€å±žæ€§ 1234567891011121314//å“ˆå¸Œè¡¨private transient Entry&lt;?,?&gt;[] table;//è®°å½•å“ˆå¸Œè¡¨ä¸­é”®å€¼å¯¹çš„ä¸ªæ•°private transient int count;//æ‰©å®¹çš„é˜ˆå€¼private int threshold;//è´Ÿè½½å› å­private float loadFactor;//hashtableè¢«ç»“æž„åž‹ä¿®æ”¹çš„æ¬¡æ•°ã€‚private transient int modCount = 0; HashTableå¹¶æ²¡æœ‰åƒHashMapé‚£æ ·å®šä¹‰äº†å¾ˆå¤šçš„å¸¸é‡ï¼Œè€Œæ˜¯ç›´æŽ¥å†™æ­»åœ¨äº†æ–¹æ³•é‡Œã€‚ Hashtableä¸è¦æ±‚åº•å±‚æ•°ç»„çš„å®¹é‡ä¸€å®šè¦ä¸º2çš„æ•´æ•°æ¬¡å¹‚ï¼Œè€ŒHashMapåˆ™è¦æ±‚ä¸€å®šä¸º2çš„æ•´æ•°æ¬¡å¹‚ã€‚ å››ã€æž„é€ å‡½æ•° 12345678/** * ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–å®¹é‡ï¼ˆ11ï¼‰å’Œé»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰æ¥æž„é€ ä¸€ä¸ªç©ºçš„hashtable. * * è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒHashtableé»˜è®¤åˆå§‹åŒ–å®¹é‡ä¸º16ï¼Œè€ŒHashMapçš„é»˜è®¤åˆå§‹åŒ–å®¹é‡ä¸º11ã€‚ */public Hashtable() &#123; this(11, 0.75f);&#125; æˆ‘ä»¬å¯ä»¥èŽ·å–åˆ°è¿™äº›ä¿¡æ¯ï¼šHashTableé»˜è®¤çš„åˆå§‹åŒ–å®¹é‡ä¸º11ï¼ˆä¸ŽHashMapä¸åŒï¼‰ï¼Œè´Ÿè½½å› å­é»˜è®¤ä¸º0.75ï¼ˆä¸ŽHashMapç›¸åŒï¼‰ã€‚è€Œæ­£å› ä¸ºé»˜è®¤åˆå§‹åŒ–å®¹é‡çš„ä¸åŒï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰å¯¹å®¹é‡åšè°ƒæ•´çš„ç­–ç•¥ï¼Œæ‰€ä»¥å¯ä»¥å…ˆæŽ¨æ–­å‡ºï¼ŒHashTableä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°è·ŸHashMapæ˜¯ä¸ä¸€æ ·çš„ï¼ˆäº‹å®žä¹Ÿç¡®å®žå¦‚æ­¤ï¼‰ã€‚ äº”ã€é‡è¦æ–¹æ³• 5.1 getæ–¹æ³• 12345678910111213public synchronized V get(Object key) &#123; Entry&lt;?,?&gt; tab[] = table; int hash = key.hashCode(); //é€šè¿‡å“ˆå¸Œå‡½æ•°ï¼Œè®¡ç®—å‡ºkeyå¯¹åº”çš„æ¡¶çš„ä½ç½® int index = (hash &amp; 0x7FFFFFFF) % tab.length; //éåŽ†è¯¥æ¡¶çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯»æ‰¾è¯¥key for (Entry&lt;?,?&gt; e = tab[index] ; e != null ; e = e.next) &#123; if ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123; return (V)e.value; &#125; &#125; return null;&#125; è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒHashtableå’ŒHashMapç¡®è®¤keyåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•çš„æ–¹æ³•ä¸åŒã€‚ Hashtableé€šè¿‡index = (hash &amp; 0x7FFFFFFF) % tab.length;æ¥ç¡®è®¤ HashMapé€šè¿‡i = (n - 1) &amp; hash;æ¥ç¡®è®¤ è·ŸHashMapç›¸æ¯”ï¼ŒHashTableçš„getæ–¹æ³•éžå¸¸ç®€å•ã€‚æˆ‘ä»¬é¦–å…ˆå¯ä»¥çœ‹è§getæ–¹æ³•ä½¿ç”¨äº†synchronizedæ¥ä¿®é¥°ï¼Œæ‰€ä»¥å®ƒèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¹¶ä¸”å®ƒæ˜¯é€šè¿‡é“¾è¡¨çš„æ–¹å¼æ¥å¤„ç†å†²çªçš„ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹è§HashTableå¹¶æ²¡æœ‰åƒHashMapé‚£æ ·å°è£…ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œè€Œæ˜¯ç›´æŽ¥æŠŠå“ˆå¸Œå‡½æ•°å†™åœ¨äº†æ–¹æ³•ä¸­ã€‚è€Œå“ˆå¸Œå‡½æ•°ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå®ƒä»…å¯¹å“ˆå¸Œè¡¨çš„é•¿åº¦è¿›è¡Œäº†å–æ¨¡ã€‚ 5.2 putæ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public synchronized V put(K key, V value) &#123; // ç¡®è®¤valueä¸ä¸ºnull if (value == null) &#123; throw new NullPointerException(); &#125; Entry&lt;?,?&gt; tab[] = table; int hash = key.hashCode(); //æ‰¾åˆ°keyåœ¨tableä¸­çš„ç´¢å¼• int index = (hash &amp; 0x7FFFFFFF) % tab.length; @SuppressWarnings("unchecked") //èŽ·å–keyæ‰€åœ¨ç´¢å¼•çš„entry Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index]; //éåŽ†entryï¼Œåˆ¤æ–­keyæ˜¯å¦å·²ç»å­˜åœ¨ for(; entry != null ; entry = entry.next) &#123; //å¦‚æžœkeyå·²ç»å­˜åœ¨ if ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) &#123; //ä¿å­˜æ—§çš„value V old = entry.value; //æ›¿æ¢value entry.value = value; //è¿”å›žæ—§çš„value return old; &#125; &#125; //å¦‚æžœkeyåœ¨hashtableä¸æ˜¯å·²ç»å­˜åœ¨ï¼Œå°±ç›´æŽ¥å°†é”®å€¼å¯¹æ·»åŠ åˆ°tableä¸­ï¼Œè¿”å›žnull addEntry(hash, key, value, index); return null;&#125;private void addEntry(int hash, K key, V value, int index) &#123; modCount++; Entry&lt;?,?&gt; tab[] = table; //å“ˆå¸Œè¡¨çš„é”®å€¼å¯¹ä¸ªæ•°è¾¾åˆ°äº†é˜ˆå€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ if (count &gt;= threshold) &#123; // Rehash the table if the threshold is exceeded rehash(); tab = table; hash = key.hashCode(); index = (hash &amp; 0x7FFFFFFF) % tab.length; &#125; // Creates the new entry. @SuppressWarnings("unchecked") Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;) tab[index]; //æŠŠæ–°èŠ‚ç‚¹æ’å…¥æ¡¶ä¸­ï¼ˆå¤´æ’æ³•ï¼‰ tab[index] = new Entry&lt;&gt;(hash, key, value, e); count++;&#125; ä»Žä»£ç ä¸­å¯ä»¥æ€»ç»“å‡ºHashtableçš„putæ–¹æ³•çš„æ€»ä½“æ€è·¯ï¼š ç¡®è®¤valueä¸ä¸ºnullã€‚å¦‚æžœä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ æ‰¾åˆ°keyåœ¨tableä¸­çš„ç´¢å¼•ï¼ŒèŽ·å–keyæ‰€åœ¨ä½ç½®çš„entry éåŽ†entryï¼Œåˆ¤æ–­keyæ˜¯å¦å·²ç»å­˜åœ¨ å¦‚æžœkeyå·²ç»å­˜åœ¨ï¼Œæ›¿æ¢valueï¼Œè¿”å›žæ—§çš„value å¦‚æžœkeyåœ¨hashtableä¸æ˜¯å·²ç»å­˜åœ¨ï¼Œå°±ç›´æŽ¥æ·»åŠ ï¼Œå¦åˆ™ç›´æŽ¥å°†é”®å€¼å¯¹æ·»åŠ åˆ°tableä¸­ï¼Œè¿”å›žnull åœ¨æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨éåŽ†æ¡¶ä¸­å…ƒç´ æ—¶ï¼Œæ˜¯æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éåŽ†çš„ã€‚å¯ä»¥å°è¯ï¼ŒHashMapçš„æ¡¶ä¸­å¯èƒ½ä¸ºé“¾è¡¨æˆ–è€…æ ‘ã€‚ä½†Hashtableçš„æ¡¶ä¸­åªå¯èƒ½æ˜¯é“¾è¡¨ã€‚ 5.3 removeæ–¹æ³• 12345678910111213141516171819202122232425public synchronized V remove(Object key) &#123; Entry&lt;?,?&gt; tab[] = table; int hash = key.hashCode(); //è®¡ç®—keyåœ¨hashtableä¸­çš„ç´¢å¼• int index = (hash &amp; 0x7FFFFFFF) % tab.length; @SuppressWarnings("unchecked") Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)tab[index]; //éåŽ†entryï¼Œå¦‚æžœentryä¸­å­˜åœ¨keyä¸ºå‚æ•°keyçš„é”®å€¼å¯¹ï¼Œå°±åˆ é™¤é”®å€¼å¯¹ï¼Œå¹¶è¿”å›žé”®å€¼å¯¹çš„value for(Entry&lt;K,V&gt; prev = null ; e != null ; prev = e, e = e.next) &#123; if ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123; modCount++; if (prev != null) &#123; prev.next = e.next; &#125; else &#123; tab[index] = e.next; &#125; count--; V oldValue = e.value; e.value = null; return oldValue; &#125; &#125; //å¦‚æžœä¸å­˜åœ¨keyä¸ºå‚æ•°keyçš„é”®å€¼å¯¹ï¼Œè¿”å›žvalue return null;&#125; ä»Žä»£ç ä¸­å¯ä»¥æ€»ç»“å‡ºHashtableçš„removeæ–¹æ³•çš„æ€»ä½“æ€è·¯ï¼š æ‰¾åˆ°keyåœ¨tableä¸­çš„ç´¢å¼•ï¼ŒèŽ·å–keyæ‰€åœ¨ä½ç½®çš„entry éåŽ†entryï¼Œåˆ¤æ–­keyæ˜¯å¦å·²ç»å­˜åœ¨ å¦‚æžœkeyå­˜åœ¨ï¼Œåˆ é™¤keyæ˜ å°„çš„é”®å€¼å¯¹ï¼Œè¿”å›žæ—§çš„value å¦‚æžœkeyåœ¨hashtableä¸å­˜åœ¨ï¼Œè¿”å›žnull 5.4 rehashæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * å¢žåŠ hashtableçš„å®¹é‡ï¼Œä¸ºäº†æ›´æœ‰æ•ˆåœ°å­˜æ”¾å’Œæ‰¾åˆ°å®ƒçš„entryã€‚ * å½“é”®å€¼å¯¹çš„æ•°é‡è¶…è¿‡äº†ä¸´ç•Œå€¼ï¼ˆcapacity*load factorï¼‰è¿™ä¸ªæ–¹æ³•è‡ªåŠ¨è°ƒç”¨ * é•¿åº¦å˜ä¸ºåŽŸæ¥çš„2å€+1 * */@SuppressWarnings("unchecked")protected void rehash() &#123; //è®°å½•æ—§å®¹é‡ int oldCapacity = table.length; //è®°å½•æ—§æ¡¶çš„æ•°ç»„ Entry&lt;?,?&gt;[] oldMap = table; // overflow-conscious code //æ–°çš„å®¹é‡ä¸ºæ—§çš„å®¹é‡çš„2å€+1 int newCapacity = (oldCapacity &lt;&lt; 1) + 1; //å¦‚æžœæ–°çš„å®¹é‡å¤§äºŽå®¹é‡çš„æœ€å¤§å€¼MAX_ARRAY_SIZE if (newCapacity - MAX_ARRAY_SIZE &gt; 0) &#123; //å¦‚æžœæ—§å®¹é‡ä¸ºMAX_ARRAY_SIZEï¼Œå®¹é‡ä¸å˜ï¼Œä¸­æ–­æ–¹æ³•çš„æ‰§è¡Œ if (oldCapacity == MAX_ARRAY_SIZE) // Keep running with MAX_ARRAY_SIZE buckets return; //å¦‚æžœæ—§å®¹é‡ä¸ä¸ºMAX_ARRAY_SIZEï¼Œæ–°å®¹é‡å˜ä¸ºMAX_ARRAY_SIZE newCapacity = MAX_ARRAY_SIZE; &#125; //åˆ›å»ºæ–°çš„æ•°ç»„ï¼Œå®¹é‡ä¸ºæ–°å®¹é‡ Entry&lt;?,?&gt;[] newMap = new Entry&lt;?,?&gt;[newCapacity]; //ç»“æž„æ€§ä¿®æ”¹æ¬¡æ•°+1 modCount++; //è®¡ç®—æ‰©å®¹çš„ä¸´ç•Œå€¼ threshold = (int)Math.min(newCapacity * loadFactor, MAX_ARRAY_SIZE + 1); table = newMap; //å°†æ—§çš„æ•°ç»„ä¸­çš„é”®å€¼å¯¹è½¬ç§»åˆ°æ–°æ•°ç»„ä¸­ for (int i = oldCapacity ; i-- &gt; 0 ;) &#123; for (Entry&lt;K,V&gt; old = (Entry&lt;K,V&gt;)oldMap[i] ; old != null ; ) &#123; Entry&lt;K,V&gt; e = old; old = old.next; int index = (e.hash &amp; 0x7FFFFFFF) % newCapacity; e.next = (Entry&lt;K,V&gt;)newMap[index]; newMap[index] = e; &#125; &#125;&#125; çœ‹å®Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºrehashçš„æ€»ä½“æ€è·¯ä¸ºï¼š æ–°å»ºå˜é‡æ–°çš„å®¹é‡ï¼Œå€¼ä¸ºæ—§çš„å®¹é‡çš„2å€+1 å¦‚æžœæ–°çš„å®¹é‡å¤§äºŽå®¹é‡çš„æœ€å¤§å€¼MAX_ARRAY_SIZE å¦‚æžœæ—§å®¹é‡ä¸ºMAX_ARRAY_SIZEï¼Œå®¹é‡ä¸å˜ï¼Œä¸­æ–­æ–¹æ³•çš„æ‰§è¡Œ å¦‚æžœæ—§å®¹é‡ä¸ä¸ºMAX_ARRAY_SIZEï¼Œæ–°å®¹é‡å˜ä¸ºMAX_ARRAY_SIZE åˆ›å»ºæ–°çš„æ•°ç»„ï¼Œå®¹é‡ä¸ºæ–°å®¹é‡ å°†æ—§çš„æ•°ç»„ä¸­çš„é”®å€¼å¯¹è½¬ç§»åˆ°æ–°æ•°ç»„ä¸­ è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒHashMapæ‰©å®¹åŽå®¹é‡å˜ä¸ºåŽŸæ¥çš„ä¸¤å€ï¼Œè€ŒHashtableæ‰©å®¹åŽå®¹é‡å˜ä¸ºåŽŸæ¥çš„ä¸¤å€åŠ ä¸€ã€‚ HashTableçš„rehashæ–¹æ³•ç›¸å½“äºŽHashMapçš„resizeæ–¹æ³•ã€‚è·ŸHashMapé‚£ç§å·§å¦™çš„rehashæ–¹å¼ç›¸æ¯”ï¼ŒHashTableçš„rehashè¿‡ç¨‹éœ€è¦å¯¹æ¯ä¸ªé”®å€¼å¯¹éƒ½é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œè€Œæ¯”èµ·å¼‚æˆ–å’Œä¸Žæ“ä½œï¼Œå–æ¨¡æ˜¯ä¸€ä¸ªéžå¸¸è€—æ—¶çš„æ“ä½œï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯å¯¼è‡´æ•ˆçŽ‡è¾ƒä½Žçš„åŽŸå› ä¹‹ä¸€ã€‚ å…­ã€éåŽ† å¯ä»¥ä½¿ç”¨ä¸ŽHashMapä¸€æ ·çš„éåŽ†æ–¹å¼ï¼Œä½†æ˜¯ç”±äºŽåŽ†å²åŽŸå› ï¼Œå¤šäº†Enumerationçš„æ–¹å¼ã€‚ é’ˆå¯¹Enumerationï¼Œè¿™é‡Œä¸Žiteratorè¿›è¡Œå¯¹æ¯”ä¸€ä¸‹ã€‚ ç›¸åŒç‚¹ Iteratorå’ŒEnumerationéƒ½å¯ä»¥å¯¹æŸäº›å®¹å™¨è¿›è¡ŒéåŽ†ã€‚ Iteratorå’ŒEnumerationéƒ½æ˜¯æŽ¥å£ã€‚ ä¸åŒç‚¹ Iteratoræœ‰å¯¹å®¹å™¨è¿›è¡Œä¿®æ”¹çš„æ–¹æ³•ã€‚è€ŒEnumerationåªèƒ½éåŽ†ã€‚ Iteratoræ”¯æŒfail-fastï¼Œè€ŒEnumerationä¸æ”¯æŒã€‚ Iteratoræ¯”Enumerationè¦†ç›–èŒƒå›´å¹¿ï¼ŒåŸºæœ¬æ‰€æœ‰å®¹å™¨ä¸­éƒ½æœ‰Iteratorè¿­ä»£å™¨ï¼Œè€Œåªæœ‰Vectorã€Hashtableæœ‰Enumerationã€‚ Enumerationåœ¨JDK 1.0å°±å·²ç»å­˜åœ¨äº†ï¼Œè€ŒIteratoræ˜¯JDK2.0æ–°åŠ çš„æŽ¥å£ã€‚ ä¸ƒã€Hashtableä¸ŽHashMapå¯¹æ¯” HashTableçš„åº”ç”¨éžå¸¸å¹¿æ³›ï¼ŒHashMapæ˜¯æ–°æ¡†æž¶ä¸­ç”¨æ¥ä»£æ›¿HashTableçš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å»ºè®®ä½¿ç”¨HashMapã€‚ ä¸‹é¢ç€é‡æ¯”è¾ƒä¸€ä¸‹äºŒè€…çš„åŒºåˆ«ï¼š 1.ç»§æ‰¿ä¸åŒ Hashtableæ˜¯åŸºäºŽé™ˆæ—§çš„Dictionaryç±»çš„ï¼ŒHashMapæ˜¯java1.2å¼•è¿›çš„MapæŽ¥å£çš„ä¸€ä¸ªå®žçŽ°ã€‚ 2.åŒæ­¥ Hashtable ä¸­çš„æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œä¿è¯äº†Hashtableä¸­çš„å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ HashMapä¸­çš„æ–¹æ³•åœ¨ç¼ºçœæƒ…å†µä¸‹æ˜¯éžåŒæ­¥çš„,HashMapä¸­çš„å¯¹è±¡å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„çŽ¯å¢ƒä¸‹ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨Hashtableï¼Œä½†æ˜¯è¦ä½¿ç”¨HashMapçš„è¯å°±è¦è‡ªå·±å¢žåŠ åŒæ­¥å¤„ç†äº†ã€‚ 3.æ•ˆçŽ‡ å•çº¿ç¨‹ä¸­, HashMapçš„æ•ˆçŽ‡å¤§äºŽHashtableã€‚å› ä¸ºåŒæ­¥çš„è¦æ±‚ä¼šå½±å“æ‰§è¡Œçš„æ•ˆçŽ‡ï¼Œæ‰€ä»¥å¦‚æžœä½ ä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼ŒHashMapæ˜¯Hashtableçš„è½»é‡çº§å®žçŽ°ï¼Œè¿™æ ·å¯ä»¥é¿å…ç”±äºŽåŒæ­¥å¸¦æ¥çš„ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ï¼Œä»Žè€Œæé«˜æ•ˆçŽ‡ã€‚ 4.nullå€¼ Hashtableä¸­ï¼Œkeyå’Œvalueéƒ½ä¸å…è®¸å‡ºçŽ°nullå€¼ï¼Œå¦åˆ™å‡ºçŽ°NullPointerExceptionã€‚ åœ¨HashMapä¸­ï¼Œnullå¯ä»¥ä½œä¸ºé”®ï¼Œè¿™æ ·çš„é”®åªæœ‰ä¸€ä¸ªï¼›å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ‰€å¯¹åº”çš„å€¼ä¸ºnullã€‚å½“get()æ–¹æ³•è¿”å›žnullå€¼æ—¶ï¼Œå³å¯ä»¥è¡¨ç¤º HashMapä¸­æ²¡æœ‰è¯¥é”®ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºè¯¥é”®æ‰€å¯¹åº”çš„å€¼ä¸ºnullã€‚å› æ­¤ï¼Œåœ¨HashMapä¸­ä¸èƒ½ç”±get()æ–¹æ³•æ¥åˆ¤æ–­HashMapä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé”®ï¼Œè€Œåº”è¯¥ç”¨containsKey()æ–¹æ³•æ¥åˆ¤æ–­ã€‚ 5.éåŽ†æ–¹å¼ Hashtableã€HashMapéƒ½ä½¿ç”¨äº† Iteratorã€‚è€Œç”±äºŽåŽ†å²åŽŸå› ï¼ŒHashtableå¯ä»¥ä½¿ç”¨Enumerationçš„æ–¹å¼ã€‚ 6.å®¹é‡ Hashtableå’ŒHashMapå®ƒä»¬ä¸¤ä¸ªå†…éƒ¨å®žçŽ°æ–¹å¼çš„æ•°ç»„çš„åˆå§‹å¤§å°å’Œæ‰©å®¹çš„æ–¹å¼ã€‚ HashTableä¸­hashæ•°ç»„é»˜è®¤å¤§å°æ˜¯11ï¼Œå¢žåŠ çš„æ–¹å¼æ˜¯ old*2+1ã€‚ HashMapä¸­hashæ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯16ï¼Œè€Œä¸”ä¸€å®šæ˜¯2çš„æŒ‡æ•°ã€‚ å…«ã€æ€»ç»“ æ— è®ºä»€ä¹ˆæ—¶å€™æœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®ç›¸åŒå®žä¾‹çš„å¯èƒ½æ—¶ï¼Œå°±åº”è¯¥ä½¿ç”¨Hashtableï¼Œåä¹‹ä½¿ç”¨HashMapã€‚éžçº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æž„èƒ½å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ã€‚ å¦‚æžœåœ¨å°†æ¥æœ‰ä¸€ç§å¯èƒ½â€”ä½ éœ€è¦æŒ‰é¡ºåºèŽ·å¾—é”®å€¼å¯¹çš„æ–¹æ¡ˆæ—¶ï¼ŒHashMapæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºæœ‰HashMapçš„ä¸€ä¸ªå­ç±» LinkedHashMapã€‚ æ‰€ä»¥å¦‚æžœä½ æƒ³å¯é¢„æµ‹çš„æŒ‰é¡ºåºè¿­ä»£ï¼ˆé»˜è®¤æŒ‰æ’å…¥çš„é¡ºåºï¼‰ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿ç”¨LinkedHashMapæ›¿æ¢HashMapã€‚åè§‚è¦æ˜¯ä½¿ç”¨çš„Hashtableå°±æ²¡é‚£ä¹ˆç®€å•äº†ã€‚ å¦‚æžœæœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®HashMapï¼ŒCollections.synchronizedMapï¼ˆï¼‰å¯ä»¥ä»£æ›¿ï¼Œæ€»çš„æ¥è¯´HashMapæ›´çµæ´»ï¼Œæˆ–è€…ç›´æŽ¥ç”¨å¹¶å‘å®¹å™¨ConcurrentHashMapã€‚ æ•´ç†è‡ªï¼š http://blog.csdn.net/panweiwei1994/article/details/77428710 http://blog.csdn.net/u013124587/article/details/52655042]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMapå’ŒLinkedHashMapéåŽ†æœºåˆ¶]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F8.HashMap%E5%92%8CLinkedHashMap%E9%81%8D%E5%8E%86%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡å•ç‹¬è®²ä¸€ä¸‹HashMapå’ŒLinkedHashMapéåŽ†æ–¹å¼ã€‚ ä¸€ã€å¯¹HashMapå’ŒLinkedHashMapéåŽ†çš„å‡ ç§æ–¹æ³• è¿™é‡Œä»¥HashMapä¸ºä¾‹ï¼ŒLinkedHashMapä¸€æ ·çš„æ–¹å¼ã€‚ 12345Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; entryIterator = map.entrySet().iterator();while (entryIterator.hasNext()) &#123; Map.Entry&lt;String, Integer&gt; next = entryIterator.next(); System.out.println("key=" + next.getKey() + " value=" + next.getValue());&#125; 123456Iterator&lt;String&gt; iterator = map.keySet().iterator();while (iterator.hasNext())&#123; String key = iterator.next(); System.out.println("key=" + key + " value=" + map.get(key));&#125; 123map.forEach((key,value)-&gt;&#123; System.out.println("key=" + key + " value=" + value);&#125;); å¼ºçƒˆå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ EntrySet è¿›è¡ŒéåŽ†ã€‚ ç¬¬ä¸€ç§å¯ä»¥æŠŠ key value åŒæ—¶å–å‡ºï¼Œç¬¬äºŒç§è¿˜å¾—éœ€è¦é€šè¿‡ key å–ä¸€æ¬¡ valueï¼Œæ•ˆçŽ‡è¾ƒä½Ž, ç¬¬ä¸‰ç§éœ€è¦ JDK1.8 ä»¥ä¸Šï¼Œé€šè¿‡å¤–å±‚éåŽ† tableï¼Œå†…å±‚éåŽ†é“¾è¡¨æˆ–çº¢é»‘æ ‘ã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒHashMapçš„è¾“å‡ºé¡ºåºä¸Žå…ƒç´ çš„è¾“å…¥é¡ºåºæ— å…³ï¼ŒLinkedHashMapå¯ä»¥æŒ‰ç…§è¾“å…¥é¡ºåºè¾“å‡ºï¼Œä¹Ÿå¯ä»¥æ ¹æ®è¯»å–å…ƒç´ çš„é¡ºåºè¾“å‡ºã€‚è¿™ä¸€çŽ°è±¡ï¼Œå·²ç»åœ¨ä¸Šä¸€ç¯‡ä¸­å±•ç¤ºå‡ºæ¥äº†ã€‚ äºŒã€HashMapçš„éåŽ†æœºåˆ¶ HashMap æä¾›äº†ä¸¤ä¸ªéåŽ†è®¿é—®å…¶å†…éƒ¨å…ƒç´ Entry&lt;k,v&gt;çš„æŽ¥å£ï¼š Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet()-------&gt;è¿”å›žæ­¤æ˜ å°„æ‰€åŒ…å«çš„æ˜ å°„å…³ç³»çš„ Set è§†å›¾ã€‚ Set&lt;K&gt; keySet()--------&gt;è¿”å›žæ­¤æ˜ å°„ä¸­æ‰€åŒ…å«çš„é”®çš„ Set è§†å›¾ã€‚ å®žé™…ä¸Šï¼Œç¬¬äºŒä¸ªæŽ¥å£è¡¨ç¤ºçš„Keyçš„é¡ºåºï¼Œå’Œç¬¬ä¸€ä¸ªæŽ¥å£è¿”å›žçš„Entryé¡ºåºæ˜¯å¯¹åº”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè¿™ä¸¤ç§æŽ¥å£å¯¹HashMapçš„å…ƒç´ éåŽ†çš„é¡ºåºç›¸ç›¸åŒçš„ã€‚ é‚£ä¹ˆï¼ŒHashMapéåŽ†å†…éƒ¨Entry&lt;K,V&gt; çš„é¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æžæ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œå…ˆè¦çŸ¥é“å…¶å†…éƒ¨ç»“æž„æ˜¯æ€Žæ ·çš„ã€‚ HashMapåœ¨å­˜å‚¨Entryå¯¹è±¡çš„æ—¶å€™ï¼Œæ˜¯æ ¹æ®Keyçš„hashå€¼åˆ¤å®šå­˜å‚¨åˆ°Entry[] tableæ•°ç»„çš„å“ªä¸€ä¸ªç´¢å¼•å€¼è¡¨ç¤ºçš„é“¾è¡¨ä¸Šã€‚ å¯¹HashMapéåŽ†Entryå¯¹è±¡çš„é¡ºåºå’ŒEntryå¯¹è±¡çš„å­˜å‚¨é¡ºåºä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ HashMapæ•£åˆ—å›¾ã€Hashtableæ•£åˆ—è¡¨æ˜¯æŒ‰â€œæœ‰åˆ©äºŽéšæœºæŸ¥æ‰¾çš„æ•£åˆ—(hash)çš„é¡ºåºâ€ã€‚å¹¶éžæŒ‰è¾“å…¥é¡ºåºã€‚éåŽ†æ—¶åªèƒ½å…¨éƒ¨è¾“å‡ºï¼Œè€Œæ²¡æœ‰é¡ºåºã€‚ç”šè‡³å¯ä»¥rehash()é‡æ–°æ•£åˆ—ï¼Œæ¥èŽ·å¾—æ›´åˆ©äºŽéšæœºå­˜å–çš„å†…éƒ¨é¡ºåºã€‚ æ‰€ä»¥å¯¹HashMapçš„éåŽ†ï¼Œç”±å†…éƒ¨çš„æœºåˆ¶å†³å®šçš„ï¼Œè¿™ä¸ªæœºåˆ¶æ˜¯åªè€ƒè™‘åˆ©äºŽå¿«é€Ÿå­˜å–ï¼Œä¸è€ƒè™‘è¾“å…¥ç­‰é¡ºåºã€‚ ä¸‰ã€LinkedHashMap çš„éåŽ†æœºåˆ¶ LinkedHashMap æ˜¯HashMapçš„å­ç±»ï¼Œå®ƒå¯ä»¥å®žçŽ°å¯¹å®¹å™¨å†…Entryçš„å­˜å‚¨é¡ºåºå’Œå¯¹Entryçš„éåŽ†é¡ºåºä¿æŒä¸€è‡´ã€‚ ä¸ºäº†å®žçŽ°è¿™ä¸ªåŠŸèƒ½ï¼ŒLinkedHashMapå†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªEntryç±»åž‹çš„åŒå‘é“¾è¡¨ï¼Œç”¨è¿™ä¸ªåŒå‘é“¾è¡¨è®°å½•Entryçš„å­˜å‚¨é¡ºåºã€‚å½“éœ€è¦å¯¹è¯¥Mapè¿›è¡ŒéåŽ†çš„æ—¶å€™ï¼Œå®žé™…ä¸Šæ˜¯éåŽ†çš„æ˜¯è¿™ä¸ªåŒå‘é“¾è¡¨ã€‚ LinkedHashMapå†…éƒ¨ä½¿ç”¨çš„LinkedHashMap.Entryç±»ç»§æ‰¿è‡ªMap.Entryç±»ï¼Œåœ¨å…¶åŸºç¡€ä¸Šå¢žåŠ äº†LinkedHashMap.Entryç±»åž‹çš„ä¸¤ä¸ªå­—æ®µï¼Œç”¨æ¥å¼•ç”¨è¯¥Entryåœ¨åŒå‘é“¾è¡¨ä¸­çš„å‰é¢çš„Entryå¯¹è±¡å’ŒåŽé¢çš„Entryå¯¹è±¡ã€‚ å®ƒçš„å†…éƒ¨ä¼šåœ¨Map.Entryç±»çš„åŸºç¡€ä¸Šï¼Œå¢žåŠ ä¸¤ä¸ªEntryç±»åž‹çš„å¼•ç”¨ï¼šbeforeï¼Œafterã€‚LinkedHashMapä½¿ç”¨ä¸€ä¸ªåŒå‘è¿žè¡¨ï¼Œå°†å…¶å†…éƒ¨æ‰€æœ‰çš„Entryä¸²èµ·æ¥ã€‚ 1234LinkedHashMap linkedHashMap = new LinkedHashMap(); linkedHashMap.put("name","louis"); linkedHashMap.put("age","24"); linkedHashMap.put("sex","male"); å¯¹LinkedHashMapè¿›è¡ŒéåŽ†çš„ç­–ç•¥ï¼š ä»Ž header.after æŒ‡å‘çš„Entryå¯¹è±¡å¼€å§‹ï¼Œç„¶åŽä¸€ç›´æ²¿ç€æ­¤é“¾è¡¨éåŽ†ä¸‹åŽ»ï¼Œç›´åˆ°æŸä¸ªentry.after == header ä¸ºæ­¢ï¼Œå®ŒæˆéåŽ†ã€‚ æ ¹æ®Entry&lt;K,V&gt;æ’å…¥LinkedHashMapçš„é¡ºåºè¿›è¡ŒéåŽ†çš„æ–¹å¼å«åšï¼šæŒ‰æ’å…¥é¡ºåºéåŽ†ã€‚ å¦å¤–ï¼ŒLinkedHashMapè¿˜æ”¯æŒä¸€ç§éåŽ†é¡ºåºï¼Œå«åšï¼šGetè¯»å–é¡ºåºã€‚ å¦‚æžœLinkedHashMapçš„è¿™ä¸ªGetè¯»å–éåŽ†é¡ºåºå¼€å¯ï¼Œé‚£ä¹ˆï¼Œå½“æˆ‘ä»¬åœ¨LinkedHashMapä¸Šè°ƒç”¨get(key) æ–¹æ³•æ—¶ï¼Œä¼šå¯¼è‡´å†…éƒ¨keyå¯¹åº”çš„Entryåœ¨åŒå‘é“¾è¡¨ä¸­çš„ä½ç½®ç§»åŠ¨åˆ°åŒå‘é“¾è¡¨çš„æœ€åŽã€‚ å››ã€éåŽ†æœºåˆ¶çš„æ€»ç»“ HashMapå¯¹å…ƒç´ çš„éåŽ†é¡ºåºè·ŸEntryæ’å…¥çš„é¡ºåºæ— å…³ï¼Œè€ŒLinkedHashMapå¯¹å…ƒç´ çš„éåŽ†é¡ºåºå¯ä»¥è·ŸEntry&lt;K,V&gt;æ’å…¥çš„é¡ºåºä¿æŒä¸€è‡´ï¼šä»ŽåŒå‘ã€‚ å½“LinkedHashMapå¤„äºŽGetèŽ·å–é¡ºåºéåŽ†æ¨¡å¼ä¸‹ï¼Œå½“æ‰§è¡Œget() æ“ä½œæ—¶ï¼Œä¼šå°†å¯¹åº”çš„Entry&lt;k,v&gt;ç§»åˆ°éåŽ†çš„æœ€åŽä½ç½®ã€‚ LinkedHashMapå¤„äºŽæŒ‰æ’å…¥é¡ºåºéåŽ†çš„æ¨¡å¼ä¸‹ï¼Œå¦‚æžœæ–°æ’å…¥çš„&lt;key,value&gt; å¯¹åº”çš„keyå·²ç»å­˜åœ¨ï¼Œå¯¹åº”çš„Entryåœ¨éåŽ†é¡ºåºä¸­çš„ä½ç½®å¹¶ä¸ä¼šæ”¹å˜ã€‚ é™¤äº†éåŽ†é¡ºåºå¤–ï¼Œå…¶ä»–ç‰¹æ€§HashMapå’ŒLinkedHashMapåŸºæœ¬ç›¸åŒã€‚]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedHashMap]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F7.LinkedHashMap%2F</url>
    <content type="text"><![CDATA[å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªè¦ä¸æ¶‰åŠçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œ Map åŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨ HashMap ï¼Œä¸è¿‡ HashMap æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿­ä»£ HashMap çš„é¡ºåºå¹¶ä¸æ˜¯ HashMap æ”¾ç½®çš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯æ— åºã€‚ HashMap çš„è¿™ä¸€ç¼ºç‚¹å¾€å¾€ä¼šå¸¦æ¥å›°æ‰°ï¼Œå› ä¸ºæœ‰äº›åœºæ™¯ï¼Œæˆ‘ä»¬æœŸå¾…ä¸€ä¸ªæœ‰åºçš„ Mapã€‚ ç¯‡å¹…æœ‰ç‚¹é•¿ï¼Œä½†æ˜¯åœ¨ç†è§£äº†HashMapä¹‹åŽå°±æ¯”è¾ƒç®€å•äº†ã€‚ è¿™ä¸ªæ—¶å€™ï¼ŒLinkedHashMapå°±é—ªäº®ç™»åœºäº†ï¼Œå®ƒè™½ç„¶å¢žåŠ äº†æ—¶é—´å’Œç©ºé—´ä¸Šçš„å¼€é”€ï¼Œä½†æ˜¯å¯ä»¥è§£å†³æœ‰æŽ’åºéœ€æ±‚çš„åœºæ™¯ã€‚ å®ƒçš„åº•å±‚æ˜¯ç»§æ‰¿äºŽ HashMap å®žçŽ°çš„ï¼Œç”±ä¸€ä¸ªåŒå‘å¾ªçŽ¯é“¾è¡¨æ‰€æž„æˆã€‚ LinkedHashMap çš„æŽ’åºæ–¹å¼æœ‰ä¸¤ç§ï¼š æ ¹æ®å†™å…¥é¡ºåºæŽ’åºã€‚ æ ¹æ®è®¿é—®é¡ºåºæŽ’åºã€‚ å…¶ä¸­æ ¹æ®è®¿é—®é¡ºåºæŽ’åºæ—¶ï¼Œæ¯æ¬¡ get éƒ½ä¼šå°†è®¿é—®çš„å€¼ç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾ï¼Œè¿™æ ·é‡å¤æ“ä½œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæŒ‰ç…§è®¿é—®é¡ºåºæŽ’åºçš„é“¾è¡¨ã€‚ ä¸€ã€LinkedHashMapæ•°æ®ç»“æž„ LinkedHashMapæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å’ŒåŒå‘å¾ªçŽ¯é“¾è¡¨å®žçŽ°çš„ï¼Œå®ƒé€šè¿‡ç»´æŠ¤ä¸€ä¸ªåŒå‘å¾ªçŽ¯é“¾è¡¨æ¥ä¿è¯å¯¹å“ˆå¸Œè¡¨è¿­ä»£æ—¶çš„æœ‰åºæ€§ï¼Œè€Œè¿™ä¸ªæœ‰åºæ˜¯æŒ‡é”®å€¼å¯¹æ’å…¥çš„é¡ºåºã€‚ æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒéåŽ†æ‰€æœ‰å…ƒç´ åªéœ€è¦ä»Žheaderå¼€å§‹éåŽ†å³å¯ï¼Œä¸€ç›´éåŽ†åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯headerç»“æŸã€‚ å¦å¤–ï¼Œå½“å‘å“ˆå¸Œè¡¨ä¸­é‡å¤æ’å…¥æŸä¸ªé”®çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“åˆ°åŽŸæ¥çš„æœ‰åºæ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ä½ æ’å…¥çš„é”®çš„é¡ºåºä¸º1ã€2ã€3ã€4ï¼ŒåŽæ¥å†æ¬¡æ’å…¥2ï¼Œè¿­ä»£æ—¶çš„é¡ºåºè¿˜æ˜¯1ã€2ã€3ã€4ï¼Œè€Œä¸ä¼šå› ä¸ºåŽæ¥æ’å…¥çš„2å˜æˆ1ã€3ã€4ã€2ã€‚ï¼ˆä½†å…¶å®žæˆ‘ä»¬å¯ä»¥æ”¹å˜å®ƒçš„è§„åˆ™ï¼Œä½¿å®ƒå˜æˆ1ã€3ã€4ã€2ï¼‰ LinkedHashMapçš„å®žçŽ°ä¸»è¦åˆ†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å“ˆå¸Œè¡¨ï¼Œå¦å¤–ä¸€éƒ¨åˆ†æ˜¯é“¾è¡¨ã€‚å“ˆå¸Œè¡¨éƒ¨åˆ†ç»§æ‰¿äº†HashMapï¼Œæ‹¥æœ‰äº†HashMapé‚£ä¸€å¥—é«˜æ•ˆçš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦çœ‹çš„å°±æ˜¯LinkedHashMapä¸­é“¾è¡¨çš„éƒ¨åˆ†ï¼Œäº†è§£å®ƒæ˜¯å¦‚ä½•æ¥ç»´æŠ¤æœ‰åºæ€§çš„ã€‚ äºŒã€demoç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public static void main(String[] args) &#123; /** * HashMapæ’å…¥æ•°æ®ï¼ŒéåŽ†è¾“å‡ºæ— åº */ System.out.println("----------HashMapæ’å…¥æ•°æ®--------"); Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(); map.put("apple", "a"); map.put("watermelon", "b"); map.put("banana", "c"); map.put("peach", "d"); Iterator iter = map.entrySet().iterator(); while (iter.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter.next(); System.out.println(entry.getKey() + "=" + entry.getValue()); &#125; /** * LinkedHashMapæ’å…¥æ•°æ®ï¼ŒéåŽ†ï¼Œé»˜è®¤ä»¥æ’å…¥é¡ºåºä¸ºåº */ System.out.println("----------LinkedHashMapæ’å…¥æ•°æ®,æŒ‰ç…§æ’å…¥é¡ºåºè¿›è¡ŒæŽ’åº--------"); Map&lt;String, String&gt; linkedHashMap = new LinkedHashMap&lt;&gt;(); linkedHashMap.put("apple", "a"); linkedHashMap.put("watermelon", "b"); linkedHashMap.put("banana", "c"); linkedHashMap.put("peach", "d"); Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iterator = linkedHashMap.entrySet().iterator(); while (iterator.hasNext()) &#123; System.out.println(iterator.next()); &#125; /** * LinkedHashMapæ’å…¥æ•°æ®ï¼Œè®¾ç½®accessOrder=trueå®žçŽ°ä½¿å¾—å…¶éåŽ†é¡ºåºæŒ‰ç…§è®¿é—®çš„é¡ºåºè¾“å‡ºï¼Œè¿™é‡Œå…ˆç”¨getæ–¹æ³•æ¥æ¼”ç¤º */ System.out.println("----------LinkedHashMapæ’å…¥æ•°æ®,accessOrder=true:æŒ‰ç…§è®¿é—®é¡ºåºè¿›è¡ŒæŽ’åº--------"); Map&lt;String, String&gt; linkedHashMap2 = new LinkedHashMap&lt;String, String&gt;(16,0.75f,true); linkedHashMap2.put("apple", "aa"); linkedHashMap2.put("watermelon", "bb"); linkedHashMap2.put("banana", "cc"); linkedHashMap2.put("peach", "dd"); linkedHashMap2.get("banana");//bananaç§»åŠ¨åˆ°äº†å†…éƒ¨çš„é“¾è¡¨æœ«å°¾ linkedHashMap2.get("apple");//appleç§»åŠ¨åˆ°äº†å†…éƒ¨çš„é“¾è¡¨æœ«å°¾ Iterator iter2 = linkedHashMap2.entrySet().iterator(); while (iter2.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter2.next(); System.out.println(entry.getKey() + "=" + entry.getValue()); &#125; /** * LinkedHashMapçš„putæ–¹æ³•åœ¨accessOrder=trueçš„æƒ…å†µä¸‹ */ System.out.println("-----------"); linkedHashMap2.put("watermelon", "bb");//watermelonç§»åŠ¨åˆ°äº†å†…éƒ¨çš„é“¾è¡¨æœ«å°¾ linkedHashMap2.put("stawbarrey", "ee");//æœ«å°¾æ’å…¥æ–°å…ƒç´ stawbarrey linkedHashMap2.put(null, null);//æ’å…¥æ–°çš„èŠ‚ç‚¹ null Iterator iter3 = linkedHashMap2.entrySet().iterator(); while (iter3.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter3.next(); System.out.println(entry.getKey() + "=" + entry.getValue()); &#125; &#125; è¾“å‡ºç»“æžœæ˜¯: 12345678910111213141516171819202122----------HashMapæ’å…¥æ•°æ®--------banana=capple=apeach=dwatermelon=b----------LinkedHashMapæ’å…¥æ•°æ®,æŒ‰ç…§æ’å…¥é¡ºåºè¿›è¡ŒæŽ’åº--------apple=awatermelon=bbanana=cpeach=d----------LinkedHashMapæ’å…¥æ•°æ®,æŒ‰ç…§è®¿é—®é¡ºåºè¿›è¡ŒæŽ’åº--------watermelon=bbpeach=ddbanana=cc//bananaåˆ°äº†æœ«å°¾apple=aa//appleåˆ°äº†æœ«å°¾-----------peach=ddbanana=ccapple=aawatermelon=bb//watermelonåˆ°äº†é“¾è¡¨æœ«å°¾stawbarrey=ee//æ–°æ’å…¥çš„æ”¾åœ¨æœ«å°¾null=null//æ–°æ’å…¥çš„æ”¾åœ¨æœ«å°¾ ä¸‰ã€å±žæ€§ LinkedHashMapå¯ä»¥è®¤ä¸ºæ˜¯HashMap+LinkedListï¼Œå³å®ƒæ—¢ä½¿ç”¨HashMapæ“ä½œæ•°æ®ç»“æž„ï¼Œåˆä½¿ç”¨LinkedListç»´æŠ¤æ’å…¥å…ƒç´ çš„å…ˆåŽé¡ºåº 3.1 ç»§æ‰¿å…³ç³» 123public class LinkedHashMap&lt;K,V&gt; extends HashMap&lt;K,V&gt; implements Map&lt;K,V&gt; LinkedHashMapæ˜¯HashMapçš„å­ç±»ï¼Œè‡ªç„¶LinkedHashMapä¹Ÿå°±ç»§æ‰¿äº†HashMapä¸­æ‰€æœ‰éžprivateçš„æ–¹æ³•ã€‚æ‰€ä»¥å®ƒå·²ç»ä»Ž HashMap é‚£é‡Œç»§æ‰¿äº†ä¸Žå“ˆå¸Œè¡¨ç›¸å…³çš„æ“ä½œäº†ï¼Œé‚£ä¹ˆåœ¨LinkedHashMapä¸­ï¼Œå®ƒå¯ä»¥ä¸“æ³¨äºŽé“¾è¡¨å®žçŽ°çš„é‚£éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸Žé“¾è¡¨å®žçŽ°ç›¸å…³çš„å±žæ€§å¦‚ä¸‹ã€‚ 3.2 å±žæ€§ä»‹ç» 1234567891011121314151617//LinkedHashMapçš„é“¾è¡¨èŠ‚ç‚¹ç»§æ‰¿äº†HashMapçš„èŠ‚ç‚¹ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†å‰æŒ‡é’ˆå’ŒåŽæŒ‡é’ˆï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123; Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125;//å¤´æŒ‡é’ˆtransient LinkedHashMap.Entry&lt;K,V&gt; head;//å°¾æŒ‡é’ˆtransient LinkedHashMap.Entry&lt;K,V&gt; tail;//é»˜è®¤ä¸ºfalseã€‚å½“ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºé“¾è¡¨ä¸­é”®å€¼å¯¹çš„é¡ºåºä¸Žæ¯ä¸ªé”®çš„æ’å…¥é¡ºåºä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´é‡å¤æ’å…¥é”®ï¼Œä¹Ÿä¼šæ›´æ–°é¡ºåº//ç®€å•æ¥è¯´ï¼Œä¸ºfalseæ—¶ï¼Œå°±æ˜¯ä¸Šé¢æ‰€æŒ‡çš„1ã€2ã€3ã€4çš„æƒ…å†µï¼›ä¸ºtrueæ—¶ï¼Œå°±æ˜¯1ã€3ã€4ã€2çš„æƒ…å†µfinal boolean accessOrder; äº”ã€æž„é€ æ–¹æ³• 1234public LinkedHashMap() &#123; super(); accessOrder = false;&#125; å…¶å®žå°±æ˜¯è°ƒç”¨çš„ HashMap çš„æž„é€ æ–¹æ³•: HashMap å®žçŽ°ï¼š 123456789101112131415public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; threshold = initialCapacity; //HashMap åªæ˜¯å®šä¹‰äº†æ”¹æ–¹æ³•ï¼Œå…·ä½“å®žçŽ°äº¤ç»™äº† LinkedHashMap init();&#125; å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ªç©ºçš„ init()ï¼Œå…·ä½“æ˜¯ç”± LinkedHashMap æ¥å®žçŽ°çš„ï¼š 12345@Overridevoid init() &#123; header = new Entry&lt;&gt;(-1, null, null, null); header.before = header.after = header;&#125; å…¶å®žä¹Ÿå°±æ˜¯å¯¹ header è¿›è¡Œäº†åˆå§‹åŒ–ã€‚ å…­ã€æ·»åŠ å…ƒç´  LinkedHashMapå¹¶æ²¡æœ‰é‡å†™ä»»ä½•putæ–¹æ³•ã€‚ä½†æ˜¯å…¶é‡å†™äº†æž„å»ºæ–°èŠ‚ç‚¹çš„newNode()æ–¹æ³•. newNode() ä¼šåœ¨HashMapçš„putVal() æ–¹æ³•é‡Œè¢«è°ƒç”¨ï¼ŒputVal() æ–¹æ³•ä¼šåœ¨æ‰¹é‡æ’å…¥æ•°æ®putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict) æˆ–è€…æ’å…¥å•ä¸ªæ•°æ®public V put(K key, V value)æ—¶è¢«è°ƒç”¨ã€‚ LinkedHashMapé‡å†™äº†newNode(),åœ¨æ¯æ¬¡æž„å»ºæ–°èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡linkNodeLast(p);å°†æ–°èŠ‚ç‚¹é“¾æŽ¥åœ¨å†…éƒ¨åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚ 12345678910111213141516171819//åœ¨æž„å»ºæ–°èŠ‚ç‚¹æ—¶ï¼Œæž„å»ºçš„æ˜¯`LinkedHashMap.Entry` ä¸å†æ˜¯`Node`.Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; e) &#123; LinkedHashMap.Entry&lt;K,V&gt; p = new LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e); linkNodeLast(p); return p;&#125;//å°†æ–°å¢žçš„èŠ‚ç‚¹ï¼Œè¿žæŽ¥åœ¨é“¾è¡¨çš„å°¾éƒ¨private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) &#123; LinkedHashMap.Entry&lt;K,V&gt; last = tail; tail = p; //é›†åˆä¹‹å‰æ˜¯ç©ºçš„ if (last == null) head = p; else &#123;//å°†æ–°èŠ‚ç‚¹è¿žæŽ¥åœ¨é“¾è¡¨çš„å°¾éƒ¨ p.before = last; last.after = p; &#125;&#125; ä»¥åŠHashMapä¸“é—¨é¢„ç•™ç»™LinkedHashMapçš„afterNodeAccess() ã€afterNodeInsertion() ã€afterNodeRemoval() æ–¹æ³•ã€‚ 1234// Callbacks to allow LinkedHashMap post-actionsvoid afterNodeAccess(Node&lt;K,V&gt; p) &#123; &#125;void afterNodeInsertion(boolean evict) &#123; &#125;void afterNodeRemoval(Node&lt;K,V&gt; p) &#123; &#125; å¦‚æžœä½ æ²¡æœ‰æ³¨æ„åˆ°æ³¨é‡Šçš„è§£é‡Šçš„è¯ï¼Œä½ å¯èƒ½ä¼šå¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆä¼šæœ‰ä¸‰ä¸ªç©ºæ–¹æ³•ï¼Œè€Œä¸”æœ‰ä¸å°‘åœ°æ–¹è¿˜è°ƒç”¨è¿‡å®ƒä»¬ã€‚å…¶å®žè¿™ä¸‰ä¸ªæ–¹æ³•è¡¨ç¤ºçš„æ˜¯åœ¨è®¿é—®ã€æ’å…¥ã€åˆ é™¤æŸä¸ªèŠ‚ç‚¹ä¹‹åŽï¼Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œå®ƒä»¬åœ¨LinkedHashMapæœ‰å„è‡ªçš„å®žçŽ°ã€‚LinkedHashMapæ­£æ˜¯é€šè¿‡é‡å†™è¿™ä¸‰ä¸ªæ–¹æ³•æ¥ä¿è¯é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤çš„æœ‰åºæ€§ã€‚ 123456789101112131415161718//å›žè°ƒå‡½æ•°ï¼Œæ–°èŠ‚ç‚¹æ’å…¥ä¹‹åŽå›žè°ƒ,åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ é™¤æœ€è€æ’å…¥çš„èŠ‚ç‚¹ã€‚//å¦‚æžœå®žçŽ°LruCacheä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³•ã€‚void afterNodeInsertion(boolean evict) &#123; // possibly remove eldest LinkedHashMap.Entry&lt;K,V&gt; first; //LinkedHashMap é»˜è®¤è¿”å›žfalse åˆ™ä¸åˆ é™¤èŠ‚ç‚¹ if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) &#123; K key = first.key; removeNode(hash(key), key, null, false, true); &#125;&#125;//LinkedHashMap é»˜è®¤è¿”å›žfalse åˆ™ä¸åˆ é™¤èŠ‚ç‚¹ã€‚ //è¿”å›žtrue ä»£è¡¨è¦åˆ é™¤æœ€æ—©çš„èŠ‚ç‚¹ã€‚//é€šå¸¸æž„å»ºä¸€ä¸ªLruCacheä¼šåœ¨è¾¾åˆ°Cacheçš„ä¸Šé™æ˜¯è¿”å›žtrueprotected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false;&#125; void afterNodeInsertion(boolean evict)ä»¥åŠboolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) æ˜¯æž„å»ºLruCacheéœ€è¦çš„å›žè°ƒï¼Œåœ¨è¿™å¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚ ä¸ƒã€åˆ é™¤å…ƒç´  LinkedHashMapä¹Ÿæ²¡æœ‰é‡å†™remove() æ–¹æ³•ï¼Œå› ä¸ºå®ƒçš„åˆ é™¤é€»è¾‘å’ŒHashMapå¹¶æ— åŒºåˆ«ã€‚ ä½†å®ƒé‡å†™äº†afterNodeRemoval() è¿™ä¸ªå›žè°ƒæ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šåœ¨Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) æ–¹æ³•ä¸­å›žè°ƒï¼ŒremoveNode() ä¼šåœ¨æ‰€æœ‰æ¶‰åŠåˆ°åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œä¸Šæ–‡åˆ†æžè¿‡ï¼Œæ˜¯åˆ é™¤èŠ‚ç‚¹æ“ä½œçš„çœŸæ­£æ‰§è¡Œè€…ã€‚ 1234567891011121314151617//åœ¨åˆ é™¤èŠ‚ç‚¹eæ—¶ï¼ŒåŒæ­¥å°†eä»ŽåŒå‘é“¾è¡¨ä¸Šåˆ é™¤void afterNodeRemoval(Node&lt;K,V&gt; e) &#123; // unlink LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; //å¾…åˆ é™¤èŠ‚ç‚¹ p çš„å‰ç½®åŽç½®èŠ‚ç‚¹éƒ½ç½®ç©º p.before = p.after = null; //å¦‚æžœå‰ç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™çŽ°åœ¨çš„å¤´ç»“ç‚¹åº”è¯¥æ˜¯åŽç½®èŠ‚ç‚¹a if (b == null) head = a; else//å¦åˆ™å°†å‰ç½®èŠ‚ç‚¹bçš„åŽç½®èŠ‚ç‚¹æŒ‡å‘a b.after = a; //åŒç†å¦‚æžœåŽç½®èŠ‚ç‚¹æ—¶null ï¼Œåˆ™å°¾èŠ‚ç‚¹åº”æ˜¯b if (a == null) tail = b; else//å¦åˆ™æ›´æ–°åŽç½®èŠ‚ç‚¹açš„å‰ç½®èŠ‚ç‚¹ä¸ºb a.before = b;&#125; å…«ã€æŸ¥è¯¢å…ƒç´  LinkedHashMapé‡å†™äº†get()å’ŒgetOrDefault() æ–¹æ³•ï¼š 12345678910111213141516public V get(Object key) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return null; if (accessOrder) afterNodeAccess(e); return e.value;&#125;public V getOrDefault(Object key, V defaultValue) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return defaultValue; if (accessOrder) afterNodeAccess(e); return e.value;&#125; å¯¹æ¯”HashMapä¸­çš„å®žçŽ°,LinkedHashMapåªæ˜¯å¢žåŠ äº†åœ¨æˆå‘˜å˜é‡(æž„é€ å‡½æ•°æ—¶èµ‹å€¼)accessOrderä¸ºtrueçš„æƒ…å†µä¸‹ï¼Œè¦åŽ»å›žè°ƒvoid afterNodeAccess(Node&lt;K,V&gt; e) å‡½æ•°ã€‚ 1234public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125; åœ¨afterNodeAccess() å‡½æ•°ä¸­ï¼Œä¼šå°†å½“å‰è¢«è®¿é—®åˆ°çš„èŠ‚ç‚¹eï¼Œç§»åŠ¨è‡³å†…éƒ¨çš„åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚ 12345678910111213141516171819202122232425262728293031void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last LinkedHashMap.Entry&lt;K,V&gt; last;//åŽŸå°¾èŠ‚ç‚¹ //å¦‚æžœaccessOrder æ˜¯true ï¼Œä¸”åŽŸå°¾èŠ‚ç‚¹ä¸ç­‰äºŽe if (accessOrder &amp;&amp; (last = tail) != e) &#123; //èŠ‚ç‚¹eå¼ºè½¬æˆåŒå‘é“¾è¡¨èŠ‚ç‚¹p LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; //pçŽ°åœ¨æ˜¯å°¾èŠ‚ç‚¹ï¼Œ åŽç½®èŠ‚ç‚¹ä¸€å®šæ˜¯null p.after = null; //å¦‚æžœpçš„å‰ç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™pä»¥å‰æ˜¯å¤´ç»“ç‚¹ï¼Œæ‰€ä»¥æ›´æ–°çŽ°åœ¨çš„å¤´ç»“ç‚¹æ˜¯pçš„åŽç½®èŠ‚ç‚¹a if (b == null) head = a; else//å¦åˆ™æ›´æ–°pçš„å‰ç›´æŽ¥ç‚¹bçš„åŽç½®èŠ‚ç‚¹ä¸º a b.after = a; //å¦‚æžœpçš„åŽç½®èŠ‚ç‚¹ä¸æ˜¯nullï¼Œåˆ™æ›´æ–°åŽç½®èŠ‚ç‚¹açš„å‰ç½®èŠ‚ç‚¹ä¸ºb if (a != null) a.before = b; else//å¦‚æžœåŽŸæœ¬pçš„åŽç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™på°±æ˜¯å°¾èŠ‚ç‚¹ã€‚ æ­¤æ—¶ æ›´æ–°lastçš„å¼•ç”¨ä¸º pçš„å‰ç½®èŠ‚ç‚¹b last = b; if (last == null) //åŽŸæœ¬å°¾èŠ‚ç‚¹æ˜¯null åˆ™ï¼Œé“¾è¡¨ä¸­å°±ä¸€ä¸ªèŠ‚ç‚¹ head = p; else &#123;//å¦åˆ™ æ›´æ–° å½“å‰èŠ‚ç‚¹pçš„å‰ç½®èŠ‚ç‚¹ä¸º åŽŸå°¾èŠ‚ç‚¹lastï¼Œ lastçš„åŽç½®èŠ‚ç‚¹æ˜¯p p.before = last; last.after = p; &#125; //å°¾èŠ‚ç‚¹çš„å¼•ç”¨èµ‹å€¼æˆp tail = p; //ä¿®æ”¹modCountã€‚ ++modCount; &#125;&#125; å›¾ç¤º(æ³¨æ„è¿™ä¸ªå›¾ï¼Œ1å’Œ6ä¹Ÿåº”è¯¥æ˜¯è¿žåœ¨ä¸€èµ·çš„ï¼Œå› ä¸ºæ˜¯åŒå‘å¾ªçŽ¯é“¾è¡¨ï¼Œæ‰€ä»¥è§†ä¸ºä¸€ä¸ªå°é”™è¯¯)ï¼š è¯´æ˜Žï¼šä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç»“ç‚¹3é“¾æŽ¥åˆ°äº†å°¾ç»“ç‚¹åŽé¢ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒafterNodeAccess() å‡½æ•°ä¸­ï¼Œä¼šä¿®æ”¹modCount,å› æ­¤å½“ä½ æ­£åœ¨accessOrder=trueçš„æ¨¡å¼ä¸‹,è¿­ä»£LinkedHashMapæ—¶ï¼Œå¦‚æžœåŒæ—¶æŸ¥è¯¢è®¿é—®æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´fail-fastï¼Œå› ä¸ºè¿­ä»£çš„é¡ºåºå·²ç»æ”¹å˜ã€‚ ä¹ã€åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ å®ƒé‡å†™äº†è¯¥æ–¹æ³•ï¼Œç›¸æ¯”HashMapçš„å®žçŽ°ï¼Œæ›´ä¸ºé«˜æ•ˆã€‚ 123456789public boolean containsValue(Object value) &#123; //éåŽ†ä¸€éé“¾è¡¨ï¼ŒåŽ»æ¯”è¾ƒæœ‰æ²¡æœ‰valueç›¸ç­‰çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›ž for (LinkedHashMap.Entry&lt;K,V&gt; e = head; e != null; e = e.after) &#123; V v = e.value; if (v == value || (value != null &amp;&amp; value.equals(v))) return true; &#125; return false;&#125; å¯¹æ¯”HashMapï¼Œæ˜¯ç”¨ä¸¤ä¸ªforå¾ªçŽ¯éåŽ†ï¼Œç›¸å¯¹ä½Žæ•ˆã€‚ 12345678910111213public boolean containsValue(Object value) &#123; Node&lt;K,V&gt;[] tab; V v; if ((tab = table) != null &amp;&amp; size &gt; 0) &#123; for (int i = 0; i &lt; tab.length; ++i) &#123; for (Node&lt;K,V&gt; e = tab[i]; e != null; e = e.next) &#123; if ((v = e.value) == value || (value != null &amp;&amp; value.equals(v))) return true; &#125; &#125; &#125; return false;&#125; åã€æ›¿æ¢æŸä¸ªå…ƒç´  1234567891011121314// ç”¨dstæ›¿æ¢srcprivate void transferLinks(LinkedHashMap.Entry&lt;K,V&gt; src, LinkedHashMap.Entry&lt;K,V&gt; dst) &#123; LinkedHashMap.Entry&lt;K,V&gt; b = dst.before = src.before; LinkedHashMap.Entry&lt;K,V&gt; a = dst.after = src.after; if (b == null) head = dst; else b.after = dst; if (a == null) tail = dst; else a.before = dst;&#125; åäºŒã€æ€»ç»“ LinkedHashMapç›¸å¯¹äºŽHashMapçš„æºç æ¯”ï¼Œæ˜¯å¾ˆç®€å•çš„ã€‚å› ä¸ºå¤§æ ‘åº•ä¸‹å¥½ä¹˜å‡‰ã€‚å®ƒç»§æ‰¿äº†HashMapï¼Œä»…é‡å†™äº†å‡ ä¸ªæ–¹æ³•ï¼Œä»¥æ”¹å˜å®ƒè¿­ä»£éåŽ†æ—¶çš„é¡ºåºã€‚è¿™ä¹Ÿæ˜¯å…¶ä¸ŽHashMapç›¸æ¯”æœ€å¤§çš„ä¸åŒã€‚ åœ¨æ¯æ¬¡æ’å…¥æ•°æ®ï¼Œæˆ–è€…è®¿é—®ã€ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¼šå¢žåŠ èŠ‚ç‚¹ã€æˆ–è°ƒæ•´é“¾è¡¨çš„èŠ‚ç‚¹é¡ºåºã€‚ä»¥å†³å®šè¿­ä»£æ—¶è¾“å‡ºçš„é¡ºåºã€‚ accessOrderé»˜è®¤æ˜¯falseï¼Œåˆ™è¿­ä»£æ—¶è¾“å‡ºçš„é¡ºåºæ˜¯æ’å…¥èŠ‚ç‚¹çš„é¡ºåºã€‚è‹¥ä¸ºtrueï¼Œåˆ™è¾“å‡ºçš„é¡ºåºæ˜¯æŒ‰ç…§è®¿é—®èŠ‚ç‚¹çš„é¡ºåºã€‚ä¸ºtrueæ—¶ï¼Œå¯ä»¥åœ¨è¿™åŸºç¡€ä¹‹ä¸Šæž„å»ºä¸€ä¸ªLruCache. LinkedHashMapå¹¶æ²¡æœ‰é‡å†™ä»»ä½•putæ–¹æ³•ã€‚ä½†æ˜¯å…¶é‡å†™äº†æž„å»ºæ–°èŠ‚ç‚¹çš„newNode()æ–¹æ³•.åœ¨æ¯æ¬¡æž„å»ºæ–°èŠ‚ç‚¹æ—¶ï¼Œå°†æ–°èŠ‚ç‚¹é“¾æŽ¥åœ¨å†…éƒ¨åŒå‘é“¾è¡¨çš„å°¾éƒ¨ accessOrder=trueçš„æ¨¡å¼ä¸‹,åœ¨afterNodeAccess()å‡½æ•°ä¸­ï¼Œä¼šå°†å½“å‰è¢«è®¿é—®åˆ°çš„èŠ‚ç‚¹eï¼Œç§»åŠ¨è‡³å†…éƒ¨çš„åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒafterNodeAccess()å‡½æ•°ä¸­ï¼Œä¼šä¿®æ”¹modCount,å› æ­¤å½“ä½ æ­£åœ¨accessOrder=trueçš„æ¨¡å¼ä¸‹,è¿­ä»£LinkedHashMapæ—¶ï¼Œå¦‚æžœåŒæ—¶æŸ¥è¯¢è®¿é—®æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´fail-fastï¼Œå› ä¸ºè¿­ä»£çš„é¡ºåºå·²ç»æ”¹å˜ã€‚ nextNode() å°±æ˜¯è¿­ä»£å™¨é‡Œçš„next()æ–¹æ³• ã€‚è¯¥æ–¹æ³•çš„å®žçŽ°å¯ä»¥çœ‹å‡ºï¼Œè¿­ä»£LinkedHashMapï¼Œå°±æ˜¯ä»Žå†…éƒ¨ç»´æŠ¤çš„åŒé“¾è¡¨çš„è¡¨å¤´å¼€å§‹å¾ªçŽ¯è¾“å‡ºã€‚ è€ŒåŒé“¾è¡¨èŠ‚ç‚¹çš„é¡ºåºåœ¨LinkedHashMapçš„å¢žã€åˆ ã€æ”¹ã€æŸ¥æ—¶éƒ½ä¼šæ›´æ–°ã€‚ä»¥æ»¡è¶³æŒ‰ç…§æ’å…¥é¡ºåºè¾“å‡ºï¼Œè¿˜æ˜¯è®¿é—®é¡ºåºè¾“å‡ºã€‚ å®ƒä¸ŽHashMapæ¯”ï¼Œè¿˜æœ‰ä¸€ä¸ªå°å°çš„ä¼˜åŒ–ï¼Œé‡å†™äº†containsValue()æ–¹æ³•ï¼Œç›´æŽ¥éåŽ†å†…éƒ¨é“¾è¡¨åŽ»æ¯”å¯¹valueå€¼æ˜¯å¦ç›¸ç­‰ã€‚ æ•´ç†è‡ªï¼š http://blog.csdn.net/zxt0601/article/details/77429150 http://wiki.jikexueyuan.com/project/java-collection/linkedhashmap.html http://blog.csdn.net/u013124587/article/details/52659741 http://www.cnblogs.com/leesf456/p/5248868.html]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashSet]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F6.HashSet%2F</url>
    <content type="text"><![CDATA[HashSet æ˜¯ä¸€ä¸ªä¸å…è®¸å­˜å‚¨é‡å¤å…ƒç´ çš„é›†åˆï¼Œå®ƒæ˜¯åŸºäºŽ HashMap å®žçŽ°çš„ï¼Œ HashSet åº•å±‚ä½¿ç”¨ HashMap æ¥ä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œå› æ­¤ HashSet çš„å®žçŽ°æ¯”è¾ƒç®€å•ï¼Œç›¸å…³ HashSet çš„æ“ä½œï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç›´æŽ¥è°ƒç”¨åº•å±‚ HashMap çš„ç›¸å…³æ–¹æ³•æ¥å®Œæˆã€‚æ‰€ä»¥åªè¦ç†è§£äº† HashMapï¼ŒHashSet å°±æ°´åˆ°æ¸ æˆäº†ã€‚ æˆå‘˜å˜é‡ é¦–å…ˆäº†è§£ä¸‹HashSetçš„æˆå‘˜å˜é‡: 1234private transient HashMap&lt;E,Object&gt; map;// Dummy value to associate with an Object in the backing Mapprivate static final Object PRESENT = new Object(); å‘çŽ°ä¸»è¦å°±ä¸¤ä¸ªå˜é‡: map ï¼šç”¨äºŽå­˜æ”¾æœ€ç»ˆæ•°æ®çš„ã€‚ PRESENT ï¼šæ˜¯æ‰€æœ‰å†™å…¥mapçš„valueå€¼ã€‚ æž„é€ æ–¹æ³• 1234567public HashSet() &#123; map = new HashMap&lt;&gt;();&#125;public HashSet(int initialCapacity, float loadFactor) &#123; map = new HashMap&lt;&gt;(initialCapacity, loadFactor);&#125; æž„é€ å‡½æ•°å¾ˆç®€å•ï¼Œåˆ©ç”¨äº†HashMapåˆå§‹åŒ–äº†mapã€‚ add 123public boolean add(E e) &#123; return map.put(e, PRESENT)==null;&#125; æ¯”è¾ƒå…³é”®çš„å°±æ˜¯è¿™ä¸ª add() æ–¹æ³•ã€‚ å¯ä»¥çœ‹å‡ºå®ƒæ˜¯å°†å­˜æ”¾çš„å¯¹è±¡å½“åšäº† HashMap çš„å¥ï¼Œvalue éƒ½æ˜¯ç›¸åŒçš„ PRESENT ã€‚ç”±äºŽ HashMap çš„ key æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œæ‰€ä»¥æ¯å½“æœ‰é‡å¤çš„å€¼å†™å…¥åˆ° HashSet æ—¶ï¼Œvalue ä¼šè¢«è¦†ç›–ï¼Œä½† key ä¸ä¼šå—åˆ°å½±å“ï¼Œè¿™æ ·å°±ä¿è¯äº† HashSet ä¸­åªèƒ½å­˜æ”¾ä¸é‡å¤çš„å…ƒç´ ã€‚ è¯¥æ–¹æ³•å¦‚æžœæ·»åŠ çš„æ˜¯åœ¨ HashSet ä¸­ä¸å­˜åœ¨çš„ï¼Œåˆ™è¿”å›ž trueï¼›å¦‚æžœæ·»åŠ çš„å…ƒç´ å·²ç»å­˜åœ¨ï¼Œè¿”å›ž falseã€‚å…¶åŽŸå› åœ¨äºŽæˆ‘ä»¬ä¹‹å‰æåˆ°çš„å…³äºŽ HashMap çš„ put æ–¹æ³•ã€‚è¯¥æ–¹æ³•åœ¨æ·»åŠ  key ä¸é‡å¤çš„é”®å€¼å¯¹çš„æ—¶å€™ï¼Œä¼šè¿”å›ž nullã€‚ æ€»ç»“ HashSet çš„åŽŸç†æ¯”è¾ƒç®€å•ï¼Œå‡ ä¹Žå…¨éƒ¨å€ŸåŠ©äºŽ HashMap æ¥å®žçŽ°çš„ã€‚ æ‰€ä»¥ HashMap ä¼šå‡ºçŽ°çš„é—®é¢˜ HashSet ä¾ç„¶ä¸èƒ½é¿å…ã€‚ å¯¹äºŽ HashSet ä¸­ä¿å­˜çš„å¯¹è±¡ï¼Œè¯·æ³¨æ„æ­£ç¡®é‡å†™å…¶ equals å’Œ hashCode æ–¹æ³•ï¼Œä»¥ä¿è¯æ”¾å…¥çš„å¯¹è±¡çš„å”¯ä¸€æ€§ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMap]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F5.HashMap%2F</url>
    <content type="text"><![CDATA[HashMapåŸºæœ¬æ˜¯é¢è¯•å¿…é—®çš„ç‚¹ï¼Œå› ä¸ºè¿™ä¸ªæ•°æ®ç»“æž„ç”¨çš„å¤ªé¢‘ç¹äº†ï¼Œjdk1.8ä¸­çš„ä¼˜åŒ–ä¹Ÿæ˜¯æ¯”è¾ƒå·§å¦™ã€‚æœ‰å¿…è¦åŽ»æ·±å…¥æŽ¢è®¨ä¸€ä¸‹ã€‚ä½†æ˜¯æ¶‰åŠçš„å†…å®¹æ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªå…ˆæŽ¢è®¨jdk8ä¸­HashMapçš„å®žçŽ°ï¼Œè‡³äºŽjdk7ä¸­HashMapçš„æ­»å¾ªçŽ¯é—®é¢˜ã€çº¢é»‘æ ‘çš„åŽŸç†ç­‰éƒ½ä¸ä¼šåœ¨æœ¬ç¯‡æ–‡ç« æ‰©å±•åˆ°ã€‚å…¶ä»–çš„æ–‡ç« å°†ä¼šå†åŽ»æŽ¢è®¨æ•´ç†ã€‚ æœ¬ç¯‡æ–‡ç« è¾ƒé•¿ï¼Œé«˜èƒ½é¢„è­¦ã€‚ ä¸€ã€å‰è¨€ ä¹‹å‰çš„Listï¼Œè®²äº†ArrayListã€LinkedListï¼Œæœ€åŽè®²åˆ°äº†CopyOnWriteArrayListï¼Œå°±å‰ä¸¤è€…è€Œè¨€ï¼Œåæ˜ çš„æ˜¯ä¸¤ç§æ€æƒ³ï¼š ï¼ˆ1ï¼‰ArrayListä»¥æ•°ç»„å½¢å¼å®žçŽ°ï¼Œé¡ºåºæ’å…¥ã€æŸ¥æ‰¾å¿«ï¼Œæ’å…¥ã€åˆ é™¤è¾ƒæ…¢ ï¼ˆ2ï¼‰LinkedListä»¥é“¾è¡¨å½¢å¼å®žçŽ°ï¼Œé¡ºåºæ’å…¥ã€æŸ¥æ‰¾è¾ƒæ…¢ï¼Œæ’å…¥ã€åˆ é™¤æ–¹ä¾¿ é‚£ä¹ˆæ˜¯å¦æœ‰ä¸€ç§æ•°æ®ç»“æž„èƒ½å¤Ÿç»“åˆä¸Šé¢ä¸¤ç§çš„ä¼˜ç‚¹å‘¢ï¼Ÿæœ‰ï¼Œç­”æ¡ˆå°±æ˜¯HashMapã€‚ HashMapæ˜¯ä¸€ç§éžå¸¸å¸¸è§ã€æ–¹ä¾¿å’Œæœ‰ç”¨çš„é›†åˆï¼Œæ˜¯ä¸€ç§é”®å€¼å¯¹ï¼ˆK-Vï¼‰å½¢å¼çš„å­˜å‚¨ç»“æž„ï¼Œåœ¨æœ‰äº†HashCodeçš„åŸºç¡€åŽï¼Œä¸‹é¢å°†è¿˜æ˜¯ç”¨å›¾ç¤ºçš„æ–¹å¼è§£è¯»HashMapçš„å®žçŽ°åŽŸç†ã€‚ Javaä¸ºæ•°æ®ç»“æž„ä¸­çš„æ˜ å°„å®šä¹‰äº†ä¸€ä¸ªæŽ¥å£java.util.Mapï¼Œæ­¤æŽ¥å£ä¸»è¦æœ‰å››ä¸ªå¸¸ç”¨çš„å®žçŽ°ç±»ï¼Œåˆ†åˆ«æ˜¯HashMapã€Hashtableã€LinkedHashMapå’ŒTreeMapï¼Œç±»ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š (1) HashMapï¼šå®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æŽ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éåŽ†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚HashMapéžçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æžœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚ (2) Hashtableï¼šHashtableæ˜¯é—ç•™ç±»ï¼Œå¾ˆå¤šæ˜ å°„çš„å¸¸ç”¨åŠŸèƒ½ä¸ŽHashMapç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ‰¿è‡ªDictionaryç±»ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»»ä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™Hashtableï¼Œå¹¶å‘æ€§ä¸å¦‚ConcurrentHashMapï¼Œå› ä¸ºConcurrentHashMapå¼•å…¥äº†åˆ†æ®µé”ã€‚Hashtableä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨HashMapæ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ConcurrentHashMapæ›¿æ¢ã€‚ (3) LinkedHashMapï¼šLinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ç”¨IteratoréåŽ†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æž„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæŽ’åºã€‚ (4) TreeMapï¼šTreeMapå®žçŽ°SortedMapæŽ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æŽ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæŽ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæŽ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨IteratoréåŽ†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æŽ’è¿‡åºçš„ã€‚å¦‚æžœä½¿ç”¨æŽ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®žçŽ°ComparableæŽ¥å£æˆ–è€…åœ¨æž„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»åž‹çš„å¼‚å¸¸ã€‚ å¯¹äºŽä¸Šè¿°å››ç§Mapç±»åž‹çš„ç±»ï¼Œè¦æ±‚æ˜ å°„ä¸­çš„keyæ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡æ˜¯è¯¥å¯¹è±¡åœ¨åˆ›å»ºåŽå®ƒçš„å“ˆå¸Œå€¼ä¸ä¼šè¢«æ”¹å˜ã€‚å¦‚æžœå¯¹è±¡çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–ï¼ŒMapå¯¹è±¡å¾ˆå¯èƒ½å°±å®šä½ä¸åˆ°æ˜ å°„çš„ä½ç½®äº†ã€‚ äºŒã€HashMapçš„ç»“æž„ å…¶ä¸­å“ˆå¸Œè¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬ç»å¸¸æŠŠæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ç§°ä¸ºä¸€ä¸ªæ¡¶ï¼Œå“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”¨æ¥å­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹ã€‚ åœ¨æ’å…¥å…ƒç´ æ—¶ï¼Œå¦‚æžœå‘ç”Ÿå†²çªï¼ˆå³å¤šä¸ªé”®å€¼å¯¹æ˜ å°„åˆ°åŒä¸€ä¸ªæ¡¶ä¸Šï¼‰çš„è¯ï¼Œå°±ä¼šé€šè¿‡é“¾è¡¨çš„å½¢å¼æ¥è§£å†³å†²çªã€‚ å› ä¸ºä¸€ä¸ªæ¡¶ä¸Šå¯èƒ½å­˜åœ¨å¤šä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥åœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œä¼šå…ˆé€šè¿‡keyçš„å“ˆå¸Œå€¼å…ˆå®šä½åˆ°æ¡¶ï¼Œå†éåŽ†æ¡¶ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œæ‰¾å‡ºkeyç›¸ç­‰çš„é”®å€¼å¯¹ï¼Œä»Žè€Œæ¥èŽ·å–valueã€‚ å¦‚å›¾æ‰€ç¤ºï¼ŒHashMap åº•å±‚æ˜¯åŸºäºŽæ•°ç»„å’Œé“¾è¡¨å®žçŽ°çš„ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼š å®¹é‡ è´Ÿè½½å› å­ å®¹é‡çš„é»˜è®¤å¤§å°æ˜¯ 16ï¼Œè´Ÿè½½å› å­æ˜¯ 0.75ï¼Œå½“ HashMap çš„ size &gt; 16*0.75 æ—¶å°±ä¼šå‘ç”Ÿæ‰©å®¹(å®¹é‡å’Œè´Ÿè½½å› å­éƒ½å¯ä»¥è‡ªç”±è°ƒæ•´)ã€‚ ä¸‰ã€ç»§æ‰¿å…³ç³» 12public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable è¯´æ˜Žï¼š HashMapç»§æ‰¿è‡ªAbstractMapï¼ŒAbstractMapæ˜¯MapæŽ¥å£çš„éª¨å¹²å®žçŽ°ï¼ŒAbstractMapä¸­å®žçŽ°äº†Mapä¸­æœ€é‡è¦æœ€å¸¸ç”¨å’Œæ–¹æ³•ï¼Œè¿™æ ·HashMapç»§æ‰¿AbstractMapå°±ä¸éœ€è¦å®žçŽ°Mapçš„æ‰€æœ‰æ–¹æ³•ï¼Œè®©HashMapå‡å°‘äº†å¤§é‡çš„å·¥ä½œã€‚ å››ã€å±žæ€§ 123456789101112131415161718192021222324252627//é»˜è®¤çš„åˆå§‹å®¹é‡ä¸º16static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16//æœ€å¤§çš„å®¹é‡ä¸Šé™ä¸º2^30static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;//é»˜è®¤çš„è´Ÿè½½å› å­ä¸º0.75static final float DEFAULT_LOAD_FACTOR = 0.75f;//å˜æˆæ ‘åž‹ç»“æž„çš„ä¸´ç•Œå€¼ä¸º8static final int TREEIFY_THRESHOLD = 8;//æ¢å¤é“¾å¼ç»“æž„çš„ä¸´ç•Œå€¼ä¸º6static final int UNTREEIFY_THRESHOLD = 6;/** * å“ˆå¸Œè¡¨çš„æœ€å°æ ‘å½¢åŒ–å®¹é‡ * å½“å“ˆå¸Œè¡¨ä¸­çš„å®¹é‡å¤§äºŽè¿™ä¸ªå€¼æ—¶ï¼Œè¡¨ä¸­çš„æ¡¶æ‰èƒ½è¿›è¡Œæ ‘å½¢åŒ– * å¦åˆ™æ¡¶å†…å…ƒç´ å¤ªå¤šæ—¶ä¼šæ‰©å®¹ï¼Œè€Œä¸æ˜¯æ ‘å½¢åŒ– * ä¸ºäº†é¿å…è¿›è¡Œæ‰©å®¹ã€æ ‘å½¢åŒ–é€‰æ‹©çš„å†²çªï¼Œè¿™ä¸ªå€¼ä¸èƒ½å°äºŽ 4 * TREEIFY_THRESHOLD */static final int MIN_TREEIFY_CAPACITY = 64;//å“ˆå¸Œè¡¨transient Node&lt;K,V&gt;[] table;//å“ˆå¸Œè¡¨ä¸­é”®å€¼å¯¹çš„ä¸ªæ•°transient int size;//å“ˆå¸Œè¡¨è¢«ä¿®æ”¹çš„æ¬¡æ•°transient int modCount;//å®ƒæ˜¯é€šè¿‡capacity*load factorè®¡ç®—å‡ºæ¥çš„ï¼Œå½“sizeåˆ°è¾¾è¿™ä¸ªå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹æ“ä½œint threshold;//è´Ÿè½½å› å­final float loadFactor; 4.1 å‡ ä¸ªå±žæ€§çš„è¯¦ç»†è¯´æ˜Ž 1234int threshold; // æ‰€èƒ½å®¹çº³çš„key-valueå¯¹æžé™ final float loadFactor; // è´Ÿè½½å› å­int modCount; int size; é¦–å…ˆï¼ŒNode[] tableçš„åˆå§‹åŒ–é•¿åº¦length(é»˜è®¤å€¼æ˜¯16)ï¼ŒLoad factorä¸ºè´Ÿè½½å› å­(é»˜è®¤å€¼æ˜¯0.75)ï¼Œthresholdæ˜¯HashMapæ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®é‡çš„Node(é”®å€¼å¯¹)ä¸ªæ•°ã€‚threshold = length * Load factorã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•°ç»„å®šä¹‰å¥½é•¿åº¦ä¹‹åŽï¼Œè´Ÿè½½å› å­è¶Šå¤§ï¼Œæ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹ä¸ªæ•°è¶Šå¤šã€‚ ç»“åˆè´Ÿè½½å› å­çš„å®šä¹‰å…¬å¼å¯çŸ¥ï¼Œthresholdå°±æ˜¯åœ¨æ­¤Load factorå’Œlength(æ•°ç»„é•¿åº¦)å¯¹åº”ä¸‹å…è®¸çš„æœ€å¤§å…ƒç´ æ•°ç›®ï¼Œè¶…è¿‡è¿™ä¸ªæ•°ç›®å°±é‡æ–°resize(æ‰©å®¹)ï¼Œæ‰©å®¹åŽçš„HashMapå®¹é‡æ˜¯ä¹‹å‰å®¹é‡çš„ä¸¤å€ï¼ˆä¸ºä»€ä¹ˆæ˜¯ä¸¤å€ä¸‹æ–‡ä¼šè¯´æ˜Žï¼‰ã€‚ é»˜è®¤çš„è´Ÿè½½å› å­0.75æ˜¯å¯¹ç©ºé—´å’Œæ—¶é—´æ•ˆçŽ‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ï¼Œå»ºè®®å¤§å®¶ä¸è¦ä¿®æ”¹ï¼Œé™¤éžåœ¨æ—¶é—´å’Œç©ºé—´æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå¦‚æžœå†…å­˜ç©ºé—´å¾ˆå¤šè€Œåˆå¯¹æ—¶é—´æ•ˆçŽ‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½Žè´Ÿè½½å› å­`Load factor`çš„å€¼ï¼›ç›¸åï¼Œå¦‚æžœå†…å­˜ç©ºé—´ç´§å¼ è€Œå¯¹æ—¶é—´æ•ˆçŽ‡è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢žåŠ è´Ÿè½½å› å­`loadFactor`çš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥å¤§äºŽ1ã€‚ sizeè¿™ä¸ªå­—æ®µå…¶å®žå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯HashMapä¸­å®žé™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡ã€‚æ³¨æ„sizeå’Œtableçš„é•¿åº¦lengthã€å®¹çº³æœ€å¤§é”®å€¼å¯¹æ•°é‡thresholdçš„åŒºåˆ«ã€‚ è€ŒmodCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æž„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼Œä¸»è¦ç”¨äºŽè¿­ä»£çš„å¿«é€Ÿå¤±è´¥ã€‚å¼ºè°ƒä¸€ç‚¹ï¼Œå†…éƒ¨ç»“æž„å‘ç”Ÿå˜åŒ–æŒ‡çš„æ˜¯ç»“æž„å‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚putæ–°é”®å€¼å¯¹ï¼Œä½†æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼è¢«è¦†ç›–ä¸å±žäºŽç»“æž„å˜åŒ–ã€‚ åœ¨HashMapä¸­ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„tableçš„é•¿åº¦lengthå¤§å°å¿…é¡»ä¸º2çš„næ¬¡æ–¹(ä¸€å®šæ˜¯åˆæ•°)ï¼Œè¿™æ˜¯ä¸€ç§éžå¸¸è§„çš„è®¾è®¡ï¼Œå› ä¸ºå¸¸è§„çš„è®¾è®¡æ˜¯æŠŠæ¡¶çš„å¤§å°è®¾è®¡ä¸ºç´ æ•°ã€‚ç›¸å¯¹æ¥è¯´ç´ æ•°å¯¼è‡´å†²çªçš„æ¦‚çŽ‡è¦å°äºŽåˆæ•°ï¼Œå…·ä½“è¯æ˜Žå¯ä»¥å‚è€ƒ http://blog.csdn.net/liuqiyao_01/article/details/14475159 ï¼ŒHashtableåˆå§‹åŒ–æ¡¶å¤§å°ä¸º11ï¼Œå°±æ˜¯æ¡¶å¤§å°è®¾è®¡ä¸ºç´ æ•°çš„åº”ç”¨ï¼ˆHashtableæ‰©å®¹åŽä¸èƒ½ä¿è¯è¿˜æ˜¯ç´ æ•°ï¼‰ã€‚HashMapé‡‡ç”¨è¿™ç§éžå¸¸è§„è®¾è®¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨å–æ¨¡å’Œæ‰©å®¹æ—¶åšä¼˜åŒ–ï¼ŒåŒæ—¶ä¸ºäº†å‡å°‘å†²çªï¼ŒHashMapå®šä½å“ˆå¸Œæ¡¶ç´¢å¼•ä½ç½®æ—¶ï¼Œä¹ŸåŠ å…¥äº†é«˜ä½å‚ä¸Žè¿ç®—çš„è¿‡ç¨‹ã€‚ä¸‹æ–‡ä¼šè¯´æ˜Žã€‚ è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿è´Ÿè½½å› å­å’ŒHashç®—æ³•è®¾è®¡çš„å†åˆç†ï¼Œä¹Ÿå…ä¸äº†ä¼šå‡ºçŽ°æ‹‰é“¾è¿‡é•¿çš„æƒ…å†µï¼Œä¸€æ—¦å‡ºçŽ°æ‹‰é“¾è¿‡é•¿ï¼Œåˆ™ä¼šä¸¥é‡å½±å“HashMapçš„æ€§èƒ½ã€‚äºŽæ˜¯ï¼Œåœ¨JDK1.8ç‰ˆæœ¬ä¸­ï¼Œå¯¹æ•°æ®ç»“æž„åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº†çº¢é»‘æ ‘ã€‚è€Œå½“é“¾è¡¨é•¿åº¦å¤ªé•¿ï¼ˆé»˜è®¤è¶…è¿‡8ï¼‰æ—¶ï¼Œå¹¶ä¸”é“¾è¡¨çš„é•¿åº¦è¶…è¿‡64æ—¶ï¼Œé“¾è¡¨å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåˆ©ç”¨çº¢é»‘æ ‘å¿«é€Ÿå¢žåˆ æ”¹æŸ¥çš„ç‰¹ç‚¹æé«˜HashMapçš„æ€§èƒ½ï¼Œå…¶ä¸­ä¼šç”¨åˆ°çº¢é»‘æ ‘çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰ç®—æ³•ã€‚ è¿™é‡Œç€é‡æä¸€ä¸‹MIN_TREEIFY_CAPACITYå­—æ®µï¼Œå®¹æ˜“ä¸ŽTREEIFY_THRESHOLDæ‰“æž¶ï¼ŒTREEIFY_THRESHOLDæ˜¯æŒ‡æ¡¶ä¸­å…ƒç´ è¾¾åˆ°8ä¸ªï¼Œå°±å°†å…¶æœ¬æ¥çš„é“¾è¡¨ç»“æž„æ”¹ä¸ºçº¢é»‘æ ‘ï¼Œæé«˜æŸ¥è¯¢çš„æ•ˆçŽ‡ã€‚MIN_TREEIFY_CAPACITYæ˜¯æŒ‡æœ€å°æ ‘åŒ–çš„å“ˆå¸Œè¡¨å…ƒç´ ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°äºŽè¿™ä¸ªå€¼ï¼Œå°±ç®—ä½ (æ•°ç»„)æ¡¶é‡Œçš„å…ƒç´ æ•°é‡å¤§äºŽ8äº†ï¼Œè¿˜æ˜¯è¦ç”¨é“¾è¡¨å­˜å‚¨ï¼Œåªæœ‰åŒæ—¶æ»¡è¶³ï¼šè¡¨ä¸­æ•°æ®å®¹é‡å·²ç»æ‰©å®¹åˆ°MIN_TREEIFY_CAPACITYè¿™ä¸ªé•¿åº¦ï¼Œå¹¶ä¸”æ¡¶é‡Œçš„æ•°æ®ä¸ªæ•°è¾¾åˆ°8ä¸ªçš„æ—¶å€™ï¼Œæ‰ä¼šå°†è¯¥æ¡¶é‡Œçš„ç»“æž„è¿›è¡Œæ ‘åŒ–ã€‚æ³¨æ„æ‰©å®¹æ˜¯æ•°ç»„çš„å¤åˆ¶ã€‚ 4.2 Nodeç»“æž„ 1234567891011121314static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; //ç”¨æ¥å®šä½æ•°ç»„ç´¢å¼•ä½ç½® final K key; V value; Node&lt;K,V&gt; next; //é“¾è¡¨çš„ä¸‹ä¸€ä¸ªnode Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; ... &#125; public final K getKey()&#123; ... &#125; public final V getValue() &#123; ... &#125; public final String toString() &#123; ... &#125; public final int hashCode() &#123; ... &#125; public final V setValue(V newValue) &#123; ... &#125; public final boolean equals(Object o) &#123; ... &#125;&#125; Nodeæ˜¯HashMapçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®žçŽ°äº†Map.EntryæŽ¥å£ï¼Œæœ¬è´¨æ˜¯å°±æ˜¯ä¸€ä¸ªæ˜ å°„(é”®å€¼å¯¹)ã€‚ä¸Šå›¾ä¸­çš„æ¯ä¸ªé»‘è‰²åœ†ç‚¹å°±æ˜¯ä¸€ä¸ªNodeå¯¹è±¡ã€‚ ä¾‹å¦‚ç¨‹åºæ‰§è¡Œä¸‹é¢ä»£ç ï¼š 1map.put("ç¾Žå›¢","å°ç¾Ž"); ç³»ç»Ÿå°†è°ƒç”¨&quot;ç¾Žå›¢&quot;è¿™ä¸ªkeyçš„hashCode()æ–¹æ³•å¾—åˆ°å…¶hashCodeå€¼ï¼ˆè¯¥æ–¹æ³•é€‚ç”¨äºŽæ¯ä¸ªJavaå¯¹è±¡ï¼‰ã€‚ ç„¶åŽå†é€šè¿‡Hashç®—æ³•æ¥å®šä½è¯¥é”®å€¼å¯¹çš„å­˜å‚¨ä½ç½®ï¼Œæœ‰æ—¶ä¸¤ä¸ªkeyä¼šå®šä½åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†Hashç¢°æ’žã€‚ å½“ç„¶Hashç®—æ³•è®¡ç®—ç»“æžœè¶Šåˆ†æ•£å‡åŒ€ï¼ŒHashç¢°æ’žçš„æ¦‚çŽ‡å°±è¶Šå°ï¼Œmapçš„å­˜å–æ•ˆçŽ‡å°±ä¼šè¶Šé«˜ã€‚ å¦‚æžœå“ˆå¸Œæ¡¶æ•°ç»„å¾ˆå¤§ï¼Œå³ä½¿è¾ƒå·®çš„Hashç®—æ³•ä¹Ÿä¼šæ¯”è¾ƒåˆ†æ•£ï¼Œå¦‚æžœå“ˆå¸Œæ¡¶æ•°ç»„æ•°ç»„å¾ˆå°ï¼Œå³ä½¿å¥½çš„Hashç®—æ³•ä¹Ÿä¼šå‡ºçŽ°è¾ƒå¤šç¢°æ’žï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ç©ºé—´æˆæœ¬å’Œæ—¶é—´æˆæœ¬ä¹‹é—´æƒè¡¡ï¼Œå…¶å®žå°±æ˜¯åœ¨æ ¹æ®å®žé™…æƒ…å†µç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡å¥½çš„hashç®—æ³•å‡å°‘Hashç¢°æ’žã€‚ é‚£ä¹ˆé€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥æŽ§åˆ¶mapä½¿å¾—Hashç¢°æ’žçš„æ¦‚çŽ‡åˆå°ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„ï¼ˆNode[] tableï¼‰å ç”¨ç©ºé—´åˆå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¥½çš„Hashç®—æ³•(5.4èŠ‚)å’Œæ‰©å®¹æœºåˆ¶(5.5èŠ‚)ã€‚ä¸‹æ–‡ä¼šè®²åˆ°ã€‚ äº”ã€æ–¹æ³• 5.1 getæ–¹æ³• 123456789101112131415161718192021222324252627282930//getæ–¹æ³•ä¸»è¦è°ƒç”¨çš„æ˜¯getNodeæ–¹æ³•ï¼Œæ‰€ä»¥é‡ç‚¹è¦çœ‹getNodeæ–¹æ³•çš„å®žçŽ°public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; //å¦‚æžœå“ˆå¸Œè¡¨ä¸ä¸ºç©º &amp;&amp; keyå¯¹åº”çš„æ¡¶ä¸Šä¸ä¸ºç©º if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; //æ˜¯å¦ç›´æŽ¥å‘½ä¸­ if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; //åˆ¤æ–­æ˜¯å¦æœ‰åŽç»­èŠ‚ç‚¹ if ((e = first.next) != null) &#123; //å¦‚æžœå½“å‰çš„æ¡¶æ˜¯é‡‡ç”¨çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„getæ–¹æ³•åŽ»èŽ·å–èŠ‚ç‚¹ if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); //ä¸æ˜¯çº¢é»‘æ ‘çš„è¯ï¼Œé‚£å°±æ˜¯ä¼ ç»Ÿçš„é“¾å¼ç»“æž„äº†ï¼Œé€šè¿‡å¾ªçŽ¯çš„æ–¹æ³•åˆ¤æ–­é“¾ä¸­æ˜¯å¦å­˜åœ¨è¯¥key do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; å®žçŽ°æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š é€šè¿‡hashå€¼èŽ·å–è¯¥keyæ˜ å°„åˆ°çš„æ¡¶ã€‚ æ¡¶ä¸Šçš„keyå°±æ˜¯è¦æŸ¥æ‰¾çš„keyï¼Œåˆ™ç›´æŽ¥å‘½ä¸­ã€‚ æ¡¶ä¸Šçš„keyä¸æ˜¯è¦æŸ¥æ‰¾çš„keyï¼Œåˆ™æŸ¥çœ‹åŽç»­èŠ‚ç‚¹ï¼š å¦‚æžœåŽç»­èŠ‚ç‚¹æ˜¯æ ‘èŠ‚ç‚¹ï¼Œé€šè¿‡è°ƒç”¨æ ‘çš„æ–¹æ³•æŸ¥æ‰¾è¯¥keyã€‚ å¦‚æžœåŽç»­èŠ‚ç‚¹æ˜¯é“¾å¼èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡å¾ªçŽ¯éåŽ†é“¾æŸ¥æ‰¾è¯¥keyã€‚ 5.2 putæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960//putæ–¹æ³•çš„å…·ä½“å®žçŽ°ä¹Ÿæ˜¯åœ¨putValæ–¹æ³•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹é¢çš„putValæ–¹æ³•public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125;final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; //å¦‚æžœå“ˆå¸Œè¡¨ä¸ºç©ºï¼Œåˆ™å…ˆåˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; //å¦‚æžœå½“å‰æ¡¶æ²¡æœ‰ç¢°æ’žå†²çªï¼Œåˆ™ç›´æŽ¥æŠŠé”®å€¼å¯¹æ’å…¥ï¼Œå®Œäº‹ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; //å¦‚æžœæ¡¶ä¸ŠèŠ‚ç‚¹çš„keyä¸Žå½“å‰keyé‡å¤ï¼Œé‚£ä½ å°±æ˜¯æˆ‘è¦æ‰¾çš„èŠ‚ç‚¹äº† if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; //å¦‚æžœæ˜¯é‡‡ç”¨çº¢é»‘æ ‘çš„æ–¹å¼å¤„ç†å†²çªï¼Œåˆ™é€šè¿‡çº¢é»‘æ ‘çš„putTreeValæ–¹æ³•åŽ»æ’å…¥è¿™ä¸ªé”®å€¼å¯¹ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); //å¦åˆ™å°±æ˜¯ä¼ ç»Ÿçš„é“¾å¼ç»“æž„ else &#123; //é‡‡ç”¨å¾ªçŽ¯éåŽ†çš„æ–¹å¼ï¼Œåˆ¤æ–­é“¾ä¸­æ˜¯å¦æœ‰é‡å¤çš„key for (int binCount = 0; ; ++binCount) &#123; //åˆ°äº†é“¾å°¾è¿˜æ²¡æ‰¾åˆ°é‡å¤çš„keyï¼Œåˆ™è¯´æ˜ŽHashMapæ²¡æœ‰åŒ…å«è¯¥é”® if ((e = p.next) == null) &#123; //åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹æ’å…¥åˆ°å°¾éƒ¨ p.next = newNode(hash, key, value, null); //å¦‚æžœé“¾çš„é•¿åº¦å¤§äºŽTREEIFY_THRESHOLDè¿™ä¸ªä¸´ç•Œå€¼ï¼Œåˆ™æŠŠé“¾å˜ä¸ºçº¢é»‘æ ‘ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; //æ‰¾åˆ°äº†é‡å¤çš„key if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; //è¿™é‡Œè¡¨ç¤ºåœ¨ä¸Šé¢çš„æ“ä½œä¸­æ‰¾åˆ°äº†é‡å¤çš„é”®ï¼Œæ‰€ä»¥è¿™é‡ŒæŠŠè¯¥é”®çš„å€¼æ›¿æ¢ä¸ºæ–°å€¼ if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; //åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; 1234567891011121314151617181920final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) &#123; int n, index; Node&lt;K,V&gt; e; if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY) resize(); else if ((e = tab[index = (n - 1) &amp; hash]) != null) &#123; TreeNode&lt;K,V&gt; hd = null, tl = null; do &#123; TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null); if (tl == null) hd = p; else &#123; p.prev = tl; tl.next = p; &#125; tl = p; &#125; while ((e = e.next) != null); if ((tab[index] = hd) != null) hd.treeify(tab); &#125;&#125; putæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œå®žçŽ°æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š å…ˆé€šè¿‡hashå€¼è®¡ç®—å‡ºkeyæ˜ å°„åˆ°å“ªä¸ªæ¡¶ã€‚ å¦‚æžœæ¡¶ä¸Šæ²¡æœ‰ç¢°æ’žå†²çªï¼Œåˆ™ç›´æŽ¥æ’å…¥ã€‚ å¦‚æžœå‡ºçŽ°ç¢°æ’žå†²çªäº†ï¼Œåˆ™éœ€è¦å¤„ç†å†²çªï¼š å¦‚æžœè¯¥æ¡¶ä½¿ç”¨çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ’å…¥ã€‚ å¦åˆ™é‡‡ç”¨ä¼ ç»Ÿçš„é“¾å¼æ–¹æ³•æ’å…¥ã€‚å¦‚æžœé“¾çš„é•¿åº¦åˆ°è¾¾ä¸´ç•Œå€¼ï¼Œåˆ™æŠŠé“¾è½¬å˜ä¸ºçº¢é»‘æ ‘ã€‚ å¦‚æžœæ¡¶ä¸­å­˜åœ¨é‡å¤çš„é”®ï¼Œåˆ™ä¸ºè¯¥é”®æ›¿æ¢æ–°å€¼ã€‚ å¦‚æžœsizeå¤§äºŽé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ã€‚ 5.3 removeæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//removeæ–¹æ³•çš„å…·ä½“å®žçŽ°åœ¨removeNodeæ–¹æ³•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹é¢çš„removeNodeæ–¹æ³•public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; //å¦‚æžœå½“å‰keyæ˜ å°„åˆ°çš„æ¡¶ä¸ä¸ºç©º if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; K k; V v; //å¦‚æžœæ¡¶ä¸Šçš„èŠ‚ç‚¹å°±æ˜¯è¦æ‰¾çš„keyï¼Œåˆ™ç›´æŽ¥å‘½ä¸­ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; //å¦‚æžœæ˜¯ä»¥çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™æž„å»ºä¸€ä¸ªæ ‘èŠ‚ç‚¹ if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); //å¦‚æžœæ˜¯ä»¥é“¾å¼çš„æ–¹å¼å¤„ç†å†²çªï¼Œåˆ™é€šè¿‡éåŽ†é“¾è¡¨æ¥å¯»æ‰¾èŠ‚ç‚¹ else &#123; do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; //æ¯”å¯¹æ‰¾åˆ°çš„keyçš„valueè·Ÿè¦åˆ é™¤çš„æ˜¯å¦åŒ¹é… if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; //é€šè¿‡è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ¥åˆ é™¤èŠ‚ç‚¹ if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); //ä½¿ç”¨é“¾è¡¨çš„æ“ä½œæ¥åˆ é™¤èŠ‚ç‚¹ else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); return node; &#125; &#125; return null;&#125; 5.4 hashæ–¹æ³•(ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®) ä¸ç®¡å¢žåŠ ã€åˆ é™¤ã€æŸ¥æ‰¾é”®å€¼å¯¹ï¼Œå®šä½åˆ°å“ˆå¸Œæ¡¶æ•°ç»„çš„ä½ç½®éƒ½æ˜¯å¾ˆå…³é”®çš„ç¬¬ä¸€æ­¥ã€‚å‰é¢è¯´è¿‡HashMapçš„æ•°æ®ç»“æž„æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ªHashMapé‡Œé¢çš„å…ƒç´ ä½ç½®å°½é‡åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨hashç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œä¸ç”¨éåŽ†é“¾è¡¨ï¼Œå¤§å¤§ä¼˜åŒ–äº†æŸ¥è¯¢çš„æ•ˆçŽ‡ã€‚HashMapå®šä½æ•°ç»„ç´¢å¼•ä½ç½®ï¼Œç›´æŽ¥å†³å®šäº†hashæ–¹æ³•çš„ç¦»æ•£æ€§èƒ½ã€‚ æ³¨æ„getæ–¹æ³•å’Œputæ–¹æ³•æºç ä¸­éƒ½éœ€è¦å…ˆè®¡ç®—keyæ˜ å°„åˆ°å“ªä¸ªæ¡¶ä¸Šï¼Œç„¶åŽæ‰è¿›è¡Œä¹‹åŽçš„æ“ä½œï¼Œè®¡ç®—çš„ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š 1(n - 1) &amp; hash ä¸Šé¢ä»£ç ä¸­çš„næŒ‡çš„æ˜¯å“ˆå¸Œè¡¨çš„å¤§å°ï¼ŒhashæŒ‡çš„æ˜¯keyçš„å“ˆå¸Œå€¼ï¼Œhashæ˜¯é€šè¿‡ä¸‹é¢è¿™ä¸ªæ–¹æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œé‡‡ç”¨äº†äºŒæ¬¡å“ˆå¸Œçš„æ–¹å¼ï¼Œå…¶ä¸­keyçš„hashCodeæ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼š 123456static final int hash(Object key) &#123; //jdk1.8 &amp; jdk1.7 int h; // h = key.hashCode() ä¸ºç¬¬ä¸€æ­¥ å–hashCodeå€¼ // h ^ (h &gt;&gt;&gt; 16) ä¸ºç¬¬äºŒæ­¥ é«˜ä½å‚ä¸Žè¿ç®— return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; å¯¹äºŽä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„hashCode()è¿”å›žå€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„Hashç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠhashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œæ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåœ¨HashMapä¸­æ˜¯è¿™æ ·åšçš„ï¼šè°ƒç”¨æ–¹æ³•äºŒæ¥è®¡ç®—è¯¥å¯¹è±¡åº”è¯¥ä¿å­˜åœ¨tableæ•°ç»„çš„å“ªä¸ªç´¢å¼•å¤„ã€‚ è¿™ä¸ªæ–¹æ³•éžå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡h &amp; (table.length -1)æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€ŒHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™æ˜¯HashMapåœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚å½“lengthæ€»æ˜¯2çš„næ¬¡æ–¹æ—¶ï¼Œh&amp; (length-1)è¿ç®—ç­‰ä»·äºŽå¯¹lengthå–æ¨¡ï¼Œä¹Ÿå°±æ˜¯h%lengthï¼Œä½†æ˜¯&amp;æ¯”%å…·æœ‰æ›´é«˜çš„æ•ˆçŽ‡ã€‚ åœ¨JDK1.8çš„å®žçŽ°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½Ž16ä½å®žçŽ°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»Žé€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½ŽBitéƒ½å‚ä¸Žåˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚ æ€»ç»“å°±æ˜¯ï¼šç”±äºŽåœ¨è®¡ç®—ä¸­ä½è¿ç®—æ¯”å–æ¨¡è¿ç®—æ•ˆçŽ‡é«˜çš„å¤šï¼Œæ‰€ä»¥ HashMap è§„å®šæ•°ç»„çš„é•¿åº¦ä¸º 2^n ã€‚è¿™æ ·ç”¨ 2^n - 1 åšä½è¿ç®—ä¸Žå–æ¨¡æ•ˆæžœä¸€è‡´ï¼Œå¹¶ä¸”æ•ˆçŽ‡è¿˜è¦é«˜å‡ºè®¸å¤šã€‚è¿™æ ·å›žç­”äº†ä¸Šæ–‡ä¸­ï¼šå¥½çš„Hashç®—æ³•åˆ°åº•æ˜¯ä»€ä¹ˆã€‚ 5.5 resizeæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; //è®¡ç®—æ‰©å®¹åŽçš„å¤§å° if (oldCap &gt; 0) &#123; //å¦‚æžœå½“å‰å®¹é‡è¶…è¿‡æœ€å¤§å®¹é‡ï¼Œåˆ™æ— æ³•è¿›è¡Œæ‰©å®¹ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; //æ²¡è¶…è¿‡æœ€å¤§å€¼åˆ™æ‰©ä¸ºåŽŸæ¥çš„ä¸¤å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold &#125; else if (oldThr &gt; 0) // initial capacity was placed in threshold newCap = oldThr; else &#123; // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; //æ–°çš„resizeé˜ˆå€¼ threshold = newThr; //åˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨ @SuppressWarnings(&#123;"rawtypes","unchecked"&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; if (oldTab != null) &#123; //éåŽ†æ—§å“ˆå¸Œè¡¨çš„æ¯ä¸ªæ¡¶ï¼Œé‡æ–°è®¡ç®—æ¡¶é‡Œå…ƒç´ çš„æ–°ä½ç½® for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; oldTab[j] = null; //å¦‚æžœæ¡¶ä¸Šåªæœ‰ä¸€ä¸ªé”®å€¼å¯¹ï¼Œåˆ™ç›´æŽ¥æ’å…¥ if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; //å¦‚æžœæ˜¯é€šè¿‡çº¢é»‘æ ‘æ¥å¤„ç†å†²çªçš„ï¼Œåˆ™è°ƒç”¨ç›¸å…³æ–¹æ³•æŠŠæ ‘åˆ†ç¦»å¼€ else if (e instanceof TreeNode) ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); //å¦‚æžœé‡‡ç”¨é“¾å¼å¤„ç†å†²çª else &#123; // preserve order Node&lt;K,V&gt; loHead = null, loTail = null; Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; //é€šè¿‡ä¸Šé¢è®²çš„æ–¹æ³•æ¥è®¡ç®—èŠ‚ç‚¹çš„æ–°ä½ç½® do &#123; next = e.next; if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab;&#125; HashMapåœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œä½¿ç”¨çš„rehashæ–¹å¼éžå¸¸å·§å¦™ï¼Œå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸ŽåŽŸæ¥è®¡ç®—ï¼ˆn-1ï¼‰&amp;hashçš„ç»“æžœç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªbitä½ï¼Œæ‰€ä»¥èŠ‚ç‚¹è¦ä¹ˆå°±åœ¨åŽŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ°â€œåŽŸä½ç½®+æ—§å®¹é‡â€è¿™ä¸ªä½ç½®ã€‚ ä¾‹å¦‚ï¼ŒåŽŸæ¥çš„å®¹é‡ä¸º32ï¼Œé‚£ä¹ˆåº”è¯¥æ‹¿hashè·Ÿ31ï¼ˆ0x11111ï¼‰åšä¸Žæ“ä½œï¼›åœ¨æ‰©å®¹æ‰©åˆ°äº†64çš„å®¹é‡ä¹‹åŽï¼Œåº”è¯¥æ‹¿hashè·Ÿ63ï¼ˆ0x111111ï¼‰åšä¸Žæ“ä½œã€‚æ–°å®¹é‡è·ŸåŽŸæ¥ç›¸æ¯”åªæ˜¯å¤šäº†ä¸€ä¸ªbitä½ï¼Œå‡è®¾åŽŸæ¥çš„ä½ç½®åœ¨23ï¼Œé‚£ä¹ˆå½“æ–°å¢žçš„é‚£ä¸ªbitä½çš„è®¡ç®—ç»“æžœä¸º0æ—¶ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹è¿˜æ˜¯åœ¨23ï¼›ç›¸åï¼Œè®¡ç®—ç»“æžœä¸º1æ—¶ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¼šè¢«åˆ†é…åˆ°23+31çš„æ¡¶ä¸Šã€‚ è¿™æ ·åšçš„å¥½å¤„ï¼šæ­£æ˜¯å› ä¸ºè¿™æ ·å·§å¦™çš„rehashæ–¹å¼ï¼Œä¿è¯äº†rehashä¹‹åŽæ¯ä¸ªæ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°å¿…å®šå°äºŽç­‰äºŽåŽŸæ¥æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°ï¼Œå³ä¿è¯äº†rehashä¹‹åŽä¸ä¼šå‡ºçŽ°æ›´ä¸¥é‡çš„å†²çªã€‚å›žç­”äº†ä¸Šæ–‡ä¸­å¥½çš„æ‰©å®¹æœºåˆ¶ã€‚ å…­ã€æ€»ç»“ HashMapçš„ç»“æž„åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªæ¡¶ï¼ŒåŽé¢å¯èƒ½ä¼šè¿žç€ä¸€ä¸²å› ä¸ºç¢°æ’žè€Œèšåœ¨ä¸€èµ·çš„(key,value)èŠ‚ç‚¹ï¼Œä»¥é“¾è¡¨çš„å½¢å¼æˆ–è€…æ ‘çš„å½¢å¼æŒ‚ç€ æŒ‰ç…§åŽŸæ¥çš„æ‹‰é“¾æ³•æ¥è§£å†³å†²çªï¼Œå¦‚æžœä¸€ä¸ªæ¡¶ä¸Šçš„å†²çªå¾ˆä¸¥é‡çš„è¯ï¼Œæ˜¯ä¼šå¯¼è‡´å“ˆå¸Œè¡¨çš„æ•ˆçŽ‡é™ä½Žè‡³Oï¼ˆnï¼‰ï¼Œè€Œé€šè¿‡çº¢é»‘æ ‘çš„æ–¹å¼ï¼Œå¯ä»¥æŠŠæ•ˆçŽ‡æ”¹è¿›è‡³Oï¼ˆlognï¼‰ã€‚ç›¸æ¯”é“¾å¼ç»“æž„çš„èŠ‚ç‚¹ï¼Œæ ‘åž‹ç»“æž„çš„èŠ‚ç‚¹ä¼šå ç”¨æ¯”è¾ƒå¤šçš„ç©ºé—´ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ”¹è¿›æ–¹å¼ã€‚ thresholdæ˜¯æ•°ç»„é•¿åº¦æ‰©å®¹çš„ä¸´ç•Œå€¼ modCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æž„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼Œè¿™é‡Œç»“æž„å˜åŒ–å¿…é¡»æ˜¯æ–°çš„å€¼å¡žè¿›æ¥æˆ–è€…æŸä¸ªå€¼åˆ é™¤è¿™ç§ç±»åž‹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ˜¯è¦†ç›– åªæœ‰åŒæ—¶æ»¡è¶³ï¼šè¡¨ä¸­æ•°æ®å®¹é‡å·²ç»æ‰©å®¹åˆ°MIN_TREEIFY_CAPACITYè¿™ä¸ªé•¿åº¦ï¼Œå¹¶ä¸”æ¡¶é‡Œçš„æ•°æ®ä¸ªæ•°è¾¾åˆ°8ä¸ªçš„æ—¶å€™ï¼Œæ‰ä¼šå°†è¯¥æ¡¶é‡Œçš„ç»“æž„è¿›è¡Œæ ‘åŒ–ã€‚ å¥½çš„hashç®—æ³•ï¼šç”±äºŽåœ¨è®¡ç®—ä¸­ä½è¿ç®—æ¯”å–æ¨¡è¿ç®—æ•ˆçŽ‡é«˜çš„å¤šï¼Œæ‰€ä»¥HashMapè§„å®šæ•°ç»„çš„é•¿åº¦ä¸º 2^n ã€‚è¿™æ ·ç”¨ 2^n - 1 ä¸Ž hash åšä½è¿ç®—ä¸Žå–æ¨¡æ•ˆæžœä¸€è‡´ï¼Œå¹¶ä¸”æ•ˆçŽ‡è¿˜è¦é«˜å‡ºè®¸å¤šã€‚ å¥½çš„æ‰©å®¹æœºåˆ¶ï¼šå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸ŽåŽŸæ¥è®¡ç®—ï¼ˆn-1ï¼‰&amp;hashçš„ç»“æžœç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªbitä½ï¼Œæ‰€ä»¥èŠ‚ç‚¹è¦ä¹ˆå°±åœ¨åŽŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ°â€œåŽŸä½ç½®+æ—§å®¹é‡â€è¿™ä¸ªä½ç½®ã€‚è¿™æ ·åšçš„å¥½å¤„ï¼šæ­£æ˜¯å› ä¸ºè¿™æ ·å·§å¦™çš„rehashæ–¹å¼ï¼Œä¿è¯äº†rehashä¹‹åŽæ¯ä¸ªæ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°å¿…å®šå°äºŽç­‰äºŽåŽŸæ¥æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°ï¼Œå³ä¿è¯äº†rehashä¹‹åŽä¸ä¼šå‡ºçŽ°æ›´ä¸¥é‡çš„å†²çªã€‚ è¿˜æœ‰å°±æ˜¯è¦è®°ä½putçš„è¿‡ç¨‹ã€‚ æ•´ç†è‡ªï¼š https://zhuanlan.zhihu.com/p/21673805 http://blog.csdn.net/u013124587/article/details/52649867]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hashcode/Equals]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F4.hashcode%E5%92%8Cequals%2F</url>
    <content type="text"><![CDATA[hashcodeæ¶‰åŠåˆ°é›†åˆHashMapç­‰é›†åˆï¼Œæ­¤ç¯‡ä¾§é‡äºŽäº†è§£hashcodeå’Œequalsæ–¹æ³•çš„ä½œç”¨çš„åŽŸç†ã€‚æœ‰åŠ©äºŽä¸‹ä¸€ç¯‡HashMapçš„ç†è§£ã€‚ ä¸€ã€Hashæ˜¯ä»€ä¹ˆ Hashæ˜¯æ•£åˆ—çš„æ„æ€ï¼Œå°±æ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œé€šè¿‡æ•£åˆ—ç®—æ³•å˜æ¢æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¯¥è¾“å‡ºå°±æ˜¯æ•£åˆ—å€¼ã€‚è¿™ä¸ªçŽ©æ„è¿˜å¯ä»¥åšåŠ å¯†ã€‚ ä¸åŒå…³é”®å­—ç»è¿‡æ•£åˆ—ç®—æ³•å˜æ¢åŽå¯èƒ½å¾—åˆ°åŒä¸€ä¸ªæ•£åˆ—åœ°å€ï¼Œè¿™ç§çŽ°è±¡ç§°ä¸ºç¢°æ’žã€‚ å¦‚æžœä¸¤ä¸ªHashå€¼ä¸åŒï¼ˆå‰ææ˜¯åŒä¸€Hashç®—æ³•ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªHashå€¼å¯¹åº”çš„åŽŸå§‹è¾“å…¥å¿…å®šä¸åŒ äºŒã€ä»€ä¹ˆæ˜¯hashcode HashCodeçš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†æŸ¥æ‰¾çš„å¿«æ·æ€§ï¼ŒHashCodeæ˜¯ç”¨æ¥åœ¨æ•£åˆ—å­˜å‚¨ç»“æž„ä¸­ç¡®å®šå¯¹è±¡çš„å­˜å‚¨åœ°å€çš„ã€‚ å¦‚æžœä¸¤ä¸ªå¯¹è±¡çš„HashCodeç›¸åŒï¼Œä¸ä»£è¡¨ä¸¤ä¸ªå¯¹è±¡å°±ç›¸åŒï¼Œåªèƒ½è¯´æ˜Žè¿™ä¸¤ä¸ªå¯¹è±¡åœ¨æ•£åˆ—å­˜å‚¨ç»“æž„ä¸­ï¼Œå­˜æ”¾äºŽåŒä¸€ä¸ªä½ç½®ã€‚ å¦‚æžœå¯¹è±¡çš„equalsæ–¹æ³•è¢«é‡å†™ï¼Œé‚£ä¹ˆå¯¹è±¡çš„HashCodeæ–¹æ³•ä¹Ÿå°½é‡é‡å†™ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸‹æ–‡ä¼šè¯´ã€‚ ä¸‰ã€HashCodeæœ‰ä»€ä¹ˆç”¨ æ¯”æ–¹è¯´Seté‡Œé¢å·²ç»æœ‰1000ä¸ªå…ƒç´ äº†ï¼Œé‚£ä¹ˆç¬¬1001ä¸ªå…ƒç´ è¿›æ¥çš„æ—¶å€™ï¼Œæœ€å¤šå¯èƒ½è°ƒç”¨1000æ¬¡equalsæ–¹æ³•ï¼Œå¦‚æžœequalsæ–¹æ³•å†™å¾—å¤æ‚ï¼Œå¯¹æ¯”çš„ä¸œè¥¿ç‰¹åˆ«å¤šï¼Œé‚£ä¹ˆæ•ˆçŽ‡ä¼šå¤§å¤§é™ä½Žã€‚ ä½¿ç”¨HashCodeå°±ä¸ä¸€æ ·äº†ï¼Œæ¯”æ–¹è¯´HashSetï¼Œåº•å±‚æ˜¯åŸºäºŽHashMapå®žçŽ°çš„ï¼Œå…ˆé€šè¿‡HashCodeå–ä¸€ä¸ªæ¨¡ï¼Œè¿™æ ·ä¸€ä¸‹å­å°±å›ºå®šåˆ°æŸä¸ªä½ç½®äº†ï¼Œå¦‚æžœè¿™ä¸ªä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‚¯å®šHashSetä¸­å¿…å®šæ²¡æœ‰å’Œæ–°æ·»åŠ çš„å…ƒç´ equalsçš„å…ƒç´ ï¼Œå°±å¯ä»¥ç›´æŽ¥å­˜æ”¾äº†ï¼Œéƒ½ä¸éœ€è¦æ¯”è¾ƒï¼› å¦‚æžœè¿™ä¸ªä½ç½®ä¸Šæœ‰å…ƒç´ äº†ï¼Œé€ä¸€æ¯”è¾ƒï¼Œæ¯”è¾ƒçš„æ—¶å€™å…ˆæ¯”è¾ƒHashCodeï¼ŒHashCodeéƒ½ä¸åŒæŽ¥ä¸‹åŽ»éƒ½ä¸ç”¨æ¯”äº†ï¼Œè‚¯å®šä¸ä¸€æ ·ï¼ŒHashCodeç›¸ç­‰ï¼Œå†equalsæ¯”è¾ƒï¼Œæ²¡æœ‰ç›¸åŒçš„å…ƒç´ å°±å­˜ï¼Œæœ‰ç›¸åŒçš„å…ƒç´ å°±ä¸å­˜ã€‚ å¦‚æžœåŽŸæ¥çš„Seté‡Œé¢æœ‰ç›¸åŒçš„å…ƒç´ ï¼Œåªè¦HashCodeçš„ç”Ÿæˆæ–¹å¼å®šä¹‰å¾—å¥½ï¼ˆä¸é‡å¤ï¼‰ï¼Œä¸ç®¡Seté‡Œé¢åŽŸæ¥æœ‰å¤šå°‘å…ƒç´ ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡çš„equalså°±å¯ä»¥äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œå®žé™…è°ƒç”¨equalsæ–¹æ³•çš„æ¬¡æ•°å¤§å¤§é™ä½Žï¼Œæé«˜äº†æ•ˆçŽ‡ã€‚ å½“ä¿©ä¸ªå¯¹è±¡çš„`hashCode`å€¼ç›¸åŒçš„æ—¶å€™ï¼Œ`Hashset`ä¼šå°†å¯¹è±¡ä¿å­˜åœ¨åŒä¸€ä¸ªä½ç½®ï¼Œä½†æ˜¯ä»–ä»¬`equals`è¿”å›ž`false`ï¼Œæ‰€ä»¥å®žé™…ä¸Šè¿™ä¸ªä½ç½®é‡‡ç”¨é“¾å¼ç»“æž„æ¥ä¿å­˜å¤šä¸ªå¯¹è±¡ã€‚ å››ã€ä¸ºä»€ä¹ˆé‡å†™Objectçš„equals()æ–¹æ³•å°½é‡è¦é‡å†™Objectçš„hashCode()æ–¹æ³• é¢ä¸´é—®é¢˜ï¼šè‹¥ä¸¤ä¸ªå¯¹è±¡equalsç›¸ç­‰ï¼Œä½†ç”±äºŽä¸åœ¨ä¸€ä¸ªåŒºé—´ï¼Œå› ä¸ºhashCodeçš„å€¼åœ¨é‡å†™ä¹‹å‰æ˜¯å¯¹å†…å­˜åœ°å€è®¡ç®—å¾—å‡ºï¼Œæ‰€ä»¥æ ¹æœ¬æ²¡æœ‰æœºä¼šè¿›è¡Œæ¯”è¾ƒï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„å¯¹è±¡(è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿˜è¦é‡å†™hashcodeæ–¹æ³•äº†)ã€‚æ‰€ä»¥Javaå¯¹äºŽeqaulsæ–¹æ³•å’ŒhashCodeæ–¹æ³•æ˜¯è¿™æ ·è§„å®šçš„ï¼š 1 å¦‚æžœä¸¤ä¸ªå¯¹è±¡ç›¸åŒ(equalsä¸ºtrue)ï¼Œé‚£ä¹ˆå®ƒä»¬çš„hashCodeå€¼ä¸€å®šè¦ç›¸åŒã€‚ä¹Ÿå‘Šè¯‰æˆ‘ä»¬é‡å†™equalsæ–¹æ³•ï¼Œä¸€å®šè¦é‡å†™hashCodeæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´hashCodeå€¼è¦å’Œç±»ä¸­çš„æˆå‘˜å˜é‡æŒ‚ä¸Šé’©ï¼Œå¯¹è±¡ç›¸åŒâ€“&gt;æˆå‘˜å˜é‡ç›¸åŒâ€”-&gt;hashCodeå€¼ä¸€å®šç›¸åŒã€‚ 2 å¦‚æžœä¸¤ä¸ªå¯¹è±¡çš„hashCodeç›¸åŒ(åªæ˜¯æ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®è€Œå·²)ï¼Œå®ƒä»¬å¹¶ä¸ä¸€å®šç›¸åŒï¼Œè¿™é‡Œçš„å¯¹è±¡ç›¸åŒæŒ‡çš„æ˜¯ç”¨eqaulsæ–¹æ³•æ¯”è¾ƒã€‚ ç®€å•æ¥è¯´ï¼Œå¦‚æžœåªé‡å†™equalsæ–¹æ³•è€Œä¸é‡å†™hashcodeæ–¹æ³•ï¼Œä¼šå¯¼è‡´é‡å¤å…ƒç´ çš„äº§ç”Ÿã€‚å…·ä½“é€šè¿‡ä¸‹é¢çš„ä¾‹å­è¿›è¡Œè¯´æ˜Žã€‚ äº”ã€ä¸¾ä¾‹ 6.1 Studentç±» å¾ˆç®€å•ï¼Œå®šä¹‰äº†idå’Œnameä¸¤ä¸ªå­—æ®µï¼Œæ— å‚å’Œæœ‰å‚æž„é€ å‡½æ•°ï¼ŒtoStringæ–¹æ³•ã€‚ 1234567891011121314151617181920public class Student &#123; private int id; private String name; get(),set()ç•¥... public Student()&#123;&#125; public Student(int id, String name) &#123; super(); this.id = id; this.name = name; &#125; @Override public String toString() &#123; return "Student [id=" + id + ", name=" + name + "]"; &#125;&#125; 6.2 mainæ–¹æ³• 1234567891011121314151617181920public static void main(String[] args) &#123; Student student1 = new Student(1,"hh"); Student student2 = new Student(1,"hh"); Student student3 = new Student(2,"gg"); HashSet&lt;Student&gt; set = new HashSet&lt;Student&gt;(); set.add(student1); set.add(student2); set.add(student3); set.add(student1);//é‡å¤æ·»åŠ äº†student1 System.out.println("seté›†åˆå®¹é‡ä¸º: "+set.size()); Iterator&lt;Student&gt; iterator = set.iterator(); while (iterator.hasNext()) &#123; Student student = iterator.next(); System.out.println(student+"---"+student.hashCode()); &#125; &#125; æ‰§è¡Œç»“æžœï¼š 1234seté›†åˆå®¹é‡ä¸º: 3Student [id=1, name=hh]---1735600054Student [id=1, name=hh]---356573597Student [id=2, name=gg]---21685669 æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåªè¦æ˜¯newçš„å¯¹è±¡ï¼Œä»–ä»¬çš„hashcodeæ˜¯ä¸ä¸€æ ·çš„ã€‚æ‰€ä»¥ï¼Œå°±ä¼šè®¤ä¸ºä»–ä»¬æ˜¯ä¸ä¸€æ ·çš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œé›†åˆé‡Œé¢æ•°é‡ä¸º3. 6.3 åªé‡å†™equals()æ–¹æ³•ï¼Œè€Œä¸é‡å†™HashCode()æ–¹æ³• è¾“å‡ºï¼š 1234seté›†åˆå®¹é‡ä¸º: 3Student [id=2, name=gg]---2018699554Student [id=1, name=hh]---366712642Student [id=1, name=hh]---1829164700 ç»“è®ºï¼šè¦†ç›–equalsï¼ˆObject objï¼‰ä½†ä¸è¦†ç›–hashCode(),å¯¼è‡´æ•°æ®ä¸å”¯ä¸€æ€§ã€‚ åœ¨è¿™é‡Œï¼Œå…¶å®žæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œstudent1å’Œstudent2å…¶å®žæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ç”±äºŽéƒ½æ˜¯newå¹¶ä¸”æ²¡æœ‰é‡å†™hashcodeå¯¼è‡´ä»–ä»¬å˜æˆäº†ä¸¤ä¸ªä¸ä¸€æ ·çš„å¯¹è±¡ã€‚ åˆ†æžï¼š ï¼ˆ1ï¼‰å½“æ‰§è¡Œset.add(student1)æ—¶ï¼Œé›†åˆä¸ºç©ºï¼Œç›´æŽ¥å­˜å…¥é›†åˆï¼› ï¼ˆ2ï¼‰å½“æ‰§è¡Œset.add(student2)æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­è¯¥å¯¹è±¡ï¼ˆstudent2ï¼‰çš„hashCodeå€¼æ‰€åœ¨çš„å­˜å‚¨åŒºåŸŸæ˜¯å¦æœ‰ç›¸åŒçš„hashCodeï¼Œå› ä¸ºæ²¡æœ‰è¦†ç›–hashCodeæ–¹æ³•ï¼Œæ‰€ä»¥jdkä½¿ç”¨é»˜è®¤Objectçš„hashCodeæ–¹æ³•ï¼Œè¿”å›žå†…å­˜åœ°å€è½¬æ¢åŽçš„æ•´æ•°ï¼Œå› ä¸ºä¸åŒå¯¹è±¡çš„åœ°å€å€¼ä¸åŒï¼Œæ‰€ä»¥è¿™é‡Œä¸å­˜åœ¨ä¸Žstudent2ç›¸åŒhashCodeå€¼çš„å¯¹è±¡ï¼Œå› æ­¤jdké»˜è®¤ä¸åŒhashCodeå€¼ï¼Œequalsä¸€å®šè¿”å›žfalseï¼Œæ‰€ä»¥ç›´æŽ¥å­˜å…¥é›†åˆã€‚ ï¼ˆ3ï¼‰å½“æ‰§è¡Œset.add(student3)æ—¶,ä¸Ž2åŒç†ã€‚ ï¼ˆ4ï¼‰å½“æœ€åŽæ‰§è¡Œset.add(student1)æ—¶ï¼Œå› ä¸ºstudent1å·²ç»å­˜å…¥é›†åˆï¼ŒåŒä¸€å¯¹è±¡è¿”å›žçš„hashCodeå€¼æ˜¯ä¸€æ ·çš„ï¼Œç»§ç»­åˆ¤æ–­equalsæ˜¯å¦è¿”å›žtrueï¼Œå› ä¸ºæ˜¯åŒä¸€å¯¹è±¡æ‰€ä»¥è¿”å›žtrueã€‚æ­¤æ—¶jdkè®¤ä¸ºè¯¥å¯¹è±¡å·²ç»å­˜åœ¨äºŽé›†åˆä¸­ï¼Œæ‰€ä»¥èˆå¼ƒã€‚ 6.4 åªé‡å†™HashCode()æ–¹æ³•ï¼Œequals()æ–¹æ³•ç›´æŽ¥è¿”å›žfalse 1234seté›†åˆå®¹é‡ä¸º: 3Student [id=1, name=hh]---4320Student [id=1, name=hh]---4320Student [id=2, name=gg]---4319 æŒ‰ç…§ä¸Šé¢çš„åˆ†æžï¼Œå¯èƒ½ä¼šè§‰å¾—é‡Œé¢åº”è¯¥è£…4ä¸ªï¼Œå› ä¸ºä¸¤æ¬¡addçš„student1ï¼Œè™½ç„¶ä»–ä»¬çš„hashcodeä¸€æ ·ï¼Œä½†æ˜¯equalsç›´æŽ¥è¿”å›žfalseï¼Œé‚£ä¹ˆåº”è¯¥åˆ¤å®šä¸ºä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ã€‚ä½†æ˜¯ç»“æžœç¡®è·Ÿæˆ‘ä»¬é¢„æƒ³çš„ä¸ä¸€æ ·ã€‚ åˆ†æžï¼š é¦–å…ˆstudent1å’Œstudent2çš„å¯¹è±¡æ¯”è¾ƒhashCodeï¼Œå› ä¸ºé‡å†™äº†HashCodeæ–¹æ³•ï¼Œæ‰€ä»¥hashcodeç›¸ç­‰,ç„¶åŽæ¯”è¾ƒä»–ä»¬ä¸¤çš„equalsæ–¹æ³•ï¼Œå› ä¸ºequalsæ–¹æ³•å§‹ç»ˆè¿”å›žfalse,æ‰€ä»¥student1å’Œstudent2ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥student2ä¹Ÿè¢«æ”¾è¿›äº†set é¦–å…ˆstudent1(student2)å’Œstudent3çš„å¯¹è±¡æ¯”è¾ƒhashCodeï¼Œä¸ç›¸ç­‰ï¼Œæ‰€ä»¥student3æ”¾è¿›setä¸­ æœ€åŽå†çœ‹æœ€åŽé‡å¤æ·»åŠ çš„student1,ä¸Žç¬¬ä¸€ä¸ªstudent1çš„hashCodeæ˜¯ç›¸ç­‰çš„ï¼Œåœ¨æ¯”è¾ƒequalsæ–¹æ³•ï¼Œå› ä¸ºequalsè¿”å›žfalse,æ‰€ä»¥student1å’Œstudent4ä¸ç›¸ç­‰;åŒæ ·ï¼Œstudent2å’Œstudent4ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„;student3å’Œstudent4çš„hashcodeéƒ½ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥è‚¯å®šä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥æœ€åŽä¸€ä¸ªé‡å¤çš„student1åº”è¯¥å¯ä»¥æ”¾åˆ°seté›†åˆä¸­ï¼Œé‚£ä¹ˆç»“æžœåº”è¯¥æ˜¯size:4,é‚£ä¸ºä»€ä¹ˆä¼šæ˜¯3å‘¢ï¼Ÿ è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æŸ¥çœ‹HashSetçš„æºç äº†ï¼Œä¸‹é¢æ˜¯HashSetä¸­çš„addæ–¹æ³•çš„æºç ï¼š 123public boolean add(E e) &#123; return map.put(e, PRESENT)==null;&#125; è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å®žHashSetæ˜¯åŸºäºŽHashMapå®žçŽ°çš„ï¼Œæˆ‘ä»¬åœ¨ç‚¹å‡»HashMapçš„putæ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š 123public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; é¦–å…ˆæ˜¯åˆ¤æ–­hashCodeæ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰çš„è¯ï¼Œç›´æŽ¥è·³è¿‡ï¼Œç›¸ç­‰çš„è¯ï¼Œç„¶åŽå†æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰æˆ–è€…è¿™ä¸¤ä¸ªå¯¹è±¡çš„equalsæ–¹æ³•ï¼Œå› ä¸ºæ˜¯è¿›è¡Œçš„æˆ–æ“ä½œï¼Œæ‰€ä»¥åªè¦æœ‰ä¸€ä¸ªæˆç«‹å³å¯ï¼Œé‚£è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥è§£é‡Šäº†ï¼Œå…¶å®žä¸Šé¢çš„é‚£ä¸ªé›†åˆçš„å¤§å°æ˜¯3,å› ä¸ºæœ€åŽçš„ä¸€ä¸ªr1æ²¡æœ‰æ”¾è¿›åŽ»ï¼Œä»¥ä¸ºr1==r1è¿”å›žtrueçš„ï¼Œæ‰€ä»¥æ²¡æœ‰æ”¾è¿›åŽ»äº†ã€‚æ‰€ä»¥é›†åˆçš„å¤§å°æ˜¯3ï¼Œå¦‚æžœæˆ‘ä»¬å°†hashCodeæ–¹æ³•è®¾ç½®æˆå§‹ç»ˆè¿”å›žfalseçš„è¯ï¼Œè¿™ä¸ªé›†åˆå°±æ˜¯4äº†ã€‚ 6.5 åŒæ—¶é‡å†™ æˆ‘çš„å†™æ³•æ˜¯ï¼š 12345678910111213141516171819@Overridepublic int hashCode() &#123; int result = 17; result = result * 31 + name.hashCode(); result = result * 31 + id; return result;&#125;@Overridepublic boolean equals(Object obj) &#123; if(obj == this) return true; if(!(obj instanceof Student)) return false; Student o = (Student)obj; return o.name.equals(name) &amp;&amp; o.id == id;&#125; ç»“æžœï¼š 123seté›†åˆå®¹é‡ä¸º: 2Student [id=2, name=gg]---118515Student [id=1, name=hh]---119506 è¾¾åˆ°æˆ‘ä»¬é¢„æœŸçš„æ•ˆæžœã€‚ å…­ã€å†…å­˜æ³„éœ² æˆ‘ä»¬ä¸Šé¢å®žéªŒäº†é‡å†™equalså’Œhashcodeæ–¹æ³•ï¼Œæ‰§è¡Œmainï¼Œæ‰§è¡Œç»“æžœæ˜¯ï¼š 123seté›†åˆå®¹é‡ä¸º: 2Student [id=1, name=hh]---4320Student [id=2, name=gg]---4319 å°†mainæ–¹æ³•æ”¹ä¸ºï¼š 1234567891011121314151617181920212223242526272829public static void main(String[] args) &#123; Student student1 = new Student(1,"hh"); Student student2 = new Student(1,"hh"); Student student3 = new Student(2,"gg"); HashSet&lt;Student&gt; set = new HashSet&lt;Student&gt;(); set.add(student1); set.add(student2); set.add(student3); set.add(student1);//é‡å¤æ·»åŠ äº†student1 System.out.println("seté›†åˆå®¹é‡ä¸º: "+set.size()); //------æ–°å¢žçš„å¼€å§‹------- student3.setId(11); set.remove(student3); System.out.println("seté›†åˆå®¹é‡ä¸º: "+set.size()); //------æ–°å¢žçš„ç»“æŸ------- Iterator&lt;Student&gt; iterator = set.iterator(); while (iterator.hasNext()) &#123; Student student = iterator.next(); System.out.println(student+"---"+student.hashCode()); &#125; &#125; è¿è¡Œç»“æžœæ˜¯ï¼š 1234seté›†åˆå®¹é‡ä¸º: 2seté›†åˆå®¹é‡ä¸º: 2Student [id=1, name=hh]---4320Student [id=11, name=gg]---4598 æˆ‘ä»¬è°ƒç”¨äº†removeåˆ é™¤student3å¯¹è±¡ï¼Œä»¥ä¸ºåˆ é™¤äº†student3,ä½†äº‹å®žä¸Šå¹¶æ²¡æœ‰åˆ é™¤ï¼Œè¿™å°±å«åšå†…å­˜æ³„éœ²ï¼Œå°±æ˜¯ä¸ç”¨çš„å¯¹è±¡ä½†æ˜¯ä»–è¿˜åœ¨å†…å­˜ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¤šæ¬¡è¿™æ ·æ“ä½œä¹‹åŽï¼Œå†…å­˜å°±çˆ†äº†ã€‚ åŽŸå› ï¼š åœ¨è°ƒç”¨removeæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…ˆä½¿ç”¨å¯¹è±¡çš„hashCodeå€¼åŽ»æ‰¾åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œç„¶åŽè¿›è¡Œåˆ é™¤ï¼Œè¿™ç§é—®é¢˜å°±æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä¿®æ”¹äº†å¯¹è±¡student3çš„idå±žæ€§çš„å€¼ï¼Œåˆå› ä¸ºRectObjectå¯¹è±¡çš„hashCodeæ–¹æ³•ä¸­æœ‰idå€¼å‚ä¸Žè¿ç®—,æ‰€ä»¥student3å¯¹è±¡çš„hashCodeå°±å‘ç”Ÿæ”¹å˜äº†ï¼Œæ‰€ä»¥removeæ–¹æ³•ä¸­å¹¶æ²¡æœ‰æ‰¾åˆ°student3äº†ï¼Œæ‰€ä»¥åˆ é™¤å¤±è´¥ã€‚å³student3çš„hashCodeå˜äº†ï¼Œä½†æ˜¯ä»–å­˜å‚¨çš„ä½ç½®æ²¡æœ‰æ›´æ–°ï¼Œä»ç„¶åœ¨åŽŸæ¥çš„ä½ç½®ä¸Šï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ç”¨ä»–çš„æ–°çš„hashCodeåŽ»æ‰¾è‚¯å®šæ˜¯æ‰¾ä¸åˆ°äº†ã€‚ æ€»ç»“ï¼š ä¸Šé¢çš„è¿™ä¸ªå†…å­˜æ³„éœ²å‘Šè¯‰æˆ‘ä¸€ä¸ªä¿¡æ¯ï¼šå¦‚æžœæˆ‘ä»¬å°†å¯¹è±¡çš„å±žæ€§å€¼å‚ä¸Žäº†hashCodeçš„è¿ç®—ä¸­ï¼Œåœ¨è¿›è¡Œåˆ é™¤çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å¯¹å…¶å±žæ€§å€¼è¿›è¡Œä¿®æ”¹ï¼Œå¦åˆ™ä¼šå‡ºçŽ°ä¸¥é‡çš„é—®é¢˜ã€‚ ä¸ƒã€æ€»ç»“ hashCodeæ˜¯ä¸ºäº†æé«˜åœ¨æ•£åˆ—ç»“æž„å­˜å‚¨ä¸­æŸ¥æ‰¾çš„æ•ˆçŽ‡ï¼Œåœ¨çº¿æ€§è¡¨ä¸­æ²¡æœ‰ä½œç”¨ã€‚ equalså’ŒhashCodeéœ€è¦åŒæ—¶è¦†ç›–ã€‚ è‹¥ä¸¤ä¸ªå¯¹è±¡equalsè¿”å›žtrueï¼Œåˆ™hashCodeæœ‰å¿…è¦ä¹Ÿè¿”å›žç›¸åŒçš„intæ•°ã€‚ è‹¥ä¸¤ä¸ªå¯¹è±¡equalsè¿”å›žfalseï¼Œåˆ™hashCodeä¸ä¸€å®šè¿”å›žä¸åŒçš„intæ•°,ä½†ä¸ºä¸ç›¸ç­‰çš„å¯¹è±¡ç”Ÿæˆä¸åŒhashCodeå€¼å¯ä»¥æé«˜å“ˆå¸Œè¡¨çš„æ€§èƒ½ã€‚ è‹¥ä¸¤ä¸ªå¯¹è±¡hashCodeè¿”å›žç›¸åŒintæ•°ï¼Œåˆ™equalsä¸ä¸€å®šè¿”å›žtrueã€‚ åŒä¸€å¯¹è±¡åœ¨æ‰§è¡ŒæœŸé—´è‹¥å·²ç»å­˜å‚¨åœ¨é›†åˆä¸­ï¼Œåˆ™ä¸èƒ½ä¿®æ”¹å½±å“hashCodeå€¼çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚ æ•´ç†è‡ªï¼š http://blog.csdn.net/haobaworenle/article/details/53819838 http://www.cnblogs.com/xrq730/p/4842028.html http://blog.csdn.net/qq_21688757/article/details/53067814 http://blog.csdn.net/fyxxq/article/details/42066843]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CopyOnWriteArrayList]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F3.CopyOnWriteArrayList%2F</url>
    <content type="text"><![CDATA[CopyOnWriteArrayListæ˜¯ArrayListçš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å˜ä½“ï¼Œå…¶ä¸­æ‰€æœ‰å¯å˜æ“ä½œï¼ˆaddã€set ç­‰ç­‰ï¼‰éƒ½æ˜¯é€šè¿‡å¯¹åº•å±‚æ•°ç»„è¿›è¡Œä¸€æ¬¡æ–°çš„å¤åˆ¶æ¥å®žçŽ°çš„ã€‚ CopyOnWriteArrayListæ˜¯ä¸€ä¸ªå†™æ—¶å¤åˆ¶çš„å®¹å™¨ï¼Œé‡‡ç”¨äº†è¯»å†™åˆ†ç¦»çš„æ€æƒ³ã€‚é€šä¿—ç‚¹æ¥è®²ï¼Œåœ¨å¯¹å®¹å™¨è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œä¸ç›´æŽ¥ä¿®æ”¹å½“å‰å®¹å™¨ï¼Œè€Œæ˜¯å…ˆå¯¹å½“å‰å®¹å™¨è¿›è¡Œæ‹·è´å¾—åˆ°ä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åŽå¯¹å‰¯æœ¬è¿›è¡Œå†™æ“ä½œï¼Œæœ€åŽå†å°†åŽŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ‹·è´å‡ºæ¥çš„å‰¯æœ¬ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¯ä»¥å¯¹å®¹å™¨è¿›è¡Œå¹¶å‘è¯»è€Œä¸ç”¨è¿›è¡ŒåŠ é”ã€‚ ä¸€ã€ç±»çš„ç»§æ‰¿å…³ç³» 12public class CopyOnWriteArrayList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable å«ä¹‰ä¸éœ€è¦å†èµ˜è¿°äº†ã€‚ äºŒã€ç±»çš„å±žæ€§ 12345678910111213141516171819202122/** ç”¨äºŽåœ¨å¯¹æ•°ç»„äº§ç”Ÿå†™æ“ä½œçš„æ–¹æ³•åŠ é”. */final transient ReentrantLock lock = new ReentrantLock();/** åº•å±‚çš„å­˜å‚¨ç»“æž„. */private transient volatile Object[] array;/** åå°„æœºåˆ¶. */private static final sun.misc.Unsafe UNSAFE;/** lockåŸŸçš„å†…å­˜åç§»é‡.æ˜¯é€šè¿‡åå°„æ‹¿åˆ°çš„ */private static final long lockOffset;static &#123; try &#123; UNSAFE = sun.misc.Unsafe.getUnsafe(); Class&lt;?&gt; k = CopyOnWriteArrayList.class; lockOffset = UNSAFE.objectFieldOffset (k.getDeclaredField("lock")); &#125; catch (Exception e) &#123; throw new Error(e); &#125;&#125; ä¸‰ã€æ•°ç»„æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´  12345678910111213141516171819202122public boolean add(E e) &#123; // å¯é‡å…¥é” final ReentrantLock lock = this.lock; // èŽ·å–é” lock.lock(); try &#123; // å…ƒç´ æ•°ç»„ Object[] elements = getArray(); // æ•°ç»„é•¿åº¦ int len = elements.length; // å¤åˆ¶æ•°ç»„ Object[] newElements = Arrays.copyOf(elements, len + 1); // å°†è¦æ·»åŠ çš„å…ƒç´ æ”¾åˆ°å‰¯æœ¬æ•°ç»„çš„æœ«å°¾åŽ» newElements[len] = e; // è®¾ç½®æ•°ç»„ setArray(newElements); return true; &#125; finally &#123; // é‡Šæ”¾é” lock.unlock(); &#125;&#125; åŸºæœ¬åŽŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯å¯¹å½“å‰æ•°ç»„åŠ é”ï¼Œå†…éƒ¨å¤åˆ¶ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¤„ç†å®Œæ¯•ï¼Œä¿®æ”¹å¼•ç”¨å³å¯ï¼Œè¾¾åˆ°æœ€ç»ˆä¸€è‡´çš„æ•ˆæžœã€‚ å››ã€å¦‚æžœæ²¡æœ‰è¿™ä¸ªå…ƒç´ åˆ™æ·»åŠ  12345public boolean addIfAbsent(E e) &#123; Object[] snapshot = getArray(); return indexOf(e, snapshot, 0, snapshot.length) &gt;= 0 ? false : addIfAbsent(e, snapshot);&#125; è¯¥å‡½æ•°ç”¨äºŽæ·»åŠ å…ƒç´ ï¼ˆå¦‚æžœæ•°ç»„ä¸­ä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ ï¼›å¦åˆ™ï¼Œä¸æ·»åŠ ï¼Œç›´æŽ¥è¿”å›žï¼‰ã€‚å¦‚ä½•å¯ä»¥ä¿è¯å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ä¸ä¼šé‡å¤æ·»åŠ å…ƒç´ ï¼Ÿ ç­”æ¡ˆï¼šé€šè¿‡å¿«ç…§æ•°ç»„å’Œå½“å‰æ•°ç»„è¿›è¡Œå¯¹æ¯”æ¥ç¡®å®šæ˜¯å¦ä¸€è‡´ï¼Œç¡®ä¿æ·»åŠ å…ƒç´ çš„çº¿ç¨‹å®‰å…¨ 12345678910111213141516171819202122232425262728293031323334private boolean addIfAbsent(E e, Object[] snapshot) &#123; // é‡å…¥é” final ReentrantLock lock = this.lock; // èŽ·å–é” lock.lock(); try &#123; // èŽ·å–æ•°ç»„ Object[] current = getArray(); // æ•°ç»„é•¿åº¦ int len = current.length; if (snapshot != current) &#123; // å¿«ç…§ä¸ç­‰äºŽå½“å‰æ•°ç»„ï¼Œå¯¹æ•°ç»„è¿›è¡Œäº†ä¿®æ”¹ // å–è¾ƒå°è€… int common = Math.min(snapshot.length, len); for (int i = 0; i &lt; common; i++) // éåŽ† if (current[i] != snapshot[i] &amp;&amp; eq(e, current[i])) // å½“å‰æ•°ç»„çš„å…ƒç´ ä¸Žå¿«ç…§çš„å…ƒç´ ä¸ç›¸ç­‰å¹¶ä¸”eä¸Žå½“å‰å…ƒç´ ç›¸ç­‰ // è¡¨ç¤ºåœ¨snapshotä¸Žcurrentä¹‹é—´ä¿®æ”¹äº†æ•°ç»„ï¼Œå¹¶ä¸”è®¾ç½®äº†æ•°ç»„æŸä¸€å…ƒç´ ä¸ºeï¼Œå·²ç»å­˜åœ¨ // è¿”å›žfalse return false; if (indexOf(e, current, common, len) &gt;= 0) // åœ¨å½“å‰æ•°ç»„ä¸­æ‰¾åˆ°eå…ƒç´  // è¿”å›žfalse return false; &#125; // å¤åˆ¶æ•°ç»„ Object[] newElements = Arrays.copyOf(current, len + 1); // å¯¹æ•°ç»„lenç´¢å¼•çš„å…ƒç´ èµ‹å€¼ä¸ºe newElements[len] = e; // è®¾ç½®æ•°ç»„ setArray(newElements); return true; &#125; finally &#123; // é‡Šæ”¾é” lock.unlock(); &#125;&#125; è¯¥å‡½æ•°çš„æµç¨‹å¦‚ä¸‹ï¼š èŽ·å–é”ï¼ŒèŽ·å–å½“å‰æ•°ç»„ä¸ºcurrentï¼Œcurrenté•¿åº¦ä¸ºlenï¼Œåˆ¤æ–­æ•°ç»„ä¹‹å‰çš„å¿«ç…§snapshotæ˜¯å¦ç­‰äºŽå½“å‰æ•°ç»„currentï¼Œè‹¥ä¸ç›¸ç­‰ï¼Œåˆ™è¿›å…¥æ­¥éª¤2ï¼›å¦åˆ™ï¼Œè¿›å…¥æ­¥éª¤3 ä¸ç›¸ç­‰ï¼Œè¡¨ç¤ºåœ¨snapshotä¸Žcurrentä¹‹é—´ï¼Œå¯¹æ•°ç»„è¿›è¡Œäº†ä¿®æ”¹ï¼Œç›´æŽ¥è¿”å›žfalseç»“æŸ; è¯´æ˜Žå½“å‰æ•°ç»„ç­‰äºŽå¿«ç…§æ•°ç»„ï¼Œè¯´æ˜Žæ•°ç»„æ²¡æœ‰è¢«æ”¹å˜ã€‚åœ¨å½“å‰æ•°ç»„ä¸­ç´¢å¼•æŒ‡å®šå…ƒç´ ï¼Œè‹¥èƒ½å¤Ÿæ‰¾åˆ°ï¼Œè¯´æ˜Žå·²ç»å­˜åœ¨æ­¤å…ƒç´ ï¼Œç›´æŽ¥è¿”å›žfalseç»“æŸï¼›å¦åˆ™è¿›å…¥4 è¯´æ˜Žæ²¡æœ‰å½“å‰è¦æ’å…¥çš„å…ƒç´ ï¼Œé€šè¿‡æ•°ç»„å¤åˆ¶çš„æ–¹å¼æ·»åŠ åˆ°æœ«å°¾ æ— è®ºå¦‚ä½•ï¼Œéƒ½è¦é‡Šæ”¾é” äº”ã€èŽ·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´  1234567public E get(int index) &#123; return get(getArray(), index);&#125;private E get(Object[] a, int index) &#123; return (E) a[index];&#125; é€šè¿‡å†™æ—¶å¤åˆ¶çš„æ–¹å¼ï¼ŒCopyOnWriteArrayList çš„ get æ–¹æ³•ä¸ç”¨åŠ é”ä¹Ÿå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥ CopyOnWriteArrayList å¹¶å‘è¯»çš„æ•ˆçŽ‡æ˜¯éžå¸¸é«˜çš„ï¼Œå®ƒæ˜¯ç›´æŽ¥é€šè¿‡æ•°ç»„ä¸‹æ ‡èŽ·å–å…ƒç´ çš„ã€‚ å…­ã€æ€»ç»“ ç®€å•è€Œè¨€è¦è®°ä½å®ƒçš„ä¸‰ä¸ªç‰¹ç‚¹ï¼š CopyOnWriteArrayList æ˜¯ä¸€ä¸ªå¹¶å‘çš„æ•°ç»„å®¹å™¨ï¼Œå®ƒçš„åº•å±‚å®žçŽ°æ˜¯æ•°ç»„ã€‚ CopyOnWriteArrayList é‡‡ç”¨å†™æ—¶å¤åˆ¶çš„æ–¹å¼æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ é€šè¿‡å†™æ—¶å¤åˆ¶çš„æ–¹å¼ï¼Œå¯ä»¥é«˜æ•ˆçš„è¿›è¡Œå¹¶å‘è¯»ï¼Œä½†æ˜¯å¯¹äºŽå†™æ“ä½œï¼Œæ¯æ¬¡éƒ½è¦è¿›è¡ŒåŠ é”ä»¥åŠæ‹·è´å‰¯æœ¬ï¼Œæ•ˆçŽ‡éžå¸¸ä½Žï¼Œæ‰€ä»¥ CopyOnWriteArrayList ä»…é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚ Vectorè™½ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯åªæ˜¯ä¸€ç§ç›¸å¯¹çš„çº¿ç¨‹å®‰å…¨è€Œä¸æ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ï¼Œå®ƒåªèƒ½å¤Ÿä¿è¯å¢žã€åˆ ã€æ”¹ã€æŸ¥çš„å•ä¸ªæ“ä½œä¸€å®šæ˜¯åŽŸå­çš„ï¼Œä¸ä¼šè¢«æ‰“æ–­ï¼Œä½†æ˜¯å¦‚æžœç»„åˆèµ·æ¥ç”¨ï¼Œå¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚ CopyOnWriteArrayListåœ¨å¹¶å‘ä¸‹ä¸ä¼šäº§ç”Ÿä»»ä½•çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ å¦å¤–ï¼Œæœ‰ä¸¤ç‚¹å¿…é¡»è®²ä¸€ä¸‹ã€‚ æˆ‘è®¤ä¸ºCopyOnWriteArrayListè¿™ä¸ªå¹¶å‘ç»„ä»¶ï¼Œå…¶å®žåæ˜ çš„æ˜¯ä¸¤ä¸ªååˆ†é‡è¦çš„åˆ†å¸ƒå¼ç†å¿µï¼š ï¼ˆ1ï¼‰è¯»å†™åˆ†ç¦» æˆ‘ä»¬è¯»å–CopyOnWriteArrayListçš„æ—¶å€™è¯»å–çš„æ˜¯CopyOnWriteArrayListä¸­çš„Object[] arrayï¼Œä½†æ˜¯ä¿®æ”¹çš„æ—¶å€™ï¼Œæ“ä½œçš„æ˜¯ä¸€ä¸ªæ–°çš„Object[] arrayï¼Œè¯»å’Œå†™æ“ä½œçš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å°±æ˜¯è¯»å†™åˆ†ç¦»ã€‚è¿™ç§æŠ€æœ¯æ•°æ®åº“ç”¨çš„éžå¸¸å¤šï¼Œåœ¨é«˜å¹¶å‘ä¸‹ä¸ºäº†ç¼“è§£æ•°æ®åº“çš„åŽ‹åŠ›ï¼Œå³ä½¿åšäº†ç¼“å­˜ä¹Ÿè¦å¯¹æ•°æ®åº“åšè¯»å†™åˆ†ç¦»ï¼Œè¯»çš„æ—¶å€™ä½¿ç”¨è¯»åº“ï¼Œå†™çš„æ—¶å€™ä½¿ç”¨å†™åº“ï¼Œç„¶åŽè¯»åº“ã€å†™åº“ä¹‹é—´è¿›è¡Œä¸€å®šçš„åŒæ­¥ï¼Œè¿™æ ·å°±é¿å…åŒä¸€ä¸ªåº“ä¸Šè¯»ã€å†™çš„IOæ“ä½œå¤ªå¤š ï¼ˆ2ï¼‰æœ€ç»ˆä¸€è‡´ å¯¹CopyOnWriteArrayListæ¥è¯´ï¼Œçº¿ç¨‹1è¯»å–é›†åˆé‡Œé¢çš„æ•°æ®ï¼Œæœªå¿…æ˜¯æœ€æ–°çš„æ•°æ®ã€‚å› ä¸ºçº¿ç¨‹2ã€çº¿ç¨‹3ã€çº¿ç¨‹4å››ä¸ªçº¿ç¨‹éƒ½ä¿®æ”¹äº†CopyOnWriteArrayListé‡Œé¢çš„æ•°æ®ï¼Œä½†æ˜¯çº¿ç¨‹1æ‹¿åˆ°çš„è¿˜æ˜¯æœ€è€çš„é‚£ä¸ªObject[] arrayï¼Œæ–°æ·»åŠ è¿›åŽ»çš„æ•°æ®å¹¶æ²¡æœ‰ï¼Œæ‰€ä»¥çº¿ç¨‹1è¯»å–çš„å†…å®¹æœªå¿…å‡†ç¡®ã€‚ä¸è¿‡è¿™äº›æ•°æ®è™½ç„¶å¯¹äºŽçº¿ç¨‹1æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯å¯¹äºŽä¹‹åŽçš„çº¿ç¨‹ä¸€å®šæ˜¯ä¸€è‡´çš„ï¼Œå®ƒä»¬æ‹¿åˆ°çš„Object[] arrayä¸€å®šæ˜¯ä¸‰ä¸ªçº¿ç¨‹éƒ½æ“ä½œå®Œæ¯•ä¹‹åŽçš„Object array[]ï¼Œè¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´ã€‚æœ€ç»ˆä¸€è‡´å¯¹äºŽåˆ†å¸ƒå¼ç³»ç»Ÿä¹Ÿéžå¸¸é‡è¦ï¼Œå®ƒé€šè¿‡å®¹å¿ä¸€å®šæ—¶é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæå‡æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§ä¸Žåˆ†åŒºå®¹é”™æ€§ã€‚å½“ç„¶ï¼Œæœ€ç»ˆä¸€è‡´å¹¶ä¸æ˜¯ä»»ä½•åœºæ™¯éƒ½é€‚ç”¨çš„ï¼Œåƒç«è½¦ç«™å”®ç¥¨è¿™ç§ç³»ç»Ÿç”¨æˆ·å¯¹äºŽæ•°æ®çš„å®žæ—¶æ€§è¦æ±‚éžå¸¸éžå¸¸é«˜ï¼Œå°±å¿…é¡»åšæˆå¼ºä¸€è‡´æ€§çš„ã€‚ æœ€åŽæ€»ç»“ä¸€ç‚¹ï¼Œéšç€CopyOnWriteArrayListä¸­å…ƒç´ çš„å¢žåŠ ï¼ŒCopyOnWriteArrayListçš„ä¿®æ”¹ä»£ä»·å°†è¶Šæ¥è¶Šæ˜‚è´µï¼Œå› æ­¤ï¼ŒCopyOnWriteArrayListé€‚ç”¨äºŽè¯»æ“ä½œè¿œå¤šäºŽä¿®æ”¹æ“ä½œçš„å¹¶å‘åœºæ™¯ä¸­ã€‚ æ„Ÿè°¢ http://www.cnblogs.com/xrq730/p/5020760.html http://blog.csdn.net/u013124587/article/details/52863533 https://www.cnblogs.com/leesf456/p/5547853.html]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedList]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F2.LinkedList%2F</url>
    <content type="text"><![CDATA[æåˆ°ArrayListï¼Œå°±ä¼šæ¯”è¾ƒä¸ŽLinkedListçš„åŒºåˆ«ã€‚æœ¬æ–‡æ¥çœ‹çœ‹LinkedListçš„æ ¸å¿ƒåŽŸç†ã€‚ å¦‚å›¾æ‰€ç¤º LinkedList åº•å±‚æ˜¯åŸºäºŽåŒå‘é“¾è¡¨å®žçŽ°çš„ï¼Œä¹Ÿæ˜¯å®žçŽ°äº† List æŽ¥å£ï¼Œæ‰€ä»¥ä¹Ÿæ‹¥æœ‰ List çš„ä¸€äº›ç‰¹ç‚¹(JDK1.7/8 ä¹‹åŽå–æ¶ˆäº†å¾ªçŽ¯ï¼Œä¿®æ”¹ä¸ºåŒå‘é“¾è¡¨)ã€‚ ä¸€ã€LinkedListå±žæ€§ 123456//é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°.transient int size = 0;//Pointer to first node.transient Node&lt;E&gt; first;//Pointer to last node.transient Node&lt;E&gt; last; äºŒã€Nodeçš„ç»“æž„ 1234567891011private static class Node&lt;E&gt; &#123; E item; Node&lt;E&gt; next;//åŽç½®æŒ‡é’ˆ Node&lt;E&gt; prev;//å‰ç½®æŒ‡é’ˆ Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123; this.item = element; this.next = next; this.prev = prev; &#125;&#125; ä¸‰ã€æ·»åŠ å…ƒç´  3.1 LinkedListè¡¨å¤´æ·»åŠ ä¸€ä¸ªå…ƒç´  å½“å‘è¡¨å¤´æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¾ˆæ˜¾ç„¶å½“å‰èŠ‚ç‚¹çš„å‰é©±ä¸€å®šä¸º nullï¼Œè€ŒåŽç»§ç»“ç‚¹æ˜¯ first æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ï¼Œå½“ç„¶è¿˜è¦ä¿®æ”¹ first æŒ‡é’ˆæŒ‡å‘æ–°çš„å¤´èŠ‚ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒåŽŸæ¥çš„å¤´èŠ‚ç‚¹å˜æˆäº†ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿˜è¦ä¿®æ”¹åŽŸæ¥å¤´èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆï¼Œä½¿å®ƒæŒ‡å‘è¡¨å¤´èŠ‚ç‚¹ï¼Œæºç çš„å®žçŽ°å¦‚ä¸‹ï¼š 1234567891011121314151617public void addFirst(E e) &#123; linkFirst(e);&#125;private void linkFirst(E e) &#123; final Node&lt;E&gt; f = first; //æ–°èŠ‚ç‚¹å‰ç½®æŒ‡é’ˆæŒ‡å‘ç©ºï¼ŒåŽç½®æŒ‡é’ˆæŒ‡å‘firstèŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(null, e, f); //æ–°èŠ‚ç‚¹ä½œä¸ºæ–°çš„firstèŠ‚ç‚¹ first = newNode; if (f == null) last = newNode;//åˆå§‹å°±æ˜¯ä¸ªç©ºLinkedListçš„è¯ï¼ŒlastæŒ‡å‘å½“å‰æ–°èŠ‚ç‚¹ else f.prev = newNode;//åˆå§‹å€¼ä¸ä¸ºç©ºï¼Œå°†å…¶å‰ç½®æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ size++; modCount++;&#125; 3.2 LinkedListè¡¨å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´  å½“å‘è¡¨å°¾æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¾ˆæ˜¾ç„¶å½“å‰èŠ‚ç‚¹çš„åŽç»§ä¸€å®šä¸º nullï¼Œè€Œå‰é©±ç»“ç‚¹æ˜¯ last æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ï¼Œç„¶åŽè¿˜è¦ä¿®æ”¹ last æŒ‡é’ˆæŒ‡å‘æ–°çš„å°¾èŠ‚ç‚¹ã€‚æ­¤å¤–ï¼Œè¿˜è¦ä¿®æ”¹åŽŸæ¥å°¾èŠ‚ç‚¹çš„åŽç»§æŒ‡é’ˆï¼Œä½¿å®ƒæŒ‡å‘æ–°çš„å°¾èŠ‚ç‚¹ï¼Œæºç çš„å®žçŽ°å¦‚ä¸‹ï¼š 123456789101112131415161718public void addLast(E e) &#123; linkLast(e);&#125;void linkLast(E e) &#123; final Node&lt;E&gt; l = last; //æ–°èŠ‚ç‚¹å‰ç½®æŒ‡é’ˆæŒ‡å‘ç©ºï¼ŒåŽç½®æŒ‡é’ˆæŒ‡å‘firstèŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); //æ–°èŠ‚ç‚¹ä½œä¸ºæ–°çš„lastèŠ‚ç‚¹ last = newNode; //å¦‚æžœåŽŸæ¥æœ‰å°¾èŠ‚ç‚¹ï¼Œåˆ™æ›´æ–°åŽŸæ¥èŠ‚ç‚¹çš„åŽç»§æŒ‡é’ˆï¼Œå¦åˆ™æ›´æ–°å¤´æŒ‡é’ˆ if (l == null) first = newNode; else l.next = newNode; size++; modCount++;&#125; 3.3 LinkedListåœ¨æŒ‡å®šèŠ‚ç‚¹å‰æ·»åŠ ä¸€ä¸ªå…ƒç´  12345678910111213141516171819202122232425262728293031323334public void add(int index, E element) &#123; //åˆ¤æ–­æ•°ç»„æ˜¯å¦è¶Šç•Œ checkPositionIndex(index); if (index == size) linkLast(element);//ç›´æŽ¥æ’åœ¨æœ€åŽä¸€ä¸ª else linkBefore(element, node(index));//åœ¨indexèŠ‚ç‚¹ä¹‹å‰æ’å…¥&#125;private void checkPositionIndex(int index) &#123; if (!isPositionIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index));&#125;private boolean isPositionIndex(int index) &#123; return index &gt;= 0 &amp;&amp; index &lt;= size;&#125;void linkBefore(E e, Node&lt;E&gt; succ) &#123; // assert succ != null; //æ‰¾åˆ°ç´¢å¼•ä½ç½®çš„å‰é¢ä¸€ä¸ªå…ƒç´ pred final Node&lt;E&gt; pred = succ.prev; //æ–°èŠ‚ç‚¹ï¼Œå‰ç½®æŒ‡é’ˆæŒ‡å‘pred,åŽç½®æŒ‡é’ˆæŒ‡å‘ç´¢å¼•å¤„å…ƒç´  final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ); //ä¿®æ”¹ç´¢å¼•å‡ºå…ƒç´ çš„å‰ç½®æŒ‡é’ˆä¸ºæ–°èŠ‚ç‚¹ succ.prev = newNode; if (pred == null) first = newNode;//è¯´æ˜Žæ˜¯æ’åœ¨è¡¨å¤´ else pred.next = newNode;//è¯´æ˜Žæ˜¯æ’åœ¨éžè¡¨å¤´ä½ç½®ï¼Œä¿®æ”¹predåŽç½®æŒ‡é’ˆä¸ºæ–°æŒ‡é’ˆ size++; modCount++;&#125; å¯è§æ¯æ¬¡æ’å…¥éƒ½æ˜¯ç§»åŠ¨æŒ‡é’ˆï¼Œå’Œ ArrayList çš„æ‹·è´æ•°ç»„æ¥è¯´æ•ˆçŽ‡è¦é«˜ä¸Šä¸å°‘ã€‚ å››ã€åˆ é™¤å…ƒç´  åˆ é™¤æ“ä½œä¸Žæ·»åŠ æ“ä½œå¤§åŒå°å¼‚ï¼Œä¾‹å¦‚åˆ é™¤æŒ‡å®šèŠ‚ç‚¹çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œéœ€è¦æŠŠå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹çš„åŽç»§ä¿®æ”¹ä¸ºå½“å‰èŠ‚ç‚¹çš„åŽç»§ï¼Œä»¥åŠå½“å‰èŠ‚ç‚¹çš„åŽç»§ç»“ç‚¹çš„å‰é©±ä¿®æ”¹ä¸ºå½“å‰èŠ‚ç‚¹çš„å‰é©±ã€‚ å°±ä¸èµ˜è¿°äº†ã€‚ äº”ã€èŽ·å–å…ƒç´  12345678910111213141516171819202122//èŽ·å–æŒ‡å®šç´¢å¼•å¯¹åº”çš„å…ƒç´ public E get(int index) &#123; checkElementIndex(index); return node(index).item;&#125;//å¯»æ‰¾å…ƒç´ çš„æ–¹å‘æ˜¯æ ¹æ®indexåœ¨è¡¨ä¸­çš„ä½ç½®å†³å®šçš„Node&lt;E&gt; node(int index) &#123; // assert isElementIndex(index); if (index &lt; (size &gt;&gt; 1)) &#123;//ç´¢å¼•å°äºŽè¡¨é•¿çš„ä¸€åŠï¼Œä»Žè¡¨å¤´å¼€å§‹å¾€åŽæ‰¾ Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123;//ç´¢å¼•å¤§äºŽè¡¨é•¿çš„ä¸€åŠï¼Œä»Žè¡¨å°¾å¾€å‰å¼€å§‹æ‰¾ Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; &#125;&#125; ä¸Šè¿°ä»£ç ï¼Œåˆ©ç”¨äº†åŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼Œå¦‚æžœindexç¦»é“¾è¡¨å¤´æ¯”è¾ƒè¿‘ï¼Œå°±ä»ŽèŠ‚ç‚¹å¤´éƒ¨éåŽ†ã€‚å¦åˆ™å°±ä»ŽèŠ‚ç‚¹å°¾éƒ¨å¼€å§‹éåŽ†ã€‚ä½¿ç”¨ç©ºé—´ï¼ˆåŒå‘é“¾è¡¨ï¼‰æ¥æ¢å–æ—¶é—´ã€‚ node()ä¼šä»¥O(n/2)çš„æ€§èƒ½åŽ»èŽ·å–ä¸€ä¸ªç»“ç‚¹ å¦‚æžœç´¢å¼•å€¼å¤§äºŽé“¾è¡¨å¤§å°çš„ä¸€åŠï¼Œé‚£ä¹ˆå°†ä»Žå°¾ç»“ç‚¹å¼€å§‹éåŽ† è¿™æ ·çš„æ•ˆçŽ‡æ˜¯éžå¸¸ä½Žçš„ï¼Œç‰¹åˆ«æ˜¯å½“ index è¶ŠæŽ¥è¿‘ size çš„ä¸­é—´å€¼æ—¶ã€‚ æ€»ç»“ 1ã€ç†è®ºä¸Šæ— å®¹é‡é™åˆ¶ï¼Œåªå—è™šæ‹Ÿæœºè‡ªèº«é™åˆ¶å½±å“ï¼Œæ‰€ä»¥æ²¡æœ‰æ‰©å®¹æ–¹æ³•ã€‚ 2ã€å’ŒArrayListä¸€æ ·ï¼ŒLinkedListä¹Ÿæ˜¯æ˜¯æœªåŒæ­¥çš„ï¼Œå¤šçº¿ç¨‹å¹¶å‘è¯»å†™æ—¶éœ€è¦å¤–éƒ¨åŒæ­¥ï¼Œå¦‚æžœä¸å¤–éƒ¨åŒæ­¥ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨Collections.synchronizedListæ–¹æ³•å¯¹LinkedListçš„å®žä¾‹è¿›è¡Œä¸€æ¬¡å°è£…ã€‚ 3ã€å’ŒArrayListä¸€æ ·ï¼ŒLinkedListä¹Ÿå¯¹å­˜å‚¨çš„å…ƒç´ æ— é™åˆ¶ï¼Œå…è®¸nullå…ƒç´ ã€‚ 4ã€é¡ºåºæ’å…¥é€Ÿåº¦ArrayListä¼šæ¯”è¾ƒå¿«ï¼Œå› ä¸ºArrayListæ˜¯åŸºäºŽæ•°ç»„å®žçŽ°çš„ï¼Œæ•°ç»„æ˜¯äº‹å…ˆnewå¥½çš„ï¼Œåªè¦å¾€æŒ‡å®šä½ç½®å¡žä¸€ä¸ªæ•°æ®å°±å¥½äº†ï¼›LinkedListåˆ™ä¸åŒï¼Œæ¯æ¬¡é¡ºåºæ’å…¥çš„æ—¶å€™LinkedListå°†newä¸€ä¸ªå¯¹è±¡å‡ºæ¥ï¼Œå¦‚æžœå¯¹è±¡æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆnewçš„æ—¶é—´åŠ¿å¿…ä¼šé•¿ä¸€ç‚¹ï¼Œå†åŠ ä¸Šä¸€äº›å¼•ç”¨èµ‹å€¼çš„æ“ä½œï¼Œæ‰€ä»¥é¡ºåºæ’å…¥LinkedListå¿…ç„¶æ…¢äºŽArrayList 5ã€åŸºäºŽä¸Šä¸€ç‚¹ï¼Œå› ä¸ºLinkedListé‡Œé¢ä¸ä»…ç»´æŠ¤äº†å¾…æ’å…¥çš„å…ƒç´ ï¼Œè¿˜ç»´æŠ¤äº†Entryçš„å‰ç½®Entryå’ŒåŽç»§Entryï¼Œå¦‚æžœä¸€ä¸ªLinkedListä¸­çš„Entryéžå¸¸å¤šï¼Œé‚£ä¹ˆLinkedListå°†æ¯”ArrayListæ›´è€—è´¹ä¸€äº›å†…å­˜ 6ã€æ•°æ®éåŽ†çš„é€Ÿåº¦ï¼Œçœ‹æœ€åŽä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œå°±ä¸ç»†è®²äº†ï¼Œç»“è®ºæ˜¯ï¼šä½¿ç”¨å„è‡ªéåŽ†æ•ˆçŽ‡æœ€é«˜çš„æ–¹å¼ï¼ŒArrayListçš„éåŽ†æ•ˆçŽ‡ä¼šæ¯”LinkedListçš„éåŽ†æ•ˆçŽ‡é«˜ä¸€äº› 7ã€æœ‰äº›è¯´æ³•è®¤ä¸ºLinkedListåšæ’å…¥å’Œåˆ é™¤æ›´å¿«ï¼Œè¿™ç§è¯´æ³•å…¶å®žæ˜¯ä¸å‡†ç¡®çš„ï¼š LinkedListåšæ’å…¥ã€åˆ é™¤çš„æ—¶å€™ï¼Œæ…¢åœ¨å¯»å€ï¼Œå¿«åœ¨åªéœ€è¦æ”¹å˜å‰åŽEntryçš„å¼•ç”¨åœ°å€ ArrayListåšæ’å…¥ã€åˆ é™¤çš„æ—¶å€™ï¼Œæ…¢åœ¨æ•°ç»„å…ƒç´ çš„æ‰¹é‡copyï¼Œå¿«åœ¨å¯»å€ æ‰€ä»¥ï¼Œå¦‚æžœå¾…æ’å…¥ã€åˆ é™¤çš„å…ƒç´ æ˜¯åœ¨æ•°æ®ç»“æž„çš„å‰åŠæ®µå°¤å…¶æ˜¯éžå¸¸é å‰çš„ä½ç½®çš„æ—¶å€™ï¼ŒLinkedListçš„æ•ˆçŽ‡å°†å¤§å¤§å¿«è¿‡ArrayListï¼Œå› ä¸ºArrayListå°†æ‰¹é‡copyå¤§é‡çš„å…ƒç´ ï¼›è¶Šå¾€åŽï¼Œå¯¹äºŽLinkedListæ¥è¯´ï¼Œå› ä¸ºå®ƒæ˜¯åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥åœ¨ç¬¬2ä¸ªå…ƒç´ åŽé¢æ’å…¥ä¸€ä¸ªæ•°æ®å’Œåœ¨å€’æ•°ç¬¬2ä¸ªå…ƒç´ åŽé¢æ’å…¥ä¸€ä¸ªå…ƒç´ åœ¨æ•ˆçŽ‡ä¸ŠåŸºæœ¬æ²¡æœ‰å·®åˆ«ï¼Œä½†æ˜¯ArrayListç”±äºŽè¦æ‰¹é‡copyçš„å…ƒç´ è¶Šæ¥è¶Šå°‘ï¼Œæ“ä½œé€Ÿåº¦å¿…ç„¶è¿½ä¸Šä¹ƒè‡³è¶…è¿‡LinkedListã€‚ ä»Žè¿™ä¸ªåˆ†æžçœ‹å‡ºï¼Œå¦‚æžœä½ ååˆ†ç¡®å®šä½ æ’å…¥ã€åˆ é™¤çš„å…ƒç´ æ˜¯åœ¨å‰åŠæ®µï¼Œé‚£ä¹ˆå°±ä½¿ç”¨LinkedListï¼›å¦‚æžœä½ ååˆ†ç¡®å®šä½ åˆ é™¤ã€åˆ é™¤çš„å…ƒç´ åœ¨æ¯”è¾ƒé åŽçš„ä½ç½®ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ArrayListã€‚å¦‚æžœä½ ä¸èƒ½ç¡®å®šä½ è¦åšçš„æ’å…¥ã€åˆ é™¤æ˜¯åœ¨å“ªå„¿å‘¢ï¼Ÿé‚£è¿˜æ˜¯å»ºè®®ä½ ä½¿ç”¨LinkedListå§ï¼Œå› ä¸ºä¸€æ¥LinkedListæ•´ä½“æ’å…¥ã€åˆ é™¤çš„æ‰§è¡Œæ•ˆçŽ‡æ¯”è¾ƒç¨³å®šï¼Œæ²¡æœ‰ArrayListè¿™ç§è¶Šå¾€åŽè¶Šå¿«çš„æƒ…å†µï¼›äºŒæ¥æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œå¼„å¾—ä¸å¥½ArrayListå°±è¦è¿›è¡Œä¸€æ¬¡æ‰©å®¹ï¼Œè®°ä½ï¼ŒArrayListåº•å±‚æ•°ç»„æ‰©å®¹æ˜¯ä¸€ä¸ªæ—¢æ¶ˆè€—æ—¶é—´åˆæ¶ˆè€—ç©ºé—´çš„æ“ä½œ. 8ã€ArrayListä½¿ç”¨æœ€æ™®é€šçš„forå¾ªçŽ¯éåŽ†ï¼ŒLinkedListä½¿ç”¨foreachå¾ªçŽ¯æ¯”è¾ƒå¿«.æ³¨æ„åˆ°ArrayListæ˜¯å®žçŽ°äº†RandomAccessæŽ¥å£è€ŒLinkedListåˆ™æ²¡æœ‰å®žçŽ°è¿™ä¸ªæŽ¥å£.å…³äºŽRandomAccessè¿™ä¸ªæŽ¥å£çš„ä½œç”¨ï¼Œçœ‹ä¸€ä¸‹JDK APIä¸Šçš„è¯´æ³•ï¼š 9ã€å¦‚æžœä½¿ç”¨æ™®é€šforå¾ªçŽ¯éåŽ†LinkedListï¼Œåœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œå…¶éåŽ†é€Ÿåº¦å°†æ…¢å¾—ä»¤äººå‘æŒ‡ æ•´ç†è‡ªï¼š 1ã€http://www.cnblogs.com/xrq730/p/5005347.html 2ã€http://blog.csdn.net/u013124587/article/details/52837848 3ã€http://blog.csdn.net/u011392897/article/details/57115818 4ã€http://blog.csdn.net/fighterandknight/article/details/61476335]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArrayList/Vector]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F1.ArrayList%E5%92%8CVector%2F</url>
    <content type="text"><![CDATA[é¢è¯•ä¸­ï¼Œå…³äºŽjavaçš„ä¸€äº›å®¹å™¨ï¼ŒArrayListæ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸é—®çš„ï¼Œå°¤å…¶æ˜¯é‡Œé¢çš„æ‰©å®¹æœºåˆ¶ã€‚ ArrayList 12public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable ArrayList å®žçŽ°äºŽ Listã€RandomAccess æŽ¥å£ã€‚å¯ä»¥æ’å…¥ç©ºæ•°æ®ï¼Œä¹Ÿæ”¯æŒéšæœºè®¿é—®ã€‚ æž„é€ å‡½æ•°ä¸ºï¼š 123456789101112131415161718//ç”¨åˆå§‹å®¹é‡ä½œä¸ºå‚æ•°çš„æž„é€ æ–¹æ³•public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; //åˆå§‹å®¹é‡å¤§äºŽ0ï¼Œå®žä¾‹åŒ–æ•°ç»„ this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; //åˆå§‹å®¹é‡ç­‰äºŽ0ï¼Œèµ‹äºˆç©ºæ•°ç»„ this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity); &#125;&#125;//æ— å‚çš„æž„é€ æ–¹æ³•public ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;&#125; ä»Žæž„é€ æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒelementDataæ˜¯ä¸€ä¸ªå¤§å°ä¸º0çš„ç©ºæ•°ç»„ï¼Œå½“æˆ‘ä»¬æŒ‡å®šäº†åˆå§‹å¤§å°çš„æ—¶å€™ï¼ŒelementDataçš„åˆå§‹å¤§å°å°±å˜æˆäº†æˆ‘ä»¬æ‰€æŒ‡å®šçš„åˆå§‹å¤§å°äº†ã€‚ ArrayListç›¸å½“äºŽåŠ¨æ€æ•°æ®ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªå±žæ€§åˆ†åˆ«æ˜¯: elementData æ•°ç»„ï¼Œä»¥åŠ size å¤§å°ã€‚ åœ¨è°ƒç”¨ add() æ–¹æ³•çš„æ—¶å€™ï¼š 12345public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true;&#125; é¦–å…ˆè¿›è¡Œæ‰©å®¹æ ¡éªŒã€‚ å°†æ’å…¥çš„å€¼æ”¾åˆ°å°¾éƒ¨ï¼Œå¹¶å°† size + 1 ã€‚ å¦‚æžœæ˜¯è°ƒç”¨ add(index,e) åœ¨æŒ‡å®šä½ç½®æ·»åŠ çš„è¯ï¼š 12345678910public void add(int index, E element) &#123; rangeCheckForAdd(index); ensureCapacityInternal(size + 1); // Increments modCount!! //å¤åˆ¶ï¼Œå‘åŽç§»åŠ¨ System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++;&#125; ä¹Ÿæ˜¯é¦–å…ˆæ‰©å®¹æ ¡éªŒã€‚ æŽ¥ç€å¯¹æ•°æ®è¿›è¡Œå¤åˆ¶ï¼Œç›®çš„æ˜¯æŠŠ index ä½ç½®ç©ºå‡ºæ¥æ”¾æœ¬æ¬¡æ’å…¥çš„æ•°æ®ï¼Œå¹¶å°†åŽé¢çš„æ•°æ®å‘åŽç§»åŠ¨ä¸€ä¸ªä½ç½®ã€‚ å…¶å®žæ‰©å®¹æœ€ç»ˆè°ƒç”¨çš„ä»£ç : 1234567891011private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity);&#125; ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„å¤åˆ¶çš„è¿‡ç¨‹ï¼ŒArrayListæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯æ‰©1.5å€ï¼Œç„¶åŽè°ƒç”¨Arraysç±»çš„copyOfæ–¹æ³•ï¼ŒæŠŠå…ƒç´ é‡æ–°æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­åŽ»ã€‚ ç”±æ­¤å¯è§ ArrayList çš„ä¸»è¦æ¶ˆè€—æ˜¯æ•°ç»„æ‰©å®¹ä»¥åŠåœ¨æŒ‡å®šä½ç½®æ·»åŠ æ•°æ®ï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨æ—¶æœ€å¥½æ˜¯æŒ‡å®šå¤§å°ï¼Œå°½é‡å‡å°‘æ‰©å®¹ã€‚æ›´è¦å‡å°‘åœ¨æŒ‡å®šä½ç½®æ’å…¥æ•°æ®çš„æ“ä½œã€‚ åºåˆ—åŒ– ç”±äºŽ ArrayList æ˜¯åŸºäºŽåŠ¨æ€æ•°ç»„å®žçŽ°çš„ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ã€‚å› æ­¤ä½¿ç”¨äº† transient ä¿®é¥°ï¼Œå¯ä»¥é˜²æ­¢è¢«è‡ªåŠ¨åºåˆ—åŒ–ã€‚ 1transient Object[] elementData; å› æ­¤ ArrayList è‡ªå®šä¹‰äº†åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException&#123; // Write out element count, and any hidden stuff int expectedModCount = modCount; s.defaultWriteObject(); // Write out size as capacity for behavioural compatibility with clone() s.writeInt(size); // Write out all elements in the proper order. //åªåºåˆ—åŒ–äº†è¢«ä½¿ç”¨çš„æ•°æ® for (int i=0; i&lt;size; i++) &#123; s.writeObject(elementData[i]); &#125; if (modCount != expectedModCount) &#123; throw new ConcurrentModificationException(); &#125;&#125;private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException &#123; elementData = EMPTY_ELEMENTDATA; // Read in size, and any hidden stuff s.defaultReadObject(); // Read in capacity s.readInt(); // ignored if (size &gt; 0) &#123; // be like clone(), allocate array based upon size not capacity ensureCapacityInternal(size); Object[] a = elementData; // Read in all elements in the proper order. for (int i=0; i&lt;size; i++) &#123; a[i] = s.readObject(); &#125; &#125;&#125; å½“å¯¹è±¡ä¸­è‡ªå®šä¹‰äº† writeObject å’Œ readObject æ–¹æ³•æ—¶ï¼ŒJVM ä¼šè°ƒç”¨è¿™ä¸¤ä¸ªè‡ªå®šä¹‰æ–¹æ³•æ¥å®žçŽ°åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–ã€‚ ä»Žå®žçŽ°ä¸­å¯ä»¥çœ‹å‡º ArrayList åªåºåˆ—åŒ–äº†è¢«ä½¿ç”¨çš„æ•°æ®ã€‚ Vector Vector ä¹Ÿæ˜¯å®žçŽ°äºŽ List æŽ¥å£ï¼Œåº•å±‚æ•°æ®ç»“æž„å’Œ ArrayList ç±»ä¼¼,ä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„å­˜æ”¾æ•°æ®ã€‚ä¸è¿‡æ˜¯åœ¨ add() æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥å†™æ•°æ®ï¼Œä½†æ˜¯å¼€é”€è¾ƒå¤§ï¼Œæ‰€ä»¥ Vector æ˜¯ä¸€ä¸ªåŒæ­¥å®¹å™¨å¹¶ä¸æ˜¯ä¸€ä¸ªå¹¶å‘å®¹å™¨ã€‚ Vectoræ¯”ArrayListå¤šäº†ä¸€ä¸ªå±žæ€§ï¼š 1protected int capacityIncrement; è¿™ä¸ªå±žæ€§æ˜¯åœ¨æ‰©å®¹çš„æ—¶å€™ç”¨åˆ°çš„ï¼Œå®ƒè¡¨ç¤ºæ¯æ¬¡æ‰©å®¹åªæ‰©capacityIncrementä¸ªç©ºé—´å°±è¶³å¤Ÿäº†ã€‚è¯¥å±žæ€§å¯ä»¥é€šè¿‡æž„é€ æ–¹æ³•ç»™å®ƒèµ‹å€¼ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹æž„é€ æ–¹æ³•ï¼š 123456789101112131415public Vector(int initialCapacity, int capacityIncrement) &#123; super(); if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal Capacity: "+initialCapacity); this.elementData = new Object[initialCapacity]; this.capacityIncrement = capacityIncrement;&#125;public Vector(int initialCapacity) &#123; this(initialCapacity, 0);&#125;public Vector() &#123; this(10);&#125; ä»Žæž„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºVectorçš„é»˜è®¤å¤§å°ä¹Ÿæ˜¯10ï¼Œè€Œä¸”å®ƒåœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±å·²ç»åˆ›å»ºäº†æ•°ç»„äº†ï¼Œè¿™ç‚¹è·ŸArrayListä¸ä¸€æ ·ã€‚å†æ¥çœ‹ä¸€ä¸‹growæ–¹æ³•ï¼š 12345678910private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); elementData = Arrays.copyOf(elementData, newCapacity);&#125; ä»Žgrowæ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼ŒnewCapacityé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸¤å€çš„oldCapacityï¼Œè€Œå½“æŒ‡å®šäº†capacityIncrementçš„å€¼ä¹‹åŽï¼ŒnewCapacityå˜æˆäº†oldCapacity+capacityIncrementã€‚ ä»¥ä¸‹æ˜¯ add() æ–¹æ³•ï¼š 123456public synchronized boolean add(E e) &#123; modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = e; return true;&#125; ä»¥åŠæŒ‡å®šä½ç½®æ’å…¥æ•°æ®: 12345678910111213public void add(int index, E element) &#123; insertElementAt(element, index);&#125;public synchronized void insertElementAt(E obj, int index) &#123; modCount++; if (index &gt; elementCount) &#123; throw new ArrayIndexOutOfBoundsException(index + " &gt; " + elementCount); &#125; ensureCapacityHelper(elementCount + 1); System.arraycopy(elementData, index, elementData, index + 1, elementCount - index); elementData[index] = obj; elementCount++;&#125;]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2018å¹´çš„æœ€åŽä¸€å¤©ï¼Œå¯¹å•†åŸŽé¡¹ç›®çš„æž¶æž„åšä¸ªæ”¹é€ ]]></title>
    <url>%2F2019%2F01%2F20%2F2018%E5%B9%B4%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9%EF%BC%8C%E5%AF%B9%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%9E%B6%E6%9E%84%E5%81%9A%E4%B8%AA%E6%94%B9%E9%80%A0%2F</url>
    <content type="text"><![CDATA[ä¸€ç›´ä»¥æ¥éƒ½æ˜¯å­¦ä¹ æ…•è¯¾çš„å®žæˆ˜è§†é¢‘ï¼Œè™½ç„¶ä¹Ÿè·Ÿç€åšå‡ºäº†ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯æ€è·¯éƒ½æ˜¯åˆ«äººæä¾›å¥½çš„ï¼Œè„±ç¦»äº†è€å¸ˆï¼Œæˆ‘ä¸€ç›´åœ¨é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šèƒ½ä¸èƒ½ç‹¬ç«‹åœ°æŒ‰ç…§è‡ªå·±çš„æ€è·¯åšå‡ºä¸€äº›ä¸œè¥¿æ¥ï¼Ÿ å‰æ–¹å›¾ç‰‡é«˜èƒ½â€¦æ›´æœ‰å‡ åå…†gifæ¼”ç¤ºåŠ¨ç”»ï¼Œå›¾ç‰‡å…¨éƒ¨å­˜æ”¾äºŽä¸ƒç‰›äº‘ä¸Šã€‚ åœ¨åŽ»å¹´ï¼Œå³2017å¹´å¹´åº•ï¼Œæˆ‘åœ¨æ…•è¯¾ä¸Šå­¦ä¹ äº†è¿™ä¸¤é—¨è¯¾ç¨‹ï¼š ç¬¬ä¸€æœŸé¡¹ç›®å®žçŽ°äº†æ¯”è¾ƒç®€å•çš„ç”µå•†ä¸šåŠ¡ï¼Œæ•´åˆSSMï¼Œå¹¶ä¸”éƒ¨ç½²åˆ°äº‘ç«¯ã€‚ ç¬¬äºŒæœŸå®žçŽ°äº†tomcaté›†ç¾¤ï¼Œé…åˆrediså®žçŽ°åˆ†å¸ƒå¼sessionï¼Œè¿˜æœ‰ä¸€äº›å®šæ—¶ä»»åŠ¡ã€redisåˆ†å¸ƒå¼é”ã€mavençŽ¯å¢ƒéš”ç¦»çš„ä¸€äº›ä¸œè¥¿ï¼Œè¿˜æ¶‰åŠå¾ˆå¤šspringå’Œspringmvcçš„æœ‰ç”¨çš„æœºå·§ã€‚ æ•´ä½“æ„Ÿè§‰æ˜¯ï¼šä¸€æœŸå®žçŽ°ä¸šåŠ¡ï¼ŒäºŒæœŸå¯¹äºŽä¸€æœŸçš„æé«˜ä¸æ˜¯å¤ªå¤§ï¼Œè·Ÿåˆ†å¸ƒå¼æ— å¤ªå¤§å…³ç³»ï¼Œä»…ä»…å®žçŽ°äº†å•ç‚¹ç™»é™†å’Œåˆ†å¸ƒå¼sessionå­˜å‚¨è€Œå·²ã€‚ ä¸ªäººæ„Ÿè§‰ä¸‹ä¸€æœŸçš„è¯¾ç¨‹åº”è¯¥æ˜¯springCloudçš„åˆ†å¸ƒå¼æ”¹é€ ï¼Œè¿›è¡ŒæœåŠ¡æ‹†åˆ†å’Œæ²»ç†ã€‚æ‰€ä»¥ï¼Œåœ¨æ•´åˆè¿™ä¸¤ä¸ªè¯¾ç¨‹çš„åŸºç¡€ä¸Šç”¨springCloudè¿›è¡Œå¾®æœåŠ¡æ²»ç†ã€‚ é¡¹ç›®è¯¦ç»†æè¿° é¡¹ç›®æºç åœ°å€ï¼šhttps://github.com/sunweiguo/MMall æ•´ä½“æ•ˆæžœæ¼”ç¤ºï¼š ä¸‹é¢è´´ä¸ªå°ä¸€ç‚¹çš„gif: éƒ¨åˆ†é¡µé¢æˆªå›¾ï¼š ç»è¿‡ä¸€ééæµ‹è¯•ï¼Œå•†åŸŽè¿˜æ˜¯å­˜åœ¨ä¸€äº›æ— ä¼¤å¤§é›…çš„bugï¼Œä½†æ˜¯ä¸»è¦è¿˜æ˜¯é”»ç‚¼è‡ªå·±çš„èƒ½åŠ›å˜›ï¼ ä¸‹è®¢å•çš„æ—¶å€™ï¼ŒæŠ¥é”™ï¼šå•†å“ä¸å­˜åœ¨æˆ–åº“å­˜ä¸è¶³ï¼Œæ˜¯å› ä¸ºæˆ‘æ¨¡æ‹Ÿçš„ç§’æ€ï¼Œæ‰€ä»¥å•†å“çš„åº“å­˜è¦æå‰é¢„ç½®äºŽredisä¸­ï¼ŒåŽç«¯ç®¡ç†ç³»ç»Ÿçš„å•†å“ç®¡ç†é¡µé¢æœ‰é¢„ç½®åº“å­˜çš„æŒ‰é’®ã€‚ æ–°å¢žå•†å“çš„æ—¶å€™ï¼Œå¯¹äºŽä¸Šä¼ å›¾ç‰‡ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ä¸€ä¼šï¼Œéœ€è¦ç­‰å¾…FTPæœåŠ¡å™¨ä¸Šä¼ å®Œæ¯•ï¼Œç»™ä¸€ä¸ªè¿”å›žä¿¡æ¯(Mapï¼Œæ˜¯å›¾ç‰‡çš„æ–‡ä»¶å)æ‰èƒ½çœŸæ­£æ˜¾ç¤ºï¼ˆå¯¹äºŽå¯Œæ–‡æœ¬ä¸­çš„å›¾ç‰‡ä¸Šä¼ ï¼Œåœ¨ä¸Šä¼ ä¹‹åŽéœ€è¦ç­‰å¾…ä¸€ä¼šï¼Œæ—¶é—´ä¸Žå°å›¾ä¸Šä¼ å·®ä¸å¤šï¼Œå¦åˆ™ç›´æŽ¥ä¿å­˜ä¸æŠ¥é”™ï¼Œä½†æ˜¯å‰ç«¯çœ‹ä¸åˆ°å›¾ï¼Œå› ä¸ºè¿˜æ²¡ä¸Šä¼ å®Œæ¯•,urlè¿˜æ²¡å›žä¼ å›žæ¥ï¼‰ æ™®é€šæ³¨å†Œçš„è´¦å·ï¼Œæ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæ‰€ä»¥ä¸èƒ½ç™»é™†åŽå°ç®¡ç†ç³»ç»Ÿã€‚ åŽæ¥åšäº†eurekaé›†ç¾¤ï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶è¿˜æ˜¯åªæŒ‡å‘å…¶ä¸­ä¸€ä¸ªeureka åœ¨å­¦ä¹ çš„è§†é¢‘ä¸­ï¼Œä¸€æœŸåªæ˜¯å®žçŽ°ä¸šåŠ¡åŠŸèƒ½ï¼Œå•ä½“æž¶æž„ï¼Œä¸€ä¸ªtomcatã€‚äºŒæœŸå¯¹å…¶åšäº†é›†ç¾¤ï¼Œå¹¶ä¸”è§£å†³äº†é›†ç¾¤æ¨¡å¼ä¸‹sessionå­˜å‚¨é—®é¢˜ï¼Œå®žçŽ°äº†æ¯”è¾ƒç®€å•çš„å•ç‚¹ç™»é™†åŠŸèƒ½ã€‚æž¶æž„å¦‚ä¸‹ï¼š å¯¹äºŽä¸Šé¢çš„æž¶æž„æ¥è¯´ï¼Œåªæ˜¯åšäº†ä¸€äº›é›†ç¾¤è¿›è¡Œä¼˜åŒ–ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œç”¨æˆ·æœåŠ¡ç­‰å…¶ä»–æœåŠ¡å¿…ç„¶è¦æ‹†åˆ†å‡ºæ¥ç‹¬ç«‹æˆä¸ºä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸€æ–¹é¢ä¸€ä¸ªå›¢é˜Ÿè´Ÿè´£ä¸€ä¸ªæœåŠ¡å¯ä»¥æé«˜å¼€å‘æ•ˆçŽ‡ï¼Œå¦å¤–ï¼Œå¯¹äºŽæ‰©å±•æ€§ä¹Ÿæ˜¯éžå¸¸æœ‰åˆ©çš„ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œä¼šå¸¦æ¥å¾ˆå¤šçš„å¤æ‚æ€§ï¼Œå°¤å…¶æ˜¯å¼•å…¥äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ‰€ä»¥ä¸èƒ½ä¸ºäº†åˆ†å¸ƒå¼è€Œåˆ†å¸ƒå¼ï¼Œè€Œæ˜¯é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯è€Œé‡‡ç”¨åˆé€‚çš„æž¶æž„ã€‚ å¾®æœåŠ¡çš„å®žçŽ°ï¼Œä¸»è¦æœ‰ä¸¤ç§ï¼Œå›½å†…æ˜¯é˜¿é‡Œç³»çš„ä»¥dubbo+zookeeperä¸ºæ ¸å¿ƒçš„ä¸€å¥—æœåŠ¡æ²»ç†å’Œå‘çŽ°ç”Ÿæ€ã€‚å¦ä¸€ä¸ªåˆ™æ˜¯å¤§åé¼Žé¼Žçš„spring cloudæ ˆã€‚ spring cloudå¹¶ä¸æ˜¯åƒspringæ˜¯ä¸€ä¸ªæ¡†æž¶ï¼Œä»–æ˜¯è§£å†³å¾®æœåŠ¡çš„ä¸€ç§æ–¹æ¡ˆï¼Œæ˜¯ç”±å„ç§ä¼˜ç§€å¼€æºç»„ä»¶å…±åŒé…åˆè€Œå®žçŽ°çš„å¾®æœåŠ¡æ²»ç†æž¶æž„ã€‚ä¸‹é¢çš„å›¾æ˜¯æˆ‘æž„æ€çš„é¡¹ç›®ç»“æž„å›¾ï¼š æœ€å‰é¢æ˜¯Nginxï¼Œè¿™é‡Œå°±ä½œä¸ºä¸€ä¸ªé™æ€èµ„æºæ˜ å°„å’Œè´Ÿè½½å‡è¡¡ï¼Œnginxä¸­æœ‰å‡ ä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºwww.oursnail.cn.confï¼Œè¿™ä¸ªä¸»è¦æ˜¯å¯¹zuulç½‘å…³åœ°å€åšä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼ŒæŒ‡å‘ç½‘å…³æ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ‰¾åˆ°å‰å°é¡µé¢æ‰€åœ¨ä½ç½®å¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“ã€‚admin.oursnail.cn.confï¼Œè¿™ä¸ªä¸»è¦æ˜¯é…ç½®åŽç«¯ä»¥åŠåŽç«¯çš„é¡µé¢æ–‡ä»¶ï¼›img.oursnail.cn.confæ˜¯å¯¹å›¾ç‰‡æœåŠ¡å™¨åœ°å€è¿›è¡Œæ˜ å°„ã€‚ ç„¶åŽæ˜¯zuulç½‘å…³ï¼Œè¿™é‡Œä¸»è¦æ˜¯ç”¨æ¥é™æµã€é‰´æƒä»¥åŠè·¯ç”±è½¬å‘ã€‚ å†åŽé¢å°±æ˜¯æˆ‘ä»¬çš„åº”ç”¨æœåŠ¡å™¨å•¦ã€‚å¯¹æœåŠ¡å™¨è¿›è¡Œäº†æœåŠ¡è¿½è¸ª(sleuth)ï¼Œå®žçŽ°äº†åŠ¨æ€åˆ·æ–°é…ç½®(spring cloud config+bus)ç­‰åŠŸèƒ½ã€‚ä»¥http restfulçš„æ–¹å¼è¿›è¡Œé€šä¿¡(openFeign),æž„å»ºèµ·ä»¥eurekaä¸ºæ³¨å†Œä¸­å¿ƒçš„åˆ†å¸ƒå¼æž¶æž„ã€‚ æ¯ä¸ªæœåŠ¡éƒ½æ˜¯åŸºäºŽspringbootæ‰“é€ ï¼Œç»“åˆmybatisæŒä¹…å±‚æ“ä½œçš„æ¡†æž¶ï¼Œå®ŒæˆåŸºæœ¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚springbootåŸºäºŽspringï¼Œç‰¹ç‚¹æ˜¯å¿«é€Ÿå¯åŠ¨ã€å†…ç½®tomcatä»¥åŠæ— xmlé…ç½®ã€‚å°†å¾ˆå¤šä¸œè¥¿å°è£…èµ·æ¥ï¼Œå¼•å…¥pomå°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨ï¼Œæ¯”å¦‚springMVCå°±åŸºæœ¬ä¸Šå¼•å…¥starter-webå³å¯ã€‚ ç”±äºŽèµ„æºçš„åŽŸå› ï¼Œåªæœ‰ä¸‰å°æœ€ä½Žé…çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥æœ¬æ¥æƒ³åšçš„åŸºäºŽESçš„å…¨æ–‡æ£€ç´¢æœåŠ¡æ²¡æœ‰åšï¼Œä¹Ÿæ²¡æœ‰åˆ†åº“åˆ†è¡¨ã€‚ è‡³äºŽå®šæ—¶ä»»åŠ¡ä»¥åŠHystrixæœåŠ¡ç†”æ–­å’Œé™çº§ï¼Œæ¯”è¾ƒç®€å•ï¼Œå°±ä¸åšäº†ã€‚ é¡¹ç›®çš„æŽ¥å£æ–‡æ¡£è¯¦è§wikiï¼šhttps://github.com/sunweiguo/spring-cloud-for-snailmall/wiki é¡¹ç›®çš„æ•°æ®åº“è¡¨è®¾è®¡ï¼šsnailmall.sql ä¸‹é¢è¯¦ç»†ä»‹ç»æ¯ä¸ªæ¨¡å—å®žçŽ°çš„å¤§ä½“æ€è·¯ï¼ˆä»…ä¾›å‚è€ƒï¼Œæ¯•ç«Ÿåº”å±Šç”Ÿï¼ŒçœŸå®žé¡¹ç›®æ²¡åšè¿‡ï¼‰ï¼š ç”¨æˆ·æ¨¡å— å…³äºŽç”¨æˆ·æ¨¡å—ï¼Œæ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ç™»é™†ã€‚å†æ ¸å¿ƒæ˜¯å¦‚ä½•éªŒè¯ä»¥åŠå¦‚ä½•å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€‚è¿™é‡Œé‡‡å–çš„æ–¹æ¡ˆä¸ºï¼š å¯¹äºŽç”¨æˆ·æ³¨å†Œï¼Œæˆ‘è¿™é‡Œå°±æ˜¯ç”¨æˆ·åï¼ˆæ˜µç§°ï¼‰ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯ä¸é‡å¤å‘¢ï¼ˆé«˜å¹¶å‘ï¼‰ï¼Ÿè¿™é‡Œè¿˜æ˜¯ç”¨äº†åˆ†å¸ƒå¼é”æ¥ä¿è¯çš„ã€‚ å¯¹äºŽæœªç™»é™†ç« å°ä¸‹ç”¨æˆ·ä¿®æ”¹å¯†ç ï¼Œé€»è¾‘ä¸ºï¼š è´­ç‰©è½¦æ¨¡å— è®¢å•æ¨¡å— é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œæˆ‘æƒ³è¯´ä¸€ä¸‹æˆ‘çš„æ€è·¯ã€‚ å¯¹äºŽå¹‚ç­‰æ€§ï¼Œè¿™é‡Œäº§ç”Ÿå¹‚ç­‰æ€§çš„ä¸»è¦åŽŸå› åœ¨äºŽMQçš„é‡ä¼ æœºåˆ¶ï¼Œå¯èƒ½ç¬¬ä¸€ä¸ªæ¶ˆæ¯ä¹…ä¹…æ²¡æœ‰å‘å‡ºåŽ»ï¼Œç„¶åŽé‡æ–°å‘é€ä¸€æ¡ï¼Œç»“æžœç¬¬ä¸€æ¡æ¶ˆæ¯çªç„¶åˆå¥½äº†ï¼Œé‚£ä¹ˆå°±ä¼šé‡å¤å‘ä¸¤è·³ï¼Œå¯¹äºŽç”¨æˆ·æ¥è¯´ï¼Œåªä¸‹ä¸€æ¬¡å•ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸‹äº†å¤šæ¬¡è®¢å•ã€‚ç½‘ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜çš„æ€è·¯æ˜¯åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¦‚æžœæ˜¯é‡å¤çš„è®¢å•å·ï¼Œå°±ä¸å¯èƒ½åˆ›å»ºå¤šæ¬¡äº†ã€‚è¿˜æœ‰ä¸€ç§å¯èƒ½æ–¹æ¡ˆæ˜¯ç”¨åˆ†å¸ƒå¼é”å¯¹è¯¥è®¢å•å·é”ä½ä¸€æ®µæ—¶é—´ï¼Œç”±äºŽåªæ˜¯é”ä½è®¢å•å·ï¼Œæ‰€ä»¥ä¸å½±å“æ€§èƒ½ï¼Œåœ¨è¿™ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸å¯ä»¥å†æ”¾åŒä¸€ä¸ªè®¢å•å·çš„è¯·æ±‚è¿›æ¥ã€‚ å¯¹äºŽMQæ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œåªèƒ½æ˜¯è®¢é˜…æ¨¡å¼äº†ã€‚æ¶ˆæ¯å‘å‡ºåŽ»ä¹‹åŽï¼Œæ¶ˆè´¹ç«¯ç»™MQå›žå¤ä¸€ä¸ªæŽ¥æ”¶åˆ°çš„ä¿¡æ¯ï¼ŒMQæœ¬æ¬¡æ¶ˆè´¹æˆåŠŸï¼Œç»™è®¢é˜…è€…ä¸€ä¸ªå›žå¤ã€‚ å¯¹äºŽå…¨å±€å”¯ä¸€IDç”Ÿæˆï¼Œè¿™é‡Œç”¨çš„æ˜¯é›ªèŠ±ç®—æ³•ï¼Œå…·ä½“ä»‹ç»å¯ä»¥çœ‹æˆ‘çš„ç¬”è®° å¯¹äºŽåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå…¶å®žå¹¶æ²¡æœ‰çœŸæ­£å¤„ç†ï¼Œå¯¹äºŽæ•°æ®åº“æ‰£å‡åº“å­˜å’Œæ•°æ®åº“æ’å…¥è®¢å•ï¼Œä»–ä»¬åœ¨ä¸åŒçš„æ•°æ®åº“ï¼Œå»–å¸ˆå…„æ¯”è¾ƒå€¾å‘çš„æ–¹å¼æ˜¯ï¼š è¿™ä¸€åˆ‡çš„åŸºç¡€è¿˜æ˜¯éœ€è¦æœ‰ä¸€ä¸ªå¯é çš„æ¶ˆæ¯æœåŠ¡ï¼Œç¡®ä¿æ¶ˆæ¯è¦èƒ½é€è¾¾ã€‚ é’ˆå¯¹redisé¢„å‡åº“å­˜å­˜åœ¨çš„å¹¶å‘é—®é¢˜ï¼Œè¿™é‡Œçš„æ€è·¯æ˜¯ç”¨lua+redisï¼Œåœ¨é¢„å‡ä¹‹å‰åˆ¤æ–­åº“å­˜æ˜¯å¦å¤Ÿï¼Œè¿™ä¸¤ä¸ªæ“ä½œè¦åœ¨ä¸€ä¸ªåŽŸå­æ“ä½œé‡Œé¢æ‰è¡Œï¼Œluaæ°å¥½å¯ä»¥å®žçŽ°åŽŸå­æ€§ã€é¡ºåºæ€§åœ°æ“ä½œã€‚ æ”¯ä»˜æ¨¡å— è¿™é‡Œå¯¹æŽ¥çš„æ˜¯æ”¯ä»˜å®-æ‰«ç æ”¯ä»˜ï¼Œç”¨åˆ°æ˜¯æ”¯ä»˜å®æ²™ç®±çŽ¯å¢ƒã€‚æ”¯ä»˜çš„æ‰«ç æ”¯ä»˜è¯¦ç»†æµç¨‹åœ¨è¿™é‡ŒèŠä¸€èŠå“ˆã€‚ å•†æˆ·å‰å°å°†å•†å“å‚æ•°å‘é€è‡³å•†æˆ·åŽå°ï¼Œå•†æˆ·åŽå°ç”Ÿæˆå†…éƒ¨è®¢å•å·å¹¶ç”¨äºŽè¯·æ±‚æ”¯ä»˜å¹³å°åˆ›å»ºé¢„ä¸‹å•ï¼Œæ”¯ä»˜å¹³å°åˆ›å»ºå®Œé¢„è®¢å•åŽå°†è®¢å•äºŒç»´ç ä¿¡æ¯è¿”è¿˜ç»™å•†æˆ·ï¼Œæ­¤æ—¶ç”¨æˆ·å³å¯æ‰«å–äºŒç»´ç è¿›è¡Œä»˜æ¬¾æ“ä½œã€‚ å†…éƒ¨è®¢å•å·ï¼šè¿™æ˜¯ç›¸å¯¹äºŽæ”¯ä»˜å®å¹³å°è€Œè¨€çš„ï¼Œè¿™ä¸ªè®¢å•å·æ˜¯æˆ‘ä»¬å•†åŸŽè‡ªå·±ç”Ÿæˆçš„ï¼Œå¯¹äºŽæˆ‘ä»¬å•†åŸŽæ¥è¯´æ˜¯å†…éƒ¨è®¢å•å·ï¼Œä½†æ˜¯å¯¹äºŽæ”¯ä»˜å®æ¥è¯´æ˜¯å¤–éƒ¨è®¢å•å·ã€‚ å°†ä¸€ç³»åˆ—çš„æ•°æ®æŒ‰ç…§æ”¯ä»˜å®çš„è¦æ±‚å‘é€ç»™æ”¯ä»˜å®å¹³å°ï¼ŒåŒ…æ‹¬å•†å“ä¿¡æ¯ï¼Œç”Ÿæˆçš„éªŒç­¾signï¼Œå…¬é’¥ï¼›æ”¯ä»˜å®åŽ»å°†signè§£å¯†ï¼Œè¿›è¡Œå•†å“çš„å„ç§ä¿¡æ¯æ ¡éªŒã€‚æ ¡éªŒé€šè¿‡ï¼ŒåŒæ­¥è¿”å›žäºŒç»´ç ä¸²ã€‚ æ”¯ä»˜ä¸šåŠ¡æµç¨‹å›¾ï¼š åœ¨èŽ·å–æ”¯ä»˜çš„äºŒç»´ç ä¸²ä¹‹åŽï¼Œç”¨å·¥å…·åŒ…å°†å…¶è½¬æ¢æœªäºŒç»´ç å±•ç¤ºç»™ç”¨æˆ·æ‰«ç ã€‚ ç”¨æˆ·æ‰«ç åŽï¼Œä¼šæ”¶åˆ°ç¬¬ä¸€æ¬¡æ”¯ä»˜å®çš„å›žè°ƒï¼Œå±•ç¤ºè¦æ”¯ä»˜çš„é‡‘é¢ï¼Œå•†å“ä¿¡æ¯ç­‰ã€‚ ç”¨æˆ·è¾“å…¥å¯†ç æˆåŠŸåŽï¼Œæ­£å¸¸æƒ…å†µä¼šæ”¶åˆ°æ”¯ä»˜å®çš„ç¬¬äºŒæ¬¡å›žè°ƒï¼Œå³æ”¯ä»˜æˆåŠŸä¿¡æ¯ã€‚ ä½†æ˜¯ä¹Ÿå¯èƒ½ä¼šç”±äºŽç½‘ç»œç­‰åŽŸå› ï¼Œè¿Ÿè¿Ÿæ”¶ä¸åˆ°æ”¯ä»˜å®çš„å›žè°ƒï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸»åŠ¨å‘èµ·è½®è¯¢åŽ»æŸ¥çœ‹æ”¯ä»˜çŠ¶æ€ã€‚ åœ¨æ”¯ä»˜æˆåŠŸä¹‹åŽï¼ŒæŽ¥æ”¶å›žè°ƒçš„æŽ¥å£è¦è®°å¾—è¿”å›žsuccesså‘Šè¯‰æ”¯ä»˜å®æˆ‘å·²ç»æ”¶åˆ°ä½ çš„å›žè°ƒäº†ï¼Œä¸è¦å†é‡å¤å‘ç»™æˆ‘äº†ã€‚æŽ¥æ”¶å›žè°ƒçš„æŽ¥å£ä¹Ÿè¦åšå¥½åŽ»é™¤é‡å¤æ¶ˆæ¯çš„é€»è¾‘ã€‚ è¿™ä¸ªæµç¨‹æ˜¯å¤šä¹ˆåœ°ç®€å•è€Œç†æ‰€å½“ç„¶ï¼ å¯¹åº”äºŽä»£ç å±‚é¢ï¼Œå…¶å®žå°±æ˜¯ä¸¤ä¸ªæŽ¥å£ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·ç‚¹å‡»åŽ»æ”¯ä»˜æŒ‰é’®ï¼Œæ­¤æ—¶å‘èµ·é¢„ä¸‹å•ï¼Œå±•ç¤ºä»˜æ¬¾äºŒç»´ç ï¼Œå¦ä¸€ä¸ªæ˜¯æŽ¥æ”¶æ”¯ä»˜å®å›žè°ƒï¼š é¢„ä¸‹å•ï¼š æŽ¥æ”¶æ”¯ä»˜å®æ”¯ä»˜çŠ¶æ€å›žè°ƒï¼š é¡¹ç›®è¿›å±• [x] 2018/12/31 å®Œæˆäº†èšåˆå·¥ç¨‹çš„åˆ›å»ºã€EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒã€spring cloud config+gitHub+spring cloud busï¼ˆrabbitMQï¼‰å®žçŽ°é…ç½®è‡ªåŠ¨åˆ·æ–°â€“v1.0 [x] 2018/12/31 å°†Eurekaæ³¨å†Œä¸­å¿ƒ(å•æœº)å’Œé…ç½®ä¸­å¿ƒéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ¯”è¾ƒå›ºå®šï¼Œæ‰€ä»¥å…ˆéƒ¨ç½²ä¸ŠåŽ»ï¼Œä»¥åŽæœ¬åœ°å°±ç›´æŽ¥ç”¨è¿™ä¸¤ä¸ªå³å¯ï¼Œå¯¹é…ç½®è¿›è¡Œäº†ä¸€ç‚¹ç‚¹ä¿®æ”¹ [ ] 2018/12/31 å…³äºŽé…ç½®çš„è‡ªåŠ¨åˆ·æ–°ï¼Œç”¨postmanå‘é€postè¯·æ±‚æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç”¨github webhookä¸è¡Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„é—®é¢˜ [x] 2018/12/31 ç”¨æˆ·æ¨¡å—çš„é€»è¾‘å®žçŽ°,é¦–å…ˆå¢žåŠ äº†ä¸€äº›pomæ–‡ä»¶çš„æ”¯æŒï¼Œæ•´åˆmybatisï¼Œæµ‹è¯•æ•°æ®åº“éƒ½é€šè¿‡ï¼Œä¸‹é¢å°±å¯ä»¥çœŸæ­£åŽ»å®žçŽ°ä¸šåŠ¡ä»£ç äº† [x] 2019/1/1 å®Œæˆç”¨æˆ·æ³¨å†Œã€ç™»é™†ã€æ ¡éªŒç”¨æˆ·åé‚®ç®±æœ‰æ•ˆæ€§ã€æŸ¥çœ‹ç™»é™†ç”¨æˆ·ä¿¡æ¯ã€æ ¹æ®ç”¨æˆ·ååŽ»æ‹¿åˆ°å¯¹åº”çš„é—®é¢˜ã€æ ¡éªŒç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€é‡ç½®å¯†ç è¿™ä¸ªå‡ ä¸ªæŽ¥å£ï¼Œåœ¨æ³¨å†Œè¿™ä¸ªæŽ¥å£ï¼Œå¢žåŠ ä¸€ä¸ªZKåˆ†å¸ƒå¼é”æ¥é˜²æ­¢åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å‡ºçŽ°ç”¨æˆ·åæˆ–é‚®ç®±é‡å¤é—®é¢˜ [x] 2019/1/2 ä¸Šåˆå®Œæˆé—¨æˆ·ç”¨æˆ·æ¨¡å—æ‰€æœ‰æŽ¥å£â€“v2.0 [x] 2019/1/2 ä¸‹åˆå®Œæˆå“ç±»ç®¡ç†æ¨¡å—ï¼Œå…³äºŽç¹ççš„èŽ·å–ç”¨æˆ·å¹¶ä¸”é‰´æƒå·¥ä½œï¼Œè¿™é‡Œå…ˆæ”¾æ¯ä¸ªæŽ¥å£é‡Œé¢å¤„ç†ï¼ŒåŽé¢æ”¾åˆ°ç½‘å…³ä¸­åŽ»å®žçŽ°â€“v3.0 [x] 2019/1/3 ä¸Šåˆå¼•å…¥ç½‘å…³æœåŠ¡ï¼Œå°†åŽå°é‡å¤çš„æƒé™æ ¡éªŒç»Ÿä¸€æ”¾åˆ°ç½‘å…³ä¸­åŽ»åšï¼Œå¹¶ä¸”åŠ äº†é™æµï¼Œè§£å†³äº†ä¸€ä¸‹è·¨åŸŸé—®é¢˜ã€‚â€“v4.0 [x] 2019/1/3 ä¸‹åˆå’Œæ™šä¸Šå®Œæˆé—¨æˆ·å’ŒåŽå°çš„å•†å“ç®¡ç†æ¨¡å—æ‰€æœ‰çš„æŽ¥å£åŠŸèƒ½ï¼Œé™¤äº†ä¸Šä¼ æ–‡ä»¶çš„ä¸¤ä¸ªæŽ¥å£æ²¡æœ‰æµ‹è¯•ä»¥å¤–ï¼Œå…¶ä»–æŽ¥å£éƒ½è¿›è¡Œäº†ç®€å•çš„æµ‹è¯•ï¼Œå…¶ä¸­è¿˜ç”¨FeignåŽ»è°ƒç”¨äº†å“ç±»æœåŠ¡æŽ¥å£â€“v5.0 [x] 2019/1/3 åˆæ­¥æŠŠè´­ç‰©è½¦æ¨¡å—å’Œæ¨¡å—å¼•å…¥ï¼Œé€šè¿‡åŸºç¡€æµ‹è¯•ï¼ŒåŽé¢åœ¨æ­¤åŸºç¡€ä¸Šç›´æŽ¥å¼€å‘ä»£ç å³å¯ï¼Œæ˜Žå¤©ä¸‹åˆçœ‹ã€Šå¤§é»„èœ‚ã€‹ï¼Œæ™šä¸Šå¸ˆé—¨èšé¤åƒç«é”…ï¼Œæ˜Žå¤©æ—©ä¸Šèµ¶ä¸€èµ¶å§ï¼Œä»Šå¤©ä»»åŠ¡ç»“æŸï¼ [x] 2019/1/4 æ•´ç†äº†æŽ¥å£æ–‡æ¡£ï¼Œå¹¶ä¸”ç”»äº†ä¸€ä¸‹è´­ç‰©è½¦æ¨¡å—çš„æµç¨‹å›¾ä»¥åŠè®¢å•æœåŠ¡çš„æµç¨‹å›¾ï¼Œé’ˆå¯¹è®¢å•æœåŠ¡ä¸­ï¼Œè®°å½•äº†éœ€è¦ä¸€äº›æ³¨æ„çš„é—®é¢˜ï¼Œå°½å¯èƒ½åœ°å®Œå–„ï¼Œæé«˜å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚å¹¶ä¸”å®Œæˆè´­ç‰©è½¦æ¨¡å—çš„controllerå±‚ã€‚ [x] 2019/1/5 å®Œæˆè´­ç‰©è½¦æ¨¡å—ï¼Œå¹¶ä¸”è¿›è¡Œäº†ç®€å•çš„æµ‹è¯•ï¼Œè¿™é‡Œè¿›è¡Œäº†ä¸¤å¤„æ”¹é€ ï¼Œä¸€ä¸ªæ˜¯åˆ¤æ–­äº†ä¸€ä¸‹æ˜¯å¦éœ€è¦åˆ¤æ–­åº“å­˜ï¼›å¦ä¸€ä¸ªæ˜¯å•†å“ä¿¡æ¯ä»Žredisä¸­å–ï¼Œå–ä¸å‡ºæ¥åˆ™è°ƒç”¨å•†å“æœåŠ¡åˆå§‹åŒ–å€¼ [x] 2019/1/5 æ”¶è´§åœ°å€ç®¡ç†æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å°±æ˜¯ä¸ªå¢žåˆ æ”¹æŸ¥ï¼Œæ²¡å•¥ä¸œè¥¿å†™ï¼Œè¿™é‡Œå°±ä¸åŠ ç¼“å­˜äº†ã€‚ [x] 2019/1/6 å®Œæˆäº†åŽå°è®¢å•ç®¡ç†æ¨¡å—å¹¶ä¸”è¿›è¡Œäº†æµ‹è¯•ï¼Œè°ƒç”¨æ”¶è´§åœ°å€æœåŠ¡æ—¶ï¼Œå‘çŽ°æ”¶è´§åœ°å€æœåŠ¡æ— æ³•è¯»å–åˆ°cookieï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•(https://blog.csdn.net/WYA1993/article/details/84304243) æš‚æ—¶è§£å†³äº†é—®é¢˜ [x] 2019/1/6 é¢„ç½®æ‰€æœ‰å•†å“åº“å­˜åˆ°redisä¸­ï¼›é¢„ç½®æ‰€æœ‰å•†å“åˆ°redisä¸­ï¼›å¤§æ¦‚ç¡®å®šå¥½è®¢å•æœåŠ¡æ€è·¯ï¼šé¢„å‡åº“å­˜ï¼ˆredisåˆ¤æ–­åº“å­˜ï¼‰â€”å¯¹userIDå¢žåŠ åˆ†å¸ƒå¼é”é˜²æ­¢ç”¨æˆ·é‡å¤æäº¤è®¢å•â€“MQå¼‚æ­¥ä¸‹è®¢å• [x] 2019/1/6 æ–°å¢žå…¨å±€å”¯ä¸€IDç”ŸæˆæœåŠ¡ï¼Œé›ªèŠ±ç®—æ³•å®žçŽ° [x] 2019/1/7 å®Œå–„è®¢å•æœåŠ¡-è¿™ä¸€å—æ¶‰åŠè·¨åº“æ“ä½œï¼Œå¹¶ä¸”ä¸åœåœ°è°ƒç”¨å…¶ä»–æœåŠ¡ï¼Œè„‘å­éƒ½å¿«æ™•äº†ï¼Œè¿™é‡Œé‡‡å–çš„ç­–ç•¥æ˜¯ï¼šç”¨åˆ°è´­ç‰©è½¦çš„æ—¶å€™ï¼ŒåŽ»è°ƒç”¨è´­ç‰©è½¦æœåŠ¡èŽ·å–ï¼›äº§å“è¯¦æƒ…ä»Žredisä¸­èŽ·å–ã€‚é¦–å…ˆå°†å•†å“ä»¥åŠå•†å“åº“å­˜å…¨éƒ¨ç¼“å­˜åˆ°redisä¸­ï¼Œç„¶åŽç”¨æˆ·ä¸‹å•ï¼Œå…ˆä»Žredisä¸­åˆ¤æ–­åº“å­˜ï¼Œå¤Ÿåˆ™å‡ï¼Œåˆ¤æ–­ å’Œæ‰£å‡æ”¾åœ¨luaè„šæœ¬ä¸­åŽŸå­æ‰§è¡Œï¼Œç„¶åŽMQå¼‚æ­¥å‡ºåŽ»ç”Ÿæˆè®¢å•ï¼ˆç”Ÿæˆè®¢å•ä¸»è¡¨å’Œè®¢å•è¯¦æƒ…è¡¨æ”¾åœ¨ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­ï¼‰ï¼Œè¿™ä¸¤æ­¥æ“ä½œæˆåŠŸä¹‹åŽï¼Œå†ç”¨MQåŽ»å¼‚æ­¥åˆ é™¤è´­ç‰©è½¦ã€‚MQæ¶ˆè´¹ä¸æˆåŠŸåˆ™é‡è¯•ã€‚ å¯¹äºŽæ‰£å‡åº“å­˜è¿™ä¸€æ­¥ï¼Œæƒ³æ³•æ˜¯ç”¨å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä¸Žredisä¸­è¿›è¡ŒåŒæ­¥ã€‚è¿™é‡Œæ˜¯æ¨¡æ‹Ÿäº†ç§’æ€åœºæ™¯ï¼Œé¢„å‡åº“å­˜+MQå¼‚æ­¥ï¼Œæäº¤è®¢å•â€“&gt;redisåˆ¤æ–­å¹¶ä¸”å‡åº“å­˜â€“&gt;è°ƒç”¨cart-serviceèŽ·å–è´­ç‰©è½¦â€“&gt;MQå¼‚æ­¥(userId,shippingId)ç”Ÿæˆè®¢å•ä¸»è¡¨å’Œè¯¦æƒ…è¡¨â€“&gt;ä¸Šé¢éƒ½æˆåŠŸï¼Œåˆ™MQå¼‚æ­¥(userId) åŽ»æ¸…é™¤è´­ç‰©è½¦ï¼Œåº“å­˜ç”¨å®šæ—¶ä»»åŠ¡åŽ»åŒæ­¥(æœªåš)ï¼Œç†æƒ³çš„åšæ³•æ˜¯ï¼šMQå¼‚æ­¥æ‰£å‡åº“å­˜ï¼Œè®¢å•æœåŠ¡è®¢é˜…æ‰£å‡åº“å­˜æ¶ˆæ¯ï¼Œä¸€æ—¦åº“å­˜æ‰£å‡æˆåŠŸï¼Œåˆ™è¿›è¡Œè®¢å•ç”Ÿæˆã€‚ [x] 2019/1/8 ç»§ç»­å®Œå–„è®¢å•æŽ¥å£ï¼Œå®Œæˆæ”¯ä»˜æœåŠ¡ï¼Œå°±ç›´æŽ¥æ”¾åœ¨è®¢å•æœåŠ¡é‡Œé¢äº†ï¼Œå› ä¸ºä¸Žè®¢å•é€»è¾‘ç´§å¯†ï¼Œå°±æ”¾åœ¨ä¸€èµ·äº†ã€‚ [x] 2019/1/8 ä½¿ç”¨äº†ä¸€ä¸‹swaggerï¼Œå‘çŽ°ä»£ç ä¾µå…¥æ¯”è¾ƒå¼ºï¼Œæ¯ä¸€ä¸ªæŽ¥å£ä¸Šé¢éƒ½è¦æ‰‹åŠ¨æ‰“ä¸Šå“åº”çš„æ³¨è§£ [x] 2019/1/8 å…³äºŽhystrixç†”æ–­ä¸Žé™çº§ï¼Œå¯ä»¥å¼•å…¥hystrixçš„ä¾èµ–ï¼Œç”¨@HystrixCommandæ³¨è§£æ¥æŽ§åˆ¶è¶…æ—¶æ—¶é—´ã€æœåŠ¡é™çº§ä»¥åŠæœåŠ¡ç†”æ–­ã€‚ä¹Ÿå¯ä»¥ç›´æŽ¥å†@FeignClientæŽ¥å£ä¸­æŒ‡å®šæœåŠ¡é™çº§çš„ç±»ï¼Œè¿™é‡Œä¸æ¼”ç¤ºäº†ï¼Œå› ä¸ºè®¾ç½®æ¯”å¦‚è¶…æ—¶æ—¶é—´ï¼Œæˆ‘è¿˜è¦é‡æ–°æµ‹è¯•ï¼Œå†™èµ·æ¥å¾ˆç®€å•ï¼Œæµ‹èµ·æ¥æœ‰ç‚¹å„¿éº»çƒ¦ [x] 2019/1/9 æœåŠ¡è·Ÿè¸ªï¼ŒæœåŠ¡ç«¯æ˜¯ç›´æŽ¥ç”¨çš„çº¿ç¨‹çš„ï¼Œåªéœ€è¦ä¸‹è½½ï¼šwget -O zipkin.jar â€˜https://search.maven.org/remote_content?g=io.zipkin.java&amp;a=zipkin-server&amp;v=LATEST&amp;c=execâ€™ï¼Œç„¶åŽnohup java -jar zipkin.jar &gt; zipkin.server.out &amp; ï¼Œå¼€æ”¾9411ç«¯å£ï¼Œæ‰“å¼€æµè§ˆå™¨http://ip:9411çœ‹åˆ°é¡µé¢å³å¯ã€‚ å®¢æˆ·ç«¯åªéœ€è¦æ·»åŠ ç›¸åº”ä¾èµ–å’Œé…ç½®æ–‡ä»¶å³å¯ã€‚ç”¨å®¢æˆ·ç«¯æµ‹è¯•ï¼Œå‘çŽ°æ­»æ´»ä¸å‡ºçŽ°æˆ‘çš„è¯·æ±‚ï¼Œç»è¿‡æœç´¢ï¼Œå‘çŽ°éœ€è¦å¢žåŠ spring.zipkin.sender.type= webè¿™ä¸ªé…ç½®é¡¹æ‰è¡Œ. [x] 2019/1/10 åˆæ­¥æŠŠé¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿›è¡Œæµ‹è¯•ï¼Œbugå¤šå¤šï¼Œä¿®æ”¹ä¸­â€¦ [x] 2019/1/10 æ”¹äº†ä¸€å¤©çš„bugï¼Œå…¶ä¸­ç½‘å…³çš„è¶…æ—¶æ—¶é—´ä»¥åŠfeignçš„è¶…æ—¶æ—¶é—´éƒ½è¦æ”¹å¤§ä¸€ç‚¹ï¼Œå¦åˆ™ä¼šè¶…æ—¶æŠ¥é”™ã€‚æœ€ç»ˆæˆåŠŸï¼ŒèŠ±äº†ä¸‰å°æœåŠ¡å™¨ï¼Œéƒ¨ç½²äº†11ä¸ªæœåŠ¡ã€‚åŽé¢æŠŠéƒ¨ç½²è¿‡ç¨‹å†™ä¸€ä¸‹ã€‚ [x] 2019/1/11 å°†æ³¨å†Œä¸­å¿ƒåšæˆé›†ç¾¤ï¼Œå› ä¸ºæ—©ä¸Šä¸€èµ·æ¥ï¼Œæ³¨å†Œä¸­å¿ƒæŒ‚äº†ï¼Ÿï¼Ÿï¼Ÿ [ ] 2019/1/11 dockeréƒ¨ç½²(å•†åŸŽç¬¬å››æœŸçš„æ”¹é€ ç›®æ ‡:å®¹å™¨åŒ–+å®¹å™¨ç¼–æŽ’)ï¼Œæœ¬æœŸæ”¹é€ ç»“æŸã€‚ [x] 2019/1/11 å®Œå–„readmeæ–‡æ¡£ [x] 2019/1/12 ä¸¤æ¬¡å‘çŽ°redisæ•°æ®è¢«èŽ«åå…¶å¦™æ¸…ç©ºï¼Œæˆ‘ç¡®å®šä¸æ˜¯ç¼“å­˜åˆ°æœŸï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè®¾ç½®äº†redisçš„å¯†ç ï¼Œæ˜Žå¤©çœ‹ç¼“å­˜æ•°æ®è¿˜åœ¨ä¸åœ¨ã€‚ [x] 2019/1/14 redisæ•°æ®æ²¡æœ‰å†ä¸¢å¤±ï¼Œä¿®å¤ç”¨æˆ·æ›´æ–°ä¿¡æ¯çš„bug é¡¹ç›®å¯åŠ¨ å®‰è£…redisã€zookeeperã€mysqlã€jdkã€nginxä»¥åŠrabbitMQã€‚ å¯¹ä»£ç è¿›è¡Œmaven-packageæ“ä½œã€‚æ‰“åŒ…æˆjaråŒ…ã€‚å°†å…¶æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼š æ‰§è¡Œnohup java -jar snailmall-user-service.8081 &gt; user-service.out &amp;åŽå°å¯åŠ¨å³å¯ã€‚ è¡¥å……ï¼šé’ˆå¯¹é…ç½®åˆ·æ–°ï¼Œä¿®æ”¹äº†githubä¿¡æ¯ï¼Œç”¨postmanè¯·æ±‚http://xxxxx:8079/actuator/bus-refresh è§¦å‘æ›´æ–°ã€‚ æœ¬æ”¹é€ æ˜¯åŸºäºŽå¿«ä¹æ…•å•†åŸŽä¸€æœŸå’Œå¿«ä¹æ…•å•†åŸŽäºŒæœŸçš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹é€ ã€‚æ‰€ä»¥éœ€è¦åœ¨å…¶ä¸šåŠ¡åŸºç¡€ä¸Šæ”¹é€ ä¼šæ¯”è¾ƒé¡ºæ‰‹ã€‚å…³äºŽå¾®æœåŠ¡ï¼Œå°¤å…¶æ˜¯ç”µå•†ä¸­çš„ä¸€äº›å¤„ç†æ‰‹æ®µï¼Œå¾ˆå¤šæ€è·¯éƒ½æ˜¯å­¦ä¹ äºŽç å—åœ¨çº¿ä¸­åˆ†å¸ƒå¼ç”µå•†é¡¹ç›®ã€‚å†åŠ ä¸Šæ…•è¯¾ç½‘å»–å¸ˆå…„çš„spring cloudå¾®æœåŠ¡å®žè·µã€‚ å‰å°é¡¹ç›® åªè¦é˜…è¯»readmeæ–‡æ¡£å³å¯ã€‚ä»£ç ä»“åº“ä¸ºï¼šhttps://github.com/sunweiguo/snailmall-front å­¦ä¹ ä¸ä»…è¦æœ‰è¾“å…¥ï¼Œæ›´è¦æœ‰è‡ªå·±çš„è¾“å‡ºï¼Œå®žè·µæ˜¯æå‡çš„æ·å¾„ï¼]]></content>
      <tags>
        <tag>å®žæˆ˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¢è¯•-è¿›ç¨‹ä¸Žçº¿ç¨‹]]></title>
    <url>%2F2019%2F01%2F19%2F%E9%9D%A2%E8%AF%95-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[éƒ½æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†çš„å¯¹è±¡ï¼Œæ¯”è¾ƒå®¹æ˜“æ··æ·†ï¼Œä½†æ˜¯åˆæ˜¯ä¸¤æ ·å®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼Œå› æ­¤åŒºåˆ«å¾ˆå¤šã€‚ä»Žä»–ä»¬åŒºåˆ«ä¹Ÿå¯ä»¥å‘æ•£å‡ºå¾ˆå¤šå…³äºŽæ“ä½œç³»ç»Ÿæ¯”è¾ƒé‡è¦çš„çŸ¥è¯†ã€‚æ‰€ä»¥é¢è¯•æ¯”è¾ƒå¸¸é—®ã€‚ 1. è¿›ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ ç¿»äº†ä¸€ä¸‹ä¹¦ï¼šã€Šæ“ä½œç³»ç»Ÿæ¦‚å¿µã€‹ç¬¬ä¸‰ç« ä¸­æåŠäº†è¿›ç¨‹çš„æ¦‚å¿µã€‚ä»–æ˜¯è¿™æ ·è¯´çš„ï¼š è¿›ç¨‹æ˜¯æ‰§è¡Œä¸­çš„ç¨‹åºï¼Œè¿™æ˜¯ä¸€ç§éžæ­£å¼è¯´æ³•ã€‚è¿›ç¨‹ä¸åªæ˜¯ç¨‹åºä»£ç ï¼ˆä»£ç å—ï¼‰ï¼Œè¿›ç¨‹è¿˜åŒ…å«äº†å½“å‰æ´»åŠ¨ï¼Œé€šè¿‡ç¨‹åºè®¡æ•°å™¨çš„å€¼å’Œå¤„ç†å™¨å¯„å­˜å™¨çš„å†…å®¹æ¥è¡¨ç¤ºã€‚æ­¤å¤–ï¼Œè¿›ç¨‹è¿˜åŒ…å«è¿›ç¨‹å †æ ˆæ®µï¼ˆåŒ…æ‹¬ä¸´æ—¶æ•°æ®ï¼Œå¦‚å‡½æ•°å‚æ•°ã€è¿”å›žåœ°å€å’Œå±€éƒ¨å˜é‡ï¼‰å’Œæ•°æ®æ®µï¼ˆåŒ…æ‹¬å…¨å±€å˜é‡ï¼‰ã€‚è¿›ç¨‹è¿˜å¯èƒ½åŒ…å«å †ï¼Œæ˜¯åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚ ç¨‹åºæœ¬èº«ä¸æ˜¯è¿›ç¨‹ã€‚ç¨‹åºåªæ˜¯è¢«åŠ¨å®žä½“ï¼Œå¦‚å­˜å‚¨åœ¨ç£ç›˜ä¸ŠåŒ…å«ä¸€ç³»åˆ—æŒ‡ä»¤çš„æ–‡ä»¶å†…å®¹ã€‚è€Œè¿›ç¨‹æ˜¯æ´»åŠ¨å®žä½“ï¼Œå®ƒæœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨æ¥è¡¨ç¤ºä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å‘½ä»¤å’Œç›¸å…³èµ„æºé›†åˆã€‚å½“ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è¢«è£…å…¥å†…å­˜æ—¶ï¼Œä¸€ä¸ªç¨‹åºæ‰èƒ½æˆä¸ºè¿›ç¨‹ã€‚ æ€»ç»“ä¸€ä¸‹è¿›ç¨‹æ˜¯ä»€ä¹ˆï¼Œæ˜¯æˆ‘ä¸ªäººç†è§£ï¼šå®ƒæ˜¯ä¸€ä¸ªæ´»åŠ¨å®žä½“ï¼Œè¿è¡Œåœ¨å†…å­˜ä¸Šã€‚ç„¶åŽå®ƒå ç”¨å¾ˆå¤šç‹¬ç«‹çš„èµ„æºï¼Œæ¯”å¦‚ï¼šå†…å­˜èµ„æºã€ç¨‹åºè¿è¡Œè‚¯å®šæ¶‰åŠCPUè®¡ç®—ã€å ç”¨çš„ç«¯å£èµ„æºï¼ˆå…¬å…±çš„ï¼‰ã€æ–‡ä»¶èµ„æºï¼ˆå…¬å…±çš„ï¼‰ã€ç½‘ç»œèµ„æºï¼ˆå…¬å…±çš„ï¼‰ç­‰ç­‰ç­‰ã€‚è¦æƒ³æ‰§è¡Œè¿™ä¸ªè¿›ç¨‹ï¼Œé¦–å…ˆè¦æœ‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæœ‰äº†è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿˜è¦æœ‰ç›¸åº”çš„æ‰§è¡Œéœ€è¦çš„èµ„æºã€‚æ‰€ä»¥å°†å¯æ‰§è¡Œæ–‡ä»¶ã€å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ã€å†…å­˜ç­‰èµ„æºç»“åˆèµ·æ¥ï¼Œæ‰æ˜¯ä¸€ä¸ªçœŸæ­£çš„è¿›ç¨‹ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥ç†è§£ä¸€å¥è¯ï¼šè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚ è¿›ç¨‹ä¸­çš„å†…å­˜ç©ºé—´ï¼ˆè™½ç„¶ç©ºé—´å¤§å°éƒ½ä¸€æ ·ï¼Œä¸‹æ–‡ä¼šè¯´æ˜Žï¼‰æ˜¯ç‹¬ç«‹çš„ï¼Œå¦åˆ™å°±ä¼šå‡ºçŽ°ä¸€ç§æƒ…å†µï¼šä¿®æ”¹è‡ªå·±ç¨‹åºä¸­çš„æŸä¸ªæŒ‡é’ˆå°±å¯ä»¥æŒ‡å‘å…¶ä»–ç¨‹åºä¸­çš„åœ°å€ï¼Œç„¶åŽæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ï¼Œå²‚ä¸æ˜¯å¾ˆææ€–çš„åœºæ™¯ï¼Ÿ å¦‚ä¸Šå›¾ï¼Œè¿›ç¨‹ä¸­åŒ…å«äº†çº¿ç¨‹ã€‚æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šè¿è¡Œå‡ ç™¾ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹ä¸­ä¹Ÿå¯èƒ½æœ‰å‡ ä¸ªåˆ°å‡ ç™¾ä¸ªçº¿ç¨‹åœ¨è¿è¡Œã€‚ æ–‡ä»¶å’Œç½‘ç»œå¥æŸ„æ˜¯æ‰€æœ‰è¿›ç¨‹å…±äº«çš„ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥åŽ»æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼ŒåŽ»æŠ¢å åŒä¸€ä¸ªç½‘ç»œç«¯å£ã€‚ å›¾ä¸­è¿˜æœ‰ä¸ªå†…å­˜ã€‚è¿™ä¸ªå†…å­˜ä¸æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„å†…å­˜æ¡ï¼Œå³ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯è™šæ‹Ÿå†…å­˜ï¼Œæ˜¯è¿›ç¨‹ç‹¬ç«‹çš„ï¼Œå¤§å°ä¸Žå®žé™…ç‰©ç†å†…å­˜æ— å…³ã€‚ 2. å¯»å€ç©ºé—´ æ¯”å¦‚8086åªæœ‰20æ ¹åœ°å€çº¿ï¼Œé‚£ä¹ˆå®ƒçš„å¯»å€ç©ºé—´å°±æ˜¯1MBï¼Œæˆ‘ä»¬å°±è¯´8086èƒ½æ”¯æŒ1MBçš„ç‰©ç†å†…å­˜ï¼ŒåŠæ—¶æˆ‘ä»¬å®‰è£…äº†128Mçš„å†…å­˜æ¡åœ¨æ¿å­ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½è¯´8086æ‹¥æœ‰1MBçš„ç‰©ç†å†…å­˜ç©ºé—´ã€‚ ä»¥å‰å«å–çš„32ä½çš„æœºå­ï¼Œ32ä½æ˜¯æŒ‡å¯»å€ç©ºé—´ä¸º2çš„32æ¬¡æ–¹ã€‚32ä½çš„386ä»¥ä¸ŠCPUå°±å¯ä»¥æ”¯æŒæœ€å¤§4GBçš„ç‰©ç†å†…å­˜ç©ºé—´äº†ã€‚ 3. ä¸ºä»€ä¹ˆä¼šæœ‰è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„åŒºåˆ« æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œä»–æ‰€éœ€çš„å†…å­˜æ˜¯æœ‰å¯èƒ½å¤§äºŽå†…å­˜æ¡å®¹é‡ä¹‹å’Œçš„ï¼Œæ¯”å¦‚ä½ çš„å†…å­˜æ¡æ˜¯256Mï¼Œä½ çš„ç¨‹åºå´è¦åˆ›å»ºä¸€ä¸ª2Gçš„æ•°æ®åŒºï¼Œé‚£ä¹ˆä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½èƒ½ä¸€èµ·åŠ è½½åˆ°å†…å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰ä¸­ï¼ŒåŠ¿å¿…æœ‰ä¸€éƒ¨åˆ†æ•°æ®è¦æ”¾åˆ°å…¶ä»–ä»‹è´¨ä¸­ï¼ˆæ¯”å¦‚ç¡¬ç›˜ï¼‰ï¼Œå¾…è¿›ç¨‹éœ€è¦è®¿é—®é‚£éƒ¨åˆ†æ•°æ®æ—¶ï¼Œåœ¨é€šè¿‡è°ƒåº¦è¿›å…¥ç‰©ç†å†…å­˜ã€‚ æ‰€ä»¥ï¼Œè™šæ‹Ÿå†…å­˜æ˜¯è¿›ç¨‹è¿è¡Œæ—¶æ‰€æœ‰å†…å­˜ç©ºé—´çš„æ€»å’Œï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€éƒ¨åˆ†ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè€Œç‰©ç†å†…å­˜å°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ‰€äº†è§£çš„å†…å­˜æ¡ã€‚ å…³é”®çš„æ˜¯ä¸è¦æŠŠè™šæ‹Ÿå†…å­˜è·ŸçœŸå®žçš„æ’åœ¨ä¸»æ¿ä¸Šçš„å†…å­˜æ¡ç›¸æŒ‚é’©ï¼Œè™šæ‹Ÿå†…å­˜å®ƒæ˜¯â€œè™šæ‹Ÿçš„â€ä¸å­˜åœ¨ï¼Œå‡çš„å•¦ï¼Œå®ƒåªæ˜¯å†…å­˜ç®¡ç†çš„ä¸€ç§æŠ½è±¡ï¼ 4. è™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€æ˜¯å¦‚ä½•æ˜ å°„å‘¢ å‡è®¾ä½ çš„è®¡ç®—æœºæ˜¯32ä½ï¼Œé‚£ä¹ˆå®ƒçš„åœ°å€æ€»çº¿æ˜¯32ä½çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒå¯ä»¥å¯»å€0 ~ 0xFFFFFFFFï¼ˆ4Gï¼‰çš„åœ°å€ç©ºé—´ï¼Œä½†å¦‚æžœä½ çš„è®¡ç®—æœºåªæœ‰256Mçš„ç‰©ç†å†…å­˜0x~0x0FFFFFFFï¼ˆ256Mï¼‰ï¼ŒåŒæ—¶ä½ çš„è¿›ç¨‹äº§ç”Ÿäº†ä¸€ä¸ªä¸åœ¨è¿™256Måœ°å€ç©ºé—´ä¸­çš„åœ°å€ï¼Œé‚£ä¹ˆè®¡ç®—æœºè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿå›žç­”è¿™ä¸ªé—®é¢˜å‰ï¼Œå…ˆè¯´æ˜Žè®¡ç®—æœºçš„å†…å­˜åˆ†é¡µæœºåˆ¶ã€‚ è®¡ç®—æœºä¼šå¯¹è™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´ï¼ˆ32ä½ä¸º4Gï¼‰åˆ†é¡µäº§ç”Ÿé¡µï¼ˆpageï¼‰ï¼Œå¯¹ç‰©ç†å†…å­˜åœ°å€ç©ºé—´ï¼ˆå‡è®¾256Mï¼‰åˆ†é¡µäº§ç”Ÿé¡µå¸§ï¼ˆpage frameï¼‰ï¼Œè¿™ä¸ªé¡µå’Œé¡µå¸§çš„å¤§å°æ˜¯ä¸€æ ·å¤§çš„ï¼Œæ‰€ä»¥å‘¢ï¼Œåœ¨è¿™é‡Œï¼Œè™šæ‹Ÿå†…å­˜é¡µçš„ä¸ªæ•°åŠ¿å¿…è¦å¤§äºŽç‰©ç†å†…å­˜é¡µå¸§çš„ä¸ªæ•°ã€‚ åœ¨è®¡ç®—æœºä¸Šæœ‰ä¸€ä¸ªé¡µè¡¨ï¼ˆpage tableï¼‰ï¼Œå°±æ˜¯æ˜ å°„è™šæ‹Ÿå†…å­˜é¡µåˆ°ç‰©ç†å†…å­˜é¡µçš„ï¼Œæ›´ç¡®åˆ‡çš„è¯´æ˜¯é¡µå·åˆ°é¡µå¸§å·çš„æ˜ å°„ï¼Œè€Œä¸”æ˜¯ä¸€å¯¹ä¸€çš„æ˜ å°„ã€‚ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œè™šæ‹Ÿå†…å­˜é¡µçš„ä¸ªæ•° &gt; ç‰©ç†å†…å­˜é¡µå¸§çš„ä¸ªæ•°ï¼Œå²‚ä¸æ˜¯æœ‰äº›è™šæ‹Ÿå†…å­˜é¡µçš„åœ°å€æ°¸è¿œæ²¡æœ‰å¯¹åº”çš„ç‰©ç†å†…å­˜åœ°å€ç©ºé—´ï¼Ÿ ä¸æ˜¯çš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯è¿™æ ·å¤„ç†çš„ã€‚æ“ä½œç³»ç»Ÿæœ‰ä¸ªé¡µé¢å¤±æ•ˆï¼ˆpage faultï¼‰åŠŸèƒ½ã€‚æ“ä½œç³»ç»Ÿæ‰¾åˆ°ä¸€ä¸ªæœ€å°‘ä½¿ç”¨çš„é¡µå¸§ï¼Œè®©ä»–å¤±æ•ˆï¼Œå¹¶æŠŠå®ƒå†™å…¥ç£ç›˜ï¼ŒéšåŽä»Žç£ç›˜ä¸­æŠŠæŠŠéœ€è¦è®¿é—®çš„æ•°æ®æ‰€åœ¨çš„é¡µæ”¾åˆ°æœ€å°‘ä½¿ç”¨çš„é¡µå¸§ä¸­ï¼Œå¹¶ä¿®æ”¹é¡µè¡¨ä¸­çš„æ˜ å°„ï¼ˆå³ä¿®æ”¹é¡µå·æŒ‡å‘å½“å‰é¡µå¸§ï¼‰ï¼Œè¿™æ ·å°±ä¿è¯æ‰€æœ‰çš„é¡µéƒ½æœ‰è¢«è°ƒåº¦çš„å¯èƒ½äº†ã€‚è¿™å°±æ˜¯å¤„ç†è™šæ‹Ÿå†…å­˜åœ°å€åˆ°ç‰©ç†å†…å­˜çš„æ­¥éª¤ã€‚ è‡³äºŽé‡Œé¢å¦‚ä½•å®žçŽ°çš„ç»†èŠ‚ï¼Œæˆ‘æ²¡æœ‰è¿‡å¤šåŽ»æŽ¢ç©¶ã€‚ 5. ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€ è™šæ‹Ÿå†…å­˜åœ°å€ç”±é¡µå·å’Œåç§»é‡ç»„æˆã€‚é¡µå·å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ã€‚åç§»é‡å°±æ˜¯æˆ‘ä¸Šé¢è¯´çš„é¡µï¼ˆæˆ–è€…é¡µå¸§ï¼‰çš„å¤§å°ï¼Œå³è¿™ä¸ªé¡µï¼ˆæˆ–è€…é¡µå¸§ï¼‰åˆ°åº•èƒ½å­˜å¤šå°‘æ•°æ®ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªè™šæ‹Ÿåœ°å€å®ƒçš„é¡µå·æ˜¯4ï¼Œåç§»é‡æ˜¯20ï¼Œé‚£ä¹ˆä»–çš„å¯»å€è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆåˆ°é¡µè¡¨ä¸­æ‰¾åˆ°é¡µå·4å¯¹åº”çš„é¡µå¸§å·ï¼ˆæ¯”å¦‚ä¸º8ï¼‰ï¼Œå¦‚æžœæ‰¾ä¸åˆ°å¯¹åº”çš„é¡µæ¡¢ï¼Œåˆ™ç”¨å¤±æ•ˆæœºåˆ¶è°ƒå…¥é¡µã€‚å¦‚æžœå­˜åœ¨ï¼ŒæŠŠé¡µå¸§å·å’Œåç§»é‡ä¼ ç»™MMUï¼ˆCPUçš„å†…å­˜ç®¡ç†å•å…ƒï¼‰ç»„æˆä¸€ä¸ªç‰©ç†ä¸ŠçœŸæ­£å­˜åœ¨çš„åœ°å€ï¼ŒæŽ¥ç€å°±æ˜¯è®¿é—®ç‰©ç†å†…å­˜ä¸­çš„æ•°æ®äº†ã€‚ 6. çº¿ç¨‹é‡Œé¢æœ‰ä»€ä¹ˆ å†™åˆ°è¿™é‡Œï¼Œå¥½åƒè¿˜ä¸Žæœ¬æ ‡é¢˜æ— å…³ï¼Œå³è¿›ç¨‹å’Œçº¿ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«ç­‰ã€‚ä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“ï¼Œé¢è¯•æˆ–è€…å­¦ä¹ ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œä¸æ˜¯ä¸ºäº†å­¦ä¹ è¿™ä¸ªåŒºåˆ«è€Œå­¦ä¹ ï¼Œ æˆ‘ä»¬åº”è¯¥å­¦ä¹ ä¸ºä»€ä¹ˆæœ‰è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œæœ‰äº†è¿›ç¨‹è¿˜éœ€è¦çº¿ç¨‹å—ï¼Ÿæœ‰äº†çº¿ç¨‹è¿˜è¦è¿›ç¨‹å—ï¼Ÿä½ è¯´è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„å•ä½ï¼Œåˆ†é…çš„æ˜¯ä»€ä¹ˆèµ„æºå‘¢ï¼Ÿè¿›ç¨‹ä¸­çš„å†…å­˜æ˜¯å’‹ç®¡ç†çš„å‘¢ï¼Ÿè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€ï¼Ÿç­‰ç­‰ç­‰ï¼Œæ‰€ä»¥é¢è¯•æ˜¯åƒå˜ä¸‡åŒ–çš„ï¼Œé‡è¦çš„æ˜¯æˆ‘ä»¬å°½å¯èƒ½åœ°å¤šé—®è‡ªå·±å‡ ä¸ªä¸ºä»€ä¹ˆï¼Œç„¶åŽä»Žä¸ºä»€ä¹ˆå¼€å§‹åŽ»é€ä¸ªå‡»ç ´ï¼Œå½¢æˆä¸€ä¸ªä½“ç³»ã€‚ è¯´è¯´è¿™ä¸ªæ ˆï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ‰§è¡Œç¨‹åºä»Žä¸»ç¨‹åºå…¥å£è¿›å…¥å¼€å§‹ï¼Œå¯èƒ½ä¼šè°ƒç”¨å¾ˆå¤šçš„å‡½æ•°ï¼Œé‚£ä¹ˆè¿™äº›å‡½æ•°çš„å‚æ•°å’Œè¿”å›žåœ°å€éƒ½ä¼šè¢«åŽ‹å…¥æ ˆä¸­ï¼ŒåŒ…æ‹¬è¿™äº›å‡½æ•°ä¸­å®šä¹‰çš„ä¸´æ—¶å±€éƒ¨å˜é‡éƒ½ä¼šåŽ‹å…¥æ ˆä¸­ï¼Œéšç€å‡½æ•°çš„æ‰§è¡Œå®Œæ¯•ï¼Œå†é€å±‚åœ°å¼¹å‡ºæ ˆï¼Œå›žåˆ°ä¸»å‡½æ•°è¿è¡Œçš„åœ°æ–¹ï¼Œå†ç»§ç»­æ‰§è¡Œã€‚ PC(program counter)ï¼Œå°±æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ŒæŒ‡å‘çš„ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œçš„åœ°å€ã€‚ ç”±æ­¤å¯è§ï¼Œæ“ä½œç³»ç»Ÿè¿è¡Œçš„å…¶å®žæ˜¯ä¸€ä¸ªä¸€ä¸ªçš„çº¿ç¨‹ï¼Œè€Œè¿›ç¨‹åªæ˜¯ä¸€ä¸ªéš”ç¦»èµ„æºçš„å®¹å™¨ã€‚ ä¸Šé¢è¯´åˆ°ï¼ŒPCæ˜¯æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œçš„åœ°å€ã€‚è€Œè¿™äº›æŒ‡ä»¤æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ã€‚ æˆ‘ä»¬çš„è®¡ç®—æœºå¤§å¤šæ•°æ˜¯å­˜å‚¨ç¨‹åºåž‹çš„ã€‚å°±æ˜¯è¯´æ•°æ®å’Œç¨‹åºæ˜¯åŒæ—¶å­˜å‚¨åœ¨åŒä¸€ç‰‡å†…å­˜é‡Œçš„ã€‚ æ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°ä¸€ä¸ªæ¼æ´žå«åšâ€œç¼“å†²åŒºæº¢å‡ºâ€ï¼šæ¯”å¦‚æœ‰ä¸€ä¸ªåœ°æ–¹è®©ç”¨æˆ·è¾“å…¥ç”¨æˆ·åï¼Œä½†æ˜¯é»‘å®¢è¾“å…¥å¾ˆé•¿å¾ˆé•¿çš„å­—ç¬¦ä¸²è¿›åŽ»ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å°±ä¼šè¶…å‡ºå­˜æ”¾è¿™ä¸ªç”¨æˆ·åçš„ä¸€ç‰‡ç¼“å†²åŒºï¼Œè€Œç›´æŽ¥ä¾µå…¥åˆ°å­˜æ”¾ç¨‹åºçš„åœ°æ–¹ï¼Œé‚£ä¹ˆé»‘å®¢å°±å¯ä»¥æ¤å…¥ç¨‹åºåŽ»æ‰§è¡Œã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯é™åˆ¶è¾“å…¥çš„ç”¨æˆ·åé•¿åº¦ï¼Œä¸è¦è¶…è¿‡ç¼“å†²åŒºå¤§å°ã€‚ è¿˜æœ‰ä¸€å—æ˜¯TLS(thread local storage)ï¼Œæˆ‘ä»¬çŸ¥é“è¿›ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„çº¿ç¨‹èƒ½ä¸èƒ½ä¹Ÿæœ‰ä¸€å°å—å±žäºŽè‡ªå·±çš„å†…å­˜åŒºåŸŸå‘¢ï¼Ÿ è¿™ä¸ªä¸œè¥¿ï¼Œå…¶å®žå¾ˆç®€å•ï¼Œå°±æ˜¯è¯´ï¼Œæ¯”å¦‚newä¸€ä¸ªå¯¹è±¡ï¼Œå¾€å¾€æ˜¯åœ¨å †ä¸­å¼€è¾Ÿç©ºé—´çš„ï¼Œä½†æ˜¯çŽ°åœ¨çš„æƒ…å†µæ˜¯ï¼šåœ¨ä¸€ä¸ªå‡½æ•°å†…ï¼Œnewå‡ºæ¥ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸å¼•ç”¨å¤–éƒ¨å¯¹è±¡ï¼Œä¹Ÿä¸ä¼šè¢«å¤–éƒ¨å¼•ç”¨ï¼Œæ˜¯çº¯ç²¹å±žäºŽè¿™ä¸ªå‡½æ•°æ®µï¼Œå¯ä»¥ç†è§£ä¸ºè¿™ä¸ªå¯¹è±¡æ˜¯å±žäºŽè¿™ä¸ªå‡½æ•°çš„å±€éƒ¨ä¸´æ—¶å˜é‡ã€‚ æ­¤æ—¶ï¼Œnewè¿™ä¸ªå¯¹è±¡å°±ä¸éœ€è¦å†åŽ»å †ä¸­å¼€è¾Ÿç©ºé—´äº†ï¼Œå› ä¸ºä¸€æ–¹é¢ä¸éœ€è¦å…±äº«ï¼Œå¦ä¸€æ–¹é¢æ˜¯åœ¨å †ä¸­å¼€è¾Ÿæ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå¹¶ä¸”å¯èƒ½æœ‰å¾ˆå¤šå‡½æ•°ï¼Œè¿™ç§å±€éƒ¨å¯¹è±¡é›¶é›¶æ€»æ€»åŠ èµ·æ¥è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œåœ¨å †ä¸­å¼€è¾Ÿä¼šæµªè´¹ç©ºé—´ã€‚ æ‰€ä»¥ï¼Œèƒ½ä¸èƒ½åœ¨æ ˆä¸­å°±å¯ä»¥newå‡ºè¿™ä¸ªå¯¹è±¡ï¼Œåæ­£ç”¨å®Œå°±æ‰”ã€‚TLSå¯ä»¥æ˜¯çŽ°åœ¨è¿™ä¸ªã€‚æ ˆä¸­ç›´æŽ¥newå¤šæ–¹ä¾¿å¤šå¿«ï¼Œå› ä¸ºä¸éœ€è¦èµ°åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼Œè¿˜é¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å¯ä»¥åŽ»æœç´¢ï¼šæ ˆä¸Šåˆ†é…å’Œé€ƒé€¸åˆ†æž 7. çº¿ç¨‹VSè¿›ç¨‹ åˆ°è¿™é‡Œï¼Œå°±æ¸…æ™°äº†å¾ˆå¤šã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å¤šå¤šå°‘å°‘ç†è§£ä»–ä»¬çš„åŒºåˆ«ã€‚ å¯ä»¥åšä¸ªç®€å•çš„æ¯”å–»ï¼Œä¾¿äºŽè®°å¿†ï¼šè¿›ç¨‹=ç«è½¦ï¼Œçº¿ç¨‹=è½¦åŽ¢ çº¿ç¨‹åœ¨è¿›ç¨‹ä¸‹è¡Œè¿›ï¼ˆå•çº¯çš„è½¦åŽ¢æ— æ³•è¿è¡Œï¼‰ ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼ˆä¸€è¾†ç«è½¦å¯ä»¥æœ‰å¤šä¸ªè½¦åŽ¢ï¼‰ ä¸åŒè¿›ç¨‹é—´æ•°æ®å¾ˆéš¾å…±äº«ï¼ˆä¸€è¾†ç«è½¦ä¸Šçš„ä¹˜å®¢å¾ˆéš¾æ¢åˆ°å¦å¤–ä¸€è¾†ç«è½¦ï¼Œæ¯”å¦‚ç«™ç‚¹æ¢ä¹˜ï¼‰ åŒä¸€è¿›ç¨‹ä¸‹ä¸åŒçº¿ç¨‹é—´æ•°æ®å¾ˆæ˜“å…±äº«ï¼ˆAè½¦åŽ¢æ¢åˆ°Bè½¦åŽ¢å¾ˆå®¹æ˜“ï¼‰ è¿›ç¨‹è¦æ¯”çº¿ç¨‹æ¶ˆè€—æ›´å¤šçš„è®¡ç®—æœºèµ„æºï¼ˆé‡‡ç”¨å¤šåˆ—ç«è½¦ç›¸æ¯”å¤šä¸ªè½¦åŽ¢æ›´è€—èµ„æºï¼‰ è¿›ç¨‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œä¸€ä¸ªçº¿ç¨‹æŒ‚æŽ‰å°†å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æŒ‚æŽ‰ï¼ˆä¸€åˆ—ç«è½¦ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€åˆ—ç«è½¦ï¼Œä½†æ˜¯å¦‚æžœä¸€åˆ—ç«è½¦ä¸Šä¸­é—´çš„ä¸€èŠ‚è½¦åŽ¢ç€ç«äº†ï¼Œå°†å½±å“åˆ°æ‰€æœ‰è½¦åŽ¢ï¼‰ è¿›ç¨‹å¯ä»¥æ‹“å±•åˆ°å¤šæœºï¼Œè¿›ç¨‹æœ€å¤šé€‚åˆå¤šæ ¸ï¼ˆä¸åŒç«è½¦å¯ä»¥å¼€åœ¨å¤šä¸ªè½¨é“ä¸Šï¼ŒåŒä¸€ç«è½¦çš„è½¦åŽ¢ä¸èƒ½åœ¨è¡Œè¿›çš„ä¸åŒçš„è½¨é“ä¸Šï¼‰ è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥ä¸Šé”ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸäº›å…±äº«å†…å­˜æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å®ƒç»“æŸï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸€å—å†…å­˜ã€‚ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„æ´—æ‰‹é—´ï¼‰ï¼â€œäº’æ–¥é”â€ è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥é™å®šä½¿ç”¨é‡ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„é¤åŽ…ï¼Œæœ€å¤šåªå…è®¸å¤šå°‘äººè¿›å…¥ï¼Œå¦‚æžœæ»¡äº†éœ€è¦åœ¨é—¨å£ç­‰ï¼Œç­‰æœ‰äººå‡ºæ¥äº†æ‰èƒ½è¿›åŽ»ï¼‰ï¼â€œä¿¡å·é‡â€ å†è¡¥å……å‡ å¥ã€‚ çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ è¿›ç¨‹é—´æ²¡æœ‰å…±äº«å†…å­˜ï¼Œæ‰€ä»¥äº¤äº’è¦é€šè¿‡TCP/IPç«¯å£çš„ç­‰æ–¹å¼æ¥å®žçŽ°ã€‚çº¿ç¨‹é—´ç”±äºŽæœ‰å…±äº«å†…å­˜ï¼Œæ‰€ä»¥äº¤äº’æ¯”è¾ƒæ–¹ä¾¿ã€‚ çº¿ç¨‹å ç”¨å¾ˆå¤šèµ„æºï¼Œè€Œçº¿ç¨‹åªéœ€è¦åˆ†é…æ ˆå’ŒPCå³å¯ã€‚ 8. é’ˆå¯¹è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„æ€»ç»“ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„4G(32ä½ç³»ç»Ÿä¸‹)å†…å­˜ç©ºé—´ï¼Œå„ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´å…·æœ‰ç±»ä¼¼çš„ç»“æž„ ä¸€ä¸ªæ–°è¿›ç¨‹å»ºç«‹çš„æ—¶å€™ï¼Œå°†ä¼šå»ºç«‹èµ·è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ­¤è¿›ç¨‹çš„æ•°æ®ï¼Œä»£ç ç­‰ä»Žç£ç›˜æ‹·è´åˆ°è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ï¼ˆå»ºç«‹ä¸€ä¸ªè¿›ç¨‹ï¼Œå°±è¦æŠŠç£ç›˜ä¸Šçš„ç¨‹åºæ–‡ä»¶æ‹·è´åˆ°è¿›ç¨‹å¯¹åº”çš„å†…å­˜ä¸­åŽ»ï¼Œå¯¹äºŽä¸€ä¸ªç¨‹åºå¯¹åº”çš„å¤šä¸ªè¿›ç¨‹è¿™ç§æƒ…å†µï¼Œæµªè´¹å†…å­˜ï¼ï¼‰ï¼Œå“ªäº›æ•°æ®åœ¨å“ªé‡Œï¼Œéƒ½ç”±è¿›ç¨‹æŽ§åˆ¶è¡¨ä¸­çš„task_structè®°å½• æ¯ä¸ªè¿›ç¨‹çš„4Gå†…å­˜ç©ºé—´åªæ˜¯è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œæ¯æ¬¡è®¿é—®å†…å­˜ç©ºé—´çš„æŸä¸ªåœ°å€ï¼Œéƒ½éœ€è¦æŠŠåœ°å€ç¿»è¯‘ä¸ºå®žé™…ç‰©ç†å†…å­˜åœ°å€ æ‰€æœ‰è¿›ç¨‹å…±äº«åŒä¸€ç‰©ç†å†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹åªæŠŠè‡ªå·±ç›®å‰éœ€è¦çš„è™šæ‹Ÿå†…å­˜ç©ºé—´æ˜ å°„å¹¶å­˜å‚¨åˆ°ç‰©ç†å†…å­˜ä¸Šã€‚ è¿›ç¨‹è¦çŸ¥é“å“ªäº›å†…å­˜åœ°å€ä¸Šçš„æ•°æ®åœ¨ç‰©ç†å†…å­˜ä¸Šï¼Œå“ªäº›ä¸åœ¨ï¼Œè¿˜æœ‰åœ¨ç‰©ç†å†…å­˜ä¸Šçš„å“ªé‡Œï¼Œéœ€è¦ç”¨é¡µè¡¨æ¥è®°å½• é¡µè¡¨çš„æ¯ä¸€ä¸ªè¡¨é¡¹åˆ†ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†è®°å½•æ­¤é¡µæ˜¯å¦åœ¨ç‰©ç†å†…å­˜ä¸Šï¼Œç¬¬äºŒéƒ¨åˆ†è®°å½•ç‰©ç†å†…å­˜é¡µçš„åœ°å€ï¼ˆå¦‚æžœåœ¨çš„è¯ï¼‰ å½“è¿›ç¨‹è®¿é—®æŸä¸ªè™šæ‹Ÿåœ°å€ï¼ŒåŽ»çœ‹é¡µè¡¨ï¼Œå¦‚æžœå‘çŽ°å¯¹åº”çš„æ•°æ®ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œåˆ™ç¼ºé¡µå¼‚å¸¸ ç¼ºé¡µå¼‚å¸¸çš„å¤„ç†è¿‡ç¨‹ï¼Œå°±æ˜¯æŠŠè¿›ç¨‹éœ€è¦çš„æ•°æ®ä»Žç£ç›˜ä¸Šæ‹·è´åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œå¦‚æžœå†…å­˜å·²ç»æ»¡äº†ï¼Œæ²¡æœ‰ç©ºåœ°æ–¹äº†ï¼Œé‚£å°±æ‰¾ä¸€ä¸ªé¡µè¦†ç›–ï¼Œå½“ç„¶å¦‚æžœè¢«è¦†ç›–çš„é¡µæ›¾ç»è¢«ä¿®æ”¹è¿‡ï¼Œéœ€è¦å°†æ­¤é¡µå†™å›žç£ç›˜ 9. å…³äºŽè¿›ç¨‹å’Œçº¿ç¨‹æ›´æ·±çš„è®¤è¯† å…³äºŽä¸ºä»€ä¹ˆè¦åˆ†è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œå…ˆæŠ›å‡ºç»“è®ºï¼š è¿›ç¨‹processï¼šè¿›ç¨‹å°±æ˜¯æ—¶é—´æ€»å’Œ=æ‰§è¡ŒçŽ¯å¢ƒåˆ‡æ¢æ—¶é—´+ç¨‹åºæ‰§è¡Œæ—¶é—´------&gt;CPUåŠ è½½æ‰§è¡ŒçŽ¯å¢ƒ-&gt;CPUæ‰§è¡Œç¨‹åº-&gt;CPUä¿å­˜æ‰§è¡ŒçŽ¯å¢ƒ çº¿ç¨‹threadï¼šçº¿ç¨‹ä¹Ÿæ˜¯æ—¶é—´æ€»å’Œ=æ‰§è¡ŒçŽ¯å¢ƒåˆ‡æ¢æ—¶é—´ï¼ˆå…±äº«è¿›ç¨‹çš„ï¼‰+ç¨‹åºæ¨¡å—æ‰§è¡Œæ—¶é—´------&gt;CPUåŠ è½½æ‰§è¡ŒçŽ¯å¢ƒï¼ˆå…±äº«è¿›ç¨‹çš„ï¼‰-&gt;CPUæ‰§è¡Œç¨‹åºæ‘¸å—-&gt;CPUä¿å­˜æ‰§è¡ŒçŽ¯å¢ƒï¼ˆå…±äº«è¿›ç¨‹çš„ï¼‰ è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯æè¿°CPUå·¥ä½œçš„æ—¶é—´æ®µï¼Œçº¿ç¨‹æ˜¯æ›´ç»†å°çš„æ—¶é—´æ®µã€‚ é‚£ä¹ˆï¼Œå¦‚æžœCPUæ—¶é—´ç‰‡ä¸´å¹¸æœ¬è¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹åœ¨æ¢å¤æ‰§è¡ŒçŽ¯å¢ƒä¹‹åŽï¼Œæ‰§è¡Œé‡Œé¢çš„è‹¥å¹²çº¿ç¨‹å°±ä¸éœ€è¦å†ä¸åœåœ°åˆ‡æ¢æ‰§è¡ŒçŽ¯å¢ƒäº†ï¼Œæ‰€ä»¥è¯´ï¼Œçº¿ç¨‹ç›¸æ¯”äºŽè¿›ç¨‹æ˜¯æ¯”è¾ƒè½»é‡çš„ã€‚ åœ¨CPUçœ‹æ¥æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„è½®æµæ‰§è¡Œçš„ï¼Œå…·ä½“çš„è½®æµæ–¹æ³•å°±æ˜¯ï¼šå…ˆåŠ è½½ç¨‹åºAçš„ä¸Šä¸‹æ–‡ï¼Œç„¶åŽå¼€å§‹æ‰§è¡ŒAï¼Œä¿å­˜ç¨‹åºAçš„ä¸Šä¸‹æ–‡ï¼Œè°ƒå…¥ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ç¨‹åºBçš„ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç„¶åŽå¼€å§‹æ‰§è¡ŒB,ä¿å­˜ç¨‹åºBçš„ä¸Šä¸‹æ–‡ã€‚ã€‚ã€‚ã€‚ è¿›ç¨‹å°±æ˜¯åŒ…æ¢ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç¨‹åºæ‰§è¡Œæ—¶é—´æ€»å’Œ = CPUåŠ è½½ä¸Šä¸‹æ–‡+CPUæ‰§è¡Œ+CPUä¿å­˜ä¸Šä¸‹æ–‡ çº¿ç¨‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿›ç¨‹çš„é¢—ç²’åº¦å¤ªå¤§ï¼Œæ¯æ¬¡éƒ½è¦æœ‰ä¸Šä¸‹çš„è°ƒå…¥ï¼Œä¿å­˜ï¼Œè°ƒå‡ºã€‚å¦‚æžœæˆ‘ä»¬æŠŠè¿›ç¨‹æ¯”å–»ä¸ºä¸€ä¸ªè¿è¡Œåœ¨ç”µè„‘ä¸Šçš„è½¯ä»¶ï¼Œé‚£ä¹ˆä¸€ä¸ªè½¯ä»¶çš„æ‰§è¡Œä¸å¯èƒ½æ˜¯ä¸€æ¡é€»è¾‘æ‰§è¡Œçš„ï¼Œå¿…å®šæœ‰å¤šä¸ªåˆ†æ”¯å’Œå¤šä¸ªç¨‹åºæ®µï¼Œå°±å¥½æ¯”è¦å®žçŽ°ç¨‹åºAï¼Œå®žé™…åˆ†æˆ aï¼Œbï¼Œcç­‰å¤šä¸ªå—ç»„åˆè€Œæˆã€‚é‚£ä¹ˆè¿™é‡Œå…·ä½“çš„æ‰§è¡Œå°±å¯èƒ½å˜æˆï¼šç¨‹åºAå¾—åˆ°CPU =ã€‹CPUåŠ è½½ä¸Šä¸‹æ–‡ï¼Œå¼€å§‹æ‰§è¡Œç¨‹åºAçš„aå°æ®µï¼Œç„¶åŽæ‰§è¡ŒAçš„bå°æ®µï¼Œç„¶åŽå†æ‰§è¡ŒAçš„cå°æ®µï¼Œæœ€åŽCPUä¿å­˜Açš„ä¸Šä¸‹æ–‡ã€‚ è¿™é‡Œaï¼Œbï¼Œcçš„æ‰§è¡Œæ˜¯å…±äº«äº†Açš„ä¸Šä¸‹æ–‡ï¼ŒCPUåœ¨æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„ã€‚è¿™é‡Œçš„aï¼Œbï¼Œcå°±æ˜¯çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ˜¯å…±äº«äº†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡çŽ¯å¢ƒã€æ›´ä¸ºç»†å°çš„CPUæ—¶é—´æ®µã€‚ è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªæ—¶é—´æ®µçš„æè¿°ï¼Œæ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ï¼Œä¸è¿‡æ˜¯é¢—ç²’å¤§å°ä¸åŒã€‚ æ•´ç†è‡ªï¼š https://www.zhihu.com/question/25532384 https://blog.csdn.net/moshenglv/article/details/52242153 https://blog.csdn.net/u012861978/article/details/53048077]]></content>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€æ­¥ä¸€æ­¥ç†è§£HTTPS]]></title>
    <url>%2F2019%2F01%2F18%2Fnetwork%2F7.%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E7%90%86%E8%A7%A3HTTPS%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬ä¸ƒç¯‡æ–‡ç« ã€‚HTTPSï¼ˆSSL/TLSï¼‰çš„åŠ å¯†æœºåˆ¶æ˜¯å‰ç«¯åŽç«¯ioså®‰å“ç­‰éƒ½åº”äº†è§£çš„åŸºæœ¬é—®é¢˜ã€‚ä¹Ÿæ˜¯é¢è¯•ç»å¸¸é—®çš„ç‚¹ã€‚ ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦åŠ å¯†ï¼Ÿ å°æ—¶å€™çœ‹è°æˆ˜ç‰‡ï¼Œæƒ…æŠ¥å‘è¿‡æ¥äº†ä¹‹åŽï¼Œç”¨ä¸€ä¸ªå°æœ¬æœ¬è¿›è¡Œç¿»è¯‘ï¼Œç„¶åŽè§£å¯†å‡ºæƒ…æŠ¥ã€‚åŠ å¯†å°±æ˜¯é˜²æ­¢æ˜Žæ–‡è¢«åˆ«äººçœ‹åˆ°ç”šè‡³ç¯¡æ”¹å˜›ï¼ å›žåˆ°äº’è”ç½‘ï¼Œå› ä¸ºhttpçš„å†…å®¹æ˜¯æ˜Žæ–‡ä¼ è¾“çš„ï¼Œæ˜Žæ–‡æ•°æ®ä¼šç»è¿‡ä¸­é—´ä»£ç†æœåŠ¡å™¨ã€è·¯ç”±å™¨ã€wifiçƒ­ç‚¹ã€é€šä¿¡æœåŠ¡è¿è¥å•†ç­‰å¤šä¸ªç‰©ç†èŠ‚ç‚¹ï¼Œå¦‚æžœä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«åŠ«æŒï¼Œä¼ è¾“çš„å†…å®¹å°±å®Œå…¨æš´éœ²äº†ï¼Œä»–è¿˜å¯ä»¥ç¯¡æ”¹ä¼ è¾“çš„ä¿¡æ¯ä¸”ä¸è¢«åŒæ–¹å¯Ÿè§‰ï¼Œè¿™å°±æ˜¯ä¸­é—´äººæ”»å‡»ã€‚æ‰€ä»¥æˆ‘ä»¬æ‰éœ€è¦å¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†ã€‚æœ€ç®€å•å®¹æ˜“ç†è§£çš„å°±æ˜¯å¯¹ç§°åŠ å¯† ã€‚ äºŒã€ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†ï¼Ÿ å°æ˜Žå†™ä¸ªæ±‚çˆ±ä¿¡ç»™å°çº¢ï¼Œå°æ˜Žæ‹…å¿ƒå°çº¢çš„å¦ˆå¦ˆçœ‹åˆ°è¿™å°ä¿¡çš„å†…å®¹ï¼Œä»–çµæœºä¸€åŠ¨ï¼Œå¯¹ä¿¡åŠ ä¸ªå¯†ï¼Œå¹¶ç¡®å®šå¥½æˆ‘ç”¨è¿™ä¸ªå¯†é’¥åŠ å¯†çš„ï¼Œå°çº¢æ”¶åˆ°ä¹‹åŽä¹Ÿç”¨è¿™ä¸ªå¯†é’¥è§£å¯†æ‰è¡Œã€‚ ä½†æ˜¯å‘¢ï¼Œè¿™é‡Œæœ‰ä¸ªéº»çƒ¦çš„åœ°æ–¹å°±æ˜¯ï¼Œå°æ˜Žå’Œå°çº¢ä¸åœ¨ä¸€ä¸ªå­¦æ ¡ï¼Œè¿™ä¸ªé’¥åŒ™å‘¢ï¼Œä¸æ–¹ä¾¿ç›´æŽ¥é€åˆ°æ‰‹é‡Œã€‚æ‰€ä»¥å‘¢ï¼Œå°æ˜Žå¾—æƒ³åŠžæ³•æŠŠè¿™ä¸ªé’¥åŒ™å¯„ä¸€ä¸ªé€ç»™å°çº¢ï¼Œå¥½å§ï¼Œå°±ç”¨æœ€è´µçš„é¡ºä¸°å§ï¼ å°±æ˜¯æœ‰ä¸€ä¸ªå¯†é’¥ï¼Œå®ƒå¯ä»¥å¯¹ä¸€æ®µå†…å®¹åŠ å¯†ï¼ŒåŠ å¯†åŽåªèƒ½ç”¨å®ƒæ‰èƒ½è§£å¯†çœ‹åˆ°åŽŸæœ¬çš„å†…å®¹ï¼Œå’Œæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­ç”¨çš„é’¥åŒ™ä½œç”¨å·®ä¸å¤šã€‚ ä¸‰ã€ç”¨å¯¹ç§°åŠ å¯†å¯è¡Œå—ï¼Ÿ é¡ºä¸°å¿«é€’åˆ°äº†ï¼Œç»“æžœå°çº¢ä¸åœ¨å®¶ï¼Œå°çº¢çš„å¦ˆå¦ˆæ”¶åˆ°äº†ï¼Œä¸€çœ‹æ˜¯ä¸ªç”·åŒå­¦å¯„çš„ï¼Œæ€Žä¹ˆèƒ½å¿ä½ï¼Œèµ¶ç´§æ‰“å¼€ï¼Œä»¥çœ‹æ˜¯ä¸€æŠŠé’¥åŒ™ï¼Œä½œä¸ºç¨‹åºçŒ¿ï¼Œå¦ˆå¦ˆå¾—æ„ä¸€ç¬‘ï¼šå“¼å“¼ï¼Œè¿˜èƒ½é€ƒè¿‡æˆ‘çš„çœ¼ç›ï¼Ÿæˆ‘èµ¶ç´§å¤åˆ¶ä¸€æŠŠè—ç€ï¼Œæˆ‘å€’è¦çœ‹çœ‹ä»–åŽé¢è¦å¯„å•¥æ¥ï¼Œè¿˜è¦åŠ å¯†ï¼Ÿï¼ æžœç„¶å°çº¢çš„å¦ˆå¦ˆç­‰åˆ°äº†æ¥è‡ªå°æ˜Žå¯„è¿‡æ¥çš„æƒ…ä¹¦ï¼Œè§£å¯†ä¸€çœ‹ï¼Œå®žé”¤æ—©æ‹ã€‚ åŒæ ·åœ°ï¼Œå°æ˜Žè¿™è¾¹ä¹Ÿéžå¸¸å±é™©ï¼Œå¿«é€’å‘˜åˆšå‡ºå‘ï¼Œå°±è¢«å°æ˜Žçš„å¦ˆå¦ˆæ‹¦æˆªäº†ï¼Œæ‹¿åˆ°äº†è¿™ä¸ªé’¥åŒ™ï¼Œé‚£å°æ˜Žè¿˜æ²¡å¯„å‡ºçš„ä¿¡å·²ç»è¢«å¦ˆå¦ˆçœ‹å…‰äº†ã€‚ æ‰€ä»¥é—®é¢˜çš„æ ¹æœ¬å°±æ˜¯ï¼Œè¿™æŠŠé’¥åŒ™è¦ä¼ è¾“ï¼Œä¼ è¾“å°±å¯èƒ½è¢«æˆªå–ã€‚ å›žåˆ°äº’è”ç½‘ï¼Œå¦‚æžœé€šä¿¡åŒæ–¹éƒ½å„è‡ªæŒæœ‰åŒä¸€ä¸ªå¯†é’¥ï¼Œä¸”æ²¡æœ‰åˆ«äººçŸ¥é“ï¼Œè¿™ä¸¤æ–¹çš„é€šä¿¡å®‰å…¨å½“ç„¶æ˜¯å¯ä»¥è¢«ä¿è¯çš„ï¼ˆé™¤éžå¯†é’¥è¢«ç ´è§£ï¼‰ã€‚ ç„¶è€Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯è¿™ä¸ªå¯†é’¥æ€Žä¹ˆè®©ä¼ è¾“çš„åŒæ–¹çŸ¥æ™“ï¼ŒåŒæ—¶ä¸è¢«åˆ«äººçŸ¥é“ã€‚ å¦‚æžœç”±æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¹¶ä¼ è¾“ç»™æµè§ˆå™¨ï¼Œé‚£è¿™ä¸ªä¼ è¾“è¿‡ç¨‹ä¸­å¯†é’¥è¢«åˆ«äººåŠ«æŒå¼„åˆ°æ‰‹äº†æ€Žä¹ˆåŠžï¼Ÿ æ¢ç§æ€è·¯ï¼Ÿè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æžœæµè§ˆå™¨å†…éƒ¨å°±é¢„å­˜äº†ç½‘ç«™Açš„å¯†é’¥ï¼Œä¸”å¯ä»¥ç¡®ä¿é™¤äº†æµè§ˆå™¨å’Œç½‘ç«™Aï¼Œä¸ä¼šæœ‰ä»»ä½•å¤–äººçŸ¥é“è¯¥å¯†é’¥ï¼Œé‚£ç†è®ºä¸Šç”¨å¯¹ç§°åŠ å¯†æ˜¯å¯ä»¥çš„ï¼Œè¿™æ ·æµè§ˆå™¨åªè¦é¢„å­˜å¥½ä¸–ç•Œä¸Šæ‰€æœ‰HTTPSç½‘ç«™çš„å¯†é’¥å°±è¡Œå•¦ï¼è¿™ä¹ˆåšæ˜¾ç„¶ä¸çŽ°å®žã€‚ æ€Žä¹ˆåŠžï¼Ÿæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ç¥žå¥‡çš„éžå¯¹ç§°åŠ å¯†ã€‚ å››ã€ä»€ä¹ˆæ˜¯éžå¯¹ç§°åŠ å¯†ï¼Ÿ æœ‰ä¸¤æŠŠå¯†é’¥ï¼Œé€šå¸¸ä¸€æŠŠå«åšå…¬é’¥ã€ä¸€æŠŠå«åšç§é’¥ã€‚ ç”¨å…¬é’¥åŠ å¯†çš„å†…å®¹å¿…é¡»ç”¨ç§é’¥æ‰èƒ½è§£å¼€ï¼ŒåŒæ ·ï¼Œç§é’¥åŠ å¯†çš„å†…å®¹åªæœ‰å…¬é’¥èƒ½è§£å¼€ã€‚ äº”ã€ç”¨éžå¯¹ç§°åŠ å¯†å¯è¡Œå—ï¼Ÿ å…¬é’¥å‘¢ï¼Œè¿˜æ˜¯è¦é€šè¿‡å¿«é€’å‘˜é€ç»™å°çº¢çš„ã€‚OKï¼Œå‡è®¾å°çº¢è¦å›žä¿¡ï¼Œå†™å¥½äº†ç”¨å…¬é’¥åŠ å¯†ï¼Œå°çº¢çš„å¦ˆå¦ˆå› ä¸ºæ‹¿ä¸åˆ°ç§é’¥ï¼Œçœ‹ä¸åˆ°ä¿¡çš„å†…å®¹ã€‚ OKï¼Œä½†æ˜¯åè¿‡æ¥å‘¢ï¼Ÿå°æ˜Žç”¨ç§é’¥åŠ å¯†ä¼ ç»™å°çº¢ï¼Œé‚£ä¹ˆå°çº¢çš„å¦ˆå¦ˆå¯å°±èƒ½è§£å¯†äº†ï¼ˆå› ä¸ºå…¬é’¥å¯èƒ½ä¼šè¢«å°çº¢çš„å¦ˆå¦ˆæ‹¿åˆ°ï¼‰ã€‚ å›žåˆ°äº’è”ç½‘ï¼ŒæœåŠ¡å™¨å…ˆæŠŠå…¬é’¥ç›´æŽ¥æ˜Žæ–‡ä¼ è¾“ç»™æµè§ˆå™¨ï¼Œä¹‹åŽæµè§ˆå™¨å‘æœåŠ¡å™¨ä¼ æ•°æ®å‰éƒ½å…ˆç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†å¥½å†ä¼ ï¼Œè¿™æ¡æ•°æ®çš„å®‰å…¨ä¼¼ä¹Žå¯ä»¥ä¿éšœäº†ï¼å› ä¸ºåªæœ‰æœåŠ¡å™¨æœ‰ç›¸åº”çš„ç§é’¥èƒ½è§£å¼€è¿™æ¡æ•°æ®ã€‚ ç„¶è€Œç”±æœåŠ¡å™¨åˆ°æµè§ˆå™¨çš„è¿™æ¡è·¯æ€Žä¹ˆä¿éšœå®‰å…¨ï¼Ÿ å¦‚æžœæœåŠ¡å™¨ç”¨å®ƒçš„çš„ç§é’¥åŠ å¯†æ•°æ®ä¼ ç»™æµè§ˆå™¨ï¼Œé‚£ä¹ˆæµè§ˆå™¨ç”¨å…¬é’¥å¯ä»¥è§£å¯†å®ƒï¼Œè€Œè¿™ä¸ªå…¬é’¥æ˜¯ä¸€å¼€å§‹é€šè¿‡æ˜Žæ–‡ä¼ è¾“ç»™æµè§ˆå™¨çš„ï¼Œè¿™ä¸ªå…¬é’¥è¢«è°åŠ«æŒåˆ°çš„è¯ï¼Œä»–ä¹Ÿèƒ½ç”¨è¯¥å…¬é’¥è§£å¯†æœåŠ¡å™¨ä¼ æ¥çš„ä¿¡æ¯äº†ã€‚ æ‰€ä»¥ç›®å‰ä¼¼ä¹Žåªèƒ½ä¿è¯ç”±æµè§ˆå™¨å‘æœåŠ¡å™¨ä¼ è¾“æ•°æ®æ—¶çš„å®‰å…¨æ€§ï¼ˆå…¶å®žä»æœ‰æ¼æ´žï¼Œä¸‹æ–‡ä¼šè¯´ï¼‰ã€‚ å…­ã€æ”¹è‰¯çš„éžå¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œä¼¼ä¹Žå¯ä»¥ï¼Ÿ å°æ˜Žå’Œå°çº¢å¹´çºªä¸å¤§ï¼Œä½†æ˜¯å¾ˆèªæ˜Žï¼Œé’ˆå¯¹è¿™ä¸ªæƒ…å†µï¼Œè¿˜æ˜¯è¿…é€Ÿå‡çº§åŠ å¯†æ–¹æ³•ã€‚ä»–ä»¬æƒ³åˆ°æ—¢ç„¶ä¸€ç»„å…¬é’¥ç§é’¥ä¸å¤Ÿï¼Œé‚£ä¸¤ç»„å‘¢ï¼Ÿ OKï¼Œå°æ˜Žå’Œå°çº¢å„é€ äº†ä¸€å¯¹ã€‚ä¸‹é¢å°±æ˜¯äº’ç›¸äº¤æ¢å…¬é’¥ã€‚é‚£ä¹ˆå°±å˜æˆï¼š ä¸‹é¢å°±å¥½åŠžå•¦ï¼Œå°æ˜Žå†™ä¿¡ç”¨å…¬é’¥BåŠ å¯†ï¼Œé‚£ä¹ˆä¿¡çš„å†…å®¹åªæœ‰å°çº¢èƒ½ç ´è§£ï¼Œå› ä¸ºå°çº¢æ˜¯éšèº«æºå¸¦ç§é’¥Bã€‚ç›¸åï¼Œå°çº¢ç”¨å…¬é’¥Aå¯¹ä¿¡åŠ å¯†ï¼Œè¿™æ ·åªæœ‰å°æ˜Žèƒ½ç ´è§£ï¼Œå› ä¸ºå°æ˜Žä¹Ÿæ˜¯éšèº«æºå¸¦ç§é’¥Aã€‚å¥½åƒå¾ˆå®‰å…¨å•¦ï¼é™¤äº†ä¸‹é¢æåˆ°çš„æ¼æ´žï¼Œå”¯ä¸€çš„ç¼ºç‚¹å¯èƒ½æ˜¯ï¼šå°çº¢å¾—èŠ±åŠå¤©æ—¶é—´æ‰èƒ½è§£å¯†å®Œè¿™å°ä¿¡ï¼Œæœ‰ç‚¹å—ä¸äº†ã€‚ å›žåˆ°äº’è”ç½‘ã€‚è¯·çœ‹ä¸‹é¢çš„è¿‡ç¨‹ï¼š æŸç½‘ç«™æ‹¥æœ‰ç”¨äºŽéžå¯¹ç§°åŠ å¯†çš„å…¬é’¥Aã€ç§é’¥Aï¼›æµè§ˆå™¨æ‹¥æœ‰ç”¨äºŽéžå¯¹ç§°åŠ å¯†çš„å…¬é’¥Bã€ç§é’¥Bã€‚ æµè§ˆå™¨åƒç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥Aæ˜Žæ–‡ç»™ä¼ è¾“æµè§ˆå™¨ã€‚ æµè§ˆå™¨æŠŠå…¬é’¥Bæ˜Žæ–‡ä¼ è¾“ç»™æœåŠ¡å™¨ã€‚ ä¹‹åŽæµè§ˆå™¨å‘æœåŠ¡å™¨ä¼ è¾“çš„æ‰€æœ‰ä¸œè¥¿éƒ½ç”¨å…¬é’¥AåŠ å¯†ï¼ŒæœåŠ¡å™¨æ”¶åˆ°åŽç”¨ç§é’¥Aè§£å¯†ã€‚ç”±äºŽåªæœ‰æœåŠ¡å™¨æ‹¥æœ‰è¿™ä¸ªç§é’¥Aå¯ä»¥è§£å¯†ï¼Œæ‰€ä»¥èƒ½ä¿è¯è¿™æ¡æ•°æ®çš„å®‰å…¨ã€‚ æœåŠ¡å™¨å‘æµè§ˆå™¨ä¼ è¾“çš„æ‰€æœ‰ä¸œè¥¿éƒ½ç”¨å…¬é’¥BåŠ å¯†ï¼Œæµè§ˆå™¨æ”¶åˆ°åŽç”¨ç§é’¥Bè§£å¯†ã€‚åŒä¸Šä¹Ÿå¯ä»¥ä¿è¯è¿™æ¡æ•°æ®çš„å®‰å…¨ã€‚ çš„ç¡®å¯ä»¥ï¼æŠ›å¼€è¿™é‡Œé¢ä»æœ‰çš„æ¼æ´žä¸è°ˆï¼ˆä¸‹æ–‡ä¼šè®²ï¼‰ï¼ŒHTTPSçš„åŠ å¯†å´æ²¡ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿæœ€ä¸»è¦çš„åŽŸå› æ˜¯éžå¯¹ç§°åŠ å¯†ç®—æ³•éžå¸¸è€—æ—¶ï¼Œç‰¹åˆ«æ˜¯åŠ å¯†è§£å¯†ä¸€äº›è¾ƒå¤§æ•°æ®çš„æ—¶å€™æœ‰äº›åŠ›ä¸ä»Žå¿ƒã€‚ ä¸ƒã€éžå¯¹ç§°åŠ å¯†+å¯¹ç§°åŠ å¯†ï¼Ÿ å°æ˜Žä¹ŸçŸ¥é“ï¼Œè¿™ä¸ªä¿¡å¾ˆé•¿ï¼Œç”¨éžå¯¹ç§°åŠ å¯†ï¼Œå¤ªæ…¢ï¼åŠžæ³•ä¹Ÿæœ‰ï¼Œæ²¡æœ‰å¿…è¦å¯¹é‚£ä¹ˆé•¿çš„ä¿¡åŠ å¯†ï¼Œæˆ‘åªè¦ä¿è¯è¿™ä¸ªçœŸæ­£è§£å¯†çš„é’¥åŒ™ä¸è¢«åˆ«äººæ‹¿åˆ°å°±è¡Œï¼Œé‚£ä¹ˆä»–çµæœºä¸€åŠ¨æƒ³åˆ°è¿™ä¸ªæ–¹æ³•ï¼š å°æ˜Žå’Œå°çº¢åˆ©ç”¨éžå¯¹ç§°åŠ å¯†å¯¹é’¥åŒ™åŠ å¯†ï¼Œå§‘ä¸”è®¤ä¸ºæ˜¯è¿™ä¸ªé’¥åŒ™è¢«æ”¾åœ¨äº†ä¸€ä¸ªç›’å­é‡Œï¼Œè¿™ä¸ªç›’å­ä¹Ÿè¢«é”èµ·æ¥äº†ï¼Œåªæœ‰å°çº¢æˆ–è€…å°æ˜Žæ‰èƒ½æ‰“å¼€ç›’å­ï¼Œå†ç”¨é’¥åŒ™åŽ»è§£å¯†ã€‚ è¿™ä¸ªçœŸæ­£ç”¨äºŽå¯¹ç§°åŠ å¯†è§£å¯†çš„é’¥åŒ™åˆ«äººå°±æ‹¿ä¸åˆ°å•¦ï¼ è‡ªä»Žç”¨äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œæ„Ÿè§‰åˆå®‰å…¨ï¼Œè§£å¯†åˆå¿«ï¼Œæ„Ÿæƒ…åˆæ·±æ¸©äº†å‘¢ï¼ å›žåˆ°äº’è”ç½‘ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š æŸç½‘ç«™æ‹¥æœ‰ç”¨äºŽéžå¯¹ç§°åŠ å¯†çš„å…¬é’¥Aã€ç§é’¥Aã€‚ æµè§ˆå™¨åƒç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥Aæ˜Žæ–‡ç»™ä¼ è¾“æµè§ˆå™¨ã€‚ æµè§ˆå™¨éšæœºç”Ÿæˆä¸€ä¸ªç”¨äºŽå¯¹ç§°åŠ å¯†çš„å¯†é’¥Xï¼Œç”¨å…¬é’¥AåŠ å¯†åŽä¼ ç»™æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨æ‹¿åˆ°åŽç”¨ç§é’¥Aè§£å¯†å¾—åˆ°å¯†é’¥Xã€‚ è¿™æ ·åŒæ–¹å°±éƒ½æ‹¥æœ‰å¯†é’¥Xäº†ï¼Œä¸”åˆ«äººæ— æ³•çŸ¥é“å®ƒã€‚ä¹‹åŽåŒæ–¹æ‰€æœ‰æ•°æ®éƒ½ç”¨å¯†é’¥XåŠ å¯†è§£å¯†ã€‚ HTTPSçš„åŸºæœ¬æ€æƒ³å°±æ˜¯åŸºäºŽè¿™ä¸ªã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆä¹Ÿå­˜åœ¨ä¸Šé¢ä¸€ç›´åœ¨è¯´çš„æ¼æ´žã€‚ å…«ã€ä¸­é—´äººæ”»å‡» åƒå¦ˆå¦ˆè¿™æ ·çº§åˆ«çš„ç¨‹åºçŒ¿å¯èƒ½æ˜¯é‚£ä»–ä»¬ä¸¤æ²¡åŠžæ³•å•¦ï¼Œä½†æ˜¯å‘¢ï¼Œæ ¡åŒºæœ‰ä¸ªçœ‹é—¨çš„å¤§çˆ·ï¼Œä»¥å‰æ˜¯ä¸ªé»‘å®¢ï¼Œä¹Ÿä¸çŸ¥é“å’‹å›žäº‹ï¼Œæ˜Žæ˜Žæ‰50å²ï¼Œä½†æ˜¯çœ‹èµ·æ¥åƒ80å²ï¼Œå¤´ä¸Šå…‰æºœæºœçš„ï¼Œå†¬å¤©å†·å‘¢ã€‚æ•´å¤©åœ¨é‚£èƒ¡è¨€ä¹±è¯­ï¼šdockerç‰›é€¼å•Šï¼Œspring cloudç‰›é€¼å•Šï¼Œè¿™ä¸ªå¼€æºè½¯ä»¶XXXå†™çš„çœŸå¥½ï¼Œè·Ÿå‘¨å›´çš„è€å¤§çˆ·è€å¤§å¦ˆæ ¹æœ¬è°ˆä¸åˆ°ä¸€èµ·åŽ»ã€‚ ä»–ä¹Ÿæ˜¯é—²çš„è›‹ç–¼ï¼Œéžè¦æŽºå’Œï¼Œå› ä¸ºæ®è¯´ä»–ä»¥å‰å•èº«30å¹´ï¼Œè‹¦é€¼æ•²ä»£ç ï¼Œä¸çŸ¥é“è°ˆæ‹çˆ±æ˜¯å•¥æ»‹å‘³ï¼Œå§‘ä¸”è®¤ä¸ºä»–å¥½å¥‡å¿ƒé‡å§ã€‚ åœ¨å°æ˜Žç¬¬ä¸€æ¬¡å¯„å…¬é’¥Açš„æ—¶å€™ï¼Œå¤§çˆ·å‡ºæ‰‹äº†ï¼Œæˆªå–ä¸‹æ¥ã€‚æ¢æˆè‡ªå·±åšçš„å…¬é’¥Bã€‚ç„¶åŽé€ç»™å°çº¢ã€‚ å°çº¢å“ªé‡Œä¼šçŸ¥é“è¿™å…¬é’¥è¢«æŽ‰åŒ…äº†å‘¢ï¼Œæ‰€ä»¥ç›´æŽ¥å°±ç”¨äº†ï¼ŒæŒ‰ç…§æ­£å¸¸æ­¥éª¤ï¼Œå°çº¢æƒ³äº†ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œè¿™æ¬¡å°±å«xiaomingwoxuanniå§ï¼ŒOKï¼Œç”¨è¿™ä¸ªå…¬é’¥Bå¯¹è¿™ä¸ªå­—ç¬¦ä¸²åŠ ä¸ªå¯†ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±è¢«é”è¿›äº†ç”¨å¤§çˆ·å…¬é’¥Bé”çš„ç›’å­é‡Œã€‚ è€å¤§çˆ·åœ¨é—¨å£å®ˆç€å‘¢ï¼Œä¸€çœ‹åˆ°å°çº¢å¯„ä¸œè¥¿äº†ï¼Œåˆå·å·åœ°æˆªå–ä¸‹æ¥ï¼Œç”¨è‡ªå·±çš„ç§é’¥Bæ¥è§£å¯†è¿™ä¸ªç›’å­ã€‚è½»æ˜“åœ°æ‹¿åˆ°äº†é‡Œé¢çš„å­—ç¬¦ä¸²ï¼ŒOKï¼Œæ€•å°æ˜Žå¯Ÿè§‰ï¼Œå†ç”¨å°æ˜Žå¯„æ¥çš„å…¬é’¥AåŠ å¯†ä¼ ç»™å°æ˜Žï¼Œè¿™æ ·åŒæ–¹éƒ½ä¸çŸ¥é“ä»–ä»¬çš„é’¥åŒ™å·²ç»è¢«å¤§çˆ·ç»™èŽ·å–äº†ã€‚ å°æ˜Žå’Œå°çº¢ä¹‹é—´çš„ä¿¡å°±ç”¨xiaomingwoxuanniè¿™ä¸ªé’¥åŒ™è¿›è¡Œå¯¹ç§°åŠ å¯†å’Œå¯¹ç§°è§£å¯†ï¼Œå®Œå…¨ä¸çŸ¥é“æœ‰ä¸ªå¤§çˆ·å°±å¤©å¤©æ‹¿ç€è¿™ä¸ªå­—ç¬¦ä¸²åŽ»è§£å¯†ä¿¡ä»¶ï¼Œçœ‹çš„ä¸äº¦ä¹ä¹Žï¼Œç”šè‡³è¿˜å·å·æ”¹å‡ ä¸ªå­—å‘¢ã€‚ å›žåˆ°äº’è”ç½‘ã€‚ä¸­é—´äººçš„ç¡®æ— æ³•å¾—åˆ°æµè§ˆå™¨ç”Ÿæˆçš„å¯†é’¥Bï¼Œè¿™ä¸ªå¯†é’¥æœ¬èº«è¢«å…¬é’¥AåŠ å¯†äº†ï¼Œåªæœ‰æœåŠ¡å™¨æ‰æœ‰ç§é’¥Aè§£å¼€æ‹¿åˆ°å®ƒå‘€ï¼ç„¶è€Œä¸­é—´äººå´å®Œå…¨ä¸éœ€è¦æ‹¿åˆ°å¯†é’¥Aå°±èƒ½å¹²åäº‹äº†ã€‚è¯·çœ‹ï¼š æŸç½‘ç«™æ‹¥æœ‰ç”¨äºŽéžå¯¹ç§°åŠ å¯†çš„å…¬é’¥Aã€ç§é’¥Aã€‚ æµè§ˆå™¨å‘ç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥Aæ˜Žæ–‡ç»™ä¼ è¾“æµè§ˆå™¨ã€‚ ä¸­é—´äººåŠ«æŒåˆ°å…¬é’¥Aï¼Œä¿å­˜ä¸‹æ¥ï¼ŒæŠŠæ•°æ®åŒ…ä¸­çš„å…¬é’¥Aæ›¿æ¢æˆè‡ªå·±ä¼ªé€ çš„å…¬é’¥Bï¼ˆå®ƒå½“ç„¶ä¹Ÿæ‹¥æœ‰å…¬é’¥Bå¯¹åº”çš„ç§é’¥Bï¼‰ã€‚ æµè§ˆå™¨éšæœºç”Ÿæˆä¸€ä¸ªç”¨äºŽå¯¹ç§°åŠ å¯†çš„å¯†é’¥Xï¼Œç”¨å…¬é’¥Bï¼ˆæµè§ˆå™¨ä¸çŸ¥é“å…¬é’¥è¢«æ›¿æ¢äº†ï¼‰åŠ å¯†åŽä¼ ç»™æœåŠ¡å™¨ã€‚ ä¸­é—´äººåŠ«æŒåŽç”¨ç§é’¥Bè§£å¯†å¾—åˆ°å¯†é’¥Xï¼Œå†ç”¨å…¬é’¥AåŠ å¯†åŽä¼ ç»™æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨æ‹¿åˆ°åŽç”¨ç§é’¥Aè§£å¯†å¾—åˆ°å¯†é’¥Xã€‚ è¿™æ ·åœ¨åŒæ–¹éƒ½ä¸ä¼šå‘çŽ°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸­é—´äººå¾—åˆ°äº†å¯†é’¥Bã€‚æ ¹æœ¬åŽŸå› æ˜¯æµè§ˆå™¨æ— æ³•ç¡®è®¤è‡ªå·±æ”¶åˆ°çš„å…¬é’¥æ˜¯ä¸æ˜¯ç½‘ç«™è‡ªå·±çš„ã€‚åªè¦è§£å†³äº†è¿™ä¸ªå…¬é’¥ä¸€å®šæ˜¯è¿™ä¸ªç½‘ç«™å‘æ¥çš„ï¼Œé‚£ä¹ˆåŸºæœ¬å°±OKäº† ä¹ã€å¦‚ä½•è¯æ˜Žæµè§ˆå™¨æ”¶åˆ°çš„å…¬é’¥ä¸€å®šæ˜¯è¯¥ç½‘ç«™çš„å…¬é’¥ï¼Ÿ çŽ°å®žç”Ÿæ´»ä¸­ï¼Œå¦‚æžœæƒ³è¯æ˜ŽæŸèº«ä»½è¯å·ä¸€å®šæ˜¯å°æ˜Žçš„ï¼Œæ€Žä¹ˆåŠžï¼Ÿçœ‹èº«ä»½è¯ã€‚è¿™é‡Œæ”¿åºœæœºæž„èµ·åˆ°äº†â€œå…¬ä¿¡â€çš„ä½œç”¨ï¼Œèº«ä»½è¯æ˜¯ç”±å®ƒé¢å‘çš„ï¼Œå®ƒæœ¬èº«çš„æƒå¨å¯ä»¥å¯¹ä¸€ä¸ªäººçš„èº«ä»½ä¿¡æ¯ä½œå‡ºè¯æ˜Žã€‚äº’è”ç½‘ä¸­èƒ½ä¸èƒ½æžè¿™ä¹ˆä¸ªå…¬ä¿¡æœºæž„å‘¢ï¼Ÿç»™ç½‘ç«™é¢å‘ä¸€ä¸ªâ€œèº«ä»½è¯â€ï¼Ÿ åã€æ•°å­—è¯ä¹¦ ç½‘ç«™åœ¨ä½¿ç”¨HTTPSå‰ï¼Œéœ€è¦å‘â€œCAæœºæž„â€ç”³è¯·é¢å‘ä¸€ä»½æ•°å­—è¯ä¹¦ï¼Œå³SSLè¯ä¹¦ï¼Œæ•°å­—è¯ä¹¦é‡Œæœ‰è¯ä¹¦æŒæœ‰è€…ã€è¯ä¹¦æŒæœ‰è€…çš„å…¬é’¥ç­‰ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æŠŠè¯ä¹¦ä¼ è¾“ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä»Žè¯ä¹¦é‡Œå–å…¬é’¥å°±è¡Œäº†ï¼Œè¯ä¹¦å°±å¦‚èº«ä»½è¯ä¸€æ ·ï¼Œå¯ä»¥è¯æ˜Žâ€œè¯¥å…¬é’¥å¯¹åº”è¯¥ç½‘ç«™â€ã€‚ç„¶è€Œè¿™é‡Œåˆæœ‰ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„é—®é¢˜äº†ï¼Œè¯ä¹¦æœ¬èº«çš„ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•é˜²æ­¢è¢«ç¯¡æ”¹ï¼Ÿå³å¦‚ä½•è¯æ˜Žè¯ä¹¦æœ¬èº«çš„çœŸå®žæ€§ï¼Ÿèº«ä»½è¯æœ‰ä¸€äº›é˜²ä¼ªæŠ€æœ¯ï¼Œæ•°å­—è¯ä¹¦æ€Žä¹ˆé˜²ä¼ªå‘¢ï¼Ÿè§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å°±åŸºæœ¬æŽ¥è¿‘èƒœåˆ©äº†ï¼ SSLè¯ä¹¦å†…å®¹ï¼š è¯ä¹¦çš„å‘å¸ƒæœºæž„CA è¯ä¹¦çš„æœ‰æ•ˆæœŸ å…¬é’¥ è¯ä¹¦æ‰€æœ‰è€… ç­¾å åä¸€ã€å¦‚ä½•æ”¾é˜²æ­¢æ•°å­—è¯ä¹¦è¢«ç¯¡æ”¹ï¼Ÿ æˆ‘ä»¬æŠŠè¯ä¹¦å†…å®¹ç”Ÿæˆä¸€ä»½â€œç­¾åâ€ï¼Œæ¯”å¯¹è¯ä¹¦å†…å®¹å’Œç­¾åæ˜¯å¦ä¸€è‡´å°±èƒ½å¯Ÿè§‰æ˜¯å¦è¢«ç¯¡æ”¹ã€‚è¿™ç§æŠ€æœ¯å°±å«æ•°å­—ç­¾åã€‚ æåˆ°æ•°å­—ç­¾åï¼Œå…¶å®žåŽŸç†å¾ˆç®€å•å•¦ï¼Œå°±æ˜¯æ¯”å¦‚æˆ‘è¦ä¼ è¾“ä¸€å¥è¯å«ï¼šâ€œä½ ç»™æˆ‘è½¬100å—é’±ï¼Œæˆ‘çš„è´¦å·æ˜¯123456ï¼Œè½¬å®Œäº†å‘Šè¯‰æˆ‘ä¸€å£°ã€‚â€ï¼Œå¦‚æžœä¸åšä»»ä½•å¤„ç†ï¼Œè¢«åˆšæ‰çš„è€å¤§çˆ·æˆªå–äº†ï¼Œä»–å·å·åœ°æ”¹ä¸€ä¸‹å†…å®¹â€œä½ ç»™æˆ‘è½¬200å—é’±ï¼Œæˆ‘çš„è´¦å·æ˜¯654321ï¼Œä¸è¦å‘Šè¯‰ä»»ä½•äººï¼Œå°¤å…¶æ˜¯ä½ å«‚å­ã€‚â€ æ˜¯ä¸æ˜¯å¤ªåäº†ï¼Œå¼„ä¸å¥½è¢«æŠ“ï¼Œå¤§çˆ·å¯ä¸æ•¢åšå¤§çš„ï¼Œåªæ•¢éª—ä¸ªå–é…’é’±ã€‚ é‚£ä¹ˆæ€Žä¹ˆé˜²æ­¢å¤§çˆ·è¿™ç§çŒ¥çæŠ€æœ¯åˆé«˜çš„äººç¯¡æ”¹å‘¢ï¼Ÿæ•°å­—ç­¾åæŽ’ä¸Šç”¨åœºå•¦ï¼ ä»¥åŽå†ä¼ æ¶ˆæ¯å°±æ˜¯â€œä½ ç»™æˆ‘è½¬100å—é’±ï¼Œæˆ‘çš„è´¦å·æ˜¯123456ï¼Œè½¬å®Œäº†å‘Šè¯‰æˆ‘ä¸€å£°ã€‚â€+â€œï¼â€¦â€¦@&amp;@%#â€¦â€¦ï¼ï¿¥@ï¿¥ï¼@%â€¦â€¦#ï¿¥ï¼%â€¦â€¦â€,åŽé¢é‚£ä¸€ä¸²ä¸œè¥¿å°±æ˜¯æ•°å­—ç­¾åï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æƒ³åŠžæ³•å¯¹å‰é¢çš„å†…å®¹è¿›è¡Œéžå¯¹ç§°åŠ å¯†ï¼ˆè¿™æ ·åˆ«äººæ ¹æœ¬ä¸çŸ¥é“ä½ åŠ å¯†çš„ç§é’¥æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå°±ä¼ªè£…ä¸äº†ç­¾åäº†ï¼‰ã€‚ä¼ è¿‡åŽ»ä¹‹åŽï¼Œæˆ‘è¦å¯¹å…¶è¿›è¡Œè§£å¯†ï¼Œä¸Žä¼ è¿‡æ¥çš„æ˜Žæ–‡ä¸€ä¸€å¯¹æ¯”å‚æ•°ï¼Œçœ‹æœ‰æ²¡æœ‰è¢«æ”¹åŠ¨è¿‡ã€‚ä¸€æ—¦å‘çŽ°å“ªé‡Œä¸å¯¹åº”ï¼Œè¯´æ˜Žå·²ç»è¢«ç¯¡æ”¹äº†ã€‚ â€œCAæœºæž„â€åˆ¶ä½œç­¾åçš„è¿‡ç¨‹ï¼š CAæ‹¥æœ‰éžå¯¹ç§°åŠ å¯†çš„ç§é’¥å’Œå…¬é’¥ã€‚ CAå¯¹è¯ä¹¦æ˜Žæ–‡ä¿¡æ¯è¿›è¡Œhashã€‚ å¯¹hashåŽçš„å€¼ç”¨ç§é’¥åŠ å¯†ï¼Œå¾—åˆ°æ•°å­—ç­¾åã€‚ æ˜Žæ–‡å’Œæ•°å­—ç­¾åå…±åŒç»„æˆäº†æ•°å­—è¯ä¹¦ï¼Œè¿™æ ·ä¸€ä»½æ•°å­—è¯ä¹¦å°±å¯ä»¥é¢å‘ç»™ç½‘ç«™äº†ã€‚ç½‘ç«™æŠŠè¿™ä¸ªæ•°å­—è¯ä¹¦ä¼ ç»™æµè§ˆå™¨ã€‚ é‚£æµè§ˆå™¨æ‹¿åˆ°æœåŠ¡å™¨ä¼ æ¥çš„æ•°å­—è¯ä¹¦åŽï¼Œå¦‚ä½•éªŒè¯å®ƒæ˜¯ä¸æ˜¯çœŸçš„ï¼Ÿï¼ˆæœ‰æ²¡æœ‰è¢«ç¯¡æ”¹ã€æŽ‰åŒ…ï¼‰ æµè§ˆå™¨éªŒè¯è¿‡ç¨‹ï¼š æ‹¿åˆ°è¯ä¹¦ï¼Œå¾—åˆ°æ˜Žæ–‡Tï¼Œæ•°å­—ç­¾åSã€‚ ç”¨CAæœºæž„çš„å…¬é’¥å¯¹Sè§£å¯†ï¼ˆç”±äºŽæ˜¯æµè§ˆå™¨ä¿¡ä»»çš„æœºæž„ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¿æœ‰å®ƒçš„å…¬é’¥ã€‚è¯¦æƒ…è§ä¸‹æ–‡ï¼‰ï¼Œå¾—åˆ°Sâ€™ã€‚ ç”¨è¯ä¹¦é‡Œè¯´æ˜Žçš„hashç®—æ³•å¯¹æ˜Žæ–‡Tè¿›è¡Œhashå¾—åˆ°Tâ€™ã€‚ æ¯”è¾ƒSâ€™æ˜¯å¦ç­‰äºŽTâ€™ï¼Œç­‰äºŽåˆ™è¡¨æ˜Žè¯ä¹¦å¯ä¿¡ã€‚ ä¸ºä»€ä¹ˆè¿™æ ·å¯ä»¥è¯æ˜Žè¯ä¹¦å¯ä¿¡å‘¢ï¼Ÿæˆ‘ä»¬æ¥ä»”ç»†æƒ³ä¸€ä¸‹ã€‚ åäºŒã€ä¸­é—´äººæœ‰å¯èƒ½ç¯¡æ”¹è¯¥è¯ä¹¦å—ï¼Ÿ è€å¤§çˆ·å°±ç®—æœ‰å¤©å¤§çš„èƒ½è€ï¼Œä¹Ÿæ‹¿ä¸åˆ°åŠ å¯†çš„ç§é’¥ï¼Œé‚£ä¹ˆåªæ˜¯å•çº¯åœ°ç¯¡æ”¹æ˜Žæ–‡ï¼Œåªä¼šé€ æˆæ ¡éªŒä¸é€šè¿‡ã€‚ å›žåˆ°äº’è”ç½‘ï¼Œå‡è®¾ä¸­é—´äººç¯¡æ”¹äº†è¯ä¹¦çš„åŽŸæ–‡ï¼Œç”±äºŽä»–æ²¡æœ‰CAæœºæž„çš„ç§é’¥ï¼Œæ‰€ä»¥æ— æ³•å¾—åˆ°æ­¤æ—¶åŠ å¯†åŽç­¾åï¼Œæ— æ³•ç›¸åº”åœ°ç¯¡æ”¹ç­¾åã€‚ æµè§ˆå™¨æ”¶åˆ°è¯¥è¯ä¹¦åŽä¼šå‘çŽ°åŽŸæ–‡å’Œç­¾åè§£å¯†åŽçš„å€¼ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜Žè¯ä¹¦å·²è¢«ç¯¡æ”¹ï¼Œè¯ä¹¦ä¸å¯ä¿¡ï¼Œä»Žè€Œç»ˆæ­¢å‘æœåŠ¡å™¨ä¼ è¾“ä¿¡æ¯ï¼Œé˜²æ­¢ä¿¡æ¯æ³„éœ²ç»™ä¸­é—´äººã€‚ åä¸‰ã€ä¸­é—´äººæœ‰å¯èƒ½æŠŠè¯ä¹¦æŽ‰åŒ…å—ï¼Ÿ å‡è®¾æœ‰å¦ä¸€ä¸ªç½‘ç«™Bä¹Ÿæ‹¿åˆ°äº†CAæœºæž„è®¤è¯çš„è¯ä¹¦ï¼Œå®ƒæƒ³æžåž®ç½‘ç«™Aï¼Œæƒ³åŠ«æŒç½‘ç«™Açš„ä¿¡æ¯ã€‚äºŽæ˜¯å®ƒæˆä¸ºä¸­é—´äººæ‹¦æˆªåˆ°äº†Aä¼ ç»™æµè§ˆå™¨çš„è¯ä¹¦ï¼Œç„¶åŽæ›¿æ¢æˆè‡ªå·±çš„è¯ä¹¦ï¼Œä¼ ç»™æµè§ˆå™¨ï¼Œä¹‹åŽæµè§ˆå™¨å°±ä¼šé”™è¯¯åœ°æ‹¿åˆ°Bçš„è¯ä¹¦é‡Œçš„å…¬é’¥äº†ï¼Œä¼šå¯¼è‡´ä¸Šæ–‡æåˆ°çš„æ¼æ´žã€‚ å…¶å®žè¿™å¹¶ä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºè¯ä¹¦é‡ŒåŒ…å«äº†ç½‘ç«™Açš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸŸåï¼Œæµè§ˆå™¨æŠŠè¯ä¹¦é‡Œçš„åŸŸåä¸Žè‡ªå·±è¯·æ±‚çš„åŸŸåæ¯”å¯¹ä¸€ä¸‹å°±çŸ¥é“æœ‰æ²¡æœ‰è¢«æŽ‰åŒ…äº†ã€‚ æ€»ç»“ï¼šå› ä¸ºä¸€ä¸ªç½‘ç«™åŸŸåå¯¹åº”ä¸€ä¸ªè¯ä¹¦ï¼Œä½ çš„è¯ä¹¦æ ¹å…¶ä»–äººçš„è¯ä¹¦è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œé‚£ä¹ˆä½ å°±ç®—æ‹¿åˆ°äº†å…¶ä»–äººçš„è¯ä¹¦å†æŽ‰åŒ…æˆè‡ªå·±çš„ï¼Œä¹Ÿæ²¡ç”¨ï¼Œæ¯•ç«Ÿæµè§ˆå™¨é‚£è¾¹åªè¦çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯æˆ‘è¦æŸ¥çœ‹çš„åŸŸåã€‚ åå››ã€ä¸ºä»€ä¹ˆåˆ¶ä½œæ•°å­—ç­¾åæ—¶éœ€è¦hashä¸€æ¬¡ï¼Ÿ æœ€æ˜¾ç„¶çš„æ˜¯æ€§èƒ½é—®é¢˜ï¼Œå‰é¢æˆ‘ä»¬å·²ç»è¯´äº†éžå¯¹ç§°åŠ å¯†æ•ˆçŽ‡è¾ƒå·®ï¼Œè¯ä¹¦ä¿¡æ¯ä¸€èˆ¬è¾ƒé•¿ï¼Œæ¯”è¾ƒè€—æ—¶ã€‚è€ŒhashåŽå¾—åˆ°çš„æ˜¯å›ºå®šé•¿åº¦çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ç”¨md5ç®—æ³•hashåŽå¯ä»¥å¾—åˆ°å›ºå®šçš„128ä½çš„å€¼ï¼‰ï¼Œè¿™æ ·åŠ å¯†è§£å¯†å°±ä¼šå¿«å¾ˆå¤šã€‚ åäº”ã€æ€Žä¹ˆè¯æ˜ŽCAæœºæž„çš„å…¬é’¥æ˜¯å¯ä¿¡çš„ï¼Ÿ è®©æˆ‘ä»¬å›žæƒ³ä¸€ä¸‹æ•°å­—è¯ä¹¦åˆ°åº•æ˜¯å¹²å•¥çš„ï¼Ÿæ²¡é”™ï¼Œä¸ºäº†è¯æ˜ŽæŸå…¬é’¥æ˜¯å¯ä¿¡çš„ï¼Œå³â€œè¯¥å…¬é’¥æ˜¯å¦å¯¹åº”è¯¥ç½‘ç«™/æœºæž„ç­‰â€ï¼Œé‚£è¿™ä¸ªCAæœºæž„çš„å…¬é’¥æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ç”¨æ•°å­—è¯ä¹¦æ¥è¯æ˜Žï¼Ÿæ²¡é”™ï¼Œæ“ä½œç³»ç»Ÿã€æµè§ˆå™¨æœ¬èº«ä¼šé¢„è£…ä¸€äº›å®ƒä»¬ä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œå¦‚æžœå…¶ä¸­æœ‰è¯¥CAæœºæž„çš„æ ¹è¯ä¹¦ï¼Œé‚£å°±å¯ä»¥æ‹¿åˆ°å®ƒå¯¹åº”çš„å¯ä¿¡å…¬é’¥äº†ã€‚ å®žé™…ä¸Šè¯ä¹¦ä¹‹é—´çš„è®¤è¯ä¹Ÿå¯ä»¥ä¸æ­¢ä¸€å±‚ï¼Œå¯ä»¥Aä¿¡ä»»Bï¼ŒBä¿¡ä»»Cï¼Œä»¥æ­¤ç±»æŽ¨ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšä¿¡ä»»é“¾æˆ–æ•°å­—è¯ä¹¦é“¾ï¼Œä¹Ÿå°±æ˜¯ä¸€è¿žä¸²çš„æ•°å­—è¯ä¹¦ï¼Œç”±æ ¹è¯ä¹¦ä¸ºèµ·ç‚¹ï¼Œé€è¿‡å±‚å±‚ä¿¡ä»»ï¼Œä½¿ç»ˆç«¯å®žä½“è¯ä¹¦çš„æŒæœ‰è€…å¯ä»¥èŽ·å¾—è½¬æŽˆçš„ä¿¡ä»»ï¼Œä»¥è¯æ˜Žèº«ä»½ã€‚ å¦å¤–ï¼Œä¸çŸ¥ä½ ä»¬æ˜¯å¦é‡åˆ°è¿‡ç½‘ç«™è®¿é—®ä¸äº†ã€æç¤ºè¦å®‰è£…è¯ä¹¦çš„æƒ…å†µï¼Ÿè¿™é‡Œå®‰è£…çš„å°±æ˜¯æ ¹è¯ä¹¦ã€‚è¯´æ˜Žæµè§ˆå™¨ä¸è®¤ç»™è¿™ä¸ªç½‘ç«™é¢å‘è¯ä¹¦çš„æœºæž„ï¼Œé‚£ä¹ˆæ²¡æœ‰è¯¥æœºæž„çš„æ ¹è¯ä¹¦ï¼Œä½ å°±å¾—æ‰‹åŠ¨ä¸‹è½½å®‰è£…ï¼ˆé£Žé™©è‡ªå·±æ‰¿æ‹…XDï¼‰ã€‚å®‰è£…è¯¥æœºæž„çš„æ ¹è¯ä¹¦åŽï¼Œä½ å°±æœ‰äº†å®ƒçš„å…¬é’¥ï¼Œå°±å¯ä»¥ç”¨å®ƒéªŒè¯æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡äº†ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¬é’¥æ˜¯ä»Žè¯ä¹¦ä¸­èŽ·å–çš„ã€‚è¯ä¹¦æ˜¯ç½‘ç«™ä»Žæœºæž„é‚£è¾¹ç”³è¯·æ¥çš„ï¼Œè¯ä¹¦+ç­¾åä¼ ç»™æµè§ˆå™¨ã€‚åªè¦æ ¡éªŒé€šè¿‡ï¼Œé‚£ä¹ˆå…¬é’¥å¿…ç„¶æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ï¼Œå¹¶ä¸”ä¸€å®šæ˜¯è¿™ä¸ªç½‘ç«™ä¼ æ¥çš„ï¼Œé‚£ä¹ˆè§£å†³äº†æˆ‘ä»¬æœ€æ ¸å¿ƒçš„é—®é¢˜ï¼šç¡®å®šå…¬é’¥æ˜¯æˆ‘ä»¬æŒ‡å®šçš„ç½‘ç«™ä¼ æ¥çš„ã€‚ æ—¢ç„¶å…¬é’¥æ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°çº¢å°±ä¼šç”¨æ­£ç¡®çš„å…¬é’¥å¯¹éšæœºå­—ç¬¦ä¸²åŠ å¯†ï¼Œä¸­é—´ä¸ä¼šå‡ºçŽ°ç¯¡æ”¹ã€‚ åå…­ã€HTTPSå¿…é¡»åœ¨æ¯æ¬¡è¯·æ±‚ä¸­éƒ½è¦å…ˆåœ¨SSL/TLSå±‚è¿›è¡Œæ¡æ‰‹ä¼ è¾“å¯†é’¥å—ï¼Ÿ è¿™ä¹Ÿæ˜¯æˆ‘å½“æ—¶çš„å›°æƒ‘ä¹‹ä¸€ï¼Œæ˜¾ç„¶æ¯æ¬¡è¯·æ±‚éƒ½ç»åŽ†ä¸€æ¬¡å¯†é’¥ä¼ è¾“è¿‡ç¨‹éžå¸¸è€—æ—¶ï¼Œé‚£æ€Žä¹ˆè¾¾åˆ°åªä¼ è¾“ä¸€æ¬¡å‘¢ï¼Ÿç”¨sessionå°±è¡Œã€‚ æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæµè§ˆå™¨ï¼ˆæˆ–å®¢æˆ·ç«¯è½¯ä»¶ï¼‰ç»´æŠ¤ä¸€ä¸ªsession IDï¼Œåœ¨TSLæ¡æ‰‹é˜¶æ®µä¼ ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ç”Ÿæˆå¥½å¯†é’¥ä¼ ç»™æœåŠ¡å™¨åŽï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯¥å¯†é’¥å­˜åˆ°ç›¸åº”çš„session IDä¸‹ï¼Œä¹‹åŽæµè§ˆå™¨æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦session IDï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®session IDæ‰¾åˆ°ç›¸åº”çš„å¯†é’¥å¹¶è¿›è¡Œè§£å¯†åŠ å¯†æ“ä½œï¼Œè¿™æ ·å°±ä¸å¿…è¦æ¯æ¬¡é‡æ–°åˆ¶ä½œã€ä¼ è¾“å¯†é’¥äº†ï¼ åä¸ƒã€HTTPSåŽŸç† ä¸‹é¢å†æ¥çœ‹çœ‹HTTPSåŽŸç†å°±ç‰¹åˆ«ç®€å•å•¦ï¼ HTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šå¯ä»¥ç†è§£ä¸ºHTTP+SSL/TLSï¼Œ å³ HTTP ä¸‹åŠ å…¥ SSL å±‚ï¼ŒHTTPS çš„å®‰å…¨åŸºç¡€æ˜¯ SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦ SSLï¼Œç”¨äºŽå®‰å…¨çš„ HTTP æ•°æ®ä¼ è¾“ã€‚ 1234HTTPSSL/TLSTCPIP æˆ‘ä»¬åªè¦çŸ¥é“ï¼Œåœ¨SSLå±‚é‡Œé¢å¯ä»¥å®Œæˆæ ¡éªŒå’Œå¯†é’¥çš„ä¼ è¾“ã€‚ ç†è§£äº†ä¸Šé¢ï¼Œè¿™ä¸ªå›¾ä¹Ÿå°±æ²¡å•¥å¥½è§£é‡Šçš„äº†ã€‚ æ•´ç†è‡ªï¼šhttps://zhuanlan.zhihu.com/p/43789231]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HTTPåŸºç¡€çŸ¥è¯†æç‚¼]]></title>
    <url>%2F2019%2F01%2F18%2Fnetwork%2F6.HTTP%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%8F%90%E7%82%BC%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬å…­ç¯‡æ–‡ç« ã€‚è¿™é‡Œç®€å•è®°å½•ä¸€äº›å…³äºŽHTTPçš„åŸºæœ¬æ¦‚å¿µï¼Œæ¯”è¾ƒåŸºç¡€ã€‚ä¸‹é¢çš„å†…å®¹æ˜¯å¯¹ã€Šå›¾è§£HTTPã€‹æç‚¼çš„å†æç‚¼ï¼Œä¸»è¦åŽŸå› æ˜¯å¾ˆå¤šé‡è¦çš„ä¸œè¥¿å‰é¢å·²ç»è¯¦ç»†è¯´è¿‡äº†ï¼Œè¿˜æœ‰ä¸€äº›ä¸œè¥¿çŸ¥é“å³å¯ï¼Œç”¨åˆ°å†åŽ»æŸ¥ï¼Œä½œä¸ºä¸€ä¸ªåŽç«¯æ”»åŸŽç‹®ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦äº†è§£é‚£ä¹ˆçç¢Žã€‚ HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®® HTTPæ˜¯æ— çŠ¶æ€åè®®ã€‚è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ï¼ˆå³ä¸åšæŒä¹…åŒ–å¤„ç†ï¼‰ã€‚ HTTPä¹‹æ‰€ä»¥è®¾è®¡å¾—å¦‚æ­¤ç®€å•ï¼Œæ˜¯ä¸ºäº†æ›´å¿«åœ°å¤„ç†å¤§é‡äº‹ç‰©ï¼Œç¡®ä¿åè®®çš„å¯ä¼¸ç¼©æ€§ã€‚ HTTP/1.1 éšæ—¶æ— çŠ¶æ€åè®®ï¼Œä½†å¯é€šè¿‡ Cookie æŠ€æœ¯ä¿å­˜çŠ¶æ€ã€‚ å‘ŠçŸ¥æœåŠ¡å™¨æ„å›¾çš„HTTPæ–¹æ³• GETï¼šèŽ·å–èµ„æº POSTï¼šä¼ è¾“å®žä½“ä¸»ä½“ PUTï¼šä¼ è¾“æ–‡ä»¶ HEADï¼šèŽ·å¾—æŠ¥æ–‡é¦–éƒ¨ï¼Œä¸ŽGETæ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯ä¸è¿”å›žæŠ¥æ–‡ä¸»ä½“å†…å®¹ã€‚ç”¨äºŽç¡®è®¤URIçš„æœ‰æ•ˆæ€§åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰ã€‚ DELETEï¼šåˆ é™¤æ–‡ä»¶ï¼Œä¸ŽPUTç›¸åï¼ˆå“åº”è¿”å›ž204 No Contentï¼‰ã€‚ OPTIONSï¼šè¯¢é—®æ”¯æŒçš„æ–¹æ³•ï¼ŒæŸ¥è¯¢é’ˆå¯¹è¯·æ±‚URIæŒ‡å®šçš„èµ„æºæ”¯æŒçš„æ–¹æ³•ï¼ˆAllow:GETã€POSTã€HEADã€OPTIONSï¼‰ã€‚ TRACEï¼šè¿½è¸ªè·¯å¾„ CONNECTï¼šè¦æ±‚ç”¨éš§é“åè®®è¿žæŽ¥ä»£ç†ï¼ˆä¸»è¦ä½¿ç”¨SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æŽ¥å±‚ï¼‰å’ŒTLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æŠŠé€šä¿¡å†…å®¹åŠ å¯†åŽç»ç½‘ç»œéš§é“ä¼ è¾“ï¼‰ã€‚ URIã€URL å®˜æ–¹è§£é‡Šéƒ½æ˜¯ä»€ä¹ˆä¹±èµ·å…«ç³Ÿçš„ä¸œè¥¿ã€‚å„ç§åšå®¢ä¹Ÿæ˜¯è·Ÿç€æŠ„ï¼Œè¿™ä¸¤è€…åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å’Œæ„ä¹‰ï¼Ÿ ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦URIå°±æ˜¯åœ¨æŸä¸€è§„åˆ™ä¸‹èƒ½æŠŠä¸€ä¸ªèµ„æºç‹¬ä¸€æ— äºŒåœ°æ ‡è¯†å‡ºæ¥ã€‚ å¯¹åº”äºŽå®žé™…ä¾‹å­å°±æ˜¯ï¼šæ¯ä¸ªäººéƒ½æœ‰èº«ä»½è¯ï¼Œè¿™ä¸ªèº«ä»½è¯å·ç å°±å¯¹åº”è¿™ä¸ªäººã€‚æ¯”å¦‚å¼ ä¸‰çš„èº«ä»½è¯å·ç ä¸º123456ï¼Œé‚£ä¹ˆæˆ‘åªè¦çŸ¥é“123456å°±å¯ä»¥æ‰¾åˆ°è¿™ä¸ªäººã€‚ é‚£ä»€ä¹ˆæ˜¯URLå‘¢ï¼Ÿä»Žåå­—çœ‹æ˜¯ï¼šç»Ÿä¸€èµ„æºå®šä½å™¨ã€‚ å¦‚æžœåšç±»æ¯”ï¼ŒURLå°±æ˜¯ï¼šåŠ¨ç‰©ä½å€åè®®://åœ°çƒ/ä¸­å›½/æµ™æ±Ÿçœ/æ­å·žå¸‚/è¥¿æ¹–åŒº/æŸå¤§å­¦/14å·å®¿èˆæ¥¼/525å·å¯/å¼ ä¸‰.äºº æˆ‘ä»¬é€šè¿‡è¿™ä¸ªè¯¦ç»†çš„åœ°å€ä¹Ÿå¯ä»¥æ‰¾åˆ°å¼ ä¸‰è¿™ä¸ªäººã€‚ é‚£ä¹ˆä»–ä»¬ä¿©åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ URIæ˜¯ä»¥æŸç§è§„åˆ™å”¯ä¸€åœ°æ ‡è¯†èµ„æºï¼Œæ‰‹æ®µä¸é™ï¼Œæ¯”å¦‚èº«ä»½è¯å·ã€‚å½“ç„¶äº†ï¼Œåœ°å€å¯ä»¥å”¯ä¸€æ ‡è¯†ï¼Œé‚£ä¹ˆä¹Ÿå±žäºŽURIçš„ä¸€ç§æ‰‹æ®µã€‚æ‰€ä»¥è¯´URLæ˜¯URIçš„å­é›†ã€‚ å›žåˆ°Webä¸Šï¼Œå‡è®¾æ‰€æœ‰çš„Htmlæ–‡æ¡£éƒ½æœ‰å”¯ä¸€çš„ç¼–å·ï¼Œè®°ä½œhtml:xxxxxï¼Œxxxxxæ˜¯ä¸€ä¸²æ•°å­—ï¼Œå³Htmlæ–‡æ¡£çš„èº«ä»½è¯å·ç ï¼Œè¿™ä¸ªèƒ½å”¯ä¸€æ ‡è¯†ä¸€ä¸ªHtmlæ–‡æ¡£ï¼Œé‚£ä¹ˆè¿™ä¸ªå·ç å°±æ˜¯ä¸€ä¸ªURIã€‚ è€ŒURLåˆ™é€šè¿‡æè¿°æ˜¯å“ªä¸ªä¸»æœºä¸Šå“ªä¸ªè·¯å¾„ä¸Šçš„æ–‡ä»¶æ¥å”¯ä¸€ç¡®å®šä¸€ä¸ªèµ„æºï¼Œä¹Ÿå°±æ˜¯å®šä½çš„æ–¹å¼æ¥å®žçŽ°çš„URIã€‚ å¯¹äºŽçŽ°åœ¨ç½‘å€æˆ‘æ›´å€¾å‘äºŽå«å®ƒURLï¼Œæ¯•ç«Ÿå®ƒæä¾›äº†èµ„æºçš„ä½ç½®ä¿¡æ¯ï¼Œå¦‚æžœæœ‰ä¸€å¤©ç½‘å€é€šè¿‡å·ç æ¥æ ‡è¯†å˜æˆäº†http://741236985.htmlï¼Œé‚£æ„Ÿè§‰å«æˆURIæ›´ä¸ºåˆé€‚ã€‚ HTTPè¯·æ±‚æŠ¥æ–‡ è¿”å›žç»“æžœçš„HTTPçŠ¶æ€ç  çŠ¶æ€ç çš„èŒè´£æ˜¯å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œæè¿°è¿”å›žçš„è¯·æ±‚ç»“æžœã€‚ çŠ¶æ€ç å¦‚200 OKï¼Œä»¥3ä¸ºæ•°å­—å’ŒåŽŸå› çŸ­è¯­ç»„æˆã€‚ æ•°å­—ä¸­çš„ç¬¬ä¸€ä½å®šä¹‰äº†å“åº”ç±»åˆ«ï¼ŒåŽä¸¤ä½æ— åˆ†ç±»ã€‚å“åº”ç±»åˆ«æœ‰ä»¥ä¸‹äº”ç§ï¼š ç±»åˆ« åŽŸå› çŸ­è¯­ 1XX Informational(ä¿¡æ¯æ€§çŠ¶æ€ç ) 2XX Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰ 3XX Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰ 4XX Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰ 5XX Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰ â­2XX æˆåŠŸ 200 OKï¼šè¯·æ±‚è¢«æ­£å¸¸å¤„ç† 204 No Contentï¼šä¸€èˆ¬åœ¨åªéœ€ä»Žå®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œå¯¹å®¢æˆ·ç«¯ä¸éœ€è¦å‘é€æ–°ä¿¡æ¯å†…å®¹çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ 206 Partial Contentï¼šå®¢æˆ·ç«¯è¿›è¡ŒèŒƒå›´è¯·æ±‚ â­3XX é‡å®šå‘ 301 Moved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ã€‚è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„URIï¼Œä»¥åŽåº”ä½¿ç”¨èµ„æºçŽ°åœ¨æ‰€æŒ‡çš„URIã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœå·²ç»æŠŠèµ„æºå¯¹åº”çš„URIä¿å­˜ä¸ºä¹¦ç­¾äº†ï¼Œè¿™æ—¶åº”è¯¥æŒ‰Locationé¦–éƒ¨å­—æ®µæç¤ºçš„URIé‡æ–°ä¿å­˜ã€‚ 302 Foundï¼šä¸´æ—¶æ€§é‡å®šå‘ã€‚è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„URIï¼Œå¸Œæœ›ç”¨æˆ·ï¼ˆæœ¬æ¬¡ï¼‰èƒ½ä½¿ç”¨æ–°çš„URIè®¿é—®ã€‚ å’Œ301 Moved PermanentlyçŠ¶æ€ç ç›¸ä¼¼ï¼Œä½†302çŠ¶æ€ç ä»£è¡¨çš„èµ„æºä¸æ˜¯è¢«æ°¸ä¹…ç§»åŠ¨ï¼Œåªæ˜¯ä¸´æ—¶æ€§è´¨çš„ã€‚æ¢å¥è¯è¯´ï¼Œå·²ç§»åŠ¨çš„èµ„æºå¯¹åº”çš„URIå°†æ¥è¿˜æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·æŠŠURIä¿å­˜æˆä¹¦ç­¾ï¼Œä½†ä¸ä¼šåƒ301çŠ¶æ€ç å‡ºçŽ°æ—¶é‚£æ ·åŽ»æ›´æ–°ä¹¦ç­¾ï¼Œè€Œæ˜¯ä»æ—§ä¿ç•™è¿”å›ž302çŠ¶æ€ç çš„é¡µé¢å¯¹åº”çš„URIï¼ˆåœ¨Chromeä¸­ï¼Œè¿˜æ˜¯ä¼šä¿å­˜ä¸ºé‡å®šå‘åŽçš„URIï¼Œä¸è§£ï¼‰ã€‚ 303 See Otherï¼šè¡¨ç¤ºç”±äºŽè¯·æ±‚å¯¹åº”çš„èµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ªURIï¼Œåº”ä½¿ç”¨GETæ–¹æ³•å®šå‘èŽ·å–è¯·æ±‚çš„èµ„æºã€‚è¿™ä¸Ž302ç±»ä¼¼ï¼Œä½†303æ˜Žç¡®è¡¨ç¤ºå®¢æˆ·ç«¯åº”å½“é‡‡ç”¨GETæ–¹æ³•èŽ·å–èµ„æºã€‚ 304 Not Modifiedï¼šè¯¥çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€é™„å¸¦æ¡ä»¶çš„è¯·æ±‚ï¼ˆæŒ‡é‡‡ç”¨GETæ–¹æ³•çš„è¯·æ±‚æŠ¥æ–‡ä¸­åŒ…å«If-Match,If-Modified-Sinceï¼ŒIf-None-Marchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Sinceä¸­ä»»ä¸€é¦–éƒ¨ã€‚ï¼‰æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å…è®¸è¯·æ±‚è®¿é—®èµ„æºï¼Œä½†å› å‘ç”Ÿè¯·æ±‚ä¸ºæ»¡è¶³æ¡ä»¶çš„æƒ…å†µåŽï¼Œç›´æŽ¥è¿”å›ž304ï¼ˆæœåŠ¡å™¨ç«¯èµ„æºæœªæ”¹å˜ï¼Œå¯ç›´æŽ¥ä½¿ç”¨å®¢æˆ·ç«¯æœªè¿‡æœŸçš„ç¼“å­˜ï¼‰ã€‚304çŠ¶æ€ç è¿”å›žæ—¶ï¼Œä¸åŒ…å«ä»»ä½•å“åº”çš„ä¸»ä½“éƒ¨åˆ†ã€‚ 304è™½è¢«åˆ’åˆ†åœ¨3XXç±»åˆ«ï¼Œä½†æ˜¯å’Œé‡å®šå‘æ²¡æœ‰å…³ç³»ã€‚ 307 Temporary Redirectï¼šä¸´æ—¶é‡å®šå‘ã€‚ä¸Ž302æœ‰ç›¸åŒå«ä¹‰ã€‚307éµå®ˆæµè§ˆå™¨æ ‡å‡†ï¼Œä¸ä¼šä»ŽPOSTå˜æˆGETã€‚ â­4XX å®¢æˆ·ç«¯é”™è¯¯ 4XXçš„å“åº”ç»“æžœè¡¨æ˜Žå®¢æˆ·ç«¯æ˜¯å‘ç”Ÿé”™è¯¯çš„åŽŸå› æ‰€åœ¨ã€‚ 400 Bad Requestï¼šè¡¨ç¤ºè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚ 401 Unauthorizedï¼šè¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰é€šè¿‡HTTPè®¤è¯ï¼ˆBASICè®¤è¯ã€DIGESTè®¤è¯ï¼‰çš„è®¤è¯ä¿¡æ¯ã€‚ 403 Forbiddenï¼šè¡¨æ˜Žå¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»äº†ã€‚æœåŠ¡å™¨ç«¯å¯åœ¨å®žä½“çš„ä¸»ä½“éƒ¨åˆ†å¯¹åŽŸå› è¿›è¡Œæè¿°ï¼ˆå¯é€‰ï¼‰ 404 Not Foundï¼šè¡¨æ˜ŽæœåŠ¡å™¨ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯æ‹’ç»è¯·æ±‚ä¸”ä¸æƒ³è¯´æ˜Žç†ç”±æ—¶æ—¶ç”¨ã€‚ â­5XX æœåŠ¡å™¨é”™è¯¯ 5XXçš„å“åº”ç»“æžœè¡¨æ˜ŽæœåŠ¡å™¨æœ¬èº«å‘ç”Ÿé”™è¯¯ã€‚ 500 Interval Server Errorï¼šè¡¨æ˜ŽæœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯Webåº”ç”¨å­˜åœ¨çš„bugæˆ–æŸäº›ä¸´æ—¶çš„æ•…éšœã€‚ 503 Service Unavailableï¼šè¡¨æ˜ŽæœåŠ¡å™¨æš‚æ—¶å¤„äºŽè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼ŒçŽ°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚å¦‚æžœäº‹å…ˆå¾—çŸ¥è§£é™¤ä»¥ä¸ŠçŠ¶å†µéœ€è¦çš„æ—¶é—´ï¼Œæœ€å¥½å†™å…¥Retry-Afteré¦–éƒ¨å­—æ®µå†è¿”å›žç»™å®¢æˆ·ç«¯ã€‚ HTTPçš„ç“¶é¢ˆ ä¸€æ¡è¿žæŽ¥ä¸Šåªå¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ˆå‰é¢è®²åˆ°ï¼ŒæŒä¹…åŒ–å¯ä¿æŒTCPè¿žæŽ¥çŠ¶æ€ï¼Œä½†ä»å®Œæˆä¸€æ¬¡è¯·æ±‚/å“åº”åŽæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡è¯·æ±‚/å“åº”ï¼Œè€Œç®¡çº¿åŒ–æ–¹å¼å¯è®©ä¸€ä¸ªTCPè¿žæŽ¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚ã€‚ï¼‰ è¯·æ±‚åªèƒ½ä»Žå®¢æˆ·ç«¯å¼€å§‹ã€‚å®¢æˆ·ç«¯ä¸å¯ä»¥æŽ¥æ”¶é™¤å“åº”ä»¥å¤–çš„æŒ‡ä»¤ è¯·æ±‚/å“åº”é¦–éƒ¨æœªç»åŽ‹ç¼©å°±å‘é€ã€‚é¦–éƒ¨ä¿¡æ¯è¶Šå¤šå»¶è¿Ÿè¶Šå¤§ å‘é€å†—é•¿(é‡å¤)çš„é¦–éƒ¨ã€‚æ¯æ¬¡äº’ç›¸å‘é€ç›¸åŒçš„é¦–éƒ¨é€ æˆçš„æµªè´¹è¾ƒå¤š SPDYä»¥ä¼šè¯å±‚çš„å½¢å¼åŠ å…¥ï¼ŒæŽ§åˆ¶å¯¹æ•°æ®çš„æµåŠ¨ï¼Œä½†è¿˜æ˜¯é‡‡ç”¨HTTPå»ºç«‹é€šä¿¡è¿žæŽ¥ã€‚å› æ­¤ï¼Œå¯ç…§å¸¸ä½¿ç”¨HTTPçš„GETå’ŒPOSTç­‰æ–¹æ³•ã€Cookieä»¥åŠHTTPæŠ¥æ–‡ç­‰ã€‚ ä½¿ç”¨ SPDYåŽï¼ŒHTTPåè®®é¢å¤–èŽ·å¾—ä»¥ä¸‹åŠŸèƒ½ã€‚ å¤šè·¯å¤ç”¨æµï¼šé€šè¿‡å•ä¸€çš„TCPè¿žæŽ¥ï¼Œå¯ä»¥æ— é™åˆ¶å¤„ç†å¤šä¸ªHTTPè¯·æ±‚ã€‚æ‰€æœ‰è¯·æ±‚çš„å¤„ç†éƒ½åœ¨ä¸€æ¡TCPè¿žæŽ¥ä¸Šå®Œæˆï¼Œå› æ­¤TCPçš„å¤„ç†æ•ˆçŽ‡å¾—åˆ°æé«˜ã€‚ èµ‹äºˆè¯·æ±‚ä¼˜å…ˆçº§ï¼šSPDYä¸ä»…å¯ä»¥æ— é™åˆ¶åœ°å¹¶å‘å¤„ç†è¯·æ±‚ï¼Œè¿˜å¯ä»¥ç»™è¯·æ±‚é€ä¸ªåˆ†é…ä¼˜å…ˆçº§é¡ºåºã€‚è¿™æ ·ä¸»è¦æ˜¯ä¸ºäº†åœ¨å‘é€å¤šä¸ªè¯·æ±‚æ—¶ï¼Œè§£å†³å› å¸¦å®½ä½Žè€Œå¯¼è‡´å“åº”å˜æ…¢çš„é—®é¢˜ã€‚ åŽ‹ç¼©HTTPé¦–éƒ¨ï¼šåŽ‹ç¼©HTTPè¯·æ±‚å’Œå“åº”çš„é¦–éƒ¨ã€‚ æŽ¨é€åŠŸèƒ½ï¼šæ”¯æŒæœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æŽ¨é€æ•°æ®çš„åŠŸèƒ½ã€‚ æœåŠ¡å™¨æç¤ºåŠŸèƒ½ï¼šæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨æç¤ºå®¢æˆ·ç«¯è¯·æ±‚æ‰€éœ€çš„èµ„æºã€‚ç”±äºŽåœ¨å®¢æˆ·ç«¯å‘çŽ°èµ„æºä¹‹å‰å°±å¯ä»¥èŽ·çŸ¥èµ„æºçš„å­˜åœ¨ï¼Œå› æ­¤åœ¨èµ„æºå·²ç¼“å­˜ç­‰æƒ…å†µä¸‹ï¼Œå¯ä»¥é¿å…å‘é€ä¸å¿…è¦çš„è¯·æ±‚ã€‚ WebSocket åˆ©ç”¨Ajaxå’ŒCometæŠ€æœ¯è¿›è¡Œé€šä¿¡å¯ä»¥æå‡Webçš„æµè§ˆé€Ÿåº¦ã€‚ä½†é—®é¢˜åœ¨äºŽé€šä¿¡è‹¥ä½¿ç”¨HTTPåè®®ï¼Œå°±æ— æ³•å½»åº•è§£å†³ç“¶é¢ˆé—®é¢˜ã€‚ WebSocketæŠ€æœ¯ä¸»è¦æ˜¯ä¸ºäº†è§£å†³Ajaxå’ŒCometé‡ŒXMLHttpRequsté™„å¸¦çš„ç¼ºé™·æ‰€å¼•èµ·çš„é—®é¢˜ã€‚ ä¸€æ—¦WebæœåŠ¡å™¨ä¸Žå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹èµ·WebSocketåè®®çš„é€šä¿¡è¿žæŽ¥ï¼Œä¹‹åŽæ‰€æœ‰çš„é€šä¿¡éƒ½ä¾é è¿™ä¸ªä¸“ç”¨åè®®è¿›è¡Œã€‚é€šä¿¡è¿‡ç¨‹ä¸­å¯äº’ç›¸å‘é€JSONã€XMLã€HTMLæˆ–å›¾ç‰‡ç­‰ä»»æ„æ ¼å¼çš„æ•°æ®ã€‚ WebSocketçš„ä¸»è¦ç‰¹ç‚¹ï¼š æŽ¨é€åŠŸèƒ½ï¼šæ”¯æŒç”±æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æŽ¨é€æ•°æ®ã€‚ å‡å°‘é€šä¿¡é‡ï¼šå’ŒHTTPç›¸æ¯”ï¼Œä¸ä½†æ¯æ¬¡è¿žæŽ¥æ—¶çš„æ€»å¼€é”€å‡å°‘ï¼Œè€Œä¸”ç”±äºŽWebSocketçš„é¦–éƒ¨ä¿¡æ¯å¾ˆå°ï¼Œé€šä¿¡é‡ä¹Ÿç›¸åº”è¾ƒå°‘ã€‚ ä¸ºäº†å®žçŽ°WebSocketé€šä¿¡ï¼Œåœ¨HTTPè¿žæŽ¥å»ºç«‹ä¹‹åŽï¼Œéœ€è¦å®Œæˆä¸€æ¬¡â€œæ¡æ‰‹â€çš„æ­¥éª¤ã€‚ æ¡æ‰‹Â·è¯·æ±‚ï¼šä¸ºäº†å®žçŽ°WebSocketé€šä¿¡ï¼Œéœ€è¦ç”¨åˆ°HTTPçš„Upgradeé¦–éƒ¨å­—æ®µï¼Œå‘ŠçŸ¥æœåŠ¡å™¨é€šä¿¡åè®®å‘ç”Ÿæ”¹å˜ï¼Œä»¥è¾¾åˆ°æ¡æ‰‹çš„ç›®çš„ã€‚ æ¡æ‰‹Â·å“åº”ï¼šå¯¹äºŽä¹‹å‰çš„è¯·æ±‚ï¼Œè¿”å›žçŠ¶æ€ç 101 Switching Protocols çš„å“åº”ã€‚ æˆåŠŸæ¡æ‰‹ç¡®ç«‹WebSocketè¿žæŽ¥åŽï¼Œé€šä¿¡æ—¶ä¸å†ä½¿ç”¨HTTPçš„æ•°æ®å¸§ï¼Œè€Œé‡‡ç”¨WebSocketç‹¬ç«‹çš„æ•°æ®å¸§ã€‚ ç”±äºŽæ˜¯å»ºç«‹åœ¨HTTPåŸºç¡€ä¸Šçš„åè®®ï¼Œå› æ­¤è¿žæŽ¥çš„å‘èµ·æ–¹ä»æ˜¯å®¢æˆ·ç«¯ï¼Œè€Œä¸€æ—¦ç¡®ç«‹WebSocketé€šä¿¡è¿žæŽ¥ï¼Œä¸è®ºæœåŠ¡å™¨ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œä»»æ„ä¸€æ–¹éƒ½å¯ç›´æŽ¥å‘å¯¹æ–¹å‘é€æŠ¥æ–‡ã€‚ æ•´ç†è‡ªï¼šhttps://github.com/JChehe/blog/blob/master/posts/ã€Šå›¾è§£HTTPã€‹è¯»ä¹¦ç¬”è®°.md]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹]]></title>
    <url>%2F2019%2F01%2F18%2Fnetwork%2F5.TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬äº”ç¯‡æ–‡ç« ã€‚é¢è¯•è®²åˆ°TCPï¼Œé‚£ä¹ˆåŸºæœ¬éƒ½ä¼šé—®ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Œä»¥åŠæ¯”å¦‚å¯¹äºŽæ¡æ‰‹ï¼Œä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ï¼Œæœ¬ç« è¯¦ç»†æŽ¢è®¨å…¶ä¸­çš„é—¨é“ã€‚ 1.å¤ä¹  é¦–å…ˆé’ˆå¯¹httpåè®®ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å¤ä¹ ä¸€ä¸‹æœ€é‡è¦çš„ä¸œè¥¿ã€‚ HTTPåè®®å³è¶…æ–‡æœ¬ä¼ é€åè®®(Hypertext Transfer Protocol )ï¼Œæ˜¯Webè”ç½‘çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯æ‰‹æœºè”ç½‘å¸¸ç”¨çš„åè®®ä¹‹ä¸€ï¼ŒHTTPåè®®æ˜¯å»ºç«‹åœ¨TCPåè®®ä¹‹ä¸Šçš„ä¸€ç§åº”ç”¨ã€‚ åœ¨HTTP 1.0ä»¥0.9ç‰ˆæœ¬ä¸­ï¼Œå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚éƒ½è¦æ±‚å»ºç«‹ä¸€æ¬¡å•ç‹¬çš„è¿žæŽ¥ï¼Œåœ¨å¤„ç†å®Œæœ¬æ¬¡è¯·æ±‚åŽï¼Œå°±è‡ªåŠ¨é‡Šæ”¾è¿žæŽ¥ã€‚ åœ¨HTTP 1.1ä¸­åˆ™å¯ä»¥åœ¨ä¸€æ¬¡è¿žæŽ¥ä¸­å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”å¤šä¸ªè¯·æ±‚å¯ä»¥é‡å è¿›è¡Œï¼Œä¸éœ€è¦ç­‰å¾…ä¸€ä¸ªè¯·æ±‚ç»“æŸåŽå†å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚ ç”±äºŽHTTPåœ¨æ¯æ¬¡è¯·æ±‚ç»“æŸåŽéƒ½ä¼šä¸»åŠ¨é‡Šæ”¾è¿žæŽ¥ï¼Œå› æ­¤HTTPè¿žæŽ¥æ˜¯ä¸€ç§â€œçŸ­è¿žæŽ¥â€ï¼Œè¦ä¿æŒå®¢æˆ·ç«¯ç¨‹åºçš„åœ¨çº¿çŠ¶æ€ï¼Œéœ€è¦ä¸æ–­åœ°å‘æœåŠ¡å™¨å‘èµ·è¿žæŽ¥è¯·æ±‚ã€‚ é€šå¸¸çš„åšæ³•æ˜¯å³ä½¿ä¸éœ€è¦èŽ·å¾—ä»»ä½•æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¿æŒæ¯éš”ä¸€æ®µå›ºå®šçš„æ—¶é—´å‘æœåŠ¡å™¨å‘é€ä¸€æ¬¡â€œä¿æŒè¿žæŽ¥â€çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯¥è¯·æ±‚åŽå¯¹å®¢æˆ·ç«¯è¿›è¡Œå›žå¤ï¼Œè¡¨æ˜ŽçŸ¥é“ å®¢æˆ·ç«¯â€œåœ¨çº¿â€ã€‚ è‹¥æœåŠ¡å™¨é•¿æ—¶é—´æ— æ³•æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œåˆ™è®¤ä¸ºå®¢æˆ·ç«¯â€œä¸‹çº¿â€ï¼Œè‹¥å®¢æˆ·ç«¯é•¿æ—¶é—´æ— æ³•æ”¶åˆ°æœåŠ¡å™¨çš„å›žå¤ï¼Œåˆ™è®¤ä¸ºç½‘ç»œå·²ç»æ–­å¼€ã€‚ 2.SOCKETåŽŸç† 2.1 å¥—æŽ¥å­—ï¼ˆsocketï¼‰æ¦‚å¿µ åˆæ¬¡æŽ¥è§¦è¿™ä¸ªåè¯ï¼šâ€œå¥—æŽ¥å­—â€ï¼Œè¯´å®žè¯ï¼Œå¿ƒé‡Œæ˜¯è’™è”½çš„ï¼Œè¿™æ˜¯å•¥çŽ©æ„ï¼Œä½†æ˜¯å¯ä»¥åŽ»æœç´¢ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¥—æŽ¥ç®¡ï¼š æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸¤ä¸ªç®¡å­å¯èƒ½ç›´æŽ¥è¿žçš„è¯è¿žä¸èµ·æ¥ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä¸­é—´ä¸€ä¸ªä¸œè¥¿è¿žæŽ¥èµ·æ¥ã€‚ é‚£ä¹ˆï¼ŒçŽ°åœ¨å°±å¥½ç†è§£äº†ï¼Œä¸¤ä¸ªç¨‹åºè¦é€šä¿¡ï¼Œéœ€è¦çŸ¥é“å¯¹æ–¹çš„ä¸€äº›ä¿¡æ¯ï¼šè¿žæŽ¥ä½¿ç”¨çš„åè®®ï¼Œæœ¬åœ°ä¸»æœºçš„IPåœ°å€ï¼Œæœ¬åœ°è¿›ç¨‹çš„åè®®ç«¯å£ï¼Œè¿œåœ°ä¸»æœºçš„IPåœ°å€ï¼Œè¿œåœ°è¿›ç¨‹çš„åè®®ç«¯å£ã€‚ å®ƒæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒæ˜¯ç½‘ç»œé€šä¿¡è¿‡ç¨‹ä¸­ç«¯ç‚¹çš„æŠ½è±¡è¡¨ç¤ºï¼Œè¿™ä¸ªæŠ½è±¡é‡Œé¢å°±åŒ…å«äº†ç½‘ç»œé€šä¿¡å¿…é¡»çš„äº”ç§ä¿¡æ¯ï¼šè¿žæŽ¥ä½¿ç”¨çš„åè®®ï¼Œæœ¬åœ°ä¸»æœºçš„IPåœ°å€ï¼Œæœ¬åœ°è¿›ç¨‹çš„åè®®ç«¯å£ï¼Œè¿œåœ°ä¸»æœºçš„IPåœ°å€ï¼Œè¿œåœ°è¿›ç¨‹çš„åè®®ç«¯å£ã€‚ é‚£ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨å®ƒå‘¢ï¼Ÿ åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šï¼ŒTCPåè®®ä¸ŽUDPåè®®å¯ä»¥åŒæ—¶ä½¿ç”¨ç›¸åŒçš„portè€Œäº’ä¸å¹²æ‰°ã€‚ æ“ä½œç³»ç»Ÿæ ¹æ®å¥—æŽ¥å­—åœ°å€ï¼Œå¯ä»¥å†³å®šåº”è¯¥å°†æ•°æ®é€è¾¾ç‰¹å®šçš„è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚è¿™å°±åƒæ˜¯ç”µè¯ç³»ç»Ÿä¸­ï¼Œä»¥ç”µè¯å·ç åŠ ä¸Šåˆ†æœºå·ç ï¼Œæ¥å†³å®šé€šè¯å¯¹è±¡ä¸€èˆ¬ã€‚ å› ä¸ºæˆ‘ä»¬ç”µè„‘ä¸Šå¯èƒ½ä¼šè·‘å¾ˆå¤šçš„åº”ç”¨ç¨‹åºï¼ŒTCPåè®®ç«¯å£éœ€è¦ä¸ºè¿™äº›åŒæ—¶è¿è¡Œçš„ç¨‹åºæä¾›å¹¶å‘æœåŠ¡ï¼Œæˆ–è€…è¯´ï¼Œä¼ è¾“å±‚éœ€è¦ä¸ºåº”ç”¨å±‚çš„å¤šä¸ªè¿›ç¨‹æä¾›é€šä¿¡æœåŠ¡ï¼Œæ¯ä¸ªè¿›ç¨‹èµ·ä¸€ä¸ªTCPè¿žæŽ¥ï¼Œé‚£ä¹ˆè¿™å¤šä¸ªTCPè¿žæŽ¥å¯èƒ½æ˜¯é€šè¿‡åŒä¸€ä¸ª TCPåè®®ç«¯å£ä¼ è¾“æ•°æ®ã€‚ å¦‚ä½•åŒºåˆ«å“ªä¸ªè¿›ç¨‹å¯¹åº”å“ªä¸ªTCPè¿žæŽ¥å‘¢ï¼Ÿ è®¸å¤šè®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸ºåº”ç”¨ç¨‹åºä¸ŽTCPï¼IPåè®®äº¤äº’æä¾›äº†å¥—æŽ¥å­—(Socket)æŽ¥å£ã€‚åº” ç”¨å±‚å¯ä»¥å’Œä¼ è¾“å±‚é€šè¿‡SocketæŽ¥å£ï¼ŒåŒºåˆ†æ¥è‡ªä¸åŒåº”ç”¨ç¨‹åºè¿›ç¨‹æˆ–ç½‘ç»œè¿žæŽ¥çš„é€šä¿¡ï¼Œå®žçŽ°æ•°æ®ä¼ è¾“çš„å¹¶å‘æœåŠ¡ã€‚ 2.2 å»ºç«‹socketè¿žæŽ¥ å»ºç«‹Socketè¿žæŽ¥è‡³å°‘éœ€è¦ä¸€å¯¹å¥—æŽ¥å­—ï¼Œå…¶ä¸­ä¸€ä¸ªè¿è¡ŒäºŽå®¢æˆ·ç«¯ï¼Œç§°ä¸ºClientSocket ï¼Œå¦ä¸€ä¸ªè¿è¡ŒäºŽæœåŠ¡å™¨ç«¯ï¼Œç§°ä¸ºServerSocket ã€‚ å¥—æŽ¥å­—ä¹‹é—´çš„è¿žæŽ¥è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šæœåŠ¡å™¨ç›‘å¬ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¿žæŽ¥ç¡®è®¤ã€‚ æœåŠ¡å™¨ç›‘å¬ï¼šæœåŠ¡å™¨ç«¯å¥—æŽ¥å­—å¹¶ä¸å®šä½å…·ä½“çš„å®¢æˆ·ç«¯å¥—æŽ¥å­—ï¼Œè€Œæ˜¯å¤„äºŽç­‰å¾…è¿žæŽ¥çš„çŠ¶æ€ï¼Œå®žæ—¶ç›‘æŽ§ç½‘ç»œçŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿žæŽ¥è¯·æ±‚ã€‚ å®¢æˆ·ç«¯è¯·æ±‚ï¼šæŒ‡å®¢æˆ·ç«¯çš„å¥—æŽ¥å­—æå‡ºè¿žæŽ¥è¯·æ±‚ï¼Œè¦è¿žæŽ¥çš„ç›®æ ‡æ˜¯æœåŠ¡å™¨ç«¯çš„å¥—æŽ¥å­—ã€‚ä¸ºæ­¤ï¼Œå®¢æˆ·ç«¯çš„å¥—æŽ¥å­—å¿…é¡»é¦–å…ˆæè¿°å®ƒè¦è¿žæŽ¥çš„æœåŠ¡å™¨çš„å¥—æŽ¥å­—ï¼ŒæŒ‡å‡ºæœåŠ¡å™¨ç«¯å¥—æŽ¥å­—çš„åœ°å€å’Œç«¯å£å·ï¼Œç„¶åŽå°±å‘æœåŠ¡å™¨ç«¯å¥—æŽ¥å­—æå‡ºè¿žæŽ¥è¯·æ±‚ã€‚ è¿žæŽ¥ç¡®è®¤ï¼šå½“æœåŠ¡å™¨ç«¯å¥—æŽ¥å­—ç›‘å¬åˆ°æˆ–è€…è¯´æŽ¥æ”¶åˆ°å®¢æˆ·ç«¯å¥—æŽ¥å­—çš„è¿žæŽ¥è¯·æ±‚æ—¶ï¼Œå°±å“åº”å®¢æˆ·ç«¯å¥—æŽ¥å­—çš„è¯·æ±‚ï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼ŒæŠŠæœåŠ¡å™¨ç«¯å¥—æŽ¥å­—çš„æè¿°å‘ ç»™å®¢æˆ·ç«¯ï¼Œä¸€æ—¦å®¢æˆ·ç«¯ç¡®è®¤äº†æ­¤æè¿°ï¼ŒåŒæ–¹å°±æ­£å¼å»ºç«‹è¿žæŽ¥ã€‚è€ŒæœåŠ¡å™¨ç«¯å¥—æŽ¥å­—ç»§ç»­å¤„äºŽç›‘å¬çŠ¶æ€ï¼Œç»§ç»­æŽ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯å¥—æŽ¥å­—çš„è¿žæŽ¥è¯·æ±‚ã€‚ 2.3 SOCKETè¿žæŽ¥ä¸ŽTCPè¿žæŽ¥ åˆ›å»ºSocketè¿žæŽ¥æ—¶ï¼Œå¯ä»¥æŒ‡å®šä½¿ç”¨çš„ä¼ è¾“å±‚åè®®ï¼ŒSocketå¯ä»¥æ”¯æŒä¸åŒçš„ä¼ è¾“å±‚åè®®ï¼ˆTCPæˆ–UDPï¼‰ï¼Œå½“ä½¿ç”¨TCPåè®®è¿›è¡Œè¿žæŽ¥æ—¶ï¼Œè¯¥Socketè¿žæŽ¥å°±æ˜¯ä¸€ä¸ªTCPè¿žæŽ¥ã€‚ 3.TCPåŸºæœ¬å­—æ®µ TCPï¼ˆTransmission Control Protocol ä¼ è¾“æŽ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§é¢å‘è¿žæŽ¥çš„ã€å¯é çš„ã€åŸºäºŽå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚ é’ˆå¯¹åè®®ä¸­çš„å­—æ®µï¼Œæˆ‘ä»¬åªéœ€è¦äº†è§£ä¸€ä¸‹ï¼šACKã€SYNã€åºå·è¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚ ACK : ç¡®è®¤ TCPåè®®è§„å®šï¼Œåªæœ‰ACK=1æ—¶æœ‰æ•ˆï¼Œä¹Ÿè§„å®šè¿žæŽ¥å»ºç«‹åŽæ‰€æœ‰å‘é€çš„æŠ¥æ–‡çš„ACKå¿…é¡»ä¸º1 SYN ï¼š åœ¨è¿žæŽ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚ å½“SYN=1è€ŒACK=0æ—¶ï¼Œè¡¨æ˜Žè¿™æ˜¯ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ã€‚ å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿žæŽ¥ï¼Œåˆ™åº”åœ¨å“åº”æŠ¥æ–‡ä¸­ä½¿SYN=1å’ŒACK=1. å› æ­¤, SYNç½®1å°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æˆ–è¿žæŽ¥æŽ¥å—æŠ¥æ–‡ã€‚ FIN å³ç»ˆç»“çš„æ„æ€ï¼Œ ç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿žæŽ¥ã€‚ å½“ FIN = 1 æ—¶ï¼Œè¡¨æ˜Žæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿žæŽ¥ã€‚ 4.ä¸‰æ¬¡æ¡æ‰‹(é‡è¦ï¼Œç»†è¯») é¦–å…ˆï¼ŒTCPä½œä¸ºä¸€ç§å¯é ä¼ è¾“æŽ§åˆ¶åè®®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³ï¼šæ—¢è¦ä¿è¯æ•°æ®å¯é ä¼ è¾“ï¼Œåˆè¦æé«˜ä¼ è¾“çš„æ•ˆçŽ‡ï¼Œè€Œç”¨ä¸‰æ¬¡æ°æ°å¯ä»¥æ»¡è¶³ä»¥ä¸Šä¸¤æ–¹é¢çš„éœ€æ±‚ï¼ ç„¶åŽï¼Œè¦æ˜Žç¡®TCPè¿žæŽ¥æ¡æ‰‹ï¼Œæ¡çš„æ˜¯å•¥ï¼Ÿ ç­”æ¡ˆï¼šé€šä¿¡åŒæ–¹æ•°æ®åŽŸç‚¹çš„åºåˆ—å·ï¼ æˆ‘ä»¬åœ¨ä¸Šé¢ä¸€ç¯‡æ–‡ç« çŸ¥é“ï¼Œæ¶ˆæ¯çš„å®Œæ•´æ˜¯é ç»™æ¯ä¸ªæ¶ˆæ¯åŒ…æžä¸€ä¸ªç¼–å·ï¼Œä¾æ¬¡åœ°ACKç¡®è®¤ã€‚ç¡®è®¤æœºåˆ¶æ˜¯ç´¯è®¡çš„ï¼Œæ„å‘³ç€ X åºåˆ—å·ä¹‹å‰(ä¸åŒ…æ‹¬ X) åŒ…éƒ½æ˜¯è¢«ç¡®è®¤æŽ¥æ”¶åˆ°çš„ã€‚ TCPå¯é ä¼ è¾“çš„ç²¾é«“ï¼šTCPè¿žæŽ¥çš„ä¸€æ–¹Aï¼Œç”±æ“ä½œç³»ç»ŸåŠ¨æ€éšæœºé€‰å–ä¸€ä¸ª32ä½é•¿çš„åºåˆ—å·ï¼ˆInitial Sequence Numberï¼‰ã€‚ å‡è®¾Açš„åˆå§‹åºåˆ—å·ä¸º1000ï¼Œä»¥è¯¥åºåˆ—å·ä¸ºåŽŸç‚¹ï¼Œå¯¹è‡ªå·±å°†è¦å‘é€çš„æ¯ä¸ªå­—èŠ‚çš„æ•°æ®è¿›è¡Œç¼–å·ï¼Œ1001ï¼Œ1002ï¼Œ1003â€¦ï¼Œå¹¶æŠŠè‡ªå·±çš„åˆå§‹åºåˆ—å·ISNå‘Šè¯‰Bã€‚ è®©Bæœ‰ä¸€ä¸ªæ€æƒ³å‡†å¤‡ï¼Œä»€ä¹ˆæ ·ç¼–å·çš„æ•°æ®æ˜¯åˆæ³•çš„ï¼Œä»€ä¹ˆç¼–å·æ˜¯éžæ³•çš„ï¼Œæ¯”å¦‚ç¼–å·900å°±æ˜¯éžæ³•çš„ï¼ŒåŒæ—¶Bè¿˜å¯ä»¥å¯¹Aæ¯ä¸€ä¸ªç¼–å·çš„å­—èŠ‚æ•°æ®è¿›è¡Œç¡®è®¤ã€‚ å¦‚æžœAæ”¶åˆ°Bç¡®è®¤ç¼–å·ä¸º2001ï¼Œåˆ™æ„å‘³ç€å­—èŠ‚ç¼–å·ä¸º1001-2000ï¼Œå…±1000ä¸ªå­—èŠ‚å·²ç»å®‰å…¨åˆ°è¾¾ã€‚ åŒç†Bä¹Ÿæ˜¯ç±»ä¼¼çš„æ“ä½œï¼Œå‡è®¾Bçš„åˆå§‹åºåˆ—å·ISNä¸º2000ï¼Œä»¥è¯¥åºåˆ—å·ä¸ºåŽŸç‚¹ï¼Œå¯¹è‡ªå·±å°†è¦å‘é€çš„æ¯ä¸ªå­—èŠ‚çš„æ•°æ®è¿›è¡Œç¼–å·ï¼Œ2001ï¼Œ2002ï¼Œ2003â€¦ï¼Œå¹¶æŠŠè‡ªå·±çš„åˆå§‹åºåˆ—å·ISNå‘Šè¯‰Aï¼Œä»¥ä¾¿Aå¯ä»¥ç¡®è®¤Bå‘é€çš„æ¯ä¸€ä¸ªå­—èŠ‚ã€‚å¦‚æžœBæ”¶åˆ°Aç¡®è®¤ç¼–å·ä¸º4001ï¼Œåˆ™æ„å‘³ç€å­—èŠ‚ç¼–å·ä¸º2001-4000ï¼Œå…±2000ä¸ªå­—èŠ‚å·²ç»å®‰å…¨åˆ°è¾¾ã€‚ å¥½äº†ï¼Œåœ¨ç†è§£äº†æ¡æ‰‹çš„æœ¬è´¨ä¹‹åŽï¼Œä¸‹é¢å°±å¯ä»¥æ€»ç»“ä¸Šé¢å›¾çš„æ¡æ‰‹è¿‡ç¨‹äº†ã€‚ å¯¹äºŽAä¸ŽBçš„æ¡æ‰‹è¿‡ç¨‹ï¼Œå¯ä»¥æ€»ç»“ä¸ºï¼š A å‘é€åŒæ­¥ä¿¡å·SYN + A's Initial sequence numberï¼ˆä¸¢å¤±ä¼šAä¼šé‡ä¼ ï¼‰ B ç¡®è®¤æ”¶åˆ°Açš„åŒæ­¥ä¿¡å·ï¼Œå¹¶è®°å½• A's ISN åˆ°æœ¬åœ°ï¼Œå‘½å B's ACK sequence number Bå‘é€åŒæ­¥ä¿¡å·SYN + B's Initial sequence number ï¼ˆä¸¢å¤±Bä¼šå‘¨æœŸæ€§è¶…æ—¶é‡ä¼ ï¼Œç›´åˆ°æ”¶åˆ°Açš„ç¡®è®¤ï¼‰ Aç¡®è®¤æ”¶åˆ°Bçš„åŒæ­¥ä¿¡å·ï¼Œå¹¶è®°å½• B's ISN åˆ°æœ¬åœ°ï¼Œå‘½å A's ACK sequence number å¾ˆæ˜¾ç„¶2å’Œ3 è¿™ä¸¤ä¸ªæ­¥éª¤å¯ä»¥åˆå¹¶ï¼Œåªéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¯ä»¥æé«˜è¿žæŽ¥çš„é€Ÿåº¦ä¸Žæ•ˆçŽ‡ã€‚ è¿™é‡Œå°±ä¼šå¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼Œä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿ A å‘é€åŒæ­¥ä¿¡å·SYN + Aâ€™s Initial sequence number Bå‘é€åŒæ­¥ä¿¡å·SYN + Bâ€™s Initial sequence number + Bâ€™s ACK sequence number è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒAä¸ŽBå°±Açš„åˆå§‹åºåˆ—å·è¾¾æˆäº†ä¸€è‡´ï¼Œä½†æ˜¯Bæ— æ³•çŸ¥é“Aæ˜¯å¦å·²ç»æŽ¥æ”¶åˆ°è‡ªå·±çš„åŒæ­¥ä¿¡å·ï¼Œå¦‚æžœè¿™ä¸ªåŒæ­¥ä¿¡å·ä¸¢å¤±äº†ï¼ŒAå’ŒBå°±Bçš„åˆå§‹åºåˆ—å·å°†æ— æ³•è¾¾æˆä¸€è‡´ã€‚ æ‰€ä»¥Aå¿…é¡»å†ç»™Bä¸€ä¸ªç¡®è®¤ï¼Œä»¥ç¡®è®¤Aå·²ç»æŽ¥æ”¶åˆ°Bçš„åŒæ­¥ä¿¡å·ã€‚ å¦‚æžœAå‘ç»™Bçš„ç¡®è®¤ä¸¢äº†ï¼Œè¯¥å¦‚ä½•ï¼Ÿ Aä¼šè¶…æ—¶é‡ä¼ è¿™ä¸ªACKå—ï¼Ÿä¸ä¼šï¼TCPä¸ä¼šä¸ºæ²¡æœ‰æ•°æ®çš„ACKè¶…æ—¶é‡ä¼ ã€‚ é‚£è¯¥å¦‚ä½•æ˜¯å¥½ï¼ŸBå¦‚æžœæ²¡æœ‰æ”¶åˆ°Açš„ACKï¼Œä¼šè¶…æ—¶é‡ä¼ è‡ªå·±çš„SYNåŒæ­¥ä¿¡å·ï¼Œä¸€ç›´åˆ°æ”¶åˆ°Açš„ACKä¸ºæ­¢ã€‚ å†™åˆ°è¿™é‡Œï¼Œå…¶å®žæˆ‘ä»¬å·²ç»æ˜Žç™½äº†ï¼Œæ¡æ‰‹å…¶å®žå°±æ˜¯å„è‡ªç¡®è®¤å¯¹æ–¹çš„åºåˆ—å·ã€‚å› ä¸ºåŽé¢çš„æ•°æ®ç¼–å·å°±ä¼šä»¥æ­¤ä¸ºåŸºç¡€ï¼Œä»Žè€Œä¿è¯åŽç»­æ•°æ®çš„å¯é æ€§ã€‚ è°¢å¸Œä»ç‰ˆã€Šè®¡ç®—æœºç½‘ç»œã€‹ä¸­çš„ä¾‹å­æ˜¯è¿™æ ·çš„ï¼Œâ€œå·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€çš„äº§ç”Ÿåœ¨è¿™æ ·ä¸€ç§æƒ…å†µä¸‹ï¼šclientå‘å‡ºçš„ç¬¬ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µå¹¶æ²¡æœ‰ä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æŸä¸ªç½‘ç»œç»“ç‚¹é•¿æ—¶é—´çš„æ»žç•™äº†ï¼Œä»¥è‡´å»¶è¯¯åˆ°è¿žæŽ¥é‡Šæ”¾ä»¥åŽçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾serverã€‚æœ¬æ¥è¿™æ˜¯ä¸€ä¸ªæ—©å·²å¤±æ•ˆçš„æŠ¥æ–‡æ®µã€‚ä½†serveræ”¶åˆ°æ­¤å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µåŽï¼Œå°±è¯¯è®¤ä¸ºæ˜¯clientå†æ¬¡å‘å‡ºçš„ä¸€ä¸ªæ–°çš„è¿žæŽ¥è¯·æ±‚ã€‚äºŽæ˜¯å°±å‘clientå‘å‡ºç¡®è®¤æŠ¥æ–‡æ®µï¼ŒåŒæ„å»ºç«‹è¿žæŽ¥ã€‚å‡è®¾ä¸é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦serverå‘å‡ºç¡®è®¤ï¼Œæ–°çš„è¿žæŽ¥å°±å»ºç«‹äº†ã€‚ç”±äºŽçŽ°åœ¨clientå¹¶æ²¡æœ‰å‘å‡ºå»ºç«‹è¿žæŽ¥çš„è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šç†ç¬serverçš„ç¡®è®¤ï¼Œä¹Ÿä¸ä¼šå‘serverå‘é€æ•°æ®ã€‚ä½†serverå´ä»¥ä¸ºæ–°çš„è¿è¾“è¿žæŽ¥å·²ç»å»ºç«‹ï¼Œå¹¶ä¸€ç›´ç­‰å¾…clientå‘æ¥æ•°æ®ã€‚è¿™æ ·ï¼Œserverçš„å¾ˆå¤šèµ„æºå°±ç™½ç™½æµªè´¹æŽ‰äº†ã€‚é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€çš„åŠžæ³•å¯ä»¥é˜²æ­¢ä¸Šè¿°çŽ°è±¡å‘ç”Ÿã€‚ä¾‹å¦‚åˆšæ‰é‚£ç§æƒ…å†µï¼Œclientä¸ä¼šå‘serverçš„ç¡®è®¤å‘å‡ºç¡®è®¤ã€‚serverç”±äºŽæ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±çŸ¥é“clientå¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¿žæŽ¥ã€‚â€ ä½†æ˜¯æœ‰çš„äººæŒ‡å‡ºï¼Œå…¶å®žè¿™åªæ˜¯è¡¨è±¡ï¼Œæˆ–è€…è¯´å¹¶ä¸æ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„è®¾è®¡åˆè¡·ï¼Œæˆ‘è¡¨ç¤ºè®¤åŒï¼Œè¿™ä¸ªé˜²æ­¢å·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µåº”è¯¥åªæ˜¯é™„åŠ çš„ä¸€äº›å¥½å¤„ï¼Œè€Œä¸åº”è¯¥æ˜¯è§£é‡Šä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„åŽŸå› ã€‚ TCPåˆå§‹é˜¶æ®µä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŽŸå› æ€»ç»“å¦‚ä¸‹ï¼š ä¸ºäº†å®žçŽ°å¯é æ•°æ®ä¼ è¾“ï¼Œ TCP åè®®çš„é€šä¿¡åŒæ–¹ï¼Œ éƒ½å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåºåˆ—å·ï¼Œ ä»¥æ ‡è¯†å‘é€å‡ºåŽ»çš„æ•°æ®åŒ…ä¸­ï¼Œ å“ªäº›æ˜¯å·²ç»è¢«å¯¹æ–¹æ”¶åˆ°çš„ã€‚ ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹å³æ˜¯é€šä¿¡åŒæ–¹ç›¸äº’å‘ŠçŸ¥åºåˆ—å·èµ·å§‹å€¼ï¼Œ å¹¶ç¡®è®¤å¯¹æ–¹å·²ç»æ”¶åˆ°äº†åºåˆ—å·èµ·å§‹å€¼çš„å¿…ç»æ­¥éª¤ï¼Œå¦‚æžœåªæ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Œ è‡³å¤šåªæœ‰è¿žæŽ¥å‘èµ·æ–¹çš„èµ·å§‹åºåˆ—å·èƒ½è¢«ç¡®è®¤ï¼Œ å¦ä¸€æ–¹é€‰æ‹©çš„åºåˆ—å·åˆ™å¾—ä¸åˆ°ç¡®è®¤ã€‚ 5.å››æ¬¡æŒ¥æ‰‹ å½“ä¸»æœº1å‘å‡ºFINæŠ¥æ–‡æ®µæ—¶ï¼Œåªæ˜¯è¡¨ç¤ºä¸»æœº1å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä¸»æœº1å‘Šè¯‰ä¸»æœº2ï¼Œå®ƒçš„æ•°æ®å·²ç»å…¨éƒ¨å‘é€å®Œæ¯•äº†ï¼› ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™ä¸»æœº1è¿˜æ˜¯å¯ä»¥æŽ¥å—æ¥è‡ªä¸»æœº2çš„æ•°æ®ï¼› å½“ä¸»æœº2è¿”å›žACKæŠ¥æ–‡æ®µæ—¶ï¼Œè¡¨ç¤ºå®ƒå·²ç»çŸ¥é“ä¸»æœº1æ²¡æœ‰æ•°æ®å‘é€äº†ï¼Œä½†æ˜¯ä¸»æœº2è¿˜æ˜¯å¯ä»¥å‘é€æ•°æ®åˆ°ä¸»æœº1çš„ï¼› å½“ä¸»æœº2ä¹Ÿå‘é€äº†FINæŠ¥æ–‡æ®µæ—¶ï¼Œè¿™ä¸ªæ—¶å€™å°±è¡¨ç¤ºä¸»æœº2ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œå°±ä¼šå‘Šè¯‰ä¸»æœº1ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼› ä¸»æœº1å‘Šè¯‰ä¸»æœº2çŸ¥é“äº†ï¼Œä¸»æœº2æ”¶åˆ°è¿™ä¸ªç¡®è®¤ä¹‹åŽå°±ç«‹é©¬å…³é—­è‡ªå·±ã€‚ ä¸»æœº1ç­‰å¾…2MSLä¹‹åŽä¹Ÿå…³é—­äº†è‡ªå·±ã€‚ é’ˆå¯¹æœ€åŽä¸€æ¡æ¶ˆæ¯ï¼Œå³ä¸»æœº1å‘é€ackåŽï¼Œä¸»æœº2æŽ¥æ”¶åˆ°æ­¤æ¶ˆæ¯ï¼Œå³è®¤ä¸ºåŒæ–¹è¾¾æˆäº†åŒæ­¥ï¼šåŒæ–¹éƒ½çŸ¥é“è¿žæŽ¥å¯ä»¥é‡Šæ”¾äº†ï¼Œæ­¤æ—¶Bå¯ä»¥å®‰å…¨åœ°é‡Šæ”¾æ­¤TCPè¿žæŽ¥æ‰€å ç”¨çš„å†…å­˜èµ„æºã€ç«¯å£å·ã€‚ æ‰€ä»¥è¢«åŠ¨å…³é—­çš„Bæ— éœ€ä»»ä½•wait timeï¼Œç›´æŽ¥é‡Šæ”¾èµ„æºã€‚ ä½†æ˜¯ä¸»æœº1å¹¶ä¸çŸ¥é“ä¸»æœº2æ˜¯å¦æŽ¥åˆ°è‡ªå·±çš„ACKï¼Œä¸»æœº1æ˜¯è¿™ä¹ˆæƒ³çš„ï¼š å¦‚æžœä¸»æœº2æ²¡æœ‰æ”¶åˆ°è‡ªå·±çš„ACKï¼Œä¸»æœº2ä¼šè¶…æ—¶é‡ä¼ FiNï¼Œé‚£ä¹ˆä¸»æœº1å†æ¬¡æŽ¥åˆ°é‡ä¼ çš„FINï¼Œä¼šå†æ¬¡å‘é€ACK å¦‚æžœä¸»æœº2æ”¶åˆ°è‡ªå·±çš„ACKï¼Œä¹Ÿä¸ä¼šå†å‘ä»»ä½•æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ACK æ— è®ºæ˜¯æƒ…å†µ1è¿˜æ˜¯2ï¼ŒAéƒ½éœ€è¦ç­‰å¾…ï¼Œè¦å–è¿™ä¸¤ç§æƒ…å†µç­‰å¾…æ—¶é—´çš„æœ€å¤§å€¼ï¼Œä»¥åº”å¯¹æœ€åçš„æƒ…å†µå‘ç”Ÿï¼Œè¿™ä¸ªæœ€åæƒ…å†µæ˜¯ï¼š ä¸»æœº2æ²¡æœ‰æ”¶åˆ°ä¸»æœº1çš„ACKï¼Œé‚£ä¹ˆè¶…æ—¶ä¹‹åŽä¸»æœº2ä¼šé‡ä¼ FINï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æµªè´¹ä¸€ä¸ªä¸»æœº1å‘å‡ºACKçš„æœ€å¤§å­˜æ´»æ—¶é—´(MSL)+FINæ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´(MSL) ä¸å¯èƒ½æ—¶é—´å†å¤šäº†ï¼Œè¿™ä¸ªå·²ç»é’ˆå¯¹æœ€ç³Ÿç³•çš„çŠ¶å†µã€‚ ç­‰å¾…2MSLæ—¶é—´ï¼ŒAå°±å¯ä»¥æ”¾å¿ƒåœ°é‡Šæ”¾TCPå ç”¨çš„èµ„æºã€ç«¯å£å·ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨è¯¥ç«¯å£å·è¿žæŽ¥ä»»ä½•æœåŠ¡å™¨ã€‚ åœ¨ç­‰å¾…çš„æ—¶é—´å†…ï¼Œä¸»æœº2å¯ä»¥é‡è¯•å¤šæ¬¡ï¼Œå› ä¸º2MSLæ—¶é—´ä¸º240ç§’ï¼Œè¶…æ—¶é‡ä¼ åªæœ‰0.5ç§’ï¼Œ1ç§’ï¼Œ2ç§’ï¼Œï¼Œ16ç§’ã€‚ å½“ä¸»æœº2é‡è¯•æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œä¸»æœº2ä¼šresetè¿žæŽ¥ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯2MSLæˆ‘ä»¬å·²ç»äº†è§£äº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦ç­‰è¿™ä¸ªæ—¶é—´å‘¢ï¼Ÿ å¦‚æžœä¸ç­‰ï¼Œé‡Šæ”¾çš„ç«¯å£å¯èƒ½ä¼šé‡è¿žåˆšæ–­å¼€çš„æœåŠ¡å™¨ç«¯å£ï¼Œè¿™æ ·ä¾ç„¶å­˜æ´»åœ¨ç½‘ç»œé‡Œçš„è€çš„TCPæŠ¥æ–‡å¯èƒ½ä¸Žæ–°TCPè¿žæŽ¥æŠ¥æ–‡å†²çªï¼Œé€ æˆæ•°æ®å†²çªï¼Œä¸ºé¿å…æ­¤ç§æƒ…å†µï¼Œéœ€è¦è€å¿ƒç­‰å¾…ç½‘ç»œè€çš„TCPè¿žæŽ¥çš„æ´»è·ƒæŠ¥æ–‡å…¨éƒ¨æ­»ç¿˜ç¿˜ï¼Œ2MSLæ—¶é—´å¯ä»¥æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚ æ•´ç†è‡ªï¼š https://www.zhihu.com/question/24853633 https://www.zhihu.com/question/67013338 https://github.com/jawil/blog/issues/14 https://www.jianshu.com/p/9968b16b607e]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCPåè®®å…¥é—¨]]></title>
    <url>%2F2019%2F01%2F18%2Fnetwork%2F4.TCP%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬å››ç¯‡æ–‡ç« ã€‚é¦–å…ˆè¦æ˜Žç¡®ï¼šä¿¡é“æœ¬èº«ä¸å¯é ï¼ˆä¸¢åŒ…ã€é‡å¤åŒ…ã€å‡ºé”™ã€ä¹±åºï¼‰ï¼Œä¸å®‰å…¨ã€‚æ‰€ä»¥å¼•å‡ºäº†ä¸ƒå±‚æˆ–äº”å±‚æ¨¡åž‹æ¥ä¿è¯ã€‚å› æ­¤ï¼Œä»»ä½•ä¸€ä¸ªä¸œè¥¿çš„æå‡ºéƒ½æ˜¯ä¸ºäº†è§£å†³æŸä¸ªé—®é¢˜çš„ã€‚å­¦ä¹ è®¡ç®—æœºï¼Œä»Žä»–çš„åŽ†å²å‡ºå‘ï¼Œç†è§£ä¸ºä»€ä¹ˆä¼šæœ‰ä¸æ–­ä½Žè¿­ä»£ï¼Œå› ä¸ºæ˜¯ä¸ºäº†è§£å†³æŸä¸ªç—›ç‚¹é—®é¢˜ã€‚æ¯”å¦‚HTTPçš„å‘å±•ï¼Œä¸ºä»€ä¹ˆåœ¨HTTP1.0åŸºç¡€ä¸Šè¿˜è¦æå‡ºHTTP1.1ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æå‡ºHTTP2.0ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä»–çš„å‘å±•åŽ†å²ä¹‹åŽå°±ä¼šæ˜Žç™½äº†ã€‚åŒæ ·ï¼Œä¸‹é¢å†è¯´ä¸€è¯´ä¸ºä»€ä¹ˆè¦æœ‰TCPåè®®ï¼ŒTCPåˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚ ä¸€ã€å›žé¡¾ é¦–å…ˆç®€å•å›žé¡¾ä¸€ä¸‹ã€‚ 1.1 ç‰©ç†å±‚ ç‰©ç†å±‚æ˜¯ç›¸å½“äºŽç‰©ç†è¿žæŽ¥ï¼Œå°†0101ä»¥ç”µä¿¡å·çš„å½¢å¼ä¼ è¾“å‡ºåŽ»ã€‚ 1.2 æ•°æ®é“¾è·¯å±‚ æ•°æ®é“¾è·¯å±‚ï¼Œæœ‰ä¸€ä¸ªå«åšä»¥å¤ªç½‘åè®®ï¼Œè§„å®šäº†ç”µå­ä¿¡å·æ˜¯å¦‚ä½•ç»„æˆæ•°æ®åŒ…çš„ï¼Œè¿™ä¸ªåè®®çš„å¤´é‡Œé¢ï¼ŒåŒ…å«äº†è‡ªèº«çš„ç½‘å¡ä¿¡æ¯ï¼Œè¿˜æœ‰ç›®çš„åœ°çš„ç½‘å¡ä¿¡æ¯ï¼ˆä¸€èˆ¬æˆ‘ä»¬å¯ä»¥çŸ¥é“å¯¹æ–¹çš„IPï¼ŒIPå¯ä»¥é€šè¿‡DNSè§£æžåˆ°ï¼Œç„¶åŽæ ¹æ®ARPåè®®å°†IPè½¬æ¢ä¸ºMACåœ°å€ï¼‰ã€‚é‚£ä¹ˆï¼Œå¦‚æžœåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¹¿æ’­çš„æ–¹å¼æ‰¾åˆ°å¯¹åº”MACåœ°å€çš„ä¸»æœºã€‚â€”å³ä»¥å¤ªç½‘åè®®è§£å†³äº†å­ç½‘å†…éƒ¨çš„ç‚¹å¯¹ç‚¹é€šä¿¡ã€‚ 1.3 ç½‘ç»œå±‚ ä½†æ˜¯å‘¢ï¼Œä»¥å¤ªç½‘åè®®ä¸èƒ½è§£å†³å¤šä¸ªå±€åŸŸç½‘é€šä¿¡ï¼Œæ¯ä¸ªå±€åŸŸç½‘ä¹‹é—´ä¸æ˜¯äº’é€šçš„ï¼Œé‚£ä¹ˆä»¥å¤ªç½‘è¿™ç§å¹¿æ’­çš„æ–¹å¼ä¸å¯ç”¨ï¼Œå°±ç®—å¯ç”¨ï¼Œç½‘ç»œé‚£ä¹ˆå¤§ï¼Œé€šè¿‡å¹¿æ’­è¿›è¡Œæ‰¾ï¼Œæ˜¯ä¸€ä¸ªå¯æ€•çš„åœºæ™¯ã€‚é‚£ä¹ˆï¼ŒIPåè®®å¯ä»¥è¿žæŽ¥å¤šä¸ªå±€åŸŸç½‘ï¼Œç®€å•æ¥è¯´ï¼ŒIP åè®®å®šä¹‰äº†ä¸€å¥—è‡ªå·±çš„åœ°å€è§„åˆ™ï¼Œç§°ä¸º IP åœ°å€ã€‚ç‰©ç†å™¨ä»¶ï¼Œæ¯”å¦‚è¯´è·¯ç”±å™¨ï¼Œå°±æ˜¯åŸºäºŽIPåè®®ï¼Œé‡Œé¢ä¿å­˜ä¸€å¥—åœ°å€æŒ‡è·¯ç‰Œï¼Œæƒ³åŽ»å“ªä¸ªå±€åŸŸç½‘ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç‰Œå­æ¥æ‰¾ï¼Œç„¶åŽé€æ­¥è·¯ç”±åˆ°ç›®æ ‡å±€åŸŸç½‘ï¼Œæœ€åŽå°±å¯ä»¥æ‰¾åˆ°é‚£å°ä¸»æœºäº†ã€‚IPå±‚å°±æ˜¯å¯¹åº”äº†ç½‘ç»œå±‚ã€‚ 1.4 ä¼ è¾“å±‚ é‚£ä¹ˆï¼Œæ­¤æ—¶è§£å†³äº†å¤šä¸ªå±€åŸŸç½‘è·¯ç”±é—®é¢˜ï¼Œä¹Ÿè§£å†³äº†å±€åŸŸç½‘å†…å¯»å€é—®é¢˜ï¼Œå³æˆ‘è¿™å°ä¸»æœºå·²ç»å¯ä»¥æ‰¾åˆ°é‚£å°ä¸»æœºäº†ï¼Œä¸‹é¢è¿˜æœ‰ä»€ä¹ˆäº‹æƒ…éœ€è¦åšå‘¢ï¼Ÿæ˜¾ç„¶ï¼Œæ‰¾åˆ°ä¸»æœºè¿˜ä¸è¡Œå•Šï¼Œæ¯”å¦‚æˆ‘ç”¨å¾®ä¿¡å‘ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘å‘åˆ°ä½ ä¸»æœºäº†ï¼Œä½†æ˜¯ä½ ä¸»æœºä¸Šçš„å¾®ä¿¡ä¸çŸ¥é“è¿™æ¡æ¶ˆæ¯å‘ç»™ä»–äº†ï¼Œè¿™é‡Œè¯´çš„å°±æ˜¯ç«¯å£ï¼Œä¿¡æ¯è¦å‘åˆ°è¿™ä¸ªç«¯å£ä¸Šï¼Œç›‘å¬è¿™ä¸ªç«¯å£çš„ç¨‹åºæ‰ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚ 1.5 åº”ç”¨å±‚ OKï¼Œæœ€ä¸Šå±‚çš„åº”ç”¨å±‚ï¼Œå°±æ˜¯æœ€è´´è¿‘ç”¨æˆ·çš„ï¼Œä»–çš„ä¸€ç³»åˆ—åè®®åªæ˜¯ä¸ºäº†è®©ä¸¤å°ä¸»æœºä¼šäº’ç›¸éƒ½ç†è§£è€Œå·²ã€‚ äºŒã€é—®é¢˜å’Œè§£å†³ 2.1 å­˜åœ¨çš„é—®é¢˜ åœ¨æ˜Žç™½äº†è®¡ç®—æœºç½‘ç»œä¸ºä»€ä¹ˆè¦è¿™å‡ å±‚æ¨¡åž‹ä¹‹åŽï¼Œæˆ‘ä»¬å†å›žåˆ°ä¸€å¼€å§‹ï¼Œå¦‚ä½•ä¿è¯å®‰å…¨ã€å¯é ã€å®Œæ•´åœ°ä¼ è¾“ä¿¡æ¯å‘¢ï¼Ÿ å¾ˆæ˜¾ç„¶ï¼Œä¸Šé¢æåˆ°çš„ï¼Œåªæ˜¯ä¿è¯ä¿¡æ¯èƒ½æ‰¾åˆ°å¯¹æ–¹ä¸»æœºå’Œç«¯å£ï¼Œä½†æ˜¯è¿™ä¸ªä¿¡æ¯ä¸­é€”è¢«æ‹¦æˆªäº†ã€ç”šè‡³è¢«ç¯¡æ”¹äº†ã€ä¿¡æ¯å»¶è¿Ÿäº†ï¼ˆå‡ åˆ†é’Ÿæˆ–è€…å‡ ä¸ªå°æ—¶ï¼Œæˆ–è€…å‡ ä¸ªä¸–çºªï¼‰ã€ç½‘ç»œä¸é€šæˆ–è€…æŒ‚äº†ï¼Œä¿¡æ¯è‡ªå·±å¯ä¸ä¼šå‘Šè¯‰ä½ ä»–æŒ‚äº†æˆ–è€…è¦è¿Ÿåˆ°ä¸€ä¼šï¼Œå¦‚æžœæ²¡æœ‰ä¸€ä¸ªåè®®æ¥ä¿éšœå¯é æ€§ï¼Œé‚£ä¹ˆæˆ‘è¿™æ¡æ¶ˆæ¯å‘å‡ºåŽ»ï¼Œèƒ½ä¸èƒ½åˆ°ã€èƒ½ä¸èƒ½åŠæ—¶åˆ°ã€èƒ½ä¸èƒ½å®Œæ•´åˆ°ã€èƒ½ä¸èƒ½ä¸è¢«ç¯¡æ”¹åˆ°ç­‰è¿™äº›é—®é¢˜å°†ä¼šé€ æˆç¾éš¾ï¼Œç½‘ç»œä¼ è¾“ä¹Ÿå°±æ²¡æœ‰äº†æ„ä¹‰ã€‚ è®¡ç®—æœºçš„å‰è¾ˆä»¬ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—çš„æŽªæ–½æ¥å°½å¯èƒ½ä¿è¯ä¿¡æ¯èƒ½æ­£ç¡®é€è¾¾ã€‚ 2.2 æ•°æ®æ ¡éªŒ é¦–å…ˆåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œå¯ä»¥é€šè¿‡å„ç§æ ¡éªŒï¼Œæ¯”å¦‚å¥‡å¶æ ¡éªŒç­‰æ‰‹æ®µæ¥åˆ¤æ–­æ•°æ®åŒ…ä¼ çš„æ˜¯å¦æ­£ç¡®ã€‚ 2.3 æ•°æ®å¯é æ€§ å¥½äº†ï¼Œè§£å†³äº†æ•°æ®æ˜¯å¦æ­£ç¡®ä¹‹åŽï¼Œä½†æ˜¯è¿˜ä¸èƒ½ä¿è¯çº¿è·¯æ˜¯å¯é çš„ï¼ŒåŠ å…¥æŸä¸ªåŒ…æ²¡å‘å‡ºåŽ»æˆ–è€…å‘é”™äº†ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªå‡ºé”™é‡ä¼ æœºåˆ¶ï¼Œä¿è¯ä¿¡æ¯ä¼ è¾“çš„å¯é æ€§ã€‚è¿™å°±å¼•å‡ºäº†TCPåè®®ã€‚ TCPï¼ˆTransmission Control Protocol ä¼ è¾“æŽ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§é¢å‘è¿žæŽ¥çš„ã€å¯é çš„ã€åŸºäºŽå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚ ä¸‹é¢æ¥çœ‹çœ‹TCPæ˜¯å¦‚ä½•è§£å†³ä¸¢åŒ…ã€é‡å¤åŒ…ã€å‡ºé”™ã€ä¹±åºç­‰ä¸å¯é çš„ä¸€äº›é—®é¢˜çš„ã€‚ ä¸‰ã€æ»‘åŠ¨çª—å£åè®®çš„æå‡º è¿™å°±å¼•å‡ºäº†TCPä¸­æœ€ç»ˆçš„ä¸€ä¸ªä¸œè¥¿ï¼šæ»‘åŠ¨çª—å£åè®®ã€‚ 3.1 æœ´ç´ çš„æ–¹æ³•æ¥ç¡®ä¿å¯é æ€§ å…ˆä»Žç®€å•çš„è§’åº¦å‡ºå‘ï¼Œè‡ªå·±æƒ³ä¸€ä¸‹ï¼Œå¦‚ä½•ä¿è¯ä¸ä¸¢åŒ…ã€ä¸ä¹±åºã€‚ æŒ‰ç…§é¡ºåºï¼Œå‘é€ä¸€ä¸ªç¡®è®¤ä¸€ä¸ªï¼Œæ˜¾ç„¶ï¼Œåžåé‡éžå¸¸ä½Žã€‚é‚£ä¹ˆï¼Œä¸€æ¬¡æ€§å‘å‡ ä¸ªåŒ…ï¼Œç„¶åŽä¸€èµ·ç¡®è®¤å‘¢ï¼Ÿ 3.2 æ”¹è¿›æ–¹æ¡ˆ é‚£ä¹ˆå°±å¼•å‡ºç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä¸€æ¬¡æ€§å‘å‡ ä¸ªåŒ…åˆé€‚å‘¢ï¼Ÿå°±è¿™å¼•å‡ºäº†æ»‘åŠ¨çª—å£ã€‚ å››ã€æ•°æ®åŒ…ç¼–å·å’Œé‡ä¼ æœºåˆ¶ 4.1 æ•°æ®åŒ…ç¼–å· åœ¨è¯´æ˜Žæ»‘åŠ¨çª—å£åŽŸç†ä¹‹å‰ï¼Œå¿…é¡»è¦è¯´ä¸€ä¸‹TCPæ•°æ®åŒ…çš„ç¼–å·SEQã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œç”±äºŽä»¥å¤ªç½‘æ•°æ®åŒ…å¤§å°é™åˆ¶ï¼Œæ‰€ä»¥æ¯ä¸ªåŒ…æ‰¿è½½çš„æ•°æ®æ˜¯æœ‰é™çš„ï¼Œå¦‚æžœå‘ä¸€ä¸ªå¾ˆå¤§çš„åŒ…ï¼Œå¿…ç„¶æ˜¯è¦æ‹†åˆ†çš„ã€‚ å‘é€çš„æ—¶å€™ï¼ŒTCP åè®®ä¸ºæ¯ä¸ªåŒ…ç¼–å·ï¼ˆsequence numberï¼Œç®€ç§° SEQï¼‰ï¼Œä»¥ä¾¿æŽ¥æ”¶çš„ä¸€æ–¹æŒ‰ç…§é¡ºåºè¿˜åŽŸã€‚ä¸‡ä¸€å‘ç”Ÿä¸¢åŒ…ï¼Œä¹Ÿå¯ä»¥çŸ¥é“ä¸¢å¤±çš„æ˜¯å“ªä¸€ä¸ªåŒ…ã€‚ ç¬¬ä¸€ä¸ªåŒ…çš„ç¼–å·æ˜¯ä¸€ä¸ªéšæœºæ•°ã€‚ä¸ºäº†ä¾¿äºŽç†è§£ï¼Œè¿™é‡Œå°±æŠŠå®ƒç§°ä¸º1å·åŒ…ã€‚å‡å®šè¿™ä¸ªåŒ…çš„è´Ÿè½½é•¿åº¦æ˜¯100å­—èŠ‚ï¼Œé‚£ä¹ˆå¯ä»¥æŽ¨ç®—å‡ºä¸‹ä¸€ä¸ªåŒ…çš„ç¼–å·åº”è¯¥æ˜¯101ã€‚è¿™å°±æ˜¯è¯´ï¼Œæ¯ä¸ªæ•°æ®åŒ…éƒ½å¯ä»¥å¾—åˆ°ä¸¤ä¸ªç¼–å·ï¼šè‡ªèº«çš„ç¼–å·ï¼Œä»¥åŠä¸‹ä¸€ä¸ªåŒ…çš„ç¼–å·ã€‚æŽ¥æ”¶æ–¹ç”±æ­¤çŸ¥é“ï¼Œåº”è¯¥æŒ‰ç…§ä»€ä¹ˆé¡ºåºå°†å®ƒä»¬è¿˜åŽŸæˆåŽŸå§‹æ–‡ä»¶ã€‚ 4.2 æ•°æ®é‡ä¼ æœºåˆ¶ TCPåè®®å°±æ˜¯æ ¹æ®è¿™äº›ç¼–å·æ¥é‡æ–°è¿˜åŽŸæ–‡ä»¶çš„ã€‚å¹¶ä¸”æŽ¥æ”¶ç«¯ä¿è¯é¡ºåºæ€§è¿”å›žACKç¡®è®¤ï¼Œæ¯”å¦‚æœ‰ä¸¤ä¸ªåŒ…å‘è¿‡åŽ»ï¼Œä¸º1å·å’Œ2å·ï¼Œ2å·æŽ¥æ”¶æˆåŠŸï¼Œä½†æ˜¯å‘çŽ°1å·åŒ…è¿˜æ²¡æŽ¥æ”¶åˆ°ï¼Œæ‰€ä»¥2å·çš„ACKæ˜¯ä¸ä¼šå‘å›žåŽ»çš„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æžœåœ¨é‡ä¼ æ—¶é—´å†…æ”¶åˆ°1å·äº†ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸¤ä¸ªåŒ…çš„ACKéƒ½è¿”å›žå›žåŽ»ï¼Œå¦‚æžœè¶…æ—¶äº†ï¼Œå°±é‡ä¼ 1å·åŒ…ã€‚çŸ¥é“1å·åŒ…æŽ¥æ”¶æˆåŠŸï¼ŒåŽç»­çš„æ‰ä¼šè¿”å›žACKã€‚ å…·ä½“æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ å‰é¢è¯´è¿‡ï¼Œæ¯ä¸€ä¸ªæ•°æ®åŒ…éƒ½å¸¦æœ‰ä¸‹ä¸€ä¸ªæ•°æ®åŒ…çš„ç¼–å·ã€‚å¦‚æžœä¸‹ä¸€ä¸ªæ•°æ®åŒ…æ²¡æœ‰æ”¶åˆ°ï¼Œé‚£ä¹ˆ ACK çš„ç¼–å·å°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒçŽ°åœ¨æ”¶åˆ°äº†4å·åŒ…ï¼Œä½†æ˜¯æ²¡æœ‰æ”¶åˆ°5å·åŒ…ã€‚ACK å°±ä¼šè®°å½•ï¼ŒæœŸå¾…æ”¶åˆ°5å·åŒ…ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œ5å·åŒ…æ”¶åˆ°äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€è½® ACK ä¼šæ›´æ–°ç¼–å·ã€‚å¦‚æžœ5å·åŒ…è¿˜æ˜¯æ²¡æ”¶åˆ°ï¼Œä½†æ˜¯æ”¶åˆ°äº†6å·åŒ…æˆ–7å·åŒ…ï¼Œé‚£ä¹ˆ ACK é‡Œé¢çš„ç¼–å·ä¸ä¼šå˜åŒ–ï¼Œæ€»æ˜¯æ˜¾ç¤º5å·åŒ…ã€‚è¿™ä¼šå¯¼è‡´å¤§é‡é‡å¤å†…å®¹çš„ ACKã€‚ å¦‚æžœå‘é€æ–¹å‘çŽ°æ”¶åˆ°ä¸‰ä¸ªè¿žç»­çš„é‡å¤ ACKï¼Œæˆ–è€…è¶…æ—¶äº†è¿˜æ²¡æœ‰æ”¶åˆ°ä»»ä½• ACKï¼Œå°±ä¼šç¡®è®¤ä¸¢åŒ…ï¼Œå³5å·åŒ…é—å¤±äº†ï¼Œä»Žè€Œå†æ¬¡å‘é€è¿™ä¸ªåŒ…ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒTCP ä¿è¯äº†ä¸ä¼šæœ‰æ•°æ®åŒ…ä¸¢å¤±ã€‚ ï¼ˆå›¾ç‰‡è¯´æ˜Žï¼šHost B æ²¡æœ‰æ”¶åˆ°100å·æ•°æ®åŒ…ï¼Œä¼šè¿žç»­å‘å‡ºç›¸åŒçš„ ACKï¼Œè§¦å‘ Host A é‡å‘100å·æ•°æ®åŒ…ã€‚ï¼‰ äº”ã€æ…¢å¯åŠ¨ ä¸‹é¢å†æ¥è¯´è¯´æ…¢å¯åŠ¨ã€‚ æœåŠ¡å™¨å‘é€æ•°æ®åŒ…ï¼Œå½“ç„¶è¶Šå¿«è¶Šå¥½ï¼Œæœ€å¥½ä¸€æ¬¡æ€§å…¨å‘å‡ºåŽ»ã€‚ä½†æ˜¯ï¼Œå‘å¾—å¤ªå¿«ï¼Œå°±æœ‰å¯èƒ½ä¸¢åŒ…ã€‚å¸¦å®½å°ã€è·¯ç”±å™¨è¿‡çƒ­ã€ç¼“å­˜æº¢å‡ºç­‰è®¸å¤šå› ç´ éƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ã€‚çº¿è·¯ä¸å¥½çš„è¯ï¼Œå‘å¾—è¶Šå¿«ï¼Œä¸¢å¾—è¶Šå¤šã€‚ æœ€ç†æƒ³çš„çŠ¶æ€æ˜¯ï¼Œåœ¨çº¿è·¯å…è®¸çš„æƒ…å†µä¸‹ï¼Œè¾¾åˆ°æœ€é«˜é€ŸçŽ‡ã€‚ä½†æ˜¯æˆ‘ä»¬æ€Žä¹ˆçŸ¥é“ï¼Œå¯¹æ–¹çº¿è·¯çš„ç†æƒ³é€ŸçŽ‡æ˜¯å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯æ…¢æ…¢è¯•ã€‚ TCP åè®®ä¸ºäº†åšåˆ°æ•ˆçŽ‡ä¸Žå¯é æ€§çš„ç»Ÿä¸€ï¼Œè®¾è®¡äº†ä¸€ä¸ªæ…¢å¯åŠ¨ï¼ˆslow startï¼‰æœºåˆ¶ã€‚å¼€å§‹çš„æ—¶å€™ï¼Œå‘é€å¾—è¾ƒæ…¢ï¼Œç„¶åŽæ ¹æ®ä¸¢åŒ…çš„æƒ…å†µï¼Œè°ƒæ•´é€ŸçŽ‡ï¼šå¦‚æžœä¸ä¸¢åŒ…ï¼Œå°±åŠ å¿«å‘é€é€Ÿåº¦ï¼›å¦‚æžœä¸¢åŒ…ï¼Œå°±é™ä½Žå‘é€é€Ÿåº¦ã€‚ Linux å†…æ ¸é‡Œé¢è®¾å®šäº†ï¼ˆå¸¸é‡TCP_INIT_CWNDï¼‰ï¼Œåˆšå¼€å§‹é€šä¿¡çš„æ—¶å€™ï¼Œå‘é€æ–¹ä¸€æ¬¡æ€§å‘é€10ä¸ªæ•°æ®åŒ…ï¼Œå³&quot;å‘é€çª—å£&quot;çš„å¤§å°ä¸º10ã€‚ç„¶åŽåœä¸‹æ¥ï¼Œç­‰å¾…æŽ¥æ”¶æ–¹çš„ç¡®è®¤ï¼Œå†ç»§ç»­å‘é€ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŽ¥æ”¶æ–¹æ¯æ”¶åˆ°ä¸¤ä¸ª TCP æ•°æ®åŒ…ï¼Œå°±è¦å‘é€ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ã€‚&quot;ç¡®è®¤&quot;çš„è‹±è¯­æ˜¯ acknowledgementï¼Œæ‰€ä»¥è¿™ä¸ªç¡®è®¤æ¶ˆæ¯å°±ç®€ç§° ACKã€‚ ACK æºå¸¦ä¸¤ä¸ªä¿¡æ¯ï¼š æœŸå¾…è¦æ”¶åˆ°ä¸‹ä¸€ä¸ªæ•°æ®åŒ…çš„ç¼–å· æŽ¥æ”¶æ–¹çš„æŽ¥æ”¶çª—å£çš„å‰©ä½™å®¹é‡ å‘é€æ–¹æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå†åŠ ä¸Šè‡ªå·±å·²ç»å‘å‡ºçš„æ•°æ®åŒ…çš„æœ€æ–°ç¼–å·ï¼Œå°±ä¼šæŽ¨æµ‹å‡ºæŽ¥æ”¶æ–¹å¤§æ¦‚çš„æŽ¥æ”¶é€Ÿåº¦ï¼Œä»Žè€Œé™ä½Žæˆ–å¢žåŠ å‘é€é€ŸçŽ‡ã€‚è¿™è¢«ç§°ä¸º&quot;å‘é€çª—å£&quot;ï¼Œè¿™ä¸ªçª—å£çš„å¤§å°æ˜¯å¯å˜çš„ã€‚ æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå‘é€å‘å’ŒæŽ¥æ”¶æ–¹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œå¯ä»¥ç†è§£ä¸ºçª—å£ã€‚æ ¹æ®æŽ¥æ”¶é€Ÿåº¦å¯ä»¥è°ƒæ•´å‘é€é€Ÿåº¦ï¼Œé€æ¸è¾¾åˆ°è¿™æ¡çº¿è·¯æœ€é«˜çš„ä¼ è¾“é€ŸçŽ‡ã€‚ okï¼Œä¸‹é¢å°±å¯ä»¥ç ”ç©¶ä¸€ä¸‹æ»‘åŠ¨çª—å£äº†ã€‚ å…­ã€æ»‘åŠ¨çª—å£åŽŸç† æ­£å¸¸æƒ…å†µä¸‹ï¼š ï¼ˆå¦‚å›¾ï¼Œ123è¡¨ç¤ºå·²ç»æ­£å¸¸å‘é€å¹¶ä¸”æ”¶åˆ°äº†ACKç¡®è®¤ã€‚4567å±žäºŽå·²å‘é€ä½†æ˜¯è¿˜æ²¡æœ‰æ”¶åˆ°ACKã€‚8910è¡¨ç¤ºå¾…å‘é€ã€‚è¿™ä¸ªçª—å£å½“å‰é•¿åº¦ä¸º7.æ­£å¸¸æƒ…å†µä¸‹ï¼Œ4å·åŒ…æ”¶åˆ°ACKï¼Œé‚£ä¹ˆçª—å£å°±ä¼šå³ç§»ä¸€æ ¼ã€‚ï¼‰ ä½†æ˜¯å¾€å¾€ä¼šå‡ºçŽ°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚5å·åŒ…è¿Ÿè¿Ÿæ”¶ä¸åˆ°ACKï¼Œåœ¨æŽ¥æ”¶ç«¯å¯èƒ½æ˜¯æ²¡æœ‰æ”¶åˆ°5å·åŒ…ï¼Œä½†æ˜¯å¯èƒ½ä¼šæ”¶åˆ°6å·åŒ…ç”šè‡³æ˜¯7ã€8å·åŒ…ï¼Œé‚£ä¹ˆæ­¤æ—¶åªèƒ½ç­‰å¾…5å·åŒ…ï¼Œå¦‚æžœ5å·åŒ…é¡ºåˆ©åˆ°è¾¾äº†ï¼Œé‚£ä¹ˆå°±æŠŠ5678å·åŒ…çš„ACKéƒ½å‘ç»™å‘é€ç«¯ï¼Œé‚£ä¹ˆå‘é€ç«¯æ»‘åŠ¨çª—å£å‘å³å³ç§»å››æ ¼ã€‚å¦‚æžœè¿Ÿè¿Ÿæ”¶ä¸åˆ°5å·åŒ…ï¼Œåªèƒ½é‡ä¼ ã€‚ ä»¥ä¸Šå°±æ˜¯å…³äºŽTCPä¸­æ¯”è¾ƒé‡è¦çš„å‡ºé”™é‡ä¼ ã€ç¼–å·ã€æ…¢å¯åŠ¨ä»¥åŠæ»‘åŠ¨çª—å£ã€‚è¿™äº›ä¿è¯äº†æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€‚ æ•´ç†è‡ªï¼šhttp://www.ruanyifeng.com/blog/2017/06/tcp-protocol.html]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[httpçš„å‰ä¸–ä»Šç”Ÿ]]></title>
    <url>%2F2019%2F01%2F17%2Fnetwork%2F3.http%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ã€‚ä½œä¸ºä¸€ä¸ªåŽç«¯æ”»åŸŽç‹®ï¼Œæ¯å¤©æ‰“äº¤é“æœ€å¤šçš„å°±æ˜¯HTTPåè®®ï¼Œåœ¨å¦‚ä»Šç«çƒ­çš„å¾®æœåŠ¡å®žçŽ°æ–¹æ¡ˆä¸­ï¼Œé™¤äº†é˜¿é‡Œçš„dubboï¼Œå°±æ˜¯spring cloudï¼Œè€Œspring cloudç›®å‰é€‚ç”¨çš„æœåŠ¡é—´é€šä¿¡æ–¹å¼ä¹Ÿå°±æ˜¯åŸºäºŽHTTP çš„ restfulæŽ¥å£æ¥å®žçŽ°ã€‚å¹¶ä¸”ä½œä¸ºæµè§ˆå™¨ä¸Šç”¨çš„æœ€å¤šçš„åè®®ï¼Œæ— è®ºæ˜¯å‰ç«¯ã€åŽç«¯è¿˜æ˜¯æµ‹è¯•éƒ½åº”è¯¥åŽ»ç†Ÿæ‚‰å®ƒï¼Œè½¯ä»¶çš„å‘å±•æ˜¯å¾ªåºæ¸è¿›çš„ï¼Œæ¯æ¬¡çš„è¿­ä»£å‡çº§éƒ½æ˜¯ä¸ºäº†è§£å†³ä¸Šä¸€ç‰ˆæœ¬çš„ç—›ç‚¹ï¼ŒHTTPåè®®çš„å‘å±•ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæœ¬ç« ç€é‡è®²è§£HTTPçš„å‰ä¸–ä»Šç”Ÿï¼Œè®©æˆ‘ä»¬æ›´åŠ äº†è§£HTTPã€‚ HTTP æ˜¯åŸºäºŽ TCP/IP åè®®çš„åº”ç”¨å±‚åè®®ã€‚å®ƒä¸æ¶‰åŠæ•°æ®åŒ…ï¼ˆpacketï¼‰ä¼ è¾“ï¼Œä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ï¼Œé»˜è®¤ä½¿ç”¨80ç«¯å£ã€‚ ä¸€ã€HTTP/0.9 1.1 ç®€ä»‹ è¿™æ˜¯ç¬¬ä¸€ä¸ªå®šç¨¿çš„HTTPåè®®ã€‚ å†…å®¹éžå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªå‘½ä»¤GET æ²¡æœ‰HEADERç­‰æè¿°æ•°æ®çš„ä¿¡æ¯ æœåŠ¡å™¨å‘é€å®Œæ¯•ï¼Œå°±å…³é—­TCPè¿žæŽ¥ï¼ˆä¸€ä¸ªHTTPè¯·æ±‚åœ¨ä¸€ä¸ªTCPè¿žæŽ¥ä¸­å®Œæˆï¼‰ 1.2 è¯·æ±‚æ ¼å¼ æ¯”å¦‚å‘èµ·ä¸€ä¸ªGETè¯·æ±‚ï¼š GET /index.html ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼ŒTCP è¿žæŽ¥ï¼ˆconnectionï¼‰å»ºç«‹åŽï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚ï¼ˆrequestï¼‰ç½‘é¡µindex.htmlã€‚ 1.3 å“åº”æ ¼å¼ åè®®è§„å®šï¼ŒæœåŠ¡å™¨åªèƒ½å›žåº”HTMLæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½å›žåº”åˆ«çš„æ ¼å¼ã€‚ 123&lt;html&gt; &lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt; æœåŠ¡å™¨å‘é€å®Œæ¯•ï¼Œå°±å…³é—­TCPè¿žæŽ¥ã€‚ äºŒã€HTTP/1.0 2.1 ç®€ä»‹ è·ŸçŽ°åœ¨æ¯”è¾ƒæ™®éé€‚ç”¨çš„1.1ç‰ˆæœ¬å·²ç»ç›¸å·®ä¸å¤šã€‚ å¢žåŠ å¾ˆå¤šå‘½ä»¤ï¼Œæ¯”å¦‚POSTã€HEADç­‰å‘½ä»¤ å¢žåŠ status code å’Œ header å¤šå­—ç¬¦é›†æ”¯æŒã€å¤šéƒ¨åˆ†å‘é€ã€æƒé™ã€ç¼“å­˜ç­‰ é¦–å…ˆï¼Œä»»ä½•æ ¼å¼çš„å†…å®¹éƒ½å¯ä»¥å‘é€ã€‚è¿™ä½¿å¾—äº’è”ç½‘ä¸ä»…å¯ä»¥ä¼ è¾“æ–‡å­—ï¼Œè¿˜èƒ½ä¼ è¾“å›¾åƒã€è§†é¢‘ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™ä¸ºäº’è”ç½‘çš„å¤§å‘å±•å¥ å®šäº†åŸºç¡€ã€‚ å…¶æ¬¡ï¼Œé™¤äº†GETå‘½ä»¤ï¼Œè¿˜å¼•å…¥äº†POSTå‘½ä»¤å’ŒHEADå‘½ä»¤ï¼Œä¸°å¯Œäº†æµè§ˆå™¨ä¸ŽæœåŠ¡å™¨çš„äº’åŠ¨æ‰‹æ®µã€‚ å†æ¬¡ï¼ŒHTTPè¯·æ±‚å’Œå›žåº”çš„æ ¼å¼ä¹Ÿå˜äº†ã€‚é™¤äº†æ•°æ®éƒ¨åˆ†ï¼Œæ¯æ¬¡é€šä¿¡éƒ½å¿…é¡»åŒ…æ‹¬å¤´ä¿¡æ¯ï¼ˆHTTP headerï¼‰ï¼Œç”¨æ¥æè¿°ä¸€äº›å…ƒæ•°æ®ã€‚ å…¶ä»–çš„æ–°å¢žåŠŸèƒ½è¿˜åŒ…æ‹¬çŠ¶æ€ç ï¼ˆstatus codeï¼‰ã€å¤šå­—ç¬¦é›†æ”¯æŒã€å¤šéƒ¨åˆ†å‘é€ï¼ˆmulti-part typeï¼‰ã€æƒé™ï¼ˆauthorizationï¼‰ã€ç¼“å­˜ï¼ˆcacheï¼‰ã€å†…å®¹ç¼–ç ï¼ˆcontent encodingï¼‰ç­‰ã€‚ 2.2 è¯·æ±‚æ ¼å¼ ä¸‹é¢æ˜¯ä¸€ä¸ª1.0ç‰ˆçš„HTTPè¯·æ±‚çš„ä¾‹å­ã€‚ 123GET / HTTP/1.0User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)Accept: */* å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ ¼å¼ä¸Ž0.9ç‰ˆæœ‰å¾ˆå¤§å˜åŒ–ã€‚ ç¬¬ä¸€è¡Œæ˜¯è¯·æ±‚å‘½ä»¤ï¼Œå¿…é¡»åœ¨å°¾éƒ¨æ·»åŠ åè®®ç‰ˆæœ¬ï¼ˆHTTP/1.0ï¼‰ã€‚åŽé¢å°±æ˜¯å¤šè¡Œå¤´ä¿¡æ¯ï¼Œæè¿°å®¢æˆ·ç«¯çš„æƒ…å†µã€‚ å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨Acceptå­—æ®µå£°æ˜Žè‡ªå·±å¯ä»¥æŽ¥å—å“ªäº›æ•°æ®æ ¼å¼ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯å£°æ˜Žè‡ªå·±å¯ä»¥æŽ¥å—ä»»ä½•æ ¼å¼çš„æ•°æ®ã€‚ 2.3 å“åº”æ ¼å¼ æœåŠ¡å™¨çš„å›žåº”å¦‚ä¸‹ï¼š 12345678910HTTP/1.0 200 OK Content-Type: text/plainContent-Length: 137582Expires: Thu, 05 Dec 1997 16:00:00 GMTLast-Modified: Wed, 5 August 1996 15:55:28 GMTServer: Apache 0.84&lt;html&gt; &lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt; å›žåº”çš„æ ¼å¼æ˜¯&quot;å¤´ä¿¡æ¯ + ä¸€ä¸ªç©ºè¡Œï¼ˆ\r\nï¼‰ + æ•°æ®&quot;ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€è¡Œæ˜¯&quot;åè®®ç‰ˆæœ¬ + çŠ¶æ€ç ï¼ˆstatus codeï¼‰ + çŠ¶æ€æè¿°&quot;ã€‚ 2.4 Content-Type å­—æ®µ å…³äºŽå­—ç¬¦çš„ç¼–ç ï¼Œ1.0ç‰ˆè§„å®šï¼Œå¤´ä¿¡æ¯å¿…é¡»æ˜¯ ASCII ç ï¼ŒåŽé¢çš„æ•°æ®å¯ä»¥æ˜¯ä»»ä½•æ ¼å¼ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨å›žåº”çš„æ—¶å€™ï¼Œå¿…é¡»å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œæ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Œè¿™å°±æ˜¯Content-Typeå­—æ®µçš„ä½œç”¨ã€‚ 2.5 ç¼ºç‚¹ æ¯ä¸ªTCPè¿žæŽ¥åªèƒ½å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚å‘é€æ•°æ®å®Œæ¯•ï¼Œè¿žæŽ¥å°±å…³é—­ï¼Œå¦‚æžœè¿˜è¦è¯·æ±‚å…¶ä»–èµ„æºï¼Œå°±å¿…é¡»å†æ–°å»ºä¸€ä¸ªè¿žæŽ¥ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰äº›æµè§ˆå™¨åœ¨è¯·æ±‚æ—¶ï¼Œç”¨äº†ä¸€ä¸ªéžæ ‡å‡†çš„Connectionå­—æ®µã€‚ Connection: keep-alive è¿™ä¸ªå­—æ®µè¦æ±‚æœåŠ¡å™¨ä¸è¦å…³é—­TCPè¿žæŽ¥ï¼Œä»¥ä¾¿å…¶ä»–è¯·æ±‚å¤ç”¨ã€‚æœåŠ¡å™¨åŒæ ·å›žåº”è¿™ä¸ªå­—æ®µã€‚ Connection: keep-alive ä¸€ä¸ªå¯ä»¥å¤ç”¨çš„TCPè¿žæŽ¥å°±å»ºç«‹äº†ï¼Œç›´åˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ä¸»åŠ¨å…³é—­è¿žæŽ¥ã€‚ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯æ ‡å‡†å­—æ®µï¼Œä¸åŒå®žçŽ°çš„è¡Œä¸ºå¯èƒ½ä¸ä¸€è‡´ï¼Œå› æ­¤ä¸æ˜¯æ ¹æœ¬çš„è§£å†³åŠžæ³•ã€‚ ä¸‰ã€HTTP/1.1 3.1 æŒä¹…è¿žæŽ¥å’Œç®¡é“æœºåˆ¶ æŒä¹…è¿žæŽ¥ï¼ˆä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä¸€ä¸ªHTTPè¯·æ±‚å°±åˆ›å»ºä¸€ä¸ªTCPè¿žæŽ¥ï¼Œè¯·æ±‚è¿”å›žä¹‹åŽå°±å…³é—­TCPè¿žæŽ¥ï¼Œç„¶è€Œå»ºç«‹ä¸€æ¬¡TCPè¿žæŽ¥çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œæ•ˆçŽ‡ä¼šæ¯”è¾ƒä½Žï¼ŒçŽ°åœ¨å»ºç«‹ä¸€ä¸ªTCPè¿žæŽ¥åŽï¼ŒåŽé¢çš„HTTPè¯·æ±‚éƒ½å¯ä»¥å¤ç”¨è¿™ä¸ªTCPè¿žæŽ¥ï¼Œå³å…è®¸äº†åœ¨åŒä¸€ä¸ªè¿žæŽ¥é‡Œé¢å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä¼šæé«˜æ•ˆçŽ‡ï¼‰ pipelineï¼ˆè§£å†³äº†åŒä¸€ä¸ªTCPè¿žæŽ¥ä¸­å®¢æˆ·ç«¯å¯ä»¥å‘é€å¤šä¸ªHTTPè¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºŽæœåŠ¡ç«¯æ¥è¯´ï¼Œå¯¹äºŽè¿›æ¥çš„è¯·æ±‚è¦æŒ‰ç…§é¡ºåºè¿›è¡Œå†…å®¹çš„è¿”å›žï¼Œå¦‚æžœå‰ä¸€ä¸ªè¯·æ±‚å¤„ç†æ—¶é—´é•¿ï¼Œè€ŒåŽä¸€ä¸ªè¯·æ±‚å¤„ç†æ—¶é—´ç«¯ï¼Œå³ä¾¿åŽé¢ä¸€ä¸ªè¯·æ±‚å·²ç»å¤„ç†å®Œæ¯•äº†ï¼Œä¹Ÿè¦ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•è¿”å›žä»–æ‰å¯ä»¥è¿”å›žç»“æžœï¼Œè¿™ç§ä¸²è¡Œçš„æ–¹å¼æ¯”è¾ƒæ…¢ï¼‰ åœ¨1.1ç‰ˆæœ¬ä»¥å‰ï¼Œæ¯æ¬¡HTTPè¯·æ±‚ï¼Œéƒ½ä¼šé‡æ–°å»ºç«‹ä¸€æ¬¡TCPè¿žæŽ¥ï¼ŒæœåŠ¡å™¨å“åº”åŽï¼Œå°±ç«‹åˆ»å…³é—­ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå»ºç«‹TCPè¿žæŽ¥çš„æ–°å»ºæˆæœ¬å¾ˆé«˜ï¼Œå› ä¸ºéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¹¶ä¸”æœ‰ç€æ…¢å¯åŠ¨çš„ç‰¹æ€§å¯¼è‡´å‘é€é€Ÿåº¦è¾ƒæ…¢ã€‚è€Œ1.1ç‰ˆæœ¬æ·»åŠ çš„æŒä¹…è¿žæŽ¥åŠŸèƒ½å¯ä»¥è®©ä¸€æ¬¡TCPè¿žæŽ¥ä¸­å‘é€å¤šæ¡HTTPè¯·æ±‚ï¼Œå€¼å¾—ä¸€æçš„æ˜¯é»˜è®¤æ˜¯ï¼ŒæŽ§åˆ¶æŒä¹…è¿žæŽ¥çš„Connectionå­—æ®µé»˜è®¤å€¼æ˜¯keep-aliveï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯é»˜è®¤æ‰“å¼€æŒä¹…è¿žæŽ¥ï¼Œå¦‚æžœæƒ³è¦å…³é—­ï¼Œåªéœ€å°†è¯¥å­—æ®µçš„å€¼æ”¹ä¸ºcloseã€‚ Connection: close è€Œç®¡é“åŒ–åˆ™èµ‹äºˆäº†å®¢æˆ·ç«¯åœ¨ä¸€ä¸ªTCPè¿žæŽ¥ä¸­è¿žç»­å‘é€å¤šä¸ªè¯·æ±‚çš„èƒ½åŠ›ï¼Œè€Œä¸éœ€è¦ç­‰åˆ°å‰ä¸€ä¸ªè¯·æ±‚å“åº”ï¼Œè¿™å¤§å¤§æé«˜äº†æ•ˆçŽ‡ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè™½ç„¶å®¢æˆ·ç«¯å¯ä»¥è¿žç»­å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿”å›žä¾ç„¶æ˜¯æŒ‰ç…§å‘é€çš„é¡ºåºè¿”å›žã€‚ï¼ˆå¼ºè°ƒçš„æ˜¯requestä¸éœ€è¦ç­‰å¾…ä¸Šä¸€ä¸ªrequestçš„responseï¼Œå…¶å®žå‘é€çš„requestè¿˜æ˜¯æœ‰é¡ºåºçš„ï¼ŒæœåŠ¡ç«¯æŒ‰ç…§è¿™ä¸ªé¡ºåºæŽ¥æ”¶ï¼Œä¾æ¬¡è¿”å›žå“åº”ï¼‰ HTTP/1.1å…è®¸å¤šä¸ªhttpè¯·æ±‚é€šè¿‡ä¸€ä¸ªå¥—æŽ¥å­—åŒæ—¶è¢«è¾“å‡º ï¼Œè€Œä¸ç”¨ç­‰å¾…ç›¸åº”çš„å“åº”ã€‚ç„¶åŽè¯·æ±‚è€…å°±ä¼šç­‰å¾…å„è‡ªçš„å“åº”ï¼Œè¿™äº›å“åº”æ˜¯æŒ‰ç…§ä¹‹å‰è¯·æ±‚çš„é¡ºåºä¾æ¬¡åˆ°è¾¾ã€‚ï¼ˆmeï¼šæ‰€æœ‰è¯·æ±‚ä¿æŒä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œä¸€ä¸ªè¯·æ±‚å‘é€å®Œä¹‹åŽï¼Œä¸å¿…ç­‰å¾…è¿™ä¸ªè¯·æ±‚çš„å“åº”è¢«æŽ¥å—åˆ°ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°±å¯ä»¥è¢«å†æ¬¡å‘å‡ºï¼›åŒæ—¶ï¼ŒæœåŠ¡å™¨ç«¯è¿”å›žè¿™äº›è¯·æ±‚çš„å“åº”æ—¶ä¹Ÿæ˜¯æŒ‰ç…§FIFOçš„é¡ºåºï¼‰ã€‚ç®¡é“åŒ–çš„è¡¨çŽ°å¯ä»¥å¤§å¤§æé«˜é¡µé¢åŠ è½½çš„é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å»¶è¿Ÿè¿žæŽ¥ä¸­ã€‚ 3.2 Content-Length å­—æ®µ ä¸€ä¸ªTCPè¿žæŽ¥çŽ°åœ¨å¯ä»¥ä¼ é€å¤šä¸ªå›žåº”ï¼ŒåŠ¿å¿…å°±è¦æœ‰ä¸€ç§æœºåˆ¶ï¼ŒåŒºåˆ†æ•°æ®åŒ…æ˜¯å±žäºŽå“ªä¸€ä¸ªå›žåº”çš„ã€‚è¿™å°±æ˜¯Content-lengthå­—æ®µçš„ä½œç”¨ï¼Œå£°æ˜Žæœ¬æ¬¡å›žåº”çš„æ•°æ®é•¿åº¦ã€‚ Content-Length: 3495 ä¸Šé¢ä»£ç å‘Šè¯‰æµè§ˆå™¨ï¼Œæœ¬æ¬¡å›žåº”çš„é•¿åº¦æ˜¯3495ä¸ªå­—èŠ‚ï¼ŒåŽé¢çš„å­—èŠ‚å°±å±žäºŽä¸‹ä¸€ä¸ªå›žåº”äº†ã€‚ åœ¨1.0ç‰ˆä¸­ï¼ŒContent-Lengthå­—æ®µä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæµè§ˆå™¨å‘çŽ°æœåŠ¡å™¨å…³é—­äº†TCPè¿žæŽ¥ï¼Œå°±è¡¨æ˜Žæ”¶åˆ°çš„æ•°æ®åŒ…å·²ç»å…¨äº†ã€‚ 3.3 åˆ†å—ä¼ è¾“ç¼–ç  å¯¹äºŽä¸€äº›å¾ˆè€—æ—¶çš„åŠ¨æ€æ“ä½œæ¥è¯´ï¼Œè¿™æ„å‘³ç€ï¼ŒæœåŠ¡å™¨è¦ç­‰åˆ°æ‰€æœ‰æ“ä½œå®Œæˆï¼Œæ‰èƒ½å‘é€æ•°æ®ï¼Œæ˜¾ç„¶è¿™æ ·çš„æ•ˆçŽ‡ä¸é«˜ã€‚æ›´å¥½çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œäº§ç”Ÿä¸€å—æ•°æ®ï¼Œå°±å‘é€ä¸€å—ï¼Œé‡‡ç”¨&quot;æµæ¨¡å¼&quot;ï¼ˆstreamï¼‰å–ä»£&quot;ç¼“å­˜æ¨¡å¼&quot;ï¼ˆbufferï¼‰ã€‚ å› æ­¤ï¼Œ1.1ç‰ˆè§„å®šå¯ä»¥ä¸ä½¿ç”¨Content-Lengthå­—æ®µï¼Œè€Œä½¿ç”¨&quot;åˆ†å—ä¼ è¾“ç¼–ç &quot;ï¼ˆchunked transfer encodingï¼‰ã€‚åªè¦è¯·æ±‚æˆ–å›žåº”çš„å¤´ä¿¡æ¯æœ‰Transfer-Encodingå­—æ®µï¼Œå°±è¡¨æ˜Žå›žåº”å°†ç”±æ•°é‡æœªå®šçš„æ•°æ®å—ç»„æˆã€‚ Transfer-Encoding: chunked æ¯ä¸ªéžç©ºçš„æ•°æ®å—ä¹‹å‰ï¼Œä¼šæœ‰ä¸€ä¸ª16è¿›åˆ¶çš„æ•°å€¼ï¼Œè¡¨ç¤ºè¿™ä¸ªå—çš„é•¿åº¦ã€‚æœ€åŽæ˜¯ä¸€ä¸ªå¤§å°ä¸º0çš„å—ï¼Œå°±è¡¨ç¤ºæœ¬æ¬¡å›žåº”çš„æ•°æ®å‘é€å®Œäº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011121314151617HTTP/1.1 200 OKContent-Type: text/plainTransfer-Encoding: chunked25This is the data in the first chunk1Cand this is the second one3con8sequence0 3.3 å…¶ä»–åŠŸèƒ½ 1.1ç‰ˆè¿˜æ–°å¢žäº†è®¸å¤šåŠ¨è¯æ–¹æ³•ï¼šPUTã€PATCHã€HEADã€ OPTIONSã€DELETEã€‚ å¦å¤–ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„å¤´ä¿¡æ¯æ–°å¢žäº†Hostå­—æ®µï¼Œç”¨æ¥æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåã€‚ Host: www.example.com æœ‰äº†Hostå­—æ®µï¼Œå°±å¯ä»¥å°†è¯·æ±‚å‘å¾€åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„ä¸åŒç½‘ç«™ï¼Œä¸ºè™šæ‹Ÿä¸»æœºçš„å…´èµ·æ‰“ä¸‹äº†åŸºç¡€ã€‚ 3.4 ç¼ºç‚¹ è™½ç„¶1.1ç‰ˆå…è®¸å¤ç”¨TCPè¿žæŽ¥ï¼Œä½†æ˜¯åŒä¸€ä¸ªTCPè¿žæŽ¥é‡Œé¢ï¼Œæ‰€æœ‰çš„æ•°æ®é€šä¿¡æ˜¯æŒ‰æ¬¡åºè¿›è¡Œçš„ã€‚æœåŠ¡å™¨åªæœ‰å¤„ç†å®Œä¸€ä¸ªå›žåº”ï¼Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€ä¸ªå›žåº”ã€‚è¦æ˜¯å‰é¢çš„å›žåº”ç‰¹åˆ«æ…¢ï¼ŒåŽé¢å°±ä¼šæœ‰è®¸å¤šè¯·æ±‚æŽ’é˜Ÿç­‰ç€ã€‚è¿™ç§°ä¸º&quot;é˜Ÿå¤´å µå¡ž&quot;ï¼ˆHead-of-line blockingï¼‰ã€‚ å››ã€SPDY åè®® 2009å¹´ï¼Œè°·æ­Œå…¬å¼€äº†è‡ªè¡Œç ”å‘çš„ SPDY åè®®ï¼Œä¸»è¦è§£å†³ HTTP/1.1 æ•ˆçŽ‡ä¸é«˜çš„é—®é¢˜ã€‚ è¿™ä¸ªåè®®åœ¨Chromeæµè§ˆå™¨ä¸Šè¯æ˜Žå¯è¡Œä»¥åŽï¼Œå°±è¢«å½“ä½œ HTTP/2 çš„åŸºç¡€ï¼Œä¸»è¦ç‰¹æ€§éƒ½åœ¨ HTTP/2 ä¹‹ä¸­å¾—åˆ°ç»§æ‰¿ã€‚ äº”ã€HTTP/2 5.1 äºŒè¿›åˆ¶åè®® HTTP/1.1 ç‰ˆçš„å¤´ä¿¡æ¯è‚¯å®šæ˜¯æ–‡æœ¬ï¼ˆASCIIç¼–ç ï¼‰ï¼Œæ•°æ®ä½“å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶ã€‚ HTTP/2 åˆ™æ˜¯ä¸€ä¸ªå½»åº•çš„äºŒè¿›åˆ¶åè®®ï¼Œå¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”ç»Ÿç§°ä¸º&quot;å¸§&quot;ï¼ˆframeï¼‰ï¼šå¤´ä¿¡æ¯å¸§å’Œæ•°æ®å¸§ã€‚ äºŒè¿›åˆ¶åè®®çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¯ä»¥å®šä¹‰é¢å¤–çš„å¸§ã€‚HTTP/2 å®šä¹‰äº†è¿‘åç§å¸§ï¼Œä¸ºå°†æ¥çš„é«˜çº§åº”ç”¨æ‰“å¥½äº†åŸºç¡€ã€‚å¦‚æžœä½¿ç”¨æ–‡æœ¬å®žçŽ°è¿™ç§åŠŸèƒ½ï¼Œè§£æžæ•°æ®å°†ä¼šå˜å¾—éžå¸¸éº»çƒ¦ï¼ŒäºŒè¿›åˆ¶è§£æžåˆ™æ–¹ä¾¿å¾—å¤šã€‚ 5.2 å¤šå·¥ HTTP/2 å¤ç”¨TCPè¿žæŽ¥ï¼Œåœ¨ä¸€ä¸ªè¿žæŽ¥é‡Œï¼Œå®¢æˆ·ç«¯å’Œæµè§ˆå™¨éƒ½å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æˆ–å›žåº”ï¼Œè€Œä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºä¸€ä¸€å¯¹åº”ï¼Œè¿™æ ·å°±é¿å…äº†&quot;é˜Ÿå¤´å µå¡ž&quot;ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªTCPè¿žæŽ¥é‡Œé¢ï¼ŒæœåŠ¡å™¨åŒæ—¶æ”¶åˆ°äº†Aè¯·æ±‚å’ŒBè¯·æ±‚ï¼ŒäºŽæ˜¯å…ˆå›žåº”Aè¯·æ±‚ï¼Œç»“æžœå‘çŽ°å¤„ç†è¿‡ç¨‹éžå¸¸è€—æ—¶ï¼ŒäºŽæ˜¯å°±å‘é€Aè¯·æ±‚å·²ç»å¤„ç†å¥½çš„éƒ¨åˆ†ï¼Œ æŽ¥ç€å›žåº”Bè¯·æ±‚ï¼Œå®ŒæˆåŽï¼Œå†å‘é€Aè¯·æ±‚å‰©ä¸‹çš„éƒ¨åˆ†ã€‚ è¿™æ ·åŒå‘çš„ã€å®žæ—¶çš„é€šä¿¡ï¼Œå°±å«åšå¤šå·¥ï¼ˆMultiplexingï¼‰ã€‚ 5.3 æ•°æ®æµ å› ä¸º HTTP/2 çš„æ•°æ®åŒ…æ˜¯ä¸æŒ‰é¡ºåºå‘é€çš„ï¼ŒåŒä¸€ä¸ªè¿žæŽ¥é‡Œé¢è¿žç»­çš„æ•°æ®åŒ…ï¼Œå¯èƒ½å±žäºŽä¸åŒçš„å›žåº”ã€‚å› æ­¤ï¼Œå¿…é¡»è¦å¯¹æ•°æ®åŒ…åšæ ‡è®°ï¼ŒæŒ‡å‡ºå®ƒå±žäºŽå“ªä¸ªå›žåº”ã€‚ HTTP/2 å°†æ¯ä¸ªè¯·æ±‚æˆ–å›žåº”çš„æ‰€æœ‰æ•°æ®åŒ…ï¼Œç§°ä¸ºä¸€ä¸ªæ•°æ®æµï¼ˆstreamï¼‰ã€‚æ¯ä¸ªæ•°æ®æµéƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–å·ã€‚æ•°æ®åŒ…å‘é€çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»æ ‡è®°æ•°æ®æµIDï¼Œç”¨æ¥åŒºåˆ†å®ƒå±žäºŽå“ªä¸ªæ•°æ®æµã€‚å¦å¤–è¿˜è§„å®šï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®æµï¼ŒIDä¸€å¾‹ä¸ºå¥‡æ•°ï¼ŒæœåŠ¡å™¨å‘å‡ºçš„ï¼ŒIDä¸ºå¶æ•°ã€‚ æ•°æ®æµå‘é€åˆ°ä¸€åŠçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥å‘é€ä¿¡å·ï¼ˆRST_STREAMå¸§ï¼‰ï¼Œå–æ¶ˆè¿™ä¸ªæ•°æ®æµã€‚1.1ç‰ˆå–æ¶ˆæ•°æ®æµçš„å”¯ä¸€æ–¹æ³•ï¼Œå°±æ˜¯å…³é—­TCPè¿žæŽ¥ã€‚è¿™å°±æ˜¯è¯´ï¼ŒHTTP/2 å¯ä»¥å–æ¶ˆæŸä¸€æ¬¡è¯·æ±‚ï¼ŒåŒæ—¶ä¿è¯TCPè¿žæŽ¥è¿˜æ‰“å¼€ç€ï¼Œå¯ä»¥è¢«å…¶ä»–è¯·æ±‚ä½¿ç”¨ã€‚ å®¢æˆ·ç«¯è¿˜å¯ä»¥æŒ‡å®šæ•°æ®æµçš„ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§è¶Šé«˜ï¼ŒæœåŠ¡å™¨å°±ä¼šè¶Šæ—©å›žåº”ã€‚ 5.4 å¤´ä¿¡æ¯åŽ‹ç¼© HTTP åè®®ä¸å¸¦æœ‰çŠ¶æ€ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œè¯·æ±‚çš„å¾ˆå¤šå­—æ®µéƒ½æ˜¯é‡å¤çš„ï¼Œæ¯”å¦‚Cookieå’ŒUser Agentï¼Œä¸€æ¨¡ä¸€æ ·çš„å†…å®¹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„å¸¦ï¼Œè¿™ä¼šæµªè´¹å¾ˆå¤šå¸¦å®½ï¼Œä¹Ÿå½±å“é€Ÿåº¦ã€‚ HTTP/2 å¯¹è¿™ä¸€ç‚¹åšäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†å¤´ä¿¡æ¯åŽ‹ç¼©æœºåˆ¶ï¼ˆheader compressionï¼‰ã€‚ä¸€æ–¹é¢ï¼Œå¤´ä¿¡æ¯ä½¿ç”¨gzipæˆ–compressåŽ‹ç¼©åŽå†å‘é€ï¼›å¦ä¸€æ–¹é¢ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤ä¸€å¼ å¤´ä¿¡æ¯è¡¨ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å…¥è¿™ä¸ªè¡¨ï¼Œç”Ÿæˆä¸€ä¸ªç´¢å¼•å·ï¼Œä»¥åŽå°±ä¸å‘é€åŒæ ·å­—æ®µäº†ï¼Œåªå‘é€ç´¢å¼•å·ï¼Œè¿™æ ·å°±æé«˜é€Ÿåº¦äº†ã€‚ 5.5 æœåŠ¡å™¨æŽ¨é€ HTTP/2 å…è®¸æœåŠ¡å™¨æœªç»è¯·æ±‚ï¼Œä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€èµ„æºï¼Œè¿™å«åšæœåŠ¡å™¨æŽ¨é€ï¼ˆserver pushï¼‰ã€‚ å¸¸è§åœºæ™¯æ˜¯å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µé‡Œé¢åŒ…å«å¾ˆå¤šé™æ€èµ„æºã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¿…é¡»æ”¶åˆ°ç½‘é¡µåŽï¼Œè§£æžHTMLæºç ï¼Œå‘çŽ°æœ‰é™æ€èµ„æºï¼Œå†å‘å‡ºé™æ€èµ„æºè¯·æ±‚ã€‚å…¶å®žï¼ŒæœåŠ¡å™¨å¯ä»¥é¢„æœŸåˆ°å®¢æˆ·ç«¯è¯·æ±‚ç½‘é¡µåŽï¼Œå¾ˆå¯èƒ½ä¼šå†è¯·æ±‚é™æ€èµ„æºï¼Œæ‰€ä»¥å°±ä¸»åŠ¨æŠŠè¿™äº›é™æ€èµ„æºéšç€ç½‘é¡µä¸€èµ·å‘ç»™å®¢æˆ·ç«¯äº†ã€‚ æ•´ç†è‡ªï¼šhttp://www.ruanyifeng.com/blog/2016/08/http.html]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Žä¸Šåˆ°ä¸‹çœ‹äº”å±‚æ¨¡åž‹]]></title>
    <url>%2F2019%2F01%2F17%2Fnetwork%2F2.%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E7%9C%8B%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬äºŒç¯‡æ–‡ç« ã€‚ç»è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„è¯¦ç»†ä»‹ç»ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸€ä¸ªæ•°æ®æ˜¯å¦‚ä½•ä»Žç‰©ç†å±‚ä¸€æ­¥ä¸€æ­¥åˆ°è¾¾åº”ç”¨å±‚çš„ï¼Œé‚£ä¹ˆæœ¬ç« ä»Žä¸Šè€Œä¸‹çš„è§’åº¦æ¥çœ‹çœ‹ä¸€æ¡è¯·æ±‚æ—¶å¦‚ä½•ä»Žæµè§ˆå™¨ä¼ é€’åˆ°æœåŠ¡å™¨å¹¶ä¸”è¿”å›žçš„ã€‚ è¿™ä¸ªè¿‡ç¨‹çœ‹çš„å°±æ˜¯ç”¨æˆ·ä»Žæµè§ˆå™¨è¾“å…¥ä¸€æ¡urlä¹‹åŽï¼Œæ˜¯å¦‚ä½•å‘é€è¿‡åŽ»çš„ã€‚ 1.ä¸Šä¸€ç¯‡æ–‡ç« çš„å°ç»“ æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œç½‘ç»œé€šä¿¡å°±æ˜¯äº¤æ¢æ•°æ®åŒ…ã€‚ç”µè„‘Aå‘ç”µè„‘Bå‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼ŒåŽè€…æ”¶åˆ°äº†ï¼Œå›žå¤ä¸€ä¸ªæ•°æ®åŒ…ï¼Œä»Žè€Œå®žçŽ°ä¸¤å°ç”µè„‘ä¹‹é—´çš„é€šä¿¡ã€‚æ•°æ®åŒ…çš„ç»“æž„ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸‹é¢è¿™æ ·ï¼š å‘é€è¿™ä¸ªåŒ…ï¼Œéœ€è¦çŸ¥é“ä¸¤ä¸ªåœ°å€ï¼š å¯¹æ–¹çš„MACåœ°å€ å¯¹æ–¹çš„IPåœ°å€ æœ‰äº†è¿™ä¸¤ä¸ªåœ°å€ï¼Œæ•°æ®åŒ…æ‰èƒ½å‡†ç¡®é€åˆ°æŽ¥æ”¶è€…æ‰‹ä¸­ã€‚ä½†æ˜¯ï¼Œå‰é¢è¯´è¿‡ï¼ŒMACåœ°å€æœ‰å±€é™æ€§ï¼Œå¦‚æžœä¸¤å°ç”µè„‘ä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œå°±æ— æ³•çŸ¥é“å¯¹æ–¹çš„MACåœ°å€ï¼Œå¿…é¡»é€šè¿‡ç½‘å…³ï¼ˆgatewayï¼‰è½¬å‘ã€‚ ä¸Šå›¾ä¸­ï¼Œ1å·ç”µè„‘è¦å‘4å·ç”µè„‘å‘é€ä¸€ä¸ªæ•°æ®åŒ…ã€‚å®ƒå…ˆåˆ¤æ–­4å·ç”µè„‘æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œç»“æžœå‘çŽ°ä¸æ˜¯ï¼ˆåŽæ–‡ä»‹ç»åˆ¤æ–­æ–¹æ³•ï¼‰ï¼ŒäºŽæ˜¯å°±æŠŠè¿™ä¸ªæ•°æ®åŒ…å‘åˆ°ç½‘å…³Aã€‚ç½‘å…³Aé€šè¿‡è·¯ç”±åè®®ï¼Œå‘çŽ°4å·ç”µè„‘ä½äºŽå­ç½‘ç»œBï¼ŒåˆæŠŠæ•°æ®åŒ…å‘ç»™ç½‘å…³Bï¼Œç½‘å…³Bå†è½¬å‘åˆ°4å·ç”µè„‘ã€‚ 1å·ç”µè„‘æŠŠæ•°æ®åŒ…å‘åˆ°ç½‘å…³Aï¼Œå¿…é¡»çŸ¥é“ç½‘å…³Açš„MACåœ°å€ã€‚ å‘é€æ•°æ®åŒ…ä¹‹å‰ï¼Œç”µè„‘å¿…é¡»åˆ¤æ–­å¯¹æ–¹æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œç„¶åŽé€‰æ‹©ç›¸åº”çš„MACåœ°å€ã€‚ æœ‰äº†ä¸€å°æ–°ç”µè„‘ä¹‹åŽï¼Œè¦æƒ³ä¸Šç½‘ï¼Œä¸€ç§æ–¹å¼æ˜¯è‡ªå·±é…ç½®é™æ€IPï¼š å¾ˆå¤šäººéƒ½æ²¡æœ‰è¿›è¡Œè¿‡è¿™ä¸ªé…ç½®ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦è¿™æ ·ã€‚ä½†æ˜¯æœ‰çš„æ—¶å€™ä¹Ÿä¼šç”¨åˆ°ï¼Œæ¯”å¦‚æˆ‘åœ¨ç”µä¿¡å®žä¹ çš„æ—¶å€™ï¼Œä»–ä»¬æ¯ä¸€ä¸ªç½‘å£æ—è¾¹éƒ½è´´ç€è¿™å››ä¸ªå‚æ•°ï¼Œä½ è”ç½‘å¿…é¡»è¦é€‚ç”¨ä»–æä¾›çš„ä¸€ç³»åˆ—åœ°å€æ‰è¡Œã€‚å…¶å®žç»è¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œé€šä¿¡çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“å¯¹æ–¹çš„IPï¼ˆARPçŸ¥é“å¯¹æ–¹çš„MACåœ°å€ï¼‰ã€å­ç½‘æŽ©ç ï¼ˆç¡®å®šæ‰€åœ¨çš„å­ç½‘ï¼‰ã€é»˜è®¤ç½‘å…³ï¼ˆä¸åœ¨ä¸€ä¸ªå­ç½‘ï¼Œè¦é€šè¿‡ç½‘å…³å–è½¬å‘ã€è·¯ç”±ï¼‰ã€DNSæœåŠ¡å™¨ï¼ˆè§£æžåŸŸåä¸ºIPåœ°å€ï¼‰ã€‚ ä½†æ˜¯ï¼Œè¿™æ ·çš„è®¾ç½®å¾ˆä¸“ä¸šï¼Œæ™®é€šç”¨æˆ·æœ›è€Œç”Ÿç•ï¼Œè€Œä¸”å¦‚æžœä¸€å°ç”µè„‘çš„IPåœ°å€ä¿æŒä¸å˜ï¼Œå…¶ä»–ç”µè„‘å°±ä¸èƒ½ä½¿ç”¨è¿™ä¸ªåœ°å€ï¼Œä¸å¤Ÿçµæ´»ã€‚å‡ºäºŽè¿™ä¸¤ä¸ªåŽŸå› ï¼Œå¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨&quot;åŠ¨æ€IPåœ°å€ä¸Šç½‘&quot;ã€‚ 2.DHCPåè®® æ‰€è°“&quot;åŠ¨æ€IPåœ°å€&quot;ï¼ŒæŒ‡è®¡ç®—æœºå¼€æœºåŽï¼Œä¼šè‡ªåŠ¨åˆ†é…åˆ°ä¸€ä¸ªIPåœ°å€ï¼Œä¸ç”¨äººä¸ºè®¾å®šã€‚å®ƒä½¿ç”¨çš„åè®®å«åšDHCPåè®®ã€‚ è¿™ä¸ªåè®®è§„å®šï¼Œæ¯ä¸€ä¸ªå­ç½‘ç»œä¸­ï¼Œæœ‰ä¸€å°è®¡ç®—æœºè´Ÿè´£ç®¡ç†æœ¬ç½‘ç»œçš„æ‰€æœ‰IPåœ°å€ï¼Œå®ƒå«åš&quot;DHCPæœåŠ¡å™¨&quot;ã€‚æ–°çš„è®¡ç®—æœºåŠ å…¥ç½‘ç»œï¼Œå¿…é¡»å‘&quot;DHCPæœåŠ¡å™¨&quot;å‘é€ä¸€ä¸ª&quot;DHCPè¯·æ±‚&quot;æ•°æ®åŒ…ï¼Œç”³è¯·IPåœ°å€å’Œç›¸å…³çš„ç½‘ç»œå‚æ•°ã€‚ å‰é¢è¯´è¿‡ï¼Œå¦‚æžœä¸¤å°è®¡ç®—æœºåœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œå¿…é¡»çŸ¥é“å¯¹æ–¹çš„MACåœ°å€å’ŒIPåœ°å€ï¼Œæ‰èƒ½å‘é€æ•°æ®åŒ…ã€‚ä½†æ˜¯ï¼Œæ–°åŠ å…¥çš„è®¡ç®—æœºä¸çŸ¥é“DHCPæœåŠ¡å™¨çš„ä¸¤ä¸ªåœ°å€ï¼Œæ€Žä¹ˆå‘é€æ•°æ®åŒ…å‘¢ï¼Ÿ DHCPåè®®åšäº†ä¸€äº›å·§å¦™çš„è§„å®šã€‚ é¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œå»ºç«‹åœ¨UDPåè®®ä¹‹ä¸Šï¼Œæ‰€ä»¥æ•´ä¸ªæ•°æ®åŒ…æ˜¯è¿™æ ·çš„ï¼š ï¼ˆ1ï¼‰æœ€å‰é¢çš„&quot;ä»¥å¤ªç½‘æ ‡å¤´&quot;ï¼Œè®¾ç½®å‘å‡ºæ–¹ï¼ˆæœ¬æœºï¼‰çš„MACåœ°å€å’ŒæŽ¥æ”¶æ–¹ï¼ˆDHCPæœåŠ¡å™¨ï¼‰çš„MACåœ°å€ã€‚å‰è€…å°±æ˜¯æœ¬æœºç½‘å¡çš„MACåœ°å€ï¼ŒåŽè€…è¿™æ—¶ä¸çŸ¥é“ï¼Œå°±å¡«å…¥ä¸€ä¸ªå¹¿æ’­åœ°å€ï¼šFF-FF-FF-FF-FF-FFã€‚ ï¼ˆ2ï¼‰åŽé¢çš„&quot;IPæ ‡å¤´&quot;ï¼Œè®¾ç½®å‘å‡ºæ–¹çš„IPåœ°å€å’ŒæŽ¥æ”¶æ–¹çš„IPåœ°å€ã€‚è¿™æ—¶ï¼Œå¯¹äºŽè¿™ä¸¤è€…ï¼Œæœ¬æœºéƒ½ä¸çŸ¥é“ã€‚äºŽæ˜¯ï¼Œå‘å‡ºæ–¹çš„IPåœ°å€å°±è®¾ä¸º0.0.0.0ï¼ŒæŽ¥æ”¶æ–¹çš„IPåœ°å€è®¾ä¸º255.255.255.255ã€‚ ï¼ˆ3ï¼‰æœ€åŽçš„&quot;UDPæ ‡å¤´&quot;ï¼Œè®¾ç½®å‘å‡ºæ–¹çš„ç«¯å£å’ŒæŽ¥æ”¶æ–¹çš„ç«¯å£ã€‚è¿™ä¸€éƒ¨åˆ†æ˜¯DHCPåè®®è§„å®šå¥½çš„ï¼Œå‘å‡ºæ–¹æ˜¯68ç«¯å£ï¼ŒæŽ¥æ”¶æ–¹æ˜¯67ç«¯å£ã€‚ è¿™ä¸ªæ•°æ®åŒ…æž„é€ å®ŒæˆåŽï¼Œå°±å¯ä»¥å‘å‡ºäº†ã€‚ä»¥å¤ªç½‘æ˜¯å¹¿æ’­å‘é€ï¼ŒåŒä¸€ä¸ªå­ç½‘ç»œçš„æ¯å°è®¡ç®—æœºéƒ½æ”¶åˆ°äº†è¿™ä¸ªåŒ…ã€‚ å› ä¸ºæŽ¥æ”¶æ–¹çš„MACåœ°å€æ˜¯FF-FF-FF-FF-FF-FFï¼Œçœ‹ä¸å‡ºæ˜¯å‘ç»™è°çš„ï¼Œæ‰€ä»¥æ¯å°æ”¶åˆ°è¿™ä¸ªåŒ…çš„è®¡ç®—æœºï¼Œè¿˜å¿…é¡»åˆ†æžè¿™ä¸ªåŒ…çš„IPåœ°å€ï¼Œæ‰èƒ½ç¡®å®šæ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„ã€‚ å½“çœ‹åˆ°å‘å‡ºæ–¹IPåœ°å€æ˜¯0.0.0.0ï¼ŒæŽ¥æ”¶æ–¹æ˜¯255.255.255.255ï¼ŒäºŽæ˜¯DHCPæœåŠ¡å™¨çŸ¥é“&quot;è¿™ä¸ªåŒ…æ˜¯å‘ç»™æˆ‘çš„&quot;ï¼Œè€Œå…¶ä»–è®¡ç®—æœºå°±å¯ä»¥ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚ æŽ¥ä¸‹æ¥ï¼ŒDHCPæœåŠ¡å™¨è¯»å‡ºè¿™ä¸ªåŒ…çš„æ•°æ®å†…å®¹ï¼Œåˆ†é…å¥½IPåœ°å€ï¼Œå‘é€å›žåŽ»ä¸€ä¸ª&quot;DHCPå“åº”&quot;æ•°æ®åŒ…ã€‚ è¿™ä¸ªå“åº”åŒ…çš„ç»“æž„ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä»¥å¤ªç½‘æ ‡å¤´çš„MACåœ°å€æ˜¯åŒæ–¹çš„ç½‘å¡åœ°å€ï¼ŒIPæ ‡å¤´çš„IPåœ°å€æ˜¯DHCPæœåŠ¡å™¨çš„IPåœ°å€ï¼ˆå‘å‡ºæ–¹ï¼‰å’Œ255.255.255.255ï¼ˆæŽ¥æ”¶æ–¹ï¼‰ï¼ŒUDPæ ‡å¤´çš„ç«¯å£æ˜¯67ï¼ˆå‘å‡ºæ–¹ï¼‰å’Œ68ï¼ˆæŽ¥æ”¶æ–¹ï¼‰ï¼Œåˆ†é…ç»™è¯·æ±‚ç«¯çš„IPåœ°å€å’Œæœ¬ç½‘ç»œçš„å…·ä½“å‚æ•°åˆ™åŒ…å«åœ¨Dataéƒ¨åˆ†ã€‚ æ–°åŠ å…¥çš„è®¡ç®—æœºæ”¶åˆ°è¿™ä¸ªå“åº”åŒ…ï¼ŒäºŽæ˜¯å°±çŸ¥é“äº†è‡ªå·±çš„IPåœ°å€ã€å­ç½‘æŽ©ç ã€ç½‘å…³åœ°å€ã€DNSæœåŠ¡å™¨ç­‰ç­‰å‚æ•°ã€‚ åŠ¨æ€æ‹¿åˆ°æœ€æ ¸å¿ƒçš„å››ä¸ªå‚æ•°ï¼šè‡ªå·±çš„IPåœ°å€ã€å­ç½‘æŽ©ç ã€ç½‘å…³åœ°å€ã€DNSæœåŠ¡å™¨ï¼Œå°±å¯ä»¥è”ç½‘äº†ã€‚ 3.è®¿é—®googleçš„è¿‡ç¨‹ æˆ‘ä»¬å‡å®šï¼Œç»è¿‡ä¸Šä¸€èŠ‚çš„æ­¥éª¤ï¼Œç”¨æˆ·è®¾ç½®å¥½äº†è‡ªå·±çš„ç½‘ç»œå‚æ•°ï¼š æœ¬æœºçš„IPåœ°å€ï¼š192.168.1.100 å­ç½‘æŽ©ç ï¼š255.255.255.0 ç½‘å…³çš„IPåœ°å€ï¼š192.168.1.1 DNSçš„IPåœ°å€ï¼š8.8.8.8 ç„¶åŽä»–æ‰“å¼€æµè§ˆå™¨ï¼Œæƒ³è¦è®¿é—®Googleï¼Œåœ¨åœ°å€æ è¾“å…¥äº†ç½‘å€ï¼šwww.google.comã€‚ è¿™æ„å‘³ç€ï¼Œæµè§ˆå™¨è¦å‘Googleå‘é€ä¸€ä¸ªç½‘é¡µè¯·æ±‚çš„æ•°æ®åŒ…ã€‚ 3.1 DNSåè®® æˆ‘ä»¬çŸ¥é“ï¼Œå‘é€æ•°æ®åŒ…ï¼Œå¿…é¡»è¦çŸ¥é“å¯¹æ–¹çš„IPåœ°å€ã€‚ä½†æ˜¯ï¼ŒçŽ°åœ¨ï¼Œæˆ‘ä»¬åªçŸ¥é“ç½‘å€www.google.comï¼Œä¸çŸ¥é“å®ƒçš„IPåœ°å€ã€‚ DNSåè®®å¯ä»¥å¸®åŠ©æˆ‘ä»¬ï¼Œå°†è¿™ä¸ªç½‘å€è½¬æ¢æˆIPåœ°å€ã€‚å·²çŸ¥DNSæœåŠ¡å™¨ä¸º8.8.8.8ï¼ŒäºŽæ˜¯æˆ‘ä»¬å‘è¿™ä¸ªåœ°å€å‘é€ä¸€ä¸ªDNSæ•°æ®åŒ…ï¼ˆ53ç«¯å£ï¼‰ã€‚ ç„¶åŽï¼ŒDNSæœåŠ¡å™¨åšå‡ºå“åº”ï¼Œå‘Šè¯‰æˆ‘ä»¬Googleçš„IPåœ°å€æ˜¯172.194.72.105ã€‚äºŽæ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯¹æ–¹çš„IPåœ°å€ã€‚ 3.2 å­ç½‘æŽ©ç  æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆ¤æ–­ï¼Œè¿™ä¸ªIPåœ°å€æ˜¯ä¸æ˜¯åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œè¿™å°±è¦ç”¨åˆ°å­ç½‘æŽ©ç ã€‚ å·²çŸ¥å­ç½‘æŽ©ç æ˜¯255.255.255.0ï¼Œæœ¬æœºç”¨å®ƒå¯¹è‡ªå·±çš„IPåœ°å€192.168.1.100ï¼Œåšä¸€ä¸ªäºŒè¿›åˆ¶çš„ANDè¿ç®—ï¼ˆä¸¤ä¸ªæ•°ä½éƒ½ä¸º1ï¼Œç»“æžœä¸º1ï¼Œå¦åˆ™ä¸º0ï¼‰ï¼Œè®¡ç®—ç»“æžœä¸º192.168.1.0ï¼›ç„¶åŽå¯¹Googleçš„IPåœ°å€172.194.72.105ä¹Ÿåšä¸€ä¸ªANDè¿ç®—ï¼Œè®¡ç®—ç»“æžœä¸º172.194.72.0ã€‚è¿™ä¸¤ä¸ªç»“æžœä¸ç›¸ç­‰ï¼Œæ‰€ä»¥ç»“è®ºæ˜¯ï¼ŒGoogleä¸Žæœ¬æœºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è¦å‘Googleå‘é€æ•°æ®åŒ…ï¼Œå¿…é¡»é€šè¿‡ç½‘å…³192.168.1.1è½¬å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŽ¥æ”¶æ–¹çš„MACåœ°å€å°†æ˜¯ç½‘å…³çš„MACåœ°å€ã€‚ 3.3 åº”ç”¨å±‚åè®® æµè§ˆç½‘é¡µç”¨çš„æ˜¯HTTPåè®®ï¼Œå®ƒçš„æ•´ä¸ªæ•°æ®åŒ…æž„é€ æ˜¯è¿™æ ·çš„ï¼š HTTPéƒ¨åˆ†çš„å†…å®¹ï¼Œç±»ä¼¼äºŽä¸‹é¢è¿™æ ·ï¼š 123456789 GET / HTTP/1.1 Host: www.google.com Connection: keep-alive User-Agent: Mozilla/5.0 (Windows NT 6.1) ...... Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Encoding: gzip,deflate,sdch Accept-Language: zh-CN,zh;q=0.8 Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3 Cookie: ... ... æˆ‘ä»¬å‡å®šè¿™ä¸ªéƒ¨åˆ†çš„é•¿åº¦ä¸º4960å­—èŠ‚ï¼Œå®ƒä¼šè¢«åµŒåœ¨TCPæ•°æ®åŒ…ä¹‹ä¸­ã€‚ 3.4 TCPåè®® TCPæ•°æ®åŒ…éœ€è¦è®¾ç½®ç«¯å£ï¼ŒæŽ¥æ”¶æ–¹ï¼ˆGoogleï¼‰çš„HTTPç«¯å£é»˜è®¤æ˜¯80ï¼Œå‘é€æ–¹ï¼ˆæœ¬æœºï¼‰çš„ç«¯å£æ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„1024-65535ä¹‹é—´çš„æ•´æ•°ï¼Œå‡å®šä¸º51775ã€‚ TCPæ•°æ®åŒ…çš„æ ‡å¤´é•¿åº¦ä¸º20å­—èŠ‚ï¼ŒåŠ ä¸ŠåµŒå…¥HTTPçš„æ•°æ®åŒ…ï¼Œæ€»é•¿åº¦å˜ä¸º4980å­—èŠ‚ã€‚ 3.5 IPåè®® ç„¶åŽï¼ŒTCPæ•°æ®åŒ…å†åµŒå…¥IPæ•°æ®åŒ…ã€‚IPæ•°æ®åŒ…éœ€è¦è®¾ç½®åŒæ–¹çš„IPåœ°å€ï¼Œè¿™æ˜¯å·²çŸ¥çš„ï¼Œå‘é€æ–¹æ˜¯192.168.1.100ï¼ˆæœ¬æœºï¼‰ï¼ŒæŽ¥æ”¶æ–¹æ˜¯172.194.72.105ï¼ˆGoogleï¼‰ã€‚ IPæ•°æ®åŒ…çš„æ ‡å¤´é•¿åº¦ä¸º20å­—èŠ‚ï¼ŒåŠ ä¸ŠåµŒå…¥çš„TCPæ•°æ®åŒ…ï¼Œæ€»é•¿åº¦å˜ä¸º5000å­—èŠ‚ã€‚ 3.6 ä»¥å¤ªç½‘åè®® æœ€åŽï¼ŒIPæ•°æ®åŒ…åµŒå…¥ä»¥å¤ªç½‘æ•°æ®åŒ…ã€‚ä»¥å¤ªç½‘æ•°æ®åŒ…éœ€è¦è®¾ç½®åŒæ–¹çš„MACåœ°å€ï¼Œå‘é€æ–¹ä¸ºæœ¬æœºçš„ç½‘å¡MACåœ°å€ï¼ŒæŽ¥æ”¶æ–¹ä¸ºç½‘å…³192.168.1.1çš„MACåœ°å€ï¼ˆé€šè¿‡ARPåè®®å¾—åˆ°ï¼‰ã€‚ ä»¥å¤ªç½‘æ•°æ®åŒ…çš„æ•°æ®éƒ¨åˆ†ï¼Œæœ€å¤§é•¿åº¦ä¸º1500å­—èŠ‚ï¼Œè€ŒçŽ°åœ¨çš„IPæ•°æ®åŒ…é•¿åº¦ä¸º5000å­—èŠ‚ã€‚å› æ­¤ï¼ŒIPæ•°æ®åŒ…å¿…é¡»åˆ†å‰²æˆå››ä¸ªåŒ…ã€‚å› ä¸ºæ¯ä¸ªåŒ…éƒ½æœ‰è‡ªå·±çš„IPæ ‡å¤´ï¼ˆ20å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥å››ä¸ªåŒ…çš„IPæ•°æ®åŒ…çš„é•¿åº¦åˆ†åˆ«ä¸º1500ã€1500ã€1500ã€560ã€‚ 3.7 æœåŠ¡å™¨å“åº” ç»è¿‡å¤šä¸ªç½‘å…³çš„è½¬å‘ï¼ŒGoogleçš„æœåŠ¡å™¨172.194.72.105ï¼Œæ”¶åˆ°äº†è¿™å››ä¸ªä»¥å¤ªç½‘æ•°æ®åŒ…ã€‚ æ ¹æ®IPæ ‡å¤´çš„åºå·ï¼ŒGoogleå°†å››ä¸ªåŒ…æ‹¼èµ·æ¥ï¼Œå–å‡ºå®Œæ•´çš„TCPæ•°æ®åŒ…ï¼Œç„¶åŽè¯»å‡ºé‡Œé¢çš„&quot;HTTPè¯·æ±‚&quot;ï¼ŒæŽ¥ç€åšå‡º&quot;HTTPå“åº”&quot;ï¼Œå†ç”¨TCPåè®®å‘å›žæ¥ã€‚ æœ¬æœºæ”¶åˆ°HTTPå“åº”ä»¥åŽï¼Œå°±å¯ä»¥å°†ç½‘é¡µæ˜¾ç¤ºå‡ºæ¥ï¼Œå®Œæˆä¸€æ¬¡ç½‘ç»œé€šä¿¡ã€‚ æ•´ç†è‡ªï¼šhttp://www.ruanyifeng.com/blog/2012/06/internet_protocol_suite_part_ii.html]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Žä¸‹åˆ°ä¸Šçœ‹äº”å±‚æ¨¡åž‹]]></title>
    <url>%2F2019%2F01%2F17%2Fnetwork%2F1.%E4%BB%8E%E4%B8%8B%E5%88%B0%E4%B8%8A%E7%9C%8B%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚è¦æƒ³äº†è§£HTTPåè®®ï¼Œå¿…ç„¶è¦ä»Žæœ€åŸºæœ¬çš„è®¡ç®—æœºç½‘ç»œçŸ¥è¯†å¼€å§‹å…¥æ‰‹ã€‚æœ¬ç¯‡æ–‡ç« ä»Žä¸‹åˆ°ä¸Šå…·ä½“ä»‹ç»äº”å±‚ç»å…¸æ¨¡åž‹ï¼Œæžé€Ÿå…¥é—¨è®¡ç®—æœºç½‘ç»œã€‚ ç»å…¸äº”å±‚æ¨¡åž‹ ä¸‹é¢æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å„å±‚åšçš„äº‹æƒ…ï¼ 1.ç‰©ç†å±‚ ç”µè„‘è¦ç»„ç½‘ï¼Œç¬¬ä¸€ä»¶äº‹è¦å¹²ä»€ä¹ˆï¼Ÿå½“ç„¶æ˜¯å…ˆæŠŠç”µè„‘è¿žèµ·æ¥ï¼Œå¯ä»¥ç”¨å…‰ç¼†ã€ç”µç¼†ã€åŒç»žçº¿ã€æ— çº¿ç”µæ³¢ç­‰æ–¹å¼ã€‚ è¿™å°±å«åš&quot;ç‰©ç†å±‚&quot;ï¼Œå®ƒå°±æ˜¯æŠŠç”µè„‘è¿žæŽ¥èµ·æ¥çš„ç‰©ç†æ‰‹æ®µã€‚å®ƒä¸»è¦è§„å®šäº†ç½‘ç»œçš„ä¸€äº›ç”µæ°”ç‰¹æ€§ï¼Œä½œç”¨æ˜¯è´Ÿè´£ä¼ é€0å’Œ1çš„ç”µä¿¡å·ã€‚ 2.æ•°æ®é“¾è·¯å±‚ å•çº¯çš„0å’Œ1æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå¿…é¡»è§„å®šè§£è¯»æ–¹å¼ï¼šå¤šå°‘ä¸ªç”µä¿¡å·ç®—ä¸€ç»„ï¼Ÿæ¯ä¸ªä¿¡å·ä½æœ‰ä½•æ„ä¹‰ï¼Ÿ è¿™å°±æ˜¯&quot;é“¾æŽ¥å±‚&quot;çš„åŠŸèƒ½ï¼Œå®ƒåœ¨&quot;å®žä½“å±‚&quot;çš„ä¸Šæ–¹ï¼Œç¡®å®šäº†0å’Œ1çš„åˆ†ç»„æ–¹å¼ã€‚ 2.1 ä»¥å¤ªç½‘åè®® æ—©æœŸçš„æ—¶å€™ï¼Œæ¯å®¶å…¬å¸éƒ½æœ‰è‡ªå·±çš„ç”µä¿¡å·åˆ†ç»„æ–¹å¼ã€‚é€æ¸åœ°ï¼Œä¸€ç§å«åš&quot;ä»¥å¤ªç½‘&quot;ï¼ˆEthernetï¼‰çš„åè®®ï¼Œå æ®äº†ä¸»å¯¼åœ°ä½ã€‚ ä»¥å¤ªç½‘è§„å®šï¼Œä¸€ç»„ç”µä¿¡å·æž„æˆä¸€ä¸ªæ•°æ®åŒ…ï¼Œå«åš&quot;å¸§&quot;ï¼ˆFrameï¼‰ã€‚æ¯ä¸€å¸§åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šæ ‡å¤´ï¼ˆHeadï¼‰å’Œæ•°æ®ï¼ˆDataï¼‰ã€‚ &quot;æ ‡å¤´&quot;åŒ…å«æ•°æ®åŒ…çš„ä¸€äº›è¯´æ˜Žé¡¹ï¼Œæ¯”å¦‚å‘é€è€…ã€æŽ¥å—è€…ã€æ•°æ®ç±»åž‹ç­‰ç­‰ï¼›&quot;æ•°æ®&quot;åˆ™æ˜¯æ•°æ®åŒ…çš„å…·ä½“å†…å®¹ã€‚ &quot;æ ‡å¤´&quot;çš„é•¿åº¦ï¼Œå›ºå®šä¸º18å­—èŠ‚ã€‚&quot;æ•°æ®&quot;çš„é•¿åº¦ï¼Œæœ€çŸ­ä¸º46å­—èŠ‚ï¼Œæœ€é•¿ä¸º1500å­—èŠ‚ã€‚å› æ­¤ï¼Œæ•´ä¸ª&quot;å¸§&quot;æœ€çŸ­ä¸º64å­—èŠ‚ï¼Œæœ€é•¿ä¸º1518å­—èŠ‚ã€‚å¦‚æžœæ•°æ®å¾ˆé•¿ï¼Œå°±å¿…é¡»åˆ†å‰²æˆå¤šä¸ªå¸§è¿›è¡Œå‘é€ã€‚ 2.2 MACåœ°å€ ä¸Šé¢æåˆ°ï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…çš„&quot;æ ‡å¤´&quot;ï¼ŒåŒ…å«äº†å‘é€è€…å’ŒæŽ¥å—è€…çš„ä¿¡æ¯ã€‚é‚£ä¹ˆï¼Œå‘é€è€…å’ŒæŽ¥å—è€…æ˜¯å¦‚ä½•æ ‡è¯†å‘¢ï¼Ÿ ä»¥å¤ªç½‘è§„å®šï¼Œè¿žå…¥ç½‘ç»œçš„æ‰€æœ‰è®¾å¤‡ï¼Œéƒ½å¿…é¡»å…·æœ‰&quot;ç½‘å¡&quot;æŽ¥å£ã€‚æ•°æ®åŒ…å¿…é¡»æ˜¯ä»Žä¸€å—ç½‘å¡ï¼Œä¼ é€åˆ°å¦ä¸€å—ç½‘å¡ã€‚ç½‘å¡çš„åœ°å€ï¼Œå°±æ˜¯æ•°æ®åŒ…çš„å‘é€åœ°å€å’ŒæŽ¥æ”¶åœ°å€ï¼Œè¿™å«åšMACåœ°å€ã€‚ æ¯å—ç½‘å¡å‡ºåŽ‚çš„æ—¶å€™ï¼Œéƒ½æœ‰ä¸€ä¸ªå…¨ä¸–ç•Œç‹¬ä¸€æ— äºŒçš„MACåœ°å€ï¼Œé•¿åº¦æ˜¯48ä¸ªäºŒè¿›åˆ¶ä½ï¼Œé€šå¸¸ç”¨12ä¸ªåå…­è¿›åˆ¶æ•°è¡¨ç¤ºã€‚ å‰6ä¸ªåå…­è¿›åˆ¶æ•°æ˜¯åŽ‚å•†ç¼–å·ï¼ŒåŽ6ä¸ªæ˜¯è¯¥åŽ‚å•†çš„ç½‘å¡æµæ°´å·ã€‚æœ‰äº†MACåœ°å€ï¼Œå°±å¯ä»¥å®šä½ç½‘å¡å’Œæ•°æ®åŒ…çš„è·¯å¾„äº†ã€‚ 2.3 å¹¿æ’­ å®šä¹‰åœ°å€åªæ˜¯ç¬¬ä¸€æ­¥ï¼ŒåŽé¢è¿˜æœ‰æ›´å¤šçš„æ­¥éª¤ã€‚ é¦–å…ˆï¼Œä¸€å—ç½‘å¡æ€Žä¹ˆä¼šçŸ¥é“å¦ä¸€å—ç½‘å¡çš„MACåœ°å€ï¼Ÿ å›žç­”æ˜¯æœ‰ä¸€ç§ARPåè®®ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸‹é¢ä»‹ç»ARPã€‚ å…¶æ¬¡ï¼Œå°±ç®—æœ‰äº†MACåœ°å€ï¼Œç³»ç»Ÿæ€Žæ ·æ‰èƒ½æŠŠæ•°æ®åŒ…å‡†ç¡®é€åˆ°æŽ¥æ”¶æ–¹ï¼Ÿ å›žç­”æ˜¯ä»¥å¤ªç½‘é‡‡ç”¨äº†ä¸€ç§å¾ˆ&quot;åŽŸå§‹&quot;çš„æ–¹å¼ï¼Œå®ƒä¸æ˜¯æŠŠæ•°æ®åŒ…å‡†ç¡®é€åˆ°æŽ¥æ”¶æ–¹ï¼Œè€Œæ˜¯å‘æœ¬ç½‘ç»œå†…æ‰€æœ‰è®¡ç®—æœºå‘é€ï¼Œè®©æ¯å°è®¡ç®—æœºè‡ªå·±åˆ¤æ–­ï¼Œæ˜¯å¦ä¸ºæŽ¥æ”¶æ–¹ã€‚ ä¸Šå›¾ä¸­ï¼Œ1å·è®¡ç®—æœºå‘2å·è®¡ç®—æœºå‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼ŒåŒä¸€ä¸ªå­ç½‘ç»œçš„3å·ã€4å·ã€5å·è®¡ç®—æœºéƒ½ä¼šæ”¶åˆ°è¿™ä¸ªåŒ…ã€‚å®ƒä»¬è¯»å–è¿™ä¸ªåŒ…çš„&quot;æ ‡å¤´&quot;ï¼Œæ‰¾åˆ°æŽ¥æ”¶æ–¹çš„MACåœ°å€ï¼Œç„¶åŽä¸Žè‡ªèº«çš„MACåœ°å€ç›¸æ¯”è¾ƒï¼Œå¦‚æžœä¸¤è€…ç›¸åŒï¼Œå°±æŽ¥å—è¿™ä¸ªåŒ…ï¼Œåšè¿›ä¸€æ­¥å¤„ç†ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚è¿™ç§å‘é€æ–¹å¼å°±å«åš&quot;å¹¿æ’­&quot;ï¼ˆbroadcastingï¼‰ã€‚ æœ‰äº†æ•°æ®åŒ…çš„å®šä¹‰ã€ç½‘å¡çš„MACåœ°å€ã€å¹¿æ’­çš„å‘é€æ–¹å¼ï¼Œ&quot;é“¾æŽ¥å±‚&quot;å°±å¯ä»¥åœ¨å¤šå°è®¡ç®—æœºä¹‹é—´ä¼ é€æ•°æ®äº†ã€‚ 3.ç½‘ç»œå±‚ ä»¥å¤ªç½‘åè®®ï¼Œä¾é MACåœ°å€å‘é€æ•°æ®ã€‚ç†è®ºä¸Šï¼Œå•å•ä¾é MACåœ°å€ï¼Œä¸Šæµ·çš„ç½‘å¡å°±å¯ä»¥æ‰¾åˆ°æ´›æ‰çŸ¶çš„ç½‘å¡äº†ï¼ŒæŠ€æœ¯ä¸Šæ˜¯å¯ä»¥å®žçŽ°çš„ã€‚ ä½†æ˜¯ï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªé‡å¤§çš„ç¼ºç‚¹ã€‚ä»¥å¤ªç½‘é‡‡ç”¨å¹¿æ’­æ–¹å¼å‘é€æ•°æ®åŒ…ï¼Œæ‰€æœ‰æˆå‘˜äººæ‰‹ä¸€&quot;åŒ…&quot;ï¼Œä¸ä»…æ•ˆçŽ‡ä½Žï¼Œè€Œä¸”å±€é™åœ¨å‘é€è€…æ‰€åœ¨çš„å­ç½‘ç»œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœä¸¤å°è®¡ç®—æœºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œå¹¿æ’­æ˜¯ä¼ ä¸è¿‡åŽ»çš„ã€‚è¿™ç§è®¾è®¡æ˜¯åˆç†çš„ï¼Œå¦åˆ™äº’è”ç½‘ä¸Šæ¯ä¸€å°è®¡ç®—æœºéƒ½ä¼šæ”¶åˆ°æ‰€æœ‰åŒ…ï¼Œé‚£ä¼šå¼•èµ·ç¾éš¾ã€‚ äº’è”ç½‘æ˜¯æ— æ•°å­ç½‘ç»œå…±åŒç»„æˆçš„ä¸€ä¸ªå·¨åž‹ç½‘ç»œï¼Œå¾ˆåƒæƒ³è±¡ä¸Šæµ·å’Œæ´›æ‰çŸ¶çš„ç”µè„‘ä¼šåœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œè¿™å‡ ä¹Žæ˜¯ä¸å¯èƒ½çš„ã€‚ å› æ­¤ï¼Œå¿…é¡»æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œèƒ½å¤ŸåŒºåˆ†å“ªäº›MACåœ°å€å±žäºŽåŒä¸€ä¸ªå­ç½‘ç»œï¼Œå“ªäº›ä¸æ˜¯ã€‚å¦‚æžœæ˜¯åŒä¸€ä¸ªå­ç½‘ç»œï¼Œå°±é‡‡ç”¨å¹¿æ’­æ–¹å¼å‘é€ï¼Œå¦åˆ™å°±é‡‡ç”¨&quot;è·¯ç”±&quot;æ–¹å¼å‘é€ã€‚ï¼ˆ&quot;è·¯ç”±&quot;çš„æ„æ€ï¼Œå°±æ˜¯æŒ‡å¦‚ä½•å‘ä¸åŒçš„å­ç½‘ç»œåˆ†å‘æ•°æ®åŒ…ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¸»é¢˜ï¼Œæœ¬æ–‡ä¸æ¶‰åŠã€‚ï¼‰é—æ†¾çš„æ˜¯ï¼ŒMACåœ°å€æœ¬èº«æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚å®ƒåªä¸ŽåŽ‚å•†æœ‰å…³ï¼Œä¸Žæ‰€å¤„ç½‘ç»œæ— å…³ã€‚ è¿™å°±å¯¼è‡´äº†&quot;ç½‘ç»œå±‚&quot;çš„è¯žç”Ÿã€‚å®ƒçš„ä½œç”¨æ˜¯å¼•è¿›ä¸€å¥—æ–°çš„åœ°å€ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤ŸåŒºåˆ†ä¸åŒçš„è®¡ç®—æœºæ˜¯å¦å±žäºŽåŒä¸€ä¸ªå­ç½‘ç»œã€‚è¿™å¥—åœ°å€å°±å«åš&quot;ç½‘ç»œåœ°å€&quot;ï¼Œç®€ç§°&quot;ç½‘å€&quot;ã€‚ äºŽæ˜¯ï¼Œ&quot;ç½‘ç»œå±‚&quot;å‡ºçŽ°ä»¥åŽï¼Œæ¯å°è®¡ç®—æœºæœ‰äº†ä¸¤ç§åœ°å€ï¼Œä¸€ç§æ˜¯MACåœ°å€ï¼Œå¦ä¸€ç§æ˜¯ç½‘ç»œåœ°å€ã€‚ä¸¤ç§åœ°å€ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ï¼ŒMACåœ°å€æ˜¯ç»‘å®šåœ¨ç½‘å¡ä¸Šçš„ï¼Œç½‘ç»œåœ°å€åˆ™æ˜¯ç®¡ç†å‘˜åˆ†é…çš„ï¼Œå®ƒä»¬åªæ˜¯éšæœºç»„åˆåœ¨ä¸€èµ·ã€‚ ç½‘ç»œåœ°å€å¸®åŠ©æˆ‘ä»¬ç¡®å®šè®¡ç®—æœºæ‰€åœ¨çš„å­ç½‘ç»œï¼ŒMACåœ°å€åˆ™å°†æ•°æ®åŒ…é€åˆ°è¯¥å­ç½‘ç»œä¸­çš„ç›®æ ‡ç½‘å¡ã€‚å› æ­¤ï¼Œä»Žé€»è¾‘ä¸Šå¯ä»¥æŽ¨æ–­ï¼Œå¿…å®šæ˜¯å…ˆå¤„ç†ç½‘ç»œåœ°å€ï¼Œç„¶åŽå†å¤„ç†MACåœ°å€ã€‚ 3.1 IPåè®® è§„å®šç½‘ç»œåœ°å€çš„åè®®ï¼Œå«åšIPåè®®ã€‚å®ƒæ‰€å®šä¹‰çš„åœ°å€ï¼Œå°±è¢«ç§°ä¸ºIPåœ°å€ã€‚ ç›®å‰ï¼Œå¹¿æ³›é‡‡ç”¨çš„æ˜¯IPåè®®ç¬¬å››ç‰ˆï¼Œç®€ç§°IPv4ã€‚è¿™ä¸ªç‰ˆæœ¬è§„å®šï¼Œç½‘ç»œåœ°å€ç”±32ä¸ªäºŒè¿›åˆ¶ä½ç»„æˆã€‚ ä¹ æƒ¯ä¸Šï¼Œæˆ‘ä»¬ç”¨åˆ†æˆå››æ®µçš„åè¿›åˆ¶æ•°è¡¨ç¤ºIPåœ°å€ï¼Œä»Ž0.0.0.0ä¸€ç›´åˆ°255.255.255.255ã€‚ äº’è”ç½‘ä¸Šçš„æ¯ä¸€å°è®¡ç®—æœºï¼Œéƒ½ä¼šåˆ†é…åˆ°ä¸€ä¸ªIPåœ°å€ã€‚è¿™ä¸ªåœ°å€åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰ä¸€éƒ¨åˆ†ä»£è¡¨ç½‘ç»œï¼ŒåŽä¸€éƒ¨åˆ†ä»£è¡¨ä¸»æœºã€‚æ¯”å¦‚ï¼ŒIPåœ°å€172.16.254.1ï¼Œè¿™æ˜¯ä¸€ä¸ª32ä½çš„åœ°å€ï¼Œå‡å®šå®ƒçš„ç½‘ç»œéƒ¨åˆ†æ˜¯å‰24ä½ï¼ˆ172.16.254ï¼‰ï¼Œé‚£ä¹ˆä¸»æœºéƒ¨åˆ†å°±æ˜¯åŽ8ä½ï¼ˆæœ€åŽçš„é‚£ä¸ª1ï¼‰ã€‚å¤„äºŽåŒä¸€ä¸ªå­ç½‘ç»œçš„ç”µè„‘ï¼Œå®ƒä»¬IPåœ°å€çš„ç½‘ç»œéƒ¨åˆ†å¿…å®šæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´172.16.254.2åº”è¯¥ä¸Ž172.16.254.1å¤„åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ ä½†æ˜¯ï¼Œé—®é¢˜åœ¨äºŽå•å•ä»ŽIPåœ°å€ï¼Œæˆ‘ä»¬æ— æ³•åˆ¤æ–­ç½‘ç»œéƒ¨åˆ†ã€‚è¿˜æ˜¯ä»¥172.16.254.1ä¸ºä¾‹ï¼Œå®ƒçš„ç½‘ç»œéƒ¨åˆ†ï¼Œåˆ°åº•æ˜¯å‰24ä½ï¼Œè¿˜æ˜¯å‰16ä½ï¼Œç”šè‡³å‰28ä½ï¼Œä»ŽIPåœ°å€ä¸Šæ˜¯çœ‹ä¸å‡ºæ¥çš„ã€‚ é‚£ä¹ˆï¼Œæ€Žæ ·æ‰èƒ½ä»ŽIPåœ°å€ï¼Œåˆ¤æ–­ä¸¤å°è®¡ç®—æœºæ˜¯å¦å±žäºŽåŒä¸€ä¸ªå­ç½‘ç»œå‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ°å¦ä¸€ä¸ªå‚æ•°&quot;å­ç½‘æŽ©ç &quot;ï¼ˆsubnet maskï¼‰ã€‚ æ‰€è°“&quot;å­ç½‘æŽ©ç &quot;ï¼Œå°±æ˜¯è¡¨ç¤ºå­ç½‘ç»œç‰¹å¾çš„ä¸€ä¸ªå‚æ•°ã€‚å®ƒåœ¨å½¢å¼ä¸Šç­‰åŒäºŽIPåœ°å€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª32ä½äºŒè¿›åˆ¶æ•°å­—ï¼Œå®ƒçš„ç½‘ç»œéƒ¨åˆ†å…¨éƒ¨ä¸º1ï¼Œä¸»æœºéƒ¨åˆ†å…¨éƒ¨ä¸º0ã€‚æ¯”å¦‚ï¼ŒIPåœ°å€172.16.254.1ï¼Œå¦‚æžœå·²çŸ¥ç½‘ç»œéƒ¨åˆ†æ˜¯å‰24ä½ï¼Œä¸»æœºéƒ¨åˆ†æ˜¯åŽ8ä½ï¼Œé‚£ä¹ˆå­ç½‘ç»œæŽ©ç å°±æ˜¯11111111.11111111.11111111.00000000ï¼Œå†™æˆåè¿›åˆ¶å°±æ˜¯255.255.255.0ã€‚ çŸ¥é“&quot;å­ç½‘æŽ©ç &quot;ï¼Œæˆ‘ä»¬å°±èƒ½åˆ¤æ–­ï¼Œä»»æ„ä¸¤ä¸ªIPåœ°å€æ˜¯å¦å¤„åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚æ–¹æ³•æ˜¯å°†ä¸¤ä¸ªIPåœ°å€ä¸Žå­ç½‘æŽ©ç åˆ†åˆ«è¿›è¡ŒANDè¿ç®—ï¼ˆä¸¤ä¸ªæ•°ä½éƒ½ä¸º1ï¼Œè¿ç®—ç»“æžœä¸º1ï¼Œå¦åˆ™ä¸º0ï¼‰ï¼Œç„¶åŽæ¯”è¾ƒç»“æžœæ˜¯å¦ç›¸åŒï¼Œå¦‚æžœæ˜¯çš„è¯ï¼Œå°±è¡¨æ˜Žå®ƒä»¬åœ¨åŒä¸€ä¸ªå­ç½‘ç»œä¸­ï¼Œå¦åˆ™å°±ä¸æ˜¯ã€‚ æ¯”å¦‚ï¼Œå·²çŸ¥IPåœ°å€172.16.254.1å’Œ172.16.254.233çš„å­ç½‘æŽ©ç éƒ½æ˜¯255.255.255.0ï¼Œè¯·é—®å®ƒä»¬æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Ÿä¸¤è€…ä¸Žå­ç½‘æŽ©ç åˆ†åˆ«è¿›è¡ŒANDè¿ç®—ï¼Œç»“æžœéƒ½æ˜¯172.16.254.0ï¼Œå› æ­¤å®ƒä»¬åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ æ€»ç»“ä¸€ä¸‹ï¼ŒIPåè®®çš„ä½œç”¨ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ä¸ºæ¯ä¸€å°è®¡ç®—æœºåˆ†é…IPåœ°å€ï¼Œå¦ä¸€ä¸ªæ˜¯ç¡®å®šå“ªäº›åœ°å€åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ 3.2 IPæ•°æ®åŒ… æ ¹æ®IPåè®®å‘é€çš„æ•°æ®ï¼Œå°±å«åšIPæ•°æ®åŒ…ã€‚ä¸éš¾æƒ³è±¡ï¼Œå…¶ä¸­å¿…å®šåŒ…æ‹¬IPåœ°å€ä¿¡æ¯ã€‚ ä½†æ˜¯å‰é¢è¯´è¿‡ï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…åªåŒ…å«MACåœ°å€ï¼Œå¹¶æ²¡æœ‰IPåœ°å€çš„æ ä½ã€‚é‚£ä¹ˆæ˜¯å¦éœ€è¦ä¿®æ”¹æ•°æ®å®šä¹‰ï¼Œå†æ·»åŠ ä¸€ä¸ªæ ä½å‘¢ï¼Ÿ å›žç­”æ˜¯ä¸éœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠIPæ•°æ®åŒ…ç›´æŽ¥æ”¾è¿›ä»¥å¤ªç½‘æ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ï¼Œå› æ­¤å®Œå…¨ä¸ç”¨ä¿®æ”¹ä»¥å¤ªç½‘çš„è§„æ ¼ã€‚è¿™å°±æ˜¯äº’è”ç½‘åˆ†å±‚ç»“æž„çš„å¥½å¤„ï¼šä¸Šå±‚çš„å˜åŠ¨å®Œå…¨ä¸æ¶‰åŠä¸‹å±‚çš„ç»“æž„ã€‚ å…·ä½“æ¥è¯´ï¼ŒIPæ•°æ®åŒ…ä¹Ÿåˆ†ä¸º&quot;æ ‡å¤´&quot;å’Œ&quot;æ•°æ®&quot;ä¸¤ä¸ªéƒ¨åˆ†ã€‚&quot;æ ‡å¤´&quot;éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬ç‰ˆæœ¬ã€é•¿åº¦ã€IPåœ°å€ç­‰ä¿¡æ¯ï¼Œ&quot;æ•°æ®&quot;éƒ¨åˆ†åˆ™æ˜¯IPæ•°æ®åŒ…çš„å…·ä½“å†…å®¹ã€‚å®ƒæ”¾è¿›ä»¥å¤ªç½‘æ•°æ®åŒ…åŽï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…å°±å˜æˆäº†ä¸‹é¢è¿™æ ·ã€‚ IPæ•°æ®åŒ…çš„&quot;æ ‡å¤´&quot;éƒ¨åˆ†çš„é•¿åº¦ä¸º20ä¸ªå­—èŠ‚ï¼Œæ•´ä¸ªæ•°æ®åŒ…çš„æ€»é•¿åº¦æœ€å¤§ä¸º65,535å­—èŠ‚ã€‚å› æ­¤ï¼Œç†è®ºä¸Šï¼Œä¸€ä¸ªIPæ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ï¼Œæœ€é•¿ä¸º65,515å­—èŠ‚ã€‚å‰é¢è¯´è¿‡ï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ï¼Œæœ€é•¿åªæœ‰1500å­—èŠ‚ã€‚å› æ­¤ï¼Œå¦‚æžœIPæ•°æ®åŒ…è¶…è¿‡äº†1500å­—èŠ‚ï¼Œå®ƒå°±éœ€è¦åˆ†å‰²æˆå‡ ä¸ªä»¥å¤ªç½‘æ•°æ®åŒ…ï¼Œåˆ†å¼€å‘é€äº†ã€‚ 3.3 ARPåè®® å…³äºŽ&quot;ç½‘ç»œå±‚&quot;ï¼Œè¿˜æœ‰æœ€åŽä¸€ç‚¹éœ€è¦è¯´æ˜Žã€‚ å› ä¸ºIPæ•°æ®åŒ…æ˜¯æ”¾åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…é‡Œå‘é€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åŒæ—¶çŸ¥é“ä¸¤ä¸ªåœ°å€ï¼Œä¸€ä¸ªæ˜¯å¯¹æ–¹çš„MACåœ°å€ï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹æ–¹çš„IPåœ°å€ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹æ–¹çš„IPåœ°å€æ˜¯å·²çŸ¥çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å®ƒçš„MACåœ°å€ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿä»ŽIPåœ°å€å¾—åˆ°MACåœ°å€ã€‚ è¿™é‡Œåˆå¯ä»¥åˆ†æˆä¸¤ç§æƒ…å†µã€‚ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚æžœä¸¤å°ä¸»æœºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œé‚£ä¹ˆäº‹å®žä¸Šæ²¡æœ‰åŠžæ³•å¾—åˆ°å¯¹æ–¹çš„MACåœ°å€ï¼Œåªèƒ½æŠŠæ•°æ®åŒ…ä¼ é€åˆ°ä¸¤ä¸ªå­ç½‘ç»œè¿žæŽ¥å¤„çš„&quot;ç½‘å…³&quot;ï¼ˆgatewayï¼‰ï¼Œè®©ç½‘å…³åŽ»å¤„ç†ã€‚ ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æžœä¸¤å°ä¸»æœºåœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ARPåè®®ï¼Œå¾—åˆ°å¯¹æ–¹çš„MACåœ°å€ã€‚ARPåè®®ä¹Ÿæ˜¯å‘å‡ºä¸€ä¸ªæ•°æ®åŒ…ï¼ˆåŒ…å«åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…ä¸­ï¼‰ï¼Œå…¶ä¸­åŒ…å«å®ƒæ‰€è¦æŸ¥è¯¢ä¸»æœºçš„IPåœ°å€ï¼Œåœ¨å¯¹æ–¹çš„MACåœ°å€è¿™ä¸€æ ï¼Œå¡«çš„æ˜¯FF:FF:FF:FF:FF:FFï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª&quot;å¹¿æ’­&quot;åœ°å€ã€‚å®ƒæ‰€åœ¨å­ç½‘ç»œçš„æ¯ä¸€å°ä¸»æœºï¼Œéƒ½ä¼šæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œä»Žä¸­å–å‡ºIPåœ°å€ï¼Œä¸Žè‡ªèº«çš„IPåœ°å€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æžœä¸¤è€…ç›¸åŒï¼Œéƒ½åšå‡ºå›žå¤ï¼Œå‘å¯¹æ–¹æŠ¥å‘Šè‡ªå·±çš„MACåœ°å€ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚ æ€»ä¹‹ï¼Œæœ‰äº†ARPåè®®ä¹‹åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°åŒä¸€ä¸ªå­ç½‘ç»œå†…çš„ä¸»æœºMACåœ°å€ï¼Œå¯ä»¥æŠŠæ•°æ®åŒ…å‘é€åˆ°ä»»æ„ä¸€å°ä¸»æœºä¹‹ä¸Šäº†ã€‚ 4. ä¼ è¾“å±‚ æœ‰äº†MACåœ°å€å’ŒIPåœ°å€ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åœ¨äº’è”ç½‘ä¸Šä»»æ„ä¸¤å°ä¸»æœºä¸Šå»ºç«‹é€šä¿¡ã€‚ æŽ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼ŒåŒä¸€å°ä¸»æœºä¸Šæœ‰è®¸å¤šç¨‹åºéƒ½éœ€è¦ç”¨åˆ°ç½‘ç»œï¼Œæ¯”å¦‚ï¼Œä½ ä¸€è¾¹æµè§ˆç½‘é¡µï¼Œä¸€è¾¹ä¸Žæœ‹å‹åœ¨çº¿èŠå¤©ã€‚å½“ä¸€ä¸ªæ•°æ®åŒ…ä»Žäº’è”ç½‘ä¸Šå‘æ¥çš„æ—¶å€™ï¼Œä½ æ€Žä¹ˆçŸ¥é“ï¼Œå®ƒæ˜¯è¡¨ç¤ºç½‘é¡µçš„å†…å®¹ï¼Œè¿˜æ˜¯è¡¨ç¤ºåœ¨çº¿èŠå¤©çš„å†…å®¹ï¼Ÿ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°æ®åŒ…åˆ°åº•ä¾›å“ªä¸ªç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ä½¿ç”¨ã€‚è¿™ä¸ªå‚æ•°å°±å«åš&quot;ç«¯å£&quot;ï¼ˆportï¼‰ï¼Œå®ƒå…¶å®žæ˜¯æ¯ä¸€ä¸ªä½¿ç”¨ç½‘å¡çš„ç¨‹åºçš„ç¼–å·ã€‚æ¯ä¸ªæ•°æ®åŒ…éƒ½å‘åˆ°ä¸»æœºçš„ç‰¹å®šç«¯å£ï¼Œæ‰€ä»¥ä¸åŒçš„ç¨‹åºå°±èƒ½å–åˆ°è‡ªå·±æ‰€éœ€è¦çš„æ•°æ®ã€‚ &quot;ç«¯å£&quot;æ˜¯0åˆ°65535ä¹‹é—´çš„ä¸€ä¸ªæ•´æ•°ï¼Œæ­£å¥½16ä¸ªäºŒè¿›åˆ¶ä½ã€‚0åˆ°1023çš„ç«¯å£è¢«ç³»ç»Ÿå ç”¨ï¼Œç”¨æˆ·åªèƒ½é€‰ç”¨å¤§äºŽ1023çš„ç«¯å£ã€‚ä¸ç®¡æ˜¯æµè§ˆç½‘é¡µè¿˜æ˜¯åœ¨çº¿èŠå¤©ï¼Œåº”ç”¨ç¨‹åºä¼šéšæœºé€‰ç”¨ä¸€ä¸ªç«¯å£ï¼Œç„¶åŽä¸ŽæœåŠ¡å™¨çš„ç›¸åº”ç«¯å£è”ç³»ã€‚ &quot;ä¼ è¾“å±‚&quot;çš„åŠŸèƒ½ï¼Œå°±æ˜¯å»ºç«‹&quot;ç«¯å£åˆ°ç«¯å£&quot;çš„é€šä¿¡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œâ€œç½‘ç»œå±‚&quot;çš„åŠŸèƒ½æ˜¯å»ºç«‹&quot;ä¸»æœºåˆ°ä¸»æœº&quot;çš„é€šä¿¡ã€‚åªè¦ç¡®å®šä¸»æœºå’Œç«¯å£ï¼Œæˆ‘ä»¬å°±èƒ½å®žçŽ°ç¨‹åºä¹‹é—´çš„äº¤æµã€‚å› æ­¤ï¼ŒUnixç³»ç»Ÿå°±æŠŠä¸»æœº+ç«¯å£ï¼Œå«åš&quot;å¥—æŽ¥å­—â€ï¼ˆsocketï¼‰ã€‚æœ‰äº†å®ƒï¼Œå°±å¯ä»¥è¿›è¡Œç½‘ç»œåº”ç”¨ç¨‹åºå¼€å‘äº†ã€‚ 4.1 UDPåè®® çŽ°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®åŒ…ä¸­åŠ å…¥ç«¯å£ä¿¡æ¯ï¼Œè¿™å°±éœ€è¦æ–°çš„åè®®ã€‚æœ€ç®€å•çš„å®žçŽ°å«åšUDPåè®®ï¼Œå®ƒçš„æ ¼å¼å‡ ä¹Žå°±æ˜¯åœ¨æ•°æ®å‰é¢ï¼ŒåŠ ä¸Šç«¯å£å·ã€‚ UDPæ•°æ®åŒ…ï¼Œä¹Ÿæ˜¯ç”±&quot;æ ‡å¤´&quot;å’Œ&quot;æ•°æ®&quot;ä¸¤éƒ¨åˆ†ç»„æˆã€‚ &quot;æ ‡å¤´&quot;éƒ¨åˆ†ä¸»è¦å®šä¹‰äº†å‘å‡ºç«¯å£å’ŒæŽ¥æ”¶ç«¯å£ï¼Œ&quot;æ•°æ®&quot;éƒ¨åˆ†å°±æ˜¯å…·ä½“çš„å†…å®¹ã€‚ç„¶åŽï¼ŒæŠŠæ•´ä¸ªUDPæ•°æ®åŒ…æ”¾å…¥IPæ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ï¼Œè€Œå‰é¢è¯´è¿‡ï¼ŒIPæ•°æ®åŒ…åˆæ˜¯æ”¾åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…ä¹‹ä¸­çš„ï¼Œæ‰€ä»¥æ•´ä¸ªä»¥å¤ªç½‘æ•°æ®åŒ…çŽ°åœ¨å˜æˆäº†ä¸‹é¢è¿™æ ·ï¼š UDPæ•°æ®åŒ…éžå¸¸ç®€å•ï¼Œ&quot;æ ‡å¤´&quot;éƒ¨åˆ†ä¸€å…±åªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ€»é•¿åº¦ä¸è¶…è¿‡65,535å­—èŠ‚ï¼Œæ­£å¥½æ”¾è¿›ä¸€ä¸ªIPæ•°æ®åŒ…ã€‚ 4.2 TCPåè®® UDPåè®®çš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒç®€å•ï¼Œå®¹æ˜“å®žçŽ°ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å¯é æ€§è¾ƒå·®ï¼Œä¸€æ—¦æ•°æ®åŒ…å‘å‡ºï¼Œæ— æ³•çŸ¥é“å¯¹æ–¹æ˜¯å¦æ”¶åˆ°ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæé«˜ç½‘ç»œå¯é æ€§ï¼ŒTCPåè®®å°±è¯žç”Ÿäº†ã€‚è¿™ä¸ªåè®®éžå¸¸å¤æ‚ï¼Œä½†å¯ä»¥è¿‘ä¼¼è®¤ä¸ºï¼Œå®ƒå°±æ˜¯æœ‰ç¡®è®¤æœºåˆ¶çš„UDPåè®®ï¼Œæ¯å‘å‡ºä¸€ä¸ªæ•°æ®åŒ…éƒ½è¦æ±‚ç¡®è®¤ã€‚å¦‚æžœæœ‰ä¸€ä¸ªæ•°æ®åŒ…é—å¤±ï¼Œå°±æ”¶ä¸åˆ°ç¡®è®¤ï¼Œå‘å‡ºæ–¹å°±çŸ¥é“æœ‰å¿…è¦é‡å‘è¿™ä¸ªæ•°æ®åŒ…äº†ã€‚ å› æ­¤ï¼ŒTCPåè®®èƒ½å¤Ÿç¡®ä¿æ•°æ®ä¸ä¼šé—å¤±ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯è¿‡ç¨‹å¤æ‚ã€å®žçŽ°å›°éš¾ã€æ¶ˆè€—è¾ƒå¤šçš„èµ„æºã€‚ TCPæ•°æ®åŒ…å’ŒUDPæ•°æ®åŒ…ä¸€æ ·ï¼Œéƒ½æ˜¯å†…åµŒåœ¨IPæ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ã€‚TCPæ•°æ®åŒ…æ²¡æœ‰é•¿åº¦é™åˆ¶ï¼Œç†è®ºä¸Šå¯ä»¥æ— é™é•¿ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯ç½‘ç»œçš„æ•ˆçŽ‡ï¼Œé€šå¸¸TCPæ•°æ®åŒ…çš„é•¿åº¦ä¸ä¼šè¶…è¿‡IPæ•°æ®åŒ…çš„é•¿åº¦ï¼Œä»¥ç¡®ä¿å•ä¸ªTCPæ•°æ®åŒ…ä¸å¿…å†åˆ†å‰²ã€‚ å…³äºŽTCPç»†èŠ‚ä»¥åŽå†æŽ¢è®¨ã€‚ 5. åº”ç”¨å±‚ åº”ç”¨ç¨‹åºæ”¶åˆ°&quot;ä¼ è¾“å±‚&quot;çš„æ•°æ®ï¼ŒæŽ¥ä¸‹æ¥å°±è¦è¿›è¡Œè§£è¯»ã€‚ç”±äºŽäº’è”ç½‘æ˜¯å¼€æ”¾æž¶æž„ï¼Œæ•°æ®æ¥æºäº”èŠ±å…«é—¨ï¼Œå¿…é¡»äº‹å…ˆè§„å®šå¥½æ ¼å¼ï¼Œå¦åˆ™æ ¹æœ¬æ— æ³•è§£è¯»ã€‚ &quot;åº”ç”¨å±‚&quot;çš„ä½œç”¨ï¼Œå°±æ˜¯è§„å®šåº”ç”¨ç¨‹åºçš„æ•°æ®æ ¼å¼ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒTCPåè®®å¯ä»¥ä¸ºå„ç§å„æ ·çš„ç¨‹åºä¼ é€’æ•°æ®ï¼Œæ¯”å¦‚Emailã€WWWã€FTPç­‰ç­‰ã€‚é‚£ä¹ˆï¼Œå¿…é¡»æœ‰ä¸åŒåè®®è§„å®šç”µå­é‚®ä»¶ã€ç½‘é¡µã€FTPæ•°æ®çš„æ ¼å¼ï¼Œè¿™äº›åº”ç”¨ç¨‹åºåè®®å°±æž„æˆäº†&quot;åº”ç”¨å±‚&quot;ã€‚ è¿™æ˜¯æœ€é«˜çš„ä¸€å±‚ï¼Œç›´æŽ¥é¢å¯¹ç”¨æˆ·ã€‚å®ƒçš„æ•°æ®å°±æ”¾åœ¨TCPæ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒçŽ°åœ¨çš„ä»¥å¤ªç½‘çš„æ•°æ®åŒ…å°±å˜æˆä¸‹é¢è¿™æ ·ã€‚ *æ³¨ï¼šUDPå¤´ä¸º8ä¸ªå­—èŠ‚ï¼ŒTCPå¤´ä¸º20ä¸ªå­—èŠ‚ æ•´ç†äºŽï¼šhttp://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
</search>
