<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Zookeeperç¬”è®°7-ZKçš„åŸºæœ¬æ“ä½œä»¥åŠæƒé™æŽ§åˆ¶]]></title>
    <url>%2F2019%2F02%2F23%2Fzookeeper%2FZookeeper%E7%AC%94%E8%AE%B07-ZK%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E4%BB%A5%E5%8F%8A%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%2F</url>
    <content type="text"><![CDATA[è¯´äº†é‚£ä¹ˆä¹…çš„ç†è®ºï¼Œä½†æ˜¯å…¶å®žå¯¹äºŽå¤§å¤šæ•°äººæ¥è¯´ï¼Œä¼šç”¨æ‰æ˜¯çŽ‹é“ï¼Œåœ¨ä¼šç”¨çš„åŸºç¡€ä¸Šå†åŽ»æ·±å…¥æŽ¢è®¨åŽŸç†å¯èƒ½æ˜¯æœ€ä½³çš„å®žè·µæ–¹å¼ï¼Œä½†æ˜¯å¯¹äºŽç¬”è®°æ¥è¯´ï¼Œå…ˆåŽŸç†å†å®žè·µå¯èƒ½æ›´ä¸ºç¨³å¦¥ï¼Œæœ¬æ–‡ä»‹ç»zkæœ€åŸºæœ¬çš„ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚æŸ¥çœ‹èŠ‚ç‚¹ã€å¢žåŠ ä¸€ä¸ªèŠ‚ç‚¹ã€Watchæœºåˆ¶ä»¥åŠACLæƒé™æŽ§åˆ¶ç­‰åŸºæœ¬å‘½ä»¤ï¼Œæœ€åŽè¿˜ä»‹ç»äº†ä¸€ä¸‹ä¸ºäº†æ–¹ä¾¿è€Œäº§ç”Ÿçš„å››å­—å‘½ä»¤ã€‚ åŸºæœ¬æ•°æ®æ¨¡åž‹ æ ‘å½¢ç»“æž„ï¼Œæ¯ä¸ªèŠ‚ç‚¹æˆä¸ºznodeï¼Œå®ƒå¯ä»¥æœ‰å­èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æœ‰æ•°æ® ä¸´æ—¶èŠ‚ç‚¹å’Œæ°¸ä¹…èŠ‚ç‚¹ï¼Œä¸´æ—¶èŠ‚ç‚¹åœ¨å®¢æˆ·ç«¯æ–­å¼€åŽæ¶ˆå¤± æ¯ä¸ªzkèŠ‚ç‚¹éƒ½æœ‰å„è‡ªçš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥æ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯ æ¯å½“èŠ‚ç‚¹æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ä¼šç´¯åŠ ï¼ˆä¹è§‚é”ï¼‰ åˆ é™¤/ä¿®æ”¹è¿‡æ—¶èŠ‚ç‚¹ï¼Œç‰ˆæœ¬å·ä¸åŒ¹é…åˆ™ä¼šæŠ¥é”™ æ¯ä¸ªzkèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®ä¸å®œè¿‡å¤§ï¼Œå‡ kå³å¯ èŠ‚ç‚¹å¯ä»¥è®¾ç½®aclï¼Œå¯ä»¥é€šè¿‡æƒé™æ¥é™åˆ¶ç”¨æˆ·çš„è®¿é—® zkçš„ä½œç”¨ masteré€‰ä¸¾ï¼Œä¿è¯é›†ç¾¤æ˜¯é«˜å¯ç”¨çš„ ç»Ÿä¸€é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œå³åªéœ€è¦éƒ¨ç½²ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥æŠŠç›¸åŒçš„é…ç½®æ–‡ä»¶åŒæ­¥æ›´æ–°åˆ°å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨ å‘å¸ƒä¸Žè®¢é˜…ï¼Œdubboå‘å¸ƒè€…æŠŠæ•°æ®å­˜åœ¨znodeä¸Šï¼Œè®¢é˜…è€…å¯ä»¥è¯»å–è¿™ä¸ªæ•°æ® åˆ†å¸ƒå¼é” é›†ç¾¤ç®¡ç†ï¼Œé›†ç¾¤ä¸­ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ zkçš„åŸºæœ¬æ“ä½œ ls / æ˜¾ç¤ºæ ¹èŠ‚ç‚¹åç§° ls2 / æ˜¾ç¤ºäº†æ ¹èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ï¼ˆstatä¹Ÿå¯ä»¥çœ‹çŠ¶æ€ï¼‰ get / æ‹¿å‡ºèŠ‚ç‚¹çš„æ•°æ®å’Œä¿¡æ¯ create [-s] [-e] path data acl åˆ›å»ºèŠ‚ç‚¹ï¼Œå¦‚æžœæ˜¯é»˜è®¤åˆ›å»ºï¼Œåˆ™æ˜¯éžé¡ºåºçš„ã€ æŒä¹…çš„èŠ‚ç‚¹ã€‚åŠ ä¸Š-eåˆ™æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼›åŠ ä¸Š-sè¡¨ç¤ºé¡ºåºèŠ‚ç‚¹ ã€æ³¨1ã€‘ï¼šå¦‚æžœæ˜¯æŒä¹…èŠ‚ç‚¹ï¼ŒçŠ¶æ€ä¿¡æ¯ä¸­çš„ephemeralOwner=0x0ï¼›ä¸´æ—¶èŠ‚ç‚¹çš„è¿™ä¸ªå±žæ€§ï¼Œæ˜¯åŽé¢ä¸€ä¸²æ¯”è¾ƒé•¿çš„å­—ç¬¦ ã€æ³¨2ã€‘ï¼šå®¢æˆ·ç«¯æ–­å¼€è¿žæŽ¥äº†ï¼Œä¸€æ®µæ—¶é—´ä¹‹åŽï¼Œé‚£ä¹ˆä¸´æ—¶èŠ‚ç‚¹å°±ä¼šæ¶ˆå¤±ï¼ˆä¸»è¦æ˜¯æœ‰ä¸ªæ—¶æ•ˆï¼Œè¶…å‡ºè¿™ä¸ªæ—¶é—´è¿˜ä¸æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„å¿ƒè·³åŒ…åˆ™æ‰è®¤å®šå®¢æˆ·ç«¯æŒ‚äº†ï¼‰ ã€æ³¨3ã€‘ï¼šåœ¨åŠ ä¸Š-såŽï¼Œåˆ›å»ºçš„èŠ‚ç‚¹ä¼šé‡å‘½åä¸ºä¸€ä¸ªç´¯åŠ çš„åç§° set path newData æ¯æ¬¡ä¿®æ”¹å€¼åŽdataVersionæ•°æ®ç‰ˆæœ¬å·ä¼šå¢ž1 ã€æ³¨4ã€‘ï¼šå¦‚ä½•å®žçŽ°ä¹è§‚é”ï¼Ÿset path data version,å°±æ˜¯è¯´å¸¦ä¸Šç‰ˆæœ¬å·ï¼Œå¦‚æžœè¿™ä¸ªç‰ˆæœ¬ä¸å¯¹åº”ï¼Œé‚£ä¹ˆå°±ä¿®æ”¹å¤±è´¥ delete path version åˆ é™¤èŠ‚ç‚¹ watcheræœºåˆ¶ é’ˆå¯¹æ¯ä¸ªèŠ‚ç‚¹çš„æ“ä½œï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç›‘ç£è€…watcher å½“ç›‘æŽ§çš„æŸä¸ªå¯¹è±¡(znode)å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è§¦å‘watcheräº‹ä»¶ zkä¸­watcheræ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè§¦å‘åŽç«‹å³é”€æ¯ï¼ˆç”¨å…¶ä»–çš„å¼€æºå®¢æˆ·ç«¯å¼€æºè®©å…¶ä¸ä¼šé”€æ¯ï¼Œé‡å¤è§¦å‘ï¼‰ çˆ¶èŠ‚ç‚¹ä»¥åŠä»–çš„å­å­™ä»¬çš„ å¢ž åˆ  æ”¹ éƒ½èƒ½å¤Ÿè§¦å‘å…¶watcher é’ˆå¯¹ä¸åŒç±»åž‹çš„äº‹ä»¶ï¼Œè§¦å‘çš„watcheräº‹ä»¶ä¹Ÿä¸åŒï¼š ï¼ˆå­ï¼‰èŠ‚ç‚¹åˆ›å»ºäº‹ä»¶ ï¼ˆå­ï¼‰èŠ‚ç‚¹åˆ é™¤äº‹ä»¶ ï¼ˆå­ï¼‰èŠ‚ç‚¹æ•°æ®å˜åŒ–äº‹ä»¶ é€šè¿‡get path [watch]æˆ–è€…stat path [watch]æˆ–è€…ls path [watch]éƒ½å¯ä»¥è®¾ç½®watcher çˆ¶èŠ‚ç‚¹ å¢ž åˆ  æ”¹ æ“ä½œè§¦å‘watcher å­èŠ‚ç‚¹ å¢ž åˆ  æ”¹ æ“ä½œè§¦å‘watcher ã€åˆ›å»ºçˆ¶èŠ‚ç‚¹è§¦å‘ã€‘ï¼šNodeCreated 12345678[zk: localhost:2181(CONNECTED) 24] stat /hello watch Node does not exist: /hello[zk: localhost:2181(CONNECTED) 25] create /hello worldWATCHER::Created /helloWatchedEvent state:SyncConnected type:NodeCreated path:/hello ã€ä¿®æ”¹çˆ¶èŠ‚ç‚¹æ•°æ®è§¦å‘ã€‘ï¼šNodeDataChanged 12345678910[zk: localhost:2181(CONNECTED) 26] stat /hello watch[zk: localhost:2181(CONNECTED) 27] get /helloworld[zk: localhost:2181(CONNECTED) 28] set /hello lalalaWATCHER::cZxid = 0x300000011WatchedEvent state:SyncConnected type:NodeDataChanged path:/helloctime = Sat Dec 08 20:00:53 CST 2018 ã€åˆ é™¤çˆ¶èŠ‚ç‚¹è§¦å‘ã€‘ï¼šNodeDeleted 1234567[zk: localhost:2181(CONNECTED) 32] get /hello watch[zk: localhost:2181(CONNECTED) 33] delete /helloWATCHER::[zk: localhost:2181(CONNECTED) 34]WatchedEvent state:SyncConnected type:NodeDeleted path:/hello ã€åˆ›å»ºå­èŠ‚ç‚¹è§¦å‘ã€‘ï¼šlsä¸ºçˆ¶èŠ‚ç‚¹è®¾ç½®watcherï¼Œåˆ›å»ºå­èŠ‚ç‚¹è§¦å‘NodeChildrenChanged 123456789101112[zk: localhost:2181(CONNECTED) 52] ls /[zookeeper][zk: localhost:2181(CONNECTED) 53] create /hello worldCreated /hello[zk: localhost:2181(CONNECTED) 54] ls /hello watch[][zk: localhost:2181(CONNECTED) 55] create /hello/helloson worldsonWATCHER::Created /hello/hellosonWatchedEvent state:SyncConnected type:NodeChildrenChanged path:/hello ã€åˆ é™¤å­èŠ‚ç‚¹è§¦å‘ã€‘ï¼šlsä¸ºçˆ¶èŠ‚ç‚¹è®¾ç½®watcherï¼Œåˆ é™¤å­èŠ‚ç‚¹è§¦å‘NodeChildrenChanged 123456789[zk: localhost:2181(CONNECTED) 56] ls /hello[helloson][zk: localhost:2181(CONNECTED) 57] ls /hello watch[helloson][zk: localhost:2181(CONNECTED) 58] delete /hello/hellosonWATCHER::[zk: localhost:2181(CONNECTED) 59]WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/hello ã€æ›´æ–°å­èŠ‚ç‚¹è§¦å‘ã€‘ï¼šlsä¸ºçˆ¶èŠ‚ç‚¹è®¾ç½®watcherï¼Œæ›´æ–°å­èŠ‚ç‚¹ä¸è§¦å‘äº‹ä»¶ 1234567891011121314151617181920[zk: localhost:2181(CONNECTED) 59] ls /hello[][zk: localhost:2181(CONNECTED) 60] create /hello/helloson worldsonCreated /hello/helloson[zk: localhost:2181(CONNECTED) 61] ls /hello watch [helloson][zk: localhost:2181(CONNECTED) 62] set /hello/helloson worldsonhahahacZxid = 0x300000020ctime = Sat Dec 08 20:15:05 CST 2018mZxid = 0x300000021mtime = Sat Dec 08 20:16:06 CST 2018pZxid = 0x300000020cversion = 0dataVersion = 1aclVersion = 0ephemeralOwner = 0x0dataLength = 14numChildren = 0[zk: localhost:2181(CONNECTED) 63] get /hello/hellosonworldsonhahaha å°±ç®—æ˜¯è®¾ç½®æˆls /hello/helloson watchä¹Ÿä¸è¡Œã€‚åªæœ‰è¿™æ ·æ‰å¯ä»¥è§¦å‘watcher: 123456789[zk: localhost:2181(CONNECTED) 72] get /swg/swgson watch8080[zk: localhost:2181(CONNECTED) 74] set /swg/swgson 7070WATCHER::cZxid = 0x300000024WatchedEvent state:SyncConnected type:NodeDataChanged path:/swg/swgsonctime = Sat Dec 08 20:18:53 CST 2018 ä¸ºä»€ä¹ˆæ›´æ–°å­èŠ‚ç‚¹çš„æ—¶å€™lsä¸è¡Œï¼Œä½†æ˜¯getå°±è¡Œå‘¢ï¼Ÿå®¢æˆ·ç«¯è¦æƒ³æ”¶åˆ°æ›´æ–°å­èŠ‚ç‚¹å†…å®¹çš„æ¶ˆæ¯çš„è¯ï¼Œä¸èƒ½é€šè¿‡å­èŠ‚ç‚¹çš„äº‹ä»¶æ¥è§¦å‘ï¼Œå¿…é¡»æŠŠå­èŠ‚ç‚¹å½“ä½œçˆ¶èŠ‚ç‚¹æ¥åšã€‚ç„¶è€Œls path [watch] ï¼šæŸ¥è¯¢æŒ‡å®šè·¯å¾„ä¸‹çš„å­èŠ‚ç‚¹æ‰€ä»¥æ˜¯é’ˆå¯¹çš„å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸èƒ½è§¦å‘è¿™ä¸ªäº‹ä»¶ï¼›è€Œget path [watch] : æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹ä¸­çš„æ•°æ®ï¼Œå¦‚æžœèŠ‚ç‚¹ä¸­æœ‰æ•°æ®æˆ–è€…stat path [watch] : æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹çš„ä¸€äº›æè¿°ä¿¡æ¯è¿™äº›ç›´æŽ¥æ˜¯æ“ä½œè¿™ä¸ªèŠ‚ç‚¹ï¼ŒæŠŠè¿™ä¸ªèŠ‚ç‚¹å½“ä½œæ˜¯çˆ¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥èƒ½èµ·ä½œç”¨ã€‚ watcherä½¿ç”¨åœºæ™¯ Watcheræ˜¯ZKä¸­å¾ˆé‡è¦çš„ç‰¹æ€§ï¼ŒZKå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº›Watcherï¼Œåœ¨è¯¥èŠ‚ç‚¹ç›¸å…³ç‰¹å®šäº‹ä»¶ï¼ˆæ¯”å¦‚èŠ‚ç‚¹æ·»åŠ ã€åˆ é™¤ã€å­èŠ‚ç‚¹å˜æ›´ç­‰ï¼‰å‘ç”Ÿæ—¶Watcherä¼šç›‘å¬åˆ°ï¼ŒZKæœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸ŠåŽ»ï¼Œè¯¥æœºåˆ¶æ˜¯ZKå®žçŽ°åˆ†å¸ƒå¼åè°ƒæœåŠ¡çš„é‡è¦ç‰¹æ€§ã€‚ é€šçŸ¥çš„æ—¶å€™æœåŠ¡ç«¯åªä¼šå‘Šè¯‰å®¢æˆ·ç«¯ä¸€ä¸ªç®€å•çš„äº‹ä»¶ï¼ˆé€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»åž‹ã€èŠ‚ç‚¹è·¯å¾„ï¼‰è€Œä¸åŒ…å«å…·ä½“çš„å˜åŒ–ä¿¡æ¯ï¼ˆå¦‚åŽŸå§‹æ•°æ®åŠå˜æ›´åŽçš„æ•°æ®ï¼‰ï¼Œå®¢æˆ·ç«¯å¦‚è¦å…·ä½“ä¿¡æ¯å†æ¬¡ä¸»åŠ¨åŽ»é‡æ–°èŽ·å–æ•°æ®ï¼›æ­¤å¤–ï¼Œæ— è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œåªè¦Watcherè¢«è§¦å‘ZKå°±ä¼šå°†å…¶åˆ é™¤ï¼Œå› æ­¤åœ¨Watcherçš„ä½¿ç”¨ä¸Šéœ€è¦åå¤æ³¨å†Œï¼Œè¿™æ ·è½»é‡çš„è®¾è®¡æœ‰æ•ˆå‡è½»äº†æœåŠ¡ç«¯åŽ‹åŠ›ï¼Œå¦‚æžœWatcherä¸€ç›´æœ‰æ•ˆï¼ŒèŠ‚ç‚¹æ›´æ–°é¢‘ç¹æ—¶æœåŠ¡ç«¯ä¼šä¸æ–­å‘å®¢æˆ·ç«¯å‘é€é€šçŸ¥ï¼Œå¯¹ç½‘ç»œåŠæœåŠ¡ç«¯æ€§èƒ½å½±å“ä¼šéžå¸¸å¤§ã€‚ æ¯”å¦‚ç»Ÿä¸€èµ„æºé…ç½®ã€‚ ACL æƒé™æŽ§åˆ¶åˆ—è¡¨ é’ˆå¯¹èŠ‚ç‚¹å¯ä»¥è®¾ç½®ç›¸å…³è¯»å†™ç­‰æƒé™ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿éšœæ•°æ®å®‰å…¨æ€§ æƒé™permissionså¯ä»¥æŒ‡å®šä¸åŒçš„æƒé™èŒƒå›´ä»¥åŠè§’è‰² getAclï¼šèŽ·å–æŸä¸ªèŠ‚ç‚¹çš„aclæƒé™ä¿¡æ¯ setAclï¼šè®¾ç½®æŸä¸ªèŠ‚ç‚¹çš„aclæƒé™ä¿¡æ¯ addauthï¼šæ³¨å†ŒæŸä¸ªç”¨æˆ·ï¼Œè¦æŠŠæŸä¸ªç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç è¾“å…¥åˆ°ç³»ç»Ÿä¸­è¿›è¡Œæ³¨å†Œï¼Œç”¨æˆ·æ‰èƒ½ç™»é™†ã€‚ é»˜è®¤æƒé™ï¼š 123[zk: localhost:2181(CONNECTED) 76] getAcl /swg&apos;world,&apos;anyone: cdrwa ACLæž„æˆï¼šzkçš„aclé€šè¿‡[schemeðŸ†”permissions]æ¥æž„æˆæƒé™åˆ—è¡¨ï¼Œå…¶ä¸­schemeæŒ‡é‡‡ç”¨çš„æŸç§æƒé™æœºåˆ¶ï¼›idæŒ‡å…è®¸è®¿é—®çš„ç”¨æˆ·ï¼›permissionsæŒ‡æƒé™ç»„åˆå­—ç¬¦ä¸² schemeï¼šä¸»è¦æ˜¯å››ç§ worldï¼šworldä¸‹åªæœ‰ä¸€ä¸ªidï¼Œå³åªæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯anyoneï¼Œé‚£ä¹ˆç»„åˆçš„å†™æ³•å°±æ˜¯world:anyone:[permissions] authï¼šä»£è¡¨è®¤è¯ç™»é™†ï¼Œéœ€è¦æ³¨å†Œç”¨æˆ·æœ‰æƒé™å°±å¯ä»¥ï¼Œå½¢å¼ä¸ºauth:user:password:[permissions],å¯†ç æ˜¯æ˜Žæ–‡ degestï¼šéœ€è¦å¯¹å¯†ç åŠ å¯†æ‰èƒ½è®¿é—®ï¼Œç»„åˆå½¢å¼ä¸ºdigest:username:BASE64(SHA(password)):[permissions]ï¼Œå¯†ç æ˜¯åŠ å¯†çš„ ipï¼šå½“è®¾ç½®ä¸ºipæŒ‡å®šçš„ipåœ°å€ï¼Œæ­¤æ—¶é™åˆ¶ipè¿›è¡Œè®¿é—®ï¼Œæ¯”å¦‚ip:192.168.1.1:[permissions] superï¼šä»£è¡¨è¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ idï¼šä»£è¡¨å…è®¸è®¿é—®çš„ç”¨æˆ· permissionsï¼š cï¼šcreate,åˆ›å»ºå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æƒé™ rï¼šread,èŽ·å–å½“å‰èŠ‚ç‚¹æˆ–è€…å­èŠ‚ç‚¹åˆ—è¡¨ wï¼šwrite,è®¾ç½®å½“å‰èŠ‚ç‚¹çš„æ•°æ® dï¼šdeleteï¼Œåˆ é™¤å­èŠ‚ç‚¹ aï¼šadminï¼Œæ˜¯æ¯”è¾ƒé«˜çš„æƒé™ï¼Œå¯ä»¥åŽ»è®¾ç½®å’Œä¿®æ”¹æƒé™ï¼Œå³æ‹¥æœ‰åˆ†é…æƒé™çš„æƒé™ world:anyone:cdrwaï¼šå¯¹äºŽé»˜è®¤æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä»–çš„æƒé™å­—ç¬¦ä¸²ï¼Œå¦‚setAcl path world:anyone:crwa authå’Œdigestï¼šå…ˆaddauth digest username:passwordï¼ˆæ˜Žæ–‡å¯†ç ï¼‰æ³¨å†Œç”¨æˆ·,ç„¶åŽsetAcl path auth:username:passwordï¼ˆæ˜Žæ–‡å¯†ç ï¼‰:cdrwaå°±å¯ä»¥è®¾ç½®ACLäº†ã€‚å†åŽ»getAcl pathæŸ¥è¯¢åˆ°çš„å¯†ç æ—¶åŠ å¯†åŽçš„ã€‚ digestï¼šè¦å…ˆé€€å‡ºåˆšæ‰çš„authçš„è´¦å·ï¼Œç›´æŽ¥é‡å¯å½“å‰å®¢æˆ·ç«¯å³å¯ã€‚setAcl path digest:username:passwordï¼ˆå¯†æ–‡å¯†ç ï¼‰:cdrwaã€‚å†åŽ»getAcl pathæŸ¥è¯¢åˆ°çš„å¯†ç æ—¶åŠ å¯†åŽçš„ã€‚æ­¤æ—¶è®¿é—®ã€åˆ é™¤ã€åˆ›å»ºèŠ‚ç‚¹æ¯”å¦‚get pathæ˜¯éœ€è¦ç™»é™†çš„ï¼Œå³å…ˆaddauth digest username:passwordï¼ˆæ˜Žæ–‡å¯†ç ï¼‰ç™»é™†ã€‚ ipï¼šsetAcl path ip:192.168.1.1:cdrwa superï¼šæœ€é«˜æƒé™ï¼Œä¿®æ”¹zkServer.shå¢žåŠ superç®¡ç†å‘˜ï¼Œé‡å¯zkServer.shã€‚åˆ°binç›®å½•ä¸‹ä¿®æ”¹zkServer.shå¢žåŠ é…ç½®ï¼š æ‰¾åˆ°è¿™ä¸€è¡Œï¼š 1nohup $JAVA &quot;-Dzookeeper.log.dir=$&#123;ZOO_LOG_DIR&#125;&quot; &quot;-Dzookeeper.root.logger=$&#123;ZOO_LOG4J_PROP&#125;&quot; åœ¨åŽé¢ç»§ç»­æ·»åŠ ï¼š 1&quot;-Dzookeeper.DigestAuthenticationProvider.superDigest=username:xQJmxLMiHGwaqBvst5y6rkB6HQs=&quot; ACLå¸¸ç”¨ä½¿ç”¨åœºæ™¯ å¼€å‘/æµ‹è¯•çŽ¯å¢ƒåˆ†ç¦»ï¼Œå¼€å‘è€…æ— æƒé™æ“ä½œæµ‹è¯•åº“çš„èŠ‚ç‚¹ï¼Œåªèƒ½çœ‹ã€‚æ¯”å¦‚åˆ†ä¸ºå¼€å‘èŠ‚ç‚¹å’Œæµ‹è¯•èŠ‚ç‚¹ã€‚ ç”Ÿäº§çŽ¯å¢ƒä¸ŠæŽ§åˆ¶æŒ‡å®šipçš„æœåŠ¡å¯ä»¥è®¿é—®ç›¸å…³èŠ‚ç‚¹é˜²æ­¢æ··ä¹± zkå››å­—å‘½ä»¤ zkå¯ä»¥é€šè¿‡å®ƒè‡ªèº«æä¾›çš„ç®€å†™å‘½ä»¤æ¥å’ŒæœåŠ¡å™¨è¿›è¡Œäº¤äº’ éœ€è¦ä½¿ç”¨åˆ° nc å‘½ä»¤ï¼Œyum install nc echo [command] | nc [ip] [port] ã€statã€‘æŸ¥çœ‹zkçš„çŠ¶æ€ä¿¡æ¯ï¼Œä»¥åŠæ˜¯å•æœºè¿˜æ˜¯é›†ç¾¤çŠ¶æ€ï¼šecho stat | nc ipæˆ–è€…localhost 2181 ã€ruokã€‘æŸ¥çœ‹å½“å‰zkServeræ˜¯å¦å¯åŠ¨ï¼Œæ­£å¸¸è¿”å›žimokï¼šecho ruok | nc ip 2181 ã€dumpã€‘åˆ—å‡ºæœªç»å¤„ç†çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ï¼šecho dump | nc ip 2181 ã€confã€‘æŸ¥çœ‹æœåŠ¡é…ç½® ã€consã€‘å±•ç¤ºè¿žæŽ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ä¿¡æ¯ ã€enviã€‘çŽ¯å¢ƒå˜é‡ï¼Œæ˜¾ç¤ºjdkå’Œzkç­‰çŽ¯å¢ƒå˜é‡çš„ä¿¡æ¯ ã€mntrã€‘ç›‘æŽ§zkå¥åº·ä¿¡æ¯ ã€wchsã€‘å±•ç¤ºwatchçš„ä¿¡æ¯ ã€wchcã€‘ä¸Žã€wchpã€‘ï¼šåˆ†åˆ«å±•ç¤ºsessionä¸ŽwatchåŠpathä¸Žwatcherçš„ä¿¡æ¯ï¼Œé»˜è®¤è¿™ä¸¤ä¸ªå‘½ä»¤æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œéœ€è¦å°†ä»–ä»¬åˆ—å…¥ç™½åå•æ‰è¡Œ]]></content>
      <tags>
        <tag>zookpeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zookeeperç¬”è®°6-zkå®‰è£…å’Œé›†ç¾¤æ­å»º]]></title>
    <url>%2F2019%2F02%2F23%2Fzookeeper%2FZookeeper%E7%AC%94%E8%AE%B06-zk%E5%AE%89%E8%A3%85%E5%92%8C%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[æœ¬ç« ä¼šå›žé¡¾ä¸€ä¸‹ZABåè®®ï¼Œç„¶åŽä»‹ç»ä¸€ä¸‹é›†ç¾¤æ­å»ºçš„é…ç½®æ–‡ä»¶ã€‚ å‰è¨€ å›žé¡¾ä¸€ä¸‹ZABåè®®ã€‚Zabåè®®åŒ…æ‹¬ä¸¤ä¸ªæ ¸å¿ƒï¼š ç¬¬ä¸€ï¼ŒåŽŸå­å¹¿æ’­ å®¢æˆ·ç«¯æäº¤äº‹åŠ¡è¯·æ±‚æ—¶LeaderèŠ‚ç‚¹ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚ç”Ÿæˆä¸€ä¸ªäº‹åŠ¡Proposalï¼Œå°†å…¶å‘é€ç»™é›†ç¾¤ä¸­æ‰€æœ‰çš„FollowerèŠ‚ç‚¹ï¼Œæ”¶åˆ°è¿‡åŠFollowerçš„åé¦ˆåŽå¼€å§‹å¯¹äº‹åŠ¡è¿›è¡Œæäº¤ã€‚ è¿™ä¹Ÿå¯¼è‡´äº†Leaderå´©æºƒåŽå¯èƒ½ä¼šå‡ºçŽ°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼ŒZABä½¿ç”¨äº†å´©æºƒæ¢å¤æ¥å¤„ç†æ•°å­—ä¸ä¸€è‡´é—®é¢˜ï¼› æ¶ˆæ¯å¹¿æ’­ä½¿ç”¨äº†TCPåè®®è¿›è¡Œé€šè®¯æ‰€æœ‰ä¿è¯äº†æŽ¥å—å’Œå‘é€äº‹åŠ¡çš„é¡ºåºæ€§ã€‚å¹¿æ’­æ¶ˆæ¯æ—¶LeaderèŠ‚ç‚¹ä¸ºæ¯ä¸ªäº‹åŠ¡Proposalåˆ†é…ä¸€ä¸ªå…¨å±€é€’å¢žçš„ZXIDï¼ˆäº‹åŠ¡IDï¼‰ï¼Œæ¯ä¸ªäº‹åŠ¡Proposaléƒ½æŒ‰ç…§ZXIDé¡ºåºæ¥å¤„ç†ï¼› LeaderèŠ‚ç‚¹ä¸ºæ¯ä¸€ä¸ªFollowerèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªé˜Ÿåˆ—æŒ‰äº‹åŠ¡ZXIDé¡ºåºæ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸”æ ¹æ®é˜Ÿåˆ—çš„è§„åˆ™FIFOæ¥è¿›è¡Œäº‹åŠ¡çš„å‘é€ã€‚ FollowerèŠ‚ç‚¹æ”¶åˆ°äº‹åŠ¡ProposalåŽä¼šå°†è¯¥äº‹åŠ¡ä»¥äº‹åŠ¡æ—¥å¿—æ–¹å¼å†™å…¥åˆ°æœ¬åœ°ç£ç›˜ä¸­ï¼ŒæˆåŠŸåŽåé¦ˆAckæ¶ˆæ¯ç»™LeaderèŠ‚ç‚¹ã€‚ æ”¶åˆ°è¿‡åŠACKåé¦ˆä¹‹åŽï¼ŒåŒæ—¶å‘æ‰€æœ‰çš„FollowerèŠ‚ç‚¹å¹¿æ’­Commitæ¶ˆæ¯ï¼ŒFollowerèŠ‚ç‚¹æ”¶åˆ°CommitåŽå¼€å§‹å¯¹äº‹åŠ¡è¿›è¡Œæäº¤ï¼› ç¬¬äºŒï¼ŒMasteré€‰ä¸¾ é‡Œé¢ç”¨çš„ç®—æ³•å«åšï¼šFast Leader Electionã€‚ epochï¼šé€‰ä¸¾è½®æ•°,å³å‘¨æœŸï¼Œå°±æ˜¯ä¹‹å‰è¯´çš„é€»è¾‘æ—¶é’ŸlogicClock Zxid: Zxid æ˜¯ä¸€ä¸ª 64 ä½çš„æ•°å­—ï¼Œå…¶ä¸­ä½Ž 32 ä½æ˜¯ä¸€ä¸ªç®€å•çš„å•è°ƒé€’å¢žçš„è®¡æ•°å™¨ï¼Œé’ˆå¯¹å®¢æˆ·ç«¯æ¯ä¸€ä¸ªäº‹åŠ¡è¯·æ±‚ï¼Œè®¡æ•°å™¨åŠ  1ï¼›è€Œé«˜ 32 ä½åˆ™ä»£è¡¨ Leader å‘¨æœŸ epoch çš„ç¼–å·ï¼Œæ¯ä¸ªå½“é€‰äº§ç”Ÿä¸€ä¸ªæ–°çš„ Leader æœåŠ¡å™¨ï¼Œå°±ä¼šä»Žè¿™ä¸ª Leader æœåŠ¡å™¨ä¸Šå–å‡ºå…¶æœ¬åœ°æ—¥å¿—ä¸­æœ€å¤§äº‹åŠ¡çš„ZXIDï¼Œå¹¶ä»Žä¸­è¯»å– epoch å€¼ï¼Œç„¶åŽåŠ  1ï¼Œä»¥æ­¤ä½œä¸ºæ–°çš„ epochï¼Œå¹¶å°†ä½Ž 32 ä½ä»Ž 0 å¼€å§‹è®¡æ•°ã€‚ æˆä¸ºleaderçš„æ¡ä»¶ é€‰epochæœ€å¤§çš„ epochç›¸ç­‰ï¼Œé€‰ zxid æœ€å¤§çš„ epochå’Œzxidéƒ½ç›¸ç­‰ï¼Œé€‰æ‹©server idæœ€å¤§çš„ï¼ˆå°±æ˜¯æˆ‘ä»¬é…ç½®zoo.cfgä¸­çš„myidï¼‰ é€‰ä¸¾çš„åŸºæœ¬æ­¥éª¤ æ¯ä¸ªä»ŽèŠ‚ç‚¹éƒ½å‘å…¶ä»–èŠ‚ç‚¹å‘é€é€‰è‡ªèº«ä¸ºLeaderçš„VoteæŠ•ç¥¨è¯·æ±‚ï¼Œç­‰å¾…å›žå¤ï¼› ä»ŽèŠ‚ç‚¹æŽ¥å—åˆ°çš„Voteå¦‚æžœæ¯”è‡ªèº«çš„å¤§ï¼ˆZXIDæ›´æ–°ï¼‰æ—¶åˆ™æŠ•ç¥¨ï¼Œå¹¶æ›´æ–°è‡ªèº«çš„Voteï¼Œå¦åˆ™æ‹’ç»æŠ•ç¥¨ï¼› æ¯ä¸ªä»ŽèŠ‚ç‚¹ä¸­ç»´æŠ¤ç€ä¸€ä¸ªæŠ•ç¥¨è®°å½•è¡¨ï¼Œå½“æŸä¸ªèŠ‚ç‚¹æ”¶åˆ°è¿‡åŠçš„æŠ•ç¥¨æ—¶ï¼Œç»“æŸæŠ•ç¥¨å¹¶æŠŠè¯¥ä»ŽèŠ‚ç‚¹é€‰ä¸ºLeaderï¼ŒæŠ•ç¥¨ç»“æŸï¼› å…·ä½“ä¸€ç‚¹çš„æ­¥éª¤ï¼š 1ã€å‘èµ·ä¸€è½®æŠ•ç¥¨é€‰ä¸¾ï¼ŒæŽ¨ä¸¾è‡ªå·±ä½œä¸ºleaderï¼Œé€šçŸ¥æ‰€æœ‰çš„æœåŠ¡å™¨ï¼Œç­‰å¾…æŽ¥æ”¶å¤–éƒ¨é€‰ç¥¨ã€‚ 2ã€åªè¦å½“å‰æœåŠ¡å™¨çŠ¶æ€ä¸ºLOOKINGï¼Œè¿›å…¥å¾ªçŽ¯ï¼Œä¸æ–­åœ°è¯»å–å…¶å®ƒServerå‘æ¥çš„é€šçŸ¥ã€è¿›è¡Œæ¯”è¾ƒã€æ›´æ–°è‡ªå·±çš„æŠ•ç¥¨ã€å‘é€è‡ªå·±çš„æŠ•ç¥¨ã€ç»Ÿè®¡æŠ•ç¥¨ç»“æžœï¼Œç›´åˆ°leaderé€‰å‡ºæˆ–å‡ºé”™é€€å‡ºã€‚å…·ä½“åšæ³•ï¼š 2.1 å¦‚æžœå‘é€è¿‡æ¥çš„é€»è¾‘æ—¶é’Ÿå¤§äºŽç›®å‰çš„é€»è¾‘æ—¶é’Ÿï¼Œé‚£ä¹ˆè¯´æ˜Žè¿™æ˜¯æ›´æ–°çš„ä¸€æ¬¡é€‰ä¸¾æŠ•ç¥¨ï¼Œæ­¤æ—¶æ›´æ–°æœ¬æœºçš„é€»è¾‘æ—¶é’Ÿï¼ˆlogicalclockï¼‰ï¼Œæ¸…ç©ºæŠ•ç¥¨ç®±ï¼ˆå› ä¸ºå·²ç»è¿‡æœŸæ²¡æœ‰ç”¨äº†ï¼‰è°ƒç”¨totalOrderPredicateå‡½æ•°åˆ¤æ–­å¯¹æ–¹çš„æŠ•ç¥¨æ˜¯å¦ä¼˜äºŽå½“å‰çš„æŠ•ç¥¨ï¼ˆè§ä¸‹é¢ä»£ç ï¼‰ï¼Œæ˜¯çš„è¯ç”¨å¯¹æ–¹æŽ¨èçš„leaderæ›´æ–°ä¸‹ä¸€æ¬¡çš„æŠ•ç¥¨ï¼Œå¦åˆ™ä½¿ç”¨åˆå§‹çš„æŠ•ç¥¨ï¼ˆæŠ•è‡ªå·±ï¼‰ï¼Œè°ƒç”¨sendNotifications() é€šçŸ¥æ‰€æœ‰æœåŠ¡å™¨æˆ‘çš„é€‰æ‹©ï¼Œè·³åˆ°2.4ã€‚ 2.2 å¦‚æžœå¯¹æ–¹å¤„äºŽä¸Šè½®æŠ•ç¥¨ï¼Œä¸äºˆç†ç¬ï¼Œå›žåˆ°2ã€‚ 2.3 å¦‚æžœå¯¹æ–¹ä¹Ÿå¤„äºŽæœ¬è½®æŠ•ç¥¨ï¼Œè°ƒç”¨totalOrderPredicateå‡½æ•°åˆ¤æ–­å¯¹æ–¹çš„æŠ•ç¥¨æ˜¯å¦ä¼˜äºŽå½“å‰çš„æŠ•ç¥¨ï¼Œæ˜¯çš„è¯æ›´æ–°å½“å‰çš„æŠ•ç¥¨ï¼Œå¦åˆ™ä½¿ç”¨åˆå§‹çš„æŠ•ç¥¨ï¼ˆæŠ•è‡ªå·±ï¼‰å¹¶æ–°ç”Ÿæˆnotificationæ¶ˆæ¯æ”¾å…¥å‘é€é˜Ÿåˆ—ã€‚è°ƒç”¨sendNotifications() é€šçŸ¥æ‰€æœ‰æœåŠ¡å™¨æˆ‘çš„é€‰æ‹©ã€‚ 2.4 å°†æ”¶åˆ°çš„æŠ•ç¥¨æ”¾å…¥è‡ªå·±çš„æŠ•ç¥¨ç®±ä¸­ã€‚ 2.5 è°ƒç”¨è®¡ç¥¨å™¨çš„containsQuorumå‡½æ•°ï¼Œåˆ¤æ–­æ‰€æŽ¨èçš„leaderæ˜¯å¦å¾—åˆ°é›†ç¾¤å¤šæ•°äººçš„åŒæ„ï¼Œå¦‚æžœå¾—åˆ°å¤šæ•°äººåŒæ„ï¼Œé‚£ä¹ˆè¿˜éœ€ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œçœ‹æ˜¯å¦æœ‰æ¯”å½“å‰æ›´ä¼˜çš„æè®®ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œåˆ™è®¤ä¸ºæŠ•ç¥¨ç»“æŸã€‚æ ¹æ®æŠ•ç¥¨ç»“æžœä¿®æ”¹è‡ªå·±çš„çŠ¶æ€ã€‚ä»¥ä¸Šä»»ä½•ä¸€æ¡ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­å¾ªçŽ¯ã€‚ å…³äºŽtotalOrderPredicate: 123456789101112131415161718192021protected boolean totalOrderPredicate(long newId, long newZxid, long newEpoch, long curId, long curZxid, long curEpoch) &#123; LOG.debug("id: " + newId + ", proposed id: " + curId + ", zxid: 0x" + Long.toHexString(newZxid) + ", proposed zxid: 0x" + Long.toHexString(curZxid)); // ä½¿ç”¨è®¡ç¥¨å™¨åˆ¤æ–­å½“å‰serverçš„æƒé‡æ˜¯å¦ä¸º0 if(self.getQuorumVerifier().getWeight(newId) == 0)&#123; return false; &#125; // é€šè¿‡Epochã€zxidã€idæ¥æ¯”è¾ƒä¸¤ä¸ªå€™é€‰leader return ((newEpoch &gt; curEpoch) || ((newEpoch == curEpoch) &amp;&amp; ((newZxid &gt; curZxid) || ((newZxid == curZxid) &amp;&amp; (newId &gt; curId))))); &#125; æ€»ç»“èµ·æ¥å°±æ˜¯ä¸€å¥è¯ï¼šè‹¥å¹²ä¸ªèŠ‚ç‚¹ï¼Œç¬¬ä¸€æ¬¡éƒ½æ˜¯æŠ•ç»™è‡ªå·±ï¼›åŽé¢å°±æ˜¯ï¼Œå°½é‡å‘æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹é æ‹¢ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šæ¯ä¸ªèŠ‚ç‚¹è´«å¯Œæœ‰å·®è·ï¼Œå¯Œæœ‰çš„èŠ‚ç‚¹è®©è´«ç©·çš„èŠ‚ç‚¹æŠ•è‡ªå·±ä¸€ç¥¨ï¼Œé‚£ä¹ˆè´«ç©·çš„èŠ‚ç‚¹ä¼šæŽ¥å—ï¼Œåä¹‹ä¸è¡Œï¼Œé‚£ä¹ˆæœ€å…ˆæ‹¿åˆ°è¶…è¿‡ä¸€åŠçš„è´«ç©·çš„èŠ‚ç‚¹çš„æŠ•ç¥¨ï¼Œå°±æˆä¸ºleaderã€‚ï¼ˆè´«ç©·ä¸Žå¯Œæœ‰éƒ½æ˜¯ç›¸å¯¹çš„ï¼Œè¶Šå¯Œæœ‰è¶Šå¯èƒ½æˆä¸ºleaderï¼‰ã€‚ zké›†ç¾¤æ­å»º é¦–å…ˆå‡†å¤‡ä¸‰ä»½è§£åŽ‹æ–‡ä»¶ï¼Œæ¯ä¸€ä»½ä¸­éƒ½æ–°å»ºä¸€ä¸ªå«dataçš„æ–‡ä»¶å¤¹ï¼šé‡Œé¢æ–°å»ºä¸€ä¸ªå«åšmyidçš„æ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªå†™1ï¼ŒåŽé¢é€’å¢žã€‚ æ¯ä¸€ä»½ä¸­é…ç½®æ–‡ä»¶æ”¹ä¸ºzoo.cfgã€‚zk1å¯¹åº”çš„zoo.cfg: 12345678910111213141516171819202122232425262728293031323334353637383940# The number of milliseconds of each tick å¿ƒè·³æ£€æµ‹æ—¶é—´tickTime=2000# The number of ticks that the initial # synchronization phase can take# é›†ç¾¤å¯åŠ¨åŽï¼Œç›¸äº’è¿žæŽ¥ï¼Œå¦‚æžœåœ¨initLimit*tickTimeæ—¶é—´å†…æ²¡æœ‰è¿žæŽ¥æˆåŠŸï¼Œé‚£ä¹ˆè®¤ä¸ºè¿žæŽ¥å¤±è´¥initLimit=10# The number of ticks that can pass between # sending a request and getting an acknowledgement# Masrerå’Œslaveä¹‹é—´æˆ–è€…slaveå’Œslaveä¹‹é—´çš„æ•°æ®åŒæ­¥æ—¶é—´ï¼Œåœ¨syncLimit*tickTimeæ˜¯æŒ‰å†…æ²¡æœ‰è¿”å›žä¸€ä¸ªACkï¼Œåˆ™# è®¤ä¸ºè¯¥èŠ‚ç‚¹å®•æœºï¼Œå¦‚æžœæ˜¯Masterå®•æœºäº†ï¼Œå°±è¦é‡æ–°é€‰ä¸¾äº†syncLimit=5# the directory where the snapshot is stored.# do not use /tmp for storage, /tmp here is just # example sakes.# æ•°æ®å­˜æ”¾çš„ç›®å½•ï¼Œè¿™æ˜¯æˆ‘æ–°å»ºçš„dataDir=D:/zookeeper1-3.4.10/data# dataLogDir = xx# the port at which the clients will connect# å®¢æˆ·ç«¯è¿žæŽ¥é›†ç¾¤çš„ç«¯å£å·clientPort=2181# the maximum number of client connections.# increase this if you need to handle more clients#maxClientCnxns=60## Be sure to read the maintenance section of the # administrator guide before turning on autopurge.## http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance## The number of snapshots to retain in dataDir#autopurge.snapRetainCount=3# Purge task interval in hours# Set to &quot;0&quot; to disable auto purge feature#autopurge.purgeInterval=1# ç¬¬ä¸€ä¸ªç«¯å£æ˜¯æ•°æ®åŒæ­¥çš„ç«¯å£å· ç¬¬äºŒä¸ªç«¯å£æ˜¯é€‰ä¸¾çš„ç«¯å£å·server.1=127.0.0.1:2887:3887server.2=127.0.0.1:2888:3888server.3=127.0.0.1:2889:3889 åŽé¢ä¸€æ¬¡é€’å¢žè¿™ä¸ªclientPortå’Œdataæ–‡ä»¶å¤¹ä½ç½®ã€‚ ä¾æ¬¡å¯åŠ¨å³å¯ã€‚]]></content>
      <tags>
        <tag>zookpeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zookeeperç¬”è®°5-ZABåè®®]]></title>
    <url>%2F2019%2F02%2F23%2Fzookeeper%2FZookeeper%E7%AC%94%E8%AE%B05-ZAB%E5%8D%8F%E8%AE%AE%2F</url>
    <content type="text"><![CDATA[åœ¨zookeeperä¸­å…¶å®žä½¿ç”¨çš„ZABåè®®æ¥å®žçŽ°æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”ä¸»è¦ä¾é çš„æ˜¯leaderå’Œfollowerè¿™ä¸¤ç§è§’è‰²æŽ§åˆ¶æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè€Œleaderæ˜¯é‡Œé¢æœ€é‡è¦çš„ä¸€ä¸ªè§’è‰²ï¼Œå®ƒæ˜¯ä¸»è¦è´Ÿè´£å†™æ“ä½œçš„èŠ‚ç‚¹ï¼Œç„¶åŽä¸Žå…¶ä»–çš„followerè¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦ä¿è¯leaderå®•æœºçš„æ—¶å€™è¦å¿«é€Ÿé€‰ä¸¾å‡ºæ–°çš„leaderå¹¶ä¸”è¿›è¡Œæ•°æ®æ¢å¤ã€‚ ä¸€ã€å‰è¨€ ZooKeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå¯ç”¨äºŽæœåŠ¡å‘çŽ°ã€åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é¢†å¯¼é€‰ä¸¾ã€é…ç½®ç®¡ç†ç­‰ã€‚ è¿™ä¸€åˆ‡çš„åŸºç¡€ï¼Œéƒ½æ˜¯ZooKeeperæä¾›äº†ä¸€ä¸ªç±»ä¼¼äºŽLinuxæ–‡ä»¶ç³»ç»Ÿçš„æ ‘å½¢ç»“æž„ï¼ˆå¯è®¤ä¸ºæ˜¯è½»é‡çº§çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œä½†åªé€‚åˆå­˜å°‘é‡ä¿¡æ¯ï¼Œå®Œå…¨ä¸é€‚åˆå­˜å‚¨å¤§é‡æ–‡ä»¶æˆ–è€…å¤§æ–‡ä»¶ï¼‰ï¼ŒåŒæ—¶æä¾›äº†å¯¹äºŽæ¯ä¸ªèŠ‚ç‚¹çš„ç›‘æŽ§ä¸Žé€šçŸ¥æœºåˆ¶ã€‚ æ—¢ç„¶æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå°±ä¸å¾—ä¸æZooKeeperæ˜¯å¦‚ä½•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§çš„ã€‚æœ¬èŠ‚å°†å°†ä»‹ç»ZooKeeperå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå¦‚ä½•è¿›è¡Œé¢†å¯¼é€‰ä¸¾ï¼Œä»¥åŠæ•°æ®ç›‘æŽ§/é€šçŸ¥æœºåˆ¶çš„è¯­ä¹‰ä¿è¯ã€‚ äºŒã€ZAB-åŽŸå­å¹¿æ’­ï¼ˆé‡ç‚¹ï¼‰ ZooKeeperé›†ç¾¤æ˜¯ä¸€ä¸ªåŸºäºŽä¸»ä»Žå¤åˆ¶çš„é«˜å¯ç”¨é›†ç¾¤ï¼Œæ¯ä¸ªæœåŠ¡å™¨æ‰¿æ‹…å¦‚ä¸‹ä¸‰ç§è§’è‰²ä¸­çš„ä¸€ç§ï¼š Leaderï¼š ä¸€ä¸ªZooKeeperé›†ç¾¤åŒä¸€æ—¶é—´åªä¼šæœ‰ä¸€ä¸ªå®žé™…å·¥ä½œçš„Leaderï¼Œå®ƒä¼šå‘èµ·å¹¶ç»´æŠ¤ä¸Žå„FollweråŠObserveré—´çš„å¿ƒè·³ã€‚æ‰€æœ‰çš„å†™æ“ä½œå¿…é¡»è¦é€šè¿‡Leaderå®Œæˆå†ç”±Leaderå°†å†™æ“ä½œå¹¿æ’­ç»™å…¶å®ƒæœåŠ¡å™¨ã€‚ Followerï¼š ä¸€ä¸ªZooKeeperé›†ç¾¤å¯èƒ½åŒæ—¶å­˜åœ¨å¤šä¸ªFollowerï¼Œå®ƒä¼šå“åº”Leaderçš„å¿ƒè·³ã€‚Followerå¯ç›´æŽ¥å¤„ç†å¹¶è¿”å›žå®¢æˆ·ç«¯çš„è¯»è¯·æ±‚ï¼ŒåŒæ—¶ä¼šå°†å†™è¯·æ±‚è½¬å‘ç»™Leaderå¤„ç†ï¼Œå¹¶ä¸”è´Ÿè´£åœ¨Leaderå¤„ç†å†™è¯·æ±‚æ—¶å¯¹è¯·æ±‚è¿›è¡ŒæŠ•ç¥¨ã€‚ Observerï¼š è§’è‰²ä¸ŽFollowerç±»ä¼¼ï¼Œä½†æ˜¯æ— æŠ•ç¥¨æƒã€‚ ä¸ºäº†ä¿è¯å†™æ“ä½œçš„ä¸€è‡´æ€§ä¸Žå¯ç”¨æ€§ï¼ŒZooKeeperä¸“é—¨è®¾è®¡äº†ä¸€ç§åä¸ºåŽŸå­å¹¿æ’­ï¼ˆZABï¼‰çš„æ”¯æŒå´©æºƒæ¢å¤çš„ä¸€è‡´æ€§åè®®ã€‚åŸºäºŽè¯¥åè®®ï¼ŒZooKeeperå®žçŽ°äº†ä¸€ç§ä¸»ä»Žæ¨¡å¼çš„ç³»ç»Ÿæž¶æž„æ¥ä¿æŒé›†ç¾¤ä¸­å„ä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚ æ ¹æ®ZABåè®®ï¼Œæ‰€æœ‰çš„å†™æ“ä½œéƒ½å¿…é¡»é€šè¿‡Leaderå®Œæˆï¼ŒLeaderå†™å…¥æœ¬åœ°æ—¥å¿—åŽå†å¤åˆ¶åˆ°æ‰€æœ‰çš„FollowerèŠ‚ç‚¹ã€‚ ä¸€æ—¦LeaderèŠ‚ç‚¹æ— æ³•å·¥ä½œï¼ŒZABåè®®èƒ½å¤Ÿè‡ªåŠ¨ä»ŽFollowerèŠ‚ç‚¹ä¸­é‡æ–°é€‰å‡ºä¸€ä¸ªåˆé€‚çš„æ›¿ä»£è€…ï¼Œå³æ–°çš„Leaderï¼Œè¯¥è¿‡ç¨‹å³ä¸ºé¢†å¯¼é€‰ä¸¾ã€‚è¯¥é¢†å¯¼é€‰ä¸¾è¿‡ç¨‹ï¼Œæ˜¯ZABåè®®ä¸­æœ€ä¸ºé‡è¦å’Œå¤æ‚çš„è¿‡ç¨‹ã€‚ 1ã€å†™Leader é€šè¿‡Leaderè¿›è¡Œå†™æ“ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç”±ä¸Šå›¾å¯è§ï¼Œé€šè¿‡Leaderè¿›è¡Œå†™æ“ä½œï¼Œä¸»è¦åˆ†ä¸ºäº”æ­¥ï¼š å®¢æˆ·ç«¯å‘Leaderå‘èµ·å†™è¯·æ±‚ Leaderå°†å†™è¯·æ±‚ä»¥Proposalçš„å½¢å¼å‘ç»™æ‰€æœ‰Followerå¹¶ç­‰å¾…ACK Followeræ”¶åˆ°Leaderçš„ProposalåŽè¿”å›žACK Leaderå¾—åˆ°è¿‡åŠæ•°çš„ACKï¼ˆLeaderå¯¹è‡ªå·±é»˜è®¤æœ‰ä¸€ä¸ªACKï¼‰åŽå‘æ‰€æœ‰çš„Followerå’ŒObserverå‘é€Commmit Leaderå°†å¤„ç†ç»“æžœè¿”å›žç»™å®¢æˆ·ç«¯ è¿™é‡Œè¦æ³¨æ„ï¼š Leaderå¹¶ä¸éœ€è¦å¾—åˆ°Observerçš„ACKï¼Œå³Observeræ— æŠ•ç¥¨æƒ Leaderä¸éœ€è¦å¾—åˆ°æ‰€æœ‰Followerçš„ACKï¼Œåªè¦æ”¶åˆ°è¿‡åŠçš„ACKå³å¯ï¼ŒåŒæ—¶Leaderæœ¬èº«å¯¹è‡ªå·±æœ‰ä¸€ä¸ªACKã€‚ä¸Šå›¾ä¸­æœ‰4ä¸ªFollowerï¼Œåªéœ€å…¶ä¸­ä¸¤ä¸ªè¿”å›žACKå³å¯ï¼Œå› ä¸º(2+1) / (4+1) &gt; 1/2 Observerè™½ç„¶æ— æŠ•ç¥¨æƒï¼Œä½†ä»é¡»åŒæ­¥Leaderçš„æ•°æ®ä»Žè€Œåœ¨å¤„ç†è¯»è¯·æ±‚æ—¶å¯ä»¥è¿”å›žå°½å¯èƒ½æ–°çš„æ•°æ® 2ã€å†™Follower/Observer é€šè¿‡Follower/Observerè¿›è¡Œå†™æ“ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»Žä¸Šå›¾å¯è§ï¼š Follower/Observerå‡å¯æŽ¥å—å†™è¯·æ±‚ï¼Œä½†ä¸èƒ½ç›´æŽ¥å¤„ç†ï¼Œè€Œéœ€è¦å°†å†™è¯·æ±‚è½¬å‘ç»™Leaderå¤„ç† é™¤äº†å¤šäº†ä¸€æ­¥è¯·æ±‚è½¬å‘ï¼Œå…¶å®ƒæµç¨‹ä¸Žç›´æŽ¥å†™Leaderæ— ä»»ä½•åŒºåˆ« 3ã€è¯»æ“ä½œ Leader/Follower/Observeréƒ½å¯ç›´æŽ¥å¤„ç†è¯»è¯·æ±‚ï¼Œä»Žæœ¬åœ°å†…å­˜ä¸­è¯»å–æ•°æ®å¹¶è¿”å›žç»™å®¢æˆ·ç«¯å³å¯ã€‚ ç”±äºŽå¤„ç†è¯»è¯·æ±‚ä¸éœ€è¦æœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’ï¼ŒFollower/Observerè¶Šå¤šï¼Œæ•´ä½“å¯å¤„ç†çš„è¯»è¯·æ±‚é‡è¶Šå¤§ï¼Œä¹Ÿå³è¯»æ€§èƒ½è¶Šå¥½ã€‚ åœ¨æ•´ä¸ªæ¶ˆæ¯å¹¿æ’­è¿‡ç¨‹ä¸­ï¼ŒLeaderæœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªäº‹åŠ¡è¯·æ±‚ç”Ÿæˆå¯¹åº”çš„Proposalæ¥è¿›è¡Œå¹¿æ’­ï¼Œå¹¶ä¸”åœ¨å¹¿æ’­äº‹åŠ¡Proposalä¹‹å‰ï¼ŒLeaderæœåŠ¡å™¨ä¼šé¦–å…ˆä¸ºè¿™ä¸ªäº‹åŠ¡Proposalåˆ†é…ä¸€ä¸ªå…¨å±€å•è°ƒé€’å¢žçš„å”¯ä¸€IDï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºäº‹åŠ¡ID(å³ZXID)ã€‚ç”±äºŽZABåè®®éœ€è¦ä¿è¯æ¯ä¸€ä¸ªæ¶ˆæ¯ä¸¥æ ¼çš„å› æžœå…³ç³»ï¼Œå› æ­¤å¿…é¡»å°†æ¯ä¸€ä¸ªäº‹åŠ¡ProposalæŒ‰ç…§å…¶ZXIDçš„å…ˆåŽé¡ºåºè¿›è¡ŒæŽ’åºå’Œå¤„ç†ã€‚ å…·ä½“çš„ï¼Œåœ¨æ¶ˆæ¯å¹¿æ’­è¿‡ç¨‹ä¸­ï¼ŒLeaderæœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªFolloweræœåŠ¡å™¨éƒ½å„è‡ªåˆ†é…ä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ï¼Œç„¶åŽå°†éœ€è¦å¹¿æ’­çš„äº‹åŠ¡Proposalä¾æ¬¡æ”¾å…¥è¿™äº›é˜Ÿåˆ—ä¸­å–ï¼Œå¹¶ä¸”æ ¹æ®FIFOç­–ç•¥è¿›è¡Œæ¶ˆæ¯å‘é€ã€‚æ¯ä¸€ä¸ªFolloweræœåŠ¡å™¨åœ¨æŽ¥æ”¶åˆ°è¿™ä¸ªäº‹åŠ¡Proposalä¹‹åŽï¼Œéƒ½ä¼šé¦–å…ˆå°†å…¶ä»¥äº‹åŠ¡æ—¥å¿—çš„å½¢å¼å†™å…¥æœ¬åœ°ç£ç›˜ä¸­ï¼Œå¹¶ä¸”æˆåŠŸå†™å…¥åŽåé¦ˆç»™LeaderæœåŠ¡å™¨ä¸€ä¸ªAckç›¸åº”ã€‚å½“LeaderæœåŠ¡å™¨æŽ¥æ”¶åˆ°è¿‡åŠæ•°Followerçš„Ackå“åº”åŽï¼Œå°±ä¼šå¹¿æ’­ä¸€ä¸ªCommitæ¶ˆæ¯ç»™æ‰€æœ‰çš„FolloweræœåŠ¡å™¨ä»¥é€šçŸ¥å…¶è¿›è¡Œäº‹åŠ¡æäº¤ï¼ŒåŒæ—¶Leaderè‡ªèº«ä¹Ÿä¼šå®Œæˆå¯¹äº‹åŠ¡çš„æäº¤ï¼Œè€Œæ¯ä¸ªFolloweræœåŠ¡å™¨åœ¨æŽ¥æ”¶åˆ°Commitæ¶ˆæ¯åŽï¼Œä¹Ÿä¼šå®Œæˆå¯¹äº‹åŠ¡çš„æäº¤ã€‚ ç„¶è€Œï¼Œåœ¨è¿™ç§ç®€åŒ–çš„äºŒé˜¶æ®µæäº¤æ¨¡åž‹ä¸‹ï¼Œæ— æ³•å¤„ç†LeaderæœåŠ¡å™¨å´©æºƒé€€å‡ºè€Œå¸¦æ¥çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œå› æ­¤ZABåè®®æ·»åŠ äº†å´©æºƒæ¢å¤æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦å¤–ï¼Œæ•´ä¸ªæ¶ˆæ¯å¹¿æ’­åè®®æ˜¯åŸºäºŽæœ‰FIFOç‰¹æ€§çš„TCPåè®®æ¥è¿›è¡Œç½‘ç»œé€šä¿¡çš„ï¼Œå› æ­¤å¾ˆå®¹æ˜“åœ°ä¿è¯æ¶ˆæ¯å¹¿æ’­è¿‡ç¨‹ä¸­æ¶ˆæ¯æŽ¥æ”¶å’Œå‘é€çš„é¡ºåºæ€§ã€‚ åœ¨ZABåè®®ä¸­ï¼Œä¸ºäº†ä¿è¯ç¨‹åºçš„æ­£ç¡®è¿è¡Œï¼Œæ•´ä¸ªæ¢å¤è¿‡ç¨‹ç»“æŸåŽéœ€è¦é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„LeaderæœåŠ¡å™¨ã€‚å› æ­¤ï¼ŒZABåè®®éœ€è¦ä¸€ä¸ªé«˜æ•ˆä¸”å¯é çš„Leaderé€‰ä¸¾ç®—æ³•ï¼Œä»Žè€Œç¡®ä¿èƒ½å¤Ÿå¿«é€Ÿé€‰ä¸¾å‡ºæ–°çš„Leaderã€‚åŒæ—¶ï¼ŒLeaderé€‰ä¸¾ç®—æ³•ä¸ä»…ä»…éœ€è¦è®©Leaderè‡ªå·±çŸ¥é“å…¶è‡ªèº«å·²ç»è¢«é€‰ä¸¾ä¸ºLeaderï¼ŒåŒæ—¶è¿˜éœ€è¦è®©é›†ç¾¤ä¸­çš„æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨ä¹Ÿå¿«é€Ÿåœ°æ„ŸçŸ¥åˆ°é€‰ä¸¾äº§ç”Ÿçš„æ–°çš„LeaderæœåŠ¡å™¨ã€‚å´©æºƒæ¢å¤ä¸»è¦åŒ…æ‹¬Leaderé€‰ä¸¾å’Œæ•°æ®æ¢å¤ä¸¤éƒ¨åˆ†ï¼Œä¸‹é¢å°†è¯¦ç»†è®²è§£Leaderé€‰ä¸¾å’Œæ•°æ®æ¢å¤æµç¨‹ã€‚ ä¸‰ã€æ”¯æŒçš„é¢†å¯¼é€‰ä¸¾ç®—æ³• åœ¨3.4.10ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤å€¼ä¸º3ï¼Œä¹Ÿå³åŸºäºŽTCPçš„FastLeaderElectionã€‚å¦å¤–ä¸‰ç§ç®—æ³•å·²ç»è¢«å¼ƒç”¨ï¼Œå¹¶ä¸”æœ‰è®¡åˆ’åœ¨ä¹‹åŽçš„ç‰ˆæœ¬ä¸­å°†å®ƒä»¬å½»åº•åˆ é™¤è€Œä¸å†æ”¯æŒã€‚ ä½•æ—¶è§¦å‘é€‰ä¸¾ï¼Ÿ é€‰ä¸¾Leaderä¸æ˜¯éšæ—¶é€‰ä¸¾çš„ï¼Œæ¯•ç«Ÿé€‰ä¸¾æœ‰äº§ç”Ÿå¤§é‡çš„é€šä¿¡ï¼Œé€ æˆç½‘ç»œIOçš„æ¶ˆè€—ã€‚å› æ­¤ä¸‹é¢æƒ…å†µæ‰ä¼šå‡ºçŽ°é€‰ä¸¾ï¼š é›†ç¾¤å¯åŠ¨ æœåŠ¡å™¨å¤„äºŽå¯»æ‰¾LeaderçŠ¶æ€ å½“æœåŠ¡å™¨å¤„äºŽLOOKINGçŠ¶æ€æ—¶ï¼Œè¡¨ç¤ºå½“å‰æ²¡æœ‰Leaderï¼Œéœ€è¦è¿›å…¥é€‰ä¸¾æµç¨‹ å´©æºƒæ¢å¤ Leaderå®•æœº ç½‘ç»œåŽŸå› å¯¼è‡´è¿‡åŠèŠ‚ç‚¹ä¸ŽLeaderå¿ƒè·³ä¸­æ–­ ä¸‹é¢å­¦ä¹ ä¸€ä¸‹FastLeaderElectionçš„åŽŸç†ã€‚ å››ã€åè¯è§£é‡Š 1ã€myid æ¯ä¸ªZooKeeperæœåŠ¡å™¨ï¼Œéƒ½éœ€è¦åœ¨æ•°æ®æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºmyidçš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«æ•´ä¸ªZooKeeperé›†ç¾¤å”¯ä¸€çš„IDï¼ˆæ•´æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼ŒæŸZooKeeperé›†ç¾¤åŒ…å«ä¸‰å°æœåŠ¡å™¨ï¼Œhostnameåˆ†åˆ«ä¸ºzoo1ã€zoo2å’Œzoo3ï¼Œå…¶myidåˆ†åˆ«ä¸º1ã€2å’Œ3ï¼Œåˆ™åœ¨é…ç½®æ–‡ä»¶ä¸­å…¶IDä¸Žhostnameå¿…é¡»ä¸€ä¸€å¯¹åº”ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­ï¼Œserver.åŽé¢çš„æ•°æ®å³ä¸ºmyid: 123server.1=zoo1:2888:3888server.2=zoo2:2888:3888server.3=zoo3:2888:3888 ç¬¬1ä¸ªç«¯å£æ˜¯é€šä¿¡å’Œæ•°æ®åŒæ­¥ç«¯å£ï¼Œé»˜è®¤æ˜¯2888 ç¬¬2ä¸ªç«¯å£æ˜¯æŠ•ç¥¨ç«¯å£ï¼Œé»˜è®¤æ˜¯3888 æ•°å°çš„å‘æ•°å¤§çš„å‘èµ·TCPè¿žæŽ¥ã€‚æ¯”å¦‚æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œmyidæ–‡ä»¶å†…å®¹åˆ†åˆ«ä¸º1,2,3ã€‚zké›†ç¾¤çš„tcpè¿žæŽ¥é¡ºåºæ˜¯1å‘2å‘èµ·TCPè¿žæŽ¥ï¼Œ2å‘3å‘èµ·TCPè¿žæŽ¥ã€‚å¦‚æžœæœ‰nä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆtcpè¿žæŽ¥é¡ºåºä¹Ÿä»¥æ­¤ç±»æŽ¨ã€‚è¿™æ ·æ•´ä¸ªzké›†ç¾¤å°±ä¼šè¿žæŽ¥èµ·æ¥ 2ã€zxid ç±»ä¼¼äºŽRDBMSä¸­çš„äº‹åŠ¡IDï¼Œç”¨äºŽæ ‡è¯†ä¸€æ¬¡æ›´æ–°æ“ä½œçš„Proposal IDã€‚ä¸ºäº†ä¿è¯é¡ºåºæ€§ï¼Œè¯¥zxidå¿…é¡»å•è°ƒé€’å¢žã€‚å› æ­¤ZooKeeperä½¿ç”¨ä¸€ä¸ª64ä½çš„æ•°æ¥è¡¨ç¤ºï¼Œé«˜32ä½æ˜¯Leaderçš„epochï¼Œä»Ž1å¼€å§‹ï¼Œæ¯æ¬¡é€‰å‡ºæ–°çš„Leaderï¼ŒepochåŠ ä¸€ã€‚ä½Ž32ä½ä¸ºè¯¥epochå†…çš„åºå·ï¼Œæ¯æ¬¡epochå˜åŒ–ï¼Œéƒ½å°†ä½Ž32ä½çš„åºå·é‡ç½®ã€‚è¿™æ ·ä¿è¯äº†zxidçš„å…¨å±€é€’å¢žæ€§ã€‚ 3ã€æœåŠ¡å™¨çŠ¶æ€ LOOKING ä¸ç¡®å®šLeaderçŠ¶æ€ã€‚è¯¥çŠ¶æ€ä¸‹çš„æœåŠ¡å™¨è®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰Leaderï¼Œä¼šå‘èµ·Leaderé€‰ä¸¾ã€‚ FOLLOWING è·Ÿéšè€…çŠ¶æ€ã€‚è¡¨æ˜Žå½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Followerï¼Œå¹¶ä¸”å®ƒçŸ¥é“Leaderæ˜¯è°ã€‚ LEADING é¢†å¯¼è€…çŠ¶æ€ã€‚è¡¨æ˜Žå½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Leaderï¼Œå®ƒä¼šç»´æŠ¤ä¸ŽFolloweré—´çš„å¿ƒè·³ã€‚ OBSERVING è§‚å¯Ÿè€…çŠ¶æ€ã€‚è¡¨æ˜Žå½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Observerï¼Œä¸ŽFolowerå”¯ä¸€çš„ä¸åŒåœ¨äºŽä¸å‚ä¸Žé€‰ä¸¾ï¼Œä¹Ÿä¸å‚ä¸Žé›†ç¾¤å†™æ“ä½œæ—¶çš„æŠ•ç¥¨ã€‚ 4ã€é€‰ç¥¨æ•°æ®ç»“æž„ æ¯ä¸ªæœåŠ¡å™¨åœ¨è¿›è¡Œé¢†å¯¼é€‰ä¸¾æ—¶ï¼Œä¼šå‘é€å¦‚ä¸‹å…³é”®ä¿¡æ¯ï¼š logicClock æ¯ä¸ªæœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ªè‡ªå¢žçš„æ•´æ•°ï¼Œåä¸ºlogicClockï¼Œå®ƒè¡¨ç¤ºè¿™æ˜¯è¯¥æœåŠ¡å™¨å‘èµ·çš„ç¬¬å¤šå°‘è½®æŠ•ç¥¨ state å½“å‰æœåŠ¡å™¨çš„çŠ¶æ€ self_id å½“å‰æœåŠ¡å™¨çš„myid self_zxid å½“å‰æœåŠ¡å™¨ä¸Šæ‰€ä¿å­˜çš„æ•°æ®çš„æœ€å¤§zxid vote_id è¢«æŽ¨ä¸¾çš„æœåŠ¡å™¨çš„myid vote_zxid è¢«æŽ¨ä¸¾çš„æœåŠ¡å™¨ä¸Šæ‰€ä¿å­˜çš„æ•°æ®çš„æœ€å¤§zxid äº”ã€leaderçš„åˆ¤å®šæ ‡å‡† æ•°æ®æ–°æ—§ç¨‹åº¦ï¼Œåªæœ‰æ‹¥æœ‰æœ€æ–°æ•°æ®çš„èŠ‚ç‚¹æ‰èƒ½æœ‰æœºä¼šæˆä¸ºLeaderï¼Œé€šè¿‡zxidçš„å¤§å°æ¥è¡¨ç¤ºæ•°æ®çš„æ–°ï¼Œzxidè¶Šå¤§ä»£è¡¨æ•°æ®è¶Šæ–° myid:é›†ç¾¤å¯åŠ¨æ—¶ï¼Œä¼šåœ¨dataç›®å½•ä¸‹é…ç½®myidæ–‡ä»¶ï¼Œé‡Œé¢çš„æ•°å­—ä»£è¡¨å½“å‰zkæœåŠ¡å™¨èŠ‚ç‚¹çš„ç¼–å·.å½“zkæœåŠ¡å™¨èŠ‚ç‚¹æ•°æ®ä¸€æ ·æ–°æ—¶ï¼Œ myidä¸­æ•°å­—è¶Šå¤§çš„å°±ä¼šè¢«é€‰ä¸¾æˆLeader å½“é›†ç¾¤ä¸­å·²ç»æœ‰Leaderæ—¶ï¼Œæ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸ä¼šå½±å“åŽŸæ¥çš„é›†ç¾¤ æŠ•ç¥¨æ•°é‡ï¼Œåªæœ‰å¾—åˆ°é›†ç¾¤ä¸­å¤šåŠçš„æŠ•ç¥¨ï¼Œæ‰èƒ½æˆä¸ºLeaderï¼Œå¤šåŠå³ï¼šn/2+1,å…¶ä¸­nä¸ºé›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°é‡ å…­ã€Leaderé€‰ä¸¾æµç¨‹ 1ã€è‡ªå¢žé€‰ä¸¾è½®æ¬¡ ZooKeeperè§„å®šæ‰€æœ‰æœ‰æ•ˆçš„æŠ•ç¥¨éƒ½å¿…é¡»åœ¨åŒä¸€è½®æ¬¡ä¸­ã€‚æ¯ä¸ªæœåŠ¡å™¨åœ¨å¼€å§‹æ–°ä¸€è½®æŠ•ç¥¨æ—¶ï¼Œä¼šå…ˆå¯¹è‡ªå·±ç»´æŠ¤çš„logicClockè¿›è¡Œè‡ªå¢žæ“ä½œã€‚ 2ã€å‘é€åˆå§‹åŒ–é€‰ç¥¨ æ¯ä¸ªæœåŠ¡å™¨æœ€å¼€å§‹éƒ½æ˜¯é€šè¿‡å¹¿æ’­æŠŠç¥¨æŠ•ç»™è‡ªå·±ã€‚ 4ã€æ›´æ–°é€‰ç¥¨ æ ¹æ®é€‰ç¥¨logicClock -&gt; vote_zxid -&gt; vote_idä¾æ¬¡åˆ¤æ–­ 4.1 åˆ¤æ–­é€‰ä¸¾è½®æ¬¡æ”¶åˆ°å¤–éƒ¨æŠ•ç¥¨åŽï¼Œé¦–å…ˆä¼šæ ¹æ®æŠ•ç¥¨ä¿¡æ¯ä¸­æ‰€åŒ…å«çš„logicClockæ¥è¿›è¡Œä¸åŒå¤„ç†ï¼š å¤–éƒ¨æŠ•ç¥¨çš„logicClock &gt; è‡ªå·±çš„logicClockï¼š è¯´æ˜Žè¯¥æœåŠ¡å™¨çš„é€‰ä¸¾è½®æ¬¡è½åŽäºŽå…¶å®ƒæœåŠ¡å™¨çš„é€‰ä¸¾è½®æ¬¡ï¼Œç«‹å³æ¸…ç©ºè‡ªå·±çš„æŠ•ç¥¨ç®±å¹¶å°†è‡ªå·±çš„logicClockæ›´æ–°ä¸ºæ”¶åˆ°çš„logicClockï¼Œç„¶åŽå†å¯¹æ¯”è‡ªå·±ä¹‹å‰çš„æŠ•ç¥¨ä¸Žæ”¶åˆ°çš„æŠ•ç¥¨ä»¥ç¡®å®šæ˜¯å¦éœ€è¦å˜æ›´è‡ªå·±çš„æŠ•ç¥¨ï¼Œæœ€ç»ˆå†æ¬¡å°†è‡ªå·±çš„æŠ•ç¥¨å¹¿æ’­å‡ºåŽ»; å¤–éƒ¨æŠ•ç¥¨çš„logicClock &lt; è‡ªå·±çš„logicClockï¼š å½“å‰æœåŠ¡å™¨ç›´æŽ¥å¿½ç•¥è¯¥æŠ•ç¥¨ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªæŠ•ç¥¨; å¤–éƒ¨æŠ•ç¥¨çš„logickClock = è‡ªå·±çš„ï¼š è¿›è¡Œä¸‹ä¸€æ­¥çš„è¿›è¡Œé€‰ç¥¨PKã€‚ 4.2 é€‰ç¥¨PKæ˜¯åŸºäºŽ(self_id, self_zxid)ä¸Ž(vote_id, vote_zxid)çš„å¯¹æ¯”ï¼š è‹¥logicClockä¸€è‡´ï¼Œåˆ™å¯¹æ¯”äºŒè€…çš„vote_zxidã€‚ è‹¥å¤–éƒ¨æŠ•ç¥¨çš„vote_zxidæ¯”è¾ƒå¤§ï¼Œåˆ™å°†è‡ªå·±çš„ç¥¨ä¸­çš„vote_zxidä¸Žvote_myidæ›´æ–°ä¸ºæ”¶åˆ°çš„ç¥¨ä¸­çš„vote_zxidä¸Žvote_myidå¹¶å¹¿æ’­å‡ºåŽ»ï¼Œå¦å¤–å°†æ”¶åˆ°çš„ç¥¨åŠè‡ªå·±æ›´æ–°åŽçš„ç¥¨æ”¾å…¥è‡ªå·±çš„ç¥¨ç®±ã€‚å¦‚æžœç¥¨ç®±å†…å·²å­˜åœ¨(self_myid, self_zxid)ç›¸åŒçš„é€‰ç¥¨ï¼Œåˆ™ç›´æŽ¥è¦†ç›– è‹¥äºŒè€…vote_zxidä¸€è‡´ï¼Œåˆ™æ¯”è¾ƒäºŒè€…çš„vote_myidã€‚ è‹¥å¤–éƒ¨æŠ•ç¥¨çš„vote_myidæ¯”è¾ƒå¤§ï¼Œåˆ™å°†è‡ªå·±çš„ç¥¨ä¸­çš„vote_myidæ›´æ–°ä¸ºæ”¶åˆ°çš„ç¥¨ä¸­çš„vote_myidå¹¶å¹¿æ’­å‡ºåŽ»ï¼Œå¦å¤–å°†æ”¶åˆ°çš„ç¥¨åŠè‡ªå·±æ›´æ–°åŽçš„ç¥¨æ”¾å…¥è‡ªå·±çš„ç¥¨ç®± 5ã€ç»Ÿè®¡é€‰ç¥¨ å¦‚æžœå·²ç»ç¡®å®šæœ‰è¿‡åŠæœåŠ¡å™¨è®¤å¯äº†è‡ªå·±çš„æŠ•ç¥¨ï¼ˆå¯èƒ½æ˜¯æ›´æ–°åŽçš„æŠ•ç¥¨ï¼‰ï¼Œåˆ™ç»ˆæ­¢æŠ•ç¥¨ã€‚å¦åˆ™ç»§ç»­æŽ¥æ”¶å…¶å®ƒæœåŠ¡å™¨çš„æŠ•ç¥¨ã€‚ 6ã€æ›´æ–°æœåŠ¡å™¨çŠ¶æ€ æŠ•ç¥¨ç»ˆæ­¢åŽï¼ŒæœåŠ¡å™¨å¼€å§‹æ›´æ–°è‡ªèº«çŠ¶æ€ã€‚è‹¥è¿‡åŠçš„ç¥¨æŠ•ç»™äº†è‡ªå·±ï¼Œåˆ™å°†è‡ªå·±çš„æœåŠ¡å™¨çŠ¶æ€æ›´æ–°ä¸ºLEADINGï¼Œå¦åˆ™å°†è‡ªå·±çš„çŠ¶æ€æ›´æ–°ä¸ºFOLLOWINGã€‚ ä¸ƒã€å›¾ç¤ºLeaderé€‰ä¸¾æµç¨‹ è¯´æ˜Žï¼š å›¾ä¸­ç®­å¤´ä¸Šçš„(1,1,0) ä¸‰ä¸ªæ•°ä¾æ¬¡ä»£è¡¨ è¯¥é€‰ç¥¨çš„æœåŠ¡å™¨çš„LogicClockï¼ˆå³æŠ•ç¥¨è½®æ•°ï¼‰; è¢«æŽ¨èçš„æœåŠ¡å™¨çš„myid (å³vote_myid); è¢«æŽ¨èçš„æœåŠ¡å™¨çš„æœ€å¤§äº‹åŠ¡ID(å³vote_zxid)ï¼› (1, 1)è¡¨ç¤ºï¼š æŠ•ç¥¨æœåŠ¡å™¨myid(å³self_myid) è¢«æŽ¨èçš„æœåŠ¡å™¨çš„myid (å³vote_myid) æ‰€ä»¥(1,1,0)åœ¨è¿™é‡Œçš„æ„æ€æ˜¯ï¼šç¬¬ä¸€è½®æŠ•ç¥¨ä¸­ï¼ŒæŠ•ç»™server 1ï¼Œå¹¶ä¸”è‡ªå·±çš„æœ€å¤§äº‹åŠ¡IDéƒ½æ˜¯0(è¿™é‡Œå¯èƒ½ä¼šæ¯”è¾ƒä¹±ï¼ŒZXIDå¯ç”¨è¿™æ ·ç†è§£ï¼šå‰32ä½æ˜¯å¹´å·ï¼Œæ¯”å¦‚ä¸‡åŽ†å¹´é—´ï¼›åŽ32ä½æ˜¯å¤šå°‘å¹´ï¼Œæ¯”å¦‚ä¸‡åŽ†15å¹´)ï¼Œæˆ‘ä»¬è¿™é‡Œå…ˆä¸è€ƒè™‘å¹´å·çš„æ›´è¿­ï¼Œå°±å‡è®¾è¿™ä¸ªæŠ•ç¥¨å‘ç”Ÿåœ¨ä¸‡åŽ†15å¹´è¿™ä¸€å¹´ï¼Œå¹¶ä¸”åªè€ƒè™‘ç¬¬ä¸€è½®æŠ•ç¥¨ã€‚å³(1,vote_id,0)ï¼Œæ‰€ä»¥æš‚æ—¶åªè€ƒè™‘ä¸­é—´ä¸ªæ•°å­—ã€‚åŽé¢æŽ¥å—å¤–éƒ¨é€‰ç¥¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªè¦å…³æ³¨ä¸­é—´ä¸ªæ•°å­—å³å¯ï¼Œæ¯”å¦‚(1,2,0)è¯´æ˜Žæ˜¯æŠ•ç»™server 2çš„ã€‚ è¿™é‡Œçš„ç¤ºä¾‹åªè€ƒè™‘ç¬¬ä¸€è½®ï¼Œå¹¶ä¸”ZXIDå°±æ˜¯0. ç¬¬ä¸€æ­¥ï¼šè‡ªå¢žé€‰ç¥¨è½®æ¬¡&amp;åˆå§‹åŒ–é€‰ç¥¨&amp;å‘é€åˆå§‹åŒ–é€‰ç¥¨ é¦–å…ˆï¼Œä¸‰å°æœåŠ¡å™¨è‡ªå¢žé€‰ä¸¾è½®æ¬¡å°†LogicClock=1ï¼›ç„¶åŽåˆå§‹åŒ–é€‰ç¥¨ï¼Œæ¸…ç©ºç¥¨ç®±ï¼›æœ€åŽå‘èµ·åˆå§‹åŒ–æŠ•ç¥¨ç»™è‡ªå·±å°†å„è‡ªçš„ç¥¨é€šè¿‡å¹¿æ’­çš„å½¢å¼æŠ•ä¸ªè‡ªå·±å¹¶ä¿å­˜åœ¨è‡ªå·±çš„ç¥¨ç®±é‡Œã€‚ æ‰€ä»¥éƒ½æ˜¯è‡ªå·±æŠ•ç»™è‡ªå·±ä¸€ç¥¨(1,1,0),(1,2,0),(1,3,0) æŠ•å®Œç¥¨ä¹‹åŽçš„çŠ¶æ€æ—¶(1,1),(2,2),(3,3) ç¬¬äºŒæ­¥ï¼šæŽ¥å—å¤–éƒ¨æŠ•ç¥¨&amp;æ›´æ–°é€‰ç¥¨ ä»¥Server 1 ä¸ºä¾‹ï¼Œåˆ†åˆ«ç»åŽ† Server 1 PK Server 2 å’Œ Server 1 PK Server 3 è¿‡ç¨‹ Server 1 PK Server 2 Server 1 æŽ¥æ”¶åˆ°Server 2çš„é€‰ç¥¨(1,2,0) è¡¨ç¤ºæŠ•ç»™server 2. è¿™æ—¶Server 1å°†è‡ªèº«çš„é€‰ç¥¨è½®æ¬¡å’ŒServer 2 çš„é€‰ç¥¨è½®æ¬¡æ¯”è¾ƒï¼Œå‘çŽ°LogicClock=1ç›¸ç­‰ï¼ŒæŽ¥ç€Server 2æ¯”è¾ƒæ¯”è¾ƒæœ€å¤§äº‹åŠ¡IDï¼Œå‘çŽ°ä¹Ÿzxid=0ä¹Ÿç›¸ç­‰ï¼Œæœ€åŽæ¯”è¾ƒå„è‡ªçš„myidï¼Œå‘çŽ°Server 2çš„myid=2 å¤§äºŽè‡ªå·±çš„myid=1ï¼› æ ¹æ®é€‰ç¥¨PKè§„åˆ™ï¼ŒServer 1å°†è‡ªå·±çš„é€‰ç¥¨ç”± (1, 1) æ›´æ­£ä¸º (1, 2)ï¼Œè¡¨ç¤ºé€‰ä¸¾Server 2ä¸ºLeaderï¼Œç„¶åŽå°†è‡ªå·±çš„æ–°é€‰ç¥¨ (1, 2)å¹¿æ’­ç»™ Server 2 å’Œ Server 3ï¼ŒåŒæ—¶æ›´æ–°ç¥¨ç®±å­ä¸­è‡ªå·±çš„é€‰ç¥¨å¹¶ä¿å­˜Server 2çš„é€‰ç¥¨ï¼Œè‡³æ­¤Server 1ç¥¨ç®±ä¸­çš„é€‰ç¥¨ä¸º(1, 2) å’Œ (2, 2)ï¼› Server 2æ”¶åˆ°Server 1çš„é€‰ç¥¨åŒæ ·ç»è¿‡è½®æ¬¡æ¯”è¾ƒå’Œé€‰ç¥¨PKåŽç¡®è®¤è‡ªå·±çš„é€‰ç¥¨ä¿æŒä¸å˜ï¼Œå¹¶æ›´æ–°ç¥¨ç®±ä¸­Server 1çš„é€‰ç¥¨ç”±(1, 1)æ›´æ–°ä¸º(1, 2)ï¼Œæ³¨æ„æ­¤æ¬¡Server 2è‡ªå·±çš„é€‰ç¥¨å¹¶æ²¡æœ‰æ”¹å˜æ‰€æœ‰ä¸ç”¨å¯¹å¤–å¹¿æ’­è‡ªå·±çš„é€‰ç¥¨ã€‚ æ­¤æ—¶ä¾¿è®¤ä¸ºå·²ç»é€‰å‡ºäº†Leaderã€‚ä½†æ˜¯è¿™é‡Œå¯èƒ½ä¼šç­‰ä¸€ä¼šçœ‹çœ‹æœ‰æ²¡æœ‰æœ€ä¼˜çš„æƒ…å†µï¼Œå¯èƒ½å°±ä¼šæ¥åˆ°ä¸‹é¢ä¸€æ­¥ã€‚ Server 1 PK Server 3 Server 1 æŽ¥æ”¶åˆ°Server 3çš„é€‰ç¥¨(1,3,0) è¡¨ç¤ºæŠ•ç»™server 3. æ ¹æ®Server 1 PK Server 2çš„æµç¨‹ç±»æŽ¨ï¼ŒServer 1è‡ªå·±çš„é€‰ç¥¨ç”±(1, 2)æ›´æ–°ä¸º(1, 3), åŒæ ·æ›´æ–°è‡ªå·±çš„ç¥¨ç®±å¹¶å¹¿æ’­ç»™Server 2 å’Œ Server 3ï¼› Server 2å†æ¬¡æŽ¥æ”¶åˆ°Server 1çš„é€‰ç¥¨(1, 3)æ—¶ç»è¿‡æ¯”è¾ƒåŽæ ¹æ®è§„åˆ™ä¹Ÿè¦å°†è‡ªå·±çš„é€‰ç¥¨ä»Ž(1, 2)æ›´æ–°ä¸º(1, 3), å¹¶æ›´æ–°ç¥¨ç®±é‡Œè‡ªå·±çš„é€‰ç¥¨å’ŒServer 1çš„é€‰ç¥¨ï¼ŒåŒæ—¶å‘Server 1å’Œ Server 3å¹¿æ’­ï¼› åŒç† Server 2 å’Œ Server 3ä¹Ÿä¼šç»åŽ†ä¸Šè¿°æŠ•ç¥¨è¿‡ç¨‹ï¼Œä¾æ¬¡ç±»æŽ¨ï¼ŒServer 1 ã€Server 2 å’ŒServer 3 åœ¨ä¿©ä¿©ä¹‹é—´åœ¨ç»åŽ†å¤šæ¬¡é€‰ä¸¾è½®æ¬¡æ¯”è¾ƒå’Œé€‰ç¥¨PKåŽæœ€ç»ˆç¡®å®šå„è‡ªçš„é€‰ç¥¨ã€‚ æœ€åŽæ›´æ–°æœåŠ¡å™¨çŠ¶æ€ï¼š é€‰ç¥¨ç¡®å®šåŽæœåŠ¡å™¨æ ¹æ®è‡ªå·±ç¥¨ç®±ä¸­çš„é€‰ç¥¨ç¡®å®šå„è‡ªçš„è§’è‰²å’ŒçŠ¶æ€ï¼Œç¥¨ç®±ä¸­è¶…è¿‡åŠæ•°çš„é€‰ç¥¨æŠ•ç»™è‡ªå·±çš„åˆ™ä¸ºLeaderï¼Œæ›´æ–°è‡ªå·±çš„çŠ¶æ€ä¸ºLEADINGï¼Œå¦åˆ™ä¸ºFollowerè§’è‰²ï¼ŒçŠ¶æ€ä¸ºFOLLOWINGï¼Œæˆä¸ºLeaderçš„æœåŠ¡å™¨è¦ä¸»åŠ¨å‘Followerå‘é€å¿ƒè·³åŒ…ï¼ŒFolloweråšå‡ºACKå›žåº”ï¼Œä»¥ç»´æŒä»–ä»¬ä¹‹é—´çš„é•¿è¿žæŽ¥ã€‚ https://dbaplus.cn/news-141-1875-1.html https://www.jianshu.com/p/3fec1f8bfc5f]]></content>
      <tags>
        <tag>zookpeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zookeeperç¬”è®°4-Zookeeperä»‹ç»]]></title>
    <url>%2F2019%2F02%2F23%2Fzookeeper%2FZookeeper%E7%AC%94%E8%AE%B04-Zookeeper%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[å…³äºŽzookeeperæœ€åŸºæœ¬çš„ä»‹ç»å·²ç»åœ¨ç¬”è®°ä¸€ä¸­ä»‹ç»äº†ã€‚ä¸å†èµ˜è¿°ã€‚ZooKeeper æ˜¯ä¸€ä¸ªå…¸åž‹çš„åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åŸºäºŽ ZooKeeper å®žçŽ°è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Master é€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚æœ¬æ–‡å†æ¥ç¨å¾®æ·±å…¥ä¸€ç‚¹ä»‹ç»ä¸€ä¸‹zookeeperçš„ä¸€äº›ç‰¹æ€§ã€‚ 1ã€ é…ç½®ç»´æŠ¤ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬ä¼šæŠŠæœåŠ¡éƒ¨ç½²åˆ°nå°æœºå™¨ä¸Šï¼ŒæœåŠ¡é…ç½®æ–‡ä»¶éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¦‚æžœé…ç½®æ–‡ä»¶çš„é…ç½®é€‰é¡¹å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£æˆ‘ä»¬å°±å¾—ä¸€å°ä¸€å°çš„åŽ»æ”¹åŠ¨ã€‚è¿™æ—¶å€™zookeeperå°±èµ·ä½œç”¨äº†ï¼Œå¯ä»¥æŠŠzkå½“æˆä¸€ä¸ªé«˜å¯ç”¨çš„é…ç½®å­˜å‚¨å™¨ï¼ŒæŠŠè¿™æ ·é…ç½®çš„äº‹æƒ…äº¤ç»™zkåŽ»è¿›è¡Œç®¡ç†ï¼Œå°†é›†ç¾¤çš„é…ç½®æ–‡ä»¶æ‹·è´åˆ°zookeeperçš„æ–‡ä»¶ç³»ç»Ÿçš„æŸä¸ªèŠ‚ç‚¹ä¸Šï¼Œç„¶åŽç”¨zkç›‘æŽ§æ‰€æœ‰åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œçš„é…ç½®æ–‡ä»¶çŠ¶æ€ï¼Œä¸€æ—¦å‘çŽ°æœ‰é…ç½®æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆæ¯å°æœåŠ¡å™¨åŒæ­¥zkçš„é…ç½®æ–‡ä»¶ï¼ŒzkåŒæ—¶ä¿è¯åŒæ­¥æ“ä½œçš„åŽŸå­æ€§ï¼Œç¡®ä¿æ¯ä¸ªæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶éƒ½èƒ½è¢«æ›´æ–°ã€‚ 2ã€ å‘½åæœåŠ¡ï¼šåœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­ï¼Œé€šå¸¸éœ€è¦ä¸€ä¸ªå®Œæ•´çš„å‘½åè§„åˆ™ï¼Œæ—¢èƒ½å¤Ÿäº§ç”Ÿå”¯ä¸€çš„åç§°åˆä¾¿äºŽäººè¯†åˆ«å’Œè®°ä½ã€‚Zkå°±æä¾›äº†è¿™ç§æœåŠ¡ï¼Œç±»ä¼¼äºŽåŸŸåå’Œipä¹‹é—´å¯¹åº”å…³ç³»ï¼ŒåŸŸåå®¹æ˜“è®°ä½ï¼Œé€šè¿‡åç§°æ¥èŽ·å–èµ„æºå’ŒæœåŠ¡çš„åœ°å€ï¼Œæä¾›è€…ç­‰ä¿¡æ¯ã€‚ 3ã€ åˆ†å¸ƒå¼é”ï¼šåˆ†å¸ƒå¼ç¨‹åºåˆ†å¸ƒåœ¨ä¸åŒä¸»æœºä¸Šçš„è¿›ç¨‹å¯¹äº’æ–¥èµ„æºè¿›è¡Œè®¿é—®çš„æ—¶å€™éœ€è¦åŠ é”ã€‚è¿™æ ·ç†è§£ï¼šå¾ˆå¤šåˆ†å¸ƒå¼ç³»ç»Ÿæœ‰å¤šä¸ªæœåŠ¡çª—å£ï¼Œä½†æ˜¯æŸä¸ªæ—¶åˆ»åªè®©ä¸€ä¸ªæœåŠ¡åŽ»å¹²æ´»ï¼Œå½“è¿™å°æœåŠ¡å™¨å‡ºé—®é¢˜çš„æ—¶å€™é”é‡Šæ”¾ï¼Œé‡Œè„Šfail overåˆ°å¦å¤–çš„æœåŠ¡ã€‚ä¸¾ä¾‹å­ï¼Œæ¯”å¦‚åŽ»æŸä¸ªåœ°æ–¹åŠžç†è¯ä»¶çš„æ—¶å€™ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçª—å£å¯¹ä½ æœåŠ¡ï¼Œå¦‚æžœè¿™ä¸ªçª—å£çš„æŸœå‘˜æœ‰æ€¥äº‹èµ°äº†ï¼Œé‚£ä¹ˆç³»ç»Ÿæˆ–è€…ç»ç†ç»™ä½ æŒ‡å®šå¦å¤–ä¸€ä¸ªçª—å£ç»§ç»­æœåŠ¡ã€‚ 4ã€ é›†ç¾¤ç®¡ç†ï¼šåˆ†å¸ƒå¼é›†ç¾¤ä¸­ï¼Œç»å¸¸ä¼šç”±äºŽå„ç§åŽŸå› ï¼Œæ¯”å¦‚ç¡¬ä»¶æ•…éšœï¼Œç½‘ç»œé—®é¢˜ï¼Œæœ‰äº›èŠ‚ç‚¹æŒ‚æŽ‰ã€æœ‰äº›èŠ‚ç‚¹åŠ è¿›æ¥ã€‚è¿™ä¸ªæ—¶å€™æœºå™¨éœ€è¦æ„ŸçŸ¥åˆ°å˜åŒ–ï¼Œç„¶åŽæ ¹æ®å˜åŒ–åšå‡ºå¯¹åº”çš„å†³ç­–ï¼Œé‚£ä¹ˆzkå°±å®žçŽ°äº†ç±»ä¼¼è¿™ç§é›†ç¾¤çš„ç®¡ç†ã€‚ ä¸€ã€ç‰¹æ€§ é¡ºåºä¸€è‡´æ€§ï¼š ä»ŽåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œæœ€ç»ˆå°†ä¼šä¸¥æ ¼æŒ‰ç…§å…¶å‘èµ·é¡ºåºè¢«åº”ç”¨åˆ°ZooKeeperä¸­ã€‚ åŽŸå­æ€§ï¼š æ‰€æœ‰äº‹åŠ¡è¯·æ±‚çš„ç»“æžœåœ¨é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¸Šçš„åº”ç”¨æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä¹ˆæ•´ä¸ªé›†ç¾¤æ‰€æœ‰é›†ç¾¤éƒ½æˆåŠŸåº”ç”¨äº†æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰åº”ç”¨ï¼Œä¸€å®šä¸ä¼šå‡ºçŽ°é›†ç¾¤ä¸­éƒ¨åˆ†æœºå™¨åº”ç”¨äº†è¯¥äº‹åŠ¡ï¼Œè€Œå¦å¤–ä¸€éƒ¨åˆ†æ²¡æœ‰åº”ç”¨çš„æƒ…å†µã€‚ å•ä¸€è§†å›¾ï¼š æ— è®ºå®¢æˆ·ç«¯è¿žæŽ¥çš„æ˜¯å“ªä¸ªZooKeeperæœåŠ¡å™¨ï¼Œå…¶çœ‹åˆ°çš„æœåŠ¡ç«¯æ•°æ®æ¨¡åž‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚ å¯é æ€§ï¼š ä¸€æ—¦æœåŠ¡ç«¯æˆåŠŸåœ°åº”ç”¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶å®Œæˆå¯¹å®¢æˆ·ç«¯çš„å“åº”ï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡æ‰€å¼•èµ·çš„æœåŠ¡ç«¯çŠ¶æ€å˜æ›´å°†ä¼šè¢«ä¸€ç›´ä¿ç•™ä¸‹æ¥ï¼Œé™¤éžæœ‰å¦ä¸€ä¸ªäº‹åŠ¡åˆå¯¹å…¶è¿›è¡Œäº†å˜æ›´ã€‚ å®žæ—¶æ€§ï¼š é€šå¸¸äººä»¬çœ‹åˆ°å®žæ—¶æ€§çš„ç¬¬ä¸€ååº”æ˜¯ï¼Œä¸€æ—¦ä¸€ä¸ªäº‹åŠ¡è¢«æˆåŠŸåº”ç”¨ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯èƒ½å¤Ÿç«‹å³ä»ŽæœåŠ¡ç«¯ä¸Šè¯»å–åˆ°è¿™ä¸ªäº‹åŠ¡å˜æ›´åŽçš„æœ€æ–°æ•°æ®çŠ¶æ€ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒZooKeeperä»…ä»…ä¿è¯åœ¨ä¸€å®šçš„æ—¶é—´æ®µå†…ï¼Œå®¢æˆ·ç«¯æœ€ç»ˆä¸€å®šèƒ½å¤Ÿä»ŽæœåŠ¡ç«¯ä¸Šè¯»å–åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ äºŒã€é›†ç¾¤è§’è‰² æœ€å…¸åž‹é›†ç¾¤æ¨¡å¼ï¼š Master/Slave æ¨¡å¼ï¼ˆä¸»å¤‡æ¨¡å¼ï¼‰ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œé€šå¸¸ MasteræœåŠ¡å™¨ä½œä¸ºä¸»æœåŠ¡å™¨æä¾›å†™æœåŠ¡ï¼Œå…¶ä»–çš„ Slave æœåŠ¡å™¨ä»ŽæœåŠ¡å™¨é€šè¿‡å¼‚æ­¥å¤åˆ¶çš„æ–¹å¼èŽ·å– Master æœåŠ¡å™¨æœ€æ–°çš„æ•°æ®æä¾›è¯»æœåŠ¡ã€‚ ä½†æ˜¯ï¼Œåœ¨ ZooKeeper ä¸­æ²¡æœ‰é€‰æ‹©ä¼ ç»Ÿçš„ Master/Slave æ¦‚å¿µï¼Œè€Œæ˜¯å¼•å…¥ä»¥ä¸‹ä¸‰ç§è§’è‰²ï¼š Leader Follower Observer zookeeper-server statuså¯ä»¥çœ‹å½“å‰èŠ‚ç‚¹çš„ZooKeeperæ˜¯ä»€ä¹ˆè§’è‰²ã€‚ ZooKeeperé»˜è®¤åªæœ‰Leaderå’ŒFollowerä¸¤ç§è§’è‰²ï¼Œæ²¡æœ‰Observerè§’è‰²ã€‚ ZooKeeperé›†ç¾¤çš„æ‰€æœ‰æœºå™¨é€šè¿‡ä¸€ä¸ªLeaderé€‰ä¸¾è¿‡ç¨‹æ¥é€‰å®šä¸€å°è¢«ç§°ä¸ºã€ŽLeaderã€çš„æœºå™¨ï¼ŒLeaderæœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯æä¾›è¯»å’Œå†™æœåŠ¡ã€‚ Followerå’ŒObserveréƒ½èƒ½æä¾›è¯»æœåŠ¡ï¼Œä¸èƒ½æä¾›å†™æœåŠ¡ã€‚ä¸¤è€…å”¯ä¸€çš„åŒºåˆ«åœ¨äºŽï¼ŒObserveræœºå™¨ä¸å‚ä¸ŽLeaderé€‰ä¸¾è¿‡ç¨‹ï¼Œä¹Ÿä¸å‚ä¸Žå†™æ“ä½œçš„ã€Žè¿‡åŠå†™æˆåŠŸã€ç­–ç•¥ï¼Œå› æ­¤Observerå¯ä»¥åœ¨ä¸å½±å“å†™æ€§èƒ½çš„æƒ…å†µä¸‹æå‡é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚ ç³»ç»Ÿæ¨¡åž‹å¦‚å›¾æ‰€ç¤ºï¼š ä¸‰ã€å…³äºŽZooKeeperçš„ä¸€äº›é‡è¦æ¦‚å¿µ ZooKeeperæœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç¨‹åºï¼ˆåªè¦åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZooKeeperå°±èƒ½æ­£å¸¸æœåŠ¡ï¼‰ ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œæœ€å¥½æ˜¯ä»¥é›†ç¾¤å½¢æ€æ¥éƒ¨ç½²ZooKeeperï¼Œè¿™æ ·åªè¦é›†ç¾¤ä¸­å¤§éƒ¨åˆ†æœºå™¨æ˜¯å¯ç”¨çš„ï¼ˆèƒ½å¤Ÿå®¹å¿ä¸€å®šçš„æœºå™¨æ•…éšœï¼‰ï¼Œé‚£ä¹ˆZooKeeperæœ¬èº«ä»ç„¶æ˜¯å¯ç”¨çš„ã€‚ ZooKeeperå°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™ä¹Ÿå°±ä¿è¯äº† é«˜åžåé‡å’Œä½Žå»¶è¿Ÿï¼ˆä½†æ˜¯å†…å­˜é™åˆ¶äº†èƒ½å¤Ÿå­˜å‚¨çš„å®¹é‡ä¸å¤ªå¤§ï¼Œæ­¤é™åˆ¶ä¹Ÿæ˜¯ä¿æŒznodeä¸­å­˜å‚¨çš„æ•°æ®é‡è¾ƒå°çš„è¿›ä¸€æ­¥åŽŸå› ï¼‰ã€‚ ZooKeeperæ˜¯é«˜æ€§èƒ½çš„ã€‚ åœ¨â€œè¯»â€å¤šäºŽâ€œå†™â€çš„åº”ç”¨ç¨‹åºä¸­å°¤å…¶åœ°é«˜æ€§èƒ½ï¼Œå› ä¸ºâ€œå†™â€ä¼šå¯¼è‡´æ‰€æœ‰çš„æœåŠ¡å™¨é—´åŒæ­¥çŠ¶æ€ã€‚ï¼ˆâ€œè¯»â€å¤šäºŽâ€œå†™â€æ˜¯åè°ƒæœåŠ¡çš„å…¸åž‹åœºæ™¯ã€‚ï¼‰ ZooKeeperæœ‰ä¸´æ—¶èŠ‚ç‚¹çš„æ¦‚å¿µã€‚ å½“åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¼šè¯ä¸€ç›´ä¿æŒæ´»åŠ¨ï¼Œçž¬æ—¶èŠ‚ç‚¹å°±ä¸€ç›´å­˜åœ¨ã€‚è€Œå½“ä¼šè¯ç»ˆç»“æ—¶ï¼Œçž¬æ—¶èŠ‚ç‚¹è¢«åˆ é™¤ã€‚æŒä¹…èŠ‚ç‚¹æ˜¯æŒ‡ä¸€æ—¦è¿™ä¸ªZNodeè¢«åˆ›å»ºäº†ï¼Œé™¤éžä¸»åŠ¨è¿›è¡ŒZNodeçš„ç§»é™¤æ“ä½œï¼Œå¦åˆ™è¿™ä¸ªZNodeå°†ä¸€ç›´ä¿å­˜åœ¨Zookeeperä¸Šã€‚ ZooKeeperåº•å±‚å…¶å®žåªæä¾›äº†ä¸¤ä¸ªåŠŸèƒ½ï¼šâ‘ ç®¡ç†ï¼ˆå­˜å‚¨ã€è¯»å–ï¼‰ç”¨æˆ·ç¨‹åºæäº¤çš„æ•°æ®ï¼›â‘¡ä¸ºç”¨æˆ·ç¨‹åºæäº¤æ•°æ®èŠ‚ç‚¹ç›‘å¬æœåŠ¡ã€‚ åªè¦åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZooKeeperå°±èƒ½æ­£å¸¸æœåŠ¡ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆé›†ç¾¤ä¸ªæ•°ä¸€èˆ¬æ˜¯å¥‡æ•°ã€‚ æˆ‘ä»¬çŸ¥é“åœ¨Zookeeperä¸­Leaderé€‰ä¸¾ç®—æ³•é‡‡ç”¨äº†Zabåè®®ã€‚Zabæ ¸å¿ƒæ€æƒ³æ˜¯å½“å¤šæ•°Serverå†™æˆåŠŸï¼Œåˆ™ä»»åŠ¡æ•°æ®å†™æˆåŠŸã€‚ â‘ å¦‚æžœæœ‰3ä¸ªServerï¼Œåˆ™æœ€å¤šå…è®¸1ä¸ªServeræŒ‚æŽ‰ã€‚ â‘¡å¦‚æžœæœ‰4ä¸ªServerï¼Œåˆ™åŒæ ·æœ€å¤šå…è®¸1ä¸ªServeræŒ‚æŽ‰ã€‚ æ—¢ç„¶3ä¸ªæˆ–è€…4ä¸ªServerï¼ŒåŒæ ·æœ€å¤šå…è®¸1ä¸ªServeræŒ‚æŽ‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å¯é æ€§æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥é€‰æ‹©å¥‡æ•°ä¸ªZooKeeper Serverå³å¯ï¼Œè¿™é‡Œé€‰æ‹©3ä¸ªServerã€‚ å››ã€ä¼šè¯ Sessionæ˜¯æŒ‡å®¢æˆ·ç«¯ä¼šè¯ï¼Œåœ¨è®²è§£å®¢æˆ·ç«¯ä¼šè¯ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹å®¢æˆ·ç«¯è¿žæŽ¥ã€‚åœ¨ZooKeeperä¸­ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥æ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒZooKeeperæœåŠ¡å™¨ä¹‹é—´çš„TCPé•¿è¿žæŽ¥ã€‚ZooKeeperå¯¹å¤–çš„æœåŠ¡ç«¯å£é»˜è®¤æ˜¯2181ï¼Œå®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šä¸ŽæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿žæŽ¥ï¼Œä»Žç¬¬ä¸€æ¬¡è¿žæŽ¥å»ºç«‹å¼€å§‹ï¼Œå®¢æˆ·ç«¯ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå¼€å§‹äº†ï¼Œé€šè¿‡è¿™ä¸ªè¿žæŽ¥ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡å¿ƒè·³æ£€æµ‹å’ŒæœåŠ¡å™¨ä¿æŒæœ‰æ•ˆçš„ä¼šè¯ï¼Œä¹Ÿèƒ½å¤Ÿå‘ZooKeeperæœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶æŽ¥å—å“åº”ï¼ŒåŒæ—¶è¿˜èƒ½é€šè¿‡è¯¥è¿žæŽ¥æŽ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„Watchäº‹ä»¶é€šçŸ¥ã€‚ Sessionçš„SessionTimeoutå€¼ç”¨æ¥è®¾ç½®ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯çš„è¶…æ—¶æ—¶é—´ã€‚å½“ç”±äºŽæœåŠ¡å™¨åŽ‹åŠ›å¤ªå¤§ã€ç½‘ç»œæ•…éšœæˆ–æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿žæŽ¥ç­‰å„ç§åŽŸå› å¯¼è‡´å®¢æˆ·ç«¯è¿žæŽ¥æ–­å¼€æ—¶ï¼Œåªè¦åœ¨SessionTimeoutè§„å®šçš„æ—¶é—´å†…èƒ½å¤Ÿé‡æ–°è¿žæŽ¥ä¸Šé›†ç¾¤ä¸­ä»»æ„ä¸€å°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¹‹å‰åˆ›å»ºçš„ä¼šè¯ä»ç„¶æœ‰æ•ˆã€‚ åœ¨ä¸ºå®¢æˆ·ç«¯åˆ›å»ºä¼šè¯ä¹‹å‰ï¼ŒæœåŠ¡ç«¯é¦–å…ˆä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½åˆ†é…ä¸€ä¸ªsessionIDã€‚ç”±äºŽsessionID æ˜¯Zookeeperä¼šè¯çš„ä¸€ä¸ªé‡è¦æ ‡è¯†ï¼Œè®¸å¤šä¸Žä¼šè¯ç›¸å…³çš„è¿è¡Œæœºåˆ¶éƒ½æ˜¯åŸºäºŽè¿™ä¸ªsessionIDçš„ï¼Œå› æ­¤ï¼Œæ— è®ºæ˜¯å“ªå°æœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ†é…çš„sessionIDï¼Œéƒ½åŠ¡å¿…ä¿è¯å…¨å±€å”¯ä¸€ã€‚ äº”ã€æ•°æ®èŠ‚ç‚¹ Zookeeperå°†æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®æ¨¡åž‹æ˜¯ä¸€æ£µæ ‘ï¼ˆZnode Tree)ï¼Œç”±æ–œæ ï¼ˆ/ï¼‰çš„è¿›è¡Œåˆ†å‰²çš„è·¯å¾„ï¼Œå°±æ˜¯ä¸€ä¸ªZnodeï¼Œä¾‹å¦‚/foo/path1ã€‚æ¯ä¸ªä¸Šéƒ½ä¼šä¿å­˜è‡ªå·±çš„æ•°æ®å†…å®¹ï¼ŒåŒæ—¶è¿˜ä¼šä¿å­˜ä¸€ç³»åˆ—å±žæ€§ä¿¡æ¯ã€‚ å…­ã€Watcher Watcherï¼ˆäº‹ä»¶ç›‘å¬å™¨ï¼‰ï¼Œæ˜¯Zookeeperä¸­çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ã€‚Zookeeperå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº›Watcherï¼Œå¹¶ä¸”åœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼ŒZooKeeperæœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸ŠåŽ»ï¼Œè¯¥æœºåˆ¶æ˜¯Zookeeperå®žçŽ°åˆ†å¸ƒå¼åè°ƒæœåŠ¡çš„é‡è¦ç‰¹æ€§ã€‚ ä¸ƒã€ç‰ˆæœ¬ åœ¨å‰é¢æˆ‘ä»¬å·²ç»æåˆ°ï¼ŒZookeeperçš„æ¯ä¸ªZNodeä¸Šéƒ½ä¼šå­˜å‚¨æ•°æ®ï¼Œå¯¹åº”äºŽæ¯ä¸ªZNodeï¼ŒZookeeperéƒ½ä¼šä¸ºå…¶ç»´æŠ¤ä¸€ä¸ªå«ä½œStatçš„æ•°æ®ç»“æž„ï¼ŒStatä¸­è®°å½•äº†è¿™ä¸ªZNodeçš„ä¸‰ä¸ªæ•°æ®ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯versionï¼ˆå½“å‰ZNodeçš„ç‰ˆæœ¬ï¼‰ã€cversionï¼ˆå½“å‰ZNodeå­èŠ‚ç‚¹çš„ç‰ˆæœ¬ï¼‰å’Œ cversionï¼ˆå½“å‰ZNodeçš„ACLç‰ˆæœ¬ï¼‰ã€‚ Zookeeperé‡‡ç”¨ACLï¼ˆAccessControlListsï¼‰ç­–ç•¥æ¥è¿›è¡Œæƒé™æŽ§åˆ¶ï¼Œç±»ä¼¼äºŽUNIXæ–‡ä»¶ç³»ç»Ÿçš„æƒé™æŽ§åˆ¶ã€‚ CREATE: åˆ›å»ºå­èŠ‚ç‚¹çš„æƒé™ã€‚ READ: èŽ·å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨çš„æƒé™ã€‚ WRITEï¼šæ›´æ–°èŠ‚ç‚¹æ•°æ®çš„æƒé™ã€‚ DELETE: åˆ é™¤å­èŠ‚ç‚¹çš„æƒé™ã€‚ ADMIN: è®¾ç½®èŠ‚ç‚¹ACLçš„æƒé™ã€‚ æ³¨æ„ï¼šCREATE å’Œ DELETE éƒ½æ˜¯é’ˆå¯¹å­èŠ‚ç‚¹çš„æƒé™æŽ§åˆ¶ã€‚ ä¸‹ä¸€èŠ‚å…ˆè¯´è¯´ZABåè®®ã€‚]]></content>
      <tags>
        <tag>zookpeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zookeeperç¬”è®°3-paxosç®—æ³•]]></title>
    <url>%2F2019%2F02%2F22%2Fzookeeper%2FZookeeper%E7%AC%94%E8%AE%B03-paxos%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[æœ‰äººè¯´ä¸€åƒä¸ªäººå°±æœ‰ä¸€åƒä¸ªpaxosç®—æ³•ç†è§£ï¼Œç®—æ³•æœ¬èº«æ™¦æ¶©éš¾æ‡‚ï¼Œå¦‚ä½•å¿«é€Ÿç”ŸåŠ¨ç†è§£paxosæ ¸å¿ƒè¦ç‚¹ä¸€ç›´æ˜¯ä¸€ä¸ªè€å¤§éš¾çš„é—®é¢˜ï¼Œæœ¬æ–‡é›†ç»“å¤šç¯‡æ–‡ç« ç²¾åŽï¼Œç®—æ˜¯ç†é¡ºäº†å…¶ä¸­çš„é—¨é“ã€‚ ä¸€ã€paxosè§£å†³äº†ä»€ä¹ˆé—®é¢˜ åœ¨ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç€é‡æåˆ°äº†è§£å†³ä¸€è‡´æ€§é—®é¢˜çš„ä¸¤ç§åè®®ï¼š2PCå’Œ3PCã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒä¸­ï¼Œè¿™ä¸¤ç§åè®®éƒ½æ— æ³•çœŸæ­£å®žçŽ°ä¸€è‡´æ€§(åˆ†å¸ƒå¼çš„ä¸€è‡´æ€§é—®é¢˜å…¶å®žä¸»è¦æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼Œå°±è¦ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚) åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹é€šä¿¡å­˜åœ¨ä¸¤ç§æ¨¡åž‹ï¼šå…±äº«å†…å­˜ï¼ˆShared memoryï¼‰å’Œæ¶ˆæ¯ä¼ é€’ï¼ˆMessages passingï¼‰ã€‚åŸºäºŽæ¶ˆæ¯ä¼ é€’é€šä¿¡æ¨¡åž‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸å¯é¿å…çš„ä¼šå‘ç”Ÿä»¥ä¸‹é”™è¯¯ï¼š è¿›ç¨‹å¯èƒ½ä¼šæ…¢ã€è¢«æ€æ­»æˆ–è€…é‡å¯ æ¶ˆæ¯å¯èƒ½ä¼šå»¶è¿Ÿã€ä¸¢å¤±ã€é‡å¤ ï¼ˆåœ¨åŸºç¡€ Paxos åœºæ™¯ä¸­ï¼Œå…ˆä¸è€ƒè™‘å¯èƒ½å‡ºçŽ°æ¶ˆæ¯ç¯¡æ”¹å³æ‹œå åº­é”™è¯¯çš„æƒ…å†µï¼‰ â­Paxos ç®—æ³•è§£å†³çš„é—®é¢˜æ˜¯åœ¨ä¸€ä¸ªå¯èƒ½å‘ç”Ÿä¸Šè¿°å¼‚å¸¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä½•å°±æŸä¸ªå€¼è¾¾æˆä¸€è‡´ï¼Œä¿è¯ä¸è®ºå‘ç”Ÿä»¥ä¸Šä»»ä½•å¼‚å¸¸ï¼Œéƒ½ä¸ä¼šç ´åå†³è®®çš„ä¸€è‡´æ€§ã€‚ é‚£ä¹ˆæˆ‘ä»¬å¯ç”¨å½¢è±¡åœ°ç†è§£ä¸ºï¼šPaxoså¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ°‘ä¸»é€‰ä¸¾çš„ç®—æ³•â€”â€”å¤§å¤šæ•°èŠ‚ç‚¹çš„å†³å®šä¼šæˆä¸ªæ•´ä¸ªé›†ç¾¤çš„ç»Ÿä¸€å†³å®šã€‚ä»»ä½•ä¸€ä¸ªç‚¹éƒ½å¯ä»¥æå‡ºè¦ä¿®æ”¹æŸä¸ªæ•°æ®çš„ææ¡ˆï¼Œæ˜¯å¦é€šè¿‡è¿™ä¸ªææ¡ˆå–å†³äºŽè¿™ä¸ªé›†ç¾¤ä¸­æ˜¯å¦æœ‰è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹åŒæ„ã€‚å–å€¼ä¸€æ—¦ç¡®å®šå°†ä¸å†æ›´æ”¹ï¼Œå¹¶ä¸”å¯ä»¥è¢«èŽ·å–åˆ°(ä¸å¯å˜æ€§ï¼Œå¯è¯»å–æ€§)ã€‚ äºŒã€å…¸åž‹åœºæ™¯ ä¸€ä¸ªå…¸åž‹çš„åœºæ™¯æ˜¯ï¼Œåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¦‚æžœå„èŠ‚ç‚¹çš„åˆå§‹çŠ¶æ€ä¸€è‡´ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œç›¸åŒçš„æ“ä½œåºåˆ—ï¼Œé‚£ä¹ˆä»–ä»¬æœ€åŽèƒ½å¾—åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚ä¸ºä¿è¯æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œç›¸åŒçš„å‘½ä»¤åºåˆ—ï¼Œéœ€è¦åœ¨æ¯ä¸€æ¡æŒ‡ä»¤ä¸Šæ‰§è¡Œä¸€ä¸ªâ€œä¸€è‡´æ€§ç®—æ³•â€ä»¥ä¿è¯æ¯ä¸ªèŠ‚ç‚¹çœ‹åˆ°çš„æŒ‡ä»¤ä¸€è‡´ã€‚ æ‰€ä»¥ï¼Œpaxosç®—æ³•ä¸»è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å„ä¸ªèŠ‚ç‚¹éƒ½èƒ½æ‰§è¡Œä¸€ä¸ªç›¸åŒçš„æ“ä½œåºåˆ—ã€‚ ä¸Šå›¾ä¸­ï¼ŒC1æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ŒN1ã€N2ã€N3æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„ä¸‰ä¸ªæœåŠ¡å™¨ï¼Œåˆå§‹çŠ¶æ€ä¸‹N1ã€N2ã€N3ä¸‰ä¸ªæœåŠ¡å™¨ä¸­æŸä¸ªæ•°æ®çš„çŠ¶æ€éƒ½æ˜¯S0ã€‚å½“å®¢æˆ·ç«¯è¦å‘æœåŠ¡å™¨è¯·æ±‚å¤„ç†æ“ä½œåºåˆ—ï¼šop1â€“op2â€“op3æ—¶ï¼ˆopè¡¨ç¤ºoperationï¼‰ å¦‚æžœæƒ³ä¿è¯åœ¨å¤„ç†å®Œå®¢æˆ·ç«¯çš„è¯·æ±‚ä¹‹åŽï¼ŒN1ã€N2ã€N3ä¸‰ä¸ªæœåŠ¡å™¨ä¸­çš„æ•°æ®çŠ¶æ€éƒ½èƒ½ä»ŽS0å˜æˆS1å¹¶ä¸”ä¸€è‡´çš„è¯ï¼ˆæˆ–è€…æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œè¿˜æ˜¯S0çŠ¶æ€ï¼‰ï¼Œå°±è¦ä¿è¯N1ã€N2ã€N3åœ¨æŽ¥æ”¶å¹¶å¤„ç†æ“ä½œåºåˆ—op1â€“op2â€“op3æ—¶ï¼Œä¸¥æ ¼æŒ‰ç…§è§„å®šçš„é¡ºåºæ­£ç¡®æ‰§è¡Œopiï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¸å°±å…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚ æ‰€ä»¥ï¼Œé’ˆå¯¹ä¸Šé¢çš„åœºæ™¯ï¼Œpaxosè§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•ä¾æ¬¡ç¡®å®šä¸å¯å˜æ“ä½œopiçš„å–å€¼ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šç¬¬iä¸ªæ“ä½œä»€ä¹ˆï¼Œåœ¨ç¡®å®šäº†opiçš„å†…å®¹ä¹‹åŽï¼Œå°±å¯ä»¥è®©å„ä¸ªå‰¯æœ¬æ‰§è¡Œopiæ“ä½œã€‚ ä¸‰ã€paxosç®—æ³• 1ã€ç®—æ³•æ¶‰åŠçš„ä¸»è¦è§’è‰²ï¼š Proposerï¼šæè®®è€…ï¼Œæå‡ºè®®æ¡ˆ(åŒæ—¶å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼Œä»–ä»¬å„è‡ªå‘å‡ºææ¡ˆ) Acceptorï¼šæŽ¥å—è€…ï¼Œæ”¶åˆ°è®®æ¡ˆåŽé€‰æ‹©æ˜¯å¦æŽ¥å— Learnerï¼šæœ€ç»ˆå†³ç­–å­¦ä¹ è€…ï¼Œåªå­¦ä¹ æ­£ç¡®çš„å†³è®® Clientï¼šäº§ç”Ÿè®®é¢˜è€…ï¼Œå‘èµ·æ–°çš„è¯·æ±‚ ä¸»è¦çš„è§’è‰²å°±æ˜¯â€œæè®®è€…â€å’Œâ€œæŽ¥å—è€…â€ã€‚å…ˆæœ‰æè®®ï¼Œå†æ¥è¡¨å†³ã€‚ï¼ˆæ³¨ï¼šå®žé™…åº”ç”¨ä¸­ï¼Œå¯ä»¥å°†ä¸€å †æœåŠ¡å™¨ä»»æ„æŒ‡å®šè§’è‰²ï¼Œä¸€éƒ¨åˆ†åšâ€œæè®®è€…â€ã€ä¸€éƒ¨åˆ†åšâ€œæŽ¥å—è€…â€ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šç‰¹å®šçš„æœåŠ¡å™¨åšâ€œæè®®è€…â€ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯â€œæŽ¥å—è€…â€ã€‚ï¼‰ Proposerå°±åƒClientçš„ä»£ç†äººï¼Œç”±Proposeræ‹¿ç€Clientçš„è®®é¢˜åŽ»å‘Acceptoræè®®ï¼Œè®©Acceptoræ¥åšå‡ºå†³ç­–ã€‚ è¿™å¹…å›¾è¡¨ç¤ºçš„æ˜¯è§’è‰²ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œæ¯ä¸€ç§è§’è‰²å°±ä»£è¡¨äº†ä¸€ç§èŠ‚ç‚¹ç±»åž‹ã€‚åœ¨ç‰©ç†éƒ¨ç½²çŽ¯èŠ‚ï¼Œå¯ä»¥æŠŠæ¯ä¸€ç§è§’è‰²éƒ½éƒ¨ç½²åœ¨ä¸€å°ç‰©ç†æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥ç»„åˆä»»ä½•ä¸¤ç§æˆ–è€…å¤šç§è§’è‰²éƒ¨ç½²åœ¨ä¸€å°ç‰©ç†æœºå™¨ä¸Šï¼Œç”šè‡³äºŽï¼ŒæŠŠè¿™å››ç§è§’è‰²éƒ½éƒ¨ç½²åœ¨åŒä¸€å°ç‰©ç†æœºå™¨ä¸Šä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ 2ã€å…³äºŽè¿™ä¸¤é˜¶æ®µçš„ç†è§£ ä»Žä¸€ä¸ªæ•…äº‹è¯´èµ·ã€‚ ä»Žå‰ï¼Œåœ¨å›½çŽ‹Leslie Lamportçš„ç»Ÿæ²»ä¸‹ï¼Œæœ‰ä¸ªé»‘æš—çš„å¸Œè…ŠåŸŽé‚¦å«paxosã€‚åŸŽé‚¦é‡Œæœ‰3ç±»äººï¼Œ å†³ç­–è€… æè®®è€… ç¾¤ä¼— è™½ç„¶è¿™æ˜¯ä¸€ä¸ªé»‘æš—çš„åŸŽé‚¦ä½†æ˜¯å¾ˆæ°‘ä¸»ï¼ŒæŒ‰ç…§è®®ä¼šæ°‘ä¸»åˆ¶çš„æ”¿æ²»æ¨¡å¼åˆ¶è®¢æ³•å¾‹ï¼Œç¾¤ä¼—æœ‰ä»€ä¹ˆå»ºè®®å’Œæ„è§éƒ½å¯ä»¥å†™ææ¡ˆäº¤ç»™æè®®è€…ï¼Œæè®®è€…ä¼šæŠŠææ¡ˆäº¤ç»™å†³ç­–è€…æ¥å†³ç­–ï¼Œå†³ç­–è€…æœ‰å¥‡æ•°ä¸ªï¼Œä¸ºä»€ä¹ˆè¦å¥‡æ•°ä¸ªï¼Ÿå¾ˆç®€å•å› ä¸ºå†³ç­–çš„æ–¹å¼å¾ˆæ— è„‘ï¼Œå°‘æ•°æœä»Žå¤šæ•°ã€‚æœ€åŽå†³ç­–è€…æŠŠåˆšå‡ºç‚‰çš„å†³ç­–æ˜­å‘Šå¤©ä¸‹ï¼Œç¾¤ä¼—å¾—çŸ¥å†³ç­–ç»“æžœã€‚ ç­‰ä¸€ä¸‹ï¼Œé‚£å“ªé‡Œé»‘æš—å‘¢ï¼Ÿé—®é¢˜å°±å‡ºåœ¨â€œæè®®è€…ä¼šæŠŠææ¡ˆäº¤ç»™å†³ç­–è€…æ¥å†³ç­–â€ï¼Œé‚£ä¹ˆå¤šææ¡ˆå†³ç­–è€…å…ˆå†³ç­–è°çš„ï¼Ÿè°ç»™çš„é’±å¤šå°±å†³ç­–è°çš„ã€‚ é‚£è¿™æ ·ä¼šæœ‰å‡ ä¸ªé—®é¢˜ï¼Œå†³ç­–è€…é‚£ä¹ˆå¤šï¼Œæ€Žä¹ˆä¿è¯æœ€åŽå†³ç­–çš„æ˜¯åŒä¸€ä¸ªææ¡ˆï¼Œä»¥åŠæ€Žä¹ˆä¿è¯æ‹¿åˆ°æ‰€æœ‰æè®®è€…ä¸­æœ€é«˜çš„æŠ¥ä»·ã€‚ èªæ˜Žåˆè´ªå©ªçš„å†³ç­–è€…æƒ³åˆ°äº†ä¸€ä¸ªåŠžæ³•ï¼šåˆ†ä¸¤é˜¶æ®µæŠ¥ä»· ç¬¬ä¸€é˜¶æ®µï¼š å†³ç­–è€…æŽ¥å—æ‰€æœ‰æ¯”ä»–å½“å‰æŒæœ‰æŠ¥ä»·é«˜çš„æŠ¥ä»·ï¼Œä¸”ä¸ä¼šé€šçŸ¥ä¹‹å‰æŠ¥ä»·çš„äºº æè®®è€…ç»™æ‰€æœ‰(ä¸€åŠä»¥ä¸Šå³å¯)å†³ç­–è€…æŠ¥ä»·ï¼Œè‹¥æœ‰äººæ¯”è‡ªå·±æŠ¥ä»·é«˜å°±åŠ ä»·ï¼Œæœ‰åŠæ•°ä»¥ä¸Šå†³ç­–è€…æŽ¥å—è‡ªå·±æŠ¥ä»·å°±åœæ­¢æŠ¥ä»·ã€‚ ä¸€æ—¦æŸä¸ªæè®®è€…æ”¶åˆ°äº†æ‰€æœ‰å†³ç­–è€…ä¸­ä¸€åŠä»¥ä¸Šçš„äººåŒæ„çš„å›žå¤ã€‚å°±ä¼šè¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚ ç¬¬äºŒé˜¶æ®µï¼š æè®®è€…åŽ»æ‰¾æ”¶è¿‡è‡ªå·±é’±çš„å¤§ä½¬ç­¾åˆåŒï¼Œè¿™é‡Œæœ‰3ç§æƒ…å†µï¼š å¾ˆå¤šå¤§ä½¬æ”¶äº†åˆ«äººæ›´é«˜çš„ä»·ï¼Œè¾¾ä¸åˆ°ä¸€åŠäººæ•°äº†ï¼Œåªå¥½å›žåŽ»æ‹¿é’±ç»§ç»­è´¿èµ‚ï¼Œå›žåˆ°ç¬¬ä¸€é˜¶æ®µé‡æ–°å‡çº§; å¤§ä½¬æ”¶åˆ°çš„æœ€é«˜æŠ¥ä»·æ˜¯è‡ªå·±çš„ï¼Œç¾Žæ»‹æ»‹ï¼ŒåŠæ•°ä»¥ä¸ŠæˆåŠŸç­¾åˆåŒï¼Œææ¡ˆæˆåŠŸ; æè®®è€…å›žåŽ»æ‹¿é’±å›žæ¥ç»§ç»­è´¿èµ‚çš„æ—¶å€™å‘çŽ°åˆåŒå·²ç»è¢«ç­¾äº†ä¸”åŠæ•°ä»¥ä¸Šéƒ½ç­¾äº†è¿™ä¸ªææ¡ˆï¼Œä¸å¹²äº†ï¼Œèµ¶å¿«æŠŠè‡ªå·±çš„ææ¡ˆæ¢æˆå·²ç»ç­¾äº†çš„ææ¡ˆï¼Œå†åŽ»æç»™æ‰€æœ‰å¤§ä½¬ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åˆ†ä¸€æ¯ç¾¹é‡è§è¿˜æ²¡ç­¾çš„å¤§ä½¬ã€‚ æœ€åŽä¸€æ­¥å°±æ˜¯è®©æ‰€æœ‰èŠ‚ç‚¹çŸ¥é“è¿™ä¸ªè¿‡åŠé€šè¿‡çš„æè®®æ˜¯ä»€ä¹ˆï¼Œä»Žè€Œè¾¾åˆ°æœ€ç»ˆçš„ä¸€è‡´ã€‚ ä¸‰ã€æ·±åŒ–ç†è§£ å‡è®¾æœ‰ä¸¤ä¸ªâ€œæè®®è€…â€å’Œä¸‰ä¸ªâ€œæŽ¥å—è€…â€ã€‚ä¸‹é¢è¿™ä¸€å¨çš„å†…å®¹ä¸€å¼€å§‹å¦‚æžœçœ‹ä¸æ˜Žç™½ä¸è¦ç´§ï¼Œç«‹å³è½¬åˆ°ä¸‹é¢çš„å›¾ç¤ºè¿‡ç¨‹ï¼Œçœ‹æ‡‚å›¾ç¤ºå†å›žè¿‡å¤´æ¥å°±ä¼šç†è§£äº†ã€‚ æ€Žä¹ˆæ˜Žç¡®æ„è§é¢†è¢–å‘¢ï¼Ÿé€šè¿‡ç¼–å·ã€‚æ¯ä¸ªâ€œæè®®è€…â€åœ¨ç¬¬ä¸€é˜¶æ®µå…ˆæŠ¥ä¸ªå·ï¼Œè°çš„å·å¤§ï¼Œè°å°±æ˜¯æ„è§é¢†è¢–ã€‚å¦‚æžœä¸å¥½ç†è§£ï¼Œå¯ä»¥æƒ³è±¡ä¸ºè´¿é€‰ã€‚æ¯ä¸ªæè®®è€…å…ˆæ‹¿ç€é’žç¥¨è´¿èµ‚ä¸€åœˆâ€œæŽ¥å—è€…â€ï¼Œè°ç»™çš„é’±å¤šï¼Œç¬¬äºŒé˜¶æ®µâ€œæŽ¥å—è€…â€å°±å¬è°çš„ã€‚æ„è§é¢†è¢–ç†è§£ä¸ºè´¿èµ‚ä¸­èƒœå‡ºçš„â€œæè®®è€…â€å³å¯ã€‚ æœ‰ä¸ªè·Ÿé€‰ä¸¾å¸¸è¯†ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œå°±æ˜¯æ¯ä¸ªâ€œæè®®è€…â€ä¸ä¼šæ‰§ç€äºŽè®©è‡ªå·±çš„æè®®é€šè¿‡ï¼Œè€Œæ˜¯æ¯ä¸ªâ€œæè®®è€…â€ä¼šæ‰§ç€äºŽè®©æè®®å°½å¿«è¾¾æˆä¸€è‡´æ„è§ã€‚æ‰€ä»¥ï¼Œä¸ºäº†è¿™ä¸ªç›®æ ‡ï¼Œå¦‚æžœâ€œæè®®è€…â€åœ¨è´¿é€‰çš„æ—¶å€™ï¼Œå‘çŽ°â€œæŽ¥å—è€…â€å·²ç»æŽ¥å—è¿‡å‰é¢æ„è§é¢†è¢–çš„æè®®äº†ï¼Œå³ä¾¿â€œæè®®è€…â€è´¿é€‰æˆåŠŸï¼Œä¹Ÿä¼šé»˜é»˜çš„æŠŠè‡ªå·±çš„æè®®æ”¹ä¸ºå‰é¢æ„è§é¢†è¢–çš„æè®®ã€‚æ‰€ä»¥ä¸€æ—¦è´¿èµ‚æˆåŠŸï¼Œèƒœå‡ºçš„â€œæè®®è€…â€å†æå‡ºæè®®ï¼Œæè®®å†…å®¹ä¹Ÿæ˜¯å‰é¢æ„è§é¢†è¢–çš„æè®®ï¼ˆè¿™æ ·ï¼Œåœ¨è°‹æ±‚å°½æ—©å½¢æˆå¤šæ•°æ´¾çš„è·¯ä¸Šï¼Œåˆå‰è¿›äº†ä¸€æ­¥ï¼‰ã€‚ é’±çš„å¤šå°‘å¾ˆé‡è¦ï¼Œå¦‚æžœé’±å°‘äº†ï¼Œæ— è®ºåœ¨ç¬¬ä¸€è¿˜æ˜¯ç¬¬äºŒé˜¶æ®µâ€œæŽ¥å—è€…â€éƒ½ä¸ä¼šé¸Ÿä½ ï¼Œç›´æŽ¥æ‹’ç»ã€‚ ä¸Šé¢è®²åˆ°ï¼Œå¦‚æžœâ€œæè®®è€…â€åœ¨è´¿é€‰æ—¶ï¼Œå‘çŽ°å‰é¢å·²ç»æœ‰æ„è§é¢†è¢–çš„æè®®ï¼Œé‚£å°±å°†è‡ªå·±çš„æè®®é»˜é»˜æ”¹æˆå‰é¢æ„è§é¢†è¢–çš„æè®®ã€‚è¿™é‡Œæœ‰ä¸€ç§æƒ…å†µï¼Œå¦‚æžœä½ æ˜¯â€œæè®®è€…â€ï¼Œåœ¨è´¿èµ‚çš„æ—¶å€™ï¼Œâ€œæŽ¥å—è€…1â€è·Ÿä½ è¯´â€œä»–è§è¿‡çš„æ„è§é¢†è¢–çš„æè®®æ˜¯æ–¹æ¡ˆ1â€ï¼Œè€Œâ€œæŽ¥å—è€…2â€è·Ÿä½ è¯´â€œä»–è§è¿‡çš„æ„è§é¢†è¢–æè®®æ˜¯æ–¹æ¡ˆ2â€ï¼Œä½ è¯¥æ€Žä¹ˆåŠžï¼Ÿè¿™æ—¶çš„åŽŸåˆ™ä¹Ÿå¾ˆç®€å•ï¼Œè¿˜æ˜¯ï¼šé’±çš„å¤šå°‘å¾ˆé‡è¦ï¼ä½ åˆ¤æ–­ä¸€ä¸‹æ˜¯â€œæŽ¥å—è€…1â€è§è¿‡çš„æ„è§é¢†è¢–æœ‰é’±ï¼Œè¿˜æ˜¯â€œæŽ¥å—è€…2â€è§è¿‡çš„æ„è§é¢†è¢–æœ‰é’±ï¼Ÿå¦‚ä½•åˆ¤æ–­å‘¢ï¼Ÿå› ä¸ºâ€œæŽ¥å—è€…â€åœ¨è¢«â€œæè®®è€…â€è´¿èµ‚çš„æ—¶å€™ï¼Œè‡ªå·±ä¼šè®°ä¸‹è´¿èµ‚çš„é‡‘é¢ã€‚æ‰€ä»¥å½“ä½ è´¿èµ‚â€œæŽ¥å—è€…â€æ—¶ï¼Œä¸€æ—¦ä½ ç»™çš„è´¿èµ‚å¤šè€Œèƒœå‡ºï¼Œâ€œæŽ¥å—è€…â€ä¼šå‘Šè¯‰ä½ ä¸¤ä»¶äº‹æƒ…ï¼ša.å‰ä»»æ„è§é¢†è¢–çš„æè®®å†…å®¹ï¼ˆå¦‚æžœæœ‰çš„è¯ï¼‰ï¼Œb.å‰ä»»æ„è§é¢†è¢–å½“æ—¶è´¿èµ‚äº†å¤šå°‘é’±ã€‚è¿™æ ·ï¼Œå†é¢å¯¹åˆšæ‰çš„æƒ…æ™¯æ—¶ï¼Œä½ åªéœ€è¦åˆ¤æ–­ä¸€ä¸‹â€œæŽ¥å—è€…1â€å’Œâ€œæŽ¥å—è€…2â€å‘Šè¯‰ä½ çš„ä¿¡æ¯ä¸­ï¼Œå“ªä¸ªæ„è§é¢†è¢–å½“æ—¶ç»™çš„é’±å¤šï¼Œé‚£ä½ å°±é»˜é»˜çš„æŠŠè‡ªå·±çš„æè®®ï¼Œæ”¹æˆé‚£ä¸ªæ„è§é¢†è¢–çš„æè®®ã€‚ åœ¨æ•´ä¸ªé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªäººè°å…ˆæ¥è°åŽåˆ°ï¼Œâ€œæŽ¥å—è€…â€ä»€ä¹ˆæ—¶é—´èƒ½å¤ŸæŽ¥åˆ°â€œæè®®è€…â€çš„ä¿¡æ¯ï¼Œæ˜¯å®Œå…¨ä¸å¯æŽ§çš„ã€‚æ‰€ä»¥å¾ˆå¯èƒ½ä¸€ä¸ªæ„è§é¢†è¢–å·²ç»äº§ç”Ÿäº†ï¼Œä½†æ˜¯ç”±äºŽè¿™ä¸ªæ„è§é¢†è¢–çš„ç¬¬äºŒé˜¶æ®µåˆšåˆšå¼€å§‹ï¼Œç»å¤§éƒ¨åˆ†â€œæŽ¥å—è€…â€è¿˜æ²¡æœ‰æ”¶åˆ°è¿™ä¸ªæ„è§é¢†è¢–çš„æè®®ã€‚ç»“æžœï¼Œè¿™æ—¶çªç„¶å†²è¿›æ¥äº†ä¸€ä¸ªæ–°çš„åœŸè±ªâ€œæè®®è€…â€ï¼Œé‚£ä¹ˆè¿™ä¸ªåœŸè±ªâ€œæè®®è€…â€ä¹Ÿæ˜¯æœ‰æœºä¼šè®©è‡ªå·±çš„æè®®èƒœå‡ºçš„ï¼è¿™æ—¶å°±å½¢æˆäº†ä¸€ç§åšå¼ˆï¼ša.ä¸Šä¸€ä¸ªæ„è§é¢†è¢–è¦èµ¶åœ¨åœŸè±ªâ€œæè®®è€…â€è´¿èµ‚åˆ°â€œæŽ¥å—è€…â€å‰ï¼Œèµ¶åˆ°â€œæŽ¥å—è€…â€é¢å‰è®©ä»–æŽ¥å—è‡ªå·±çš„æè®®ï¼Œå¦åˆ™ä¼šå› ä¸ºè‡ªå·±çš„ä¹‹å‰è´¿èµ‚çš„é’±æ¯”åœŸè±ªå°‘è€Œè¢«æ‹’ç»ã€‚b.åœŸè±ªâ€œæè®®è€…â€è¦èµ¶åœ¨ä¸Šä¸€ä¸ªæ„è§é¢†è¢–å°†æè®®ä¼ è¾¾ç»™â€œæŽ¥å—è€…â€å‰ï¼Œè´¿èµ‚åˆ°â€œæŽ¥å—è€…â€ï¼Œå¦åˆ™åœŸè±ªâ€œæè®®è€…â€å³ä¾¿è´¿èµ‚æˆåŠŸï¼Œä¹Ÿè¦é»˜é»˜çš„å°†è‡ªå·±çš„æè®®æ”¹ä¸ºå‰ä»»æ„è§é¢†è¢–çš„æè®®ã€‚è¿™æ•´ä¸ªåšå¼ˆçš„è¿‡ç¨‹ï¼Œæœ€ç»ˆå°±çœ‹è¿™ä¸¤ä¸ªâ€œæè®®è€…â€è°çš„è¿›å±•å¿«äº†ã€‚ä½†æœ€ç»ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªæ„è§é¢†è¢–ï¼Œå…ˆå¾—åˆ°å¤šæ•°â€œæŽ¥å—è€…â€çš„è®¤å¯ï¼Œé‚£ä»–çš„æè®®å°±èƒœå‡ºäº†ã€‚è¿™ä¸€å—ä¸ç†è§£å°±çœ‹ä¸‹é¢çš„åˆ†è§£è¯´æ˜Žã€‚ 1ï¼‰é¦–å…ˆâ€œæè®®è€…1â€è´¿èµ‚äº†3ä¸ªâ€œæŽ¥å—è€…â€ 2ï¼‰3ä¸ªâ€œæŽ¥å—è€…â€è®°å½•ä¸‹è´¿èµ‚é‡‘é¢ï¼Œå› ä¸ºç›®å‰åªæœ‰ä¸€ä¸ªâ€œæè®®è€…â€å‡ºä»·ï¼Œå› æ­¤$1å°±æ˜¯æœ€é«˜çš„äº†ï¼Œæ‰€ä»¥â€œæŽ¥å—è€…â€ä»¬è¿”å›žè´¿èµ‚æˆåŠŸã€‚æ­¤å¤–ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•å…ˆå‰çš„æ„è§é¢†è¢–æå‡ºçš„æè®®ï¼Œå› æ­¤â€œæŽ¥å—è€…â€ä»¬å‘Šè¯‰â€œæè®®è€…1â€æ²¡æœ‰ä¹‹å‰æŽ¥å—è¿‡çš„æè®®ï¼ˆè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰ä¸Šä¸€ä¸ªæ„è§é¢†è¢–çš„è´¿èµ‚é‡‘é¢äº†ï¼‰ã€‚ å‡å¦‚æ­¤æ—¶ç”±äºŽè´¿èµ‚çš„äººæ•°è¶…è¿‡äº†ä¸€åŠï¼Œé‚£ä¹ˆç¬¬ä¸€é˜¶æ®µæˆåŠŸï¼Œå‡†å¤‡è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼Œå°±æ˜¯æ­£å¼ç­¾åˆåŒï¼Œç­¾è¶…è¿‡åŠæ•°çš„åˆåŒæ‰çœŸæ­£è¡¨ç¤ºæœ¬è½®æˆåŠŸã€‚ 3ï¼‰â€œæè®®è€…1â€å‘çŽ°æœ‰è¶…è¿‡ä¸€åŠäººæŽ¥å—äº†è‡ªå·±çš„è´¿èµ‚ï¼Œä¸‹é¢å°±è¦çœŸæ­£å‘èµ·æè®®äº†ï¼Œå…ˆå‘â€œæŽ¥å—è€…1â€æå‡ºäº†è‡ªå·±çš„æè®®ï¼š1å·æè®®ï¼Œå¹¶å‘ŠçŸ¥è‡ªå·±ä¹‹å‰å·²è´¿èµ‚$1ã€‚ 4ï¼‰â€œæŽ¥å—è€…1â€æ£€æŸ¥äº†ä¸€ä¸‹ï¼Œç›®å‰è®°å½•çš„è´¿èµ‚é‡‘é¢å°±æ˜¯$1ï¼ŒäºŽæ˜¯æŽ¥å—äº†è¿™ä¸€æè®®ï¼Œå¹¶æŠŠ1å·æè®®è®°å½•åœ¨æ¡ˆã€‚ 5ï¼‰åœ¨â€œæè®®è€…1â€å‘â€œæŽ¥å—è€…2â€â€œæŽ¥å—è€…3â€å‘èµ·æè®®å‰ï¼ŒåœŸè±ªâ€œæè®®è€…2â€å‡ºçŽ°ï¼Œä»–å¼€å§‹ç”¨$2è´¿èµ‚â€œæŽ¥å—è€…1â€ä¸Žâ€œæŽ¥å—è€…2â€ã€‚ 6ï¼‰â€œæŽ¥å—è€…1â€ä¸Žâ€œæŽ¥å—è€…2â€ç«‹åˆ»è¢«æ”¶ä¹°ï¼Œå°†è´¿èµ‚é‡‘é¢æ”¹ä¸º$2ã€‚ä½†æ˜¯ï¼Œä¸åŒçš„æ˜¯ï¼šâ€œæŽ¥å—è€…1â€å‘Šè¯‰â€œæè®®è€…2â€,ä¹‹å‰æˆ‘å·²ç»æŽ¥å—è¿‡1å·æè®®äº†ï¼ŒåŒæ—¶1å·æè®®çš„â€œæè®®è€…â€è´¿èµ‚è¿‡$1ï¼›è€Œï¼Œâ€œæŽ¥å—è€…2â€å‘Šè¯‰â€œæè®®è€…2â€ï¼Œä¹‹å‰æ²¡æœ‰æŽ¥å—è¿‡å…¶ä»–æ„è§é¢†è¢–çš„æè®®ï¼Œä¹Ÿæ²¡æœ‰ä¸Šä¸€ä¸ªæ„è§é¢†è¢–çš„è´¿èµ‚é‡‘é¢ã€‚ 7ï¼‰è¿™æ—¶ï¼Œâ€œæè®®è€…1â€å›žè¿‡ç¥žæ¥äº†ï¼Œä»–å‘â€œæŽ¥å—è€…2â€å’Œâ€œæŽ¥å—è€…3â€å‘èµ·1å·æè®®ï¼Œå¹¶å¸¦ç€ä¿¡æ¯â€œæˆ‘å‰æœŸå·²ç»è´¿èµ‚è¿‡$1â€ã€‚ 8ï¼‰â€œæŽ¥å—è€…2â€â€œæŽ¥å—è€…3â€å¼€å§‹ç­”å¤ï¼šâ€œæŽ¥å—è€…2â€æ£€æŸ¥äº†ä¸€ä¸‹è‡ªå·±è®°å½•çš„è´¿èµ‚é‡‘é¢ï¼Œç„¶åŽè¡¨ç¤ºï¼Œå·²ç»æœ‰äººå‡ºä»·åˆ°$2äº†ï¼Œè€Œä½ ä¹‹å‰åªå‡ºåˆ°$1ï¼Œä¸æŽ¥å—ä½ çš„æè®®ï¼Œå†è§ã€‚ä½†â€œæŽ¥å—è€…3â€æ£€æŸ¥äº†ä¸€ä¸‹è‡ªå·±è®°å½•çš„è´¿èµ‚é‡‘é¢ï¼Œç›®å‰è®°å½•çš„è´¿èµ‚é‡‘é¢å°±æ˜¯$1ï¼ŒäºŽæ˜¯æŽ¥å—äº†è¿™ä¸€æè®®ï¼Œå¹¶æŠŠ1å·æè®®è®°å½•åœ¨æ¡ˆã€‚ 9ï¼‰åˆ°è¿™é‡Œï¼Œâ€œæè®®è€…1â€å·²ç»å¾—åˆ°ä¸¤ä¸ªæŽ¥å—è€…çš„èµžåŒï¼Œå·²ç»å¾—åˆ°äº†å¤šæ•°â€œæŽ¥å—è€…â€çš„èµžåŒã€‚äºŽæ˜¯â€œæè®®è€…1â€ç¡®å®š1å·æè®®æœ€ç»ˆé€šè¿‡ã€‚ 10ï¼‰æ­¤æ—¶â€œæè®®è€…2â€å‘çŽ°1å·æè®®å·²ç»è¢«é€šè¿‡äº†ï¼Œä¸ºäº†æœ€å¿«è¾¾æˆä¸€è‡´ï¼Œé‚£ä¹ˆä»–å°±é»˜é»˜åœ°å°†è‡ªå·±çš„æè®®ä¹Ÿæ”¹ä¸ºä¸Ž1å·æè®®ä¸€è‡´ï¼Œç„¶åŽå¼€å§‹å‘â€œæŽ¥å—è€…1â€â€œæŽ¥å—è€…2â€å‘èµ·æè®®ï¼ˆæè®®å†…å®¹ä»ç„¶æ˜¯1å·æè®®ï¼‰ï¼Œå¹¶å¸¦ç€ä¿¡æ¯ï¼šä¹‹å‰è‡ªå·±å·²è´¿èµ‚è¿‡$2ã€‚ 11ï¼‰è¿™æ—¶â€œæŽ¥å—è€…1â€â€œæŽ¥å—è€…2â€æ”¶åˆ°â€œæè®®è€…2â€çš„æè®®åŽï¼Œç…§ä¾‹å…ˆæ¯”å¯¹ä¸€ä¸‹è´¿èµ‚é‡‘é¢ï¼Œæ¯”å¯¹å‘çŽ°â€œæè®®è€…2â€ä¹‹å‰å·²è´¿èµ‚$2ï¼Œå¹¶ä¸”è‡ªå·±è®°å½•çš„è´¿èµ‚é‡‘é¢ä¹Ÿæ˜¯$2ï¼Œæ‰€ä»¥æŽ¥å—ä»–çš„æè®®ï¼Œä¹Ÿå°±æ˜¯éƒ½æŽ¥å—1å·æè®®ã€‚ 12ï¼‰äºŽæ˜¯ï¼Œâ€œæè®®è€…2â€ä¹Ÿæ‹¿åˆ°äº†å¤šæ•°æ´¾çš„æ„è§ï¼Œæœ€ç»ˆé€šè¿‡çš„ä¹Ÿæ˜¯1å·æè®®ã€‚ å›žåˆ°ä¸Šé¢çš„ç¬¬5ï¼‰æ­¥ï¼Œå¦‚æžœâ€œæè®®è€…2â€ç¬¬ä¸€æ¬¡å…ˆåŽ»è´¿èµ‚â€œæŽ¥å—è€…2â€â€œæŽ¥å—è€…3â€ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿé‚£å¾ˆå¯èƒ½1å·æè®®å°±ä¸ä¼šæˆä¸ºæœ€ç»ˆé€‰å‡ºçš„æè®®ã€‚å› ä¸ºå½“â€œæè®®è€…2â€å…ˆè´¿èµ‚åˆ°äº†â€œæŽ¥å—è€…2â€â€œæŽ¥å—è€…3â€ï¼Œé‚£ç­‰â€œæè®®è€…1â€å¸¦ç€è®®é¢˜å†åŽ»æ‰¾è¿™ä¸¤ä½çš„æ—¶å€™ï¼Œå°±ä¼šå› ä¸ºä¹‹å‰è´¿èµ‚çš„é’±å°‘ï¼ˆ$1&lt;$2ï¼‰è€Œè¢«æ‹’ç»ã€‚æ‰€ä»¥ï¼Œè¿™ä¹Ÿå°±æ˜¯åˆšæ‰è®²åˆ°å¯èƒ½å­˜åœ¨åšå¼ˆçš„åœ°æ–¹ï¼ša.â€œæè®®è€…1â€è¦èµ¶åœ¨â€œæè®®è€…2â€è´¿èµ‚åˆ°â€œæŽ¥å—è€…2â€â€œæŽ¥å—è€…3â€ä¹‹å‰ï¼Œè®©â€œæŽ¥å—è€…2â€â€œæŽ¥å—è€…3â€æŽ¥å—è‡ªå·±çš„æ„è§ï¼Œå¦åˆ™â€œæè®®è€…1â€ä¼šå› ä¸ºé’±å°‘è€Œè¢«æ‹’ç»ï¼›b.â€œæè®®è€…2â€è¦èµ¶åœ¨â€œæè®®è€…1â€ä¹‹å‰è´¿èµ‚åˆ°â€œæŽ¥å—è€…â€ï¼Œå¦åˆ™â€œæè®®è€…2â€å³ä¾¿è´¿èµ‚æˆåŠŸï¼Œä¹Ÿè¦é»˜é»˜çš„å°†è‡ªå·±çš„æè®®æ”¹ä¸ºâ€œæè®®è€…1â€çš„æè®®ã€‚ä½†ä½ å¾€åŽæŽ¨æ¼”ä¼šå‘çŽ°ï¼Œæ— è®ºå¦‚ä½•ï¼Œæ€»ä¼šæœ‰ä¸€ä¸ªâ€œæè®®è€…â€çš„æè®®èŽ·å¾—å¤šæ•°ç¥¨è€Œèƒœå‡ºã€‚ äº”ã€æ€»ç»“ å¥½å•¦ï¼Œæ•…äº‹åˆ°è¿™é‡ŒåŸºæœ¬è®²è¿°å®Œäº†ï¼Œå’±ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œå…¶å®žPaxosç®—æ³•å°±ä¸‹é¢è¿™ä¹ˆå‡ ä¸ªåŽŸåˆ™ï¼š Paxosç®—æ³•åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼šç¬¬ä¸€ä¸ªé˜¶æ®µä¸»è¦æ˜¯è´¿é€‰ï¼Œè¿˜æ²¡æœ‰æå‡ºæè®®ï¼›ç¬¬äºŒä¸ªé˜¶æ®µä¸»è¦æ ¹æ®ç¬¬ä¸€é˜¶æ®µçš„ç»“æžœï¼Œæ˜Žç¡®æŽ¥å—è°çš„æè®®ï¼Œå¹¶æ˜Žç¡®æè®®çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼ˆè¿™ä¸ªæè®®å¯èƒ½æ˜¯è´¿é€‰èƒœå‡ºâ€œæè®®è€…â€è‡ªå·±çš„æè®®ï¼Œä¹Ÿå¯èƒ½æ˜¯å‰ä»»æ„è§é¢†è¢–çš„æè®®ï¼Œå…·ä½“æ˜¯å“ªä¸ªæè®®ï¼Œè§ä¸‹é¢ç¬¬3ç‚¹åŽŸåˆ™ï¼‰ã€‚ ç¼–å·ï¼ˆè´¿èµ‚é‡‘é¢ï¼‰å¾ˆé‡è¦ï¼Œæ— è®ºåœ¨å“ªä¸ªé˜¶æ®µï¼Œç¼–å·ï¼ˆè´¿èµ‚é‡‘é¢ï¼‰å°çš„ï¼Œéƒ½ä¼šè¢«é„™è§†ï¼ˆè¢«æ‹’ç»ï¼‰ã€‚ åœ¨ç¬¬ä¸€é˜¶æ®µä¸­ï¼Œä¸€æ—¦â€œæŽ¥å—è€…â€å·²ç»æŽ¥å—äº†ä¹‹å‰æ„è§é¢†è¢–çš„æè®®ï¼Œé‚£åŽé¢å†æ¥æ‰¾è¿™ä¸ªâ€œæŽ¥å—è€…â€çš„â€œæè®®è€…â€ï¼Œå³ä¾¿åœ¨è´¿èµ‚ä¸­èƒœå‡ºï¼Œä¹Ÿè¦è¢«æ´—è„‘ï¼Œé»˜é»˜å°†è‡ªå·±çš„æè®®æ”¹ä¸ºå‰ä»»æ„è§é¢†è¢–çš„æè®®ï¼Œç„¶åŽä»–ä¼šåœ¨ç¬¬äºŒé˜¶æ®µæå‡ºè¯¥æè®®ï¼ˆä¹Ÿå°±æ˜¯ä¹‹å‰æ„è§é¢†è¢–çš„æè®®ï¼Œä»¥åŠ›äº‰è®©å¤§å®¶çš„æ„è§è¶‹åŒï¼‰ã€‚å¦‚æžœâ€œæŽ¥å—è€…â€ä¹‹å‰æ²¡æœ‰æŽ¥å—è¿‡ä»»ä½•æè®®ï¼Œé‚£è´¿é€‰èƒœå‡ºçš„â€œæè®®è€…â€å°±å¯ä»¥æå‡ºè‡ªå·±çš„æè®®äº†ã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è€ƒé‡ï¼Œå‡å¦‚proposer Aå‘èµ·IDä¸ºnçš„æè®®ï¼Œåœ¨æè®®æœªå®Œæˆå‰proposer Båˆå‘èµ·IDä¸ºn+1çš„æè®®ï¼Œåœ¨n+1æè®®æœªå®Œæˆå‰proposer Cåˆå‘èµ·IDä¸ºn+2çš„æè®®â€¦â€¦ å¦‚æ­¤acceptorä¸èƒ½å®Œæˆå†³è®®ã€å½¢æˆæ´»é”(livelock)ï¼Œè™½ç„¶è¿™ä¸å½±å“ä¸€è‡´æ€§ï¼Œä½†æˆ‘ä»¬ä¸€èˆ¬ä¸æƒ³è®©è¿™æ ·çš„æƒ…å†µå‘ç”Ÿã€‚è§£å†³çš„æ–¹æ³•æ˜¯ä»Žproposerä¸­é€‰å‡ºä¸€ä¸ªleaderï¼Œæè®®ç»Ÿä¸€ç”±leaderå‘èµ·ã€‚ å¦‚ä½•æµ…æ˜¾æ˜“æ‡‚åœ°è§£è¯´ Paxos çš„ç®—æ³•ï¼Ÿ å…±è¯†ç®—æ³•ä¹‹ï¼šPaxos è®²ä¸€ä¸ªå…³äºŽpaxosçš„æ•…äº‹ æµ…æ˜¾æ˜“æ‡‚åœ°è§£è¯»Paxosç®—æ³• åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºè¿›é˜¶ - Paxos]]></content>
      <tags>
        <tag>zookpeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zookeeperç¬”è®°2-2PC&3PC]]></title>
    <url>%2F2019%2F02%2F22%2Fzookeeper%2FZookeeper%E7%AC%94%E8%AE%B02-2PC%263PC%2F</url>
    <content type="text"><![CDATA[å¾ˆå¤šäººå¯¹è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€è‡´æ€§é—®é¢˜çš„éš¾åº¦è¿˜æ²¡æœ‰ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ï¼Œæœ¬èŠ‚è¯¦ç»†è®²è§£åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€è‡´æ€§é¢ä¸´çš„ç§ç§æŒ‘æˆ˜ï¼Œå¹¶ä¸”è¯¦ç»†è¯´æ˜Ž2PCå’Œ3PCè¿™äº›æ¯”è¾ƒç®€å•çš„è§£å†³æ–¹æ¡ˆçš„åŽŸç†å’Œå­˜åœ¨çš„é—®é¢˜ï¼Œä¸ºåŽé¢å¼•å‡ºzkçš„è§£å†³æ–¹æ¡ˆåšé“ºåž«ã€‚ ä¸€ã€å‰è¨€ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§é—®é¢˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„é—®é¢˜ï¼Œzookeeperè§£å†³çš„å°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬ä»Žä¸€è‡´æ€§é—®é¢˜ã€ç‰¹å®šæ¡ä»¶ä¸‹è§£å†³ä¸€è‡´æ€§é—®é¢˜çš„ä¸¤ç§æ–¹æ³•(2PCã€3PC)å…¥é—¨ï¼Œäº†è§£æœ€åŸºç¡€çš„åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºã€‚ äºŒã€ä¸€è‡´æ€§ ä½•ä¸ºä¸€è‡´æ€§é—®é¢˜ï¼Ÿç®€å•è€Œè¨€ï¼Œä¸€è‡´æ€§é—®é¢˜å°±æ˜¯ç›¸äº’ç‹¬ç«‹çš„èŠ‚ç‚¹ä¹‹é—´å¦‚ä½•è¾¾æˆä¸€é¡¹å†³è®®çš„é—®é¢˜ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿›è¡Œæ•°æ®åº“äº‹åŠ¡æäº¤(commit transaction)ã€Leaderé€‰ä¸¾ã€åºåˆ—å·ç”Ÿæˆç­‰éƒ½ä¼šé‡åˆ°ä¸€è‡´æ€§é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ä¹Ÿå¾ˆå¸¸è§ï¼Œæ¯”å¦‚ç‰Œå‹æ€Žä¹ˆå•†å®šå‡ ç‚¹åœ¨å“ªæ‰“å‡ åœˆéº»å°†. å‡è®¾ä¸€ä¸ªå…·æœ‰Nä¸ªèŠ‚ç‚¹çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå½“å…¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬è¯´è¿™ä¸ªç³»ç»Ÿæ»¡è¶³ä¸€è‡´æ€§ï¼š å…¨è®¤åŒ(agreement): æ‰€æœ‰Nä¸ªèŠ‚ç‚¹éƒ½è®¤åŒä¸€ä¸ªç»“æžœ å€¼åˆæ³•(validity): è¯¥ç»“æžœå¿…é¡»ç”±Nä¸ªèŠ‚ç‚¹ä¸­çš„èŠ‚ç‚¹æå‡º å¯ç»“æŸ(termination): å†³è®®è¿‡ç¨‹åœ¨ä¸€å®šæ—¶é—´å†…ç»“æŸï¼Œä¸ä¼šæ— ä¼‘æ­¢åœ°è¿›è¡Œä¸‹åŽ» æœ‰äººå¯èƒ½ä¼šè¯´ï¼Œå†³å®šä»€ä¹ˆæ—¶å€™åœ¨å“ªæ“æ“éº»å°†ï¼Œ4ä¸ªäººå•†é‡ä¸€ä¸‹å°±okï¼Œè¿™ä¸å¾ˆç®€å•å—ï¼Ÿ ä½†å°±è¿™æ ·çœ‹ä¼¼ç®€å•çš„äº‹æƒ…ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå®žçŽ°èµ·æ¥å¹¶ä¸è½»æ¾ï¼Œå› ä¸ºå®ƒé¢ä¸´ç€ä¸Šä¸€èŠ‚æ‰€è¯´çš„è¿™äº›é—®é¢˜ï¼š æ¶ˆæ¯ä¼ é€’å¼‚æ­¥æ— åº(asynchronous): çŽ°å®žç½‘ç»œä¸æ˜¯ä¸€ä¸ªå¯é çš„ä¿¡é“ï¼Œå­˜åœ¨æ¶ˆæ¯å»¶æ—¶ã€ä¸¢å¤±ï¼ŒèŠ‚ç‚¹é—´æ¶ˆæ¯ä¼ é€’åšä¸åˆ°åŒæ­¥æœ‰åº(synchronous) èŠ‚ç‚¹å®•æœº(fail-stop): èŠ‚ç‚¹æŒç»­å®•æœºï¼Œä¸ä¼šæ¢å¤ èŠ‚ç‚¹å®•æœºæ¢å¤(fail-recover): èŠ‚ç‚¹å®•æœºä¸€æ®µæ—¶é—´åŽæ¢å¤ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ€å¸¸è§ ç½‘ç»œåˆ†åŒ–(network partition): ç½‘ç»œé“¾è·¯å‡ºçŽ°é—®é¢˜ï¼Œå°†Nä¸ªèŠ‚ç‚¹éš”ç¦»æˆå¤šä¸ªéƒ¨åˆ† æ‹œå åº­å°†å†›é—®é¢˜(byzantine failure): èŠ‚ç‚¹æˆ–å®•æœºæˆ–é€»è¾‘å¤±è´¥ï¼Œç”šè‡³ä¸æŒ‰å¥—è·¯å‡ºç‰ŒæŠ›å‡ºå¹²æ‰°å†³è®®çš„ä¿¡æ¯ å‡è®¾çŽ°å®žåœºæ™¯ä¸­ä¹Ÿå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬çœ‹çœ‹ç»“æžœä¼šæ€Žæ ·ï¼š ç¬¬ä¸€ç§æƒ…å†µï¼š æˆ‘: è€çŽ‹ï¼Œä»Šæ™š7ç‚¹è€åœ°æ–¹ï¼Œæ“å¤Ÿ48åœˆä¸è§ä¸æ•£ï¼ â€¦â€¦ (ç¬¬äºŒå¤©å‡Œæ™¨3ç‚¹) éš”å£è€çŽ‹: æ²¡é—®é¢˜ï¼ // æ¶ˆæ¯å»¶è¿Ÿ æˆ‘: â€¦â€¦ ç¬¬äºŒç§æƒ…å†µï¼š æˆ‘: å°å¼ ï¼Œä»Šæ™š7ç‚¹è€åœ°æ–¹ï¼Œæ“å¤Ÿ48åœˆä¸è§ä¸æ•£ï¼ å°å¼ : No â€¦â€¦ (ä¸¤å°æ—¶åŽâ€¦â€¦) å°å¼ : No problemï¼ // å®•æœºèŠ‚ç‚¹æ¢å¤ æˆ‘: â€¦â€¦ ç¬¬ä¸‰ç§æƒ…å†µï¼š æˆ‘: è€æŽå¤´ï¼Œä»Šæ™š7ç‚¹è€åœ°æ–¹ï¼Œæ“å¤Ÿ48åœˆä¸è§ä¸æ•£ï¼ è€æŽ: å¿…é¡»çš„ï¼Œå¤§ä¿å¥èµ°èµ·ï¼ // æ‹œå åº­å°†å†› (è¿™æ˜¯è¦æ‰“éº»å°†å‘¢ï¼Ÿè¿˜æ˜¯è¦å¤§ä¿å¥ï¼Ÿè¿˜æ˜¯ä¸€è¾¹æ‰“éº»å°†ä¸€è¾¹å¤§ä¿å¥â€¦â€¦) è¿˜èƒ½ä¸èƒ½ä¸€èµ·æ„‰å¿«åœ°çŽ©è€â€¦ æ­£å¦‚ä¸ŠèŠ‚æ‰€è¯´ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒConsistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ä¸­æœ€å¤šåªèƒ½æ»¡è¶³ä¸¤ä¸ªã€‚é‚£ä¹ˆï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸€å®šè¦æ»¡è¶³çš„äº†ã€‚é‚£ä¹ˆå¼ºä¸€è‡´æ€§å’Œé«˜å¯ç”¨å¿…å®šä¸èƒ½åŒæ—¶æ»¡è¶³ã€‚ å¯¹äºŽä¸€è‡´æ€§ï¼Œ2PCã€3PCæ˜¯ç›¸å¯¹ç®€å•çš„è§£å†³å¼ºä¸€è‡´æ€§é—®é¢˜çš„åè®®ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥äº†è§£2PCå’Œ3PCã€‚ ä¸‰ã€åè°ƒè€… åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªæœºå™¨èŠ‚ç‚¹è™½ç„¶éƒ½èƒ½æ˜Žç¡®çš„çŸ¥é“è‡ªå·±æ‰§è¡Œçš„äº‹åŠ¡æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œä½†æ˜¯å´æ— æ³•çŸ¥é“å…¶ä»–åˆ†å¸ƒå¼èŠ‚ç‚¹çš„äº‹åŠ¡æ‰§è¡Œæƒ…å†µã€‚å› æ­¤ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡è¦è·¨è¶Šå¤šä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ—¶å€™ï¼ˆæ¯”å¦‚ï¼Œæ·˜å®ä¸‹å•æµç¨‹ï¼Œä¸‹å•ç³»ç»Ÿå’Œåº“å­˜ç³»ç»Ÿå¯èƒ½å°±æ˜¯åˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„åˆ†å¸ƒå¼èŠ‚ç‚¹ä¸­ï¼‰ï¼Œä¸ºäº†ä¿è¯è¯¥äº‹åŠ¡å¯ä»¥æ»¡è¶³ACIDï¼Œå°±è¦å¼•å…¥ä¸€ä¸ªåè°ƒè€…ï¼ˆCooradinatorï¼‰ã€‚å…¶ä»–çš„èŠ‚ç‚¹è¢«ç§°ä¸ºå‚ä¸Žè€…ï¼ˆParticipantï¼‰ã€‚åè°ƒè€…è´Ÿè´£è°ƒåº¦å‚ä¸Žè€…çš„è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›å‚ä¸Žè€…æ˜¯å¦è¦æŠŠäº‹åŠ¡è¿›è¡Œæäº¤ã€‚ å››ã€2PC(äºŒé˜¶æäº¤) é¡¾åæ€ä¹‰å®ƒåˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼Œå…ˆç”±ä¸€æ–¹è¿›è¡Œæè®®(propose)å¹¶æ”¶é›†å…¶ä»–èŠ‚ç‚¹çš„åé¦ˆ(vote)ï¼Œå†æ ¹æ®åé¦ˆå†³å®šæäº¤(commit)æˆ–ä¸­æ­¢(abort)äº‹åŠ¡ã€‚æˆ‘ä»¬å°†æè®®çš„èŠ‚ç‚¹ç§°ä¸ºåè°ƒè€…(coordinator)ï¼Œå…¶ä»–å‚ä¸Žå†³è®®èŠ‚ç‚¹ç§°ä¸ºå‚ä¸Žè€…(participants, æˆ–cohorts)ã€‚ åœ¨é˜¶æ®µ1ä¸­ï¼Œåè°ƒè€…å‘èµ·ä¸€ä¸ªæè®®ï¼Œåˆ†åˆ«é—®è¯¢å„å‚ä¸Žè€…æ˜¯å¦æŽ¥å—ã€‚åªè¦æœ‰ä¸€ä¸ªå‚ä¸Žè€…æ²¡æœ‰å‡†å¤‡å¥½å°±ä¸­æ­¢ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒäºŒé˜¶æ®µæäº¤åè®®çš„ç¬¬ä¸€é˜¶æ®µå‡†å¤‡é˜¶æ®µä¸ä»…ä»…æ˜¯å›žç­”YES or NOï¼Œè¿˜æ˜¯è¦æ‰§è¡Œäº‹åŠ¡æ“ä½œçš„ï¼Œåªæ˜¯æ‰§è¡Œå®Œäº‹åŠ¡æ“ä½œï¼Œå¹¶æ²¡æœ‰è¿›è¡Œcommitè¿˜æ˜¯roolbackã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦äº‹åŠ¡æ‰§è¡Œä¹‹åŽï¼Œåœ¨æ²¡æœ‰æ‰§è¡Œcommitæˆ–è€…roolbackä¹‹å‰ï¼Œèµ„æºæ˜¯è¢«é”å®šçš„ã€‚è¿™ä¼šé€ æˆé˜»å¡žã€‚ 1ï¼‰åè°ƒè€…èŠ‚ç‚¹å‘æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹è¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œæäº¤æ“ä½œ(vote)ï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸Žè€…èŠ‚ç‚¹çš„å“åº”ã€‚ 2ï¼‰å‚ä¸Žè€…èŠ‚ç‚¹æ‰§è¡Œè¯¢é—®å‘èµ·ä¸ºæ­¢çš„æ‰€æœ‰äº‹åŠ¡æ“ä½œï¼Œå¹¶å°†Undoä¿¡æ¯(ç”¨äºŽå¤±è´¥æ—¶çš„å›žæ»š)å’ŒRedoä¿¡æ¯å†™å…¥æ—¥å¿—ã€‚ï¼ˆæ³¨æ„ï¼šè‹¥æˆåŠŸè¿™é‡Œå…¶å®žæ¯ä¸ªå‚ä¸Žè€…å·²ç»æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼‰ 3ï¼‰å„å‚ä¸Žè€…èŠ‚ç‚¹å“åº”åè°ƒè€…èŠ‚ç‚¹å‘èµ·çš„è¯¢é—®ã€‚å¦‚æžœå‚ä¸Žè€…èŠ‚ç‚¹çš„äº‹åŠ¡æ“ä½œå®žé™…æ‰§è¡ŒæˆåŠŸï¼Œåˆ™å®ƒè¿”å›žä¸€ä¸ªâ€åŒæ„â€æ¶ˆæ¯ï¼›å¦‚æžœå‚ä¸Žè€…èŠ‚ç‚¹çš„äº‹åŠ¡æ“ä½œå®žé™…æ‰§è¡Œå¤±è´¥ï¼Œåˆ™å®ƒè¿”å›žä¸€ä¸ªâ€ä¸­æ­¢â€æ¶ˆæ¯ã€‚ åœ¨é˜¶æ®µ2ä¸­ï¼Œåè°ƒè€…æ ¹æ®å‚ä¸Žè€…çš„åé¦ˆï¼Œæäº¤æˆ–ä¸­æ­¢äº‹åŠ¡ï¼Œå¦‚æžœå‚ä¸Žè€…å…¨éƒ¨åŒæ„åˆ™æäº¤ï¼Œåªè¦æœ‰ä¸€ä¸ªå‚ä¸Žè€…ä¸åŒæ„å°±ä¸­æ­¢ã€‚é‡Šæ”¾æ‰€æœ‰äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„é”èµ„æºã€‚(æ³¨æ„:å¿…é¡»åœ¨æœ€åŽé˜¶æ®µé‡Šæ”¾é”èµ„æº) é—®é¢˜ï¼š 1ã€åŒæ­¥é˜»å¡žé—®é¢˜ã€‚æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å‚ä¸ŽèŠ‚ç‚¹éƒ½æ˜¯äº‹åŠ¡é˜»å¡žåž‹çš„ã€‚å½“å‚ä¸Žè€…å æœ‰å…¬å…±èµ„æºæ—¶ï¼Œå…¶ä»–ç¬¬ä¸‰æ–¹èŠ‚ç‚¹è®¿é—®å…¬å…±èµ„æºä¸å¾—ä¸å¤„äºŽé˜»å¡žçŠ¶æ€ã€‚ 2ã€å•ç‚¹æ•…éšœã€‚ç”±äºŽåè°ƒè€…çš„é‡è¦æ€§ï¼Œä¸€æ—¦åè°ƒè€…å‘ç”Ÿæ•…éšœã€‚å‚ä¸Žè€…ä¼šä¸€ç›´é˜»å¡žä¸‹åŽ»ã€‚å°¤å…¶åœ¨ç¬¬äºŒé˜¶æ®µï¼Œåè°ƒè€…å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å‚ä¸Žè€…è¿˜éƒ½å¤„äºŽé”å®šäº‹åŠ¡èµ„æºçš„çŠ¶æ€ä¸­ï¼Œè€Œæ— æ³•ç»§ç»­å®Œæˆäº‹åŠ¡æ“ä½œã€‚ï¼ˆå¦‚æžœæ˜¯åè°ƒè€…æŒ‚æŽ‰ï¼Œå¯ä»¥é‡æ–°é€‰ä¸¾ä¸€ä¸ªåè°ƒè€…ï¼Œä½†æ˜¯æ— æ³•è§£å†³å› ä¸ºåè°ƒè€…å®•æœºå¯¼è‡´çš„å‚ä¸Žè€…å¤„äºŽé˜»å¡žçŠ¶æ€çš„é—®é¢˜ï¼‰ 3ã€æ•°æ®ä¸ä¸€è‡´ã€‚åœ¨äºŒé˜¶æ®µæäº¤çš„é˜¶æ®µäºŒä¸­ï¼Œå½“åè°ƒè€…å‘å‚ä¸Žè€…å‘é€commitè¯·æ±‚ä¹‹åŽï¼Œå‘ç”Ÿäº†å±€éƒ¨ç½‘ç»œå¼‚å¸¸æˆ–è€…åœ¨å‘é€commitè¯·æ±‚è¿‡ç¨‹ä¸­åè°ƒè€…å‘ç”Ÿäº†æ•…éšœï¼Œè¿™ä¼šå¯¼è‡´åªæœ‰ä¸€éƒ¨åˆ†å‚ä¸Žè€…æŽ¥å—åˆ°äº†commitè¯·æ±‚ã€‚è€Œåœ¨è¿™éƒ¨åˆ†å‚ä¸Žè€…æŽ¥åˆ°commitè¯·æ±‚ä¹‹åŽå°±ä¼šæ‰§è¡Œcommitæ“ä½œã€‚ä½†æ˜¯å…¶ä»–éƒ¨åˆ†æœªæŽ¥åˆ°commitè¯·æ±‚çš„æœºå™¨åˆ™æ— æ³•æ‰§è¡Œäº‹åŠ¡æäº¤ã€‚äºŽæ˜¯æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¾¿å‡ºçŽ°äº†æ•°æ®éƒ¨ä¸€è‡´æ€§çš„çŽ°è±¡ã€‚ äºŒé˜¶æ®µæ— æ³•è§£å†³çš„é—®é¢˜ï¼šåè°ƒè€…åœ¨å‘å‡ºcommitæ¶ˆæ¯ä¹‹åŽå®•æœºï¼Œè€Œå”¯ä¸€æŽ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„å‚ä¸Žè€…åŒæ—¶ä¹Ÿå®•æœºäº†ã€‚é‚£ä¹ˆå³ä½¿åè°ƒè€…é€šè¿‡é€‰ä¸¾åè®®äº§ç”Ÿäº†æ–°çš„åè°ƒè€…ï¼Œè¿™æ¡äº‹åŠ¡çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œæ²¡äººçŸ¥é“äº‹åŠ¡æ˜¯å¦è¢«å·²ç»æäº¤ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œè¡ç”Ÿå‡ºäº†å¯¹2PCçš„æ”¹è¿›3PCã€‚æˆ‘ä»¬æŽ¥ä¸‹æ¥çœ‹çœ‹3PCæ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ã€‚ äº”ã€3PC(ä¸‰é˜¶æ®µæäº¤) 3PCæœ€å…³é”®è¦è§£å†³çš„æ˜¯å•ç‚¹å’Œé˜»å¡žã€‚ æ‰€ä»¥3PCæŠŠ2PCçš„å‡†å¤‡é˜¶æ®µå†æ¬¡ä¸€åˆ†ä¸ºäºŒï¼Œè¿™æ ·ä¸‰é˜¶æ®µæäº¤å°±æœ‰CanCommitã€PreCommitã€DoCommitä¸‰ä¸ªé˜¶æ®µã€‚åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œåªæ˜¯è¯¢é—®æ‰€æœ‰å‚ä¸Žè€…æ˜¯å¦å¯å¯ä»¥æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶ä¸åœ¨æœ¬é˜¶æ®µæ‰§è¡Œäº‹åŠ¡æ“ä½œã€‚å½“åè°ƒè€…æ”¶åˆ°æ‰€æœ‰çš„å‚ä¸Žè€…éƒ½è¿”å›žYESæ—¶ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µæ‰æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œç„¶åŽåœ¨ç¬¬ä¸‰é˜¶æ®µåœ¨æ‰§è¡Œcommitæˆ–è€…rollbackã€‚ 5.1 CanCommité˜¶æ®µ 3PCçš„CanCommité˜¶æ®µå…¶å®žå’Œ2PCçš„å‡†å¤‡é˜¶æ®µå¾ˆåƒã€‚åè°ƒè€…å‘å‚ä¸Žè€…å‘é€commitè¯·æ±‚ï¼Œå‚ä¸Žè€…å¦‚æžœå¯ä»¥æäº¤å°±è¿”å›žYeså“åº”ï¼Œå¦åˆ™è¿”å›žNoå“åº”ã€‚ ä½†æ˜¯æ­¤æ—¶ä¸æ‰§è¡Œäº‹åŠ¡çš„æ“ä½œï¼Œä¹Ÿå°±æ—¶è¯´ä¸ä¼šé”ä½èµ„æºã€‚ 5.2 PreCommité˜¶æ®µ å‡å¦‚åè°ƒè€…ä»Žæ‰€æœ‰çš„å‚ä¸Žè€…èŽ·å¾—çš„åé¦ˆéƒ½æ˜¯Yeså“åº”ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œäº‹åŠ¡çš„é¢„æ‰§è¡Œã€‚æ­¤æ—¶ä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œå’Œå°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚å¦‚æžœå‚ä¸Žè€…æˆåŠŸçš„æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œåˆ™è¿”å›žACKå“åº”ï¼ŒåŒæ—¶å¼€å§‹ç­‰å¾…æœ€ç»ˆæŒ‡ä»¤ã€‚ å‡å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚ä¸Žè€…å‘åè°ƒè€…å‘é€äº†Noå“åº”ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ä¹‹åŽï¼Œåè°ƒè€…éƒ½æ²¡æœ‰æŽ¥åˆ°å‚ä¸Žè€…çš„å“åº”ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚ 5.3 doCommité˜¶æ®µ åŠ å…¥åè°ƒæŽ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…å‘é€çš„ACKå“åº”ï¼Œé‚£ä¹ˆä»–å°†ä»Žé¢„æäº¤çŠ¶æ€è¿›å…¥åˆ°æäº¤çŠ¶æ€ã€‚å¹¶å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€doCommitè¯·æ±‚ã€‚ åè°ƒè€…æ²¡æœ‰æŽ¥æ”¶åˆ°å‚ä¸Žè€…å‘é€çš„ACKå“åº”ï¼ˆå¯èƒ½æ˜¯æŽ¥å—è€…å‘é€çš„ä¸æ˜¯ACKå“åº”ï¼Œä¹Ÿå¯èƒ½å“åº”è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸­æ–­äº‹åŠ¡ã€‚ åœ¨doCommité˜¶æ®µï¼Œå¦‚æžœå‚ä¸Žè€…æ— æ³•åŠæ—¶æŽ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–è€…rebortè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åŽï¼Œä¼šç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚ï¼ˆå…¶å®žè¿™ä¸ªåº”è¯¥æ˜¯åŸºäºŽæ¦‚çŽ‡æ¥å†³å®šçš„ï¼Œå½“è¿›å…¥ç¬¬ä¸‰é˜¶æ®µæ—¶ï¼Œè¯´æ˜Žå‚ä¸Žè€…åœ¨ç¬¬äºŒé˜¶æ®µå·²ç»æ”¶åˆ°äº†PreCommitè¯·æ±‚ï¼Œé‚£ä¹ˆåè°ƒè€…äº§ç”ŸPreCommitè¯·æ±‚çš„å‰ææ¡ä»¶æ˜¯ä»–åœ¨ç¬¬äºŒé˜¶æ®µå¼€å§‹ä¹‹å‰ï¼Œæ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…çš„CanCommitå“åº”éƒ½æ˜¯Yesã€‚ï¼ˆä¸€æ—¦å‚ä¸Žè€…æ”¶åˆ°äº†PreCommitï¼Œæ„å‘³ä»–çŸ¥é“å¤§å®¶å…¶å®žéƒ½åŒæ„ä¿®æ”¹äº†ï¼‰æ‰€ä»¥ï¼Œä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼Œå½“è¿›å…¥ç¬¬ä¸‰é˜¶æ®µæ—¶ï¼Œç”±äºŽç½‘ç»œè¶…æ—¶ç­‰åŽŸå› ï¼Œè™½ç„¶å‚ä¸Žè€…æ²¡æœ‰æ”¶åˆ°commitæˆ–è€…abortå“åº”ï¼Œä½†æ˜¯ä»–æœ‰ç†ç”±ç›¸ä¿¡ï¼šæˆåŠŸæäº¤çš„å‡ çŽ‡å¾ˆå¤§ã€‚ ï¼‰ ç›¸å¯¹äºŽ2PCï¼Œ3PCä¸»è¦è§£å†³çš„å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå¹¶å‡å°‘é˜»å¡žï¼Œå› ä¸ºä¸€æ—¦å‚ä¸Žè€…æ— æ³•åŠæ—¶æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„ä¿¡æ¯ä¹‹åŽï¼Œä»–ä¼šé»˜è®¤æ‰§è¡Œcommitã€‚è€Œä¸ä¼šä¸€ç›´æŒæœ‰äº‹åŠ¡èµ„æºå¹¶å¤„äºŽé˜»å¡žçŠ¶æ€ã€‚ ä½†æ˜¯è¿™ç§æœºåˆ¶ä¹Ÿä¼šå¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå› ä¸ºï¼Œç”±äºŽç½‘ç»œåŽŸå› ï¼Œåè°ƒè€…å‘é€çš„abortå“åº”æ²¡æœ‰åŠæ—¶è¢«å‚ä¸Žè€…æŽ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆå‚ä¸Žè€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åŽæ‰§è¡Œäº†commitæ“ä½œã€‚è¿™æ ·å°±å’Œå…¶ä»–æŽ¥åˆ°abortå‘½ä»¤å¹¶æ‰§è¡Œå›žæ»šçš„å‚ä¸Žè€…ä¹‹é—´å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ å…­ã€æ€»ç»“ äº†è§£äº†2PCå’Œ3PCä¹‹åŽï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼Œæ— è®ºæ˜¯äºŒé˜¶æ®µæäº¤è¿˜æ˜¯ä¸‰é˜¶æ®µæäº¤éƒ½æ— æ³•å½»åº•è§£å†³åˆ†å¸ƒå¼çš„ä¸€è‡´æ€§é—®é¢˜ã€‚Google Chubbyçš„ä½œè€…Mike Burrowsè¯´è¿‡ï¼Œ there is only one consensus protocol, and thatâ€™s Paxosâ€ â€“ all other approaches are just broken versions of Paxos. æ„å³ä¸–ä¸Šåªæœ‰ä¸€ç§ä¸€è‡´æ€§ç®—æ³•ï¼Œé‚£å°±æ˜¯Paxosï¼Œæ‰€æœ‰å…¶ä»–ä¸€è‡´æ€§ç®—æ³•éƒ½æ˜¯Paxosç®—æ³•çš„ä¸å®Œæ•´ç‰ˆã€‚]]></content>
      <tags>
        <tag>zookpeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zookeeperç¬”è®°1-CAPå’ŒBASEç†è®º]]></title>
    <url>%2F2019%2F02%2F22%2Fzookeeper%2FZookeeper%E7%AC%94%E8%AE%B01-CAP%E5%92%8CBASE%E7%90%86%E8%AE%BA%2F</url>
    <content type="text"><![CDATA[éšç€åº”ç”¨è§„æ¨¡çš„è¿…é€Ÿæ‰©å¼ ï¼Œå•å°æœºå™¨çš„éƒ¨ç½²å·²ç»éš¾ä»¥æ”¯æ’‘ç”¨æˆ·å¤§è§„æ¨¡ã€é«˜å¹¶å‘çš„è¯·æ±‚äº†ï¼Œ å› æ­¤æœåŠ¡åŒ–ã€é›†ç¾¤åŒ–ã€åˆ†å¸ƒå¼æ¦‚å¿µåº”è¿è€Œç”Ÿã€‚ ç„¶è€Œï¼Œ é›†ç¾¤çš„ç»´æŠ¤å’Œå¤šèŠ‚ç‚¹åº”ç”¨ç¨‹åºçš„åä½œè¿è¡Œè¿œæ¯”å•æœºæ¨¡å¼å¤æ‚ï¼Œéœ€è¦é¡¾åŠåˆ°çš„ç»†èŠ‚é—®é¢˜å®žåœ¨å¤ªå¤šï¼Œæ¯”å¦‚è¯´åŒä¸€åˆ†é…ç½®åœ¨å¤šå°æœºå™¨ä¸Šçš„åŒæ­¥ï¼Œ å®¢æˆ·ç«¯ç¨‹åºå®žæ—¶æ„ŸçŸ¥æœåŠ¡æœºçŠ¶æ€ï¼Œåº”ç”¨ä¸Žåº”ç”¨ä¹‹é—´çš„å…¬å…±èµ„æºçš„äº’æ–¥è®¿é—®ç­‰ç­‰ä¸€ç³»åˆ—çš„é—®é¢˜ã€‚zookeeperèƒ½å¤Ÿç»™æˆ‘ä»¬éžå¸¸å®Œç¾Žçš„è§£å†³è¿™äº›é—®é¢˜ï¼Œzookeeperå¤©ç”Ÿçš„å°±æ˜¯ä¸ºè§£å†³åˆ†å¸ƒå¼åè°ƒæœåŠ¡è¿™ä¸ªé—®é¢˜è€Œæ¥ã€‚ ä¸€ã€å‰è¨€ å­¦ä¹ zookeeperæ‰ç®—æ˜¯çœŸæ­£è·¨è¿›åˆ†å¸ƒå¼è¿™ä¸ªå¤§é—¨ã€‚æ¯”è¾ƒç»å…¸çš„åº”ç”¨æ˜¯å¯ä»¥ä½œä¸ºdubboæŽ¨èçš„æ³¨å†Œä¸­å¿ƒã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»è¦æ˜Žç¡®å‡ ä¸ªæˆ‘ä»¬ä¹‹å‰å¯èƒ½ä¸ä¼šé‡åˆ°çš„ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åˆå¾ˆå¸¸è§çš„é—®é¢˜ï¼š ç½‘ç»œç›¸å½“å¯é  å»¶è¿Ÿä¸º0 ä¼ è¾“å¸¦å®½æ˜¯æ— é™çš„ ç½‘ç»œç›¸å½“å®‰å…¨ æ‹“æ‰‘ç»“æž„ä¸ä¼šæ”¹å˜ å¿…é¡»è¦æœ‰ä¸€ä¸ªç®¡ç†å‘˜ ä¼ è¾“æˆæœ¬ä¸º0 ç½‘ç»œåŒè´¨åŒ– æ€»ç»“èµ·æ¥ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ€å¸¸å‡ºçŽ°çš„é—®é¢˜æ˜¯ï¼šé€šä¿¡å¼‚å¸¸ï¼Œè¡¨çŽ°ä¸ºç½‘ç»œé€šä¿¡æˆåŠŸï¼Œå¤±è´¥å’Œè¶…æ—¶ï¼›èŠ‚ç‚¹æ•…éšœï¼ŒåŒ…æ‹¬å®•æœºå’ŒOOMã€‚ äºŒã€Zookeeperæ˜¯ä»€ä¹ˆ å®˜æ–¹è§£é‡Šï¼š å®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶ï¼Œæ˜¯Apache Hadoop çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼åº”ç”¨ä¸­ç»å¸¸é‡åˆ°çš„ä¸€äº›æ•°æ®ç®¡ç†é—®é¢˜ï¼Œå¦‚ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰ã€‚ ä¸Šé¢çš„è§£é‡Šæœ‰ç‚¹æŠ½è±¡ï¼Œç®€å•æ¥è¯´zookeeper=æ–‡ä»¶ç³»ç»Ÿ+ç›‘å¬é€šçŸ¥æœºåˆ¶ã€‚æˆ‘ä»¬è¿™é‡Œæ‹¿æ¯”è¾ƒç®€å•çš„åˆ†å¸ƒå¼åº”ç”¨é…ç½®ç®¡ç†ä¸ºä¾‹æ¥è¯´æ˜Žã€‚ å‡è®¾æˆ‘ä»¬çš„ç¨‹åºæ˜¯åˆ†å¸ƒå¼éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šï¼Œå¦‚æžœæˆ‘ä»¬è¦æ”¹å˜ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é€å°æœºå™¨åŽ»ä¿®æ”¹ï¼Œéžå¸¸éº»çƒ¦ï¼ŒçŽ°åœ¨æŠŠè¿™äº›é…ç½®å…¨éƒ¨æ”¾åˆ°zookeeperä¸ŠåŽ»ï¼Œä¿å­˜åœ¨ zookeeper çš„æŸä¸ªç›®å½•èŠ‚ç‚¹ä¸­ï¼Œç„¶åŽæ‰€æœ‰ç›¸å…³åº”ç”¨ç¨‹åºå¯¹è¿™ä¸ªç›®å½•èŠ‚ç‚¹è¿›è¡Œç›‘å¬ï¼Œä¸€æ—¦é…ç½®ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå°±ä¼šæ”¶åˆ° zookeeper çš„é€šçŸ¥ï¼Œç„¶åŽä»Ž zookeeper èŽ·å–æ–°çš„é…ç½®ä¿¡æ¯åº”ç”¨åˆ°ç³»ç»Ÿä¸­ã€‚ ä¸‰ã€Zookeeperè®¾è®¡ç›®çš„ 1ã€æœ€ç»ˆä¸€è‡´æ€§ï¼šclientä¸è®ºè¿žæŽ¥åˆ°å“ªä¸ªServerï¼Œå±•ç¤ºç»™å®ƒéƒ½æ˜¯åŒä¸€ä¸ªè§†å›¾ï¼Œè¿™æ˜¯zookeeperæœ€é‡è¦çš„æ€§èƒ½ã€‚ 2ã€å¯é æ€§ï¼šå…·æœ‰ç®€å•ã€å¥å£®ã€è‰¯å¥½çš„æ€§èƒ½ï¼Œå¦‚æžœæ¶ˆæ¯è¢«åˆ°ä¸€å°æœåŠ¡å™¨æŽ¥å—ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æ‰€æœ‰çš„æœåŠ¡å™¨æŽ¥å—ã€‚ 3ã€å®žæ—¶æ€§ï¼šZookeeperä¿è¯å®¢æˆ·ç«¯å°†åœ¨ä¸€ä¸ªæ—¶é—´é—´éš”èŒƒå›´å†…èŽ·å¾—æœåŠ¡å™¨çš„æ›´æ–°ä¿¡æ¯ï¼Œæˆ–è€…æœåŠ¡å™¨å¤±æ•ˆçš„ä¿¡æ¯ã€‚ä½†ç”±äºŽç½‘ç»œå»¶æ—¶ç­‰åŽŸå› ï¼ŒZookeeperä¸èƒ½ä¿è¯ä¸¤ä¸ªå®¢æˆ·ç«¯èƒ½åŒæ—¶å¾—åˆ°åˆšæ›´æ–°çš„æ•°æ®ï¼Œå¦‚æžœéœ€è¦æœ€æ–°æ•°æ®ï¼Œåº”è¯¥åœ¨è¯»æ•°æ®ä¹‹å‰è°ƒç”¨sync()æŽ¥å£ã€‚ 4ã€ç­‰å¾…æ— å…³ï¼ˆwait-freeï¼‰ï¼šæ…¢çš„æˆ–è€…å¤±æ•ˆçš„clientä¸å¾—å¹²é¢„å¿«é€Ÿçš„clientçš„è¯·æ±‚ï¼Œä½¿å¾—æ¯ä¸ªclientéƒ½èƒ½æœ‰æ•ˆçš„ç­‰å¾…ã€‚ 5ã€åŽŸå­æ€§ï¼šæ›´æ–°åªèƒ½æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œæ²¡æœ‰ä¸­é—´çŠ¶æ€ã€‚ 6ã€é¡ºåºæ€§ï¼šåŒ…æ‹¬å…¨å±€æœ‰åºå’Œååºä¸¤ç§ï¼šå…¨å±€æœ‰åºæ˜¯æŒ‡å¦‚æžœåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šæ¶ˆæ¯aåœ¨æ¶ˆæ¯bå‰å‘å¸ƒï¼Œåˆ™åœ¨æ‰€æœ‰Serverä¸Šæ¶ˆæ¯aéƒ½å°†åœ¨æ¶ˆæ¯bå‰è¢«å‘å¸ƒï¼›ååºæ˜¯æŒ‡å¦‚æžœä¸€ä¸ªæ¶ˆæ¯båœ¨æ¶ˆæ¯aåŽè¢«åŒä¸€ä¸ªå‘é€è€…å‘å¸ƒï¼Œaå¿…å°†æŽ’åœ¨bå‰é¢ã€‚ å››ã€CAPç†è®º æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸å¯èƒ½åŒæ—¶æ»¡è¶³Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰è¿™ä¸‰ä¸ªåŸºæœ¬éœ€æ±‚ï¼Œæœ€å¤šåªèƒ½æ»¡è¶³å…¶ä¸­çš„ä¸¤é¡¹ã€‚ 1ã€ä¸€è‡´æ€§ï¼š æŒ‡æ•°æ®åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´æ˜¯å¦èƒ½å¤Ÿä¿æŒä¸€è‡´çš„ç‰¹æ€§ã€‚å½“æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œåŽï¼Œä»ç„¶ä¿è¯ç³»ç»Ÿæ•°æ®å¤„äºŽä¸€è‡´çš„çŠ¶æ€ã€‚ 2ã€å¯ç”¨æ€§ï¼ˆé«˜å¯ç”¨ï¼‰ï¼š ç³»ç»Ÿæä¾›çš„æœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºŽå¯ç”¨çš„çŠ¶æ€ã€‚å¯¹äºŽç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨â€œæœ‰é™çš„æ—¶é—´å†…â€è¿”å›žç»“æžœã€‚è¿™ä¸ªæœ‰é™æ—¶é—´æ˜¯ç³»ç»Ÿè®¾è®¡ä¹‹åˆå°±æŒ‡å®šå¥½çš„ç³»ç»Ÿè¿è¡ŒæŒ‡æ ‡ã€‚è¿”å›žçš„ç»“æžœæŒ‡çš„æ˜¯ç³»ç»Ÿè¿”å›žç”¨æˆ·çš„ä¸€ä¸ªæ­£å¸¸å“åº”ç»“æžœï¼Œè€Œä¸æ˜¯â€œout ot memory errorâ€ä¹‹ç±»çš„ç³»ç»Ÿé”™è¯¯ä¿¡æ¯ã€‚ 3ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆæ•°æ®åˆ†ç‰‡ï¼‰ï¼š åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶éœ€è¦èƒ½å¤Ÿä¿è¯å¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éžæ˜¯æ•´ä¸ªç½‘ç»œçŽ¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚ç»„æˆåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¯ä¸ªèŠ‚ç‚¹çš„åŠ å…¥ä¸Žé€€å‡ºéƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç½‘ç»œåˆ†åŒºã€‚ ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶ï¼Œåªèƒ½æ»¡è¶³ä¸¤ä¸ªï¼Œæ„å‘³ç€æˆ‘ä»¬è¦æŠ›å¼ƒå…¶ä¸­çš„ä¸€é¡¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1ã€CAï¼Œæ”¾å¼ƒPï¼šå°†æ‰€æœ‰æ•°æ®éƒ½æ”¾åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¸Šã€‚è¿™åŒæ—¶æ”¾å¼ƒäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚ 2ã€CPï¼Œæ”¾å¼ƒAï¼šä¸€æ—¦ç³»ç»Ÿé‡åˆ°æ•…éšœæ—¶ï¼Œå—å½±å“çš„æœåŠ¡å™¨éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œåœ¨æ¢å¤æœŸé—´æ— æ³•å¯¹å¤–æä¾›æ­£å¸¸çš„æœåŠ¡ã€‚ 3ã€APï¼Œæ”¾å¼ƒCï¼šè¿™é‡Œçš„æ”¾å¼ƒä¸€è‡´æ€§æ˜¯æŒ‡æ”¾å¼ƒæ•°æ®å¼ºä¸€è‡´æ€§ï¼Œè€Œä¿ç•™æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚ç³»ç»Ÿæ— æ³•å®žæ—¶ä¿æŒæ•°æ®çš„ä¸€è‡´ï¼Œä½†æ‰¿è¯ºåœ¨ä¸€ä¸ªé™å®šçš„æ—¶é—´çª—å£å†…ï¼Œæ•°æ®æœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚ å¯¹äºŽåˆ†å¸ƒå¼ç³»ç»Ÿè€Œè¨€ï¼Œåˆ†åŒºå®¹é”™æ€§æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ç»„ä»¶å¿…ç„¶éœ€è¦éƒ¨ç½²åˆ°ä¸é€šçš„èŠ‚ç‚¹ï¼Œå¿…ç„¶ä¼šå‡ºçŽ°å­ç½‘ç»œï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œé—®é¢˜æ˜¯å¿…å®šä¼šå‡ºçŽ°çš„å¼‚å¸¸ã€‚å› æ­¤åˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½åœ¨Cï¼ˆä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚ äº”ã€BASEç†è®º Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft-stateï¼ˆ è½¯çŠ¶æ€/æŸ”æ€§äº‹åŠ¡ï¼‰ã€Eventual Consistencyï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚æ˜¯åŸºäºŽCAPå®šç†æ¼”åŒ–è€Œæ¥ï¼Œæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æžœã€‚ æ ¸å¿ƒæ€æƒ³ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªä¸šåŠ¡æ ¹æ®è‡ªèº«çš„ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚ 1ã€åŸºæœ¬å¯ç”¨ï¼š æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºçŽ°æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚ä½†ä¸ç­‰ä»·äºŽä¸å¯ç”¨ã€‚æ¯”å¦‚ï¼šæœç´¢å¼•æ“Ž0.5ç§’è¿”å›žæŸ¥è¯¢ç»“æžœï¼Œä½†ç”±äºŽæ•…éšœï¼Œ2ç§’å“åº”æŸ¥è¯¢ç»“æžœï¼›ç½‘é¡µè®¿é—®è¿‡å¤§æ—¶ï¼Œéƒ¨åˆ†ç”¨æˆ·æä¾›é™çº§æœåŠ¡ï¼Œç­‰ã€‚ 2ã€è½¯çŠ¶æ€ï¼š è½¯çŠ¶æ€æ˜¯æŒ‡å…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶ä¸”è¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚å³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹é—´å‰¯æœ¬åŒæ­¥çš„æ—¶å€™å­˜åœ¨å»¶æ—¶ã€‚ 3ã€æœ€ç»ˆä¸€è‡´æ€§ï¼š ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åŽï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œä¸éœ€è¦å®žæ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚æœ€ç»ˆä¸€è‡´æ€§æ˜¯å¼±ä¸€è‡´æ€§çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚ BASEç†è®ºé¢å‘çš„æ˜¯å¤§åž‹é«˜å¯ç”¨å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥èŽ·å¾—å¯ç”¨æ€§ã€‚ACIDæ˜¯ä¼ ç»Ÿæ•°æ®åº“å¸¸ç”¨çš„æ¦‚å¿µè®¾è®¡ï¼Œè¿½æ±‚å¼ºä¸€è‡´æ€§æ¨¡åž‹ã€‚]]></content>
      <tags>
        <tag>zookpeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBooté€šç”¨çŸ¥è¯†æ·±å…¥--åˆ‡é¢ã€å¼‚å¸¸ã€å•å…ƒæµ‹è¯•]]></title>
    <url>%2F2019%2F02%2F21%2Fmiscellany%2FSupringBoot%E9%80%9A%E7%94%A8%E7%9F%A5%E8%AF%86%E6%B7%B1%E5%85%A5--%E5%88%87%E9%9D%A2%E3%80%81%E5%BC%82%E5%B8%B8%E3%80%81%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%2F</url>
    <content type="text"><![CDATA[å¯¹äºŽå°ç™½æ¥è¯´ï¼Œä¸‹é¢çš„çŸ¥è¯†éƒ½æ˜¯æ»¡æ»¡çš„å¹²è´§ï¼Œå€¼å¾—å¥½å¥½å­¦ä¹ ï¼Œå…·ä½“çš„è§†é¢‘æ˜¯å­¦ä¹ çš„å»–å¸ˆå…„çš„Spring Bootè¿›é˜¶ä¹‹Webè¿›é˜¶ï¼Œå€¼å¾—ä¸€çœ‹ï¼Œä¸‹é¢æ˜¯ç¬”è®°æ€»ç»“ã€‚ ä¸€ã€é¢å‘åˆ‡é¢ç¼–ç¨‹ è®¿é—® localhost:8080/dev/add æ—¥å¿—æ‰“å°ç»“æžœæ˜¯ï¼š äºŒã€æ ¡éªŒå’Œè¿”å›žç»“æžœå°è£… 1ã€é¦–å…ˆæ˜¯åœ¨studentç±»ä¸­å¯¹usernameå¢žåŠ æ³¨è§£ï¼š@NotNull(message = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;) 2ã€åœ¨å¢žåŠ ä¸€ä¸ªå­¦ç”Ÿçš„æ–¹æ³•ä¸Šè¿›è¡Œå‚æ•°çš„éªŒè¯ï¼š 3ã€åœ¨httpå·¥å…·ä¸Šè¾“å…¥ http://localhost:8080/dev/add?username=hello&amp;age=10 è¿”å›žæ­£ç¡®ä¿¡æ¯ï¼Œå³å­¦ç”Ÿçš„jsonæµï¼š{â€œidâ€:5,â€œusernameâ€:â€œhelloâ€,â€œageâ€:10} å¦‚æžœä¸ä¼ usernameï¼Œå³å¿…å¡«çš„é‚£ä¸€é¡¹ä¸ç»™ï¼Œåˆ™å‘ç”Ÿå¼‚å¸¸ï¼š http://localhost:8080/dev/add?age=10 è¿”å›žä¿¡æ¯ä¸ºï¼šç”¨æˆ·åä¸èƒ½ä¸ºç©º 4ã€æˆ‘ä»¬ä¼šå‘çŽ°ï¼Œæ­£ç¡®è¿”å›žæ˜¯æ–°æ·»åŠ å­¦ç”Ÿçš„jsonæ ¼å¼ï¼Œé”™è¯¯è¿”å›žå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ ·å¯¹äºŽå‰å°æ¥è¯´æ˜¯æ— æ³•å¤„ç†çš„ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå°è£…ç±»æ¥åŒ…è£…ä¸€ä¸‹ã€‚ 5ã€ä¸‹é¢å¯¹controllerå±‚è¿›è¡Œæ”¹é€ ï¼Œè¿”å›žç»Ÿä¸€çš„æ ¼å¼ã€‚ 6ã€controlleræ›¾è¿›è¡Œç»“æžœå°è£…çš„æ—¶å€™ï¼Œå‘çŽ°ä»£ç é‡å¤ï¼Œè¿›è¡Œä¼˜åŒ–ã€‚ æ–°å»ºä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨æ¥å°è£…ç»“æžœã€‚ ç»§è€Œæ”¹é€ controller: ç»“æžœä¸Žä¸Šé¢ä¸€è‡´ã€‚ ä¸‰ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç† å¦‚æžœserviceå±‚ä¸šåŠ¡é€»è¾‘æ˜¯ï¼š 1ã€æˆ‘ä»¬ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ–¹æ¡ˆå¯èƒ½æ˜¯ç»™æ¯ä¸€ç§æƒ…å†µåŠ ä¸Šä¸€ä¸ªæ ‡è®°ï¼Œcontrollerå±‚æ ¹æ®æ ‡è®°çš„ä¸åŒè¿›è¡Œä¸åŒçš„è¿”å›žå¤„ç†ï¼š serviceå±‚æ–¹æ³•ï¼š ç›¸åº”çš„controllerå±‚ä¸ºï¼š å¯¹äºŽé€»è¾‘æ¯”è¾ƒç®€å•çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¯ä»¥åˆ°è¾¾æˆ‘ä»¬çš„é¢„æœŸæ•ˆæžœï¼Œä½†æ˜¯ä¸€æ—¦ä¸šåŠ¡é‡é€»è¾‘å¤æ‚åº¦é«˜ä¸€ç‚¹ï¼Œå°±ä¼šéžå¸¸åœ°æ··ä¹±ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€‚ 2ã€åŠ ä¸Šå¼‚å¸¸å¤„ç† serviceå±‚å¤„ç†ä¸º: controllerå±‚å¤„ç†ä¸º: è¿”å›žç»“æžœä¸ºï¼š æ˜¾ç„¶æ ¼å¼éƒ½æ˜¯ä¸ç»Ÿä¸€çš„ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯å¯¹é»˜è®¤çš„exceptionè¿”å›žä¿¡æ¯å†è¿›è¡Œä¸€æ¬¡å°è£…ã€‚ 3ã€ä¿®æ”¹exceptionè¿”å›žä¿¡æ¯æ ¼å¼ï¼š æ–°å»ºä¸€ä¸ªhandleç±»ï¼š ä½†æ˜¯å¯¹äºŽè¿™ç§æ–¹å¼ï¼Œå¦‚æžœæˆ‘æƒ³è®©ä¸Šå°å­¦çš„å­¦ç¡•çŠ¶æ€ç ä¸º100,ä¸Šåˆä¸­çš„å­¦ç”Ÿçš„çŠ¶æ€ç ä¸º101ï¼Œå°±æ— æ³•å®žçŽ°äº†ã€‚è§£å†³æ–¹æ¡ˆï¼šè‡ªå®šä¹‰å¼‚å¸¸ã€‚ 4ã€è‡ªå®šä¹‰å¼‚å¸¸ æ–°å»ºä¸€ä¸ªå¼‚å¸¸ç±»ï¼š åœ¨serviceå±‚æŠ›å‡ºå¼‚å¸¸ä¸ºthrow new StudentException(100,&quot;è¿˜åœ¨ä¸Šå°å­¦&quot;)ã€‚ åœ¨åˆšæ‰å†™çš„é»˜è®¤å¼‚å¸¸å¤„ç†ç±»ä¸­è¿›è¡Œåˆ¤æ–­å¤„ç†ï¼š è¿™æ ·ï¼Œå½“å±žäºŽå°å­¦ç”Ÿæ—¶ï¼ŒçŠ¶æ€ç ä¸º100,å½“å±žäºŽåˆä¸­ç”Ÿæ—¶ï¼ŒçŠ¶æ€ç ä¸º101ï¼Œå°±åŒºåˆ†å¼€äº†ã€‚å½“ä¸å±žäºŽè¿™ä¸ªå¼‚å¸¸çš„å¼‚å¸¸ï¼Œå°±ä¼šæŠ›å‡ºæœªçŸ¥é”™è¯¯ã€‚è¿™æ ·ä¹Ÿä¸å¥½ï¼Œæœ€å¥½ç”¨æ—¥å¿—å°†æœªçŸ¥é”™è¯¯æ‰“å°å‡ºæ¥ã€‚ 5ã€ç³»ç»Ÿå¼‚å¸¸(é»˜è®¤å¼‚å¸¸å¤„ç†): åˆ°çŽ°åœ¨ä»ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼šçŠ¶æ€ç ä¸ŽçŠ¶æ€ä¿¡æ¯éƒ½æ˜¯è‡ªå·±åœ¨ç¨‹åºä¸­ä¸´æ—¶å®šä¹‰çš„ï¼Œæ˜¯ä¸è§„èŒƒçš„è¡Œä¸ºï¼Œéœ€è¦æœ‰ä¸€ä¸ªåœ°æ–¹ç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºŽåŒºåˆ†å’Œé˜²æ­¢æ··ä¹±é‡å¤ã€‚ 6ã€æžšä¸¾å®šä¹‰å¼‚å¸¸çŠ¶æ€ æ”¹é€ serviceå±‚ï¼š è¿™æ ·å°±å®Œæˆäº†å¼‚å¸¸çš„ç»Ÿä¸€ç®¡ç†ã€‚ å››ã€springbootæµ‹è¯• 1ã€å¯¹äºŽserviceå±‚çš„æµ‹è¯• åˆ›å»ºï¼šæ–¹æ³•åå³å‡»â€”go toâ€“test 2ã€å¯¹äºŽcontrollerå±‚çš„apiçš„æµ‹è¯•]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[10.SleuthæœåŠ¡è¿½è¸ª]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F10.Sleuth%E6%9C%8D%E5%8A%A1%E8%BF%BD%E8%B8%AA%2F</url>
    <content type="text"><![CDATA[åœ¨ä»¥å‰ï¼Œæ‰€æœ‰çš„ä¸œè¥¿æ”¾åœ¨ä¸€èµ·æ‰“åŒ…ï¼Œæ”¾åˆ°æœåŠ¡å™¨ä¸Šä¹Ÿå°±ä¸ç®¡äº†ï¼Œä½†æ˜¯åˆ°äº†åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¸€ä¸ªè¯·æ±‚è¦ç»è¿‡åå‡ ä¸ªæœåŠ¡çš„å‘¨è½¬ï¼Œå¦‚æžœä¸è¿›è¡Œé“¾è·¯çš„è¿½è¸ªï¼Œè¿™äº›å¯¹äºŽæˆ‘ä»¬æ¥è¯´éƒ½æ˜¯é€æ˜Žçš„ï¼Œé‚£ä¹ˆå“ªä¸ªèŠ‚ç‚¹å­˜åœ¨é—®é¢˜æˆ–è€…å­˜åœ¨è¶…æ—¶éšæ‚£æˆ‘ä»¬éƒ½æ˜¯å¾ˆéš¾çŸ¥é“çš„ï¼Œå› æ­¤æœåŠ¡è¿½è¸ªæ˜¯æˆ‘ä»¬å¿…é¡»è¦åšçš„ä¸€æ ·äº‹æƒ…ã€‚ ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªspringcloud-sleuthå‘¢ï¼Ÿ éšç€åˆ†å¸ƒå¼ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œä½ çš„ä¸€ä¸ªè¯·æ±‚å‘è¿‡å‘è¿‡åŽ»ï¼Œå„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„è·³è½¬ï¼Œæœ‰å¯èƒ½æŸä¸ªè¯·æ±‚æŸä¸€å¤©åŽ‹åŠ›å¤ªå¤§äº†ï¼Œä¸€ä¸ªè¯·æ±‚è¿‡åŽ»æ²¡å“åº”ï¼Œä¸€ä¸ªè¯·æ±‚ä¸‹åŽ»ä¾èµ–äº†ä¸‰å››ä¸ªæœåŠ¡ï¼Œä½†æ˜¯ä½ åŽ»ä¸çŸ¥é“å“ªä¸€ä¸ªæœåŠ¡å‡ºæ¥é—®é¢˜ï¼Œè¿™æ—¶å€™æˆ‘æ˜¯ä¸æ˜¯éœ€è¦å¯¹å¾®æœåŠ¡è¿›è¡Œè¿½è¸ªå‘€ï¼Ÿç›‘æŽ§ä¸€ä¸ªè¯·æ±‚çš„å‘èµ·ï¼Œä»ŽæœåŠ¡ä¹‹é—´ä¼ é€’ä¹‹é—´çš„è¿‡ç¨‹ï¼Œæˆ‘æœ€å¥½è®°å½•ä¸€ä¸‹ï¼Œè®°å½•æ¯ä¸€ä¸ªçš„è€—æ—¶å¤šä¹…ï¼Œä¸€æ—¦å‡ºäº†é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹æ€§çš„è¿›è¡Œä¼˜åŒ–ï¼Œæ˜¯è¦å¢žåŠ èŠ‚ç‚¹ï¼Œå‡è½»åŽ‹åŠ›ï¼Œè¿˜æ˜¯æœåŠ¡ç»§ç»­æ‹†åˆ†ï¼Œè®©é€»è¾‘æ›´åŠ ç®€å•ç‚¹å‘¢ï¼Ÿè¿™æ—¶å€™springcloud-sleuthé›†æˆzipkinèƒ½å¸®æˆ‘ä»¬è§£å†³è¿™äº›æœåŠ¡è¿½è¸ªé—®é¢˜ã€‚ äºŒã€åˆ›å»ºå·¥ç¨‹ æœ¬å·¥ç¨‹çš„Spring Bootçš„ç‰ˆæœ¬ä¸º1.5.8ï¼ŒSpring Cloudç‰ˆæœ¬ä¸ºDalston.RELEASEã€‚åŒ…å«äº†eureka-serverå·¥ç¨‹ï¼Œä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œeureka-serverçš„åˆ›å»ºè¿‡ç¨‹è¿™é‡Œä¸é‡å¤ï¼›zipkin-serverä½œä¸ºé“¾è·¯è¿½è¸ªæœåŠ¡ä¸­å¿ƒï¼Œè´Ÿè´£å­˜å‚¨é“¾è·¯æ•°æ®ï¼›gateway-serviceä½œä¸ºæœåŠ¡ç½‘å…³å·¥ç¨‹ï¼Œè´Ÿè´£è¯·æ±‚çš„è½¬å‘,åŒæ—¶å®ƒä¹Ÿä½œä¸ºé“¾è·¯è¿½è¸ªå®¢æˆ·ç«¯ï¼Œè´Ÿè´£äº§ç”Ÿæ•°æ®ï¼Œå¹¶ä¸Šä¼ ç»™zipkin-serviceï¼›user-serviceä¸ºä¸€ä¸ªåº”ç”¨æœåŠ¡ï¼Œå¯¹å¤–æš´éœ²APIæŽ¥å£ï¼ŒåŒæ—¶å®ƒä¹Ÿä½œä¸ºé“¾è·¯è¿½è¸ªå®¢æˆ·ç«¯ï¼Œè´Ÿè´£äº§ç”Ÿæ•°æ®ã€‚ 1.æž„å»ºeureka-server è¿™ä¸ªæœåŠ¡å°±æ¯”è¾ƒç®€å•äº†ï¼Œå°±æ˜¯eurekaçš„æœåŠ¡ç«¯ï¼Œç”¨æ¥æ³¨å†ŒæœåŠ¡ã€‚è§ä»£ç eureka-server. 2.æž„å»ºzipkin-server ä¾èµ–ï¼š 12345678910111213141516171819202122232425262728&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--eurekaæœåŠ¡ç«¯--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zipkinæœåŠ¡ç«¯--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.java&lt;/groupId&gt; &lt;artifactId&gt;zipkin-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--æ˜¾ç¤ºçš„é¡µé¢--&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.java&lt;/groupId&gt; &lt;artifactId&gt;zipkin-autoconfigure-ui&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ä¸»å‡½æ•°ä¸Šæ‰“ä¸Šä¸¤ä¸ªæ³¨è§£å¼€å¯ZipkinServerçš„åŠŸèƒ½ï¼š 12@EnableEurekaClient@EnableZipkinServer é…ç½®æ–‡ä»¶ä¸Šä¹Ÿå¾ˆç®€å•ï¼Œæ³¨å†Œåˆ°eurekaä¸Šå’ŒæŒ‡å®šå¥½å¯åŠ¨çš„ç«¯å£å³å¯ã€‚ 123456789eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/server: port: 9411spring: application: name: zipkin-server 3.æž„å»ºuser-service æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œå–åä¸ºuser-serviceï¼Œä½œä¸ºåº”ç”¨æœåŠ¡ï¼Œå¯¹å¤–æš´éœ²APIæŽ¥å£. ä¾èµ–ï¼š 12345678910111213141516171819202122&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; æ‰“ä¸Šeurekaæ³¨è§£ã€‚é…ç½®æ–‡ä»¶ä¸ºï¼š 1234567891011121314eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/server: port: 8080spring: application: name: user-service zipkin: base-url: http://localhost:9411 sleuth: sampler: percentage: 1.0 Zipkin Serveråœ°å€ä¸ºhttp://localhost:9411ã€‚ spring.sleuth.sampler.percentageä¸º1.0,å³100%çš„æ¦‚çŽ‡å°†é“¾è·¯çš„æ•°æ®ä¸Šä¼ ç»™Zipkin Serverï¼Œåœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œè¯¥å€¼ä¸º0.1. æµ‹è¯•çš„apiä¸ºï¼š 123456789@RestController@RequestMapping("/user")public class UserController &#123; @GetMapping("/hello") public String hi()&#123; return "hello user!"; &#125;&#125; 4.æž„å»ºgateway-service æ–°å»ºä¸€ä¸ªåä¸ºgateway-serviceå·¥ç¨‹ï¼Œè¿™ä¸ªå·¥ç¨‹ä½œä¸ºæœåŠ¡ç½‘å…³ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°user-serviceï¼Œä½œä¸ºZipkinå®¢æˆ·ç«¯ï¼Œéœ€è¦å°†é“¾è·¯æ•°æ®ä¸Šä¼ ç»™Zipkin Serverï¼ŒåŒæ—¶å®ƒä¹Ÿä½œä¸ºEureka Clientã€‚ ä¾èµ–ï¼š 12345678910111213141516171819&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zuul&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;version&gt;RELEASE&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; æ³¨è§£ï¼š 12@EnableEurekaClient@EnableZuulProxy é…ç½®æ–‡ä»¶ï¼š 123456789101112131415161718192021eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/server: port: 8081spring: application: name: gateway-service sleuth: sampler: percentage: 1.0 zipkin: base-url: http://localhost:9411zuul: routes: api-a: path: /user-api/** serviceId: user-service ä»¥â€œ/user-api/**â€å¼€å¤´çš„Uriè¯·æ±‚ï¼Œè½¬å‘åˆ°æœåŠ¡åä¸º user-service çš„æœåŠ¡ ä¸‰ã€æ¼”ç¤ºæ•ˆæžœ å®Œæ•´çš„é¡¹ç›®æ­å»ºå®Œæ¯•ï¼Œä¾æ¬¡å¯åŠ¨eureka-serverã€zipkin-serverã€user-serviceã€gateway-serviceã€‚åœ¨æµè§ˆå™¨ä¸Šè®¿é—®http://localhost:8081/user-api/user/hi è®¿é—®http://localhost:9411ï¼Œå³è®¿é—®Zipkinçš„å±•ç¤ºç•Œé¢ï¼Œç•Œé¢æ˜¾ç¤ºå¦‚å›¾æ‰€ç¤ºï¼š è¿™ä¸ªç•Œé¢ä¸»è¦ç”¨æ¥æŸ¥æ‰¾æœåŠ¡çš„è°ƒç”¨æƒ…å†µï¼Œå¯ä»¥æ ¹æ®æœåŠ¡åã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€è¯·æ±‚æ¶ˆè€—çš„æ—¶é—´ç­‰æ¡ä»¶æ¥æŸ¥æ‰¾ã€‚ç‚¹å‡»â€œFind Tracesâ€æŒ‰é’®ï¼Œç•Œé¢å¦‚å›¾æ‰€ç¤ºã€‚ä»Žå›¾å¯çŸ¥æœåŠ¡çš„è°ƒç”¨æƒ…å†µï¼Œæ¯”å¦‚æœåŠ¡è°ƒç”¨æ—¶é—´ã€æœåŠ¡çš„æ¶ˆè€—æ—¶é—´ï¼ŒæœåŠ¡è°ƒç”¨çš„é“¾è·¯æƒ…å†µã€‚ ç‚¹å‡»DependencesæŒ‰é’®ï¼Œå¯ä»¥æŸ¥çœ‹æœåŠ¡çš„ä¾èµ–å…³ç³»ï¼Œåœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼Œgateway-serviceå°†è¯·æ±‚è½¬å‘åˆ°äº†user-serviceï¼Œå®ƒä»¬çš„ä¾èµ–å…³ç³»å¦‚å›¾ï¼š å‚è€ƒæ–‡ç« ï¼šSpring Cloud Sleuthè¿›é˜¶å®žæˆ˜]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[9.Streamæ¶ˆæ¯é©±åŠ¨]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F9.Stream%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8%2F</url>
    <content type="text"><![CDATA[å¯¹äºŽMQæˆ‘ä»¬å¹¶ä¸é™Œç”Ÿï¼Œå¸‚é¢ä¸Šä¹Ÿæœ‰å½¢å½¢è‰²è‰²çš„MQï¼Œå„æœ‰å„çš„ç‰¹ç‚¹ï¼ŒåŽŸç†ä¸Šå¤šå¤šå°‘å°‘æœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒMQçš„æ›´æ¢çš„æ—¶å€™å¯èƒ½ä¼šå‡ºçŽ°ä»£ç çš„å¤§ç‰‡ä¿®æ”¹ï¼Œè¿™æ˜¾ç„¶æ˜¯å¾ˆä¸å¥½çš„ï¼Œæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼æ¥å±è”½æŽ‰è¿™ç§MQé—´çš„å·®å¼‚å‘¢ï¼Ÿè¿™å°±å¼•å‡ºäº†ä»Šå¤©è®¨è®ºçš„ä¸»è§’ï¼šSpring Cloud Stream. ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦SpringCloud Streamæ¶ˆæ¯é©±åŠ¨å‘¢ï¼Ÿ æ¯”æ–¹è¯´æˆ‘ä»¬ç”¨åˆ°äº†RabbitMQå’ŒKafkaï¼Œç”±äºŽè¿™ä¸¤ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶çš„æž¶æž„ä¸Šçš„ä¸åŒï¼ŒåƒRabbitMQæœ‰exchangeï¼Œkafkaæœ‰Topicï¼Œpartitionsåˆ†åŒºï¼Œè¿™äº›ä¸­é—´ä»¶çš„å·®å¼‚æ€§å¯¼è‡´æˆ‘ä»¬å®žé™…é¡¹ç›®å¼€å‘ç»™æˆ‘ä»¬é€ æˆäº†ä¸€å®šçš„å›°æ‰°ï¼Œæˆ‘ä»¬å¦‚æžœç”¨äº†ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„å…¶ä¸­ä¸€ç§ï¼Œ åŽé¢çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘æƒ³å¾€å¦å¤–ä¸€ç§æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¿ç§»ï¼Œè¿™æ—¶å€™æ— ç–‘å°±æ˜¯ä¸€ä¸ªç¾éš¾æ€§çš„ï¼Œä¸€å¤§å †ä¸œè¥¿éƒ½è¦é‡æ–°æŽ¨å€’é‡æ–°åšï¼Œå› ä¸ºå®ƒè·Ÿæˆ‘ä»¬çš„ç³»ç»Ÿè€¦åˆäº†ï¼Œè¿™æ—¶å€™springcloud Streamç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§è§£è€¦åˆçš„æ–¹å¼ã€‚ Spring Cloud Streamç”±ä¸€ä¸ªä¸­é—´ä»¶ä¸­ç«‹çš„æ ¸ç»„æˆã€‚åº”ç”¨é€šè¿‡Spring Cloud Streamæ’å…¥çš„input(ç›¸å½“äºŽæ¶ˆè´¹è€…consumerï¼Œå®ƒæ˜¯ä»Žé˜Ÿåˆ—ä¸­æŽ¥æ”¶æ¶ˆæ¯çš„)å’Œoutput(ç›¸å½“äºŽç”Ÿäº§è€…producerï¼Œå®ƒæ˜¯ä»Žé˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯çš„ã€‚)é€šé“ä¸Žå¤–ç•Œäº¤æµã€‚ é€šé“é€šè¿‡æŒ‡å®šä¸­é—´ä»¶çš„Binderå®žçŽ°ä¸Žå¤–éƒ¨ä»£ç†è¿žæŽ¥ã€‚ä¸šåŠ¡å¼€å‘è€…ä¸å†å…³æ³¨å…·ä½“æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œåªéœ€å…³æ³¨Binderå¯¹åº”ç”¨ç¨‹åºæä¾›çš„æŠ½è±¡æ¦‚å¿µæ¥ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶å®žçŽ°ä¸šåŠ¡å³å¯ã€‚ Binder: é€šè¿‡å®šä¹‰ç»‘å®šå™¨ä½œä¸ºä¸­é—´å±‚ï¼Œå®žçŽ°äº†åº”ç”¨ç¨‹åºä¸Žæ¶ˆæ¯ä¸­é—´ä»¶(Middleware)ç»†èŠ‚ä¹‹é—´çš„éš”ç¦»ã€‚é€šè¿‡å‘åº”ç”¨ç¨‹åºæš´éœ²ç»Ÿä¸€çš„Channelé€šé“ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸éœ€è¦å†è€ƒè™‘å„ç§ä¸åŒçš„æ¶ˆæ¯ä¸­é—´ä»¶çš„å®žçŽ°ã€‚å½“éœ€è¦å‡çº§æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæˆ–è€…æ˜¯æ›´æ¢å…¶ä»–æ¶ˆæ¯ä¸­é—´ä»¶äº§å“æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ›´æ¢å¯¹åº”çš„Binderç»‘å®šå™¨è€Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•åº”ç”¨é€»è¾‘ ã€‚ç”šè‡³å¯ä»¥ä»»æ„çš„æ”¹å˜ä¸­é—´ä»¶çš„ç±»åž‹è€Œä¸éœ€è¦ä¿®æ”¹ä¸€è¡Œä»£ç ã€‚ç›®å‰åªæä¾›äº†RabbitMQå’ŒKafkaçš„Binderå®žçŽ°ã€‚ Springcloud Streamè¿˜æœ‰ä¸ªå¥½å¤„å°±æ˜¯åƒKafkaä¸€æ ·å¼•å…¥äº†ä¸€ç‚¹åˆ†åŒºçš„æ¦‚å¿µï¼ŒåƒRabbitMQä¸æ”¯æŒåˆ†åŒºçš„é˜Ÿåˆ—ï¼Œä½ ç”¨äº†SpringCloud StreamæŠ€æœ¯ï¼Œå®ƒå°±ä¼šå¸®RabbitMQå¼•å…¥äº†åˆ†åŒºçš„ç‰¹æ€§ï¼ŒSpringCloud Streamå°±æ˜¯å¤©ç„¶æ”¯æŒåˆ†åŒºçš„ï¼Œæˆ‘ä»¬ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚ äºŒã€ç®€å•çš„æ¼”ç¤º é¦–å…ˆæˆ‘ä»¬è¦æ–°å»ºä¸‰ä¸ªé¡¹ç›®ï¼Œåˆ†åˆ«æ˜¯spring-cloud-streamï¼Œspring-cloud-stream1ï¼Œspring-cloud-stream2ï¼Œå…¶ä¸­spring-cloud-streamä½œä¸ºç”Ÿäº§è€…è¿›è¡Œå‘æ¶ˆæ¯æ¨¡å—ï¼Œspring-cloud-stream-1ï¼Œspring-cloud-stream-2ä½œä¸ºæ¶ˆæ¯æŽ¥æ”¶æ¨¡å—ã€‚ ç¬¬ä¸€æ­¥ï¼š å¯¹äºŽè¿™ä¸‰ä¸ªé¡¹ç›®ï¼Œéƒ½è¦å¼•å…¥ä¾èµ–ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.swg&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-stream-producer&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;spring-cloud-stream-producer&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-stream-dependencies&lt;/artifactId&gt; &lt;version&gt;Elmhurst.SR2&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-stream&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-kafka&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; ç¬¬äºŒæ­¥ï¼š å¯¹äºŽspring-cloud-streamï¼Œæ˜¯ä¿¡æ¯çš„ç”Ÿäº§æ–¹ï¼Œé…ç½®æ–‡ä»¶ä¸ºï¼š 12345678910111213141516171819202122server: port: 8081spring: application: name: producer cloud: stream: kafka: binder: #Kafkaçš„æ¶ˆæ¯ä¸­é—´ä»¶æœåŠ¡å™¨ brockers: localhost:9092 #Zookeeperçš„èŠ‚ç‚¹ï¼Œå¦‚æžœé›†ç¾¤ï¼ŒåŽé¢åŠ ,å·åˆ†éš” zk-nodes: localhost:2181 #å¦‚æžœè®¾ç½®ä¸ºfalse,å°±ä¸ä¼šè‡ªåŠ¨åˆ›å»ºTopic æœ‰å¯èƒ½ä½ Topicè¿˜æ²¡åˆ›å»ºå°±ç›´æŽ¥è°ƒç”¨äº†ã€‚ auto-create-topics: true bindings: #è¿™é‡Œç”¨streamç»™æˆ‘ä»¬æä¾›çš„é»˜è®¤outputï¼ŒåŽé¢ä¼šè®²åˆ°è‡ªå®šä¹‰output output: #æ¶ˆæ¯å‘å¾€çš„ç›®çš„åœ° destination: stream-demo #æ¶ˆæ¯å‘é€çš„æ ¼å¼ï¼ŒæŽ¥æ”¶ç«¯ä¸ç”¨æŒ‡å®šæ ¼å¼ï¼Œä½†æ˜¯å‘é€ç«¯è¦ content-type: text/plain è¿™é‡ŒæŒ‡å®šäº†kafkaå’Œzkçš„åœ°å€ï¼Œæœ€ç»ˆçš„æ˜¯ï¼ŒæŒ‡å®šäº†æˆ‘ä»¬è¦ç”¨çš„outputï¼Œå°±æ˜¯æ¶ˆæ¯çš„ç”Ÿäº§é€šé“ï¼Œè¿™é‡Œç”¨çš„æ˜¯è‡ªå®šä¹‰ã€‚ä¸‹é¢æŒ‡å®šäº†æ¶ˆæ¯çš„ç›®çš„åœ°ã€‚ å‘é€çš„ç¨‹åºSendServiceï¼š 123456789101112@EnableBinding(Source.class)public class SendService &#123; @Autowired private Source source; public void sendMsg(String msg)&#123; source.output().send(MessageBuilder.withPayload(msg).build()); &#125;&#125; è¿™é‡Œå°±æ˜¯æŽ¥å£ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åŽæŠŠæ¶ˆæ¯é€šè¿‡outputå‘é€åˆ°æŒ‡å®šçš„ç›®çš„åœ°ã€‚@EnableBinding(Source.class)è¿™ä¸ªæ³¨è§£ç»™æˆ‘ä»¬ç»‘å®šæ¶ˆæ¯é€šé“çš„ï¼ŒSourceæ˜¯Streamç»™æˆ‘ä»¬æä¾›çš„ï¼Œå¯ä»¥ç‚¹è¿›åŽ»çœ‹æºç ï¼Œå¯ä»¥çœ‹åˆ°outputå’Œinput,è¿™å’Œé…ç½®æ–‡ä»¶ä¸­çš„outputï¼Œinputå¯¹åº”çš„ã€‚ æœ€åŽå°±æ˜¯æµè§ˆå™¨ä¼ å…¥å€¼ï¼š 1234567891011121314@RestControllerpublic class HelloController &#123; @Autowired private SendService sendService; @RequestMapping("/send/&#123;msg&#125;") public void send(@PathVariable("msg") String msg)&#123; System.out.println("å‘é€äº†ã€‚ã€‚ã€‚"+msg); sendService.sendMsg(msg); &#125;&#125; ç¬¬ä¸‰æ­¥ï¼š æ¶ˆæ¯çš„å‘é€ç«¯å·²ç»æžå¥½äº†ï¼Œä¸‹é¢é…ç½®æ¶ˆæ¯çš„æ¶ˆè´¹ç«¯ã€‚é…ç½®æ–‡ä»¶ä¸ºï¼š 12345678910111213141516server: port: 8082spring: application: name: consumer_1 cloud: stream: kafka: binder: brockers: localhost:9092 zk-nodes: localhost:2181 auto-create-topics: true bindings: #inputæ˜¯æŽ¥æ”¶ï¼Œæ³¨æ„è¿™é‡Œä¸èƒ½å†åƒå‰é¢ä¸€æ ·å†™outputäº† input: destination: stream-demo æŽ¥æ”¶çš„serviceï¼š 12345678910//æ¶ˆæ¯æŽ¥å—ç«¯ï¼Œstreamç»™æˆ‘ä»¬æä¾›äº†Sink,Sinkæºç é‡Œé¢æ˜¯ç»‘å®šinputçš„ï¼Œè¦è·Ÿæˆ‘ä»¬é…ç½®æ–‡ä»¶çš„imputå…³è”çš„ã€‚@EnableBinding(Sink.class)public class RecieveService &#123; @StreamListener(Sink.INPUT)//å…¶å®žå°±æ˜¯@StreamListener(â€œinputâ€)ï¼Œç›‘å¬è¿™ä¸ªé€šé“æœ‰æ²¡æœ‰æ¶ˆæ¯è¿‡æ¥ï¼Œæœ‰å°±æ¶ˆè´¹ public void recieve(Object payload)&#123; System.out.println("====="+payload); &#125;&#125; ç¬¬å››æ­¥ å¯åŠ¨kafkaå’Œzkï¼Œä¸Šä¸€ç« å·²ç»è®²è¿‡äº†å¦‚ä½•å¯åŠ¨ã€‚æ‰“å¼€æµè§ˆå™¨è¾“å…¥å¯¹åº”çš„urlè¿›è¡Œæµ‹è¯•ï¼Œçœ‹ä¸¤ä¸ªæ¶ˆè´¹ç«¯æ˜¯å¦éƒ½å¯ä»¥æ‰“å°å‡ºæ¥ä¼ å…¥çš„ä¿¡æ¯ã€‚ æ€»ç»“ å…¶å®žä¸Šé¢çš„ä¸€ä¸ªæµç¨‹å°±å¯ä»¥æ¦‚æ‹¬ä¸ºä¸‹é¢ä¸€å¼ å›¾ï¼š ä¸€ä¸ªæ˜¯äº§å“çš„ç”Ÿäº§è€…ï¼Œä¸€ä¸ªæ˜¯å•†åº—æ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…å°†äº§å“é€šè¿‡é€šé“ï¼Œè¿™é‡Œå°±æ˜¯Sourceä¸­é»˜è®¤çš„outputï¼Œå°†äº§å“å‘é€åˆ°binderä¸­ï¼Œç»™ä»–ä¸€ä¸ªtopicï¼Œå‘Šè¯‰æ¶ˆè´¹è€…è¿™ä¸ªæ¶ˆæ¯çš„åå­—(ä½ç½®ï¼Œè¿™é‡Œæ˜¯stream-demo)ã€‚æ¶ˆè´¹è€…é€šè¿‡ç›‘å¬Sinkä¸­çš„é»˜è®¤çš„inputé€šé“æ¥çœ‹çœ‹æœ‰æ²¡æœ‰è‡ªå·±æ„Ÿå…´è¶£çš„æ¶ˆæ¯ã€‚ 12345678910111213public interface Source &#123; String OUTPUT = "output"; @Output("output") MessageChannel output();&#125;public interface Sink &#123; String INPUT = "input"; @Input("input") SubscribableChannel input();&#125; åˆ°è¿™é‡Œï¼Œæœ€åŸºæœ¬çš„ä¸€ä¸ªæ¶ˆæ¯çš„ç”Ÿäº§æ¶ˆè´¹æµç¨‹å°±èµ°å®Œäº†ã€‚ ä¸‰ã€è‡ªå®šä¹‰æ¶ˆæ¯é€šé“ åˆ°çŽ°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯å‘é€å’ŒæŽ¥æ”¶ï¼Œç”¨çš„æ˜¯Streamç»™æˆ‘ä»¬æä¾›çš„é»˜è®¤Sourceï¼ŒSinkï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬è¦è‡ªå·±è¿›è¡Œè‡ªå®šä¹‰ï¼Œè¿™ç§æ–¹å¼åœ¨å·¥ä½œä¸­è¿˜æ˜¯ç”¨çš„æ¯”è¾ƒå¤šçš„ï¼Œå› ä¸ºæˆ‘ä»¬è¦å¾€ä¸åŒçš„æ¶ˆæ¯é€šé“å‘æ¶ˆæ¯ï¼Œ å¿…ç„¶ä¸èƒ½å…¨éƒ½å«input,outputçš„ï¼Œé‚£æ ·çš„è¯å°±ä¹±å¥—äº†ï¼Œå› æ­¤é¦–å…ˆè‡ªå®šä¹‰ä¸€ä¸ªæŽ¥å£ï¼Œå¦‚ä¸‹ï¼š 123456789/** * Created by cong on 2018/5/28. */public interface MySource &#123; @Output("myOutput") MessageChannel myOutput();&#125; å…¶å®žå°±æ˜¯å°†é»˜è®¤çš„Sourceé‡Œçš„outputæ”¹ä¸ªåå­—è€Œå·²ï¼Œååˆ†ç®€å•ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šé€šé“çš„åœ°æ–¹å°±è¦å“åº”åœ°ä¿®æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„é€šé“å°±å¯ä»¥äº†ã€‚ 12345678910111213141516171819202122server: port: 7888spring: application: name: producer cloud: stream: kafka: binder:#Kafkaçš„æ¶ˆæ¯ä¸­é—´ä»¶æœåŠ¡å™¨ brockers: localhost:9092#Zookeeperçš„èŠ‚ç‚¹ï¼Œå¦‚æžœé›†ç¾¤ï¼ŒåŽé¢åŠ ,å·åˆ†éš” zk-nodes: localhost:2181#å¦‚æžœè®¾ç½®ä¸ºfalse,å°±ä¸ä¼šè‡ªåŠ¨åˆ›å»ºTopic æœ‰å¯èƒ½ä½ Topicè¿˜æ²¡åˆ›å»ºå°±ç›´æŽ¥è°ƒç”¨äº†ã€‚ auto-create-topics: true bindings:#è‡ªå®šä¹‰output myOutput:#æ¶ˆæ¯å‘å¾€çš„ç›®çš„åœ° destination: stream-demo#æ¶ˆæ¯å‘é€çš„æ ¼å¼ï¼ŒæŽ¥æ”¶ç«¯ä¸ç”¨æŒ‡å®šæ ¼å¼ï¼Œä½†æ˜¯å‘é€ç«¯è¦ content-type: text/plain ä¸‹é¢å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±æ˜¯æ³¨å…¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„sourceå³å¯ï¼š 1234567891011@EnableBinding(MySource.class)public class SendService &#123; @Autowired private MySource source; public void sendMsg(String msg)&#123; source.myOutput().send(MessageBuilder.withPayload(msg).build()); &#125;&#125; æ¶ˆè´¹è€…åŒæ ·å¦‚æ­¤ï¼Œå°±æ˜¯æ”¹ä¸€ä¸‹Sinkçš„åå­—å³å¯ã€‚ å››ã€æ¶ˆæ¯ä¸­è½¬ç«™ è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„åŠŸèƒ½ï¼Œå°±æ˜¯æ¶ˆæ¯ç»è¿‡ä¸­é—´ä¸€ä¸ªåŠ å·¥ä¸€ä¸‹ï¼Œå†ä¼ ç»™ä¸‹ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚å°±æ˜¯ä¸€ä¸ªé“¾å¼çš„è°ƒç”¨ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬è¿™é‡Œæ”¹é€ ä¸€ä¸‹spring-cloud-stream-consumer-1ä¸ºspring-cloud-stream-trans: ç¬¬ä¸€æ­¥ï¼š 12345678910111213141516171819server: port: 7889spring: application: name: consumer_1 cloud: stream: kafka: binder: brockers: localhost:9092 zk-nodes: localhost:2181 auto-create-topics: true bindings:#inputæ˜¯æŽ¥æ”¶ï¼Œæ³¨æ„è¿™é‡Œä¸èƒ½å†åƒå‰é¢ä¸€æ ·å†™outputäº† input: destination: stream-demo #è¿›è¡Œæ¶ˆæ¯ä¸­è½¬å¤„ç†åŽï¼Œåœ¨è¿›è¡Œè½¬å‘å‡ºåŽ» output: destination: stream-demo-trans ç¬¬äºŒæ­¥ï¼šæŽ¥ç€åœ¨æ–°å»ºä¸€ä¸ªæ¶ˆæ¯ä¸­è½¬ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516package hjc.consumer;import org.springframework.cloud.stream.annotation.EnableBinding;import org.springframework.cloud.stream.messaging.Processor;import org.springframework.integration.annotation.ServiceActivator;@EnableBinding(Processor.class)public class TransFormService &#123; @ServiceActivator(inputChannel = Processor.INPUT,outputChannel = Processor.OUTPUT) public Object transform(Object payload)&#123; System.out.println("æ¶ˆæ¯ä¸­è½¬ç«™ï¼š"+payload); return payload; &#125;&#125; è®°å¾—è¦å°†æ‹·è´è¿‡æ¥çš„å·¥ç¨‹ä¸­çš„SendServiceé‡Œé¢çš„æ³¨è§£å…¨éƒ¨åˆ é™¤æŽ‰ï¼Œè¦ä¸ç„¶ç¨‹åºå¯åŠ¨ä¼šæŠ¥é”™ã€‚ æŽ¥ç€è¦ä¿®æ”¹æ¶ˆæ¯ä¸­è½¬ç«™å‘é€æ¶ˆæ¯å‡ºåŽ»çš„æŽ¥æ”¶ç«¯springcloud-stream2çš„é…ç½®,inputçš„å€¼æ”¹ä¸ºstream-demo-transå³å¯ã€‚ äº”ã€æ¶ˆæ¯åˆ†ç»„ æˆ‘ä»¬éƒ½æ˜¯ä¸€ç«¯å‘æ¶ˆæ¯ï¼Œä¸¤ä¸ªæ¶ˆæ¯æŽ¥å—è€…éƒ½æŽ¥æ”¶åˆ°äº†ï¼Œä½†æ˜¯æœ‰æ—¶å€™æœ‰äº›ä¸šåŠ¡åœºæ™¯æˆ‘åªæƒ³è®©å…¶ä¸­ä¸€ä¸ªæ¶ˆæ¯æŽ¥æ”¶è€…æŽ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ Groupï¼Œå¦‚æžœä½¿ç”¨è¿‡ Kafka çš„è¯»è€…å¹¶ä¸ä¼šé™Œç”Ÿã€‚Spring Cloud Stream çš„è¿™ä¸ªåˆ†ç»„æ¦‚å¿µçš„æ„æ€åŸºæœ¬å’Œ Kafka ä¸€è‡´ã€‚å¾®æœåŠ¡ä¸­åŠ¨æ€çš„ç¼©æ”¾åŒä¸€ä¸ªåº”ç”¨çš„æ•°é‡ä»¥æ­¤æ¥è¾¾åˆ°æ›´é«˜çš„å¤„ç†èƒ½åŠ›æ˜¯éžå¸¸å¿…é¡»çš„ã€‚å¯¹äºŽè¿™ç§æƒ…å†µï¼ŒåŒä¸€ä¸ªäº‹ä»¶é˜²æ­¢è¢«é‡å¤æ¶ˆè´¹ï¼Œ åªè¦æŠŠè¿™äº›åº”ç”¨æ”¾ç½®äºŽåŒä¸€ä¸ª group ä¸­ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚ä¸åŒçš„ç»„æ˜¯å¯ä»¥æ¶ˆè´¹çš„ï¼ŒåŒä¸€ä¸ªç»„å†…ä¼šå‘ç”Ÿç«žäº‰å…³ç³»ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå¯ä»¥æ¶ˆè´¹ã€‚ ä¿®æ”¹æ¶ˆè´¹æ®µçš„é…ç½®æ–‡ä»¶ï¼Œå°†ä»–ä»¬éƒ½é…ç½®åˆ°åŒä¸€ä¸ªç»„ä¸‹é¢ï¼š 123456789101112131415161718server: port: 7889spring: application: name: consumer_1 cloud: stream: kafka: binder: brockers: localhost:9092 zk-nodes: localhost:2181 auto-create-topics: true bindings: #inputæ˜¯æŽ¥æ”¶ï¼Œæ³¨æ„è¿™é‡Œä¸èƒ½å†åƒå‰é¢ä¸€æ ·å†™outputäº† input: destination: stream-demo #åˆ†ç»„çš„ç»„å group: group å¯ä»¥çœ‹åˆ°springcloud-stream1å’Œspringcloud-stream2æ˜¯å±žäºŽåŒä¸€ç»„çš„ã€‚springcloud-streamæ¨¡å—çš„å‘çš„æ¶ˆæ¯åªèƒ½è¢«springcloud-stream1æˆ–springcloud-stream2å…¶ä¸­ä¸€ä¸ªæŽ¥æ”¶åˆ°ï¼Œè¿™æ ·é¿å…äº†é‡å¤æ¶ˆè´¹ã€‚]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[8.Busæ¶ˆæ¯æ€»çº¿]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F8.Bus%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF%2F</url>
    <content type="text"><![CDATA[ä¸ºäº†å®žçŽ°ä¾æ¬¡redreshè‡ªåŠ¨åˆ·æ–°æ‰€æœ‰æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥æ¶ˆæ¯æ€»çº¿è¿›è¡Œæ¶ˆæ¯çš„é€šçŸ¥ï¼Œæœ¬æ–‡ä¸»è¦é‡‡ç”¨kafkaä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æ¥å®žçŽ°ï¼Œå½“ç„¶äº†ï¼ŒrabbitMQä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ ä¸€ã€å‰è¨€ æ³¨ï¼šæœ¬ç¯‡æ–‡ç« æ˜¯åŸºäºŽspring boot 2.xï¼Œä¸»è¦å‚è€ƒ SpringCloudå®žæˆ˜8-Busæ¶ˆæ¯æ€»çº¿ è¿™ç¯‡æ–‡ç« è€Œå†™ã€‚ä½†æ˜¯ä»–çš„ç‰ˆæœ¬æ¯”è¾ƒä½Žï¼Œæœ‰ä¸€ä¸¤ä¸ªå‘éœ€è¦æ³¨æ„ã€‚ ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²åˆ°ï¼Œæˆ‘ä»¬å¦‚æžœè¦åŽ»æ›´æ–°æ‰€æœ‰å¾®æœåŠ¡çš„é…ç½®ï¼Œåœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹åŽ»æ›´æ–°é…ç½®ï¼Œåªèƒ½ä¾é spring cloud configäº†ï¼Œä½†æ˜¯ï¼Œæ˜¯æˆ‘ä»¬è¦ä¸€ä¸ªæœåŠ¡ä¸€ä¸ªæœåŠ¡çš„å‘é€postè¯·æ±‚ï¼Œæˆ‘ä»¬èƒ½å—çš„äº†å—ï¼Ÿ è™½ç„¶è¿™æ¯”ä¹‹å‰çš„æ²¡é…ç½®ä¸­å¿ƒå¥½å¤šäº†ï¼Œé‚£ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•ç»§ç»­é¿å…æŒ¨ä¸ªæŒ¨ä¸ªçš„å‘æœåŠ¡å‘é€Postè¯·æ±‚æ¥å‘ŠçŸ¥æœåŠ¡ä½ çš„é…ç½®ä¿¡æ¯æ”¹å˜äº†ï¼Œéœ€è¦åŠæ—¶ä¿®æ”¹å†…å­˜ä¸­çš„é…ç½®ä¿¡æ¯å‘¢ï¼Ÿ è¿™æ—¶å€™æˆ‘ä»¬å°±ä¸è¦å¿˜è®°æ¶ˆæ¯é˜Ÿåˆ—çš„å‘å¸ƒè®¢é˜…æ¨¡åž‹ã€‚è®©æ‰€æœ‰ä¸ºæœåŠ¡æ¥è®¢é˜…è¿™ä¸ªäº‹ä»¶ï¼Œå½“è¿™ä¸ªäº‹ä»¶å‘ç”Ÿæ”¹å˜äº†ï¼Œå°±å¯ä»¥é€šçŸ¥æ‰€æœ‰å¾®æœåŠ¡åŽ»æ›´æ–°å®ƒä»¬çš„å†…å­˜ä¸­çš„é…ç½®ä¿¡æ¯ã€‚è¿™æ—¶Busæ¶ˆæ¯æ€»çº¿å°±èƒ½è§£å†³ï¼Œä½ åªéœ€è¦åœ¨springcloud Config Serverç«¯å‘å‡ºrefreshï¼Œå°±å¯ä»¥è§¦å‘æ‰€æœ‰å¾®æœåŠ¡æ›´æ–°äº†ã€‚ å¦‚ä¸‹æž¶æž„å›¾æ‰€ç¤ºï¼š æ ¹æ®æ­¤å›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºåˆ©ç”¨Spring Cloud Busåšé…ç½®æ›´æ–°çš„æ­¥éª¤: 1ã€æäº¤ä»£ç è§¦å‘postç»™å®¢æˆ·ç«¯Aå‘é€bus/refresh 2ã€å®¢æˆ·ç«¯AæŽ¥æ”¶åˆ°è¯·æ±‚ä»ŽServerç«¯æ›´æ–°é…ç½®å¹¶ä¸”å‘é€ç»™Spring Cloud Bus 3ã€Spring Cloud busæŽ¥åˆ°æ¶ˆæ¯å¹¶é€šçŸ¥ç»™å…¶å®ƒå®¢æˆ·ç«¯ 4ã€å…¶å®ƒå®¢æˆ·ç«¯æŽ¥æ”¶åˆ°é€šçŸ¥ï¼Œè¯·æ±‚Serverç«¯èŽ·å–æœ€æ–°é…ç½® 5ã€å…¨éƒ¨å®¢æˆ·ç«¯å‡èŽ·å–åˆ°æœ€æ–°çš„é…ç½® Spring Cloud Busé™¤äº†æ”¯æŒRabbitMQçš„è‡ªåŠ¨åŒ–é…ç½®ä¹‹å¤–ï¼Œè¿˜æ”¯æŒçŽ°åœ¨è¢«å¹¿æ³›åº”ç”¨çš„Kafkaã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ­å»ºä¸€ä¸ªKafkaçš„æœ¬åœ°çŽ¯å¢ƒï¼Œå¹¶é€šè¿‡å®ƒæ¥å°è¯•ä½¿ç”¨Spring Cloud Buså¯¹Kafkaçš„æ”¯æŒï¼Œå®žçŽ°æ¶ˆæ¯æ€»çº¿çš„åŠŸèƒ½ã€‚ äºŒã€Kafka Kafkaä½¿ç”¨Scalaå®žçŽ°ï¼Œè¢«ç”¨ä½œLinkedInçš„æ´»åŠ¨æµå’Œè¿è¥æ•°æ®å¤„ç†çš„ç®¡é“ï¼ŒçŽ°åœ¨ä¹Ÿè¢«è¯¸å¤šäº’è”ç½‘ä¼ä¸šå¹¿æ³›åœ°ç”¨ä½œä¸ºæ•°æ®æµç®¡é“å’Œæ¶ˆæ¯ç³»ç»Ÿã€‚ Kafakæž¶æž„å›¾å¦‚ä¸‹: Kafkaæ˜¯åŸºäºŽæ¶ˆæ¯å‘å¸ƒ/è®¢é˜…æ¨¡å¼å®žçŽ°çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œå…¶ä¸»è¦è®¾è®¡ç›®æ ‡å¦‚ä¸‹ï¼š æ¶ˆæ¯æŒä¹…åŒ–ï¼šä»¥æ—¶é—´å¤æ‚åº¦ä¸ºO(1)çš„æ–¹å¼æä¾›æ¶ˆæ¯æŒä¹…åŒ–èƒ½åŠ›ï¼Œå³ä½¿å¯¹TBçº§ä»¥ä¸Šæ•°æ®ä¹Ÿèƒ½ä¿è¯å¸¸æ•°æ—¶é—´å¤æ‚åº¦çš„è®¿é—®æ€§èƒ½ã€‚ é«˜åžåï¼šåœ¨å»‰ä»·çš„å•†ç”¨æœºå™¨ä¸Šä¹Ÿèƒ½æ”¯æŒå•æœºæ¯ç§’100Kæ¡ä»¥ä¸Šçš„åžåé‡ åˆ†å¸ƒå¼ï¼šæ”¯æŒæ¶ˆæ¯åˆ†åŒºä»¥åŠåˆ†å¸ƒå¼æ¶ˆè´¹ï¼Œå¹¶ä¿è¯åˆ†åŒºå†…çš„æ¶ˆæ¯é¡ºåº è·¨å¹³å°ï¼šæ”¯æŒä¸åŒæŠ€æœ¯å¹³å°çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ï¼šJavaã€PHPã€Pythonç­‰ï¼‰ å®žæ—¶æ€§ï¼šæ”¯æŒå®žæ—¶æ•°æ®å¤„ç†å’Œç¦»çº¿æ•°æ®å¤„ç† ä¼¸ç¼©æ€§ï¼šæ”¯æŒæ°´å¹³æ‰©å±• Kafkaä¸­æ¶‰åŠçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š Brokerï¼šKafkaé›†ç¾¤åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨è¢«ç§°ä¸ºBrokerã€‚ Topicï¼šé€»è¾‘ä¸ŠåŒRabbitçš„Queueé˜Ÿåˆ—ç›¸ä¼¼ï¼Œæ¯æ¡å‘å¸ƒåˆ°Kafkaé›†ç¾¤çš„æ¶ˆæ¯éƒ½å¿…é¡»æœ‰ä¸€ä¸ªTopicã€‚ï¼ˆç‰©ç†ä¸Šä¸åŒTopicçš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ï¼Œé€»è¾‘ä¸Šä¸€ä¸ªTopicçš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºŽä¸€ä¸ªæˆ–å¤šä¸ªBrokerä¸Šï¼Œä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„Topicå³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºŽä½•å¤„ï¼‰ Partitionï¼šPartitionæ˜¯ç‰©ç†æ¦‚å¿µä¸Šçš„åˆ†åŒºï¼Œä¸ºäº†æä¾›ç³»ç»ŸåžåçŽ‡ï¼Œåœ¨ç‰©ç†ä¸Šæ¯ä¸ªTopicä¼šåˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªPartitionï¼Œæ¯ä¸ªPartitionå¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆå­˜å‚¨å¯¹åº”åˆ†åŒºçš„æ¶ˆæ¯å†…å®¹å’Œç´¢å¼•æ–‡ä»¶ï¼‰ã€‚ Producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œè´Ÿè´£ç”Ÿäº§æ¶ˆæ¯å¹¶å‘é€åˆ°Kafka Brokerã€‚ Consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘Kafka Brokerè¯»å–æ¶ˆæ¯å¹¶å¤„ç†çš„å®¢æˆ·ç«¯ã€‚ Consumer Groupï¼šæ¯ä¸ªConsumerå±žäºŽä¸€ä¸ªç‰¹å®šçš„ç»„ï¼ˆå¯ä¸ºæ¯ä¸ªConsumeræŒ‡å®šå±žäºŽä¸€ä¸ªç»„ï¼Œè‹¥ä¸æŒ‡å®šåˆ™å±žäºŽé»˜è®¤ç»„ï¼‰ï¼Œç»„å¯ä»¥ç”¨æ¥å®žçŽ°ä¸€æ¡æ¶ˆæ¯è¢«ç»„å†…å¤šä¸ªæˆå‘˜æ¶ˆè´¹ç­‰åŠŸèƒ½ã€‚ å¯ä»¥ä»Žkafkaçš„æž¶æž„å›¾çœ‹åˆ°Kafkaæ˜¯éœ€è¦Zookeeperæ”¯æŒçš„ï¼Œä½ éœ€è¦åœ¨ä½ çš„Kafkaé…ç½®é‡Œé¢æŒ‡å®šZookeeperåœ¨å“ªé‡Œï¼Œå®ƒæ˜¯é€šè¿‡Zookeeperåšä¸€äº›å¯é æ€§çš„ä¿è¯ï¼Œåšbrokerçš„ä¸»ä»Žï¼Œæˆ‘ä»¬è¿˜è¦çŸ¥é“Kafkaçš„æ¶ˆæ¯æ˜¯ä»¥topicå½¢å¼ä½œä¸ºç»„ç»‡çš„ï¼ŒProducerså‘é€topicå½¢å¼çš„æ¶ˆæ¯ï¼Œ Consumeræ˜¯æŒ‰ç…§ç»„æ¥åˆ†çš„ï¼Œæ‰€ä»¥ï¼Œä¸€ç»„Consumerséƒ½ä¼šæŽ¥æ”¶åŒæ ·çš„topicå½¢å¼çš„æ¶ˆæ¯ã€‚åœ¨æœåŠ¡ç«¯ï¼Œå®ƒè¿˜åšäº†ä¸€äº›åˆ†ç‰‡ï¼Œé‚£ä¹ˆä¸€ä¸ªTopicå¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„åˆ†ç‰‡ä¸Šé¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ‹“å±•éƒ¨ç½²å¤šä¸ªæœºå™¨ï¼ŒKafkaæ˜¯å¤©ç”Ÿåˆ†å¸ƒå¼çš„ã€‚ é¦–å…ˆæ˜¯è¦ä¸‹è½½å¯¹åº”çš„kafkaï¼šhttps://www.apache.org/dyn/closer.cgi?path=/kafka/2.1.0/kafka_2.11-2.1.0.tgz è§£åŽ‹ä¹‹åŽè¿›åŽ»/bin/windows/ç›®å½•ä¸‹ï¼š é¦–å…ˆå¯åŠ¨zookeeper: 1.\zookeeper-server-start.bat D:\kafka_2.11-2.1.0\config\zookeeper.properties å¦‚æžœå‡ºçŽ°é”™è¯¯ï¼š 123å‘½ä»¤è¯­æ³•ä¸æ­£ç¡®ã€‚é”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» Files\Java\jdk1.8.0_121\lib\dt.jar;C:\ProgramPS D:\kafka_2.11-2.1.0\bin\windows&gt; .\zookeeper-server-start.bat D:\kafka_2.11-2.1.0\config/zookeeper.properties æ–¹æ³•æ˜¯ï¼š é¦–å…ˆæˆ‘ä»¬è¿›åˆ°ä¸‹è½½å¥½çš„Kafkaç›®å½•ä¸­kafka_2.11-1.1.0\bin\windows ä¸‹ç¼–è¾‘kafka-run-class.batå¦‚ä¸‹ï¼š æ‰¾åˆ°è¿™æ¡é…ç½® å¦‚ä¸‹ï¼š set COMMAND=%JAVA% %KAFKA_HEAP_OPTS% %KAFKA_JVM_PERFORMANCE_OPTS% %KAFKA_JMX_OPTS% %KAFKA_LOG4J_OPTS% -cp %CLASSPATH% %KAFKA_OPTS% %* å¯ä»¥çœ‹åˆ°%CLASSPATH%æ²¡æœ‰åŒå¼•å·ï¼Œ å› æ­¤ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œä¸ç„¶å¯åŠ¨ä¸èµ·æ¥çš„ï¼ŒæŠ¥ä½ JDKæ²¡å®‰è£…å¥½ï¼Œä¿®æ”¹åŽå¦‚ä¸‹ï¼š set COMMAND=%JAVA% %KAFKA_HEAP_OPTS% %KAFKA_JVM_PERFORMANCE_OPTS% %KAFKA_JMX_OPTS% %KAFKA_LOG4J_OPTS% -cp â€œ%CLASSPATH%â€ %KAFKA_OPTS% %* åŽé¢å¯åŠ¨kafka: 1.\kafka-server-start.bat D:\kafka_2.11-2.1.0\config\server.properties è¿™ä¸¤è€…é…ç½®æ–‡ä»¶ç›´æŽ¥é»˜è®¤å³å¯ã€‚å¯åŠ¨æˆåŠŸä¹‹åŽï¼Œå°±æ”¾é‚£å§ï¼ æ¶ˆæ¯æ€»çº¿ åœ¨ä¸Šä¸€ç« çš„spring-cloud-config-serverä»¥åŠclientç»§ç»­é›†æˆã€‚spring bootç‰ˆæœ¬æ˜¯2.0.3.RELEASE. ç¬¬ä¸€æ­¥ï¼šspring cloud configæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯(æžä¸¤ä¸ªå®¢æˆ·ç«¯)éƒ½è¦å¼•å…¥kafkaä¾èµ–ï¼Œä»¥config serverç«¯ä¸ºä¾‹ï¼š 12345678910111213141516171819202122232425262728293031&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--Eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--config server--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--kafka MQ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-bus-kafka&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶(æœåŠ¡ç«¯) 123456789101112131415161718192021server: port: 8085spring: application: name: config-server cloud: config: server: git: uri: https://github.com/sunweiguo/spring-cloud-config-center.git username: sunweiguo password: xxxxxxxxxeureka: client: service-url: defaultZone: http://localhost:8761/eureka,http://localhost:8762/eurekamanagement: endpoints: web: exposure: include: bus-refresh æ³¨æ„ï¼Œåœ¨1.xç‰ˆæœ¬ä¸­ä¸€èˆ¬é…ç½® 1234#æ˜¯å¦éœ€è¦æƒé™æ‹‰å–ï¼Œé»˜è®¤æ˜¯true,å¦‚æžœä¸falseå°±ä¸å…è®¸ä½ åŽ»æ‹‰å–é…ç½®ä¸­å¿ƒServeræ›´æ–°çš„å†…å®¹management: security: enabled: false è€Œåœ¨2.xç‰ˆæœ¬ä¸­å·²ç»æŠŠè¿™ä¸ªæ”¹æŽ‰äº†ã€‚æ‰€ä»¥è¦æ³¨æ„ã€‚ä¸é…ç½®çš„è¯ä¼šæŠ¥é”™405.å¯ä»¥å°è¯•åŽ»æŽ‰ï¼Œç”¨postmanæµ‹è¯•ä¸€æŠŠã€‚ ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ æ³¨è§£ åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å¯åŠ¨å‡½æ•°ä¸Šéƒ½å¢žåŠ ä¸€æ¡æ³¨è§£@RefreshScope ok,è‡³æ­¤ï¼Œé›†æˆå®Œæ¯•ã€‚æ¶ˆæ¯æ€»çº¿çš„åŠŸèƒ½å°±æœ‰äº†ã€‚ å¯åŠ¨å…¨éƒ¨å·¥ç¨‹ã€‚ä¿®æ”¹gitä¸Šçš„å†…å®¹ã€‚ç„¶åŽå‘çŽ°å®¢æˆ·ç«¯éƒ½æ²¡æ›´æ–°ã€‚ä¸‹é¢å¯åŠ¨postmanæ¥å¯¹config serverå‘é€ä¸€æ¡postè¯·æ±‚ï¼š 1localhost:8085/actuator/bus-refresh å†åˆ·æ–°æµè§ˆå™¨ï¼Œå°±ä¼šå‘çŽ°æ‰€æœ‰çš„å®¢æˆ·ç«¯éƒ½è‡ªåŠ¨æ›´æ–°äº†ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè¦åˆ·æ–°çš„å®¢æˆ·ç«¯å…·ä½“å®žä¾‹æˆ–è€…é€šé…ç¬¦ç¬¦åˆçš„å®¢æˆ·ç«¯ã€‚]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[7.Configåˆ†å¸ƒå¼é…ç½®ç®¡ç†]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F7.Config%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[å…³äºŽé›†ä¸­çš„é…ç½®ç®¡ç†å·²ç»åœ¨ 10.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-é›†ä¸­åŒ–é…ç½® ä¸­è¯¦ç»†ä»‹ç»äº†ã€‚æœ¬æ–‡ä¸ºäº†æ–¹ä¾¿å¼•å‡ºé—®é¢˜ï¼Œæ‰€ä»¥é‡æ–°ä»‹ç»ä¸€ä¸‹å®ƒçš„åŸºæœ¬ä½¿ç”¨ã€‚ æœåŠ¡ç«¯ ç¬¬ä¸€æ­¥ï¼šæ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œå¼•å…¥ç›¸å…³ä¾èµ– 12345678910111213141516171819202122232425&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--Eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--config--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ç¬¬äºŒæ­¥ï¼šæ·»åŠ æ³¨è§£ 123456789@SpringBootApplication@EnableDiscoveryClient@EnableConfigServerpublic class SpringCloudConfigServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudConfigServerApplication.class, args); &#125;&#125; ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ–‡ä»¶ 12345678910111213141516server: port: 8085spring: application: name: config-server cloud: config: server: git: uri: https://github.com/sunweiguo/spring-cloud-config-center.git username: sunweiguo password: *********eureka: client: service-url: defaultZone: http://localhost:8761/eureka,http://localhost:8762/eureka ç¬¬å››æ­¥ï¼šåœ¨è¿™ä¸ªä»“åº“é‡Œæ–°å»ºä¸¤ä¸ªæ–‡ä»¶cloud-config-dev.propertieså’Œcloud-config-test.propertiesï¼Œé‡Œé¢æœ‰ä¸€äº›ç®€å•å†…å®¹ï¼šname=sunweiguo-devå’Œname=sunweiguo-test ç¬¬å››æ­¥ï¼šå¯åŠ¨é…ç½®çš„æœåŠ¡ç«¯ æµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:8085/cloud-config-dev.propertiesï¼Œå¦‚æžœå¯ä»¥çœ‹åˆ°é‡Œé¢é…ç½®çš„å†…å®¹ï¼Œé‚£ä¹ˆå°±é…ç½®æˆåŠŸäº†ã€‚ å®¢æˆ·ç«¯ ç¬¬ä¸€æ­¥ï¼šæ–°å»ºä¸€ä¸ªsbé¡¹ç›®ï¼Œå¼•å…¥ä¾èµ– 1234567891011121314151617181920212223242526272829&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--Eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--å¥åº·ç›‘æŽ§åŒ…--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ç¬¬äºŒæ­¥ï¼šæ·»åŠ æ³¨è§£ä½¿å…¶æ³¨å†Œåˆ°eurekaä¸Šï¼Œä¸å†èµ˜è¿° ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ–‡ä»¶ æ³¨æ„ï¼Œè¿™é‡Œå¿…é¡»æ˜¯bootstrap.ymlï¼Œä»–çš„ä¼˜å…ˆçº§åˆ«æ¯”application.ymlè¦é«˜ã€‚ 123456789101112131415161718192021server: port: 8086# è¿™ä¸ªcloud-configè¦ä¸Žgitä¸Šçš„æ–‡ä»¶åä¸€è‡´ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™åœ¨å¼€å¤´çš„é“¾æŽ¥ä¸­å·²ç»è¯¦ç»†ä»‹ç»äº†spring: application: name: cloud-config cloud: config: profile: dev discovery: service-id: config-server # è‡´å‘½æœåŠ¡ç«¯ enabled: trueeureka: client: service-url: defaultZone: http://localhost:8761/eureka,http://localhost:8762/eurekamanagement: endpoints: web: exposure: include: &quot;*&quot; # è¿™æ˜¯ä¸€ä¸ª2.xçš„å‘ï¼Œéœ€è¦é…ç½®è¿™ä¸ªæš´éœ²æ‰€æœ‰ç«¯ç‚¹ï¼Œå¦åˆ™refreshæŠ¥404 ç¬¬å››æ­¥ï¼šå†™ä¸€ä¸ªç®€å•çš„controlleræ¥æ˜¾ç¤º 12345678910111213@RestController@RefreshScopepublic class TestController &#123; @Value("$&#123;name&#125;") private String name; @RequestMapping("/test") public String test()&#123; return "hello."+this.name; &#125;&#125; ç¬¬äº”æ­¥ï¼šåœ¨æµè§ˆå™¨ä¸­è¾“å…¥å¯¹åº”çš„urlçœ‹æ˜¯å¦æ˜¾ç¤ºæ­£ç¡®ï¼Œä¸‹é¢å°±æ˜¯åœ¨gitä¸Šä¿®æ”¹ä¸€ä¸‹å¯¹åº”çš„æ–‡ä»¶å†…å®¹ã€‚æˆ‘ä»¬ä¼šå‘çŽ°ï¼ŒæœåŠ¡ç«¯ä¸Šé¢å·²ç»æ›´æ–°äº†ï¼Œä½†æ˜¯å®¢æˆ·ç«¯æ²¡æœ‰æ›´æ–°ã€‚é‚£ä¹ˆå°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åŽ»è§¦å‘ä»–æ›´æ–° ç¬¬å…­æ­¥ï¼šæ‰“å¼€postmanå·¥å…·ã€‚è¾“å…¥Urlï¼šlocalhost:8086/actuator/refresh å¦‚æžœè¿”å›žï¼š 1234[ &quot;config.client.version&quot;, &quot;name&quot;] é‚£ä¹ˆè¡¨ç¤ºæ›´æ–°æˆåŠŸã€‚æ­¤æ—¶å†åˆ·æ–°ä¹‹å‰çš„é¡µé¢ï¼Œä¼šå‘çŽ°å®¢æˆ·ç«¯çš„å†…å®¹å·²ç»åŒæ­¥è¿‡æ¥äº†ã€‚ æ€»ç»“ æˆ‘ä»¬å®žçŽ°äº†å°†é…ç½®æ–‡ä»¶æ”¾åœ¨gitä¸Šé›†ä¸­ç®¡ç†ï¼Œä½†æ˜¯åœ¨ä¿®æ”¹ä¸­å¿ƒä»“åº“ä¸­çš„é…ç½®åŽï¼Œå®¢æˆ·ç«¯æ˜¯æ²¡æœ‰æ›´æ–°çš„ï¼ŒåŽæ¥æˆ‘ä»¬ç”¨æ›´æ–°åŒ…æ‰‹åŠ¨åŽ»æ›´æ–°ï¼Œè™½ç„¶ä¸ç”¨é‡å¯æœåŠ¡ï¼Œä½†æ˜¯è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•é¿å…ï¼Œå¯¹æ¯ä¸ªæœåŠ¡å‘é€postè¯·æ±‚åŽ»æ›´æ–°å‘¢ï¼Ÿ å…¶å®žå¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨å‘å¸ƒè®¢é˜…çš„åŽŸç†ï¼Œåˆ©ç”¨æ¶ˆæ¯æ¥é€šçŸ¥ä»Žè€Œè§¦å‘æ›´æ–°ï¼Œæ˜¯æ¯”è¾ƒå¥½çš„æ–¹å¼ã€‚ä¸‹ä¸€èŠ‚ä»‹ç»æ¶ˆæ¯æ€»çº¿ã€‚]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[6.Zuulç½‘å…³æœåŠ¡]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F6.Zuul%E7%BD%91%E5%85%B3%E6%9C%8D%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[åœ¨ 9.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-APIç½‘å…³ ä¸­å·²ç»å¯¹APIç½‘å…³è¿›è¡Œäº†è¯¦ç»†çš„ä»‹ç»ã€‚åŸºç¡€çš„æ¦‚å¿µå°±ä¸å†èµ˜è¿°äº†ã€‚ä¸‹é¢ç€é‡çœ‹ä¸€ä¸‹zuulä¸­å¦‚ä½•å®žçŽ°è¿‡æ»¤å™¨ã€‚ åŸºæœ¬ä½¿ç”¨ ç¬¬ä¸€æ­¥:åˆ›å»ºä¸€ä¸ªspringbootå·¥ç¨‹ï¼Œå¼•å…¥ä¾èµ–ï¼š 123456789101112131415161718192021222324252627282930313233343536&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Finchley.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--Eureka client--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zuul--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ç¬¬äºŒæ­¥ï¼šåœ¨å¯åŠ¨å‡½æ•°ä¸Šå¢žåŠ æ³¨è§£ï¼š 123456789@SpringBootApplication@EnableDiscoveryClient@EnableZuulProxypublic class SpringCloudEurekaZuulApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudEurekaZuulApplication.class, args); &#125;&#125; ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ–‡ä»¶ï¼š 1234567891011121314spring: application: name: api-gatewayeureka: client: service-url: defaultZone: http://localhost:8761/eureka,http://localhost:8762/eurekazuul: routes: service-hi: path: /service-hi/**/ serviceId: service-hiserver: port: 8084 ä¸»è¦å°±æ˜¯é…ç½®è·¯ç”±è§„åˆ™ï¼Œä»¥service-hiä¸ºå‰ç¼€çš„éƒ½åŽ»serivce-hiä¸ºåå­—çš„æœåŠ¡ä¸‹æ‰¾å¯¹åº”çš„æ˜ å°„ã€‚ è¿™æ ·ï¼Œå°±å®Œæˆäº†åŸºæœ¬çš„æ•´åˆã€‚å¯åŠ¨å…¶ä»–çš„é¡¹ç›®ï¼šspring-cloud-eureka-server-1,spring-cloud-eureka-server-2,spring-cloud-eureka-client-1,spring-cloud-eureka-client-1. åœ¨æˆ‘çš„spring-cloud-eureka-client-1æœ‰ä¸€ä¸ªè·¯å¾„å«localhost:8080/testè¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é‚£ä¹ˆæ­¤æ—¶ç”¨ç½‘å…³æ¥è®¿é—®çš„è¯åº”è¯¥æ˜¯ï¼šlocalhost:8084/service-hi/test. è¿‡æ»¤å™¨ æ–°å»ºä¸€ä¸ªç±»ï¼Œå‡è®¾æˆ‘ä»¬è¦æ£€éªŒtokenï¼Œå¦‚æžœtokenä¸ºç©ºï¼Œå°±è¿”å›žæœªæŽˆæƒã€‚ TokenFilterï¼š 12345678910111213141516171819202122232425262728293031323334353637public class TokenFilter extends ZuulFilter &#123; //pre åœ¨è·¯ç”±è¡¨å¯»æ‰¾è·¯ç”±æ—¶ç”Ÿæ•ˆ //routing æ‰¾åˆ°è·¯ç”±å¼€å§‹è¿›è¡Œè¯·æ±‚è½¬å‘æ—¶ç”Ÿæ•ˆ //error å‡ºé”™æ—¶ç”Ÿæ•ˆ //post routingæˆ–è€…errorä¹‹åŽæœ€åŽé˜¶æ®µç”Ÿæ•ˆ @Override public String filterType() &#123; return "pre"; &#125; //è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ @Override public int filterOrder() &#123; return 0; &#125; //trueè¡¨ç¤ºè¿‡æ»¤å™¨ç”Ÿæ•ˆ @Override public boolean shouldFilter() &#123; return true; &#125; @Override public Object run() throws ZuulException &#123; RequestContext context = RequestContext.getCurrentContext(); HttpServletRequest request = context.getRequest(); String token = request.getParameter("token"); if(token == null)&#123; context.setSendZuulResponse(false); context.setResponseStatusCode(401); context.setResponseBody("unsutherized"); return null; &#125; return null; &#125;&#125; è¦å°†å…¶æ³¨å†Œåˆ°springï¼š 1234@Beanpublic TokenFilter tokenFilter()&#123; return new TokenFilter();&#125; å†æ¬¡è®¿é—®localhost:8084/service-hi/testæ—¶ï¼Œæ˜¾ç¤ºunsutherizedï¼Œå½“è®¿é—®localhost:8084/service-hi/test?token=123æ—¶è®¿é—®é€šè¿‡ã€‚ å¦‚æžœåœ¨run()ä¸­å‡ºçŽ°å¼‚å¸¸ï¼Œä½†æ˜¯è¿™ä¸ªå¼‚å¸¸ä¸èƒ½æŠ›å‡ºæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚é‚£ä¹ˆå¦‚ä½•åœ¨é¡µé¢ä¸Šå¦‚ä½•æ˜¾ç¤ºå‘¢ï¼Ÿåœ¨catchçš„ä»£ç ä¸­è¿™æ ·å†™ï¼š 123context.set(error.status_code,401);context.set("error.exception",e);context.set("error.message","æç¤ºä¿¡æ¯");]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[4.Hystrixè¯·æ±‚åˆå¹¶]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F4.Hystrix%E8%AF%B7%E6%B1%82%E5%90%88%E5%B9%B6%2F</url>
    <content type="text"><![CDATA[åœ¨å¾®æœåŠ¡æž¶æž„ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªé¡¹ç›®æ‹†åˆ†æˆå¾ˆå¤šä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œè¿™äº›ç‹¬ç«‹çš„æ¨¡å—é€šè¿‡è¿œç¨‹è°ƒç”¨æ¥äº’ç›¸é…åˆå·¥ä½œï¼Œä½†æ˜¯ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œé€šä¿¡æ¬¡æ•°çš„å¢žåŠ ä¼šå¯¼è‡´æ€»çš„é€šä¿¡æ—¶é—´å¢žåŠ ï¼ŒåŒæ—¶ï¼Œçº¿ç¨‹æ± çš„èµ„æºä¹Ÿæ˜¯æœ‰é™çš„ï¼Œé«˜å¹¶å‘çŽ¯å¢ƒä¼šå¯¼è‡´æœ‰å¤§é‡çš„çº¿ç¨‹å¤„äºŽç­‰å¾…çŠ¶æ€ï¼Œè¿›è€Œå¯¼è‡´å“åº”å»¶è¿Ÿï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ¥äº†è§£Hystrixçš„è¯·æ±‚åˆå¹¶ã€‚ ä¸€ã€è¯·æ±‚åˆå¹¶ hystrixä¸­çš„è¯·æ±‚åˆå¹¶ï¼Œå°±æ˜¯åˆ©ç”¨ä¸€ä¸ªåˆå¹¶å¤„ç†å™¨ï¼Œå°†å¯¹åŒä¸€ä¸ªæœåŠ¡å‘èµ·çš„è¿žç»­è¯·æ±‚åˆå¹¶æˆä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†(è¿™äº›è¿žç»­è¯·æ±‚çš„æ—¶é—´çª—é»˜è®¤ä¸º10ms)ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„ä¸€ä¸ªæ ¸å¿ƒç±»å°±æ˜¯HystrixCollapserã€‚ è¯·æ±‚ä¸åˆå¹¶ä¹‹å‰ï¼š ä¸‹å›¾å±•ç¤ºäº†åœ¨æœªä½¿ç”¨HystrixCollapserè¯·æ±‚åˆå¹¶å™¨ä¹‹å‰çš„çº¿ç¨‹ä½¿ç”¨æƒ…å†µã€‚å¯ä»¥çœ‹åˆ°å½“æœåŠ¡æ¶ˆè´¹è€…åŒæ—¶å¯¹USER-SERVICEçš„/users/{id}æŽ¥å£å‘èµ·äº†äº”ä¸ªè¯·æ±‚æ—¶ï¼Œä¼šå‘è¯¥ä¾èµ–æœåŠ¡çš„ç‹¬ç«‹çº¿ç¨‹æ± ä¸­ç”³è¯·äº”ä¸ªçº¿ç¨‹æ¥å®Œæˆå„è‡ªçš„è¯·æ±‚æ“ä½œã€‚ è€Œåœ¨ä½¿ç”¨äº†HystrixCollapserè¯·æ±‚åˆå¹¶å™¨ä¹‹åŽï¼Œç›¸åŒæƒ…å†µä¸‹çš„çº¿ç¨‹å ç”¨å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ç”±äºŽåŒä¸€æ—¶é—´å‘ç”Ÿçš„äº”ä¸ªè¯·æ±‚å¤„äºŽè¯·æ±‚åˆå¹¶å™¨çš„ä¸€ä¸ªæ—¶é—´çª—å†…ï¼Œè¿™äº›å‘å‘/users/{id}æŽ¥å£çš„è¯·æ±‚è¢«è¯·æ±‚åˆå¹¶å™¨æ‹¦æˆªä¸‹æ¥ï¼Œå¹¶åœ¨åˆå¹¶å™¨ä¸­è¿›è¡Œç»„åˆï¼Œç„¶åŽå°†è¿™äº›è¯·æ±‚åˆå¹¶æˆä¸€ä¸ªè¯·æ±‚å‘å‘USER-SERVICEçš„æ‰¹é‡æŽ¥å£/users?ids={ids}ï¼Œåœ¨èŽ·å–åˆ°æ‰¹é‡è¯·æ±‚ç»“æžœä¹‹åŽï¼Œé€šè¿‡è¯·æ±‚åˆå¹¶å™¨å†å°†æ‰¹é‡ç»“æžœæ‹†åˆ†å¹¶åˆ†é…ç»™æ¯ä¸ªè¢«åˆå¹¶çš„è¯·æ±‚ã€‚ä»Žå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥æ¥ï¼Œé€šè¿‡ä½¿ç”¨è¯·æ±‚åˆå¹¶å™¨æœ‰æ•ˆåœ°å‡å°‘äº†å¯¹çº¿ç¨‹æ± ä¸­èµ„æºçš„å ç”¨ã€‚æ‰€ä»¥åœ¨èµ„æºæœ‰æ•ˆå¹¶ä¸”åœ¨çŸ­æ—¶é—´å†…ä¼šäº§ç”Ÿé«˜å¹¶å‘è¯·æ±‚çš„æ—¶å€™ï¼Œä¸ºé¿å…è¿žæŽ¥ä¸å¤Ÿç”¨è€Œå¼•èµ·çš„å»¶è¿Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨è¯·æ±‚åˆå¹¶å™¨çš„æ–¹å¼æ¥å¤„ç†å’Œä¼˜åŒ–ã€‚ æœ¬ç€ç®€å•çš„ç›®çš„ï¼Œæ‰€ä»¥éžæ³¨è§£çš„æ–¹å¼æˆ‘å°±æ²¡åšã€‚å…·ä½“å‚è€ƒæ–‡ç« ï¼šSpring Cloudä¸­Hystrixçš„è¯·æ±‚åˆå¹¶ 1.1 æœåŠ¡æä¾›è€… é¦–å…ˆæ˜¯éœ€è¦æœåŠ¡æä¾›è€…æä¾›ä¸¤ä¸ªæŽ¥å£ï¼Œä¸€ä¸ªæ˜¯è¿”å›žé›†åˆï¼Œæ¨¡æ‹Ÿåœ¨åŒä¸€æ—¶é—´å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¥è¯·æ±‚ä¹¦ç±ä¿¡æ¯ã€‚ 12345678910@RequestMapping("/getbooks")public List&lt;Book&gt; books(String ids) &#123; System.out.println("ids&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;" + ids); ArrayList&lt;Book&gt; books = new ArrayList&lt;&gt;(); books.add(new Book("ã€ŠæŽè‡ªæˆã€‹", 55, "å§šé›ªåž ", "äººæ°‘æ–‡å­¦å‡ºç‰ˆç¤¾")); books.add(new Book("ä¸­å›½æ–‡å­¦ç®€å²", 33, "æž—åºš", "æ¸…åŽå¤§å­¦å‡ºç‰ˆç¤¾")); books.add(new Book("æ–‡å­¦æ”¹è‰¯åˆè®®", 33, "èƒ¡é€‚", "æ— ")); books.add(new Book("ids", 22, "helloworld", "haha")); return books;&#125; 1.2 æœåŠ¡æ¶ˆè´¹è€… é¦–å…ˆåœ¨BookServiceä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ç”¨æ¥è°ƒç”¨æœåŠ¡æä¾›è€…æä¾›çš„æŽ¥å£ï¼Œå¦‚ä¸‹ï¼š 1234567891011@HystrixCollapser(batchMethod = "test11",collapserProperties = &#123;@HystrixProperty(name ="timerDelayInMilliseconds",value = "100")&#125;)public Future&lt;Book&gt; test10(Long id) &#123; return null;&#125;@HystrixCommandpublic List&lt;Book&gt; test11(List&lt;Long&gt; ids) &#123; System.out.println("test9---------"+ids+"Thread.currentThread().getName():" + Thread.currentThread().getName()); Book[] books = restTemplate.getForObject("http://SERVICE-HI/getbooks?ids=&#123;1&#125;", Book[].class, StringUtils.join(ids, ",")); return Arrays.asList(books);&#125; åœ¨test10æ–¹æ³•ä¸Šæ·»åŠ @HystrixCollapseræ³¨è§£å®žçŽ°è¯·æ±‚åˆå¹¶ï¼Œç”¨batchMethodå±žæ€§æŒ‡æ˜Žè¯·æ±‚åˆå¹¶åŽçš„å¤„ç†æ–¹æ³•ï¼ŒcollapserPropertieså±žæ€§æŒ‡å®šå…¶ä»–å±žæ€§:ä¸ºè¯·æ±‚åˆå¹¶å™¨è®¾ç½®äº†æ—¶é—´å»¶è¿Ÿå±žæ€§ï¼Œåˆå¹¶å™¨ä¼šåœ¨è¯¥æ—¶é—´çª—å†…æ”¶é›†èŽ·å–å•ä¸ªBookçš„è¯·æ±‚å¹¶åœ¨æ—¶é—´çª—ç»“æŸæ—¶è¿›è¡Œåˆå¹¶ç»„è£…æˆå•ä¸ªæ‰¹é‡è¯·æ±‚ã€‚ 1.3 è°ƒç”¨æ¶ˆè´¹æœåŠ¡ ä¸‹é¢å°±æ˜¯ç›´æŽ¥è°ƒç”¨test10å³å¯ï¼š 123456789101112131415161718@RequestMapping("/books")public void test7() throws ExecutionException, InterruptedException &#123; HystrixRequestContext context = HystrixRequestContext.initializeContext(); Future&lt;Book&gt; f1 = bookService.test10(1l); Future&lt;Book&gt; f2 = bookService.test10(2l); Future&lt;Book&gt; f3 = bookService.test10(3l); Book b1 = f1.get(); Book b2 = f2.get(); Book b3 = f3.get(); Thread.sleep(3000); Future&lt;Book&gt; f4 = bookService.test10(4l); Book b4 = f4.get(); System.out.println("b1&gt;&gt;&gt;"+b1); System.out.println("b2&gt;&gt;&gt;"+b2); System.out.println("b3&gt;&gt;&gt;"+b3); System.out.println("b4&gt;&gt;&gt;"+b4); context.close();&#125; 1.4 è¿è¡Œç»“æžœ 123456test9---------[3, 1, 2]Thread.currentThread().getName():hystrix-BookService-6test9---------[4]Thread.currentThread().getName():hystrix-BookService-7b1&gt;&gt;&gt;com.swg.springcloudeureka.Book@5a901d44b2&gt;&gt;&gt;com.swg.springcloudeureka.Book@3305e39b3&gt;&gt;&gt;com.swg.springcloudeureka.Book@2282567cb4&gt;&gt;&gt;com.swg.springcloudeureka.Book@52e7b4ea å‰ä¸‰ä¸ªè¯·æ±‚ä¼šè¿›è¡Œåˆå¹¶ï¼Œå³1ï¼Œ2ï¼Œ3ä¸‰ä¸ªidè¢«åˆå¹¶åˆ°ä¸€ä¸ªlistä¸­ä¼ ç»™test11ï¼Œç¬¬å››ä¸ªè¯·æ±‚ä¼šå•ç‹¬æ‰§è¡Œ. äºŒã€æ€»ç»“ è¯·æ±‚åˆå¹¶çš„ä¼˜ç‚¹å°ä¼™ä¼´ä»¬å·²ç»çœ‹åˆ°äº†ï¼Œå¤šä¸ªè¯·æ±‚è¢«åˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚è¿›è¡Œä¸€æ¬¡æ€§å¤„ç†ï¼Œå¯ä»¥æœ‰æ•ˆèŠ‚çœç½‘ç»œå¸¦å®½å’Œçº¿ç¨‹æ± èµ„æºï¼Œä½†æ˜¯ï¼Œæœ‰ä¼˜ç‚¹å¿…ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œè®¾ç½®è¯·æ±‚åˆå¹¶ä¹‹åŽï¼Œæœ¬æ¥ä¸€ä¸ªè¯·æ±‚å¯èƒ½5mså°±æžå®šäº†ï¼Œä½†æ˜¯çŽ°åœ¨å¿…é¡»å†ç­‰10msçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„è¯·æ±‚ä¸€èµ·çš„ï¼Œè¿™æ ·ä¸€ä¸ªè¯·æ±‚çš„è€—æ—¶å°±ä»Ž5mså¢žåŠ åˆ°15msäº†ï¼Œä¸è¿‡ï¼Œå¦‚æžœæˆ‘ä»¬è¦å‘èµ·çš„å‘½ä»¤æœ¬èº«å°±æ˜¯ä¸€ä¸ªé«˜å»¶è¿Ÿçš„å‘½ä»¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨è¯·æ±‚åˆå¹¶äº†ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æ—¶é—´çª—çš„æ—¶é—´æ¶ˆè€—å°±æ˜¾å¾—å¾®ä¸è¶³é“äº†ï¼Œå¦å¤–é«˜å¹¶å‘ä¹Ÿæ˜¯è¯·æ±‚åˆå¹¶çš„ä¸€ä¸ªéžå¸¸é‡è¦çš„åœºæ™¯ã€‚]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[3.Hystrixè¯·æ±‚ç†”æ–­æœåŠ¡é™çº§]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F3.Hystrix%E8%AF%B7%E6%B1%82%E7%86%94%E6%96%AD%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%2F</url>
    <content type="text"><![CDATA[åŸºæœ¬çš„ä»‹ç»å’ŒåŸºæœ¬çš„æ¼”ç¤ºéƒ½å·²ç»åœ¨11.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-ç†”æ–­æœºåˆ¶ä¸­è¯´æ˜Žå’Œæ¼”ç¤ºäº†ã€‚ä¸‹é¢æ¥è¯´ç‚¹ä¸ä¸€æ ·çš„ä¸œè¥¿å§ï¼ ä¸€ã€å‰è¨€ æ¯”å¦‚æ‹¿æˆ‘ä¸Šä¸€ç« ä¸­çš„ä»£ç ï¼Œæˆ‘ä»¬å°†spring-eureka-ribbonå‡çº§ä¸ºspring-cloud-ribbon-hystrix: æ— éžæ˜¯å¼•å…¥ä¾èµ–ï¼Œä¸»å‡½æ•°æ·»åŠ ä¸€ä¸ªå…è®¸ç†”æ–­çš„å£°æ˜Žã€‚ 12345678910111213141516@Servicepublic class HelloServiceImpl implements IHelloServie &#123; @Autowired RestTemplate restTemplate; @Override @HystrixCommand(fallbackMethod = "helloFallBack") public String hiService(String name) &#123; return restTemplate.getForEntity("http://SERVICE-HI/hello?name="+name,String.class).getBody(); &#125; public String helloFallBack(String name)&#123; return "&lt;font color='red'&gt;error&lt;/font&gt;"; &#125;&#125; æ³¨æ„ï¼Œæˆ‘ä»¬çš„fallBackæ–¹æ³•çš„å‚æ•°å¿…é¡»ä¸Žè¢«æ³¨è§£çš„æ–¹æ³•çš„å‚æ•°ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ å¯åŠ¨é¡¹ç›®ï¼šspring-cloud-eureka-server-1,spring-cloud-eureka-server-2,spring-cloud-eureka-client-1,spring-cloud-eureka-client-2,spring-cloud-ribbon-hystrix. ç„¶åŽå…³é—­ä¸€ä¸ªclientï¼Œçœ‹æ˜¯å¦è§¦å‘æœåŠ¡é™çº§ï¼Œæ˜¾ç¤ºçº¢è‰²çš„error. äºŒã€ç”¨æ³•è¿›é˜¶-å®žçŽ°å¼‚æ­¥æ¶ˆè´¹ æˆ‘ä»¬ä¸ç”¨@HystrixCommandæ³¨è§£æ¥å®žçŽ°ä¸Šé¢ä¸ªåŠŸèƒ½ã€‚ä»£ç è§spring-cloud-eureka-ribbon-hystrix-02 1234567891011121314@RestControllerpublic class HelloController &#123; @Autowired private RestTemplate restTemplate; @RequestMapping("hello") public String hello()&#123; HelloServiceCommand command = new HelloServiceCommand("hello",restTemplate); String res = command.execute(); return res; &#125;&#125; å…¶ä¸­æ ¸å¿ƒçš„HelloServiceCommand: 12345678910111213141516171819public class HelloServiceCommand extends HystrixCommand&lt;String&gt; &#123; private RestTemplate restTemplate; public HelloServiceCommand(String commandGroupKey,RestTemplate restTemplate) &#123; super(HystrixCommandGroupKey.Factory.asKey(commandGroupKey)); this.restTemplate = restTemplate; &#125; @Override protected String run() throws Exception &#123; return restTemplate.getForEntity("http://SERVICE-HI/hello?name='swg'",String.class).getBody(); &#125; @Override protected String getFallback() &#123; return "&lt;font color='red'&gt;error&lt;/font&gt;"; &#125;&#125; è¿™æ ·å°±å¯ä»¥ç”¨ä»£ç å®žçŽ°ä¸Šé¢çš„æ³¨è§£çš„åŠŸèƒ½ã€‚ æˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼Œrun()æ–¹æ³•é‡Œè°ƒç”¨å…¶ä»–çš„æœåŠ¡ï¼ˆå¤šä¸ªï¼‰ï¼Œå¦‚æžœæ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆæ—¶é—´æ˜¯æ‰€æœ‰æœåŠ¡æ‰§è¡Œæ—¶é—´ä¹‹å’Œã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠžæ³•ä½¿ä»–å¹¶è¡Œæ‰§è¡Œå‘¢ï¼Ÿè¾¾åˆ°ä¸€ç§NIOçš„æ•ˆæžœã€‚ NIOçš„ä¸¤ä¸ªå®žçŽ°æ–¹å¼ï¼šFutureå°†æ¥å¼å’ŒCallableå›žè°ƒå¼ï¼Œè¿™é‡Œä½¿ç”¨å°†æ¥å¼ã€‚ å…¶å®žæ ¸å¿ƒå°±æ˜¯Future&lt;String&gt; future = command.queue();ï¼Œè®©è¿™ä¸ªæ–¹æ³•è‡ªå·±å¦å¼€ä¸€ä¸ªçº¿ç¨‹åŽ»é»˜é»˜æ‰§è¡Œï¼Œæœ¬çº¿ç¨‹è¿˜ç»§ç»­å¾€ä¸‹ï¼Œç­‰æˆ‘æƒ³åˆ°ç»“æžœçš„æ—¶å€™ï¼Œå†åŽ»è°ƒç”¨String res = future.get();é˜»å¡žåœ°èŽ·å–ç»“æžœï¼Œå¦‚æžœç»“æžœå·²ç»å‡†å¤‡å¥½äº†ï¼Œé‚£ä¹ˆå°±ç›´æŽ¥æ‹¿åˆ°ã€‚ åœ¨ä»£ç spring-cloud-eureka-ribbon-hystrix-03ä¸­çš„controllerä¸­è¿›è¡Œæµ‹è¯•ï¼š 12345678910111213@RequestMapping("hello")public String hello() throws ExecutionException, InterruptedException &#123; HelloServiceCommand command = new HelloServiceCommand("hello",restTemplate); long now = System.currentTimeMillis(); Future&lt;String&gt; future = command.queue(); System.out.println("start"); long end = System.currentTimeMillis(); System.out.println(end - now); String res = future.get(); long last = System.currentTimeMillis()-end; System.out.println(last); return res;&#125; æµ‹è¯•çš„ç›®çš„å°±æ˜¯çœ‹è°ƒç”¨command.queue()ä¹‹åŽä¼šä¸ä¼šé˜»å¡žæœ¬çº¿ç¨‹çš„æ‰§è¡Œï¼Œæˆ‘ä»¬è®©è¢«restTemplateè°ƒç”¨çš„æ–¹æ³•ç¡çœ ä¸€ä¼šï¼š 1234567@RequestMapping("hello")public String hello(@RequestParam("name")String name) throws InterruptedException &#123; System.out.println("æ–¹æ³•å¼€å§‹æ‰§è¡Œã€‚ã€‚ã€‚"); Thread.sleep(800); System.out.println("æ–¹æ³•æ‰§è¡Œç»“æŸã€‚ã€‚ã€‚"); return "hi "+ name +",you are from " + port;&#125; ç»“æžœæ‰“å°ï¼š 123start1817 å°±æ˜¯è¯´å°†æ‰§è¡Œå…¶ä»–æœåŠ¡è¿™ä¸ªæ“ä½œå¼‚æ­¥åˆ°äº†å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæœ¬çº¿ç¨‹ç«‹å³æ‰§è¡Œä¸‹é¢çš„é€»è¾‘ã€‚è¿™æ ·ï¼Œæé«˜äº†æ•ˆçŽ‡ã€‚ å¥½äº†ï¼Œç”¨éžæ³¨è§£çš„æ–¹å¼æ¥å®žçŽ°äº†ä¸€ä¸‹NIOçš„å®žçŽ°æ–¹å¼ï¼Œé‚£ä¹ˆè‚¯å®šè¿˜æ˜¯ä½¿ç”¨æ³¨è§£æ¯”è¾ƒæ–¹ä¾¿ï¼Œé‚£ä¹ˆåŸºäºŽæ³¨è§£çš„è¯ï¼Œæˆ‘ä»¬å¦‚ä½•å®žçŽ°futureçš„æ–¹å¼æ¥æ‰§è¡Œå‘¢ï¼Ÿä»£ç spring-cloud-eureka-ribbon-hystrix-04 æˆ‘ä»¬åªéœ€è¦å°†åŽŸæ¥çš„HelloServiceImplä¸­çš„hiServiceæ–¹æ³•æ”¹ä¸ºï¼š 12345678910111213import com.netflix.hystrix.contrib.javanica.command.AsyncResult;@Override@HystrixCommand(fallbackMethod = "helloFallBack")public String hiService(String name) throws ExecutionException, InterruptedException &#123; Future&lt;String&gt; future = new AsyncResult&lt;String&gt;() &#123; @Override public String invoke() &#123; return restTemplate.getForEntity("http://SERVICE-HI/hello?name="+name,String.class).getBody(); &#125; &#125;; return future.get();&#125; å°±å¯ä»¥å®žçŽ°è¿™ç§å¼‚æ­¥çš„æ–¹å¼è°ƒç”¨äº†ã€‚ ä¸‰ã€è§‚å¯Ÿè€…æ¨¡å¼æ¥å®žçŽ° è®¢é˜…è€…æ¥ç›‘å¬è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œå¯ä»¥å®žçŽ°å¤šä¸ªè¯·æ±‚é›†ä¸­å¤„ç†ã€‚ ä»£ç ä¸æƒ³åŽ»æžäº†â€¦ å››ã€æ€»ç»“ è¿™é‡Œä¸»è¦æ˜¯å®žçŽ°ç†”æ–­çš„åŠŸèƒ½ï¼Œä¸€å¼€å§‹çš„@HystrixCommand+fallbackï¼Œåˆ°åŽé¢è‡ªå·±ç”¨HystrixCommandä»£ç å®žçŽ°çš„ï¼Œå†åˆ°åŽæ¥ç”¨Futureæ¥å®žçŽ°å¼‚æ­¥æ¶ˆè´¹ï¼Œåˆ°æœ€åŽä»‹ç»çš„ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®žçŽ°çš„æ–¹å¼HystrixObserverCommandã€‚]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2.Ribbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F2.Ribbon%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%2F</url>
    <content type="text"><![CDATA[åœ¨å¾®æœåŠ¡æž¶æž„ä¸­ï¼Œä¸šåŠ¡éƒ½ä¼šè¢«æ‹†åˆ†æˆä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼ŒæœåŠ¡ä¸ŽæœåŠ¡çš„é€šè®¯æ˜¯åŸºäºŽhttp restfulçš„ã€‚Spring cloudæœ‰ä¸¤ç§æœåŠ¡è°ƒç”¨æ–¹å¼ï¼Œä¸€ç§æ˜¯ribbon+restTemplateï¼Œå¦ä¸€ç§æ˜¯feignã€‚åœ¨è¿™ä¸€ç¯‡æ–‡ç« é¦–å…ˆè®²è§£ä¸‹åŸºäºŽribbon+restã€‚ ä¸€ã€å‰è¨€ Spring Cloud Ribbon æ˜¯ä¸€ä¸ªåŸºäºŽ HTTP å’Œ TCP çš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å·¥å…·ï¼Œå®ƒåŸºäºŽ Netflix Ribbon å®žçŽ°ã€‚ é€šè¿‡ Spring Cloud çš„å°è£…ï¼Œ å¯ä»¥è®©æˆ‘ä»¬è½»æ¾åœ°å°†é¢å‘æœåŠ¡çš„ REST æ¨¡æ¿è¯·æ±‚è‡ªåŠ¨è½¬æ¢æˆå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„æœåŠ¡è°ƒç”¨ã€‚Spring Cloud Ribbon è™½ç„¶åªæ˜¯ä¸€ä¸ªå·¥å…·ç±»æ¡†æž¶ï¼Œå®ƒä¸åƒæœåŠ¡æ³¨å†Œä¸­å¿ƒã€ é…ç½®ä¸­å¿ƒã€ API ç½‘å…³é‚£æ ·éœ€è¦ç‹¬ç«‹éƒ¨ç½²ï¼Œ ä½†æ˜¯å®ƒå‡ ä¹Žå­˜åœ¨äºŽæ¯ä¸€ä¸ªSpring Cloud æž„å»ºçš„å¾®æœåŠ¡å’ŒåŸºç¡€è®¾æ–½ä¸­ã€‚ å› ä¸ºå¾®æœåŠ¡é—´çš„è°ƒç”¨ï¼ŒAPI ç½‘å…³çš„è¯·æ±‚è½¬å‘ç­‰å†…å®¹å®žé™…ä¸Šéƒ½æ˜¯é€šè¿‡Ribbon æ¥å®žçŽ°çš„ï¼ŒåŒ…æ‹¬åŽç»­æˆ‘ä»¬å°†è¦ä»‹ç»çš„ Feign, å®ƒä¹Ÿæ˜¯åŸºäºŽ Ribbonå®žçŽ°çš„å·¥å…·ã€‚ äºŒã€Ribbon ribbonæ˜¯ä¸€ä¸ªè´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ï¼Œå¯ä»¥å¾ˆå¥½çš„æŽ§åˆ¶httå’Œtcpçš„ä¸€äº›è¡Œä¸ºã€‚Feigné»˜è®¤é›†æˆäº†ribbonã€‚ è€Œä¹‹å‰ç”¨çš„nginxæ¥å®žçŽ°è´Ÿè½½å‡è¡¡ï¼Œä»–æ˜¯ä¸€ç§æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚ é›†æˆRibbonä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ã€‚æ–°å»ºä¸€ä¸ªé¡¹ç›®spring-cloud-eureka-ribbon 2.1 å¼•å…¥ä¾èµ–ï¼š 1234567891011121314151617181920212223&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 2.2 ç„¶åŽå°±æ˜¯æ³¨å†Œä¸€ä¸ªä¸“é—¨è´Ÿè½½å‡è¡¡çš„ä¸€ä¸ªå®¢æˆ·ç«¯ï¼š 1234567891011121314@SpringBootApplication@EnableDiscoveryClientpublic class SpringCloudEurekaApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudEurekaApplication.class, args); &#125; @Bean @LoadBalanced RestTemplate restTemplate() &#123; return new RestTemplate(); &#125;&#125; åœ¨å·¥ç¨‹çš„å¯åŠ¨ç±»ä¸­,é€šè¿‡@EnableDiscoveryClientå‘æœåŠ¡ä¸­å¿ƒæ³¨å†Œï¼›å¹¶ä¸”å‘ç¨‹åºçš„iocæ³¨å…¥ä¸€ä¸ªbean: restTemplate;å¹¶é€šè¿‡@LoadBalancedæ³¨è§£è¡¨æ˜Žè¿™ä¸ªrestRemplateå¼€å¯è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚ 2.3 é…ç½®æ–‡ä»¶ å°±æ˜¯å‘æ³¨å†Œä¸­å¿ƒé›†ç¾¤æ³¨å†Œè€Œå·²ã€‚æ‰€ä»¥ï¼Œä¸Šç« ä¸­æåˆ°çš„Eurekaä¸¤ä¸ªæœåŠ¡ç«¯è¦å¯åŠ¨èµ·æ¥ã€‚ 123456789server: port: 8082spring: application: name: eureka-ribboneureka: client: service-url: defaultZone: http://localhost:8761/eureka,http://localhost:8762/eureka 2.4 æµ‹è¯•çš„controller è¿™ä¸ªribbonæ¥æŽ¥æ”¶è¯·æ±‚ï¼Œç„¶åŽç”±ä»–æ¥å†³å®šè½¬å‘åˆ°å“ªä¸ªæœåŠ¡ã€‚ æ‰€ä»¥è¿™é‡Œè¦å¯åŠ¨èµ·æ¥ä¸¤ä¸ªæœåŠ¡ï¼Œè®©æˆ‘æ¥å®žé™…è°ƒç”¨ï¼Œæˆ‘ä»¬å°±ç»™ä»–ä¸€ä¸ªæœ€ç®€å•çš„åŠŸèƒ½ï¼šæ‰“å°å‡ºæ¥ç«¯å£ã€‚ 1234567891011@RestControllerpublic class HelloController &#123; @Value("$&#123;server.port&#125;") private String port; @RequestMapping("hello") public String hello(@RequestParam("name")String name)&#123; return "hi "+ name +",you are from " + port; &#125;&#125; ç„¶åŽåœ¨æˆ‘çš„ribbonä¸­å†™ä¸€ä¸ªcontrollerä½œä¸ºä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼š 123456789101112@RestControllerpublic class HelloController &#123; @Autowired private IHelloServie helloServie; @RequestMapping("hello") public String hello(@RequestParam("name")String name)&#123; return helloServie.hiService(name); &#125;&#125; å…·ä½“çš„serviceå°±æ˜¯ç”¨åˆšæ‰å®šä¹‰çš„restTemplateæ¥æ ¹æ®æœåŠ¡å®žä¾‹çš„åç§°åŽ»å‘èµ·è°ƒç”¨ï¼š 1234567891011@Servicepublic class HelloServiceImpl implements IHelloServie &#123; @Autowired RestTemplate restTemplate; @Override public String hiService(String name) &#123; return restTemplate.getForObject("http://SERVICE-HI/hello?name="+name,String.class); &#125;&#125; 2.5 é¡µé¢æµ‹è¯• æµè§ˆå™¨è¾“å…¥http://localhost:8082/hello?name=sunweiguoï¼Œä¸åœåœ°åˆ·æ–°ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è½®æµæ˜¾ç¤ºï¼š hi sunweiguo,you are from 8080å’Œhi sunweiguo,you are from 8081è¿™ä¸¤å¥ï¼Œè¯´æ˜Žè´Ÿè½½å‡è¡¡å·²ç»ç”Ÿæ•ˆï¼Œå¹¶ä¸”ç®—æ³•æ˜¯è½®è¯¢ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚è¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ã€‚]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[1.EurekaæœåŠ¡æ²»ç†]]></title>
    <url>%2F2019%2F02%2F21%2Fspring-cloud-modules%2F1.Eureka%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%2F</url>
    <content type="text"><![CDATA[åœ¨ä¸Šä¸€ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬ä»¥æœ€ç®€å•çš„ä¸šåŠ¡åœºæ™¯æ€¥é€Ÿå…¥é—¨äº†å¾®æœåŠ¡ï¼Œå½“ç„¶äº†ï¼Œå¿½ç•¥äº†å¾ˆå¤šçš„ç»†èŠ‚ï¼Œä½œä¸ºå…¥é—¨æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯çœŸæ­£ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦äº†è§£å¾ˆå¤šé¢å¤–çš„ä½¿ç”¨çŸ¥è¯†ï¼Œæ‰€ä»¥æœ¬ç³»åˆ—å°±å­•è‚²è€Œç”Ÿï¼Œå³åœ¨ä¸Šä¸€ç³»åˆ—çš„åŸºç¡€ä¸Šç»§ç»­å¼ºåŒ–ï¼ŒåŠ æ·±å¯¹spring cloudçš„ä½¿ç”¨ç†è§£ã€‚æœ¬ç« é¦–å…ˆè¿˜æ˜¯ä»‹ç»eurekaæœåŠ¡æ³¨å†Œå’Œå‘çŽ°ç»„ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯å¾®æœåŠ¡çš„åŸºçŸ³ã€‚ å…³äºŽEurekaçš„åŸºæœ¬ä½¿ç”¨ï¼Œåœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»äº†ï¼š7.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å¾®æœåŠ¡çš„æ³¨å†Œå’Œå‘çŽ°ï¼Œä¸å†èµ˜è¿°ã€‚æœ¬ç« å­¦ä¹ å¦‚ä½•æ­å»ºä¸€ä¸ªeurekaé«˜å¯ç”¨é›†ç¾¤ã€‚ ä¸€ã€å‰è¨€ é¦–å…ˆæ¥çœ‹çœ‹Eurekaé«˜å¯ç”¨çš„æž¶æž„ã€‚ å…¶ä¸­ï¼Œç»­çº¦æ˜¯æŒ‡ï¼šæœåŠ¡ç«¯ç»´æŒä¸€ä¸ªæœ‰è¿‡æœŸæ—¶é—´çš„æœåŠ¡åˆ—è¡¨ï¼Œå½“å®¢æˆ·ç«¯è®¿é—®ä¸€æ¬¡ï¼Œæˆ‘å°±åˆ·æ–°ä¸€ä¸‹è¿‡æœŸæ—¶é—´ã€‚ 1234# 90ç§’ä¸æ¥ç»­çº¦å°±å‰”é™¤lease-expiration-duration-in-seconds: 90# æ¯éš”30ç§’è‡ªåŠ¨ç»­çº¦ä¸€æ¬¡lease-renewal-interval-in-seconds: 30 åœ¨å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”å¤šé•¿æ—¶é—´åŽ»è¯·æ±‚ä¸€ä¸‹æœåŠ¡å™¨ï¼Œåˆ·æ–°ä¸€ä¸‹æœåŠ¡åˆ—è¡¨ï¼š 12# é»˜è®¤æ¯éš”30åŽ»è¯·æ±‚ä¸€ä¸‹æœåŠ¡å™¨registry-fetch-interval-seconds: 30 äºŒã€æ€»ç»“ EurekaåŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼šEureka Server å’Œ Eureka Clientï¼Œå®ƒä»¬çš„ä½œç”¨å¦‚ä¸‹ï¼š Eureka Clientæ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºŽç®€åŒ–ä¸ŽEureka Serverçš„äº¤äº’ï¼› Eureka Serveræä¾›æœåŠ¡å‘çŽ°çš„èƒ½åŠ›ï¼Œå„ä¸ªå¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šé€šè¿‡Eureka Clientå‘Eureka Serverè¿›è¡Œæ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ç½‘ç»œä¿¡æ¯ï¼‰ï¼ŒEureka Serverä¼šå­˜å‚¨è¯¥æœåŠ¡çš„ä¿¡æ¯ï¼› å¾®æœåŠ¡å¯åŠ¨åŽï¼Œä¼šå‘¨æœŸæ€§åœ°å‘Eureka Serverå‘é€å¿ƒè·³ï¼ˆé»˜è®¤å‘¨æœŸä¸º30ç§’ï¼‰ä»¥ç»­çº¦è‡ªå·±çš„ä¿¡æ¯ã€‚å¦‚æžœEureka Serveråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æŽ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡èŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEureka Serverå°†ä¼šæ³¨é”€è¯¥å¾®æœåŠ¡èŠ‚ç‚¹ï¼ˆé»˜è®¤90ç§’ï¼‰ï¼› æ¯ä¸ªEureka ServeråŒæ—¶ä¹Ÿæ˜¯Eureka Clientï¼Œå¤šä¸ªEureka Serverä¹‹é—´é€šè¿‡å¤åˆ¶çš„æ–¹å¼å®ŒæˆæœåŠ¡æ³¨å†Œè¡¨çš„åŒæ­¥ï¼› Eureka Clientä¼šç¼“å­˜Eureka Serverä¸­çš„ä¿¡æ¯ã€‚å³ä½¿æ‰€æœ‰çš„Eureka ServerèŠ‚ç‚¹éƒ½å®•æŽ‰ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¾ç„¶å¯ä»¥ä½¿ç”¨ç¼“å­˜ä¸­çš„ä¿¡æ¯æ‰¾åˆ°æœåŠ¡æä¾›è€…ã€‚ ä¸‰ã€é›†ç¾¤é…ç½® Server1ç«¯é…ç½®æ–‡ä»¶ï¼š 1234567891011server: port: 8761eureka: instance: hostname: eureka client: service-url: defaultZone: http://localhost:8762/eurekaspring: application: name: eureka-server Server2ç«¯é…ç½®æ–‡ä»¶ï¼š 1234567891011server: port: 8762eureka: instance: hostname: eureka client: service-url: defaultZone: http://localhost:8761/eurekaspring: application: name: eureka-server å°±æ˜¯è¯´ä¸¤ä¸ªserveräº’ç›¸æ³¨å†Œã€‚å½¢æˆä¸€ä¸ªserveré›†ç¾¤ã€‚ client1é…ç½®æ–‡ä»¶ï¼š 123456789server: port: 8080spring: application: name: eureka-clienteureka: client: service-url: defaultZone: http://localhost:8761/eureka,http://localhost:8762/eureka client2ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ 123456789server: port: 8081spring: application: name: eureka-clienteureka: client: service-url: defaultZone: http://localhost:8761/eureka,http://localhost:8762/eureka åˆ†åˆ«å¯åŠ¨ä¹‹åŽï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ•ˆæžœï¼š å…³äºŽæœ¬ç³»åˆ—çš„æ‰€æœ‰ä»£ç ï¼Œå°†æŒ‰ç…§1-10çš„ç« èŠ‚ä¾æ¬¡å­˜æ”¾åœ¨ï¼šhttps://github.com/sunweiguo/swgBook-for-spring-cloud/tree/master/spring-cloud-modules åŽé¢ä¸å†èµ˜è¿°ã€‚]]></content>
      <tags>
        <tag>springcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[11.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-ç†”æ–­æœºåˆ¶]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F11.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬åä¸€ç¯‡æ–‡ç« ï¼ŒæŸä¸ªæœåŠ¡ä¸€æ—¦å‡ºçŽ°ä¸å¯ç”¨ï¼Œå¯èƒ½ä¼šç‰µè¿žæ•´ä¸ªç³»ç»Ÿé€ æˆé›ªå´©ï¼Œæˆ–è€…æœ‰çš„æ—¶å€™èµ„æºéœ€è¦èšé›†åœ¨æ ¸å¿ƒä¸šåŠ¡ä¸Šï¼Œéžæ ¸å¿ƒä¸šåŠ¡å°±å¯ä»¥é€‚å½“åœ°å…³é—­ï¼Œæ­¤æ—¶å°±æ˜¯éœ€è¦æœ‰ä¸€ç§æœºåˆ¶æ¥å®žçŽ°ç³»ç»Ÿä¿æŠ¤å’ŒæœåŠ¡é™çº§çš„åŠŸèƒ½ã€‚æœ¬ç« ä»‹ç»hystrixç»„ä»¶ã€‚ ä¸€ã€å®šä¹‰ ä¿æŠ¤ç³»ç»Ÿçš„ä¸€ç§æ–¹å¼ï¼Œå½“è¯·æ±‚è¶…å‡ºé˜ˆå€¼ï¼ŒæŠŠçœŸå®žçš„æœåŠ¡æŽ¥å£æ–­å¼€ï¼Œå¯èƒ½åªæ˜¯è¿”å›žç»™ä½ ä¸€ä¸ªé»˜è®¤å€¼ã€‚è¿™æ ·ï¼ŒæŽæ–­äº†è‡ªå·±çš„æœåŠ¡ï¼Œåˆå¯ä»¥ç»™ç”¨æˆ·ä¸€ä¸ªå“åº”ã€‚ å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨æ‰§è¡Œç†”æ–­ï¼Œå¯¹äºŽåŽç»­è¯·æ±‚ï¼Œä¸å†ç»§ç»­è°ƒç”¨è¯¥ç›®æ ‡æœåŠ¡ï¼Œè€Œæ˜¯ç›´æŽ¥è¿”å›žï¼Œä»Žè€Œå¯ä»¥å¿«é€Ÿé‡Šæ”¾èµ„æºã€‚ ç†”æ–­å™¨å¥½å¤„ï¼šç³»ç»Ÿç¨³å®šã€å‡å°‘æ€§èƒ½æŸè€—ã€åŠæ—¶å“åº”ã€é˜ˆå€¼å¯é…ç½® ç†”æ–­è¿™ä¸€æ¦‚å¿µæ¥æºäºŽç”µå­å·¥ç¨‹ä¸­çš„æ–­è·¯å™¨ï¼ˆCircuit Breakerï¼‰ã€‚åœ¨äº’è”ç½‘ç³»ç»Ÿä¸­ï¼Œå½“ä¸‹æ¸¸æœåŠ¡å› è®¿é—®åŽ‹åŠ›è¿‡å¤§è€Œå“åº”å˜æ…¢æˆ–å¤±è´¥ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ï¼Œå¯ä»¥æš‚æ—¶åˆ‡æ–­å¯¹ä¸‹æ¸¸æœåŠ¡çš„è°ƒç”¨ã€‚ è¿™ç§ç‰ºç‰²å±€éƒ¨ï¼Œä¿å…¨æ•´ä½“çš„æŽªæ–½å°±å«åšç†”æ–­ã€‚ å¦‚æžœä¸é‡‡å–ç†”æ–­æŽªæ–½ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¼šæ€Žæ ·å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ —å­ã€‚å½“å‰ç³»ç»Ÿä¸­æœ‰Aï¼ŒBï¼ŒCä¸‰ä¸ªæœåŠ¡ï¼ŒæœåŠ¡Aæ˜¯ä¸Šæ¸¸ï¼ŒæœåŠ¡Bæ˜¯ä¸­æ¸¸ï¼ŒæœåŠ¡Cæ˜¯ä¸‹æ¸¸ã€‚å®ƒä»¬çš„è°ƒç”¨é“¾å¦‚ä¸‹ï¼š ä¸€æ—¦ä¸‹æ¸¸æœåŠ¡Cå› æŸäº›åŽŸå› å˜å¾—ä¸å¯ç”¨ï¼Œç§¯åŽ‹äº†å¤§é‡è¯·æ±‚ï¼ŒæœåŠ¡Bçš„è¯·æ±‚çº¿ç¨‹ä¹Ÿéšä¹‹é˜»å¡žã€‚çº¿ç¨‹èµ„æºé€æ¸è€—å°½ï¼Œä½¿å¾—æœåŠ¡Bä¹Ÿå˜å¾—ä¸å¯ç”¨ã€‚ç´§æŽ¥ç€ï¼ŒæœåŠ¡Aä¹Ÿå˜ä¸ºä¸å¯ç”¨ï¼Œæ•´ä¸ªè°ƒç”¨é“¾è·¯è¢«æ‹–åž®ã€‚ åƒè¿™ç§è°ƒç”¨é“¾è·¯çš„è¿žé”æ•…éšœï¼Œå«åšé›ªå´©ã€‚ æ­£æ‰€è°“åˆ®éª¨ç–—æ¯’ï¼Œå£®å£«æ–­è…•ã€‚åœ¨è¿™ç§æ—¶å€™ï¼Œå°±éœ€è¦æˆ‘ä»¬çš„ç†”æ–­æœºåˆ¶æ¥æŒ½æ•‘æ•´ä¸ªç³»ç»Ÿã€‚ å¼€å¯ç†”æ–­:åœ¨å›ºå®šæ—¶é—´çª—å£å†…ï¼ŒæŽ¥å£è°ƒç”¨è¶…æ—¶æ¯”çŽ‡è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼ï¼Œä¼šå¼€å¯ç†”æ–­ã€‚è¿›å…¥ç†”æ–­çŠ¶æ€åŽï¼ŒåŽç»­å¯¹è¯¥æœåŠ¡æŽ¥å£çš„è°ƒç”¨ä¸å†ç»è¿‡ç½‘ç»œï¼Œç›´æŽ¥æ‰§è¡Œæœ¬åœ°çš„é»˜è®¤æ–¹æ³•ï¼Œè¾¾åˆ°æœåŠ¡é™çº§çš„æ•ˆæžœã€‚ ç†”æ–­æ¢å¤:ç†”æ–­ä¸å¯èƒ½æ˜¯æ°¸ä¹…çš„ã€‚å½“ç»è¿‡äº†è§„å®šæ—¶é—´ä¹‹åŽï¼ŒæœåŠ¡å°†ä»Žç†”æ–­çŠ¶æ€å›žå¤è¿‡æ¥ï¼Œå†æ¬¡æŽ¥å—è°ƒç”¨æ–¹çš„è¿œç¨‹è°ƒç”¨ã€‚ äºŒã€ç†”æ–­å’Œé™çº§ åœ¨è‚¡ç¥¨å¸‚åœºï¼Œç†”æ–­è¿™ä¸ªè¯å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œæ˜¯æŒ‡å½“è‚¡æŒ‡æ³¢å¹…è¾¾åˆ°æŸä¸ªç‚¹åŽï¼Œäº¤æ˜“æ‰€ä¸ºæŽ§åˆ¶é£Žé™©é‡‡å–çš„æš‚åœäº¤æ˜“æŽªæ–½ã€‚ç›¸åº”çš„ï¼ŒæœåŠ¡ç†”æ–­ä¸€èˆ¬æ˜¯æŒ‡è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œç”±äºŽæŸäº›åŽŸå› ä½¿å¾—æœåŠ¡å‡ºçŽ°äº†è¿‡è½½çŽ°è±¡ï¼Œä¸ºé˜²æ­¢é€ æˆæ•´ä¸ªç³»ç»Ÿæ•…éšœï¼Œä»Žè€Œé‡‡ç”¨çš„ä¸€ç§ä¿æŠ¤æŽªæ–½ï¼Œæ‰€ä»¥å¾ˆå¤šåœ°æ–¹æŠŠç†”æ–­äº¦ç§°ä¸ºè¿‡è½½ä¿æŠ¤ã€‚ å¤§å®¶éƒ½è§è¿‡å¥³ç”Ÿæ—…è¡Œå§ï¼Œå¤§å·çš„æ—…è¡Œç®±æ˜¯å¿…å¤‡ç‰©ï¼Œå¹³å¸¸èµ°èµ°è¿‘å¤„ç»°ç»°æœ‰ä½™ï¼Œä½†ä¸€æ—¦å‡ºä¸ªè¿œé—¨ï¼Œå†å¤§çš„ç®±å­éƒ½ç™½æ­äº†ï¼Œæ€Žä¹ˆåŠžå‘¢ï¼Ÿå¸¸è§çš„æƒ…æ™¯å°±æ˜¯æŠŠç‰©å“æ‹¿å‡ºæ¥åˆ†åˆ†å †ï¼Œæ¯”äº†åˆæ¯”ï¼Œæœ€åŽä¸€äº›éžå¿…éœ€å“çš„å°±å¿ç—›æ”¾ä¸‹äº†ï¼Œç­‰åˆ°ä¸‹æ¬¡ç®±å­å¤Ÿç”¨äº†ï¼Œå†å¸¦ä¸Šç”¨ä¸€ç”¨ã€‚è€ŒæœåŠ¡é™çº§ï¼Œå°±æ˜¯è¿™ä¹ˆå›žäº‹ï¼Œæ•´ä½“èµ„æºå¿«ä¸å¤Ÿäº†ï¼Œå¿ç—›å°†æŸäº›æœåŠ¡å…ˆå…³æŽ‰ï¼Œå¾…æ¸¡è¿‡éš¾å…³ï¼Œå†å¼€å¯å›žæ¥ã€‚ é™çº§ç™½è¯ç†è§£ï¼šæ¯”å¦‚åœ¨å…¬å¸ é‡åˆ°è´µå®¾è¦æ¥ å°±æŠŠä¸€äº›ä¸é‡è¦çš„å¸¸è§„æŽ¥å¾…æš‚åœ æŠŠè¿™äº›èµ„æºä¾›ç»™æ‹›å¾…è´µå®¾ ä¹‹å‰æœ‰ä¸ªæ·˜å®çš„åˆ†äº« æ¯”å¦‚åŒ11 æŠŠè®¢å•è¯„è®ºå’Œæ”¶è—ç­‰åŠŸèƒ½åœ¨è¿™ä¸€å¤©æš‚åœ æŠŠè¿™äº›èµ„æºåˆ†ç»™å…¶å®ƒå…³é”®æœåŠ¡ æ¯”å¦‚ä¸‹å• æ‰€ä»¥ä»Žä¸Šè¿°åˆ†æžæ¥çœ‹ï¼Œä¸¤è€…å…¶å®žä»Žæœ‰äº›è§’åº¦çœ‹æ˜¯æœ‰ä¸€å®šçš„ç±»ä¼¼æ€§çš„ï¼š ç›®çš„å¾ˆä¸€è‡´ï¼Œéƒ½æ˜¯ä»Žå¯ç”¨æ€§å¯é æ€§ç€æƒ³ï¼Œä¸ºé˜²æ­¢ç³»ç»Ÿçš„æ•´ä½“ç¼“æ…¢ç”šè‡³å´©æºƒï¼Œé‡‡ç”¨çš„æŠ€æœ¯æ‰‹æ®µï¼› æœ€ç»ˆè¡¨çŽ°ç±»ä¼¼ï¼Œå¯¹äºŽä¸¤è€…æ¥è¯´ï¼Œæœ€ç»ˆè®©ç”¨æˆ·ä½“éªŒåˆ°çš„æ˜¯æŸäº›åŠŸèƒ½æš‚æ—¶ä¸å¯è¾¾æˆ–ä¸å¯ç”¨ï¼› ç²’åº¦ä¸€èˆ¬éƒ½æ˜¯æœåŠ¡çº§åˆ«ï¼Œå½“ç„¶ï¼Œä¸šç•Œä¹Ÿæœ‰ä¸å°‘æ›´ç»†ç²’åº¦çš„åšæ³•ï¼Œæ¯”å¦‚åšåˆ°æ•°æ®æŒä¹…å±‚ï¼ˆå…è®¸æŸ¥è¯¢ï¼Œä¸å…è®¸å¢žåˆ æ”¹ï¼‰ï¼› è‡ªæ²»æ€§è¦æ±‚å¾ˆé«˜ï¼Œç†”æ–­æ¨¡å¼ä¸€èˆ¬éƒ½æ˜¯æœåŠ¡åŸºäºŽç­–ç•¥çš„è‡ªåŠ¨è§¦å‘ï¼Œé™çº§è™½è¯´å¯äººå·¥å¹²é¢„ï¼Œä½†åœ¨å¾®æœåŠ¡æž¶æž„ä¸‹ï¼Œå®Œå…¨é äººæ˜¾ç„¶ä¸å¯èƒ½ï¼Œå¼€å…³é¢„ç½®ã€é…ç½®ä¸­å¿ƒéƒ½æ˜¯å¿…è¦æ‰‹æ®µï¼› è€Œä¸¤è€…çš„åŒºåˆ«ä¹Ÿæ˜¯æ˜Žæ˜¾çš„ï¼š è§¦å‘åŽŸå› ä¸å¤ªä¸€æ ·ï¼ŒæœåŠ¡ç†”æ–­ä¸€èˆ¬æ˜¯æŸä¸ªæœåŠ¡ï¼ˆä¸‹æ¸¸æœåŠ¡ï¼‰æ•…éšœå¼•èµ·ï¼Œè€ŒæœåŠ¡é™çº§ä¸€èˆ¬æ˜¯ä»Žæ•´ä½“è´Ÿè·è€ƒè™‘ï¼› ç®¡ç†ç›®æ ‡çš„å±‚æ¬¡ä¸å¤ªä¸€æ ·ï¼Œç†”æ–­å…¶å®žæ˜¯ä¸€ä¸ªæ¡†æž¶çº§çš„å¤„ç†ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½éœ€è¦ï¼ˆæ— å±‚çº§ä¹‹åˆ†ï¼‰ï¼Œè€Œé™çº§ä¸€èˆ¬éœ€è¦å¯¹ä¸šåŠ¡æœ‰å±‚çº§ä¹‹åˆ†ï¼ˆæ¯”å¦‚é™çº§ä¸€èˆ¬æ˜¯ä»Žæœ€å¤–å›´æœåŠ¡å¼€å§‹ï¼‰ ä¸‰ã€Spring Cloud Hystrix Spring Cloud Hystrixæ˜¯åŸºäºŽNetflixçš„å¼€æºæ¡†æž¶Hystrixå®žçŽ°ï¼Œè¯¥æ¡†æž¶å®žçŽ°äº†æœåŠ¡ç†”æ–­ã€çº¿ç¨‹éš”ç¦»ç­‰ä¸€ç³»åˆ—æœåŠ¡ä¿æŠ¤åŠŸèƒ½ã€‚å¯¹äºŽç†”æ–­æœºåˆ¶çš„å®žçŽ°ï¼ŒHystrixè®¾è®¡äº†ä¸‰ç§çŠ¶æ€ï¼š ç†”æ–­å…³é—­çŠ¶æ€ï¼ˆClosedï¼‰ï¼šæœåŠ¡æ²¡æœ‰æ•…éšœæ—¶ï¼Œç†”æ–­å™¨æ‰€å¤„çš„çŠ¶æ€ï¼Œå¯¹è°ƒç”¨æ–¹çš„è°ƒç”¨ä¸åšä»»ä½•é™åˆ¶ã€‚ ç†”æ–­å¼€å¯çŠ¶æ€ï¼ˆOpenï¼‰ï¼šåœ¨å›ºå®šæ—¶é—´çª—å£å†…ï¼ˆHystrixé»˜è®¤æ˜¯10ç§’ï¼‰ï¼ŒæŽ¥å£è°ƒç”¨å‡ºé”™æ¯”çŽ‡è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼ï¼ˆHystrixé»˜è®¤ä¸º50%ï¼‰ï¼Œä¼šè¿›å…¥ç†”æ–­å¼€å¯çŠ¶æ€ã€‚è¿›å…¥ç†”æ–­çŠ¶æ€åŽï¼ŒåŽç»­å¯¹è¯¥æœåŠ¡æŽ¥å£çš„è°ƒç”¨ä¸å†ç»è¿‡ç½‘ç»œï¼Œç›´æŽ¥æ‰§è¡Œæœ¬åœ°çš„fallbackæ–¹æ³•ã€‚ åŠç†”æ–­çŠ¶æ€ï¼ˆHalf-Openï¼‰ï¼šåœ¨è¿›å…¥ç†”æ–­å¼€å¯çŠ¶æ€ä¸€æ®µæ—¶é—´ä¹‹åŽï¼ˆHystrixé»˜è®¤æ˜¯5ç§’ï¼‰ï¼Œç†”æ–­å™¨ä¼šè¿›å…¥åŠç†”æ–­çŠ¶æ€ã€‚æ‰€è°“åŠç†”æ–­å°±æ˜¯å°è¯•æ¢å¤æœåŠ¡è°ƒç”¨ï¼Œå…è®¸æœ‰é™çš„æµé‡è°ƒç”¨è¯¥æœåŠ¡ï¼Œå¹¶ç›‘æŽ§è°ƒç”¨æˆåŠŸçŽ‡ã€‚å¦‚æžœæˆåŠŸçŽ‡è¾¾åˆ°é¢„æœŸï¼Œåˆ™è¯´æ˜ŽæœåŠ¡å·²æ¢å¤ï¼Œè¿›å…¥ç†”æ–­å…³é—­çŠ¶æ€ï¼›å¦‚æžœæˆåŠŸçŽ‡ä»æ—§å¾ˆä½Žï¼Œåˆ™é‡æ–°è¿›å…¥ç†”æ–­å…³é—­çŠ¶æ€ã€‚ é›†æˆHystrixä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼š demoçš„æ”¹é€ çš„åŸºç¡€æ˜¯eureka-client-feign,å°†å…¶æ”¹é€ ä¸ºeureka-client-feign-hystrix 1ã€å¼•å…¥ä¾èµ–ï¼š 12345&lt;!--Hystrix--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;&lt;/dependency&gt; 2ã€æ·»åŠ æ³¨è§£@EnableCircuitBreakerï¼Œå¯ç”¨Hystrix 12345678910@SpringBootApplication@EnableDiscoveryClient@EnableFeignClients@EnableCircuitBreakerpublic class EurekaClientFeignApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(EurekaClientFeignApplication.class, args); &#125;&#125; 3ã€åœ¨controlleræ–¹æ³•ä¸Šå¢žåŠ æ³¨è§£@HystrixCommand 12345678910111213141516@RestControllerpublic class TestController &#123; @Autowired private CityClient cityClient; @GetMapping("cities") @HystrixCommand(fallbackMethod = "defaultCities") public String getData()&#123; String res = cityClient.listCity(); return res; &#125; public String defaultCities()&#123; return "City Data Server is down!"; &#125;&#125; 4ã€æµ‹è¯• å¯åŠ¨eurekaå’ŒåŸŽå¸‚æ•°æ®æœåŠ¡ï¼Œå†å¯åŠ¨æœ¬æœåŠ¡ï¼Œæ˜¯æ­£å¸¸çš„ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°†åŸŽå¸‚æ•°æ®æœåŠ¡å…³é—­ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰è¿”å›žæˆ‘ä»¬æŒ‡å®šçš„é»˜è®¤å€¼ã€‚ å››ã€æ”¹é€ æœ¬ç³»ç»Ÿ åœ¨demoä¸­ï¼Œç”¨@HystrixCommandæ³¨è§£ä¸­çš„ç†”æ–­æ—¶æ‰§è¡Œçš„æ–¹æ³•æ¥å®žçŽ°å¼‚å¸¸æƒ…å†µä¸‹çš„é»˜è®¤è¿”å›žã€‚çŽ°åœ¨æˆ‘ä»¬è¦æ”¹é€ msa-weather-report-eureka-feign-gatewayï¼Œå°†å…¶æ”¹é€ ä¸ºmsa-weather-report-eureka-feign-gateway-hystrixï¼Œæˆ‘ä»¬ç”¨æ–°çš„æ–¹å¼ï¼Œç›´æŽ¥åœ¨DataClientè¿™ä¸ªæŽ¥å£é‡Œé¢å£°æ˜Žè§¦å‘ç†”æ–­æ—¶å›žè°ƒçš„ç±»DataClientFallback.classã€‚ 123456789101112131415@FeignClient(name = "msa-eureka-client-zuul",fallback = DataClientFallback.class)public interface DataClient &#123; /** * èŽ·å–åŸŽå¸‚åˆ—è¡¨ */ @RequestMapping("city/cities") List&lt;City&gt; listCity() throws Exception; /** * æ ¹æ®åŸŽå¸‚IDèŽ·å–å¤©æ°” */ @RequestMapping("data/weather/cityId/&#123;cityId&#125;") WeatherResponse getDataByCityId(@PathVariable("cityId") String cityId);&#125; å…·ä½“è¿™ä¸ªå›žè°ƒçš„ç±»é‡Œé¢æ—¶è¿™æ ·å†™çš„ï¼š 123456789101112131415161718@Componentpublic class DataClientFallback implements DataClient &#123; @Override public List&lt;City&gt; listCity() throws Exception &#123; List&lt;City&gt; cityList = new ArrayList&lt;&gt;(); City city = new City(); city.setCityId(&quot;101190101&quot;); city.setCityName(&quot;é»˜è®¤çš„å—äº¬&quot;); cityList.add(city); return cityList; &#125; @Override public WeatherResponse getDataByCityId(String cityId) &#123; return null; &#125;&#125; ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœåŸŽå¸‚æ•°æ®æœåŠ¡æŒ‚äº†ï¼Œå°±é»˜è®¤è¿”å›žä¸€ä¸‹æˆ‘è¿™é‡Œè®¾ç½®çš„åŸŽå¸‚ï¼›å¦‚æžœèŽ·å–å¤©æ°”ä¿¡æ¯çš„æœåŠ¡æŒ‚äº†ï¼Œæˆ‘ä»¬å°±ç›´æŽ¥è¿”å›žnull; é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ç›¸å½“äºŽåœ¨feignä¸­å¯ç”¨hystrixï¼Œå°±éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¢žåŠ é…ç½®ï¼š 123feign: hystrix: enabled: true å› ä¸ºå¦‚æžœæ ¹æ®åŸŽå¸‚idèŽ·å–å¤©æ°”ä¿¡æ¯çš„æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œæˆ‘ä»¬é»˜è®¤ç›´æŽ¥è¿”å›žnullï¼Œæ˜¾ç¤ºé¡µé¢å•¥éƒ½ä¸æ˜¾ç¤ºæ—¶ä¸å¥½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å‰ç«¯åˆ¤æ–­ä¸€ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;!--ä¸ä¸ºç©ºæ—¶--&gt;&lt;div th:if="$&#123;reportModel.report&#125; != null"&gt; &lt;div class="row"&gt; &lt;h1 class="text-success" th:text="$&#123;reportModel.report.city&#125;"&gt;åŸŽå¸‚åç§°&lt;/h1&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;p&gt; ç©ºæ°”è´¨é‡æŒ‡æ•°ï¼š&lt;span th:text="$&#123;reportModel.report.aqi&#125;"&gt;&lt;/span&gt; &lt;/p&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;p&gt; å½“å‰æ¸©åº¦ï¼š&lt;span th:text="$&#123;reportModel.report.wendu&#125;"&gt;&lt;/span&gt; &lt;/p&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;p&gt; æ¸©é¦¨æç¤ºï¼š&lt;span th:text="$&#123;reportModel.report.ganmao&#125;"&gt;&lt;/span&gt; &lt;/p&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;div class="card border-info" th:each="forecast : $&#123;reportModel.report.forecast&#125;"&gt; &lt;div class="card-body text-info"&gt; &lt;p class="card-text" th:text="$&#123;forecast.date&#125;"&gt;æ—¥æœŸ&lt;/p&gt; &lt;p class="card-text " th:text="$&#123;forecast.type&#125;"&gt;å¤©æ°”ç±»åž‹&lt;/p&gt; &lt;p class="card-text" th:text="$&#123;forecast.high&#125;"&gt;æœ€é«˜æ¸©åº¦&lt;/p&gt; &lt;p class="card-text" th:text="$&#123;forecast.low&#125;"&gt;æœ€ä½Žæ¸©åº¦&lt;/p&gt; &lt;p class="card-text" th:text="$&#123;forecast.fengxiang&#125;"&gt;é£Žå‘&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;!--ä¸ºç©ºæ—¶ï¼Œè¯´æ˜Žç†”æ–­å™¨ç”Ÿæ•ˆï¼Œç›´æŽ¥æ˜¾ç¤ºæç¤ºä¿¡æ¯--&gt;&lt;div th:if="$&#123;reportModel.report&#125; == null"&gt; &lt;div class="row"&gt; &lt;p&gt; å¤©æ°”æ•°æ®APIæœåŠ¡æš‚ä¸å¯ç”¨ï¼ &lt;/p&gt; &lt;/div&gt;&lt;/div&gt; ä¸‹é¢å°±æ¥æµ‹è¯•ä¸€æŠŠå§ï¼ é¦–å…ˆæ—¶å®Œå…¨æ­£å¸¸çš„æƒ…å†µï¼Œå„ä¸ªæœåŠ¡éƒ½å¯ç”¨ï¼š å¯åŠ¨å¦‚ä¸‹æœåŠ¡ï¼šredis,weather-sureka-server,msa-weather-city-eureka,msa-weather-collection-eureka-feign-gateway,msa-weather-data-eureka,msa-weather-report-eureka-feign-gateway-hystrix,msa-eureka-client-zuulè¿™å…­ä¸ªæœåŠ¡ï¼š æ­£å¸¸çš„è¯ï¼Œå°±ä¼šçœ‹åˆ°ä¹‹å‰çš„é¡µé¢ï¼šhttp://localhost:8083/report/cityId/101190101 åŸŽå¸‚æ•°æ®æœåŠ¡ä¸å¯ç”¨ï¼Œç†”æ–­å™¨ç”Ÿæ•ˆï¼š å…³é—­åŸŽå¸‚æ•°æ®æœåŠ¡msa-weather-city-eurekaï¼Œé€ æˆæœåŠ¡ä¸å¯ç”¨çš„çŽ°è±¡ã€‚çœ‹é¡µé¢æ˜¾ç¤ºæ˜¯å¦åªæœ‰æˆ‘å¡žè¿›åŽ»çš„å‡æ•°æ®ã€‚ å¤©æ°”æ•°æ®æœåŠ¡ä¸å¯ç”¨ï¼Œç†”æ–­å™¨ç”Ÿæ•ˆï¼š å…³é—­å¤©æ°”æ•°æ®APIæœåŠ¡msa-weather-data-eureka.çœ‹é¡µé¢æ˜¯å¦æ˜¾ç¤ºæœåŠ¡æš‚ä¸å¯ç”¨çš„æç¤ºä¿¡æ¯ã€‚ æŠ¥äº†ä¸€ä¸ªç©ºæŒ‡é’ˆé”™è¯¯ï¼ŒåŽŸå› æ˜¯msa-weather-report-eureka-feign-gateway-hystrixä¸­WeatherReportServiceImplä¸­çš„æ–¹æ³•åŽŸæ¥æ˜¯è¿™æ ·å†™çš„ï¼š 1234567891011@Service@Slf4jpublic class WeatherReportServiceImpl implements IWeatherReportService &#123; @Autowired private WeatherClient weatherClient; @Override public Weather getDataByCityId(String cityId) &#123; return weatherClient.getDataByCityId(cityId).getData(); &#125;&#125; æ˜¾ç„¶ï¼Œè¦åšä¸€ä¸‹åˆ¤ç©ºæ“ä½œï¼Œå¦åˆ™æ˜¯ä¸èƒ½è°ƒç”¨getData()è¿™ä¸ªæ–¹æ³•çš„ã€‚ 12345678910111213141516@Service@Slf4jpublic class WeatherReportServiceImpl implements IWeatherReportService &#123; @Autowired private DataClient dataClient; @Override public Weather getDataByCityId(String cityId) &#123; WeatherResponse res = dataClient.getDataByCityId(cityId); Weather weather = null; if(res != null)&#123; weather = res.getData(); &#125; return weather; &#125;&#125; è¿™æ ·å­ï¼Œé‡æ–°å¯åŠ¨å¤©æ°”é¢„æŠ¥UIæœåŠ¡ã€‚å°±å¯ä»¥çœ‹åˆ°æ•ˆæžœå•¦ï¼ è¿™æ ·ï¼Œæœ¬ç³»ç»Ÿé›†æˆhystrixå°±æˆåŠŸäº†ã€‚]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[10.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-é›†ä¸­åŒ–é…ç½®]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F10.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E9%9B%86%E4%B8%AD%E5%8C%96%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬åç¯‡æ–‡ç« ï¼ŒæœåŠ¡æ‹†åˆ†ä¹‹åŽï¼Œé…ç½®æ–‡ä»¶å°±å¿…ç„¶éšç€è¿™äº›æ‹†åˆ†çš„æœåŠ¡åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¿™å¯¹è¿è¥æ˜¯ä¸€ä¸ªç¾éš¾ï¼Œç”¨ä¸€ä¸ªé›†ä¸­åŒ–çš„æ–¹å¼ç»Ÿä¸€è¿›è¡Œé…ç½®æ–‡ä»¶çš„é…ç½®ä¸Žä¿®æ”¹æ˜¯å¿…è¦çš„ã€‚æœ¬ç« ä»‹ç»spring configçš„åŸºæœ¬ä½¿ç”¨ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›å°é—®é¢˜ï¼Œåœ¨åŽé¢çš„å®žæˆ˜çŽ¯èŠ‚ä¸­ä¼šè§£å†³ã€‚ ä¸€ã€èƒŒæ™¯ éšç€çº¿ä¸Šé¡¹ç›®å˜çš„æ—¥ç›Šåºžå¤§ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½æ•£è½ç€å„ç§é…ç½®æ–‡ä»¶ï¼Œå¦‚æžœé‡‡ç”¨åˆ†å¸ƒå¼çš„å¼€å‘æ¨¡å¼ï¼Œéœ€è¦çš„é…ç½®æ–‡ä»¶éšç€æœåŠ¡å¢žåŠ è€Œä¸æ–­å¢žå¤šã€‚æŸä¸€ä¸ªåŸºç¡€æœåŠ¡ä¿¡æ¯å˜æ›´ï¼Œéƒ½ä¼šå¼•èµ·ä¸€ç³»åˆ—çš„æ›´æ–°å’Œé‡å¯ï¼Œè¿ç»´è‹¦ä¸å ªè¨€ä¹Ÿå®¹æ˜“å‡ºé”™ã€‚é…ç½®ä¸­å¿ƒä¾¿æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„çµä¸¹å¦™è¯ã€‚ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¤–éƒ¨çš„ã€é›†ä¸­åŒ–çš„ä¸€ä¸ªé…ç½®ä¸­å¿ƒã€‚ äºŒã€é…ç½®åˆ†ç±» æŒ‰é…ç½®çš„æ¥æºåˆ’åˆ† ä¸»è¦æœ‰æºä»£ç ã€æ–‡ä»¶ã€æ•°æ®åº“è¿žæŽ¥ã€è¿œç¨‹è°ƒç”¨ç­‰ æŒ‰é…ç½®çš„çŽ¯å¢ƒåˆ’åˆ† ä¸»è¦æœ‰å¼€å‘çŽ¯å¢ƒã€æµ‹è¯•çŽ¯å¢ƒã€é¢„å‘å¸ƒçŽ¯å¢ƒã€ç”Ÿäº§çŽ¯å¢ƒç­‰ã€‚ æŒ‰é…ç½®çš„é›†æˆé˜¶æ®µåˆ’åˆ† ç¼–è¯‘æ—¶ã€æ‰“åŒ…æ—¶å’Œè¿è¡Œæ—¶ æŒ‰é…ç½®çš„åŠ è½½æ–¹å¼åˆ’åˆ† å¯åŠ¨åŠ è½½å’ŒåŠ¨æ€åŠ è½½ ä¸‰ã€Spring Cloud Config åœ¨æˆ‘ä»¬äº†è§£spring cloud configä¹‹å‰ï¼Œæˆ‘å¯ä»¥æƒ³æƒ³ä¸€ä¸ªé…ç½®ä¸­å¿ƒæä¾›çš„æ ¸å¿ƒåŠŸèƒ½åº”è¯¥æœ‰ä»€ä¹ˆ æä¾›æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ”¯æŒ é›†ä¸­ç®¡ç†å„çŽ¯å¢ƒçš„é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶ä¿®æ”¹ä¹‹åŽï¼Œå¯ä»¥å¿«é€Ÿçš„ç”Ÿæ•ˆ å¯ä»¥è¿›è¡Œç‰ˆæœ¬ç®¡ç† æ”¯æŒå¤§çš„å¹¶å‘æŸ¥è¯¢ æ”¯æŒå„ç§è¯­è¨€ Spring Cloud Configå¯ä»¥å®Œç¾Žçš„æ”¯æŒä»¥ä¸Šæ‰€æœ‰çš„éœ€æ±‚ã€‚ Spring Cloud Configé¡¹ç›®æ˜¯ä¸€ä¸ªè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ç®¡ç†æ–¹æ¡ˆã€‚å®ƒåŒ…å«äº†Clientå’ŒServerä¸¤ä¸ªéƒ¨åˆ†ï¼Œserveræä¾›é…ç½®æ–‡ä»¶çš„å­˜å‚¨ã€ä»¥æŽ¥å£çš„å½¢å¼å°†é…ç½®æ–‡ä»¶çš„å†…å®¹æä¾›å‡ºåŽ»ï¼Œclienté€šè¿‡æŽ¥å£èŽ·å–æ•°æ®ã€å¹¶ä¾æ®æ­¤æ•°æ®åˆå§‹åŒ–è‡ªå·±çš„åº”ç”¨ã€‚Spring cloudä½¿ç”¨gitæˆ–svnå­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨git. Serverç«¯ æ³¨å†Œåˆ°eurekaçš„å®žä¾‹åï¼šweather-config-server 1ã€æ·»åŠ ä¾èµ– 123456&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 2ã€é…ç½®æ–‡ä»¶ 1234567891011121314151617spring: application: name: weather-config-server cloud: config: server: git: uri: https://github.com/sunweiguo/spring-cloud-config-center search-paths: config-repo username: sunweiguo password: xxxeureka: client: service-url: defaultZone: http://localhost:8761/eurekaserver: port: 8086 config-repoè¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç”±è‡ªå·±åœ¨githubä¸Šåˆ›å»ºçš„ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼šweather-config-client-dev.properties,é‡Œé¢çš„å†…å®¹ä¸ºauther=oursnail.cn(éšä¾¿å†™ç‚¹ä¸œè¥¿ä»¥ä¾›æµ‹è¯•) ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆwebæŽ¥å£ï¼Œè®¿é—®å¯ä»¥å‚ç…§ä»¥ä¸‹çš„è§„åˆ™ï¼š /{application}/{profile}[/{label}] /{application}-{profile}.yml /{label}/{application}-{profile}.yml /{application}-{profile}.properties /{label}/{application}-{profile}.properties æˆ‘è¿™é‡Œçš„weather-config-client-dev.properties,å®ƒçš„applicationæ˜¯weather-config-clientï¼Œprofileæ˜¯devã€‚clientä¼šæ ¹æ®å¡«å†™çš„å‚æ•°æ¥é€‰æ‹©è¯»å–å¯¹åº”çš„é…ç½®ã€‚ 3ã€å¯åŠ¨ç±» å¯åŠ¨ç±»æ·»åŠ @EnableConfigServerï¼Œæ¿€æ´»å¯¹é…ç½®ä¸­å¿ƒçš„æ”¯æŒ 123456789@SpringBootApplication@EnableDiscoveryClient@EnableConfigServerpublic class WeatherEurekaClientApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(WeatherEurekaClientApplication.class, args); &#125;&#125; åˆ°æ­¤serverç«¯ç›¸å…³é…ç½®å·²ç»å®Œæˆ 4ã€æµ‹è¯• è®¿é—® http://localhost:8086/auther/dev è¿”å›žï¼š 12345678910&#123;&quot;name&quot;: &quot;auther&quot;,&quot;profiles&quot;: [&quot;dev&quot;],&quot;label&quot;: null,&quot;version&quot;: &quot;ef1a6baeddce01d3956ba2a7181f66721959a10c&quot;,&quot;state&quot;: null,&quot;propertySources&quot;: []&#125; æˆ‘ä»¬å¯ä»¥è¯»åˆ°autheré‡Œçš„å†…å®¹ï¼Œè¯´æ˜ŽæœåŠ¡ç«¯é…ç½®æˆåŠŸã€‚ å››ã€Clientç«¯ æ³¨å†Œåˆ°eurekaçš„å®žä¾‹åï¼šweather-config-client 1ã€æ·»åŠ ä¾èµ– 123456789101112131415&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 2ã€é…ç½®æ–‡ä»¶ éœ€è¦é…ç½®ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œapplication.propertieså’Œbootstrap.properties application.propertieså¦‚ä¸‹ï¼š 1234spring.application.name=weather-config-clientserver.port=8087eureka.client.service-url.defaultZone: http://localhost:8761/eureka bootstrap.propertieså¦‚ä¸‹ï¼š 1234spring.cloud.config.name=weather-config-clientspring.cloud.config.profile=devspring.cloud.config.uri=http://localhost:8086/spring.cloud.config.label=master spring.application.nameï¼šå¯¹åº”{application}éƒ¨åˆ† spring.cloud.config.profileï¼šå¯¹åº”{profile}éƒ¨åˆ† spring.cloud.config.labelï¼šå¯¹åº”gitçš„åˆ†æ”¯ã€‚å¦‚æžœé…ç½®ä¸­å¿ƒä½¿ç”¨çš„æ˜¯æœ¬åœ°å­˜å‚¨ï¼Œåˆ™è¯¥å‚æ•°æ— ç”¨ spring.cloud.config.uriï¼šé…ç½®ä¸­å¿ƒçš„å…·ä½“åœ°å€,å°±æ˜¯serverç«¯åœ°å€ ç‰¹åˆ«æ³¨æ„ï¼šä¸Šé¢è¿™äº›ä¸Žspring-cloudç›¸å…³çš„å±žæ€§å¿…é¡»é…ç½®åœ¨bootstrap.propertiesä¸­ï¼Œconfigéƒ¨åˆ†å†…å®¹æ‰èƒ½è¢«æ­£ç¡®åŠ è½½ã€‚å› ä¸ºconfigçš„ç›¸å…³é…ç½®ä¼šå…ˆäºŽapplication.propertiesï¼Œè€Œbootstrap.propertiesçš„åŠ è½½ä¹Ÿæ˜¯å…ˆäºŽapplication.propertiesã€‚ æµ‹è¯•ï¼š 123456789101112@RunWith(SpringRunner.class)@SpringBootTestpublic class WeatherEurekaClientApplicationTests &#123; @Value("$&#123;auther&#125;") private String auther; @Test public void contextLoads() &#123; Assert.assertEquals("oursnail.cn",auther); &#125;&#125; å¦‚æžœæµ‹è¯•é€šè¿‡ï¼Œé‚£ä¹ˆèŽ·å–å†…å®¹æˆåŠŸã€‚ ä½†æ˜¯æˆ‘ä»¬é€šè¿‡ç½‘é¡µçš„æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬ä¼šå‘çŽ°ä¿®æ”¹äº†githubä¸Šçš„å†…å®¹åŽï¼Œç½‘é¡µä¸Šçš„å†…å®¹æ˜¯ä¸èƒ½ç«‹å³åˆ·æ–°çš„ã€‚è¿™æ¯”è¾ƒå¤´ç–¼ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›é€”å¾„åŽ»è§£å†³ã€‚è¿™ä¸ªè‡ªåŠ¨åˆ·æ–°é—®é¢˜ä¼šåœ¨åŽé¢çš„å®žæˆ˜é¡¹ç›®ä¸­å®žçŽ°ã€‚ 12345678910@RestControllerpublic class HelloController &#123; @Value("$&#123;auther&#125;") private String auther; @GetMapping("/hello") public String hello()&#123; return auther; &#125;&#125;]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[9.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-APIç½‘å…³]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F9.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-API%E7%BD%91%E5%85%B3%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬ä¹ç¯‡æ–‡ç« ï¼ŒæœåŠ¡çš„æ³¨å†Œã€å‘çŽ°å’Œæ¶ˆè´¹éƒ½è§£å†³äº†ï¼Œå°ç³»ç»Ÿå°±å¯ä»¥è·‘èµ·æ¥äº†ï¼Œä½†æ˜¯å¯¹äºŽå¤æ‚çš„ç³»ç»Ÿï¼Œä¸€ä¸ªç»Ÿä¸€çš„å…¥å£æ˜¯å¿…è¦çš„ï¼Œä¸‹é¢å°†ä»‹ç»ç½‘å…³æ˜¯ä»€ä¹ˆï¼Œå®ƒçš„é‡è¦æ€§ï¼Œå¹¶ä¸”ä»‹ç»zuulç»„ä»¶çš„ä½¿ç”¨ã€‚ ä¸€ã€èƒŒæ™¯ ç†è®ºä¸Šï¼Œå®¢æˆ·ç«¯å¯ä»¥ç›´æŽ¥å‘å¾®æœåŠ¡å‘é€è¯·æ±‚ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰ä¸€ä¸ªå…¬å¼€çš„URLï¼Œè¯¥URLå°†æ˜ å°„åˆ°å¾®æœåŠ¡çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç”±å®ƒè´Ÿè´£åœ¨å¯ç”¨å®žä¾‹ä¹‹é—´åˆ†å‘è¯·æ±‚ã€‚ ä½†æ˜¯æˆ‘ä»¬çŸ¥é“åœ¨å¾®æœåŠ¡æž¶æž„é£Žæ ¼ä¸­ï¼Œä¸€ä¸ªå¤§åº”ç”¨è¢«æ‹†åˆ†æˆä¸ºäº†å¤šä¸ªå°çš„æœåŠ¡ç³»ç»Ÿæä¾›å‡ºæ¥ï¼Œè¿™äº›å°çš„ç³»ç»Ÿä»–ä»¬å¯ä»¥è‡ªæˆä½“ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å°ç³»ç»Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œæ¡†æž¶ç”šè‡³è¯­è¨€ç­‰ï¼Œè¿™äº›å°ç³»ç»Ÿé€šå¸¸ä»¥æä¾› Rest Api é£Žæ ¼çš„æŽ¥å£æ¥è¢« H5, Android, IOS ä»¥åŠç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè°ƒç”¨ã€‚ ä½†æ˜¯åœ¨UIä¸Šè¿›è¡Œå±•ç¤ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦åœ¨ä¸€ä¸ªç•Œé¢ä¸Šå±•ç¤ºå¾ˆå¤šæ•°æ®ï¼Œè¿™äº›æ•°æ®å¯èƒ½æ¥è‡ªäºŽä¸åŒçš„å¾®æœåŠ¡ä¸­ï¼Œä¸¾ä¸ªä¾‹å­ã€‚ åœ¨ä¸€ä¸ªç”µå•†ç³»ç»Ÿä¸­ï¼ŒæŸ¥çœ‹ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µï¼Œè¿™ä¸ªå•†å“è¯¦æƒ…é¡µåŒ…å«å•†å“çš„æ ‡é¢˜ï¼Œä»·æ ¼ï¼Œåº“å­˜ï¼Œè¯„è®ºç­‰ï¼Œè¿™äº›æ•°æ®å¯¹äºŽåŽç«¯æ¥è¯´å¯èƒ½æ˜¯ä½äºŽä¸åŒçš„å¾®æœåŠ¡ç³»ç»Ÿä¹‹ä¸­ï¼Œå¯èƒ½æˆ‘åŽå°çš„ç³»ç»Ÿæ˜¯è¿™æ ·æ¥æ‹†åˆ†æˆ‘çš„æœåŠ¡çš„ï¼š äº§å“æœåŠ¡ - è´Ÿè´£æä¾›å•†å“çš„æ ‡é¢˜ï¼Œæè¿°ï¼Œè§„æ ¼ç­‰ã€‚ ä»·æ ¼æœåŠ¡ - è´Ÿè´£å¯¹äº§å“è¿›è¡Œå®šä»·ï¼Œä»·æ ¼ç­–ç•¥è®¡ç®—ï¼Œä¿ƒé”€ä»·ç­‰ã€‚ åº“å­˜æœåŠ¡ - è´Ÿè´£äº§å“åº“å­˜ã€‚ è¯„ä»·æœåŠ¡ - è´Ÿè´£ç”¨æˆ·å¯¹å•†å“çš„è¯„è®ºï¼Œå›žå¤ç­‰ã€‚ çŽ°åœ¨ï¼Œå•†å“è¯¦æƒ…é¡µéœ€è¦ä»Žè¿™äº›å¾®æœåŠ¡ä¸­æ‹‰å–ç›¸åº”çš„ä¿¡æ¯ï¼Œé—®é¢˜æ¥äº†: ç”±äºŽæˆ‘ä»¬ä½¿ç”¨çš„æœåŠ¡ç³»ç»Ÿæž¶æž„ï¼Œæ‰€ä»¥æ²¡åŠžæ³•åƒä¼ ç»Ÿå•ä½“åº”ç”¨ä¸€æ ·ä¾é æ•°æ®åº“çš„ join æŸ¥è¯¢æ¥å¾—åˆ°æœ€ç»ˆç»“æžœï¼Œé‚£ä¹ˆå¦‚ä½•æ‰èƒ½è®¿é—®å„ä¸ªæœåŠ¡å‘¢ï¼Ÿè¿™é‡Œå°±ä¼šå¼•å‡ºä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š 1. å®¢æˆ·ç«¯éœ€æ±‚å’Œå¾®æœåŠ¡æš´éœ²çš„ç»†ç²’åº¦ API ä¸åŒ¹é… ç»å¸¸æœ‰ä¸€ä¸ªä¸šåŠ¡è°ƒç”¨å¾ˆå¤šä¸ªæœåŠ¡ï¼Œå‡å¦‚å®¢æˆ·ç«¯å‘é€è®¸å¤šè¯·æ±‚ï¼Œè¿™åœ¨å…¬ç½‘ä¸Šå¯èƒ½ä¼šå¾ˆä½Žæ•ˆï¼Œè€Œä¸”ä¼šä½¿å®¢æˆ·ç«¯ä»£ç å˜å¾—æ›´å¤æ‚ã€‚ 2. æœåŠ¡ä½¿ç”¨çš„åè®®ä¸æ˜¯ Web å‹å¥½çš„ æœ‰çš„æœåŠ¡å¯èƒ½ä½¿ç”¨äºŒè¿›åˆ¶ RPCï¼ˆæ¯”å¦‚ thriftï¼‰ï¼Œæœ‰çš„æœåŠ¡å¯èƒ½ä½¿ç”¨ AMQP æ¶ˆæ¯ä¼ é€’åè®®ã€‚ä¸ç®¡å“ªç§åè®®éƒ½ä¸æ˜¯æµè§ˆå™¨å‹å¥½æˆ–é˜²ç«å¢™å‹å¥½çš„ï¼Œæœ€å¥½æ˜¯å†…éƒ¨ä½¿ç”¨ã€‚åœ¨é˜²ç«å¢™ä¹‹å¤–ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥ä½¿ç”¨è¯¸å¦‚ HTTP å’Œ WebSocket ä¹‹ç±»çš„åè®®ã€‚ 3. éš¾é‡æž„ éšç€æ—¶é—´æŽ¨ç§»å¯èƒ½æƒ³è¦æ›´æ”¹ç³»ç»Ÿåˆ’åˆ†æˆæœåŠ¡çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåˆå¹¶ä¸¤ä¸ªæœåŠ¡æˆ–è€…å°†ä¸€ä¸ªæœåŠ¡æ‹†åˆ†æˆä¸¤ä¸ªæˆ–æ›´å¤šæœåŠ¡ã€‚å¦‚æžœå®¢æˆ·ç«¯ä¸Žå¾®æœåŠ¡ç›´æŽ¥é€šä¿¡ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ç±»é‡æž„å°±å¾ˆå›°éš¾ã€‚ ç”±äºŽä»¥ä¸Šé—®é¢˜ï¼Œå®¢æˆ·ç«¯ä¸Žå¾®æœåŠ¡ç›´æŽ¥é€šä¿¡å¾ˆå°‘æ˜¯åˆç†çš„ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ API ç½‘å…³ï¼Œç”± API ç½‘å…³ä½œä¸ºåŽç«¯æœåŠ¡ç³»ç»Ÿçš„å”¯ä¸€å…¥å£ã€‚å®ƒå°è£…äº†ç³»ç»Ÿå†…éƒ¨æž¶æž„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªå®šåˆ¶çš„ API ã€‚ç”±å®ƒè´Ÿè´£æœåŠ¡è¯·æ±‚è·¯ç”±ã€ç»„åˆåŠåè®®è½¬æ¢ã€‚æœ‰çš„ API ç½‘å…³è¿˜æœ‰å…¶å®ƒèŒè´£ï¼Œå¦‚èº«ä»½éªŒè¯ã€ç›‘æŽ§ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ç­‰ã€‚ äºŒã€API ç½‘å…³ APIç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿçš„å”¯ä¸€å…¥å£ã€‚ä»Žé¢å‘å¯¹è±¡è®¾è®¡çš„è§’åº¦çœ‹ï¼Œå®ƒä¸Žå¤–è§‚æ¨¡å¼ç±»ä¼¼ã€‚APIç½‘å…³å°è£…äº†ç³»ç»Ÿå†…éƒ¨æž¶æž„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªå®šåˆ¶çš„APIã€‚å®ƒå¯èƒ½è¿˜å…·æœ‰å…¶å®ƒèŒè´£ï¼Œå¦‚èº«ä»½éªŒè¯ã€ç›‘æŽ§ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€è¯·æ±‚åˆ†ç‰‡ä¸Žç®¡ç†ã€é™æ€å“åº”å¤„ç†ã€‚ APIç½‘å…³æ–¹å¼çš„æ ¸å¿ƒè¦ç‚¹æ˜¯ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æŽ¥å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰çš„éžä¸šåŠ¡åŠŸèƒ½ã€‚é€šå¸¸ï¼Œç½‘å…³ä¹Ÿæ˜¯æä¾›REST/HTTPçš„è®¿é—®APIã€‚æœåŠ¡ç«¯é€šè¿‡API-GWæ³¨å†Œå’Œç®¡ç†æœåŠ¡ã€‚ å•èŠ‚ç‚¹ç½‘å…³ Backends for frontends ç½‘å…³ ä¸‰ã€API ç½‘å…³çš„ä¼˜ç¼ºç‚¹ 1. ä¼˜ç‚¹ å°è£…äº†åº”ç”¨ç¨‹åºçš„å†…éƒ¨ç»“æž„ã€‚å®¢æˆ·ç«¯åªéœ€è¦åŒç½‘å…³äº¤äº’ï¼Œè€Œä¸å¿…è°ƒç”¨ç‰¹å®šçš„æœåŠ¡ï¼ˆç»Ÿä¸€APIå…¥å£ï¼‰ã€‚API ç½‘å…³ä¸ºæ¯ä¸€ç±»å®¢æˆ·ç«¯æä¾›äº†ç‰¹å®šçš„ API ï¼Œä»Žè€Œå‡å°‘å®¢æˆ·ç«¯ä¸Žåº”ç”¨ç¨‹åºé—´çš„äº¤äº’æ¬¡æ•°ï¼Œç®€åŒ–å®¢æˆ·ç«¯ä»£ç çš„å¤„ç†ï¼ˆé›†åˆå¤šä¸ªAPIï¼‰ã€‚ å¦å¤–ï¼Œå¯ä»¥é¿å…å†…éƒ¨ä¿¡æ¯æ³„éœ²ç»™å¤–éƒ¨ã€‚å¯ä»¥ä¸ºå¾®æœåŠ¡æ·»åŠ é¢å¤–çš„å®‰å…¨å±‚ã€‚æ”¯æŒæ··åˆé€šä¿¡åè®®ã€‚é™ä½Žæž„å»ºå¾®æœåŠ¡çš„å¤æ‚æ€§ã€‚ 2. ç¼ºç‚¹ å¢žåŠ äº†ä¸€ä¸ªå¿…é¡»å¼€å‘ã€éƒ¨ç½²å’Œç»´æŠ¤çš„é«˜å¯ç”¨ç»„ä»¶ã€‚è¿˜æœ‰ä¸€ä¸ªé£Žé™©æ˜¯ API ç½‘å…³å˜æˆäº†å¼€å‘ç“¶é¢ˆã€‚ä¸ºäº†æš´éœ²æ¯ä¸ªå¾®æœåŠ¡ï¼Œå¼€å‘äººå‘˜å¿…é¡»æ›´æ–° API ç½‘å…³ã€‚API ç½‘å…³çš„æ›´æ–°è¿‡ç¨‹è¦å°½å¯èƒ½åœ°ç®€å•ï¼Œå¦åˆ™ä¸ºäº†æ›´æ–°ç½‘å…³ï¼Œå¼€å‘äººå‘˜å°†ä¸å¾—ä¸æŽ’é˜Ÿç­‰å¾…ã€‚ä¸è¿‡ï¼Œè™½ç„¶æœ‰è¿™äº›ä¸è¶³ï¼Œä½†å¯¹äºŽå¤§å¤šæ•°çŽ°å®žä¸–ç•Œçš„åº”ç”¨ç¨‹åºè€Œè¨€ä½¿ç”¨ API ç½‘å…³æ˜¯åˆç†çš„ã€‚ï¼ˆåœ¨æž¶æž„ä¸Šéœ€è¦é¢å¤–è€ƒè™‘æ›´å¤šç¼–æŽ’å’Œç®¡ç†ï¼›è·¯ç”±é€»è¾‘é…ç½®è¦è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ï¼›å¯èƒ½å¼•å‘å•ç‚¹æ•…éšœï¼‰ å››ã€å‚è€ƒå®žçŽ°æ–¹æ¡ˆ ä»¥ä¸Šåˆ—å‡ºåœ¨ DIY è¿™ä¸ª API ç½‘å…³æ—¶éœ€è¦è€ƒè™‘çš„ç‚¹ï¼Œä»¥åŠå‚è€ƒçš„æŠ€æœ¯å®žçŽ°ã€‚ä¸‹é¢æ˜¯å‡ ç§ç›®å‰æ¯”è¾ƒæµè¡Œçš„ API ç½‘å…³æ­å»ºçš„æŠ€æœ¯æ–¹æ¡ˆä¾›å‚è€ƒï¼ŒåŽç»­æ–‡ç« å°†ç»™å‡ºè¿™äº›æ–¹æ¡ˆæ­å»ºçš„ä¾‹å­ 1ï¼‰Nginx + Luaå®žçŽ°è´Ÿè½½å‡è¡¡ã€é™æµã€æœåŠ¡å‘çŽ°ç­‰åŠŸèƒ½ 2ï¼‰ä½¿ç”¨ spring cloud æŠ€æœ¯æ ˆï¼Œå…¶ä¸­ zuul å°±æ˜¯ç”¨ä½œ API ç½‘å…³çš„ 3ï¼‰Mashape çš„å¼€æº API ç½‘å…³ Kong æœ¬æ¬¡ï¼Œä½¿ç”¨zuulä½œä¸ºAPIç½‘å…³ã€‚ äº”ã€Zuul åŠŸèƒ½ï¼šè®¤è¯ã€åŽ‹æµ‹ã€é‡‘ä¸é›€æµ‹è¯•ã€åŠ¨æ€è·¯ç”±ã€è´Ÿè½½å‰Šå‡ã€å®‰å…¨ã€é™æ€ç›¸åº”å¤„ç†â€¦ æ³¨æ„ï¼šå› ä¸ºæˆ‘åˆ°ç›®å‰ä¸ºæ­¢ï¼Œspringbootç”¨çš„ç‰ˆæœ¬æ˜¯2.1.xï¼Œä½†æ˜¯å‘¢ï¼Œé›†æˆzuulçš„æ—¶å€™æŠ¥é”™ï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œæ˜¯zuulè¿˜ä¸æ”¯æŒ2.1.xçš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘å°†demo:weather-eureka-client=zuulé™çº§åˆ°äº†2.0.3ç‰ˆæœ¬ã€‚å¯åŠ¨æˆåŠŸå¹¶ä¸”æµ‹è¯•æˆåŠŸ é¦–å…ˆæ˜¯å‡†å¤‡æ‹¿å‡ºä¹‹å‰çš„ä¸¤ä¸ªé¡¹ç›®ï¼šweather-eureka-serverå’Œweather-eureka-clientï¼Œå¯åŠ¨ï¼Œä¸€ä¸ªåœ°å€æ˜¯8671ï¼Œä¸€ä¸ªåœ°å€æˆ‘è®¾å®šä¸º8081,åŸºäºŽweather-eureka-clientæ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼šweather-eureka-client-zuulï¼Œæ”¹åŠ¨å¦‚ä¸‹ï¼š é¦–å…ˆå°†springbootç‰ˆæœ¬é™åˆ°2.0.xç‰ˆæœ¬ã€‚åœ¨å¯åŠ¨ç±»ä¸Šå¢žåŠ æ³¨è§£ï¼š@EnableZuulProxyï¼Œåœ¨ymlæ–‡ä»¶ä¸­æ–°å¢žï¼š 12345zuul: routes: hi: path: /hi/** serviceId: weather-eureka-client è¿™é‡Œçš„å«ä¹‰æ˜¯ï¼šå®šä¹‰ä¸€ä¸ªåå­—å«åšhiçš„è·¯ç”±è§„åˆ™ï¼ˆè‡ªå®šä¹‰ï¼‰ï¼Œæˆ‘ä»¬è®¿é—®/hi/**è¿™ä¸ªè·¯å¾„çš„æ—¶å€™ï¼Œå°±ä¼šè½¬å‘åˆ°weather-eureka-clientè¿™ä¸ªæœåŠ¡ä¸‹çš„**è·¯å¾„ã€‚ æ¯”å¦‚æˆ‘è¿™é‡Œçš„weather-eureka-clientæœ‰ä¸€ä¸ªcontrollerè·¯å¾„ä¸º&quot;hello&quot;ï¼Œè°ƒç”¨localhost:8081/helloå°±å¯ä»¥è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é‚£ä¹ˆæœ‰äº†zuulé…ç½®ä¹‹åŽï¼Œæˆ‘å¯ä»¥è®¿é—®localhost:8082/hi/helloä¹Ÿå¯ä»¥è®¿é—®åˆ°è¿™ä¸ªè·¯å¾„äº†ã€‚ æ”¹é€ æœ¬ç³»ç»Ÿï¼š æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼šmsa-eureka-client-zuulã€‚ä¸»è¦æ˜¯å®šä¹‰ç½‘å…³çš„è·¯ç”±ã€‚ 123456789101112131415161718spring: application: name: msa-eureka-client-zuuleureka: client: service-url: defaultZone: http://localhost:8761/eureka# ä¸€ä¸ªæ˜¯msa-weather-data-eurekaï¼Œä¸€ä¸ªæ˜¯msa-weather-ciy-eurekazuul: routes: city: path: /city/**/ serviceId: msa-weather-city-eureka data: path: /data/**/ serviceId: msa-weather-data-eurekaserver: port: 8085 okï¼Œä¸‹é¢æˆ‘ä»¬å°±ä¿®æ”¹msa-weather-collection-cureka-feignå’Œmsa-weather-report-feign.å¤åˆ¶ä¸ºæ–°çš„é¡¹ç›®ï¼šmsa-weather-collection-cureka-feign-zuulå’Œmsa-weather-report-feign-zuul ä»¥msa-weather-report-feign-zuulä¸ºä¾‹ï¼Œå…¶å®žä»–ä¾æ‰˜äºŽä¸¤ä¸ªæœåŠ¡:msa-weather-data-eurekaå’Œmsa-weather-ciy-eurekaï¼Œè¿™ä¸¤ä¸ªæˆ‘ä»¬åªéœ€è¦å†™åœ¨ä¸€ä¸ªæŽ¥å£å†…ï¼Œè°ƒç”¨ç½‘å…³é‡Œå®šä¹‰çš„è·¯ç”±å³å¯ï¼š 12345678910111213141516@FeignClient("msa-eureka-client-zuul")public interface DataClient &#123; /** * èŽ·å–åŸŽå¸‚åˆ—è¡¨ */ @RequestMapping("city/cities") List&lt;City&gt; listCity() throws Exception; /** * æ ¹æ®åŸŽå¸‚IDèŽ·å–å¤©æ°” */ @RequestMapping("data/weather/cityId/&#123;cityId&#125;") WeatherResponse getDataByCityId(@PathVariable("cityId") String cityId);&#125; è¿™æ ·å­ï¼Œè¿™ä¸ªDataClientå°±å–ä»£äº†ä¹‹å‰çš„cityClientå’ŒWeatherClientã€‚æ”¹é€ å®Œæˆã€‚ æµ‹è¯•æ— é—®é¢˜ã€‚]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[8.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å¾®æœåŠ¡çš„æ¶ˆè´¹]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F8.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%B6%88%E8%B4%B9%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬å…«ç¯‡æ–‡ç« ï¼Œåœ¨è§£å†³äº†æœåŠ¡æ³¨å†Œå’Œå‘çŽ°ä¸¤ä¸ªé—®é¢˜ä¹‹åŽï¼Œå°±è¦è§£å†³æœåŠ¡æ¶ˆè´¹é—®é¢˜äº†ã€‚æœ¬èŠ‚ä»‹ç»feignçš„ä½¿ç”¨ã€‚ 1.å‘çŽ°æ¨¡å¼ ç›´è¿žæ¨¡å¼ï¼š ç›´æŽ¥åŽ»è¿žæŽ¥æŸä¸ªurlï¼Œæ¯”è¾ƒç®€å•ç²—æš´ï¼Œä½†æ˜¯ä¸èƒ½å®žçŽ°è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨ï¼Œä½¿ç”¨æ¯”è¾ƒå°‘ã€‚ å®¢æˆ·ç«¯å‘çŽ°æ¨¡å¼ï¼š æœåŠ¡å®žä¾‹å¯åŠ¨åŽï¼Œå°†è‡ªå·±çš„ä½ç½®ä¿¡æ¯æäº¤åˆ°æœåŠ¡æ³¨å†Œè¡¨ å®¢æˆ·ç«¯ä»ŽæœåŠ¡æ³¨å†Œè¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œæ¥èŽ·å–å¯ç”¨çš„æœåŠ¡å®žä¾‹ å®¢æˆ·ç«¯è‡ªè¡Œä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ä»Žå¤šä¸ªæœåŠ¡å®žä¾‹ä¸­é€‰æ‹©ä¸€ä¸ª æœåŠ¡ç«¯å‘çŽ°æ¨¡å¼ï¼š è´Ÿè½½å‡è¡¡çš„å®žçŽ°åœ¨æœåŠ¡ç«¯ã€‚è€Œå®¢æˆ·ç«¯å‘çŽ°æ¨¡å¼çš„è´Ÿè½½å‡è¡¡ç”±å®¢æˆ·ç«¯æ¥å®žçŽ°ã€‚ 2.æœåŠ¡çš„æ¶ˆè´¹è€… Apache HttpClientï¼šè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚ Ribbon: åŸºäºŽå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å·¥å…·ã€‚å¯ä»¥åŸºäºŽHttpæˆ–è€…Tcpå®žçŽ°è´Ÿè½½å‡è¡¡ã€‚ ç›´æŽ¥æ ¹æ®æœåŠ¡çš„åå­—æ¥æ¶ˆè´¹ï¼Œå…·ä½“æ˜¯è¿žåˆ°å“ªä¸€ä¸ªå…·ä½“çš„ipåŽ»æ¶ˆè´¹æ˜¯ä¸ç”¨ç®¡çš„ï¼Œå› ä¸ºä»–å·²ç»åœ¨å®¢æˆ·ç«¯ä¸Šåšäº†ä¸€å®šçš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œç”±ä»–çš„ç®—æ³•æ¥å†³å®šã€‚ Febin: Feignæ˜¯ä¸€ä¸ªå£°æ˜Žå¼çš„ä¼ªHttpå®¢æˆ·ç«¯ï¼Œå®ƒä½¿å¾—å†™Httpå®¢æˆ·ç«¯å˜å¾—æ›´ç®€å•ã€‚ä½¿ç”¨Feignï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæŽ¥å£å¹¶æ³¨è§£ã€‚å®ƒå…·æœ‰å¯æ’æ‹”çš„æ³¨è§£ç‰¹æ€§ï¼Œå¯ä½¿ç”¨Feign æ³¨è§£å’ŒJAX-RSæ³¨è§£ã€‚Feignæ”¯æŒå¯æ’æ‹”çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚Feigné»˜è®¤é›†æˆäº†Ribbonï¼Œå¹¶å’ŒEurekaç»“åˆï¼Œé»˜è®¤å®žçŽ°äº†è´Ÿè½½å‡è¡¡çš„æ•ˆæžœã€‚ æˆ‘ä»¬å…ˆæ¥æžä¸ªdemoæµ‹è¯•ä¸€æŠŠï¼ 3.Demo for Feign é¦–å…ˆï¼Œæˆ‘ä»¬ä¹‹å‰çš„å·¥ä½œä¸­å·²ç»ç”±äº†ä¸€ä¸ªEureka serverï¼Œå†æ‹¿ä¸€ä¸ªå«åšmsa-weather-city-serverçš„æœåŠ¡æ¥æµ‹è¯•ã€‚è¿™ä¸ªæœåŠ¡çš„ä¸»è¦åŠŸèƒ½æ˜¯èŽ·å–åŸŽå¸‚ä¿¡æ¯ã€‚ 3.1 å¼•å…¥ä¾èµ–ã€æ·»åŠ æ³¨è§£ é¦–å…ˆå¼•å…¥feignä¾èµ–ï¼Œæ³¨æ„è¿™é‡Œæœ‰ä¸ªå‘ï¼Œæˆ‘ä¸€å¼€å§‹æ²¡æœ‰æŒ‡å®šç‰ˆæœ¬å·ï¼Œæ­»æ´»æ— æ³•å¯¼å…¥@EnableFeignClientsè¿™ä¸ªæ³¨è§£ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;version&gt;2.0.1.RELEASE&lt;/version&gt;&lt;/dependency&gt; åœ¨ç¨‹åºçš„å¯åŠ¨ç±»ServiceFeignApplication ï¼ŒåŠ ä¸Š@EnableFeignClientsæ³¨è§£å¼€å¯Feignçš„åŠŸèƒ½ï¼š 123456789@SpringBootApplication@EnableDiscoveryClient@EnableFeignClientspublic class EurekaClientFeignApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(EurekaClientFeignApplication.class, args); &#125;&#125; 3.2 é…ç½®æ–‡ä»¶ 1234567891011121314spring: application: name: eureka-weather-feigneureka: client: service-url: defaultZone: http://localhost:8761/eurekafeign: client: config: feignName: connectTimeout: 5000 readTimeout: 5000 3.3 å®šä¹‰feignæŽ¥å£ å®šä¹‰ä¸€ä¸ªfeignæŽ¥å£ï¼Œé€šè¿‡@ FeignClientï¼ˆâ€œæœåŠ¡åâ€ï¼‰ï¼Œæ¥æŒ‡å®šè°ƒç”¨å“ªä¸ªæœåŠ¡ã€‚æ¯”å¦‚åœ¨ä»£ç ä¸­è°ƒç”¨äº†msa-weather-city-eurekaæœåŠ¡çš„â€œ/citiesâ€æŽ¥å£æ¥èŽ·å–æ‰€æœ‰çš„åŸŽå¸‚åˆ—è¡¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345@FeignClient("msa-weather-city-eureka")public interface CityClient &#123; @GetMapping("/cities") String listCity();&#125; 3.4 å®šä¹‰APIæ¥ä¾›æµè§ˆå™¨è°ƒç”¨ 12345678910@RestControllerpublic class TestController &#123; @Autowired private CityClient cityClient; @GetMapping("cities") public String getData()&#123; String res = cityClient.listCity(); return res; &#125;&#125; è¿™æ ·ï¼Œå¯åŠ¨æœåŠ¡ä¸­å¿ƒEureka serverå’ŒæœåŠ¡æä¾›æ–¹msa-weather-city-serverä»¥åŠæœ¬æ¶ˆè´¹æœåŠ¡ã€‚å†æµè§ˆå™¨ä¸­è®¿é—®å¯¹åº”çš„urlï¼šhttp://localhost:8080/citieså°±å¯ä»¥è°ƒç”¨åˆ°msa-weather-city-serveræä¾›çš„æœåŠ¡ã€‚ è‡³æ­¤ï¼Œdemoæ¼”ç¤ºå®Œæ¯•ã€‚ 4.ç”¨Feignç»§ç»­å®Œå–„å¤©æ°”é¡¹ç›® æœ‰ä¸‰ä¸ªTODOé¡¹ï¼š æ•°æ®é‡‡é›†å¾®æœåŠ¡åœ¨å¤©æ°”æ•°æ®åŒæ­¥ä»»åŠ¡ä¸­ï¼Œä¾èµ–äºŽåŸŽå¸‚æ•°æ®APIå¾®æœåŠ¡ å¤©æ°”é¢„æŠ¥å¾®æœåŠ¡æŸ¥è¯¢å¤©æ°”ä¿¡æ¯ï¼Œä¾èµ–äºŽå¤©æ°”æ•°æ®APIå¾®æœåŠ¡ å¤©æ°”é¢„æŠ¥å¾®æœåŠ¡æä¾›çš„åŸŽå¸‚åˆ—è¡¨ï¼Œä¾èµ–äºŽåŸŽå¸‚æ•°æ®APIå¾®æœåŠ¡ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œéœ€è¦åŽ»é›†æˆFeignåŽ»æ¶ˆè´¹çš„å¾®æœåŠ¡åªæœ‰ä¸¤ä¸ªï¼šmsa-weather-collection-eurekaå’Œmsa-weather-report-eurekaã€‚æˆ‘ä»¬å°†å…¶æ”¹é€ ä¸ºï¼šmsa-weather-collection-eureka-feignå’Œmsa-weather-report-eureka-feign. è¿™é‡Œå°±ä»¥msa-weather-collection-eurekaä¸ºä¾‹ï¼Œæ­¥éª¤åŸºæœ¬ä¸Ždemoä¸€æ ·ã€‚é¦–å…ˆæ˜¯å¼•å…¥ä¾èµ–ï¼Œç„¶åŽåŠ ä¸Šæ³¨è§£å¼€å¯FeignåŠŸèƒ½ã€‚æ–°å»ºä¸€ä¸ªæŽ¥å£ï¼Œè¿˜æ˜¯èŽ·å–åŸŽå¸‚åˆ—è¡¨ã€‚æˆ‘åªè¦æŒ‡å®šå¥½é‚£ä¸ªåŸŽå¸‚åˆ—è¡¨çš„å¾®æœåŠ¡çš„åå­—å’Œè·¯å¾„ï¼Œå°±å¯ä»¥èŽ·å–åˆ°äº†ã€‚ä¸æ¸…æ¥šç›´æŽ¥çœ‹ä»£ç å³å¯ã€‚ é‚£ä¹ˆåœ¨å…¨éƒ¨æ”¹å¥½ä¹‹åŽï¼Œæˆ‘ä»¬å¯åŠ¨è¿™äº”ä¸ªé¡¹ç›®ã€‚ä½†æ˜¯æˆ‘ä»¬è¦æ³¨æ„ï¼Œå…ˆå¯åŠ¨weather-eureka-serverï¼Œæ¥æä¾›æ³¨å†Œçš„æœåŠ¡ã€‚ç„¶åŽå¯åŠ¨åŸŽå¸‚æ•°æ®æœåŠ¡ï¼Œå› ä¸ºå¤©æ°”æ•°æ®é‡‡é›†è¦ç”¨åˆ°ä»–ã€‚ç„¶åŽå¯åŠ¨å¤©æ°”æ•°æ®é‡‡é›†æœåŠ¡ã€‚ç„¶åŽä¸€æ¬¡å¯åŠ¨å¤©æ°”æ•°æ®APIæœåŠ¡å’Œå¤©æ°”é¢„æŠ¥UIæ˜¾ç¤ºæœåŠ¡ã€‚ é‚£ä¹ˆæˆ‘ä»¬è®¿é—®å¤©æ°”é¢„æŠ¥UIå¯¹åº”çš„URL,ä»¥å—äº¬ä¸ºä¾‹ï¼š http://localhost:8083/report/cityId/101190101ï¼Œå¦‚æžœåŠŸèƒ½æ˜¯æ­£å¸¸çš„ï¼Œæ ‡è¯†å¾®æœåŠ¡æ”¹é€ åˆæ­¥æˆåŠŸã€‚]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[7.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å¾®æœåŠ¡çš„æ³¨å†Œå’Œå‘çŽ°]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F7.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%B3%A8%E5%86%8C%E5%92%8C%E5%8F%91%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬ä¸ƒç¯‡æ–‡ç« ï¼Œé¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯æœåŠ¡æ³¨å†Œå’Œå‘çŽ°ã€‚æœ¬èŠ‚ä»‹ç»eurekaçš„ä½¿ç”¨ã€‚ 1.ä»€ä¹ˆæ˜¯spring cloud Spring Cloudæ˜¯ä¸€ç³»åˆ—æ¡†æž¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨Spring Bootçš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘çŽ°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æŽ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨Spring Bootçš„å¼€å‘é£Žæ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚Springå¹¶æ²¡æœ‰é‡å¤åˆ¶é€ è½®å­ï¼Œå®ƒåªæ˜¯å°†ç›®å‰å„å®¶å…¬å¸å¼€å‘çš„æ¯”è¾ƒæˆç†Ÿã€ç»å¾—èµ·å®žé™…è€ƒéªŒçš„æœåŠ¡æ¡†æž¶ç»„åˆèµ·æ¥ï¼Œé€šè¿‡Spring Booté£Žæ ¼è¿›è¡Œå†å°è£…å±è”½æŽ‰äº†å¤æ‚çš„é…ç½®å’Œå®žçŽ°åŽŸç†ï¼Œæœ€ç»ˆç»™å¼€å‘è€…ç•™å‡ºäº†ä¸€å¥—ç®€å•æ˜“æ‡‚ã€æ˜“éƒ¨ç½²å’Œæ˜“ç»´æŠ¤çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·åŒ…ã€‚ å¾®æœåŠ¡æ˜¯å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ã€æ°´å¹³æ‰©å±•ã€ç‹¬ç«‹è®¿é—®ï¼ˆæˆ–è€…æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼‰çš„æœåŠ¡å•å…ƒï¼Œspring cloudå°±æ˜¯è¿™äº›å¾®æœåŠ¡çš„å¤§ç®¡å®¶ï¼Œé‡‡ç”¨äº†å¾®æœåŠ¡è¿™ç§æž¶æž„ä¹‹åŽï¼Œé¡¹ç›®çš„æ•°é‡ä¼šéžå¸¸å¤šï¼Œspring cloudåšä¸ºå¤§ç®¡å®¶éœ€è¦ç®¡ç†å¥½è¿™äº›å¾®æœåŠ¡ï¼Œè‡ªç„¶éœ€è¦å¾ˆå¤šå°å¼Ÿæ¥å¸®å¿™ã€‚ è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€äº›é—®é¢˜:é…ç½®ç®¡ç†ã€æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘çŽ°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€æœåŠ¡é—´è°ƒç”¨ã€ä¸€æ¬¡æ€§ä»¤ç‰Œã€å…¨å±€é”ã€é¢†å¯¼é€‰ä¸¾ã€æŽ§åˆ¶æ€»çº¿ã€æ€ç»´å¯¼å›¾ã€åˆ†å¸ƒå¼ä¼šè¯ã€é›†ç¾¤çŠ¶æ€ã€åˆ†å¸ƒå¼æ¶ˆæ¯ã€‚ã€‚ã€‚ 2.spring cloud &amp; spring boot SpringBootæ˜¯æž„å»ºspring cloudæž¶æž„çš„åŸºçŸ³ 3.spring cloudå­é¡¹ç›® å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šspringcloud(ä¸€)ï¼šå¤§è¯Spring Cloud 4.Eureka 4.1.æœåŠ¡ä¸­å¿ƒ æœåŠ¡ä¸­å¿ƒåˆç§°æ³¨å†Œä¸­å¿ƒï¼Œç®¡ç†å„ç§æœåŠ¡åŠŸèƒ½åŒ…æ‹¬æœåŠ¡çš„æ³¨å†Œã€å‘çŽ°ã€ç†”æ–­ã€è´Ÿè½½ã€é™çº§ç­‰ï¼Œæ¯”å¦‚dubbo adminåŽå°çš„å„ç§åŠŸèƒ½ã€‚ æœ‰äº†æœåŠ¡ä¸­å¿ƒè°ƒç”¨å…³ç³»ä¼šæœ‰ä»€ä¹ˆå˜åŒ–ï¼Œç”»å‡ ä¸ªç®€å›¾æ¥å¸®å¿™ç†è§£. é¡¹ç›®Aè°ƒç”¨é¡¹ç›®B 12graph LRé¡¹ç›®A--&gt;é¡¹ç›®B æœ‰äº†æœåŠ¡ä¸­å¿ƒä¹‹åŽï¼Œä»»ä½•ä¸€ä¸ªæœåŠ¡éƒ½ä¸èƒ½ç›´æŽ¥åŽ»æŽ‰ç”¨ï¼Œéƒ½éœ€è¦é€šè¿‡æœåŠ¡ä¸­å¿ƒæ¥è°ƒç”¨ 12graph LRé¡¹ç›®A--&gt;æ³¨å†Œä¸­å¿ƒå†åŽ»è®¿é—®é¡¹ç›®B ç”±äºŽå„ç§æœåŠ¡éƒ½æ³¨å†Œåˆ°äº†æœåŠ¡ä¸­å¿ƒï¼Œå°±æœ‰äº†åŽ»åšå¾ˆå¤šé«˜çº§åŠŸèƒ½æ¡ä»¶ã€‚æ¯”å¦‚å‡ å°æœåŠ¡æä¾›ç›¸åŒæœåŠ¡æ¥åšå‡è¡¡è´Ÿè½½ï¼›ç›‘æŽ§æœåŠ¡å™¨è°ƒç”¨æˆåŠŸçŽ‡æ¥åšç†”æ–­ï¼Œç§»é™¤æœåŠ¡åˆ—è¡¨ä¸­çš„æ•…éšœç‚¹ï¼›ç›‘æŽ§æœåŠ¡è°ƒç”¨æ—¶é—´æ¥å¯¹ä¸åŒçš„æœåŠ¡å™¨è®¾ç½®ä¸åŒçš„æƒé‡ç­‰ç­‰ã€‚ 4.2.Eureka Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®žçŽ°æœåŠ¡æ³¨å†Œå’Œå‘çŽ°ã€‚ Eureka Server ä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨ Eureka çš„å®¢æˆ·ç«¯è¿žæŽ¥åˆ° Eureka Serverï¼Œå¹¶ç»´æŒå¿ƒè·³è¿žæŽ¥ã€‚ è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡ Eureka Server æ¥ç›‘æŽ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ Spring Cloud çš„ä¸€äº›å…¶ä»–æ¨¡å—ï¼ˆæ¯”å¦‚Zuulï¼‰å°±å¯ä»¥é€šè¿‡ Eureka Server æ¥å‘çŽ°ç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œå¹¶æ‰§è¡Œç›¸å…³çš„é€»è¾‘ã€‚ Eurekaç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼šEurekaæœåŠ¡å™¨å’ŒEurekaå®¢æˆ·ç«¯ã€‚EurekaæœåŠ¡å™¨ç”¨ä½œæœåŠ¡æ³¨å†ŒæœåŠ¡å™¨ã€‚Eurekaå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªjavaå®¢æˆ·ç«¯ï¼Œç”¨æ¥ç®€åŒ–ä¸ŽæœåŠ¡å™¨çš„äº¤äº’ã€ä½œä¸ºè½®è¯¢è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶æä¾›æœåŠ¡çš„æ•…éšœåˆ‡æ¢æ”¯æŒã€‚ å…¶ä¸­æœ‰ä¸‰ä¸ªè§’è‰²ï¼š Eureka Serverï¼šæä¾›æœåŠ¡æ³¨å†Œå’Œå‘çŽ° Service ProvideræœåŠ¡æä¾›æ–¹ï¼Œå°†è‡ªèº«æœåŠ¡æ³¨å†Œåˆ°Eurekaï¼Œä»Žè€Œä½¿æœåŠ¡æ¶ˆè´¹æ–¹èƒ½å¤Ÿæ‰¾åˆ° Service Consumerï¼šæœåŠ¡æ¶ˆè´¹æ–¹ï¼Œä»ŽEurekaèŽ·å–æ³¨å†ŒæœåŠ¡åˆ—è¡¨ï¼Œä»Žè€Œèƒ½å¤Ÿæ¶ˆè´¹æœåŠ¡ 4.3.Eureka Server æ–°å»ºä¸€ä¸ªspringbooté¡¹ç›®ã€‚spring cloudå·²ç»å¸®æˆ‘å®žçŽ°äº†æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘ä»¬åªéœ€è¦å¾ˆç®€å•çš„å‡ ä¸ªæ­¥éª¤å°±å¯ä»¥å®Œæˆã€‚ æ¼”ç¤ºçš„springbootç‰ˆæœ¬æ˜¯æœ€æ–°çš„&lt;version&gt;2.1.0.RELEASE&lt;/version&gt;,springcloudä¹Ÿæ˜¯æœ€æ–°çš„&lt;version&gt;Finchley.RELEASE&lt;/version&gt; 1ã€pomä¸­æ·»åŠ ä¾èµ– 12345678910111213141516171819202122232425262728293031&lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;Finchley.RELEASE&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/dependencyManagement&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--Eureka server--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 2ã€æ·»åŠ å¯åŠ¨ä»£ç ä¸­æ·»åŠ @EnableEurekaServeræ³¨è§£ 12345678@SpringBootApplication@EnableEurekaServerpublic class WeatherEurekaServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(WeatherEurekaServerApplication.class, args); &#125;&#125; 3ã€é…ç½®æ–‡ä»¶ åœ¨é»˜è®¤è®¾ç½®ä¸‹ï¼Œè¯¥æœåŠ¡æ³¨å†Œä¸­å¿ƒä¹Ÿä¼šå°†è‡ªå·±ä½œä¸ºå®¢æˆ·ç«¯æ¥å°è¯•æ³¨å†Œå®ƒè‡ªå·±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¦ç”¨å®ƒçš„å®¢æˆ·ç«¯æ³¨å†Œè¡Œä¸ºï¼Œåœ¨application.ymlï¼š 12345678910server: port: 8761eureka: instance: hostname: localhost client: register-with-eureka: false fetch-registry: false service-url: defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/ eureka.client.register-with-eureka ï¼šè¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°Eureka Serverï¼Œé»˜è®¤ä¸ºtrueã€‚ eureka.client.fetch-registry ï¼šè¡¨ç¤ºæ˜¯å¦ä»ŽEureka ServerèŽ·å–æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚ eureka.client.serviceUrl.defaultZone ï¼šè®¾ç½®ä¸ŽEureka Serveräº¤äº’çš„åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ã€‚é»˜è®¤æ˜¯http://localhost:8761/eureka ï¼›å¤šä¸ªåœ°å€å¯ä½¿ç”¨ , åˆ†éš”ã€‚ å¯åŠ¨å·¥ç¨‹åŽï¼Œè®¿é—®ï¼šhttp://localhost:8761/ ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„é¡µé¢ï¼Œå…¶ä¸­è¿˜æ²¡æœ‰å‘çŽ°ä»»ä½•æœåŠ¡ 4.4.Eureka Client åŸºæœ¬ä¸Žä¸Šä¸€ä¸ªæ˜¯ç±»ä¼¼çš„ã€‚ 1@EnableDiscoveryClient ä¸»è¦çš„é…ç½®æ–‡ä»¶ï¼š 1234567spring: application: name: weather-eureka-clienteureka: client: service-url: defaultZone: http://localhost:8761/eureka è¿™æ ·åŒæ—¶å¯åŠ¨Eureka Serverå’ŒEureka Clientä¸¤ä¸ªå·¥ç¨‹ã€‚åœ¨ç½‘ç«™ä¸­è¾“å…¥localhost://8761å°±å¯ä»¥çœ‹åˆ°æ³¨å†Œåˆ°Eureka Serverçš„å®žä¾‹äº†ã€‚ 5.æœ¬é—¨å®žæˆ˜ å°†ä¹‹å‰çš„å››ä¸ªå¾®æœåŠ¡æ”¹é€ ä¸ºeurekaçš„å®¢æˆ·ç«¯ã€‚ å³å°† mas-weather-collection-server mas-weather-report-server mas-weather-data-server mas-weather-city-server æ”¹ä¸ºï¼š mas-weather-collection-eureka mas-weather-report-eureka mas-weather-data-eureka mas-weather-city-eureka æ”¹é€ è¿‡ç¨‹ååˆ†ç®€å•ï¼Œå°±æ˜¯å¼•å…¥ä¾èµ–ï¼Œä¿®æ”¹é…ç½®å³å¯ã€‚ åŒæ—¶å¯åŠ¨è¿™å››ä¸ªå¾®æœåŠ¡å®¢æˆ·ç«¯å’Œä¸€ä¸ªeurekaæœåŠ¡ç«¯ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š ç”µè„‘è¦çˆ†ç‚¸äº†~~~~~~ ä¸‹é¢ï¼Œè¿™äº›å¾®æœåŠ¡ä¹‹é—´å¯ä»¥ç›¸äº’è®¿é—®äº†ã€‚]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[6.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-æ‹†åˆ†æœ¬ç³»ç»Ÿ]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F6.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E6%8B%86%E5%88%86%E6%9C%AC%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬å…­ç¯‡æ–‡ç« ï¼Œå…ˆåˆæ­¥æ‹†åˆ†æœ¬ç³»ç»Ÿä¸ºå››ä¸ªæœåŠ¡ï¼Œè¿˜æ²¡æœ‰è¿›è¡ŒæœåŠ¡æ²»ç†ç­‰ï¼Œåªæ˜¯ç®€å•çš„ä¸šåŠ¡æ‹†åˆ†ï¼Œä¸ºä¸‹ä¸€æ­¥åšå‡†å¤‡ã€‚ å¤©æ°”æ•°æ®é‡‡é›†å¾®æœåŠ¡ è¿™ä¸ªå¾®æœåŠ¡ä¸“é—¨æä¾›æ•°æ®é‡‡é›†å’Œå®šæ—¶æ›´æ–°åŠŸèƒ½ï¼Œå°†æ•°æ®å­˜å‚¨åœ¨redisä¸­ã€‚ è¯¥æœåŠ¡çš„æ ¸å¿ƒserviceä¸­çš„æ–¹æ³•æ˜¯ï¼šsyncDataByCityIdï¼Œå°±æ˜¯æ ¹æ®cityIdæ¥å°†æ•°æ®åŒæ­¥è¿›redisã€‚ ä»£ç ï¼šhttps://github.com/sunweiguo/swgBook-for-spring-cloud/tree/master/spring-cloud-weather-action/06/msa-weather-collection-server å¤©æ°”æ•°æ®API è¿™ä¸ªæœåŠ¡ä¸“é—¨æ¥æä¾›å¤©æ°”æ•°æ®çš„æŸ¥è¯¢åŠŸèƒ½ã€‚ å°†å‰ç«¯é¡µé¢ä»¥åŠå®šæ—¶ã€åŸŽå¸‚ç›¸å…³çš„ä»£ç å…¨éƒ¨å‰”é™¤ã€‚åªç•™ä¸‹ä¸¤ä¸ªAPIï¼š 123WeatherResponse getDataByCityId(String cityId);WeatherResponse getDataByCityName(String cityName); ä»£ç ï¼šhttps://github.com/sunweiguo/swgBook-for-spring-cloud/tree/master/spring-cloud-weather-action/06/msa-weather-data-server å¤©æ°”é¢„æŠ¥å¾®æœåŠ¡ æœ¬æœåŠ¡çš„ä¸»è¦åŠŸèƒ½ä¸ºï¼šç”¨æˆ·é€šè¿‡æµè§ˆå™¨æ¥è®¿é—®ï¼Œå¯ä»¥è¿”å›žä¸€ä¸ªå¤©æ°”é¢„æŠ¥çš„ç•Œé¢ã€‚ å°±å°†rediså’Œå®šæ—¶ä»»åŠ¡ç›¸å…³çš„éƒ½åˆ æŽ‰ã€‚æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªæŽ¥å£ï¼š 1Weather getDataByCityId(String cityId); å› ä¸ºå±•ç¤ºæ•°æ®éœ€è¦ç”¨åˆ°åŸŽå¸‚ä¿¡æ¯ï¼Œä½†æ˜¯æ­¤æ—¶è¿˜æ²¡æœ‰ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±åŽ»æ¨¡æ‹Ÿä¸€äº›æ•°æ®åŽ»æ˜¾ç¤ºã€‚ ä»£ç ï¼šhttps://github.com/sunweiguo/swgBook-for-spring-cloud/tree/master/spring-cloud-weather-action/06/msa-weather-report-server åŸŽå¸‚æ•°æ®API æœ¬æœåŠ¡åªæä¾›åŸŽå¸‚åˆ—è¡¨æ•°æ®åŠŸèƒ½ã€‚ 1List&lt;City&gt; listCity() throws Exception; æœ‰çš„éœ€è¦å¡«å……ä¸€äº›å‡æ•°æ®ä¹‹åŽï¼Œéƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚ ä»£ç ï¼šhttps://github.com/sunweiguo/swgBook-for-spring-cloud/tree/master/spring-cloud-weather-action/06/msa-weather-city-server]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[5.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-æœåŠ¡æ‹†åˆ†å’Œä¸šåŠ¡å»ºæ¨¡]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F5.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86%E5%92%8C%E4%B8%9A%E5%8A%A1%E5%BB%BA%E6%A8%A1%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬äº”ç¯‡æ–‡ç« ï¼Œåœ¨è¿›è¡ŒçœŸæ­£çš„ä¸šåŠ¡æ‹†åˆ†ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ä»€ä¹ˆæ˜¯SOAæž¶æž„ï¼Œä»€ä¹ˆæ˜¯å¾®æœåŠ¡ã€‚ç¡®å®šæœ¬ç³»ç»Ÿæ‹†åˆ†çš„å‡ ä¸ªéƒ¨åˆ†ã€‚ å•ä½“æž¶æž„ æˆ‘ä»¬ç†Ÿæ‚‰çš„å•ä½“MVCæž¶æž„ï¼š ç”¨æˆ·&lt;â€”&gt;è¡¨ç¤ºå±‚&lt;â€”&gt;ä¸šåŠ¡å±‚&lt;â€”&gt;æ•°æ®è®¿é—®å±‚&lt;â€”&gt;æ•°æ®åº“ å•å—ç»“æž„çš„ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ ç¼ºç‚¹ åŠŸèƒ½åˆ’åˆ†æ¸…æ¥š åŠŸèƒ½ä»ç„¶å¤ªå¤§ å±‚æ¬¡å…³ç³»è‰¯å¥½ æ”¯ä»˜å‘¨æœŸå˜é•¿ æ¯ä¸€å±‚ç‹¬ç«‹ å‡çº§é£Žé™©é«˜ éƒ¨ç½²ç®€å• ç»´æŠ¤æˆæœ¬å¢žåŠ  æŠ€æœ¯å•ä¸€ å¯ä¼¸ç¼©æ€§å·® ç”¨äººæˆæœ¬ä½Ž ç›‘æŽ§å›°éš¾ å•ä½“æž¶æž„å¦‚ä½•è½¬åŒ–ä¸ºå¾®æœåŠ¡ ä»€ä¹ˆæ˜¯SOAï¼Ÿ SOAæ˜¯ä¸€ç§è®¾è®¡æ–¹æ³•ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªæœåŠ¡ï¼Œè€ŒæœåŠ¡ä¹‹é—´é€šè¿‡é…åˆæœ€ç»ˆä¼šæä¾›ä¸€ç³»åˆ—åŠŸèƒ½ã€‚ä¸€ä¸ªæœåŠ¡é€šå¸¸ä»¥ç‹¬ç«‹çš„å½¢å¼å­˜åœ¨äºŽæ“ä½œç³»ç»Ÿè¿›ç¨‹ä¸­ã€‚æœåŠ¡ä¹‹é—´é€šè¿‡ç½‘ç»œè°ƒç”¨ï¼Œè€Œéžé‡‡ç”¨è¿›ç¨‹å†…è°ƒç”¨çš„æ–¹å¼è¿›è¡Œé€šä¿¡ã€‚ æ‰€ä»¥ï¼ŒSOAåªæ˜¯ä¸€ç§æž¶æž„è®¾è®¡æ¨¡å¼ï¼ŒSOAPï¼ŒRESTï¼ŒRPCæ˜¯æ ¹æ®è¿™ç§è®¾è®¡æ¨¡å¼æž„å»ºå‡ºæ¥çš„è§„èŒƒã€‚å…¶ä¸­SOAPé€šä¿—ç†è§£å°±æ˜¯http+xmlçš„å½¢å¼ï¼ŒRESTå°±æ˜¯http+jsonçš„å½¢å¼ï¼ŒRPCæ˜¯åŸºäºŽsocketçš„å½¢å¼ã€‚dubboå°±æ˜¯å…¸åž‹çš„RPCæ¡†æž¶ï¼Œè€ŒSpringCloudå°±æ˜¯éµå®ˆRESTè§„èŒƒçš„ç”Ÿæ€ç³»ç»Ÿã€‚ SOA VS å¾®æœåŠ¡ è¯è¯´1979å¹´ï¼Œåˆæ˜¯ä¸€ä¸ªæ˜¥å¤©ï¼ŒèŽ†ç”°ä¹¡ä¸‹çš„èµ¤è„šåŒ»ç”Ÿå´å¤§ç‰›è¢«æ”¹é©çš„æ˜¥é£Žå¹çš„å¿ƒæ½®æ¾Žæ¹ƒï¼Œè¯´å¹²å°±å¹²ï¼Œå´å¤§ç‰›è¶ç€å¤œè‰²æœ¦èƒ§æ‰¾å¤§é˜Ÿæ”¯ä¹¦æ±‡æŠ¥äº†æ±‡æŠ¥æ€æƒ³ï¼Œç¬¬äºŒå¤©å°±æ‰¿åŒ…äº†æ‘å«ç”Ÿå®¤ï¼Œå¼€å¯äº†è‡ªå·±çš„åœ¨åŒ»ç–—åœˆçš„ä¼ å¥‡åŽ†ç¨‹ã€‚ ä¹¡æ‘è¯Šæ‰€å¤§å®¶éƒ½çŸ¥é“ï¼Œæ²¡ä»€ä¹ˆå¤æ‚çš„ä¸œä¸œï¼Œæˆ¿å­åªæœ‰ä¸€é—´ï¼Œä¸€ä¸ªå¤§æŸœå°ä¸­é—´éš”å¼€ï¼Œä¸€åŠæ˜¯è¯Šç–—å…¼å€™è¯ŠåŒºï¼Œä¸€åŠæ˜¯è¯æˆ¿ï¼Œçœ‹ç—…å°±ç›´æŽ¥æ‰¾åŒ»ç”Ÿï¼Œå¦‚æžœå‰é¢æœ‰äººå°±è‡ªå·±æ‰¾ä¸ªä½å­åä¸‹ï¼ŒæŽ’é˜Ÿç­‰ä¸€ä¼šï¼Œç§©åºå€’ä¹Ÿäº•ç„¶ï¼Œçœ‹å®Œç—…äº†åŒ»ç”Ÿç›´æŽ¥ç»™æŠ“è¯ï¼Œç„¶åŽä¸‹ä¸€ä¸ªç»§ç»­ï¼Œä¹Ÿä¸éœ€è¦æŠ¤å£«å’Œè¯å‰‚å¸ˆï¼Œå´å¤§ç‰›ä¸€ä¸ªäººå…¨éƒ¨åŒ…åŠžã€‚ è¾›è¾›è‹¦è‹¦å¿™ç¢Œäº†åå¹´ï¼Œæ—¶é—´æ¥åˆ°äº†å…«ä¹å¹´ï¼Œåˆæ˜¯ä¸€ä¸ªæ˜¥å¤©ï¼Œæ˜”æ—¥çš„å•èº«æ±‰å´å¤§ç‰›å·²æˆä¸ºåé‡Œå…«ä¹¡çš„çŸ¥åäººç‰©ï¼Œåª³å¦‡å¨¶ä¸Šäº†ä¸è¯´ï¼Œå®¶é‡Œè¿˜å¢žåŠ äº†ä¸€å¯¹åŒèƒžèƒŽå„¿å­ï¼ŒäºŒå±‚çš„å°æ´‹æˆ¿ä¹Ÿç”šæ˜¯æ°”æ´¾ã€‚å¯æ˜¯ä¹Ÿæœ‰çƒ¦å¿ƒäº‹ï¼Œå°½ç®¡ä¹¡æ‘è¯Šæ‰€æ‰©å¤§åˆ°äº†ä¸¤é—´ï¼Œåª³å¦‡è¿˜å¶å°”èƒ½åŽ»å¸®å¸®å¿™ï¼Œä½†æ˜¯åŒ»ç”Ÿè¿˜æ˜¯åªæœ‰è‡ªå·±ä¸€ä¸ªï¼Œå¤©å¤©ä»Žæ—©å¿™åˆ°æ™šæŒ£çš„éƒ½æ˜¯ä¸€ä»½é’±ï¼Œæƒ³å¤šæŒ£ç‚¹æ€Žä¹ˆåŠžï¼Ÿå´å¤§ç‰›æ—¥æ€å¤œæƒ³ï¼Œè¿˜çœŸç»™ä»–æƒ³å‡ºæ¥ä¸€æ‹›ï¼Œæ€Žä¹ˆåŠžï¼Œæ‰©å¤§è§„æ¨¡ï¼Œå¤šæ‹›å‡ ä¸ªåŒ»ç”Ÿä¸€èµ·å¹²ã€‚åŽŸæ¥å´å¤§ç‰›åªèƒ½æ²»å¤´ç–¼è„‘çƒ­å’Œè·Œæ‰“æŸä¼¤ï¼ŒçŽ°åœ¨æ–°æ‹›äº†ä¸€ä¸ªåŒ»ç§‘å¤§å­¦çš„æ¯•ä¸šç”Ÿåˆ˜å°æ˜Žä¸“æ²»æ„Ÿå†’å‘çƒ§ï¼Œåˆä»Žé‚»æ‘è¯·æ¥äº†è€å¤§å¤«æŽé˜¿èŠ±ä¸“æ²»å¦‡ç§‘ç—…ï¼ŒçŽ°åœ¨ä¸€ä¸ªæ™®é€šçš„å°è¯Šæ‰€å°±å˜æˆäº†æœ‰ä¸‰ä¸ªç‹¬ç«‹ç§‘å®¤åŠ ä¸€ä¸ªå…¬å…±è¯æˆ¿ï¼ˆå´å¤§ç‰›åª³å¦‡è´Ÿè´£ï¼‰çš„å°åŒ»é™¢äº†ï¼Œå´å¤§ç‰›æ˜¯å¤–ç§‘ä¸»ä»»å…¼é™¢é•¿ï¼Œæ”¶å…¥é‚£å¯æ¯”ä¹‹å‰ç¿»äº†ä¸‰ç•ªã€‚äººé€¢å–œäº‹ç²¾ç¥žçˆ½ï¼Œå¤§ç‰›é™¢é•¿è¯·åŽ¿é‡Œçš„ä¹¦æ³•åå®¶ä¸ºæ–°åŒ»é™¢ä¹¦å†™äº†ç‰ŒåŒ¾â€“â€œåšçˆ±åŒ»é™¢â€ï¼ŒæŒ‘äº†ä¸€ä¸ªé»„é“å‰æ—¥æ­£å¼æŒ‚äº†ä¸ŠåŽ»ã€‚ ä¸€æ™ƒåå¹´è¿‡åŽ»äº†ï¼Œåˆæ˜¯ä¸€ä¸ªæ˜¥å¤©ï¼Œå´å¤§ç‰›çš„åšçˆ±åŒ»é™¢å·²ç»å‘å±•åˆ°äº†å†…ç§‘å¤–ç§‘å¦‡ç§‘äº”å®˜ç§‘éª¨ç§‘ç”Ÿæ®–ç§‘å…­ä¸ªç§‘å®¤ï¼Œæ¯ä¸ªç§‘å®¤3åˆ°5ååŒ»ç”Ÿä¸ç­‰ï¼Œä¹Ÿè€—è´¹å·¨èµ„è´­è¿›äº†è¡€å¤œåŒ–éªŒBè¶…ç­‰å…ˆè¿›ä»ªå™¨ï¼Œå¤§ç‰›é™¢é•¿ä¹Ÿæ—©å·²è„±ç¦»äº†åŒ»ç–—ä¸€çº¿ï¼Œæˆä¸ºäº†ä¸“èŒçš„ç®¡ç†è€…ï¼Œä½†æ˜¯åŒ»é™¢çš„å¤§äº‹å°äº‹å¤§å®¶éƒ½æ‰¾ä»–ï¼Œå°±è¿™ä¸‰åå¤šå·å‘˜å·¥æžçš„ä»–æ¯å¤©æ˜¯ç„¦å¤´çƒ‚é¢ï¼Œæƒ³å†æ‰©å¤§è§„æ¨¡å®žåœ¨æ˜¯æœ‰å¿ƒæ— åŠ›äº†ã€‚è¦è¯´è¿˜æ˜¯å¤§å­¦ç”Ÿæœ‰æ°´å¹³ï¼Œè€éƒ¨ä¸‹åˆ˜å°æ˜Žç»™å¤§ç‰›é™¢é•¿çŒ®äº†ä¸€è®¡ï¼ŒæŠŠå„ä¸ªç§‘å®¤ç‹¬ç«‹å‡ºåŽ»ï¼Œè®©å„ä¸ªç§‘å®¤ä¸»ä»»è‡ªå·±ç®¡ç†ï¼Œå¤§ç‰›é™¢é•¿åªç®¡ç§‘å®¤ä¹‹é—´çš„åè°ƒå’ŒåŒ»é™¢å‘å±•çš„å¤§äº‹ï¼Œè¿™æ ·æ—¢èƒ½è°ƒåŠ¨åŸºå±‚çš„ç§¯æžæ€§ï¼Œåˆèƒ½æŠŠå¤§ç‰›é™¢é•¿è§£æ”¾å‡ºæ¥æ‰©å¤§ç”Ÿäº§æŠ“å¤§äº‹è°‹å¤§äº‹ï¼Œå²‚ä¸å¦™å“‰ï¼Ÿå°±è¿™æ ·ï¼Œåšçˆ±åŒ»é™¢çš„æ–°ä¸€è½®æ”¹é©è½°è½°çƒˆçƒˆçš„å±•å¼€äº†ã€‚ åˆæ˜¯ä¸€ä¸ªåå¹´ï¼Œåˆæ˜¯ä¸€ä¸ªæ˜¥å¤©ï¼Œå¤§ç‰›é™¢é•¿å·²æˆä¸ºæœ¬åœ°çŸ¥åçš„ä¼ä¸šå®¶ï¼Œåšçˆ±åŒ»é™¢ä¹Ÿå‘å±•åˆ°äº†äºŒåä¸‰ä¸ªç§‘å®¤æ•°ç™¾åå‘˜å·¥ï¼Œå‘å±•ä¸­ä¹Ÿå‡ºçŽ°äº†æ–°é—®é¢˜ï¼Œç”±äºŽå„ä¸ªç§‘å®¤ç‹¬ç«‹æŒ‚å·ã€æ”¶è´¹ã€åŒ–éªŒï¼Œæœ‰çš„ç§‘å®¤æ•´å¤©å¿™å¿™ç¢Œç¢Œæ•ˆç›Šå¥½ï¼Œæœ‰çš„ç§‘å®¤å°±ç›¸å¯¹å¹³åº¸äº›ï¼Œè¿žåˆ†åˆ°çš„å„ç§æ£€æŸ¥ä»ªå™¨éƒ½ä¸èƒ½æ»¡è´Ÿè·è¿è¡Œï¼Œæ•´ä¸ªåŒ»é™¢å…»äº†ä¸å°‘é—²äººã€‚è¿™æ—¶å€™å¤§ç‰›é™¢é•¿è§†é‡Žä¹Ÿå¼€é˜”äº†ï¼Œè¯·æ¥äº†ç®¡ç†ä¸“å®¶è¿›è¡Œäº†é¡¶å±‚è®¾è®¡ï¼ŒæŠŠåŽŸæ¥åˆ†æ•£åˆ°å„ä¸ªç§‘å®¤çš„éžæ ¸å¿ƒæœåŠ¡å…¨éƒ¨æ”¶å½’é›†ä¸­ç®¡ç†ï¼ŒæŠŠåŽŸæ¥äºŒåä¸‰ä¸ªæŒ‚å·çª—å£æ•´åˆä¸ºåä¸ªï¼ŒäºŒåä¸‰ä¸ªæ”¶è´¹çª—å£æ•´åˆä¸ºå…«ä¸ªï¼Œé›†ä¸­å¸ƒè®¾åœ¨ä¸€æ¥¼å¤§åŽ…ä¸ºå…¨é™¢æœåŠ¡ï¼Œè¿˜æŠŠåˆ†æ•£åœ¨å„ä¸ªç§‘å®¤çš„æ£€æŸ¥ä»ªå™¨é›†ä¸­èµ·æ¥æˆç«‹ç‹¬ç«‹çš„æ£€éªŒç§‘ï¼Œä¹Ÿä¸ºå…¨é™¢æœåŠ¡ï¼Œè¿™æ ·äººäººæœ‰æ´»å¹²ï¼Œæ•´ä¸ªåŒ»é™¢çš„æœåŠ¡èƒ½åŠ›åˆä¸Šäº†ä¸€ä¸ªæ–°å°é˜¶ï¼Œè¿™è½®æ”¹é©åŽåšçˆ±åŒ»é™¢é€šè¿‡äº†å„çº§éƒ¨é—¨çš„é‰´å®šæˆä¸ºäº†è¿œè¿‘é©°åçš„ä¸‰ç”²åŒ»é™¢ï¼Œå´å¤§ç‰›ä¹Ÿæ¢èº«ä¸€å˜æˆä¸ºäº†åšçˆ±é›†å›¢çš„CEOå…¼è‘£äº‹é•¿ï¼Œä¸‹ä¸€æ­¥å°±å‡†å¤‡IPOä¸Šå¸‚äº†ã€‚ è¯´åˆ°è¿™é‡Œå¤§å®¶å¯èƒ½æœ‰ç‚¹ç³Šæ¶‚ï¼Œè¿™ä¸ªè·Ÿå¾®æœåŠ¡æœ‰å˜›å…³ç³»ï¼Ÿåœ¨å­™è€å¸ˆçœ‹æ¥ï¼Œå¤§ç‰›è¯Šæ‰€çš„1.0é˜¶æ®µå°±ç›¸å½“äºŽè½¯ä»¶å¼€å‘çš„å•ä½“ç»“æž„ï¼Œä¸€ä¸ªç¨‹åºå‘˜æ‰“å¤©ä¸‹ï¼Œä»Žå¤´ç¼–åˆ°å°¾ï¼Œå¾ˆéš¾åšå¤§åšå¼ºã€‚å¤§ç‰›è¯Šæ‰€çš„2.0é˜¶æ®µå°±ç›¸å½“äºŽè½¯ä»¶å¼€å‘çš„åž‚ç›´ç»“æž„ï¼Œå„ç§‘å®¤æŒ‰ç…§ä¸šåŠ¡åˆ’åˆ†ï¼Œå¾ˆå®¹æ˜“æ¨ªå‘æ‰©å±•ã€‚åšçˆ±åŒ»é™¢çš„1.0é˜¶æ®µå°±ç›¸å½“äºŽè½¯ä»¶å¼€å‘çš„SOAç»“æž„ï¼Œé™¤äº†è¯æˆ¿ï¼ˆæ•°æ®åº“ï¼‰å¤–å„ä¸ªæœåŠ¡ç‹¬ç«‹æä¾›ï¼ˆç§‘å®¤ä¸»ä»»è´Ÿè´£ï¼‰ï¼Œä½†éœ€è¦å¤§ç‰›é™¢é•¿ï¼ˆESBæ€»çº¿ï¼‰æ¥åè°ƒã€‚åšçˆ±åŒ»é™¢çš„2.0é˜¶æ®µå°±ç›¸å½“äºŽè½¯ä»¶å¼€å‘çš„å¾®æœåŠ¡ç»“æž„ï¼Œå…¬å…±æœåŠ¡é™¢å†…å…±äº«ï¼Œç§‘å®¤ä¸»ä»»ç®¡ç†åŠŸèƒ½å¼±åŒ–ï¼ˆåªç®¡åŒ»ç”Ÿä¸šåŠ¡ï¼‰ï¼Œä¼˜ç‚¹æ˜¯æ‰©å®¹æ–¹ä¾¿ï¼Œå“ªä¸ªéƒ¨é—¨ç¼ºäººç›´æŽ¥åŠ ï¼Œä¸ç”¨çœ‹ä¸Šä¸‹æ¸¸ï¼Œèµ„æºåˆ©ç”¨çŽ‡é«˜ï¼Œäººå‘˜å’Œè®¾å¤‡æ•ˆçŽ‡é«˜ã€‚ä¸ºä»€ä¹ˆè¦å˜å‘¢ï¼Ÿå°è¯Šæ‰€æœ‰å°è¯Šæ‰€çš„æ´»æ³•ï¼Œå¤§åŒ»é™¢æœ‰å¤§åŒ»é™¢çš„éª„å‚²ã€‚æ— ä»–ï¼Œå¤©ä¸‹ç†™ç†™ï¼Œçš†ä¸ºåˆ©æ¥ï¼›å¤©ä¸‹æ”˜æ”˜ï¼Œçš†ä¸ºåˆ©å¾€ã€‚ è®¾è®¡åŽŸåˆ™ æ‹†åˆ†è¶³å¤Ÿå¾®ï¼šåˆ’åˆ†æ¯”è¾ƒç»†ï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½å¤ªç»†ï¼Œå¢žåŠ ç®¡ç†é—®é¢˜ è½»é‡çº§é€šä¿¡ï¼šrestï¼Œrpcç­‰æ–¹å¼åœ¨ç½‘ç»œä¸Šé€šä¿¡ å•ä¸€èŒè´£åŽŸåˆ™ï¼šé«˜å†…èšï¼Œä½Žè€¦åˆï¼Œç¡®å®šæœåŠ¡è¾¹ç•Œ å¦‚ä½•è®¾è®¡å¾®æœåŠ¡ç³»ç»Ÿ æœåŠ¡æ‹†åˆ†----ã€‹æœåŠ¡æ³¨å†Œ----ã€‹æœåŠ¡å‘çŽ°----ã€‹æœåŠ¡æ¶ˆè´¹(è°ƒç”¨å¦å¤–ä¸€ä¸ªæœåŠ¡)----ã€‹ç»Ÿä¸€å…¥å£(æœåŠ¡å¾ˆå¤šçš„æ—¶å€™éœ€è¦æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£)----ã€‹é…ç½®ç®¡ç†(ç®¡ç†æ¯ä¸ªæœåŠ¡çš„é…ç½®ä¿¡æ¯)----ã€‹ç†”æ–­æœºåˆ¶(ä¿æŠ¤ç³»ç»Ÿé¿å…å´©æºƒ)----ã€‹è‡ªåŠ¨æ‰©å±•(æ ¹æ®è´Ÿè·è‡ªåŠ¨æ‰©å±•é›†ç¾¤) å¾®æœåŠ¡æ‹†åˆ†çš„æ„ä¹‰ æ˜“äºŽå®žçŽ° æ˜“äºŽéƒ¨ç½² æ˜“äºŽç»´æŠ¤ æ˜“äºŽæ›´æ–° æœ¬å¤©æ°”é¢„æŠ¥ç³»ç»Ÿå¯ä»¥æ‹†åˆ†ä¸ºï¼š å¤©æ°”æ•°æ®é‡‡é›†æœåŠ¡ï¼šæ•°æ®é‡‡é›†å’Œæ•°æ®å­˜å‚¨ å¤©æ°”é¢„æŠ¥æœåŠ¡ï¼šæ•°æ®å±•ç¤º å¤©æ°”æ•°æ®APIï¼šæ•°æ®æŸ¥è¯¢ åŸŽå¸‚æ•°æ®APIï¼šæ•°æ®æŸ¥è¯¢]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[4.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å‰ç«¯æ ·å¼]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F4.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E5%89%8D%E7%AB%AF%E6%A0%B7%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬å››ç¯‡æ–‡ç« ï¼Œæ•´ä¸€ä¸ªå‰ç«¯çš„æ¸²æŸ“å¼•æ“Žå¹¶ä¸”ç”¨bootstrapç¾ŽåŒ–ä¸€ä¸‹æ ·å¼ã€‚ Thymeleaf æ•°æ®åŠ¨æ€åœ°æ¸²æŸ“ï¼Œè¿™é‡Œé‡‡ç”¨Thymeleafæ¨¡æ¿å¼•æ“Žã€‚ é¦–å…ˆæ˜¯å¼•å…¥ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;&lt;/dependency&gt; åŽç«¯çš„controllerï¼š 12345678910111213141516171819@RestController@RequestMapping("/report")public class WeatherReportController &#123; @Autowired private IWeatherReportService weatherReportService; @Autowired private ICityDataService cityDataService; @GetMapping("/cityId/&#123;cityId&#125;") public ModelAndView getReportByCityId(@PathVariable("cityId") String cityId, Model model) throws Exception &#123; Weather weather = weatherReportService.getDataByCityId(cityId); model.addAttribute("title","èœ—ç‰›å¤©æ°”é¢„æŠ¥"); model.addAttribute("cityId",cityId); model.addAttribute("cityList",cityDataService.listCity()); model.addAttribute("report",weather); return new ModelAndView("weather/report","reportModel",model); &#125;&#125; å‰ç«¯çš„ç®€å•é¡µé¢ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;!DOCTYPE html&gt;&lt;html lang="zh-CN" xmlns:th="http://www.thymeleaf.org"&gt;&lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;title&gt;èœ—ç‰›å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h3 th:text="$&#123;reportModel.title&#125;"&gt;snail&lt;/h3&gt;&lt;!--ä¸‹æ‹‰æ¡†æ¥é€‰æ‹©åŸŽå¸‚--&gt;&lt;select&gt; &lt;option th:each="city : $&#123;reportModel.cityList&#125;" th:value="$&#123;city.cityId&#125;" th:text="$&#123;city.cityName&#125;" th:selected="$&#123;city.cityId eq reportModel.cityId &#125;"&gt; &lt;/option&gt;&lt;/select&gt;&lt;!--æ˜¾ç¤ºä¸€ä¸‹é€‰æ‹©åŽçš„åŸŽå¸‚çš„åç§°--&gt;&lt;h1 th:text="$&#123;reportModel.report.city&#125;"&gt;åŸŽå¸‚åç§°&lt;/h1&gt;&lt;!--æ˜¾ç¤ºè¿™ä¸ªåŸŽå¸‚çš„ä¸€äº›åŸºæœ¬å¤©æ°”çŠ¶å†µ--&gt;&lt;p&gt; ç©ºæ°”è´¨é‡æŒ‡æ•°ï¼š&lt;span th:text="$&#123;reportModel.report.aqi&#125;"&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt; å½“å‰æ¸©åº¦ï¼š&lt;span th:text="$&#123;reportModel.report.wendu&#125;"&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt; æ¸©é¦¨æç¤ºï¼š&lt;span th:text="$&#123;reportModel.report.ganmao&#125;"&gt;&lt;/span&gt;&lt;/p&gt;&lt;!--æ˜¾ç¤ºæœªæ¥å‡ å¤©çš„å¤©æ°”çŠ¶å†µ--&gt;&lt;div th:each="forecast : $&#123;reportModel.report.forecast&#125;"&gt; &lt;div&gt; &lt;p th:text="$&#123;forecast.date&#125;"&gt;æ—¥æœŸ&lt;/p&gt; &lt;p th:text="$&#123;forecast.type&#125;"&gt;å¤©æ°”ç±»åž‹&lt;/p&gt; &lt;p th:text="$&#123;forecast.high&#125;"&gt;æœ€é«˜æ¸©åº¦&lt;/p&gt; &lt;p th:text="$&#123;forecast.low&#125;"&gt;æœ€ä½Žæ¸©åº¦&lt;/p&gt; &lt;p th:text="$&#123;forecast.fengxiang&#125;"&gt;é£Žå‘&lt;/p&gt; &lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æ³¨æ„ è¿™é‡Œä¿®æ­£ä¸€ä¸‹äº†ä¸€ä¸‹ä¹‹å‰å­˜åœ¨çš„ä¸€ä¸ªå°é”™è¯¯ï¼Œå°±æ˜¯è¯·æ±‚å¤©æ°”çš„æŽ¥å£åº”è¯¥æ˜¯ï¼šhttp://wthrcdn.etouch.cn/weather_mini?citykey=xxx è€Œæˆ‘ä¹‹å‰ç¨‹åºä¸­å†™çš„æ˜¯http://wthrcdn.etouch.cn/weather_mini?cityKey=xxx å°±æ˜¯è¿™ä¸ªcitykeyä¸­çš„kï¼Œåº”è¯¥æ˜¯å°å†™ã€‚å¯¼è‡´è¯·æ±‚ä¸åˆ°æ•°æ®ï¼Œå‰ç«¯ç›´æŽ¥æŠ¥é”™ã€‚ Bootstrap ç¨å¾®ç¾ŽåŒ–ä¸€ä¸‹é¡µé¢ã€‚å¼•å…¥bootstrapã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374&lt;!DOCTYPE html&gt;&lt;html lang="zh-CN" xmlns:th="http://www.thymeleaf.org"&gt;&lt;head&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt; &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous"&gt; &lt;title&gt;èœ—ç‰›å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;div class="container controls-pane"&gt; &lt;div class="row"&gt; &lt;h3 th:text="$&#123;reportModel.title&#125;"&gt;snail&lt;/h3&gt; &lt;select class="custom-select" id="selectCityId"&gt; &lt;option th:each="city : $&#123;reportModel.cityList&#125;" th:value="$&#123;city.cityId&#125;" th:text="$&#123;city.cityName&#125;" th:selected="$&#123;city.cityId eq reportModel.cityId &#125;"&gt; &lt;/option&gt; &lt;/select&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;h1 class="text-success" th:text="$&#123;reportModel.report.city&#125;"&gt;åŸŽå¸‚åç§°&lt;/h1&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;p&gt; ç©ºæ°”è´¨é‡æŒ‡æ•°ï¼š&lt;span th:text="$&#123;reportModel.report.aqi&#125;"&gt;&lt;/span&gt; &lt;/p&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;p&gt; å½“å‰æ¸©åº¦ï¼š&lt;span th:text="$&#123;reportModel.report.wendu&#125;"&gt;&lt;/span&gt; &lt;/p&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;p&gt; æ¸©é¦¨æç¤ºï¼š&lt;span th:text="$&#123;reportModel.report.ganmao&#125;"&gt;&lt;/span&gt; &lt;/p&gt; &lt;/div&gt; &lt;div class="row"&gt; &lt;div class="card border-info" th:each="forecast : $&#123;reportModel.report.forecast&#125;"&gt; &lt;div class="card-body text-info"&gt; &lt;p class="card-text" th:text="$&#123;forecast.date&#125;"&gt;æ—¥æœŸ&lt;/p&gt; &lt;p class="card-text " th:text="$&#123;forecast.type&#125;"&gt;å¤©æ°”ç±»åž‹&lt;/p&gt; &lt;p class="card-text" th:text="$&#123;forecast.high&#125;"&gt;æœ€é«˜æ¸©åº¦&lt;/p&gt; &lt;p class="card-text" th:text="$&#123;forecast.low&#125;"&gt;æœ€ä½Žæ¸©åº¦&lt;/p&gt; &lt;p class="card-text" th:text="$&#123;forecast.fengxiang&#125;"&gt;é£Žå‘&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;!-- jQuery first, then Popper.js, then Bootstrap JS --&gt;&lt;script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"&gt;&lt;/script&gt;&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"&gt;&lt;/script&gt;&lt;script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"&gt;&lt;/script&gt;&lt;!-- Optional JavaScript --&gt;&lt;script type="text/javascript" th:src="@&#123;/js/weather/report.js&#125;"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; å…¶ä¸­ä¸‹æ‹‰æ¡†é€‰ä¸­å‘åŽç«¯è¯·æ±‚æ¯ä¸ªåŸŽå¸‚æ•°æ®çš„jsï¼š 1234567$(function()&#123; $("#selectCityId").change(function()&#123; var cityId = $("#selectCityId").val(); var url = '/report/cityId/'+ cityId; window.location.href = url; &#125;)&#125;); æœ€åŽçš„æ•ˆæžœï¼š]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[3.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å¤©æ°”æ•°æ®åŒæ­¥]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F3.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E5%A4%A9%E6%B0%94%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œç”±äºŽå¤©æ°”ä¿¡æ¯éœ€è¦æ›´æ–°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®šæ—¶å™¨å®šæ—¶åŽ»èŽ·å–ä¸€ä¸‹æœ€æ–°çš„ä¿¡æ¯ã€‚ç”±äºŽæœ¬é¡¹ç›®å®žçŽ°æ¯”è¾ƒç®€å•å°±å¯ä»¥ç”¨quartzæ¥å®žçŽ°ã€‚ quartzå¦‚ä½•æ•´åˆ æ•°æ®éœ€è¦å®šæ—¶åœ°åˆ·æ–°ï¼Œä¸èƒ½ç­‰åˆ°ç”¨æˆ·æ¥èŽ·å–çš„æ—¶å€™æ‰æ›´æ–°ï¼Œè¿™é‡Œç”¨æœ€å¸¸ç”¨çš„quartzå®šæ—¶å™¨æ¥å®žçŽ°ã€‚ é¦–å…ˆæ—¶å¼•å…¥ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt;&lt;/dependency&gt; ä¸‹é¢å®šä¹‰ä¸€ä¸ªæ‰§è¡Œçš„ä»»åŠ¡ï¼Œå…ˆä»€ä¹ˆéƒ½ä¸å¹²ï¼Œå°±æ‰“å°ä¸€å¥è¯å³å¯ï¼š 12345678@Slf4jpublic class WeatherDataSyncJob extends QuartzJobBean &#123; @Override protected void executeInternal(JobExecutionContext context) throws JobExecutionException &#123; log.info("å¤©æ°”æ•°æ®åŒæ­¥ä»»åŠ¡å¼€å§‹"); &#125;&#125; ä¸‹é¢è¦å®šä¹‰é…ç½®ç±»ï¼š é¦–å…ˆæ˜¯è¦å®šä¹‰è¿™ä¸ªä»»åŠ¡çš„ç»†èŠ‚ï¼šJobDetailï¼Œå°±æ˜¯è¯´æˆ‘ä»¬é…ç½®çš„è¿™ä¸ªquartzé‡Œé¢çš„ä»»åŠ¡æ˜¯è°ï¼Ÿç»™ä»–èµ·ä¸ªåå­—å•¥çš„ã€‚ åŽé¢ä¸ªæ˜¯å®šä¹‰è§¦å‘å™¨ï¼Œå†³å®šäº†åˆšæ‰å®šä¹‰çš„è¿™ä¸ªJobDetailå¤šé•¿æ—¶é—´æ‰§è¡Œä¸€æ¬¡ã€‚è¿™é‡Œæ˜¯ä¸ºäº†æ¨¡æ‹Ÿæƒ³è¿‡ï¼Œå®šä¹‰äº†ä¸¤ç§’å°±æ‰§è¡Œä¸€æ¬¡ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯åŠ¨é¡¹ç›®åŽï¼Œçœ‹åˆ°çš„æ•ˆæžœåº”è¯¥æ˜¯æ¯ä¸¤ç§’æ‰“å°ä¸€æ¬¡æ—¥å¿—ã€‚ 1234567891011121314151617181920212223@Configurationpublic class QuartzConfig &#123; //å®šä¹‰ä¸€ä¸ªjobDetail,å°±æ˜¯æ³¨å†Œä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå…·ä½“å¦‚ä½•æ‰§è¡Œæ—¶åœ¨WeatherDataSyncJobä¸­å®šä¹‰ //å…·ä½“ä½•æ—¶æ‰§è¡Œï¼Œæ˜¯ä¸‹é¢çš„Triggerå®šä¹‰ @Bean public JobDetail weatherDataSyncDetail()&#123; return JobBuilder.newJob(WeatherDataSyncJob.class). withIdentity("WeatherDataSyncJob"). storeDurably().build(); &#125; //è§¦å‘å™¨ @Bean public Trigger weatherDataSyncTrigger()&#123; SimpleScheduleBuilder scheduleBuilder = SimpleScheduleBuilder .simpleSchedule() .withIntervalInSeconds(2)//ä¸¤ç§’åŽ»è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ .repeatForever(); return TriggerBuilder.newTrigger().forJob(weatherDataSyncDetail()) .withIdentity("weatherDataSyncTrigger") .withSchedule(scheduleBuilder).build(); &#125;&#125; æ‹‰å–åŸŽå¸‚ä¿¡æ¯ ç½‘ç«™ï¼š http://mobile.weather.com.cn/js/citylist.xml æ¯”å¦‚æˆ‘å°†æ±Ÿè‹çœçš„å•ç‹¬æ‹¿å‡ºæ¥ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182&lt;xml&gt; &lt;c c1="0"&gt; &lt;d d1="101190101" d2="å—äº¬" d3="nanjing" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190102" d2="æº§æ°´" d3="lishui" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190103" d2="é«˜æ·³" d3="gaochun" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190104" d2="æ±Ÿå®" d3="jiangning" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190105" d2="å…­åˆ" d3="luhe" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190106" d2="æ±Ÿæµ¦" d3="jiangpu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190107" d2="æµ¦å£" d3="pukou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190201" d2="æ— é”¡" d3="wuxi" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190202" d2="æ±Ÿé˜´" d3="jiangyin" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190203" d2="å®œå…´" d3="yixing" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190204" d2="é”¡å±±" d3="xishan" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190301" d2="é•‡æ±Ÿ" d3="zhenjiang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190302" d2="ä¸¹é˜³" d3="danyang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190303" d2="æ‰¬ä¸­" d3="yangzhong" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190304" d2="å¥å®¹" d3="jurong" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190305" d2="ä¸¹å¾’" d3="dantu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190401" d2="è‹å·ž" d3="suzhou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190402" d2="å¸¸ç†Ÿ" d3="changshu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190403" d2="å¼ å®¶æ¸¯" d3="zhangjiagang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190404" d2="æ˜†å±±" d3="kunshan" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190405" d2="å´ä¸­" d3="wuzhong" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190407" d2="å´æ±Ÿ" d3="wujiang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190408" d2="å¤ªä»“" d3="taicang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190501" d2="å—é€š" d3="nantong" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190502" d2="æµ·å®‰" d3="haian" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190503" d2="å¦‚çš‹" d3="rugao" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190504" d2="å¦‚ä¸œ" d3="rudong" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190507" d2="å¯ä¸œ" d3="qidong" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190508" d2="æµ·é—¨" d3="haimen" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190509" d2="é€šå·ž" d3="tongzhou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190601" d2="æ‰¬å·ž" d3="yangzhou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190602" d2="å®åº”" d3="baoying" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190603" d2="ä»ªå¾" d3="yizheng" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190604" d2="é«˜é‚®" d3="gaoyou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190605" d2="æ±Ÿéƒ½" d3="jiangdu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190606" d2="é‚—æ±Ÿ" d3="hanjiang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190701" d2="ç›åŸŽ" d3="yancheng" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190702" d2="å“æ°´" d3="xiangshui" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190703" d2="æ»¨æµ·" d3="binhai" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190704" d2="é˜œå®" d3="funing" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190705" d2="å°„é˜³" d3="sheyang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190706" d2="å»ºæ¹–" d3="jianhu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190707" d2="ä¸œå°" d3="dongtai" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190708" d2="å¤§ä¸°" d3="dafeng" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190709" d2="ç›éƒ½" d3="yandu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190801" d2="å¾å·ž" d3="xuzhou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190802" d2="é“œå±±" d3="tongshan" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190803" d2="ä¸°åŽ¿" d3="fengxian" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190804" d2="æ²›åŽ¿" d3="peixian" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190805" d2="é‚³å·ž" d3="pizhou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190806" d2="ç¢å®" d3="suining" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190807" d2="æ–°æ²‚" d3="xinyi" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190901" d2="æ·®å®‰" d3="huaian" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190902" d2="é‡‘æ¹–" d3="jinhu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190903" d2="ç›±çœ™" d3="xuyi" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190904" d2="æ´ªæ³½" d3="hongze" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190905" d2="æ¶Ÿæ°´" d3="lianshui" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190906" d2="æ·®é˜´åŒº" d3="huaiyinqu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101190908" d2="æ·®å®‰åŒº" d3="huaianqu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191001" d2="è¿žäº‘æ¸¯" d3="lianyungang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191002" d2="ä¸œæµ·" d3="donghai" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191003" d2="èµ£æ¦†" d3="ganyu" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191004" d2="çŒäº‘" d3="guanyun" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191005" d2="çŒå—" d3="guannan" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191101" d2="å¸¸å·ž" d3="changzhou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191102" d2="æº§é˜³" d3="liyang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191103" d2="é‡‘å›" d3="jintan" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191104" d2="æ­¦è¿›" d3="wujin" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191201" d2="æ³°å·ž" d3="taizhou" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191202" d2="å…´åŒ–" d3="xinghua" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191203" d2="æ³°å…´" d3="taixing" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191204" d2="å§œå °" d3="jiangyan" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191205" d2="é–æ±Ÿ" d3="jingjiang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191301" d2="å®¿è¿" d3="suqian" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191302" d2="æ²­é˜³" d3="shuyang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191303" d2="æ³—é˜³" d3="siyang" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191304" d2="æ³—æ´ª" d3="sihong" d4="æ±Ÿè‹"/&gt; &lt;d d1="101191305" d2="å®¿è±«" d3="suyu" d4="æ±Ÿè‹"/&gt; &lt;/c&gt;&lt;/xml&gt; å…¶å®žæ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯ä»Žxmlæ–‡ä»¶ä¸­èŽ·å–æ‰€æœ‰çš„åŸŽå¸‚ä¿¡æ¯ï¼Œè½¬æ¢ä¸ºåŸŽå¸‚åˆ—è¡¨å¯¹è±¡ã€‚ç„¶åŽéåŽ†åŸŽå¸‚ä¸­çš„idï¼Œå°±å¯ä»¥æ ¹æ®idæ‹¼æŽ¥urlåŽ»ç›´æŽ¥åŽ»è°ƒç”¨å¤©æ°”çš„æŽ¥å£åŽ»æŸ¥è¯¢å¤©æ°”ï¼Œç„¶åŽé‡æ–°è¦†ç›–redisä¸­çš„å¤©æ°”æ•°æ®å³å¯ã€‚ 12345678910111213141516171819202122232425262728@Slf4jpublic class WeatherDataSyncJob extends QuartzJobBean &#123; @Autowired private IWeatherDataService weatherDataService; @Autowired private ICityDataService cityDataService; @Override protected void executeInternal(JobExecutionContext context) throws JobExecutionException &#123; log.info("å¤©æ°”æ•°æ®åŒæ­¥ä»»åŠ¡å¼€å§‹"); //èŽ·å–åŸŽå¸‚åˆ—è¡¨ List&lt;City&gt; cityList = null; try &#123; cityList = cityDataService.listCity(); &#125; catch (Exception e) &#123; log.error("èŽ·å–åŸŽå¸‚åˆ—è¡¨å¤±è´¥ï¼",e); &#125; //éåŽ†åŸŽå¸‚idèŽ·å–å¤©æ°” for(City city:cityList)&#123; String cityId = city.getCityId(); log.info("å®šæ—¶å™¨æ›´æ–°äº†&#123;&#125;è¿™ä¸ªåŸŽå¸‚çš„å¤©æ°”ä¿¡æ¯", city.getCityName()); weatherDataService.syncDataByCityId(cityId); &#125; log.info("å¤©æ°”æ•°æ®åŒæ­¥ä»»åŠ¡ç»“æŸ"); &#125;&#125; å…·ä½“å¦‚ä½•è¯»å–xmlæ–‡ä»¶ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950@Service@Slf4jpublic class CityDataServiceImpl implements ICityDataService &#123; @Override public List&lt;City&gt; listCity() throws Exception &#123; //è¯»å–xmlæ–‡ä»¶ Resource resource = new ClassPathResource("citylist.xml"); //è¯»å–æ–‡ä»¶çš„bufferæµ BufferedReader bf = new BufferedReader(new InputStreamReader(resource.getInputStream(),"UTF-8")); StringBuffer buffer = new StringBuffer(); String line = ""; while((line = bf.readLine()) != null)&#123; buffer.append(line); &#125; //æ­¤æ—¶æ•°æ®å·²ç»è¯»åˆ°bufferé‡Œäº† bf.close(); //xmlè½¬æ¢ä¸ºjavaå¯¹è±¡ CityList cityList = (CityList) XmlBuilder.xmlStrToObj(CityList.class,buffer.toString()); return cityList.getCityList(); &#125;&#125;/** * @Author ã€swgã€‘. * @Date 2018/11/19 17:09 * @DESC xmlè½¬æ¢ä¸ºå¯¹è±¡ * @CONTACT 317758022@qq.com */public class XmlBuilder &#123; public static Object xmlStrToObj(Class&lt;?&gt; clazz,String xmlStr) throws Exception&#123; Object xmlObject = null; Reader reader = null; JAXBContext context = JAXBContext.newInstance(clazz); //xmlè½¬ä¸ºå¯¹è±¡çš„æŽ¥å£ Unmarshaller unmarshaller = context.createUnmarshaller(); reader = new StringReader(xmlStr); xmlObject = unmarshaller.unmarshal(reader); if(null != reader)&#123; reader.close(); &#125; return xmlObject; &#125;&#125; å…¶ä¸­ï¼Œè§£æžxmlæˆ‘ä»¬ç”¨åˆ°äº†JAXBï¼Œä»–æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç»´åŸºç™¾ç§‘ï¼š JAXBï¼ˆJava Architecture for XML Bindingç®€ç§°JAXBï¼‰å…è®¸Javaå¼€å‘äººå‘˜å°†Javaç±»æ˜ å°„ä¸ºXMLè¡¨ç¤ºæ–¹å¼ã€‚JAXBæä¾›ä¸¤ç§ä¸»è¦ç‰¹æ€§ï¼šå°†ä¸€ä¸ªJavaå¯¹è±¡åºåˆ—åŒ–ä¸ºXMLï¼Œä»¥åŠåå‘æ“ä½œï¼Œå°†XMLè§£æžæˆJavaå¯¹è±¡ã€‚æ¢å¥è¯è¯´ï¼ŒJAXBå…è®¸ä»¥XMLæ ¼å¼å­˜å‚¨å’Œè¯»å–æ•°æ®ï¼Œè€Œä¸éœ€è¦ç¨‹åºçš„ç±»ç»“æž„å®žçŽ°ç‰¹å®šçš„è¯»å–XMLå’Œä¿å­˜XMLçš„ä»£ç ã€‚]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-redisæå‡æ€§èƒ½]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F2.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-redis%E6%8F%90%E5%8D%87%E6%80%A7%E8%83%BD%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å­¦ä¹ çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªå…è´¹çš„æŽ¥å£èƒ½æ‰¿å—çš„å¹¶å‘æ˜¯å¾ˆä½Žçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æœåŠ¡å™¨ä½œä¸ºä¸€ä¸ªä¸­è½¬ç«™åŽ»å‘è¿™ä¸ªæŽ¥å£è¯·æ±‚æ•°æ®ä¹Ÿéžå¸¸åœ°è€—æ—¶ï¼ŒäºŽæ€§èƒ½å’Œç¨³å®šæ€§éƒ½æ²¡æœ‰ä¿éšœï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦redisä½œä¸ºç¼“å­˜æ¥æé«˜æ€§èƒ½ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ç”¨redisæ¥é‡æž„ä¸€ä¸‹ã€‚ å…ˆå¼•å…¥ä¸€ä¸‹ä¾èµ–ï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt; æ€è·¯å¾ˆç®€å•ï¼šç¼“å­˜ä¸­æœ‰æ•°æ®çš„æ—¶å€™ï¼Œå°±ç›´æŽ¥ä»Žç¼“å­˜ä¸­æ‹¿å³å¯ï¼Œè‹¥ç¼“å­˜ä¸­æ²¡æœ‰æ­¤æ•°æ®ï¼Œå°±åŽ»è°ƒç”¨æŽ¥å£é‡æ–°èŽ·å–å¹¶ä¸”å†å­˜åˆ°ç¼“å­˜ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839private static final long TIME_OUT = 30*60L;private WeatherResponse doGetWeather(String uri)&#123; //å…ˆåŽ»ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œæœ‰å°±ç›´æŽ¥æ‹¿ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œå¦åˆ™è°ƒç”¨æŽ¥å£ String key = uri; String strBody = null; WeatherResponse resp = null; ObjectMapper mapper = new ObjectMapper(); ValueOperations&lt;String,String&gt; ops = stringRedisTemplate.opsForValue(); if(stringRedisTemplate.hasKey(uri))&#123; //ç¼“å­˜æœ‰æ•°æ® log.info("Redis has data!"); strBody = ops.get(key); &#125;else&#123; //ç¼“å­˜æ²¡æœ‰æ•°æ® log.info("Redis don't thas data!"); ResponseEntity&lt;String&gt; resString = restTemplate.getForEntity(uri,String.class); if(resString.getStatusCodeValue() == 200) &#123; strBody = resString.getBody(); &#125; //æ•°æ®å†™å…¥ç¼“å­˜ ops.set(key,strBody,TIME_OUT, TimeUnit.SECONDS); &#125; try &#123; resp = mapper.readValue(strBody,WeatherResponse.class); &#125;catch (IOException e)&#123; log.error("Error!",e); &#125; return resp;&#125; ä¸€å¼€å§‹å¯ä»¥å°†è¿‡æœŸæ—¶é—´ç¼©çŸ­ä¸€ç‚¹ï¼Œè¿™é‡Œredisç›´æŽ¥å¯åŠ¨å³å¯ï¼Œé»˜è®¤ç«¯å£æ˜¯6379.]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[1.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-ç®€å•æŽ¥å£è°ƒç”¨]]></title>
    <url>%2F2019%2F02%2F21%2Fweather-for-spring-cloud%2F1.%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5%E7%B3%BB%E7%BB%9F-%E7%AE%80%E5%8D%95%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%2F</url>
    <content type="text"><![CDATA[æ…•è¯¾ç½‘çš„è¯¾ç¨‹ã€Šä»Žå¤©æ°”é¡¹ç›®çœ‹ Spring Cloud å¾®æœåŠ¡æ²»ç†ã€‹åº”è¯¥æ˜¯å…¥é—¨spring cloudå¾®æœåŠ¡æœ€ç®€å•çš„å®žæˆ˜è§†é¢‘äº†ã€‚è¿™æ˜¯å­¦ä¹ çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œå› ä¸ºä¸šåŠ¡å¾ˆç®€å•ï¼Œå°±æ˜¯èŽ·å–å¤©æ°”å¹¶ä¸”å±•ç¤ºå‡ºæ¥ï¼Œæœ¬èŠ‚è¯´æ˜Žä¸€ä¸‹å¦‚ä½•èŽ·å–å¤©æ°”ä¿¡æ¯ã€‚ä»£ç è¯¦è§å°¾éƒ¨ï¼Œæœ¬ç³»åˆ—æ‰€æœ‰ä»£ç éƒ½åˆ†ç±»ä¿å­˜å†githubä¸Šäº†ã€‚ ä¸€ã€èŽ·å–å¤©æ°”ä¿¡æ¯ æ•°æ®æ¥æºï¼š http://wthrcdn.etouch.cn/weather_mini?citykey=xxx æˆ–è€… http://wthrcdn.etouch.cn/weather_mini?city=xxx é¦–å…ˆæˆ‘ä»¬å¦‚ä½•åšä¸€ä¸ªæŸ¥è¯¢å¤©æ°”çš„æŽ¥å£å‘¢ï¼Ÿå…¶å®žç‰¹åˆ«ç®€å•ï¼Œå°±æ˜¯ç”¨HttpClientè¿™ä¸ªå®¢æˆ·ç«¯æ¥è°ƒç”¨ä»¥ä¸Šçš„æŽ¥å£ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ•°æ®äº†ã€‚ æˆ‘ä»¬æ‰€éœ€è¦åšçš„å·¥ä½œä¹Ÿéžå¸¸å°‘ï¼Œå°±æ˜¯å°è£…ä¸€ä¸‹æ•°æ®ï¼Œè¯·æ±‚ä¸€ä¸‹å‚æ•°å³å¯ã€‚ è¯·æ±‚çš„æ•°æ®æ˜¯jsonï¼Œæˆ‘ä»¬è¿™é‡Œå‡†å¤‡å¥½æ•°æ®beanå³å¯ï¼š 123456789101112131415161718192021222324252627282930313233343536@Datapublic class WeatherResponse implements Serializable &#123; private Weather data; private Integer status; private String desc;&#125;@Datapublic class Weather implements Serializable &#123; private String city; private String aqi; private List&lt;Forecast&gt; forecast; private String ganmao; private String wendu; private Yesterday yesterday;&#125;@Datapublic class Forecast implements Serializable &#123; private String date; private String high; private String fengli; private String low; private String fengxiang; private String type;&#125;@Datapublic class Yesterday implements Serializable&#123; private String date; private String high; private String fx; private String low; private String fl; private String type;&#125; okï¼Œæ•°æ®è½½ä½“å·²ç»å¥½äº†ï¼Œä¸‹é¢å°±æ˜¯ç”¨RestTemplateè°ƒç”¨urlå–èŽ·å–å¤©æ°”ä¿¡æ¯ï¼Œç”¨ä¸Šé¢çš„beanæ¥å°è£…ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041@Servicepublic class WeatherDataServiceImpl implements IWeatherDataService &#123; @Autowired private RestTemplate restTemplate; //ç»Ÿä¸€æŽ¥å£å‰ç¼€ private static final String WEATHER_URI = "http://wthrcdn.etouch.cn/weather_mini?"; @Override public WeatherResponse getDataByCityId(String cityId) &#123; String uri = WEATHER_URI + "citykey="+cityId; return doGetWeather(uri); &#125; @Override public WeatherResponse getDataByCityName(String cityName) &#123; String uri = WEATHER_URI + "city="+cityName; return doGetWeather(uri); &#125; //æ ¹æ®å‚æ•°èŽ·å–å¤©æ°”æ•°æ® private WeatherResponse doGetWeather(String uri)&#123; ResponseEntity&lt;String&gt; resString = restTemplate.getForEntity(uri,String.class); ObjectMapper mapper = new ObjectMapper(); WeatherResponse resp = null; String strBody = null; if(resString.getStatusCodeValue() == 200)&#123; strBody = resString.getBody(); &#125; try &#123; resp = mapper.readValue(strBody,WeatherResponse.class); &#125;catch (IOException e)&#123; e.printStackTrace(); &#125; return resp; &#125;&#125; æœ€åŽå†ç”¨ä¸€ä¸ªcontrolleræ¥ç»™ä¸€ä¸ªæŽ¥å£å³å¯ã€‚ äºŒã€æ³¨æ„ ç›´æŽ¥å¯åŠ¨é¡¹ç›®ä¼šæŠ¥é”™ï¼š 123456789101112131415161718Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.2018-11-19 15:19:54.732 ERROR 13924 --- [ main] o.s.b.d.LoggingFailureAnalysisReporter : ***************************APPLICATION FAILED TO START***************************Description:Field restTemplate in com.swg.weatherbasic.service.impl.WeatherDataServiceImpl required a bean of type 'org.springframework.web.client.RestTemplate' that could not be found.The injection point has the following annotations: - @org.springframework.beans.factory.annotation.Autowired(required=true)Action:Consider defining a bean of type 'org.springframework.web.client.RestTemplate' in your configuration. æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æç¤ºä¿¡æ¯æ˜¯ï¼š'org.springframework.web.client.RestTemplate' that could not be found.,é”™è¯¯å°±å¾ˆæ˜Žæ˜¾äº†ï¼Œè¿™ä¸ªçŽ©æ„æ ¹æœ¬å°±æ²¡æœ‰åœ¨springä¸­æ³¨å†Œï¼Œæ€Žä¹ˆå¯ä»¥æ³¨å…¥å‘¢? æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å‘springæ³¨å†Œä¸€ä¸‹è¿™ä¸ªbeanï¼š 12345678910@Configurationpublic class RestConfig &#123; @Autowired private RestTemplateBuilder builder; @Bean public RestTemplate restTemplate()&#123; return builder.build(); &#125;&#125; ä¸‰ã€å½©è›‹ å°†æ­¤å°é¡¹ç›®ä½œä¸ºä¸€ä¸ªå°ç‰ˆæœ¬ï¼Œç›´æŽ¥ä¿å­˜åˆ°ç äº‘ä¸Šã€‚å¦‚ä½•åšå‘¢ï¼Ÿ å…¶å®žå¾ˆç®€å•ï¼Œå…ˆåŽ»ç äº‘ä¸Šæ–°å»ºä¸€ä¸ªé¡¹ç›®ã€‚ç„¶åŽåœ¨æœ¬åœ°æŸä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ 1git clone xxx ç„¶åŽå°†æˆ‘ä»¬çš„é¡¹ç›®ç›´æŽ¥æ‹·è´åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚æ‰§è¡Œ 123git add .git commit -am &apos;weather-basic&apos;git push origin master è¿™æ ·å°±å¯ä»¥äº†ã€‚ ä»£ç åœ°å€ï¼šspring-cloud-weather-action----01 ä¸‹é¢ç« èŠ‚çš„ä»£ç ä¾æ¬¡ç±»æŽ¨ï¼Œå¯èƒ½å°±ä¸å†èµ˜è¿°äº†ã€‚æœ¬é¡¹ç›®çš„springbootç‰ˆæœ¬æ˜¯2.1.0.RELEASEï¼Œspring cloudç”¨çš„æ˜¯Finchley.RELEASEç‰ˆæœ¬ã€‚]]></content>
      <tags>
        <tag>å¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹ThreadLocalè‡ªé—®è‡ªç­”]]></title>
    <url>%2F2019%2F02%2F20%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8BThreadLocal%E8%87%AA%E9%97%AE%E8%87%AA%E7%AD%94%2F</url>
    <content type="text"><![CDATA[ä»¥é—®ç­”çš„å½¢å¼åŠ æ·±å¯¹threadlocalçš„ç†è§£ï¼Œåšåˆ°é¢è¯•çš„é•‡å®šè‡ªè‹¥ã€‚ é—®é¢˜1ï¼šThreadLocaläº†è§£å—ï¼Ÿæ‚¨èƒ½ç»™æˆ‘è¯´è¯´ä»–çš„ä¸»è¦ç”¨é€”å—ï¼Ÿ å®˜æ–¹å®šä½ï¼šThreadLocalç±»ç”¨æ¥æä¾›çº¿ç¨‹å†…éƒ¨çš„å±€éƒ¨å˜é‡ã€‚è¿™ç§å˜é‡åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹è®¿é—®ï¼ˆé€šè¿‡getå’Œsetæ–¹æ³•è®¿é—®ï¼‰æ—¶èƒ½ä¿è¯å„ä¸ªçº¿ç¨‹çš„å˜é‡ç›¸å¯¹ç‹¬ç«‹äºŽå…¶ä»–çº¿ç¨‹å†…çš„å˜é‡ã€‚ ç®€å•å½’çº³å°±æ˜¯ï¼š ThreadLocalçš„ä½œç”¨æ˜¯æä¾›çº¿ç¨‹å†…çš„å±€éƒ¨å˜é‡ è¿™ç§å˜é‡åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…èµ·ä½œç”¨ ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰° é—®é¢˜2ï¼šThreadLocalå®žçŽ°åŽŸç†æ˜¯ä»€ä¹ˆï¼Œå®ƒæ˜¯æ€Žä¹ˆæ ·åšåˆ°å±€éƒ¨å˜é‡ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°çš„ï¼Ÿ é€šå¸¸ï¼Œå¦‚æžœæˆ‘ä¸åŽ»çœ‹æºä»£ç çš„è¯ï¼Œæˆ‘çŒœThreadLocalæ˜¯è¿™æ ·å­è®¾è®¡çš„ï¼šæ¯ä¸ªThreadLocalç±»éƒ½åˆ›å»ºä¸€ä¸ªMapï¼Œç„¶åŽç”¨çº¿ç¨‹çš„ID threadIDä½œä¸ºMapçš„keyï¼Œè¦å­˜å‚¨çš„å±€éƒ¨å˜é‡ä½œä¸ºMapçš„valueï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°å„ä¸ªçº¿ç¨‹çš„å€¼éš”ç¦»çš„æ•ˆæžœã€‚è¿™æ˜¯æœ€ç®€å•çš„è®¾è®¡æ–¹æ³•ï¼ŒJDKæœ€æ—©æœŸçš„ThreadLocalå°±æ˜¯è¿™æ ·è®¾è®¡çš„ã€‚ ä½†æ˜¯ï¼ŒJDKåŽé¢ä¼˜åŒ–äº†è®¾è®¡æ–¹æ¡ˆï¼ŒçŽ°æ—¶JDK8 ThreadLocalçš„è®¾è®¡æ˜¯ï¼šæ¯ä¸ªThreadç»´æŠ¤ä¸€ä¸ªThreadLocalMapå“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªå“ˆå¸Œè¡¨çš„keyæ˜¯ThreadLocalå®žä¾‹æœ¬èº«ï¼Œvalueæ‰æ˜¯çœŸæ­£è¦å­˜å‚¨çš„å€¼Objectã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç”¨ä¸Šé¢ä¸ªè®¾è®¡å‘¢ï¼Ÿå¤šç®€å•å•Šï¼ å¦‚æžœç”¨Mapæ¥åšçš„è¯ï¼Œåªèƒ½æ˜¯ç”¨thread+threadlocalè®¡ç®—å‡ºæ¥ä½œä¸ºkeyï¼Œæ¯•ç«Ÿæˆ‘å­˜çš„ä¸ä¸€å®šåªæœ‰ä¸€ä¸ªå˜é‡ã€‚é‚£ä¹ˆä¸ç”¨ä»–çš„æ—¶å€™ï¼Œå¦‚ä½•æ¸…ç†å‘¢ï¼Ÿåªèƒ½æ˜¯æ‰‹åŠ¨removeæŽ‰ï¼Œä½†æ˜¯ä¸€æ–¹é¢å¾ˆéº»çƒ¦ï¼Œå¦ä¸€æ–¹é¢ä»£ç å¾ˆä¸‘é™‹ï¼Œæœ€åŽä¸€æ–¹é¢æ˜¯åœ¨removeçš„æ—¶å€™çªç„¶å‡ºçŽ°é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚ æ–°çš„è®¾è®¡çš„å¥½å¤„ï¼š å½“Threadé”€æ¯ä¹‹åŽï¼Œå¯¹åº”çš„ThreadLocalMapä¹Ÿä¼šéšä¹‹é”€æ¯ï¼Œèƒ½å‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚ å‡è®¾å½“å‰threadä¸€ç›´æ´»ç€ï¼ˆæ¯”å¦‚èµ–åœ¨çº¿ç¨‹æ± ä¸­ï¼‰ï¼Œæœ‰äº›æ— ç”¨çš„threadlocalå¯¹è±¡æ€Žä¹ˆæ¸…ç†å‘¢ï¼Ÿ keyæ˜¯ä¸€ä¸ªè½¯å¼•ç”¨æŒ‡å‘ThreadLocalå®žä¾‹ï¼Œç‰¹æ€§æ˜¯ä¸‹ä¸€æ¬¡gcçš„æ—¶å€™å°±ä¼šè¢«å›žæ”¶æŽ‰äº†ï¼ŒThreadLocalMapä¸­å°±ä¼šå‡ºçŽ°keyä¸ºnullçš„Entry. keyå›žæ”¶æŽ‰äº†ï¼Œvalueå€¼è¿˜åœ¨å•Šï¼Œè¿™ä¸ªæ€Žä¹ˆå›žæ”¶ï¼ï¼ï¼ ThreadLocalçš„getå’Œsetæ–¹æ³•æ¯æ¬¡è°ƒç”¨æ—¶ï¼Œå¦‚æžœå‘çŽ°å½“å‰çš„entryçš„keyä¸ºnullï¼ˆä¹Ÿå°±æ˜¯è¢«å›žæ”¶æŽ‰äº†ï¼‰ï¼Œæœ€ç»ˆä¼šè°ƒç”¨expungeStaleEntry(int staleSlot)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæŠŠå“ˆå¸Œè¡¨å½“å‰ä½ç½®çš„æ— ç”¨æ•°æ®æ¸…ç†æŽ‰ï¼ˆå½“ç„¶è¿˜æœ‰åˆ«çš„æ“ä½œï¼‰ã€‚ ä½†æ˜¯æœ€ä½³å®žè·µè¿˜æ˜¯æ¯æ¬¡ä½¿ç”¨å®ŒThreadLocalï¼Œéƒ½è°ƒç”¨å®ƒçš„remove()æ–¹æ³•ï¼Œæ¸…é™¤æ•°æ®,ç¡®ä¿ä¸ä¼šå‡ºçŽ°å†…å­˜æ³„æ¼é—®é¢˜ã€‚ é—®é¢˜3ï¼šæ‚¨èƒ½è¯´è¯´ThreadLocalå¸¸ç”¨æ“ä½œçš„åº•å±‚å®žçŽ°åŽŸç†å—ï¼Ÿå¦‚å­˜å‚¨set(T value)ï¼ŒèŽ·å–get()ï¼Œåˆ é™¤remove()ç­‰æ“ä½œã€‚ å…·ä½“çš„ä»£ç å°±ä¸è´´äº†ï¼Œæ ¸å¿ƒä»£ç éƒ½å·²ç»çœ‹è¿‡äº†ã€‚è¿™é‡Œç®€å•æ€»ç»“ä¸€ä¸‹ã€‚ è°ƒç”¨get() èŽ·å–å½“å‰çº¿ç¨‹Threadå¯¹è±¡ï¼Œè¿›è€ŒèŽ·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡ã€‚ åˆ¤æ–­å½“å‰çš„ThreadLocalMapæ˜¯å¦å­˜åœ¨,å¦‚æžœå­˜åœ¨ï¼Œåˆ™ä»¥å½“å‰çš„ThreadLocal ä¸º keyï¼Œè°ƒç”¨ThreadLocalMapä¸­çš„getEntryæ–¹æ³•èŽ·å–å¯¹åº”çš„å­˜å‚¨å®žä½“ eã€‚æ‰¾åˆ°å¯¹åº”çš„å­˜å‚¨å®žä½“ eï¼ŒèŽ·å–å­˜å‚¨å®žä½“ e å¯¹åº”çš„ valueå€¼ï¼Œå³ä¸ºæˆ‘ä»¬æƒ³è¦çš„å½“å‰çº¿ç¨‹å¯¹åº”æ­¤ThreadLocalçš„å€¼ï¼Œè¿”å›žç»“æžœå€¼ã€‚ å¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™è¯æ˜Žæ­¤çº¿ç¨‹æ²¡æœ‰ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡ï¼Œè°ƒç”¨setInitialValueæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚è¿”å›žsetInitialValueåˆå§‹åŒ–çš„å€¼ã€‚ è°ƒç”¨set(T value) èŽ·å–å½“å‰çº¿ç¨‹Threadå¯¹è±¡ï¼Œè¿›è€ŒèŽ·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡ã€‚ åˆ¤æ–­å½“å‰çš„ThreadLocalMapæ˜¯å¦å­˜åœ¨ï¼š å¦‚æžœå­˜åœ¨ï¼Œåˆ™è°ƒç”¨map.setè®¾ç½®æ­¤å®žä½“entryã€‚ å¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨createMapè¿›è¡ŒThreadLocalMapå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œå¹¶å°†æ­¤å®žä½“entryä½œä¸ºç¬¬ä¸€ä¸ªå€¼å­˜æ”¾è‡³ThreadLocalMapä¸­ã€‚ è°ƒç”¨remove() èŽ·å–å½“å‰çº¿ç¨‹Threadå¯¹è±¡ï¼Œè¿›è€ŒèŽ·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡ã€‚ åˆ¤æ–­å½“å‰çš„ThreadLocalMapæ˜¯å¦å­˜åœ¨ï¼Œ å¦‚æžœå­˜åœ¨ï¼Œåˆ™è°ƒç”¨map.removeï¼Œä»¥å½“å‰ThreadLocalä¸ºkeyåˆ é™¤å¯¹åº”çš„å®žä½“entryã€‚ é—®é¢˜4ï¼šå¯¹ThreadLocalçš„å¸¸ç”¨æ“ä½œå®žé™…æ˜¯å¯¹çº¿ç¨‹Threadä¸­çš„ThreadLocalMapè¿›è¡Œæ“ä½œï¼Œæ ¸å¿ƒæ˜¯ThreadLocalMapè¿™ä¸ªå“ˆå¸Œè¡¨ï¼Œä½ èƒ½è°ˆè°ˆThreadLocalMapçš„å†…éƒ¨åº•å±‚å®žçŽ°å—? ThreadLocalMapçš„åº•å±‚å®žçŽ°æ˜¯ä¸€ä¸ªå®šåˆ¶çš„è‡ªå®šä¹‰HashMapå“ˆå¸Œè¡¨ï¼Œæ ¸å¿ƒç»„æˆå…ƒç´ æœ‰ï¼š Entry[] tableï¼šåº•å±‚å“ˆå¸Œè¡¨ table,å¿…è¦æ—¶éœ€è¦è¿›è¡Œæ‰©å®¹ï¼Œåº•å±‚å“ˆå¸Œè¡¨ table.length é•¿åº¦å¿…é¡»æ˜¯2çš„næ¬¡æ–¹ã€‚ int sizeï¼šå®žé™…å­˜å‚¨é”®å€¼å¯¹å…ƒç´ ä¸ªæ•° entries int thresholdï¼šä¸‹ä¸€æ¬¡æ‰©å®¹æ—¶çš„é˜ˆå€¼ï¼Œé˜ˆå€¼ threshold = len(table) * 2 / 3ã€‚å½“ size &gt;= threshold æ—¶ï¼ŒéåŽ†tableå¹¶åˆ é™¤keyä¸ºnullçš„å…ƒç´ ï¼Œå¦‚æžœåˆ é™¤åŽsize &gt;= threshold*3/4æ—¶ï¼Œéœ€è¦å¯¹tableè¿›è¡Œæ‰©å®¹ å…¶ä¸­Entry[] tableå“ˆå¸Œè¡¨å­˜å‚¨çš„æ ¸å¿ƒå…ƒç´ æ˜¯Entryï¼ŒEntryåŒ…å«ï¼š ThreadLocal&lt;?&gt; kï¼šå½“å‰å­˜å‚¨çš„ThreadLocalå®žä¾‹å¯¹è±¡ Object valueï¼šå½“å‰ ThreadLocal å¯¹åº”å‚¨å­˜çš„å€¼value éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤Entryç»§æ‰¿äº†å¼±å¼•ç”¨ WeakReferenceï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ThreadLocalMapæ—¶ï¼Œå‘çŽ°key == nullï¼Œåˆ™æ„å‘³ç€æ­¤key ThreadLocalä¸åœ¨è¢«å¼•ç”¨ï¼Œéœ€è¦å°†å…¶ä»ŽThreadLocalMapå“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚ é—®é¢˜5ï¼šThreadLocalMapä¸­çš„å­˜å‚¨å®žä½“Entryä½¿ç”¨ThreadLocalä½œä¸ºkeyï¼Œä½†è¿™ä¸ªEntryæ˜¯ç»§æ‰¿å¼±å¼•ç”¨WeakReferenceçš„ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Œä½¿ç”¨äº†å¼±å¼•ç”¨WeakReferenceä¼šé€ æˆå†…å­˜æ³„éœ²é—®é¢˜å—ï¼Ÿ å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« ã€‚ é—®é¢˜6ï¼šThreadLocalå’Œsynchronizedçš„åŒºåˆ«? ThreadLocalå’Œsynchronizedå…³é”®å­—éƒ½ç”¨äºŽå¤„ç†å¤šçº¿ç¨‹å¹¶å‘è®¿é—®å˜é‡çš„é—®é¢˜ï¼Œåªæ˜¯äºŒè€…å¤„ç†é—®é¢˜çš„è§’åº¦å’Œæ€è·¯ä¸åŒã€‚ ThreadLocalæ˜¯ä¸€ä¸ªJavaç±»,é€šè¿‡å¯¹å½“å‰çº¿ç¨‹ä¸­çš„å±€éƒ¨å˜é‡çš„æ“ä½œæ¥è§£å†³ä¸åŒçº¿ç¨‹çš„å˜é‡è®¿é—®çš„å†²çªé—®é¢˜ã€‚æ‰€ä»¥ï¼ŒThreadLocalæä¾›äº†çº¿ç¨‹å®‰å…¨çš„å…±äº«å¯¹è±¡æœºåˆ¶ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰å…¶å‰¯æœ¬ã€‚ Javaä¸­çš„synchronizedæ˜¯ä¸€ä¸ªä¿ç•™å­—ï¼Œå®ƒä¾é JVMçš„é”æœºåˆ¶æ¥å®žçŽ°ä¸´ç•ŒåŒºçš„å‡½æ•°æˆ–è€…å˜é‡çš„è®¿é—®ä¸­çš„åŽŸå­æ€§ã€‚åœ¨åŒæ­¥æœºåˆ¶ä¸­ï¼Œé€šè¿‡å¯¹è±¡çš„é”æœºåˆ¶ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å˜é‡ã€‚æ­¤æ—¶ï¼Œè¢«ç”¨ä½œâ€œé”æœºåˆ¶â€çš„å˜é‡æ—¶å¤šä¸ªçº¿ç¨‹å…±äº«çš„ã€‚ åŒæ­¥æœºåˆ¶(synchronizedå…³é”®å­—)é‡‡ç”¨äº†ä»¥â€œæ—¶é—´æ¢ç©ºé—´â€çš„æ–¹å¼ï¼Œæä¾›ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æŽ’é˜Ÿè®¿é—®ã€‚è€ŒThreadLocalé‡‡ç”¨äº†â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›ä¸€ä»½å˜é‡çš„å‰¯æœ¬ï¼Œä»Žè€Œå®žçŽ°åŒæ—¶è®¿é—®è€Œäº’ä¸å½±å“. é—®é¢˜7ï¼šThreadLocalåœ¨çŽ°æ—¶æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ æ€»çš„æ¥è¯´ThreadLocalä¸»è¦æ˜¯è§£å†³2ç§ç±»åž‹çš„é—®é¢˜ï¼š è§£å†³å¹¶å‘é—®é¢˜ï¼šä½¿ç”¨ThreadLocalä»£æ›¿synchronizedæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åŒæ­¥æœºåˆ¶é‡‡ç”¨äº†â€œä»¥æ—¶é—´æ¢ç©ºé—´â€çš„æ–¹å¼ï¼Œè€ŒThreadLocalé‡‡ç”¨äº†â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ã€‚å‰è€…ä»…æä¾›ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æŽ’é˜Ÿè®¿é—®ï¼Œè€ŒåŽè€…ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä»½å˜é‡ï¼Œå› æ­¤å¯ä»¥åŒæ—¶è®¿é—®è€Œäº’ä¸å½±å“ã€‚ è§£å†³æ•°æ®å­˜å‚¨é—®é¢˜ï¼šThreadLocalä¸ºå˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½åˆ›å»ºäº†ä¸€ä¸ªå‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è‡ªå·±å†…éƒ¨çš„å‰¯æœ¬å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚å¦‚ä¸€ä¸ªParameterå¯¹è±¡çš„æ•°æ®éœ€è¦åœ¨å¤šä¸ªæ¨¡å—ä¸­ä½¿ç”¨ï¼Œå¦‚æžœé‡‡ç”¨å‚æ•°ä¼ é€’çš„æ–¹å¼ï¼Œæ˜¾ç„¶ä¼šå¢žåŠ æ¨¡å—ä¹‹é—´çš„è€¦åˆæ€§ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ThreadLocalè§£å†³ã€‚ ä¸€èˆ¬çš„Webåº”ç”¨åˆ’åˆ†ä¸ºå±•çŽ°å±‚ã€æœåŠ¡å±‚å’ŒæŒä¹…å±‚ä¸‰ä¸ªå±‚æ¬¡ï¼Œåœ¨ä¸åŒçš„å±‚ä¸­ç¼–å†™å¯¹åº”çš„é€»è¾‘ï¼Œä¸‹å±‚é€šè¿‡æŽ¥å£å‘ä¸Šå±‚å¼€æ”¾åŠŸèƒ½è°ƒç”¨ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»ŽæŽ¥æ”¶è¯·æ±‚åˆ°è¿”å›žå“åº”æ‰€ç»è¿‡çš„æ‰€æœ‰ç¨‹åºè°ƒç”¨éƒ½åŒå±žäºŽä¸€ä¸ªçº¿ç¨‹ThreadLocalæ˜¯è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸€ä¸ªå¾ˆå¥½çš„æ€è·¯ï¼Œå®ƒé€šè¿‡ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä¸ªç‹¬ç«‹çš„å˜é‡å‰¯æœ¬è§£å†³äº†å˜é‡å¹¶å‘è®¿é—®çš„å†²çªé—®é¢˜ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒThreadLocalæ¯”ç›´æŽ¥ä½¿ç”¨synchronizedåŒæ­¥æœºåˆ¶è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜æ›´ç®€å•ï¼Œæ›´æ–¹ä¾¿ï¼Œä¸”ç»“æžœç¨‹åºæ‹¥æœ‰æ›´é«˜çš„å¹¶å‘æ€§ã€‚ æ€»ç»“ ThreadLocalæä¾›çº¿ç¨‹å†…éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œåœ¨æœ¬çº¿ç¨‹å†…éšæ—¶éšåœ°å¯å–ï¼Œéš”ç¦»å…¶ä»–çº¿ç¨‹ã€‚ ThreadLocalçš„è®¾è®¡æ˜¯ï¼šæ¯ä¸ªThreadç»´æŠ¤ä¸€ä¸ªThreadLocalMapå“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªå“ˆå¸Œè¡¨çš„keyæ˜¯ThreadLocalå®žä¾‹æœ¬èº«ï¼Œvalueæ‰æ˜¯çœŸæ­£è¦å­˜å‚¨çš„å€¼Objectã€‚ å¯¹ThreadLocalçš„å¸¸ç”¨æ“ä½œå®žé™…æ˜¯å¯¹çº¿ç¨‹Threadä¸­çš„ThreadLocalMapè¿›è¡Œæ“ä½œã€‚ ThreadLocalMapçš„åº•å±‚å®žçŽ°æ˜¯ä¸€ä¸ªå®šåˆ¶çš„è‡ªå®šä¹‰å“ˆå¸Œè¡¨ï¼ŒThreadLocalMapçš„é˜ˆå€¼threshold = åº•å±‚å“ˆå¸Œè¡¨tableçš„é•¿åº¦ len * 2 / 3ï¼Œå½“å®žé™…å­˜å‚¨å…ƒç´ ä¸ªæ•°size å¤§äºŽæˆ–ç­‰äºŽ é˜ˆå€¼thresholdçš„ 3/4 æ—¶size &gt;= threshold*3/4ï¼Œåˆ™å¯¹åº•å±‚å“ˆå¸Œè¡¨æ•°ç»„tableè¿›è¡Œæ‰©å®¹æ“ä½œã€‚ ThreadLocalMapä¸­çš„å“ˆå¸Œè¡¨Entry[] tableå­˜å‚¨çš„æ ¸å¿ƒå…ƒç´ æ˜¯Entryï¼Œå­˜å‚¨çš„keyæ˜¯ThreadLocalå®žä¾‹å¯¹è±¡ï¼Œvalueæ˜¯ThreadLocal å¯¹åº”å‚¨å­˜çš„å€¼valueã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤Entryç»§æ‰¿äº†å¼±å¼•ç”¨ WeakReferenceï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ThreadLocalMapæ—¶ï¼Œå‘çŽ°key == nullï¼Œåˆ™æ„å‘³ç€æ­¤key ThreadLocalä¸åœ¨è¢«å¼•ç”¨ï¼Œéœ€è¦å°†å…¶ä»ŽThreadLocalMapå“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚ ThreadLocalMapä½¿ç”¨ThreadLocalçš„å¼±å¼•ç”¨ä½œä¸ºkeyï¼Œå¦‚æžœä¸€ä¸ªThreadLocalæ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨æ¥å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆç³»ç»Ÿ GC çš„æ—¶å€™ï¼Œè¿™ä¸ªThreadLocalåŠ¿å¿…ä¼šè¢«å›žæ”¶ã€‚æ‰€ä»¥ï¼Œåœ¨ThreadLocalçš„get(),set(),remove()çš„æ—¶å€™éƒ½ä¼šæ¸…é™¤çº¿ç¨‹ThreadLocalMapé‡Œæ‰€æœ‰keyä¸ºnullçš„valueã€‚å¦‚æžœæˆ‘ä»¬ä¸ä¸»åŠ¨è°ƒç”¨ä¸Šè¿°æ“ä½œï¼Œåˆ™ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ ä¸ºäº†å®‰å…¨åœ°ä½¿ç”¨ThreadLocalï¼Œå¿…é¡»è¦åƒæ¯æ¬¡ä½¿ç”¨å®Œé”å°±è§£é”ä¸€æ ·ï¼Œåœ¨æ¯æ¬¡ä½¿ç”¨å®ŒThreadLocalåŽéƒ½è¦è°ƒç”¨remove()æ¥æ¸…ç†æ— ç”¨çš„Entryã€‚è¿™åœ¨æ“ä½œåœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶å°¤ä¸ºé‡è¦ã€‚ ThreadLocalå’Œsynchronizedçš„åŒºåˆ«ï¼šåŒæ­¥æœºåˆ¶(synchronizedå…³é”®å­—)é‡‡ç”¨äº†ä»¥â€œæ—¶é—´æ¢ç©ºé—´â€çš„æ–¹å¼ï¼Œæä¾›ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æŽ’é˜Ÿè®¿é—®ã€‚è€ŒThreadLocalé‡‡ç”¨äº†â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›ä¸€ä»½å˜é‡çš„å‰¯æœ¬ï¼Œä»Žè€Œå®žçŽ°åŒæ—¶è®¿é—®è€Œäº’ä¸å½±å“ã€‚ ThreadLocalä¸»è¦æ˜¯è§£å†³2ç§ç±»åž‹çš„é—®é¢˜ï¼šA. è§£å†³å¹¶å‘é—®é¢˜ï¼šä½¿ç”¨ThreadLocalä»£æ›¿åŒæ­¥æœºåˆ¶è§£å†³å¹¶å‘é—®é¢˜ã€‚B. è§£å†³æ•°æ®å­˜å‚¨é—®é¢˜ï¼šå¦‚ä¸€ä¸ªParameterå¯¹è±¡çš„æ•°æ®éœ€è¦åœ¨å¤šä¸ªæ¨¡å—ä¸­ä½¿ç”¨ï¼Œå¦‚æžœé‡‡ç”¨å‚æ•°ä¼ é€’çš„æ–¹å¼ï¼Œæ˜¾ç„¶ä¼šå¢žåŠ æ¨¡å—ä¹‹é—´çš„è€¦åˆæ€§ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ThreadLocalè§£å†³ã€‚]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹ThreadLocalå†…å­˜æ³„æ¼é—®é¢˜]]></title>
    <url>%2F2019%2F02%2F20%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8BThreadLocal%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[ThreadLocalæ˜¯é¢è¯•é‡ç¾åŒºï¼Œåˆ†ä¸ºä¸¤ç¯‡æ¥è®²è§£å…¶ä¸­çš„ç”¨æ³•å’ŒåŽŸç†ã€‚è¿™æ˜¯ç¬¬äºŒç¯‡ã€‚ ä¸€ã€å‰è¨€ ThreadLocal çš„ä½œç”¨æ˜¯æä¾›çº¿ç¨‹å†…çš„å±€éƒ¨å˜é‡ï¼Œè¿™ç§å˜é‡åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…èµ·ä½œç”¨ï¼Œå‡å°‘åŒä¸€ä¸ªçº¿ç¨‹å†…å¤šä¸ªå‡½æ•°æˆ–è€…ç»„ä»¶ä¹‹é—´ä¸€äº›å…¬å…±å˜é‡çš„ä¼ é€’çš„å¤æ‚åº¦ã€‚ä½†æ˜¯å¦‚æžœæ»¥ç”¨ ThreadLocalï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å›´ç»•ä¸‰ä¸ªæ–¹é¢æ¥åˆ†æž ThreadLocal å†…å­˜æ³„æ¼çš„é—®é¢˜: ThreadLocal å®žçŽ°åŽŸç† ThreadLocalä¸ºä»€ä¹ˆä¼šå†…å­˜æ³„æ¼ ThreadLocal æœ€ä½³å®žè·µ äºŒã€ThreadLocal å®žçŽ°åŽŸç† è¿™éƒ¨åˆ†å†…å®¹ä¸Šä¸€ç¯‡å·²ç»è¯¦ç»†è®²è§£å®Œæ¯•ï¼Œè¿™é‡Œè°¨ä½œä¸ºä¸€ä¸ªå›žé¡¾æˆ–è€…æ€»ç»“å§ï¼ ThreadLocalçš„å®žçŽ°æ˜¯è¿™æ ·çš„ï¼šæ¯ä¸ªThread ç»´æŠ¤ä¸€ä¸ª ThreadLocalMap æ˜ å°„è¡¨ï¼Œè¿™ä¸ªæ˜ å°„è¡¨çš„ key æŒ‡å‘ ThreadLocal å®žä¾‹æœ¬èº«ï¼Œvalue æŒ‡å‘çœŸæ­£éœ€è¦å­˜å‚¨çš„ Objectï¼Œè¿™ä¸ªå€¼çœŸå®žä¿å­˜åœ¨çº¿ç¨‹å®žä¾‹ä¸Šçš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ ThreadLocal æœ¬èº«å¹¶ä¸å­˜å‚¨å€¼ï¼Œå®ƒåªæ˜¯ä½œä¸ºä¸€ä¸ª key æ¥è®©çº¿ç¨‹ä»Ž ThreadLocalMap èŽ·å– valueã€‚å€¼å¾—æ³¨æ„çš„æ˜¯å›¾ä¸­çš„è™šçº¿ï¼Œè¡¨ç¤º ThreadLocalMap æ˜¯ä½¿ç”¨ ThreadLocal çš„å¼±å¼•ç”¨ä½œä¸º Key çš„ï¼Œå¼±å¼•ç”¨çš„å¯¹è±¡åœ¨ GC æ—¶ä¼šè¢«å›žæ”¶ã€‚ è¿™é‡Œä¸€å®šè¦æ³¨æ„ï¼ŒThreadLocal æœ¬èº«å¹¶ä¸å­˜å‚¨å€¼ï¼Œå®ƒåªæ˜¯ä½œä¸ºä¸€ä¸ª key æ¥è®©çº¿ç¨‹ä»Ž ThreadLocalMap èŽ·å– valueã€‚æˆ‘ä»¬ä»Žgetå’Œsetä»£ç ä¸­å¯ä»¥çœ‹åˆ°ThreadLocalMapçš„keyæ˜¯ThreadLocal å®žä¾‹æœ¬èº«ã€‚ ä¸‰ã€ThreadLocalä¸ºä»€ä¹ˆä¼šå†…å­˜æ³„æ¼ ThreadLocalMapä½¿ç”¨ThreadLocalçš„å¼±å¼•ç”¨ä½œä¸ºkey,å¦‚æžœä¸€ä¸ªThreadLocalæ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨æ¥å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆç³»ç»Ÿ GC çš„æ—¶å€™ï¼Œè¿™ä¸ªThreadLocalåŠ¿å¿…ä¼šè¢«å›žæ”¶ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒThreadLocalMapä¸­å°±ä¼šå‡ºçŽ°keyä¸ºnullçš„Entryï¼Œå°±æ²¡æœ‰åŠžæ³•è®¿é—®è¿™äº›keyä¸ºnullçš„Entryçš„valueï¼Œå¦‚æžœå½“å‰çº¿ç¨‹å†è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯ï¼Œè¿™äº›keyä¸ºnullçš„Entryçš„valueå°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼ºå¼•ç”¨é“¾ï¼šThread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; valueæ°¸è¿œæ— æ³•å›žæ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚ å…¶å®žï¼ŒThreadLocalMapçš„è®¾è®¡ä¸­å·²ç»è€ƒè™‘åˆ°è¿™ç§æƒ…å†µï¼Œä¹ŸåŠ ä¸Šäº†ä¸€äº›é˜²æŠ¤æŽªæ–½ï¼šåœ¨ThreadLocalçš„get(),set(),remove()çš„æ—¶å€™éƒ½ä¼šæ¸…é™¤çº¿ç¨‹ThreadLocalMapé‡Œæ‰€æœ‰keyä¸ºnullçš„valueã€‚ ä½†æ˜¯è¿™äº›è¢«åŠ¨çš„é¢„é˜²æŽªæ–½å¹¶ä¸èƒ½ä¿è¯ä¸ä¼šå†…å­˜æ³„æ¼ï¼š ä½¿ç”¨staticçš„ThreadLocalï¼Œå»¶é•¿äº†ThreadLocalçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯èƒ½å¯¼è‡´çš„å†…å­˜æ³„æ¼ åˆ†é…ä½¿ç”¨äº†ThreadLocalåˆä¸å†è°ƒç”¨get(),set(),remove()æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ å››ã€ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨ ä»Žè¡¨é¢ä¸Šçœ‹å†…å­˜æ³„æ¼çš„æ ¹æºåœ¨äºŽä½¿ç”¨äº†å¼±å¼•ç”¨ã€‚ç½‘ä¸Šçš„æ–‡ç« å¤§å¤šç€é‡åˆ†æžThreadLocalä½¿ç”¨äº†å¼±å¼•ç”¨ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œä½†æ˜¯å¦ä¸€ä¸ªé—®é¢˜ä¹ŸåŒæ ·å€¼å¾—æ€è€ƒï¼šä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨è€Œä¸æ˜¯å¼ºå¼•ç”¨ï¼Ÿ key ä½¿ç”¨å¼ºå¼•ç”¨ï¼šå¼•ç”¨çš„ThreadLocalçš„å¯¹è±¡è¢«å›žæ”¶äº†ï¼Œä½†æ˜¯ThreadLocalMapè¿˜æŒæœ‰ThreadLocalçš„å¼ºå¼•ç”¨ï¼Œå¦‚æžœæ²¡æœ‰æ‰‹åŠ¨åˆ é™¤ï¼ŒThreadLocalä¸ä¼šè¢«å›žæ”¶ï¼Œå¯¼è‡´Entryå†…å­˜æ³„æ¼ã€‚ key ä½¿ç”¨å¼±å¼•ç”¨ï¼šå¼•ç”¨çš„ThreadLocalçš„å¯¹è±¡è¢«å›žæ”¶äº†ï¼Œç”±äºŽThreadLocalMapæŒæœ‰ThreadLocalçš„å¼±å¼•ç”¨ï¼Œå³ä½¿æ²¡æœ‰æ‰‹åŠ¨åˆ é™¤ï¼ŒThreadLocalä¹Ÿä¼šè¢«å›žæ”¶ã€‚valueåœ¨ä¸‹ä¸€æ¬¡ThreadLocalMapè°ƒç”¨set,getï¼Œremoveçš„æ—¶å€™ä¼šè¢«æ¸…é™¤ã€‚ æ¯”è¾ƒä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼šç”±äºŽThreadLocalMapçš„ç”Ÿå‘½å‘¨æœŸè·ŸThreadä¸€æ ·é•¿ï¼Œå¦‚æžœéƒ½æ²¡æœ‰æ‰‹åŠ¨åˆ é™¤å¯¹åº”keyï¼Œéƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œä½†æ˜¯ä½¿ç”¨å¼±å¼•ç”¨å¯ä»¥å¤šä¸€å±‚ä¿éšœï¼šå¼±å¼•ç”¨ThreadLocalä¸ä¼šå†…å­˜æ³„æ¼ï¼Œå¯¹åº”çš„valueåœ¨ä¸‹ä¸€æ¬¡ThreadLocalMapè°ƒç”¨set,get,removeçš„æ—¶å€™ä¼šè¢«æ¸…é™¤ã€‚ å› æ­¤ï¼ŒThreadLocalå†…å­˜æ³„æ¼çš„æ ¹æºæ˜¯ï¼šç”±äºŽThreadLocalMapçš„ç”Ÿå‘½å‘¨æœŸè·ŸThreadä¸€æ ·é•¿ï¼Œå¦‚æžœæ²¡æœ‰æ‰‹åŠ¨åˆ é™¤å¯¹åº”keyå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œè€Œä¸æ˜¯å› ä¸ºå¼±å¼•ç”¨ã€‚ äº”ã€ThreadLocal æœ€ä½³å®žè·µ ç»¼åˆä¸Šé¢çš„åˆ†æžï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ThreadLocalå†…å­˜æ³„æ¼çš„å‰å› åŽæžœï¼Œé‚£ä¹ˆæ€Žä¹ˆé¿å…å†…å­˜æ³„æ¼å‘¢ï¼Ÿ æ¯æ¬¡ä½¿ç”¨å®ŒThreadLocalï¼Œéƒ½è°ƒç”¨å®ƒçš„remove()æ–¹æ³•ï¼Œæ¸…é™¤æ•°æ®ã€‚ åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åŠæ—¶æ¸…ç†ThreadLocalï¼Œä¸ä»…æ˜¯å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œæ›´ä¸¥é‡çš„æ˜¯å¯èƒ½å¯¼è‡´ä¸šåŠ¡é€»è¾‘å‡ºçŽ°é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨ThreadLocalå°±è·ŸåŠ é”å®Œè¦è§£é”ä¸€æ ·ï¼Œç”¨å®Œå°±æ¸…ç†ã€‚ æ•´ç†è‡ªï¼š æ·±å…¥åˆ†æž ThreadLocal å†…å­˜æ³„æ¼é—®é¢˜]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹ThreadLocalè¯¦è§£]]></title>
    <url>%2F2019%2F02%2F20%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8BThreadLocal%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[ThreadLocalæ˜¯é¢è¯•é‡ç¾åŒºï¼Œä½†æ˜¯å¥½åƒæˆ‘æ²¡é‡åˆ°è¿‡æœ‰äººé—®ï¼Œå°´å°¬è„¸ï¼Œä¸è¿‡æˆ‘ä»¬ä¸èƒ½åšç §æ¿ä¸Šçš„é±¼è‚‰é™é™ç­‰å¾…å®°å‰²ï¼Œåˆ†ä¸ºä¸¤ç¯‡æ¥è®²è§£å…¶ä¸­çš„ç”¨æ³•å’ŒåŽŸç†ã€‚è¿™æ˜¯ç¬¬ä¸€ç¯‡ã€‚ ä¸€ã€ThreadLocalç®€ä»‹ ThreadLocalç±»ç”¨æ¥æä¾›çº¿ç¨‹å†…éƒ¨çš„å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹è®¿é—®(é€šè¿‡getæˆ–setæ–¹æ³•è®¿é—®)æ—¶èƒ½ä¿è¯å„ä¸ªçº¿ç¨‹é‡Œçš„å˜é‡ç›¸å¯¹ç‹¬ç«‹äºŽå…¶ä»–çº¿ç¨‹å†…çš„å˜é‡ï¼ŒThreadLocalå®žä¾‹é€šå¸¸æ¥è¯´éƒ½æ˜¯private staticç±»åž‹ã€‚ ThreadLocalç±»æä¾›äº†å››ä¸ªå¯¹å¤–å¼€æ”¾çš„æŽ¥å£æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ç”¨æˆ·æ“ä½œThreadLocalç±»çš„åŸºæœ¬æ–¹æ³•ï¼š void set(Object value)è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ã€‚ public Object get()è¯¥æ–¹æ³•è¿”å›žå½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚ public void remove()å°†å½“å‰çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼åˆ é™¤ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘å†…å­˜çš„å ç”¨ï¼Œè¯¥æ–¹æ³•æ˜¯JDK 5.0æ–°å¢žçš„æ–¹æ³•ã€‚éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå½“çº¿ç¨‹ç»“æŸåŽï¼Œå¯¹åº”è¯¥çº¿ç¨‹çš„å±€éƒ¨å˜é‡å°†è‡ªåŠ¨è¢«åžƒåœ¾å›žæ”¶ï¼Œæ‰€ä»¥æ˜¾å¼è°ƒç”¨è¯¥æ–¹æ³•æ¸…é™¤çº¿ç¨‹çš„å±€éƒ¨å˜é‡å¹¶ä¸æ˜¯å¿…é¡»çš„æ“ä½œï¼Œä½†å®ƒå¯ä»¥åŠ å¿«å†…å­˜å›žæ”¶çš„é€Ÿåº¦ã€‚ protected Object initialValue()è¿”å›žè¯¥çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼ï¼Œè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªprotectedçš„æ–¹æ³•ï¼Œæ˜¾ç„¶æ˜¯ä¸ºäº†è®©å­ç±»è¦†ç›–è€Œè®¾è®¡çš„ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå»¶è¿Ÿè°ƒç”¨æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹ç¬¬1æ¬¡è°ƒç”¨get()æˆ–set(Object)æ—¶æ‰æ‰§è¡Œï¼Œå¹¶ä¸”ä»…æ‰§è¡Œ1æ¬¡ï¼ŒThreadLocalä¸­çš„ç¼ºçœå®žçŽ°ç›´æŽ¥è¿”å›žä¸€ä¸ªnullã€‚ ä¸€ä¸ªç®€å•çš„å°ä¾‹å­æ¥æ„Ÿå—ThreadLocalåˆ°åº•æ˜¯ä»€ä¹ˆä»¥åŠæ€Žä¹ˆç”¨ï¼š è¿è¡Œç»“æžœï¼š 1234567Thread-0å¼ ä¸‰æŽå››çŽ‹äº”Thread-1ChineseEnglish åˆ†æž å¯ä»¥ï¼Œçœ‹å‡ºè™½ç„¶å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯ç”±äºŽthreadLocalå˜é‡ç”±ThreadLocal ä¿®é¥°ï¼Œåˆ™ä¸åŒçš„çº¿ç¨‹è®¿é—®çš„å°±æ˜¯è¯¥çº¿ç¨‹è®¾ç½®çš„å€¼ï¼Œè¿™é‡Œä¹Ÿå°±ä½“çŽ°å‡ºæ¥ThreadLocalçš„ä½œç”¨ã€‚ å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶ï¼ŒThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚ äºŒã€æ‰’å¼€JDK threadlocalç¥žç§˜é¢çº± threadlocalçš„åŽŸç†å›¾ä¸ºï¼š é‚£ThreadLocalå†…éƒ¨æ˜¯å¦‚ä½•ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤å˜é‡å‰¯æœ¬çš„å‘¢ï¼Ÿåˆ°åº•æ˜¯ä»€ä¹ˆåŽŸç†å‘¢ï¼Ÿ å…ˆæ¥çœ‹ä¸€ä¸‹ThreadLocalçš„set()æ–¹æ³•çš„æºç æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼š æˆ‘ä»¬çœ‹åˆ°ï¼Œé¦–å…ˆé€šè¿‡getMap(Thread t)æ–¹æ³•èŽ·å–ä¸€ä¸ªå’Œå½“å‰çº¿ç¨‹ç›¸å…³çš„ThreadLocalMapï¼Œç„¶åŽå°†å˜é‡çš„å€¼è®¾ç½®åˆ°è¿™ä¸ªThreadLocalMapå¯¹è±¡ä¸­ï¼Œå½“ç„¶å¦‚æžœèŽ·å–åˆ°çš„ThreadLocalMapå¯¹è±¡ä¸ºç©ºï¼Œå°±é€šè¿‡createMapæ–¹æ³•åˆ›å»ºã€‚ æˆ‘ä»¬å†å¾€ä¸‹é¢åŽ»ä¸€ç‚¹ï¼Œæ¯”å¦‚map.setæ–¹æ³•åˆ°åº•æ˜¯æ€Žä¹ˆå®žçŽ°çš„ï¼Ÿ ç»“åˆä¸Šé¢çš„å›¾ï¼Œå…¶å®žæˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼Œæ•°æ®å¹¶ä¸æ˜¯æ”¾åœ¨æ‰€è°“çš„Mapé›†åˆä¸­ï¼Œè€Œæ˜¯æ”¾è¿›äº†ä¸€ä¸ªEntryæ•°ç»„ä¸­ï¼Œè¿™ä¸ªentryç´¢å¼•æ˜¯ä¸Šé¢è®¡ç®—å¥½çš„ï¼Œentryçš„keyæ˜¯æŒ‡å‘threadLocalçš„ä¸€ä¸ªè½¯å¼•ç”¨ï¼Œvalueæ˜¯æŒ‡å‘çœŸå®žæ•°æ®çš„ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œä»¥åŽå†èŽ·å–çš„æ—¶å€™ï¼Œå†ä»¥åŒæ ·çš„æ–¹å¼è®¡ç®—å¾—åˆ°ç´¢å¼•ä¸‹æ ‡å³å¯ã€‚ ä¸Šé¢ä»£ç å‡ºçŽ°çš„ ThreadLocalMap æ˜¯ä»€ä¹ˆï¼Ÿ ThreadLocalMapæ˜¯ThreadLocalç±»çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå®ƒå®žçŽ°äº†é”®å€¼å¯¹çš„è®¾ç½®å’ŒèŽ·å–ï¼ˆå¯¹æ¯”Mapå¯¹è±¡æ¥ç†è§£ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ThreadLocalMapå‰¯æœ¬ï¼Œå®ƒæ‰€å­˜å‚¨çš„å€¼ï¼Œåªèƒ½è¢«å½“å‰çº¿ç¨‹è¯»å–å’Œä¿®æ”¹ã€‚ æˆ‘ä»¬æ·±å…¥çœ‹ä¸€ä¸‹getMapå’ŒcreateMapçš„å®žçŽ° getMap: createMap: ä»£ç éžå¸¸ç›´ç™½ï¼Œå°±æ˜¯èŽ·å–å’Œè®¾ç½®Threadå†…çš„ä¸€ä¸ªå«threadLocalsçš„å˜é‡ï¼Œè€Œè¿™ä¸ªå˜é‡çš„ç±»åž‹å°±æ˜¯ThreadLocalMapï¼Œè¿™æ ·è¿›ä¸€æ­¥éªŒè¯äº†ä¸Šæ–‡ä¸­çš„è§‚ç‚¹ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ThreadLocalMapå¯¹è±¡ã€‚ Threadæºç ä¸­çš„threadLocalsï¼š æˆ‘ä»¬æŽ¥ç€çœ‹ThreadLocalä¸­çš„getæ–¹æ³•å¦‚ä¸‹ ç¬¬ä¸€æ­¥ å…ˆèŽ·é€šè¿‡Thread.currentThreadï¼ˆï¼‰å–å½“å‰çº¿ç¨‹ ç¬¬äºŒæ­¥ ç„¶åŽèŽ·å–å½“å‰çº¿ç¨‹çš„threadLocalså±žæ€§ ç¬¬ä¸‰æ­¥ åœ¨threadLocalså±žæ€§é‡ŒèŽ·å–Entryå®žä¾‹ ç¬¬å››éƒ¨ ä»ŽEntryå®žä¾‹çš„valueå±žæ€§é‡ŒèŽ·å–åˆ°æœ€åŽæ‰€è¦çš„Objectå¯¹è±¡ æŽ¥ä¸‹æ¥è®¨è®ºä¸€ä¸‹ä¸Šé¢å‡ºçŽ°çš„ThreadLocalMapç±»ä»¥åŠEntryç±»ï¼Œç›´æŽ¥è´´æºç  Entryæ˜¯ThreadLocalMapçš„å†…éƒ¨ç±»ï¼Œè€Œä¸”ThreadLocalMapé‡Œæ‹¥æœ‰ä¸€ä¸ªç±»åž‹ä¸ºEntry[]çš„tableå±žæ€§ï¼Œè€Œä¸”æ¯ä¸ªçº¿ç¨‹å®žä¾‹æœ‰è‡ªå·±çš„ThreadLocalMapã€‚åˆ°è¿™é‡Œç»“è®ºå·²ç»å¾ˆæ˜Žæ˜¾äº†ï¼šè´Ÿè´£ä¿å­˜ThreadLocalçš„keyå’Œvalueæ ¹æœ¬å°±ä¸æ˜¯ä¸€ä¸ªMapç±»åž‹ï¼Œè€Œæ˜¯ä¸€ä¸ªEntryæ•°ç»„! Entryç»§æ‰¿WeakReferenceï¼Œå› æ­¤ç»§æ‰¿æ‹¥æœ‰ä¸€ä¸ªå¼±å¼•ç”¨referentï¼Œè€Œä¸”è‡ªèº«ä¹Ÿæœ‰ä¸€ä¸ªvalueå±žæ€§ã€‚Entryåˆ©ç”¨referentæ¥ä¿å­˜threadLocalå®žä¾‹çš„å¼±å¼•ç”¨ï¼Œåˆ©ç”¨valueä¿å­˜Objectçš„å¼ºå¼•ç”¨ã€‚è‡³äºŽä¸ºä»€ä¹ˆä¸€ä¸ªæ˜¯å¼ºå¼•ç”¨ï¼Œä¸€ä¸ªæ˜¯å¼±å¼•ç”¨ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€ç¯‡ä¸­æ¥æŽ¢è®¨ã€‚ æœ€åŽçš„é—®é¢˜æ˜¯æ€Žæ ·åœ¨Entryæ•°ç»„é‡Œå®šä½æˆ‘ä»¬éœ€è¦çš„Entryå‘¢?å…¶å®žä¸Šé¢åœ¨setçš„æ—¶å€™å·²ç»å¤§æ¦‚çŸ¥é“äº†ï¼ŒçŽ°åœ¨å†æ¥çœ‹çœ‹ä»£ç å§ï¼š ç•™æ„key.threadLocalHashCodeè¿™ä¸ªå±žæ€§ï¼ŒEntryåœ¨ä¿å­˜è¿›Entry[]æ•°ç»„ä¹‹å‰ï¼Œä¼šåˆ©ç”¨ThreadLocalçš„å¼•ç”¨è®¡ç®—å‡ºä¸€ä¸ªhashå€¼ï¼Œç„¶åŽåˆ©ç”¨è¿™ä¸ªhashå€¼ä½œä¸ºä¸‹æ ‡å®šä½åˆ°Entry[]æ•°ç»„çš„æŸä¸ªä½ç½®ï¼› åŽŸç†æ€»ç»“ï¼šThreadLocalç±»å¹¶æ²¡æœ‰ä¸€ä¸ªMapæ¥ä¿å­˜æ•°æ®ï¼Œæ•°æ®éƒ½æ˜¯ä¿å­˜åœ¨çº¿ç¨‹å®žä¾‹ä¸Šçš„ï¼›å®¢æˆ·ç«¯è®¿é—®ThreadLocalå®žä¾‹çš„getæ–¹æ³•ï¼Œgetæ–¹æ³•é€šè¿‡Thread.getCurrentThreadèŽ·å¾—å½“å‰çº¿ç¨‹çš„å®žä¾‹ï¼Œä»Žè€ŒèŽ·å¾—å½“å‰çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡ï¼Œè€ŒThreadLocalMapé‡ŒåŒ…å«äº†ä¸€ä¸ªEntryæ•°ç»„ï¼Œé‡Œé¢çš„æ¯ä¸ªEntryä¿å­˜äº†ThreadLocalå¼•ç”¨ä»¥åŠObjectå¼•ç”¨ï¼ŒEntryçš„referentä¿å­˜ThreadLocalçš„å¼±å¼•ç”¨ï¼ŒEntryçš„valueä¿å­˜Objectçš„å¼ºå¼•ç”¨ã€‚ ä¸‰ã€threadLocaåº”ç”¨ threadlocalå®žçŽ°çš„å¯å¤ç”¨çš„è€—æ—¶ç»Ÿè®¡å·¥å…·Profiler è¿è¡Œç»“æžœï¼š 12Thread-0è€—æ—¶ï¼š 1000Thread-1è€—æ—¶ï¼š 1999 threadLocalå®žçŽ°æ•°æ®åº“è¿žæŽ¥çº¿ç¨‹éš”ç¦» é€šè¿‡è°ƒç”¨ConnectionManager.getConnection()æ–¹æ³•ï¼Œæ¯ä¸ªçº¿ç¨‹èŽ·å–åˆ°çš„ï¼Œéƒ½æ˜¯å’Œå½“å‰çº¿ç¨‹ç»‘å®šçš„é‚£ä¸ªConnectionå¯¹è±¡ï¼Œç¬¬ä¸€æ¬¡èŽ·å–æ—¶ï¼Œæ˜¯é€šè¿‡initialValue()æ–¹æ³•çš„è¿”å›žå€¼æ¥è®¾ç½®å€¼çš„ã€‚é€šè¿‡ConnectionManager.setConnection(Connection conn)æ–¹æ³•è®¾ç½®çš„Connectionå¯¹è±¡ï¼Œä¹Ÿåªä¼šå’Œå½“å‰çº¿ç¨‹ç»‘å®šã€‚è¿™æ ·å°±å®žçŽ°äº†Connectionå¯¹è±¡åœ¨å¤šä¸ªçº¿ç¨‹ä¸­çš„å®Œå…¨éš”ç¦»ã€‚ åœ¨Springå®¹å™¨ä¸­ç®¡ç†å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹çš„Connectionå¯¹è±¡æ—¶ï¼Œé‡‡ç”¨çš„æ€è·¯å’Œä»¥ä¸Šä»£ç éžå¸¸ç›¸ä¼¼ã€‚ å››ã€threadLocalç¼ºé™· ThreadLocalå˜é‡çš„è¿™ç§éš”ç¦»ç­–ç•¥ï¼Œä¹Ÿä¸æ˜¯ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½ä½¿ç”¨çš„ã€‚ å¦‚æžœå¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®çš„å¯¹è±¡å®žä¾‹åªèƒ½åˆ›å»ºé‚£ä¹ˆä¸€ä¸ªï¼Œé‚£å°±æ²¡æœ‰åˆ«çš„åŠžæ³•äº†ï¼Œè€è€å®žå®žçš„ä½¿ç”¨åŒæ­¥æœºåˆ¶å§ã€‚ ä¸‹ä¸€ç¯‡æŽ¢è®¨ThreadLocal å†…å­˜æ³„æ¼é—®é¢˜ã€‚ å‚è€ƒï¼š æ·±å…¥ç†è§£ThreadLocal]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹NIO]]></title>
    <url>%2F2019%2F02%2F20%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8BNIO%2F</url>
    <content type="text"><![CDATA[ä¸ºäº†é™åˆ¶ç¯‡å¹…ï¼Œå…³äºŽIOè¿™ä¸€å—çš„å†…å®¹ï¼Œå·²ç»ä»Žæœ¬ç¬”è®°ä¸­ç§»é™¤ï¼Œå…·ä½“è¿˜æ˜¯å¦å¤–çœ‹ç¬”è®°ï¼Œè¿™é‡Œä¸»è¦è¿˜æ˜¯ä»‹ç»NIOã€‚ ä¸€ã€NIO éžé˜»å¡žçš„è¾“å…¥/è¾“å‡º (NIO) åº“æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ã€‚NIO å¼¥è¡¥äº†åŽŸæ¥çš„ I/O çš„ä¸è¶³ï¼Œæä¾›äº†é«˜é€Ÿçš„ã€é¢å‘å—çš„ I/Oã€‚ 1.1 é˜»å¡žI/Oé€šä¿¡æ¨¡åž‹ å‡å¦‚çŽ°åœ¨ä½ å¯¹é˜»å¡žI/Oå·²æœ‰äº†ä¸€å®šäº†è§£ï¼Œæˆ‘ä»¬çŸ¥é“é˜»å¡žI/Oåœ¨è°ƒç”¨InputStream.read()æ–¹æ³•æ—¶æ˜¯é˜»å¡žçš„ï¼Œå®ƒä¼šä¸€ç›´ç­‰åˆ°æ•°æ®åˆ°æ¥æ—¶ï¼ˆæˆ–è¶…æ—¶ï¼‰æ‰ä¼šè¿”å›žï¼›åŒæ ·ï¼Œåœ¨è°ƒç”¨ServerSocket.accept()æ–¹æ³•æ—¶ï¼Œä¹Ÿä¼šä¸€ç›´é˜»å¡žåˆ°æœ‰å®¢æˆ·ç«¯è¿žæŽ¥æ‰ä¼šè¿”å›žï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥è¿‡æ¥åŽï¼ŒæœåŠ¡ç«¯éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹åŽ»å¤„ç†è¯¥å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚é˜»å¡žI/Oçš„é€šä¿¡æ¨¡åž‹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š ç¼ºç‚¹ï¼š å½“å®¢æˆ·ç«¯å¤šæ—¶ï¼Œä¼šåˆ›å»ºå¤§é‡çš„å¤„ç†çº¿ç¨‹ã€‚ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½è¦å ç”¨æ ˆç©ºé—´å’Œä¸€äº›CPUæ—¶é—´ é˜»å¡žå¯èƒ½å¸¦æ¥é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸”å¤§éƒ¨åˆ†ä¸Šä¸‹æ–‡åˆ‡æ¢å¯èƒ½æ˜¯æ— æ„ä¹‰çš„ã€‚ 1.2 java NIOåŽŸç†åŠé€šä¿¡æ¨¡åž‹ ä¸‹é¢æ˜¯java NIOçš„å·¥ä½œåŽŸç†ï¼š ç”±ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥å¤„ç†æ‰€æœ‰çš„ IO äº‹ä»¶ï¼Œå¹¶è´Ÿè´£åˆ†å‘ã€‚ äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼šäº‹ä»¶åˆ°çš„æ—¶å€™è§¦å‘ï¼Œè€Œä¸æ˜¯åŒæ­¥çš„åŽ»ç›‘è§†äº‹ä»¶ã€‚ çº¿ç¨‹é€šè®¯ï¼šçº¿ç¨‹ä¹‹é—´é€šè¿‡ wait,notify ç­‰æ–¹å¼é€šè®¯ã€‚ä¿è¯æ¯æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢éƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚å‡å°‘æ— è°“çš„çº¿ç¨‹åˆ‡æ¢ã€‚ Java NIOçš„æœåŠ¡ç«¯åªéœ€å¯åŠ¨ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ¥å¤„ç†æ‰€æœ‰çš„ IO äº‹ä»¶ï¼Œè¿™ç§é€šä¿¡æ¨¡åž‹æ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿjava NIOé‡‡ç”¨äº†åŒå‘é€šé“ï¼ˆchannelï¼‰è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè€Œä¸æ˜¯å•å‘çš„æµï¼ˆstreamï¼‰ï¼Œåœ¨é€šé“ä¸Šå¯ä»¥æ³¨å†Œæˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚ä¸€å…±æœ‰ä»¥ä¸‹å››ç§äº‹ä»¶ï¼š äº‹ä»¶å å¯¹åº”å€¼ æœåŠ¡ç«¯æŽ¥æ”¶å®¢æˆ·ç«¯è¿žæŽ¥äº‹ä»¶ SelectionKey.OP_ACCEPT(16) å®¢æˆ·ç«¯è¿žæŽ¥æœåŠ¡ç«¯äº‹ä»¶ SelectionKey.OP_CONNECT(8) è¯»äº‹ä»¶ SelectionKey.OP_READ(1) å†™äº‹ä»¶ SelectionKey.OP_WRITE(4) æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å„è‡ªç»´æŠ¤ä¸€ä¸ªç®¡ç†é€šé“çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºselectorï¼Œè¯¥å¯¹è±¡èƒ½æ£€æµ‹ä¸€ä¸ªæˆ–å¤šä¸ªé€šé“ (channel) ä¸Šçš„äº‹ä»¶ã€‚æˆ‘ä»¬ä»¥æœåŠ¡ç«¯ä¸ºä¾‹ï¼Œå¦‚æžœæœåŠ¡ç«¯çš„selectorä¸Šæ³¨å†Œäº†è¯»äº‹ä»¶ï¼ŒæŸæ—¶åˆ»å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€äº†ä¸€äº›æ•°æ®ï¼Œé˜»å¡žI/Oè¿™æ—¶ä¼šè°ƒç”¨read()æ–¹æ³•é˜»å¡žåœ°è¯»å–æ•°æ®ï¼Œè€ŒNIOçš„æœåŠ¡ç«¯ä¼šåœ¨selectorä¸­æ·»åŠ ä¸€ä¸ªè¯»äº‹ä»¶ã€‚æœåŠ¡ç«¯çš„å¤„ç†çº¿ç¨‹ä¼šè½®è¯¢åœ°è®¿é—®selectorï¼Œå¦‚æžœè®¿é—®selectoræ—¶å‘çŽ°æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶åˆ°è¾¾ï¼Œåˆ™å¤„ç†è¿™äº›äº‹ä»¶ï¼Œå¦‚æžœæ²¡æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶åˆ°è¾¾ï¼Œåˆ™å¤„ç†çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡žç›´åˆ°æ„Ÿå…´è¶£çš„äº‹ä»¶åˆ°è¾¾ä¸ºæ­¢ã€‚ä¸‹é¢æ˜¯æˆ‘ç†è§£çš„java NIOçš„é€šä¿¡æ¨¡åž‹ç¤ºæ„å›¾ï¼š äºŒã€å…³äºŽé˜»å¡žä¸Žéžé˜»å¡žï¼ŒåŒæ­¥ä¸ŽéžåŒæ­¥çš„ç†è§£ æˆ‘ä»¬éƒ½çŸ¥é“å¸¸è§çš„IOæœ‰å››ç§æ–¹å¼ï¼ŒåŒæ­¥é˜»å¡žï¼ŒåŒæ­¥éžé˜»å¡žï¼Œå¼‚æ­¥é˜»å¡žï¼Œå¼‚æ­¥éžé˜»å¡žã€‚ç„¶è€Œå¯¹äºŽåŒæ­¥å’Œé˜»å¡žçš„ç†è§£å´ä¸€ç›´å¾ˆæ¨¡ç³Šã€‚ 2.1 åŒæ­¥ä¸Žå¼‚æ­¥ æ‰€è°“åŒæ­¥å°±æ˜¯ä¸€ä¸ªä»»åŠ¡çš„å®Œæˆéœ€è¦ä¾èµ–å¦å¤–ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œåªæœ‰ç­‰å¾…è¢«ä¾èµ–çš„ä»»åŠ¡å®ŒæˆåŽï¼Œä¾èµ–çš„ä»»åŠ¡æ‰èƒ½ç®—å®Œæˆï¼Œè¿™æ˜¯ä¸€ç§å¯é çš„ä»»åŠ¡åºåˆ—ã€‚è¦ä¹ˆæˆåŠŸéƒ½æˆåŠŸï¼Œå¤±è´¥éƒ½å¤±è´¥ï¼Œä¸¤ä¸ªä»»åŠ¡çš„çŠ¶æ€å¯ä»¥ä¿æŒä¸€è‡´ã€‚ è€Œå¼‚æ­¥æ˜¯ä¸éœ€è¦ç­‰å¾…è¢«ä¾èµ–çš„ä»»åŠ¡å®Œæˆï¼Œåªæ˜¯é€šçŸ¥è¢«ä¾èµ–çš„ä»»åŠ¡è¦å®Œæˆä»€ä¹ˆå·¥ä½œï¼Œä¾èµ–çš„ä»»åŠ¡ä¹Ÿç«‹å³æ‰§è¡Œï¼Œåªè¦è‡ªå·±å®Œæˆäº†æ•´ä¸ªä»»åŠ¡å°±ç®—å®Œæˆäº†ã€‚è‡³äºŽè¢«ä¾èµ–çš„ä»»åŠ¡æœ€ç»ˆæ˜¯å¦çœŸæ­£å®Œæˆï¼Œä¾èµ–å®ƒçš„ä»»åŠ¡æ— æ³•ç¡®å®šï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸å¯é çš„ä»»åŠ¡åºåˆ—ã€‚ æˆ‘ä»¬å¯ä»¥ç”¨æ‰“ç”µè¯ï¼ˆåŒæ­¥ï¼‰å’Œå‘çŸ­ä¿¡ï¼ˆå¼‚æ­¥ï¼‰æ¥å¾ˆå¥½çš„æ¯”å–»åŒæ­¥ä¸Žå¼‚æ­¥æ“ä½œã€‚ 2.2 é˜»å¡žå’Œéžé˜»å¡ž é˜»å¡žå°±æ˜¯ CPU åœä¸‹æ¥ç­‰å¾…ä¸€ä¸ªæ…¢çš„æ“ä½œå®Œæˆ CPU æ‰æŽ¥ç€å®Œæˆå…¶å®ƒçš„äº‹ã€‚ éžé˜»å¡žå°±æ˜¯åœ¨è¿™ä¸ªæ…¢çš„æ“ä½œåœ¨æ‰§è¡Œæ—¶ CPU åŽ»å¹²å…¶å®ƒåˆ«çš„äº‹ï¼Œç­‰è¿™ä¸ªæ…¢çš„æ“ä½œå®Œæˆæ—¶ï¼ŒCPU å†æŽ¥ç€å®ŒæˆåŽç»­çš„æ“ä½œã€‚ è™½ç„¶è¡¨é¢ä¸Šçœ‹éžé˜»å¡žçš„æ–¹å¼å¯ä»¥æ˜Žæ˜¾çš„æé«˜ CPU çš„åˆ©ç”¨çŽ‡ï¼Œä½†æ˜¯ä¹Ÿå¸¦äº†å¦å¤–ä¸€ç§åŽæžœå°±æ˜¯ç³»ç»Ÿçš„çº¿ç¨‹åˆ‡æ¢å¢žåŠ ã€‚ 2.3 ä»€ä¹ˆæ˜¯é˜»å¡žIOï¼Ÿä»€ä¹ˆæ˜¯éžé˜»å¡žIOï¼Ÿ åœ¨äº†è§£é˜»å¡žIOå’Œéžé˜»å¡žIOä¹‹å‰ï¼Œå…ˆçœ‹ä¸‹ä¸€ä¸ªå…·ä½“çš„IOæ“ä½œè¿‡ç¨‹æ˜¯æ€Žä¹ˆè¿›è¡Œçš„ã€‚ é€šå¸¸æ¥è¯´ï¼ŒIOæ“ä½œåŒ…æ‹¬ï¼šå¯¹ç¡¬ç›˜çš„è¯»å†™ã€å¯¹socketçš„è¯»å†™ä»¥åŠå¤–è®¾çš„è¯»å†™ã€‚ å½“ç”¨æˆ·çº¿ç¨‹å‘èµ·ä¸€ä¸ªIOè¯·æ±‚æ“ä½œï¼ˆæœ¬æ–‡ä»¥è¯»è¯·æ±‚æ“ä½œä¸ºä¾‹ï¼‰ï¼Œå†…æ ¸ä¼šåŽ»æŸ¥çœ‹è¦è¯»å–çš„æ•°æ®æ˜¯å¦å°±ç»ªï¼Œå¯¹äºŽé˜»å¡žIOæ¥è¯´ï¼Œå¦‚æžœæ•°æ®æ²¡æœ‰å°±ç»ªï¼Œåˆ™ä¼šä¸€ç›´åœ¨é‚£ç­‰å¾…ï¼Œç›´åˆ°æ•°æ®å°±ç»ªï¼›å¯¹äºŽéžé˜»å¡žIOæ¥è¯´ï¼Œå¦‚æžœæ•°æ®æ²¡æœ‰å°±ç»ªï¼Œåˆ™ä¼šè¿”å›žä¸€ä¸ªæ ‡å¿—ä¿¡æ¯å‘ŠçŸ¥ç”¨æˆ·çº¿ç¨‹å½“å‰è¦è¯»çš„æ•°æ®æ²¡æœ‰å°±ç»ªã€‚å½“æ•°æ®å°±ç»ªä¹‹åŽï¼Œä¾¿å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çº¿ç¨‹ï¼Œè¿™æ ·æ‰å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„IOè¯»è¯·æ±‚æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå®Œæ•´çš„IOè¯»è¯·æ±‚æ“ä½œåŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š æŸ¥çœ‹æ•°æ®æ˜¯å¦å°±ç»ªï¼› è¿›è¡Œæ•°æ®æ‹·è´ï¼ˆå†…æ ¸å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çº¿ç¨‹ï¼‰ã€‚ é‚£ä¹ˆé˜»å¡žï¼ˆblocking IOï¼‰å’Œéžé˜»å¡žï¼ˆnon-blocking IOï¼‰çš„åŒºåˆ«å°±åœ¨äºŽç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå¦‚æžœæ•°æ®æ²¡æœ‰å°±ç»ªï¼Œåœ¨æŸ¥çœ‹æ•°æ®æ˜¯å¦å°±ç»ªçš„è¿‡ç¨‹ä¸­æ˜¯ä¸€ç›´ç­‰å¾…ï¼Œè¿˜æ˜¯ç›´æŽ¥è¿”å›žä¸€ä¸ªæ ‡å¿—ä¿¡æ¯ã€‚ Javaä¸­ä¼ ç»Ÿçš„IOéƒ½æ˜¯é˜»å¡žIOï¼Œæ¯”å¦‚é€šè¿‡socketæ¥è¯»æ•°æ®ï¼Œè°ƒç”¨read()æ–¹æ³•ä¹‹åŽï¼Œå¦‚æžœæ•°æ®æ²¡æœ‰å°±ç»ªï¼Œå½“å‰çº¿ç¨‹å°±ä¼šä¸€ç›´é˜»å¡žåœ¨readæ–¹æ³•è°ƒç”¨é‚£é‡Œï¼Œç›´åˆ°æœ‰æ•°æ®æ‰è¿”å›žï¼›è€Œå¦‚æžœæ˜¯éžé˜»å¡žIOçš„è¯ï¼Œå½“æ•°æ®æ²¡æœ‰å°±ç»ªï¼Œread()æ–¹æ³•åº”è¯¥è¿”å›žä¸€ä¸ªæ ‡å¿—ä¿¡æ¯ï¼Œå‘ŠçŸ¥å½“å‰çº¿ç¨‹æ•°æ®æ²¡æœ‰å°±ç»ªï¼Œè€Œä¸æ˜¯ä¸€ç›´åœ¨é‚£é‡Œç­‰å¾…ã€‚ 2.4 ä»€ä¹ˆæ˜¯åŒæ­¥IOï¼Ÿä»€ä¹ˆæ˜¯å¼‚æ­¥IOï¼Ÿ æˆ‘ä»¬çŸ¥é“äº†ï¼Œé˜»å¡žå’Œéžé˜»å¡žæ˜¯åˆ¤æ–­æ•°æ®æ˜¯å¦å°±ç»ªæ—¶å¦‚ä½•å¤„ç†ï¼Œå³IOæ“ä½œçš„ç¬¬ä¸€é˜¶æ®µã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯åŒæ­¥IOå’Œå¼‚æ­¥IOå‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“ï¼ŒåŒæ­¥æ˜¯æ‰“ç”µè¯ï¼Œå¼‚æ­¥æ˜¯å‘çŸ­ä¿¡ï¼Œæ‰“ç”µè¯éœ€è¦ç­‰åˆ°ç”µè¯é€šäº†æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œå‘çŸ­ä¿¡å°±ä¸ç”¨æ“å¿ƒé‚£ä¹ˆå¤šäº†ï¼Œæˆ‘å‘å‡ºåŽ»å°±è¡Œäº†ï¼Œè‡³äºŽä»€ä¹ˆæ—¶å€™å‘é€ã€å¦‚ä½•å‘é€ä»¥åŠå¦‚ä½•ä¿è¯æˆ‘è¿™ä¸ªçŸ­ä¿¡ä¸€å®šèƒ½å‘å‡ºåŽ»ï¼Œæˆ‘æ˜¯ä¸ç®¡çš„ã€‚ åŒæ­¥IOå³ å¦‚æžœä¸€ä¸ªçº¿ç¨‹è¯·æ±‚è¿›è¡ŒIOæ“ä½œï¼Œåœ¨IOæ“ä½œå®Œæˆä¹‹å‰ï¼Œè¯¥çº¿ç¨‹ä¼šè¢«é˜»å¡žï¼›è€Œå¼‚æ­¥IOä¸º å¦‚æžœä¸€ä¸ªçº¿ç¨‹è¯·æ±‚è¿›è¡ŒIOæ“ä½œï¼ŒIOæ“ä½œä¸ä¼šå¯¼è‡´è¯·æ±‚çº¿ç¨‹è¢«é˜»å¡žã€‚ æè¿°çš„æ˜¯ç”¨æˆ·çº¿ç¨‹ä¸Žå†…æ ¸çš„äº¤äº’æ–¹å¼ï¼š åŒæ­¥æ˜¯æŒ‡ç”¨æˆ·çº¿ç¨‹å‘èµ· I/O è¯·æ±‚åŽéœ€è¦ç­‰å¾…æˆ–è€…è½®è¯¢å†…æ ¸ I/Oæ“ä½œå®ŒæˆåŽæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼› å¼‚æ­¥æ˜¯æŒ‡ç”¨æˆ·çº¿ç¨‹å‘èµ·I/Oè¯·æ±‚åŽä»ç»§ç»­æ‰§è¡Œï¼Œå½“å†…æ ¸I/Oæ“ä½œå®ŒæˆåŽä¼šé€šçŸ¥ç”¨æˆ·çº¿ç¨‹ï¼Œæˆ–è€…è°ƒç”¨ç”¨æˆ·çº¿ç¨‹æ³¨å†Œçš„å›žè°ƒå‡½æ•°ã€‚ ä¸‰ã€Channelï¼ˆé€šé“ï¼‰ é€šé“ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šå‘ä»€ä¹ˆçš„é“è·¯ï¼Œä¸ºæŸä¸ªæä¾›äº†æ¸ é“ã€‚åœ¨ä¼ ç»ŸIOä¸­ï¼Œæˆ‘ä»¬è¦è¯»å–ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œé€šå¸¸æ˜¯åƒä¸‹é¢è¿™æ ·è¯»å–çš„ï¼š è¿™é‡Œçš„InputStreamå®žé™…ä¸Šå°±æ˜¯ä¸ºè¯»å–æ–‡ä»¶æä¾›ä¸€ä¸ªé€šé“çš„ã€‚ å› æ­¤å¯ä»¥å°†NIO ä¸­çš„ChannelåŒä¼ ç»ŸIOä¸­çš„Streamæ¥ç±»æ¯”ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œä¼ ç»ŸIOä¸­ï¼ŒStreamæ˜¯å•å‘çš„ï¼Œæ¯”å¦‚InputStreamåªèƒ½è¿›è¡Œè¯»å–æ“ä½œï¼ŒOutputStreamåªèƒ½è¿›è¡Œå†™æ“ä½œã€‚è€ŒChannelæ˜¯åŒå‘çš„ï¼Œæ—¢å¯ç”¨æ¥è¿›è¡Œè¯»æ“ä½œï¼Œåˆå¯ç”¨æ¥è¿›è¡Œå†™æ“ä½œã€‚ é€šé“åŒ…æ‹¬ä»¥ä¸‹ç±»åž‹ï¼š FileChannelï¼šä»Žæ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼› DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼› SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼› ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿žæŽ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿žæŽ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannel ä¸‹é¢ç»™å‡ºé€šè¿‡FileChannelæ¥å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®çš„ä¸€ä¸ªä¾‹å­ï¼š å››ã€Bufferï¼ˆç¼“å†²åŒºï¼‰ Bufferï¼ˆç¼“å†²åŒºï¼‰ï¼Œæ˜¯NIOä¸­éžå¸¸é‡è¦çš„ä¸€ä¸ªä¸œè¥¿ï¼Œåœ¨NIOä¸­æ‰€æœ‰æ•°æ®çš„è¯»å’Œå†™éƒ½ç¦»ä¸å¼€Bufferã€‚æ¯”å¦‚ä¸Šé¢çš„ä¸€æ®µä»£ç ä¸­ï¼Œè¯»å–çš„æ•°æ®æ—¶æ”¾åœ¨byteæ•°ç»„å½“ä¸­ï¼Œè€Œåœ¨NIOä¸­ï¼Œè¯»å–çš„æ•°æ®åªèƒ½æ”¾åœ¨Bufferä¸­ã€‚åŒæ ·åœ°ï¼Œå†™å…¥æ•°æ®ä¹Ÿæ˜¯å…ˆå†™å…¥åˆ°Bufferä¸­ã€‚ ä¸Šé¢çš„å›¾æè¿°äº†ä»Žä¸€ä¸ªå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œç„¶åŽæœåŠ¡ç«¯æŽ¥æ”¶æ•°æ®çš„è¿‡ç¨‹ã€‚å®¢æˆ·ç«¯å‘é€æ•°æ®æ—¶ï¼Œå¿…é¡»å…ˆå°†æ•°æ®å­˜å…¥Bufferä¸­ï¼Œç„¶åŽå°†Bufferä¸­çš„å†…å®¹å†™å…¥é€šé“ã€‚æœåŠ¡ç«¯è¿™è¾¹æŽ¥æ”¶æ•°æ®å¿…é¡»é€šè¿‡Channelå°†æ•°æ®è¯»å…¥åˆ°Bufferä¸­ï¼Œç„¶åŽå†ä»ŽBufferä¸­å–å‡ºæ•°æ®æ¥å¤„ç†ã€‚ ç¼“å†²åŒºå®žè´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æž„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»/å†™è¿›ç¨‹ã€‚ ç¼“å†²åŒºåŒ…æ‹¬ä»¥ä¸‹ç±»åž‹ï¼š ByteBuffer CharBuffer ShortBuffer IntBuffer LongBuffer FloatBuffer DoubleBuffer å¦‚æžœæ˜¯å¯¹äºŽæ–‡ä»¶è¯»å†™ï¼Œä¸Šé¢å‡ ç§Bufferéƒ½å¯èƒ½ä¼šç”¨åˆ°ã€‚ä½†æ˜¯å¯¹äºŽç½‘ç»œè¯»å†™æ¥è¯´ï¼Œç”¨çš„æœ€å¤šçš„æ˜¯ByteBufferã€‚ äº”ã€ç¼“å†²åŒºçŠ¶æ€å˜é‡ capacityï¼šæœ€å¤§å®¹é‡ï¼› positionï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼› limitï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚ çŠ¶æ€å˜é‡çš„æ”¹å˜è¿‡ç¨‹ä¸¾ä¾‹ï¼š â‘  æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚ â‘¡ ä»Žè¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ç§»åŠ¨è®¾ç½®ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚ â‘¢ åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ flip() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0ã€‚ bufferä¸­çš„flipæ–¹æ³•æ¶‰åŠåˆ°buferä¸­çš„Capacity,Positionå’ŒLimitä¸‰ä¸ªæ¦‚å¿µã€‚å…¶ä¸­Capacityåœ¨è¯»å†™æ¨¡å¼ä¸‹éƒ½æ˜¯å›ºå®šçš„ï¼Œå°±æ˜¯æˆ‘ä»¬åˆ†é…çš„ç¼“å†²å¤§å°,Positionç±»ä¼¼äºŽè¯»å†™æŒ‡é’ˆï¼Œè¡¨ç¤ºå½“å‰è¯»(å†™)åˆ°ä»€ä¹ˆä½ç½®,Limitåœ¨å†™æ¨¡å¼ä¸‹è¡¨ç¤ºæœ€å¤šèƒ½å†™å…¥å¤šå°‘æ•°æ®ï¼Œæ­¤æ—¶å’ŒCapacityç›¸åŒï¼Œåœ¨è¯»æ¨¡å¼ä¸‹è¡¨ç¤ºæœ€å¤šèƒ½è¯»å¤šå°‘æ•°æ®ï¼Œæ­¤æ—¶å’Œç¼“å­˜ä¸­çš„å®žé™…æ•°æ®å¤§å°ç›¸åŒã€‚åœ¨å†™æ¨¡å¼ä¸‹è°ƒç”¨flipæ–¹æ³•ï¼Œé‚£ä¹ˆlimitå°±è®¾ç½®ä¸ºäº†positionå½“å‰çš„å€¼(å³å½“å‰å†™äº†å¤šå°‘æ•°æ®),postionä¼šè¢«ç½®ä¸º0ï¼Œä»¥è¡¨ç¤ºè¯»æ“ä½œä»Žç¼“å­˜çš„å¤´å¼€å§‹è¯»ã€‚ä¹Ÿå°±æ˜¯è¯´è°ƒç”¨flipä¹‹åŽï¼Œè¯»å†™æŒ‡é’ˆæŒ‡åˆ°ç¼“å­˜å¤´éƒ¨ï¼Œå¹¶ä¸”è®¾ç½®äº†æœ€å¤šåªèƒ½è¯»å‡ºä¹‹å‰å†™å…¥çš„æ•°æ®é•¿åº¦(è€Œä¸æ˜¯æ•´ä¸ªç¼“å­˜çš„å®¹é‡å¤§å°)ã€‚ â‘£ ä»Žç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚ â‘¤ æœ€åŽéœ€è¦è°ƒç”¨ clear() æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚ å…­ã€æ–‡ä»¶ NIO å®žä¾‹ ä»¥ä¸‹å±•ç¤ºäº†ä½¿ç”¨ NIO å¿«é€Ÿå¤åˆ¶æ–‡ä»¶çš„å®žä¾‹ï¼š ä¸ƒã€Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ å¯ä»¥è¯´å®ƒæ˜¯NIOä¸­æœ€å…³é”®çš„ä¸€ä¸ªéƒ¨åˆ†ï¼ŒSelectorçš„ä½œç”¨å°±æ˜¯ç”¨æ¥è½®è¯¢æ¯ä¸ªæ³¨å†Œçš„Channelï¼Œä¸€æ—¦å‘çŽ°Channelæœ‰æ³¨å†Œçš„äº‹ä»¶å‘ç”Ÿï¼Œä¾¿èŽ·å–äº‹ä»¶ç„¶åŽè¿›è¡Œå¤„ç†ã€‚ ç”¨å•çº¿ç¨‹å¤„ç†ä¸€ä¸ªSelectorï¼Œç„¶åŽé€šè¿‡Selector.select()æ–¹æ³•æ¥èŽ·å–åˆ°è¾¾äº‹ä»¶ï¼Œåœ¨èŽ·å–äº†åˆ°è¾¾äº‹ä»¶ä¹‹åŽï¼Œå°±å¯ä»¥é€ä¸ªåœ°å¯¹è¿™äº›äº‹ä»¶è¿›è¡Œå“åº”å¤„ç†ã€‚ å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚ ä¸‹é¢ä»Žç¼–ç¨‹çš„è§’åº¦å…·ä½“æ¥çœ‹çœ‹é€‰æ‹©å™¨æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚ 7.1 åˆ›å»ºé€‰æ‹©å™¨ 1Selector selector = Selector.open(); 7.2 å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š 123ServerSocketChannel ssChannel = ServerSocketChannel.open();ssChannel.configureBlocking(false);ssChannel.register(selector, SelectionKey.OP_ACCEPT); é€šé“å¿…é¡»é…ç½®ä¸ºéžé˜»å¡žæ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æžœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡žï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½åŽ»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚ åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š SelectionKey.OP_CONNECT SelectionKey.OP_ACCEPT SelectionKey.OP_READ SelectionKey.OP_WRITE å®ƒä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234public static final int OP_READ = 1 &lt;&lt; 0;public static final int OP_WRITE = 1 &lt;&lt; 2;public static final int OP_CONNECT = 1 &lt;&lt; 3;public static final int OP_ACCEPT = 1 &lt;&lt; 4; å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶å¯ä»¥è¢«å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»Žè€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š 1int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE; 7.3 ç›‘å¬äº‹ä»¶ 1int num = selector.select(); ä½¿ç”¨ select() æ¥ç›‘å¬äº‹ä»¶åˆ°è¾¾ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡žç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚ 7.4 èŽ·å–åˆ°è¾¾çš„äº‹ä»¶ 1234567891011Set&lt;SelectionKey&gt; keys = selector.selectedKeys();Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator();while (keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next(); if (key.isAcceptable()) &#123; // ... &#125; else if (key.isReadable()) &#123; // ... &#125; keyIterator.remove();&#125; 7.5 äº‹ä»¶å¾ªçŽ¯ å› ä¸ºä¸€æ¬¡ select() è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªçŽ¯å†…ã€‚ 1234567891011121314while (true) &#123; int num = selector.select(); Set&lt;SelectionKey&gt; keys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator(); while (keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next(); if (key.isAcceptable()) &#123; // ... &#125; else if (key.isReadable()) &#123; // ... &#125; keyIterator.remove(); &#125;&#125; å…«ã€æµä¸Žå— I/O ä¸Ž NIO æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼ŒI/O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚ é¢å‘æµçš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éžå¸¸å®¹æ˜“ï¼Œé“¾æŽ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ I/O é€šå¸¸ç›¸å½“æ…¢ã€‚ é¢å‘å—çš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼ŒæŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰æµå¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚ I/O åŒ…å’Œ NIO å·²ç»å¾ˆå¥½åœ°é›†æˆäº†ï¼Œjava.io.* å·²ç»ä»¥ NIO ä¸ºåŸºç¡€é‡æ–°å®žçŽ°äº†ï¼Œæ‰€ä»¥çŽ°åœ¨å®ƒå¯ä»¥åˆ©ç”¨ NIO çš„ä¸€äº›ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œjava.io.* åŒ…ä¸­çš„ä¸€äº›ç±»åŒ…å«ä»¥å—çš„å½¢å¼è¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—å³ä½¿åœ¨é¢å‘æµçš„ç³»ç»Ÿä¸­ï¼Œå¤„ç†é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚ ä¹ã€ä¸€ä¸ªå®Œæ•´ NIO å®žä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public class NIOServer &#123; public static void main(String[] args) throws IOException &#123; Selector selector = Selector.open(); ServerSocketChannel ssChannel = ServerSocketChannel.open(); ssChannel.configureBlocking(false); ssChannel.register(selector, SelectionKey.OP_ACCEPT); ServerSocket serverSocket = ssChannel.socket(); InetSocketAddress address = new InetSocketAddress("127.0.0.1", 8888); serverSocket.bind(address); while (true) &#123; selector.select(); Set&lt;SelectionKey&gt; keys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator(); while (keyIterator.hasNext()) &#123; SelectionKey key = keyIterator.next(); if (key.isAcceptable()) &#123; ServerSocketChannel ssChannel1 = (ServerSocketChannel) key.channel(); // æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæ–°è¿žæŽ¥åˆ›å»ºä¸€ä¸ª SocketChannel SocketChannel sChannel = ssChannel1.accept(); sChannel.configureBlocking(false); // è¿™ä¸ªæ–°è¿žæŽ¥ä¸»è¦ç”¨äºŽä»Žå®¢æˆ·ç«¯è¯»å–æ•°æ® sChannel.register(selector, SelectionKey.OP_READ); &#125; else if (key.isReadable()) &#123; SocketChannel sChannel = (SocketChannel) key.channel(); System.out.println(readDataFromSocketChannel(sChannel)); sChannel.close(); &#125; keyIterator.remove(); &#125; &#125; &#125; private static String readDataFromSocketChannel(SocketChannel sChannel) throws IOException &#123; ByteBuffer buffer = ByteBuffer.allocate(1024); StringBuffer data = new StringBuffer(); while (true) &#123; buffer.clear(); int n = sChannel.read(buffer); if (n == -1) break; buffer.flip(); int limit = buffer.limit(); char[] dst = new char[limit]; for (int i = 0; i &lt; limit; i++) dst[i] = (char) buffer.get(i); data.append(dst); buffer.clear(); &#125; return data.toString(); &#125;&#125; 12345678910public class NIOClient &#123; public static void main(String[] args) throws IOException &#123; Socket socket = new Socket("127.0.0.1", 8888); OutputStream out = socket.getOutputStream(); String s = "hello world"; out.write(s.getBytes()); out.close(); &#125;&#125; åã€NIOå’ŒIOçš„ä¸»è¦åŒºåˆ« IO NIO é¢å‘æµ é¢å‘ç¼“å†² é˜»å¡žIO éžé˜»å¡žIO æ—  é€‰æ‹©å™¨ é¢å‘æµä¸Žé¢å‘ç¼“å†² Java IOå’ŒNIOä¹‹é—´ç¬¬ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒIOæ˜¯é¢å‘æµçš„ï¼ŒNIOæ˜¯é¢å‘ç¼“å†²åŒºçš„ã€‚ Java IOé¢å‘æµæ„å‘³ç€æ¯æ¬¡ä»Žæµä¸­è¯»ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ï¼Œç›´è‡³è¯»å–æ‰€æœ‰å­—èŠ‚ï¼Œå®ƒä»¬æ²¡æœ‰è¢«ç¼“å­˜åœ¨ä»»ä½•åœ°æ–¹ã€‚æ­¤å¤–ï¼Œå®ƒä¸èƒ½å‰åŽç§»åŠ¨æµä¸­çš„æ•°æ®ã€‚å¦‚æžœéœ€è¦å‰åŽç§»åŠ¨ä»Žæµä¸­è¯»å–çš„æ•°æ®ï¼Œéœ€è¦å…ˆå°†å®ƒç¼“å­˜åˆ°ä¸€ä¸ªç¼“å†²åŒºã€‚ Java NIOçš„ç¼“å†²å¯¼å‘æ–¹æ³•ç•¥æœ‰ä¸åŒã€‚æ•°æ®è¯»å–åˆ°ä¸€ä¸ªå®ƒç¨åŽå¤„ç†çš„ç¼“å†²åŒºï¼Œéœ€è¦æ—¶å¯åœ¨ç¼“å†²åŒºä¸­å‰åŽç§»åŠ¨ã€‚è¿™å°±å¢žåŠ äº†å¤„ç†è¿‡ç¨‹ä¸­çš„çµæ´»æ€§ã€‚ä½†æ˜¯ï¼Œè¿˜éœ€è¦æ£€æŸ¥æ˜¯å¦è¯¥ç¼“å†²åŒºä¸­åŒ…å«æ‰€æœ‰æ‚¨éœ€è¦å¤„ç†çš„æ•°æ®ã€‚è€Œä¸”ï¼Œéœ€ç¡®ä¿å½“æ›´å¤šçš„æ•°æ®è¯»å…¥ç¼“å†²åŒºæ—¶ï¼Œä¸è¦è¦†ç›–ç¼“å†²åŒºé‡Œå°šæœªå¤„ç†çš„æ•°æ®ã€‚ é˜»å¡žä¸Žéžé˜»å¡žIO Java IOçš„å„ç§æµæ˜¯é˜»å¡žçš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨read() æˆ– write()æ—¶ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡žï¼Œç›´åˆ°æœ‰ä¸€äº›æ•°æ®è¢«è¯»å–ï¼Œæˆ–æ•°æ®å®Œå…¨å†™å…¥ã€‚è¯¥çº¿ç¨‹åœ¨æ­¤æœŸé—´ä¸èƒ½å†å¹²ä»»ä½•äº‹æƒ…äº†ã€‚Java NIOçš„éžé˜»å¡žæ¨¡å¼ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä»ŽæŸé€šé“å‘é€è¯·æ±‚è¯»å–æ•°æ®ï¼Œä½†æ˜¯å®ƒä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®ï¼Œå¦‚æžœç›®å‰æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šèŽ·å–ï¼Œè€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡žï¼Œæ‰€ä»¥ç›´è‡³æ•°æ®å˜çš„å¯ä»¥è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–çš„äº‹æƒ…ã€‚ éžé˜»å¡žå†™ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥åŽ»åšåˆ«çš„äº‹æƒ…ã€‚ çº¿ç¨‹é€šå¸¸å°†éžé˜»å¡žIOçš„ç©ºé—²æ—¶é—´ç”¨äºŽåœ¨å…¶å®ƒé€šé“ä¸Šæ‰§è¡ŒIOæ“ä½œï¼Œæ‰€ä»¥ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹çŽ°åœ¨å¯ä»¥ç®¡ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºé€šé“ï¼ˆchannelï¼‰ã€‚ é€‰æ‹©å™¨ï¼ˆSelectorsï¼‰ Java NIOçš„é€‰æ‹©å™¨å…è®¸ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥ç›‘è§†å¤šä¸ªè¾“å…¥é€šé“ï¼Œä½ å¯ä»¥æ³¨å†Œå¤šä¸ªé€šé“ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œç„¶åŽä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥â€œé€‰æ‹©â€é€šé“ï¼šè¿™äº›é€šé“é‡Œå·²ç»æœ‰å¯ä»¥å¤„ç†çš„è¾“å…¥ï¼Œæˆ–è€…é€‰æ‹©å·²å‡†å¤‡å†™å…¥çš„é€šé“ã€‚è¿™ç§é€‰æ‹©æœºåˆ¶ï¼Œä½¿å¾—ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¾ˆå®¹æ˜“æ¥ç®¡ç†å¤šä¸ªé€šé“ã€‚ åä¸€ã€æ€»ç»“ NIOå…¶å®žå®žçŽ°çš„æ˜¯ä¸€ä¸ªIOçš„å¤šè·¯å¤ç”¨ï¼Œç”¨selectæ¥åŒæ—¶ç›‘å¬å¤šä¸ªchannelï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯åŒæ­¥é˜»å¡žçš„ï¼Œéœ€è¦selectä¸æ–­ç›‘å¬ç«¯å£ã€‚ä½†æ˜¯å¯¹äºŽIOå„ä¸ªé€šé“æ¥è¯´å°±æ˜¯å¯ä»¥çœ‹åšæ˜¯å¼‚æ­¥ã€‚ åŸºæœ¬å¯ä»¥è®¤ä¸º â€œNIO = I/Oå¤šè·¯å¤ç”¨ + éžé˜»å¡žå¼I/Oâ€ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯å•çº¿ç¨‹ï¼Œä½†ä¹Ÿæœ‰è¶…è¿‡ä¸€ä¸ªçº¿ç¨‹å®žçŽ°NIOçš„æƒ…å†µ æˆ‘ä»¬å¯ä»¥ç”¨æ‰“ç”µè¯ï¼ˆåŒæ­¥ï¼‰å’Œå‘çŸ­ä¿¡ï¼ˆå¼‚æ­¥ï¼‰æ¥å¾ˆå¥½çš„æ¯”å–»åŒæ­¥ä¸Žå¼‚æ­¥æ“ä½œ é˜»å¡žå°±æ˜¯ CPU åœä¸‹æ¥ç­‰å¾…ä¸€ä¸ªæ…¢çš„æ“ä½œå®Œæˆ CPU æ‰æŽ¥ç€å®Œæˆå…¶å®ƒçš„äº‹ã€‚ éžé˜»å¡žå°±æ˜¯åœ¨è¿™ä¸ªæ…¢çš„æ“ä½œåœ¨æ‰§è¡Œæ—¶ CPU åŽ»å¹²å…¶å®ƒåˆ«çš„äº‹ï¼Œç­‰è¿™ä¸ªæ…¢çš„æ“ä½œå®Œæˆæ—¶ï¼ŒCPU å†æŽ¥ç€å®ŒæˆåŽç»­çš„æ“ä½œã€‚ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ã€‚ ä¼ ç»ŸIOä¸­ï¼ŒStreamæ˜¯å•å‘çš„ï¼Œæ¯”å¦‚InputStreamåªèƒ½è¿›è¡Œè¯»å–æ“ä½œï¼ŒOutputStreamåªèƒ½è¿›è¡Œå†™æ“ä½œã€‚è€ŒChannelæ˜¯åŒå‘çš„ï¼Œæ—¢å¯ç”¨æ¥è¿›è¡Œè¯»æ“ä½œï¼Œåˆå¯ç”¨æ¥è¿›è¡Œå†™æ“ä½œã€‚ åœ¨NIOä¸­ï¼Œè¯»å–çš„æ•°æ®åªèƒ½æ”¾åœ¨Bufferä¸­ã€‚åŒæ ·åœ°ï¼Œå†™å…¥æ•°æ®ä¹Ÿæ˜¯å…ˆå†™å…¥åˆ°Bufferä¸­ã€‚ç¼“å†²åŒºæœ‰ä¸‰ä¸ªçŠ¶æ€å˜é‡ï¼šcapacityï¼šæœ€å¤§å®¹é‡ï¼›positionï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼›limitï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚ Selectorçš„ä½œç”¨å°±æ˜¯ç”¨æ¥è½®è¯¢æ¯ä¸ªæ³¨å†Œçš„Channelï¼Œä¸€æ—¦å‘çŽ°Channelæœ‰æ³¨å†Œçš„äº‹ä»¶å‘ç”Ÿï¼Œä¾¿èŽ·å–äº‹ä»¶ç„¶åŽè¿›è¡Œå¤„ç†. NIOå’ŒIOçš„ä¸»è¦åŒºåˆ«ã€‚ NIOé€‚ç”¨åœºæ™¯ æœåŠ¡å™¨éœ€è¦æ”¯æŒè¶…å¤§é‡çš„é•¿æ—¶é—´è¿žæŽ¥ã€‚æ¯”å¦‚10000ä¸ªè¿žæŽ¥ä»¥ä¸Šï¼Œå¹¶ä¸”æ¯ä¸ªå®¢æˆ·ç«¯å¹¶ä¸ä¼šé¢‘ç¹åœ°å‘é€å¤ªå¤šæ•°æ®ã€‚ä¾‹å¦‚æ€»å…¬å¸çš„ä¸€ä¸ªä¸­å¿ƒæœåŠ¡å™¨éœ€è¦æ”¶é›†å…¨å›½ä¾¿åˆ©åº—å„ä¸ªæ”¶é“¶æœºçš„äº¤æ˜“ä¿¡æ¯ï¼Œåªéœ€è¦å°‘é‡çº¿ç¨‹æŒ‰éœ€å¤„ç†ç»´æŠ¤çš„å¤§é‡é•¿æœŸè¿žæŽ¥ã€‚ BIOé€‚ç”¨åœºæ™¯ é€‚ç”¨äºŽè¿žæŽ¥æ•°ç›®æ¯”è¾ƒå°ï¼Œå¹¶ä¸”ä¸€æ¬¡å‘é€å¤§é‡æ•°æ®çš„åœºæ™¯ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºŽåº”ç”¨ä¸­ã€‚ å‚è€ƒï¼š IO - åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡žï¼Œéžé˜»å¡ž Java NIOï¼šæµ…æžI/Oæ¨¡åž‹ NIOä¸Žä¼ ç»ŸIOçš„åŒºåˆ« Java NIOï¼šNIOæ¦‚è¿° Java I/O]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SocketåŸºç¡€]]></title>
    <url>%2F2019%2F02%2F20%2FSocket%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ I/Oå‡ ç§å¸¸è§æ¨¡åž‹ä»¥åŠselectã€pollã€epollä¸‰ç§å¤šè·¯å¤ç”¨çš„å…·ä½“å®žçŽ°ã€‚ ä¸€ã€I/O æ¨¡åž‹ ä¸€ä¸ªè¾“å…¥æ“ä½œï¼Œå³æˆ‘ä»¬å¸¸è¯´çš„è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š ç­‰å¾…æ•°æ®å‡†å¤‡å¥½ ä»Žå†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ® å¯¹äºŽä¸€ä¸ªå¥—æŽ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»Žç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ‰€ç­‰å¾…åˆ†ç»„åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»Žå†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„è¿‡ç¨‹ï¼Œå¯èƒ½æ˜¯æ€§èƒ½å‡ºçŽ°ç“¶é¢ˆçš„åœ°æ–¹ã€‚ Unix ä¸‹æœ‰äº”ç§ I/O æ¨¡åž‹ï¼š é˜»å¡žå¼ I/O éžé˜»å¡žå¼ I/O I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰ ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰ å¼‚æ­¥ I/Oï¼ˆAIOï¼‰ 1.1 é˜»å¡žå¼ I/O åº”ç”¨è¿›ç¨‹è¢«é˜»å¡žï¼Œç›´åˆ°æ•°æ®å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›žã€‚ åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨é˜»å¡žçš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒç¨‹åºè¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤é˜»å¡žä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡žã€‚å› ä¸ºå…¶ä»–ç¨‹åºè¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œè¿™ç§æ¨¡åž‹çš„æ‰§è¡Œæ•ˆçŽ‡ä¼šæ¯”è¾ƒé«˜ã€‚ ä¸‹å›¾ä¸­ï¼Œrecvfrom ç”¨äºŽæŽ¥æ”¶ Socket ä¼ æ¥çš„æ•°æ®ï¼Œå¹¶å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒº buf ä¸­ã€‚è¿™é‡ŒæŠŠ recvfrom() å½“æˆç³»ç»Ÿè°ƒç”¨ã€‚ 1ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen); 1.2 éžé˜»å¡žå¼ I/O åº”ç”¨è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹åŽï¼Œå†…æ ¸è¿”å›žä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥èŽ·çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼æˆä¸ºè½®è¯¢ï¼ˆpollingï¼‰ã€‚ ç”±äºŽ CPU è¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ç§æ¨¡åž‹æ˜¯æ¯”è¾ƒä½Žæ•ˆçš„ã€‚ 1.3 I/O å¤ç”¨ ä½¿ç”¨ select æˆ–è€… poll ç­‰å¾…æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ç­‰å¾…å¤šä¸ªå¥—æŽ¥å­—ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜ä¸ºå¯è¯»ï¼Œè¿™ä¸€è¿‡ç¨‹ä¼šè¢«é˜»å¡žï¼Œå½“æŸä¸€ä¸ªå¥—æŽ¥å­—å¯è¯»æ—¶è¿”å›žã€‚ä¹‹åŽå†ä½¿ç”¨ recvfrom æŠŠæ•°æ®ä»Žå†…æ ¸å¤åˆ¶åˆ°è¿›ç¨‹ä¸­ã€‚ å®ƒå¯ä»¥è®©å•ä¸ªè¿›ç¨‹å…·æœ‰å¤„ç†å¤šä¸ª I/O äº‹ä»¶çš„èƒ½åŠ›ã€‚åˆè¢«ç§°ä¸º Event Driven I/Oï¼Œå³äº‹ä»¶é©±åŠ¨ I/Oã€‚ å¦‚æžœä¸€ä¸ª Web æœåŠ¡å™¨æ²¡æœ‰ I/O å¤ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª Socket è¿žæŽ¥éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹åŽ»å¤„ç†ã€‚å¦‚æžœåŒæ—¶æœ‰å‡ ä¸‡ä¸ªè¿žæŽ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºç›¸åŒæ•°é‡çš„çº¿ç¨‹ã€‚å¹¶ä¸”ç›¸æ¯”äºŽå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ï¼ŒI/O å¤ç”¨ä¸éœ€è¦è¿›ç¨‹çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€ï¼Œç³»ç»Ÿå¼€é”€æ›´å°ã€‚ 1.4 ä¿¡å·é©±åŠ¨ I/O åº”ç”¨è¿›ç¨‹ä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›žï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éžé˜»å¡žçš„ã€‚å†…æ ¸åœ¨æ•°æ®åˆ°è¾¾æ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€ SIGIO ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹åŽåœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨ recvfrom å°†æ•°æ®ä»Žå†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ã€‚ ç›¸æ¯”äºŽéžé˜»å¡žå¼ I/O çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨ I/O çš„ CPU åˆ©ç”¨çŽ‡æ›´é«˜ã€‚ 1.5 å¼‚æ­¥ I/O è¿›è¡Œ aio_read ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›žï¼Œåº”ç”¨è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šè¢«é˜»å¡žï¼Œå†…æ ¸ä¼šåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åŽå‘åº”ç”¨è¿›ç¨‹å‘é€ä¿¡å·ã€‚ å¼‚æ­¥ I/O ä¸Žä¿¡å·é©±åŠ¨ I/O çš„åŒºåˆ«åœ¨äºŽï¼Œå¼‚æ­¥ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡å·é©±åŠ¨ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹å¯ä»¥å¼€å§‹ I/Oã€‚ 1.6 åŒæ­¥ I/O ä¸Žå¼‚æ­¥ I/O åŒæ­¥ I/Oï¼šåº”ç”¨è¿›ç¨‹åœ¨è°ƒç”¨ recvfrom æ“ä½œæ—¶ä¼šé˜»å¡žã€‚ å¼‚æ­¥ I/Oï¼šä¸ä¼šé˜»å¡žã€‚ é˜»å¡žå¼ I/Oã€éžé˜»å¡žå¼ I/Oã€I/O å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/O éƒ½æ˜¯åŒæ­¥ I/Oï¼Œè™½ç„¶éžé˜»å¡žå¼ I/O å’Œä¿¡å·é©±åŠ¨ I/O åœ¨ç­‰å¾…æ•°æ®é˜¶æ®µä¸ä¼šé˜»å¡žï¼Œä½†æ˜¯åœ¨ä¹‹åŽçš„å°†æ•°æ®ä»Žå†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹è¿™ä¸ªæ“ä½œä¼šé˜»å¡žã€‚ 1.7 äº”å¤§ I/O æ¨¡åž‹æ¯”è¾ƒ å‰å››ç§ I/O æ¨¡åž‹çš„ä¸»è¦åŒºåˆ«åœ¨äºŽç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œè€Œç¬¬äºŒä¸ªé˜¶æ®µæ˜¯ä¸€æ ·çš„ï¼šå°†æ•°æ®ä»Žå†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨è¿›ç¨‹ä¼šè¢«é˜»å¡žã€‚ äºŒã€select/poll/epoll è¿™ä¸‰ä¸ªéƒ½æ˜¯ I/O å¤šè·¯å¤ç”¨çš„å…·ä½“å®žçŽ°ï¼Œselect å‡ºçŽ°çš„æœ€æ—©ï¼Œä¹‹åŽæ˜¯ pollï¼Œå†æ˜¯ epollã€‚ 2.1 select fd_set è¡¨ç¤ºæè¿°ç¬¦é›†åˆç±»åž‹ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼šreadsetã€writeset å’Œ exceptsetï¼Œåˆ†åˆ«å¯¹åº”è¯»ã€å†™ã€å¼‚å¸¸æ¡ä»¶çš„æè¿°ç¬¦é›†åˆã€‚ timeout å‚æ•°å‘ŠçŸ¥å†…æ ¸ç­‰å¾…æ‰€æŒ‡å®šæè¿°ç¬¦ä¸­çš„ä»»ä½•ä¸€ä¸ªå°±ç»ªå¯èŠ±å¤šå°‘æ—¶é—´ï¼› æˆåŠŸè°ƒç”¨è¿”å›žç»“æžœå¤§äºŽ 0ï¼›å‡ºé”™è¿”å›žç»“æžœä¸º -1ï¼›è¶…æ—¶è¿”å›žç»“æžœä¸º 0ã€‚ æ¯æ¬¡è°ƒç”¨ select éƒ½éœ€è¦å°† fd_set \*readfds, fd_set \*writefds, fd_set \*exceptfds é“¾è¡¨å†…å®¹å…¨éƒ¨ä»Žåº”ç”¨è¿›ç¨‹ç¼“å†²å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²ã€‚ è¿”å›žç»“æžœä¸­å†…æ ¸å¹¶æ²¡æœ‰å£°æ˜Ž fd_set ä¸­å“ªäº›æè¿°ç¬¦å·²ç»å‡†å¤‡å¥½ï¼Œæ‰€ä»¥å¦‚æžœè¿”å›žå€¼å¤§äºŽ 0 æ—¶ï¼Œåº”ç”¨è¿›ç¨‹éœ€è¦éåŽ†æ‰€æœ‰çš„ fd_setã€‚ select æœ€å¤šæ”¯æŒ 1024 ä¸ªæè¿°ç¬¦ï¼Œå…¶ä¸­ 1024 ç”±å†…æ ¸çš„ FD_SETSIZE å†³å®šã€‚å¦‚æžœéœ€è¦æ‰“ç ´è¯¥é™åˆ¶å¯ä»¥ä¿®æ”¹ FD_SETSIZEï¼Œç„¶åŽé‡æ–°ç¼–è¯‘å†…æ ¸ã€‚ 2.2 poll å®ƒå’Œ select åŠŸèƒ½åŸºæœ¬ç›¸åŒã€‚åŒæ ·éœ€è¦æ¯æ¬¡å°†æè¿°ç¬¦ä»Žåº”ç”¨è¿›ç¨‹å¤åˆ¶åˆ°å†…æ ¸ï¼Œpoll è°ƒç”¨è¿”å›žåŽåŒæ ·éœ€è¦è¿›è¡Œè½®è¯¢æ‰èƒ½çŸ¥é“å“ªäº›æè¿°ç¬¦å·²ç»å‡†å¤‡å¥½ã€‚ poll å–æ¶ˆäº† 1024 ä¸ªæè¿°ç¬¦æ•°é‡ä¸Šé™ï¼Œä½†æ˜¯æ•°é‡å¤ªå¤§ä»¥åŽä¸èƒ½ä¿è¯æ‰§è¡Œæ•ˆçŽ‡ï¼Œå› ä¸ºå¤åˆ¶å¤§é‡å†…å­˜åˆ°å†…æ ¸ååˆ†ä½Žæ•ˆï¼Œæ‰€éœ€æ—¶é—´ä¸Žæè¿°ç¬¦æ•°é‡æˆæ­£æ¯”ã€‚ poll åœ¨æè¿°ç¬¦çš„é‡å¤åˆ©ç”¨ä¸Šæ¯” select çš„ fd_set ä¼šæ›´å¥½ã€‚ å¦‚æžœåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œå¦‚æžœä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªæè¿°ç¬¦è°ƒç”¨äº† poll ç³»ç»Ÿè°ƒç”¨ï¼Œä½†æ˜¯å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†è¯¥æè¿°ç¬¦ï¼Œä¼šå¯¼è‡´ poll è°ƒç”¨ç»“æžœä¸ç¡®å®šï¼Œè¯¥é—®é¢˜åŒæ ·å‡ºçŽ°åœ¨ select ä¸­ã€‚ 2.3 epoll epoll ä»…ä»…é€‚ç”¨äºŽ Linux OSã€‚ å®ƒæ˜¯ select å’Œ poll çš„å¢žå¼ºç‰ˆï¼Œæ›´åŠ çµæ´»è€Œä¸”æ²¡æœ‰æè¿°ç¬¦æ•°é‡é™åˆ¶ã€‚ å®ƒå°†ç”¨æˆ·å…³å¿ƒçš„æè¿°ç¬¦æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œä»Žè€Œåªéœ€è¦åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´æ‹·è´ä¸€æ¬¡ã€‚ select å’Œ poll æ–¹å¼ä¸­ï¼Œè¿›ç¨‹åªæœ‰åœ¨è°ƒç”¨ä¸€å®šçš„æ–¹æ³•åŽï¼Œå†…æ ¸æ‰å¯¹æ‰€æœ‰ç›‘è§†çš„æè¿°ç¬¦è¿›è¡Œæ‰«æã€‚è€Œ epoll äº‹å…ˆé€šè¿‡ epoll_ctl() æ¥æ³¨å†Œæè¿°ç¬¦ï¼Œä¸€æ—¦åŸºäºŽæŸä¸ªæè¿°ç¬¦å°±ç»ªæ—¶ï¼Œå†…æ ¸ä¼šé‡‡ç”¨ç±»ä¼¼ callback çš„å›žè°ƒæœºåˆ¶ï¼Œè¿…é€Ÿæ¿€æ´»è¿™ä¸ªæè¿°ç¬¦ï¼Œå½“è¿›ç¨‹è°ƒç”¨ epoll_wait() æ—¶ä¾¿å¾—åˆ°é€šçŸ¥ã€‚ æ–°ç‰ˆæœ¬çš„ epoll_create(int size) å‚æ•° size ä¸èµ·ä»»ä½•ä½œç”¨ï¼Œåœ¨æ—§ç‰ˆæœ¬çš„ epoll ä¸­å¦‚æžœæè¿°ç¬¦çš„æ•°é‡å¤§äºŽ sizeï¼Œä¸ä¿è¯æœåŠ¡è´¨é‡ã€‚ epoll_ctl() æ‰§è¡Œä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºŽå‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Šï¼Œé€šè¿‡å›žè°ƒå‡½æ•°å†…æ ¸ä¼šå°† I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ç®¡ç†ã€‚ epoll_wait() å–å‡ºåœ¨å†…æ ¸ä¸­é€šè¿‡é“¾è¡¨ç»´æŠ¤çš„ I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦ï¼Œå°†ä»–ä»¬ä»Žå†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ï¼Œä¸éœ€è¦åƒ select/poll å¯¹æ³¨å†Œçš„æ‰€æœ‰æè¿°ç¬¦éåŽ†ä¸€éã€‚ epoll å¯¹å¤šçº¿ç¨‹ç¼–ç¨‹æ›´æœ‰å‹å¥½ï¼ŒåŒæ—¶å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªæè¿°ç¬¦è°ƒç”¨äº† epoll_wait() ä¹Ÿä¸ä¼šäº§ç”Ÿåƒ select/poll çš„ä¸ç¡®å®šæƒ…å†µã€‚æˆ–è€…ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† epoll_wait å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†åŒä¸€ä¸ªæè¿°ç¬¦ä¹Ÿä¸ä¼šäº§ç”Ÿä¸ç¡®å®šæƒ…å†µã€‚ ä¸‰ã€select å’Œ poll æ¯”è¾ƒ 3.1 åŠŸèƒ½ å®ƒä»¬æä¾›äº†å‡ ä¹Žç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨ä¸€äº›ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒï¼š select ä¼šä¿®æ”¹ fd_set å‚æ•°ï¼Œè€Œ poll ä¸ä¼šï¼› select é»˜è®¤åªèƒ½ç›‘å¬ 1024 ä¸ªæè¿°ç¬¦ï¼Œå¦‚æžœè¦ç›‘å¬æ›´å¤šçš„è¯ï¼Œéœ€è¦ä¿®æ”¹ FD_SETSIZE ä¹‹åŽé‡æ–°ç¼–è¯‘ï¼› poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶ç±»åž‹ã€‚ 3.2 é€Ÿåº¦ poll å’Œ select åœ¨é€Ÿåº¦ä¸Šéƒ½å¾ˆæ…¢ã€‚ å®ƒä»¬éƒ½é‡‡å–è½®è¯¢çš„æ–¹å¼æ¥æ‰¾åˆ° I/O å®Œæˆçš„æè¿°ç¬¦ï¼Œå¦‚æžœæè¿°ç¬¦å¾ˆå¤šï¼Œé‚£ä¹ˆé€Ÿåº¦å°±ä¼šå¾ˆæ…¢ï¼› select åªä½¿ç”¨æ¯ä¸ªæè¿°ç¬¦çš„ 3 ä½ï¼Œè€Œ poll é€šå¸¸éœ€è¦ä½¿ç”¨ 64 ä½ï¼Œå› æ­¤ poll éœ€è¦å¤åˆ¶æ›´å¤šçš„å†…æ ¸ç©ºé—´ã€‚ 3.3 å¯ç§»æ¤æ€§ å‡ ä¹Žæ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¾ƒæ–°çš„ç³»ç»Ÿæ”¯æŒ pollã€‚ å››ã€eopll å·¥ä½œæ¨¡å¼ epoll_event æœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚ 4.1 LT æ¨¡å¼ å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚ä¸‹æ¬¡è°ƒç”¨ epoll_wait() æ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚æ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blockingã€‚ 4.2 ET æ¨¡å¼ å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æžœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() æ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆçŽ‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºŽä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡žè¯»/é˜»å¡žå†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚ äº”ã€select poll epoll åº”ç”¨åœºæ™¯ å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ç§é”™è§‰è®¤ä¸ºåªè¦ç”¨ epoll å°±å¯ä»¥äº†ï¼Œselect poll éƒ½æ˜¯åŽ†å²é—ç•™é—®é¢˜ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Œå…¶å®žå¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚ 5.1 select åº”ç”¨åœºæ™¯ select() poll() epoll_wait() éƒ½æœ‰ä¸€ä¸ª timeoutå‚æ•°ï¼Œåœ¨ select() ä¸­ timeout çš„ç²¾ç¡®åº¦ä¸º 1nsï¼Œè€Œ poll() å’Œ epoll_wait() ä¸­åˆ™ä¸º 1msã€‚æ‰€ä»¥ select æ›´åŠ é€‚ç”¨äºŽå®žæ—¶è¦æ±‚æ›´é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æŽ§åˆ¶ã€‚ select åŽ†å²æ›´åŠ æ‚ ä¹…ï¼Œå®ƒçš„å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹Žè¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚ 5.2 poll åº”ç”¨åœºæ™¯ poll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æžœå¹³å°æ”¯æŒåº”è¯¥é‡‡ç”¨ poll ä¸”å¯¹å®žæ—¶æ€§è¦æ±‚å¹¶ä¸æ˜¯ååˆ†ä¸¥æ ¼ï¼Œè€Œä¸æ˜¯ selectã€‚ éœ€è¦åŒæ—¶ç›‘æŽ§å°äºŽ 1000 ä¸ªæè¿°ç¬¦ã€‚é‚£ä¹ˆä¹Ÿæ²¡æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“çŽ° epoll çš„ä¼˜åŠ¿ã€‚ éœ€è¦ç›‘æŽ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éžå¸¸çŸ­æš‚çš„ã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½Žæ•ˆçŽ‡ã€‚epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•ã€‚ 5.3 epoll åº”ç”¨åœºæ™¯ ç¨‹åºåªéœ€è¦è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰éžå¸¸å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œè€Œä¸”è¿™äº›è¿žæŽ¥æœ€å¥½æ˜¯é•¿è¿žæŽ¥ã€‚ å…­ã€å¯¹æ¯” ä¸¾ä¾‹è¯´æ˜Žï¼šè€å¸ˆæ”¶å­¦ç”Ÿä½œä¸šï¼Œç›¸å½“äºŽåº”ç”¨å±‚è°ƒç”¨I/Oæ“ä½œã€‚ 1ã€è€å¸ˆé€ä¸ªæ”¶å­¦ç”Ÿä½œä¸šï¼Œå­¦ç”Ÿæ²¡æœ‰åšå®Œï¼Œåªèƒ½é˜»å¡žç­‰å¾…ï¼Œæ”¶äº†ä¹‹åŽï¼Œå†åŽ»æ”¶ä¸‹ä¸€ä¸ªå­¦ç”Ÿçš„ä½œä¸šã€‚è¿™æ˜¾ç„¶å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚ 2ã€æ€Žä¹ˆè§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Ÿ è€å¸ˆæ‰¾ä¸ªç­é•¿ï¼Œç­é•¿è´Ÿè´£æ”¶ä½œä¸šï¼Œç­é•¿çš„åšæ³•æ˜¯ï¼šéåŽ†é—®å­¦ç”Ÿä½œä¸šå†™å¥½äº†å—ï¼Œå†™å¥½çš„ï¼Œæ”¶èµ·æ¥äº¤ç»™è€å¸ˆã€‚ä¼‘æ¯ä¸€ä¼šï¼Œå†åŽ»éåŽ†ã€‚ã€‚ã€‚ è¿™ä¸ªç­é•¿å°±æ˜¯selectã€‚ å­˜åœ¨é—®é¢˜ è¿™ä¸ªç­é•¿è¿˜æœ‰ä¸€ä¸ªèƒ½åŠ›é—®é¢˜ï¼Œæœ€å¤šåªèƒ½ç®¡ç†1024ä¸ªå­¦ç”Ÿã€‚ å¾ˆå¤šå­¦ç”Ÿçš„ä½œä¸šæ²¡æœ‰å†™å¥½ï¼Œè€Œä¸”çŸ­æ—¶é—´å†™ä¸å¥½ï¼Œç­é•¿è¿˜æ˜¯ä¸åœåœ°éåŽ†åŽ»é—®ï¼Œå½±å“æ•ˆçŽ‡ã€‚ æ€Žä¹ˆè§£å†³é—®é¢˜1ç­é•¿çš„èƒ½åŠ›é—®é¢˜ï¼Ÿ æ¢ä¸€ä¸ªèƒ½åŠ›æ›´å¼ºçš„ç­é•¿ï¼Œå¯ä»¥ç®¡ç†æ›´å¤šçš„å­¦ç”Ÿï¼Œè¿™ä¸ªç­é•¿å°±æ˜¯pollã€‚ æ€Žä¹ˆè§£å†³é—®é¢˜1ã€2ï¼Œå­˜åœ¨çš„èƒ½åŠ›é—®é¢˜å’Œæ•ˆçŽ‡é—®é¢˜ï¼Ÿ æ¢ä¸€ä¸ªèƒ½åŠ›è¶…çº§å¼ºçš„ç­é•¿ï¼Œå¯ä»¥ç®¡ç†æ— é™å¤šçš„å­¦ç”Ÿï¼ŒåŒæ—¶ç­é•¿çš„åšæ³•æ˜¯ï¼šéåŽ†ä¸€æ¬¡æ‰€æœ‰çš„å­¦ç”Ÿï¼Œå¦‚æžœä½œä¸šæ²¡æœ‰å†™å®Œï¼Œå‘Šè¯‰å­¦ç”Ÿå†™å¥½ä¹‹åŽï¼Œæ”¾åœ¨ä¸€ä¸ªå›ºå®šçš„åœ°æ–¹ã€‚è¿™æ ·çš„è¯ï¼Œç­é•¿åªéœ€è¦å®šæœŸåˆ°è¿™ä¸ªåœ°æ–¹å–ä½œä¸šå°±å¥½äº†ã€‚è¿™å°±æ˜¯epollã€‚ å‚è€ƒï¼š socket ç†è§£ select poll epoll]]></content>
      <tags>
        <tag>Socket</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹æ³›åž‹ä¸‹]]></title>
    <url>%2F2019%2F02%2F19%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%B3%9B%E5%9E%8B%E4%B8%8B%2F</url>
    <content type="text"><![CDATA[æœ¬èŠ‚ç»§ç»­è®¨è®ºæ³›åž‹ç›¸å…³çš„çŸ¥è¯†ã€‚ 6ã€æ³›åž‹ä¸Šä¸‹è¾¹ç•Œ æˆ‘ä»¬å†æ¥è®¨è®ºè®¨è®ºé€šé…ç¬¦ã€‚ é€šé…ç¬¦æœ‰2ç§ï¼š æ— è¾¹ç•Œé€šé…ç¬¦ï¼Œç”¨&lt;?&gt;è¡¨ç¤ºã€‚ æœ‰è¾¹ç•Œé€šé…ç¬¦ï¼Œç”¨&lt;? extends Object&gt;æˆ–è€…&lt;? super Object&gt;æ¥è¡¨ç¤ºã€‚ï¼ˆObjectä»…ä»…æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼‰ 6.1 æ— è¾¹ç•Œ 123List&lt;?&gt; list = new ArrayList&lt;String&gt;(); // åˆæ³•List&lt;?&gt; list = new ArrayList&lt;?&gt;(); // ä¸åˆæ³•List&lt;String&gt; list = new ArrayList&lt;?&gt;(); // ä¸åˆæ³• å¯¹äºŽå¸¦æœ‰é€šé…ç¬¦çš„å¼•ç”¨å˜é‡ï¼Œæ˜¯ä¸èƒ½è°ƒç”¨å…·æœ‰ä¸Žæ³›åž‹å‚æ•°æœ‰å…³çš„æ–¹æ³•çš„ã€‚ 1234List&lt;?&gt; list = new ArrayList&lt;String&gt;();list.add(1); // ç¼–è¯‘ä¸é€šè¿‡list.get(0); // ç¼–è¯‘é€šè¿‡int size = list.size(); // ç”±äºŽsize()æ–¹æ³•ä¸­ä¸å«æ³›åž‹å‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨é€šé…ç¬¦å˜é‡ä¸­è°ƒç”¨ æ€»ç»“èµ·æ¥ï¼Œæ— è¾¹ç•Œé€šé…ç¬¦ä¸»è¦ç”¨åšå¼•ç”¨ï¼Œå¯ä»¥è°ƒç”¨ä¸Žæ³›åž‹å‚æ•°æ— å…³çš„æ–¹æ³•ï¼Œä¸èƒ½è°ƒç”¨å‚æ•°ä¸­åŒ…å«æ³›åž‹å‚æ•°çš„æ–¹æ³•ã€‚ 6.2 æœ‰è¾¹ç•Œ åœ¨ä½¿ç”¨æ³›åž‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºä¼ å…¥çš„æ³›åž‹ç±»åž‹å®žå‚è¿›è¡Œä¸Šä¸‹è¾¹ç•Œçš„é™åˆ¶ï¼Œå¦‚ï¼šç±»åž‹å®žå‚åªå‡†ä¼ å…¥æŸç§ç±»åž‹çš„çˆ¶ç±»æˆ–æŸç§ç±»åž‹çš„å­ç±»ã€‚ ä¸Šè¾¹ç•Œé€šé…ï¼Œç”¨&lt;? extends ç±»åž‹&gt;è¡¨ç¤ºã€‚å…¶è¯­æ³•ä¸ºï¼š 1List&lt;? extends ç±»åž‹1&gt; x = new ArrayList&lt;ç±»åž‹2&gt;(); å…¶ä¸­ï¼Œç±»åž‹2å°±åªèƒ½æ˜¯ç±»åž‹1æˆ–è€…æ˜¯ç±»åž‹1çš„å­ç±»ã€‚ä¸‹é¢ä»£ç éªŒè¯åˆæ³•æ€§ã€‚ 12List&lt;? extends Number&gt; x = new ArrayList&lt;Integer&gt;(); //ç”±äºŽIntegeræ˜¯Numberçš„å­ç±»ï¼Œè¿™æ˜¯åˆæ³•çš„List&lt;? extends Number&gt; x = new ArrayList&lt;String&gt;(); //ç”±äºŽStringä¸æ˜¯Numberçš„å­ç±»ï¼Œè¿™æ˜¯ä¸åˆæ³•çš„ ä¸‹è¾¹ç•Œé€šé…ï¼Œç”¨&lt;? super ç±»åž‹&gt;è¡¨ç¤ºã€‚å…¶è¯­æ³•ä¸ºï¼š 1List&lt;? super ç±»åž‹1&gt; x = new ArrayList&lt;ç±»åž‹2&gt;(); å…¶ä¸­ï¼Œç±»åž‹2å°±åªèƒ½æ˜¯ç±»åž‹1æˆ–è€…æ˜¯ç±»åž‹1çš„è¶…ç±»ã€‚ä¸‹é¢ä»£ç æœ‰éªŒè¯åˆæ³•æ€§ã€‚ 12List&lt;? super Integer&gt; x = new ArrayList&lt;Number&gt;(); //ç”±äºŽNumberæ˜¯Integerçš„è¶…ç±»ï¼Œè¿™æ˜¯åˆæ³•çš„List&lt;? super Integer&gt; x = new ArrayList&lt;String&gt;(); //ç”±äºŽStringä¸æ˜¯Integerçš„è¶…ç±»ï¼Œè¿™æ˜¯ä¸åˆæ³•çš„ é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä¸‹è¾¹ç•Œé€šé…ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä¸Šè¾¹ç•Œé€šé…å‘¢ï¼Ÿé¦–å…ˆè€ƒè™‘ä¸€ä¸‹æ€Žæ ·æ‰èƒ½ä¿è¯ä¸ä¼šå‘ç”Ÿè¿è¡Œæ—¶å¼‚å¸¸ï¼Œè¿™æ˜¯æ³›åž‹è¦è§£å†³çš„é¦–è¦é—®é¢˜ï¼Œé€šè¿‡å‰é¢çš„å†…å®¹å¯ä»¥çœ‹åˆ°ï¼Œä»»ä½•å¯èƒ½å¯¼è‡´ç±»åž‹è½¬æ¢å¼‚å¸¸çš„æ“ä½œéƒ½æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚ â­ä¸Šè¾¹ç•Œé€šé…ï¼šå¯ä»¥ä¿è¯å­˜æ”¾çš„å®žé™…å¯¹è±¡è‡³å¤šæ˜¯ä¸Šè¾¹ç•ŒæŒ‡å®šçš„ç±»åž‹ï¼Œé‚£ä¹ˆåœ¨è¯»å–å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥æ”¾å¿ƒåœ°å°†å¯¹è±¡èµ‹äºˆä¸Šè¾¹ç•Œç±»åž‹çš„å¼•ç”¨ã€‚ 1234List&lt;Integer&gt; list1 = new ArrayList&lt;Integer&gt;();list1.add(1);List&lt;? extends Number&gt; list2 = list1;Number a = list2.get(0); // ç¼–è¯‘é€šè¿‡ â­ä¸‹è¾¹ç•Œé€šé…ï¼šå¯ä»¥ä¿è¯å­˜æ”¾çš„å®žé™…å¯¹è±¡è‡³å°‘æ˜¯ä¸‹è¾¹ç•ŒæŒ‡å®šçš„ç±»åž‹ï¼Œé‚£ä¹ˆåœ¨å­˜å…¥å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥æ”¾å¿ƒåœ°å°†ä¸‹è¾¹ç•Œç±»åž‹çš„å¯¹è±¡å­˜å…¥æ³›åž‹å¯¹è±¡ä¸­ã€‚ 123List&lt;? super Integer&gt; list3 = new ArrayList&lt;Number&gt;();list3.add(1);list3.add(2); æ€»ç»“ï¼š å¦‚æžœä½ æƒ³ä»Žä¸€ä¸ªæ•°æ®ç±»åž‹é‡ŒèŽ·å–æ•°æ®ï¼Œä½¿ç”¨ ? extends é€šé…ç¬¦ã€‚ å¦‚æžœä½ æƒ³æŠŠå¯¹è±¡å†™å…¥ä¸€ä¸ªæ•°æ®ç»“æž„é‡Œï¼Œä½¿ç”¨ ? super é€šé…ç¬¦ã€‚ å¦‚æžœä½ æ—¢æƒ³å­˜ï¼Œåˆæƒ³å–ï¼Œé‚£å°±åˆ«ç”¨é€šé…ç¬¦ã€‚ å¯¹äºŽæ³›åž‹æ–¹æ³•æ·»åŠ ä¸Šä¸‹è¾¹ç•Œï¼š 1234567//åœ¨æ³›åž‹æ–¹æ³•ä¸­æ·»åŠ ä¸Šä¸‹è¾¹ç•Œé™åˆ¶çš„æ—¶å€™ï¼Œå¿…é¡»åœ¨æƒé™å£°æ˜Žä¸Žè¿”å›žå€¼ä¹‹é—´çš„&lt;T&gt;ä¸Šæ·»åŠ ä¸Šä¸‹è¾¹ç•Œï¼Œå³åœ¨æ³›åž‹å£°æ˜Žçš„æ—¶å€™æ·»åŠ //public &lt;T&gt; T showKeyName(Generic&lt;T extends Number&gt; container)ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼š"Unexpected bound"public &lt;T extends Number&gt; T showKeyName(Generic&lt;T&gt; container)&#123; System.out.println("container key :" + container.getKey()); T test = container.getKey(); return test;&#125; 7ã€æ³›åž‹çš„åŽŸç† 7.1 ç±»åž‹æ“¦é™¤ Javaä¸­çš„æ³›åž‹æ˜¯é€šè¿‡ç±»åž‹æ“¦é™¤æ¥å®žçŽ°çš„ã€‚æ‰€è°“ç±»åž‹æ“¦é™¤ï¼Œæ˜¯æŒ‡é€šè¿‡ç±»åž‹å‚æ•°åˆå¹¶ï¼Œå°†æ³›åž‹ç±»åž‹å®žä¾‹å…³è”åˆ°åŒä¸€ä»½å­—èŠ‚ç ä¸Šã€‚ç¼–è¯‘å™¨åªä¸ºæ³›åž‹ç±»åž‹ç”Ÿæˆä¸€ä»½å­—èŠ‚ç ï¼Œå¹¶å°†å…¶å®žä¾‹å…³è”åˆ°è¿™ä»½å­—èŠ‚ç ä¸Šã€‚ç±»åž‹æ“¦é™¤çš„å…³é”®åœ¨äºŽä»Žæ³›åž‹ç±»åž‹ä¸­æ¸…é™¤ç±»åž‹å‚æ•°çš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶ä¸”å†å¿…è¦çš„æ—¶å€™æ·»åŠ ç±»åž‹æ£€æŸ¥å’Œç±»åž‹è½¬æ¢çš„æ–¹æ³•ã€‚ ä¸‹é¢é€šè¿‡ä¸¤ä¸ªä¾‹å­æ¥è¯æ˜Žåœ¨ç¼–è¯‘æ—¶ç¡®å®žå‘ç”Ÿäº†ç±»åž‹æ“¦é™¤ã€‚ ä¾‹1åˆ†åˆ«åˆ›å»ºå®žé™…ç±»åž‹ä¸ºStringå’ŒIntegerçš„ArrayListå¯¹è±¡ï¼Œé€šè¿‡getClass()æ–¹æ³•èŽ·å–ä¸¤ä¸ªå®žä¾‹çš„ç±»ï¼Œæœ€åŽåˆ¤æ–­è¿™ä¸ªå®žä¾‹çš„ç±»æ˜¯ç›¸ç­‰çš„ï¼Œè¯æ˜Žä¸¤ä¸ªå®žä¾‹å…±äº«åŒä¸€ä¸ªç±»ã€‚ ä¾‹2åˆ›å»ºä¸€ä¸ªåªèƒ½å­˜å‚¨Integerçš„ArrayListå¯¹è±¡ï¼Œåœ¨addä¸€ä¸ªæ•´åž‹æ•°å€¼åŽï¼Œåˆ©ç”¨åå°„è°ƒç”¨add(Object o) addä¸€ä¸ªasdå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è¿è¡Œä»£ç ä¸ä¼šæŠ¥é”™ï¼Œè¿è¡Œç»“æžœä¼šæ‰“å°å‡º1å’Œasdä¸¤ä¸ªå€¼ã€‚è¿™æ—¶å†é‡Œåˆ©ç”¨åå°„è°ƒç”¨add(Integer o)æ–¹æ³•ï¼Œè¿è¡Œä¼šæŠ›å‡ºcodeNoSuchMethodExceptionå¼‚å¸¸ã€‚è¿™å……åˆ†è¯æ˜Žäº†åœ¨ç¼–è¯‘åŽï¼Œæ“¦é™¤äº†Integerè¿™ä¸ªæ³›åž‹ä¿¡æ¯ï¼Œåªä¿ç•™äº†åŽŸå§‹ç±»åž‹ã€‚ 7.2 è‡ªåŠ¨ç±»åž‹è½¬æ¢ ä¸Šä¸€èŠ‚ä¸Šè¯´åˆ°äº†ç±»åž‹æ“¦é™¤ï¼ŒJavaç¼–è¯‘å™¨ä¼šæ“¦é™¤æŽ‰æ³›åž‹ä¿¡æ¯ã€‚é‚£ä¹ˆè°ƒç”¨ArrayListçš„get()æœ€ç»ˆè¿”å›žçš„å¿…ç„¶ä¼šæ˜¯ä¸€ä¸ªObjectå¯¹è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æºä»£ç å¹¶æ²¡æœ‰å†™è¿‡Objectè½¬æˆIntegerçš„ä»£ç ï¼Œä¸ºä»€ä¹ˆå°±èƒ½â€œç›´æŽ¥â€å°†å–å‡ºæ¥çš„å¯¹è±¡èµ‹äºˆä¸€ä¸ªIntegerç±»åž‹çš„å˜é‡å‘¢ï¼ˆå¦‚ä¸‹é¢çš„ä»£ç ç¬¬12è¡Œï¼‰ï¼Ÿ å®žé™…ä¸Šï¼ŒJavaçš„æ³›åž‹é™¤äº†ç±»åž‹æ“¦é™¤ä¹‹å¤–ï¼Œè¿˜ä¼šè‡ªåŠ¨ç”ŸæˆcheckcastæŒ‡ä»¤è¿›è¡Œå¼ºåˆ¶ç±»åž‹è½¬æ¢ã€‚ä¸Šé¢çš„ä»£ç ä¸­çš„mainæ–¹æ³•ç¼–è¯‘åŽæ‰€å¯¹åº”çš„å­—èŠ‚ç å¦‚ä¸‹ã€‚ çœ‹åˆ°ç¬¬26è¡Œä»£ç å°±æ˜¯å°†Objectç±»åž‹çš„å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºIntegerçš„æŒ‡ä»¤ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥å°†ä¸Šé¢çš„ä»£ç è½¬æ¢ä¸ºä¸‹é¢çš„ä»£ç ï¼Œå®ƒæ‰€å®žçŽ°çš„æ•ˆæžœè·Ÿä¸Šé¢çš„æ³›åž‹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚æ—¢ç„¶æ³›åž‹ä¹Ÿéœ€è¦è¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼Œæ‰€ä»¥æ³›åž‹å¹¶ä¸ä¼šæä¾›è¿è¡Œæ—¶æ•ˆçŽ‡ï¼Œä¸è¿‡å¯ä»¥å¤§å¤§é™ä½Žç¼–ç¨‹æ—¶çš„å‡ºé”™æ¦‚çŽ‡ã€‚ 8ã€ç®€å•æ€»ç»“ 8.1 ç±»åž‹æ“¦é™¤(Type Erasure) Java çš„æ³›åž‹æ˜¯åœ¨ç¼–è¯‘å™¨å±‚æ¬¡å®žçŽ°çš„ã€‚ åœ¨ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç ä¸­ä¸åŒ…å«æ³›åž‹ä¸­çš„ç±»åž‹å‚æ•°ï¼Œç±»åž‹å‚æ•°ä¼šåœ¨ç¼–è¯‘æ—¶åŽ»æŽ‰ã€‚ ä¾‹å¦‚ï¼šList&lt;String&gt; å’Œ List&lt;Integer&gt; åœ¨ç¼–è¯‘åŽéƒ½å˜æˆ Listã€‚ ç±»åž‹æ“¦é™¤çš„åŸºæœ¬è¿‡ç¨‹ï¼šå°†ä»£ç ä¸­çš„ç±»åž‹å‚æ•°æ›¿æ¢ä¸ºå…·ä½“çš„ç±»ï¼ŒåŒæ—¶åŽ»æŽ‰ &lt;&gt; çš„å†…å®¹ã€‚ 8.2 æ³›åž‹çš„ä¼˜åŠ¿ ç¼–è¯‘æ—¶æ›´å¼ºå¤§çš„ç±»åž‹æ£€æµ‹ã€‚ ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼šæ–¹æ³•ä¼ å…¥ä¸€ä¸ªStringå¯¹è±¡ï¼Œä¼ å‡ºä¸€ä¸ªString å¯¹è±¡ï¼Œå¹¶å¼ºåˆ¶è½¬æ¢ä¸ºIntegerå¯¹è±¡ã€‚è¿™æ®µä»£ç ç¼–è¯‘å¯ä»¥é€šè¿‡ï¼Œå› ä¸ºéƒ½æ˜¯Objectçš„å­ç±»ï¼Œä½†æ˜¯è¿è¡Œæ—¶ä¼šäº§ç”ŸClassCastExceptionã€‚ è€Œå¦‚æžœé€šè¿‡æ³›åž‹æ¥å®žçŽ°ï¼Œåˆ™ä¼šåœ¨ç¼–è¯‘æ—¶è¿›è¡Œç±»åž‹çš„æ£€æµ‹ã€‚ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼šä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚ æä¾›è‡ªåŠ¨å’Œéšå¼çš„ç±»åž‹è½¬æ¢ 8.3 &lt;T&gt; VS &lt;?&gt; ä¸åŒç‚¹ï¼š &lt;T&gt;ç”¨äºŽæ³›åž‹çš„å®šä¹‰ï¼Œä¾‹å¦‚class MyGeneric&lt;T&gt; {...} &lt;?&gt;ç”¨äºŽæ³›åž‹çš„å£°æ˜Žï¼Œå³æ³›åž‹çš„ä½¿ç”¨ï¼Œä¾‹å¦‚MyGeneric&lt;?&gt; g = new MyGeneric&lt;&gt;(); ç›¸åŒç‚¹ï¼šéƒ½å¯ä»¥æŒ‡å®šä¸Šç•Œå’Œä¸‹ç•Œ: 8.4 &lt;?&gt;ä¸åŒäºŽ&lt;Object&gt; æŒ‡å®šæœªçŸ¥ç±»åž‹ï¼Œå¦‚List&lt;?&gt;ã€‚List&lt;?&gt;ä¸ç­‰äºŽList&lt;Object&gt; Stringæ˜¯Objectçš„å­ç±»ï¼Œä½†æ˜¯List&lt;String&gt;ä¸æ˜¯List&lt;Object&gt;çš„å­ç±»ã€‚ å¦‚æžœå°†List&lt;Object&gt;æ¢æˆList&lt;?&gt;ï¼Œåˆ™å¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚ æ³¨æ„ï¼š ç›¸åŒå‚æ•°ç±»åž‹çš„æ³›åž‹ç±»çš„ç»§æ‰¿å…³ç³»å–å†³äºŽæ³›åž‹ç±»è‡ªèº«çš„ç»§æ‰¿ç»“æž„ã€‚ ä¾‹å¦‚List&lt;String&gt;æ˜¯Collection&lt;String&gt;çš„å­ç±» å½“ç±»åž‹å£°æ˜Žä¸­ä½¿ç”¨é€šé…ç¬¦?æ—¶ï¼Œå…¶å­ç±»åž‹å¯ä»¥åœ¨ä¸¤ä¸ªç»´åº¦ä¸Šæ‰©å±•ã€‚ 123ä¾‹å¦‚ Collection&lt;? extends Number&gt;åœ¨ç»´åº¦1ä¸Šæ‰©å±•ï¼šList&lt;? extends Number&gt;åœ¨ç»´åº¦2ä¸Šæ‰©å±•ï¼šCollection&lt;Integer&gt; 9ã€Javaæ³›åž‹ä¸­Listã€List&lt;Object&gt;ã€List&lt;?&gt;çš„åŒºåˆ« Listï¼šåŽŸç”Ÿæ€ç±»åž‹ List&lt;Object&gt;ï¼šå‚æ•°åŒ–çš„ç±»åž‹ï¼Œè¡¨æ˜ŽListä¸­å¯ä»¥å®¹çº³ä»»æ„ç±»åž‹çš„å¯¹è±¡ List&lt;?&gt;ï¼šæ— é™å®šé€šé…ç¬¦ç±»åž‹ï¼Œè¡¨ç¤ºåªèƒ½åŒ…å«æŸä¸€ç§æœªçŸ¥å¯¹è±¡ç±»åž‹ æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªList&lt;String&gt;ç±»åž‹çš„å¯¹è±¡stringsï¼Œå†æŠŠå®ƒèµ‹ç»™åŽŸç”Ÿæ€ç±»åž‹Listï¼Œè¿™æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ç¬¬5è¡Œä¸­å°è¯•æŠŠå®ƒä¼ é€’ç»™List&lt;Object&gt;æ—¶ï¼Œå‡ºçŽ°äº†ä¸€ä¸ªç±»åž‹ä¸ç›¸å®¹é”™è¯¯ï¼Œæ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªç¼–è¯‘æœŸé”™è¯¯ã€‚ è¿™æ˜¯å› ä¸ºæ³›åž‹æœ‰å­ç±»åž‹åŒ–çš„è§„åˆ™ï¼š List&lt;String&gt;æ˜¯åŽŸç”Ÿæ€ç±»åž‹Listçš„ä¸€ä¸ªå­ç±»åž‹ã€‚è™½ç„¶Stringæ˜¯Objectçš„å­ç±»åž‹ï¼Œä½†æ˜¯ç”±äºŽæ³›åž‹æ˜¯ä¸å¯åå˜çš„ï¼ŒList&lt;String&gt;å¹¶ä¸æ˜¯List&lt;Object&gt;çš„å­ç±»åž‹ï¼Œæ‰€ä»¥è¿™é‡Œçš„ä¼ é€’æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ List&lt;Object&gt;å”¯ä¸€ç‰¹æ®Šçš„åœ°æ–¹åªæ˜¯Objectæ˜¯æ‰€æœ‰ç±»åž‹çš„è¶…ç±»ï¼Œç”±äºŽæ³›åž‹çš„ä¸å¯åå˜æ€§ï¼Œå®ƒåªèƒ½è¡¨ç¤ºListä¸­å¯ä»¥å®¹çº³æ‰€æœ‰ç±»åž‹çš„å¯¹è±¡ï¼Œå´ä¸èƒ½è¡¨ç¤ºä»»ä½•å‚æ•°ç±»åž‹çš„List&lt;E&gt;ã€‚ è¾“å‡ºç»“æžœï¼š 1211sss æ€»ç»“ï¼š List&lt;Object&gt;:è¡¨ç¤ºå¯ç”¨è£…è½½ä»»æ„ç±»åž‹çš„å¯¹è±¡ï¼Œå¦‚ä¸Šé¢æœ€åŽä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯ä»–ä¸èƒ½æŽ¥å—List&lt;String&gt;çš„æ›¿æ¢ï¼Œå› ä¸ºä¸å…·æœ‰ç»§æ‰¿æ€§ï¼Œå¹¶ä¸”List&lt;Object&gt;å¦‚æžœå¯ä»¥è¢«List&lt;String&gt;ï¼Œå°±ä¸ç¬¦åˆåŽŸåˆ™äº†ï¼Œå› ä¸ºList&lt;String&gt;åªèƒ½æŽ¥å—Stringç±»åž‹çš„å¯¹è±¡ã€‚ List&lt;?&gt;:è§£å†³ä¸Šé¢è¡¨é¢æœ‰ç»§æ‰¿å…³ç³»çš„Listçš„èµ‹å€¼é—®é¢˜ï¼Œè¿˜æœ‰å°±æ˜¯ï¼Œä»–æ˜¯ç”¨ä½œå£°æ˜Žèƒ½æŽ¥æ”¶ä¸€ç§æœªçŸ¥å¯¹è±¡ç±»åž‹ï¼Œè€Œä¸æ˜¯å¤§æ‚çƒ©å•¥éƒ½èƒ½æŽ¥æ”¶ã€‚ Listï¼šåŽŸå§‹ç±»åž‹ï¼Œå•¥éƒ½æ²¡æœ‰é™åˆ¶ã€‚ä¸ªäººè®¤ä¸ºä¸ŽList&lt;Object&gt;ç±»ä¼¼ï¼Œä½†æ˜¯åˆæ²¡æœ‰ç»§æ‰¿çš„é™åˆ¶ã€‚å³å•¥ç±»åž‹éƒ½å¯ä»¥æŽ¥æ”¶ã€‚ 10ã€å‚è€ƒ http://hinylover.space/2016/06/25/relearn-java-generic-1/ java æ³›åž‹è¯¦è§£ https://www.cnblogs.com/rese-t/p/8158870.html]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹æ³›åž‹ä¸Š]]></title>
    <url>%2F2019%2F02%2F19%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%B3%9B%E5%9E%8B%E4%B8%8A%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡æ–‡ç« å…¨é¢ä»‹ç»Javaæ³›åž‹ä¸­çš„åŸºç¡€åŠåŽŸç†ã€‚æœ¬èŠ‚ä¸»è¦ä»‹ç»ä»€ä¹ˆæ˜¯æ³›åž‹ã€æ³›åž‹çš„æ ¸å¿ƒç‰¹æ€§ã€æ³›åž‹ä¸Žç»§æ‰¿æ³¨æ„ç‚¹ã€æ³›åž‹ä¸Žå¤šæ€çš„åŽŸç†ä»¥åŠæ³›åž‹çš„ä½¿ç”¨ã€‚ 1ã€ä»€ä¹ˆæ˜¯æ³›åž‹ä»¥åŠä¸ºä»€ä¹ˆç”¨æ³›åž‹ ç›´æŽ¥ä¸Šä¾‹å­è¿›è¡Œè¯´æ˜Žï¼š æ¯«æ— ç–‘é—®ï¼Œç¨‹åºçš„è¿è¡Œç»“æžœä¼šä»¥å´©æºƒç»“æŸï¼š 1java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.String ä¸ºä»€ä¹ˆä¼šå‡ºçŽ°è¿™ç§é—®é¢˜å‘¢ï¼Ÿ é›†åˆæœ¬èº«æ— æ³•å¯¹å…¶å­˜æ”¾çš„å¯¹è±¡ç±»åž‹è¿›è¡Œé™å®šï¼Œå¯ä»¥æ¶µç›–Javaä¸­çš„æ‰€æœ‰ç±»åž‹ã€‚ç¼ºå£å¤ªå¤§ï¼Œå¯¼è‡´å„ç§è›‡ã€èšã€è™«ã€é¼ é€šé€šéƒ½å¯ä»¥è¿›æ¥ã€‚ ç”±äºŽæˆ‘ä»¬è¦ä½¿ç”¨çš„å®žé™…å­˜æ”¾ç±»åž‹çš„æ–¹æ³•ï¼Œæ‰€ä»¥ä¸å¯é¿å…åœ°è¦è¿›è¡Œç±»åž‹è½¬æ¢ã€‚å°å¯¹è±¡è½¬å¤§å¯¹è±¡å¾ˆå®¹æ˜“ï¼Œå¤§å¯¹è±¡è½¬å°å¯¹è±¡åˆ™æœ‰å¾ˆå¤§çš„é£Žé™©ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æ—¶ï¼Œæˆ‘ä»¬æ— ä»Žå¾—çŸ¥å¯¹è±¡çœŸæ­£çš„ç±»åž‹ã€‚ æ³›åž‹å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜è€Œè¯žç”Ÿçš„ã€‚ 2ã€æ³›åž‹çš„ç‰¹æ€§ 2.1 æ³›åž‹åªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆ è¾“å‡ºç»“æžœï¼šç±»åž‹ç›¸åŒ é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥è¯æ˜Žï¼Œåœ¨ç¼–è¯‘ä¹‹åŽç¨‹åºä¼šé‡‡å–åŽ»æ³›åž‹åŒ–çš„æŽªæ–½ã€‚ä¹Ÿå°±æ˜¯è¯´Javaä¸­çš„æ³›åž‹ï¼Œåªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆã€‚åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæ­£ç¡®æ£€éªŒæ³›åž‹ç»“æžœåŽï¼Œä¼šå°†æ³›åž‹çš„ç›¸å…³ä¿¡æ¯æ“¦é™¤ï¼Œå¹¶ä¸”åœ¨å¯¹è±¡è¿›å…¥å’Œç¦»å¼€æ–¹æ³•çš„è¾¹ç•Œå¤„æ·»åŠ ç±»åž‹æ£€æŸ¥å’Œç±»åž‹è½¬æ¢çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ³›åž‹ä¿¡æ¯ä¸ä¼šè¿›å…¥åˆ°è¿è¡Œæ—¶é˜¶æ®µã€‚ å¯¹æ­¤æ€»ç»“æˆä¸€å¥è¯ï¼šæ³›åž‹ç±»åž‹åœ¨é€»è¾‘ä¸Šçœ‹ä»¥çœ‹æˆæ˜¯å¤šä¸ªä¸åŒçš„ç±»åž‹ï¼Œå®žé™…ä¸Šéƒ½æ˜¯ç›¸åŒçš„åŸºæœ¬ç±»åž‹ã€‚ 2.2 æ³›åž‹çš„å…¼å®¹æ€§ Javaç¼–è¯‘å™¨æ˜¯å‘åŽå…¼å®¹çš„ï¼Œä¹Ÿå°±æ˜¯ä½Žç‰ˆæœ¬çš„æºä»£ç å¯ä»¥ç”¨é«˜ç‰ˆæœ¬ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ã€‚ä¸‹é¢æ¥çœ‹çœ‹é‚£äº›å…¼å®¹æ€§ä»£ç ã€‚ å¼•ç”¨å’Œå®žä¾‹åŒ–éƒ½ä¸åŒ…å«æ³›åž‹ä¿¡æ¯ã€‚ ä¸Šé¢çš„è¿™æ®µä»£ç æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ï¼Œè¿™æ˜¯JDK1.4ä¹‹å‰çš„å†™æ³•ï¼Œæ‰€ä»¥å¯ä»¥éªŒè¯JDK1.5ä¹‹åŽçš„ç¼–è¯‘å™¨æ˜¯å¯ä»¥å…¼å®¹JDK1.4ä¹‹å‰çš„æºä»£ç çš„ã€‚ä¸è¿‡ï¼Œç¬”è€…åœ¨JDK1.8.xç‰ˆæœ¬çš„ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶ï¼Œä¼šæŠ›å‡ºå¦‚ä¸‹æ‰€ç¤ºçš„è­¦å‘Šä¿¡æ¯ã€‚å¾ˆæ˜¾ç„¶ï¼Œå¦‚æžœç±»è¢«å®šä¹‰æˆæ³›åž‹ç±»ï¼Œä½†æ˜¯åœ¨å®žé™…ä½¿ç”¨æ—¶ä¸ä½¿ç”¨æ³›åž‹ç‰¹æ€§ï¼Œè¿™æ˜¯ä¸æŽ¨èçš„åšæ³•ï¼ 12æ³¨: Compatibility.javaä½¿ç”¨äº†æœªç»æ£€æŸ¥æˆ–ä¸å®‰å…¨çš„æ“ä½œã€‚æ³¨: æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·ä½¿ç”¨ -Xlint:unchecked é‡æ–°ç¼–è¯‘ã€‚ å¼•ç”¨ä½¿ç”¨æ³›åž‹ï¼Œå®žä¾‹åŒ–ä¸ä½¿ç”¨æ³›åž‹ã€‚ ä¸Šé¢çš„ä»£ç ç¼–è¯‘ä¸é€šè¿‡ï¼Œç”±äºŽå¯¹å¼•ç”¨ä½¿ç”¨äº†æ³›åž‹ï¼Œå…¶ä¸­çš„æ‰€èƒ½å®¹çº³çš„å¯¹è±¡å¿…é¡»ä¸ºString ç±»åž‹ã€‚è¿™ç§å†™æ³•å®žé™…ä¸Šè·Ÿå®Œæ•´å†™æ³•çš„ä½œç”¨ä¸€è‡´ï¼Œä¸è¿‡Eclipseä»ç„¶ä¼šè­¦å‘Š 1ä¸Šé¢çš„ä»£ç ç¼–è¯‘ä¸é€šè¿‡ï¼Œç”±äºŽå¯¹å¼•ç”¨ä½¿ç”¨äº†æ³›åž‹ï¼Œå…¶ä¸­çš„æ‰€èƒ½å®¹çº³çš„å¯¹è±¡å¿…é¡»ä¸ºString ç±»åž‹ã€‚è¿™ç§å†™æ³•å®žé™…ä¸Šè·Ÿå®Œæ•´å†™æ³•çš„ä½œç”¨ä¸€è‡´ï¼Œä¸è¿‡Eclipseä»ç„¶ä¼šè­¦å‘Šã€‚ å¼•ç”¨ä¸ä½¿ç”¨æ³›åž‹ï¼Œå®žä¾‹åŒ–ä½¿ç”¨æ³›åž‹ã€‚ ä¸Šé¢çš„è¿™æ®µä»£ç å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œå…¶æ•ˆæžœä¸Ž1ï¼ˆä¸ä½¿ç”¨æ³›åž‹ï¼‰å®Œå…¨ä¸€è‡´ã€‚ç»“åˆ2ã€3å¯ä»¥çŸ¥é“ï¼Œç¼–è¯‘æ—¶åªèƒ½åšå¼•ç”¨çš„ç±»åž‹æ£€æŸ¥ï¼Œè€Œæ— æ³•æ£€æŸ¥å¼•ç”¨æ‰€æŒ‡å‘å¯¹è±¡çš„å®žé™…ç±»åž‹ã€‚ 3ã€æ³›åž‹ä¸Žç»§æ‰¿ åœ¨ä½¿ç”¨æ³›åž‹æ—¶ï¼Œå¼•ç”¨çš„å‚æ•°ç±»åž‹ä¸Žå®žé™…å¯¹è±¡çš„å‚æ•°ç±»åž‹è¦ä¿æŒä¸€è‡´ï¼ˆé€šé…ç¬¦é™¤å¤–ï¼‰ï¼Œå°±ç®—ä¸¤ä¸ªå‚æ•°ç±»åž‹æ˜¯ç»§æ‰¿å…³ç³»ä¹Ÿæ˜¯ä¸å…è®¸çš„ã€‚çœ‹çœ‹ä¸‹é¢çš„2è¡Œä»£ç ï¼Œå®ƒä»¬å‡ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚ 12ArrayList&lt;String&gt; arrayList1 = new ArrayList&lt;Object&gt;(); //ç¼–è¯‘é”™è¯¯ ArrayList&lt;Object&gt; arrayList1 = new ArrayList&lt;String&gt;(); //ç¼–è¯‘é”™è¯¯ ä¸‹é¢æ¥æŽ¢è®¨ä¸€ä¸‹ä¸ºä»€ä¹ˆä¸èƒ½è¿™ä¹ˆåšã€‚ ç¬¬1ç§æƒ…å†µï¼Œå¦‚æžœè¿™ç§ä»£ç å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œé‚£ä¹ˆè°ƒç”¨get()æ–¹æ³•è¿”å›žçš„å¯¹è±¡åº”è¯¥æ˜¯Stringï¼Œä½†å®ƒå®žé™…ä¸Šå¯ä»¥å­˜æ”¾ä»»æ„Objectç±»åž‹çš„å¯¹è±¡ï¼Œè¿™æ ·åœ¨è°ƒç”¨ç±»åž‹è½¬æ¢æŒ‡ä»¤æ—¶ä¼šæŠ›å‡ºClassCastExceptionã€‚ ç¬¬2ç§æƒ…å†µã€‚è™½ç„¶Stringç±»åž‹çš„å¯¹è±¡è½¬æ¢ä¸ºObjectä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯è¿™æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿæˆ‘ä»¬åŽŸæœ¬æƒ³è¦ç”¨Stringå¯¹è±¡çš„æ–¹æ³•ï¼Œä½†æœ€ç»ˆå°†å…¶èµ‹äºˆäº†ä¸€ä¸ªObjectç±»åž‹çš„å¼•ç”¨ã€‚å¦‚æžœéœ€è¦ä½¿ç”¨Stringä¸­çš„æŸäº›æ–¹æ³•ï¼Œå¿…é¡»å°†Objectå¼ºåˆ¶è½¬æ¢ä¸ºStringã€‚è¿™æ ·ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯å´è¿èƒŒäº†æ³›åž‹è®¾è®¡çš„åˆè¡·ã€‚ 4ã€æ³›åž‹ä¸Žå¤šæ€ ä¸‹é¢æ¥è€ƒè™‘ä¸€ä¸‹æ³›åž‹ä¸­å¤šæ€é—®é¢˜ã€‚æ™®é€šç±»åž‹çš„å¤šæ€æ˜¯é€šè¿‡ç»§æ‰¿å¹¶é‡å†™çˆ¶ç±»çš„æ–¹æ³•æ¥å®žçŽ°çš„ï¼Œæ³›åž‹ä¹Ÿä¸ä¾‹å¤–ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ³›åž‹å¤šæ€ç¤ºä¾‹ã€‚ ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªæ³›åž‹çˆ¶ç±»å’Œä¸€ä¸ªå®žé™…å‚æ•°ä¸ºStringç±»åž‹çš„å­ç±»ï¼Œå¹¶â€œé‡å†™â€äº†set(T)å’Œget()æ–¹æ³•ã€‚Sonç±»ä¸­çš„@Overrideæ³¨è§£ä¹Ÿæ¸…æ¥šåœ°æ˜¾ç¤ºè¿™æ˜¯ä¸€ä¸ªé‡å†™æ–¹æ³•ï¼Œæœ€ç»ˆæ‰§è¡Œçš„ç»“æžœå¦‚ä¸‹ï¼Œä¸Žæƒ³è±¡ä¸­çš„ç»“æžœå®Œå…¨ä¸€è‡´ã€‚ 12I am father, t=hello worldI am son. çœŸçš„è¿™ä¹ˆç®€å•ä¹ˆï¼Ÿè™½ç„¶è¡¨é¢ä¸Šï¼ˆæºä»£ç å±‚é¢ï¼‰æ¥çœ‹ï¼Œæ³›åž‹å¤šæ€ä¸Žæ™®é€šç±»çš„å¤šæ€å¹¶æ— äºŒæ ·ï¼Œä½†æ˜¯å…¶å†…éƒ¨çš„å®žæ—¶åŽŸç†å´å¤§ç›¸å¾„åº­ã€‚ æ³›åž‹ç±»Fatheråœ¨ç¼–è¯‘åŽä¼šæ“¦é™¤æ³›åž‹ä¿¡æ¯ï¼Œæ‰€æœ‰çš„æ³›åž‹å‚æ•°éƒ½ä¼šç”¨Objectç±»æ›¿ä»£ã€‚å®žé™…ä¸Šï¼ŒFatherç¼–è¯‘åŽçš„å­—èŠ‚ç ä¸Žä¸‹é¢çš„ä»£ç å®Œå…¨ä¸€è‡´ã€‚ Sonç±»çš„ä¸Žæœ€ç»ˆä¼šå˜ä¸ºï¼š Fatherå’ŒSonç±»çš„set()æ–¹æ³•çš„å‚æ•°ç±»åž‹ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ï¼Œè¿™å¹¶ä¸æ˜¯æ–¹æ³•é‡å†™ï¼Œè€Œæ˜¯æ–¹æ³•é‡è½½ï¼ä½†æ˜¯ï¼Œå¦‚æžœæ˜¯é‡è½½ï¼Œé‚£ä¹ˆSonç±»å°±åº”è¯¥ä¼šç»§æ‰¿Fatherç±»çš„set(Object)æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯Sonä¼šåŒæ—¶åŒ…å«set(String)å’Œset(Object)ï¼Œä¸‹é¢æ¥æµ‹è¯•ä¸€ä¸‹ã€‚ 123Son son = new Son();son.set("test");son.set(new Object()); // ç¼–è¯‘é”™è¯¯ å½“setä¸€ä¸ªObjectå¯¹è±¡æ—¶ï¼Œç¼–è¯‘æ— æ³•é€šè¿‡ã€‚è¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œæ„Ÿè§‰è·Ÿä¹‹å‰å­¦åˆ°çš„çŸ¥è¯†æ˜¯ç›¸æ‚–çš„ã€‚æˆ‘ä»¬åŽŸæœ¬æƒ³é€šè¿‡é‡å†™æ–¹æ³•æ¥å®žçŽ°å¤šæ€ï¼Œä½†ç”±äºŽæ³›åž‹çš„ç±»åž‹æ“¦é™¤ï¼Œå´æœ€ç»ˆå˜æˆäº†é‡è½½ï¼Œæ‰€ä»¥ç±»åž‹æ“¦é™¤ä¸Žå¤šæ€æœ‰äº†çŸ›ç›¾ã€‚é‚£ä¹ˆJavaæ˜¯æ€Žä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿè¿˜æ˜¯ä»Žå­—èŠ‚ç ä¸­æ‰¾ç­”æ¡ˆå§ã€‚Sonç±»æœ€ç»ˆçš„ç¼–è¯‘ç»“æžœå¦‚ä¸‹ï¼š 1234567public void set(java.lang.String); // æˆ‘ä»¬é‡å†™çš„æ–¹æ³•public java.lang.String get(); // æˆ‘ä»¬é‡å†™çš„æ–¹æ³•public java.lang.Object get(); // ç¼–è¯‘å™¨ç”Ÿæˆçš„æ–¹æ³•public void set(java.lang.Object); // ç¼–è¯‘å™¨ç”Ÿæˆçš„æ–¹æ³• ... 2: checkcast #39 // class java/lang/String ... â­è¿™é‡Œé¢å¤šäº†ä¸€ä¸ªObject get()æ–¹æ³•å’Œset(Object)æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨Sonç±»æºä»£ç é‡Œé¢å¹¶ä¸å­˜åœ¨ï¼Œè¿™æ˜¯ç¼–è¯‘å™¨ä¸ºäº†è§£å†³æ³›åž‹çš„å¤šæ€é—®é¢˜è€Œè‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•ï¼Œç§°ä¸ºâ€œæ¡¥æ–¹æ³•â€ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç­¾åä¸ŽFatherç±»ä¸­çš„ä¸¤ä¸ªæ–¹æ³•çš„ç­¾åå®Œå…¨ä¸€è‡´ï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„æ–¹æ³•é‡å†™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»çœŸæ­£é‡å†™çš„æˆ‘ä»¬çœ‹ä¸åˆ°çš„æ¡¥æ–¹æ³•ï¼Œå•Šï¼Œå¤šä¹ˆç—›çš„é¢†æ‚Ÿï¼ï¼ï¼@Overrideæ³¨è§£åªæ˜¯å‡è±¡ï¼Œè®©äººè¯¯ä»¥ä¸ºä»–ä»¬çœŸçš„æ˜¯é‡å†™æ–¹æ³•ã€‚ å†çœ‹çœ‹set(Object)æ¡¥æ–¹æ³•çš„å®žçŽ°ç»†èŠ‚ï¼Œå…ˆå°†Objectå¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºStringå¯¹è±¡ï¼Œç„¶åŽè°ƒç”¨Sonä¸­çš„set(String)æ–¹æ³•ã€‚é¥¶äº†ä¸€ä¸ªåœˆï¼Œæœ€ç»ˆæ‰å›žåˆ°æˆ‘ä»¬â€œé‡å†™â€çš„æ–¹æ³•ã€‚mainæ–¹æ³•ä¸­åŽŸæœ¬è°ƒç”¨çˆ¶ç±»çš„set(Object)æ–¹æ³•ï¼Œç”±äºŽå­ç±»é€šè¿‡æ¡¥æ–¹æ³•é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æœ€ç»ˆçš„è°ƒç”¨é¡ºåºæ˜¯ï¼šset(Object) -&gt; set(String)ã€‚ ä¸Žset(Object)æ¡¥æ–¹æ³•çš„æ„ä¹‰ä¸åŒï¼ŒObject get()å¹¶ä¸ä»…ä»…è§£å†³æ³›åž‹ä¸Žé‡å†™çš„å†²çªï¼Œè€Œæ›´å…·æœ‰ä¸€èˆ¬æ€§ã€‚çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼Œè¿™æ˜¯ä¸€ä¸ªæ™®é€šç±»çš„ç»§æ‰¿: 12345public class GeneralFather &#123; public Object get() &#123; return null; &#125;&#125; 123456public class GeneralSon extends GeneralFather &#123; @Override public String get() &#123; return ""; &#125;&#125; å­ç±»çš„è¿”å›žç±»åž‹æ˜¯çˆ¶ç±»çš„è¿”å›žç±»åž‹çš„å­ç±»ï¼Œè¿™æ˜¯å…è®¸çš„ï¼Œè¿™ç§ç‰¹æ€§å«åšJavaè¿”å›žå€¼çš„åå˜æ€§ã€‚è€Œåå˜æ€§çš„å®žçŽ°æ–¹æ³•å°±æ˜¯ä¸Šé¢æ‰€è¿°çš„æ¡¥æ–¹æ³•ã€‚ è¿™é‡Œè¿˜ä¼šæœ‰ç–‘æƒ‘ï¼Œsetæ–¹æ³•å¯ä»¥é€šè¿‡å‚æ•°ç±»åž‹æ¥ç¡®å®šè°ƒç”¨çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå‚æ•°ä¸€æ ·è€Œè¿”å›žå€¼ä¸ä¸€æ ·æ˜¯ä¸èƒ½é‡è½½çš„ã€‚å¦‚æžœæˆ‘ä»¬åœ¨æºä»£ç ä¸­é€šè¿‡ç¼–å†™String get()å’ŒObject get()æ–¹æ³•æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ã€‚è™½ç„¶ï¼Œç¼–è¯‘å™¨æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯JVMæ˜¯å¯ä»¥ç¼–å†™è¿™ä¸¤ç§æ–¹æ³•çš„ï¼Œå®ƒè°ƒç”¨æ–¹æ³•æ—¶ï¼Œå°†è¿”å›žå€¼ä¹Ÿä½œä¸ºæ–¹æ³•ç­¾åçš„ä¸€éƒ¨åˆ†ã€‚æœ‰ç§åªè®¸å·žå®˜æ”¾ç«ï¼Œä¸è®¸ç™¾å§“ç‚¹ç¯çš„æ„Ÿè§‰ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒJVMåšäº†ä¸å°‘æˆ‘ä»¬è®¤ä¸ºä¸åˆæ³•çš„äº‹æƒ…ï¼Œæ‰€ä»¥å¦‚æžœä¸æ·±å…¥ç ”ç©¶åº•å±‚åŽŸç†ï¼Œæœ‰äº›é—®é¢˜æ ¹æœ¬è§£é‡Šä¸äº†ã€‚ 5ã€æ³›åž‹çš„ä½¿ç”¨ æ³›åž‹æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºï¼šæ³›åž‹ç±»ã€æ³›åž‹æŽ¥å£ã€æ³›åž‹æ–¹æ³•. 5.1 æ³›åž‹ç±» æ³›åž‹ç±»åž‹ç”¨äºŽç±»çš„å®šä¹‰ä¸­ï¼Œè¢«ç§°ä¸ºæ³›åž‹ç±»ã€‚é€šè¿‡æ³›åž‹å¯ä»¥å®Œæˆå¯¹ä¸€ç»„ç±»çš„æ“ä½œå¯¹å¤–å¼€æ”¾ç›¸åŒçš„æŽ¥å£ã€‚æœ€å…¸åž‹çš„å°±æ˜¯å„ç§å®¹å™¨ç±»ï¼Œå¦‚ï¼šListã€Setã€Mapã€‚ ä¸‹é¢è¿›è¡Œå®žä¾‹åŒ–ï¼š ç»“æžœä¸ºï¼š 1212-27 09:20:04.432 13063-13063/? D/æ³›åž‹æµ‹è¯•: key is 12345612-27 09:20:04.432 13063-13063/? D/æ³›åž‹æµ‹è¯•: key is key_vlaue å®šä¹‰çš„æ³›åž‹ç±»ï¼Œå°±ä¸€å®šè¦ä¼ å…¥æ³›åž‹ç±»åž‹å®žå‚ä¹ˆï¼Ÿå¹¶ä¸æ˜¯è¿™æ ·ï¼Œåœ¨ä½¿ç”¨æ³›åž‹çš„æ—¶å€™å¦‚æžœä¼ å…¥æ³›åž‹å®žå‚ï¼Œåˆ™ä¼šæ ¹æ®ä¼ å…¥çš„æ³›åž‹å®žå‚åšç›¸åº”çš„é™åˆ¶ï¼Œæ­¤æ—¶æ³›åž‹æ‰ä¼šèµ·åˆ°æœ¬åº”èµ·åˆ°çš„é™åˆ¶ä½œç”¨ã€‚å¦‚æžœä¸ä¼ å…¥æ³›åž‹ç±»åž‹å®žå‚çš„è¯ï¼Œåœ¨æ³›åž‹ç±»ä¸­ä½¿ç”¨æ³›åž‹çš„æ–¹æ³•æˆ–æˆå‘˜å˜é‡å®šä¹‰çš„ç±»åž‹å¯ä»¥ä¸ºä»»ä½•çš„ç±»åž‹ã€‚ 1234D/æ³›åž‹æµ‹è¯•: key is 111111D/æ³›åž‹æµ‹è¯•: key is 4444D/æ³›åž‹æµ‹è¯•: key is 55.55D/æ³›åž‹æµ‹è¯•: key is false 5.2 æ³›åž‹æŽ¥å£ å½“å®žçŽ°æ³›åž‹æŽ¥å£çš„ç±»ï¼Œæœªä¼ å…¥æ³›åž‹å®žå‚æ—¶ï¼š å½“å®žçŽ°æ³›åž‹æŽ¥å£çš„ç±»ï¼Œä¼ å…¥æ³›åž‹å®žå‚æ—¶ï¼š 5.3 æ³›åž‹é€šé…ç¬¦ æˆ‘ä»¬çŸ¥é“Ingeteræ˜¯Numberçš„ä¸€ä¸ªå­ç±»ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹ŸéªŒè¯è¿‡Generic&lt;Ingeter&gt;ä¸ŽGeneric&lt;Number&gt;å®žé™…ä¸Šæ˜¯ç›¸åŒçš„ä¸€ç§åŸºæœ¬ç±»åž‹ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨ä½¿ç”¨Generic&lt;Number&gt;ä½œä¸ºå½¢å‚çš„æ–¹æ³•ä¸­ï¼Œèƒ½å¦ä½¿ç”¨Generic&lt;Ingeter&gt;çš„å®žä¾‹ä¼ å…¥å‘¢ï¼Ÿåœ¨é€»è¾‘ä¸Šç±»ä¼¼äºŽGeneric&lt;Number&gt;å’ŒGeneric&lt;Ingeter&gt;æ˜¯å¦å¯ä»¥çœ‹æˆå…·æœ‰çˆ¶å­å…³ç³»çš„æ³›åž‹ç±»åž‹å‘¢ï¼Ÿ ä¸ºäº†å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨Generic&lt;T&gt;è¿™ä¸ªæ³›åž‹ç±»ç»§ç»­çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š é€šè¿‡æç¤ºä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Generic&lt;Integer&gt;ä¸èƒ½è¢«çœ‹ä½œä¸ºGeneric&lt;Number&gt;çš„å­ç±»ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡º:åŒä¸€ç§æ³›åž‹å¯ä»¥å¯¹åº”å¤šä¸ªç‰ˆæœ¬ï¼ˆå› ä¸ºå‚æ•°ç±»åž‹æ˜¯ä¸ç¡®å®šçš„ï¼‰ï¼Œä¸åŒç‰ˆæœ¬çš„æ³›åž‹ç±»å®žä¾‹æ˜¯ä¸å…¼å®¹çš„ã€‚ å›žåˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Ÿæ€»ä¸èƒ½ä¸ºäº†å®šä¹‰ä¸€ä¸ªæ–°çš„æ–¹æ³•æ¥å¤„ç†Generic&lt;Integer&gt;ç±»åž‹çš„ç±»ï¼Œè¿™æ˜¾ç„¶ä¸Žjavaä¸­çš„å¤šæ€ç†å¿µç›¸è¿èƒŒã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨é€»è¾‘ä¸Šå¯ä»¥è¡¨ç¤ºåŒæ—¶æ˜¯Generic&lt;Integer&gt;å’ŒGeneric&lt;Number&gt;çˆ¶ç±»çš„å¼•ç”¨ç±»åž‹ã€‚ç”±æ­¤ç±»åž‹é€šé…ç¬¦åº”è¿è€Œç”Ÿã€‚ æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„æ–¹æ³•æ”¹ä¸€ä¸‹ï¼š ç±»åž‹é€šé…ç¬¦ä¸€èˆ¬æ˜¯ä½¿ç”¨'?'ä»£æ›¿å…·ä½“çš„ç±»åž‹å®žå‚ï¼Œæ³¨æ„ï¼Œæ­¤å¤„â€™?'æ˜¯ç±»åž‹å®žå‚ï¼Œè€Œä¸æ˜¯ç±»åž‹å½¢å‚ ã€‚é‡è¦è¯´ä¸‰éï¼æ­¤å¤„'?'æ˜¯ç±»åž‹å®žå‚ï¼Œè€Œä¸æ˜¯ç±»åž‹å½¢å‚ ï¼ æ­¤å¤„'?'æ˜¯ç±»åž‹å®žå‚ï¼Œè€Œä¸æ˜¯ç±»åž‹å½¢å‚ ï¼å†ç›´ç™½ç‚¹çš„æ„æ€å°±æ˜¯ï¼Œæ­¤å¤„çš„'?'å’ŒNumberã€Stringã€Integerä¸€æ ·éƒ½æ˜¯ä¸€ç§å®žé™…çš„ç±»åž‹ï¼Œå¯ä»¥æŠŠ'?'çœ‹æˆæ‰€æœ‰ç±»åž‹çš„çˆ¶ç±»ã€‚æ˜¯ä¸€ç§çœŸå®žçš„ç±»åž‹ã€‚ å¯ä»¥è§£å†³å½“å…·ä½“ç±»åž‹ä¸ç¡®å®šçš„æ—¶å€™ï¼Œè¿™ä¸ªé€šé…ç¬¦å°±æ˜¯'?'ï¼›å½“æ“ä½œç±»åž‹æ—¶ï¼Œä¸éœ€è¦ä½¿ç”¨ç±»åž‹çš„å…·ä½“åŠŸèƒ½æ—¶ï¼Œåªä½¿ç”¨Objectç±»ä¸­çš„åŠŸèƒ½ã€‚é‚£ä¹ˆå¯ä»¥ç”¨'?'é€šé…ç¬¦æ¥è¡¨ç¤ºæœªçŸ¥ç±»åž‹ã€‚ 5.4 æ³›åž‹æ–¹æ³• æ³›åž‹ç±»ï¼Œæ˜¯åœ¨å®žä¾‹åŒ–ç±»çš„æ—¶å€™æŒ‡æ˜Žæ³›åž‹çš„å…·ä½“ç±»åž‹ï¼›æ³›åž‹æ–¹æ³•ï¼Œæ˜¯åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™æŒ‡æ˜Žæ³›åž‹çš„å…·ä½“ç±»åž‹ ã€‚ 1Object obj = genericMethod(Class.forName("com.test.test")); å†å¯¹æ³›åž‹æ–¹æ³•è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒï¼ŒåŠ æ·±ç†è§£ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394public class GenericTest &#123; //è¿™ä¸ªç±»æ˜¯ä¸ªæ³›åž‹ç±»ï¼Œåœ¨ä¸Šé¢å·²ç»ä»‹ç»è¿‡ public class Generic&lt;T&gt;&#123; private T key; public Generic(T key) &#123; this.key = key; &#125; //æˆ‘æƒ³è¯´çš„å…¶å®žæ˜¯è¿™ä¸ªï¼Œè™½ç„¶åœ¨æ–¹æ³•ä¸­ä½¿ç”¨äº†æ³›åž‹ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ³›åž‹æ–¹æ³•ã€‚ //è¿™åªæ˜¯ç±»ä¸­ä¸€ä¸ªæ™®é€šçš„æˆå‘˜æ–¹æ³•ï¼Œåªä¸è¿‡ä»–çš„è¿”å›žå€¼æ˜¯åœ¨å£°æ˜Žæ³›åž‹ç±»å·²ç»å£°æ˜Žè¿‡çš„æ³›åž‹ã€‚ //æ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰å¯ä»¥ç»§ç»­ä½¿ç”¨ T è¿™ä¸ªæ³›åž‹ã€‚ public T getKey()&#123; return key; &#125; /** * è¿™ä¸ªæ–¹æ³•æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ï¼Œåœ¨ç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬æç¤ºè¿™æ ·çš„é”™è¯¯ä¿¡æ¯"cannot reslove symbol E" * å› ä¸ºåœ¨ç±»çš„å£°æ˜Žä¸­å¹¶æœªå£°æ˜Žæ³›åž‹Eï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨Eåšå½¢å‚å’Œè¿”å›žå€¼ç±»åž‹æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ— æ³•è¯†åˆ«ã€‚ public E setKey(E key)&#123; this.key = keyï¼› &#125; */ //å¿…é¡»è¦å£°æ˜ŽEæ‰è¡Œ public &lt;E&gt; E setKey(E key)&#123; this.key = (T)key; return key; &#125; &#125; /** * è¿™æ‰æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ³›åž‹æ–¹æ³•ã€‚ * é¦–å…ˆåœ¨publicä¸Žè¿”å›žå€¼ä¹‹é—´çš„&lt;T&gt;å¿…ä¸å¯å°‘ï¼Œè¿™è¡¨æ˜Žè¿™æ˜¯ä¸€ä¸ªæ³›åž‹æ–¹æ³•ï¼Œå¹¶ä¸”å£°æ˜Žäº†ä¸€ä¸ªæ³›åž‹T * è¿™ä¸ªTå¯ä»¥å‡ºçŽ°åœ¨è¿™ä¸ªæ³›åž‹æ–¹æ³•çš„ä»»æ„ä½ç½®. * æ³›åž‹çš„æ•°é‡ä¹Ÿå¯ä»¥ä¸ºä»»æ„å¤šä¸ª * å¦‚ï¼špublic &lt;T,K&gt; K showKeyName(Generic&lt;T&gt; container)&#123; * ... * &#125; */ public &lt;T&gt; T showKeyName(Generic&lt;T&gt; container)&#123; System.out.println("container key :" + container.getKey()); //å½“ç„¶è¿™ä¸ªä¾‹å­ä¸¾çš„ä¸å¤ªåˆé€‚ï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜Žæ³›åž‹æ–¹æ³•çš„ç‰¹æ€§ã€‚ T test = container.getKey(); return test; &#125; //è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ³›åž‹æ–¹æ³•ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ï¼Œåªæ˜¯ä½¿ç”¨äº†Generic&lt;Number&gt;è¿™ä¸ªæ³›åž‹ç±»åšå½¢å‚è€Œå·²ã€‚ public void showKeyValue1(Generic&lt;Number&gt; obj)&#123; Log.d("æ³›åž‹æµ‹è¯•","key value is " + obj.getKey()); &#125; //è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ³›åž‹æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ï¼Œåªä¸è¿‡ä½¿ç”¨äº†æ³›åž‹é€šé…ç¬¦? //åŒæ—¶è¿™ä¹Ÿå°è¯äº†æ³›åž‹é€šé…ç¬¦ç« èŠ‚æ‰€æè¿°çš„ï¼Œ?æ˜¯ä¸€ç§ç±»åž‹å®žå‚ï¼Œå¯ä»¥çœ‹åšä¸ºNumberç­‰æ‰€æœ‰ç±»çš„çˆ¶ç±» public void showKeyValue2(Generic&lt;?&gt; obj)&#123; Log.d("æ³›åž‹æµ‹è¯•","key value is " + obj.getKey()); &#125; /** * è¿™ä¸ªæ–¹æ³•æ˜¯æœ‰é—®é¢˜çš„ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æç¤ºé”™è¯¯ä¿¡æ¯ï¼š"UnKnown class 'E' " * è™½ç„¶æˆ‘ä»¬å£°æ˜Žäº†&lt;T&gt;,ä¹Ÿè¡¨æ˜Žäº†è¿™æ˜¯ä¸€ä¸ªå¯ä»¥å¤„ç†æ³›åž‹çš„ç±»åž‹çš„æ³›åž‹æ–¹æ³•ã€‚ * ä½†æ˜¯åªå£°æ˜Žäº†æ³›åž‹ç±»åž‹Tï¼Œå¹¶æœªå£°æ˜Žæ³›åž‹ç±»åž‹Eï¼Œå› æ­¤ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†Eè¿™ä¸ªç±»åž‹ã€‚ public &lt;T&gt; T showKeyName(Generic&lt;E&gt; container)&#123; ... &#125; */ /** * è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æç¤ºé”™è¯¯ä¿¡æ¯ï¼š"UnKnown class 'T' " * å¯¹äºŽç¼–è¯‘å™¨æ¥è¯´Tè¿™ä¸ªç±»åž‹å¹¶æœªé¡¹ç›®ä¸­å£°æ˜Žè¿‡ï¼Œå› æ­¤ç¼–è¯‘ä¹Ÿä¸çŸ¥é“è¯¥å¦‚ä½•ç¼–è¯‘è¿™ä¸ªç±»ã€‚ * æ‰€ä»¥è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ­£ç¡®çš„æ³›åž‹æ–¹æ³•å£°æ˜Žã€‚ public void showkey(T genericObj)&#123; &#125; */ //åœ¨æ³›åž‹ç±»ä¸­å£°æ˜Žäº†ä¸€ä¸ªæ³›åž‹æ–¹æ³•ï¼Œä½¿ç”¨æ³›åž‹Eï¼Œè¿™ç§æ³›åž‹Eå¯ä»¥ä¸ºä»»æ„ç±»åž‹ã€‚å¯ä»¥ç±»åž‹ä¸ŽTç›¸åŒï¼Œä¹Ÿå¯ä»¥ä¸åŒã€‚ //ç”±äºŽæ³›åž‹æ–¹æ³•åœ¨å£°æ˜Žçš„æ—¶å€™ä¼šå£°æ˜Žæ³›åž‹&lt;E&gt;ï¼Œå› æ­¤å³ä½¿åœ¨æ³›åž‹ç±»ä¸­å¹¶æœªå£°æ˜Žæ³›åž‹ï¼Œç¼–è¯‘å™¨ä¹Ÿèƒ½å¤Ÿæ­£ç¡®è¯†åˆ«æ³›åž‹æ–¹æ³•ä¸­è¯†åˆ«çš„æ³›åž‹ã€‚ public &lt;E&gt; void show_3(E t)&#123; System.out.println(t.toString()); &#125; //åœ¨æ³›åž‹ç±»ä¸­å£°æ˜Žäº†ä¸€ä¸ªæ³›åž‹æ–¹æ³•ï¼Œä½¿ç”¨æ³›åž‹Tï¼Œæ³¨æ„è¿™ä¸ªTæ˜¯ä¸€ç§å…¨æ–°çš„ç±»åž‹ï¼Œå¯ä»¥ä¸Žæ³›åž‹ç±»ä¸­å£°æ˜Žçš„Tä¸æ˜¯åŒä¸€ç§ç±»åž‹ã€‚ public &lt;T&gt; void show_2(T t)&#123; System.out.println(t.toString()); &#125; public static void main(String[] args) &#123; &#125;&#125; 5.5 æ³›åž‹æ–¹æ³•ä¸Žå¯å˜å‚æ•° 1printMsg("111",222,"aaaa","2323.4",55.55); 5.6 é™æ€æ–¹æ³•ä¸Žæ³›åž‹ å¦‚æžœé™æ€æ–¹æ³•è¦ä½¿ç”¨æ³›åž‹çš„è¯ï¼Œå¿…é¡»å°†é™æ€æ–¹æ³•ä¹Ÿå®šä¹‰æˆæ³›åž‹æ–¹æ³• ã€‚]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹å…‹éš†]]></title>
    <url>%2F2019%2F02%2F19%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%85%8B%E9%9A%86%2F</url>
    <content type="text"><![CDATA[é¢è¯•çš„æ—¶å€™å¯èƒ½ä¼šé—®åˆ°å…‹éš†ç›¸å…³çš„æ·±æ‹·è´å’Œæµ…æ‹·è´ï¼Œè‡³å°‘æˆ‘æ˜¯è¢«é—®è¿‡çš„ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬çš„äº†è§£æ˜¯å¿…è¦çš„ï¼Œæœ¬ç¯‡æ–‡ç« æŽ¢è®¨Javaå…‹éš†æ–¹é¢çš„çŸ¥è¯†ã€‚ 1. Javaä¸­å¯¹è±¡åˆ›å»ºçš„ä¸¤ç§æ–¹å¼ cloneé¡¾åæ€ä¹‰å°±æ˜¯å¤åˆ¶ï¼Œ åœ¨Javaè¯­è¨€ä¸­ï¼Œ cloneæ–¹æ³•è¢«å¯¹è±¡è°ƒç”¨ï¼Œæ‰€ä»¥ä¼šå¤åˆ¶å¯¹è±¡ã€‚æ‰€è°“çš„å¤åˆ¶å¯¹è±¡ï¼Œé¦–å…ˆè¦åˆ†é…ä¸€ä¸ªå’Œæºå¯¹è±¡åŒæ ·å¤§å°çš„ç©ºé—´ï¼Œåœ¨è¿™ä¸ªç©ºé—´ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚é‚£ä¹ˆåœ¨javaè¯­è¨€ä¸­ï¼Œæœ‰å‡ ç§æ–¹å¼å¯ä»¥åˆ›å»ºå¯¹è±¡å‘¢ï¼Ÿ ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡ ä½¿ç”¨cloneæ–¹æ³•å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ é‚£ä¹ˆè¿™ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆç›¸åŒå’Œä¸åŒå‘¢ï¼Ÿ newæ“ä½œç¬¦çš„æœ¬æ„æ˜¯åˆ†é…å†…å­˜ã€‚ç¨‹åºæ‰§è¡Œåˆ°newæ“ä½œç¬¦æ—¶ï¼Œ é¦–å…ˆåŽ»çœ‹newæ“ä½œç¬¦åŽé¢çš„ç±»åž‹ï¼Œå› ä¸ºçŸ¥é“äº†ç±»åž‹ï¼Œæ‰èƒ½çŸ¥é“è¦åˆ†é…å¤šå¤§çš„å†…å­˜ç©ºé—´ã€‚åˆ†é…å®Œå†…å­˜ä¹‹åŽï¼Œå†è°ƒç”¨æž„é€ å‡½æ•°ï¼Œå¡«å……å¯¹è±¡çš„å„ä¸ªåŸŸï¼Œè¿™ä¸€æ­¥å«åšå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œæž„é€ æ–¹æ³•è¿”å›žåŽï¼Œä¸€ä¸ªå¯¹è±¡åˆ›å»ºå®Œæ¯•ï¼Œå¯ä»¥æŠŠä»–çš„å¼•ç”¨ï¼ˆåœ°å€ï¼‰å‘å¸ƒåˆ°å¤–éƒ¨ï¼Œåœ¨å¤–éƒ¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¼•ç”¨æ“çºµè¿™ä¸ªå¯¹è±¡ã€‚ è€Œcloneåœ¨ç¬¬ä¸€æ­¥æ˜¯å’Œnewç›¸ä¼¼çš„ï¼Œ éƒ½æ˜¯åˆ†é…å†…å­˜ï¼Œè°ƒç”¨cloneæ–¹æ³•æ—¶ï¼Œåˆ†é…çš„å†…å­˜å’Œæºå¯¹è±¡ï¼ˆå³è°ƒç”¨cloneæ–¹æ³•çš„å¯¹è±¡ï¼‰ç›¸åŒï¼Œç„¶åŽå†ä½¿ç”¨åŽŸå¯¹è±¡ä¸­å¯¹åº”çš„å„ä¸ªåŸŸï¼Œå¡«å……æ–°å¯¹è±¡çš„åŸŸï¼Œ å¡«å……å®Œæˆä¹‹åŽï¼Œcloneæ–¹æ³•è¿”å›žï¼Œä¸€ä¸ªæ–°çš„ç›¸åŒçš„å¯¹è±¡è¢«åˆ›å»ºï¼ŒåŒæ ·å¯ä»¥æŠŠè¿™ä¸ªæ–°å¯¹è±¡çš„å¼•ç”¨å‘å¸ƒåˆ°å¤–éƒ¨ã€‚ 2. å¤åˆ¶å¯¹è±¡ or å¤åˆ¶å¼•ç”¨ åœ¨Javaä¸­ï¼Œä»¥ä¸‹ç±»ä¼¼çš„ä»£ç éžå¸¸å¸¸è§ï¼š å½“Person p1 = p;æ‰§è¡Œä¹‹åŽï¼Œ æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡å—ï¼Ÿ é¦–å…ˆçœ‹æ‰“å°ç»“æžœï¼š 12com.pansoft.zhangjg.testclone.Person@2f9ee1accom.pansoft.zhangjg.testclone.Person@2f9ee1ac å¯å·²çœ‹å‡ºï¼Œæ‰“å°çš„åœ°å€å€¼æ˜¯ç›¸åŒçš„ï¼Œæ—¢ç„¶åœ°å€éƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚på’Œp1åªæ˜¯å¼•ç”¨è€Œå·²ï¼Œä»–ä»¬éƒ½æŒ‡å‘äº†ä¸€ä¸ªç›¸åŒçš„å¯¹è±¡Person(23, &quot;zhang&quot;) ã€‚ å¯ä»¥æŠŠè¿™ç§çŽ°è±¡å«åšå¼•ç”¨çš„å¤åˆ¶ã€‚ è€Œä¸‹é¢çš„ä»£ç æ˜¯çœŸçœŸæ­£æ­£çš„å…‹éš†äº†ä¸€ä¸ªå¯¹è±¡ã€‚ ä»Žæ‰“å°ç»“æžœå¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ›å»ºäº†æ–°çš„å¯¹è±¡ï¼Œ è€Œä¸æ˜¯æŠŠåŽŸå¯¹è±¡çš„åœ°å€èµ‹ç»™äº†ä¸€ä¸ªæ–°çš„å¼•ç”¨å˜é‡ï¼š 12com.pansoft.zhangjg.testclone.Person@2f9ee1accom.pansoft.zhangjg.testclone.Person@67f1fba0 ä»¥ä¸Šä»£ç æ‰§è¡Œå®ŒæˆåŽï¼Œ å†…å­˜ä¸­çš„æƒ…æ™¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3. æ·±æ‹·è´ or æµ…æ‹·è´ ageæ˜¯åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‹·è´æ²¡æœ‰ä»€ä¹ˆç–‘è®®ï¼Œç›´æŽ¥å°†ä¸€ä¸ª4å­—èŠ‚çš„æ•´æ•°å€¼æ‹·è´è¿‡æ¥å°±è¡Œã€‚ nameæ˜¯Stringç±»åž‹çš„ï¼Œ å®ƒåªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œ æŒ‡å‘ä¸€ä¸ªçœŸæ­£çš„Stringå¯¹è±¡ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‹·è´æœ‰ä¸¤ç§æ–¹å¼ï¼š ç›´æŽ¥å°†æºå¯¹è±¡ä¸­çš„nameçš„å¼•ç”¨å€¼æ‹·è´ç»™æ–°å¯¹è±¡çš„nameå­—æ®µ æˆ–è€…æ˜¯æ ¹æ®åŽŸPersonå¯¹è±¡ä¸­çš„nameæŒ‡å‘çš„å­—ç¬¦ä¸²å¯¹è±¡åˆ›å»ºä¸€ä¸ªæ–°çš„ç›¸åŒçš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå°†è¿™ä¸ªæ–°å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨èµ‹ç»™æ–°æ‹·è´çš„Personå¯¹è±¡çš„nameå­—æ®µã€‚ è¿™ä¸¤ç§æ‹·è´æ–¹å¼åˆ†åˆ«å«åšæµ…æ‹·è´å’Œæ·±æ‹·è´ã€‚æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŽŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‹é¢é€šè¿‡ä»£ç è¿›è¡ŒéªŒè¯ã€‚å¦‚æžœä¸¤ä¸ªPersonå¯¹è±¡çš„nameçš„åœ°å€å€¼ç›¸åŒï¼Œ è¯´æ˜Žä¸¤ä¸ªå¯¹è±¡çš„nameéƒ½æŒ‡å‘åŒä¸€ä¸ªStringå¯¹è±¡ï¼Œ ä¹Ÿå°±æ˜¯æµ…æ‹·è´ï¼Œ è€Œå¦‚æžœä¸¤ä¸ªå¯¹è±¡çš„nameçš„åœ°å€å€¼ä¸åŒï¼Œ é‚£ä¹ˆå°±è¯´æ˜ŽæŒ‡å‘ä¸åŒçš„Stringå¯¹è±¡ï¼Œ ä¹Ÿå°±æ˜¯åœ¨æ‹·è´Personå¯¹è±¡çš„æ—¶å€™ï¼Œ åŒæ—¶æ‹·è´äº†nameå¼•ç”¨çš„Stringå¯¹è±¡ï¼Œ ä¹Ÿå°±æ˜¯æ·±æ‹·è´ã€‚éªŒè¯ä»£ç å¦‚ä¸‹ï¼š è¦†ç›–Objectä¸­çš„cloneæ–¹æ³•ï¼Œ å®žçŽ°æ·±æ‹·è´.å‡è®¾bodyç±»é‡Œé¢ç»„åˆäº†headç±»ã€‚ Bodyä¸­ç»„åˆäº†Headï¼Œé‡å†™äº†Bodyçš„cloneæ–¹æ³•ï¼Œé‚£ä¹ˆæ˜¾ç„¶ç¬¬ä¸€ä¸ªè¾“å‡ºä¸ºfalseï¼›ä½†æ˜¯æ²¡æœ‰å¯¹Headè¿›è¡Œé‡å†™cloneæ–¹æ³•ï¼Œé‚£ä¹ˆä»–ä»¬æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå†…å­˜ç©ºé—´ã€‚å³ï¼Œæ²¡æœ‰é‡å†™cloneçš„Headç±»åªæ˜¯æµ…æ‹·è´ã€‚ 12body == body1 : falsebody.head == body1.head : true å¦‚æžœè¦ä½¿Bodyå¯¹è±¡åœ¨cloneæ—¶è¿›è¡Œæ·±æ‹·è´ï¼Œ é‚£ä¹ˆå°±è¦åœ¨Bodyçš„cloneæ–¹æ³•ä¸­ï¼Œå°†æºå¯¹è±¡å¼•ç”¨çš„Headå¯¹è±¡ä¹Ÿcloneä¸€ä»½ã€‚ æ‰“å°ç»“æžœï¼š 12body == body1 : falsebody.head == body1.head : false ç”±æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªç»“è®ºï¼šå¦‚æžœæƒ³è¦æ·±æ‹·è´ä¸€ä¸ªå¯¹è±¡ï¼Œ è¿™ä¸ªå¯¹è±¡å¿…é¡»è¦å®žçŽ°CloneableæŽ¥å£ï¼Œå®žçŽ°cloneæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨cloneæ–¹æ³•å†…éƒ¨ï¼ŒæŠŠè¯¥å¯¹è±¡å¼•ç”¨çš„å…¶ä»–å¯¹è±¡ä¹Ÿè¦cloneä¸€ä»½ ï¼Œ è¿™å°±è¦æ±‚è¿™ä¸ªè¢«å¼•ç”¨çš„å¯¹è±¡å¿…é¡»ä¹Ÿè¦å®žçŽ°CloneableæŽ¥å£å¹¶ä¸”å®žçŽ°cloneæ–¹æ³•ã€‚ é‚£ä¹ˆï¼ŒæŒ‰ç…§ä¸Šé¢çš„ç»“è®ºï¼Œ Bodyç±»ç»„åˆäº†Headç±»ï¼Œ è€ŒHeadç±»ç»„åˆäº†Faceç±»ï¼Œè¦æƒ³æ·±æ‹·è´Bodyç±»ï¼Œå¿…é¡»åœ¨Bodyç±»çš„cloneæ–¹æ³•ä¸­å°†Headç±»ä¹Ÿè¦æ‹·è´ä¸€ä»½ï¼Œä½†æ˜¯åœ¨æ‹·è´Headç±»æ—¶ï¼Œé»˜è®¤æ‰§è¡Œçš„æ˜¯æµ…æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´Headä¸­ç»„åˆçš„Faceå¯¹è±¡å¹¶ä¸ä¼šè¢«æ‹·è´ã€‚éªŒè¯ä»£ç å¦‚ä¸‹ï¼š è¾“å‡ºç»“æžœç¬¦åˆé¢„æœŸï¼š 123body == body1 : falsebody.head == body1.head : falsebody.head.face == body1.head.face : true å†…å­˜ç»“æž„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é‚£ä¹ˆæ­¤æ—¶Headä¸­ç»„åˆçš„Faceåˆæ˜¯ä¸€ä¸ªæµ…æ‹·è´ã€‚é‚£ä¹ˆåˆ°åº•å¦‚ä½•å®žçŽ°å½»åº•çš„æ·±æ‹·è´å‘¢ï¼Ÿ å¯¹äºŽä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œæ€Žæ ·æ‰èƒ½ä¿è¯ä¸¤ä¸ªBodyå¯¹è±¡å®Œå…¨ç‹¬ç«‹å‘¢ï¼Ÿåªè¦åœ¨æ‹·è´Headå¯¹è±¡çš„æ—¶å€™ï¼Œä¹Ÿå°†Faceå¯¹è±¡æ‹·è´ä¸€ä»½å°±å¯ä»¥äº†ã€‚è¿™éœ€è¦è®©Faceç±»ä¹Ÿå®žçŽ°CloneableæŽ¥å£ï¼Œå®žçŽ°cloneæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨åœ¨Headå¯¹è±¡çš„cloneæ–¹æ³•ä¸­ï¼Œæ‹·è´å®ƒæ‰€å¼•ç”¨çš„Faceå¯¹è±¡ã€‚ä¿®æ”¹çš„éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š å†æ¬¡è¿è¡Œä¸Šé¢çš„ç¤ºä¾‹ï¼Œå¾—åˆ°çš„è¿è¡Œç»“æžœå¦‚ä¸‹ï¼š 123body == body1 : falsebody.head == body1.head : falsebody.head.face == body1.head.face : false è¿™è¯´åä¸¤ä¸ªBodyå·²ç»å®Œå…¨ç‹¬ç«‹äº†ï¼Œä»–ä»¬é—´æŽ¥å¼•ç”¨çš„faceå¯¹è±¡å·²ç»è¢«æ‹·è´ï¼Œä¹Ÿå°±æ˜¯å¼•ç”¨äº†ç‹¬ç«‹çš„Faceå¯¹è±¡ã€‚å†…å­˜ç»“æž„å›¾å¦‚ä¸‹ï¼š æ˜¾ç„¶ï¼Œå¯¹äºŽå¤æ‚çš„å¯¹è±¡è€Œè¨€ï¼Œç”¨è¿™ç§æ–¹å¼å®žçŽ°æ·±æ‹·è´æ˜¯ååˆ†å›°éš¾çš„ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥ç”¨åºåˆ—åŒ–çš„æ–¹å¼æ¥å®žçŽ°å¯¹è±¡çš„æ·±å…‹éš†ã€‚ 4. åºåˆ—åŒ–è§£å†³å¤šå±‚å…‹éš†é—®é¢˜ é¦–å…ˆç”±ä¸€ä¸ªå¤–éƒ¨ç±»Outerï¼š å†æ¥ä¸€ä¸ªè¢«åºåˆ—åŒ–çš„ç±»Inner: å†å¯¹å…‹éš†çš„å¯¹è±¡è¿›è¡Œæµ‹è¯•ï¼š è¿è¡Œç»“æžœï¼š 1234falsefalseouterçš„nameå€¼ä¸ºï¼šouterInnerçš„nameå€¼ä¸ºï¼šinner å‚è€ƒï¼š Javaæé«˜ç¯‡â€”â€”å¯¹è±¡å…‹éš†ï¼ˆå¤åˆ¶ï¼‰ è¯¦è§£Javaä¸­çš„cloneæ–¹æ³• â€“ åŽŸåž‹æ¨¡å¼]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹å¼‚å¸¸]]></title>
    <url>%2F2019%2F02%2F19%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%BC%82%E5%B8%B8%2F</url>
    <content type="text"><![CDATA[åœ¨å¼€å‘ä¸­ï¼Œå¼‚å¸¸å¤„ç†æ˜¯ä¸€ä¸ªä¸å¯ç»•å¼€çš„è¯é¢˜ï¼Œæˆ‘ä»¬å¯¹äºŽå¼‚å¸¸çš„å¤„ç†å·²ç»éžå¸¸ç†Ÿç»ƒäº†ï¼Œå¯¹äºŽå¼‚å¸¸æœ¬èº«çš„æ¦‚å¿µã€ç”¨æ³•ç­‰ä¸å†èµ˜è¿°äº†ï¼Œç›´æŽ¥ç»“åˆé¢è¯•é—®é¢˜æ¥åŠ æ·±å¯¹å¼‚å¸¸çš„ç†è§£å§ã€‚ Throwable å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»ä½•å¯ä»¥ä½œä¸ºå¼‚å¸¸æŠ›å‡ºçš„ç±»ï¼Œåˆ†ä¸ºä¸¤ç§ï¼š Error å’Œ Exceptionã€‚ 1. ä»€ä¹ˆæ˜¯Javaå¼‚å¸¸ å¼‚å¸¸æ˜¯å‘ç”Ÿåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­é˜»ç¢ç¨‹åºæ­£å¸¸æ‰§è¡Œçš„é”™è¯¯äº‹ä»¶ã€‚æ¯”å¦‚ï¼šç”¨æˆ·è¾“å…¥é”™è¯¯æ•°æ®ã€ç¡¬ä»¶æ•…éšœã€ç½‘ç»œé˜»å¡žç­‰éƒ½ä¼šå¯¼è‡´å‡ºçŽ°å¼‚å¸¸ã€‚ åªè¦åœ¨Javaè¯­å¥æ‰§è¡Œä¸­äº§ç”Ÿäº†å¼‚å¸¸ï¼Œä¸€ä¸ªå¼‚å¸¸å¯¹è±¡å°±ä¼šè¢«åˆ›å»ºï¼ŒJREå°±ä¼šè¯•å›¾å¯»æ‰¾å¼‚å¸¸å¤„ç†ç¨‹åºæ¥å¤„ç†å¼‚å¸¸ã€‚å¦‚æžœæœ‰åˆé€‚çš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå¼‚å¸¸å¯¹è±¡å°±ä¼šè¢«å¼‚å¸¸å¤„ç†ç¨‹åºæŽ¥ç®¡ï¼Œå¦åˆ™ï¼Œå°†å¼•å‘è¿è¡ŒçŽ¯å¢ƒå¼‚å¸¸ï¼ŒJREç»ˆæ­¢ç¨‹åºæ‰§è¡Œã€‚ Javaå¼‚å¸¸å¤„ç†æ¡†æž¶åªèƒ½å¤„ç†è¿è¡Œæ—¶é”™è¯¯ï¼Œç¼–è¯‘é”™è¯¯ä¸åœ¨å…¶è€ƒè™‘èŒƒå›´ä¹‹å†…ã€‚ 2. Errorå’ŒExceptionçš„åŒºåˆ« Errorï¼šæ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œè¡¨ç¤ºè¿è¡Œåº”ç”¨ç¨‹åºä¸­è¾ƒä¸¥é‡é—®é¢˜ã€‚å¤§å¤šæ•°é”™è¯¯ä¸Žä»£ç ç¼–å†™è€…æ‰§è¡Œçš„æ“ä½œæ— å…³ï¼Œè€Œè¡¨ç¤ºä»£ç è¿è¡Œæ—¶ JVMå‡ºçŽ°çš„é—®é¢˜ã€‚ ä¾‹å¦‚ï¼ŒJavaè™šæ‹Ÿæœºè¿è¡Œé”™è¯¯ï¼Œå½“ JVM ä¸å†æœ‰ç»§ç»­æ‰§è¡Œæ“ä½œæ‰€éœ€çš„å†…å­˜èµ„æºæ—¶ï¼Œå°†å‡ºçŽ°OutOfMemoryErrorã€‚è¿™äº›å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒJavaè™šæ‹Ÿæœºä¸€èˆ¬ä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢ã€‚ 3. Javaå¼‚å¸¸å¤„ç†ä¸­æœ‰å“ªäº›å…³é”®å­—ï¼Ÿ throw:æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°åˆ›å»ºå¹¶æŠ›å‡ºå¼‚å¸¸å¯¹è±¡æ¥ç»ˆæ­¢ç¨‹åºçš„æ­£å¸¸æ‰§è¡Œã€‚throwå…³é”®å­—ç”¨æ¥æŠ›å‡ºå¹¶å¤„ç†è¿è¡Œæ—¶å¼‚å¸¸ã€‚ throws:å½“æˆ‘ä»¬æŠ›å‡ºä»»ä½•â€œè¢«æ£€æŸ¥çš„å¼‚å¸¸(checked exception)â€å¹¶ä¸å¤„ç†æ—¶ï¼Œéœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­ä½¿ç”¨å…³é”®å­—throwsæ¥å‘ŠçŸ¥è°ƒç”¨ç¨‹åºæ­¤æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºçš„å¼‚å¸¸ã€‚è°ƒç”¨æ–¹æ³•å¯èƒ½ä¼šå¤„ç†è¿™äº›å¼‚å¸¸ï¼Œæˆ–è€…åŒæ ·ç”¨throwsæ¥å°†å¼‚å¸¸ä¼ ç»™ä¸Šä¸€çº§è°ƒç”¨æ–¹æ³•ã€‚throwså…³é”®å­—åŽå¯æŽ¥å¤šä¸ªæ½œåœ¨å¼‚å¸¸ï¼Œç”šè‡³æ˜¯åœ¨main()ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨throwsã€‚ try-catch:æˆ‘ä»¬åœ¨ä»£ç ä¸­ç”¨try-catchå—å¤„ç†å¼‚å¸¸ã€‚å½“ç„¶ï¼Œä¸€ä¸ªtryå—ä¹‹åŽå¯ä»¥æœ‰å¤šä¸ªcatchå­å¥ï¼Œtry-catchå—ä¹Ÿèƒ½åµŒå¥—ã€‚æ¯ä¸ªcatchå—å¿…é¡»æŽ¥å—ä¸€ä¸ªï¼ˆä¸”ä»…æœ‰ä¸€ä¸ªï¼‰ä»£è¡¨å¼‚å¸¸ç±»åž‹çš„å‚æ•°ã€‚ finally:finallyå—æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”åªèƒ½é…åˆtry-catchä¸€èµ·ä½¿ç”¨ã€‚è™½ç„¶å¼‚å¸¸ç»ˆæ­¢äº†ç¨‹åºçš„æ‰§è¡Œï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›æ‰“å¼€çš„èµ„æºæ²¡æœ‰è¢«å…³é—­ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬èƒ½ä½¿ç”¨finallyè¿›è¡Œå…³é—­ã€‚ä¸ç®¡å¼‚å¸¸æœ‰æ²¡æœ‰å‡ºçŽ°ï¼Œfinallyå—æ€»ä¼šè¢«æ‰§è¡Œã€‚ 4. æè¿°ä¸€ä¸‹å¼‚å¸¸çš„å±‚çº§ Throwableæ˜¯æ‰€æœ‰å¼‚å¸¸çš„çˆ¶ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªç›´æŽ¥å­å¯¹è±¡Error,Exceptionï¼Œå…¶ä¸­Exceptionåˆè¢«ç»§ç»­åˆ’åˆ†ä¸ºâ€œè¢«æ£€æŸ¥çš„å¼‚å¸¸(checked exception)â€å’Œâ€è¿è¡Œæ—¶çš„å¼‚å¸¸ï¼ˆruntime exception,å³ä¸å—æ£€æŸ¥çš„å¼‚å¸¸ï¼‰â€ã€‚ Errorè¡¨ç¤ºç¼–è¯‘æ—¶å’Œç³»ç»Ÿé”™è¯¯ï¼Œé€šå¸¸ä¸èƒ½é¢„æœŸå’Œæ¢å¤ï¼Œæ¯”å¦‚ç¡¬ä»¶æ•…éšœã€JVMå´©æºƒã€å†…å­˜ä¸è¶³ç­‰ã€‚ è¢«æ£€æŸ¥çš„å¼‚å¸¸ï¼ˆChecked exceptionï¼‰åœ¨ç¨‹åºä¸­èƒ½é¢„æœŸï¼Œå¹¶è¦å°è¯•ä¿®å¤ï¼Œå¦‚FileNotFoundExceptionã€‚æˆ‘ä»¬å¿…é¡»æ•èŽ·æ­¤ç±»å¼‚å¸¸ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›æœ‰ç”¨ä¿¡æ¯å’Œåˆé€‚æ—¥å¿—æ¥è¿›è¡Œè°ƒè¯•ã€‚Exceptionæ˜¯æ‰€æœ‰è¢«æ£€æŸ¥çš„å¼‚å¸¸çš„çˆ¶ç±»ã€‚ è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionï¼‰åˆç§°ä¸ºä¸å—æ£€æŸ¥å¼‚å¸¸ï¼ŒæºäºŽç³Ÿç³•çš„ç¼–ç¨‹ã€‚æ¯”å¦‚æˆ‘ä»¬æ£€ç´¢æ•°ç»„å…ƒç´ ä¹‹å‰å¿…é¡»ç¡®è®¤æ•°ç»„çš„é•¿åº¦ï¼Œå¦åˆ™å°±å¯èƒ½ä¼šæŠ›å‡ºArrayIndexOutOfBoundExceptionè¿è¡Œæ—¶å¼‚å¸¸ã€‚RuntimeExceptionæ˜¯æ‰€æœ‰è¿è¡Œæ—¶å¼‚å¸¸çš„çˆ¶ç±»ã€‚ 5. æè¿°Java 7 ARM(Automatic Resource Managementï¼Œè‡ªåŠ¨èµ„æºç®¡ç†)ç‰¹å¾å’Œå¤šä¸ªcatchå—çš„ä½¿ç”¨ å¦‚æžœä¸€ä¸ªtryå—ä¸­æœ‰å¤šä¸ªå¼‚å¸¸è¦è¢«æ•èŽ·ï¼Œcatchå—ä¸­çš„ä»£ç ä¼šå˜ä¸‘é™‹çš„åŒæ—¶è¿˜è¦ç”¨å¤šä½™çš„ä»£ç æ¥è®°å½•å¼‚å¸¸ã€‚æœ‰é‰´äºŽæ­¤ï¼ŒJava 7çš„ä¸€ä¸ªæ–°ç‰¹å¾æ˜¯ï¼šä¸€ä¸ªcatchå­å¥ä¸­å¯ä»¥æ•èŽ·å¤šä¸ªå¼‚å¸¸ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234catch(IOException | SQLException | Exception ex)&#123; logger.error(ex); throw new MyException(ex.getMessage());&#125; å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå½“å¿˜è®°å…³é—­èµ„æºæˆ–å› èµ„æºè€—å°½å‡ºçŽ°è¿è¡Œæ—¶å¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯ç”¨finallyå­å¥æ¥å…³é—­èµ„æºã€‚è¿™äº›å¼‚å¸¸å¾ˆéš¾è°ƒè¯•ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥åˆ°èµ„æºä½¿ç”¨çš„æ¯ä¸€æ­¥æ¥ç¡®å®šæ˜¯å¦å·²å…³é—­ã€‚å› æ­¤ï¼ŒJava 7ç”¨try-with-resourcesè¿›è¡Œäº†æ”¹è¿›ï¼šåœ¨tryå­å¥ä¸­èƒ½åˆ›å»ºä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå½“ç¨‹åºçš„æ‰§è¡Œå®Œtry-catchä¹‹åŽï¼Œè¿è¡ŒçŽ¯å¢ƒè‡ªåŠ¨å…³é—­èµ„æºã€‚ åˆ©ç”¨Try-Catch-Finallyç®¡ç†èµ„æºï¼ˆæ—§çš„ä»£ç é£Žæ ¼ï¼‰ï¼š 1234567891011121314151617private static void printFile() throws IOException &#123; InputStream input = null; try &#123; input = new FileInputStream("file.txt");//å¯èƒ½å‘ç”Ÿå¼‚å¸¸1 int data = input.read();//å¯èƒ½å‘ç”Ÿå¼‚å¸¸2 while(data != -1)&#123; System.out.print((char) data); data = input.read(); &#125; &#125; finally &#123; if(input != null)&#123; input.close();//å¯èƒ½å‘ç”Ÿå¼‚å¸¸3 &#125; &#125;&#125; å‡è®¾tryè¯­å¥å—æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œç„¶åŽfinallyè¯­å¥å—è¢«æ‰§è¡Œã€‚åŒæ ·å‡è®¾finallyè¯­å¥å—ä¹ŸæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ã€‚é‚£ä¹ˆå“ªä¸ªå¼‚å¸¸ä¼šæ ¹æ®è°ƒç”¨æ ˆå¾€å¤–ä¼ æ’­ï¼Ÿ å³ä½¿tryè¯­å¥å—ä¸­æŠ›å‡ºçš„å¼‚å¸¸ä¸Žå¼‚å¸¸ä¼ æ’­æ›´ç›¸å…³ï¼Œæœ€ç»ˆè¿˜æ˜¯finallyè¯­å¥å—ä¸­æŠ›å‡ºçš„å¼‚å¸¸ä¼šæ ¹æ®è°ƒç”¨æ ˆå‘å¤–ä¼ æ’­ã€‚ åœ¨java7ä¸­ï¼Œå¯¹äºŽä¸Šé¢çš„ä¾‹å­å¯ä»¥ç”¨try-with-resource ç»“æž„è¿™æ ·å†™ï¼š 1234567891011private static void printFileJava7() throws IOException &#123; try(FileInputStream input = new FileInputStream("file.txt")) &#123; int data = input.read(); while(data != -1)&#123; System.out.print((char) data); data = input.read(); &#125; &#125;&#125; å½“tryè¯­å¥å—è¿è¡Œç»“æŸæ—¶ï¼ŒFileInputStream ä¼šè¢«è‡ªåŠ¨å…³é—­ã€‚è¿™æ˜¯å› ä¸ºFileInputStream å®žçŽ°äº†javaä¸­çš„java.lang.AutoCloseableæŽ¥å£ã€‚æ‰€æœ‰å®žçŽ°äº†è¿™ä¸ªæŽ¥å£çš„ç±»éƒ½å¯ä»¥åœ¨try-with-resourcesç»“æž„ä¸­ä½¿ç”¨ã€‚ å½“try-with-resourcesç»“æž„ä¸­æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼ŒåŒæ—¶FileInputStreamè¢«å…³é—­æ—¶ï¼ˆè°ƒç”¨äº†å…¶closeæ–¹æ³•ï¼‰ä¹ŸæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œtry-with-resourcesç»“æž„ä¸­æŠ›å‡ºçš„å¼‚å¸¸ä¼šå‘å¤–ä¼ æ’­ï¼Œè€ŒFileInputStreamè¢«å…³é—­æ—¶æŠ›å‡ºçš„å¼‚å¸¸è¢«æŠ‘åˆ¶äº†ã€‚ ä½ å¯ä»¥åœ¨å—ä¸­ä½¿ç”¨å¤šä¸ªèµ„æºè€Œä¸”è¿™äº›èµ„æºéƒ½èƒ½è¢«è‡ªåŠ¨åœ°å…³é—­ã€‚ä¸‹é¢æ˜¯ä¾‹å­ï¼š 12345678910111213private static void printFileJava7() throws IOException &#123; try( FileInputStream input = new FileInputStream("file.txt"); BufferedInputStream bufferedInput = new BufferedInputStream(input) ) &#123; int data = bufferedInput.read(); while(data != -1)&#123; System.out.print((char) data); data = bufferedInput.read(); &#125; &#125;&#125; è¿™äº›èµ„æºå°†æŒ‰ç…§ä»–ä»¬è¢«åˆ›å»ºé¡ºåºçš„é€†åºæ¥å…³é—­ã€‚é¦–å…ˆBufferedInputStream ä¼šè¢«å…³é—­ï¼Œç„¶åŽFileInputStreamä¼šè¢«å…³é—­ã€‚ è¿™ä¸ªtry-with-resourcesç»“æž„é‡Œä¸ä»…èƒ½å¤Ÿæ“ä½œjavaå†…ç½®çš„ç±»ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨è‡ªå·±çš„ç±»ä¸­å®žçŽ°java.lang.AutoCloseableæŽ¥å£ï¼Œç„¶åŽåœ¨try-with-resourcesç»“æž„é‡Œä½¿ç”¨è¿™ä¸ªç±»ã€‚ AutoClosable æŽ¥å£ä»…ä»…æœ‰ä¸€ä¸ªæ–¹æ³•ï¼ŒæŽ¥å£å®šä¹‰å¦‚ä¸‹ï¼š 1234public interface AutoClosable &#123; public void close() throws Exception;&#125; ä»»ä½•å®žçŽ°äº†è¿™ä¸ªæŽ¥å£çš„æ–¹æ³•éƒ½å¯ä»¥åœ¨try-with-resourcesç»“æž„ä¸­ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 1234567891011public class MyAutoClosable implements AutoCloseable &#123; public void doIt() &#123; System.out.println("MyAutoClosable doing it!"); &#125; @Override public void close() throws Exception &#123; System.out.println("MyAutoClosable closed!"); &#125;&#125; doIt()æ˜¯æ–¹æ³•ä¸æ˜¯AutoClosable æŽ¥å£ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä¹‹æ‰€ä»¥å®žçŽ°è¿™ä¸ªæ–¹æ³•æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³è¦è¿™ä¸ªç±»é™¤äº†å…³é—­æ–¹æ³•å¤–è¿˜èƒ½åšç‚¹å…¶ä»–äº‹ã€‚ ä¸‹é¢æ˜¯MyAutoClosable åœ¨try-with-resourcesç»“æž„ä¸­ä½¿ç”¨çš„ä¾‹å­ï¼š 123456private static void myAutoClosable() throws Exception &#123; try(MyAutoClosable myAutoClosable = new MyAutoClosable())&#123; myAutoClosable.doIt(); &#125;&#125; è¿è¡Œç»“æžœï¼š 12MyAutoClosable doing it!MyAutoClosable closed! é€šè¿‡ä¸Šé¢è¿™äº›ä½ å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºtry-catchä¸­ä½¿ç”¨çš„èµ„æºæ˜¯è‡ªå·±åˆ›é€ çš„è¿˜æ˜¯javaå†…ç½®çš„ç±»åž‹ï¼Œtry-with-resourceséƒ½æ˜¯ä¸€ä¸ªèƒ½å¤Ÿç¡®ä¿èµ„æºèƒ½è¢«æ­£ç¡®åœ°å…³é—­çš„å¼ºå¤§æ–¹æ³•ã€‚ 6. åœ¨Javaä¸­throwä¸Žthrowså…³é”®å­—ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ throwsç”¨äºŽåœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜Žæ­¤æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ï¼Œè€Œthrowå…³é”®å­—åˆ™æ˜¯ä¸­æ–­ç¨‹åºçš„æ‰§è¡Œå¹¶ç§»äº¤å¼‚å¸¸å¯¹è±¡åˆ°è¿è¡Œæ—¶è¿›è¡Œå¤„ç†ã€‚ 7. åœ¨Javaä¸­æ€Žä¹ˆå†™è‡ªå®šä¹‰çš„å¼‚å¸¸ï¼Ÿ æˆ‘ä»¬èƒ½ç»§æ‰¿Exceptionç±»æˆ–å…¶ä»»ä½•å­ç±»æ¥å®žçŽ°è‡ªå·±çš„è‡ªå®šä¹‰å¼‚å¸¸ç±»ã€‚è¿™è‡ªå®šä¹‰å¼‚å¸¸ç±»å¯ä»¥æœ‰è‡ªå·±å˜é‡å’Œæ–¹æ³•æ¥ä¼ é€’é”™è¯¯ä»£ç æˆ–å…¶å®ƒå¼‚å¸¸ç›¸å…³ä¿¡æ¯æ¥å¤„ç†å¼‚å¸¸ã€‚ 1234567891011121314@Datapublic class HappyBikeException extends RuntimeException&#123; private Integer code = ResponseEnum.ERROR.getCode(); public HappyBikeException(Integer code,String msg)&#123; super(msg); this.code = code; &#125; public HappyBikeException(String msg)&#123; super(msg); &#125;&#125; 8. Javaä¸­final,finally,finalizeçš„åŒºåˆ«ï¼Ÿ è¿™æ˜¯ä¸€ä¸ªåžƒåœ¾é—®é¢˜ï¼Œå¾ˆæƒ³åˆ é™¤æŽ‰ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æ–°æ‰‹ï¼Œè¿˜æ˜¯ä¿ç•™ä¸€ä¸‹å§ï¼Œè‡³å°‘ä»Žå•è¯ä¸Šæœ‰é‚£ä¹ˆä¸€ç‚¹ç‚¹åƒã€‚ finalå’Œfinallyåœ¨Javaä¸­æ˜¯å…³é”®å­—ï¼Œè€Œfinalizeåˆ™æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚ finalå…³é”®å­—ä½¿å¾—ç±»å˜é‡ä¸å¯å˜ï¼Œé¿å…ç±»è¢«å…¶å®ƒç±»ç»§æ‰¿æˆ–æ–¹æ³•è¢«é‡å†™ã€‚finallyè·Ÿtry-catchå—ä¸€èµ·ä½¿ç”¨ï¼Œå³ä½¿æ˜¯å‡ºçŽ°äº†å¼‚å¸¸ï¼Œå…¶å­å¥æ€»ä¼šè¢«æ‰§è¡Œï¼Œé€šå¸¸ï¼Œfinallyå­å¥ç”¨æ¥å…³é—­ç›¸å…³èµ„æºã€‚finallyæ–¹æ³•ä¸­çš„å¯¹è±¡è¢«é”€æ¯ä¹‹å‰ä¼šè¢«åžƒåœ¾å›žæ”¶ã€‚ 9. åœ¨mainæ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ ç­”ï¼šå½“mainæ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒJavaè¿è¡Œæ—¶é—´ç»ˆæ­¢å¹¶åœ¨æŽ§åˆ¶å°æ‰“å°å¼‚å¸¸ä¿¡æ¯å’Œæ ˆè½¨è¿¹ã€‚ 10. catchå­å¥èƒ½ä¸ºç©ºå—ï¼Ÿ catchåŽé¢æ‹¬å·é‡Œé¢ä¸èƒ½ä¸ºç©ºã€‚ ç­”ï¼šå¯ä»¥æœ‰ç©ºçš„catchå­å¥ï¼Œä½†é‚£æ˜¯æœ€ç³Ÿç³•çš„ç¼–ç¨‹ï¼Œå› ä¸ºé‚£æ ·çš„è¯ï¼Œå¼‚å¸¸å³ä½¿è¢«æ•èŽ·ï¼Œæˆ‘ä»¬ä¹Ÿå¾—ä¸åˆ°ä»»ä½•çš„æœ‰ç”¨ä¿¡æ¯ï¼Œå¯¹äºŽè°ƒè¯•æ¥è¯´ä¼šæ˜¯ä¸ªå™©æ¢¦ï¼Œå› æ­¤ï¼Œç¼–ç¨‹æ—¶æ°¸è¿œä¸è¦æœ‰ç©ºçš„catchå­å¥ã€‚Catchå­å¥ä¸­è‡³å°‘è¦åŒ…å«ä¸€ä¸ªæ—¥å¿—è¯­å¥è¾“å‡ºåˆ°æŽ§åˆ¶å°æˆ–ä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ 11. æä¾›ä¸€äº›Javaå¼‚å¸¸å¤„ç†çš„æœ€ä½³å®žè·µã€‚ ä½¿ç”¨å…·ä½“çš„å¼‚å¸¸æ–¹ä¾¿è°ƒè¯• ç¨‹åºä¸­æ—©ç‚¹æŠ›å‡ºå¼‚å¸¸ æ•èŽ·å¼‚å¸¸åŽè®©è°ƒç”¨è€…å¤„ç†å¼‚å¸¸ ä½¿ç”¨Java 7 ARMåŠŸèƒ½ç¡®ä¿èµ„æºå…³é—­æˆ–è€…ç”¨finallyå­å¥æ­£ç¡®åœ°å…³é—­å®ƒä»¬ ä¸ºäº†è°ƒè¯•éœ€è¦æ€»æ˜¯è®°å½•å¼‚å¸¸ä¿¡æ¯ ç”¨å¤šä¸ªcatchå­å¥å®žçŽ°æ›´å®Œå…¨çš„å…³é—­ ä½ è‡ªå·±çš„åº”ç”¨APIä¸­ç”¨è‡ªå®šä¹‰çš„å¼‚å¸¸æ¥æŠ›å‡ºå•ç§ç±»åž‹å¼‚å¸¸ éµå¾ªå‘½åè§„å®šï¼Œä»¥å¼‚å¸¸ç»“æŸ åœ¨Javadocä¸­ç”¨@throwsæ¥æ ‡æ³¨æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ å¤„ç†å¼‚å¸¸æ˜¯æœ‰èŠ±é”€çš„ï¼Œå› æ­¤åªæœ‰åœ¨å¿…è¦æ—¶æ‰æŠ›å‡ºã€‚å¦åˆ™ï¼Œä½ ä¼šæ‰‘ç©ºæˆ–æ¯«æ— æ”¶èŽ·ã€‚ 12. tryã€catchã€finallyä¸‰ä¸ªè¯­å¥å—åº”æ³¨æ„çš„é—®é¢˜ tryã€catchã€finallyä¸‰ä¸ªè¯­å¥å—å‡ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œä¸‰è€…å¯ä»¥ç»„æˆ tryâ€¦catchâ€¦finallyã€tryâ€¦catchã€tryâ€¦finallyä¸‰ç§ç»“æž„ï¼Œcatchè¯­å¥å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œfinallyè¯­å¥æœ€å¤šä¸€ä¸ªã€‚ tryã€catchã€finallyä¸‰ä¸ªä»£ç å—ä¸­å˜é‡çš„ä½œç”¨åŸŸä¸ºä»£ç å—å†…éƒ¨ï¼Œåˆ†åˆ«ç‹¬ç«‹è€Œä¸èƒ½ç›¸äº’è®¿é—®ã€‚å¦‚æžœè¦åœ¨ä¸‰ä¸ªå—ä¸­éƒ½å¯ä»¥è®¿é—®ï¼Œåˆ™éœ€è¦å°†å˜é‡å®šä¹‰åˆ°è¿™äº›å—çš„å¤–é¢ã€‚ å¤šä¸ªcatchå—æ—¶å€™ï¼Œåªä¼šåŒ¹é…å…¶ä¸­ä¸€ä¸ªå¼‚å¸¸ç±»å¹¶æ‰§è¡Œcatchå—ä»£ç ï¼Œè€Œä¸ä¼šå†æ‰§è¡Œåˆ«çš„catchå—ï¼Œå¹¶ä¸”åŒ¹é…catchè¯­å¥çš„é¡ºåºæ˜¯ç”±ä¸Šåˆ°ä¸‹ã€‚ æ— è®ºç¨‹åºæ˜¯å¦æœ‰å¼‚å¸¸ï¼Œå¹¶ä¸”æ— è®ºä¹‹é—´try-catchæ˜¯å¦é¡ºåˆ©æ‰§è¡Œå®Œæ¯•ï¼Œéƒ½ä¼šæ‰§è¡Œfinallyè¯­å¥ã€‚åœ¨ä»¥ä¸‹ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œfinallyå—ä¸ä¼šæ‰§è¡Œï¼šåœ¨finallyè¯­å¥å—ä¸­å‘ç”Ÿå¼‚å¸¸ï¼›åœ¨å‰é¢ä»£ç ä¸­ä½¿ç”¨äº†System.exit()é€€å‡ºç¨‹åºï¼›ç¨‹åºæ‰€åœ¨çº¿ç¨‹æ­»äº¡ï¼›å…³é—­cpuã€‚ â­å½“ç¨‹åºæ‰§è¡Œtryå—ï¼Œcatchå—æ—¶é‡åˆ°returnè¯­å¥æˆ–è€…throwè¯­å¥ï¼Œè¿™ä¸¤ä¸ªè¯­å¥éƒ½ä¼šå¯¼è‡´è¯¥æ–¹æ³•ç«‹å³ç»“æŸï¼Œæ‰€ä»¥ç³»ç»Ÿå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œè¿™ä¸¤ä¸ªè¯­å¥ï¼Œè€Œæ˜¯åŽ»å¯»æ‰¾è¯¥å¼‚å¸¸å¤„ç†æµç¨‹ä¸­çš„finallyå—ï¼Œå¦‚æžœæ²¡æœ‰finallyå—ï¼Œç¨‹åºç«‹å³æ‰§è¡Œreturnè¯­å¥æˆ–è€…throwè¯­å¥ï¼Œæ–¹æ³•ç»ˆæ­¢ã€‚å¦‚æžœæœ‰finallyå—ï¼Œç³»ç»Ÿç«‹å³å¼€å§‹æ‰§è¡Œfinallyå—ï¼Œåªæœ‰å½“finallyå—æ‰§è¡Œå®ŒæˆåŽï¼Œç³»ç»Ÿæ‰ä¼šå†æ¬¡è·³å›žæ¥æ‰§è¡Œtryå—ã€catchå—é‡Œçš„returnæˆ–throwè¯­å¥ï¼Œå¦‚æžœfinallyå—é‡Œä¹Ÿä½¿ç”¨äº†returnæˆ–throwç­‰å¯¼è‡´æ–¹æ³•ç»ˆæ­¢çš„è¯­å¥ï¼Œåˆ™finallyå—å·²ç»ç»ˆæ­¢äº†æ–¹æ³•ï¼Œä¸ç”¨å†è·³å›žåŽ»æ‰§è¡Œtryå—ã€catchå—é‡Œçš„ä»»ä½•ä»£ç äº†ã€‚ 13. è§£é‡ŠJavaä¸­çš„å¼‚å¸¸å¤„ç†æµç¨‹ å¼‚å¸¸å¤„ç†å®Œæˆä»¥åŽï¼ŒExceptionå¯¹è±¡ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼Ÿ Exceptionå¯¹è±¡ä¼šåœ¨ä¸‹ä¸€ä¸ªåžƒåœ¾å›žæ”¶è¿‡ç¨‹ä¸­è¢«å›žæ”¶æŽ‰ã€‚ è¯·å†™å‡º 5 ç§å¸¸è§åˆ°çš„runtime exceptionã€‚ NullPointerExceptionï¼šå½“æ“ä½œä¸€ä¸ªç©ºå¼•ç”¨æ—¶ä¼šå‡ºçŽ°æ­¤é”™è¯¯ã€‚ NumberFormatExceptionï¼šæ•°æ®æ ¼å¼è½¬æ¢å‡ºçŽ°é—®é¢˜æ—¶å‡ºçŽ°æ­¤å¼‚å¸¸ã€‚ ClassCastExceptionï¼šå¼ºåˆ¶ç±»åž‹è½¬æ¢ç±»åž‹ä¸åŒ¹é…æ—¶å‡ºçŽ°æ­¤å¼‚å¸¸ã€‚ ArrayIndexOutOfBoundsExceptionï¼šæ•°ç»„ä¸‹æ ‡è¶Šç•Œï¼Œå½“ä½¿ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°ç»„ä¸‹æ ‡æ—¶å‡ºçŽ°æ­¤å¼‚å¸¸ã€‚ ArithmeticExceptionï¼šæ•°å­¦è¿è¡Œé”™è¯¯æ—¶å‡ºçŽ°æ­¤å¼‚å¸¸ å‚è€ƒï¼š http://www.importnew.com/7383.html http://www.importnew.com/7541.html http://www.importnew.com/7820.html]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è‡ªå·±å®žçŽ°ä¸€ä¸ªç®€å•çš„webæœåŠ¡å™¨]]></title>
    <url>%2F2019%2F02%2F18%2Fthread%2F%E8%87%AA%E5%B7%B1%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84web%E6%9C%8D%E5%8A%A1%E5%99%A8%2F</url>
    <content type="text"><![CDATA[è¿™é‡Œæ¶‰åŠç½‘ç»œç¼–ç¨‹çš„åŸºæœ¬çŸ¥è¯†ä»¥åŠHTTPåè®®çš„åŸºæœ¬è®¤è¯†ï¼Œä¸‹é¢æ¥ä¸€æ­¥ä¸€æ­¥å®žçŽ°ä¸€ä¸‹æœ€ç®€å•çš„ä¸€ä¸ªwebæœåŠ¡å™¨ã€‚ ä¸€ã€ç”¨æˆ·è¯·æ±‚åŸŸååˆ°åº•å‘é€äº†ä»€ä¹ˆä¿¡æ¯æ¥ å¦‚æžœæœåŠ¡ç«¯éƒ½ä¸çŸ¥é“å®¢æˆ·ç«¯å‘æ¥çš„æ˜¯ä»€ä¹ˆï¼Œé‚£ä½•è°ˆå¯¹å†…å®¹çš„è§£æžå‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆåœ¨æœåŠ¡ç«¯è§£æžå®¢æˆ·ç«¯çš„è®¿é—®ä¿¡æ¯ï¼Œæ¯”å¦‚æˆ‘ä»¬æ¯”è¾ƒå…³å¿ƒçš„æ˜¯è¯·æ±‚çš„æ˜¯ä»€ä¹ˆè·¯å¾„ï¼š æ­¤æ—¶æˆ‘ä»¬è®¿é—®åœ°å€ï¼š localhost:8888 æ‰“å°å‡ºæ¥çš„ç»“æžœä¸ºï¼š å…¶å®žå¯¹äºŽæˆ‘ä»¬è¿™ç§æ¯”è¾ƒç®€å•çš„å®žçŽ°æ¥è¯´ï¼Œçº¢æ¡†çš„ä¿¡æ¯å·²ç»è¶³å¤Ÿäº†ã€‚æˆ‘ä»¬åªè¦çŸ¥é“å®¢æˆ·ç«¯è¦å‘æ¥çš„èµ„æºåå­—æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬æ ¹æ®è¿™ä¸ªåå­—å–æ‰¾å“åº”çš„èµ„æºè¿”å›žç»™å®¢æˆ·ç«¯å±•ç¤ºå³å¯ã€‚ç”±äºŽæˆ‘å…¶å®žè¯·æ±‚çš„æ˜¯æ ¹è·¯å¾„ï¼Œæ‰€ä»¥æ˜¯/ã€‚å¦‚æžœæˆ‘åœ¨è¿™é‡Œè¯·æ±‚ localhost:8888/index.html é‚£ä¹ˆå°±ä¼šæ˜¾ç¤º GET /index.html HTTP/1.1è¿™æ ·çš„ä¿¡æ¯ã€‚ä¸å†æ¼”ç¤ºã€‚ ä½†æ˜¯ä¸Šé¢çš„å†™æ³•æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œä»…ä»…æ˜¯æ¼”ç¤ºè€Œç”¨ï¼Œå› ä¸ºå®ƒä¼šä¸€ç›´ç­‰å¾…è¾“å…¥ã€‚ é‚£ä¹ˆï¼Œä¸ç”¨whileä¸€ç›´ç­‰å¾…ï¼Œè€Œä¸”åªéœ€è¦ç¬¬ä¸€è¡Œå³å¯ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼š å¥½äº†ï¼Œä¸èƒ½æ€»ä¹‹åªæŽ¥æ”¶å§ï¼Œæˆ‘ä»¬æœåŠ¡ç«¯è¦ç»™å®¢æˆ·ç«¯ç‚¹ä»€ä¹ˆã€‚ äºŒã€æœåŠ¡ç«¯å¦‚ä½•å“åº”èµ„æºç»™å®¢æˆ·ç«¯å±•ç¤º é¦–å…ˆæˆ‘ä»¬å¾—æœ‰èµ„æºæ‰èƒ½å±•ç¤ºï¼Œå‡è®¾æˆ‘ä»¬è¦å±•ç¤ºindex.htmlï¼Œæˆ‘ä»¬å°†å…¶æš‚æ—¶æ”¾åœ¨F:/webroootä¸‹ã€‚ å†…å®¹æš‚æ—¶ä¸ºï¼š åªæ˜¯å±•ç¤ºä¸€ä¸‹æ¬¢è¿Žä¿¡æ¯è€Œå·²ã€‚æœåŠ¡ç«¯å°±éœ€è¦è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åŽä»¥æµçš„å½¢å¼å‘é€ç»™å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸Šï¼Œæµè§ˆå™¨å†è§£æžå±•ç¤ºã€‚ æ­¤æ—¶å†åŽ»è®¿é—®é¡µé¢ï¼Œå°±ä¼šæ˜¾ç¤ºæ¬¢è¿Žçš„ä¿¡æ¯å•¦ï¼ è¿™é‡Œæ²¡æœ‰å…³é—­æµï¼Œä¹Ÿæ²¡æœ‰å…³é—­socketï¼Œä¸è¿‡ä¸‹é¢éƒ½ä¼šå…³é—­æŽ‰ã€‚è¿™ä¸ªä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ï¼Œè¿™çŽ©æ„éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­åšçš„ï¼Œæ˜¾ç„¶ä¸å¦‚å¤šçº¿ç¨‹æ¥çš„å¿«ï¼Œå¹¶ä¸”å…¨å†™åœ¨ä¸»çº¿ç¨‹é‡Œï¼Œè‚¯å®šæ˜¯ä¸å¤Ÿå¥½çš„ã€‚ä¸‹é¢å°±ç”¨å¤šçº¿ç¨‹æ¥å®žçŽ°ã€‚ ä¸‰ã€æ™®é€šçš„å¤šçº¿ç¨‹å®žçŽ°æ–¹å¼ å°±æ˜¯åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­å¤„ç†æ•°æ®å’Œè¿”å›žæ•°æ®ã€‚ å…¶å¾ˆç®€å•ï¼Œä½†æ˜¯å¦‚æžœæˆ‘æƒ³æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡å‘¢ï¼Ÿ æ¯”å¦‚æˆ‘çš„æ ¹ç›®å½•ä¸‹æœ‰ä¸€å¼ å›¾ç‰‡å«åšï¼šhh.jpg å¾ˆæ˜¾ç„¶çŽ°åœ¨è¿˜æ˜¯æ— æ³•å±•ç¤ºçš„ï¼ŒåŽŸå› æ˜¯æˆ‘è¿™é‡Œå†™æ­»äº†æ˜¯ä»¥text/htmlçš„å½¢å¼å“åº”ï¼Œä½†æ˜¯å›¾ç‰‡æ­£ç¡®çš„å“åº”æ˜¯image/jpegè¿™ç§æ ¼å¼ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½æ— è„‘å†™æ­»ï¼Œè¦è¿›è¡Œé€‚å½“çš„åˆ¤æ–­æ‰è¡Œã€‚ä¸‹é¢è´´å‡ºä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495public class ServerThread implements Runnable&#123; //æ ¹ç›®å½• private static final String webroot = "F:\\webroot\\"; private Socket client; InputStream ins; OutputStream out; //å­˜æ”¾ç±»åž‹ï¼Œæ¯”å¦‚jpgå¯¹åº”çš„æ˜¯image/jpegï¼Œè¿™æ˜¯httpåè®®è§„å®šçš„æ¯ç§ç±»åž‹çš„å“åº”æ ¼å¼ private static Map&lt;String,String&gt; contentMap = new HashMap&lt;&gt;(); static &#123; contentMap.put("html","text/html;charset=utf-8"); contentMap.put("jpg","image/jpeg"); contentMap.put("png","image/jpeg"); &#125; public ServerThread(Socket client)&#123; this.client = client; init(); &#125; private void init() &#123; try &#123; ins = client.getInputStream(); out = client.getOutputStream(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void run() &#123; try &#123; go(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; private void go() throws IOException &#123; //èŽ·å–è¯·æ±‚å†…å®¹ BufferedReader reader = new BufferedReader(new InputStreamReader(ins)); //èŽ·å–åˆ°è¯·æ±‚çš„èµ„æºåç§° String line = reader.readLine().split(" ")[1].replace("/","\\"); if(line.equals("\\"))&#123; line += "index.html"; &#125; System.out.println(line); //æ‹¼æŽ¥èµ·æ¥å°±æ˜¯èµ„æºçš„å®Œæ•´è·¯å¾„ File file = new File(webroot + line); //åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å“åº”å†…å®¹ï¼Œä¸å­˜åœ¨åˆ™å‘ŠçŸ¥ä¸å­˜åœ¨ if (file.exists()) &#123; //ç»™ç”¨æˆ·å“åº” PrintWriter pw = new PrintWriter(out); InputStream i = new FileInputStream(webroot + line); //ç”±äºŽéœ€è¦å°†å›¾ç‰‡ä¹Ÿè¦ä¼ ç»™å‰ç«¯ï¼Œå†ç”¨è¿™ä¸ªå°±ä¸å¥½åŠžäº†ï¼Œå¾—ç”¨æ™®é€šçš„æ–‡ä»¶è¾“å…¥æµ// BufferedReader fr = new BufferedReader(new InputStreamReader(i)); pw.println("HTTP/1.1 200 OK"); //è¿”å›žçš„ç±»åž‹æ˜¯åŠ¨æ€åˆ¤æ–­çš„ï¼Œå›¾ç‰‡ç”¨å›¾ç‰‡çš„ç±»åž‹ï¼Œæ–‡æœ¬ç”¨æ–‡æœ¬çš„ç±»åž‹ String s = contentMap.get(line.substring(line.lastIndexOf(".")+1,line.length())); System.out.println("è¿”å›žçš„ç±»åž‹ä¸ºï¼š"+ s); pw.println("Content-Type: " + s); pw.println("Content-Length:" + i.available()); pw.println("Server: hello-server"); pw.println("Date:"+ new Date()); pw.println(""); pw.flush(); //å†™å…¥è¾“å‡ºæµä¸­é€šè¿‡PrintWriterå‘ç»™æµè§ˆå™¨ byte[] buff = new byte[1024]; int len = 0; while ( (len = i.read(buff)) != -1)&#123; out.write(buff,0,len); &#125; pw.flush(); pw.close(); i.close(); reader.close(); client.close(); &#125;else &#123; StringBuffer error = new StringBuffer(); error.append("HTTP /1.1 400 file not found /r/n"); error.append("Content-Type:text/html \r\n"); error.append("Content-Length:20 \r\n").append("\r\n"); error.append("&lt;h1 &gt;File Not Found..&lt;/h1&gt;"); try &#123; out.write(error.toString().getBytes()); out.flush(); out.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; ok,ä½ ä¼šå‘çŽ°ï¼Œæˆ‘è¿˜æ·»åŠ äº†åˆ¤æ–­èµ„æºå­˜åœ¨ä¸å­˜åœ¨çš„é€»è¾‘ï¼Œè¿™æ ·æ˜¾å¾—æ›´åŠ å¥å…¨ä¸€ç‚¹ã€‚ å½“æ‰¾å¾—åˆ°èµ„æºå¾—æ—¶å€™ï¼š å½“æ‰¾ä¸åˆ°èµ„æºå¾—æ—¶å€™ï¼š å››ã€çº¿ç¨‹æ± æ–¹å¼ å…¶å®žå¾ˆç®€å•ï¼Œçº¿ç¨‹æ± çš„ä¼˜åŠ¿ä»¥å‰ä¹Ÿè¯´è¿‡ï¼Œä¸èµ˜è¿°ï¼Œç›´æŽ¥è´´ä¸€ä¸‹ä»£ç ç»“æŸã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„webæœåŠ¡å™¨çš„å¼€å‘ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹JDKåŠ¨æ€ä»£ç†]]></title>
    <url>%2F2019%2F02%2F17%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8BJDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%2F</url>
    <content type="text"><![CDATA[ä»£ç†æ¨¡å¼å¯ä»¥è¯´æ˜¯ç»å¸¸é¢è¯•è¢«é—®çš„ä¸€ä¸ªä¸œè¥¿ï¼Œå› ä¸ºspring aopçš„å®žçŽ°åŽŸç†å°±æ˜¯åŸºäºŽå®ƒï¼Œå…³äºŽå®ƒï¼Œåªè¦è®°ä½ï¼Œå®ƒæ˜¯è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªä»£ç†ç±»ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†åŽ»çœ‹çœ‹å®ƒåº•å±‚æºç ï¼Œå…¶å®žJDKå·²ç»å¸®æˆ‘ä»¬æœ€å¤§ç¨‹åº¦ä¸Šå°è£…æˆç®€å•çš„å‡½æ•°äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥å‡ ä¸ªå‚æ•°å°±å¯ä»¥ç”Ÿæˆå¯¹åº”çš„ä»£ç†å¯¹è±¡ã€‚ ä»£ç†æ¨¡å¼æ˜¯ä»€ä¹ˆ å®šä¹‰ï¼šç»™æŸä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æŽ§åˆ¶å¯¹äºŽåŽŸå¯¹è±¡çš„è®¿é—®ï¼Œå³å®¢æˆ·ä¸ç›´æŽ¥æ“æŽ§åŽŸå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†å¯¹è±¡é—´æŽ¥åœ°æ“æŽ§åŽŸå¯¹è±¡ã€‚ RealSubject æ˜¯åŽŸå¯¹è±¡ï¼ˆæœ¬æ–‡æŠŠåŽŸå¯¹è±¡ç§°ä¸º&quot;å§”æ‰˜å¯¹è±¡&quot;ï¼‰ï¼ŒProxy æ˜¯ä»£ç†å¯¹è±¡ã€‚ Subject æ˜¯å§”æ‰˜å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½å…±åŒå®žçŽ°çš„æŽ¥å£ã€‚ Request() æ˜¯å§”æ‰˜å¯¹è±¡å’Œä»£ç†å¯¹è±¡å…±åŒæ‹¥æœ‰çš„æ–¹æ³•ã€‚ ç»“åˆç”Ÿæ´»ç†è§£ä»£ç†æ¨¡å¼ è¦ç†è§£ä»£ç†æ¨¡å¼å¾ˆç®€å•ï¼Œå…¶å®žç”Ÿæ´»å½“ä¸­å°±å­˜åœ¨ä»£ç†æ¨¡å¼ï¼š æˆ‘ä»¬è´­ä¹°ç«è½¦ç¥¨å¯ä»¥åŽ»ç«è½¦ç«™ä¹°ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åŽ»ç«è½¦ç¥¨ä»£å”®å¤„ä¹°ï¼Œæ­¤å¤„çš„ç«è½¦ç¥¨ä»£å”®å¤„å°±æ˜¯ç«è½¦ç«™è´­ç¥¨çš„ä»£ç†ï¼Œå³æˆ‘ä»¬åœ¨ä»£å”®ç‚¹å‘å‡ºä¹°ç¥¨è¯·æ±‚ï¼Œä»£å”®ç‚¹ä¼šæŠŠè¯·æ±‚å‘ç»™ç«è½¦ç«™ï¼Œç«è½¦ç«™æŠŠè´­ä¹°æˆåŠŸå“åº”å‘ç»™ä»£å”®ç‚¹ï¼Œä»£å”®ç‚¹å†å‘Šè¯‰ä½ ã€‚ ä½†æ˜¯ä»£å”®ç‚¹åªèƒ½ä¹°ç¥¨ï¼Œä¸èƒ½é€€ç¥¨ï¼Œè€Œç«è½¦ç«™èƒ½ä¹°ç¥¨ä¹Ÿèƒ½é€€ç¥¨ï¼Œå› æ­¤ä»£ç†å¯¹è±¡æ”¯æŒçš„æ“ä½œå¯èƒ½å’Œå§”æ‰˜å¯¹è±¡çš„æ“ä½œæœ‰æ‰€ä¸åŒã€‚ Javaå®žçŽ°é™æ€ä»£ç†ç¤ºä¾‹ ä»£ç†çš„å®žçŽ°åˆ†ä¸ºï¼š é™æ€ä»£ç† ä»£ç†ç±»æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å®žçŽ°å¥½çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ Java ç¼–è¯‘å®ŒæˆåŽä»£ç†ç±»æ˜¯ä¸€ä¸ªå®žé™…çš„ class æ–‡ä»¶ã€‚ åŠ¨æ€ä»£ç† ä»£ç†ç±»æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ Java ç¼–è¯‘å®Œä¹‹åŽå¹¶æ²¡æœ‰å®žé™…çš„ class æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ°JVMä¸­ã€‚ Java å®žçŽ°åŠ¨æ€ä»£ç† å‡ ä¸ªé‡è¦åè¯: å§”æ‰˜ç±»å’Œå§”æ‰˜å¯¹è±¡ï¼šå§”æ‰˜ç±»æ˜¯ä¸€ä¸ªç±»ï¼Œå§”æ‰˜å¯¹è±¡æ˜¯å§”æ‰˜ç±»çš„å®žä¾‹ï¼Œå³åŽŸç±»ã€‚ ä»£ç†ç±»å’Œä»£ç†å¯¹è±¡ï¼šä»£ç†ç±»æ˜¯ä¸€ä¸ªç±»ï¼Œä»£ç†å¯¹è±¡æ˜¯ä»£ç†ç±»çš„å®žä¾‹ã€‚ Javaå®žçŽ°åŠ¨æ€ä»£ç†çš„å¤§è‡´æ­¥éª¤å¦‚ä¸‹: å®šä¹‰ä¸€ä¸ªå§”æ‰˜ç±»å’Œå…¬å…±æŽ¥å£ã€‚ è‡ªå·±å®šä¹‰ä¸€ä¸ªç±»ï¼ˆè°ƒç”¨å¤„ç†å™¨ç±»ï¼Œå³å®žçŽ° InvocationHandler æŽ¥å£ï¼‰ï¼Œè¿™ä¸ªç±»çš„ç›®çš„æ˜¯æŒ‡å®šè¿è¡Œæ—¶å°†ç”Ÿæˆçš„ä»£ç†ç±»éœ€è¦å®Œæˆçš„å…·ä½“ä»»åŠ¡ï¼ˆåŒ…æ‹¬Preprocesså’ŒPostprocessï¼‰ï¼Œå³ä»£ç†ç±»è°ƒç”¨ä»»ä½•æ–¹æ³•éƒ½ä¼šç»è¿‡è¿™ä¸ªè°ƒç”¨å¤„ç†å™¨ç±»ï¼ˆåœ¨æœ¬æ–‡æœ€åŽä¸€èŠ‚å¯¹æ­¤è¿›è¡Œè§£é‡Šï¼‰ã€‚ ç”Ÿæˆä»£ç†å¯¹è±¡ï¼ˆå½“ç„¶ä¹Ÿä¼šç”Ÿæˆä»£ç†ç±»ï¼‰ï¼Œéœ€è¦ä¸ºä»–æŒ‡å®š(1)ç±»åŠ è½½å™¨å¯¹è±¡(2)å®žçŽ°çš„ä¸€ç³»åˆ—æŽ¥å£(3)è°ƒç”¨å¤„ç†å™¨ç±»çš„å®žä¾‹ã€‚å› æ­¤å¯ä»¥çœ‹å‡ºä¸€ä¸ªä»£ç†å¯¹è±¡å¯¹åº”ä¸€ä¸ªå§”æ‰˜å¯¹è±¡ï¼Œå¯¹åº”ä¸€ä¸ªè°ƒç”¨å¤„ç†å™¨å®žä¾‹ã€‚ Java å®žçŽ°åŠ¨æ€ä»£ç†ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªç±»: java.lang.reflect.Proxy: è¿™æ˜¯ç”Ÿæˆä»£ç†ç±»çš„ä¸»ç±»ï¼Œé€šè¿‡ Proxy ç±»ç”Ÿæˆçš„ä»£ç†ç±»éƒ½ç»§æ‰¿äº† Proxy ç±»ï¼Œå³ DynamicProxyClass extends Proxyã€‚ java.lang.reflect.InvocationHandler: è¿™é‡Œç§°ä»–ä¸º&quot;è°ƒç”¨å¤„ç†å™¨&quot;ï¼Œä»–æ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œæˆ‘ä»¬åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»éœ€è¦å®Œæˆçš„å…·ä½“å†…å®¹éœ€è¦è‡ªå·±å®šä¹‰ä¸€ä¸ªç±»ï¼Œè€Œè¿™ä¸ªç±»å¿…é¡»å®žçŽ° InvocationHandler æŽ¥å£ã€‚ Proxy ç±»ä¸»è¦æ–¹æ³•ä¸ºï¼š è¿™ä¸ªé™æ€å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»åŠ è½½å™¨å¯¹è±¡ï¼ˆå³å“ªä¸ªç±»åŠ è½½å™¨æ¥åŠ è½½è¿™ä¸ªä»£ç†ç±»åˆ° JVM çš„æ–¹æ³•åŒºï¼‰ ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŽ¥å£ï¼ˆè¡¨æ˜Žä½ è¿™ä¸ªä»£ç†ç±»éœ€è¦å®žçŽ°å“ªäº›æŽ¥å£ï¼‰ ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è°ƒç”¨å¤„ç†å™¨ç±»å®žä¾‹ï¼ˆæŒ‡å®šä»£ç†ç±»ä¸­å…·ä½“è¦å¹²ä»€ä¹ˆï¼‰ã€‚ è¿™ä¸ªå‡½æ•°æ˜¯ JDK ä¸ºäº†ç¨‹åºå‘˜æ–¹ä¾¿åˆ›å»ºä»£ç†å¯¹è±¡è€Œå°è£…çš„ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤ä½ è°ƒç”¨newProxyInstance()æ—¶ç›´æŽ¥åˆ›å»ºäº†ä»£ç†å¯¹è±¡ï¼ˆç•¥åŽ»äº†åˆ›å»ºä»£ç†ç±»çš„ä»£ç ï¼‰ã€‚å…¶å®žä»–ä¸»è¦å®Œæˆäº†ä»¥ä¸‹å‡ ä¸ªå·¥ä½œï¼š Proxy ç±»è¿˜æœ‰ä¸€äº›é™æ€æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š InvocationHandler getInvocationHandler(Object proxy): èŽ·å¾—ä»£ç†å¯¹è±¡å¯¹åº”çš„è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ã€‚ Class getProxyClass(ClassLoader loader, Class[] interfaces): æ ¹æ®ç±»åŠ è½½å™¨å’Œå®žçŽ°çš„æŽ¥å£èŽ·å¾—ä»£ç†ç±»ã€‚ Proxy ç±»ä¸­æœ‰ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œæ˜ å°„å…³ç³»ä¸ºï¼š(&lt;ClassLoader&gt;,(&lt;Interfaces&gt;,&lt;ProxyClass&gt;) )ï¼Œå¯ä»¥çœ‹å‡ºä¸€çº§keyä¸ºç±»åŠ è½½å™¨ï¼Œæ ¹æ®è¿™ä¸ªä¸€çº§keyèŽ·å¾—äºŒçº§æ˜ å°„è¡¨ï¼ŒäºŒçº§keyä¸ºæŽ¥å£æ•°ç»„ï¼Œå› æ­¤å¯ä»¥çœ‹å‡ºï¼šä¸€ä¸ªç±»åŠ è½½å™¨å¯¹è±¡å’Œä¸€ä¸ªæŽ¥å£æ•°ç»„ç¡®å®šäº†ä¸€ä¸ªä»£ç†ç±»ã€‚ æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥é˜è¿° Java å®žçŽ°åŠ¨æ€ä»£ç†çš„æ•´ä¸ªè¿‡ç¨‹ï¼š InvocationHandler æŽ¥å£ä¸­æœ‰æ–¹æ³•ï¼šinvoke(Object proxy, Method method, Object[] args) è¿™ä¸ªå‡½æ•°æ˜¯åœ¨ä»£ç†å¯¹è±¡è°ƒç”¨ä»»ä½•ä¸€ä¸ªæ–¹æ³•æ—¶éƒ½ä¼šè°ƒç”¨çš„ï¼Œæ–¹æ³•ä¸åŒä¼šå¯¼è‡´ç¬¬äºŒä¸ªå‚æ•°methodä¸åŒï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»£ç†å¯¹è±¡ï¼ˆè¡¨ç¤ºå“ªä¸ªä»£ç†å¯¹è±¡è°ƒç”¨äº†methodæ–¹æ³•ï¼Œä¼ é€’æ¥çš„æ˜¯ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ Method å¯¹è±¡ï¼ˆè¡¨ç¤ºå“ªä¸ªæ–¹æ³•è¢«è°ƒç”¨äº†ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æŒ‡å®šè°ƒç”¨æ–¹æ³•çš„å‚æ•°ã€‚ åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»å…·æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š ç»§æ‰¿ Proxy ç±»ï¼Œå¹¶å®žçŽ°äº†åœ¨Proxy.newProxyInstance()ä¸­æä¾›çš„æŽ¥å£æ•°ç»„ã€‚ public finalã€‚ å‘½åæ–¹å¼ä¸º $ProxyNï¼Œå…¶ä¸­Nä¼šæ…¢æ…¢å¢žåŠ ï¼Œä¸€å¼€å§‹æ˜¯ $Proxy1ï¼ŒæŽ¥ä¸‹æ¥æ˜¯$Proxy2â€¦ æœ‰ä¸€ä¸ªå‚æ•°ä¸º InvocationHandler çš„æž„é€ å‡½æ•°ã€‚è¿™ä¸ªä»Ž Proxy.newProxyInstance() å‡½æ•°å†…éƒ¨çš„clazz.getConstructor(new Class[] { InvocationHandler.class }) å¯ä»¥çœ‹å‡ºã€‚ Java å®žçŽ°åŠ¨æ€ä»£ç†çš„ç¼ºç‚¹ï¼šå› ä¸º Java çš„å•ç»§æ‰¿ç‰¹æ€§ï¼ˆæ¯ä¸ªä»£ç†ç±»éƒ½ç»§æ‰¿äº† Proxy ç±»ï¼‰ï¼Œåªèƒ½é’ˆå¯¹æŽ¥å£åˆ›å»ºä»£ç†ç±»ï¼Œä¸èƒ½é’ˆå¯¹ç±»åˆ›å»ºä»£ç†ç±»ã€‚ ä¸éš¾å‘çŽ°ï¼Œä»£ç†ç±»çš„å®žçŽ°æ˜¯æœ‰å¾ˆå¤šå…±æ€§çš„ï¼ˆé‡å¤ä»£ç ï¼‰ï¼ŒåŠ¨æ€ä»£ç†çš„å¥½å¤„åœ¨äºŽé¿å…äº†è¿™äº›é‡å¤ä»£ç ï¼Œåªéœ€è¦å…³æ³¨æ“ä½œã€‚ å°æ —å­ å‡è®¾æ¨¡æ‹Ÿä¸€ä¸ªåœºæ™¯ï¼Œä¹°è¡£æœï¼Œæ­£å¸¸æƒ…å†µæ‰€æœ‰äººä¹°è¿™ä»¶è¡£æœè¦100å—é’±ã€‚ å®šä¹‰ä¸€ä¸ªé”€å”®æŽ¥å£ï¼š ä¸€ä¸ªå…·ä½“çš„å®žçŽ°ç±»ï¼š é‚£ä¹ˆæ­£å¸¸æƒ…å†µå¤§å®¶éƒ½è¦èŠ±100æ‰èƒ½ä¹°è¿™ä»¶è¡£æœã€‚ä½†æ˜¯çŽ°åœ¨å¯¹ä¼šå‘˜åšæ´»åŠ¨ï¼Œä¼šå‘˜æ‰“5æŠ˜ã€‚æ€Žä¹ˆåšå‘¢ï¼Ÿæ­£å¸¸æ€ç»´æ˜¯ï¼šå¢žåŠ ä¸€ä¸ªæŽ¥å£ï¼Œç”šè‡³æ›´ç³Ÿçš„æƒ³æ³•æ˜¯ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªå®žçŽ°ç±»ï¼Œéƒ½æ˜¯ä¸å¥½çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦æƒ³è¿‡è¿™æ ·çš„æ–¹æ¡ˆï¼šæ–°å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œè®©è¿™ä¸ªä»£ç†ç±»åŽ»åšç›¸åº”çš„é€»è¾‘å‘¢ï¼Ÿæ—¢ä¸ç”¨ä¿®æ”¹åŽŸæ¥çš„ä»£ç ï¼Œè€Œä¸”è¿˜å¾ˆç®€å•å°±èƒ½å®žçŽ°ã€‚ çŽ°åœ¨å†™ä¸€ä¸ªä»£ç†ç±»ï¼š é‚£ä¹ˆè°ƒç”¨çš„æ—¶å€™ï¼Œä¸€ä¸ªæ˜¯ä¼šå‘˜ï¼Œä¸€ä¸ªæ˜¯æ™®é€šç”¨æˆ·ï¼Œæ ¹æ®èº«ä»½è°ƒä¸åŒçš„æ–¹æ³•å³å¯ï¼š Java åŠ¨æ€ä»£ç†çš„å†…éƒ¨å®žçŽ° çŽ°åœ¨æˆ‘ä»¬å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼š Java æ˜¯æ€Žä¹ˆä¿è¯ä»£ç†å¯¹è±¡è°ƒç”¨çš„ä»»ä½•æ–¹æ³•éƒ½ä¼šè°ƒç”¨ InvocationHandler çš„ invoke() æ–¹æ³•çš„ï¼Ÿ è¿™å°±æ¶‰åŠåˆ°åŠ¨æ€ä»£ç†çš„å†…éƒ¨å®žçŽ°ã€‚å‡è®¾æœ‰ä¸€ä¸ªæŽ¥å£ Subjectï¼Œä¸”é‡Œé¢æœ‰ int request(int i) æ–¹æ³•ï¼Œåˆ™ç”Ÿæˆçš„ä»£ç†ç±»å¤§è‡´å¦‚ä¸‹ï¼š é€šè¿‡ä¸Šé¢çš„æ–¹æ³•å°±æˆåŠŸè°ƒç”¨äº† invoke() æ–¹æ³•ï¼Œæ‰€ä»¥è¿™æ˜¯ä»£ç†ç±»ä¸­å·²ç»æ³¨å®šè¦åŽ»æ‰§è¡Œ invoke() æ–¹æ³•äº†ã€‚ æœ‰ä¸€ç¯‡æ–‡ç« æ¯”è¾ƒç”ŸåŠ¨åœ°é˜è¿°äº†åŠ¨æ€ä»£ç†çš„å«ä¹‰ï¼šJavaå¸å›½ä¹‹åŠ¨æ€ä»£ç†]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŸºç¡€ä¹‹æ³¨è§£]]></title>
    <url>%2F2019%2F02%2F17%2Fjava-basic%2Fjava%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%B3%A8%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[æ³¨è§£æ˜¯ä¸€ç³»åˆ—å…ƒæ•°æ®ï¼Œå®ƒæä¾›æ•°æ®ç”¨æ¥è§£é‡Šç¨‹åºä»£ç ï¼Œæ³¨é‡Šæ˜¯ç»™äººçœ‹çš„ï¼Œæ³¨è§£æ˜¯ç»™ç¼–è¯‘å™¨çœ‹çš„ï¼Œå› æ­¤æ³¨è§£åªåœ¨ç¼–è¯‘å™¨æœ‰æ•ˆã€‚æ³¨è§£çš„å®žçŽ°åŽŸç†æ¶‰åŠåå°„å’ŒåŠ¨æ€ä»£ç†ï¼Œå…³äºŽåå°„å·²ç»åœ¨å‰é¢è¯´è¿‡ï¼ŒåŠ¨æ€ä»£ç†è¿˜æ²¡è¯´ï¼Œç•™åœ¨ä¸‹ä¸€èŠ‚ã€‚ æ³¨è§£è¯­æ³• ç›¸ä¿¡æœ‰ä¸å°‘çš„äººå‘˜ä¼šè®¤ä¸ºæ³¨è§£çš„åœ°ä½ä¸é«˜ã€‚å…¶å®žåŒ classs å’Œ interface ä¸€æ ·ï¼Œæ³¨è§£ä¹Ÿå±žäºŽä¸€ç§ç±»åž‹ã€‚å®ƒæ˜¯åœ¨ Java SE 5.0 ç‰ˆæœ¬ä¸­å¼€å§‹å¼•å…¥çš„æ¦‚å¿µã€‚ æ³¨è§£çš„å®šä¹‰ æ³¨è§£é€šè¿‡ @interface å…³é”®å­—è¿›è¡Œå®šä¹‰ã€‚ 1public @interface TestAnnotation &#123;&#125; ä½ å¯ä»¥ç®€å•ç†è§£ä¸ºåˆ›å»ºäº†ä¸€å¼ åå­—ä¸º TestAnnotation çš„æ ‡ç­¾ã€‚ æ³¨è§£çš„ä½¿ç”¨ ä¸Šé¢åˆ›å»ºäº†ä¸€ä¸ªæ³¨è§£ï¼Œé‚£ä¹ˆæ³¨è§£çš„çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ã€‚ 12@TestAnnotationpublic class Test &#123;&#125; ä¸è¿‡ï¼Œè¦æƒ³æ³¨è§£èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œè¿˜éœ€è¦ä»‹ç»ä¸€ä¸‹ä¸€ä¸ªæ–°çš„æ¦‚å¿µé‚£å°±æ˜¯å…ƒæ³¨è§£ã€‚ ä»€ä¹ˆæ˜¯å…ƒæ³¨è§£ å…ƒæ³¨è§£æ˜¯å¯ä»¥æ³¨è§£åˆ°æ³¨è§£ä¸Šçš„æ³¨è§£ï¼Œæˆ–è€…è¯´å…ƒæ³¨è§£æ˜¯ä¸€ç§åŸºæœ¬æ³¨è§£ï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿåº”ç”¨åˆ°å…¶å®ƒçš„æ³¨è§£ä¸Šé¢ã€‚ å…ƒæ ‡ç­¾æœ‰ @Retentionã€@Documentedã€@Targetã€@Inheritedã€@Repeatable 5 ç§ã€‚ @Retention Retention çš„è‹±æ–‡æ„ä¸ºä¿ç•™æœŸçš„æ„æ€ã€‚å½“ @Retention åº”ç”¨åˆ°ä¸€ä¸ªæ³¨è§£ä¸Šçš„æ—¶å€™ï¼Œå®ƒè§£é‡Šè¯´æ˜Žäº†è¿™ä¸ªæ³¨è§£çš„çš„å­˜æ´»æ—¶é—´ã€‚ RetentionPolicy.SOURCE æ³¨è§£åªåœ¨æºç é˜¶æ®µä¿ç•™ï¼Œåœ¨ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶å®ƒå°†è¢«ä¸¢å¼ƒå¿½è§†ã€‚ RetentionPolicy.CLASS æ³¨è§£åªè¢«ä¿ç•™åˆ°ç¼–è¯‘è¿›è¡Œçš„æ—¶å€™ï¼Œå®ƒå¹¶ä¸ä¼šè¢«åŠ è½½åˆ° JVM ä¸­ã€‚ RetentionPolicy.RUNTIME æ³¨è§£å¯ä»¥ä¿ç•™åˆ°ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šè¢«åŠ è½½è¿›å…¥åˆ° JVM ä¸­ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶å¯ä»¥èŽ·å–åˆ°å®ƒä»¬ã€‚ 12@Retention(RetentionPolicy.RUNTIME)public @interface TestAnnotation &#123;&#125; @Documented é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªå…ƒæ³¨è§£è‚¯å®šæ˜¯å’Œæ–‡æ¡£æœ‰å…³ã€‚å®ƒçš„ä½œç”¨æ˜¯èƒ½å¤Ÿå°†æ³¨è§£ä¸­çš„å…ƒç´ åŒ…å«åˆ° Javadoc ä¸­åŽ»ã€‚ @Target Target æ˜¯ç›®æ ‡çš„æ„æ€ï¼Œ@Target æŒ‡å®šäº†æ³¨è§£è¿ç”¨çš„åœ°æ–¹ã€‚ ElementType.ANNOTATION_TYPE å¯ä»¥ç»™ä¸€ä¸ªæ³¨è§£è¿›è¡Œæ³¨è§£ ElementType.CONSTRUCTOR å¯ä»¥ç»™æž„é€ æ–¹æ³•è¿›è¡Œæ³¨è§£ ElementType.FIELD å¯ä»¥ç»™å±žæ€§è¿›è¡Œæ³¨è§£ ElementType.LOCAL_VARIABLE å¯ä»¥ç»™å±€éƒ¨å˜é‡è¿›è¡Œæ³¨è§£ ElementType.METHOD å¯ä»¥ç»™æ–¹æ³•è¿›è¡Œæ³¨è§£ ElementType.PACKAGE å¯ä»¥ç»™ä¸€ä¸ªåŒ…è¿›è¡Œæ³¨è§£ ElementType.PARAMETER å¯ä»¥ç»™ä¸€ä¸ªæ–¹æ³•å†…çš„å‚æ•°è¿›è¡Œæ³¨è§£ ElementType.TYPE å¯ä»¥ç»™ä¸€ä¸ªç±»åž‹è¿›è¡Œæ³¨è§£ï¼Œæ¯”å¦‚ç±»ã€æŽ¥å£ã€æžšä¸¾ @Inherited Inherited æ˜¯ç»§æ‰¿çš„æ„æ€ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯è¯´æ³¨è§£æœ¬èº«å¯ä»¥ç»§æ‰¿ï¼Œè€Œæ˜¯è¯´å¦‚æžœä¸€ä¸ªè¶…ç±»è¢« @Inherited æ³¨è§£è¿‡çš„æ³¨è§£è¿›è¡Œæ³¨è§£çš„è¯ï¼Œé‚£ä¹ˆå¦‚æžœå®ƒçš„å­ç±»æ²¡æœ‰è¢«ä»»ä½•æ³¨è§£åº”ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå­ç±»å°±ç»§æ‰¿äº†è¶…ç±»çš„æ³¨è§£ã€‚ 1234567891011//å®šä¹‰ä¸€ä¸ªè¢«@Inheritedæ³¨è§£çš„æ³¨è§£@Test@Inherited@Retention(RetentionPolicy.RUNTIME)@interface Test &#123;&#125;//çˆ¶ç±»è¢«@Testæ³¨è§£ï¼Œå³ä¸Šé¢è¯´çš„è¢«@Inherited æ³¨è§£è¿‡çš„æ³¨è§£è¿›è¡Œæ³¨è§£@Testpublic class A &#123;&#125;//é‚£ä¹ˆclass Bä¹Ÿæ‹¥æœ‰@Testæ³¨è§£public class B extends A &#123;&#125; @Repeatable Repeatable è‡ªç„¶æ˜¯å¯é‡å¤çš„æ„æ€ã€‚@Repeatable æ˜¯ Java 1.8 æ‰åŠ è¿›æ¥çš„ï¼Œæ‰€ä»¥ç®—æ˜¯ä¸€ä¸ªæ–°çš„ç‰¹æ€§ã€‚ ä»€ä¹ˆæ ·çš„æ³¨è§£ä¼šå¤šæ¬¡åº”ç”¨å‘¢ï¼Ÿé€šå¸¸æ˜¯æ³¨è§£çš„å€¼å¯ä»¥åŒæ—¶å–å¤šä¸ªã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªäººä»–æ—¢æ˜¯ç¨‹åºå‘˜åˆæ˜¯äº§å“ç»ç†,åŒæ—¶ä»–è¿˜æ˜¯ä¸ªç”»å®¶ã€‚ 12345678910111213141516171819202122232425262728//æŒ‰ç…§è§„å®šï¼Œå®ƒé‡Œé¢å¿…é¡»è¦æœ‰ä¸€ä¸ª value çš„å±žæ€§//å±žæ€§ç±»åž‹æ˜¯ä¸€ä¸ªè¢« @Repeatable æ³¨è§£è¿‡çš„æ³¨è§£æ•°ç»„ï¼Œæ³¨æ„å®ƒæ˜¯æ•°ç»„ã€‚@interface Persons &#123; Person[] value();&#125;//@Repeatable åŽé¢æ‹¬å·ä¸­çš„ç±»ç›¸å½“äºŽä¸€ä¸ªå®¹å™¨æ³¨è§£//ä»€ä¹ˆæ˜¯å®¹å™¨æ³¨è§£å‘¢ï¼Ÿå°±æ˜¯ç”¨æ¥å­˜æ”¾å…¶å®ƒæ³¨è§£çš„åœ°æ–¹ã€‚å®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ³¨è§£ã€‚@Repeatable(Persons.class)@interface Person&#123; String role() default "";&#125;//æœ‰äº†ä¸Šé¢ä¸¤ä¸ªæ³¨è§£ï¼ŒPersonsç›¸å½“äºŽä¸€ä¸ªæ€»æ ‡ç­¾//ä»–é‡Œé¢å¯ä»¥æ”¾ä»»æ„å¤šä¸ªå­æ ‡ç­¾ï¼Œè¿™äº›å­æ ‡ç­¾ç±»åž‹æ˜¯Person//å¹¶ä¸”æ˜¯å­˜æ”¾äºŽè¿™ä¸ªæ€»æ ‡ç­¾çš„Personç±»åž‹çš„æ•°ç»„ä¸­ã€‚//é‚£ä¹ˆæ—¢ç„¶æœ‰äº†æ€»æ ‡ç­¾å’Œæ”¾å­æ ‡ç­¾çš„æ•°ç»„ï¼Œé‚£ä¹ˆï¼Œä¸‹é¢å°±å¯ä»¥å®šä¹‰å­æ ‡ç­¾//å­æ ‡ç­¾çš„ç±»åž‹è‡ªç„¶å°±æ˜¯Personï¼Œé‡Œé¢è¿™é‡Œå‡è®¾å®šä¹‰roleå±žæ€§//å°±æ˜¯è¯´è¿™äº›å­æ ‡ç­¾è¡¨ç¤ºäººçš„è§’è‰²ã€‚//è‡ªç„¶ä¹Ÿå°±æ”¯æŒå¤šç§è§’è‰²ï¼Œé‚£ä¹ˆå®šä¹‰å¤šæ¬¡å³å¯ã€‚å¦‚ä¸‹@Person(role="artist")@Person(role="coder")@Person(role="PM")public class SuperMan&#123;&#125; æ³¨è§£çš„å±žæ€§ 123456789@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)public @interface TestAnnotation &#123; public int id() default -1; public String msg() default "Hi";&#125; ä½¿ç”¨ï¼š 12345//æœ‰é»˜è®¤å€¼çš„æ—¶å€™ï¼Œå¯ä»¥ä¸æ‰§è¡Œå±žæ€§@TestAnnotation(id=3,msg="hello annotation")public class Test &#123;&#125; æœ‰ä¸€äº›è§„åˆ™ï¼š ä¿®é¥°ç¬¦åªèƒ½æ˜¯public æˆ–é»˜è®¤(default) å‚æ•°æˆå‘˜åªèƒ½ç”¨åŸºæœ¬ç±»åž‹byte,short,int,long,float,double,boolean,charå…«ç§åŸºæœ¬ç±»åž‹å’ŒString,Enum,Class,annotationsåŠè¿™äº›ç±»åž‹çš„æ•°ç»„ å¦‚æžœåªæœ‰ä¸€ä¸ªå‚æ•°æˆå‘˜,æœ€å¥½å°†åç§°è®¾ä¸ºâ€valueâ€ æ³¨è§£å…ƒç´ å¿…é¡»æœ‰ç¡®å®šçš„å€¼,å¯ä»¥åœ¨æ³¨è§£ä¸­å®šä¹‰é»˜è®¤å€¼,ä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£æ—¶æŒ‡å®š,éžåŸºæœ¬ç±»åž‹çš„å€¼ä¸å¯ä¸ºnull,å¸¸ä½¿ç”¨ç©ºå­—ç¬¦ä¸²æˆ–0ä½œé»˜è®¤å€¼ åœ¨è¡¨çŽ°ä¸€ä¸ªå…ƒç´ å­˜åœ¨æˆ–ç¼ºå¤±çš„çŠ¶æ€æ—¶,å®šä¹‰ä¸€ä¸‹ç‰¹æ®Šå€¼æ¥è¡¨ç¤º,å¦‚ç©ºå­—ç¬¦ä¸²æˆ–è´Ÿå€¼ Java é¢„ç½®çš„æ³¨è§£ @Deprecated è¿™ä¸ªå…ƒç´ æ˜¯ç”¨æ¥æ ‡è®°è¿‡æ—¶çš„å…ƒç´ ï¼Œæƒ³å¿…å¤§å®¶åœ¨æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç¢°åˆ°ã€‚ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µé‡åˆ°è¿™ä¸ªæ³¨è§£æ—¶ä¼šå‘å‡ºæé†’è­¦å‘Šï¼Œå‘Šè¯‰å¼€å‘è€…æ­£åœ¨è°ƒç”¨ä¸€ä¸ªè¿‡æ—¶çš„å…ƒç´ æ¯”å¦‚è¿‡æ—¶çš„æ–¹æ³•ã€è¿‡æ—¶çš„ç±»ã€è¿‡æ—¶çš„æˆå‘˜å˜é‡ã€‚ @Override è¿™ä¸ªå¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œæç¤ºå­ç±»è¦å¤å†™çˆ¶ç±»ä¸­è¢« @Override ä¿®é¥°çš„æ–¹æ³• @SuppressWarnings é˜»æ­¢è­¦å‘Šçš„æ„æ€ã€‚ä¹‹å‰è¯´è¿‡è°ƒç”¨è¢« @Deprecated æ³¨è§£çš„æ–¹æ³•åŽï¼Œç¼–è¯‘å™¨ä¼šè­¦å‘Šæé†’ï¼Œè€Œæœ‰æ—¶å€™å¼€å‘è€…ä¼šå¿½ç•¥è¿™ç§è­¦å‘Šï¼Œä»–ä»¬å¯ä»¥åœ¨è°ƒç”¨çš„åœ°æ–¹é€šè¿‡ @SuppressWarnings è¾¾åˆ°ç›®çš„ã€‚ @SafeVarargs å‚æ•°å®‰å…¨ç±»åž‹æ³¨è§£ã€‚å®ƒçš„ç›®çš„æ˜¯æé†’å¼€å‘è€…ä¸è¦ç”¨å‚æ•°åšä¸€äº›ä¸å®‰å…¨çš„æ“ä½œ,å®ƒçš„å­˜åœ¨ä¼šé˜»æ­¢ç¼–è¯‘å™¨äº§ç”Ÿ unchecked è¿™æ ·çš„è­¦å‘Šã€‚ @FunctionalInterface å‡½æ•°å¼æŽ¥å£æ³¨è§£ï¼Œè¿™ä¸ªæ˜¯ Java 1.8 ç‰ˆæœ¬å¼•å…¥çš„æ–°ç‰¹æ€§ã€‚å‡½æ•°å¼ç¼–ç¨‹å¾ˆç«ï¼Œæ‰€ä»¥ Java 8 ä¹ŸåŠæ—¶æ·»åŠ äº†è¿™ä¸ªç‰¹æ€§ã€‚ å‡½æ•°å¼æŽ¥å£ (Functional Interface) å°±æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€ä¸ªæ–¹æ³•çš„æ™®é€šæŽ¥å£ã€‚ 123456789101112131415@FunctionalInterfacepublic interface Runnable &#123; /** * When an object implementing interface &lt;code&gt;Runnable&lt;/code&gt; is used * to create a thread, starting the thread causes the object's * &lt;code&gt;run&lt;/code&gt; method to be called in that separately executing * thread. * &lt;p&gt; * The general contract of the method &lt;code&gt;run&lt;/code&gt; is that it may * take any action whatsoever. * * @see java.lang.Thread#run() */ public abstract void run();&#125; æˆ‘ä»¬è¿›è¡Œçº¿ç¨‹å¼€å‘ä¸­å¸¸ç”¨çš„ Runnable å°±æ˜¯ä¸€ä¸ªå…¸åž‹çš„å‡½æ•°å¼æŽ¥å£ï¼Œä¸Šé¢æºç å¯ä»¥çœ‹åˆ°å®ƒå°±è¢« @FunctionalInterface æ³¨è§£ã€‚ å¯èƒ½æœ‰äººä¼šç–‘æƒ‘ï¼Œå‡½æ•°å¼æŽ¥å£æ ‡è®°æœ‰ä»€ä¹ˆç”¨ï¼Œè¿™ä¸ªåŽŸå› æ˜¯å‡½æ•°å¼æŽ¥å£å¯ä»¥å¾ˆå®¹æ˜“è½¬æ¢ä¸º Lambda è¡¨è¾¾å¼ã€‚ æ³¨è§£ä¸Žåå°„ æ³¨è§£é€šè¿‡åå°„èŽ·å–ã€‚é¦–å…ˆå¯ä»¥é€šè¿‡ Class å¯¹è±¡çš„ isAnnotationPresent() æ–¹æ³•åˆ¤æ–­å®ƒæ˜¯å¦åº”ç”¨äº†æŸä¸ªæ³¨è§£ 1public boolean isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass) &#123;&#125; ç„¶åŽé€šè¿‡ getAnnotation() æ–¹æ³•æ¥èŽ·å– Annotation å¯¹è±¡ã€‚ 1public &lt;A extends Annotation&gt; A getAnnotation(Class&lt;A&gt; annotationClass) &#123;&#125; æˆ–è€…æ˜¯ getAnnotations() æ–¹æ³•ã€‚ 1public Annotation[] getAnnotations() &#123;&#125; è¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼š é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼š 123456789@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)public @interface TestAnnotation &#123; public int id() default -1; public String msg() default "Hi";&#125; ç„¶åŽå®šä¹‰ä¸€ä¸ªç±»ï¼Œæ‰“ä¸Šè¿™ä¸ªæ³¨è§£ï¼š 123@TestAnnotationpublic class Test &#123;&#125; æœ€åŽå†mainå‡½æ•°ä¸­æ‹¿åˆ°æ³¨è§£ï¼š 1234567891011121314public class Main4 &#123; public static void main(String[] args) &#123; //åˆ¤æ–­Test.classä¸­æ˜¯å¦å­˜åœ¨TestAnnotationæ³¨è§£ boolean hasAnnotation = Test.class.isAnnotationPresent(TestAnnotation.class); if(hasAnnotation)&#123; System.out.println("æ³¨è§£å­˜åœ¨..."); //ä»ŽTestç±»ä¸­æ‹¿å‡ºTestAnnotationæ³¨è§£ TestAnnotation annotation = Test.class.getAnnotation(TestAnnotation.class); //æ‹¿åˆ°æ³¨è§£ä¹‹åŽï¼Œå¯ä»¥æ‹¿å‡ºæ³¨è§£ä¸­çš„å±žæ€§å¯¹åº”çš„é»˜è®¤å€¼ System.out.println(annotation.id()); System.out.println(annotation.msg()); &#125; &#125;&#125; ä¸Šé¢æ¼”ç¤ºçš„æ˜¯ä»Žç±»ä¸Šæ‹¿åˆ°æ³¨è§£ï¼Œå¯¹äºŽå±žæ€§ã€æ–¹æ³•åŒæ ·éƒ½å¯ä»¥ç”¨åå°„æ‹¿åˆ°æ³¨è§£ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class Test &#123; @Check(value="hi") int a; @Perform public void testMethod()&#123;&#125; public static void main(String[] args) &#123; try &#123;/*************æ‹¿åˆ°å±žæ€§ä¸Šçš„æ³¨è§£****************/ Field a = Test.class.getDeclaredField("a"); a.setAccessible(true); //èŽ·å–ä¸€ä¸ªæˆå‘˜å˜é‡ä¸Šçš„æ³¨è§£ Check check = a.getAnnotation(Check.class); if ( check != null ) &#123; System.out.println("check value:"+check.value()); &#125;/*************æ‹¿åˆ°æ–¹æ³•ä¸Šçš„æ³¨è§£****************/ Method testMethod = Test.class.getDeclaredMethod("testMethod"); if ( testMethod != null ) &#123; // èŽ·å–æ–¹æ³•ä¸­çš„æ³¨è§£ Annotation[] ans = testMethod.getAnnotations(); for( int i = 0;i &lt; ans.length;i++) &#123; System.out.println("method testMethod annotation:"+ans[i].annotationType().getSimpleName()); &#125; &#125; &#125; catch (NoSuchFieldException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); System.out.println(e.getMessage()); &#125; catch (SecurityException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); System.out.println(e.getMessage()); &#125; catch (NoSuchMethodException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); System.out.println(e.getMessage()); &#125; &#125;&#125; æ³¨è§£å®žçŽ°åŽŸç† åœ¨ä¸Šé¢èŽ·å–æ³¨è§£æ—¶æ˜¯è¿™æ ·å†™çš„ï¼š 1TestAnnotation annotation = Test.class.getAnnotation(TestAnnotation.class); å®ƒæ˜¯ä»Žclassä¸­èŽ·å–å‡ºTestAnnotationæ³¨è§£çš„ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯åœ¨æŸä¸ªæ—¶å€™æ³¨è§£è¢«åŠ å…¥åˆ°classç»“æž„ä¸­åŽ»äº†ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ä»Žjavaæºç åˆ°classå­—èŠ‚ç æ˜¯ç”±ç¼–è¯‘å™¨å®Œæˆçš„ï¼Œç¼–è¯‘å™¨ä¼šå¯¹javaæºç è¿›è¡Œè§£æžå¹¶ç”Ÿæˆclassæ–‡ä»¶ã€‚ è€Œæ³¨è§£ä¹Ÿæ˜¯åœ¨ç¼–è¯‘æ—¶ç”±ç¼–è¯‘å™¨è¿›è¡Œå¤„ç†ï¼Œç¼–è¯‘å™¨ä¼šå¯¹æ³¨è§£ç¬¦å·å¤„ç†å¹¶é™„åŠ åˆ°classç»“æž„ä¸­ æ ¹æ®jvmè§„èŒƒï¼Œclassæ–‡ä»¶ç»“æž„æ˜¯ä¸¥æ ¼æœ‰åºçš„æ ¼å¼ï¼Œå”¯ä¸€å¯ä»¥é™„åŠ ä¿¡æ¯åˆ°classç»“æž„ä¸­çš„æ–¹å¼å°±æ˜¯ä¿å­˜åˆ°classç»“æž„çš„attributeså±žæ€§ä¸­ æˆ‘ä»¬çŸ¥é“å¯¹äºŽç±»ã€å­—æ®µã€æ–¹æ³•ï¼Œåœ¨classç»“æž„ä¸­éƒ½æœ‰è‡ªå·±ç‰¹å®šçš„è¡¨ç»“æž„ï¼Œè€Œä¸”å„è‡ªéƒ½æœ‰è‡ªå·±çš„å±žæ€§ï¼Œè€Œå¯¹äºŽæ³¨è§£ï¼Œä½œç”¨çš„èŒƒå›´ä¹Ÿå¯ä»¥ä¸åŒï¼Œå¯ä»¥ä½œç”¨åœ¨ç±»ä¸Šï¼Œä¹Ÿå¯ä»¥ä½œç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œè¿™æ—¶ç¼–è¯‘å™¨ä¼šå¯¹åº”å°†æ³¨è§£ä¿¡æ¯å­˜æ”¾åˆ°ç±»ã€å­—æ®µã€æ–¹æ³•è‡ªå·±çš„å±žæ€§ä¸Šã€‚ åœ¨æˆ‘ä»¬çš„Testç±»è¢«ç¼–è¯‘åŽï¼Œåœ¨å¯¹åº”çš„Test.classæ–‡ä»¶ä¸­ä¼šåŒ…å«ä¸€ä¸ªRuntimeVisibleAnnotationså±žæ€§ï¼Œç”±äºŽè¿™ä¸ªæ³¨è§£æ˜¯ä½œç”¨åœ¨ç±»ä¸Šï¼Œæ‰€ä»¥æ­¤å±žæ€§è¢«æ·»åŠ åˆ°ç±»çš„å±žæ€§é›†ä¸Šã€‚å³TestAnnotationæ³¨è§£çš„é”®å€¼å¯¹value=testä¼šè¢«è®°å½•èµ·æ¥ã€‚ è€Œå½“JVMåŠ è½½Test.classæ–‡ä»¶å­—èŠ‚ç æ—¶ï¼Œå°±ä¼šå°†RuntimeVisibleAnnotationså±žæ€§å€¼ä¿å­˜åˆ°Testçš„Classå¯¹è±¡ä¸­ï¼ŒäºŽæ˜¯å°±å¯ä»¥é€šè¿‡Test.class.getAnnotation(TestAnnotation.class)èŽ·å–åˆ°Testæ³¨è§£å¯¹è±¡ï¼Œè¿›è€Œå†é€šè¿‡Testæ³¨è§£å¯¹è±¡èŽ·å–åˆ°Testé‡Œé¢çš„å±žæ€§å€¼ã€‚ Testæ³¨è§£å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿå…¶å®žæ³¨è§£è¢«ç¼–è¯‘åŽçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªç»§æ‰¿AnnotationæŽ¥å£çš„æŽ¥å£ã€‚æ‰€ä»¥@TestAnnotationå…¶å®žå°±æ˜¯â€œpublic interface TestAnnotation extends Annotationâ€ å½“æˆ‘ä»¬é€šè¿‡Test.class.getAnnotation(TestAnnotation.class)è°ƒç”¨æ—¶ï¼ŒJDKä¼šé€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆä¸€ä¸ªå®žçŽ°äº†TestAnnotationæŽ¥å£çš„å¯¹è±¡ï¼Œå¹¶æŠŠå°†RuntimeVisibleAnnotationså±žæ€§å€¼è®¾ç½®è¿›æ­¤å¯¹è±¡ä¸­ï¼Œæ­¤å¯¹è±¡å³ä¸ºTestAnnotationæ³¨è§£å¯¹è±¡ï¼Œé€šè¿‡å®ƒçš„value()æ–¹æ³•å°±å¯ä»¥èŽ·å–åˆ°æ³¨è§£å€¼ã€‚ æ€»ç»“æ³¨è§£åˆ°åº•æ˜¯ä»€ä¹ˆä»¥åŠæ³¨è§£åˆ°åº•æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ æ³¨é‡Šæ˜¯ç»™äººçœ‹çš„ï¼Œæ³¨è§£æ˜¯ç»™ç¼–è¯‘å™¨çœ‹çš„ï¼Œä»¥@Overrideæ³¨è§£ä¸ºä¾‹ï¼Œä»–çš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ä»–æ‰€æ³¨è§£çš„æ–¹æ³•æ˜¯é‡å†™çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¼šåŽ»æ£€æŸ¥çˆ¶ç±»æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ–¹æ³•ï¼Œä»¥åŠè¿™ä¸ªæ–¹æ³•çš„ç­¾åä¸Žçˆ¶ç±»æ˜¯å¦ç›¸åŒã€‚ æ³¨è§£ä¸ä¼šä¹Ÿä¸èƒ½å½±å“ä»£ç çš„å®žé™…é€»è¾‘ï¼Œä»…ä»…èµ·åˆ°è¾…åŠ©æ€§çš„ä½œç”¨ï¼› ä¹Ÿå°±æ˜¯è¯´ï¼Œæ³¨è§£åªæ˜¯æè¿°javaä»£ç çš„ä»£ç ï¼Œèƒ½è¢«ç¼–è¯‘å™¨è§£æžï¼Œåªæœ‰ç¼–è¯‘å™¨æˆ–è€…è™šæ‹Ÿæœºæ¥ä¸»åŠ¨è§£æžä»–çš„æ—¶å€™ï¼Œä»–æ‰å¯èƒ½å‘æŒ¥ä½œç”¨ã€‚ æ³¨è§£åˆ†ä¸ºä¸‰ç±»ï¼Œå…ƒæ³¨è§£ï¼Œjavaè‡ªå¸¦çš„æ ‡å‡†æ³¨è§£ä»¥åŠè‡ªå®šä¹‰æ³¨è§£ã€‚ æ³¨è§£çš„ä½¿ç”¨åœºæ™¯ï¼š ç”Ÿæˆæ–‡æ¡£ï¼Œé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®ç”Ÿæˆjavadocæ–‡æ¡£ã€‚ ç¼–è¯‘æ£€æŸ¥ï¼Œé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®è®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´è¿›è¡Œæ£€æŸ¥éªŒè¯ã€‚ ç¼–è¯‘æ—¶åŠ¨æ€å¤„ç†ï¼Œç¼–è¯‘æ—¶é€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®åŠ¨æ€å¤„ç†ï¼Œä¾‹å¦‚åŠ¨æ€ç”Ÿæˆä»£ç ã€‚ è¿è¡Œæ—¶åŠ¨æ€å¤„ç†ï¼Œè¿è¡Œæ—¶é€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®åŠ¨æ€å¤„ç†ï¼Œä¾‹å¦‚ä½¿ç”¨åå°„æ³¨å…¥å®žä¾‹ã€‚ æˆ‘è§‰å¾—è¿™äº›è¯´çš„å¤ªç©ºæ´žäº†ï¼Œæ³¨è§£åœ¨springä¸­å°±æ˜¯éžå¸¸å¸¸ç”¨çš„æŠ€æœ¯ï¼Œæ¯”å¦‚ï¼Œæˆ‘æŒ‡å®šè¿™ä¸ªç±»æ˜¯@Controlleræˆ–è€…@Serviceä¹‹ç±»ï¼Œé‚£ä¹ˆæˆ‘é…ç½®åŒ…æ‰«æå°†å…¶ç±»è·¯å¾„å…¨éƒ¨æ‰«æåˆ°åŽï¼Œå¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œè¿™äº›ç±»å°±ä¼šè‡ªåŠ¨è¢«springæ‰€ç®¡ç†ï¼Œå³è‡ªåŠ¨å‘springæ³¨å†Œï¼Œä»¥åŽè¦æ³¨å…¥è¿™äº›ç»„ä»¶çš„æ—¶å€™ï¼Œå°±ç›´æŽ¥ä»Žspringçš„IOCå®¹å™¨ä¸­å–å‡ºæ¥å³å¯ã€‚]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JavaåŸºç¡€ä¹‹å†°å·è¡¨é¢]]></title>
    <url>%2F2019%2F02%2F17%2Fjava-basic%2FJava%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%86%B0%E5%B7%9D%E8%A1%A8%E9%9D%A2%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡æ–‡ç« æ˜¯ç½—åˆ—ä¸€äº›å…³äºŽjavaåŸºç¡€çš„æ ¸å¿ƒç‚¹ï¼Œè¿™äº›ç‚¹æ˜¯åŸºç¡€ä¸­çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯é‡ç‚¹ä¸­çš„é‡ç‚¹ã€‚ä¸ºä»€ä¹ˆæœ¬ç¯‡æ–‡ç« å«åšå†°å·è¡¨é¢å‘¢ï¼Ÿæˆ‘æƒ³è¡¨è¾¾çš„æ„æ€æ˜¯ï¼Œè¿™äº›åŸºç¡€åªæ˜¯ä¸€ä¸ªå¼•å­ï¼ŒèƒŒåŽç‰µæ‰¯å‡ºæ¥çš„ä¸œè¥¿å¯èƒ½ä¼šå¾ˆå¤šï¼Œé¢è¯•å¾€å¾€éƒ½æ˜¯ä»ŽåŸºç¡€çš„çŸ¥è¯†ç‚¹æ…¢æ…¢æ·±å…¥æŒ–æŽ˜çš„ï¼Œæ‰€ä»¥åƒä¸‡ä¸èƒ½å¿½è§†å¯¹äºŽå®ƒä»¬çš„å¤ä¹ ã€‚ ä¸€ã€å…³é”®å­— final 1. æ•°æ® å£°æ˜Žæ•°æ®ä¸ºå¸¸é‡ï¼Œå¯ä»¥æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨è¿è¡Œæ—¶è¢«åˆå§‹åŒ–åŽä¸èƒ½è¢«æ”¹å˜çš„å¸¸é‡ã€‚ å¯¹äºŽåŸºæœ¬ç±»åž‹ï¼Œfinal ä½¿æ•°å€¼ä¸å˜ï¼› å¯¹äºŽå¼•ç”¨ç±»åž‹ï¼Œfinal ä½¿å¼•ç”¨ä¸å˜ï¼Œä¹Ÿå°±ä¸èƒ½å¼•ç”¨å…¶å®ƒå¯¹è±¡ï¼Œä½†æ˜¯è¢«å¼•ç”¨çš„å¯¹è±¡æœ¬èº«æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚ 1234final int x = 1;// x = 2; // cannot assign value to final variable 'x'final A y = new A();y.a = 1; 2. æ–¹æ³• å£°æ˜Žæ–¹æ³•ä¸èƒ½è¢«å­ç±»è¦†ç›–ã€‚ private æ–¹æ³•éšå¼åœ°è¢«æŒ‡å®šä¸º finalï¼Œå¦‚æžœåœ¨å­ç±»ä¸­å®šä¹‰çš„æ–¹æ³•å’ŒåŸºç±»ä¸­çš„ä¸€ä¸ª private æ–¹æ³•ç­¾åç›¸åŒï¼Œæ­¤æ—¶å­ç±»çš„æ–¹æ³•ä¸æ˜¯è¦†ç›–åŸºç±»æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨å­ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ã€‚ 3. ç±» å£°æ˜Žç±»ä¸å…è®¸è¢«ç»§æ‰¿ã€‚ static 1. é™æ€å˜é‡ é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ï¼Œåªåœ¨ç±»åˆå§‹åŒ–æ—¶èµ‹å€¼ä¸€æ¬¡ã€‚ é™æ€å˜é‡ï¼šç±»æ‰€æœ‰çš„å®žä¾‹éƒ½å…±äº«é™æ€å˜é‡ï¼Œå¯ä»¥ç›´æŽ¥é€šè¿‡ç±»åæ¥è®¿é—®å®ƒï¼› å®žä¾‹å˜é‡ï¼šæ¯åˆ›å»ºä¸€ä¸ªå®žä¾‹å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®žä¾‹å˜é‡ï¼Œå®ƒä¸Žè¯¥å®žä¾‹åŒç”Ÿå…±æ­»ã€‚ 1234public class A &#123; private int x; // å®žä¾‹å˜é‡ public static int y; // é™æ€å˜é‡&#125; 2. é™æ€æ–¹æ³• é™æ€æ–¹æ³•åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å­˜åœ¨äº†ï¼Œå®ƒä¸ä¾èµ–äºŽä»»ä½•å®žä¾‹ï¼Œæ‰€ä»¥é™æ€æ–¹æ³•å¿…é¡»æœ‰å®žçŽ°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•ï¼ˆabstractï¼‰ã€‚ 3. é™æ€è¯­å¥å— é™æ€è¯­å¥å—åœ¨ç±»åˆå§‹åŒ–æ—¶è¿è¡Œä¸€æ¬¡ã€‚ 4. é™æ€å†…éƒ¨ç±» å†…éƒ¨ç±»çš„ä¸€ç§ï¼Œé™æ€å†…éƒ¨ç±»ä¸ä¾èµ–å¤–éƒ¨ç±»ï¼Œä¸”ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éžé™æ€çš„å˜é‡å’Œæ–¹æ³•ã€‚ 5. é™æ€å¯¼åŒ… 1import static com.xxx.ClassName.* åœ¨ä½¿ç”¨é™æ€å˜é‡å’Œæ–¹æ³•æ—¶ä¸ç”¨å†æŒ‡æ˜Ž ClassNameï¼Œä»Žè€Œç®€åŒ–ä»£ç ï¼Œä½†å¯è¯»æ€§å¤§å¤§é™ä½Žã€‚ 6. å˜é‡èµ‹å€¼é¡ºåº é™æ€å˜é‡çš„èµ‹å€¼å’Œé™æ€è¯­å¥å—çš„è¿è¡Œä¼˜å…ˆäºŽå®žä¾‹å˜é‡çš„èµ‹å€¼å’Œæ™®é€šè¯­å¥å—çš„è¿è¡Œï¼Œé™æ€å˜é‡çš„èµ‹å€¼å’Œé™æ€è¯­å¥å—çš„è¿è¡Œå“ªä¸ªå…ˆæ‰§è¡Œå–å†³äºŽå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚ å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰ å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰ çˆ¶ç±»ï¼ˆå®žä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰ çˆ¶ç±»ï¼ˆæž„é€ å‡½æ•°ï¼‰ å­ç±»ï¼ˆå®žä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰ å­ç±»ï¼ˆæž„é€ å‡½æ•°ï¼‰ äºŒã€Object é€šç”¨æ–¹æ³• æ¦‚è§ˆ 1234567891011public final native Class&lt;?&gt; getClass()public native int hashCode()public boolean equals(Object obj)protected native Object clone() throws CloneNotSupportedExceptionpublic String toString()public final native void notify()public final native void notifyAll()public final native void wait(long timeout) throws InterruptedExceptionpublic final void wait(long timeout, int nanos) throws InterruptedExceptionpublic final void wait() throws InterruptedExceptionprotected void finalize() throws Throwable &#123;&#125; equals() 1. equals() ä¸Ž == çš„åŒºåˆ« å¯¹äºŽåŸºæœ¬ç±»åž‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼ŒåŸºæœ¬ç±»åž‹æ²¡æœ‰ equals() æ–¹æ³•ã€‚ å¯¹äºŽå¼•ç”¨ç±»åž‹ï¼Œ== åˆ¤æ–­ä¸¤ä¸ªå®žä¾‹æ˜¯å¦å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ equals() åˆ¤æ–­å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦ç­‰ä»·ã€‚ 1234Integer x = new Integer(1);Integer y = new Integer(1);System.out.println(x.equals(y)); // trueSystem.out.println(x == y); // false é»˜è®¤æƒ…å†µä¸‹ä¹Ÿå°±æ˜¯ä»Žè¶…ç±»Objectç»§æ‰¿è€Œæ¥çš„equalsæ–¹æ³•ä¸Ž==æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œæ¯”è¾ƒçš„éƒ½æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œä½†æˆ‘ä»¬å¯ä»¥é‡å†™equalsæ–¹æ³•ï¼Œä½¿å…¶æŒ‰ç…§æˆ‘ä»¬çš„éœ€æ±‚çš„æ–¹å¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚Stringç±»é‡å†™äº†equalsæ–¹æ³•ï¼Œä½¿å…¶æ¯”è¾ƒçš„æ˜¯å­—ç¬¦çš„åºåˆ—ï¼Œè€Œä¸å†æ˜¯å†…å­˜åœ°å€ã€‚ 2. ç­‰ä»·å…³ç³» ï¼ˆä¸€ï¼‰è‡ªåæ€§ 1x.equals(x); // true ï¼ˆäºŒï¼‰å¯¹ç§°æ€§ 1x.equals(y) == y.equals(x); // true ï¼ˆä¸‰ï¼‰ä¼ é€’æ€§ 12if (x.equals(y) &amp;&amp; y.equals(z)) x.equals(z); // true; ï¼ˆå››ï¼‰ä¸€è‡´æ€§ å¤šæ¬¡è°ƒç”¨ equals() æ–¹æ³•ç»“æžœä¸å˜ 1x.equals(y) == x.equals(y); // true ï¼ˆäº”ï¼‰ä¸Ž null çš„æ¯”è¾ƒ å¯¹ä»»ä½•ä¸æ˜¯ null çš„å¯¹è±¡ x è°ƒç”¨ x.equals(null) ç»“æžœéƒ½ä¸º false 1x.euqals(null); // false; 3. å®žçŽ° æ£€æŸ¥æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æžœæ˜¯ç›´æŽ¥è¿”å›ž trueï¼› æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»åž‹ï¼Œå¦‚æžœä¸æ˜¯ï¼Œç›´æŽ¥è¿”å›ž falseï¼› å°† Object å®žä¾‹è¿›è¡Œè½¬åž‹ï¼› åˆ¤æ–­æ¯ä¸ªå…³é”®åŸŸæ˜¯å¦ç›¸ç­‰ã€‚ 1234567891011121314151617181920212223public class EqualExample &#123; private int x; private int y; private int z; public EqualExample(int x, int y, int z) &#123; this.x = x; this.y = y; this.z = z; &#125; @Override public boolean equals(Object o) &#123; if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; EqualExample that = (EqualExample) o; if (x != that.x) return false; if (y != that.y) return false; return z == that.z; &#125;&#125; hashCode() hasCode() è¿”å›žæ•£åˆ—å€¼ï¼Œè€Œ equals() æ˜¯ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå®žä¾‹æ˜¯å¦ç­‰ä»·ã€‚ç­‰ä»·çš„ä¸¤ä¸ªå®žä¾‹æ•£åˆ—å€¼ä¸€å®šè¦ç›¸åŒï¼Œä½†æ˜¯æ•£åˆ—å€¼ç›¸åŒçš„ä¸¤ä¸ªå®žä¾‹ä¸ä¸€å®šç­‰ä»·ã€‚ åœ¨è¦†ç›– equals() æ–¹æ³•æ—¶åº”å½“æ€»æ˜¯è¦†ç›– hashCode() æ–¹æ³•ï¼Œä¿è¯ç­‰ä»·çš„ä¸¤ä¸ªå®žä¾‹æ•£åˆ—å€¼ä¹Ÿç›¸ç­‰ã€‚ ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæ–°å»ºäº†ä¸¤ä¸ªç­‰ä»·çš„å®žä¾‹ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° HashSet ä¸­ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™ä¸¤ä¸ªå®žä¾‹å½“æˆä¸€æ ·çš„ï¼Œåªåœ¨é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå®žä¾‹ï¼Œä½†æ˜¯å› ä¸º EqualExample æ²¡æœ‰å®žçŽ° hasCode() æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå®žä¾‹çš„æ•£åˆ—å€¼æ˜¯ä¸åŒçš„ï¼Œæœ€ç»ˆå¯¼è‡´é›†åˆæ·»åŠ äº†ä¸¤ä¸ªç­‰ä»·çš„å®žä¾‹ã€‚ 1234567EqualExample e1 = new EqualExample(1, 1, 1);EqualExample e2 = new EqualExample(1, 1, 1);System.out.println(e1.equals(e2)); // trueHashSet&lt;EqualExample&gt; set = new HashSet&lt;&gt;();set.add(e1);set.add(e2);System.out.println(set.size()); // 2 ç†æƒ³çš„æ•£åˆ—å‡½æ•°åº”å½“å…·æœ‰å‡åŒ€æ€§ï¼Œå³ä¸ç›¸ç­‰çš„å®žä¾‹åº”å½“å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰å¯èƒ½çš„æ•£åˆ—å€¼ä¸Šã€‚è¿™å°±è¦æ±‚äº†æ•£åˆ—å‡½æ•°è¦æŠŠæ‰€æœ‰åŸŸçš„å€¼éƒ½è€ƒè™‘è¿›æ¥ï¼Œå¯ä»¥å°†æ¯ä¸ªåŸŸéƒ½å½“æˆ R è¿›åˆ¶çš„æŸä¸€ä½ï¼Œç„¶åŽç»„æˆä¸€ä¸ª R è¿›åˆ¶çš„æ•´æ•°ã€‚R ä¸€èˆ¬å– 31ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¥‡ç´ æ•°ï¼Œå¦‚æžœæ˜¯å¶æ•°çš„è¯ï¼Œå½“å‡ºçŽ°ä¹˜æ³•æº¢å‡ºï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¸Ž 2 ç›¸ä¹˜ç›¸å½“äºŽå‘å·¦ç§»ä¸€ä½ã€‚ ä¹‹æ‰€ä»¥é€‰æ‹©31ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ä¸ªå¥‡ç´ æ•°ï¼Œå¦‚æžœä¹˜æ•°æ˜¯å¶æ•°ï¼Œå¹¶ä¸”ä¹˜æ³•æº¢å‡ºçš„è¯ï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¸Ž2ç›¸ä¹˜ç­‰ä»·äºŽç§»ä½è¿ç®—ã€‚ä½¿ç”¨ç´ æ•°çš„å¥½å¤„å¹¶ä¸æ˜¯å¾ˆæ˜Žæ˜¾ï¼Œä½†æ˜¯ä¹ æƒ¯ä¸Šéƒ½ä½¿ç”¨ç´ æ•°æ¥è®¡ç®—æ•£åˆ—ç»“æžœã€‚31æœ‰ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå°±æ˜¯ç”¨ç§»ä½å’Œå‡æ³•æ¥ä»£æ›¿ä¹˜æ³•ï¼Œå¯ä»¥å¾—åˆ°æ›´å¥½çš„æ€§èƒ½ï¼š31*i==(i&lt;&lt;5)-iã€‚çŽ°åœ¨çš„VMå¯ä»¥è‡ªåŠ¨å®Œæˆè¿™ç§ä¼˜åŒ–ã€‚ 12345678@Overridepublic int hashCode() &#123; int result = 17; result = 31 * result + x; result = 31 * result + y; result = 31 * result + z; return result;&#125; clone() 1. cloneable clone() æ˜¯ Object çš„å—ä¿æŠ¤æ–¹æ³•ï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æžœä¸€ä¸ªç±»ä¸æ˜¾å¼åŽ»è¦†ç›– clone() å°±æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ã€‚ 1234public class CloneExample &#123; private int a; private int b;&#125; 12CloneExample e1 = new CloneExample();// CloneExample e2 = e1.clone(); // 'clone()' has protected access in 'java.lang.Object' æŽ¥ä¸‹æ¥è¦†ç›– Object çš„ clone() å¾—åˆ°ä»¥ä¸‹å®žçŽ°ï¼š 123456789public class CloneExample &#123; private int a; private int b; @Override protected CloneExample clone() throws CloneNotSupportedException &#123; return (CloneExample)super.clone(); &#125;&#125; 123456CloneExample e1 = new CloneExample();try &#123; CloneExample e2 = e1.clone();&#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace();&#125; 1java.lang.CloneNotSupportedException: CloneTest ä»¥ä¸ŠæŠ›å‡ºäº† CloneNotSupportedExceptionï¼Œè¿™æ˜¯å› ä¸º CloneTest æ²¡æœ‰å®žçŽ° Cloneable æŽ¥å£ã€‚ 123456789public class CloneExample implements Cloneable &#123; private int a; private int b; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125; åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œclone() æ–¹æ³•å¹¶ä¸æ˜¯ Cloneable æŽ¥å£çš„æ–¹æ³•ï¼Œè€Œæ˜¯ Object çš„ä¸€ä¸ª protected æ–¹æ³•ã€‚Cloneable æŽ¥å£åªæ˜¯è§„å®šï¼Œå¦‚æžœä¸€ä¸ªç±»æ²¡æœ‰å®žçŽ° Cloneable æŽ¥å£åˆè°ƒç”¨äº† clone() æ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚ 2. æ·±æ‹·è´ä¸Žæµ…æ‹·è´ æµ…æ‹·è´ï¼šæ‹·è´å®žä¾‹å’ŒåŽŸå§‹å®žä¾‹çš„å¼•ç”¨ç±»åž‹å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼› æ·±æ‹·è´ï¼šæ‹·è´å®žä¾‹å’ŒåŽŸå§‹å®žä¾‹çš„å¼•ç”¨ç±»åž‹å¼•ç”¨ä¸åŒå¯¹è±¡ã€‚ 1234567891011121314151617181920212223public class ShallowCloneExample implements Cloneable &#123; private int[] arr; public ShallowCloneExample() &#123; arr = new int[10]; for (int i = 0; i &lt; arr.length; i++) &#123; arr[i] = i; &#125; &#125; public void set(int index, int value) &#123; arr[index] = value; &#125; public int get(int index) &#123; return arr[index]; &#125; @Override protected ShallowCloneExample clone() throws CloneNotSupportedException &#123; return (ShallowCloneExample) super.clone(); &#125;&#125; 123456789ShallowCloneExample e1 = new ShallowCloneExample();ShallowCloneExample e2 = null;try &#123; e2 = e1.clone();&#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace();&#125;e1.set(2, 222);System.out.println(e2.get(2)); // 222 12345678910111213141516171819202122232425262728public class DeepCloneExample implements Cloneable &#123; private int[] arr; public DeepCloneExample() &#123; arr = new int[10]; for (int i = 0; i &lt; arr.length; i++) &#123; arr[i] = i; &#125; &#125; public void set(int index, int value) &#123; arr[index] = value; &#125; public int get(int index) &#123; return arr[index]; &#125; @Override protected DeepCloneExample clone() throws CloneNotSupportedException &#123; DeepCloneExample result = (DeepCloneExample) super.clone(); result.arr = new int[arr.length]; for (int i = 0; i &lt; arr.length; i++) &#123; result.arr[i] = arr[i]; &#125; return result; &#125;&#125; 123456789DeepCloneExample e1 = new DeepCloneExample();DeepCloneExample e2 = null;try &#123; e2 = e1.clone();&#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace();&#125;e1.set(2, 222);System.out.println(e2.get(2)); // 2 ä½¿ç”¨ clone() æ–¹æ³•æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡å³å¤æ‚åˆæœ‰é£Žé™©ï¼Œå®ƒä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”è¿˜éœ€è¦ç±»åž‹è½¬æ¢ã€‚Effective Java ä¹¦ä¸Šè®²åˆ°ï¼Œæœ€å¥½ä¸è¦åŽ»ä½¿ç”¨ clone()ï¼Œå¯ä»¥ä½¿ç”¨æ‹·è´æž„é€ å‡½æ•°æˆ–è€…æ‹·è´å·¥åŽ‚æ¥æ‹·è´ä¸€ä¸ªå¯¹è±¡ã€‚ 12345678910111213141516171819202122232425public class CloneConstructorExample &#123; private int[] arr; public CloneConstructorExample() &#123; arr = new int[10]; for (int i = 0; i &lt; arr.length; i++) &#123; arr[i] = i; &#125; &#125; public CloneConstructorExample(CloneConstructorExample original) &#123; arr = new int[original.arr.length]; for (int i = 0; i &lt; original.arr.length; i++) &#123; arr[i] = original.arr[i]; &#125; &#125; public void set(int index, int value) &#123; arr[index] = value; &#125; public int get(int index) &#123; return arr[index]; &#125;&#125; 1234CloneConstructorExample e1 = new CloneConstructorExample();CloneConstructorExample e2 = new CloneConstructorExample(e1);e1.set(2, 222);System.out.println(e2.get(2)); // 2 å››ã€ç»§æ‰¿ è®¿é—®æƒé™ Java ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€defaultã€protected ä»¥åŠpublicï¼Œå¦‚æžœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºåŒ…çº§å¯è§ã€‚ å¯ä»¥å¯¹ç±»æˆ–ç±»ä¸­çš„æˆå‘˜ï¼ˆå­—æ®µä»¥åŠæ–¹æ³•ï¼‰åŠ ä¸Šè®¿é—®ä¿®é¥°ç¬¦ã€‚ æˆå‘˜å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»çš„å®žä¾‹è®¿é—®åˆ°è¯¥æˆå‘˜ï¼› ç±»å¯è§è¡¨ç¤ºå…¶å®ƒç±»å¯ä»¥ç”¨è¿™ä¸ªç±»åˆ›å»ºå¯¹è±¡ã€‚ protected ç”¨äºŽä¿®é¥°æˆå‘˜ï¼Œè¡¨ç¤ºåœ¨ç»§æ‰¿ä½“ç³»ä¸­æˆå‘˜å¯¹äºŽå­ç±»å¯è§ï¼Œä½†æ˜¯è¿™ä¸ªè®¿é—®ä¿®é¥°ç¬¦å¯¹äºŽç±»æ²¡æœ‰æ„ä¹‰ã€‚ å¦‚æžœå­ç±»çš„æ–¹æ³•è¦†ç›–äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¸­è¯¥æ–¹æ³•çš„è®¿é—®çº§åˆ«ä¸å…è®¸ä½ŽäºŽçˆ¶ç±»çš„è®¿é—®çº§åˆ«ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å¯ä»¥ä½¿ç”¨çˆ¶ç±»å®žä¾‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å®žä¾‹ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ»¡è¶³é‡Œæ°æ›¿æ¢åŽŸåˆ™ã€‚ å­—æ®µå†³ä¸èƒ½æ˜¯å…¬æœ‰çš„ï¼Œå› ä¸ºè¿™ä¹ˆåšçš„è¯å°±å¤±åŽ»äº†å¯¹è¿™ä¸ªå­—æ®µä¿®æ”¹è¡Œä¸ºçš„æŽ§åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹å…¶éšæ„ä¿®æ”¹ã€‚å¯ä»¥ä½¿ç”¨å…¬æœ‰çš„ getter å’Œ setter æ–¹æ³•æ¥æ›¿æ¢å…¬æœ‰å­—æ®µã€‚ æŠ½è±¡ç±»ä¸ŽæŽ¥å£ 1. æŠ½è±¡ç±» æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•éƒ½ä½¿ç”¨ abstract è¿›è¡Œå£°æ˜Žã€‚æŠ½è±¡ç±»ä¸€èˆ¬ä¼šåŒ…å«æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•ä¸€å®šä½äºŽæŠ½è±¡ç±»ä¸­ã€‚ æŠ½è±¡ç±»å’Œæ™®é€šç±»æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®žä¾‹åŒ–ï¼Œéœ€è¦ç»§æ‰¿æŠ½è±¡ç±»æ‰èƒ½å®žä¾‹åŒ–å…¶å­ç±»ã€‚ 1234567891011public abstract class AbstractClassExample &#123; protected int x; private int y; public abstract void func1(); public void func2() &#123; System.out.println("func2"); &#125;&#125; 123456public class AbstractExtendClassExample extends AbstractClassExample&#123; @Override public void func1() &#123; System.out.println("func1"); &#125;&#125; 123// AbstractClassExample ac1 = new AbstractClassExample(); // 'AbstractClassExample' is abstract; cannot be instantiatedAbstractClassExample ac2 = new AbstractExtendClassExample();ac2.func1(); 2. æŽ¥å£ æŽ¥å£æ˜¯æŠ½è±¡ç±»çš„å»¶ä¼¸ï¼Œåœ¨ Java 8 ä¹‹å‰ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®Œå…¨æŠ½è±¡çš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸èƒ½æœ‰ä»»ä½•çš„æ–¹æ³•å®žçŽ°ã€‚ ä»Ž Java 8 å¼€å§‹ï¼ŒæŽ¥å£ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤çš„æ–¹æ³•å®žçŽ°ï¼Œè¿™æ˜¯å› ä¸ºä¸æ”¯æŒé»˜è®¤æ–¹æ³•çš„æŽ¥å£çš„ç»´æŠ¤æˆæœ¬å¤ªé«˜äº†ã€‚åœ¨ Java 8 ä¹‹å‰ï¼Œå¦‚æžœä¸€ä¸ªæŽ¥å£æƒ³è¦æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¦ä¿®æ”¹æ‰€æœ‰å®žçŽ°äº†è¯¥æŽ¥å£çš„ç±»ã€‚ æŽ¥å£çš„æˆå‘˜ï¼ˆå­—æ®µ + æ–¹æ³•ï¼‰é»˜è®¤éƒ½æ˜¯ public çš„ï¼Œå¹¶ä¸”ä¸å…è®¸å®šä¹‰ä¸º private æˆ–è€…protectedã€‚ æŽ¥å£çš„å­—æ®µé»˜è®¤éƒ½æ˜¯ static å’Œ final çš„ã€‚ 1234567891011121314public interface InterfaceExample &#123; void func1(); default void func2()&#123; System.out.println("func2"); &#125; int x = 123; // int y; // Variable 'y' might not have been initialized public int z = 0; // Modifier 'public' is redundant for interface fields // private int k = 0; // Modifier 'private' not allowed here // protected int l = 0; // Modifier 'protected' not allowed here // private void fun3(); // Modifier 'private' not allowed here&#125; 123456public class InterfaceImplementExample implements InterfaceExample &#123; @Override public void func1() &#123; System.out.println("func1"); &#125;&#125; 1234// InterfaceExample ie1 = new InterfaceExample(); // 'InterfaceExample' is abstract; cannot be instantiatedInterfaceExample ie2 = new InterfaceImplementExample();ie2.func1();System.out.println(InterfaceExample.x); 3. æ¯”è¾ƒ ä»Žè®¾è®¡å±‚é¢ä¸Šçœ‹ï¼ŒæŠ½è±¡ç±»æä¾›äº†ä¸€ç§ IS-A å…³ç³»ï¼Œé‚£ä¹ˆå°±å¿…é¡»æ»¡è¶³é‡Œå¼æ›¿æ¢åŽŸåˆ™ï¼Œå³å­ç±»å¯¹è±¡å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æŽ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚è€ŒæŽ¥å£æ›´åƒæ˜¯ä¸€ç§ LIKE-A å…³ç³»ï¼Œå®ƒåªæ˜¯æä¾›ä¸€ç§æ–¹æ³•å®žçŽ°å¥‘çº¦ï¼Œå¹¶ä¸è¦æ±‚æŽ¥å£å’Œå®žçŽ°æŽ¥å£çš„ç±»å…·æœ‰ IS-A å…³ç³»ã€‚ ä»Žä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å®žçŽ°å¤šä¸ªæŽ¥å£ï¼Œä½†æ˜¯ä¸èƒ½ç»§æ‰¿å¤šä¸ªæŠ½è±¡ç±»ã€‚ æŽ¥å£çš„å­—æ®µåªèƒ½æ˜¯ static å’Œ final ç±»åž‹çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„å­—æ®µæ²¡æœ‰è¿™ç§é™åˆ¶ã€‚ æŽ¥å£çš„æ–¹æ³•åªèƒ½æ˜¯ public çš„ï¼Œè€ŒæŠ½è±¡ç±»çš„æ–¹æ³•å¯ä»¥ç”±å¤šç§è®¿é—®æƒé™ã€‚ 4. ä½¿ç”¨é€‰æ‹© ä½¿ç”¨æŠ½è±¡ç±»ï¼š éœ€è¦åœ¨å‡ ä¸ªç›¸å…³çš„ç±»ä¸­å…±äº«ä»£ç ã€‚ éœ€è¦èƒ½æŽ§åˆ¶ç»§æ‰¿æ¥çš„æ–¹æ³•å’ŒåŸŸçš„è®¿é—®æƒé™ï¼Œè€Œä¸æ˜¯éƒ½ä¸º publicã€‚ éœ€è¦ç»§æ‰¿éžé™æ€ï¼ˆnon-staticï¼‰å’Œéžå¸¸é‡ï¼ˆnon-finalï¼‰å­—æ®µã€‚ ä½¿ç”¨æŽ¥å£ï¼š éœ€è¦è®©ä¸ç›¸å…³çš„ç±»éƒ½å®žçŽ°ä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚ä¸ç›¸å…³çš„ç±»éƒ½å¯ä»¥å®žçŽ° Compareable æŽ¥å£ä¸­çš„ compareTo() æ–¹æ³•ï¼› éœ€è¦ä½¿ç”¨å¤šé‡ç»§æ‰¿ã€‚ åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒæŽ¥å£ä¼˜å…ˆäºŽæŠ½è±¡ç±»ï¼Œå› ä¸ºæŽ¥å£æ²¡æœ‰æŠ½è±¡ç±»ä¸¥æ ¼çš„ç±»å±‚æ¬¡ç»“æž„è¦æ±‚ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºä¸€ä¸ªç±»æ·»åŠ è¡Œä¸ºã€‚å¹¶ä¸”ä»Ž Java 8 å¼€å§‹ï¼ŒæŽ¥å£ä¹Ÿå¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•å®žçŽ°ï¼Œä½¿å¾—ä¿®æ”¹æŽ¥å£çš„æˆæœ¬ä¹Ÿå˜çš„å¾ˆä½Žã€‚ super è®¿é—®çˆ¶ç±»çš„æž„é€ å‡½æ•°ï¼šå¯ä»¥ä½¿ç”¨ super() å‡½æ•°è®¿é—®çˆ¶ç±»çš„æž„é€ å‡½æ•°ï¼Œä»Žè€Œå®Œæˆä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œã€‚ è®¿é—®çˆ¶ç±»çš„æˆå‘˜ï¼šå¦‚æžœå­ç±»è¦†ç›–äº†çˆ¶ç±»çš„ä¸­æŸä¸ªæ–¹æ³•çš„å®žçŽ°ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ super å…³é”®å­—æ¥å¼•ç”¨çˆ¶ç±»çš„æ–¹æ³•å®žçŽ°ã€‚ 12345678910111213public class SuperExample &#123; protected int x; protected int y; public SuperExample(int x, int y) &#123; this.x = x; this.y = y; &#125; public void func() &#123; System.out.println("SuperExample.func()"); &#125;&#125; 1234567891011121314public class SuperExtendExample extends SuperExample &#123; private int z; public SuperExtendExample(int x, int y, int z) &#123; super(x, y); this.z = z; &#125; @Override public void func() &#123; super.func(); System.out.println("SuperExtendExample.func()"); &#125;&#125; 12SuperExample e = new SuperExtendExample(1, 2, 3);e.func(); 12SuperExample.func()SuperExtendExample.func() è¦†ç›–ä¸Žé‡è½½ è¦†ç›–ï¼ˆOverrideï¼‰å­˜åœ¨äºŽç»§æ‰¿ä½“ç³»ä¸­ï¼ŒæŒ‡å­ç±»å®žçŽ°äº†ä¸€ä¸ªä¸Žçˆ¶ç±»åœ¨æ–¹æ³•å£°æ˜Žä¸Šå®Œå…¨ç›¸åŒçš„ä¸€ä¸ªæ–¹æ³•ï¼› é‡è½½ï¼ˆOverloadï¼‰å­˜åœ¨äºŽåŒä¸€ä¸ªç±»ä¸­ï¼ŒæŒ‡ä¸€ä¸ªæ–¹æ³•ä¸Žå·²ç»å­˜åœ¨çš„æ–¹æ³•åç§°ä¸Šç›¸åŒï¼Œä½†æ˜¯å‚æ•°ç±»åž‹ã€ä¸ªæ•°ã€é¡ºåºè‡³å°‘æœ‰ä¸€ä¸ªä¸åŒã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œè¿”å›žå€¼ä¸åŒï¼Œå…¶å®ƒéƒ½ç›¸åŒä¸ç®—æ˜¯é‡è½½ã€‚ äº”ã€String String, StringBuffer and StringBuilder 1. æ˜¯å¦å¯å˜ String ä¸å¯å˜ StringBuffer å’Œ StringBuilder å¯å˜ 2. æ˜¯å¦çº¿ç¨‹å®‰å…¨ String ä¸å¯å˜ï¼Œå› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ StringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ synchronized æ¥åŒæ­¥ String ä¸å¯å˜çš„åŽŸå›  1. å¯ä»¥ç¼“å­˜ hash å€¼ å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œå› æ­¤åªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚ 2. String Pool çš„éœ€è¦ å¦‚æžœä¸€ä¸ª String å¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¼šä»Ž String Pool ä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ String æ˜¯ä¸å¯å˜çš„ï¼Œæ‰å¯èƒ½ä½¿ç”¨ String Poolã€‚ 3. å®‰å…¨æ€§ String ç»å¸¸ä½œä¸ºå‚æ•°ï¼ŒString ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å‚æ•°ä¸å¯å˜ã€‚ä¾‹å¦‚åœ¨ä½œä¸ºç½‘ç»œè¿žæŽ¥å‚æ•°çš„æƒ…å†µä¸‹å¦‚æžœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œè¿žæŽ¥è¿‡ç¨‹ä¸­ï¼ŒString è¢«æ”¹å˜ï¼Œæ”¹å˜ String å¯¹è±¡çš„é‚£ä¸€æ–¹ä»¥ä¸ºçŽ°åœ¨è¿žæŽ¥çš„æ˜¯å…¶å®ƒä¸»æœºï¼Œè€Œå®žé™…æƒ…å†µå´ä¸ä¸€å®šæ˜¯ã€‚ 4. çº¿ç¨‹å®‰å…¨ String ä¸å¯å˜æ€§å¤©ç”Ÿå…·å¤‡çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚ String.intern() ä½¿ç”¨ String.intern() å¯ä»¥ä¿è¯ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å®žä¾‹å¼•ç”¨ç›¸åŒçš„å†…å­˜å¯¹è±¡ã€‚ ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œs1 å’Œ s2 é‡‡ç”¨ new String() çš„æ–¹å¼æ–°å»ºäº†ä¸¤ä¸ªä¸åŒå¯¹è±¡ï¼Œè€Œ s3 æ˜¯é€šè¿‡ s1.intern() æ–¹æ³•å–å¾—ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•é¦–å…ˆæŠŠ s1 å¼•ç”¨çš„å¯¹è±¡æ”¾åˆ° String Pollï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ï¼‰ä¸­ï¼Œç„¶åŽè¿”å›žè¿™ä¸ªå¯¹è±¡å¼•ç”¨ã€‚å› æ­¤ s3 å’Œ s1 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± çš„å¯¹è±¡ã€‚ 12345String s1 = new String("aaa");String s2 = new String("aaa");System.out.println(s1 == s2); // falseString s3 = s1.intern();System.out.println(s1.intern() == s3); // true å¦‚æžœæ˜¯é‡‡ç”¨ â€œbbbâ€ è¿™ç§ä½¿ç”¨åŒå¼•å·çš„å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²å®žä¾‹ï¼Œä¼šè‡ªåŠ¨åœ°å°†æ–°å»ºçš„å¯¹è±¡æ”¾å…¥ String Pool ä¸­ã€‚ 123String s4 = "bbb";String s5 = "bbb";System.out.println(s4 == s5); // true åœ¨ Java 7 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± è¢«æ”¾åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œå®ƒå±žäºŽæ°¸ä¹…ä»£ã€‚è€Œåœ¨ Java 7ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± è¢«æ”¾åœ¨å †ä¸­ã€‚è¿™æ˜¯å› ä¸ºæ°¸ä¹…ä»£çš„ç©ºé—´æœ‰é™ï¼Œåœ¨å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²çš„åœºæ™¯ä¸‹ä¼šå¯¼è‡´ OutOfMemoryError é”™è¯¯ã€‚ å…­ã€åŸºæœ¬ç±»åž‹ä¸Žè¿ç®— åŒ…è£…ç±»åž‹ å…«ä¸ªåŸºæœ¬ç±»åž‹ï¼š boolean/1 byte/8 char/16 short/16 int/32 float/32 long/64 double/64 åŸºæœ¬ç±»åž‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»åž‹ï¼ŒåŸºæœ¬ç±»åž‹ä¸Žå…¶å¯¹åº”çš„åŒ…è£…ç±»åž‹ä¹‹é—´çš„èµ‹å€¼ä½¿ç”¨è‡ªåŠ¨è£…ç®±ä¸Žæ‹†ç®±å®Œæˆã€‚ 12Integer x = 2; // è£…ç®±int y = x; // æ‹†ç®± new Integer(123) ä¸Ž Integer.valueOf(123) çš„åŒºåˆ«åœ¨äºŽï¼Œnew Integer(123) æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ Integer.valueOf(123) å¯èƒ½ä¼šä½¿ç”¨ç¼“å­˜å¯¹è±¡ï¼Œå› æ­¤å¤šæ¬¡ä½¿ç”¨ Integer.valueOf(123) ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚ 123456Integer x = new Integer(123);Integer y = new Integer(123);System.out.println(x == y); // falseInteger z = Integer.valueOf(123);Integer k = Integer.valueOf(123);System.out.println(z == k); // true ç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ valueOf() æ–¹æ³•ï¼Œå› æ­¤å¤šä¸ª Integer å®žä¾‹ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºå¹¶ä¸”å€¼ç›¸åŒï¼Œé‚£ä¹ˆå°±ä¼šå¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚ 123Integer m = 123;Integer n = 123;System.out.println(m == n); // true valueOf() æ–¹æ³•çš„å®žçŽ°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æžœåœ¨çš„è¯å°±ç›´æŽ¥ä½¿ç”¨ç¼“å­˜æ± çš„å†…å®¹ã€‚ 12345public static Integer valueOf(int i) &#123; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i);&#125; åœ¨ Java 8 ä¸­ï¼ŒInteger ç¼“å­˜æ± çš„å¤§å°é»˜è®¤ä¸º -128~127ã€‚ 1234567891011121314151617181920212223242526272829static final int low = -128;static final int high;static final Integer cache[];static &#123; // high value may be configured by property int h = 127; String integerCacheHighPropValue = sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high"); if (integerCacheHighPropValue != null) &#123; try &#123; int i = parseInt(integerCacheHighPropValue); i = Math.max(i, 127); // Maximum array size is Integer.MAX_VALUE h = Math.min(i, Integer.MAX_VALUE - (-low) -1); &#125; catch( NumberFormatException nfe) &#123; // If the property cannot be parsed into an int, ignore it. &#125; &#125; high = h; cache = new Integer[(high - low) + 1]; int j = low; for(int k = 0; k &lt; cache.length; k++) cache[k] = new Integer(j++); // range [-128, 127] must be interned (JLS7 5.1.7) assert IntegerCache.high &gt;= 127;&#125; Java è¿˜å°†ä¸€äº›å…¶å®ƒåŸºæœ¬ç±»åž‹çš„å€¼æ”¾åœ¨ç¼“å†²æ± ä¸­ï¼ŒåŒ…å«ä»¥ä¸‹è¿™äº›ï¼š boolean values true and false all byte values short values between -128 and 127 int values between -128 and 127 char in the range \u0000 to \u007F å› æ­¤åœ¨ä½¿ç”¨è¿™äº›åŸºæœ¬ç±»åž‹å¯¹åº”çš„åŒ…è£…ç±»åž‹æ—¶ï¼Œå°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨ç¼“å†²æ± ä¸­çš„å¯¹è±¡ã€‚ Differences between new Integer(123), Integer.valueOf(123) and just 123 switch ä»Ž Java 7 å¼€å§‹ï¼Œå¯ä»¥åœ¨ switch æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ä½¿ç”¨ String å¯¹è±¡ã€‚ 123456789String s = "a";switch (s) &#123; case "a": System.out.println("aaa"); break; case "b": System.out.println("bbb"); break;&#125; switch ä¸æ”¯æŒ longï¼Œæ˜¯å› ä¸º swicth çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºé‚£äº›åªéœ€è¦å¯¹å°‘æ•°çš„å‡ ä¸ªå€¼è¿›è¡Œç­‰å€¼åˆ¤æ–­ï¼Œå¦‚æžœå€¼è¿‡äºŽå¤æ‚ï¼Œé‚£ä¹ˆè¿˜æ˜¯ç”¨ if æ¯”è¾ƒåˆé€‚ã€‚]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Conditionè¯¦è§£]]></title>
    <url>%2F2019%2F02%2F15%2Fthread%2FCondition%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[åœ¨çº¿ç¨‹é—´é€šä¿¡æ–¹å¼æ€»ç»“ä¸­æœ‰ä¸€ä¸ªéœ€æ±‚ï¼šè½®æµæ‰“å°å¥‡æ•°å’Œå¶æ•°ï¼Œæˆ‘ä»¬ç”¨waitå’Œnotifyå®žçŽ°äº†ä¸€ä¸‹ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å­˜åœ¨å¼Šç«¯ï¼Œå°±æ˜¯ä¸èƒ½ç²¾ç¡®æŽ§åˆ¶å”¤é†’å“ªä¸ªçº¿ç¨‹ï¼Œæ¯”å¦‚çŽ°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯è½®æµæ‰“å°ABCè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ é¦–å…ˆå‡†å¤‡ä¸‰ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«æ‰§è¡Œæ‰“å°æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªæ­»å¾ªçŽ¯ï¼Œæ¯æ¬¡ä¼‘æ¯ä¸€ç§’ã€‚ ä¸€ã€wait/notifyå®žçŽ°è½®æµæ‰“å°ABCä¸‰ä¸ªå­—æ¯ å¦‚æžœæ˜¯ä¸åŠ ä»»ä½•æŽ§åˆ¶ç­–ç•¥çš„è¯ï¼Œå¿…ç„¶æ˜¯æ— æ³•ä¿è¯æŒ‰ç…§A B Cçš„é¡ºåºä¾æ¬¡å¾ªçŽ¯æ‰§è¡Œçš„ï¼Œæ¯”å¦‚ï¼š æ‰§è¡Œç»“æžœæ˜¯ï¼š 1694620367 1234567ABCBAC... é‚£ä¹ˆå¦‚ä½•ä¿è¯æŒ‰ç…§æˆ‘ä»¬è¿™ä¸ªé¡ºåºæ‰§è¡Œå‘¢ï¼Ÿå¦‚æžœè¿˜æ˜¯æ²¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåªèƒ½è¿™æ ·å†™ï¼š æ€æƒ³ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯æžä¸€ä¸ªå˜é‡ï¼Œè§„å®šåªæœ‰0çš„æ—¶å€™æ‰æ‰“å°Aï¼Œåªæœ‰1çš„æ—¶å€™æ‰æ‰“å°Bï¼Œåªæœ‰2çš„æ—¶å€™æ‰æ‰“å°Cã€‚é‚£ä¹ˆï¼Œå¯¹äºŽæ‰“å°Açš„çº¿ç¨‹ï¼Œåªè¦ä¸æ˜¯0å°±wait()ç­‰å¾…ï¼Œä¸€æ—¦ç­‰äºŽ0å°±æ‰“å°ï¼Œå¹¶ä¸”åŠ ä¸€ï¼›å¯¹äºŽæ‰“å°Bçš„çº¿ç¨‹ï¼Œåªè¦ä¸æ˜¯1å°±wait()ç­‰å¾…ï¼Œä¸€æ—¦ç­‰äºŽ1å°±æ‰“å°ï¼Œå¹¶ä¸”åŠ ä¸€ã€‚å‰©ä¸‹åŒç†ã€‚ è¿™æ ·ï¼Œç”±äºŽsignalæ˜¯ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œåˆå§‹å€¼ä¸º0.é‚£ä¹ˆä¸‰ä¸ªçº¿ç¨‹ä¸­PrintBå’ŒPrintCéƒ½ç­‰å¾…ï¼Œåªæœ‰PrintAèƒ½æ‰§è¡Œæ‰“å°ï¼Œç„¶åŽåŠ ä¸º1ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹æ¥åˆ¤æ–­ï¼Œæ­¤æ—¶æ‰“å°Açš„çº¿ç¨‹å’Œæ‰“å°Cçš„çº¿ç¨‹å‘çŽ°éƒ½ä¸ç¬¦åˆä»–ä»¬æ‰“å°çš„æ¡ä»¶ï¼Œéƒ½è¿›å…¥äº†whileä¸­ç­‰å¾…äº†ï¼Œåªæœ‰æ‰“å°Bçš„çº¿ç¨‹å‘çŽ°ç­‰äºŽ1ï¼Œåˆ™ä¸è¿›å…¥whileå¾ªçŽ¯ï¼Œæ‰“å°å†åŠ ä¸€ã€‚ä¾æ¬¡åå¤ï¼Œå¯ä»¥å¾—åˆ°é¡ºåºæ‰“å°çš„Aã€Bã€Cã€‚ è¿™ç§æ–¹å¼æ˜¾ç„¶å¾ˆä¸å¥½ï¼Œæ˜¯é notifyAllæ¥å”¤é†’æ‰€æœ‰çº¿ç¨‹æ¥å®žçŽ°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½å”¤é†’æŒ‡å®šçš„çº¿ç¨‹å‘¢ï¼Ÿè¿™æ ·å¤„ç†èµ·æ¥æ›´åŠ ä¼˜é›…æ•ˆçŽ‡ä¹Ÿä¼šæ›´é«˜ï¼ äºŒã€Conditionæ¥å®žçŽ° è¾¾åˆ°äº†ä¸Šé¢ä¸€æ ·çš„æ•ˆæžœã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å‘çŽ°å®ƒçš„å¼ºå¤§ä¹‹å¤„åœ¨äºŽæˆ‘ä»¬å¯ä»¥æŒ‡å®šå“ªä¸ªçº¿ç¨‹å”¤é†’äº†ï¼Œè¿™çœ‹èµ·æ¥æ˜¯ä¸€ç‚¹ç‚¹è¿›æ­¥ï¼Œä½†æ˜¯æˆ‘ä»¬å­¦ä¹ å¤šçº¿ç¨‹é‚£ä¹ˆé•¿æ—¶é—´äº†ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œæ˜¯å¾ˆå¤§çš„ä¸€ä¸ªè¿›æ­¥ï¼Œå› ä¸ºä¹‹å‰ç”¨notifyæ˜¯éšæœºå”¤é†’ä¸€ä¸ªï¼ŒnotifyAllæ˜¯å”¤é†’å…¨éƒ¨ï¼Œæ€»æ˜¯ä¸èƒ½å—æˆ‘ä»¬çš„å®Œå…¨æŽ§åˆ¶ï¼Œè™½ç„¶è¯´çº¿ç¨‹çš„æ‰§è¡Œæœ¬èº«å°±æ˜¯ä¸ç¡®å®šçš„ï¼Œå› æ­¤ä¸ç¡®å®šæ€§æ˜¯ä»–ä»¬çš„å¤©ç”Ÿå±žæ€§ï¼Œä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬ç¡®å®žéœ€è¦ä¸€ä¸ªé«˜æ•ˆå¹¶ä¸”ä¼˜é›…çš„å®žçŽ°å¯æŽ§çš„æ–¹å¼ï¼Œæ‰€ä»¥æ˜¯å¾ˆé‡è¦çš„ã€‚ å®ƒè¿™ç§åŠŸèƒ½å¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢ç”¨å®ƒå®žçŽ°ä¸€ä¸ªæœ‰ç•Œé˜Ÿåˆ—ã€‚ï¼ˆå…³äºŽç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨äº†ï¼Œå†™æ³•éžå¸¸ç®€å•ï¼Œå°±æ˜¯å¯¹ç…§ä¸Šé¢çš„ä¾‹å­æ”¹ä¸€ä¸‹å³å¯ã€‚ï¼‰ ä¸‰ã€Conditionå®žçŽ°æœ‰ç•Œé˜Ÿåˆ— æˆ‘ä»¬å·²ç»æŽ¥è§¦äº†çº¿ç¨‹æ± ï¼Œå®ƒé‡Œé¢æ¶‰åŠé˜Ÿåˆ—ï¼Œæœ‰å¾ˆå¤šç§é˜Ÿåˆ—ï¼Œæœ€å¸¸è§çš„æ˜¯ArrayBlockingQueueä»¥åŠLinkedBlockingQueueï¼Œä»–ä»¬çš„æºç ä¸­å…¶å®žä¹Ÿæ˜¯é Conditionæ¥å®žçŽ°é˜»å¡žå¡žå€¼å’Œé˜»å¡žå–å€¼çš„ã€‚çŽ°åœ¨æˆ‘ä»¬ä¹Ÿæ¥å®žçŽ°ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ArrayBlockingQueueå§ï¼ é¦–å…ˆæ˜Žç¡®ä¸€ä¸‹é˜Ÿåˆ—æ˜¯FIFOçš„ï¼Œå³å…ˆè¿›å…ˆå‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦ä¿è¯å…ˆæ’å…¥çš„è¦å…ˆå¼¹å‡ºã€‚å…¶æ¬¡è¦æ³¨æ„çš„æ˜¯å½“æ²¡æœ‰å…ƒç´ çš„æ—¶å€™è¦é˜»å¡žï¼Œå³ç­‰å¾…æœ‰å…ƒç´ äº†æ‰èƒ½èŽ·å–ï¼›æ”¾å…¥å…ƒç´ ä¹Ÿæ˜¯åŒç†ï¼Œè¦ç­‰æœ‰ç©ºä½çš„æ‰èƒ½é‡æ–°æ”¾å…¥ã€‚ å¦‚ä½•å®žçŽ°ä»¥ä¸Šè¿™ç§æ•°æ®ç»“æž„å‘¢ï¼Ÿå…³äºŽå…ˆè¿›çš„å…ˆå‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªæŒ‡é’ˆæ¥å®žçŽ°ï¼Œä¸€ä¸ªå«åšaddIndexï¼Œä¸€ä¸ªå«åšremoveIndexï¼Œåˆå§‹éƒ½æ˜¯æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ å¤„ã€‚å½“å¡žè¿›æ¥ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆaddIndexå°±è‡ªå¢žï¼Œå½“è‡ªå¢žåˆ°æœ€åŽä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªæ—¶å€™æ•°ç»„ä¸ä¸€å®šæ˜¯æ»¡çš„ï¼Œå› ä¸ºæœ‰å¯èƒ½å‰é¢çš„å€¼å·²ç»è¢«å–å‡ºåŽ»äº†ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªå˜é‡countæ¥æ ‡å¿—æ˜¯å¦å·²ç»å¡žæ»¡ï¼Œå¦‚æžœæ»¡äº†å°±é˜»å¡žï¼Œå¦åˆ™å¦‚æžœaddIndexåˆ°æœ€åŽä¸€ä¸ªä½ç½®ï¼Œå°±é‡æ–°ç½®0. å¯¹äºŽremoveIndexä¹Ÿæ˜¯ç›¸åŒæ–¹å‘ç§»é™¤ï¼Œå‡è®¾æœ€ç®€å•çš„æƒ…å†µï¼Œå°±æ˜¯é•¿åº¦ä¸º5çš„æ•°ç»„ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå…ƒç´ æ”¾åœ¨0ä½ç½®ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ”¾åœ¨1ä½ç½®ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ æ”¾åœ¨2ä½ç½®ï¼Œæ­¤æ—¶è¦ç§»é™¤ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„æœ€å…ˆè¿›æ¥çš„å…ƒç´ ï¼Œæˆ‘ä»¬å°†å…¶ç§»é™¤ï¼Œå¹¶ä¸”removeIndexåŠ ä¸€æŒ‡å‘ç¬¬äºŒä¸ªå…ƒç´ ã€‚å¦‚æ­¤åå¤æ‰§è¡Œã€‚ ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108public class MyQueue &#123; //æŒ‡å‘çš„æ˜¯åˆšå…¥é˜Ÿçš„å…ƒç´ çš„ä¸‹è§’æ ‡ private int addIndex; //æŒ‡å‘çš„æ˜¯åˆšå‡ºé˜Ÿçš„å…ƒç´ åŽé¢ä¸€ä¸ªå…ƒç´ çš„ä¸‹è§’æ ‡ private int removeIndex; //å®žé™…å…ƒç´ ä¸ªæ•° private int count; private Lock lock = new ReentrantLock(); private Condition putCondition = lock.newCondition(); private Condition getCondition = lock.newCondition(); private Object[] myQueue; //åˆå§‹åŒ–é˜Ÿåˆ—çš„é•¿åº¦ public MyQueue(int initSize)&#123; myQueue = new Object[initSize]; &#125; //å‘é˜Ÿåˆ—çš„å°¾éƒ¨æ”¾å…¥å…ƒç´  public void put(Object object)&#123; lock.lock(); while (count == myQueue.length)&#123; //è¯´æ˜Žé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œéœ€è¦ç­‰å¾…ä¸€ä¸‹ï¼Œé‚£ä¹ˆæ”¾å…ƒç´ çš„çº¿ç¨‹å°±è¦é˜»å¡žä½ï¼Œå³ç­‰å¾… System.out.println(Thread.currentThread().getName()+"--é˜Ÿåˆ—å·²æ»¡ï¼Œä¸èƒ½å†å¡žå€¼äº†ï¼Œæˆ‘è¦é˜»å¡žä¸€ä¼š...."); try &#123; putCondition.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; //è¯´æ˜Žæ˜¯å¯ä»¥æ”¾å…¥å…ƒç´ çš„ myQueue[addIndex++] = object; if(addIndex == myQueue.length)&#123; addIndex = 0; &#125; //å…ƒç´ çš„æ•°é‡è¦åŠ ä¸€ count++; System.out.println(Thread.currentThread().getName()+"æˆåŠŸå‘é˜Ÿåˆ—æ”¾å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå½“å‰é˜Ÿåˆ—å…ƒç´ ä¸ªæ•°ä¸º---"+count); System.out.println(); getCondition.signal(); lock.unlock(); &#125; //ä»Žé˜Ÿåˆ—çš„å¤´éƒ¨èŽ·å–å…ƒç´  public Object get()&#123; lock.lock(); while (count == 0)&#123; //è¯´æ˜Žé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œéœ€è¦ç­‰å¾…ä¸€ä¸‹ï¼Œé‚£ä¹ˆå–å…ƒç´ çš„çº¿ç¨‹å°±è¦é˜»å¡žä½ï¼Œå³ç­‰å¾… System.out.println(Thread.currentThread().getName()+"--é˜Ÿåˆ—å·²ç©ºï¼Œä¸èƒ½å†å–å€¼äº†ï¼Œæˆ‘è¦é˜»å¡žä¸€ä¼š...."); System.out.println(); try &#123; getCondition.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; int removeValue = (int) myQueue[removeIndex]; myQueue[removeIndex++] = null; if (removeIndex == myQueue.length)&#123; removeIndex = 0; &#125; count--; System.out.println(Thread.currentThread().getName()+"æˆåŠŸä»Žé˜Ÿåˆ—èŽ·å–ä¸€ä¸ªå…ƒç´ ï¼Œå½“å‰é˜Ÿåˆ—çš„å…ƒç´ ä¸ªæ•°ä¸º---"+count); putCondition.signal(); lock.unlock(); return removeValue; &#125; public static void main(String[] args) &#123; MyQueue myQueue = new MyQueue(5); new Thread(new PutThread(myQueue)).start(); new Thread(new TakeThread(myQueue)).start(); new Thread(new TakeThread(myQueue)).start(); &#125;&#125;class PutThread implements Runnable&#123; private MyQueue myQueue; public PutThread(MyQueue myQueue)&#123; this.myQueue = myQueue; &#125; @Override public void run() &#123; for(int i=0;i&lt;10;i++)&#123; System.out.println(Thread.currentThread().getName()+"æˆåŠŸæ”¾å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ ä¸ºï¼š"+i); myQueue.put(i); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125;class TakeThread implements Runnable&#123; private MyQueue myQueue; public TakeThread(MyQueue myQueue)&#123; this.myQueue = myQueue; &#125; @Override public void run() &#123; int res = (int) myQueue.get(); System.out.println(Thread.currentThread().getName()+"æˆåŠŸæ”¾å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå…ƒç´ ä¸ºï¼š"+res); &#125;&#125; å››ã€ConditionåŽŸç†æ¦‚è¿° æˆ‘ä»¬åœ¨ä¸Šé¢çš„å­¦ä¹ ä¸­çœ‹åˆ°ï¼Œå¯¹äºŽä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å°±è¦å‡†å¤‡ä¸€ä¸ªConditionå¯¹è±¡ï¼Œå¹¶ä¸”è¿˜è¦ç”¨å¯é‡å…¥é”ReentrantLockæ¥å®žçŽ°åŠ é”ï¼š 123public Lock lock = new ReentrantLock();public Condition cp = lock.newCondition();public Condition cc = lock.newCondition(); å®ƒçš„åŽŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬çœ‹åˆ°ï¼Œåˆ›å»ºä¸€ä¸ªconditionå¯¹è±¡æ˜¯é€šè¿‡lock.newCondition(),è€Œè¿™ä¸ªæ–¹æ³•å®žé™…ä¸Šæ˜¯ä¼šnewå‡ºä¸€ä¸ªConditionObjectå¯¹è±¡ï¼Œè¯¥ç±»æ˜¯AQSçš„ä¸€ä¸ªå†…éƒ¨ç±». æˆ‘ä»¬çŸ¥é“åœ¨é”æœºåˆ¶çš„å®žçŽ°ä¸Šï¼ŒAQSå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œå¦‚æžœæ˜¯ç‹¬å å¼é”çš„è¯ï¼Œæ‰€æœ‰èŽ·å–é”å¤±è´¥çš„çº¿ç¨‹çš„å°¾æ’å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ ·çš„ï¼Œconditionå†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨åŒæ ·çš„æ–¹å¼ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª ç­‰å¾…é˜Ÿåˆ—ï¼Œæ‰€æœ‰è°ƒç”¨condition.awaitæ–¹æ³•çš„çº¿ç¨‹ä¼šåŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”çº¿ç¨‹çŠ¶æ€è½¬æ¢ä¸ºç­‰å¾…çŠ¶æ€ã€‚å¦å¤–æ³¨æ„åˆ°ConditionObjectä¸­æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼š 1234/** First node of condition queue. */private transient Node firstWaiter;/** Last node of condition queue. */private transient Node lastWaiter; è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥ConditionObjecté€šè¿‡æŒæœ‰ç­‰å¾…é˜Ÿåˆ—çš„å¤´å°¾æŒ‡é’ˆæ¥ç®¡ç†ç­‰å¾…é˜Ÿåˆ—ã€‚ä¸»è¦æ³¨æ„çš„æ˜¯Nodeç±»å¤ç”¨äº†åœ¨AQSä¸­çš„Nodeç±»ã€‚æ‰€ä»¥ç†è§£äº†AQSå°±ç®€å•äº†ã€‚ä½†æ˜¯è¿™ä¸ªé˜Ÿåˆ—æœ‰ä¸€ç‚¹ä¸åŒï¼Œä»–æ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œè€ŒAQSä¸­çš„åŒæ­¥é˜Ÿåˆ—å¼ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚ åŒæ—¶è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨lock.newCondition()æ–¹æ³•åˆ›å»ºå¤šä¸ªconditionå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªlockå¯ä»¥æŒæœ‰å¤šä¸ªç­‰å¾…é˜Ÿåˆ—ã€‚è€Œåœ¨ä¹‹å‰åˆ©ç”¨Objectçš„æ–¹å¼å®žé™…ä¸Šæ˜¯æŒ‡åœ¨å¯¹è±¡Objectå¯¹è±¡ç›‘è§†å™¨ä¸Šåªèƒ½æ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œè€Œå¹¶å‘åŒ…ä¸­çš„Lockæ‹¥æœ‰ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—å’Œå¤šä¸ªç­‰å¾…é˜Ÿåˆ—ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š å¦‚å›¾æ‰€ç¤ºï¼ŒConditionObjectæ˜¯AQSçš„å†…éƒ¨ç±»ï¼Œå› æ­¤æ¯ä¸ªConditionObjectèƒ½å¤Ÿè®¿é—®åˆ°AQSæä¾›çš„æ–¹æ³•ï¼Œç›¸å½“äºŽæ¯ä¸ªConditionéƒ½æ‹¥æœ‰æ‰€å±žåŒæ­¥å™¨çš„å¼•ç”¨ã€‚ å¥½äº†ï¼Œè‡³æ­¤æˆ‘ä»¬å·²ç»çŸ¥é“å¤šæ¬¡è°ƒç”¨lock.newCondition()æ–¹æ³•åˆ›å»ºå¤šä¸ªconditionå¯¹è±¡ï¼Œå¹¶ä¸”å®žé™…ä¸Šè¿™ä¸ªå¯¹è±¡å°±æ˜¯ConditionObjectã€‚AQSç»´æŠ¤çš„åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ç»“æž„ï¼Œè€Œè¿™ä¸ªConditionå¯¹è±¡ç»´æŠ¤çš„æ˜¯ä¸€ä¸ªå•é¡¹é“¾è¡¨ç»“æž„ã€‚ äº”ã€awaitå®žçŽ°åŽŸç† å½“è°ƒç”¨condition.await()æ–¹æ³•åŽä¼šä½¿å¾—å½“å‰èŽ·å–lockçš„çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æžœè¯¥çº¿ç¨‹èƒ½å¤Ÿä»Žawait()æ–¹æ³•è¿”å›žçš„è¯ä¸€å®šæ˜¯è¯¥çº¿ç¨‹èŽ·å–äº†ä¸Žconditionç›¸å…³è”çš„lockã€‚await()æ–¹æ³•æºç ä¸ºï¼š åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨condition.await()æ–¹æ³•åŽï¼Œä¼šä½¿å¾—å½“å‰çº¿ç¨‹é‡Šæ”¾lockç„¶åŽåŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç›´è‡³è¢«signal/signalAllåŽä¼šä½¿å¾—å½“å‰çº¿ç¨‹ä»Žç­‰å¾…é˜Ÿåˆ—ä¸­ç§»è‡³åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­åŽ»ï¼Œç›´åˆ°èŽ·å¾—äº†lockåŽæ‰ä¼šä»Žawaitæ–¹æ³•è¿”å›ž(è·³å‡ºwhileå¾ªçŽ¯é‚£å°±ä¸ç”¨ç»§ç»­ç­‰å¾…äº†å‘—)ï¼Œæˆ–è€…åœ¨ç­‰å¾…æ—¶è¢«ä¸­æ–­ä¼šåšä¸­æ–­å¤„ç†ã€‚ æ‰€ä»¥å¯¹äºŽawait()æ–¹æ³•æ¥è¯´ï¼Œå®ƒå®žçŽ°çš„åŠŸèƒ½ä¸ºï¼šå°†è¦ç­‰å¾…çš„çº¿ç¨‹å°è£…æˆèŠ‚ç‚¹å°¾æ’å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç„¶åŽè·Ÿwaitä¸€æ ·é‡Šæ”¾è¿™ä¸ªç­‰å¾…çº¿ç¨‹çš„é”ã€‚è¿™äº›åšå®Œäº†ä¹‹åŽè¿˜éœ€è¦whileå¾ªçŽ¯åˆ¤æ–­æ˜¯å¦å·²ç»åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªisOnsyncQueueæ˜¯ç”±ä¸‹é¢è¯´åˆ°çš„signalæ–¹æ³•è§¦å‘çš„ï¼Œç”±äºŽæ­¤æ—¶è¿˜æ²¡æœ‰signalæ‰€ä»¥é™·åœ¨æ­»å¾ªçŽ¯ä¸­å‡ºä¸æ¥ï¼Œå°±è°ƒç”¨lockSupport.parkæ–¹æ³•ä½¿ä»–è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›å½“æœ‰signalæˆ–è€…æœ‰ä¸­æ–­å‘ç”Ÿçš„æ—¶å€™ï¼Œå°±è·³å‡ºå¾ªçŽ¯ï¼Œç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶å¦‚æžœæ˜¯signalè§¦å‘çš„ï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªif,é‚£å°±è°ƒç”¨acquireQueueæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æˆ‘ä»¬ä¹‹å‰è¯´çš„AQSä¸­æ˜¯æåŠçš„ï¼Œä¸»è¦æ€æƒ³æ˜¯å¦‚æžœè¿™ä¸ªèŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯headé‚£ä¹ˆå°±è‡ªæ—‹èŽ·å–é”ï¼Œå¦åˆ™å¯èƒ½ä¼šé˜»å¡žã€‚è¿™é‡Œå·²ç»ä»Žå¤§ä½“ä¸Šè¯´æ˜Žäº†è¿™ä¸ªæ–¹æ³•çš„æ•´ä½“æ€è·¯ï¼Œä¸‹é¢ç»§ç»­è¯¦ç»†åˆ†æžåˆ†æžã€‚ åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†çŸ¥é“ï¼š æ˜¯æ€Žæ ·å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­åŽ»çš„ï¼Ÿ é‡Šæ”¾é”çš„è¿‡ç¨‹ï¼Ÿ æ€Žæ ·æ‰èƒ½ä»Žawaitæ–¹æ³•é€€å‡ºï¼Ÿ ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯æ€Žæ ·å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­åŽ»çš„ï¼Ÿ è¿™æ®µä»£ç å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå°†å½“å‰èŠ‚ç‚¹åŒ…è£…æˆNodeï¼Œå¦‚æžœç­‰å¾…é˜Ÿåˆ—çš„firstWaiterä¸ºnullçš„è¯ï¼ˆç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºé˜Ÿåˆ—ï¼‰ï¼Œåˆ™å°†firstWaiteræŒ‡å‘å½“å‰çš„Node,å¦åˆ™ï¼Œæ›´æ–°lastWaiter(å°¾èŠ‚ç‚¹)å³å¯ã€‚å°±æ˜¯é€šè¿‡å°¾æ’å…¥çš„æ–¹å¼å°†å½“å‰çº¿ç¨‹å°è£…çš„Nodeæ’å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­å³å¯ï¼ŒåŒæ—¶å¯ä»¥çœ‹å‡ºç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªä¸å¸¦å¤´ç»“ç‚¹çš„é“¾å¼é˜Ÿåˆ—ï¼Œä¹‹å‰æˆ‘ä»¬å­¦ä¹ AQSæ—¶çŸ¥é“åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå¸¦å¤´ç»“ç‚¹çš„é“¾å¼é˜Ÿåˆ—ï¼Œè¿™æ˜¯ä¸¤è€…çš„ä¸€ä¸ªåŒºåˆ«ã€‚å°†å½“å‰èŠ‚ç‚¹æ’å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¹‹åŽï¼Œä¼šä½¿å½“å‰çº¿ç¨‹é‡Šæ”¾lockï¼Œç”±fullyReleaseæ–¹æ³•å®žçŽ°ï¼ŒfullyReleaseæºç ä¸ºï¼š è°ƒç”¨AQSçš„æ¨¡æ¿æ–¹æ³•releaseæ–¹æ³•é‡Šæ”¾AQSçš„åŒæ­¥çŠ¶æ€(è¿™æ ·ä¹Ÿè¯´æ˜Žäº†é€€å‡ºawaitæ–¹æ³•å¿…é¡»æ˜¯å·²ç»èŽ·å¾—äº†conditionå¼•ç”¨ï¼ˆå…³è”ï¼‰çš„lock)å¹¶ä¸”å”¤é†’åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­å¤´ç»“ç‚¹çš„åŽç»§èŠ‚ç‚¹å¼•ç”¨çš„çº¿ç¨‹ï¼Œå¦‚æžœé‡Šæ”¾æˆåŠŸåˆ™æ­£å¸¸è¿”å›žï¼Œè‹¥å¤±è´¥çš„è¯å°±æŠ›å‡ºå¼‚å¸¸ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™ä¸¤æ®µä»£ç å·²ç»è§£å†³äº†å‰é¢çš„ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆäº†ï¼Œè¿˜å‰©ä¸‹ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œæ€Žæ ·ä»Žawaitæ–¹æ³•é€€å‡ºï¼ŸçŽ°åœ¨å›žè¿‡å¤´å†æ¥çœ‹awaitæ–¹æ³•æœ‰è¿™æ ·ä¸€æ®µé€»è¾‘ï¼š å¾ˆæ˜¾ç„¶ï¼Œå½“çº¿ç¨‹ç¬¬ä¸€æ¬¡è°ƒç”¨condition.await()æ–¹æ³•æ—¶ï¼Œä¼šè¿›å…¥åˆ°è¿™ä¸ªwhile()å¾ªçŽ¯ä¸­ï¼Œå› ä¸ºåˆ¤æ–­çš„æ¡ä»¶æ˜¯è¿™ä¸ªçº¿ç¨‹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬è¿™ä¸ªåˆšè¿›ç­‰å¾…é˜Ÿåˆ—ï¼Œå’‹å¯èƒ½åœ¨åŒæ­¥é˜Ÿåˆ—ã€‚ ç„¶åŽé€šè¿‡LockSupport.park(this)æ–¹æ³•ä½¿å¾—å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆè¦æƒ³é€€å‡ºè¿™ä¸ªawaitæ–¹æ³•ç¬¬ä¸€ä¸ªå‰ææ¡ä»¶è‡ªç„¶è€Œç„¶çš„æ˜¯è¦å…ˆé€€å‡ºè¿™ä¸ªwhileå¾ªçŽ¯ï¼Œå‡ºå£å°±åªå‰©ä¸‹ä¸¤ä¸ªåœ°æ–¹ï¼š é€»è¾‘èµ°åˆ°breaké€€å‡ºwhileå¾ªçŽ¯ï¼› whileå¾ªçŽ¯ä¸­çš„é€»è¾‘åˆ¤æ–­ä¸ºfalseã€‚ å†çœ‹ä»£ç å‡ºçŽ°ç¬¬1ç§æƒ…å†µçš„æ¡ä»¶æ˜¯å½“å‰ç­‰å¾…çš„çº¿ç¨‹è¢«ä¸­æ–­åŽä»£ç ä¼šèµ°åˆ°breaké€€å‡ºï¼Œç¬¬äºŒç§æƒ…å†µæ˜¯å½“å‰èŠ‚ç‚¹è¢«ç§»åŠ¨åˆ°äº†åŒæ­¥é˜Ÿåˆ—ä¸­ï¼ˆå³å¦å¤–çº¿ç¨‹è°ƒç”¨çš„conditionçš„signalæˆ–è€…signalAllæ–¹æ³•ï¼‰ï¼Œwhileä¸­é€»è¾‘åˆ¤æ–­ä¸ºfalseåŽç»“æŸwhileå¾ªçŽ¯ã€‚ æ€»ç»“ä¸‹ï¼Œå°±æ˜¯å½“å‰çº¿ç¨‹è¢«ä¸­æ–­æˆ–è€…è°ƒç”¨condition.signal/condition.signalAllæ–¹æ³•å½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°äº†åŒæ­¥é˜Ÿåˆ—åŽ ï¼Œè¿™æ˜¯å½“å‰çº¿ç¨‹é€€å‡ºawaitæ–¹æ³•çš„å‰ææ¡ä»¶ã€‚ å½“é€€å‡ºwhileå¾ªçŽ¯åŽå°±ä¼šè°ƒç”¨acquireQueued(node, savedState)ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ä»‹ç»AQSçš„åº•å±‚å®žçŽ°æ—¶è¯´è¿‡äº†ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯åœ¨è‡ªæ—‹è¿‡ç¨‹ä¸­çº¿ç¨‹ä¸æ–­å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œç›´è‡³æˆåŠŸï¼ˆçº¿ç¨‹èŽ·å–åˆ°lockï¼‰ã€‚ awaitæ–¹æ³•ç¤ºæ„å›¾å¦‚ä¸‹å›¾ï¼š å¦‚å›¾ï¼Œè°ƒç”¨condition.awaitæ–¹æ³•çš„çº¿ç¨‹å¿…é¡»æ˜¯å·²ç»èŽ·å¾—äº†lockï¼Œä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹æ˜¯åŒæ­¥é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ã€‚è°ƒç”¨è¯¥æ–¹æ³•åŽä¼šä½¿å¾—å½“å‰çº¿ç¨‹æ‰€å°è£…çš„Nodeå°¾æ’å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ æ­¤å¤–ï¼Œawaitä¹Ÿæ”¯æŒè¶…æ—¶ç­‰å¾…å’Œä¸å“åº”ä¸­æ–­ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ å…­ã€signal/signalAllå®žçŽ°åŽŸç† è°ƒç”¨conditionçš„signalæˆ–è€…signalAllæ–¹æ³•å¯ä»¥å°†ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œä½¿å¾—è¯¥èŠ‚ç‚¹èƒ½å¤Ÿæœ‰æœºä¼šèŽ·å¾—lockã€‚æŒ‰ç…§ç­‰å¾…é˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„ï¼Œæ‰€ä»¥ç­‰å¾…é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹å¿…ç„¶ä¼šæ˜¯ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡è°ƒç”¨conditionçš„signalæ–¹æ³•æ˜¯å°†å¤´èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ signalæ–¹æ³•é¦–å…ˆä¼šæ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»èŽ·å–lockï¼Œå¦‚æžœæ²¡æœ‰èŽ·å–lockä¼šç›´æŽ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æžœèŽ·å–çš„è¯å†å¾—åˆ°ç­‰å¾…é˜Ÿåˆ—çš„å¤´æŒ‡é’ˆå¼•ç”¨çš„èŠ‚ç‚¹ï¼Œä¹‹åŽçš„æ“ä½œçš„doSignalæ–¹æ³•ä¹Ÿæ˜¯åŸºäºŽè¯¥èŠ‚ç‚¹ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹doSignalæ–¹æ³•åšäº†äº›ä»€ä¹ˆäº‹æƒ…ï¼ŒdoSignalæ–¹æ³•æºç ä¸ºï¼š å…·ä½“é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼ŒçœŸæ­£å¯¹å¤´èŠ‚ç‚¹åšå¤„ç†çš„é€»è¾‘åœ¨transferForSignalä¸­ï¼Œè¯¥æ–¹æ³•æºç ä¸ºï¼š å…³é”®é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼Œè¿™æ®µä»£ç ä¸»è¦åšäº†ä¸¤ä»¶äº‹æƒ…1.å°†å¤´ç»“ç‚¹çš„çŠ¶æ€æ›´æ”¹ä¸ºCONDITIONï¼›2.è°ƒç”¨enqæ–¹æ³•ï¼Œå°†è¯¥èŠ‚ç‚¹å°¾æ’å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå…³äºŽenqæ–¹æ³•è¯·çœ‹AQSçš„åº•å±‚å®žçŽ°è¿™ç¯‡æ–‡ç« ã€‚çŽ°åœ¨æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šè°ƒç”¨conditionçš„signalçš„å‰ææ¡ä»¶æ˜¯å½“å‰çº¿ç¨‹å·²ç»èŽ·å–äº†lockï¼Œè¯¥æ–¹æ³•ä¼šä½¿å¾—ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å¤´èŠ‚ç‚¹å³ç­‰å¾…æ—¶é—´æœ€é•¿çš„é‚£ä¸ªèŠ‚ç‚¹ç§»å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè€Œç§»å…¥åˆ°åŒæ­¥é˜Ÿåˆ—åŽæ‰æœ‰æœºä¼šä½¿å¾—ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ï¼Œå³ä»Žawaitæ–¹æ³•ä¸­çš„LockSupport.park(this)æ–¹æ³•ä¸­è¿”å›žï¼Œä»Žè€Œæ‰æœ‰æœºä¼šä½¿å¾—è°ƒç”¨awaitæ–¹æ³•çš„çº¿ç¨‹æˆåŠŸé€€å‡ºï¼Œæ­¤æ—¶å°±è¦å›žè¿‡å¤´åŽ»å†çœ‹çœ‹awaitæ–¹æ³•çš„åŽç»­å¤„ç†æµç¨‹äº†ã€‚signalæ‰§è¡Œç¤ºæ„å›¾å¦‚ä¸‹å›¾ï¼š sigllAllä¸Žsigalæ–¹æ³•çš„åŒºåˆ«ä½“çŽ°åœ¨doSignalAllæ–¹æ³•ä¸Šï¼Œå‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“doSignalæ–¹æ³•åªä¼šå¯¹ç­‰å¾…é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼Œè€ŒdoSignalAllåªä¸è¿‡æ—¶é—´ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ç§»å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå³â€œé€šçŸ¥â€å½“å‰è°ƒç”¨condition.await()æ–¹æ³•çš„æ¯ä¸€ä¸ªçº¿ç¨‹ã€‚ æ•´ç†è‡ªï¼šè¯¦è§£Conditionçš„awaitå’Œsignalç­‰å¾…/é€šçŸ¥æœºåˆ¶]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®žçŽ°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼]]></title>
    <url>%2F2019%2F02%2F13%2Fthread%2F%E5%AE%9E%E7%8E%B0%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[æ— è®ºæ˜¯é¢è¯•è¿˜æ˜¯å·¥ä½œä¸­ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬ç”¨å„ç§æ–¹å¼æ¥å®žçŽ°å®ƒã€‚ å‰è¨€ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜æ˜¯çº¿ç¨‹æ¨¡åž‹ä¸­çš„ç»å…¸é—®é¢˜ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åœ¨åŒä¸€æ—¶é—´æ®µå†…å…±ç”¨åŒä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œç”Ÿäº§è€…å¾€å­˜å‚¨ç©ºé—´ä¸­æ·»åŠ äº§å“ï¼Œæ¶ˆè´¹è€…ä»Žå­˜å‚¨ç©ºé—´ä¸­å–èµ°äº§å“ï¼Œå½“å­˜å‚¨ç©ºé—´ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…é˜»å¡žï¼Œå½“å­˜å‚¨ç©ºé—´æ»¡æ—¶ï¼Œç”Ÿäº§è€…é˜»å¡žã€‚ ä¸€ã€wait/notify/notifyAllå®žçŽ° æœ‰ä¸€ä¸ªå¤©çŒ«å°åº—ä¸“é—¨è´Ÿè´£ç”Ÿäº§å•†å“ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åŽ»ä¹°å•†å“ï¼š ä¸€ä¸ªç”Ÿäº§è€…çš„çº¿ç¨‹ï¼š åŒç†ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…çš„çº¿ç¨‹ï¼š ä¸‹é¢è¿›è¡Œæµ‹è¯•ï¼š æ­¤æ—¶çš„ç»“æžœä¸ºï¼š ç”±äºŽç”Ÿäº§å¤§äºŽæ¶ˆè´¹ï¼Œé€ æˆäº§èƒ½è¿‡å‰©ã€‚ äºŒã€é˜»å¡žé˜Ÿåˆ—å®žçŽ° è¿™ä¸ªçš„å®žçŽ°å·²ç»åœ¨JUCç»„ä»¶æ‹“å±•-BlockingQueueä¸­å®žçŽ°äº†ã€‚ä¸å†èµ˜è¿°ã€‚ä¸»è¦å°±æ˜¯ç”¨åˆ°é˜»å¡žçš„put()å’Œtake()ä¸¤ä¸ªæ–¹æ³•ã€‚ ä¸‰ã€condition+Lockå®žçŽ° è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åŸºäºŽwaitå’Œnotifyçš„ä»£ç ç¨å¾®æ”¹ä¸€ä¸‹å³å¯ã€‚ ç”Ÿäº§è€…æ”¹ä¸ºï¼š æ¶ˆè´¹è€…è·Ÿç”Ÿäº§è€…ä¸€æ ·çš„æ”¹æ³•ï¼š æ‰§è¡Œæ•ˆæžœç±»ä¼¼ã€‚å…³äºŽConditionæŽ¥å£ï¼Œåœ¨Conditionè¯¦è§£è¿™ç¯‡æ–‡ç« ä¸­è¿›è¡Œäº†è¯¦ç»†ä»‹ç»ã€‚ å…¶å®žè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ–¹å¼ä¹Ÿå¯ä»¥å®žçŽ°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡åž‹ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æœ€æ ¸å¿ƒçš„å°±æ˜¯ä¸Šé¢è®²çš„ä¸‰ç§ï¼ŒæŽŒæ¡è¿™ä¸ªå°±ä¸æ…Œäº†ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹é—´é€šä¿¡æ–¹å¼æ€»ç»“]]></title>
    <url>%2F2019%2F02%2F13%2Fthread%2F%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[åœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»äº†waitå’Œnotifyçš„åŸºæœ¬çŸ¥è¯†ï¼Œæˆ‘ä»¬çŸ¥é“äº†ä»–ä»¬éƒ½æ˜¯Objectè¿™ä¸ªåŸºç±»ä¸­çš„æ–¹æ³•ï¼Œå› æ­¤æ¯ä¸ªå¯¹è±¡éƒ½å¤©ç”Ÿæ‹¥æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯è§å…¶é‡è¦æ€§ï¼Œåœ¨å¤šçº¿ç¨‹çš„å­¦ä¹ ä¸­ï¼Œä»–ä»¬ä¸¤å…„å¼Ÿå¯ä»¥å®žçŽ°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œå½“ç„¶äº†ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–çš„æ–¹å¼å®žçŽ°çº¿ç¨‹é—´é€šä¿¡ï¼Œä¸‹é¢é€ä¸€å‡»ç ´ã€‚ ä¸€ã€å‰è¨€ å¼€å‘ä¸­ä¸å…ä¼šé‡åˆ°éœ€è¦æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•é€šçŸ¥ä¸»çº¿ç¨‹å¤„ç†æŸäº›é€»è¾‘çš„åœºæ™¯ã€‚æˆ–è€…æ˜¯çº¿ç¨‹ A åœ¨æ‰§è¡Œåˆ°æŸä¸ªæ¡ä»¶é€šçŸ¥çº¿ç¨‹ B æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚ äºŒã€ç­‰å¾…é€šçŸ¥æœºåˆ¶ å³ç”¨wait+notifyæ¥å®žçŽ°ã€‚ æ¡ˆä¾‹ç›®æ ‡ï¼šä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°å¥‡å¶æ•°ï¼Œä¸€å…±100ä¸ªã€‚æ³¨æ„ï¼Œè¿™ä¹Ÿæ˜¯é˜¿é‡Œçš„ä¸€é“é¢è¯•ç¼–ç¨‹é¢˜ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273public class TwoThreadWaitNotify &#123; private int count = 1; private boolean flag = false; public static void main(String[] args) &#123; TwoThreadWaitNotify twoThreadWaitNotify = new TwoThreadWaitNotify(); new Thread(new PrintOdd(twoThreadWaitNotify)).start(); new Thread(new PrintEven(twoThreadWaitNotify)).start(); &#125; //æ‰“å°å¥‡æ•° static class PrintOdd implements Runnable&#123; private TwoThreadWaitNotify twoThreadWaitNotify; public PrintOdd(TwoThreadWaitNotify twoThreadWaitNotify)&#123; this.twoThreadWaitNotify = twoThreadWaitNotify; &#125; @Override public void run() &#123; while(twoThreadWaitNotify.count &lt;= 100)&#123; synchronized (TwoThreadWaitNotify.class)&#123; if(!twoThreadWaitNotify.flag)&#123; System.out.println("å¥‡æ•°çº¿ç¨‹å¼€å§‹æ‰§è¡Œï¼Œæ‰“å°ï¼š"+twoThreadWaitNotify.count); twoThreadWaitNotify.count++; twoThreadWaitNotify.flag = true; TwoThreadWaitNotify.class.notify(); &#125;else &#123; try &#123; TwoThreadWaitNotify.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; &#125; //æ‰“å°å¶æ•° static class PrintEven implements Runnable&#123; private TwoThreadWaitNotify twoThreadWaitNotify; public PrintEven(TwoThreadWaitNotify twoThreadWaitNotify)&#123; this.twoThreadWaitNotify = twoThreadWaitNotify; &#125; @Override public void run() &#123; while(twoThreadWaitNotify.count &lt;= 100)&#123; synchronized (TwoThreadWaitNotify.class)&#123; if(twoThreadWaitNotify.flag)&#123; System.out.println("å¶æ•°çº¿ç¨‹å¼€å§‹æ‰§è¡Œï¼Œæ‰“å°ï¼š"+twoThreadWaitNotify.count); twoThreadWaitNotify.count++; twoThreadWaitNotify.flag = false; TwoThreadWaitNotify.class.notify(); &#125;else &#123; try &#123; TwoThreadWaitNotify.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; &#125;&#125; è¿è¡Œç»“æžœéƒ¨åˆ†æˆªå›¾ï¼š è¿™é‡Œçš„çº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡ TwoThreadWaitNotify.class èŽ·å–é”ï¼ŒA çº¿ç¨‹è°ƒç”¨äº†åŒæ­¥å¯¹è±¡çš„ wait() æ–¹æ³•é‡Šæ”¾äº†é”å¹¶è¿›å…¥ WAITING çŠ¶æ€ã€‚ B çº¿ç¨‹è°ƒç”¨äº† notify() æ–¹æ³•ï¼Œè¿™æ · A çº¿ç¨‹æ”¶åˆ°é€šçŸ¥ä¹‹åŽå°±å¯ä»¥ä»Ž wait() æ–¹æ³•ä¸­è¿”å›žã€‚ è¿™é‡Œåˆ©ç”¨äº† TwoThreadWaitNotify.class å¯¹è±¡å®Œæˆäº†é€šä¿¡ã€‚ æœ‰ä¸€äº›éœ€è¦æ³¨æ„: wait() ã€notify()ã€notifyAll() è°ƒç”¨çš„å‰æéƒ½æ˜¯èŽ·å¾—äº†å¯¹è±¡çš„é”(ä¹Ÿå¯ç§°ä¸ºå¯¹è±¡ç›‘è§†å™¨)ã€‚ è°ƒç”¨ wait() æ–¹æ³•åŽçº¿ç¨‹ä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥WAITING çŠ¶æ€ï¼Œè¯¥çº¿ç¨‹ä¹Ÿä¼šè¢«ç§»åŠ¨åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ è°ƒç”¨ notify() æ–¹æ³•ä¼šå°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹çŠ¶æ€ä¹Ÿä¼šæ›´æ–°ä¸º BLOCKED ä»Ž wait() æ–¹æ³•è¿”å›žçš„å‰ææ˜¯è°ƒç”¨ notify() æ–¹æ³•çš„çº¿ç¨‹é‡Šæ”¾é”ï¼Œwait() æ–¹æ³•çš„çº¿ç¨‹èŽ·å¾—é”ã€‚ â­ç­‰å¾…é€šçŸ¥æœ‰ç€ä¸€ä¸ªç»å…¸èŒƒå¼ï¼š çº¿ç¨‹ A ä½œä¸ºæ¶ˆè´¹è€…ï¼š èŽ·å–å¯¹è±¡çš„é”ã€‚ 2.è¿›å…¥ while(åˆ¤æ–­æ¡ä»¶)ï¼Œå¹¶è°ƒç”¨ wait() æ–¹æ³•ã€‚ å½“æ¡ä»¶æ»¡è¶³è·³å‡ºå¾ªçŽ¯æ‰§è¡Œå…·ä½“å¤„ç†é€»è¾‘ã€‚ çº¿ç¨‹ B ä½œä¸ºç”Ÿäº§è€…: èŽ·å–å¯¹è±¡é”ã€‚ æ›´æ”¹ä¸Žçº¿ç¨‹ A å…±ç”¨çš„åˆ¤æ–­æ¡ä»¶ã€‚ è°ƒç”¨ notify() æ–¹æ³•ã€‚ ä¼ªä»£ç å¦‚ä¸‹: 1234567891011121314//Thread Asynchronized(Object)&#123; while(æ¡ä»¶)&#123; Object.wait(); &#125; //do something&#125;//Thread Bsynchronized(Object)&#123; æ¡ä»¶=false;//æ”¹å˜æ¡ä»¶ Object.notify();&#125; ä¸‰ã€Joinæ–¹å¼ è¿™ä¸ªä¹‹å‰ä¹Ÿæ˜¯æåŠè¿‡çš„ï¼Œä¸»è¦æ˜¯å¯ä»¥æ‰“æ–­ä¸»çº¿ç¨‹è®©å­çº¿ç¨‹å…ˆæ‰§è¡Œå®Œï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯ç²’åº¦ä¸å¤Ÿç»†è…»ï¼Œæˆ‘ä¸èƒ½æŽ§åˆ¶å­çº¿ç¨‹åœ¨æŸä¸ªç‚¹åœä¸€ä¸‹è®©å…¶ä»–å­çº¿ç¨‹æ‰§è¡Œã€‚ æ ¸å¿ƒé€»è¾‘: 123while (isAlive()) &#123; wait(0);&#125; åœ¨ join çº¿ç¨‹å®ŒæˆåŽä¼šè°ƒç”¨ notifyAll() æ–¹æ³•ï¼Œæ˜¯åœ¨ JVM å®žçŽ°ä¸­è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œçœ‹ä¸å‡ºæ¥ã€‚ å››ã€volatile å…±äº«å†…å­˜ å› ä¸º Java æ˜¯é‡‡ç”¨å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œçº¿ç¨‹é€šä¿¡çš„ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ç”¨ä¸»çº¿ç¨‹å…³é—­ A çº¿ç¨‹: è¾“å‡ºç»“æžœï¼š 12345thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ­£åœ¨è¿è¡Œã€‚ã€‚ã€‚thread Aæ‰§è¡Œå®Œæ¯• è¿™é‡Œçš„ flag å­˜æ”¾äºŽä¸»å†…å­˜ä¸­ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹å’Œçº¿ç¨‹ A éƒ½å¯ä»¥çœ‹åˆ°ã€‚flag é‡‡ç”¨ volatile ä¿®é¥°ä¸»è¦æ˜¯ä¸ºäº†å†…å­˜å¯è§æ€§ã€‚ äº”ã€CountDownLatch å¹¶å‘å·¥å…· åœ¨å‰é¢çš„æ–‡ç« ä¸­æˆ‘ä»¬åŸºæœ¬çŸ¥é“å®ƒçš„ä½¿ç”¨ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œæ²¡æœ‰æ‰¾ä¸€ä¸ªæ¯”è¾ƒå®žé™…çš„åœºæ™¯æ¥æè¿°å®ƒçš„åŠŸèƒ½ï¼Œä¸‹é¢æˆ‘å°†ä»¥ä¸€ä¸ªå®žé™…åœºæ™¯æ¥ç”¨CountDownLatchæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å‡è®¾å°æ˜Žå’Œå°çº¢æ˜¯ä¸€å¯¹å¤«å¦»ï¼Œä»–ä»¬ä¸¤å‡†å¤‡çƒ§ä¸€ä¸ªèœï¼Œå°±å«åšé’æ¤’ç‚’è‚‰ä¸ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œè¦æƒ³ç‚’å‡ºé’æ¤’ç‚’è‚‰ä¸ï¼Œéœ€è¦åˆ‡å¥½é’æ¤’ï¼Œç„¶åŽåˆ‡å¥½è‚‰ä¸ï¼Œå¦‚æžœæƒ³è¦è‚‰çš„è´¨æ„Ÿçˆ½å«©ï¼Œéœ€è¦ç”¨æ·€ç²‰æ‰ä¸€æ‰ï¼ŒåŠ ç‚¹é†‹ï¼ŒåŠ ç‚¹æ–™é…’åŽ»åŽ»è…¥ï¼Œå¹¶ä¸”å¼„å¥½äº†ä¹‹åŽéœ€è¦å…ˆç‚’ä¸€ä¸‹è‚‰ã€‚æœ€åŽä¸¤æ ·éƒ½å‡†å¤‡å¥½ä¹‹åŽï¼šå³åˆ‡å¥½çš„é’æ¤’å’Œé¢„çƒ­å¥½çš„è‚‰ä¸ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆåœ¨ä¸€èµ·ç‚’ä¸€ä¸‹å‡ºé”…äº†ã€‚ å‡è®¾åˆ‡é’æ¤’éœ€è¦3åˆ†é’Ÿï¼Œå‡†å¤‡å¥½è‚‰éœ€è¦5åˆ†é’Ÿï¼Œè¿™ä¸¤ä¸ªåŒæ—¶å‡†å¤‡å¥½ä¹‹åŽå°±å¯ä»¥è¿›è¡Œçƒ§èœäº†ã€‚å¦‚ä½•æœ€å¤§ç¨‹åº¦ä¸Šæé«˜æ•ˆçŽ‡å‘¢ï¼Ÿ æ˜¾ç„¶ï¼Œå°±æ˜¯å°æ˜Žåˆ‡é’æ¤’ï¼Œå°çº¢æžè‚‰ä¸ï¼Œä¸¤ä¸ªäººå¹¶è¡Œã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨CountDownLatchæ¥æ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯ã€‚ åˆ‡é’æ¤’çº¿ç¨‹ï¼š å‡†å¤‡è‚‰ä¸çš„çº¿ç¨‹ï¼š æµ‹è¯•ï¼š ç»“æžœä¸ºï¼š 12345å°æ˜Žå¼€å§‹åˆ‡é’æ¤’...å°çº¢å¼€å§‹å‡†å¤‡è‚‰ä¸...å°æ˜Žåˆ‡å¥½é’æ¤’äº†...å°çº¢å‡†å¤‡å¥½è‚‰ä¸äº†...overï¼Œé£Ÿæå…¨éƒ¨å‡†å¤‡å¥½äº†ï¼Œä¸€èµ·ä¸‹é”… cost:5010 è¿™é‡Œçªå‡ºçš„å°±æ˜¯ï¼Œä¸»çº¿ç¨‹ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œå®Œäº†æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ CountDownLatch ä¹Ÿæ˜¯åŸºäºŽ AQS(AbstractQueuedSynchronizer) å®žçŽ°çš„. åˆå§‹åŒ–ä¸€ä¸ª CountDownLatch æ—¶å‘Šè¯‰å¹¶å‘çš„çº¿ç¨‹ï¼Œç„¶åŽåœ¨æ¯ä¸ªçº¿ç¨‹å¤„ç†å®Œæ¯•ä¹‹åŽè°ƒç”¨ countDown() æ–¹æ³•ã€‚ è¯¥æ–¹æ³•ä¼šå°† AQS å†…ç½®çš„ä¸€ä¸ª state çŠ¶æ€ -1 ã€‚ æœ€ç»ˆåœ¨ä¸»çº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•ï¼Œå®ƒä¼šé˜»å¡žç›´åˆ° state == 0 çš„æ—¶å€™è¿”å›žã€‚ è¿™ä¸ªåŠŸèƒ½æ˜¯ä¸æ˜¯å¾ˆç±»ä¼¼äºŽä¸Šé¢çš„joinï¼Œä½†æ˜¯å®ƒæ¯”joinçµæ´»å¤šäº†ã€‚ å…­ã€CyclicBarrier å¹¶å‘å·¥å…· è¿™ä¸ªå·¥å…·ç±»ä»ŽåŽŸç†ä¸Šæ¥çœ‹ä¸ŽCountDownLatchéžå¸¸ç±»ä¼¼ï¼Œå…·ä½“çš„ä½¿ç”¨å¯ä»¥çœ‹AQSå®žçŽ°çš„ä¸€äº›åŒæ­¥ç»„ä»¶ä»‹ç»ã€‚ä»–ä»¬ä¸¤æ˜¯æœ‰åŒºåˆ«çš„ã€‚è¯¥å·¥å…·å¯ä»¥å®žçŽ° CountDownLatch åŒæ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¦æ›´åŠ çµæ´»ã€‚ç”šè‡³å¯ä»¥è°ƒç”¨ reset() æ–¹æ³•é‡ç½® CyclicBarrier (éœ€è¦è‡ªè¡Œæ•èŽ· BrokenBarrierException å¤„ç†) ç„¶åŽé‡æ–°æ‰§è¡Œã€‚å°±ä¸å†èµ˜è¿°äº†ã€‚ ä¸ƒã€çº¿ç¨‹å“åº”ä¸­æ–­ è¿™ä¸ªæˆ‘ä»¬ä¹‹å‰ä¹Ÿæ˜¯æè¿‡çš„ï¼Œå°±æ˜¯interruptæ¥å®žçŽ°ï¼Œçº¿ç¨‹æ–¹æ³•é‡Œé¢ç”¨whileä¸åœåœ°åˆ¤æ–­ä¸­æ–­æ ‡å¿—ä½ä»Žè€Œè¾¾åˆ°è‡ªä¸»ä¸­æ–­çš„ç›®çš„ã€‚ è¾“å‡ºç»“æžœ: 123thread Aè¿è¡Œä¸­ã€‚ã€‚thread Aè¿è¡Œä¸­ã€‚ã€‚thread Aé€€å‡ºã€‚ã€‚ å¯ä»¥é‡‡ç”¨ä¸­æ–­çº¿ç¨‹çš„æ–¹å¼æ¥é€šä¿¡ï¼Œè°ƒç”¨äº† thread.interrupt() æ–¹æ³•å…¶å®žå°±æ˜¯å°† thread ä¸­çš„ä¸€ä¸ªæ ‡å¿—å±žæ€§ç½®ä¸ºäº† trueã€‚ å¹¶ä¸æ˜¯è¯´è°ƒç”¨äº†è¯¥æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹ï¼Œå¦‚æžœä¸å¯¹è¿™ä¸ªæ ‡å¿—è¿›è¡Œå“åº”å…¶å®žæ˜¯æ²¡æœ‰ä»€ä¹ˆä½œç”¨(è¿™é‡Œå¯¹è¿™ä¸ªæ ‡å¿—è¿›è¡Œäº†åˆ¤æ–­)ã€‚ ä½†æ˜¯å¦‚æžœæŠ›å‡ºäº† InterruptedException å¼‚å¸¸ï¼Œè¯¥æ ‡å¿—å°±ä¼šè¢« JVM é‡ç½®ä¸º falseã€‚ å…«ã€çº¿ç¨‹æ±  awaitTermination() æ–¹æ³• è¿™ä¸ªçŽ©æ„ä¸Žæˆ‘ä»¬çŸ¥é“shutdownæ–¹æ³•ç»„åˆä½¿ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè°ƒç”¨äº† shutdown() ä¹‹åŽçº¿ç¨‹æ± ä¼šåœæ­¢æŽ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šå¹³æ»‘çš„å…³é—­çº¿ç¨‹æ± ä¸­çŽ°æœ‰çš„ä»»åŠ¡ã€‚ å…³äºŽawaitTermination()æ–¹æ³•ï¼ŒæŽ¥æ”¶timeoutå’ŒTimeUnitä¸¤ä¸ªå‚æ•°ï¼Œç”¨äºŽè®¾å®šè¶…æ—¶æ—¶é—´åŠå•ä½ã€‚å½“ç­‰å¾…è¶…è¿‡è®¾å®šæ—¶é—´æ—¶ï¼Œä¼šç›‘æµ‹ExecutorServiceæ˜¯å¦å·²ç»å…³é—­ï¼Œè‹¥å…³é—­åˆ™è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalse.å› æ­¤ï¼Œåœ¨shutdwonä¹‹åŽï¼Œæˆ‘ä»¬å¯ä»¥ç”¨awaitTermination()ä¸æ–­åœ°ç›‘æµ‹å‰©ä¸‹çš„çº¿ç¨‹çš„æ‰§è¡ŒçŠ¶æ€ï¼Œæ‰§è¡Œå®Œæ¯•å°±å¯ä»¥æ‰§è¡Œä¸»çº¿ç¨‹äº†ã€‚ è¾“å‡ºç»“æžœ: 123452018-03-16 20:18:01.273 [pool-1-thread-2] INFO c.c.actual.ThreadCommunication - running22018-03-16 20:18:01.273 [pool-1-thread-1] INFO c.c.actual.ThreadCommunication - running2018-03-16 20:18:02.273 [main] INFO c.c.actual.ThreadCommunication - çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚2018-03-16 20:18:03.278 [main] INFO c.c.actual.ThreadCommunication - çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œã€‚ã€‚ã€‚2018-03-16 20:18:04.278 [main] INFO c.c.actual.ThreadCommunication - main over æœ€åŽå†å¼ºè°ƒä¸€ä¸‹ï¼š ä½¿ç”¨è¿™ä¸ª awaitTermination() æ–¹æ³•çš„å‰æéœ€è¦å…³é—­çº¿ç¨‹æ± ï¼Œå¦‚è°ƒç”¨äº† shutdown() æ–¹æ³•ã€‚ è°ƒç”¨äº† shutdown() ä¹‹åŽçº¿ç¨‹æ± ä¼šåœæ­¢æŽ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šå¹³æ»‘çš„å…³é—­çº¿ç¨‹æ± ä¸­çŽ°æœ‰çš„ä»»åŠ¡ã€‚ ä¹ã€ç®¡é“é€šä¿¡ è¿™ä¸ªæ–¹å¼æˆ‘è§åˆ°çš„æ¯”è¾ƒå°‘ï¼Œäº†è§£ä¸€ä¸‹ã€‚ è¾“å‡ºç»“æžœ: 1234567891011122018-03-16 19:56:43.014 [Thread-0] INFO c.c.actual.ThreadCommunication - running2018-03-16 19:56:43.014 [Thread-1] INFO c.c.actual.ThreadCommunication - running22018-03-16 19:56:43.130 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=02018-03-16 19:56:43.132 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=12018-03-16 19:56:43.132 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=22018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=32018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=42018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=52018-03-16 19:56:43.133 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=62018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=72018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=82018-03-16 19:56:43.134 [Thread-1] INFO c.c.actual.ThreadCommunication - msg=9 Java è™½è¯´æ˜¯åŸºäºŽå†…å­˜é€šä¿¡çš„ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ç®¡é“é€šä¿¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥æµå’Œè¾“å‡ºæµéœ€è¦é¦–å…ˆå»ºç«‹è¿žæŽ¥ã€‚è¿™æ ·çº¿ç¨‹ B å°±å¯ä»¥æ”¶åˆ°çº¿ç¨‹ A å‘å‡ºçš„æ¶ˆæ¯äº†ã€‚ åã€æ€»ç»“ å®žé™…å¼€å‘ä¸­å¯ä»¥çµæ´»æ ¹æ®éœ€æ±‚é€‰æ‹©æœ€é€‚åˆçš„çº¿ç¨‹é€šä¿¡æ–¹å¼ã€‚ æ•´ç†è‡ªï¼šæ·±å…¥ç†è§£çº¿ç¨‹é€šä¿¡]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JUCç»„ä»¶æ‹“å±•-BlockingQueue]]></title>
    <url>%2F2019%2F02%2F12%2Fthread%2FJUC%E7%BB%84%E4%BB%B6%E6%8B%93%E5%B1%95-BlockingQueue%2F</url>
    <content type="text"><![CDATA[åœ¨ä¹‹å‰çš„çº¿ç¨‹æ± åŽŸç†ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°åœ¨æ ¸å¿ƒçº¿ç¨‹è¢«å…¨éƒ¨å ç”¨å¹¶ä¸”æ²¡æœ‰ç©ºé—²çº¿ç¨‹çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠåŽç»­çš„çº¿ç¨‹ä»»åŠ¡å…ˆæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ç»“æž„ä¸­ï¼Œç„¶åŽæŒ‰ç…§é˜Ÿåˆ—çš„æ–¹å¼åŽ»æ¶ˆåŒ–ä»»åŠ¡ã€‚è™½ç„¶é˜Ÿåˆ—æœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯ä»–ä»¬éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„åå­—å«åšé˜»å¡žé˜Ÿåˆ—ï¼Œæœ¬æ–‡æ¥é€ä¸ªå‡»ç ´æ­å¼€ä»–ä»¬çš„é¢çº±ã€‚ ä¸€ã€BlockingQueue åœ¨Javaä¸­ï¼ŒBlockingQueueæ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œå®ƒçš„å®žçŽ°ç±»æœ‰ArrayBlockingQueueã€DelayQueueã€ LinkedBlockingDequeã€LinkedBlockingQueueã€PriorityBlockingQueueã€SynchronousQueueç­‰ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“çŽ°åœ¨å­˜å‚¨ç»“æž„ä¸Šæˆ–å¯¹å…ƒç´ æ“ä½œä¸Šçš„ä¸åŒï¼Œä½†æ˜¯å¯¹äºŽtakeä¸Žputæ“ä½œçš„åŽŸç†ï¼Œå´æ˜¯ç±»ä¼¼çš„ã€‚ BlockingQueue æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼ˆQueueï¼‰ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯é˜»å¡žï¼ˆBlockingï¼‰çš„å‘¢ï¼Ÿæ˜¯å› ä¸º BlockingQueue æ”¯æŒå½“èŽ·å–é˜Ÿåˆ—å…ƒç´ ä½†æ˜¯é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä¼šé˜»å¡žç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ å†è¿”å›žï¼›ä¹Ÿæ”¯æŒæ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æžœé˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆç­‰åˆ°é˜Ÿåˆ—å¯ä»¥æ”¾å…¥æ–°å…ƒç´ æ—¶å†æ”¾å…¥ã€‚ add(anObject):æŠŠanObjectåŠ åˆ°BlockingQueueé‡Œ,å³å¦‚æžœBlockingQueueå¯ä»¥å®¹çº³,åˆ™è¿”å›žtrue,å¦åˆ™æŠ›å‡ºå¼‚å¸¸ offer(anObject):è¡¨ç¤ºå¦‚æžœå¯èƒ½çš„è¯,å°†anObjectåŠ åˆ°BlockingQueueé‡Œ,å³å¦‚æžœBlockingQueueå¯ä»¥å®¹çº³,åˆ™è¿”å›žtrue,å¦åˆ™è¿”å›žfalse. â­put(anObject):æŠŠanObjectåŠ åˆ°BlockingQueueé‡Œ,å¦‚æžœBlockQueueæ²¡æœ‰ç©ºé—´,åˆ™è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹è¢«é˜»æ–­ç›´åˆ°BlockingQueueé‡Œé¢æœ‰ç©ºé—´å†ç»§ç»­. â­ä¸Žputç›¸å¯¹åº”çš„æ˜¯take():å–èµ°BlockingQueueé‡ŒæŽ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥BlockingQueueä¸ºç©º,é˜»æ–­è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°Blockingæœ‰æ–°çš„å¯¹è±¡è¢«åŠ å…¥ä¸ºæ­¢ poll(time):å–èµ°BlockingQueueé‡ŒæŽ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥ä¸èƒ½ç«‹å³å–å‡º,åˆ™å¯ä»¥ç­‰timeå‚æ•°è§„å®šçš„æ—¶é—´,å–ä¸åˆ°æ—¶è¿”å›žnull æ³¨æ„ï¼šBlockingQueue ä¸æŽ¥å— null å…ƒç´ ã€‚è¯•å›¾ add ã€ put æˆ– offer ä¸€ä¸ª null å…ƒç´ æ—¶ï¼ŒæŸäº›å®žçŽ°ä¼šæŠ›å‡º NullPointerException ã€‚ null è¢«ç”¨ä½œæŒ‡ç¤º poll æ“ä½œå¤±è´¥çš„è­¦æˆ’å€¼ã€‚ BlockingQueue çš„å„ä¸ªå®žçŽ°éƒ½éµå¾ªäº†è¿™äº›è§„åˆ™ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿä¸ç”¨æ­»è®°è¿™ä¸ªè¡¨æ ¼ï¼ŒçŸ¥é“æœ‰è¿™ä¹ˆå›žäº‹ï¼Œç„¶åŽå†™ä»£ç çš„æ—¶å€™æ ¹æ®è‡ªå·±çš„éœ€è¦åŽ»çœ‹æ–¹æ³•çš„æ³¨é‡Šæ¥é€‰å–åˆé€‚çš„æ–¹æ³•å³å¯ã€‚ ä¸€ä¸ª BlockingQueue å¯èƒ½æ˜¯æœ‰ç•Œçš„ï¼Œå¦‚æžœåœ¨æ’å…¥çš„æ—¶å€™ï¼Œå‘çŽ°é˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆ put æ“ä½œå°†ä¼šé˜»å¡žã€‚é€šå¸¸ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è¯´çš„æ— ç•Œé˜Ÿåˆ—ä¹Ÿä¸æ˜¯è¯´çœŸæ­£çš„æ— ç•Œï¼Œè€Œæ˜¯å®ƒçš„å®¹é‡æ˜¯ Integer.MAX_VALUEï¼ˆ21äº¿å¤šï¼‰ã€‚ BlockingQueue å®žçŽ°ä¸»è¦ç”¨äºŽç”Ÿäº§è€…-æ¶ˆè´¹è€…é˜Ÿåˆ—ï¼Œä½†å®ƒå¦å¤–è¿˜æ”¯æŒCollection æŽ¥å£ã€‚å› æ­¤ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œä½¿ç”¨remove(x) ä»Žé˜Ÿåˆ—ä¸­ç§»é™¤ä»»æ„ä¸€ä¸ªå…ƒç´ æ˜¯æœ‰å¯èƒ½çš„ã€‚ç„¶è€Œï¼Œè¿™ç§æ“ä½œé€šå¸¸ä¸ ä¼šæœ‰æ•ˆæ‰§è¡Œï¼Œåªèƒ½æœ‰è®¡åˆ’åœ°å¶å°”ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨å–æ¶ˆæŽ’é˜Ÿä¿¡æ¯æ—¶ã€‚ BlockingQueue çš„å®žçŽ°éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯æ‰¹é‡çš„é›†åˆæ“ä½œå¦‚ addAll, containsAll, retainAll å’Œ removeAll ä¸ä¸€å®šæ˜¯åŽŸå­æ“ä½œã€‚å¦‚ addAll(c) æœ‰å¯èƒ½åœ¨æ·»åŠ äº†ä¸€äº›å…ƒç´ åŽä¸­é€”æŠ›å‡ºå¼‚å¸¸ï¼Œæ­¤æ—¶ BlockingQueue ä¸­å·²ç»æ·»åŠ äº†éƒ¨åˆ†å…ƒç´ ï¼Œè¿™ä¸ªæ˜¯å…è®¸çš„ï¼Œå–å†³äºŽå…·ä½“çš„å®žçŽ°ã€‚ ä¸‹é¢æ¥çœ‹çœ‹é˜»å¡žé˜Ÿåˆ—çš„å„ç§å…·ä½“çš„å®žçŽ°ç±»ã€‚ äºŒã€ArrayBlockingQueue æž„é€ å‡½æ•°å¿…é¡»å¸¦ä¸€ä¸ªintå‚æ•°æ¥æŒ‡æ˜Žå…¶å¤§å° ä¸€ä¸ªç”±æ•°ç»„ç»“æž„ç»„æˆçš„æœ‰ç•Œé˜»å¡žé˜Ÿåˆ—. æ­¤é˜Ÿåˆ—æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŽŸåˆ™å¯¹å…ƒç´ è¿›è¡ŒæŽ’åº. â­å…¶å¹¶å‘æŽ§åˆ¶é‡‡ç”¨å¯é‡å…¥é”æ¥æŽ§åˆ¶ï¼Œä¸ç®¡æ˜¯æ’å…¥æ“ä½œè¿˜æ˜¯è¯»å–æ“ä½œï¼Œéƒ½éœ€è¦èŽ·å–åˆ°é”æ‰èƒ½è¿›è¡Œæ“ä½œã€‚ â­å¦‚æžœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿™ä¸ªæ—¶å€™è¯»æ“ä½œçš„çº¿ç¨‹è¿›å…¥åˆ°è¯»çº¿ç¨‹é˜Ÿåˆ—æŽ’é˜Ÿï¼Œç­‰å¾…å†™çº¿ç¨‹å†™å…¥æ–°çš„å…ƒç´ ï¼Œç„¶åŽå”¤é†’è¯»çº¿ç¨‹é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚ â­å¦‚æžœé˜Ÿåˆ—å·²æ»¡ï¼Œè¿™ä¸ªæ—¶å€™å†™æ“ä½œçš„çº¿ç¨‹è¿›å…¥åˆ°å†™çº¿ç¨‹é˜Ÿåˆ—æŽ’é˜Ÿï¼Œç­‰å¾…è¯»çº¿ç¨‹å°†é˜Ÿåˆ—å…ƒç´ ç§»é™¤è…¾å‡ºç©ºé—´ï¼Œç„¶åŽå”¤é†’å†™çº¿ç¨‹é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚ æ”¯æŒå…¬å¹³é”å’Œéžå…¬å¹³é”ã€‚å…¬å¹³çš„èŽ·å–é”ï¼Œä¹Ÿå°±æ˜¯å½“å‰ç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹å…ˆèŽ·å–é” ä¸‰ã€LinkedBlockingQueue å¤§å°ä¸å®šçš„BlockingQueue è‹¥å…¶æž„é€ å‡½æ•°å¸¦ä¸€ä¸ªè§„å®šå¤§å°çš„å‚æ•°,ç”Ÿæˆçš„BlockingQueueæœ‰å¤§å°é™åˆ¶ è‹¥ä¸å¸¦å¤§å°å‚æ•°,æ‰€ç”Ÿæˆçš„BlockingQueueçš„å¤§å°ç”±Integer.MAX_VALUEæ¥å†³å®š å…¶æ‰€å«çš„å¯¹è±¡æ˜¯ä»¥FIFO(å…ˆå…¥å…ˆå‡º)é¡ºåºæŽ’åºçš„ â­é“¾æŽ¥é˜Ÿåˆ—çš„åžåé‡é€šå¸¸è¦é«˜äºŽåŸºäºŽæ•°ç»„çš„é˜Ÿåˆ—ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°å¹¶å‘åº”ç”¨ç¨‹åºä¸­ï¼Œå…¶å¯é¢„çŸ¥çš„æ€§èƒ½è¦ä½Ž æœ€æ–°æ’å…¥çš„æ•°æ®åœ¨å°¾éƒ¨ï¼Œæœ€æ–°ç§»é™¤çš„å¯¹è±¡åœ¨å¤´éƒ¨ å››ã€PriorityBlockingQueue â­ç±»ä¼¼äºŽLinkedBlockQueue,ä½†å…¶æ‰€å«å¯¹è±¡çš„æŽ’åºä¸æ˜¯FIFO,è€Œæ˜¯ä¾æ®å¯¹è±¡çš„è‡ªç„¶æŽ’åºé¡ºåºæˆ–è€…æ˜¯æž„é€ å‡½æ•°çš„Comparatorå†³å®šçš„é¡ºåº ä¸€ä¸ªæ— ç•Œçš„é˜»å¡žé˜Ÿåˆ— äº”ã€SynchronousQueue â­å®ƒæ˜¯ä¸€ç§é˜»å¡žé˜Ÿåˆ—ï¼Œå…¶ä¸­æ¯ä¸ª put å¿…é¡»ç­‰å¾…ä¸€ä¸ª takeï¼Œåä¹‹äº¦ç„¶ã€‚ â­åŒæ­¥é˜Ÿåˆ—æ²¡æœ‰ä»»ä½•å†…éƒ¨å®¹é‡ï¼Œç”šè‡³è¿žä¸€ä¸ªé˜Ÿåˆ—çš„å®¹é‡éƒ½æ²¡æœ‰ã€‚ å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ˜¯é˜»å¡žçš„ã€‚ ä¸å…è®¸ä½¿ç”¨ null å…ƒç´ ã€‚ å…¬å¹³æŽ’åºç­–ç•¥æ˜¯æŒ‡è°ƒç”¨ put çš„çº¿ç¨‹ä¹‹é—´ï¼Œæˆ– take çš„çº¿ç¨‹ä¹‹é—´ã€‚ ä¸€ä¸ªæ²¡æœ‰å®¹é‡çš„å¹¶å‘é˜Ÿåˆ—æœ‰ä»€ä¹ˆç”¨äº†ï¼Ÿæˆ–è€…è¯´å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ å°½ç®¡å…ƒç´ åœ¨SynchronousQueue å†…éƒ¨ä¸ä¼šâ€œåœç•™â€ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€SynchronousQueue å†…éƒ¨æ²¡æœ‰é˜Ÿåˆ—ã€‚å®žé™…ä¸ŠSynchronousQueue ç»´æŠ¤ç€çº¿ç¨‹é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯æ’å…¥çº¿ç¨‹æˆ–è€…ç§»é™¤çº¿ç¨‹åœ¨ä¸åŒæ—¶å­˜åœ¨çš„æ—¶å€™å°±ä¼šæœ‰çº¿ç¨‹é˜Ÿåˆ—ã€‚æ—¢ç„¶æœ‰é˜Ÿåˆ—ï¼ŒåŒæ ·å°±æœ‰å…¬å¹³æ€§å’Œéžå…¬å¹³æ€§ç‰¹æ€§ï¼Œå…¬å¹³æ€§ä¿è¯æ­£åœ¨ç­‰å¾…çš„æ’å…¥çº¿ ç¨‹æˆ–è€…ç§»é™¤çº¿ç¨‹ä»¥FIFOçš„é¡ºåºä¼ é€’èµ„æºã€‚ å®ƒæ¨¡æ‹Ÿçš„åŠŸèƒ½ç±»ä¼¼äºŽç”Ÿæ´»ä¸­ä¸€æ‰‹äº¤é’±ä¸€æ‰‹äº¤è´§è¿™ç§æƒ…å½¢ï¼Œåƒé‚£ç§è´§åˆ°ä»˜æ¬¾æˆ–è€…å…ˆä»˜æ¬¾åŽå‘è´§æ¨¡åž‹ä¸é€‚åˆä½¿ç”¨SynchronousQueueã€‚é¦–å…ˆè¦çŸ¥é“SynchronousQueueæ²¡æœ‰å®¹çº³å…ƒç´ çš„èƒ½åŠ›ï¼Œå³å®ƒçš„isEmpty()æ–¹æ³•æ€»æ˜¯è¿”å›žtrueï¼Œä½†æ˜¯ç»™äººçš„æ„Ÿè§‰å´åƒæ˜¯åªèƒ½å®¹çº³ä¸€ä¸ªå…ƒç´ ã€‚ å…­ã€DelayQueue DelayQueue å¯¹å…ƒç´ è¿›è¡ŒæŒæœ‰ç›´åˆ°ä¸€ä¸ªç‰¹å®šçš„å»¶è¿Ÿåˆ°æœŸã€‚æ³¨æ„å…¶ä¸­çš„å…ƒç´ å¿…é¡»å®žçŽ° java.util.concurrent.Delayed æŽ¥å£ã€‚ ä¸ƒã€ç”Ÿäº§è€…ä¸Žæ¶ˆè´¹è€…æ¨¡å¼ é˜»å¡žé˜Ÿåˆ—çš„æœ€å¸¸ä½¿ç”¨çš„ä¾‹å­å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼,ä¹Ÿæ˜¯å„ç§å®žçŽ°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼æ–¹å¼ä¸­é¦–é€‰çš„æ–¹å¼ã€‚ä½¿ç”¨è€…ä¸ç”¨å…³å¿ƒä»€ä¹ˆé˜»å¡žç”Ÿäº§ï¼Œä»€ä¹ˆæ—¶å€™é˜»å¡žæ¶ˆè´¹ï¼Œä½¿ç”¨éžå¸¸æ–¹ä¾¿ã€‚ LinkedBlockingQueueæ¥å®žçŽ°ä¸€ä¸ªç”Ÿäº§è€…ä¸Žæ¶ˆè´¹è€…æ¨¡åž‹ï¼š è¿è¡Œæ•ˆæžœï¼š 12345678producer1 produce 95producer3 produce 36consumer0 consumer 95consumer2 consumer 36producer0 produce 27consumer4 consumer 27producer2 produce 75...... å…«ã€ArrayBlockingQueueå’ŒLinkedBlockingQueueçš„åŒºåˆ« é˜Ÿåˆ—ä¸­é”çš„å®žçŽ°ä¸åŒ ArrayBlockingQueueå®žçŽ°çš„é˜Ÿåˆ—ä¸­çš„é”æ˜¯æ²¡æœ‰åˆ†ç¦»çš„ï¼Œå³ç”Ÿäº§å’Œæ¶ˆè´¹ç”¨çš„æ˜¯åŒä¸€ä¸ªé”ï¼›å¦å¤–ï¼Œå¯ä»¥æŒ‡å®šæ˜¯å¦ä¸ºå…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éžå…¬å¹³é”ã€‚ LinkedBlockingQueueå®žçŽ°çš„é˜Ÿåˆ—ä¸­çš„é”æ˜¯åˆ†ç¦»çš„ï¼Œåœ¨é˜Ÿå¤´å’Œé˜Ÿå°¾å„æŒæœ‰ä¸€æŠŠé”ï¼Œå…¥é˜Ÿå’Œå‡ºé˜Ÿä¹‹é—´ä¸å­˜åœ¨ç«žäº‰ã€‚å³ç”Ÿäº§ç”¨çš„æ˜¯putLockï¼Œæ¶ˆè´¹æ˜¯takeLockï¼Œè¿™ä¹Ÿæ„å‘³ç€åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥å¹¶è¡Œåœ°æ“ä½œé˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œä»¥æ­¤æ¥æé«˜æ•´ä¸ªé˜Ÿåˆ—çš„å¹¶å‘æ€§èƒ½ã€‚ åœ¨ç”Ÿäº§æˆ–æ¶ˆè´¹æ—¶æ“ä½œä¸åŒ ArrayBlockingQueueå®žçŽ°çš„é˜Ÿåˆ—ä¸­åœ¨ç”Ÿäº§å’Œæ¶ˆè´¹çš„æ—¶å€™ï¼Œæ˜¯ç›´æŽ¥å°†æžšä¸¾å¯¹è±¡æ’å…¥æˆ–ç§»é™¤çš„ï¼› LinkedBlockingQueueå®žçŽ°çš„é˜Ÿåˆ—ä¸­åœ¨ç”Ÿäº§å’Œæ¶ˆè´¹çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæžšä¸¾å¯¹è±¡è½¬æ¢ä¸ºNode&lt;E&gt;è¿›è¡Œæ’å…¥æˆ–ç§»å‡º(ä¼šç”Ÿæˆä¸€ä¸ªé¢å¤–çš„Nodeå¯¹è±¡ï¼Œè¿™åœ¨é•¿æ—¶é—´å†…éœ€è¦é«˜æ•ˆå¹¶å‘åœ°å¤„ç†å¤§æ‰¹é‡æ•°æ®çš„ç³»ç»Ÿä¸­ï¼Œå…¶å¯¹äºŽGCçš„å½±å“è¿˜æ˜¯å­˜åœ¨ä¸€å®šçš„åŒºåˆ«ã€‚) é˜Ÿåˆ—å¤§å°åˆå§‹åŒ–æ–¹å¼ä¸åŒ ArrayBlockingQueueå®žçŽ°çš„é˜Ÿåˆ—ä¸­å¿…é¡»æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°ï¼› LinkedBlockingQueueå®žçŽ°çš„é˜Ÿåˆ—ä¸­å¯ä»¥ä¸æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°ï¼Œä½†æ˜¯é»˜è®¤æ˜¯Integer.MAX_VALUE ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœæž„é€ ä¸€ä¸ªLinkedBlockingQueueå¯¹è±¡ï¼Œè€Œæ²¡æœ‰æŒ‡å®šå…¶å®¹é‡å¤§å°ï¼ŒLinkedBlockingQueueä¼šé»˜è®¤ä¸€ä¸ªç±»ä¼¼æ— é™å¤§å°çš„å®¹é‡ï¼ˆInteger.MAX_VALUEï¼‰ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æžœç”Ÿäº§è€…çš„é€Ÿåº¦ä¸€æ—¦å¤§äºŽæ¶ˆè´¹è€…çš„é€Ÿåº¦ï¼Œä¹Ÿè®¸è¿˜æ²¡æœ‰ç­‰åˆ°é˜Ÿåˆ—æ»¡é˜»å¡žäº§ç”Ÿï¼Œç³»ç»Ÿå†…å­˜å°±æœ‰å¯èƒ½å·²è¢«æ¶ˆè€—æ®†å°½äº†ã€‚ åœ¨ä½¿ç”¨ArrayBlockingQueueå’ŒLinkedBlockingQueueåˆ†åˆ«å¯¹1000000ä¸ªç®€å•å­—ç¬¦åšå…¥é˜Ÿæ“ä½œæ—¶ï¼ŒLinkedBlockingQueueçš„æ¶ˆè€—æ˜¯ArrayBlockingQueueæ¶ˆè€—çš„10å€å·¦å³ï¼Œå³LinkedBlockingQueueæ¶ˆè€—åœ¨1500æ¯«ç§’å·¦å³ï¼Œè€ŒArrayBlockingQueueåªéœ€150æ¯«ç§’å·¦å³ã€‚ æŒ‰ç…§å®žçŽ°åŽŸç†æ¥åˆ†æžï¼ŒArrayBlockingQueueå®Œå…¨å¯ä»¥é‡‡ç”¨åˆ†ç¦»é”ï¼Œä»Žè€Œå®žçŽ°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ“ä½œçš„å®Œå…¨å¹¶è¡Œè¿è¡Œã€‚Doug Leaä¹‹æ‰€ä»¥æ²¡è¿™æ ·åŽ»åšï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºArrayBlockingQueueçš„æ•°æ®å†™å…¥å’ŒèŽ·å–æ“ä½œå·²ç»è¶³å¤Ÿè½»å·§ï¼Œä»¥è‡³äºŽå¼•å…¥ç‹¬ç«‹çš„é”æœºåˆ¶ï¼Œé™¤äº†ç»™ä»£ç å¸¦æ¥é¢å¤–çš„å¤æ‚æ€§å¤–ï¼Œå…¶åœ¨æ€§èƒ½ä¸Šå®Œå…¨å ä¸åˆ°ä»»ä½•ä¾¿å®œã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JUCç»„ä»¶æ‹“å±•-ForkJoinç®€ä»‹]]></title>
    <url>%2F2019%2F02%2F12%2Fthread%2FJUC%E7%BB%84%E4%BB%B6%E6%8B%93%E5%B1%95-ForkJoin%E7%AE%80%E4%BB%8B%2F</url>
    <content type="text"><![CDATA[JUCç»„ä»¶æ‹“å±•-ForkJoinç®€ä»‹ï¼Œæœ¬æ–‡åªæ˜¯åˆæ­¥è®¤è¯†è®¤è¯†ä¸€ä¸‹ForkJoinæ˜¯ä»€ä¹ˆï¼Œä¸æ·±ç©¶é‡Œé¢çš„åŽŸç†ã€‚ ForkJoin ä»€ä¹ˆæ˜¯Fork/Joinæ¡†æž¶ Fork/Joinæ¡†æž¶æ˜¯Java7æä¾›äº†çš„ä¸€ä¸ªç”¨äºŽå¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„æ¡†æž¶ï¼Œ æ˜¯ä¸€ä¸ªæŠŠå¤§ä»»åŠ¡åˆ†å‰²æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼Œæœ€ç»ˆæ±‡æ€»æ¯ä¸ªå°ä»»åŠ¡ç»“æžœåŽå¾—åˆ°å¤§ä»»åŠ¡ç»“æžœçš„æ¡†æž¶ã€‚ æˆ‘ä»¬å†é€šè¿‡Forkå’ŒJoinè¿™ä¸¤ä¸ªå•è¯æ¥ç†è§£ä¸‹Fork/Joinæ¡†æž¶ï¼ŒForkå°±æ˜¯æŠŠä¸€ä¸ªå¤§ä»»åŠ¡åˆ‡åˆ†ä¸ºè‹¥å¹²å­ä»»åŠ¡å¹¶è¡Œçš„æ‰§è¡Œï¼ŒJoinå°±æ˜¯åˆå¹¶è¿™äº›å­ä»»åŠ¡çš„æ‰§è¡Œç»“æžœï¼Œæœ€åŽå¾—åˆ°è¿™ä¸ªå¤§ä»»åŠ¡çš„ç»“æžœã€‚æ¯”å¦‚è®¡ç®—1+2+ã€‚ã€‚ï¼‹10000ï¼Œå¯ä»¥åˆ†å‰²æˆ10ä¸ªå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡åˆ†åˆ«å¯¹1000ä¸ªæ•°è¿›è¡Œæ±‚å’Œï¼Œæœ€ç»ˆæ±‡æ€»è¿™10ä¸ªå­ä»»åŠ¡çš„ç»“æžœã€‚ å·¥ä½œçªƒå–ç®—æ³• å·¥ä½œçªƒå–ï¼ˆwork-stealingï¼‰ç®—æ³•æ˜¯æŒ‡æŸä¸ªçº¿ç¨‹ä»Žå…¶ä»–é˜Ÿåˆ—é‡Œçªƒå–ä»»åŠ¡æ¥æ‰§è¡Œã€‚å·¥ä½œçªƒå–çš„è¿è¡Œæµç¨‹å›¾å¦‚ä¸‹ï¼š é‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å·¥ä½œçªƒå–ç®—æ³•å‘¢ï¼Ÿ å‡å¦‚æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªä»»åŠ¡åˆ†å‰²ä¸ºè‹¥å¹²äº’ä¸ä¾èµ–çš„å­ä»»åŠ¡ï¼Œä¸ºäº†å‡å°‘çº¿ç¨‹é—´çš„ç«žäº‰ï¼ŒäºŽæ˜¯æŠŠè¿™äº›å­ä»»åŠ¡åˆ†åˆ«æ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—é‡Œï¼Œå¹¶ä¸ºæ¯ä¸ªé˜Ÿåˆ—åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œçº¿ç¨‹å’Œé˜Ÿåˆ—ä¸€ä¸€å¯¹åº”ï¼Œæ¯”å¦‚Açº¿ç¨‹è´Ÿè´£å¤„ç†Aé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚ä½†æ˜¯æœ‰çš„çº¿ç¨‹ä¼šå…ˆæŠŠè‡ªå·±é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡å¹²å®Œï¼Œè€Œå…¶ä»–çº¿ç¨‹å¯¹åº”çš„é˜Ÿåˆ—é‡Œè¿˜æœ‰ä»»åŠ¡ç­‰å¾…å¤„ç†ã€‚å¹²å®Œæ´»çš„çº¿ç¨‹ä¸Žå…¶ç­‰ç€ï¼Œä¸å¦‚åŽ»å¸®å…¶ä»–çº¿ç¨‹å¹²æ´»ï¼ŒäºŽæ˜¯å®ƒå°±åŽ»å…¶ä»–çº¿ç¨‹çš„é˜Ÿåˆ—é‡Œçªƒå–ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚ Fork/Joinæ¡†æž¶å¦‚ä½•å®žçŽ°å·¥ä½œçªƒå–çš„ï¼Ÿ è¿™æ—¶å®ƒä»¬ä¼šè®¿é—®åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸ºäº†å‡å°‘çªƒå–ä»»åŠ¡çº¿ç¨‹å’Œè¢«çªƒå–ä»»åŠ¡çº¿ç¨‹ä¹‹é—´çš„ç«žäº‰ï¼Œé€šå¸¸ä¼šä½¿ç”¨åŒç«¯é˜Ÿåˆ—ï¼Œè¢«çªƒå–ä»»åŠ¡çº¿ç¨‹æ°¸è¿œä»ŽåŒç«¯é˜Ÿåˆ—çš„å¤´éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œï¼Œè€Œçªƒå–ä»»åŠ¡çš„çº¿ç¨‹æ°¸è¿œä»ŽåŒç«¯é˜Ÿåˆ—çš„å°¾éƒ¨æ‹¿ä»»åŠ¡æ‰§è¡Œã€‚ Fork/Joinæ¡†æž¶æœ‰æ²¡æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ å·¥ä½œçªƒå–ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å……åˆ†åˆ©ç”¨çº¿ç¨‹è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå¹¶å‡å°‘äº†çº¿ç¨‹é—´çš„ç«žäº‰ï¼Œå…¶ç¼ºç‚¹æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹è¿˜æ˜¯å­˜åœ¨ç«žäº‰ï¼Œæ¯”å¦‚åŒç«¯é˜Ÿåˆ—é‡Œåªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶ã€‚å¹¶ä¸”æ¶ˆè€—äº†æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚åˆ›å»ºå¤šä¸ªçº¿ç¨‹å’Œå¤šä¸ªåŒç«¯é˜Ÿåˆ—ã€‚ è¯¥å¦‚ä½•è®¾è®¡ä¸€ä¸ªFork/Joinæ¡†æž¶? ç¬¬ä¸€æ­¥åˆ†å‰²ä»»åŠ¡ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªforkç±»æ¥æŠŠå¤§ä»»åŠ¡åˆ†å‰²æˆå­ä»»åŠ¡ï¼Œæœ‰å¯èƒ½å­ä»»åŠ¡è¿˜æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸åœçš„åˆ†å‰²ï¼Œç›´åˆ°åˆ†å‰²å‡ºçš„å­ä»»åŠ¡è¶³å¤Ÿå°ã€‚ ç¬¬äºŒæ­¥æ‰§è¡Œä»»åŠ¡å¹¶åˆå¹¶ç»“æžœã€‚åˆ†å‰²çš„å­ä»»åŠ¡åˆ†åˆ«æ”¾åœ¨åŒç«¯é˜Ÿåˆ—é‡Œï¼Œç„¶åŽå‡ ä¸ªå¯åŠ¨çº¿ç¨‹åˆ†åˆ«ä»ŽåŒç«¯é˜Ÿåˆ—é‡ŒèŽ·å–ä»»åŠ¡æ‰§è¡Œã€‚å­ä»»åŠ¡æ‰§è¡Œå®Œçš„ç»“æžœéƒ½ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä»Žé˜Ÿåˆ—é‡Œæ‹¿æ•°æ®ï¼Œç„¶åŽåˆå¹¶è¿™äº›æ•°æ®ã€‚ è¿™é‡Œå°±å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œå¦‚æžœæœ‰å¿…è¦ï¼Œä»¥åŽå†ç»†è°ˆã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AQSå®žçŽ°çš„ä¸€äº›å¹¶å‘å·¥å…·ç±»]]></title>
    <url>%2F2019%2F02%2F12%2Fthread%2FAQS%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB%2F</url>
    <content type="text"><![CDATA[åœ¨å‰é¢æˆ‘ä»¬å·²ç»æ·±å…¥äº†è§£äº†AQSåŽŸç†ï¼Œæœ¬èŠ‚ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„åŸºäºŽAQSå®žçŽ°çš„å¹¶å‘å·¥å…·ç±»ã€‚ ä¸€ã€CountDownLatch è®¡æ•°å™¨å‡åˆ°0ï¼Œå¤„äºŽç­‰å¾…çš„çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚åªèƒ½ç”¨ä¸€æ¬¡ï¼Œä¸èƒ½é‡ç½®ã€‚ æ¯”å¦‚æœ‰ä¸€ä¸ªè¿ç®—é‡å¾ˆå¤§çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒæ‹†åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼Œç­‰æ‰€æœ‰å­ä»»åŠ¡å…¨éƒ¨å®Œæˆä¹‹åŽï¼Œå†æ‰§è¡Œæœ€åŽçš„æ±‡æ€»å·¥ä½œã€‚ ä¸‹é¢ç”¨ä¸€ä¸ªå®žä¾‹æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š è¿è¡Œç»“æžœï¼Œæˆªå–äº†æœ€åŽä¸€ç‚¹ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸»ç¨‹åºç­‰å¾…æ‰€æœ‰çš„å­ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œå†æ‰§è¡Œï¼Œå®ƒæ˜¯é€šè¿‡await()é˜»å¡žç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å‡åˆ°0ä¸ºæ­¢ã€‚ é‚£å¦‚æžœæ˜¯è¿™ç§åœºæ™¯å‘¢ï¼šè®¡ç®—è‹¥å¹²ä¸ªå­ä»»åŠ¡ï¼Œç»™å®šä¸€ä¸ªæ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´çš„è¯ï¼Œå°±æŠŠè¿™ä¸ªä»»åŠ¡æ”¾å¼ƒæŽ‰ã€‚ 1countDownLatch.await(10, TimeUnit.MILLISECONDS); äºŒã€Semaphore èƒ½æŽ§åˆ¶åŒä¸€æ—¶é—´å¹¶å‘çº¿ç¨‹çš„æ•°ç›® Semaphoreï¼ˆä¿¡å·é‡ï¼‰æ˜¯ç”¨æ¥æŽ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œå®ƒé€šè¿‡åè°ƒå„ä¸ªçº¿ç¨‹ï¼Œä»¥ä¿è¯åˆç†çš„ä½¿ç”¨å…¬å…±èµ„æºã€‚å¾ˆå¤šå¹´ä»¥æ¥ï¼Œæˆ‘éƒ½è§‰å¾—ä»Žå­—é¢ä¸Šå¾ˆéš¾ç†è§£Semaphoreæ‰€è¡¨è¾¾çš„å«ä¹‰ï¼Œåªèƒ½æŠŠå®ƒæ¯”ä½œæ˜¯æŽ§åˆ¶æµé‡çš„çº¢ç»¿ç¯ï¼Œæ¯”å¦‚XXé©¬è·¯è¦é™åˆ¶æµé‡ï¼Œåªå…è®¸åŒæ—¶æœ‰ä¸€ç™¾è¾†è½¦åœ¨è¿™æ¡è·¯ä¸Šè¡Œä½¿ï¼Œå…¶ä»–çš„éƒ½å¿…é¡»åœ¨è·¯å£ç­‰å¾…ï¼Œæ‰€ä»¥å‰ä¸€ç™¾è¾†è½¦ä¼šçœ‹åˆ°ç»¿ç¯ï¼Œå¯ä»¥å¼€è¿›è¿™æ¡é©¬è·¯ï¼ŒåŽé¢çš„è½¦ä¼šçœ‹åˆ°çº¢ç¯ï¼Œä¸èƒ½é©¶å…¥XXé©¬è·¯ï¼Œä½†æ˜¯å¦‚æžœå‰ä¸€ç™¾è¾†ä¸­æœ‰äº”è¾†è½¦å·²ç»ç¦»å¼€äº†XXé©¬è·¯ï¼Œé‚£ä¹ˆåŽé¢å°±å…è®¸æœ‰5è¾†è½¦é©¶å…¥é©¬è·¯ï¼Œè¿™ä¸ªä¾‹å­é‡Œè¯´çš„è½¦å°±æ˜¯çº¿ç¨‹ï¼Œé©¶å…¥é©¬è·¯å°±è¡¨ç¤ºçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œç¦»å¼€é©¬è·¯å°±è¡¨ç¤ºçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œçœ‹è§çº¢ç¯å°±è¡¨ç¤ºçº¿ç¨‹è¢«é˜»å¡žï¼Œä¸èƒ½æ‰§è¡Œã€‚ Semaphoreå¯ä»¥ç”¨äºŽåšæµé‡æŽ§åˆ¶ï¼Œç‰¹åˆ«å…¬ç”¨èµ„æºæœ‰é™çš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚æ•°æ®åº“è¿žæŽ¥ã€‚å‡å¦‚æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œè¦è¯»å–å‡ ä¸‡ä¸ªæ–‡ä»¶çš„æ•°æ®ï¼Œå› ä¸ºéƒ½æ˜¯IOå¯†é›†åž‹ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨å‡ åä¸ªçº¿ç¨‹å¹¶å‘çš„è¯»å–ï¼Œä½†æ˜¯å¦‚æžœè¯»åˆ°å†…å­˜åŽï¼Œè¿˜éœ€è¦å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œæ•°æ®åº“çš„è¿žæŽ¥æ•°åªæœ‰10ä¸ªï¼Œè¿™æ—¶æˆ‘ä»¬å¿…é¡»æŽ§åˆ¶åªæœ‰åä¸ªçº¿ç¨‹åŒæ—¶èŽ·å–æ•°æ®åº“è¿žæŽ¥ä¿å­˜æ•°æ®ï¼Œå¦åˆ™ä¼šæŠ¥é”™æ— æ³•èŽ·å–æ•°æ®åº“è¿žæŽ¥ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Semaphoreæ¥åšæµæŽ§ï¼Œä»£ç å¦‚ä¸‹ï¼š å†æ¥ä¸€ä¸ªä¾‹å­ï¼š è¿™é‡Œæ˜¯ä¸€ä¸ªçº¿ç¨‹èŽ·å–ä¸€ä¸ªè®¸å¯ï¼Œé‚£ä¹ˆåŒä¸€æ—¶é—´ï¼Œå¯ä»¥æœ‰ä¸‰ä¸ªçº¿ç¨‹è¿›æ¥ä¸€èµ·å·¥ä½œã€‚é‚£å¦‚æžœæˆ‘æ”¹æˆä¸€ä¸ªçº¿ç¨‹èŽ·å–ä¸‰ä¸ªè®¸å¯å‘¢ï¼Ÿå°±åƒä¸€ä¸ªäººåŒæ—¶å ä¸‰ä¸ªå‘ä½ï¼Œé‚£ä¹ˆåªæœ‰ç­‰è¿™ä¸ªäººæ‹‰å®Œäº†æ‰èƒ½è½®åˆ°ä¸‹ä¸€ä¸ªäººäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±å˜æˆè·Ÿå•çº¿ç¨‹ä¸€æ ·äº†ã€‚ 123semaphore.acquire(3);test(threadNum);semaphore.release(3); è€ƒè™‘è¿™ä¸ªåœºæ™¯ï¼šå¹¶å‘å¤ªé«˜äº†ï¼Œå°±ç®—æ˜¯æŽ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œä¹Ÿæ¯”è¾ƒæ£˜æ‰‹ï¼›ä¸€ä¸ªåŽ•æ‰€ä¸‰ä¸ªå‘ä½ï¼Œå¤–é¢äººå¤ªå¤šäº†ï¼Œè®©ä¸‰ä¸ªäººè¿›æ¥ï¼Œå…¶ä»–çš„éƒ½ç»™è½°èµ°ã€‚å¦‚ä½•åšåˆ°å‘¢ï¼Ÿ 1234if(semaphore.tryAcquire())&#123;//å°è¯•èŽ·å–ä¸€ä¸ªè®¸å¯ test(threadNum); semaphore.release();&#125; è¾“å‡ºç»“æžœï¼šåªæœ‰ä¸‰æ¡ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œå…¶ä»–çš„çº¿ç¨‹å°±éƒ½è¢«ä¸¢å¼ƒäº†ã€‚ ä¹Ÿå¯ä»¥ç»™ä»–ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¿™é‡Œæ˜¯5000æ¯«ç§’ã€‚æ¯ä¸ªå‘½ä»¤éœ€è¦è¿è¡Œ1000æ¯«ç§’ï¼Œé‚£ä¹ˆç¨‹åºç­‰1000æ¯«ç§’ä¹‹åŽä¼šæ‰“å°ä¸‰æ¡ï¼›ç„¶åŽå†ç­‰1000æ¯«ç§’ï¼Œåˆå¯ä»¥æ‹¿åˆ°æ–°çš„ä¸‰ä¸ªè®¸å¯ï¼Œå†æ‰“å°ä¸‰æ¡ï¼›ç›´åˆ°5000æ¯«ç§’ç”¨å®Œã€‚å¯èƒ½ä¼šæ‰“å°3*5æ¡è®°å½•ã€‚å‰©ä¸‹çš„5æ¡è®°å½•ç”±äºŽå·²ç»è¶…æ—¶ï¼Œå…¨éƒ¨è¢«æ”¾å¼ƒæŽ‰ã€‚ ä¸‰ã€CyclicBarrier CyclicBarrierä¹Ÿæ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±» , å®ƒå…è®¸ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾… , ç›´åˆ°åˆ°è¾¾æŸä¸ªå…¬å…±çš„å±éšœç‚¹ , é€šè¿‡å®ƒå¯ä»¥å®Œæˆå¤šä¸ªçº¿ç¨‹ä¹‹é—´ç›¸äº’ç­‰å¾… ,åªæœ‰å½“æ¯ä¸ªçº¿ç¨‹éƒ½å‡†å¤‡å¥½ä¹‹åŽ, æ‰èƒ½å„è‡ªç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŽç»­çš„æ“ä½œ, å’Œ CountDownLatchç›¸ä¼¼çš„åœ°æ–¹å°±æ˜¯, å®ƒä¹Ÿæ˜¯é€šè¿‡è®¡æ•°å™¨æ¥å®žçŽ°çš„. å½“æŸä¸ªçº¿ç¨‹è°ƒç”¨äº† await()æ–¹æ³•ä¹‹åŽ, è¯¥çº¿ç¨‹å°±è¿›å…¥äº†ç­‰å¾…çŠ¶æ€ . è€Œä¸”è®¡æ•°å™¨å°±è¿›è¡Œ -1 æ“ä½œ , å½“è®¡æ•°å™¨çš„å€¼è¾¾åˆ°äº†æˆ‘ä»¬è®¾ç½®çš„åˆå§‹å€¼0çš„æ—¶å€™ , ä¹‹å‰è°ƒç”¨äº†await() æ–¹æ³•è€Œè¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ç»§ç»­æ‰§è¡ŒåŽç»­çš„æ“ä½œ. å› ä¸º CyclicBarrieré‡Šæ”¾çº¿ç¨‹ä¹‹åŽå¯ä»¥é‡ç”¨, æ‰€ä»¥åˆç§°ä¹‹ä¸ºå¾ªçŽ¯å±éšœ . CyclicBarrier ä½¿ç”¨åœºæ™¯å’Œ CountDownLatch å¾ˆç›¸ä¼¼ , å¯ä»¥ç”¨äºŽå¤šçº¿ç¨‹è®¡ç®—æ•°æ®, æœ€åŽåˆå¹¶è®¡ç®—ç»“æžœçš„åº”ç”¨åœºæ™¯ . ä¸¤è€…çš„åŒºåˆ«ï¼š CountDownLatchçš„è®¡æ•°å™¨åªèƒ½ä½¿ç”¨ä¸€æ¬¡ , è€Œ CyclicBarrier çš„è®¡æ•°å™¨å¯ä»¥ä½¿ç”¨ reseté‡ç½® å¾ªçŽ¯ä½¿ç”¨ CountDownLatch ä¸»è¦æ˜¯ 1 ä¸ª æˆ–è€… n ä¸ªçº¿ç¨‹éœ€è¦ç­‰å¾…å…¶å®ƒçº¿ç¨‹å®ŒæˆæŸé¡¹æ“ä½œä¹‹åŽæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œ , å…¶æè¿°çš„æ˜¯ 1 ä¸ª æˆ–è€… n ä¸ªçº¿ç¨‹ä¸Žå…¶å®ƒçº¿ç¨‹çš„å…³ç³» ; CyclicBarrier ä¸»è¦æ˜¯å®žçŽ°äº† 1 ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ä¹‹é—´ç›¸äº’ç­‰å¾…,ç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ»¡è¶³æ¡ä»¶ä¹‹åŽ, æ‰æ‰§è¡ŒåŽç»­çš„æ“ä½œ , å…¶æè¿°çš„æ˜¯å†…éƒ¨å„ä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…çš„å…³ç³» . CyclicBarrier å‡å¦‚æœ‰ 5 ä¸ªçº¿ç¨‹éƒ½è°ƒç”¨äº† await() æ–¹æ³• , é‚£è¿™ä¸ª 5 ä¸ªçº¿ç¨‹å°±ç­‰ç€ , å½“è¿™ 5 ä¸ªçº¿ç¨‹éƒ½å‡†å¤‡å¥½ä¹‹åŽ, å®ƒä»¬æœ‰å„è‡ªå¾€ä¸‹ç»§ç»­æ‰§è¡Œ , å¦‚æžœè¿™ 5 ä¸ªçº¿ç¨‹åœ¨åŽç»­æœ‰ä¸€ä¸ªè®¡ç®—å‘ç”Ÿé”™è¯¯äº† , è¿™é‡Œå¯ä»¥é‡ç½®è®¡æ•°å™¨ , å¹¶è®©è¿™ 5 ä¸ªçº¿ç¨‹å†æ‰§è¡Œä¸€é . è¿è¡Œæ•ˆæžœï¼šå…ˆæ¯éš”ä¸€ç§’æ‰§è¡Œraceæ–¹æ³•æ‰“å°å‡ºready,ç­‰3ä¸ªçº¿ç¨‹æ‰“å°å®Œæ¯•ï¼Œç«‹å³éƒ½å°†é˜»å¡žçš„log.info(&quot;continue...&quot;);å…¨éƒ¨æ‰“å°å‡ºæ¥ã€‚ ä¹Ÿå¯ä»¥è®¾å®šè¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´äº†å°±ä¸ç­‰äº†ã€‚ å¦‚æžœåœ¨å¤§å®¶å·²ç»éƒ½å‡†å¤‡å¥½äº†çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆåšä¸€ä»¶äº‹æƒ…ï¼Œå³åˆå§‹åŒ–æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥åœ¨å£°æ˜ŽCyclicBarrieråŽé¢å¢žåŠ ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚ å°±åƒå¼€ä¼šï¼Œäººéƒ½åˆ°é½äº†ä¹‹åŽï¼Œæˆ‘ä»¬å–Šä¸€å£°ï¼Œäººéƒ½åˆ°é½ï¼Œæˆ‘ä»¬çŽ°åœ¨å¼€å§‹å¼€ä¼šäº†å•Šã€‚ä¸‹é¢å°±å¼€å§‹æ­£å¼å¼€ä¼šã€‚ 123private static CyclicBarrier cyclicBarrier = new CyclicBarrier(5,() -&gt; &#123; log.info("callback is running...");&#125;); å››ã€Exchanger Exchanger ç±»è¡¨ç¤ºä¸€ç§ä¼šåˆç‚¹ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯ä»¥åœ¨è¿™é‡Œäº¤æ¢å¯¹è±¡ã€‚ä¸¤ä¸ªçº¿ç¨‹å„è‡ªè°ƒç”¨exchange æ–¹æ³•è¿›è¡Œäº¤æ¢ï¼Œå½“çº¿ç¨‹ A è°ƒç”¨ Exchange å¯¹è±¡çš„ exchange æ–¹æ³•åŽï¼Œå®ƒä¼šé™·å…¥é˜»å¡žçŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹ B ä¹Ÿè°ƒç”¨äº† exchange æ–¹æ³•ï¼Œç„¶åŽä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼äº¤æ¢æ•°æ®ï¼Œä¹‹åŽçº¿ç¨‹ A å’Œ B ç»§ç»­è¿è¡Œã€‚ exchange æ–¹æ³•æœ‰ä¸¤ä¸ªé‡è½½å®žçŽ°ï¼Œåœ¨äº¤æ¢æ•°æ®çš„æ—¶å€™è¿˜å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚å¦‚æžœä¸€ä¸ªçº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¸Žä¹‹äº¤æ¢æ•°æ®ï¼Œå°±ä¼šæŠ›å‡º TimeoutException è¶…æ—¶å¼‚å¸¸ã€‚å¦‚æžœæ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œåˆ™ä¼šä¸€ç›´ç­‰å¾…ã€‚ 12345//äº¤æ¢æ•°æ®ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´public V exchange(V x, long timeout, TimeUnit unit)throws InterruptedException, TimeoutException//äº¤æ¢æ•°æ®public V exchange(V x) throws InterruptedException ä¸‹é¢çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼š æˆ‘ä»¬è¦æ³¨æ„ï¼Œäº¤æ¢çš„æ—¶å€™ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶åˆ°è¾¾ä¸€ä¸ªæ±‡åˆç‚¹æ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œå³è¿™é‡Œçš„açº¿ç¨‹æ‹¿åˆ°bçº¿ç¨‹çš„å€¼å¹¶ä¸”bæ‹¿åˆ°açš„å€¼ï¼Œç¨‹åºæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ ä¾‹å­å¾ˆç®€å•ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾è°ƒç”¨exchangeæ–¹æ³•çš„åŒæ­¥ç‚¹çš„æ—¶å€™ï¼Œä¸¤ä¸ªçº¿ç¨‹å°±èƒ½äº¤æ¢å½¼æ­¤çš„æ•°æ®ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹æ± åŽŸç†è¯¦è§£]]></title>
    <url>%2F2019%2F02%2F12%2Fthread%2F%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[JAVAå¸®åŠ©å¼€å‘è€…å°è£…äº†ä¸€äº›çŽ°æˆçš„çº¿ç¨‹æ± è°ƒç”¨ï¼Œä½†æ˜¯æ¯ç§çº¿ç¨‹æ± éƒ½æœ‰è‡ªå·±çš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚æžœä¸äº†è§£é‡Œé¢çš„åŽŸç†ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“æŽ‰è¿›å‘é‡Œï¼Œçº¿ç¨‹æ± åŽŸç†ä¹Ÿæ˜¯é¢è¯•çš„é‡ç¾åŒºï¼Œå› æ­¤æœ¬é—®å°†å®Œæ•´åˆ†æžçº¿ç¨‹æ± çš„åŽŸç†ã€‚ ä¸€ã€new threadå¼Šç«¯ ä»Žå­¦ä¹ javaå¤šçº¿ç¨‹å¼€å§‹ï¼Œæˆ‘ä»¬å°±å­¦ä¹ äº†ç”¨new threadæ¥åˆ›å»ºçº¿ç¨‹ã€‚ä½†æ˜¯ä»–æœ‰ä¸€å®šçš„å¼Šç«¯ï¼š æ¯æ¬¡new Threadæ–°å»ºå¯¹è±¡ï¼Œæ€§èƒ½å·® çº¿ç¨‹ç¼ºä¹ç»Ÿä¸€ç®¡ç†ï¼Œå¯èƒ½æ— é™åˆ¶çš„æ–°å»ºçº¿ç¨‹ï¼Œç›¸äº’ç«žäº‰ï¼Œæœ‰å¯èƒ½å ç”¨è¿‡å¤šç³»ç»Ÿèµ„æºå¯¼è‡´æ­»æœºæˆ–OOM ç¼ºå°‘æ›´å¤šåŠŸèƒ½ï¼Œå¦‚æ›´å¤šæ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­ äºŒã€çº¿ç¨‹æ± å¥½å¤„ é‡ç”¨å­˜åœ¨çš„çº¿ç¨‹ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºã€æ¶ˆäº¡çš„å¼€é”€ï¼Œæ€§èƒ½ä½³ å¯æœ‰æ•ˆæŽ§åˆ¶æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨çŽ‡ï¼ŒåŒæ—¶å¯ä»¥é¿å…è¿‡å¤šèµ„æºç«žäº‰ï¼Œé¿å…é˜»å¡ž æä¾›å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€å•çº¿ç¨‹ã€å¹¶å‘æ•°æŽ§åˆ¶ç­‰åŠŸèƒ½ ä¸‰ã€çº¿ç¨‹æ± ç›¸å…³å‚æ•° 1234567public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) corePoolSize:æ ¸å¿ƒçº¿ç¨‹æ•°é‡ é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åŽï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼Œ ï¼ˆé™¤éžè°ƒç”¨prestartAllCoreThreads()å’ŒprestartCoreThread()æ–¹æ³•ï¼Œä»Žæ–¹æ³•åå­—å¯ä»¥çœ‹å‡ºï¼Œæ˜¯é¢„åˆ›å»ºçº¿ç¨‹çš„æ„æ€ï¼Œå³åœ¨æ²¡æœ‰ä»»åŠ¡åˆ°æ¥ä¹‹å‰ï¼Œå°±åˆ›å»ºcorePoolSizeä¸ªçº¿ç¨‹æˆ–1ä¸ªçº¿ç¨‹ï¼‰å½“æœ‰ä»»åŠ¡æ¥ä¹‹åŽï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹åŽ»æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°corePoolSizeåŽï¼Œå°±ä¼šæŠŠåˆ°è¾¾çš„ä»»åŠ¡æ”¾åˆ°ç¼“å­˜é˜Ÿåˆ—å½“ä¸­ï¼› å½“æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå³ä½¿å…¶ä»–ç©ºé—²çš„åŸºæœ¬çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°ä»»åŠ¡ä¹Ÿä¼šåˆ›å»ºçº¿ç¨‹ï¼Œç­‰åˆ°éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°å¤§äºŽçº¿ç¨‹æ± åŸºæœ¬å¤§å°æ—¶å°±ä¸å†åˆ›å»ºã€‚ maximumPoolSize:çº¿ç¨‹æœ€å¤§çº¿ç¨‹æ•° çº¿ç¨‹æ± ä¸­çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œè¡¨ç¤ºçº¿ç¨‹æ± ä¸­æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ã€‚ è¶…è¿‡å°±æ‰§è¡Œrejectç­–ç•¥:å¦‚æžœé˜Ÿåˆ—æ»¡äº†,å¹¶ä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºŽæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™çº¿ç¨‹æ± ä¼šå†åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ workQueue:é˜»å¡žé˜Ÿåˆ—ï¼Œå­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¾ˆé‡è¦ï¼Œä¼šå¯¹çº¿ç¨‹æ± è¿è¡Œè¿‡ç¨‹äº§ç”Ÿé‡å¤§å½±å“ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š ArrayBlockingQueueï¼šæ˜¯ä¸€ä¸ªåŸºäºŽæ•°ç»„ç»“æž„çš„æœ‰ç•Œé˜»å¡žé˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŽŸåˆ™å¯¹å…ƒç´ è¿›è¡ŒæŽ’åºï¼› LinkedBlockingQueueï¼šä¸€ä¸ªåŸºäºŽé“¾è¡¨ç»“æž„çš„é˜»å¡žé˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰FIFO ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ æŽ’åºå…ƒç´ ï¼Œåžåé‡é€šå¸¸è¦é«˜äºŽArrayBlockingQueueã€‚é™æ€å·¥åŽ‚æ–¹æ³•Executors.newFixedThreadPool()ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ï¼› SynchronousQueueï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡žé˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºŽé˜»å¡žçŠ¶æ€ï¼Œåžåé‡é€šå¸¸è¦é«˜äºŽLinkedBlockingQueueï¼Œé™æ€å·¥åŽ‚æ–¹æ³•Executors.newCachedThreadPoolä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ï¼› PriorityBlockingQueueï¼šä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡žé˜Ÿåˆ—ï¼›åº•å±‚ç”¨DelayedWorkQueueå®žçŽ°ã€‚ keepAliveTimeï¼šçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶æœ€å¤šä¿æŒå¤šä¹…æ—¶é—´ç»ˆæ­¢ å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äºŽcorePoolSizeæ—¶ï¼Œå¦‚æžœä¸€ä¸ªçº¿ç¨‹ç©ºé—²çš„æ—¶é—´è¾¾åˆ°keepAliveTimeï¼Œåˆ™ä¼šç»ˆæ­¢ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸è¶…è¿‡corePoolSizeã€‚ï¼ˆä½†æ˜¯å¦‚æžœè°ƒç”¨äº†allowCoreThreadTimeOut(boolean value)æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å¤§äºŽcorePoolSizeæ—¶ï¼ŒkeepAliveTimeå‚æ•°ä¹Ÿä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼›ï¼‰ unit:keepAliveTimeçš„æ—¶é—´å•ä½ threadFactoryï¼šçº¿ç¨‹å·¥åŽ‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ threadFactoryç”¨äºŽè®¾ç½®åˆ›å»ºçº¿ç¨‹çš„å·¥åŽ‚ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹å·¥åŽ‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­— handler:é¥±å’Œç­–ç•¥ å½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜Žçº¿ç¨‹æ± å¤„äºŽé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚è¿™ä¸ªç­–ç•¥é»˜è®¤æƒ…å†µä¸‹æ˜¯AbortPolicyï¼Œè¡¨ç¤ºæ— æ³•å¤„ç†æ–°ä»»åŠ¡æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ è¿™äº›å‚æ•°å…¨éƒ¨ä¼ ç»™ThreadPoolExecutorä¹‹åŽï¼ŒThreadPoolExecutorå°±å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¿™ä¸ªçº¿ç¨‹æ± æäº¤ä»¥åŠç»ˆæ­¢çº¿ç¨‹ä»»åŠ¡ã€‚ å››ã€é¥±å’Œç­–ç•¥ å½“çº¿ç¨‹æ± ä¸­å·²ç»åˆ°äº†å®Œå…¨æ²¡æœ‰åŠžæ³•å†æŽ¥æ”¶æ–°çš„çº¿ç¨‹è¿›æ¥çš„æ—¶å€™ï¼Œå°±ä¼šå¯åŠ¨é¥±å’Œç­–ç•¥ã€‚ 1234java.util.concurrent.ThreadPoolExecutor.AbortPolicyjava.util.concurrent.ThreadPoolExecutor.CallerRunsPolicyjava.util.concurrent.ThreadPoolExecutor.DiscardOldestPolicyjava.util.concurrent.ThreadPoolExecutor.DiscardPolicy AbortPolicyï¼šä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰ CallerRunsPolicyï¼šåªç”¨è°ƒç”¨æ‰€åœ¨çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åŽé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ DiscardPolicyï¼šä¸å¤„ç†ï¼Œä¸¢å¼ƒæŽ‰,ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ äº”ã€çº¿ç¨‹æ± çš„æºç è§£è¯» ç¨‹åºä¸­è¦å£°æ˜Žçº¿ç¨‹æ± ï¼Œæ˜¯è¿™æ ·å†™çš„ï¼š 12ExecutorService exec = Executors.newCachedThreadPool();exec.excute(Runnable command); å…ˆæ¥çœ‹çœ‹ExecutorServiceå…¶ä¸­çš„å¥¥ç§˜ã€‚ 5.1 ExecutorServiceå’ŒExecutorçš„å…³ç³» Executoræ˜¯ä¸€ä¸ªé¡¶å±‚æŽ¥å£ï¼Œåœ¨å®ƒé‡Œé¢åªå£°æ˜Žäº†ä¸€ä¸ªæ–¹æ³•execute(Runnable)ï¼Œè¿”å›žå€¼ä¸ºvoidï¼Œå‚æ•°ä¸ºRunnableç±»åž‹ï¼Œä»Žå­—é¢æ„æ€å¯ä»¥ç†è§£ï¼Œå°±æ˜¯ç”¨æ¥æ‰§è¡Œä¼ è¿›åŽ»çš„ä»»åŠ¡çš„ï¼› 123public interface Executor &#123; void execute(Runnable command);&#125; ExecutorServiceæŽ¥å£ç»§æ‰¿äº†ExecutoræŽ¥å£ï¼Œå¹¶å£°æ˜Žäº†ä¸€äº›æ–¹æ³•ï¼šsubmitã€invokeAllã€invokeAnyä»¥åŠshutDownç­‰ï¼› 12345678910111213141516171819202122public interface ExecutorService extends Executor &#123; void shutdown(); boolean isShutdown(); boolean isTerminated(); boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException; &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task); &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result); Future&lt;?&gt; submit(Runnable task); &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException; &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException; &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException; &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; å¯ä»¥çœ‹å‡ºï¼ŒExecutorServiceå…·å¤‡ç®¡ç†æ‰§è¡Œå™¨å’Œä»»åŠ¡ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œæäº¤ä»»åŠ¡æœºåˆ¶æ›´åŠ å®Œå–„ã€‚Executoråªæ˜¯è¿è¡Œæ–°ä»»åŠ¡çš„ç®€å•æŽ¥å£ï¼Œç›®çš„æ˜¯å°†ä»»åŠ¡æäº¤å’Œä»»åŠ¡æ‰§è¡Œè§£è€¦ã€‚ 5.2 ThreadPoolExecutoré‡è¦æ–¹æ³• æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨æ‰§è¡ŒExecutors.newCachedThreadPool()çš„æ—¶å€™ï¼Œå†…éƒ¨æ˜¯è°ƒç”¨ThreadPoolExecutorçš„æž„é€ å‡½æ•°æ¥ç”ŸæˆExceutorså¯¹è±¡ï¼Œå³ç”Ÿæˆäº†çº¿ç¨‹æ± ï¼Œå› ä¸ºç»§æ‰¿å…³ç³»æ˜¯ï¼šThreadPoolExecutor extends AbstractExecutorService implements ExecutorService extends Executorã€‚æž„å»ºå¥½ä¹‹åŽï¼Œå°±å¯ä»¥æž„å»ºå·¥ä½œçº¿ç¨‹åŽ»æ‰§è¡Œä»»åŠ¡ã€‚å…¶ä¸­ï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š æ‰€ä»¥ï¼Œç”¨äºŽexecute()æˆ–è€…submit()çš„çº¿ç¨‹ä»»åŠ¡éƒ½æ˜¯è¢«å°è£…æˆworkeråŽ»æ‰§è¡Œçš„ã€‚ä¸‹é¢æ¥çœ‹çœ‹execute()å’Œsubmit()ç­‰æ ¸å¿ƒæ–¹æ³•ã€‚ åœ¨ThreadPoolExecutorç±»ä¸­æœ‰å‡ ä¸ªéžå¸¸é‡è¦çš„æ–¹æ³•ï¼š execute() execute()æ–¹æ³•å®žé™…ä¸Šæ˜¯Executorä¸­å£°æ˜Žçš„æ–¹æ³•ï¼Œåœ¨ThreadPoolExecutorè¿›è¡Œäº†å…·ä½“çš„å®žçŽ°ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ThreadPoolExecutorçš„æ ¸å¿ƒæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œäº¤ç”±çº¿ç¨‹æ± åŽ»æ‰§è¡Œã€‚ submit() submit()æ–¹æ³•æ˜¯åœ¨ExecutorServiceä¸­å£°æ˜Žçš„æ–¹æ³•,è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç”¨æ¥å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡çš„ï¼Œä½†æ˜¯å®ƒå’Œexecute()æ–¹æ³•ä¸åŒï¼Œå®ƒèƒ½å¤Ÿè¿”å›žä»»åŠ¡æ‰§è¡Œçš„ç»“æžœï¼ŒåŽ»çœ‹submit()æ–¹æ³•çš„å®žçŽ°ï¼Œä¼šå‘çŽ°å®ƒå®žé™…ä¸Šè¿˜æ˜¯è°ƒç”¨çš„execute()æ–¹æ³•ï¼Œåªä¸è¿‡å®ƒåˆ©ç”¨äº†Futureæ¥èŽ·å–ä»»åŠ¡æ‰§è¡Œç»“æžœã€‚ shutdown() å°†çº¿ç¨‹æ± çŠ¶æ€ç½®ä¸ºSHUTDOWN,å¹¶ä¸ä¼šç«‹å³åœæ­¢ï¼š åœæ­¢æŽ¥æ”¶å¤–éƒ¨submitçš„ä»»åŠ¡å†…éƒ¨æ­£åœ¨è·‘çš„ä»»åŠ¡å’Œé˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡ï¼Œä¼šæ‰§è¡Œå®Œç­‰åˆ°ç¬¬äºŒæ­¥å®ŒæˆåŽï¼Œæ‰çœŸæ­£åœæ­¢ shutdownNow() å°†çº¿ç¨‹æ± çŠ¶æ€ç½®ä¸ºSTOPã€‚ä¼å›¾ç«‹å³åœæ­¢ï¼Œäº‹å®žä¸Šä¸ä¸€å®šï¼š è·Ÿshutdown()ä¸€æ ·ï¼Œå…ˆåœæ­¢æŽ¥æ”¶å¤–éƒ¨æäº¤çš„ä»»åŠ¡å¿½ç•¥é˜Ÿåˆ—é‡Œç­‰å¾…çš„ä»»åŠ¡å°è¯•å°†æ­£åœ¨è·‘çš„ä»»åŠ¡interruptä¸­æ–­è¿”å›žæœªæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ å®ƒè¯•å›¾ç»ˆæ­¢çº¿ç¨‹çš„æ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨Thread.interrupt()æ–¹æ³•æ¥å®žçŽ°çš„ï¼Œä½†æ˜¯å¤§å®¶çŸ¥é“ï¼Œè¿™ç§æ–¹æ³•çš„ä½œç”¨æœ‰é™ï¼Œå¦‚æžœçº¿ç¨‹ä¸­æ²¡æœ‰sleep ã€waitã€Conditionã€å®šæ—¶é”ç­‰åº”ç”¨, interrupt()æ–¹æ³•æ˜¯æ— æ³•ä¸­æ–­å½“å‰çš„çº¿ç¨‹çš„ã€‚æ‰€ä»¥ï¼ŒShutdownNow()å¹¶ä¸ä»£è¡¨çº¿ç¨‹æ± å°±ä¸€å®šç«‹å³å°±èƒ½é€€å‡ºï¼Œå®ƒä¹Ÿå¯èƒ½å¿…é¡»è¦ç­‰å¾…æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆäº†æ‰èƒ½é€€å‡ºã€‚ä½†æ˜¯å¤§å¤šæ•°æ—¶å€™æ˜¯èƒ½ç«‹å³é€€å‡ºçš„ awaitTermination(long timeOut, TimeUnit unit) æŽ¥æ”¶timeoutå’ŒTimeUnitä¸¤ä¸ªå‚æ•°ï¼Œç”¨äºŽè®¾å®šè¶…æ—¶æ—¶é—´åŠå•ä½ã€‚å½“ç­‰å¾…è¶…è¿‡è®¾å®šæ—¶é—´æ—¶ï¼Œä¼šç›‘æµ‹ExecutorServiceæ˜¯å¦å·²ç»å…³é—­ï¼Œè‹¥å…³é—­åˆ™è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalseã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¼šå’Œshutdownæ–¹æ³•ç»„åˆä½¿ç”¨ã€‚ 5.3 Executorsç”Ÿæˆçº¿ç¨‹æ±  è¦é…ç½®ä¸€ä¸ªçº¿ç¨‹æ± æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºŽçº¿ç¨‹æ± çš„åŽŸç†ä¸æ˜¯å¾ˆæ¸…æ¥šçš„æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½é…ç½®çš„çº¿ç¨‹æ± ä¸æ˜¯è¾ƒä¼˜çš„ï¼Œå› æ­¤åœ¨Executorsç±»é‡Œé¢æä¾›äº†ä¸€äº›é™æ€å·¥åŽ‚ï¼Œç”Ÿæˆä¸€äº›å¸¸ç”¨çš„çº¿ç¨‹æ± ã€‚è¿™ä¸ªå°±æ¶‰åŠä¸Šé¢æˆ‘ä»¬åå¤æåŠçš„æ ¸å¿ƒç±»ï¼šThreadPoolExecutorã€‚ â­å…¶å®žéƒ½æ˜¯é€šè¿‡è°ƒç”¨ThreadPoolExecutoræ¥å®Œæˆçš„ï¼Œæœ€åŽå¯ä»¥è¿”å›žExecutorServiceå¯¹è±¡ï¼Œå…¶å®žè¯´ç™½äº†éƒ½æ˜¯Excutorå¯¹è±¡ã€‚ ä¸‹é¢æ¥åˆ†åˆ«çœ‹çœ‹æ¯”è¾ƒå¸¸ç”¨çš„çº¿ç¨‹æ± ã€‚ newSingleThreadExecutor åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚è¿™ä¸ªçº¿ç¨‹æ± åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºŽå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ã€‚å¦‚æžœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å› ä¸ºå¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ›¿ä»£å®ƒã€‚æ­¤çº¿ç¨‹æ± ä¿è¯æ‰€æœ‰ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºæ‰§è¡Œã€‚ 12345678910111213141516171819//åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ä¸ªæ•°å’Œæœ€å¤§çº¿ç¨‹ä¸ªæ•°éƒ½ä¸º1çš„çº¿ç¨‹æ± //é˜»å¡žé˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX_VALUE//keeyAliveTime=0è¯´æ˜Žåªè¦çº¿ç¨‹ä¸ªæ•°æ¯”æ ¸å¿ƒçº¿ç¨‹ä¸ªæ•°å¤šå¹¶ä¸”å½“å‰ç©ºé—²åˆ™å›žæ”¶//çº¿ç¨‹ç”±DefaultThreadFactoryé»˜è®¤åˆ›å»ºï¼Œæœ‰ç»Ÿä¸€çš„å‘½åè§„èŒƒï¼Œå¹¶ä¸”ä¼˜å…ˆçº§æ˜¯ä¸€æ ·çš„public static ExecutorService newSingleThreadExecutor() &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()));&#125;//ä½¿ç”¨è‡ªå·±çš„çº¿ç¨‹å·¥åŽ‚æ¥åˆ›å»ºçº¿ç¨‹public static ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory) &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(), threadFactory));&#125; demoï¼š 12345678910111213141516@Slf4jpublic class ThreadPoolTest3 &#123; public static void main(String[] args) &#123; ExecutorService exec = Executors.newSingleThreadExecutor(); for(int i=0;i&lt;10;i++)&#123; final int index = i; exec.execute(() -&gt; &#123; log.info("task:&#123;&#125;,index:&#123;&#125;",Thread.currentThread().getId(),index); &#125;); &#125; exec.shutdown(); &#125;&#125; è¿è¡Œç»“æžœï¼š 12345678910task:10,index:0task:10,index:1task:10,index:2task:10,index:3task:10,index:4task:10,index:5task:10,index:6task:10,index:7task:10,index:8task:10,index:9 è¿è¡Œç»“æžœåˆ†æžï¼šå•çº¿ç¨‹+æœ‰åºã€‚ newFixedThreadPool åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°çº¿ç¨‹è¾¾åˆ°çº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ã€‚çº¿ç¨‹æ± çš„å¤§å°ä¸€æ—¦è¾¾åˆ°æœ€å¤§å€¼å°±ä¼šä¿æŒä¸å˜ï¼Œå¦‚æžœæŸä¸ªçº¿ç¨‹å› ä¸ºæ‰§è¡Œå¼‚å¸¸è€Œç»“æŸï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šè¡¥å……ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚ 123456789101112131415//åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ä¸ªæ•°å’Œæœ€å¤§çº¿ç¨‹ä¸ªæ•°éƒ½ä¸ºnThreadsçš„çº¿ç¨‹æ± //é˜»å¡žé˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX_VALUE//keeyAliveTime=0è¯´æ˜Žåªè¦çº¿ç¨‹ä¸ªæ•°æ¯”æ ¸å¿ƒçº¿ç¨‹ä¸ªæ•°å¤šå¹¶ä¸”å½“å‰ç©ºé—²åˆ™å›žæ”¶public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());&#125;//ä½¿ç”¨è‡ªå·±çš„çº¿ç¨‹å·¥åŽ‚æ¥åˆ›å»ºçº¿ç¨‹public static ExecutorService newFixedThreadPool(int nThreads, ThreadFactory threadFactory) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(), threadFactory);&#125; demoï¼š 12345678910111213141516@Slf4jpublic class ThreadPoolTest2 &#123; public static void main(String[] args) &#123; ExecutorService exec = Executors.newFixedThreadPool(3); for(int i=0;i&lt;10;i++)&#123; final int index = i; exec.execute(() -&gt; &#123; log.info("task:&#123;&#125;,index:&#123;&#125;",Thread.currentThread().getId(),index); &#125;); &#125; exec.shutdown(); &#125;&#125; è¿è¡Œç»“æžœï¼š 12345678910task:11,index:1task:11,index:3task:11,index:4task:11,index:5task:11,index:6task:11,index:7task:11,index:8task:11,index:9task:10,index:0task:12,index:2 ç»“æžœåˆ†æžï¼šåªåˆ›å»ºäº†ä¸‰ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚ newCachedThreadPool åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ã€‚å¦‚æžœçº¿ç¨‹æ± çš„å¤§å°è¶…è¿‡äº†å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šå›žæ”¶éƒ¨åˆ†ç©ºé—²ï¼ˆ60ç§’ä¸æ‰§è¡Œä»»åŠ¡ï¼‰çš„çº¿ç¨‹ï¼Œå½“ä»»åŠ¡æ•°å¢žåŠ æ—¶ï¼Œæ­¤çº¿ç¨‹æ± åˆå¯ä»¥æ™ºèƒ½çš„æ·»åŠ æ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´JVMï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°ã€‚ 1234567891011121314151617//åˆ›å»ºä¸€ä¸ªæŒ‰éœ€åˆ›å»ºçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œåˆå§‹çº¿ç¨‹ä¸ªæ•°ä¸º0ï¼Œæœ€å¤šçº¿ç¨‹ä¸ªæ•°ä¸ºInteger.MAX_VALUE//é˜»å¡žé˜Ÿåˆ—ä¸ºåŒæ­¥é˜Ÿåˆ—//keeyAliveTime=60è¯´æ˜Žåªè¦å½“å‰çº¿ç¨‹60så†…ç©ºé—²åˆ™å›žæ”¶//ç‰¹æ®Šåœ¨äºŽåŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—çš„ä»»åŠ¡ä¼šè¢«é©¬ä¸Šè¢«æ‰§è¡Œï¼ŒåŒæ­¥é˜Ÿåˆ—é‡Œé¢æœ€å¤šåªæœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”å­˜åœ¨åŽé©¬ä¸Šä¼šæ‹¿å‡ºæ‰§è¡Œpublic static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());&#125;//ä½¿ç”¨è‡ªå·±çš„çº¿ç¨‹å·¥åŽ‚æ¥åˆ›å»ºçº¿ç¨‹public static ExecutorService newCachedThreadPool(ThreadFactory threadFactory) &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;(), threadFactory);&#125; demoï¼š 12345678910111213141516@Slf4jpublic class ThreadPoolTest1 &#123; public static void main(String[] args) &#123; ExecutorService exec = Executors.newCachedThreadPool(); for(int i=0;i&lt;10;i++)&#123; final int index = i; exec.execute(() -&gt; &#123; log.info("task:&#123;&#125;,index:&#123;&#125;",Thread.currentThread().getId(),index); &#125;); &#125; exec.shutdown(); &#125;&#125; è¿è¡Œç»“æžœï¼š 12345678910task:10,index:0task:12,index:2task:14,index:4task:16,index:6task:18,index:8task:11,index:1task:13,index:3task:15,index:5task:17,index:7task:19,index:9 ç»“æžœåˆ†æžï¼šæŒ‰éœ€åˆ›å»ºçº¿ç¨‹ï¼Œå‡ ä¹Žä¸€æ¬¡å¾ªçŽ¯å°±åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œã€‚ newScheduledThreadPool åˆ›å»ºä¸€ä¸ªå¤§å°æ— é™çš„çº¿ç¨‹æ± ã€‚æ­¤çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„éœ€æ±‚ã€‚ 12345//åˆ›å»ºä¸€ä¸ªæœ€å°çº¿ç¨‹ä¸ªæ•°corePoolSizeï¼Œæœ€å¤§ä¸ºInteger.MAX_VALUE//é˜»å¡žé˜Ÿåˆ—ä¸ºDelayedWorkQueueçš„çº¿ç¨‹æ± public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) &#123; return new ScheduledThreadPoolExecutor(corePoolSize);&#125; demoï¼š 1234567891011121314151617181920212223242526272829303132//å¤šé•¿æ—¶é—´ä¹‹åŽæ‰§è¡Œä¸€æ¬¡@Slf4jpublic class ThreadPoolTest4 &#123; public static void main(String[] args) &#123; ScheduledExecutorService exec = Executors.newScheduledThreadPool(3); exec.schedule(new Runnable() &#123; @Override public void run() &#123; log.info("schedule run"); &#125; &#125;,3, TimeUnit.SECONDS); exec.shutdown(); &#125;&#125;//å®šæ—¶æ‰§è¡Œï¼Œè¿™é‡Œæ˜¯æ¯éš”3ç§’æ‰§è¡Œä¸€æ¬¡@Slf4jpublic class ThreadPoolTest4 &#123; public static void main(String[] args) &#123; ScheduledExecutorService exec = Executors.newScheduledThreadPool(3); exec.scheduleAtFixedRate(new Runnable() &#123; @Override public void run() &#123; log.info("schedule run"); &#125; &#125;,1,3,TimeUnit.SECONDS);//ä¸€å¼€å§‹å»¶è¿Ÿ1ç§’æ‰§è¡Œä»»åŠ¡ï¼Œä¹‹åŽæ¯éš”3ç§’æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œä¸é€‚åˆè°ƒç”¨exec.shutdown();ï¼Œå› ä¸ºä¼šè¢«å…³é—­ &#125;&#125; newSingleThreadScheduledExecutor åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚æ­¤çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„éœ€æ±‚ã€‚ 123456//åˆ›å»ºä¸€ä¸ªæœ€å°çº¿ç¨‹ä¸ªæ•°corePoolSizeä¸º1ï¼Œæœ€å¤§ä¸ºInteger.MAX_VALUE//é˜»å¡žé˜Ÿåˆ—ä¸ºDelayedWorkQueueçš„çº¿ç¨‹æ± ã€‚public static ScheduledExecutorService newSingleThreadScheduledExecutor() &#123; return new DelegatedScheduledExecutorService (new ScheduledThreadPoolExecutor(1));&#125; åŒä¸Šã€‚demoä¸å†èµ˜è¿°ã€‚ 5.4 çº¿ç¨‹æ± å®žçŽ°åŽŸç†â€“çº¿ç¨‹æ± çŠ¶æ€ static final int RUNNING = 0; å½“åˆ›å»ºçº¿ç¨‹æ± åŽï¼Œåˆå§‹æ—¶ï¼Œçº¿ç¨‹æ± å¤„äºŽRUNNINGçŠ¶æ€ï¼› static final int SHUTDOWN = 1; å¦‚æžœè°ƒç”¨äº†shutdown()æ–¹æ³•ï¼Œåˆ™çº¿ç¨‹æ± å¤„äºŽSHUTDOWNçŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹æ± ä¸èƒ½å¤ŸæŽ¥å—æ–°çš„ä»»åŠ¡ï¼Œå®ƒä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼› static final int STOP = 2; å¦‚æžœè°ƒç”¨äº†shutdownNow()æ–¹æ³•ï¼Œåˆ™çº¿ç¨‹æ± å¤„äºŽSTOPçŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹æ± ä¸èƒ½æŽ¥å—æ–°çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šåŽ»å°è¯•ç»ˆæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼› static final int TERMINATED = 3; å½“çº¿ç¨‹æ± å¤„äºŽSHUTDOWNæˆ–STOPçŠ¶æ€ï¼Œå¹¶ä¸”æ‰€æœ‰å·¥ä½œçº¿ç¨‹å·²ç»é”€æ¯ï¼Œä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²ç»æ¸…ç©ºæˆ–æ‰§è¡Œç»“æŸåŽï¼Œçº¿ç¨‹æ± è¢«è®¾ç½®ä¸ºTERMINATEDçŠ¶æ€ã€‚ 6.5 çº¿ç¨‹æ± å®žçŽ°åŽŸç†â€“ä»»åŠ¡çš„æ‰§è¡Œ corePoolSizeä¸ŽmaximumPoolSizeçš„å…³ç³»ä¸¾ä¸ªç®€å•çš„ä¾‹å­å½¢è±¡ç†è§£å°±æ˜¯ï¼š å‡å¦‚æœ‰ä¸€ä¸ªå·¥åŽ‚ï¼Œå·¥åŽ‚é‡Œé¢æœ‰10ä¸ªå·¥äººï¼Œæ¯ä¸ªå·¥äººåŒæ—¶åªèƒ½åšä¸€ä»¶ä»»åŠ¡ã€‚ å› æ­¤åªè¦å½“10ä¸ªå·¥äººä¸­æœ‰å·¥äººæ˜¯ç©ºé—²çš„ï¼Œæ¥äº†ä»»åŠ¡å°±åˆ†é…ç»™ç©ºé—²çš„å·¥äººåšï¼› å½“10ä¸ªå·¥äººéƒ½æœ‰ä»»åŠ¡åœ¨åšæ—¶ï¼Œå¦‚æžœè¿˜æ¥äº†ä»»åŠ¡ï¼Œå°±æŠŠä»»åŠ¡è¿›è¡ŒæŽ’é˜Ÿç­‰å¾…ï¼› å¦‚æžœè¯´æ–°ä»»åŠ¡æ•°ç›®å¢žé•¿çš„é€Ÿåº¦è¿œè¿œå¤§äºŽå·¥äººåšä»»åŠ¡çš„é€Ÿåº¦ï¼Œé‚£ä¹ˆæ­¤æ—¶å·¥åŽ‚ä¸»ç®¡å¯èƒ½ä¼šæƒ³è¡¥æ•‘æŽªæ–½ï¼Œæ¯”å¦‚é‡æ–°æ‹›4ä¸ªä¸´æ—¶å·¥äººè¿›æ¥ï¼› ç„¶åŽå°±å°†ä»»åŠ¡ä¹Ÿåˆ†é…ç»™è¿™4ä¸ªä¸´æ—¶å·¥äººåšï¼› å¦‚æžœè¯´ç€14ä¸ªå·¥äººåšä»»åŠ¡çš„é€Ÿåº¦è¿˜æ˜¯ä¸å¤Ÿï¼Œæ­¤æ—¶å·¥åŽ‚ä¸»ç®¡å¯èƒ½å°±è¦è€ƒè™‘ä¸å†æŽ¥æ”¶æ–°çš„ä»»åŠ¡æˆ–è€…æŠ›å¼ƒå‰é¢çš„ä¸€äº›ä»»åŠ¡äº†ã€‚ å½“è¿™14ä¸ªå·¥äººå½“ä¸­æœ‰äººç©ºé—²æ—¶ï¼Œè€Œæ–°ä»»åŠ¡å¢žé•¿çš„é€Ÿåº¦åˆæ¯”è¾ƒç¼“æ…¢ï¼Œå·¥åŽ‚ä¸»ç®¡å¯èƒ½å°±è€ƒè™‘è¾žæŽ‰4ä¸ªä¸´æ—¶å·¥äº†ï¼Œåªä¿æŒåŽŸæ¥çš„10ä¸ªå·¥äººï¼Œæ¯•ç«Ÿè¯·é¢å¤–çš„å·¥äººæ˜¯è¦èŠ±é’±çš„ã€‚ è¿™ä¸ªä¾‹å­ä¸­çš„corePoolSizeå°±æ˜¯10ï¼Œè€ŒmaximumPoolSizeå°±æ˜¯14ï¼ˆ10+4ï¼‰ã€‚ maximumPoolSizeå¯ä»¥çœ‹ä½œæ˜¯çº¿ç¨‹æ± çš„ä¸€ç§è¡¥æ•‘æŽªæ–½ï¼Œå³ä»»åŠ¡é‡çªç„¶è¿‡å¤§æ—¶çš„ä¸€ç§è¡¥æ•‘æŽªæ–½ã€‚ åœ¨ThreadPoolExecutorç±»ä¸­ï¼Œæœ€æ ¸å¿ƒçš„ä»»åŠ¡æäº¤æ–¹æ³•æ˜¯execute()æ–¹æ³•ï¼Œè™½ç„¶é€šè¿‡submitä¹Ÿå¯ä»¥æäº¤ä»»åŠ¡ï¼Œä½†æ˜¯å®žé™…ä¸Šsubmitæ–¹æ³•é‡Œé¢æœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯execute()æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç ”ç©¶execute()æ–¹æ³•çš„å®žçŽ°åŽŸç†å³å¯ï¼š æ³¨ï¼šexecute()æ–¹æ³•å’Œsubmit()æ–¹æ³•å·²ç»åœ¨å‰é¢è®²è¿‡åŒºåˆ«äº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142public void execute(Runnable command) &#123; if (command == null) throw new NullPointerException(); // // Proceed in 3 steps: // // 1. // åˆ¤æ–­å½“å‰çš„çº¿ç¨‹æ•°æ˜¯å¦å°äºŽcorePoolSize,å¦‚æžœæ˜¯ï¼Œä½¿ç”¨å…¥å‚ä»»åŠ¡é€šè¿‡addWordæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œ // å¦‚æžœèƒ½å®Œæˆæ–°çº¿ç¨‹åˆ›å»ºexexuteæ–¹æ³•ç»“æŸï¼ŒæˆåŠŸæäº¤ä»»åŠ¡ // 2. // åœ¨ç¬¬ä¸€æ­¥æ²¡æœ‰å®Œæˆä»»åŠ¡æäº¤ï¼›çŠ¶æ€ä¸ºè¿è¡Œå¹¶ä¸”èƒ½å¤ŸæˆåŠŸåŠ å…¥ä»»åŠ¡åˆ°å·¥ä½œé˜Ÿåˆ—åŽï¼Œå†è¿›è¡Œä¸€æ¬¡checkï¼Œå¦‚æžœçŠ¶æ€ // åœ¨ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—åŽå˜ä¸ºäº†éžè¿è¡Œï¼ˆæœ‰å¯èƒ½æ˜¯åœ¨æ‰§è¡Œåˆ°è¿™é‡Œçº¿ç¨‹æ± shutdownäº†ï¼‰ï¼Œéžè¿è¡ŒçŠ¶æ€ä¸‹å½“ç„¶æ˜¯éœ€è¦ // rejectï¼›ç„¶åŽå†åˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦ä¸º0ï¼ˆæœ‰å¯èƒ½è¿™ä¸ªæ—¶å€™çº¿ç¨‹æ•°å˜ä¸ºäº†0ï¼‰ï¼Œå¦‚æ˜¯ï¼Œæ–°å¢žä¸€ä¸ªçº¿ç¨‹ï¼› // 3. // å¦‚æžœä¸èƒ½åŠ å…¥ä»»åŠ¡åˆ°å·¥ä½œé˜Ÿåˆ—ï¼Œå°†å°è¯•ä½¿ç”¨ä»»åŠ¡æ–°å¢žä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æžœå¤±è´¥ï¼Œåˆ™æ˜¯çº¿ç¨‹æ± å·²ç»shutdownæˆ–è€…çº¿ç¨‹æ±  // å·²ç»è¾¾åˆ°é¥±å’ŒçŠ¶æ€ï¼Œæ‰€ä»¥rejectè¿™ä¸ªä»»åŠ¡ // int c = ctl.get(); // å·¥ä½œçº¿ç¨‹æ•°å°äºŽæ ¸å¿ƒçº¿ç¨‹æ•° if (workerCountOf(c) &lt; corePoolSize) &#123; // ç›´æŽ¥å¯åŠ¨æ–°çº¿ç¨‹ï¼Œtrueè¡¨ç¤ºä¼šå†æ¬¡æ£€æŸ¥workerCountæ˜¯å¦å°äºŽcorePoolSize if (addWorker(command, true)) return; c = ctl.get(); &#125; // å¦‚æžœå·¥ä½œçº¿ç¨‹æ•°å¤§äºŽç­‰äºŽæ ¸å¿ƒçº¿ç¨‹æ•° // çº¿ç¨‹çš„çš„çŠ¶æ€ä¸ºRUNNINGå¹¶ä¸”é˜Ÿåˆ—notfull if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; // å†æ¬¡æ£€æŸ¥çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æžœä¸æ˜¯RUNNINGç›´æŽ¥ä»Žé˜Ÿåˆ—ä¸­ç§»é™¤ int recheck = ctl.get(); if (! isRunning(recheck) &amp;&amp; remove(command)) // ç§»é™¤æˆåŠŸï¼Œæ‹’ç»è¯¥éžè¿è¡Œçš„ä»»åŠ¡ reject(command); else if (workerCountOf(recheck) == 0) // é˜²æ­¢äº†SHUTDOWNçŠ¶æ€ä¸‹æ²¡æœ‰æ´»åŠ¨çº¿ç¨‹äº†ï¼Œä½†æ˜¯é˜Ÿåˆ—é‡Œè¿˜æœ‰ä»»åŠ¡æ²¡æ‰§è¡Œè¿™ç§ç‰¹æ®Šæƒ…å†µã€‚ // æ·»åŠ ä¸€ä¸ªnullä»»åŠ¡æ˜¯å› ä¸ºSHUTDOWNçŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹æ± ä¸å†æŽ¥å—æ–°ä»»åŠ¡ addWorker(null, false); &#125; // å¦‚æžœé˜Ÿåˆ—æ»¡äº†æˆ–è€…æ˜¯éžè¿è¡Œçš„ä»»åŠ¡éƒ½æ‹’ç»æ‰§è¡Œ else if (!addWorker(command, false)) reject(command);&#125; å¯¹åº”çš„ç¨‹åºæµç¨‹å›¾ä¸ºï¼š ä¸ºäº†ç†è§£æ›´åŠ å¾—é€å½»ï¼Œç”¨ä¸‹å›¾é…åˆæ–‡å­—æ€»ç»“ä¸€ä¸‹ï¼š 1.å¦‚æžœå½“å‰è¿è¡Œçš„çº¿ç¨‹å°‘äºŽcorePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼ˆæ³¨æ„ï¼Œæ‰§è¡Œè¿™ä¸€æ­¥éª¤éœ€è¦èŽ·å–å…¨å±€é”ï¼‰ã€‚ 2.å¦‚æžœè¿è¡Œçš„çº¿ç¨‹ç­‰äºŽæˆ–å¤šäºŽcorePoolSizeï¼Œåˆ™å°†ä»»åŠ¡åŠ å…¥BlockingQueueã€‚ 3.å¦‚æžœæ— æ³•å°†ä»»åŠ¡åŠ å…¥BlockingQueueï¼ˆé˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™åœ¨éžcorePoolä¸­åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼ˆæ³¨æ„ï¼Œæ‰§è¡Œè¿™ä¸€æ­¥éª¤éœ€è¦èŽ·å–å…¨å±€é”ï¼‰ã€‚ 4.å¦‚æžœåˆ›å»ºæ–°çº¿ç¨‹å°†ä½¿å½“å‰è¿è¡Œçš„çº¿ç¨‹è¶…å‡ºmaximumPoolSizeï¼Œä»»åŠ¡å°†è¢«æ‹’ç»ï¼Œå¹¶è°ƒç”¨RejectedExecutionHandler.rejectedExecution()æ–¹æ³•ã€‚ ThreadPoolExecutoré‡‡å–ä¸Šè¿°æ­¥éª¤çš„æ€»ä½“è®¾è®¡æ€è·¯ï¼Œæ˜¯ä¸ºäº†åœ¨æ‰§è¡Œexecute()æ–¹æ³•æ—¶ï¼Œå°½å¯èƒ½åœ°é¿å…èŽ·å–å…¨å±€é”ï¼ˆé‚£å°†ä¼šæ˜¯ä¸€ä¸ªä¸¥é‡çš„å¯ä¼¸ç¼©ç“¶é¢ˆï¼‰ã€‚åœ¨ThreadPoolExecutorå®Œæˆé¢„çƒ­ä¹‹åŽï¼ˆå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºŽç­‰äºŽcorePoolSizeï¼‰ï¼Œå‡ ä¹Žæ‰€æœ‰çš„execute()æ–¹æ³•è°ƒç”¨éƒ½æ˜¯æ‰§è¡Œæ­¥éª¤2ï¼Œè€Œæ­¥éª¤2ä¸éœ€è¦èŽ·å–å…¨å±€é”ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»ŽCASåˆ°AtomicåŒ…åŽŸç†]]></title>
    <url>%2F2019%2F02%2F12%2Fthread%2F%E4%BB%8ECAS%E5%88%B0Atomic%E5%8C%85%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬çŸ¥é“ï¼Œvolatileä¿è¯äº†å¯è§æ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åŽŸå­æ€§ï¼Œåœ¨é¢å¯¹çº¿ç¨‹å®‰å…¨é—®é¢˜æ—¶ï¼Œå°±æ˜¾åœ°åŠ›ä¸ä»Žå¿ƒï¼Œé‚£ä¹ˆé™¤äº†synchronizedå…³é”®å­—å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥å®žçŽ°çº¿ç¨‹å®‰å…¨æ›´æ–°å‘¢ï¼Ÿæœ¬æ–‡é¦–å…ˆä»‹ç»CASæ˜¯ä»€ä¹ˆï¼Œå¼•å‡ºJUCä¸‹ä¸€ä¸ªé‡è¦çš„åŒ…ï¼šAtomicåŒ…ã€‚ ä¸€ã€CASç®€ä»‹ CASï¼ˆCompare and Swapï¼‰ï¼Œå³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼Œå®žçŽ°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ï¼ŒDoug leaå¤§ç¥žåœ¨javaåŒæ­¥å™¨ä¸­å¤§é‡ä½¿ç”¨äº†CASæŠ€æœ¯ï¼Œé¬¼æ–§ç¥žå·¥çš„å®žçŽ°äº†å¤šçº¿ç¨‹æ‰§è¡Œçš„å®‰å…¨æ€§ã€‚ CASçš„æ€æƒ³å¾ˆç®€å•ï¼šä¸‰ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå½“å‰å†…å­˜å€¼Vã€æ—§çš„é¢„æœŸå€¼Aã€å³å°†æ›´æ–°çš„å€¼Bï¼Œå½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼ä¿®æ”¹ä¸ºBå¹¶è¿”å›žtrueï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œå¹¶è¿”å›žfalseã€‚ äºŒã€n++é—®é¢˜ é€šè¿‡javap -verbose Caseçœ‹çœ‹addæ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œn++è¢«æ‹†åˆ†æˆäº†ä¸‹é¢å‡ ä¸ªæŒ‡ä»¤ï¼š æ‰§è¡Œgetfieldæ‹¿åˆ°åŽŸå§‹nï¼› æ‰§è¡Œiaddè¿›è¡ŒåŠ 1æ“ä½œï¼› æ‰§è¡Œputfieldå†™æŠŠç´¯åŠ åŽçš„å€¼å†™å›žnï¼› é€šè¿‡volatileä¿®é¥°çš„å˜é‡å¯ä»¥ä¿è¯çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œä½†å¹¶ä¸èƒ½ä¿è¯è¿™3ä¸ªæŒ‡ä»¤çš„åŽŸå­æ‰§è¡Œï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œä¸‹ï¼Œæ— æ³•åšåˆ°çº¿ç¨‹å®‰å…¨ï¼Œå¾—åˆ°æ­£ç¡®çš„ç»“æžœï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹çº¿ç¨‹å®‰å…¨ä¸‰ä¸ªç‰¹æ€§ åŽŸå­æ€§ï¼šæä¾›äº†äº’æ–¥è®¿é—®ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥å¯¹å®ƒè¿›è¡Œæ“ä½œã€‚ å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹ä¸»å†…å­˜çš„ä¿®æ”¹å¯ä»¥åŠæ—¶åœ°è¢«å…¶ä»–çº¿ç¨‹è§‚å¯Ÿåˆ°ã€‚ æœ‰åºæ€§ï¼šä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå…¶ä»–çº¿ç¨‹ä¸­çš„æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºï¼Œç”±äºŽæŒ‡ä»¤é‡æŽ’åºçš„å­˜åœ¨ï¼Œè¯¥è§‚å¯Ÿç»“æžœä¸€èˆ¬æ‚ä¹±æ— åºã€‚ å¯ä»¥çœ‹åˆ°åŽŸå­æ€§æ˜¯çº¿ç¨‹å®‰å…¨çš„ä¸€å¤§ç‰¹æ€§ã€‚ ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ åœ¨addæ–¹æ³•åŠ ä¸Šsynchronizedä¿®é¥°è§£å†³ã€‚ è¿™ä¸ªæ–¹æ¡ˆå½“ç„¶å¯è¡Œï¼Œä½†æ˜¯æ€§èƒ½ä¸Šå·®äº†ç‚¹ï¼Œè¿˜æœ‰å…¶å®ƒæ–¹æ¡ˆä¹ˆï¼Ÿ å››ã€è§£å†³æ–¹æ¡ˆäºŒ æˆ‘ä»¬å¯ä¸å¯ä»¥ç”¨ä¸€ä¸‹ä¹è§‚é”çš„æ€æƒ³å‘¢ï¼Ÿå³ä¸åŠ é”ï¼Œç­‰çœŸæ­£è¦èµ‹å€¼çš„æ—¶å€™æ¯”è¾ƒä¸€ä¸‹ã€‚ å½“ç„¶äº†ï¼Œè¿™æ®µä»£ç å¦‚æžœçœŸçš„åœ¨å¹¶å‘ä¸‹æ‰§è¡Œï¼Œè‚¯å®šå‡ºé—®é¢˜ï¼Œåªæœ‰æŠŠè¿™æ•´ä¸ªè¿‡ç¨‹å˜æˆä¸€ä¸ªåŽŸå­æ“ä½œæ‰è¡Œï¼Œå³åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½ä¿®æ”¹å˜é‡aã€‚ å¦‚ä½•å®žçŽ°å‘¢ï¼Ÿ æˆ‘ä»¬æ³¨æ„åˆ°JUCä¸‹æœ‰ä¸ªå¥½ä¸œè¥¿ï¼Œä»¥Atomicæ‰“å¤´çš„ä¸€äº›ç±»ã€‚å°±å¯ä»¥å¾ˆå¥½åœ°å¸®åŠ©æˆ‘ä»¬å®žçŽ°å¯¹ä¸€ä¸ªæ•°åŠ ä¸€å‡ä¸€çš„åŽŸå­æ€§æ“ä½œã€‚æ¯”å¦‚æˆ‘ä»¬è¦å®‰å…¨åœ°å¯¹nåŠ ä¸€ï¼Œå¯ä»¥è¿™æ ·åšï¼š ä¸‹é¢å°±ä»¥AtomicIntegerçš„å®žçŽ°ä¸ºä¾‹ï¼Œåˆ†æžä¸€ä¸‹CASæ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚ Unsafeï¼Œæ˜¯CASçš„æ ¸å¿ƒç±»ï¼Œç”±äºŽJavaæ–¹æ³•æ— æ³•ç›´æŽ¥è®¿é—®åº•å±‚ç³»ç»Ÿï¼Œéœ€è¦é€šè¿‡æœ¬åœ°ï¼ˆnativeï¼‰æ–¹æ³•æ¥è®¿é—®ï¼ŒUnsafeç›¸å½“äºŽä¸€ä¸ªåŽé—¨ï¼ŒåŸºäºŽè¯¥ç±»å¯ä»¥ç›´æŽ¥æ“ä½œç‰¹å®šå†…å­˜çš„æ•°æ®ã€‚ å˜é‡valueOffsetï¼Œè¡¨ç¤ºè¯¥å˜é‡å€¼åœ¨å†…å­˜ä¸­çš„åç§»åœ°å€ï¼Œå› ä¸ºUnsafeå°±æ˜¯æ ¹æ®å†…å­˜åç§»åœ°å€èŽ·å–æ•°æ®çš„ã€‚ å˜é‡valueç”¨volatileä¿®é¥°ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¹‹é—´çš„å†…å­˜å¯è§æ€§ã€‚ çœ‹çœ‹AtomicIntegerå¦‚ä½•å®žçŽ°å¹¶å‘ä¸‹çš„ç´¯åŠ æ“ä½œï¼š å‡è®¾çº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶æ‰§è¡ŒgetAndIncrementæ“ä½œï¼ˆåˆ†åˆ«è·‘åœ¨ä¸åŒCPUä¸Šï¼‰ï¼š å‡è®¾AtomicIntegeré‡Œé¢çš„valueåŽŸå§‹å€¼ä¸º0ï¼Œå³ä¸»å†…å­˜ä¸­AtomicIntegerçš„valueä¸º0ï¼Œæ ¹æ®Javaå†…å­˜æ¨¡åž‹ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Bå„è‡ªæŒæœ‰ä¸€ä»½valueçš„å‰¯æœ¬ï¼Œå€¼ä¸º0ã€‚ çº¿ç¨‹Aé€šè¿‡getIntVolatile(var1, var2)æ‹¿åˆ°valueå€¼0ï¼Œè¿™æ—¶çº¿ç¨‹Aè¢«æŒ‚èµ·ã€‚ çº¿ç¨‹Bä¹Ÿé€šè¿‡getIntVolatile(var1, var2)æ–¹æ³•èŽ·å–åˆ°valueå€¼0ï¼Œè¿æ°”å¥½ï¼Œçº¿ç¨‹Bæ²¡æœ‰è¢«æŒ‚èµ·ï¼Œå¹¶æ‰§è¡ŒcompareAndSwapIntæ–¹æ³•æ¯”è¾ƒå†…å­˜å€¼ä¹Ÿä¸º0ï¼ŒæˆåŠŸä¿®æ”¹å†…å­˜å€¼ä¸º1ã€‚ è¿™æ—¶çº¿ç¨‹Aæ¢å¤ï¼Œæ‰§è¡ŒcompareAndSwapIntæ–¹æ³•æ¯”è¾ƒï¼Œå‘çŽ°è‡ªå·±æ‰‹é‡Œçš„å€¼(0)å’Œå†…å­˜çš„å€¼(1)ä¸ä¸€è‡´ï¼Œè¯´æ˜Žè¯¥å€¼å·²ç»è¢«å…¶å®ƒçº¿ç¨‹æå‰ä¿®æ”¹è¿‡äº†ï¼Œé‚£åªèƒ½é‡æ–°æ¥ä¸€éäº†ã€‚ é‡æ–°èŽ·å–valueå€¼ï¼Œå› ä¸ºå˜é‡valueè¢«volatileä¿®é¥°ï¼Œæ‰€ä»¥å…¶å®ƒçº¿ç¨‹å¯¹å®ƒçš„ä¿®æ”¹ï¼Œçº¿ç¨‹Aæ€»æ˜¯èƒ½å¤Ÿçœ‹åˆ°ï¼Œçº¿ç¨‹Aç»§ç»­æ‰§è¡ŒcompareAndSwapIntè¿›è¡Œæ¯”è¾ƒæ›¿æ¢ï¼Œç›´åˆ°æˆåŠŸã€‚ æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨CASä¿è¯äº†å¯¹äºŽvalueçš„ä¿®æ”¹çš„å¹¶å‘å®‰å…¨ï¼Œç»§ç»­æ·±å…¥çœ‹çœ‹Unsafeç±»ä¸­çš„compareAndSwapIntæ–¹æ³•å®žçŽ°ã€‚ æˆ‘ä»¬çœ‹åˆ°æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªæ“ä½œç³»ç»Ÿçš„å…·ä½“å®žçŽ°éƒ½æ˜¯ä¸å¤§ä¸€æ ·çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸å†æ·±ç©¶äº†ã€‚åªè¦çŸ¥é“å®ƒçš„æ¯”è¾ƒå’Œæ›¿æ¢æ˜¯ä¸€ä¸ªåŽŸå­æ“ä½œå³å¯ã€‚ äº”ã€å…¶ä»–é‡è¦çš„Atomicç±» 5.1 LongAdder ä¸Šé¢æåˆ°äº†AtomicIntegerï¼Œé‚£ä¹ˆå¿…ç„¶ä¹Ÿå­˜åœ¨``AtomicLong`ã€‚ç”¨æ³•å’ŒåŽŸç†æ˜¯ä¸€æ ·çš„ã€‚ æ—¢ç„¶ç”¨LongAddrä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸ä½¿ç”¨AtomicLongå‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œä¸ºä»€ä¹ˆAtomicLongå¯ä»¥å®žçŽ°ï¼Œè¿˜è¦æœ‰LongAddrè¿™ä¸ªç±»å‘¢ï¼Ÿï¼Ÿï¼Ÿ LongAddrä¼˜ç‚¹ï¼šæˆ‘ä»¬ä»ŽAtomicIntegerè¿™ä¸ªç±»çš„å®žçŽ°çœ‹åˆ°ï¼Œä»–æ˜¯åœ¨ä¸€ä¸ªæ­»å¾ªçŽ¯å†…ä¸åœåœ°å°è¯•ä¿®æ”¹ç›®æ ‡å€¼ï¼Œç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚å¦‚æžœç«žäº‰ä¸æ¿€çƒˆçš„æ—¶å€™ï¼Œä¿®æ”¹æˆåŠŸçš„å‡ çŽ‡å¾ˆé«˜ã€‚å¦åˆ™ä¿®æ”¹å¤±è´¥çš„æ¦‚çŽ‡å°±ä¼šå¾ˆé«˜ã€‚åœ¨å¤§é‡ä¿®æ”¹å¤±è´¥çš„æ—¶å€™ï¼Œå¤šæ¬¡å°è¯•ï¼Œæ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚ å¯¹äºŽæ™®é€šç±»åž‹çš„Longå’ŒDoubleå˜é‡ï¼ŒJVMå…è®¸å°†64ä½çš„è¯»æ“ä½œå’Œå†™æ“ä½œæ‹†æˆä¸¤ä¸ª32ä½çš„æ“ä½œã€‚ æˆ‘ä»¬çŸ¥é“JUCä¸‹é¢æä¾›çš„åŽŸå­ç±»éƒ½æ˜¯åŸºäºŽUnsafeç±»å®žçŽ°çš„ï¼Œå¹¶ç”±Unsafeæ¥æä¾›CASçš„èƒ½åŠ›ã€‚CAS (compare-and-swap)æœ¬è´¨ä¸Šæ˜¯ç”±çŽ°ä»£CPUåœ¨ç¡¬ä»¶çº§å®žçŽ°çš„åŽŸå­æŒ‡ä»¤ï¼Œå…è®¸è¿›è¡Œæ— é˜»å¡žï¼Œå¤šçº¿ç¨‹çš„æ•°æ®æ“ä½œåŒæ—¶å…¼é¡¾äº†å®‰å…¨æ€§ä»¥åŠæ•ˆçŽ‡ã€‚getAndAddLongæ–¹æ³•ä¼šä»¥volatileçš„è¯­ä¹‰åŽ»è¯»éœ€è¦è‡ªå¢žçš„åŸŸçš„æœ€æ–°å€¼ï¼Œç„¶åŽé€šè¿‡CASåŽ»å°è¯•æ›´æ–°ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¼šç›´æŽ¥æˆåŠŸåŽè¿”å›žï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘ä¸‹å¯èƒ½ä¼šåŒæ—¶æœ‰å¾ˆå¤šçº¿ç¨‹åŒæ—¶å°è¯•è¿™ä¸ªè¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹Aè¯»åˆ°çš„æœ€æ–°å€¼å¯èƒ½å®žé™…å·²ç»è¿‡æœŸäº†ï¼Œå› æ­¤éœ€è¦åœ¨whileå¾ªçŽ¯ä¸­ä¸æ–­çš„é‡è¯•ï¼Œé€ æˆå¾ˆå¤šä¸å¿…è¦çš„å¼€é”€ã€‚ å°†AtomicLongæ ¸å¿ƒæ•°æ®valueåˆ†ç¦»æˆä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªçº¿ç¨‹è®¿é—®æ—¶ï¼Œé€šè¿‡hashç­‰ç®—æ³•ï¼Œæ˜ å°„åˆ°å…¶ä¸­ä¸€ä¸ªæ•°å­—è¿›è¡Œè®¡æ•°ã€‚æœ€ç»ˆçš„è®¡æ•°ç»“æžœåˆ™ä¸ºè¿™ä¸ªæ•°ç»„çš„æ±‚å’Œç´¯åŠ ã€‚å…¶ä¸­çƒ­ç‚¹æ•°æ®valueä¼šè¢«åˆ†ç¦»æˆå¤šä¸ªå•å…ƒçš„cellï¼Œæ¯ä¸ªcellç‹¬è‡ªç»´æŠ¤å†…éƒ¨çš„å€¼ï¼Œå½“å‰å¯¹è±¡çš„å®žé™…å€¼ç”±cellç´¯è®¡åˆæˆã€‚è¿™æ ·ï¼Œçƒ­ç‚¹å°±å¾—åˆ°æœ‰æ•ˆçš„åˆ†ç¦»å¹¶æé«˜äº†å¹¶è¡Œåº¦ã€‚ LongAddråœ¨AtomicLongåŸºç¡€ä¸Šå°†å•ç‚¹çš„æ›´æ–°åŽ‹åŠ›åˆ†æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚ä½Žå¹¶å‘æ—¶é€šè¿‡å¯¹baseç›´æŽ¥æ›´æ–°ï¼Œå¾—åˆ°ä¸ŽAtomicLongä¸€æ ·çš„æ€§èƒ½ã€‚ ç¼ºé™·ï¼šç»Ÿè®¡çš„æ—¶å€™ï¼Œå¦‚æžœæœ‰å¹¶å‘æ›´æ–°ï¼Œä¼šæœ‰ç»Ÿè®¡çš„è¯¯å·®ï¼Œä¾‹å¦‚èŽ·å–ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„IDè¿˜æ˜¯é‡‡ç”¨`AtomicLong`æ›´å¥½ä¸€ç‚¹ã€‚ 5.2 AtomicReference è¿™ä¸ªå…¶å®žå¾ˆç®€å•ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š å…¶å®žè¿™ä¸ªæ–¹æ³•å®žçŽ°çš„æ˜¯å¯¹ä¸€ä¸ªå…±äº«å¯¹è±¡çš„åŽŸå­æ€§æ“ä½œï¼Œä¿è¯å¯¹è±¡æ›´æ–°çš„åŽŸå­æ€§ã€‚ 5.3 AtomicIntegerFieldUpdater å‡è®¾çŽ°åœ¨æœ‰è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯ï¼š ä¸€ç™¾ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªintå¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œè¦æ±‚åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä¿®æ”¹ã€‚ å¯èƒ½æœ‰çš„åŒå­¦ä¼šè¿™ä¹ˆå†™ï¼š æˆ‘ä»¬æ¥åˆ†æžä¸€ä¸‹ï¼Œå¯¹äºŽvolatileå˜é‡ï¼Œå†™çš„æ—¶å€™ä¼šå°†çº¿ç¨‹æœ¬åœ°å†…å­˜çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸Šï¼Œè¯»çš„æ—¶å€™ä¼šå°†ä¸»å†…å­˜çš„æ•°æ®åŠ è½½åˆ°æœ¬åœ°å†…å­˜é‡Œï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯å¯è§è¡Œå’Œå•ä¸ªè¯»/å†™æ“ä½œçš„åŽŸå­æ€§ã€‚ ä½†æ˜¯ä¸Šä¾‹ä¸­å…ˆ å…ˆåˆ¤æ–­:!ischanged å†æ‰§è¡Œèµ‹å€¼æ“ä½œï¼šischanged=true è¯¥ç»„åˆæ“ä½œå°±ä¸èƒ½ä¿è¯åŽŸå­æ€§äº†ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹A A1-&gt;A2 , çº¿ç¨‹B B1-&gt;B2 (ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatileè¯»æˆ–è€…ç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileå†™çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹ä¸¤ä¸ªè¯­å¥é‡æŽ’åºï¼Œæ‰€ä»¥æœ€åŽçš„æ‰§è¡Œé¡ºåºæ»¡è¶³é¡ºåºä¸€è‡´æ€§æ¨¡åž‹çš„)ï¼Œä½†æ˜¯æœ€åŽçš„æ‰§è¡Œç»“æžœå¯èƒ½æ˜¯A1-&gt;B1-&gt;A2-&gt;B2ã€‚ä¸æ»¡è¶³éœ€æ±‚. è¿™ç§æƒ…å†µä¸‹ï¼ŒAtomicIntegerFieldUpdaterå°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ã€‚ å¯¹äºŽè¿™ä¸ªä»£ç çš„ç†è§£å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªä»£ç æ¥ï¼š è¿è¡Œç»“æžœï¼š 12update success 1:200update fail ç”¨AtomicIntegerFieldUpdater.newUpdateræŒ‡å®šç±»é‡Œé¢çš„å±žæ€§ã€‚è¿™é‡Œæˆ‘ä»¬è¦æ›´æ–°Testç±»é‡Œé¢çš„Aå­—æ®µï¼ˆå¿…é¡»æ˜¯volatileä¸”ä¸æ˜¯staticå¯¹è±¡ï¼‰ã€‚update.compareAndSet()æ–¹æ³•ä½¿ç”¨casæœºåˆ¶ï¼Œæ¯æ¬¡æäº¤çš„æ—¶å€™éƒ½æ¯”è¾ƒä¸‹test.aæ˜¯ä¸æ˜¯100ï¼Œå¦‚æžœæ˜¯ï¼Œåˆ™æ›´æ–°ã€‚ æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨finalå˜é‡ï¼Œå› ä¸ºè¯­ä¹‰å†²çªã€‚å¯¹äºŽAtomicIntegerFieldUpdaterå’ŒAtomicLongFieldUpdateråªèƒ½ä¿®æ”¹int/longç±»åž‹çš„å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹å…¶åŒ…è£…ç±»åž‹ï¼ˆInteger/Longï¼‰ã€‚å¦‚æžœè¦ä¿®æ”¹åŒ…è£…ç±»åž‹å°±éœ€è¦ä½¿ç”¨AtomicReferenceFieldUpdaterã€‚ 5.4 AtomicStampedReference å¯¹äºŽä¸Šé¢è¯´çš„AtomicIntegerç­‰å­˜åœ¨ä¸€ä¸ªé—®é¢˜å°±æ˜¯ABAé—®é¢˜ã€‚ ABAé—®é¢˜ï¼šå…¶ä»–çº¿ç¨‹å°†Aæ”¹ä¸ºBï¼Œåˆé‡æ–°æ”¹ä¸ºäº†Aï¼Œæœ¬çº¿ç¨‹ç”¨æœŸæœ›å€¼Aä¸Žä¹‹è¿›è¡Œæ¯”è¾ƒï¼Œå‘çŽ°æ˜¯ç›¸ç­‰çš„ï¼Œåˆ™è¿›è¡Œä¸‹é¢çš„æ“ä½œã€‚å› ä¸ºè¿™ä¸ªå€¼å·²ç»è¢«æ”¹å˜è¿‡ï¼Œè¿™å°±æ˜¯ABAé—®é¢˜ã€‚ è§£å†³ï¼šç”¨ä¸ªç‰ˆæœ¬å·æ¥æŽ§åˆ¶ï¼Œæ¥é˜²æ­¢ABAé—®é¢˜ã€‚ 5.5 AtomicBoolean åœºæ™¯ï¼šè‹¥å¹²ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•åªèƒ½æ‰§è¡Œä¸€æ¬¡ã€‚ å¥½äº†ï¼Œå…¶å®žAtomicåŒ…æœ€æ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯ç”¨æ— é˜»å¡žçš„CASæ¥ä»£æ›¿é”å®žçŽ°é«˜æ€§èƒ½æ“ä½œï¼Œæ˜¯å®žçŽ°çº¿ç¨‹å®‰å…¨çš„ä¸€ç§å¯è¡Œæ–¹æ³•ï¼Œç†è§£äº†CASåŽŸç†å’Œä»–ä»¬çš„åŸºæœ¬ç”¨æ³•å’Œåœºæ™¯ä½¿ç”¨ï¼ŒåŸºæœ¬å°±å¯ä»¥äº†ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[volatileè¯¦è§£]]></title>
    <url>%2F2019%2F02%2F11%2Fthread%2Fvolatile%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[volatileæ˜¯æ¯”è¾ƒé‡è¦çš„å…³é”®å­—ï¼Œå®ƒæ¶‰åŠJMMï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ·±å…¥äº†è§£ã€‚ ä¸€ã€javaå†…å­˜æ¨¡åž‹JMM JMMæœ¬èº«æ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®žå­˜åœ¨ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ç»„è§„åˆ™æˆ–è§„èŒƒï¼Œé€šè¿‡è¿™ç»„è§„èŒƒå®šä¹‰äº†ç¨‹åºä¸­å„ä¸ªå˜é‡(åŒ…æ‹¬å®žä¾‹å­—æ®µï¼Œé™æ€å­—æ®µå’Œæž„æˆæ•°ç»„å¯¹è±¡çš„å…ƒç´ )çš„è®¿é—®æ–¹å¼ã€‚ è¯·åŠ¡å¿…åŒºåˆ†HMMå’ŒJAVAå†…å­˜åŒºåŸŸï¼ŒJMMæè¿°çš„æ˜¯ä¸€ç»„è§„åˆ™ï¼Œå›´ç»•åŽŸå­æ€§ã€æœ‰åºæ€§ä»¥åŠå¯è§æ€§å±•å¼€ã€‚ å¤§å¤šæ•°çš„å˜é‡æ˜¯åªèƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­çš„ï¼Œçº¿ç¨‹ä¹Ÿä¸èƒ½ç›´æŽ¥åŽ»ä¸»å†…å­˜ä¸­è¯»å–æ•°æ®ï¼Œè€Œæ˜¯èŽ·å–æ•°æ®çš„å‰¯æœ¬ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªå‰¯æœ¬è¿›è¡Œä¿®æ”¹åŽï¼Œä¼šåœ¨æŸä¸ªæ—¶æœºåˆ·æ–°å›žä¸»å†…å­˜ã€‚æ¯ä¸ªçº¿ç¨‹ä¹‹é—´çš„å·¥ä½œå†…å­˜çš„å€¼æ˜¯äº’ä¸é€æ˜Žçš„ï¼Œå› æ­¤ä¸èƒ½äº’ç›¸è®¿é—®ï¼Œçº¿ç¨‹é—´çš„é€šä¿¡å¿…é¡»é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚ äºŒã€JMMä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜éƒ½æ”¾äº›ä»€ä¹ˆ ä¸»å†…å­˜ å­˜å‚¨JAVAå®žä¾‹å¯¹è±¡ åŒ…æ‹¬å®žä¾‹å˜é‡ã€ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ å±žäºŽæ•°æ®å…±äº«çš„åŒºåŸŸï¼Œå¤šçº¿ç¨‹å¹¶å‘æ“ä½œæ—¶ä¼šå¼•èµ·çº¿ç¨‹å®‰å…¨é—®é¢˜ å·¥ä½œå†…å­˜ å­˜å‚¨å½“å‰æ–¹æ³•çš„æ‰€æœ‰æœ¬åœ°å˜é‡ä¿¡æ¯ï¼Œæœ¬åœ°å˜é‡å¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§(æ–¹æ³•é‡Œçš„åŸºæœ¬æ•°æ®ç±»åž‹ä¼šç›´æŽ¥è¢«å­˜å‚¨åœ¨å·¥ä½œå†…å­˜çš„æ ˆå¸§ç»“æž„ä¸­) å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ã€Nativeæ–¹æ³•ä¿¡æ¯ å¦‚æžœæ˜¯å¼•ç”¨ç±»åž‹ï¼Œå¼•ç”¨å­˜å‚¨åœ¨å·¥ä½œå†…å­˜ä¸­ï¼Œå®žä¾‹å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ å±žäºŽçº¿ç¨‹ç§æœ‰æ•°æ®åŒºåŸŸï¼Œä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ ä¸‰ã€æŒ‡ä»¤é‡æŽ’åº ä¸ºäº†æé«˜æ‰§è¡Œæ€§èƒ½ï¼ŒJVMä¼šè¿›è¡Œä¸€å®šçš„æŒ‡ä»¤é‡æŽ’åºï¼Œç¦æ­¢æ–¹å¼å°±æ˜¯åŠ å…¥å†…å­˜å±éšœæŒ‡ä»¤ï¼Œä¸‹é¢ä¼šè¯´ã€‚ å½“ç„¶äº†ï¼ŒæŒ‡ä»¤é‡æŽ’åºéœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼š åœ¨å•çº¿ç¨‹çŽ¯å¢ƒä¸‹ä¸èƒ½æ”¹å˜ç¨‹åºè¿è¡Œçš„ç»“æžœ å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸å…è®¸é‡æŽ’åº æ— æ³•é€šè¿‡happend-beforeåŽŸåˆ™æŽ¨å¯¼å‡ºæ¥çš„ï¼Œæ‰èƒ½è¿›è¡ŒæŒ‡ä»¤çš„é‡æŽ’åºã€‚ å››ã€happend-before å¤šçº¿ç¨‹æœ‰ä¸¤ä¸ªåŸºæœ¬çš„é—®é¢˜ï¼Œå°±æ˜¯åŽŸå­æ€§å’Œå¯è§æ€§ï¼Œè€Œhappens-beforeè§„åˆ™å°±æ˜¯ç”¨æ¥è§£å†³å¯è§æ€§çš„ã€‚ å³ï¼šåœ¨æ—¶é—´ä¸Šï¼ŒåŠ¨ä½œAå‘ç”Ÿåœ¨åŠ¨ä½œBä¹‹å‰ï¼Œèƒ½ä¸èƒ½ä¿è¯Bå¯ä»¥çœ‹è§Aï¼Ÿå¦‚æžœå¯ä»¥ä¿è¯çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯´hb(A,B) 12345678910111213141516class VolatileExample &#123; int a = 0; volatile boolean flag = false; public void writer() &#123; a = 1; //1 flag = true; //2 &#125; public void reader() &#123; if (flag) &#123; //3 int i = a; //4 â€¦â€¦ &#125; &#125;&#125; å‡è®¾çº¿ç¨‹Aæ‰§è¡Œwriter()æ–¹æ³•ä¹‹åŽï¼Œçº¿ç¨‹Bæ‰§è¡Œreader()æ–¹æ³•ã€‚æ ¹æ®happens beforeè§„åˆ™ï¼Œè¿™ä¸ªè¿‡ç¨‹å»ºç«‹çš„happens before å…³ç³»å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š æ ¹æ®ç¨‹åºæ¬¡åºè§„åˆ™ï¼Œ1 happens before 2; 3 happens before 4ã€‚ æ ¹æ®volatileè§„åˆ™ï¼Œ2 happens before 3ã€‚ æ ¹æ®happens before çš„ä¼ é€’æ€§è§„åˆ™ï¼Œ1 happens before 4ã€‚ ä¸Šè¿°happens before å…³ç³»çš„å›¾å½¢åŒ–è¡¨çŽ°å½¢å¼å¦‚ä¸‹ï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªç®­å¤´é“¾æŽ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä»£è¡¨äº†ä¸€ä¸ªhappens before å…³ç³»ã€‚é»‘è‰²ç®­å¤´è¡¨ç¤ºç¨‹åºé¡ºåºè§„åˆ™ï¼›æ©™è‰²ç®­å¤´è¡¨ç¤ºvolatileè§„åˆ™ï¼›è“è‰²ç®­å¤´è¡¨ç¤ºç»„åˆè¿™äº›è§„åˆ™åŽæä¾›çš„happens beforeä¿è¯ã€‚ è¿™é‡ŒAçº¿ç¨‹å†™ä¸€ä¸ªvolatileå˜é‡åŽï¼ŒBçº¿ç¨‹è¯»åŒä¸€ä¸ªvolatileå˜é‡ã€‚Açº¿ç¨‹åœ¨å†™volatileå˜é‡ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨Bçº¿ç¨‹è¯»åŒä¸€ä¸ªvolatileå˜é‡åŽï¼Œå°†ç«‹å³å˜å¾—å¯¹Bçº¿ç¨‹å¯è§ã€‚ è¯´äº†é‚£ä¹ˆå¤šï¼Œjavaä¸­æ˜¯å¦‚ä½•ä¿è¯è¿™ç§å¯è§æ€§çš„å‘¢ï¼ŸVolatileé—ªäº®ç™»åœºã€‚ äº”ã€ä»€ä¹ˆæ˜¯volatile volatileå…³é”®å­—çš„ç›®çš„æ˜¯ä¿è¯è¢«å®ƒä¿®é¥°çš„å…±äº«å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹æ€»æ˜¯å¯è§çš„ã€‚ å…­ã€ä¸ºä»€ä¹ˆè¦ç”¨volatile Volatileå˜é‡ä¿®é¥°ç¬¦å¦‚æžœä½¿ç”¨æ°å½“çš„è¯ï¼Œå®ƒæ¯”synchronizedçš„ä½¿ç”¨å’Œæ‰§è¡Œæˆæœ¬ä¼šæ›´ä½Žï¼Œå› ä¸ºå®ƒä¸ä¼šå¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œè°ƒåº¦ã€‚ ä¸€æ—¦ä¸€ä¸ªå…±äº«å˜é‡ï¼ˆç±»çš„æˆå‘˜å˜é‡ã€ç±»çš„é™æ€æˆå‘˜å˜é‡ï¼‰è¢«volatileä¿®é¥°ä¹‹åŽï¼Œé‚£ä¹ˆå°±å…·å¤‡äº†ä¸¤å±‚è¯­ä¹‰ï¼š ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„ã€‚ ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æŽ’åºã€‚ ä¸ƒã€volatileå¦‚ä½•ä¿è¯å¯è§æ€§ voliatileå…³é”®å­—ä¿è¯äº†åœ¨è¿›ç¨‹ä¸­å˜é‡çš„å˜åŒ–çš„å¯è§æ€§ã€‚ åœ¨å¤šçº¿ç¨‹çš„åº”ç”¨é‡Œï¼Œå¦‚æžœçº¿ç¨‹æ“ä½œäº†ä¸€ä¸ªæ²¡æœ‰è¢«volatileå…³é”®å­—æ ‡è®°çš„å˜é‡ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šåœ¨ä½¿ç”¨åˆ°è¿™ä¸ªå˜é‡æ—¶ä»Žä¸»å­˜é‡Œæ‹·è´è¿™ä¸ªå˜é‡åˆ°CPUçš„cacheé‡Œé¢ï¼ˆä¸ºäº†æ€§èƒ½ï¼CPUç¼“å­˜å¯æ¯”å†…å­˜å¿«å¤šäº†ï¼‰ã€‚å¦‚æžœä½ çš„ç”µè„‘æœ‰å¤šäºŽä¸€ä¸ªCPUï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šåœ¨ä¸åŒçš„CPUä¸Šé¢è¿è¡Œï¼Œè¿™æ„å‘³ç€æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæŠŠè¿™ä¸ªå˜é‡æ‹·è´åˆ°ä¸åŒçš„CPU cacheé‡Œé¢ï¼Œæ­£å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸€ä¸ªä¸å¸¦æœ‰volatileå…³é”®å­—çš„å˜é‡åœ¨JVMä»Žä¸»å­˜é‡Œé¢è¯»å–æ•°æ®åˆ°CPU cacheæˆ–è€…ä»Žcacheé‡Œé¢å†™å…¥æ•°æ®åˆ°ä¸»å­˜æ—¶æ˜¯æ²¡æœ‰ä¿è¯çš„ã€‚ æƒ³è±¡è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œå½“ä¸€åˆ°ä¸¤ä¸ªçº¿ç¨‹å…è®¸åŽ»å…±äº«ä¸€ä¸ªåŒ…å«äº†ä¸€ä¸ªè®¡æ•°å˜é‡çš„å¯¹è±¡ï¼Œè¿™ä¸ªè®¡æ•°å˜é‡å¦‚ä¸‹æ‰€å®šä¹‰ 12345public class SharedObject &#123; public int counter = 0; //æ— å…³é”®å­—&#125; ç„¶åŽï¼Œè¿™çº¿ç¨‹ä¸€å¢žåŠ äº†counterå˜é‡çš„å€¼ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯åŒæ—¶çº¿ç¨‹ä¸€å’Œçº¿ç¨‹äºŒéƒ½æœ‰å¯èƒ½éšæ—¶è¯»å–è¿™ä¸ªcounterå˜é‡ã€‚ å¦‚æžœè¿™ä¸ªcounterå˜é‡æœªæ›¾ä½¿ç”¨volatileå£°æ˜Žï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•ä¿è¯è¿™ä¸ªå˜é‡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­æ‰€ä½äºŽçš„CPUçš„cacheå’Œä¸»å­˜ä¸­çš„å€¼æ˜¯å¦ä¿æŒä¸€è‡´äº†ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š é‚£ä¹ˆéƒ¨åˆ†çš„çº¿ç¨‹å°±ä¸èƒ½çœ‹åˆ°è¿™ä¸ªå˜é‡æœ€æ–°çš„æ ·å­ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡è¿˜æ²¡æœ‰è¢«çº¿ç¨‹å†™å›žåˆ°ä¸»å­˜ä¸­ï¼Œè¿™å°±æ˜¯å¯è§æ€§çš„é—®é¢˜ï¼Œè¿™ä¸ªçº¿ç¨‹æ›´æ–°çš„å˜é‡å¯¹äºŽå…¶ä»–çº¿ç¨‹æ˜¯ä¸å¯è§†çš„ã€‚ åœ¨å£°æ˜Žäº†counterå˜é‡çš„volatileå…³é”®å­—åŽï¼Œæ‰€æœ‰å†™å…¥åˆ°counterå˜é‡çš„å€¼ä¼šè¢«ç«‹å³å†™å›žåˆ°ä¸»å­˜ä¸­ã€‚åŒæ—¶ï¼Œæ‰€æœ‰è¯»å–è¿™ä¸ªå˜é‡çš„çº¿ç¨‹ä¼šå…ˆæŠŠå¯¹åº”çš„å·¥ä½œå†…å­˜ç½®ä¸ºæ— æ•ˆï¼Œä»Žä¸»å­˜é‡Œé¢è¯»å–è¿™ä¸ªå˜é‡ï¼Œä¸‹é¢çš„ä»£ç å°±æ˜¯å£°æ˜Žå¸¦volatileå…³é”®å­—çš„å˜é‡çš„æ–¹æ³• 12345public class SharedObject &#123; public volatile int counter = 0;&#125; å¦‚æ­¤å£°æ˜Žè¿™ä¸ªå˜é‡å°±ä¿è¯äº†è¿™ä¸ªå˜é‡å¯¹äºŽå…¶ä»–å†™è¿™ä¸ªå˜é‡çš„çº¿ç¨‹çš„å¯è§æ€§ã€‚ æ€»ç»“ï¼š å¤„ç†å™¨ä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦ï¼Œä¸ç›´æŽ¥å’Œå†…å­˜è¿›è¡Œé€šè®¯ï¼Œè€Œæ˜¯å…ˆå°†ç³»ç»Ÿå†…å­˜çš„æ•°æ®è¯»åˆ°å†…éƒ¨ç¼“å­˜ï¼ˆL1,L2æˆ–å…¶ä»–ï¼‰åŽå†è¿›è¡Œæ“ä½œï¼Œä½†æ“ä½œå®Œä¹‹åŽä¸çŸ¥é“ä½•æ—¶ä¼šå†™åˆ°å†…å­˜ï¼Œå¦‚æžœå¯¹å£°æ˜Žäº†Volatileå˜é‡è¿›è¡Œå†™æ“ä½œï¼ŒJVMå°±ä¼šå‘å¤„ç†å™¨å‘é€ä¸€æ¡Lockå‰ç¼€çš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸ªå˜é‡æ‰€åœ¨ç¼“å­˜è¡Œçš„æ•°æ®å†™å›žåˆ°ç³»ç»Ÿå†…å­˜ã€‚ä½†æ˜¯å°±ç®—å†™å›žåˆ°å†…å­˜ï¼Œå¦‚æžœå…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„å€¼è¿˜æ˜¯æ—§çš„ï¼Œå†æ‰§è¡Œè®¡ç®—æ“ä½œå°±ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥åœ¨å¤šå¤„ç†å™¨ä¸‹ï¼Œä¸ºäº†ä¿è¯å„ä¸ªå¤„ç†å™¨çš„ç¼“å­˜æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¼šå®žçŽ°ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œæ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æŽ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±ç¼“å­˜çš„å€¼æ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå½“å¤„ç†å™¨å‘çŽ°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®æˆæ— æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œä¼šå¼ºåˆ¶é‡æ–°ä»Žç³»ç»Ÿå†…å­˜é‡ŒæŠŠæ•°æ®è¯»åˆ°å¤„ç†å™¨ç¼“å­˜é‡Œã€‚ å…«ã€æ¥è¯¦ç»†è¯´è¯´volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰ volatileå†™çš„å†…å­˜è¯­ä¹‰å¦‚ä¸‹ï¼š å½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ ä»¥ä¸Šé¢ç¤ºä¾‹ç¨‹åºVolatileExampleä¸ºä¾‹ï¼Œå‡è®¾çº¿ç¨‹Aé¦–å…ˆæ‰§è¡Œwriter()æ–¹æ³•ï¼ŒéšåŽçº¿ç¨‹Bæ‰§è¡Œreader()æ–¹æ³•ï¼Œåˆå§‹æ—¶ä¸¤ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¸­çš„flagå’Œaéƒ½æ˜¯åˆå§‹çŠ¶æ€ã€‚ä¸‹å›¾æ˜¯çº¿ç¨‹Aæ‰§è¡Œvolatileå†™åŽï¼Œå…±äº«å˜é‡çš„çŠ¶æ€ç¤ºæ„å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçº¿ç¨‹Aåœ¨å†™flagå˜é‡åŽï¼Œæœ¬åœ°å†…å­˜Aä¸­è¢«çº¿ç¨‹Aæ›´æ–°è¿‡çš„ä¸¤ä¸ªå…±äº«å˜é‡çš„å€¼è¢«åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚æ­¤æ—¶ï¼Œæœ¬åœ°å†…å­˜Aå’Œä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚ volatileè¯»çš„å†…å­˜è¯­ä¹‰å¦‚ä¸‹ï¼š å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚çº¿ç¨‹æŽ¥ä¸‹æ¥å°†ä»Žä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨è¯»flagå˜é‡åŽï¼Œæœ¬åœ°å†…å­˜Bå·²ç»è¢«ç½®ä¸ºæ— æ•ˆã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹Bå¿…é¡»ä»Žä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚çº¿ç¨‹Bçš„è¯»å–æ“ä½œå°†å¯¼è‡´æœ¬åœ°å†…å­˜Bä¸Žä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡çš„å€¼ä¹Ÿå˜æˆä¸€è‡´çš„äº†ã€‚ å¦‚æžœæˆ‘ä»¬æŠŠvolatileå†™å’Œvolatileè¯»è¿™ä¸¤ä¸ªæ­¥éª¤ç»¼åˆèµ·æ¥çœ‹çš„è¯ï¼Œåœ¨è¯»çº¿ç¨‹Bè¯»ä¸€ä¸ªvolatileå˜é‡åŽï¼Œå†™çº¿ç¨‹Aåœ¨å†™è¿™ä¸ªvolatileå˜é‡ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡çš„å€¼éƒ½å°†ç«‹å³å˜å¾—å¯¹è¯»çº¿ç¨‹Bå¯è§ã€‚ ä¸‹é¢å¯¹volatileå†™å’Œvolatileè¯»çš„å†…å­˜è¯­ä¹‰åšä¸ªæ€»ç»“ï¼š çº¿ç¨‹Aå†™ä¸€ä¸ªvolatileå˜é‡ï¼Œå®žè´¨ä¸Šæ˜¯çº¿ç¨‹Aå‘æŽ¥ä¸‹æ¥å°†è¦è¯»è¿™ä¸ªvolatileå˜é‡çš„æŸä¸ªçº¿ç¨‹å‘å‡ºäº†ï¼ˆå…¶å¯¹å…±äº«å˜é‡æ‰€åœ¨ä¿®æ”¹çš„ï¼‰æ¶ˆæ¯ã€‚ çº¿ç¨‹Bè¯»ä¸€ä¸ªvolatileå˜é‡ï¼Œå®žè´¨ä¸Šæ˜¯çº¿ç¨‹BæŽ¥æ”¶äº†ä¹‹å‰æŸä¸ªçº¿ç¨‹å‘å‡ºçš„ï¼ˆåœ¨å†™è¿™ä¸ªvolatileå˜é‡ä¹‹å‰å¯¹å…±äº«å˜é‡æ‰€åšä¿®æ”¹çš„ï¼‰æ¶ˆæ¯ã€‚ çº¿ç¨‹Aå†™ä¸€ä¸ªvolatileå˜é‡ï¼ŒéšåŽçº¿ç¨‹Bè¯»è¿™ä¸ªvolatileå˜é‡ï¼Œè¿™ä¸ªè¿‡ç¨‹å®žè´¨ä¸Šæ˜¯çº¿ç¨‹Aé€šè¿‡ä¸»å†…å­˜å‘çº¿ç¨‹Bå‘é€æ¶ˆæ¯ã€‚ ä¹ã€volatileå¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æŽ’åº è¿™å°±ä¸å¾—ä¸æä¸€ä¸ªæŒ‡ä»¤å«åšï¼šå†…å­˜å±éšœäº†ã€‚ å®ƒå¯å°±åŽ‰å®³äº†ï¼Œ ä¿è¯ç‰¹å®šæ“ä½œçš„æ‰§è¡Œé¡ºåº ä¿è¯æŸäº›å˜é‡çš„å†…å­˜å¯è§æ€§ é€šè¿‡æ’å…¥å†…å­˜å±éšœæŒ‡ä»¤ç¦æ­¢åœ¨å†…å­˜å±éšœå‰åŽçš„æŒ‡ä»¤æ‰§è¡Œé‡æŽ’åºä¼˜åŒ–ã€‚ è¿™ä¸ªæŒ‡ä»¤å¯¹ç¼–è¯‘å™¨å’ŒCPUçš„æ‰§è¡Œéƒ½æ˜¯èµ·ä½œç”¨çš„ï¼Œå¯ç”¨å¼ºåˆ¶åˆ·å‡ºå„ç§CPUçš„ç¼“å­˜æ•°æ®ï¼Œå› æ­¤ä»»ä½•CPUä¸Šçš„çº¿ç¨‹éƒ½èƒ½è¯»å–åˆ°è¿™äº›æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ã€‚ å› æ­¤ï¼Œä»Žæ ¹æœ¬ä¸Šæ¥è¯´ï¼Œæ˜¯å†…å­˜å±éšœæŒ‡ä»¤å®žçŽ°äº†volatileçš„å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æŽ’åºçš„ã€‚ åã€volatileçš„åº”ç”¨åœºæ™¯ volatileå…³é”®å­—åªèƒ½å¯¹32ä½å’Œ64ä½çš„å˜é‡ä½¿ç”¨ synchronizedå…³é”®å­—æ˜¯é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä¸€æ®µä»£ç ï¼Œé‚£ä¹ˆå°±ä¼šå¾ˆå½±å“ç¨‹åºæ‰§è¡Œæ•ˆçŽ‡ï¼Œè€Œvolatileå…³é”®å­—åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½è¦ä¼˜äºŽsynchronizedï¼Œä½†æ˜¯è¦æ³¨æ„volatileå…³é”®å­—æ˜¯æ— æ³•æ›¿ä»£synchronizedå…³é”®å­—çš„ï¼Œå› ä¸ºvolatileå…³é”®å­—æ— æ³•ä¿è¯æ“ä½œçš„åŽŸå­æ€§ã€‚é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨volatileå¿…é¡»å…·å¤‡ä»¥ä¸‹2ä¸ªæ¡ä»¶ï¼š 1ï¼‰å¯¹å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–äºŽå½“å‰å€¼ 2ï¼‰è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„ä¸å˜å¼ä¸­ ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªJavaä¸­ä½¿ç”¨volatileçš„å‡ ä¸ªåœºæ™¯ã€‚ â‘ .çŠ¶æ€æ ‡è®°é‡ 123456789volatile boolean flag = false; //çº¿ç¨‹1while(!flag)&#123; doSomething();&#125; //çº¿ç¨‹2public void setFlag() &#123; flag = true;&#125; â‘¡.å•ä¾‹æ¨¡å¼ä¸­çš„double check 1234567891011121314151617class Singleton&#123; private volatile static Singleton instance = null; private Singleton() &#123; &#125; public static Singleton getInstance() &#123; if(instance==null) &#123; synchronized (Singleton.class) &#123; if(instance==null) instance = new Singleton();//éžåŽŸå­æ“ä½œ &#125; &#125; return instance; &#125;&#125; instance = new Singleton();//éžåŽŸå­æ“ä½œ æ‰§è¡Œè¿™ä¸€å¥ï¼ŒJVMå‘ç”Ÿäº†å¦‚ä¸‹äº‹æƒ…ï¼š ç»™ instance åˆ†é…å†…å­˜ è°ƒç”¨ Singleton çš„æž„é€ å‡½æ•°æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ å°†instanceå¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆæ‰§è¡Œå®Œè¿™æ­¥ instance å°±ä¸ºéž null äº†ï¼‰ ä½†æ˜¯åœ¨ JVM çš„å³æ—¶ç¼–è¯‘å™¨ä¸­å­˜åœ¨æŒ‡ä»¤é‡æŽ’åºçš„ä¼˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥çš„é¡ºåºæ˜¯ä¸èƒ½ä¿è¯çš„ï¼Œæœ€ç»ˆçš„æ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ 1-2-3 ä¹Ÿå¯èƒ½æ˜¯ 1-3-2ã€‚å¦‚æžœæ˜¯åŽè€…ï¼Œåˆ™åœ¨ 3 æ‰§è¡Œå®Œæ¯•ã€2 æœªæ‰§è¡Œä¹‹å‰ï¼Œè¢«çº¿ç¨‹äºŒæŠ¢å äº†ï¼Œè¿™æ—¶ instance å·²ç»æ˜¯éž null äº†ï¼ˆä½†å´æ²¡æœ‰åˆå§‹åŒ–ï¼‰ï¼Œæ‰€ä»¥çº¿ç¨‹äºŒä¼šç›´æŽ¥è¿”å›ž instanceï¼Œç„¶åŽä½¿ç”¨ï¼Œç„¶åŽé¡ºç†æˆç« åœ°å‡ºé”™äº†ï¼Œä¸å†æ˜¯å•ä¾‹äº†ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¯»å†™é”ReentrantReadWriteLock]]></title>
    <url>%2F2019%2F02%2F11%2Fthread%2F%E8%AF%BB%E5%86%99%E9%94%81ReentrantReadWriteLock%2F</url>
    <content type="text"><![CDATA[è¯»å†™é”çš„å‡ºçŽ°æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ€æƒ³æ˜¯ï¼šè¯»è¯»ä¸äº’æ–¥ï¼Œè¯»å†™äº’æ–¥ï¼Œå†™å†™äº’æ–¥ã€‚æœ¬æ–‡æ¥äº†è§£ä¸€ä¸‹è¯»å†™é”çš„ä½¿ç”¨å’Œé”é™çº§çš„æ¦‚å¿µã€‚ 1. é”çš„åˆ†ç±» æŽ’ä»–é”ï¼šåœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ï¼› è¯»å†™é”ï¼šåœ¨åŒä¸€æ—¶åˆ»å…è®¸å¤šä¸ªè¯»çº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯å½“å†™çº¿ç¨‹è®¿é—®ï¼Œæ‰€æœ‰çš„å†™çº¿ç¨‹å’Œè¯»çº¿ç¨‹å‡è¢«é˜»å¡žã€‚è¯»å†™é”ç»´æŠ¤äº†ä¸€ä¸ªè¯»é”åŠ ä¸€ä¸ªå†™é”ï¼Œé€šè¿‡è¯»å†™é”åˆ†ç¦»çš„æ¨¡å¼æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½é«˜äºŽä¸€èˆ¬çš„æŽ’ä»–é”ã€‚ 2. è¯»å†™é” æˆ‘ä»¬å¯¹æ•°æ®çš„æ“ä½œæ— éžä¸¤ç§ï¼šâ€œè¯»â€å’Œâ€œå†™â€ï¼Œè¯•æƒ³ä¸€ä¸ªè¿™æ ·çš„æƒ…æ™¯ï¼Œå½“åä¸ªçº¿ç¨‹åŒæ—¶è¯»å–æŸä¸ªæ•°æ®æ—¶ï¼Œè¿™ä¸ªæ“ä½œåº”ä¸åº”è¯¥åŠ åŒæ­¥ã€‚ç­”æ¡ˆæ˜¯æ²¡å¿…è¦çš„ã€‚åªæœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µéœ€è¦åŠ åŒæ­¥ï¼š è¿™åä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªå…¬å…±æ•°æ®æ—¢æœ‰è¯»åˆæœ‰å†™ è¿™åä¸ªçº¿ç¨‹å¯¹å…¬å…±æ•°æ®è¿›è¡Œå†™æ“ä½œ ä»¥ä¸Šä¸¤ç‚¹å½’ç»“èµ·æ¥å°±ä¸€ç‚¹å°±æ˜¯æœ‰å¯¹æ•°æ®è¿›è¡Œæ”¹å˜çš„æ“ä½œå°±éœ€è¦åŒæ­¥ æ‰€ä»¥ java5æä¾›äº†è¯»å†™é”è¿™ç§é”æ”¯æŒå¤šçº¿ç¨‹è¯»æ“ä½œä¸äº’æ–¥ï¼Œå¤šçº¿ç¨‹è¯»å†™äº’æ–¥ï¼Œå¤šçº¿ç¨‹å†™äº’æ–¥ã€‚è¯»æ“ä½œä¸äº’æ–¥è¿™æ ·æœ‰åŠ©äºŽæ€§èƒ½çš„æé«˜ï¼Œè¿™ç‚¹åœ¨java5ä»¥å‰æ²¡æœ‰ã€‚ 3. javaå¹¶å‘åŒ…æä¾›çš„è¯»å†™é” javaå¹¶å‘åŒ…æä¾›äº†è¯»å†™é”çš„å…·ä½“å®žçŽ°ReentrantReadWriteLockï¼Œå®ƒä¸»è¦æä¾›äº†ä¸€ä¸‹ç‰¹æ€§ï¼š å…¬å¹³æ€§é€‰æ‹©ï¼šæ”¯æŒå…¬å¹³å’Œéžå…¬å¹³ï¼ˆé»˜è®¤ï¼‰ä¸¤ç§èŽ·å–é”çš„æ–¹å¼ï¼Œéžå…¬å¹³é”çš„åžåé‡ä¼˜äºŽå…¬å¹³é”ï¼› å¯é‡å…¥ï¼šæ”¯æŒå¯é‡å…¥ï¼Œè¯»çº¿ç¨‹åœ¨èŽ·å–è¯»é”ä¹‹åŽèƒ½å¤Ÿå†æ¬¡èŽ·å–è¯»é”ï¼Œå†™çº¿ç¨‹åœ¨èŽ·å–äº†å†™é”ä¹‹åŽèƒ½å¤Ÿå†æ¬¡èŽ·å–å†™é”ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥èŽ·å–è¯»é”ï¼› é”é™çº§ï¼šçº¿ç¨‹èŽ·å–é”çš„é¡ºåºéµå¾ªèŽ·å–å†™é”ï¼ŒèŽ·å–è¯»é”ï¼Œé‡Šæ”¾å†™é”ï¼Œå†™é”å¯ä»¥é™çº§æˆä¸ºè¯»é”ã€‚ 4. å…ˆçœ‹ä¸ªå°ä¾‹å­ è¯»å–æ•°æ®å’Œå†™å…¥æ•°æ® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657import java.util.HashMap;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReadWriteLock;import java.util.concurrent.locks.ReentrantReadWriteLock;public class Demo &#123; //å®šä¹‰ä¸€ä¸ªmapç”¨æ¥è¯»å–å’Œå­˜æ”¾æ•°æ® private HashMap&lt;String,String&gt; map = new HashMap&lt;String,String&gt;(); //å®žä¾‹åŒ–ReentrantReadWriteLock private ReadWriteLock rwl = new ReentrantReadWriteLock(); //æ ¹æ®å®žä¾‹åŒ–å¯¹è±¡åˆ†åˆ«èŽ·å–è¯»é”å’Œå†™é” private Lock r = rwl.readLock(); private Lock w = rwl.writeLock(); //è¯»å–æ•°æ® public void get(String key)&#123; //ä¸Šè¯»é” r.lock(); System.out.println(Thread.currentThread().getName()+" è¯»æ“ä½œå¼€å§‹æ‰§è¡Œ"); try&#123; try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; //è¯»å–æ•°æ® System.out.println(map.get(key)); &#125;finally &#123; //è§£è¯»é” r.unlock(); System.out.println(Thread.currentThread().getName()+" è¯»æ“ä½œæ‰§è¡Œå®Œæ¯•"); &#125; &#125; //å­˜å…¥æ•°æ®ï¼Œå³å†™æ•°æ® public void put(String key,String value)&#123; //ä¸Šå†™é” w.lock(); System.out.println(Thread.currentThread().getName()+" å†™æ“ä½œå¼€å§‹æ‰§è¡Œ"); try&#123; try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; //å†™æ•°æ® map.put(key, value); &#125;finally&#123; //è§£å†™é” w.unlock(); System.out.println(Thread.currentThread().getName()+" å†™æ“ä½œæ‰§è¡Œå®Œæ¯•"); &#125; &#125; &#125; Mainè¿›è¡Œåˆ›å»ºå¤šçº¿ç¨‹æµ‹è¯•ï¼šå…ˆæ¥æµ‹è¯•ä¸€ä¸‹å­˜åœ¨å†™çš„æƒ…å†µ(åªæœ‰å†™æˆ–è€…å†™è¯»éƒ½æœ‰) 1234567891011121314151617181920212223242526272829303132333435363738public class Main &#123; public static void main(String[] args) &#123; Demo demo = new Demo(); //å†™ new Thread(new Runnable() &#123; @Override public void run() &#123; demo.put("key1", "value1"); &#125; &#125;).start(); //è¯» new Thread(new Runnable() &#123; @Override public void run() &#123; demo.get("key1"); &#125; &#125;).start(); //å†™ new Thread(new Runnable() &#123; @Override public void run() &#123; demo.put("key2", "value2"); &#125; &#125;).start(); //å†™ new Thread(new Runnable() &#123; @Override public void run() &#123; demo.put("key3", "value3"); &#125; &#125;).start(); &#125;&#125; æ‰§è¡Œç»“æžœï¼š 123456789Thread-0 å†™æ“ä½œå¼€å§‹æ‰§è¡ŒThread-0 å†™æ“ä½œæ‰§è¡Œå®Œæ¯•Thread-1 è¯»æ“ä½œå¼€å§‹æ‰§è¡Œvalue1Thread-1 è¯»æ“ä½œæ‰§è¡Œå®Œæ¯•Thread-2 å†™æ“ä½œå¼€å§‹æ‰§è¡ŒThread-2 å†™æ“ä½œæ‰§è¡Œå®Œæ¯•Thread-3 å†™æ“ä½œå¼€å§‹æ‰§è¡ŒThread-3 å†™æ“ä½œæ‰§è¡Œå®Œæ¯• åˆ†æžï¼š å‘çŽ°å­˜åœ¨å†™çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªåŒæ­¥ç­‰å¾…çš„è¿‡ç¨‹ï¼Œå³å¼€å§‹æ‰§è¡Œï¼Œç„¶åŽç­‰å¾…3ç§’ï¼Œæ‰§è¡Œå®Œæ¯•ï¼Œç¬¦åˆç¬¬2ä¸ªç›®å½•ä¸­æåˆ°çš„è§„åˆ™ã€‚ å¯¹åªæœ‰è¯»æ“ä½œçš„æƒ…å½¢è¿›è¡Œæµ‹è¯• 123456789101112131415161718192021222324252627282930public class Main &#123; public static void main(String[] args) &#123; Demo demo = new Demo(); demo.put("key1", "value1"); demo.put("key2", "value2"); demo.put("key3", "value3"); new Thread(new Runnable() &#123; @Override public void run() &#123; demo.get("key1"); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; demo.get("key2"); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; demo.get("key3"); &#125; &#125;).start(); &#125;&#125; è¿è¡Œç»“æžœï¼š 123456789Thread-0 è¯»æ“ä½œå¼€å§‹æ‰§è¡ŒThread-1 è¯»æ“ä½œå¼€å§‹æ‰§è¡ŒThread-2 è¯»æ“ä½œå¼€å§‹æ‰§è¡Œvalue1Thread-0 è¯»æ“ä½œæ‰§è¡Œå®Œæ¯•value2Thread-1 è¯»æ“ä½œæ‰§è¡Œå®Œæ¯•value3Thread-2 è¯»æ“ä½œæ‰§è¡Œå®Œæ¯• åˆ†æž åœ¨ä¸»çº¿ç¨‹ä¸­å…ˆputè¿›åŽ»å‡ ä¸ªæ•°ç”¨äºŽè¯»çš„æµ‹è¯•ï¼Œä¸‹é¢å¼€è¾Ÿä¸‰ä¸ªè¯»çº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»Žæ‰§è¡Œç»“æžœä¸­å‘çŽ°ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹è¿›åŽ»ä¹‹åŽï¼Œå¦å¤–çš„çº¿ç¨‹èƒ½å¤Ÿç«‹å³å†æ¬¡è¿›å…¥ï¼Œå³è¿™ä¸‰æŠŠé”ä¸æ˜¯äº’æ–¥çš„ã€‚ 5. é”é™çº§ é”é™çº§æ˜¯æŒ‡å†™é”å°†ä¸ºè¯»é”ã€‚ é”é™çº§ï¼šä»Žå†™é”å˜æˆè¯»é”ï¼›é”å‡çº§ï¼šä»Žè¯»é”å˜æˆå†™é”ã€‚è¯»é”æ˜¯å¯ä»¥è¢«å¤šçº¿ç¨‹å…±äº«çš„ï¼Œå†™é”æ˜¯å•çº¿ç¨‹ç‹¬å çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å†™é”çš„å¹¶å‘é™åˆ¶æ¯”è¯»é”é«˜ï¼Œè¿™å¯èƒ½å°±æ˜¯å‡çº§/é™çº§åç§°çš„æ¥æºã€‚ å¦‚ä¸‹ä»£ç ä¼šäº§ç”Ÿæ­»é”ï¼Œå› ä¸ºåŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåœ¨æ²¡æœ‰é‡Šæ”¾è¯»é”çš„æƒ…å†µä¸‹ï¼Œå°±åŽ»ç”³è¯·å†™é”ï¼Œè¿™å±žäºŽé”å‡çº§ï¼ŒReentrantReadWriteLockæ˜¯ä¸æ”¯æŒçš„ã€‚ 12345ReadWriteLock rtLock = new ReentrantReadWriteLock(); rtLock.readLock().lock(); //ä¸Šè¯»é”System.out.println("get readLock."); rtLock.writeLock().lock(); //è¯»é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œä¸å…è®¸ä¸Šæ­»é”System.out.println("blocking"); ReentrantReadWriteLockæ”¯æŒé”é™çº§ï¼Œå¦‚ä¸‹ä»£ç ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚ 123456ReadWriteLock rtLock = new ReentrantReadWriteLock(); rtLock.writeLock().lock(); //ä¸Šå†™é”System.out.println("writeLock"); rtLock.readLock().lock(); //å¯ä»¥åœ¨å†™é”æ²¡æœ‰é‡Šæ”¾çš„æ—¶å€™ç«‹å³ä¸Šè¯»é”System.out.println("get read lock"); åˆ©ç”¨è¿™ä¸ªæœºåˆ¶ï¼šåŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåœ¨æ²¡æœ‰é‡Šæ”¾è¯»é”çš„æƒ…å†µä¸‹ï¼Œå°±åŽ»ç”³è¯·å†™é”ï¼Œè¿™å±žäºŽé”å‡çº§ï¼ŒReentrantReadWriteLockæ˜¯ä¸æ”¯æŒçš„ã€‚ åœ¨å†™é”æ²¡æœ‰é‡Šæ”¾çš„æ—¶å€™ï¼Œå…ˆèŽ·å–åˆ°è¯»é”ï¼Œç„¶åŽå†é‡Šæ”¾å†™é”ï¼Œä¿è¯åŽé¢è¯»åˆ°çš„æ•°æ®çš„ä¸€è‡´æ€§ã€‚ 123456789101112131415private volatile boolean isUpdate;public void readWrite()&#123; r.lock();//ä¸ºäº†ä¿è¯isUpdateèƒ½å¤Ÿæ‹¿åˆ°æœ€æ–°çš„å€¼ if(isUpdate)&#123; r.unlock(); w.lock(); map.put("xxx","xxx"); r.lock();//å†™é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œç«‹å³èŽ·å–è¯»é”ï¼Œé˜»å¡žæœ¬çº¿ç¨‹ï¼Œä¿è¯æœ¬çº¿ç¨‹ä¸‹é¢è¯»çš„ä¸€è‡´æ€§ w.unlock(); &#125; String value = map.get("xxx"); //è¯»åˆ°çš„æ•°æ®æ˜¯æœ¬çº¿ç¨‹è‡ªå·±æ›´æ–°çš„æ•°æ®ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ‰° System.out.println(value); r.unlock();&#125;]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»ŽReentrantLockå¼•å‡ºAQSçš„åŽŸç†]]></title>
    <url>%2F2019%2F02%2F11%2Fthread%2F%E4%BB%8EReentrantLock%E5%BC%95%E5%87%BAAQS%E7%9A%84%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[å¦‚æžœå¯¹å¹¶å‘ç¼–ç¨‹ç¨å¾®ç†Ÿæ‚‰çš„è¯ï¼Œå°±ä¸ä¼šå¯¹ReentrantLocké™Œç”Ÿï¼Œä¹Ÿå¯èƒ½å¯¹ä¸€äº›ç»„ä»¶æ¯”å¦‚CountDownLatch,FutureTaskä»¥åŠSemaphoreç­‰åŒæ­¥ç»„ä»¶è€³é—»è¿‡ï¼Œä»–ä»¬éƒ½æ˜¯JUCåŒ…ä¸‹çš„ç±»æˆ–è€…å·¥å…·ï¼Œä»–ä»¬éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„åŸºç¡€ï¼šAQSï¼Œå³AbstractQueuedSynchronizerï¼Œä»Žä»Šå¤©å¼€å§‹ï¼Œè®©æˆ‘ä»¬è®°ä½å®ƒï¼Œå¹¶ä¸”å°è¯•åŽ»ç†è§£å®ƒã€‚ ä¸€ã€ReentrantLock é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ReentrantLockè¿™ä¸ªå¯é‡å…¥é”çš„æ€§è´¨å’Œä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¾€å¾€ä¼šåœ¨é¢è¯•ä¸­è¢«é¢è¯•å®˜æ‹¿æ¥åŒsynchronizedç›¸æ¯”è¾ƒã€‚å¦‚æžœè¿™ç§åŸºæœ¬çš„æ¯”è¾ƒéƒ½ä¸çŸ¥é“çš„è¯ï¼Œé‚£å°±æ²¡æœ‰åŽç»­æ·±å…¥çš„æŽ¢è®¨äº†ï¼Œé¢è¯•å¯èƒ½ä¹Ÿä¼šç»“æŸäº†ã€‚ å®ƒçš„ç”¨æ³•æžå…¶ç®€å•ï¼Œå¦‚ä¸‹ï¼š ä»–ä»¬ä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ï¼š synchronizedæ˜¯å…³é”®å­—ï¼ŒReentrantLockæ˜¯ä¸€ä¸ªç±» ReentrantLockå¯ä»¥å¯¹èŽ·å–é”çš„ç­‰å¾…æ—¶é—´è¿›è¡Œè®¾ç½®ï¼Œé¿å…æ­»é” ReentrantLockå¯ä»¥èŽ·å–å„ç§é”çš„ä¿¡æ¯ ReentrantLockå¯ä»¥çµæ´»åœ°å®žçŽ°å¤šè·¯é€šçŸ¥ æœºåˆ¶ï¼šsynchronizedæ“ä½œMarkWordï¼Œlockè°ƒç”¨Unsafeç±»çš„park()æ–¹æ³• ReentrantLockå¯ä»¥è®¾ç½®é”çš„å…¬å¹³æ€§ ReentrantLockè°ƒç”¨lock()ä¹‹åŽå¿…é¡»è°ƒç”¨unlock()é‡Šæ”¾é” æ€§èƒ½ä¸ŠReentrantLockæœªå¿…å°±æ¯”synchronizedé«˜ï¼Œä»–ä»¬éƒ½æ˜¯å¯é‡å…¥çš„ å¯ä»¥çœ‹å‡ºï¼ŒReentrantLockæ›´åŠ çµæ´»ï¼Œå¯ä»¥æ›´åŠ ç»†è…»åº¦æ“ä½œé”ï¼Œè€Œsynchronizedçœ‹èµ·æ¥åˆ™ç›¸å¯¹æ¯”è¾ƒç¬¨æ‹™ï¼Œä½†æ˜¯ç¬¨æ‹™çš„æ˜¯ç®€å•çš„ï¼Œä¸å­˜åœ¨å¿˜è®°é‡Šæ”¾é”çš„é—®é¢˜ã€‚å¯è°“å­˜åœ¨å³åˆç†å˜›ï¼ é’ˆå¯¹ä¸Šæ–‡ä¸­æåˆ°çš„Unsafeç±»ï¼Œå…¶ä¸­æœ€ç»å…¸çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼šcompareAndSwapXXXè¿™ç±»CASæ–¹æ³•ï¼Œå®ƒå…¶å®žæ˜¯JAVAç•™çš„ä¸€ä¸ªåŽé—¨ï¼Œå®ƒå¯ä»¥ç›´æŽ¥æ“ä½œå†…å­˜ï¼Œå› æ­¤å¦‚æžœæ™®é€šå¼€å‘è€…æ‹¿æ¥ç”¨çš„è¯ï¼Œå¯èƒ½ä¼šå‡ºçŽ°å„ç§é—®é¢˜ï¼Œå› æ­¤è¢«æˆä¸ºä¸å®‰å…¨çš„ç±»ã€‚ å¥½äº†ï¼Œå…³äºŽåŒºåˆ«å·²ç»è¯´çš„å·®ä¸å¤šäº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±è¦æ¥çœŸæ ¼çš„äº†ï¼Œé¦–å…ˆæ¥ç¿»ç¿»æºç ã€‚å‰æ–¹é«˜èƒ½é¢„è­¦ï¼Œè¯·éžæˆ˜æ–—äººå‘˜ç´§æ€¥æ’¤ç¦»çŽ°åœºï¼Œè€å¸æœºè¦å¼€è½¦äº†ã€‚ é¦–å…ˆå‘¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹lock()æ–¹æ³•çš„å®žçŽ°æ˜¯ï¼š 123public void lock() &#123; sync.lock();&#125; è¿™é‡Œå¤šäº†ä¸€ä¸ªä¸œè¥¿å«Syncï¼ŒSyncä¸ºReentrantLocké‡Œé¢çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ƒç»§æ‰¿AQSï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼šå…¬å¹³é”FairSyncå’Œéžå…¬å¹³é”NonfairSyncã€‚ ReentrantLocké‡Œé¢å¤§éƒ¨åˆ†çš„åŠŸèƒ½éƒ½æ˜¯å§”æ‰˜ç»™Syncæ¥å®žçŽ°çš„ï¼ŒåŒæ—¶Syncå†…éƒ¨å®šä¹‰äº†lock()æŠ½è±¡æ–¹æ³•ç”±å…¶å­ç±»åŽ»å®žçŽ°ï¼Œé»˜è®¤å®žçŽ°äº†nonfairTryAcquire(int acquires)æ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºå®ƒæ˜¯éžå…¬å¹³é”çš„é»˜è®¤å®žçŽ°æ–¹å¼ã€‚ å‡ ä¹Žæ¯ä¸€ä¸ªæ–¹æ³•éƒ½æ˜¯é€šè¿‡sync.xxxæ¥å®žçŽ°çš„ï¼Œè€ŒSyncè¿™ä¸ªå†…éƒ¨ç±»åœ¨AQSçš„åŸºç¡€ä¸Šå¢žåŠ ä¸€äº›ä¸œè¥¿è€Œå·²ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šéƒ½æ˜¯åŸºäºŽAQSæ¥å®žçŽ°çš„ã€‚ ä¸ä»…ä»…æ˜¯è¿™ä¸ªï¼ŒJUCåŒ…åŸºæœ¬éƒ½æ˜¯ä»¥AQSä¸ºåŸºç¡€æž„æˆï¼Œå› æ­¤AQSå¯ä»¥ç†è§£ä¸ºJUCçš„ä¸€ä¸ªå®žçŽ°æ¡†æž¶ã€‚æ—¢ç„¶AQSè¿™ä¹ˆé‡è¦ï¼Œä¸‹é¢æœ‰å¿…è¦æŒ–åœ°ä¸‰å°ºæŽ˜å‡ºå®ƒçš„åŽŸç†ã€‚ äºŒã€AQSç®€ä»‹ javaçš„å†…ç½®é”ä¸€ç›´éƒ½æ˜¯å¤‡å—äº‰è®®çš„ï¼Œåœ¨JDK 1.6ä¹‹å‰ï¼Œsynchronizedè¿™ä¸ªé‡é‡çº§é”æ€§èƒ½ä¸€ç›´éƒ½æ˜¯è¾ƒä¸ºä½Žä¸‹ï¼Œè™½ç„¶åœ¨1.6åŽï¼Œè¿›è¡Œå¤§é‡çš„é”ä¼˜åŒ–ç­–ç•¥,ä½†æ˜¯ä¸ŽLockç›¸æ¯”synchronizedè¿˜æ˜¯å­˜åœ¨ä¸€äº›ç¼ºé™·çš„ï¼šè™½ç„¶synchronizedæä¾›äº†ä¾¿æ·æ€§çš„éšå¼èŽ·å–é”é‡Šæ”¾é”æœºåˆ¶ï¼ˆåŸºäºŽJVMæœºåˆ¶ï¼‰ï¼Œä½†æ˜¯å®ƒå´ç¼ºå°‘äº†èŽ·å–é”ä¸Žé‡Šæ”¾é”çš„å¯æ“ä½œæ€§ï¼Œå¯ä¸­æ–­ã€è¶…æ—¶èŽ·å–é”ï¼Œä¸”å®ƒä¸ºç‹¬å å¼åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½å¤§æ‰“æŠ˜æ‰£ã€‚ AQSï¼šAbstractQueuedSynchronizerï¼Œå³é˜Ÿåˆ—åŒæ­¥å™¨ã€‚å®ƒæ˜¯æž„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æž¶ï¼ˆå¦‚ReentrantLockã€ReentrantReadWriteLockã€ Semaphoreç­‰ï¼‰ï¼ŒJUCå¹¶å‘åŒ…çš„ä½œè€…ï¼ˆDoug Leaï¼‰æœŸæœ›å®ƒèƒ½å¤Ÿæˆä¸ºå®žçŽ°å¤§éƒ¨åˆ†åŒæ­¥éœ€æ±‚çš„åŸºç¡€ã€‚å®ƒæ˜¯JUCå¹¶å‘åŒ…ä¸­çš„æ ¸å¿ƒåŸºç¡€ç»„ä»¶ã€‚ AQSè§£å†³äº†åœ¨å®žçŽ°åŒæ­¥å™¨æ—¶æ¶‰åŠå½“çš„å¤§é‡ç»†èŠ‚é—®é¢˜ï¼Œä¾‹å¦‚èŽ·å–åŒæ­¥çŠ¶æ€ã€FIFOåŒæ­¥é˜Ÿåˆ—ã€‚åŸºäºŽAQSæ¥æž„å»ºåŒæ­¥å™¨å¯ä»¥å¸¦æ¥å¾ˆå¤šå¥½å¤„ã€‚å®ƒä¸ä»…èƒ½å¤Ÿæžå¤§åœ°å‡å°‘å®žçŽ°å·¥ä½œï¼Œè€Œä¸”ä¹Ÿä¸å¿…å¤„ç†åœ¨å¤šä¸ªä½ç½®ä¸Šå‘ç”Ÿçš„ç«žäº‰é—®é¢˜ã€‚ AQSçš„ä¸»è¦ä½¿ç”¨æ–¹å¼æ˜¯ç»§æ‰¿ï¼Œå­ç±»é€šè¿‡ç»§æ‰¿åŒæ­¥å™¨å¹¶å®žçŽ°å®ƒçš„æŠ½è±¡æ–¹æ³•æ¥ç®¡ç†åŒæ­¥çŠ¶æ€ã€‚ AQSä½¿ç”¨ä¸€ä¸ªintç±»åž‹çš„æˆå‘˜å˜é‡stateæ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œå½“state&gt;0æ—¶è¡¨ç¤ºå·²ç»èŽ·å–äº†é”ï¼Œå½“state = 0æ—¶è¡¨ç¤ºé‡Šæ”¾äº†é”ã€‚å®ƒæä¾›äº†ä¸‰ä¸ªæ–¹æ³•ï¼ˆgetState()ã€setState(int newState)ã€compareAndSetState(int expect,int update)ï¼‰æ¥å¯¹åŒæ­¥çŠ¶æ€stateè¿›è¡Œæ“ä½œï¼Œå½“ç„¶AQSå¯ä»¥ç¡®ä¿å¯¹stateçš„æ“ä½œæ˜¯å®‰å…¨çš„ã€‚ AQSé€šè¿‡å†…ç½®çš„FIFOåŒæ­¥é˜Ÿåˆ—æ¥å®Œæˆèµ„æºèŽ·å–çº¿ç¨‹çš„æŽ’é˜Ÿå·¥ä½œï¼Œå¦‚æžœå½“å‰çº¿ç¨‹èŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼ˆé”ï¼‰æ—¶ï¼ŒAQSåˆ™ä¼šå°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æž„é€ æˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å¹¶å°†å…¶åŠ å…¥åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¼šé˜»å¡žå½“å‰çº¿ç¨‹ï¼Œå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œåˆ™ä¼šæŠŠèŠ‚ç‚¹ä¸­çš„çº¿ç¨‹å”¤é†’ï¼Œä½¿å…¶å†æ¬¡å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ã€‚ ä¸‰ã€CLHåŒæ­¥é˜Ÿåˆ— CLHåŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªFIFOåŒå‘é˜Ÿåˆ—ï¼ŒAQSä¾èµ–å®ƒæ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†ï¼Œå½“å‰çº¿ç¨‹å¦‚æžœèŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ï¼ŒAQSåˆ™ä¼šå°†å½“å‰çº¿ç¨‹å·²ç»ç­‰å¾…çŠ¶æ€ç­‰ä¿¡æ¯æž„é€ æˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å¹¶å°†å…¶åŠ å…¥åˆ°CLHåŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¼šé˜»å¡žå½“å‰çº¿ç¨‹ï¼Œå½“åŒæ­¥çŠ¶æ€é‡Šæ”¾æ—¶ï¼Œä¼šæŠŠé¦–èŠ‚ç‚¹å”¤é†’ï¼ˆå…¬å¹³é”ï¼‰ï¼Œä½¿å…¶å†æ¬¡å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ã€‚ åœ¨CLHåŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¿å­˜ç€çº¿ç¨‹çš„å¼•ç”¨ï¼ˆthreadï¼‰ã€çŠ¶æ€ï¼ˆwaitStatusï¼‰ã€å‰é©±èŠ‚ç‚¹ï¼ˆprevï¼‰ã€åŽç»§èŠ‚ç‚¹ï¼ˆnextï¼‰ï¼ŒCLHåŒæ­¥é˜Ÿåˆ—ç»“æž„å›¾å¦‚ä¸‹ï¼š ä¸¾ä¾‹ç†è§£ï¼šå‡è®¾ç›®å‰æœ‰ä¸‰ä¸ªçº¿ç¨‹Thread1ã€Thread2ã€Thread3åŒæ—¶åŽ»ç«žäº‰é”ï¼Œå¦‚æžœç»“æžœæ˜¯Thread1èŽ·å–äº†é”ï¼ŒThread2å’ŒThread3è¿›å…¥äº†ç­‰å¾…é˜Ÿåˆ—ï¼Œé‚£ä¹ˆä»–ä»¬çš„æ ·å­å¦‚ä¸‹ï¼š AQSçš„ç­‰å¾…é˜Ÿåˆ—åŸºäºŽä¸€ä¸ªåŒå‘é“¾è¡¨å®žçŽ°çš„ï¼ŒHEADèŠ‚ç‚¹ä¸å…³è”çº¿ç¨‹ï¼ŒåŽé¢ä¸¤ä¸ªèŠ‚ç‚¹åˆ†åˆ«å…³è”Thread2å’ŒThread3ï¼Œä»–ä»¬å°†ä¼šæŒ‰ç…§å…ˆåŽé¡ºåºè¢«ä¸²è”åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸Šã€‚è¿™ä¸ªæ—¶å€™å¦‚æžœåŽé¢å†æœ‰çº¿ç¨‹è¿›æ¥çš„è¯å°†ä¼šè¢«å½“åšé˜Ÿåˆ—çš„TAILã€‚ å››ã€å…¥åˆ— 12345678910111213141516private Node addWaiter(Node mode) &#123; //æ–°å»ºNode Node node = new Node(Thread.currentThread(), mode); //å¿«é€Ÿå°è¯•æ·»åŠ å°¾èŠ‚ç‚¹ Node pred = tail; if (pred != null) &#123; node.prev = pred; //CASè®¾ç½®å°¾èŠ‚ç‚¹ if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; enq(node); return node;&#125; addWaiter(Node node)å…ˆé€šè¿‡å¿«é€Ÿå°è¯•è®¾ç½®å°¾èŠ‚ç‚¹ï¼Œå¦‚æžœå¤±è´¥ï¼Œåˆ™è°ƒç”¨enq(Node node)æ–¹æ³•è®¾ç½®å°¾èŠ‚ç‚¹: 123456789101112131415161718private Node enq(final Node node) &#123; //å¤šæ¬¡å°è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ for (;;) &#123; Node t = tail; //tailä¸å­˜åœ¨ï¼Œè®¾ç½®ä¸ºé¦–èŠ‚ç‚¹ if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; //è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹ node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125;&#125; å…¶å®žå°±å¾ˆæ˜Žäº†äº†ï¼Œé¦–å…ˆæ˜¯å°è¯•å¿«é€Ÿç”¨CASè®¾ç½®å½“å‰çš„èŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨å¹¶å‘é—®é¢˜è®¾ç½®ä¸æˆåŠŸï¼Œä¸‹é¢ç”¨æ­»å¾ªçŽ¯çš„æ–¹å¼ä¸æ–­åœ°å°è¯•æ·»åŠ èŠ‚ç‚¹å¹¶ä¸”è®¾ç½®ä¸ºå°¾èŠ‚ç‚¹ï¼Œç›´åˆ°æˆåŠŸã€‚ è¿‡ç¨‹å¦‚ä¸‹ï¼š äº”ã€å‡ºåˆ— CLHåŒæ­¥é˜Ÿåˆ—éµå¾ªFIFOï¼Œé¦–èŠ‚ç‚¹çš„çº¿ç¨‹é‡Šæ”¾åŒæ­¥çŠ¶æ€åŽï¼Œå°†ä¼šå”¤é†’å®ƒçš„åŽç»§èŠ‚ç‚¹ï¼ˆnextï¼‰ï¼Œè€ŒåŽç»§èŠ‚ç‚¹å°†ä¼šåœ¨èŽ·å–åŒæ­¥çŠ¶æ€æˆåŠŸæ—¶å°†è‡ªå·±è®¾ç½®ä¸ºé¦–èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹éžå¸¸ç®€å•ï¼Œheadæ‰§è¡Œè¯¥èŠ‚ç‚¹å¹¶æ–­å¼€åŽŸé¦–èŠ‚ç‚¹çš„nextå’Œå½“å‰èŠ‚ç‚¹çš„prevå³å¯ï¼Œæ³¨æ„åœ¨è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸éœ€è¦ä½¿ç”¨CASæ¥ä¿è¯çš„ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸèŽ·å–åˆ°åŒæ­¥çŠ¶æ€ã€‚ å…¶å®žè¿™é‡ŒæŒ‰ç…§æºç çš„è§£é‡Šï¼Œæ˜¯å°†ç¬¬ä¸€ä¸ªèŽ·å–åˆ°åŒæ­¥çŠ¶æ€çš„nodeä½œä¸ºæ–°çš„headï¼Œç„¶åŽå°†åŽŸæ¥çš„headç½®ç©ºã€‚ å…­ã€åŒæ­¥çŠ¶æ€çš„èŽ·å–ä¸Žé‡Šæ”¾ åœ¨å‰é¢æåˆ°è¿‡ï¼ŒAQSæ˜¯æž„å»ºJavaåŒæ­¥ç»„ä»¶çš„åŸºç¡€ï¼Œæˆ‘ä»¬æœŸå¾…å®ƒèƒ½å¤Ÿæˆä¸ºå®žçŽ°å¤§éƒ¨åˆ†åŒæ­¥éœ€æ±‚çš„åŸºç¡€ã€‚AQSçš„è®¾è®¡æ¨¡å¼é‡‡ç”¨çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå­ç±»é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œå®žçŽ°å®ƒçš„æŠ½è±¡æ–¹æ³•æ¥ç®¡ç†åŒæ­¥çŠ¶æ€ï¼Œå¯¹äºŽå­ç±»è€Œè¨€å®ƒå¹¶æ²¡æœ‰å¤ªå¤šçš„æ´»è¦åšï¼ŒAQSæä¾›äº†å¤§é‡çš„æ¨¡æ¿æ–¹æ³•æ¥å®žçŽ°åŒæ­¥ï¼Œä¸»è¦æ˜¯åˆ†ä¸ºä¸‰ç±»ï¼šç‹¬å å¼èŽ·å–å’Œé‡Šæ”¾åŒæ­¥çŠ¶æ€ã€å…±äº«å¼èŽ·å–å’Œé‡Šæ”¾åŒæ­¥çŠ¶æ€ã€æŸ¥è¯¢åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹æƒ…å†µã€‚è‡ªå®šä¹‰å­ç±»ä½¿ç”¨AQSæä¾›çš„æ¨¡æ¿æ–¹æ³•å°±å¯ä»¥å®žçŽ°è‡ªå·±çš„åŒæ­¥è¯­ä¹‰ã€‚ ä¸‹é¢å…·ä½“æ¥è§£é‡Šä¸€ä¸‹ç‹¬å å¼å’Œå…±äº«å¼çš„å«ä¹‰ åœ¨å…·ä½“åˆ†æžä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè§£é‡Šä¸¤ç§åŒæ­¥çš„æ–¹å¼ï¼Œç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ï¼š ç‹¬å æ¨¡å¼ï¼šèµ„æºæ˜¯ç‹¬å çš„ï¼Œä¸€æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹èŽ·å–ã€‚ å…±äº«æ¨¡å¼ï¼šåŒæ—¶å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹èŽ·å–ï¼Œå…·ä½“çš„èµ„æºçš„ä¸ªæ•°å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šã€‚ å¦‚æžœæˆ‘ä»¬è‡ªå·±å®žçŽ°ä¸€ä¸ªåŒæ­¥å™¨çš„æ¡†æž¶ï¼Œæˆ‘ä»¬æ€Žä¹ˆè®¾è®¡å‘¢ï¼Ÿä¸‹é¢å¯èƒ½æ˜¯æˆ‘ä»¬æƒ³åˆ°çš„æ¯”è¾ƒé€šç”¨çš„è®¾è®¡æ–¹æ¡ˆï¼ˆç‹¬å æ¨¡å¼ï¼‰: å®šä¹‰ä¸€ä¸ªå˜é‡int state=0ï¼Œä½¿ç”¨è¿™ä¸ªå˜é‡è¡¨ç¤ºè¢«èŽ·å–çš„èµ„æºçš„æ•°é‡ã€‚ çº¿ç¨‹åœ¨èŽ·å–èµ„æºå‰è¦å…ˆæ£€æŸ¥stateçš„çŠ¶æ€ï¼Œå¦‚æžœä¸º0ï¼Œåˆ™ä¿®æ”¹ä¸º1ï¼Œè¡¨ç¤ºèŽ·å–èµ„æºæˆåŠŸï¼Œå¦åˆ™è¡¨ç¤ºèµ„æºå·²ç»è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œæ­¤æ—¶çº¿ç¨‹è¦å µå¡žä»¥ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾èµ„æºã€‚ ä¸ºäº†èƒ½ä½¿å¾—èµ„æºé‡Šæ”¾åŽæ‰¾åˆ°é‚£äº›ä¸ºäº†ç­‰å¾…èµ„æºè€Œå µå¡žçš„çº¿ç¨‹ï¼Œæˆ‘ä»¬æŠŠè¿™äº›çº¿ç¨‹ä¿å­˜åœ¨FIFOé˜Ÿåˆ—ä¸­ã€‚ å½“å æœ‰èµ„æºçš„çº¿ç¨‹é‡Šæ”¾æŽ‰èµ„æºåŽï¼Œå¯ä»¥ä»Žé˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªå µå¡žçš„çº¿ç¨‹ï¼Œç”±äºŽæ­¤æ—¶èµ„æºå·²ç»é‡Šæ”¾ï¼Œå› æ­¤è¿™ä¸ªè¢«å”¤é†’çš„çº¿ç¨‹å¯ä»¥èŽ·å–èµ„æºå¹¶ä¸”æ‰§è¡Œã€‚ è¿™ä¸ªstateå˜é‡åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å½“AQSçš„å­ç±»å®žçŽ°ç‹¬å åŠŸèƒ½æ—¶ï¼Œå¦‚ReentrantLockï¼Œèµ„æºæ˜¯å¦å¯ä»¥è¢«è®¿é—®è¢«å®šä¹‰ä¸ºï¼šåªè¦AQSçš„stateå˜é‡ä¸ä¸º0ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆä»£è¡¨èµ„æºä¸å¯è®¿é—®ã€‚æ­¤æ—¶ï¼Œstateæ˜¯ç”¨æ¥è¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–é”çš„å¯é‡å…¥æ¬¡æ•°ï¼› å½“AQSçš„å­ç±»å®žçŽ°å…±äº«åŠŸèƒ½æ—¶ï¼Œå¦‚CountDownLatchï¼Œèµ„æºæ˜¯å¦å¯ä»¥è¢«è®¿é—®è¢«å®šä¹‰ä¸ºï¼šåªè¦AQSçš„stateå˜é‡ä¸ä¸º0ï¼Œé‚£ä¹ˆä»£è¡¨èµ„æºä¸å¯ä»¥ä¸ºè®¿é—®ã€‚æ­¤æ—¶ï¼Œstateç”¨æ¥è¡¨ç¤ºå½“å‰è®¡æ•°å™¨çš„å€¼ã€‚ ä¸ƒã€ç‹¬å å¼-ç‹¬å å¼åŒæ­¥çŠ¶æ€èŽ·å– ç‹¬å å¼ï¼ŒåŒä¸€æ—¶åˆ»ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰åŒæ­¥çŠ¶æ€ã€‚ ç‹¬å å¼åŒæ­¥çŠ¶æ€èŽ·å–acquire(int arg)æ–¹æ³•ä¸ºAQSæä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ºç‹¬å å¼èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œä½†æ˜¯è¯¥æ–¹æ³•å¯¹ä¸­æ–­ä¸æ•æ„Ÿï¼Œä¹Ÿå°±æ˜¯è¯´ç”±äºŽçº¿ç¨‹èŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥åŠ å…¥åˆ°CLHåŒæ­¥é˜Ÿåˆ—ä¸­ï¼ŒåŽç»­å¯¹çº¿ç¨‹è¿›è¡Œä¸­æ–­æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¸ä¼šä»ŽåŒæ­¥é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) &#123; selfInterrupt(); &#125;&#125; tryAcquireï¼šåŽ»å°è¯•èŽ·å–é”ï¼ŒèŽ·å–æˆåŠŸåˆ™è®¾ç½®é”çŠ¶æ€å¹¶è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalseã€‚è¯¥æ–¹æ³•è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶è‡ªå·±å®žçŽ°(ReentrantLockä¸­å®žçŽ°å…¬å¹³é”å’Œéžå…¬å¹³é”å°±æ˜¯åˆ†åˆ«é‡å†™äº†è¿™ä¸ªæ–¹æ³•å®žçŽ°çš„ï¼Œä¸‹é¢çœ‹ReentrantLockçš„åŽŸç†çš„æ—¶å€™å°±æ˜Žç™½äº†)ï¼Œè¯¥æ–¹æ³•å¿…é¡»è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„èŽ·å–åŒæ­¥çŠ¶æ€ã€‚ addWaiterï¼šå¦‚æžœtryAcquireè¿”å›žFALSEï¼ˆèŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼‰ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•å°†å½“å‰çº¿ç¨‹åŠ å…¥åˆ°CLHåŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ã€‚ acquireQueuedï¼šå½“å‰çº¿ç¨‹ä¼šæ ¹æ®å…¬å¹³æ€§åŽŸåˆ™æ¥è¿›è¡Œé˜»å¡žç­‰å¾…ï¼ˆè‡ªæ—‹ï¼‰,ç›´åˆ°èŽ·å–é”ä¸ºæ­¢ï¼›å¹¶ä¸”è¿”å›žå½“å‰çº¿ç¨‹åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰ä¸­æ–­è¿‡ã€‚ selfInterruptï¼šäº§ç”Ÿä¸€ä¸ªä¸­æ–­ã€‚ å¯¹è¿™é‡Œçš„acquireQueuedæœ‰ç–‘æƒ‘ï¼Œä¸‹é¢æ¥çœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆã€‚acquireQueuedæ–¹æ³•ä¸ºä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰çº¿ç¨‹ï¼ˆNodeï¼‰è¿›å…¥åŒæ­¥é˜Ÿåˆ—åŽï¼Œå°±ä¼šå…ˆè¿›å…¥ä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè‡ªçœåœ°è§‚å¯Ÿï¼Œå½“æ¡ä»¶æ»¡è¶³ï¼ŒèŽ·å–åˆ°åŒæ­¥çŠ¶æ€åŽï¼Œå°±å¯ä»¥ä»Žè¿™ä¸ªè‡ªæ—‹è¿‡ç¨‹ä¸­é€€å‡ºã€‚ 1234567891011121314151617181920212223242526272829final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; //èŽ·å–å½“å‰èŠ‚ç‚¹nodeçš„å‰é©±ç»“ç‚¹p final Node p = node.predecessor(); //å¦‚æžœpç¡®å®žæ˜¯headï¼Œé‚£è¯´æ˜Žå½“å‰èŠ‚ç‚¹nodeæ˜¯å¯ç”¨çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ //å³ä¸ºå½“å‰é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™æœ€å…ˆå¤„ç†å®ƒ //å½“å‰çº¿ç¨‹åˆ™å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ if (p == head &amp;&amp; tryAcquire(arg)) &#123; //ä»Žè¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œæ›´æ–°å½“å‰èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ //å°†åŽŸæ¥å¤´èŠ‚ç‚¹çš„nextå¼•ç”¨ç½®ç©ºä»¥ä¾›JVMå›žæ”¶ //å…·ä½“è§å‡ºåˆ—å°æ ‡é¢˜ä¸‹çš„ç¤ºæ„å›¾ setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; //å¦‚æžœå‰é©±èŠ‚ç‚¹ä¸æ˜¯å¤´èŠ‚ç‚¹å°±ç»§ç»­é˜»å¡žç»§ç»­ç­‰å¾…å‘— if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; ä»Žä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰çº¿ç¨‹ä¼šä¸€ç›´å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œå½“ç„¶å‰ææ˜¯åªæœ‰å…¶å‰é©±èŠ‚ç‚¹ä¸ºå¤´ç»“ç‚¹æ‰èƒ½å¤Ÿå°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œç†ç”±ï¼š ä¿æŒFIFOåŒæ­¥é˜Ÿåˆ—åŽŸåˆ™ã€‚ å¤´èŠ‚ç‚¹é‡Šæ”¾åŒæ­¥çŠ¶æ€åŽï¼Œå°†ä¼šå”¤é†’å…¶åŽç»§èŠ‚ç‚¹ï¼ŒåŽç»§èŠ‚ç‚¹è¢«å”¤é†’åŽéœ€è¦æ£€æŸ¥è‡ªå·±æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ã€‚ å¯¹è¿™ä¸ªçš„ç†è§£ç®€å•æ¥è¯´å°±æ˜¯ï¼š åœ¨AQSä¸­ç»´æŠ¤ç€ä¸€ä¸ªFIFOçš„åŒæ­¥é˜Ÿåˆ—ï¼Œå½“çº¿ç¨‹èŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥åŽï¼Œåˆ™ä¼šåŠ å…¥åˆ°è¿™ä¸ªCLHåŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾å¹¶ä¸€ç›´ä¿æŒç€è‡ªæ—‹ã€‚åœ¨CLHåŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹åœ¨è‡ªæ—‹æ—¶ä¼šåˆ¤æ–­å…¶å‰é©±èŠ‚ç‚¹æ˜¯å¦ä¸ºé¦–èŠ‚ç‚¹ï¼Œå¦‚æžœå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹å°±æ˜¯å¤´èŠ‚ç‚¹ï¼Œåˆ™è¡¨æ˜Žå½“å‰èŠ‚ç‚¹æ˜¯å½“å‰é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå¯ç”¨çº¿ç¨‹ï¼Œåˆ™è®©å…¶ä¸æ–­å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æžœèŽ·å–åˆ°ï¼Œåˆ™é€€å‡ºCLHåŒæ­¥é˜Ÿåˆ—ã€‚å½“çº¿ç¨‹æ‰§è¡Œå®Œé€»è¾‘åŽï¼Œä¼šé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œé‡Šæ”¾åŽä¼šå”¤é†’å…¶åŽç»§èŠ‚ç‚¹ã€‚ ç»§ç»­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œå¦‚æžœå‘çŽ°å‰é©±èŠ‚ç‚¹å¹¶ä¸æ˜¯headï¼Œé‚£ä¹ˆå°±è¯´æ˜Žæ˜¯æ¯”è¾ƒé åŽçš„èŠ‚ç‚¹äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ä¹‹åŽæ‰ä¼šç”¨åˆ°å®ƒï¼Œæ‰€ä»¥æ ¹æœ¬ä¸éœ€è¦å†å‚ä¸Žè‡ªæ—‹æµªè´¹CPUçš„æ€§èƒ½äº†ï¼Œå³ä¸‹é¢ä¸€ä¸ªif: 123if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; é€šè¿‡è¿™æ®µä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨èŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥åŽï¼Œçº¿ç¨‹å¹¶ä¸æ˜¯ç«‹é©¬è¿›è¡Œé˜»å¡žï¼Œéœ€è¦æ£€æŸ¥è¯¥çº¿ç¨‹çš„çŠ¶æ€ï¼Œæ£€æŸ¥çŠ¶æ€çš„æ–¹æ³•ä¸º shouldParkAfterFailedAcquire(Node pred, Node node) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦é å‰é©±èŠ‚ç‚¹åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦åº”è¯¥è¢«é˜»å¡žï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; //å‰é©±èŠ‚ç‚¹ int ws = pred.waitStatus; //çŠ¶æ€ä¸ºsignalï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å¤„äºŽç­‰å¾…çŠ¶æ€ï¼Œç›´æŽ¥æ”¾å›žtrue if (ws == Node.SIGNAL) return true; //å‰é©±èŠ‚ç‚¹çŠ¶æ€ &gt; 0 ï¼Œåˆ™ä¸ºCancelled,è¡¨æ˜Žè¯¥èŠ‚ç‚¹å·²ç»è¶…æ—¶æˆ–è€…è¢«ä¸­æ–­äº†ï¼Œéœ€è¦ä»ŽåŒæ­¥é˜Ÿåˆ—ä¸­å–æ¶ˆ if (ws &gt; 0) &#123; do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; //å‰é©±èŠ‚ç‚¹çŠ¶æ€ä¸ºConditionã€propagate else &#123; compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false;&#125; è¿™æ®µä»£ç ä¸»è¦æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦éœ€è¦è¢«é˜»å¡žï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š å¦‚æžœå½“å‰çº¿ç¨‹çš„å‰é©±èŠ‚ç‚¹çŠ¶æ€ä¸ºSINNALï¼Œåˆ™è¡¨æ˜Žå½“å‰çº¿ç¨‹éœ€è¦è¢«é˜»å¡žï¼Œè°ƒç”¨unpark()æ–¹æ³•å”¤é†’ï¼Œç›´æŽ¥è¿”å›žtrueï¼Œå½“å‰çº¿ç¨‹é˜»å¡ž å¦‚æžœå½“å‰çº¿ç¨‹çš„å‰é©±èŠ‚ç‚¹çŠ¶æ€ä¸ºCANCELLEDï¼ˆws &gt; 0ï¼‰ï¼Œåˆ™è¡¨æ˜Žè¯¥çº¿ç¨‹çš„å‰é©±èŠ‚ç‚¹å·²ç»ç­‰å¾…è¶…æ—¶æˆ–è€…è¢«ä¸­æ–­äº†ï¼Œåˆ™éœ€è¦ä»ŽCLHé˜Ÿåˆ—ä¸­å°†è¯¥å‰é©±èŠ‚ç‚¹åˆ é™¤æŽ‰ï¼Œç›´åˆ°å›žæº¯åˆ°å‰é©±èŠ‚ç‚¹çŠ¶æ€ &lt;= 0 ï¼Œè¿”å›žfalse å¦‚æžœå‰é©±èŠ‚ç‚¹éžSINNALï¼ŒéžCANCELLEDï¼Œåˆ™é€šè¿‡CASçš„æ–¹å¼å°†å…¶å‰é©±èŠ‚ç‚¹è®¾ç½®ä¸ºSINNALï¼Œè¿”å›žfalse é’ˆå¯¹pred.waitStatusçš„å‡ ç§çŠ¶æ€ï¼š 1234567891011/** waitStatus value to indicate thread has cancelled */static final int CANCELLED = 1;/** waitStatus value to indicate successor's thread needs unparking */static final int SIGNAL = -1;/** waitStatus value to indicate thread is waiting on condition */static final int CONDITION = -2;/** * waitStatus value to indicate the next acquireShared should * unconditionally propagate */static final int PROPAGATE = -3; å¦‚æžœ shouldParkAfterFailedAcquire(Node pred, Node node) æ–¹æ³•è¿”å›žtrueï¼Œåˆ™è°ƒç”¨parkAndCheckInterrupt()æ–¹æ³•é˜»å¡žå½“å‰çº¿ç¨‹ï¼š 1234private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted();&#125; parkAndCheckInterrupt() æ–¹æ³•ä¸»è¦æ˜¯æŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œä»Žè€Œé˜»å¡žä½çº¿ç¨‹çš„è°ƒç”¨æ ˆï¼ŒåŒæ—¶è¿”å›žå½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚å…¶å†…éƒ¨åˆ™æ˜¯è°ƒç”¨LockSupportå·¥å…·ç±»çš„park()æ–¹æ³•æ¥é˜»å¡žè¯¥æ–¹æ³•ã€‚ é‚£ä¹ˆï¼Œæ­¤æ—¶ï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œé‡Šæ”¾é”äº†ï¼Œå°±éœ€è¦å”¤é†’é˜Ÿåˆ—ä¸­åŽç»§èŠ‚ç‚¹ï¼š 12345678910public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) //å”¤é†’åŽç»§èŠ‚ç‚¹ unparkSuccessor(h); return true; &#125; return false;&#125; è°ƒç”¨unparkSuccessor(Node node)å”¤é†’åŽç»§èŠ‚ç‚¹ï¼š 123456789101112131415161718192021private void unparkSuccessor(Node node) &#123; //å½“å‰èŠ‚ç‚¹çŠ¶æ€ int ws = node.waitStatus; //å½“å‰çŠ¶æ€ &lt; 0 åˆ™è®¾ç½®ä¸º 0 if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); //å½“å‰èŠ‚ç‚¹çš„åŽç»§èŠ‚ç‚¹ Node s = node.next; //åŽç»§èŠ‚ç‚¹ä¸ºnullæˆ–è€…å…¶çŠ¶æ€ &gt; 0 (è¶…æ—¶æˆ–è€…è¢«ä¸­æ–­äº†) if (s == null || s.waitStatus &gt; 0) &#123; s = null; //ä»ŽtailèŠ‚ç‚¹æ¥æ‰¾å¯ç”¨èŠ‚ç‚¹ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; //å”¤é†’åŽç»§èŠ‚ç‚¹ if (s != null) LockSupport.unpark(s.thread);&#125; å¯èƒ½ä¼šå­˜åœ¨å½“å‰çº¿ç¨‹çš„åŽç»§èŠ‚ç‚¹ä¸ºnullï¼Œè¶…æ—¶ã€è¢«ä¸­æ–­çš„æƒ…å†µï¼Œå¦‚æžœé‡åˆ°è¿™ç§æƒ…å†µäº†ï¼Œåˆ™éœ€è¦è·³è¿‡è¯¥èŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸ºä½•æ˜¯ä»Žtailå°¾èŠ‚ç‚¹å¼€å§‹ï¼Œè€Œä¸æ˜¯ä»Žnode.nextå¼€å§‹å‘¢ï¼ŸåŽŸå› åœ¨äºŽnode.nextä»ç„¶å¯èƒ½ä¼šå­˜åœ¨nullæˆ–è€…å–æ¶ˆäº†ï¼Œæ‰€ä»¥é‡‡ç”¨tailå›žæº¯åŠžæ³•æ‰¾ç¬¬ä¸€ä¸ªå¯ç”¨çš„çº¿ç¨‹ã€‚æœ€åŽè°ƒç”¨LockSupportçš„unpark(Thread thread)æ–¹æ³•å”¤é†’è¯¥çº¿ç¨‹ã€‚ ä»Žä¸Šé¢æˆ‘å¯ä»¥çœ‹åˆ°ï¼Œå½“éœ€è¦é˜»å¡žæˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼ŒAQSéƒ½æ˜¯ä½¿ç”¨LockSupportè¿™ä¸ªå·¥å…·ç±»æ¥å®Œæˆçš„ã€‚ LockSupportå®šä¹‰äº†ä¸€ç³»åˆ—ä»¥parkå¼€å¤´çš„æ–¹æ³•æ¥é˜»å¡žå½“å‰çº¿ç¨‹ï¼Œunpark(Thread thread)æ–¹æ³•æ¥å”¤é†’ä¸€ä¸ªè¢«é˜»å¡žçš„çº¿ç¨‹ã€‚è¿™äº›æ–¹æ³•çš„å®žçŽ°éƒ½æ˜¯é€šè¿‡Unsafeç±»è°ƒç”¨nativeæ–¹æ³•æ¥å®žçŽ°çš„ã€‚ å¥½äº†ï¼Œè‡³æ­¤å°±å®Œå®Œå…¨å…¨åœ°æžæ˜Žç™½äº†ç‹¬å å¼åŒæ­¥çŠ¶æ€èŽ·å–acquire(int arg)æ–¹æ³•çš„åŽŸç†ï¼Œç‰¹åˆ«æ˜¯å…¶ä¸­èŠ‚ç‚¹å¦‚ä½•è¿›å‡ºã€é˜Ÿåˆ—ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¦‚ä½•å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ã€å¦‚ä½•é˜»å¡žåŽç»§çº¿ç¨‹ä»¥åŠå¦‚ä½•å”¤é†’ã€‚ å…«ã€ç‹¬å å¼èŽ·å–å“åº”ä¸­æ–­ AQSæä¾›äº†acquire(int arg)æ–¹æ³•ä»¥ä¾›ç‹¬å å¼èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œä½†æ˜¯è¯¥æ–¹æ³•å¯¹ä¸­æ–­ä¸å“åº”ï¼Œå¯¹çº¿ç¨‹è¿›è¡Œä¸­æ–­æ“ä½œåŽï¼Œè¯¥çº¿ç¨‹ä¼šä¾ç„¶ä½äºŽCLHåŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…ç€èŽ·å–åŒæ­¥çŠ¶æ€ã€‚ä¸ºäº†å“åº”ä¸­æ–­ï¼ŒAQSæä¾›äº†acquireInterruptibly(int arg)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨ç­‰å¾…èŽ·å–åŒæ­¥çŠ¶æ€æ—¶ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­äº†ï¼Œä¼šç«‹åˆ»å“åº”ä¸­æ–­æŠ›å‡ºå¼‚å¸¸InterruptedExceptionã€‚ å…·ä½“åŽŸç†å°±ä¸æ·±ç©¶äº†ï¼Œå…¶å®žæºç è·Ÿä¸Šé¢ä¸ªç›¸å·®ä¸å¤§ï¼Œåªæ˜¯ä¸å†æ˜¯ä½¿ç”¨interruptedæ ‡å¿—ï¼Œè€Œæ˜¯ç›´æŽ¥æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚å†æ·±ç©¶è¿™åšå®¢æ²¡æ³•ç»§ç»­å†™å•¦ã€‚ ä¹ã€ç‹¬å å¼è¶…æ—¶èŽ·å– AQSé™¤äº†æä¾›ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•å¤–ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå¢žå¼ºç‰ˆçš„æ–¹æ³•ï¼štryAcquireNanos(int arg,long nanos)ã€‚è¯¥æ–¹æ³•ä¸ºacquireInterruptiblyæ–¹æ³•çš„è¿›ä¸€æ­¥å¢žå¼ºï¼Œå®ƒé™¤äº†å“åº”ä¸­æ–­å¤–ï¼Œè¿˜æœ‰è¶…æ—¶æŽ§åˆ¶ã€‚å³å¦‚æžœå½“å‰çº¿ç¨‹æ²¡æœ‰åœ¨æŒ‡å®šæ—¶é—´å†…èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œåˆ™ä¼šè¿”å›žfalseï¼Œå¦åˆ™è¿”å›žtrueã€‚ é’ˆå¯¹è¶…æ—¶æŽ§åˆ¶ï¼Œç¨‹åºé¦–å…ˆè®°å½•å”¤é†’æ—¶é—´deadline :deadline = System.nanoTime() +nanosTimeoutï¼ˆæ—¶é—´é—´éš”ï¼‰ã€‚ å¦‚æžœèŽ·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œåˆ™éœ€è¦è®¡ç®—å‡ºéœ€è¦ä¼‘çœ çš„æ—¶é—´é—´éš”nanosTimeout = deadline - System.nanoTime()ï¼Œå¦‚æžœnanosTimeout &lt;= 0 è¡¨ç¤ºå·²ç»è¶…æ—¶äº†ï¼Œè¿”å›žfalse; å¦‚æžœå¤§äºŽspinForTimeoutThreshold(1000L)åˆ™éœ€è¦ä¼‘çœ nanosTimeout ; å¦‚æžœnanosTimeout &lt;= spinForTimeoutThreshold ï¼Œå°±ä¸éœ€è¦ä¼‘çœ äº†ï¼Œç›´æŽ¥è¿›å…¥å¿«é€Ÿè‡ªæ—‹çš„è¿‡ç¨‹ã€‚åŽŸå› åœ¨äºŽ spinForTimeoutThreshold å·²ç»éžå¸¸å°äº†ï¼Œéžå¸¸çŸ­çš„æ—¶é—´ç­‰å¾…æ— æ³•åšåˆ°ååˆ†ç²¾ç¡®ï¼Œå¦‚æžœè¿™æ—¶å†æ¬¡è¿›è¡Œè¶…æ—¶ç­‰å¾…ï¼Œç›¸åä¼šè®©nanosTimeout çš„è¶…æ—¶ä»Žæ•´ä½“ä¸Šé¢è¡¨çŽ°å¾—ä¸æ˜¯é‚£ä¹ˆç²¾ç¡®ï¼Œæ‰€ä»¥åœ¨è¶…æ—¶éžå¸¸çŸ­çš„åœºæ™¯ä¸­ï¼ŒAQSä¼šè¿›è¡Œæ— æ¡ä»¶çš„å¿«é€Ÿè‡ªæ—‹ã€‚ æµç¨‹å›¾å¦‚ä¸‹ï¼š åã€å…±äº«å¼-å…±äº«å¼åŒæ­¥çŠ¶æ€èŽ·å– å…±äº«å¼ä¸Žç‹¬å å¼çš„æœ€ä¸»è¦åŒºåˆ«åœ¨äºŽåŒä¸€æ—¶åˆ»ç‹¬å å¼åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œè€Œå…±äº«å¼åœ¨åŒä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹èŽ·å–åŒæ­¥çŠ¶æ€ã€‚ä¾‹å¦‚è¯»æ“ä½œå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œï¼Œè€Œå†™æ“ä½œåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œå…¶ä»–æ“ä½œéƒ½ä¼šè¢«é˜»å¡žã€‚ AQSæä¾›acquireShared(int arg)æ–¹æ³•å…±äº«å¼èŽ·å–åŒæ­¥çŠ¶æ€ï¼š 1234public final void acquireShared(int arg) &#123; if (tryAcquireShared(arg) &lt; 0) doAcquireShared(arg);&#125; ä»Žä¸Šé¢ç¨‹åºå¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•é¦–å…ˆæ˜¯è°ƒç”¨tryAcquireShared(int arg)æ–¹æ³•å°è¯•èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æžœèŽ·å–å¤±è´¥åˆ™è°ƒç”¨doAcquireShared(int arg)è‡ªæ—‹æ–¹å¼èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œå…±äº«å¼èŽ·å–åŒæ­¥çŠ¶æ€çš„æ ‡å¿—æ˜¯è¿”å›ž &gt;= 0 çš„å€¼è¡¨ç¤ºèŽ·å–æˆåŠŸã€‚è‡ªæ—‹æ–¹å¼èŽ·å–åŒæ­¥çŠ¶æ€å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627private void doAcquireShared(int arg) &#123; final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head) &#123; int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; &#125; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; é€»è¾‘å‡ ä¹Žå’Œç‹¬å å¼é”çš„èŽ·å–ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œçš„è‡ªæ—‹è¿‡ç¨‹ä¸­èƒ½å¤Ÿé€€å‡ºçš„æ¡ä»¶æ˜¯å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹å¹¶ä¸”tryAcquireShared(arg)è¿”å›žå€¼å¤§äºŽç­‰äºŽ0å³èƒ½æˆåŠŸèŽ·å¾—åŒæ­¥çŠ¶æ€ã€‚ acquireShared(int arg)æ–¹æ³•ä¸å“åº”ä¸­æ–­ï¼Œä¸Žç‹¬å å¼ç›¸ä¼¼ï¼ŒAQSä¹Ÿæä¾›äº†å“åº”ä¸­æ–­ã€è¶…æ—¶çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼šacquireSharedInterruptibly(int arg)ã€tryAcquireSharedNanos(int arg,long nanos)ï¼Œè¿™é‡Œå°±ä¸åšè§£é‡Šäº†ã€‚ åä¸€ã€å…±äº«å¼åŒæ­¥çŠ¶æ€é‡Šæ”¾ èŽ·å–åŒæ­¥çŠ¶æ€åŽï¼Œéœ€è¦è°ƒç”¨release(int arg)æ–¹æ³•é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š 1234567public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; doReleaseShared(); return true; &#125; return false;&#125; å› ä¸ºå¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œé‡Šæ”¾åŒæ­¥çŠ¶æ€èµ„æºï¼Œæ‰€ä»¥éœ€è¦ç¡®ä¿åŒæ­¥çŠ¶æ€å®‰å…¨åœ°æˆåŠŸé‡Šæ”¾ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡CASå’Œå¾ªçŽ¯æ¥å®Œæˆçš„ã€‚ åäºŒã€å†å›žè¿‡å¤´æ¥çœ‹çœ‹ReentrantLockçš„åŽŸç† åœ¨å¯¹AQSåŽŸç†è¿›è¡Œå¤§æ¦‚äº†æ¢³ç†ä¹‹åŽï¼Œå†æ¥ç†è§£ReentrantLockå°±æ¯”è¾ƒå®¹æ˜“äº†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†çš„äº‹æƒ…éƒ½ç”±AQSåšå®Œäº†ï¼Œå‰©ä¸‹çš„åªè¦é‡å†™å‡ ä¸ªä¸ªæ€§åŒ–çš„æ–¹æ³•å³å¯ã€‚ è¿˜æ˜¯è¦çœ‹çœ‹æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼šlock()æ–¹æ³• 123public void lock() &#123; sync.lock();&#125; ä¸‹é¢æ¥çœ‹çœ‹è¿™ä¸ªlock()ï¼Œä¸€ç‚¹ç‚¹è¿›äº†æŠ½è±¡é™æ€å†…éƒ¨ç±»Syncä¸­åŽ»äº†ï¼š 1abstract void lock(); ä¸Šé¢è¯´è¿‡ï¼ŒReentrantLocké‡Œé¢å¤§éƒ¨åˆ†çš„åŠŸèƒ½éƒ½æ˜¯å§”æ‰˜ç»™Syncæ¥å®žçŽ°çš„ï¼ŒåŒæ—¶Syncå†…éƒ¨å®šä¹‰äº†lock()æŠ½è±¡æ–¹æ³•ç”±å…¶å­ç±»åŽ»å®žçŽ°çš„ï¼Œæ‰€ä»¥è¿™ä¸ªlockæ–¹æ³•çš„å…·ä½“å®žçŽ°æ˜¯åœ¨å­ç±»ä¸­å®Œæˆçš„ã€‚Syncçš„å­ç±»æœ‰NonfairSyncå’ŒFairSyncè¿™ä¸¤ä¸ªï¼Œä¸€çœ‹å°±çŸ¥é“äº†ï¼Œä¸€ä¸ªæ˜¯éžå…¬å¹³ä¸€ä¸ªæ˜¯å…¬å¹³ã€‚ åä¸‰ã€éžå…¬å¹³é” å…ˆæ¥çœ‹çœ‹æ¯”è¾ƒç®€å•çš„éžå…¬å¹³é”ï¼š 123456789101112131415161718static final class NonfairSync extends Sync &#123; private static final long serialVersionUID = 7316153563782823691L; /** * Performs lock. Try immediate barge, backing up to normal * acquire on failure. */ final void lock() &#123; if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1); &#125; protected final boolean tryAcquire(int acquires) &#123; return nonfairTryAcquire(acquires); &#125;&#125; æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªlock()æ–¹æ³•é‡Œé¢é¦–å…ˆç”¨CASå°è¯•èŽ·å–é”ï¼ŒèŽ·å–ä¸åˆ°åˆ™æ‰§è¡Œacquire()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ°å¥½æ˜¯å®Œå…¨ç”±AQSå®žçŽ°ï¼Œé‚£ä¹ˆå°±å›žåˆ°äº†ä¸Šé¢ä»‹ç»è¿‡çš„å†…å®¹äº†ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿å†è´´ä¸€ä¸‹æºç ï¼š 12345public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125; é¦–å…ˆå°±æ˜¯è°ƒç”¨tryAcquire()è¿™ä¸ªæ–¹æ³•ï¼Œå³å°è¯•èŽ·å–é”ï¼Œè¿™ä¸ªæ–¹æ³•ä¸Šé¢ä¹Ÿæè¿‡ï¼Œæ˜¯ç•™ç»™å…·ä½“çš„ç±»è‡ªå·±åŽ»å®žçŽ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦å›žåˆ°ReentrantLockä¸­æ¥çœ‹çœ‹ï¼Œæžœç„¶ï¼Œåœ¨ä¸Šé¢è´´çš„NonfairSyncè¿™ä¸ªç±»ä¸­å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œäº†é‡å†™ã€‚å³ï¼š 123protected final boolean tryAcquire(int acquires) &#123; return nonfairTryAcquire(acquires);&#125; è°ƒç”¨çš„æ–¹æ³•å°±æ˜¯å®žçŽ°å°è¯•èŽ·å–é”çš„æ ¸å¿ƒä»£ç ï¼š 123456789101112131415161718192021222324final boolean nonfairTryAcquire(int acquires) &#123; //å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); //èŽ·å–åŒæ­¥çŠ¶æ€ int c = getState(); //state == 0,è¡¨ç¤ºè¯¥é”æœªè¢«ä»»ä½•çº¿ç¨‹å æœ‰ï¼Œè¯¥é”èƒ½è¢«å½“å‰çº¿ç¨‹èŽ·å– if (c == 0) &#123; //èŽ·å–é”æˆåŠŸï¼Œè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹æ‰€æœ‰ if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; //çº¿ç¨‹é‡å…¥ //åˆ¤æ–­é”æŒæœ‰çš„çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹ else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; å°±å¾ˆç®€å•äº†ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†æ”¯æŒé‡å…¥æ€§ï¼Œåœ¨ç¬¬äºŒæ­¥å¢žåŠ äº†å¤„ç†é€»è¾‘ï¼Œå¦‚æžœè¯¥é”å·²ç»è¢«çº¿ç¨‹æ‰€å æœ‰äº†ï¼Œä¼šç»§ç»­æ£€æŸ¥å æœ‰çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹ï¼Œå¦‚æžœæ˜¯çš„è¯ï¼ŒåŒæ­¥çŠ¶æ€åŠ 1è¿”å›žtrueï¼Œè¡¨ç¤ºå¯ä»¥å†æ¬¡èŽ·å–æˆåŠŸã€‚æ¯æ¬¡é‡æ–°èŽ·å–éƒ½ä¼šå¯¹åŒæ­¥çŠ¶æ€è¿›è¡ŒåŠ ä¸€çš„æ“ä½œã€‚ å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ˜¯éžå…¬å¹³é”ï¼Œå°±æ˜¯è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¯èƒ½æ˜¯æ¯”å…ˆè¿›æ¥çš„çº¿ç¨‹å…ˆèŽ·å–é”ï¼Œå°±åƒåœ¨å¼€è½¦çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šç”±ä¸€äº›è½¦æ’åˆ°ä½ çš„å‰é¢ä¸€æ ·ã€‚ä½†æ˜¯å¦‚æžœå®ƒæ²¡æœ‰èŽ·å–é”ï¼Œåˆ™å…¥é˜Ÿã€‚ é‚£ä¹ˆå°è¯•èŽ·å–é”çš„é€»è¾‘æˆ‘ä»¬çŸ¥é“äº†ï¼Œé‚£ä¹ˆé‡Šæ”¾é”å‘¢ï¼Ÿ 123456789101112131415protected final boolean tryRelease(int releases) &#123; //1. åŒæ­¥çŠ¶æ€å‡1 int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; //2. åªæœ‰å½“åŒæ­¥çŠ¶æ€ä¸º0æ—¶ï¼Œé”æˆåŠŸè¢«é‡Šæ”¾ï¼Œè¿”å›žtrue free = true; setExclusiveOwnerThread(null); &#125; // 3. é”æœªè¢«å®Œå…¨é‡Šæ”¾ï¼Œè¿”å›žfalse setState(c); return free;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‡å…¥é”çš„é‡Šæ”¾å¿…é¡»å¾—ç­‰åˆ°åŒæ­¥çŠ¶æ€ä¸º0æ—¶é”æ‰ç®—æˆåŠŸé‡Šæ”¾ï¼Œå¦åˆ™é”ä»æœªé‡Šæ”¾ã€‚å¦‚æžœé”è¢«èŽ·å–næ¬¡ï¼Œé‡Šæ”¾äº†n-1æ¬¡ï¼Œè¯¥é”æœªå®Œå…¨é‡Šæ”¾è¿”å›žfalseï¼Œåªæœ‰è¢«é‡Šæ”¾næ¬¡æ‰ç®—æˆåŠŸé‡Šæ”¾ï¼Œè¿”å›žtrueã€‚ åå››ã€å…¬å¹³é” ä½•è°“å…¬å¹³æ€§ï¼Œæ˜¯é’ˆå¯¹èŽ·å–é”è€Œè¨€çš„ï¼Œå¦‚æžœä¸€ä¸ªé”æ˜¯å…¬å¹³çš„ï¼Œé‚£ä¹ˆé”çš„èŽ·å–é¡ºåºå°±åº”è¯¥ç¬¦åˆè¯·æ±‚ä¸Šçš„ç»å¯¹æ—¶é—´é¡ºåºï¼Œæ»¡è¶³FIFOã€‚ReentrantLockçš„æž„é€ æ–¹æ³•æ— å‚æ—¶æ˜¯æž„é€ éžå…¬å¹³é”ã€‚ æä¾›äº†æœ‰å‚æž„é€ å‡½æ•°ï¼Œå¯ä¼ å…¥ä¸€ä¸ªbooleanå€¼ï¼Œtrueæ—¶ä¸ºå…¬å¹³é”ï¼Œfalseæ—¶ä¸ºéžå…¬å¹³é”ï¼Œæºç ä¸ºï¼š 123public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; åœ¨ä¸Šé¢éžå…¬å¹³é”èŽ·å–æ—¶ï¼ˆnonfairTryAcquireæ–¹æ³•ï¼‰åªæ˜¯ç®€å•çš„èŽ·å–äº†ä¸€ä¸‹å½“å‰çŠ¶æ€åšäº†ä¸€äº›é€»è¾‘å¤„ç†ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°å½“å‰åŒæ­¥é˜Ÿåˆ—ä¸­çº¿ç¨‹ç­‰å¾…çš„æƒ…å†µã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å…¬å¹³é”çš„å¤„ç†é€»è¾‘æ˜¯æ€Žæ ·çš„ï¼Œæ ¸å¿ƒæ–¹æ³•ä¸ºï¼š 1234567891011121314151617181920protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false; &#125;&#125; è¿™æ®µä»£ç çš„é€»è¾‘ä¸ŽnonfairTryAcquireåŸºæœ¬ä¸Šä¸€è‡´ï¼Œå”¯ä¸€çš„ä¸åŒåœ¨äºŽå¢žåŠ äº†hasQueuedPredecessorsçš„é€»è¾‘åˆ¤æ–­ï¼Œæ–¹æ³•åå°±å¯çŸ¥é“è¯¥æ–¹æ³•ç”¨æ¥åˆ¤æ–­å½“å‰èŠ‚ç‚¹åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹çš„åˆ¤æ–­ï¼Œå¦‚æžœæœ‰å‰é©±èŠ‚ç‚¹è¯´æ˜Žæœ‰çº¿ç¨‹æ¯”å½“å‰çº¿ç¨‹æ›´æ—©çš„è¯·æ±‚èµ„æºï¼Œæ ¹æ®å…¬å¹³æ€§ï¼Œå½“å‰çº¿ç¨‹è¯·æ±‚èµ„æºå¤±è´¥ã€‚å¦‚æžœå½“å‰èŠ‚ç‚¹æ²¡æœ‰å‰é©±èŠ‚ç‚¹çš„è¯ï¼Œå†æ‰æœ‰åšåŽé¢çš„é€»è¾‘åˆ¤æ–­çš„å¿…è¦æ€§ã€‚å…¬å¹³é”æ¯æ¬¡éƒ½æ˜¯ä»ŽåŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹èŽ·å–åˆ°é”ï¼Œè€Œéžå…¬å¹³æ€§é”åˆ™ä¸ä¸€å®šï¼Œæœ‰å¯èƒ½åˆšé‡Šæ”¾é”çš„çº¿ç¨‹èƒ½å†æ¬¡èŽ·å–åˆ°é”ã€‚ åäº”ã€å…¬å¹³é” VS éžå…¬å¹³é” å…¬å¹³é”æ¯æ¬¡èŽ·å–åˆ°é”ä¸ºåŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¿è¯è¯·æ±‚èµ„æºæ—¶é—´ä¸Šçš„ç»å¯¹é¡ºåºï¼Œè€Œéžå…¬å¹³é”æœ‰å¯èƒ½åˆšé‡Šæ”¾é”çš„çº¿ç¨‹ä¸‹æ¬¡ç»§ç»­èŽ·å–è¯¥é”ï¼Œåˆ™æœ‰å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹æ°¸è¿œæ— æ³•èŽ·å–åˆ°é”ï¼Œé€ æˆâ€œé¥¥é¥¿â€çŽ°è±¡ã€‚ å…¬å¹³é”ä¸ºäº†ä¿è¯æ—¶é—´ä¸Šçš„ç»å¯¹é¡ºåºï¼Œéœ€è¦é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œéžå…¬å¹³é”ä¼šé™ä½Žä¸€å®šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé™ä½Žæ€§èƒ½å¼€é”€ã€‚å› æ­¤ï¼ŒReentrantLocké»˜è®¤é€‰æ‹©çš„æ˜¯éžå…¬å¹³é”ï¼Œåˆ™æ˜¯ä¸ºäº†å‡å°‘ä¸€éƒ¨åˆ†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¿è¯äº†ç³»ç»Ÿæ›´å¤§çš„åžåé‡ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Žåº•å±‚ç†è§£synchronized]]></title>
    <url>%2F2019%2F02%2F11%2Fthread%2F%E4%BB%8E%E5%BA%95%E5%B1%82%E7%90%86%E8%A7%A3synchronized%2F</url>
    <content type="text"><![CDATA[ä¸Šä¸€ç« äº†è§£äº†synchronizedçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ä¹‹åŽï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ·±å…¥äº†è§£äº†è§£å…¶åº•å±‚åŽŸç†ï¼Œå¹¶ä¸”è¯´æ˜Žå¯¹å®ƒçš„ä¼˜åŒ–ã€‚ ä¸€ã€synchronizedåº•å±‚å®žçŽ°åŽŸç† é¦–å…ˆç»™å‡ºä¸€ä¸ªä¸æ˜¯ç»“è®ºçš„ç»“è®ºï¼Œsynchronizedçš„å®žçŽ°åŸºç¡€æ˜¯ï¼šJAVAå¯¹è±¡å¤´å’ŒMonitorï¼Œç†è§£äº†è¿™ä¸¤è€…çš„ä½œç”¨å°±ç†è§£äº†synchronizedçš„å®žçŽ°åŽŸç†ã€‚ä¸‹é¢è¿›è¡Œè¯¦ç»†è®²è§£ã€‚ â­ç„¶åŽåœ¨æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹é”çš„å†…å­˜è¯­ä¹‰ï¼š å½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼ŒJAVAå†…å­˜æ¨¡åž‹ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”é¢æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ å½“çº¿ç¨‹èŽ·å–é”æ—¶ï¼ŒJAVAå†…å­˜æ¨¡åž‹ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆï¼Œä»Žè€Œä½¿å¾—è¢«ç›‘è§†å™¨ä¿æŠ¤çš„ä¸´ç•ŒåŒºä»£ç å¿…é¡»ä»Žä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚ åœ¨JAVAå†…å­˜æ¨¡åž‹-çº¿ç¨‹å…±äº«è¿™ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†å¯¹è±¡å¤´é‡Œé¢çš„åŸºæœ¬æž„æˆã€‚ æˆ‘ä»¬ç€é‡çœ‹ä¸€ä¸‹å¯¹è±¡å¤´ï¼Œä¸‹é¢ä¸¤ä¸ªè¿™é‡Œä¸éœ€è¦å…³å¿ƒã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…³é”®å­—ï¼šé”çŠ¶æ€æ ‡å¿—ã€‚å› æ­¤Mark Wordæ˜¯å®žçŽ°é”çš„å…³é”®äº†ã€‚ æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼ŒMark Wordæ˜¯ä¸€ä¸ªå¯å˜çš„ç»“æž„ï¼Œå¯å˜çš„éƒ¨åˆ†ä¸»è¦æœ‰å¦‚ä¸‹ï¼š å…¶ä¸­ï¼Œåå‘æ‰€å’Œè½»é‡çº§é”æ˜¯JDK1.6ä¹‹åŽå¯¹synchronizedä¼˜åŒ–æ‰€æ–°åŠ çš„ï¼ŒåŽæ–‡ä¼šæŽ¢è®¨å¯¹synchronizedçš„ä¼˜åŒ–ã€‚ OKï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬çŸ¥é“äº†æ¯ä¸ªå¯¹è±¡åŒºåŸŸçš„å¯¹è±¡å¤´è¿™ä¸€å—å­˜å‚¨äº†å…³äºŽé”çš„ä¿¡æ¯ï¼Œå³é”çŠ¶æ€ã€‚ä»”ç»†çœ‹è¡¨æ ¼ï¼Œæ¯”å¦‚é‡é‡çº§é”ï¼Œå°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„synchronizedå¯¹è±¡é”ï¼Œå®ƒçš„è¯´æ˜Žæ˜¯ï¼šæŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆã€‚é‚£è¿™ä¸ªé”æ˜¯ä»€ä¹ˆå‘¢ï¼ŸæŒ‡å‘çš„æ˜¯ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿè¿™ä¸ªå°±ä¸å¾—ä¸æåŠç¬¬äºŒä¸ªå…³é”®å­—å•¦ï¼šMonitor Monitor:æ¯ä¸ªå¯¹è±¡æ‰“å¨˜èƒŽç”Ÿä¸‹æ¥å°±è‡ªå¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œæˆä¸ºå†…éƒ¨é”æˆ–è€…Monitoré”ï¼Œä¹Ÿç§°ä¸ºç®¡ç¨‹æˆ–è€…ç›‘è§†å™¨é”ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ç§åŒæ­¥å·¥å…·ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºåŒæ­¥å¯¹è±¡ã€‚ é‚£ä¹ˆå›žåˆ°ä¸Šé¢çš„é—®é¢˜ä¸Šæ¥ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å°±æ˜¯Monitorå¯¹è±¡çš„èµ·å§‹åœ°å€ï¼Œå› æ­¤ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šå­˜åœ¨ä¸€ä¸ªMonitorä¸Žä¹‹å…³è”ï¼Œå½“è¿™ä¸ªMonitorè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰æ—¶ï¼Œå®ƒå°±ä¼šå¤„äºŽé”å®šçŠ¶æ€ã€‚ åœ¨Hotspotè™šæ‹Ÿæœºä¸­ï¼Œè¿™ä¸ªMonitoræ˜¯ç”±ObjectMonitorå®žçŽ°çš„ï¼Œä½äºŽè™šæ‹Ÿæœºæºç ä¸­ï¼Œç”¨C++å®žçŽ°ã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ï¼ è¿™ä¸ªæºç åœ°å€ä¸ºï¼šobjectMonitor.hpp æˆ‘ä»¬çœ‹åˆ°äº†å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å…³é”®å­—ï¼Œé¦–å…ˆï¼Œæ¯ä¸ªç­‰å¾…èŽ·å–é”çš„çº¿ç¨‹éƒ½ä¼šè¢«å°è£…ä¸ºObjectWaiterå¯¹è±¡ã€‚_WaitSetå°±æ˜¯ä¹‹å‰è¯´çš„æ‰€æœ‰waitçŠ¶æ€çš„çº¿ç¨‹éƒ½ä¼šè¢«æ”¾åœ¨è¿™é‡Œç­‰å¾…å”¤é†’å†åŽ»ç«žäº‰é”ï¼›_EntryListå°±æ˜¯æ‰€æœ‰ç­‰å¾…èŽ·å–é”çš„çº¿ç¨‹å¯¹è±¡å­˜æ”¾çš„åœ°æ–¹ã€‚_owneræŒ‡å‘çš„æ˜¯å½“å‰èŽ·å–åˆ°é”çš„çº¿ç¨‹å¯¹è±¡ã€‚_countä¸ºè®¡æ•°ï¼Œè¿™ä¸ªå°±è·Ÿå¯é‡å…¥ç›¸å…³äº†ï¼Œçº¿ç¨‹è¿›æ¥ä¸€æ¬¡å°±åŠ ä¸€æ¬¡ï¼Œä¸º0çš„æ—¶å€™å°±è¯´æ˜Žé‡Šæ”¾é”äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶å¤„äºŽ_EntryListæ± ä¸­çš„çº¿ç¨‹éƒ½å¯ä»¥åŽ»ç«žäº‰è¿™æŠŠé”äº†ã€‚ å°†ä¸Šé¢æ–‡å­—è½¬æ¢ä¸ºå›¾æ¥ç†è§£å°±æ˜¯ï¼š ä»¥ä¸Šå°±æ˜¯Synchronizedå®žçŽ°é”çš„åŽŸç†ã€‚ äºŒã€synchronizedåœ¨å­—èŠ‚ç å±‚é¢çš„è¯­ä¹‰ æˆ‘ä»¬æ‹¿ä¸‹é¢è¿™æ®µç¨‹åºä½œä¸ºç¤ºä¾‹ï¼š æˆ‘ä»¬å¯¹è¿™ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œjavapçš„åˆ†æžï¼Œé’ˆå¯¹ç¬¬ä¸€ä¸ªåŒæ­¥ä»£ç å—ï¼š æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼ŒsynchronizedåŒæ­¥ä»£ç å—å®žçŽ°åŒæ­¥çš„å…³é”®æŒ‡ä»¤æ˜¯monitorenterå’Œmonitorexitã€‚è¿™æ°å¥½ä¸Žä¸Šé¢è¯´çš„monitoré”å¯¹åº”ä¸Šï¼Œå³å¤šä¸ªçº¿ç¨‹åœ¨_EntryListä¸­ç«žäº‰ï¼Œçœ‹è°èƒ½æ‹¿åˆ°monitoré”çš„æŒ‡å‘å…¨ï¼Œæ‹¿åˆ°äº†å°±å¯ä»¥è¿›æ¥ï¼Œæ‹¿ä¸åˆ°å°±é˜»å¡žåœ¨monitorenterå¤„ç»§ç»­ç­‰å¾…ã€‚çŸ¥é“è¿™ä¸ªé”è¢«é‡Šæ”¾äº†ä¸ºæ­¢ã€‚ é‚£ä¹ˆå¯¹äºŽsynchronizedä¿®é¥°çš„æ–¹æ³•å‘¢ï¼Ÿ å¦‚æžœæ˜¯åŒæ­¥æ–¹æ³•ï¼Œåœ¨å­—èŠ‚ç å±‚é¢çš„è¡¨ç¤ºæ˜¯ç•¥æœ‰ä¸åŒçš„ã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ˜¯åœ¨æŸä¸ªæ ‡è¯†ä½ä¸Šç»™å…¶æ‰“ä¸ŠACC_SYNCHRONIZEDæ ‡å¿—ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªsynchronizedä¿®é¥°çš„åŒæ­¥æ–¹æ³•ï¼Œé‚£ä¹ˆä¸‹é¢å¯¹äºŽé”ç«žäº‰å•¥çš„éƒ½ä¸Žä¸Šé¢ä¸€æ ·ï¼Œæ‰€ä»¥åªæ˜¯å­—èŠ‚ç å±‚é¢çš„è¡¨ç¤ºä¸åŒè€Œå·²ï¼ŒåŽŸç†éƒ½ä¸€æ ·ã€‚ ä¸‰ã€å¯¹synchronizedçš„ä¼˜åŒ– å¯¹äºŽsynchronizedçš„æ€§èƒ½ï¼Œåœ¨ä»¥å‰ä¸€ç›´æ˜¯å—¤ä¹‹ä»¥é¼»çš„ï¼Œè¿™ç§è§‚å¿µä»Žè€ä¸€ä»£çš„ç¨‹åºçŒ¿ä»¬å£å£ç›¸ä¼ åˆ°å¦‚ä»Šï¼Œå¯è°“æ˜¯æ ¹æ·±è’‚å›ºï¼Œåœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œç¡®å®žæ˜¯å¾ˆæ…¢ï¼ŒåŽŸå› å¦‚ä¸‹ï¼š æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronizedå±žäºŽé‡é‡çº§é”ï¼Œä¾èµ–äºŽMutex Lockå®žçŽ° çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éœ€è¦ä»Žç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œå¼€é”€è¾ƒå¤§ jdk1.6å¯¹é”çš„å®žçŽ°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚ é”ä¸»è¦å­˜åœ¨å››ç§çŠ¶æ€ï¼Œä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ï¼Œä»–ä»¬ä¼šéšç€ç«žäº‰çš„æ¿€çƒˆè€Œé€æ¸å‡çº§ã€‚æ³¨æ„é”å¯ä»¥å‡çº§ä¸å¯é™çº§ï¼Œè¿™ç§ç­–ç•¥æ˜¯ä¸ºäº†æé«˜èŽ·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆçŽ‡ã€‚ 3.1 è‡ªæ—‹é” çº¿ç¨‹çš„é˜»å¡žå’Œå”¤é†’éœ€è¦CPUä»Žç”¨æˆ·æ€è½¬ä¸ºæ ¸å¿ƒæ€ï¼Œé¢‘ç¹çš„é˜»å¡žå’Œå”¤é†’å¯¹CPUæ¥è¯´æ˜¯ä¸€ä»¶è´Ÿæ‹…å¾ˆé‡çš„å·¥ä½œï¼ŒåŠ¿å¿…ä¼šç»™ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å¸¦æ¥å¾ˆå¤§çš„åŽ‹åŠ›ã€‚åŒæ—¶æˆ‘ä»¬å‘çŽ°åœ¨è®¸å¤šåº”ç”¨ä¸Šé¢ï¼Œå¯¹è±¡é”çš„é”çŠ¶æ€åªä¼šæŒç»­å¾ˆçŸ­ä¸€æ®µæ—¶é—´ï¼Œä¸ºäº†è¿™ä¸€æ®µå¾ˆçŸ­çš„æ—¶é—´é¢‘ç¹åœ°é˜»å¡žå’Œå”¤é†’çº¿ç¨‹æ˜¯éžå¸¸ä¸å€¼å¾—çš„ã€‚æ‰€ä»¥å¼•å…¥è‡ªæ—‹é”ã€‚ ä½•è°“è‡ªæ—‹é”ï¼Ÿ æ‰€è°“è‡ªæ—‹é”ï¼Œå°±æ˜¯è®©è¯¥çº¿ç¨‹ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¸ä¼šè¢«ç«‹å³æŒ‚èµ·ï¼Œçœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦ä¼šå¾ˆå¿«é‡Šæ”¾é”ã€‚æ€Žä¹ˆç­‰å¾…å‘¢ï¼Ÿæ‰§è¡Œä¸€æ®µæ— æ„ä¹‰çš„å¾ªçŽ¯å³å¯ï¼ˆè‡ªæ—‹ï¼‰ã€‚ è‡ªæ—‹ç­‰å¾…ä¸èƒ½æ›¿ä»£é˜»å¡žï¼Œå…ˆä¸è¯´å¯¹å¤„ç†å™¨æ•°é‡çš„è¦æ±‚ï¼ˆå¤šæ ¸ï¼Œè²Œä¼¼çŽ°åœ¨æ²¡æœ‰å•æ ¸çš„å¤„ç†å™¨äº†ï¼‰ï¼Œè™½ç„¶å®ƒå¯ä»¥é¿å…çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ï¼Œä½†æ˜¯å®ƒå ç”¨äº†å¤„ç†å™¨çš„æ—¶é—´ã€‚å¦‚æžœæŒæœ‰é”çš„çº¿ç¨‹å¾ˆå¿«å°±é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„æ•ˆçŽ‡å°±éžå¸¸å¥½ï¼Œåä¹‹ï¼Œè‡ªæ—‹çš„çº¿ç¨‹å°±ä¼šç™½ç™½æ¶ˆè€—æŽ‰å¤„ç†çš„èµ„æºï¼Œå®ƒä¸ä¼šåšä»»ä½•æœ‰æ„ä¹‰çš„å·¥ä½œï¼Œå…¸åž‹çš„å ç€èŒ…å‘ä¸æ‹‰å±Žï¼Œè¿™æ ·åè€Œä¼šå¸¦æ¥æ€§èƒ½ä¸Šçš„æµªè´¹ã€‚æ‰€ä»¥è¯´ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´ï¼ˆè‡ªæ—‹çš„æ¬¡æ•°ï¼‰å¿…é¡»è¦æœ‰ä¸€ä¸ªé™åº¦ï¼Œå¦‚æžœè‡ªæ—‹è¶…è¿‡äº†å®šä¹‰çš„æ—¶é—´ä»ç„¶æ²¡æœ‰èŽ·å–åˆ°é”ï¼Œåˆ™åº”è¯¥è¢«æŒ‚èµ·ã€‚ è‡ªæ—‹é”åœ¨JDK 1.4.2ä¸­å¼•å…¥ï¼Œé»˜è®¤å…³é—­ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨-XX:+UseSpinningå¼€å¼€å¯ï¼Œåœ¨JDK1.6ä¸­é»˜è®¤å¼€å¯ã€‚åŒæ—¶è‡ªæ—‹çš„é»˜è®¤æ¬¡æ•°ä¸º10æ¬¡ï¼Œå¯ä»¥é€šè¿‡å‚æ•°-XX:PreBlockSpinæ¥è°ƒæ•´ï¼› å¦‚æžœé€šè¿‡å‚æ•°-XX:preBlockSpinæ¥è°ƒæ•´è‡ªæ—‹é”çš„è‡ªæ—‹æ¬¡æ•°ï¼Œä¼šå¸¦æ¥è¯¸å¤šä¸ä¾¿ã€‚å‡å¦‚æˆ‘å°†å‚æ•°è°ƒæ•´ä¸º10ï¼Œä½†æ˜¯ç³»ç»Ÿå¾ˆå¤šçº¿ç¨‹éƒ½æ˜¯ç­‰ä½ åˆšåˆšé€€å‡ºçš„æ—¶å€™å°±é‡Šæ”¾äº†é”ï¼ˆå‡å¦‚ä½ å¤šè‡ªæ—‹ä¸€ä¸¤æ¬¡å°±å¯ä»¥èŽ·å–é”ï¼‰ï¼Œä½ æ˜¯ä¸æ˜¯å¾ˆå°´å°¬ã€‚äºŽæ˜¯JDK1.6å¼•å…¥è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼Œè®©è™šæ‹Ÿæœºä¼šå˜å¾—è¶Šæ¥è¶Šèªæ˜Žã€‚ 3.2 é€‚åº”è‡ªæ—‹é” JDK 1.6å¼•å…¥äº†æ›´åŠ èªæ˜Žçš„è‡ªæ—‹é”ï¼Œå³è‡ªé€‚åº”è‡ªæ—‹é”ã€‚æ‰€è°“è‡ªé€‚åº”å°±æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸å†æ˜¯å›ºå®šçš„ï¼Œå®ƒæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å®ƒæ€Žä¹ˆåšå‘¢ï¼Ÿçº¿ç¨‹å¦‚æžœè‡ªæ—‹æˆåŠŸäº†ï¼Œé‚£ä¹ˆä¸‹æ¬¡è‡ªæ—‹çš„æ¬¡æ•°ä¼šæ›´åŠ å¤šï¼Œå› ä¸ºè™šæ‹Ÿæœºè®¤ä¸ºæ—¢ç„¶ä¸Šæ¬¡æˆåŠŸäº†ï¼Œé‚£ä¹ˆæ­¤æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½ä¼šå†æ¬¡æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­çš„æ¬¡æ•°æ›´å¤šã€‚åä¹‹ï¼Œå¦‚æžœå¯¹äºŽæŸä¸ªé”ï¼Œå¾ˆå°‘æœ‰è‡ªæ—‹èƒ½å¤ŸæˆåŠŸçš„ï¼Œé‚£ä¹ˆåœ¨ä»¥åŽè¦æˆ–è€…è¿™ä¸ªé”çš„æ—¶å€™è‡ªæ—‹çš„æ¬¡æ•°ä¼šå‡å°‘ç”šè‡³çœç•¥æŽ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ æœ‰äº†è‡ªé€‚åº”è‡ªæ—‹é”ï¼Œéšç€ç¨‹åºè¿è¡Œå’Œæ€§èƒ½ç›‘æŽ§ä¿¡æ¯çš„ä¸æ–­å®Œå–„ï¼Œè™šæ‹Ÿæœºå¯¹ç¨‹åºé”çš„çŠ¶å†µé¢„æµ‹ä¼šè¶Šæ¥è¶Šå‡†ç¡®ï¼Œè™šæ‹Ÿæœºä¼šå˜å¾—è¶Šæ¥è¶Šèªæ˜Žã€‚ 3.3 é”æ¶ˆé™¤ ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œæ“ä½œæ—¶éœ€è¦å¯¹è¿™éƒ¨åˆ†æ“ä½œè¿›è¡ŒåŒæ­¥æŽ§åˆ¶ï¼Œä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼ŒJVMæ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«žäº‰ï¼Œè¿™æ˜¯JVMä¼šå¯¹è¿™äº›åŒæ­¥é”è¿›è¡Œé”æ¶ˆé™¤ã€‚é”æ¶ˆé™¤çš„ä¾æ®æ˜¯é€ƒé€¸åˆ†æžçš„æ•°æ®æ”¯æŒã€‚ å¦‚æžœä¸å­˜åœ¨ç«žäº‰ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦åŠ é”å‘¢ï¼Ÿæ‰€ä»¥é”æ¶ˆé™¤å¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”çš„æ—¶é—´ã€‚å˜é‡æ˜¯å¦é€ƒé€¸ï¼Œå¯¹äºŽè™šæ‹Ÿæœºæ¥è¯´éœ€è¦ä½¿ç”¨æ•°æ®æµåˆ†æžæ¥ç¡®å®šï¼Œä½†æ˜¯å¯¹äºŽæˆ‘ä»¬ç¨‹åºå‘˜æ¥è¯´è¿™è¿˜ä¸æ¸…æ¥šä¹ˆï¼Ÿæˆ‘ä»¬ä¼šåœ¨æ˜Žæ˜ŽçŸ¥é“ä¸å­˜åœ¨æ•°æ®ç«žäº‰çš„ä»£ç å—å‰åŠ ä¸ŠåŒæ­¥å—ï¼Ÿä½†æ˜¯æœ‰æ—¶å€™ç¨‹åºå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³çš„é‚£æ ·ï¼Ÿæˆ‘ä»¬è™½ç„¶æ²¡æœ‰æ˜¾ç¤ºä½¿ç”¨é”ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸€äº›JDKçš„å†…ç½®APIæ—¶ï¼Œå¦‚StringBufferã€Vectorã€HashTableç­‰ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå­˜åœ¨éšå½¢çš„åŠ é”æ“ä½œã€‚æ¯”å¦‚StringBufferçš„append()æ–¹æ³•ï¼ŒVectorçš„add()æ–¹æ³•ï¼š 12345678public void vectorTest()&#123; Vector&lt;String&gt; vector = new Vector&lt;String&gt;(); for(int i = 0 ; i &lt; 10 ; i++)&#123; vector.add(i + ""); &#125; System.out.println(vector);&#125; åœ¨è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼ŒJVMå¯ä»¥æ˜Žæ˜¾æ£€æµ‹åˆ°å˜é‡vectoræ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•vectorTest()ä¹‹å¤–ï¼Œæ‰€ä»¥JVMå¯ä»¥å¤§èƒ†åœ°å°†vectorå†…éƒ¨çš„åŠ é”æ“ä½œæ¶ˆé™¤ã€‚ 3.4 é”ç²—åŒ– æˆ‘ä»¬çŸ¥é“åœ¨ä½¿ç”¨åŒæ­¥é”çš„æ—¶å€™ï¼Œéœ€è¦è®©åŒæ­¥å—çš„ä½œç”¨èŒƒå›´å°½å¯èƒ½å°â€”ä»…åœ¨å…±äº«æ•°æ®çš„å®žé™…ä½œç”¨åŸŸä¸­æ‰è¿›è¡ŒåŒæ­¥ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä½¿éœ€è¦åŒæ­¥çš„æ“ä½œæ•°é‡å°½å¯èƒ½ç¼©å°ï¼Œå¦‚æžœå­˜åœ¨é”ç«žäº‰ï¼Œé‚£ä¹ˆç­‰å¾…é”çš„çº¿ç¨‹ä¹Ÿèƒ½å°½å¿«æ‹¿åˆ°é”ã€‚ åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°è§‚ç‚¹æ˜¯æ­£ç¡®çš„ï¼ŒLZä¹Ÿä¸€ç›´åšæŒç€è¿™ä¸ªè§‚ç‚¹ã€‚ä½†æ˜¯å¦‚æžœä¸€ç³»åˆ—çš„è¿žç»­åŠ é”è§£é”æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥å¼•å…¥é”ç²—åŒ–çš„æ¦‚å¿µã€‚ é”ç²—è¯æ¦‚å¿µæ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯å°†å¤šä¸ªè¿žç»­çš„åŠ é”ã€è§£é”æ“ä½œè¿žæŽ¥åœ¨ä¸€èµ·ï¼Œæ‰©å±•æˆä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”ã€‚å¦‚ä¸Šé¢å®žä¾‹ï¼švectoræ¯æ¬¡addçš„æ—¶å€™éƒ½éœ€è¦åŠ é”æ“ä½œï¼ŒJVMæ£€æµ‹åˆ°å¯¹åŒä¸€ä¸ªå¯¹è±¡ï¼ˆvectorï¼‰è¿žç»­åŠ é”ã€è§£é”æ“ä½œï¼Œä¼šåˆå¹¶ä¸€ä¸ªæ›´å¤§èŒƒå›´çš„åŠ é”ã€è§£é”æ“ä½œï¼Œå³åŠ é”è§£é”æ“ä½œä¼šç§»åˆ°forå¾ªçŽ¯ä¹‹å¤–ã€‚ 3.5 åå‘é” åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«žäº‰ï¼Œæ€»æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡èŽ·å¾—ã€‚ â­â­â­æ ¸å¿ƒçš„æ€æƒ³æ˜¯ï¼šå¦‚æžœä¸€ä¸ªçº¿ç¨‹èŽ·å¾—äº†é”ï¼Œé‚£ä¹ˆé”å°±ä¼šè¿›å…¥åå‘æ¨¡å¼ï¼Œæ­¤æ—¶Mark Wordçš„ç»“æž„ä¹Ÿå˜ä¸ºåå‘é”ç»“æž„ï¼Œå½“è¯¥ç»“æž„å†æ¬¡è¯·æ±‚é”æ—¶ï¼Œæ— éœ€å†åšä»»ä½•åŒæ­¥æ“ä½œï¼Œå³èŽ·å–é”çš„è¿‡ç¨‹åªéœ€è¦æ£€æŸ¥Mark Wordçš„é”æ ‡è®°ä½ä½åå‘é”ä»¥åŠå½“å‰çº¿ç¨‹IDç­‰äºŽMark Wordçš„ThreadIdå³å¯ï¼Œè¿™æ ·çœåŽ»äº†å¤§é‡æœ‰å…³é”ç”³è¯·çš„æ“ä½œã€‚ å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«žäº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„èŽ·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŽŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŽŸå­æŒ‡ä»¤ï¼ˆç”±äºŽä¸€æ—¦å‡ºçŽ°å¤šçº¿ç¨‹ç«žäº‰çš„æƒ…å†µå°±å¿…é¡»æ’¤é”€åå‘é”ï¼Œæ‰€ä»¥åå‘é”çš„æ’¤é”€æ“ä½œçš„æ€§èƒ½æŸè€—å¿…é¡»å°äºŽèŠ‚çœä¸‹æ¥çš„CASåŽŸå­æŒ‡ä»¤çš„æ€§èƒ½æ¶ˆè€—ï¼‰ã€‚ä¸Šé¢è¯´è¿‡ï¼Œè½»é‡çº§é”æ˜¯ä¸ºäº†åœ¨çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—æ—¶æé«˜æ€§èƒ½ï¼Œè€Œåå‘é”åˆ™æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—æ—¶è¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚ å®ƒçš„æ€æƒ³å¯ä»¥ç†è§£ä¸ºCASï¼Œå› æ­¤è¿™ç§é”ä¸é€‚åˆäºŽé”ç«žäº‰æ¯”è¾ƒæ¿€çƒˆçš„å¤šçº¿ç¨‹åœºåˆã€‚ åå‘é”çš„èŽ·å–å’Œé‡Šæ”¾ï¼š è®¿é—® Mark Word ä¸­åå‘é”çš„æ ‡è¯†ä½æ˜¯å¦ä¸º1ï¼Œå¦‚æžœæ˜¯1ï¼Œåˆ™ç¡®å®šä¸ºåå‘é”ã€‚ å¦‚æžœåå‘é”çš„æ ‡è¯†ä½ä¸º0ï¼Œè¯´æ˜Žæ­¤æ—¶æ˜¯å¤„äºŽæ— é”çŠ¶æ€ï¼Œåˆ™å½“å‰çº¿ç¨‹é€šè¿‡CASæ“ä½œå°è¯•èŽ·å–åå‘é”ï¼Œå¦‚æžœèŽ·å–é”æˆåŠŸï¼Œåˆ™å°†Mark Wordä¸­çš„åå‘çº¿ç¨‹IDè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹IDï¼›å¹¶ä¸”å°†åå‘æ ‡è¯†ä½è®¾ä¸º1ã€‚ å¦‚æžœåå‘é”çš„æ ‡è¯†ä½ä¸ä¸º1ï¼Œä¹Ÿä¸ä¸º0(æ­¤æ—¶åå‘é”çš„æ ‡è¯†ä½æ²¡æœ‰å€¼)ï¼Œè¯´æ˜Žå‘ç”Ÿäº†ç«žäº‰ï¼Œåå‘é”å·²ç»è†¨èƒ€ä¸ºè½»é‡çº§é”ï¼Œè¿™æ—¶ä½¿ç”¨CASæ“ä½œå°è¯•èŽ·å¾—é”ã€‚ å¦‚æžœæ˜¯åå‘é”ï¼Œåˆ™åˆ¤æ–­ Mark Word ä¸­çš„åå‘çº¿ç¨‹IDæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œå¦‚æžœåå‘çº¿ç¨‹IDæŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œåˆ™è¡¨æ˜Žå½“å‰çº¿ç¨‹å·²ç»èŽ·å–åˆ°äº†é”ï¼› å¦‚æžœåå‘çº¿ç¨‹IDå¹¶æœªæŒ‡å‘å½“å‰çº¿ç¨‹ï¼Œåˆ™é€šè¿‡CASæ“ä½œå°è¯•èŽ·å–åå‘é”ï¼Œå¦‚æžœèŽ·å–é”æˆåŠŸï¼Œåˆ™å°† Mark Word ä¸­çš„åå‘çº¿ç¨‹IDè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹IDï¼› å¦‚æžœCASèŽ·å–åå‘é”å¤±è´¥ï¼Œåˆ™è¡¨ç¤ºæœ‰ç«žäº‰ã€‚å½“åˆ°è¾¾å…¨å±€å®‰å…¨ç‚¹æ—¶(åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç )ï¼ŒèŽ·å¾—åå‘é”çš„çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œåå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œç„¶åŽè¢«é˜»å¡žåœ¨å®‰å…¨ç‚¹çš„çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚ åå‘é”çš„é‡Šæ”¾ï¼š å½“å…¶å®ƒçš„çº¿ç¨‹å°è¯•èŽ·å–åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾åå‘é”ã€‚ é‡Šæ”¾åå‘é”éœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹(åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç )ã€‚ - é¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œç„¶åŽæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æ´»ç€ï¼Œå¦‚æžœçº¿ç¨‹ä¸å¤„äºŽæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€ï¼Œ - å¦‚æžœçº¿ç¨‹è¿˜æ´»ç€ï¼Œè¯´æ˜Žæ­¤æ—¶å‘ç”Ÿäº†ç«žäº‰ï¼Œåˆ™åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œç„¶åŽåˆšåˆšè¢«æš‚åœçš„çº¿ç¨‹ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚ 3.6 è½»é‡çº§é” å¼•å…¥è½»é‡çº§é”çš„ä¸»è¦ç›®çš„æ˜¯åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«žäº‰çš„å‰æä¸‹ï¼Œå‡å°‘ä¼ ç»Ÿçš„é‡é‡çº§é”ä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚å½“å…³é—­åå‘é”åŠŸèƒ½æˆ–è€…å¤šä¸ªçº¿ç¨‹ç«žäº‰åå‘é”å¯¼è‡´åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œåˆ™ä¼šå°è¯•èŽ·å–è½»é‡çº§é”ã€‚ â­è½»é‡çº§é”æ‰€é€‚åº”çš„åœºæ™¯æ˜¯çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„æƒ…å†µï¼Œå¦‚æžœå­˜åœ¨åŒä¸€æ—¶é—´è®¿é—®åŒä¸€é”çš„æƒ…å†µï¼Œå°±ä¼šå¯¼è‡´è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚ è½»é‡çº§é”çš„åŠ é”è¿‡ç¨‹ï¼š 1.å½“ä½¿ç”¨è½»é‡çº§é”(é”æ ‡è¯†ä½ä¸º00)æ—¶ï¼Œçº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVMä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆæ¡¢ä¸­åˆ›å»ºç”¨äºŽå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­(æ³¨:é”è®°å½•ä¸­çš„æ ‡è¯†å­—æ®µç§°ä¸ºDisplaced Mark Word)ã€‚ 2.å°†å¯¹è±¡å¤´ä¸­çš„MarkWordå¤åˆ¶åˆ°æ ˆæ¡¢ä¸­çš„é”è®°å½•ä¸­ä¹‹åŽï¼Œè™šæ‹Ÿæœºå°†å°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´ä¸­Mark Wordæ›¿æ¢ä¸ºæŒ‡å‘è¯¥çº¿ç¨‹è™šæ‹Ÿæœºæ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆï¼Œæ­¤æ—¶å¦‚æžœæ²¡æœ‰çº¿ç¨‹å æœ‰é”æˆ–è€…æ²¡æœ‰çº¿ç¨‹ç«žäº‰é”ï¼Œåˆ™å½“å‰çº¿ç¨‹æˆåŠŸèŽ·å–åˆ°é”ï¼Œç„¶åŽæ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ã€‚ 3.å¦‚æžœåœ¨èŽ·å–åˆ°é”çš„çº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿå®Œæˆäº†æ ˆæ¡¢ä¸­é”è®°å½•çš„åˆ›å»ºï¼Œå¹¶ä¸”å·²ç»å°†å¯¹è±¡å¤´ä¸­çš„MarkWordå¤åˆ¶åˆ°äº†è‡ªå·±çš„é”è®°å½•ä¸­ï¼Œç„¶åŽå°è¯•ä½¿ç”¨CASå°†å¯¹è±¡å¤´ä¸­çš„MarkWordä¿®æ”¹ä¸ºæŒ‡å‘è‡ªå·±çš„é”è®°å½•çš„æŒ‡é’ˆï¼Œä½†æ˜¯ç”±äºŽä¹‹å‰èŽ·å–åˆ°é”çš„çº¿ç¨‹å·²ç»å°†å¯¹è±¡å¤´ä¸­çš„MarkWordä¿®æ”¹è¿‡äº†(å¹¶ä¸”çŽ°åœ¨è¿˜åœ¨æ‰§è¡ŒåŒæ­¥ä½“ä¸­çš„ä»£ç ,å³ä»ç„¶æŒæœ‰ç€é”)ï¼Œæ‰€ä»¥æ­¤æ—¶å¯¹è±¡å¤´ä¸­çš„MarkWordä¸Žå½“å‰çº¿ç¨‹é”è®°å½•ä¸­MarkWordçš„å€¼ä¸åŒï¼Œå¯¼è‡´CASæ“ä½œå¤±è´¥ï¼Œç„¶åŽè¯¥çº¿ç¨‹å°±ä¼šä¸åœåœ°å¾ªçŽ¯ä½¿ç”¨CASæ“ä½œè¯•å›¾å°†å¯¹è±¡å¤´ä¸­çš„MarkWordæ›¿æ¢ä¸ºè‡ªå·±é”è®°å½•ä¸­MarkWordçš„å€¼ï¼Œ(å½“å¾ªçŽ¯æ¬¡æ•°æˆ–å¾ªçŽ¯æ—¶é—´è¾¾åˆ°ä¸Šé™æ—¶åœæ­¢å¾ªçŽ¯)å¦‚æžœåœ¨å¾ªçŽ¯ç»“æŸä¹‹å‰CASæ“ä½œæˆåŠŸï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°±å¯ä»¥æˆåŠŸèŽ·å–åˆ°é”ï¼Œå¦‚æžœå¾ªçŽ¯ç»“æŸä¹‹åŽä¾ç„¶èŽ·å–ä¸åˆ°é”ï¼Œåˆ™é”èŽ·å–å¤±è´¥ï¼Œå¯¹è±¡å¤´ä¸­çš„MarkWordä¼šè¢«ä¿®æ”¹ä¸ºæŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œç„¶åŽè¿™ä¸ªèŽ·å–é”å¤±è´¥çš„çº¿ç¨‹å°±ä¼šè¢«æŒ‚èµ·ï¼Œé˜»å¡žäº†ã€‚ 4.å½“æŒæœ‰é”çš„é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥ä½“ä¹‹åŽï¼Œä½¿ç”¨CASæ“ä½œå°†å¯¹è±¡å¤´ä¸­çš„MarkWordè¿˜åŽŸä¸ºæœ€åˆçš„çŠ¶æ€æ—¶(å°†å¯¹è±¡å¤´ä¸­æŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆæ›¿æ¢ä¸ºDisplaced Mark Word )ï¼Œå‘çŽ°MarkWordå·²è¢«ä¿®æ”¹ä¸ºæŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œå› æ­¤CASæ“ä½œå¤±è´¥ï¼Œè¯¥çº¿ç¨‹ä¼šé‡Šæ”¾é”å¹¶å”¤èµ·é˜»å¡žç­‰å¾…çš„çº¿ç¨‹ï¼Œå¼€å§‹æ–°ä¸€è½®å¤ºé”ä¹‹äº‰ï¼Œè€Œæ­¤æ—¶ï¼Œè½»é‡çº§é”å·²ç»è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œæ‰€æœ‰ç«žäº‰å¤±è´¥çš„çº¿ç¨‹éƒ½ä¼šé˜»å¡žï¼Œè€Œä¸æ˜¯è‡ªæ—‹ã€‚ é” ä¼˜ç‚¹ ç¼ºç‚¹ è¯•ç”¨åœºæ™¯ åå‘é” åŠ é”å’Œè§£é”ä¸éœ€è¦é¢å¤–çš„æ¶ˆè€—ï¼Œå’Œæ‰§è¡ŒéžåŒæ­¥æ–¹æ³•æ¯”ä»…å­˜åœ¨çº³ç§’çº§çš„å·®è·ã€‚ å¦‚æžœçº¿ç¨‹é—´å­˜åœ¨é”ç«žäº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—ã€‚ é€‚ç”¨äºŽåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—åœºæ™¯ã€‚ è½»é‡çº§é” ç«žäº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡žï¼Œæé«˜äº†ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚ å¦‚æžœå§‹ç»ˆå¾—ä¸åˆ°é”ç«žäº‰çš„çº¿ç¨‹ä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPUã€‚ è¿½æ±‚å“åº”æ—¶é—´ã€‚åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦éžå¸¸å¿«ã€‚ é‡é‡çº§é” çº¿ç¨‹ç«žäº‰ä¸ä½¿ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€—CPUã€‚ çº¿ç¨‹é˜»å¡žï¼Œå“åº”æ—¶é—´ç¼“æ…¢ã€‚ è¿½æ±‚åžåé‡ã€‚åŒæ­¥å—æ‰§è¡Œé€Ÿåº¦è¾ƒé•¿ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Žå–ç¥¨ç¨‹åºåˆæ­¥çœ‹synchronizedçš„ç‰¹æ€§]]></title>
    <url>%2F2019%2F02%2F10%2Fthread%2F%E4%BB%8E%E5%8D%96%E7%A5%A8%E7%A8%8B%E5%BA%8F%E5%88%9D%E6%AD%A5%E7%9C%8Bsynchronized%E7%9A%84%E7%89%B9%E6%80%A7%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ˜¯å…³äºŽJAVAå¤šçº¿ç¨‹å’Œå¹¶å‘çš„ç¬¬äº”ç¯‡ï¼Œåœ¨å¤šçº¿ç¨‹å­¦ä¹ å’Œç¼–ç¨‹ä¸­ï¼Œsynchronizedéƒ½æ˜¯æˆ‘ä»¬ç¬¬ä¸€ä¸ªè¦ç¢°è§çš„å…³é”®å­—ï¼Œå®ƒå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒè¢«è®¤ä¸ºè¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´ï¼Œå¹¶ä¸”å®ƒä»£è¡¨çš„æ˜¯äº’æ–¥é”çš„åŸºæœ¬æ€æƒ³ï¼ŒJDKæˆ–è€…å…¶ä»–åœ°æ–¹çš„æºç éšå¤„å¯è§ï¼Œæœ¬æ–‡ç”¨ä¸€ä¸ªå–ç¥¨ç¨‹åºæ¥åˆ‡å…¥synchronizedçš„å­¦ä¹ ï¼Œä»Žè¯­æ³•å’Œä½¿ç”¨ä¸Šè¿›è¡Œå…¨é¢äº†è§£ï¼Œå¹¶ä¸”å¯¹å…¶å¼•ç”³å‡ºæ¥çš„ä¸€äº›æ¦‚å¿µè¿›è¡Œè¯´æ˜Žã€‚ 1. çº¿ç¨‹å®‰å…¨é—®é¢˜äº§ç”ŸåŽŸå›  å­˜åœ¨å…±äº«æ•°æ® å­˜åœ¨å¤šæ¡çº¿ç¨‹å…±åŒæ“ä½œè¿™äº›å…±äº«æ•°æ® 2. çº¿ç¨‹å®‰å…¨é—®é¢˜è§£å†³æ–¹æ³• ä¸Šé¢çš„é—®é¢˜å½’æ ¹ç»“åº•æ˜¯ç”±äºŽä¸¤ä¸ªçº¿ç¨‹è®¿é—®ç›¸åŒçš„èµ„æºé€ æˆçš„ã€‚å¯¹äºŽå¹¶å‘ç¼–ç¨‹ï¼Œéœ€è¦é‡‡å–æŽªæ–½é˜²æ­¢ä¸¤ä¸ªçº¿ç¨‹æ¥è®¿é—®ç›¸åŒçš„èµ„æºã€‚ ä¸€ç§æŽªæ–½æ˜¯å½“èµ„æºè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ—¶ï¼Œä¸ºå…¶åŠ é”ã€‚ç¬¬ä¸€ä¸ªè®¿é—®èµ„æºçš„çº¿ç¨‹å¿…é¡»é”å®šè¯¥èµ„æºï¼Œæ˜¯å…¶ä»–ä»»åŠ¡åœ¨èµ„æºè¢«è§£é”å‰ä¸èƒ½è®¿é—®è¯¥èµ„æºã€‚ åŸºæœ¬ä¸Šæ‰€æœ‰çš„å¹¶å‘æ¨¡å¼åœ¨è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜æ—¶ï¼Œéƒ½é‡‡ç”¨â€œåºåˆ—åŒ–è®¿é—®ä¸´ç•Œèµ„æºâ€çš„æ–¹æ¡ˆã€‚å³åœ¨åŒä¸€æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ä¸´ç•Œèµ„æºï¼Œä¹Ÿç§°ä½œåŒæ­¥äº’æ–¥è®¿é—®ã€‚é€šå¸¸æ¥è¯´ï¼Œæ˜¯åœ¨è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç å‰é¢åŠ ä¸Šä¸€ä¸ªé”ï¼Œå½“è®¿é—®å®Œä¸´ç•Œèµ„æºåŽé‡Šæ”¾é”ï¼Œè®©å…¶ä»–çº¿ç¨‹ç»§ç»­è®¿é—®ã€‚ è¿™é‡Œæ¥å¥½å¥½è°ˆè°ˆSynchronizedå®žçŽ°åŠ é”çš„æ–¹å¼ã€‚ 3. synchronizedä¿®é¥°ç¬¦ synchronizedï¼šå¯ä»¥åœ¨ä»»æ„å¯¹è±¡åŠæ–¹æ³•ä¸ŠåŠ é”ï¼Œè€ŒåŠ é”çš„è¿™æ®µä»£ç ç§°ä¸ºâ€œäº’æ–¥åŒºâ€æˆ–â€œä¸´ç•ŒåŒºâ€. synchronizedæ»¡è¶³äº†ä»¥ä¸‹é‡è¦ç‰¹æ€§ï¼š äº’æ–¥æ€§ï¼šå³åœ¨åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰æŸä¸ªå¯¹è±¡é”ï¼Œé€šè¿‡è¿™ç§ç‰¹æ€§æ¥å®žçŽ°å¤šçº¿ç¨‹çš„åè°ƒæœºåˆ¶ï¼Œè¿™æ ·åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹éœ€è¦åŒæ­¥çš„ä»£ç å—è¿›è¡Œè®¿é—®ï¼Œäº’æ–¥æ€§ä¹Ÿç§°ä¸ºæ“ä½œçš„åŽŸå­æ€§ã€‚ å¯è§æ€§ï¼šå¿…é¡»ç¡®ä¿åœ¨é”è¢«é‡Šæ”¾ä¹‹å‰ï¼Œå¯¹å…±äº«å˜é‡æ‰€åšçš„ä¿®æ”¹ï¼Œå¯¹äºŽéšåŽèŽ·å¾—è¯¥é”çš„å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¯è§çš„ï¼Œå¦åˆ™å¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½æ˜¯åœ¨æœ¬åœ°ç¼“å­˜çš„æŸä¸ªå‰¯æœ¬ä¸Šç»§ç»­æ“ä½œï¼Œä»Žè€Œå¼•èµ·ä¸ä¸€è‡´ â­synchronizedé”çš„ä¸æ˜¯ä»£ç ï¼Œæ˜¯å¯¹è±¡ï¼ 3.1 ä¸ä½¿ç”¨synchronizedä¼šå‡ºçŽ°çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ 123456789101112131415161718public class SellTicket implements Runnable&#123; private int count = 5; @Override public void run() &#123; sellTicket(); &#125; private void sellTicket() &#123; if(count&gt;0)&#123; count--; System.out.println(Thread.currentThread().getName()+",è¿˜å‰©"+count); &#125;else &#123; System.out.println("ç¥¨å–å…‰äº†"); &#125; &#125; &#125; 1234567891011121314151617public class Main &#123; public static void main(String[] args) &#123; SellTicket sellTicket = new SellTicket(); //åŒæ—¶å¼€å¯äº”ä¸ªçº¿ç¨‹åŽ»å–ç¥¨ Thread t1 = new Thread(sellTicket, "thread1"); Thread t2 = new Thread(sellTicket, "thread2"); Thread t3 = new Thread(sellTicket, "thread3"); Thread t4 = new Thread(sellTicket, "thread4"); Thread t5 = new Thread(sellTicket, "thread5"); t1.start(); t2.start(); t3.start(); t4.start(); t5.start(); &#125;&#125; æŸä¸€æ¬¡è¿è¡Œçš„ç»“æžœæ˜¯: 12345thread2,è¿˜å‰©2thread1,è¿˜å‰©2thread3,è¿˜å‰©2thread4,è¿˜å‰©0thread5,è¿˜å‰©0 å¾ˆæ˜¾ç„¶ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´æ‰“æž¶äº†ï¼Œæ•°æ®æ··ä¹±äº†ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œrunï¼ˆï¼‰æ–¹æ³•ï¼Œå¯¹countè¿›è¡Œä¿®æ”¹ï¼Œè¿›è€Œé€ æˆé”™è¯¯ã€‚ 3.2 ä½¿ç”¨synchronizedæ¥åŠ é” å¯¹å–ç¥¨çš„æ ¸å¿ƒæ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizedï¼š 12345678private synchronized void sellTicket() &#123; if(count&gt;0)&#123; count--; System.out.println(Thread.currentThread().getName()+",è¿˜å‰©"+count); &#125;else &#123; System.out.println("ç¥¨å–å…‰äº†"); &#125;&#125; æˆ–è€…å†™æˆåŒæ­¥ä»£ç å—çš„å½¢å¼ï¼š 12345678910private void sellTicket() &#123; synchronized (this) &#123; if(count&gt;0)&#123; count--; System.out.println(Thread.currentThread().getName()+",è¿˜å‰©"+count); &#125;else &#123; System.out.println("ç¥¨å–å…‰äº†"); &#125; &#125;&#125; ç»“æžœåªæœ‰ä¸€ä¸ªï¼š 12345thread1 count:4thread4 count:3thread5 count:2thread3 count:1thread2 count:0 ç»“æžœæ˜¯æ­£ç¡®çš„ï¼Œå¯ä»¥çœ‹å‡ºä»£ç Aå’Œä»£ç Bçš„åŒºåˆ«å°±æ˜¯åœ¨sellTicket()æ–¹æ³•ä¸ŠåŠ ä¸Šäº†synchronizedä¿®é¥°ã€‚ è¯´æ˜Žï¼šå½“å¤šä¸ªçº¿ç¨‹è®¿é—®MyThread çš„runæ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æžœä½¿ç”¨äº†synchronizedä¿®é¥°ï¼Œé‚£ä¸ªå¤šçº¿ç¨‹å°±ä¼šä»¥æŽ’é˜Ÿçš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼ˆè¿™é‡ŒæŽ’é˜Ÿæ˜¯æŒ‰ç…§CPUåˆ†é…çš„å…ˆåŽé¡ºåºè€Œå®šçš„ï¼‰ï¼Œä¸€ä¸ªçº¿ç¨‹æƒ³è¦æ‰§è¡Œsynchronizedä¿®é¥°çš„æ–¹æ³•é‡Œçš„ä»£ç ï¼Œé¦–å…ˆæ˜¯å°è¯•èŽ·å¾—é”ï¼Œå¦‚æžœæ‹¿åˆ°é”ï¼Œæ‰§è¡Œsynchronizedä»£ç ä½“çš„å†…å®¹ï¼Œå¦‚æžœæ‹¿ä¸åˆ°é”çš„è¯ï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šä¸æ–­çš„å°è¯•èŽ·å¾—è¿™æŠŠé”ï¼Œç›´åˆ°æ‹¿åˆ°ä¸ºæ­¢ï¼Œè€Œä¸”å¤šä¸ªçº¿ç¨‹åŒæ—¶åŽ»ç«žäº‰è¿™æŠŠé”ï¼Œä¹Ÿå°±æ˜¯ä¼šå‡ºçŽ°é”ç«žäº‰çš„é—®é¢˜ã€‚ 3.3 ä¸€ä¸ªå¯¹è±¡æœ‰ä¸€æŠŠé”ï¼ä¸åŒå¯¹è±¡ä¸åŒé”ï¼ æ¯æ¬¡å¼€å¯ä¸€ä¸ªçº¿ç¨‹å°±newä¸€ä¸ªå¯¹è±¡çš„è¯ï¼Œå³å¯¹æ¯ä¸ªä¸åŒçš„å¯¹è±¡åŠ é”ï¼Œåˆ™äº’ä¸å¹²æ‰°ï¼š 123456789101112131415public class Main &#123; public static void main(String[] args) &#123; Thread t1 = new Thread(new SellTicket(), "thread1"); Thread t2 = new Thread(new SellTicket(), "thread2"); Thread t3 = new Thread(new SellTicket(), "thread3"); Thread t4 = new Thread(new SellTicket(), "thread4"); Thread t5 = new Thread(new SellTicket(), "thread5"); t1.start(); t2.start(); t3.start(); t4.start(); t5.start(); &#125;&#125; çº¿ç¨‹ä»»åŠ¡SellTicket()æ— è®ºç»™ä¸ç»™sellTicket()åŠ é”ï¼Œç»“æžœéƒ½æ˜¯ä¸€æ ·çš„ï¼š 12345thread1,è¿˜å‰©4thread2,è¿˜å‰©4thread3,è¿˜å‰©4thread5,è¿˜å‰©4thread4,è¿˜å‰©4 è¿™æ˜¯å› ä¸ºæˆ‘è¿™é‡Œæ˜¯äº”ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡å„è‡ªèŽ·å–è‡ªå·±çš„é”ï¼Œäº’ä¸å½±å“ï¼Œæ‰€ä»¥éƒ½æ˜¯4. å…³é”®å­—synchronizedå–å¾—çš„é”éƒ½æ˜¯å¯¹è±¡é”ï¼Œè€Œä¸æ˜¯æŠŠä¸€æ®µä»£ç æˆ–æ–¹æ³•å½“åšé”ï¼Œæ‰€ä»¥ä¸Šè¿°å®žä¾‹ä»£ç Cä¸­å“ªä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œsynchronized å…³é”®å­—çš„æ–¹æ³•ï¼Œé‚£ä¸ªçº¿ç¨‹å°±æŒæœ‰è¯¥æ–¹æ³•æ‰€å±žå¯¹è±¡çš„é”ï¼Œäº”ä¸ªå¯¹è±¡ï¼Œçº¿ç¨‹èŽ·å¾—çš„å°±æ˜¯ä¸¤ä¸ªä¸åŒå¯¹è±¡çš„ä¸åŒçš„é”ï¼Œä»–ä»¬äº’ä¸å½±å“çš„ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬åœ¨æ­£å¸¸çš„åœºæ™¯çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æœ‰ä¸€ç§æƒ…å†µçš„å°±æ˜¯ï¼Œä¸€ä¸ªç±»newå‡ºæ¥çš„æ‰€æœ‰å¯¹è±¡ä¼šå¯¹ä¸€ä¸ªå˜é‡countè¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆå¦‚ä½•å®žçŽ°å“ªï¼Ÿå¾ˆç®€å•å°±æ˜¯åŠ staticï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œç”¨staticä¿®æ”¹çš„æ–¹æ³•æˆ–è€…å˜é‡ï¼Œåœ¨è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡æ˜¯å…·æœ‰ç›¸åŒçš„å¼•ç”¨çš„ï¼Œè¿™æ ·çš„è¯ï¼Œæ— è®ºå®žä¾‹åŒ–å¤šå°‘å¯¹è±¡ï¼Œè°ƒç”¨çš„éƒ½æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚ Mainå‡½æ•°ä¸å˜ï¼š 123456789101112131415public class Main &#123; public static void main(String[] args) &#123; Thread t1 = new Thread(new SellTicket(), "thread1"); Thread t2 = new Thread(new SellTicket(), "thread2"); Thread t3 = new Thread(new SellTicket(), "thread3"); Thread t4 = new Thread(new SellTicket(), "thread4"); Thread t5 = new Thread(new SellTicket(), "thread5"); t1.start(); t2.start(); t3.start(); t4.start(); t5.start(); &#125;&#125; SellTicketåˆ™åœ¨å–ç¥¨æ–¹æ³•ä¸Šå¢žåŠ staticå…³é”®å­—ï¼š 1234567891011121314151617public class SellTicket implements Runnable&#123; private static int count = 5; @Override public void run() &#123; sellTicket(); &#125; private synchronized static void sellTicket() &#123; if(count&gt;0)&#123; count--; System.out.println(Thread.currentThread().getName()+",è¿˜å‰©"+count); &#125;else &#123; System.out.println("ç¥¨å–å…‰äº†"); &#125; &#125;&#125; æˆ–è€…æ˜¾ç¤ºåœ°é”ä½Classå¯¹è±¡ï¼Œå³é”ä½ç±»å¯¹è±¡ï¼š 12345678910private static void sellTicket() &#123; synchronized (SellTicket.class) &#123; if(count&gt;0)&#123; count--; System.out.println(Thread.currentThread().getName()+",è¿˜å‰©"+count); &#125;else &#123; System.out.println("ç¥¨å–å…‰äº†"); &#125; &#125;&#125; ç»“æžœä¸º: 12345thread1,è¿˜å‰©4thread2,è¿˜å‰©3thread4,è¿˜å‰©2thread3,è¿˜å‰©1thread5,è¿˜å‰©0 ä»”ç»†çœ‹ï¼Œæˆ‘ä»¬ç»™sellTicketè®¾å®šä¸ºstaticé™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±ä»Žä¹‹å‰çš„å¯¹è±¡æ–¹æ³•ä¸Šå‡åˆ°ç±»çº§åˆ«æ–¹æ³•ï¼Œè¿™ä¸ªç±»æ‰€æœ‰çš„å¯¹è±¡éƒ½è°ƒç”¨çš„åŒä¸€ä¸ªæ–¹æ³•ã€‚å®žçŽ°èµ„æºçš„å…±äº«å’ŒåŠ é”ã€‚ ä¸Šé¢è®²çš„æ—¶å¯¹è±¡é”å’Œç±»é”ï¼Œå‰è€…é”å®šçš„æ˜¯æŸä¸ªå®žä¾‹å¯¹è±¡ï¼ŒåŽè€…é”å®šçš„æ˜¯Classå¯¹è±¡ã€‚ä¸‹é¢æ€»ç»“ä¸€ä¸‹ï¼š æœ‰çº¿ç¨‹è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦å¤–çš„çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å¯¹è±¡çš„éžåŒæ­¥ä»£ç å— è‹¥é”ä½çš„æ—¶åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—(åŒæ­¥æ–¹æ³•)æ—¶ï¼Œå¦ä¸€ä¸ªè®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—(åŒæ­¥æ–¹æ³•)çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ž åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡çš„å¯¹è±¡é”äº’ä¸å¹²æ‰° ç±»é”ç”±äºŽä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡é”ï¼Œå› æ­¤è¡¨çŽ°ä¸Žä¸Šè¿°ä¸€è‡´ï¼Œåªæ˜¯ç”±äºŽä¸€ä¸ªç±»åªæœ‰ä¸€æŠŠç±»é”ï¼Œæ‰€ä»¥åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡ä½¿ç”¨ç±»é”æ˜¯åŒæ­¥çš„ ç±»é”å’Œå¯¹è±¡é”äº’ä¸å¹²æ‰° 4. Synchronizedé”é‡å…¥ 4.1 ä»€ä¹ˆæ˜¯å¯é‡å…¥é” é”çš„æ¦‚å¿µå°±ä¸ç”¨å¤šè§£é‡Šäº†,å½“æŸä¸ªçº¿ç¨‹Aå·²ç»æŒæœ‰äº†ä¸€ä¸ªé”,å½“çº¿ç¨‹Bå°è¯•è¿›å…¥è¢«è¿™ä¸ªé”ä¿æŠ¤çš„ä»£ç æ®µçš„æ—¶å€™.å°±ä¼šè¢«é˜»å¡ž. â­è€Œé”çš„æ“ä½œç²’åº¦æ˜¯&quot;çº¿ç¨‹â€,è€Œä¸æ˜¯è°ƒç”¨.åŒä¸€ä¸ªçº¿ç¨‹å†æ¬¡è¿›å…¥åŒæ­¥ä»£ç çš„æ—¶å€™.å¯ä»¥ä½¿ç”¨è‡ªå·±å·²ç»èŽ·å–åˆ°çš„é”,è¿™å°±æ˜¯å¯é‡å…¥é”ã€‚ 4.2 å¯é‡å…¥é”çš„å°ä¾‹å­ 1234567891011121314151617181920212223242526public class SyncDubbo &#123; public synchronized void method1()&#123; System.out.println("method1..."); method2(); &#125; public synchronized void method2()&#123; System.out.println("method2..."); method3(); &#125; public synchronized void method3()&#123; System.out.println("method3..."); &#125; public static void main(String[] args) &#123; SyncDubbo syncDubbo = new SyncDubbo(); new Thread(new Runnable() &#123; @Override public void run() &#123; syncDubbo.method1(); &#125; &#125;).start(); &#125;&#125; ç¤ºä¾‹ä»£ç å‘æˆ‘ä»¬æ¼”ç¤ºäº†ï¼Œå¦‚ä½•åœ¨ä¸€ä¸ªå·²ç»è¢«synchronizedå…³é”®å­—ä¿®é¥°è¿‡çš„æ–¹æ³•å†åŽ»è°ƒç”¨å¯¹è±¡ä¸­å…¶ä»–è¢«synchronizedä¿®é¥°çš„æ–¹æ³•ã€‚ 4.3 ä¸ºä»€ä¹ˆè¦å¯é‡å…¥ æˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†â€œä¸€ä¸ªå¯¹è±¡ä¸€æŠŠé”ï¼Œå¤šä¸ªå¯¹è±¡å¤šæŠŠé”â€ï¼Œå¯é‡å…¥é”çš„æ¦‚å¿µå°±æ˜¯ï¼šè‡ªå·±å¯ä»¥èŽ·å–è‡ªå·±çš„å†…éƒ¨é”ã€‚ å‡å¦‚æœ‰1ä¸ªçº¿ç¨‹TèŽ·å¾—äº†å¯¹è±¡Açš„é”ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹Tå¦‚æžœåœ¨æœªé‡Šæ”¾å‰å†æ¬¡è¯·æ±‚è¯¥å¯¹è±¡çš„é”æ—¶ï¼Œå¦‚æžœæ²¡æœ‰å¯é‡å…¥é”çš„æœºåˆ¶ï¼Œæ˜¯ä¸ä¼šèŽ·å–åˆ°é”çš„ï¼Œè¿™æ ·çš„è¯å°±ä¼šå‡ºçŽ°æ­»é”çš„æƒ…å†µã€‚ å°±å¦‚ä»£ç Aä½“çŽ°çš„é‚£æ ·ï¼Œçº¿ç¨‹Tåœ¨æ‰§è¡Œåˆ°method1ï¼ˆï¼‰å†…éƒ¨çš„æ—¶å€™ï¼Œç”±äºŽè¯¥çº¿ç¨‹å·²ç»èŽ·å–äº†è¯¥å¯¹è±¡syncDubbo çš„å¯¹è±¡é”ï¼Œå½“æ‰§è¡Œåˆ°è°ƒç”¨method2ï¼ˆï¼‰ çš„æ—¶å€™ï¼Œä¼šå†æ¬¡è¯·æ±‚è¯¥å¯¹è±¡çš„å¯¹è±¡é”ï¼Œå¦‚æžœæ²¡æœ‰å¯é‡å…¥é”æœºåˆ¶çš„è¯ï¼Œç”±äºŽè¯¥çº¿ç¨‹Tè¿˜æœªé‡Šæ”¾åœ¨åˆšè¿›å…¥method1ï¼ˆï¼‰ æ—¶èŽ·å–çš„å¯¹è±¡é”ï¼Œå½“æ‰§è¡Œåˆ°è°ƒç”¨method2ï¼ˆï¼‰ çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºçŽ°æ­»é”ã€‚ 4.4 å¯é‡å…¥é”åˆ°åº•æœ‰ä»€ä¹ˆç”¨å“ªï¼Ÿ æ­£å¦‚ä¸Šè¿°ä»£ç Aå’Œï¼ˆ4.3ï¼‰ä¸­è§£é‡Šé‚£æ ·ï¼Œæœ€å¤§çš„ä½œç”¨æ˜¯é¿å…æ­»é”ã€‚å‡å¦‚æœ‰ä¸€ä¸ªåœºæ™¯ï¼šç”¨æˆ·åå’Œå¯†ç ä¿å­˜åœ¨æœ¬åœ°txtæ–‡ä»¶ä¸­ï¼Œåˆ™ç™»å½•éªŒè¯æ–¹æ³•å’Œæ›´æ–°å¯†ç æ–¹æ³•éƒ½åº”è¯¥è¢«åŠ synchronizedï¼Œé‚£ä¹ˆå½“æ›´æ–°å¯†ç çš„æ—¶å€™éœ€è¦éªŒè¯å¯†ç çš„åˆæ³•æ€§ï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨éªŒè¯æ–¹æ³•ï¼Œæ­¤æ—¶æ˜¯å¯ä»¥è°ƒç”¨çš„ã€‚ 4.5 ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿ çº¿ç¨‹Aå½“å‰æŒæœ‰äº’æ–¥æ‰€é”lock1ï¼Œçº¿ç¨‹Bå½“å‰æŒæœ‰äº’æ–¥é”lock2ã€‚æŽ¥ä¸‹æ¥ï¼Œå½“çº¿ç¨‹Aä»ç„¶æŒæœ‰lock1æ—¶ï¼Œå®ƒè¯•å›¾èŽ·å–lock2ï¼Œå› ä¸ºçº¿ç¨‹Bæ­£æŒæœ‰lock2ï¼Œå› æ­¤çº¿ç¨‹Aä¼šé˜»å¡žç­‰å¾…çº¿ç¨‹Bå¯¹lock2çš„é‡Šæ”¾ã€‚å¦‚æžœæ­¤æ—¶çº¿ç¨‹Båœ¨æŒæœ‰lock2çš„æ—¶å€™ï¼Œä¹Ÿåœ¨è¯•å›¾èŽ·å–lock1ï¼Œå› ä¸ºçº¿ç¨‹Aæ­£æŒæœ‰lock1ï¼Œå› æ­¤çº¿ç¨‹Bä¼šé˜»å¡žç­‰å¾…Aå¯¹lock1çš„é‡Šæ”¾ã€‚äºŒè€…éƒ½åœ¨ç­‰å¾…å¯¹æ–¹æ‰€æŒæœ‰é”çš„é‡Šæ”¾ï¼Œè€ŒäºŒè€…å´åˆéƒ½æ²¡é‡Šæ”¾è‡ªå·±æ‰€æŒæœ‰çš„é”ï¼Œè¿™æ—¶äºŒè€…ä¾¿ä¼šä¸€ç›´é˜»å¡žä¸‹åŽ»ã€‚è¿™ç§æƒ…å½¢ç§°ä¸ºæ­»é”ã€‚ ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜Žï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public class DeadLock &#123; private static Object obj1 = new Object(); private static Object obj2 = new Object(); public static void a()&#123; synchronized (obj1) &#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (obj2) &#123; System.out.println("a"); &#125; &#125; &#125; public static void b()&#123; synchronized (obj2) &#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (obj1) &#123; System.out.println("b"); &#125; &#125; &#125; public static void main(String[] args) &#123; DeadLock d = new DeadLock(); new Thread(new Runnable() &#123; @Override public void run() &#123; d.a(); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; d.b(); &#125; &#125;).start(); &#125;&#125; äº§ç”Ÿæ­»é”çš„åŽŸå› ä¸»è¦æ˜¯ï¼š ï¼ˆ1ï¼‰ å› ä¸ºç³»ç»Ÿèµ„æºä¸è¶³ã€‚ ï¼ˆ2ï¼‰ è¿›ç¨‹è¿è¡ŒæŽ¨è¿›çš„é¡ºåºä¸åˆé€‚ã€‚ ï¼ˆ3ï¼‰ èµ„æºåˆ†é…ä¸å½“ç­‰ã€‚ å¦‚ä½•è§£å†³æ­»é”ï¼š å°½é‡ä¸€ä¸ªçº¿ç¨‹åªèŽ·å–ä¸€ä¸ªé”ã€‚ ä¸€ä¸ªçº¿ç¨‹åªå ç”¨ä¸€ä¸ªèµ„æºã€‚ å°è¯•ä½¿ç”¨å®šæ—¶é”ï¼Œè‡³å°‘èƒ½ä¿è¯é”æœ€ç»ˆä¼šè¢«é‡Šæ”¾ã€‚ 4.6 å¯é‡å…¥é”æ”¯æŒåœ¨çˆ¶å­ç±»ç»§æ‰¿çš„çŽ¯å¢ƒä¸­ 1234567891011121314public class Father &#123; public synchronized void doSomething()&#123; ...... &#125; &#125; public class Child extends Father &#123; public synchronized void doSomething()&#123; ...... super.doSomething(); &#125; &#125; æ‰§è¡Œå­ç±»çš„æ–¹æ³•çš„æ—¶å€™,å…ˆèŽ·å–äº†ä¸€æ¬¡Widgetçš„é”,ç„¶åŽåœ¨æ‰§è¡Œsuperçš„æ—¶å€™,å°±è¦èŽ·å–ä¸€æ¬¡,å¦‚æžœä¸å¯é‡å…¥,é‚£ä¹ˆå°±è·ªäº†. åœ¨è¿™é‡Œï¼Œå¯èƒ½ä¼šäº§ç”Ÿç–‘é—®ï¼š é‡å…¥â€ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å†æ¬¡èŽ·å¾—åŒä¸€ä¸ªå¯¹è±¡çš„é”ã€‚å¯æ˜¯ä½ ç»™å‡ºçš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ç†è§£çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨Childçš„doSomethingæ–¹æ³•å‰æˆ–å¾—äº†Childå¯¹è±¡çš„é”ï¼Œsuper.doSomethingæ–¹æ³•è°ƒç”¨æ—¶ï¼Œæ¬¡çº¿ç¨‹èŽ·å¾—äº†Childå¯¹è±¡çˆ¶å¯¹è±¡çš„é”ã€‚ä¸¤ä¸ªé”å±žäºŽä¸åŒçš„å¯¹è±¡ï¼Œè¿™è¿˜ç®—æ˜¯é‡å…¥å—ï¼Ÿ è§£é‡Šï¼šå½“Childå®žä¾‹å¯¹è±¡è°ƒç”¨doSomethingæ–¹æ³•æ—¶ï¼Œæ­¤æ—¶æŒæœ‰çš„æ˜¯Childå®žä¾‹å¯¹è±¡çš„é”ï¼Œä¹‹åŽè°ƒç”¨super.doSomething();ï¼Œè¿™æ—¶ä»ç„¶å¯¹äºŽChildå®žä¾‹å¯¹è±¡åŠ é”ï¼Œå› ä¸ºæ­¤æ—¶ä»ç„¶ä½¿ç”¨çš„æ˜¯Childå®žä¾‹å¯¹è±¡å†…å­˜ç©ºé—´çš„æ•°æ®ã€‚ è‡³äºŽè¿™å¥è¯çš„ç†è§£ï¼Œå°±ç‰µæ¶‰åˆ°ç»§æ‰¿çš„æœºåˆ¶ï¼š åœ¨ä¸€ä¸ªå­ç±»è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªçˆ¶ç±»å¯¹è±¡ï¼Œç„¶åŽåœ¨çˆ¶ç±»å¯¹è±¡å¤–éƒ¨æ”¾ä¸Šå­ç±»ç‹¬æœ‰çš„å±žæ€§ï¼Œä¸¤è€…åˆèµ·æ¥å½¢æˆä¸€ä¸ªå­ç±»çš„å¯¹è±¡ã€‚æ‰€ä»¥æ‰€è°“çš„ç»§æ‰¿ä½¿å­ç±»æ‹¥æœ‰çˆ¶ç±»æ‰€æœ‰çš„å±žæ€§å’Œæ–¹æ³•å…¶å®žå¯ä»¥è¿™æ ·ç†è§£ï¼Œå­ç±»å¯¹è±¡ç¡®å®žæ‹¥æœ‰çˆ¶ç±»å¯¹è±¡ä¸­æ‰€æœ‰çš„å±žæ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯çˆ¶ç±»å¯¹è±¡ä¸­çš„ç§æœ‰å±žæ€§å’Œæ–¹æ³•ï¼Œå­ç±»æ˜¯æ— æ³•è®¿é—®åˆ°çš„ï¼Œåªæ˜¯æ‹¥æœ‰ï¼Œä½†ä¸èƒ½ä½¿ç”¨ã€‚å°±åƒæœ‰äº›ä¸œè¥¿ä½ å¯èƒ½æ‹¥æœ‰ï¼Œä½†æ˜¯ä½ å¹¶ä¸èƒ½ä½¿ç”¨ã€‚æ‰€ä»¥å­ç±»å¯¹è±¡æ˜¯ç»å¯¹å¤§äºŽçˆ¶ç±»å¯¹è±¡çš„ï¼Œæ‰€è°“çš„å­ç±»å¯¹è±¡åªèƒ½ç»§æ‰¿çˆ¶ç±»éžç§æœ‰çš„å±žæ€§åŠæ–¹æ³•çš„è¯´æ³•æ˜¯é”™è¯¯çš„ã€‚å¯ä»¥ç»§æ‰¿ï¼Œåªæ˜¯æ— æ³•è®¿é—®åˆ°è€Œå·²ã€‚ ä¹‹æ‰€ä»¥ç½‘ä¸Šæœ‰å¾ˆå¤šè¯´åªç»§æ‰¿protectedæˆ–è€…privateçš„ï¼Œæ˜¯å› ä¸ºä»Žè¯­è¨€çš„è§’åº¦å‡ºå‘çš„ï¼š ä»Žå†…å­˜çš„è§’åº¦æ¥çœ‹ï¼Œçš„ç¡®æ˜¯ç»§æ‰¿äº†çš„ï¼Œå¯ä»¥å†™ä¸€ä¸ªç®€å•çš„ç»§æ‰¿ç±»ï¼Œdebugçœ‹å­ç±»çš„å±žæ€§æ˜¯å¦å­˜åœ¨çˆ¶ç±»çš„privateå±žæ€§ï¼Œäº‹å®žè¯æ˜Žæ˜¯æœ‰çš„ã€‚ é’ˆå¯¹è¿™é‡Œæœ‰äººè¯´ï¼šä¸æ˜¯åˆ›å»ºä¸€ä¸ªçˆ¶ç±»å¯¹è±¡ï¼Œè€Œåªæ˜¯åˆ›å»ºä¸€ä¸ªçˆ¶ç±»ç©ºé—´å¹¶è¿›è¡Œç›¸åº”çš„åˆå§‹åŒ–ã€‚å¯¹æ­¤ï¼Œæˆ‘ä¸€å¼€å§‹ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œä¸è¿‡å½“æˆ‘çœ‹åˆ°è¿™ä¸ªç­”æ¡ˆçš„æ—¶å€™ï¼Œåˆè§‰å¾—å¾ˆæœ‰é“ç†ï¼š ä¼šåˆ›å»ºçˆ¶ç±»å¯¹è±¡ã€‚ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ï¼ˆç¬¬å››ç‰ˆï¼‰129é¡µï¼Œå½“åˆ›å»ºä¸€ä¸ªå¯¼å‡ºç±»å¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†ä¸€ä¸ªåŸºç±»çš„å­å¯¹è±¡ï¼Œè¿™å­å¯¹è±¡ä¸Žä½ ç”¨åŸºç±»ç›´æŽ¥åˆ›å»ºçš„å¯¹è±¡æ˜¯ä¸€æ ·çš„ï¼ŒäºŒè€…åŒºåˆ«åœ¨äºŽåŽè€…æ¥æºäºŽå¤–éƒ¨ï¼Œè€ŒåŸºç±»çš„å­å¯¹è±¡è¢«åŒ…è£…åœ¨å¯¼å‡ºç±»å¯¹è±¡å†…éƒ¨ã€‚ 5. å‘ç”Ÿå¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é” 1234567891011121314151617181920212223public class SyncException &#123; private int i = 0; public synchronized void operation() &#123; while (true) &#123; i++; System.out.println(Thread.currentThread().getName() + " , i= " + i); if (i == 10) &#123; Integer.parseInt("a"); &#125; &#125; &#125; public static void main(String[] args) &#123; final SyncException se = new SyncException(); new Thread(new Runnable() &#123; public void run() &#123; se.operation(); &#125; &#125;, "t1").start(); &#125;&#125; æ‰§è¡Œç»“æžœå¦‚ä¸‹ï¼š 123456789101112t1 , i= 2t1 , i= 3t1 , i= 4t1 , i= 5t1 , i= 6t1 , i= 7t1 , i= 8t1 , i= 9t1 , i= 10java.lang.NumberFormatException: For input string: &quot;a&quot; at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) //å…¶ä»–è¾“å‡ºä¿¡æ¯ å…³äºŽsynchronizedçš„ä¼˜åŒ–æ”¾åˆ°åŽæ–‡åŽ»è®²ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹é‡è¦çš„ç›¸å…³æ–¹æ³•]]></title>
    <url>%2F2019%2F02%2F10%2Fthread%2F%E7%BA%BF%E7%A8%8B%E9%87%8D%E8%A6%81%E7%9A%84%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ˜¯å…³äºŽJAVAå¤šçº¿ç¨‹å’Œå¹¶å‘çš„ç¬¬å››ç¯‡ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦æ¥çœ‹çœ‹çº¿ç¨‹ç›¸å…³çš„å‡ ä¸ªé‡è¦æ–¹æ³•ã€‚ waitå’Œsleep ä»–ä»¬æœ€åŸºæœ¬çš„å·®å¼‚æ˜¯ï¼š waitæ˜¯Objectçš„ä¸€ä¸ªæ–¹æ³•ï¼Œsleepæ˜¯Threadç±»çš„æ–¹æ³• sleepå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œä½†æ˜¯waitæ–¹æ³•åªèƒ½åœ¨synchroniedæ–¹æ³•æˆ–synchroniedå—ä¸­ä½¿ç”¨ æœ¬è´¨çš„åŒºåˆ«æ˜¯ï¼š Thread.sleepåªä¼šè®©å‡ºCPuï¼Œä¸ä¼šå¯¼è‡´é”è¡Œä¸ºçš„æ”¹å˜ Object.waitä¸ä»…è®©å‡ºCPUï¼Œè¿˜ä¼šé‡Šæ”¾å·²ç»å ç”¨çš„åŒæ­¥èµ„æºé” è¿™ä¸ªåŒºåˆ«ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆwaitæ–¹æ³•åªèƒ½åœ¨synchroniedæ–¹æ³•æˆ–synchroniedå—ä¸­ä½¿ç”¨ï¼Œå› ä¸ºæ²¡æœ‰èŽ·å–è¿‡é”å“ªé‡Œæ¥çš„é‡Šæ”¾é”å‘¢ï¼Ÿæ‰€ä»¥é‡Šæ”¾é”çš„å‰ææ˜¯è¦èŽ·å–é”ã€‚ ä¸‹é¢æ¥éªŒè¯ä¸€ä¸‹ï¼Œçœ¼è§ä¸ºå®žï¼ å¯¹äºŽsleepæ¥è¯´æ˜¯æ²¡æœ‰é”çš„è¦æ±‚çš„ï¼Œæ—¢ä¸ç”¨èŽ·å–é”ä¹Ÿä¸ç”¨é‡Šæ”¾é”ï¼Œå…³äºŽè¿™ä¸€ç‚¹å°±ä¸å†éªŒè¯äº†ã€‚ notifyå’ŒnotifyAll å…ˆæ¥äº†è§£ä¸€ä¸‹é”æ± å’Œç­‰å¾…æ± çš„æ¦‚å¿µã€‚ é”æ± EntryLisy å‡è®¾çº¿ç¨‹Aå·²ç»æ‹¥æœ‰äº†æŸä¸ªå¯¹è±¡(ä¸æ˜¯ç±»)çš„é”ï¼Œè€Œå…¶ä»–çº¿ç¨‹Bã€Cæƒ³è¦è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æŸä¸ªsynchronizedæ–¹æ³•æˆ–å—ï¼Œç”±äºŽBã€Cçº¿ç¨‹åœ¨è¿›å…¥å¯¹è±¡çš„synchronizedæ–¹æ³•æˆ–å—ä¹‹å‰å¿…é¡»å…ˆèŽ·å¾—è¯¥å¯¹è±¡é”å¾—æ‹¥æœ‰æƒï¼Œè€Œæ°å·§è¯¥å¯¹è±¡çš„é”æ­£è¢«çº¿ç¨‹Aæ‰€å ç”¨ï¼Œæ­¤æ—¶Bã€Cçº¿ç¨‹å°±ä¼šè¢«é˜»å¡žï¼Œè¿›å…¥ä¸€ä¸ªåœ°æ–¹åŽ»ç­‰å¾…æ‰€å¾—é‡Šæ”¾ï¼Œè¿™ä¸ªåœ°æ–¹å°±æ˜¯è¯¥å¯¹è±¡å¾—é”æ± ã€‚ ç­‰å¾…æ± WaitSet å‡è®¾çº¿ç¨‹Aè°ƒç”¨äº†æŸä¸ªå¯¹è±¡çš„waitæ–¹æ³•åŽï¼Œçº¿ç¨‹Aå°±ä¼šé‡Šæ”¾è¯¥å¯¹è±¡å¾—é”ï¼ŒåŒæ—¶çº¿ç¨‹Aå¥è¿›å…¥åˆ°è¯¥å¯¹è±¡å¾—ç­‰å¾…æ± ä¸­ï¼Œè¿›å…¥åˆ°ç­‰å¾…æ± ä¸­å¾—çº¿ç¨‹ä¸ä¼šåŽ»ç«žäº‰è¯¥å¯¹è±¡çš„é”ã€‚ notifyçš„ä½œç”¨å°±æ˜¯éšæœºå”¤é†’ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ç­‰å¾…æ± çš„çº¿ç¨‹ï¼Œè€ŒnotifyAllæ˜¯å”¤é†’æ‰€æœ‰å¤„äºŽç­‰å¾…æ± ä¸­çº¿ç¨‹ï¼Œå”¤é†’ä¹‹åŽå°±å¯ä»¥å†åŽ»ç«žäº‰èŽ·å¾—é”çš„æœºä¼šäº†ã€‚ åˆšæ‰çš„ä¾‹å­ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼Œæ¥äº†è§£ä¸€ä¸‹notifyçš„ä½œç”¨ã€‚è¿˜æ‹¿åˆšæ‰é‚£ä¸ªä¾‹å­ï¼š yield å½“è°ƒç”¨Thread.yield()å‡½æ•°æ—¶ï¼Œä¼šç»™çº¿ç¨‹è°ƒåº¦å™¨ä¸€ä¸ªå½“å‰çº¿ç¨‹æ„¿æ„è®©å‡ºCPUä½¿ç”¨çš„æš—ç¤ºï¼Œä½†æ˜¯çº¿ç¨‹è°ƒåº¦å™¨å¯èƒ½ä¼šå¿½ç•¥è¿™ä¸ªæš—ç¤ºã€‚å¹¶ä¸”å®ƒä¹Ÿä¸ä¼šé‡Šæ”¾å½“å‰çº¿ç¨‹å ç”¨çš„é”ã€‚ yield()ä¸Žæ— å‚çš„wait()çš„åŒºåˆ«ï¼š æ‰§è¡Œyield()åŽï¼Œå½“å‰çº¿ç¨‹ç”±è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ã€‚æ‰§è¡ŒwaitåŽï¼Œå½“å‰çº¿ç¨‹ä¼šå¤±åŽ»å¯¹è±¡çš„é”ï¼ŒçŠ¶æ€å˜ä¸ºWAITINGçŠ¶æ€ã€‚ æ‰§è¡Œyield()åŽï¼Œå½“å‰çº¿ç¨‹ä¸ä¼šé‡Šæ”¾é”ã€‚æ‰§è¡ŒwaitåŽï¼Œå½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾é”ã€‚ æ¯”è¾ƒç®€å•ï¼Œå°±ä¸ä¸¾ä¾‹äº†ã€‚ interrupt å®ƒåªæ˜¯é€šçŸ¥çº¿ç¨‹åº”è¯¥ä¸­æ–­äº†ã€‚ å¦‚æžœçº¿ç¨‹å¤„äºŽè¢«é˜»å¡žçŠ¶æ€ï¼Œé‚£ä¹ˆçº¿ç¨‹å°†ç«‹å³é€€å‡ºè¢«é˜»å¡žçŠ¶æ€ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªinterruptedExceptionå¼‚å¸¸ å¦‚æžœçº¿ç¨‹å¤„äºŽæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸ºtrueã€‚è¢«è®¾ç½®ä¸­æ–­æ ‡å¿—çš„çº¿ç¨‹å°†ç»§ç»­æ­£å¸¸è¿è¡Œï¼Œä¸å—å½±å“ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸­æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯ç”±è¢«è°ƒç”¨çš„çº¿ç¨‹çŠ¶æ€å’Œè‡ªå·±ç¨‹åºåˆ¤æ–­å†³å®šçš„ã€‚ é˜»å¡žçŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹ä¼šç«‹å³é€€å‡ºï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ æ­£å¸¸çŠ¶æ€ä¸‹ï¼Œéœ€è¦è¢«è°ƒç”¨çš„çº¿ç¨‹æ£€æŸ¥ä¸­æ–­æ ‡å¿—ä½ï¼Œç„¶åŽå†æ ¹æ®ä¸­æ–­æ ‡å¿—ä½è‡ªè¡Œåœ°åœæ­¢çº¿ç¨‹ ä¸‹é¢å†™ä¸€ä¸ªdemoæ¥éªŒè¯ä¸€ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637public class InterruptDemo &#123; public static void main(String[] args) throws InterruptedException &#123; Runnable interruptTask = new Runnable() &#123; @Override public void run() &#123; int i = 0; try &#123; //åœ¨æ­£å¸¸è¿è¡Œä»»åŠ¡æ—¶ï¼Œç»å¸¸æ£€æŸ¥æœ¬çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œå¦‚æžœè¢«è®¾ç½®äº†ä¸­æ–­æ ‡å¿—å°±è‡ªè¡Œåœæ­¢çº¿ç¨‹ while (!Thread.currentThread().isInterrupted()) &#123; Thread.sleep(100); // ä¼‘çœ 100ms i++; System.out.println(Thread.currentThread().getName() + " (" + Thread.currentThread().getState() + ") loop " + i); &#125; &#125; catch (InterruptedException e) &#123; //åœ¨è°ƒç”¨é˜»å¡žæ–¹æ³•æ—¶æ­£ç¡®å¤„ç†InterruptedExceptionå¼‚å¸¸ã€‚ï¼ˆä¾‹å¦‚ï¼Œcatchå¼‚å¸¸åŽå°±ç»“æŸçº¿ç¨‹ã€‚ï¼‰ System.out.println(Thread.currentThread().getName() + " (" + Thread.currentThread().getState() + ") catch InterruptedException."); &#125; &#125; &#125;; Thread t1 = new Thread(interruptTask, "t1"); System.out.println(t1.getName() +" ("+t1.getState()+") is new."); // 1.å¯åŠ¨â€œçº¿ç¨‹t1â€ t1.start(); System.out.println(t1.getName() +" ("+t1.getState()+") is started."); // 2.ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åŽä¸»çº¿ç¨‹ç»™t1å‘â€œä¸­æ–­â€æŒ‡ä»¤ã€‚ Thread.sleep(400); t1.interrupt(); System.out.println(t1.getName() +" ("+t1.getState()+") is interrupted."); // 3.ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åŽæŸ¥çœ‹t1çš„çŠ¶æ€ã€‚ Thread.sleep(300); System.out.println(t1.getName() +" ("+t1.getState()+") is interrupted now."); &#125;&#125; æ‰“å°ç»“æžœä¸ºï¼š 12345678t1 (NEW) is new.t1 (RUNNABLE) is started.t1 (RUNNABLE) loop 1t1 (RUNNABLE) loop 2t1 (RUNNABLE) loop 3t1 (TIMED_WAITING) is interrupted.t1 (RUNNABLE) catch InterruptedException.t1 (TERMINATED) is interrupted now. é¦–å…ˆï¼Œæ˜¯å°±ç»ªçŠ¶æ€ï¼Œä¸ºnewï¼›æŽ¥ä¸‹æ¥å¯åŠ¨è¿™ä¸ªçº¿ç¨‹ï¼ŒçŠ¶æ€å˜ä¸ºstartedï¼Œç”±äºŽæ­¤æ—¶ä¸€åˆ‡å®‰å¥½ï¼Œæ²¡æœ‰â€œæ‰“æ‰°â€è¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œï¼Œæ‰€ä»¥æ¯éš”100æ¯«ç§’æ‰“å°ä¸€å¥(RUNNABLE) loop iå‡ºæ¥ï¼›åœ¨400æ¯«ç§’çš„å®‰å¥½ä¹‹åŽï¼Œç»™ä»–ä¸€ä¸ªt1.interrupt();ï¼Œæ­¤æ—¶çº¿ç¨‹å¯èƒ½æ°å¥½åœ¨æ‰§è¡Œsleepç¡è§‰å‘¢ï¼Œè¿™ä¸ªinterruptä¸€çœ‹ä½ åœ¨é˜»å¡ž(ç¡è§‰)ï¼Œé‚£è¿˜å¾—äº†ï¼Œç«‹é©¬åœæ­¢è¿™ä¸ªçº¿ç¨‹å¹¶ä¸”æŠ›å‡ºå¼‚å¸¸ã€‚ ä½†æ˜¯è¯è¯´å›žå¤´ï¼Œæœ¬ç¨‹åºè¿˜ç”¨äº†ifåˆ¤æ–­ï¼Œåªè¦æ ‡å¿—ä½ä¸ºfalseå°±ä¸åœå¾ªçŽ¯ï¼Œä¸€æ—¦æ ‡å¿—ä½å˜ä¸ºtrueåˆ™ç«‹é©¬é€€å‡ºå¾ªçŽ¯ã€‚æ‰€ä»¥å³ä½¿ä½ ä¸ç¡è§‰ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯èƒ½é€šè¿‡è¿™ä¸ªIfæ¥ç»ˆæ­¢ä½ çš„å¾ªçŽ¯ã€‚ join joinæ˜¯åŠ å…¥çš„æ„æ€ï¼Œéžå¸¸å½¢è±¡ç”ŸåŠ¨ã€‚ 12345678/** * Waits for this thread to die. * è°ƒç”¨æ–¹çº¿ç¨‹ï¼ˆè°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹ï¼‰æ‰§è¡Œç­‰å¾…æ“ä½œï¼Œ * ç›´åˆ°è¢«è°ƒç”¨çš„çº¿ç¨‹ï¼ˆjoinæ–¹æ³•æ‰€å±žçš„çº¿ç¨‹ï¼‰ç»“æŸï¼Œå†è¢«å”¤é†’ */public final void join() throws InterruptedException &#123; join(0);&#125; å…·ä½“çš„å®žçŽ°å¦‚ä¸‹ï¼š æˆ‘ä»¬çŸ¥é“waitæ˜¯éœ€è¦é‡Šæ”¾å½“å‰çº¿ç¨‹æ‰€å çš„å¯¹è±¡é”çš„ï¼Œè€ŒjoinåŸºäºŽwaitå®žçŽ°ï¼Œæ˜¾ç„¶æ˜¯å¯ä»¥çš„ã€‚ è¿™é‡Œåˆ¤æ–­å¦‚æžœçº¿ç¨‹è¿˜åœ¨è¿è¡Œä¸­çš„è¯ï¼Œåˆ™ç»§ç»­ç­‰å¾…ï¼Œå¦‚æžœæŒ‡å®šæ—¶é—´åˆ°äº†ï¼Œæˆ–è€…çº¿ç¨‹è¿è¡Œå®Œæˆäº†ï¼Œåˆ™ä»£ç ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œè°ƒç”¨çº¿ç¨‹å°±å¯ä»¥æ‰§è¡ŒåŽé¢çš„é€»è¾‘äº†ã€‚ ä½†æ˜¯åœ¨è¿™é‡Œæ²¡æœ‰çœ‹åˆ°å“ªé‡Œè°ƒç”¨notifyæˆ–è€…notifyAllæ–¹æ³•ï¼Œå¦‚æžœæ²¡æœ‰è°ƒç”¨çš„è¯ï¼Œé‚£è°ƒç”¨æ–¹çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹åŽ»ï¼Œé‚£æ˜¯å“ªé‡Œè°ƒç”¨äº†å”¤é†’å®ƒçš„æ–¹æ³•å‘¢ï¼Ÿé€šè¿‡æŸ¥è¯å¾—çŸ¥ï¼ŒåŽŸæ¥åœ¨çº¿ç¨‹ç»“æŸæ—¶ï¼Œjavaè™šæ‹Ÿæœºä¼šæ‰§è¡Œè¯¥çº¿ç¨‹çš„æœ¬åœ°exitæ–¹æ³•ï¼Œè¿™ä¸ªexitæ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨notifyAllæ–¹æ³•ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚ ä¸‹é¢æ¥ä¸¤ä¸ªä¾‹å­æ¥å½»åº•ç†è§£å®ƒçš„ç”¨æ³•ã€‚ ä¾‹å­ä¸€ï¼šæœ‰è€å¿ƒçš„ç”·å­©ï¼š ç”·å­©å’Œå¥³å­©å‡†å¤‡å‡ºåŽ»é€›è¡— å¥³å­©å¼€å§‹åŒ–å¦†,ç”·å­©åœ¨ç­‰å¾…ã€‚ã€‚ã€‚ å¥³å­©åŒ–å¦†å®Œæˆï¼ï¼Œè€—æ—¶5000 ç”·å­©å’Œå¥³å­©å¼€å§‹åŽ»é€›è¡—äº† å°±æ˜¯ç”·å­©å’Œå¥³å­©å‡†å¤‡åŽ»é€›è¡—ï¼Œå¥³å­©è¦åŒ–å¦†å…ˆï¼Œç­‰å¥³å­©åŒ–å¦†å®Œæˆäº†ï¼Œå†ä¸€èµ·åŽ»é€›è¡—ã€‚ ä¾‹å­äºŒï¼šæ²¡æœ‰è€å¿ƒçš„ç”·å­©ï¼š ç”·å­©å’Œå¥³å­©å‡†å¤‡å‡ºåŽ»é€›è¡— å¥³å­©å¼€å§‹åŒ–å¦†,ç”·å­©åœ¨ç­‰å¾…ã€‚ã€‚ã€‚ ç”·å­©ç­‰äº†2000, ä¸æƒ³å†ç­‰äº†ï¼ŒåŽ»é€›è¡—äº† å¥³å­©åŒ–å¦†å®Œæˆï¼ï¼Œè€—æ—¶5000 ç”·å­©ç­‰äº†join(time)ä¸­çš„timeæ—¶é—´ï¼Œå¦‚æžœè¿™ä¸ªtimeæ—¶é—´åˆ°è¾¾ä¹‹åŽï¼Œå¥³å­©æ‰€åœ¨çš„çº¿ç¨‹è¿˜æ²¡æ‰§è¡Œå®Œï¼Œåˆ™ä¸ç­‰å¾…äº†ï¼Œç»§ç»­æ‰§è¡ŒåŽé¢çš„é€»è¾‘ï¼Œå°±æ˜¯ä¸ç­‰å¥³å­©äº†ï¼Œè‡ªå·±åŽ»é€›è¡—ã€‚ æ€»ç»“ äº†è§£äº†è¿™äº›æ ¸å¿ƒæ–¹æ³•ä¹‹åŽï¼Œå°±å¯ä»¥å¯¹ä¸‹é¢è¿™å¹…å›¾ç®€å•è¯´ä¸€è¯´å•¦ï¼š é¦–å…ˆæ˜¯new Thread()åªæ˜¯æ–°å»ºçŠ¶æ€ï¼Œåªæœ‰startä¹‹åŽæ‰ä¼šè¿›å…¥runnableçŠ¶æ€ï¼Œæ³¨æ„è¿™ä¸ªçŠ¶æ€é‡Œé¢å¯èƒ½æœ‰ä¸¤ç§çŠ¶æ€ï¼Œä¸€ç§æ˜¯æ­£åœ¨è¿è¡Œï¼Œå³runningï¼Œè¿˜æœ‰ä¸€ç§æ˜¯å°±ç»ªçŠ¶æ€å³readyï¼Œè¿™ä¸¤ä¸ªçŠ¶æ€å½’å±žäºŽä¸€ç±»çš„åŽŸå› æ˜¯ä»–ä»¬ä¹‹é—´æ˜¯åœ¨ä¸æ–­åˆ‡æ¢çš„ï¼Œå³CPUçš„æ—¶é—´ç‰‡å†…ä¸´å¹¸åˆ°è¿™ä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹ä¸­æœ‰è‹¥å¹²ä¸ªçº¿ç¨‹çš„è¯ï¼Œå°±ä¼šé«˜é€Ÿåœ°åˆ‡æ¢å„ä¸ªçº¿ç¨‹é€ä¸ªæ‰§è¡Œï¼Œè¾¾åˆ°å®è§‚ä¸Šæ˜¯å¹¶è¡Œæ‰§è¡Œçš„æ•ˆæžœã€‚æˆ‘ä»¬çŸ¥é“yieldæ˜¯ç»™çº¿ç¨‹è°ƒåº¦å™¨ä¸€ä¸ªæš—ç¤ºè®©å‡ºå½“å‰æ‰§è¡Œçš„çº¿ç¨‹çš„æ—¶é—´ç‰‡ï¼Œè‡³äºŽè¿™ä¸ªçº¿ç¨‹è°ƒåº¦å™¨å¬ä¸å¬é‚£å°±ä¸çŸ¥é“äº†ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å®šçš„éšæœºæ€§ã€‚å¦‚æžœæ­£å¸¸æ‰§è¡Œç»“æŸå°±è¿›å…¥æœ€åŽçš„ç»ˆæ­¢çŠ¶æ€ã€‚å¾€å³è¾¹çœ‹ï¼Œå¦‚æžœå‘ç”Ÿå¸¦æ—¶é—´çš„è¶…æ—¶ç­‰å¾…ï¼Œå¦‚sleep(100)ï¼Œæœ¬çº¿ç¨‹ä¼šé˜»å¡žï¼Œè®©å‡ºCPUæ‰§è¡Œæƒå¹¶ä¸”ä¸æ”¹å˜é”çŠ¶æ€ï¼Œä¸Žä¹‹åŒºåˆ«çš„æ˜¯wait(100)è¿™ä¸ªæ–¹æ³•ä¸ä»…è®©å‡ºCPUæ‰§è¡Œæƒï¼Œè¿˜ä¼šé‡Šæ”¾é”ï¼Œæ‰€ä»¥è¦è°ƒç”¨waitæ–¹æ³•å¿…ç„¶è¦å…ˆèŽ·å–é”ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯åœ¨synchronizedä¸­è°ƒç”¨å®ƒã€‚è‡³äºŽjoin(100)æ˜¯æŒ‡é˜»å¡žå½“å‰çº¿ç¨‹ï¼Œè®©å…¶ä»–çš„çº¿ç¨‹å…ˆæ‰§è¡Œï¼Œåº•å±‚æ˜¯waitæ‰€ä»¥ä¹Ÿä¼šé‡Šæ”¾é”ã€‚è¶…æ—¶ç­‰å¾…åªè¦ç­‰å®ƒæ—¶é—´è¿‡äº†å°±å¯ä»¥è·³å‡ºé˜»å¡žçŠ¶æ€äº†ï¼Œæˆ–è€…ç”¨notifyæˆ–è€…interruptä¹‹ç±»çš„æ¥å”¤é†’æˆ–è€…æ‰“æ–­å®ƒã€‚å¾€å·¦ä¸‹è§’çœ‹ï¼Œæ˜¯é”èŽ·å–çš„æ—¶å€™å¯èƒ½å‘ç”Ÿé˜»å¡žï¼Œè¿™ä¸ªæ—¶å€™åªèƒ½ç­‰å…¶ä»–çº¿ç¨‹é‡Šæ”¾é”æ‰è¡Œäº†ã€‚å¾€å·¦è¾¹çœ‹ï¼Œæ˜¯æ— é™æœŸç­‰å¾…çš„ä»£è¡¨ï¼Œå”¤é†’æ‰‹æ®µä¸Žæœ‰é™æœŸç­‰å¾…æ˜¯ä¸€æ ·çš„ã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹çš„çŠ¶æ€]]></title>
    <url>%2F2019%2F02%2F10%2Fthread%2F%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ˜¯å…³äºŽJAVAå¤šçº¿ç¨‹å’Œå¹¶å‘çš„ç¬¬ä¸‰ç¯‡ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸‹çº¿ç¨‹çš„å‡ ä¸ªçŠ¶æ€çš„å«ä¹‰ã€‚ Threadç±»æºç ä¸­è§„å®šäº†å‡ ç§çº¿ç¨‹çš„çŠ¶æ€ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364public enum State &#123; /** * Thread state for a thread which has not yet started. */ NEW, /** * Thread state for a runnable thread. A thread in the runnable * state is executing in the Java virtual machine but it may * be waiting for other resources from the operating system * such as processor. */ RUNNABLE, /** * Thread state for a thread blocked waiting for a monitor lock. * A thread in the blocked state is waiting for a monitor lock * to enter a synchronized block/method or * reenter a synchronized block/method after calling * &#123;@link Object#wait() Object.wait&#125;. */ BLOCKED, /** * Thread state for a waiting thread. * A thread is in the waiting state due to calling one of the * following methods: * &lt;ul&gt; * &lt;li&gt;&#123;@link Object#wait() Object.wait&#125; with no timeout&lt;/li&gt; * &lt;li&gt;&#123;@link #join() Thread.join&#125; with no timeout&lt;/li&gt; * &lt;li&gt;&#123;@link LockSupport#park() LockSupport.park&#125;&lt;/li&gt; * &lt;/ul&gt; * * &lt;p&gt;A thread in the waiting state is waiting for another thread to * perform a particular action. * * For example, a thread that has called &lt;tt&gt;Object.wait()&lt;/tt&gt; * on an object is waiting for another thread to call * &lt;tt&gt;Object.notify()&lt;/tt&gt; or &lt;tt&gt;Object.notifyAll()&lt;/tt&gt; on * that object. A thread that has called &lt;tt&gt;Thread.join()&lt;/tt&gt; * is waiting for a specified thread to terminate. */ WAITING, /** * Thread state for a waiting thread with a specified waiting time. * A thread is in the timed waiting state due to calling one of * the following methods with a specified positive waiting time: * &lt;ul&gt; * &lt;li&gt;&#123;@link #sleep Thread.sleep&#125;&lt;/li&gt; * &lt;li&gt;&#123;@link Object#wait(long) Object.wait&#125; with timeout&lt;/li&gt; * &lt;li&gt;&#123;@link #join(long) Thread.join&#125; with timeout&lt;/li&gt; * &lt;li&gt;&#123;@link LockSupport#parkNanos LockSupport.parkNanos&#125;&lt;/li&gt; * &lt;li&gt;&#123;@link LockSupport#parkUntil LockSupport.parkUntil&#125;&lt;/li&gt; * &lt;/ul&gt; */ TIMED_WAITING, /** * Thread state for a terminated thread. * The thread has completed execution. */ TERMINATED;&#125; å…¶å®žæºç ä¸­å·²ç»è¯¦ç»†è¯´æ˜Žäº†è¿™å‡ ç§çŠ¶æ€çš„å«ä¹‰ä»¥åŠå‘ç”Ÿçš„æ—¶æœºã€‚ä¸‹é¢è¿˜æ˜¯å†çœ‹çœ‹ï¼š æ–°å»º(new)ï¼šåˆ›å»ºåŽå°šæœªå¯åŠ¨çš„çº¿ç¨‹çš„çŠ¶æ€ è¿è¡Œ(Runnable)ï¼šåŒ…å«Runningå’ŒReadyä¸¤ç§çŠ¶æ€ æ— é™æœŸç­‰å¾…(Waiting)ï¼šä¸ä¼šè¢«åˆ†é…CPUæ‰§è¡Œæ—¶é—´ï¼Œéœ€è¦æ˜¾å¼è¢«å”¤é†’ æ— Timeoutå‚æ•°çš„Object.wait()æ–¹æ³• æ— Timeoutå‚æ•°çš„Thread.join()æ–¹æ³• LockSupport.park()æ–¹æ³• é™æœŸç­‰å¾…(Timed Waiting)ï¼šä¸ä¼šè¢«åˆ†é…CPUæ‰§è¡Œæ—¶é—´ï¼Œåœ¨ä¸€å®šæ—¶é—´åŽä¼šç”±ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ Thread.sleep()æ–¹æ³• è®¾ç½®äº†Timeoutå‚æ•°çš„Object.wait()æ–¹æ³• è®¾ç½®äº†Timeoutå‚æ•°çš„Thread.join()æ–¹æ³• LockSupport.parkNanos()æ–¹æ³• LockSupport.parkUntil()æ–¹æ³• é˜»å¡ž(Blocked)ï¼šç­‰å¾…èŽ·å–æŽ’ä»–é” ç»“æŸ(Terminated)ï¼šå·²ç»ˆæ­¢çº¿ç¨‹çš„çŠ¶æ€ï¼Œçº¿ç¨‹å·²ç»ç»“æŸæ‰§è¡Œ æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šçº¿ç¨‹çŠ¶æ€ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šå­˜åœ¨çŠ¶æ€çš„è½¬æ¢ï¼Œä»–ä»¬çš„çŠ¶æ€æ˜¯å¦‚ä½•è½¬æ¢çš„å‘¢ï¼Ÿä¸‹é¢è¿™å¼ å›¾å°±æ˜¯æ¯”è¾ƒå…¨é¢çš„çŠ¶æ€è½¬æ¢å›¾ï¼š åˆå­¦è€…çœ‹åˆ°è¿™å¼ å›¾ä¸€å¼ æ˜¯æ¯”è¾ƒæ™•çš„ï¼Œå„ç§ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿å †åœ¨è¿™é‡Œå®žåœ¨æ˜¯éš¾ä»¥ä¸‹å’½ï¼Œä¸è¿‡ä¸€å¼€å§‹ä¸èƒ½å®Œå…¨çœ‹æ‡‚æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œéœ€è¦è¿›ä¸€æ­¥åœ°å­¦ä¹ ä¸€äº›ç»†èŠ‚ï¼Œä¸æ–­åœ°æ¥å›žé¡¾ï¼Œæ€»æœ‰ä¸€å¤©å°±ä¼šçœŸæ­£ç†è§£äº†ã€‚ ä¸‹é¢å°±æ˜¯è¦è¯¦ç»†è¯´è¯´Threadç±»é‡Œé¢çš„ä¸€äº›æ–¹æ³•å•¦ï¼Œç†è§£äº†è¿™äº›æ–¹æ³•ï¼ŒçŠ¶æ€çš„åˆ‡æ¢å›¾ä¾¿ä¸€ç›®äº†ç„¶ã€‚ä¸ºäº†é™åˆ¶ç¯‡å¹…ï¼Œæœ¬æ–‡å…ˆè¯´åˆ°è¿™é‡Œã€‚]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå¤šçº¿ç¨‹ä¹‹ä¼ å‚å’Œè¿”å›žå€¼å¤„ç†]]></title>
    <url>%2F2019%2F02%2F10%2Fthread%2Fjava%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8B%E4%BC%A0%E5%8F%82%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E5%A4%84%E7%90%86%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ˜¯å…³äºŽJAVAå¤šçº¿ç¨‹å’Œå¹¶å‘çš„ç¬¬äºŒç¯‡ï¼Œå¯¹äºŽä¼ å‚å’Œè¿”å›žå€¼çš„é—®é¢˜ï¼Œæ˜¯é¢è¯•ä¸­å…³äºŽå¤šçº¿ç¨‹è¿™ä¸€å—é—®å¾—æ¯”è¾ƒå¤šçš„é—®é¢˜äº†ï¼Œè¿™é‡Œè¿›è¡Œè¯¦ç»†çš„è¯´æ˜Žã€‚ ä¸€ã€å¦‚ä½•ç»™run()æ–¹æ³•ä¼ å‚ æˆ‘ä»¬çŸ¥é“å¤šçº¿ç¨‹æ˜¯é€šè¿‡star()æ–¹æ³•è®©çº¿ç¨‹å¤„äºŽå‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œè€Œå®žé™…è¿è¡Œçš„ä¸šåŠ¡é€»è¾‘æ˜¯æ”¾åœ¨run()æ–¹æ³•ä½“ä¸­çš„ï¼Œä½†æ˜¯run()æ–¹æ³•æ˜¯æ²¡æœ‰å‚æ•°çš„æ–¹æ³•ï¼Œå®žé™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å‘æ–¹æ³•ä½“ä¸­ä¼ é€’å‚æ•°ï¼Œå®žçŽ°çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼š æž„é€ å‡½æ•°ä¼ å‚ï¼Œè¿™ä¸ªåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­å·²ç»æ¼”ç¤ºäº†ã€‚ æˆå‘˜å˜é‡ä¼ å‚ï¼Œè¿™ä¸ªå°±æ˜¯ä¾é setæ–¹æ³•ã€‚ å›žè°ƒå‡½æ•°ä¼ å‚ï¼Œè¿™ä¸ªç¨å¾®ç‰¹æ®Šä¸€ç‚¹ã€‚è¿™é‡Œè¯´æ˜Žä¸€ä¸‹ã€‚ ä¸Šé¢çš„ä¸¤ç§å‘çº¿ç¨‹ä¸­ä¼ é€’æ•°æ®çš„æ–¹æ³•æ˜¯æœ€å¸¸ç”¨çš„ã€‚ä½†è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯mainæ–¹æ³•ä¸­ä¸»åŠ¨å°†æ•°æ®ä¼ å…¥çº¿ç¨‹ç±»çš„ã€‚è¿™å¯¹äºŽçº¿ç¨‹æ¥è¯´ï¼Œæ˜¯è¢«åŠ¨æŽ¥æ”¶è¿™äº›æ•°æ®çš„ã€‚ ç„¶è€Œï¼Œåœ¨æœ‰äº›åº”ç”¨ä¸­éœ€è¦åœ¨çº¿ç¨‹è¿è¡Œçš„è¿‡ç¨‹ä¸­åŠ¨æ€åœ°èŽ·å–æ•°æ®ï¼Œå¦‚åœ¨ä¸‹é¢ä»£ç çš„runæ–¹æ³•ä¸­äº§ç”Ÿäº†3ä¸ªéšæœºæ•°ï¼Œç„¶åŽé€šè¿‡Workç±»çš„processæ–¹æ³•æ±‚è¿™ä¸‰ä¸ªéšæœºæ•°çš„å’Œï¼Œå¹¶é€šè¿‡Dataç±»çš„valueå°†ç»“æžœè¿”å›žã€‚ä»Žè¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿”å›žvalueä¹‹å‰ï¼Œå¿…é¡»è¦å¾—åˆ°ä¸‰ä¸ªéšæœºæ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª valueæ˜¯æ— æ³•äº‹å…ˆå°±ä¼ å…¥çº¿ç¨‹ç±»çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839class Data &#123; public int value = 0 ;&#125;class Work &#123; public void process(Data data, Integer[] numbers) &#123; for ( int n : numbers) &#123; data.value += n; &#125; &#125;&#125;public class MyThread3 extends Thread &#123; private Work work; public MyThread3(Work work) &#123; this .work = work; &#125; public void run() &#123; //1.éšæœºç”Ÿæˆ3ä¸ªæ•°æ”¾è¿›æ•°ç»„ä¸­ java.util.Random random = new java.util.Random(); Data data = new Data(); int n1 = random.nextInt( 1000 ); int n2 = random.nextInt( 2000 ); int n3 = random.nextInt( 3000 ); Integer[] numbers = new Integer[3]; numbers[0] = n1; numbers[1] = n2; numbers[2] = n3; //è°ƒç”¨å‡½æ•°åŽ»è®¡ç®—è¿™ä¸‰ä¸ªæ•°ä¹‹å’Œï¼Œè®¡ç®—çš„ç»“æžœå­˜åœ¨Dataå®žä¾‹ä¸­çš„valueå±žæ€§ä¸­ //è¿™é‡Œprocessç›¸å½“äºŽå›žè°ƒå‡½æ•°ï¼Œæˆ‘è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç»™æˆ‘ä¸€ä¸ªè®¡ç®—ç»“æžœ work.process(data, numbers); System.out.println(String.valueOf(n1) + "+" + String.valueOf(n2) + "+" + String.valueOf(n3) + "=" + data.value); &#125; public static void main(String[] args) &#123; Thread t = new MyThread3( new Work()); t.start(); &#125;&#125; å…¶ä¸­ä¸€æ¬¡çš„æ‰§è¡Œç»“æžœä¸ºï¼š 1707+678+173=1558 åœ¨ä¸Šé¢ä»£ç ä¸­çš„processæ–¹æ³•è¢«ç§°ä¸ºå›žè°ƒå‡½æ•°ã€‚ä»Žæœ¬è´¨ä¸Šè¯´ï¼Œå›žè°ƒå‡½æ•°å°±æ˜¯äº‹ä»¶å‡½æ•°ã€‚åœ¨Windows APIä¸­å¸¸ä½¿ç”¨å›žè°ƒå‡½æ•°å’Œè°ƒç”¨APIçš„ç¨‹åºä¹‹é—´è¿›è¡Œæ•°æ®äº¤äº’ã€‚å› æ­¤ï¼Œè°ƒç”¨å›žè°ƒå‡½æ•°çš„è¿‡ç¨‹å°±æ˜¯æœ€åŽŸå§‹çš„å¼•å‘äº‹ä»¶çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­è°ƒç”¨äº†processæ–¹æ³•æ¥èŽ·å¾—æ•°æ®ä¹Ÿå°±ç›¸å½“äºŽåœ¨runæ–¹æ³•ä¸­å¼•å‘äº†ä¸€ä¸ªäº‹ä»¶ã€‚ äºŒã€å¦‚ä½•å¤„ç†çº¿ç¨‹è¿”å›žå€¼ ç”±äºŽçº¿ç¨‹ç›¸å½“äºŽä¸€ä¸ªå¼‚æ­¥çš„å¤„ç†å‡½æ•°ï¼Œæƒ³è¦èŽ·å–å®ƒçš„ç»“æžœå°±ä¸èƒ½åƒä¼ ç»Ÿçš„èŽ·å–å®ƒçš„returnçš„å€¼é‚£ä¹ˆç®€å•äº†ï¼Œä¸»è¦é—®é¢˜å°±åœ¨äºŽå®ƒä»€ä¹ˆæ—¶å€™èƒ½å¤„ç†å¥½æ˜¯ä¸çŸ¥é“çš„ï¼Œéœ€è¦ä¸€å®šçš„æœºåˆ¶åŽ»ç­‰å¾…å®ƒå¤„ç†å¥½äº†å†åŽ»èŽ·å–å®ƒçš„å¤„ç†ç»“æžœã€‚æ–¹å¼ä¸€èˆ¬æœ‰ä¸‰ç§ã€‚ 2.1 ä¸»çº¿ç¨‹ç­‰å¾…æ³• è¿™ä¸ªæ–¹æ³•æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„å¤„ç†æ–¹å¼ã€‚ä¸‹é¢æžä¸ªå®žä¾‹æ¥çœ‹çœ‹å¤§æ¦‚æ˜¯å¦‚ä½•æ“ä½œçš„ã€‚ é¦–å…ˆå†™ä¸€ä¸ªç±»ï¼Œå†™è¿™ä¸ªçš„å«ä¹‰æ˜¯ï¼Œå‡å¦‚ä¸»çº¿ç¨‹ä¸ç­‰å¾…ï¼Œå°†ä¼šä¸€å£æ°”æ‰§è¡Œåˆ°æœ€åŽä¸€è¡Œï¼Œæ­¤æ—¶å­çº¿ç¨‹å¯èƒ½è¿˜æ²¡æ‰§è¡Œå®Œã€‚å°±ä¼šå‡ºçŽ°æ‰“å°ç©ºã€‚ é‚£ä¹ˆæˆ‘ä»¬çš„ä¸»çº¿ç¨‹å¦‚ä½•èŽ·å–åˆ°å­çº¿ç¨‹ä¸­èµ‹äºˆçš„å€¼å‘¢ï¼Ÿä¸€ç§æ–¹å¼å°±æ˜¯æ­»ç­‰ï¼Œä¸åœåœ°è½®è¯¢çœ‹ä½ çš„å€¼æ˜¯å¦å·²ç»è®¡ç®—å¥½äº†ï¼Œä¸€æ—¦è®¡ç®—å¥½å°±å¯ä»¥æ‹¿åˆ°è¿™ä¸ªå€¼ã€‚ç±»ä¼¼äºŽä»¥ä¸‹ï¼š å…¶å®žè¿™å°±æ˜¯è‡ªæ—‹ï¼Œå³CPUåœåœ¨è¿™é‡Œç­‰å¾…ï¼Œä¸èƒ½å¹²å…¶ä»–äº‹æƒ…ï¼Œè¿™å¿…ç„¶ä¼šå¤§å¤§æµªè´¹CPUèµ„æºï¼Œæ‰€ä»¥è™½ç„¶è¿™ç§æ–¹å¼å®žçŽ°èµ·æ¥éžå¸¸ç®€å•ï¼Œä½†æ˜¯ä¸é€‚åˆç”¨ã€‚å¦å¤–çš„ç¼ºç‚¹å°±æ˜¯ä»£ç è‡ƒè‚¿ï¼Œæ¯”å¦‚æˆ‘è¦ç­‰å¾…çš„å€¼ä¸æ­¢ä¸€ä¸ªï¼Œæœ‰å¤šä¸ªï¼Œé‚£æ˜¯ä¸æ˜¯è¦å†™å¤šä¸ªwhileå¾ªçŽ¯æ¥ç­‰å¾…å‘¢ï¼Ÿæ­¤å¤–ï¼Œæˆ‘ä»¬å¤§å¤šæ—¶å€™æ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ªå­çº¿ç¨‹åˆ°åº•è¦æ‰§è¡Œå¤šä¹…ï¼Œå› ä¸ºæˆ‘ä»¬è¿™é‡Œæ˜¯æ¯éš”100æ¯«ç§’è½®è¯¢ä¸€æ¬¡ï¼Œé‚£å‡å¦‚è¿™ä¸ªå€¼åœ¨è¿™100æ¯«ç§’å†…å€¼å·²ç»æœ‰äº†ï¼Œé‚£ä¹ˆæ˜¯ä¸èƒ½ç«‹å³èŽ·å–çš„ã€‚ é’ˆå¯¹ä»¥ä¸Šä¸èƒ½ç²¾å‡†æŽ§åˆ¶çš„ç¼ºç‚¹ï¼Œè¿™é‡Œä¾¿æœ‰äº†ç¬¬äºŒç§æ–¹æ³•ã€‚ Joinæ–¹æ³• Threadç±»ä¸­çš„joinæ–¹æ³•å¯ä»¥é˜»å¡žå½“å‰çº¿ç¨‹ä»¥ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæ¯•ã€‚ åœ¨è¿™é‡Œï¼Œç”±äºŽæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨çš„joinï¼Œæ‰€ä»¥é˜»å¡žä¸»çº¿ç¨‹ï¼Œè®©å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†ç»§ç»­æ‰§è¡Œã€‚ è¿™ç§æ–¹æ³•æ›´ç®€å•ï¼Œä½†æ˜¯å­˜åœ¨å¤šä¸ªå­çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œåšåˆ°çµæ´»ä»¥åŠç²¾å‡†æŽ§åˆ¶æ˜¯åšä¸åˆ°çš„ã€‚ CallableæŽ¥å£å®žçŽ° JAVAæä¾›äº†æœ‰è¿”å›žå€¼çš„ä»»åŠ¡ï¼Œå³å®žçŽ°äº†CallableæŽ¥å£çš„ä»»åŠ¡ï¼Œæ‰§è¡Œè¿™ä¸ªä»»åŠ¡ä¹‹åŽå¯ä»¥èŽ·å–ä¸€ä¸ªå«åšFutrueçš„å¯¹è±¡ï¼Œé€šè¿‡get()å°±å¯ä»¥èŽ·å–Callableä»»åŠ¡è¿”å›žçš„å†…å®¹ã€‚ å…·ä½“æ˜¯å¦‚ä½•èŽ·å–è¿”å›žçš„å†…å®¹å‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡FutureTaskè¿™ä¸ªç±»æ¥èŽ·å–ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡çº¿ç¨‹æ± èŽ·å–ã€‚ å¯¹äºŽç¬¬ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥ç†è§£ã€‚ å…ˆæ–°å»ºä¸€ä¸ªå®žçŽ°äº†CallableæŽ¥å£çš„ä»»åŠ¡ï¼š æŠŠCallableä»»åŠ¡æ”¾è¿›FutureTaskä¸­ï¼Œè¿™ä¸ªFutureTaskå†æ”¾è¿›Threadä¸­åŽ»æ‰§è¡Œï¼š å‘çŽ°æˆ‘ä»¬çš„ç¨‹åºå¹¶æ²¡æœ‰æ˜¾ç¤ºåœ°ç­‰å¾…ï¼ŒFutureTaskçš„get()æ–¹æ³•å®Œæˆäº†ç­‰å¾…å’ŒèŽ·å–è¿”å›žå€¼ã€‚ä¸‹é¢æ¥çœ‹çœ‹Futureçš„ç»§æ‰¿å…³ç³»ï¼š æˆ‘ä»¬å‘çŽ°ï¼ŒFutureTaskå®žè´¨ä¸Šéƒ½æ˜¯RunnableæŽ¥å£çš„å®žä¾‹ï¼Œåªæ˜¯å®ƒè¿˜æ˜¯FutrueæŽ¥å£çš„å®žä¾‹ï¼Œæ‰€ä»¥ä¸ä»…å¯ä»¥ä½œä¸ºä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡è¢«æ‰§è¡Œï¼Œè¿˜å¯ä»¥æŽ¥å—ä¸€ä¸ªCallableæŽ¥å£åŽ»æŽ¥å—å®ƒçš„è¿”å›žå€¼ã€‚å› æ­¤æ˜¯ä¸€ä¸ªå‡çº§ç‰ˆçš„Runnableå®žä¾‹ã€‚ è¯´å®Œäº†FutureTaskçš„å®žçŽ°æ–¹å¼ï¼Œä¸‹é¢å†æ¥çœ‹çœ‹å¦ä¸€ç§æ–¹å¼ï¼Œå³çº¿ç¨‹æ± æ¥å®žçŽ°ã€‚å…³äºŽçº¿ç¨‹æ± ï¼ŒåŽæ–‡è¿˜ä¼šè¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œåªæ˜¯ç®€å•å…ˆè¿ç”¨ä¸€ä¸‹ã€‚ è¾¾åˆ°äº†ä¸€æ ·çš„æ•ˆæžœã€‚æˆ‘ä»¬æ¥åˆ†æžåˆ†æžã€‚ æˆ‘ä»¬å‘çŽ°ï¼Œå…¶å®žä¸¤ç§æ–¹å¼çš„æ ¹æœ¬å°±æ˜¯Futureè¿™ä¸ªæŽ¥å£ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æŽ¥ç”¨äº†FutureTaskè¿™ä¸ªç±»æ¥æ‰‹åŠ¨å®žçŽ°ï¼Œå³ä¸ä»…éœ€è¦å®ƒæŽ¥æ”¶ä¸€ä¸ªCallableä»»åŠ¡ï¼Œè¿˜éœ€è¦å°†å…¶ä½œä¸ºä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡åŽ»æ‰‹åŠ¨æ‰§è¡Œã€‚è€Œç¬¬äºŒç§æ–¹å¼å°±æ¯”è¾ƒç®€å•äº†ï¼Œæœ‰äº†çº¿ç¨‹æ± ï¼Œæˆ‘ç›´æŽ¥æŠŠCallableä»»åŠ¡æ‰”çº¿ç¨‹æ± åŽ»submitï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯ä»¥èŽ·å–è¿”å›žå€¼çš„Futureç±»åž‹å¯¹è±¡ï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªå¯¹è±¡èŽ·å–åˆ°å€¼äº†ã€‚ æ‰€ä»¥ä¸¤ç§æ–¹å¼æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·ä¸€æ ·çš„ã€‚ ä¸‹é¢è¡¥å……ä¸€ä¸‹å…³äºŽRunnableå’ŒCallableä¸¤è€…çš„åŒºåˆ«ï¼š è¡¨é¢åŒºåˆ«ï¼š Runnableä¸è¿”å›žä»»åŠ¡æ‰§è¡Œç»“æžœï¼ŒCallableå¯è¿”å›žä»»åŠ¡æ‰§è¡Œç»“æžœ Callableåœ¨ä»»åŠ¡æ— æ³•è®¡ç®—ç»“æžœæ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œè€ŒRunnableä¸èƒ½ æœ¬è´¨åŒºåˆ«ï¼š Runnableçš„callæ–¹æ³•æ˜¯è¢«çº¿ç¨‹è°ƒç”¨çš„ï¼Œåœ¨runæ–¹æ³•ä¸­æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼›è€Œcallableçš„callæ–¹æ³•ä¸æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæ˜¯ç”±Futureçš„runæ–¹æ³•è°ƒç”¨çš„]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ç¨‹åŸºæœ¬çŸ¥è¯†æ¢³ç†]]></title>
    <url>%2F2019%2F02%2F10%2Fthread%2F%E7%BA%BF%E7%A8%8B%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ˜¯å…³äºŽJAVAå¤šçº¿ç¨‹å’Œå¹¶å‘çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è¯´æ˜ŽåŸºæœ¬æ¦‚å¿µï¼Œè¿™æ˜¯é¢è¯•ä¸­æœ€åŸºæœ¬çš„è¦ä¼šçš„ä¸œè¥¿ï¼Œå¦‚æžœè¿™äº›éƒ½å›žç­”ä¸äº†ï¼ŒåŸºæœ¬ä¸Šå°±æ²¡æœ‰æœºä¼šäº†ï¼Œæœ¬æ–‡ä»Žæºç ç¨å¾®æ·±å…¥ä¸€ç‚¹åŽ»æŽ¢è®¨å¸¸è§çš„åŸºæœ¬æ¦‚å¿µã€‚æœ¬æ–‡å¹¶ä¸ä¼šä»Žæœ€æœ€æœ€æœ€åŸºæœ¬çš„çŸ¥è¯†å¼€å§‹è¯´èµ·ï¼Œå°†ä¸è´¹ç¬”å¢¨ç›´å‡»è¦å®³ï¼Œæ‰€ä»¥éœ€è¦ä¸€ç‚¹å¤šçº¿ç¨‹çš„åŸºæœ¬çŸ¥è¯†æ‰è¡Œï¼Œè¿™ä¹Ÿç¬¦åˆæœ¬åšå®¢çš„å®—æ—¨ï¼Œå³çŸ¥è¯†ç‚¹å†æ¬¡æç‚¼å’Œå‡çº§ã€‚ ä¸€ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« è¿™ä¸€å—è¯¦è§ é¢è¯•-è¿›ç¨‹ä¸Žçº¿ç¨‹ é‡Œé¢çš„å†…å®¹ï¼Œç›¸ä¿¡å·²ç»å¤Ÿç”¨äº†ã€‚ äºŒã€start()å’Œrun()æ–¹æ³•çš„åŒºåˆ« ä»¥ä¸€ä¸ªå°ä¾‹å­å…¥æ‰‹ï¼Œåœ¨ä¸»å‡½æ•°ä¸­å°è¯•æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”ä»¥t.run()çš„å½¢å¼åŽ»è°ƒç”¨ï¼Œä»Žç»“æžœå¯ä»¥çœ‹å‡ºï¼Œjavaé»˜è®¤å¼€å¯ä¸»çº¿ç¨‹æ¥æ‰§è¡Œï¼Œå½“æˆ‘ä»¬ç”¨t.run()åŽ»æ‰§è¡Œçš„æ—¶å€™ï¼Œåªæ˜¯ç›¸å½“äºŽç®€å•çš„å‡½æ•°è°ƒç”¨ï¼Œå› ä¸ºä»Žæ‰“å°ç»“æžœå¯ä»¥çœ‹å‡ºéƒ½æ˜¯mainè¿›ç¨‹ï¼Œé‚£ä¹ˆï¼Œå®žè´¨ä¸Šå¹¶æ²¡æœ‰æ–°å»ºä¸€ä¸ªå­çº¿ç¨‹ã€‚ ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯ä¸€è°ƒç”¨å°±ä¼šåŽ»æ‰§è¡Œï¼Œè€Œæ˜¯è¯´è¿™ä¸ªçº¿ç¨‹å¤„äºŽå°±ç»ªçŠ¶æ€ï¼Œå°†æœ‰èµ„æ ¼èŽ·å¾—CPUçš„ä¸´å¹¸ï¼Œå…³äºŽçº¿ç¨‹çŠ¶æ€ï¼ŒåŽæ–‡ä¼šå†æ¬¡è¯¦ç»†è¯´æ˜Žï¼Œå…³äºŽstartä¹‹åŽå¤„äºŽå°±ç»ªçŠ¶æ€è¿™ä¸€ç‚¹é»˜è®¤è¯»è€…æ˜¯æ¸…æ¥šçš„ï¼Œä¸‹é¢è¡¨è¿°å¯èƒ½ä¸ä¼šå¤ªé¡¾åŠè¯´æ˜Žè¿™ä¸€ç‚¹ï¼‰ï¼š é‚£ä¹ˆï¼Œä»Žè¡¨è±¡ä¸Šæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œrunåªæ˜¯ç®€å•çš„å‡½æ•°è°ƒç”¨ï¼Œstartæ‰ä¼šçœŸæ­£åœ°å¼€å¯ä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œï¼Œä¸‹é¢ä»Žæºç å±‚é¢æ¥çœ‹çœ‹start()çš„åŸºæœ¬å®žçŽ°æ–¹å¼ã€‚ è¯´æ˜Žä¸€ä¸‹ï¼Œæœ¬æºç æ˜¯åŸºäºŽJDK1.8ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒçš„æ ¸å¿ƒå®žçŽ°æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼ŒIDEAä¸Šå·²ç»çœ‹ä¸äº†ï¼Œåªå¥½åŽ»çœ‹çœ‹openJDKäº†ã€‚ ç›´æŽ¥æ‰“å¼€ç½‘å€ï¼š Thread.c æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š æˆ‘ä»¬çœ‹åˆ°å¾ˆå¤šå…³äºŽçº¿ç¨‹çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯çœ‹ä¸åˆ°å…·ä½“çš„å®žçŽ°çš„ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸Šé¢å¼•å…¥äº†jvm.hçš„åº“ï¼Œæ‰€ä»¥å®žçŽ°åº”è¯¥æ˜¯åœ¨jvmç›¸å…³çš„ä»£ç ä¸­ï¼Œç›´æŽ¥ç‚¹å¼€ï¼š jvm.cpp å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼š emmmï¼Œè™½ç„¶ä¸å¤§çœ‹å¾—æ‡‚ï¼Œä½†æ˜¯æˆ‘ä»¬ç¡®å®žçœ‹åˆ°äº†start()ä¼šè°ƒç”¨è™šæ‹ŸæœºåŽ»åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæœ€ç»ˆå†åŽ»è°ƒç”¨runæ–¹æ³•åŽ»æ‰§è¡Œã€‚æ‰€ä»¥æµç¨‹å¦‚ä¸‹ï¼š æœ€ç»ˆæ€»ç»“ï¼š è°ƒç”¨start()æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­çº¿ç¨‹å¹¶å¯åŠ¨ run()æ–¹æ³•åªæ˜¯threadçš„ä¸€ä¸ªæ™®é€šæ–¹æ³•çš„è°ƒç”¨ ä¸‰ã€Threadå’ŒRunnableæ˜¯ä»€ä¹ˆå…³ç³» è¿˜æ˜¯è€è§„çŸ©ï¼Œå…ˆæ¥ç¿»ç¿»æºç ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒThreadæ˜¯ä¸€ä¸ªclassï¼Œè€ŒRunnableæ˜¯ä¸€ä¸ªinterfaceï¼Œè€ŒRunnableä¸­åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•å°±æ˜¯run(). é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸Šé¢è¯´åˆ°ï¼Œæ–°å»ºä¸€ä¸ªçº¿ç¨‹æ˜¯è¦é start()æ¥å®žçŽ°çš„ï¼Œé‚£ä¹ˆRunnableæ˜¯å¦‚ä½•æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹å‘¢ï¼Ÿå®ƒä¸æ˜¯åªæœ‰ä¸€ä¸ªrun()æ–¹æ³•å—ï¼Ÿ æ­¤æ—¶å†æ¥çœ‹Threadç±»ï¼Œå®ƒé‡Œé¢æœ‰å¤§é‡çš„æ–¹æ³•ï¼Œå°±åŒ…å«äº†run()å’Œstart()æ–¹æ³•ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æž„é€ å‡½æ•°ä¸º: 1public Thread(Runnable target) &#123;...&#125; å°±æ˜¯è¯´ï¼Œä¼ å…¥RunableæŽ¥å£å®žä¾‹ï¼Œå†è°ƒç”¨Threadçš„start()æ–¹æ³•åˆ›å»ºå­çº¿ç¨‹ï¼Œå†æ¥è°ƒç”¨é‡å†™çš„run()æ–¹æ³•å°±å¯ä»¥äº†ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­ã€‚ å…ˆè¯´è¯´ç”¨Threadçš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ç±»ï¼š è¿™ä¹Ÿä»Žä¾§é¢è¯æ˜Žäº†ï¼Œçº¿ç¨‹æ˜¯äº¤æ›¿æ‰§è¡Œçš„ï¼Œä½†æ˜¯å› ä¸ºå±žäºŽåŒä¸€ä¸ªè¿›ç¨‹ï¼Œå…±äº«åŒä¸€ä¸ªåœ°å€å’Œèµ„æºï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œåˆ‡æ¢ï¼Œæžå¤§æé«˜äº†CPUæ‰§è¡Œæ•ˆçŽ‡ã€‚ ä¸‹é¢å†æ¥çœ‹çœ‹RunnableæŽ¥å£æ˜¯æ€Žä¹ˆå®žçŽ°å¤šçº¿ç¨‹çš„ï¼š æ€»ç»“ä¸€ä¸‹ä»–ä»¬ä¿©ï¼š Threadæ˜¯ä¸€ä¸ªç±»ï¼ŒRunnableæ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œå‰è€…å®žçŽ°åŽè€… Threadæœ‰startæ–¹æ³•ï¼Œç»“åˆrun()å¯ä»¥å®žçŽ°å¤šçº¿ç¨‹ï¼Œä½†æ˜¯Runnableæ²¡æœ‰start()æ–¹æ³•ï¼Œæ‰€ä»¥è¦é€šè¿‡Thread()æ¥å®žçŽ°ï¼Œæ‰€ä»¥ï¼Œä¸¤ç§æ–¹å¼æœ€ç»ˆéƒ½æ˜¯é€šè¿‡Threadçš„start()æ¥å®žçŽ°run()çš„å¤šçº¿ç¨‹ç‰¹æ€§ ç”±äºŽJAVAæ˜¯å•ä¸€ç»§æ‰¿çš„ï¼Œæ‰€ä»¥æŽ¨èå¤šä½¿ç”¨RunnableæŽ¥å£]]></content>
      <tags>
        <tag>javaå¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®žä¾‹è¯´æ˜Žç±»åŠ è½½è¿‡ç¨‹]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E5%AE%9E%E4%BE%8B%E8%AF%B4%E6%98%8E%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬åä¸‰ç¯‡æ–‡ç« ï¼Œæœ¬æ–‡ä»Žä¸€ä¸ªç®€å•ç¨‹åºå…¥æ‰‹ï¼Œå°†å‰é¢æ‰€å­¦ä¸²è”èµ·æ¥ï¼Œè¯¦ç»†æ¥çœ‹çœ‹ç±»åŠ è½½çš„è¿‡ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚ é›¶ã€Javaè™šæ‹Ÿæœºå¯åŠ¨ã€åŠ è½½ç±»è¿‡ç¨‹åˆ†æž ä¸‹é¢æˆ‘å°†å®šä¹‰ä¸€ä¸ªéžå¸¸ç®€å•çš„javaç¨‹åºå¹¶è¿è¡Œå®ƒï¼Œæ¥é€æ­¥åˆ†æžjavaè™šæ‹Ÿæœºå¯åŠ¨çš„è¿‡ç¨‹ã€‚ 12345678910111213package org.luanlouis.jvm.load; import sun.security.pkcs11.P11Util; public class Main&#123; public static void main(String[] args) &#123; System.out.println("Hello,World!"); ClassLoader loader = P11Util.class.getClassLoader(); System.out.println(loader); &#125; &#125; åœ¨windowså‘½ä»¤è¡Œä¸‹è¾“å…¥ï¼š java org.luanlouis.jvm.load.Main å½“è¾“å…¥ä¸Šè¿°çš„å‘½ä»¤æ—¶ï¼š windowså¼€å§‹è¿è¡Œ{JRE_HOME}/bin/java.exeç¨‹åºï¼Œjava.exe ç¨‹åºå°†å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š 1.æ ¹æ®JVMå†…å­˜é…ç½®è¦æ±‚ï¼Œä¸ºJVMç”³è¯·ç‰¹å®šå¤§å°çš„å†…å­˜ç©ºé—´ï¼› 2.åˆ›å»ºä¸€ä¸ªå¼•å¯¼ç±»åŠ è½½å™¨å®žä¾‹ï¼Œåˆæ­¥åŠ è½½ç³»ç»Ÿç±»åˆ°å†…å­˜æ–¹æ³•åŒºåŒºåŸŸä¸­ï¼› 3.åˆ›å»ºJVM å¯åŠ¨å™¨å®žä¾‹ Launcher,å¹¶å–å¾—ç±»åŠ è½½å™¨ClassLoaderï¼› 4.ä½¿ç”¨ä¸Šè¿°èŽ·å–çš„ClassLoaderå®žä¾‹åŠ è½½æˆ‘ä»¬å®šä¹‰çš„ org.luanlouis.jvm.load.Mainç±»ï¼› 5.åŠ è½½å®Œæˆæ—¶å€™JVMä¼šæ‰§è¡ŒMainç±»çš„mainæ–¹æ³•å…¥å£ï¼Œæ‰§è¡ŒMainç±»çš„mainæ–¹æ³•ï¼› 6.ç»“æŸï¼Œjavaç¨‹åºè¿è¡Œç»“æŸï¼ŒJVMé”€æ¯ã€‚ ä¸‹é¢é€ä¸€åˆ†æžä¸€ä¸‹è¿™å‡ ä¸ªæ­¥éª¤ã€‚ ä¸€ã€æ ¹æ®JVMå†…å­˜é…ç½®è¦æ±‚ï¼Œä¸ºJVMç”³è¯·ç‰¹å®šå¤§å°çš„å†…å­˜ç©ºé—´ JVMå†…å­˜æŒ‰ç…§åŠŸèƒ½ä¸Šçš„åˆ’åˆ†ï¼Œå¯ä»¥ç²—ç•¥åœ°åˆ’åˆ†ä¸ºæ–¹æ³•åŒº(Method Area) å’Œå †(Heap),è€Œæ‰€æœ‰çš„ç±»çš„å®šä¹‰ä¿¡æ¯éƒ½ä¼šè¢«åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ã€‚ äºŒã€åˆ›å»ºä¸€ä¸ªå¼•å¯¼ç±»åŠ è½½å™¨å®žä¾‹ï¼Œåˆæ­¥åŠ è½½ç³»ç»Ÿç±»åˆ°å†…å­˜æ–¹æ³•åŒºåŒºåŸŸä¸­ JVMç”³è¯·å¥½å†…å­˜ç©ºé—´åŽï¼ŒJVMä¼šåˆ›å»ºä¸€ä¸ªå¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap Classloaderï¼‰å®žä¾‹ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨æ˜¯ä½¿ç”¨C++è¯­è¨€å®žçŽ°çš„ï¼Œè´Ÿè´£åŠ è½½JVMè™šæ‹Ÿæœºè¿è¡Œæ—¶æ‰€éœ€çš„åŸºæœ¬ç³»ç»Ÿçº§åˆ«çš„ç±»ï¼Œå¦‚java.lang.String, java.lang.Objectç­‰ç­‰ã€‚ å¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap Classloader)ä¼šè¯»å– {JRE_HOME}/lib ä¸‹çš„jaråŒ…å’Œé…ç½®ï¼Œç„¶åŽå°†è¿™äº›ç³»ç»Ÿç±»åŠ è½½åˆ°æ–¹æ³•åŒºå†…ã€‚ æœ¬ä¾‹ä¸­ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨æ˜¯ç”¨ {JRE_HOME}/libåŠ è½½ç±»çš„ï¼Œä¸è¿‡ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å‚æ•° -Xbootclasspath æˆ– ç³»ç»Ÿå˜é‡sun.boot.class.pathæ¥æŒ‡å®šçš„ç›®å½•æ¥åŠ è½½ç±»ã€‚ ä¸€èˆ¬è€Œè¨€ï¼Œ{JRE_HOME}/libä¸‹å­˜æ”¾ç€JVMæ­£å¸¸å·¥ä½œæ‰€éœ€è¦çš„ç³»ç»Ÿç±»ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š æ–‡ä»¶å æè¿° rt.jar è¿è¡ŒçŽ¯å¢ƒåŒ…ï¼Œrtå³runtimeï¼ŒJ2SE çš„ç±»å®šä¹‰éƒ½åœ¨è¿™ä¸ªåŒ…å†… charsets.jar å­—ç¬¦é›†æ”¯æŒåŒ… jce.jar æ˜¯ä¸€ç»„åŒ…ï¼Œå®ƒä»¬æä¾›ç”¨äºŽåŠ å¯†ã€å¯†é’¥ç”Ÿæˆå’Œåå•†ä»¥åŠ Message Authentication Codeï¼ˆMACï¼‰ jsse.jar å®‰å…¨å¥—æŽ¥å­—æ‹“å±•åŒ…Javaâ„¢ Secure Socket Extension classlist è¯¥æ–‡ä»¶å†…è¡¨ç¤ºæ˜¯å¼•å¯¼ç±»åŠ è½½å™¨åº”è¯¥åŠ è½½çš„ç±»çš„æ¸…å• net.properties JVM ç½‘ç»œé…ç½®ä¿¡æ¯ å¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap ClassLoaderï¼‰ åŠ è½½ç³»ç»Ÿç±»åŽï¼ŒJVMå†…å­˜ä¼šå‘ˆçŽ°å¦‚ä¸‹æ ¼å±€ï¼š å¼•å¯¼ç±»åŠ è½½å™¨å°†ç±»ä¿¡æ¯åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ï¼Œä»¥ç‰¹å®šæ–¹å¼ç»„ç»‡ï¼Œå¯¹äºŽæŸä¸€ä¸ªç‰¹å®šçš„ç±»è€Œè¨€ï¼Œåœ¨æ–¹æ³•åŒºä¸­å®ƒåº”è¯¥æœ‰ è¿è¡Œæ—¶å¸¸é‡æ± ã€ç±»åž‹ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œå¯¹åº”classå®žä¾‹çš„å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ ç±»åŠ è½½å™¨çš„å¼•ç”¨,ç”±äºŽè¿™äº›ç±»æ˜¯ç”±å¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap Classloader)è¿›è¡ŒåŠ è½½çš„ï¼Œè€Œ å¼•å¯¼ç±»åŠ è½½å™¨æ˜¯ç”±C++è¯­è¨€å®žçŽ°çš„ï¼Œæ‰€ä»¥æ˜¯æ— æ³•è®¿é—®çš„ï¼Œæ•…è€Œè¯¥å¼•ç”¨ä¸ºNULL å¯¹åº”classå®žä¾‹çš„å¼•ç”¨ï¼Œ ç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»ä¿¡æ¯æ”¾åˆ°æ–¹æ³•åŒºä¸­åŽï¼Œä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Class ç±»åž‹çš„å®žä¾‹æ”¾åˆ°å †(Heap)ä¸­, ä½œä¸ºå¼€å‘äººå‘˜è®¿é—®æ–¹æ³•åŒºä¸­ç±»å®šä¹‰çš„å…¥å£å’Œåˆ‡å…¥ç‚¹ã€‚ ä¸‰ã€åˆ›å»ºJVM å¯åŠ¨å™¨å®žä¾‹ Launcher,å¹¶å–å¾—ç±»åŠ è½½å™¨ClassLoader ä¸Šè¿°æ­¥éª¤å®Œæˆï¼ŒJVMåŸºæœ¬è¿è¡ŒçŽ¯å¢ƒå°±å‡†å¤‡å°±ç»ªäº†ã€‚æŽ¥ç€ï¼Œæˆ‘ä»¬è¦è®©JVMå·¥ä½œèµ·æ¥äº†ï¼šè¿è¡Œæˆ‘ä»¬å®šä¹‰çš„ç¨‹åº org.luanlouis,jvm.load.Mainã€‚ æ­¤æ—¶ï¼ŒJVMè™šæ‹Ÿæœºè°ƒç”¨å·²ç»åŠ è½½åœ¨æ–¹æ³•åŒºçš„ç±»sun.misc.Launcher çš„é™æ€æ–¹æ³•getLauncher(), èŽ·å–sun.misc.Launcher å®žä¾‹ï¼š 1234//èŽ·å–Javaå¯åŠ¨å™¨ sun.misc.Launcher launcher = sun.misc.Launcher.getLauncher(); //èŽ·å–ç±»åŠ è½½å™¨ClassLoaderç”¨æ¥åŠ è½½classåˆ°å†…å­˜æ¥ ClassLoader classLoader = launcher.getClassLoader(); sun.misc.Launcher ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼è®¾è®¡ï¼Œä¿è¯ä¸€ä¸ªJVMè™šæ‹Ÿæœºå†…åªæœ‰ä¸€ä¸ªsun.misc.Launcherå®žä¾‹ã€‚ åœ¨Launcherçš„å†…éƒ¨ï¼Œå…¶å®šä¹‰äº†ä¸¤ä¸ªç±»åŠ è½½å™¨(ClassLoader),åˆ†åˆ«æ˜¯sun.misc.Launcher.ExtClassLoaderå’Œsun.misc.Launcher.AppClassLoaderï¼Œè¿™ä¸¤ä¸ªç±»åŠ è½½å™¨åˆ†åˆ«è¢«ç§°ä¸ºæ‹“å±•ç±»åŠ è½½å™¨(Extension ClassLoader) å’Œ åº”ç”¨ç±»åŠ è½½å™¨(Application ClassLoader).å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å››ã€ä½¿ç”¨ç±»åŠ è½½å™¨ClassLoaderåŠ è½½Mainç±» é€šè¿‡ launcher.getClassLoader()æ–¹æ³•è¿”å›žAppClassLoaderå®žä¾‹ï¼ŒæŽ¥ç€å°±æ˜¯AppClassLoaderåŠ è½½ org.luanlouis.jvm.load.Mainç±»çš„æ—¶å€™äº†ã€‚ 12lassLoader classloader = launcher.getClassLoader();//å–å¾—AppClassLoaderç±» classLoader.loadClass("org.luanlouis.jvm.load.Main");//åŠ è½½è‡ªå®šä¹‰ç±» ä¸Šè¿°å®šä¹‰çš„org.luanlouis.jvm.load.Mainç±»è¢«ç¼–è¯‘æˆorg.luanlouis.jvm.load.Main classäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™ä¸ªclassæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå«å¸¸é‡æ± (Constant Pool)çš„ç»“æž„ä½“æ¥å­˜å‚¨è¯¥classçš„å¸¸é‡ä¿¡æ¯ã€‚å¸¸é‡æ± ä¸­æœ‰CONSTANT_CLASS_INFOç±»åž‹çš„å¸¸é‡ï¼Œè¡¨ç¤ºè¯¥classä¸­å£°æ˜Žäº†è¦ç”¨åˆ°é‚£äº›ç±»ï¼š å½“AppClassLoaderè¦åŠ è½½ org.luanlouis.jvm.load.Mainç±»æ—¶ï¼Œä¼šåŽ»æŸ¥çœ‹è¯¥ç±»çš„å®šä¹‰ï¼Œå‘çŽ°å®ƒå†…éƒ¨å£°æ˜Žä½¿ç”¨äº†å…¶å®ƒçš„ç±»ï¼š sun.security.pkcs11.P11Utilã€java.lang.Objectã€java.lang.Systemã€java.io.PrintStreamã€java.lang.Classï¼›org.luanlouis.jvm.load.Mainç±»è¦æƒ³æ­£å¸¸å·¥ä½œï¼Œé¦–å…ˆè¦èƒ½å¤Ÿä¿è¯è¿™äº›å…¶å†…éƒ¨å£°æ˜Žçš„ç±»åŠ è½½æˆåŠŸã€‚æ‰€ä»¥AppClassLoaderè¦å…ˆå°†è¿™äº›ç±»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ï¼ˆæ³¨ï¼šä¸ºäº†ç†è§£æ–¹ä¾¿ï¼Œè¿™é‡Œæ²¡æœ‰è€ƒè™‘æ‡’åŠ è½½çš„æƒ…å†µï¼Œäº‹å®žä¸Šçš„JVMåŠ è½½ç±»è¿‡ç¨‹æ¯”è¿™å¤æ‚çš„å¤šï¼‰ åŠ è½½é¡ºåºï¼š åŠ è½½java.lang.Objectã€java.lang.Systemã€java.io.PrintStreamã€java,lang.Class AppClassLoaderå°è¯•åŠ è½½è¿™äº›ç±»çš„æ—¶å€™ï¼Œä¼šå…ˆå§”æ‰˜ExtClassLoaderè¿›è¡ŒåŠ è½½ï¼› è€ŒExtClassLoaderå‘çŽ°ä¸æ˜¯å…¶åŠ è½½èŒƒå›´ï¼Œå…¶è¿”å›žnullï¼› AppClassLoaderå‘çŽ°çˆ¶ç±»åŠ è½½å™¨ExtClassLoaderæ— æ³•åŠ è½½ï¼Œ åˆ™ä¼šæŸ¥è¯¢è¿™äº›ç±»æ˜¯å¦å·²ç»è¢«BootstrapClassLoaderåŠ è½½è¿‡ï¼Œ ç»“æžœè¡¨æ˜Žè¿™äº›ç±»å·²ç»è¢«BootstrapClassLoaderåŠ è½½è¿‡ï¼Œ åˆ™æ— éœ€é‡å¤åŠ è½½ï¼Œç›´æŽ¥è¿”å›žå¯¹åº”çš„Class&lt;T&gt;å®žä¾‹ï¼› åŠ è½½sun.security.pkcs11.P11Util æ­¤åœ¨{JRE_HOME}/lib/ext/sunpkcs11.jaråŒ…å†…ï¼Œå±žäºŽExtClassLoaderè´Ÿè´£åŠ è½½çš„èŒƒç•´ã€‚ AppClassLoaderå°è¯•åŠ è½½è¿™äº›ç±»çš„æ—¶å€™ï¼Œä¼šå…ˆå§”æ‰˜ExtClassLoaderè¿›è¡ŒåŠ è½½ï¼› è€ŒExtClassLoaderå‘çŽ°å…¶æ­£å¥½å±žäºŽåŠ è½½èŒƒå›´ï¼Œæ•…ExtClassLoaderè´Ÿè´£å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ ExtClassLoaderåœ¨åŠ è½½sun.security.pkcs11.P11Utilæ—¶ä¹Ÿåˆ†æžè¿™ä¸ªç±»å†…éƒ½ä½¿ç”¨äº†å“ªäº›ç±»ï¼Œ å¹¶å°†è¿™äº›ç±»å…ˆåŠ è½½å†…å­˜åŽï¼Œæ‰å¼€å§‹åŠ è½½sun.security.pkcs11.P11Utilï¼Œ åŠ è½½æˆåŠŸåŽç›´æŽ¥è¿”å›žå¯¹åº”çš„Class&lt;sun.security.pkcs11.P11Util&gt;å®žä¾‹ï¼› åŠ è½½org.luanlouis.jvm.load.Main AppClassLoaderå°è¯•åŠ è½½è¿™äº›ç±»çš„æ—¶å€™ï¼Œä¼šå…ˆå§”æ‰˜ExtClassLoaderè¿›è¡ŒåŠ è½½ï¼› è€ŒExtClassLoaderå‘çŽ°ä¸æ˜¯å…¶åŠ è½½èŒƒå›´ï¼Œå…¶è¿”å›žnullï¼› AppClassLoaderå‘çŽ°çˆ¶ç±»åŠ è½½å™¨ExtClassLoaderæ— æ³•åŠ è½½ï¼Œ åˆ™ä¼šæŸ¥è¯¢è¿™äº›ç±»æ˜¯å¦å·²ç»è¢«BootstrapClassLoaderåŠ è½½è¿‡ã€‚ è€Œç»“æžœè¡¨æ˜ŽBootstrapClassLoader æ²¡æœ‰åŠ è½½è¿‡å®ƒï¼Œ è¿™æ—¶å€™AppClassLoaderåªèƒ½è‡ªå·±åŠ¨æ‰‹è´Ÿè´£å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œ ç„¶åŽè¿”å›žå¯¹åº”çš„Class&lt;org.luanlouis.jvm.load.Main&gt;å®žä¾‹å¼•ç”¨ï¼› ä»¥ä¸Šä¸‰æ­¥éª¤éƒ½æˆåŠŸï¼Œæ‰è¡¨ç¤ºclassLoader.loadClass(&quot;org.luanlouis.jvm.load.Main&quot;)å®Œæˆï¼Œä¸Šè¿°æ“ä½œå®ŒæˆåŽï¼ŒJVMå†…å­˜æ–¹æ³•åŒºçš„æ ¼å±€ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š JVMæ–¹æ³•åŒºçš„ç±»ä¿¡æ¯åŒºæ˜¯æŒ‰ç…§ç±»åŠ è½½å™¨è¿›è¡Œåˆ’åˆ†çš„ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨ä¼šç»´æŠ¤è‡ªå·±åŠ è½½ç±»ä¿¡æ¯ï¼› æŸä¸ªç±»åŠ è½½å™¨åœ¨åŠ è½½ç›¸åº”çš„ç±»æ—¶ï¼Œä¼šç›¸åº”åœ°åœ¨JVMå†…å­˜å †ï¼ˆHeapï¼‰ä¸­åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Class&lt;T&gt;ï¼Œç”¨æ¥è¡¨ç¤ºè®¿é—®è¯¥ç±»ä¿¡æ¯çš„å…¥å£ äº”ã€ä½¿ç”¨Mainç±»çš„mainæ–¹æ³•ä½œä¸ºç¨‹åºå…¥å£è¿è¡Œç¨‹åº å°±æ˜¯åŽ»æ‰§è¡ŒæŒ‡ä»¤ï¼Œè¿‡ç¨‹ä¸ŽJavaå¦‚ä½•æ‰§è¡Œä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åºç±»ä¼¼ã€‚ å…­ã€æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼ŒJVMé”€æ¯ï¼Œé‡Šæ”¾å†…å­˜ å¯¹äºŽæœ¬ç¨‹åºï¼Œä¸»ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œé‡Šæ”¾ä¸»å‡½æ•°æ‰€åœ¨çš„æ ˆå¸§ï¼Œé‡Šæ”¾å †ä¸­çš„å†…å­˜ã€‚ ä¸ƒã€å†æ¥å›žé¡¾å›žé¡¾javaç±»åŠ è½½å™¨ç›¸å…³çš„æ¦‚å¿µå§ æœ¬å¤„çš„å†…å®¹ä¸ºå†æ¬¡ç®€å•è¯´æ˜Žï¼Œå…·ä½“è§åŒäº²å§”æ´¾æ¨¡åž‹ã€‚ç±»åŠ è½½å™¨(Class Loader)ï¼šé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯å¯ä»¥åŠ è½½ç±»çš„å·¥å…·ã€‚JVMè‡ªèº«å®šä¹‰äº†ä¸‰ä¸ªç±»åŠ è½½å™¨ï¼šå¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap Class Loader)ã€æ‹“å±•ç±»åŠ è½½å™¨(Extension Class Loader )ã€åº”ç”¨åŠ è½½å™¨(Application Class Loader)ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿä¼šè‡ªå·±å®šä¹‰ä¸€äº›ç±»åŠ è½½å™¨æ¥æ»¡è¶³è‡ªèº«çš„éœ€è¦ã€‚ å¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap Class Loader): è¯¥ç±»åŠ è½½å™¨ä½¿JVMä½¿ç”¨C++/Cåº•å±‚ä»£ç å®žçŽ°çš„åŠ è½½å™¨ï¼Œç”¨ä»¥åŠ è½½JVMè¿è¡Œæ—¶æ‰€éœ€è¦çš„ç³»ç»Ÿç±»ï¼Œè¿™äº›ç³»ç»Ÿç±»åœ¨{JRE_HOME}/libç›®å½•ä¸‹ã€‚ç”±äºŽç±»åŠ è½½å™¨æ˜¯ä½¿ç”¨å¹³å°ç›¸å…³çš„åº•å±‚C++/Cè¯­è¨€å®žçŽ°çš„ï¼Œ æ‰€ä»¥è¯¥åŠ è½½å™¨ä¸èƒ½è¢«Javaä»£ç è®¿é—®åˆ°ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢æŸä¸ªç±»æ˜¯å¦è¢«å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½è¿‡ã€‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ç³»ç»Ÿç±»å¦‚ï¼šjava.lang.String,java.lang.Object,java.lang*â€¦ è¿™äº›éƒ½è¢«æ”¾åœ¨ {JRE_HOME}/lib/rt.jaråŒ…å†…ï¼Œ å½“JVMç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œå¼•å¯¼ç±»åŠ è½½å™¨ä¼šå°†å…¶åŠ è½½åˆ° JVMå†…å­˜çš„æ–¹æ³•åŒºä¸­ã€‚ æ‹“å±•ç±»åŠ è½½å™¨(Extension Class Loader): è¯¥åŠ è½½å™¨æ˜¯ç”¨äºŽåŠ è½½ java çš„æ‹“å±•ç±» ï¼Œæ‹“å±•ç±»ä¸€èˆ¬ä¼šæ”¾åœ¨{JRE_HOME}/lib/ext/ ç›®å½•ä¸‹ï¼Œç”¨æ¥æä¾›é™¤äº†ç³»ç»Ÿç±»ä¹‹å¤–çš„é¢å¤–åŠŸèƒ½ã€‚æ‹“å±•ç±»åŠ è½½å™¨æ˜¯æ˜¯æ•´ä¸ªJVMåŠ è½½å™¨çš„Javaä»£ç å¯ä»¥è®¿é—®åˆ°çš„ç±»åŠ è½½å™¨çš„æœ€é¡¶ç«¯ï¼Œå³æ˜¯è¶…çº§çˆ¶åŠ è½½å™¨ï¼Œæ‹“å±•ç±»åŠ è½½å™¨æ˜¯æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨çš„ã€‚ï¼ˆæ³¨æ„ï¼Œå…¶å®žå¼•å¯¼ç±»åŠ è½½å™¨ä¸èƒ½ç®—æ˜¯æ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»ï¼Œæˆ‘ä»¬ä»Žæºç ä¸­å¯ä»¥çœ‹å‡ºæ¥çš„ï¼‰ åº”ç”¨ç±»åŠ è½½å™¨(Applocatoin Class Loader): è¯¥ç±»åŠ è½½å™¨æ˜¯ç”¨äºŽåŠ è½½ç”¨æˆ·ä»£ç ï¼Œæ˜¯ç”¨æˆ·ä»£ç çš„å…¥å£ã€‚æˆ‘ç»å¸¸æ‰§è¡ŒæŒ‡ä»¤ java xxx.x.xxx.x.x.XClass , å®žé™…ä¸Šï¼ŒJVMå°±æ˜¯ä½¿ç”¨çš„AppClassLoaderåŠ è½½ xxx.x.xxx.x.x.XClass ç±»çš„ã€‚ ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustomized Class Loaderï¼‰ï¼šç”¨æˆ·å¯ä»¥è‡ªå·±å®šä¹‰ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»ã€‚æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½è¦ç»§æ‰¿java.lang.ClassLoaderç±»ã€‚ å…³äºŽåŒäº²å§”æ´¾æ¨¡åž‹ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚ å…«ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ Java ä»»ä½•ä¸€æ®µä»£ç çš„æ‰§è¡Œï¼Œéƒ½æœ‰å¯¹åº”çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ã€‚å¦‚æžœæˆ‘ä»¬åœ¨ä»£ç ä¸­ï¼Œæƒ³çœ‹å½“å‰æ˜¯å“ªä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œå½“å‰ä»£ç ï¼Œæˆ‘ä»¬ç»å¸¸æ˜¯ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š 1Thread thread = Thread.currentThread();//è¿”å›žå¯¹å½“å½“å‰è¿è¡Œçº¿ç¨‹çš„å¼•ç”¨ ç›¸åº”åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå½“å‰çš„çº¿ç¨‹æŒ‡å®šç±»åŠ è½½å™¨ã€‚åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œ å½“æ‰§è¡Œ java org.luanlouis.jvm.load.Main çš„æ—¶å€™ï¼ŒJVMä¼šåˆ›å»ºä¸€ä¸ªMainçº¿ç¨‹ï¼Œè€Œåˆ›å»ºåº”ç”¨ç±»åŠ è½½å™¨AppClassLoaderçš„æ—¶å€™ï¼Œä¼šå°†AppClassLoaderè®¾ç½®æˆMainçº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼š 123456789101112131415161718public Launcher() &#123; Launcher.ExtClassLoader var1; try &#123; var1 = Launcher.ExtClassLoader.getExtClassLoader(); &#125; catch (IOException var10) &#123; throw new InternalError("Could not create extension class loader", var10); &#125; try &#123; this.loader = Launcher.AppClassLoader.getAppClassLoader(var1); &#125; catch (IOException var9) &#123; throw new InternalError("Could not create application class loader", var9); &#125; //å°†AppClassLoaderè®¾ç½®æˆå½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åŠ è½½å™¨ Thread.currentThread().setContextClassLoader(this.loader); //....... &#125; çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ä»Žçº¿ç¨‹çš„è§’åº¦æ¥çœ‹å¾…ç±»çš„åŠ è½½ï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹ç»‘å®šä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œå¯ä»¥å°†ç±»çš„åŠ è½½ä»Žå•çº¯çš„ åŒäº²åŠ è½½æ¨¡åž‹è§£æ”¾å‡ºæ¥ï¼Œè¿›è€Œå®žçŽ°ç‰¹å®šçš„åŠ è½½éœ€æ±‚ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E9%9D%99%E6%80%81%E5%88%86%E6%B4%BE%E5%92%8C%E5%8A%A8%E6%80%81%E5%88%86%E6%B4%BE%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬åäºŒç¯‡æ–‡ç« ï¼Œæœ¬ç« è¯´æ˜Žé™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾çš„åŽŸç†ã€‚ è¿™é‡Œæ‰€è°“çš„åˆ†æ´¾æŒ‡çš„æ˜¯åœ¨Javaä¸­å¯¹æ–¹æ³•çš„è°ƒç”¨ã€‚Javaä¸­æœ‰ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ã€‚åˆ†æ´¾æ˜¯å¤šæ€æ€§çš„ä½“çŽ°ï¼ŒJavaè™šæ‹Ÿæœºåº•å±‚æä¾›äº†æˆ‘ä»¬å¼€å‘ä¸­â€œé‡å†™â€å’Œâ€œé‡è½½â€çš„åº•å±‚å®žçŽ°ã€‚å…¶ä¸­é‡è½½å±žäºŽé™æ€åˆ†æ´¾ï¼Œè€Œé‡å†™åˆ™æ˜¯åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ã€‚é™¤äº†ä½¿ç”¨åˆ†æ´¾çš„æ–¹å¼å¯¹æ–¹æ³•è¿›è¡Œè°ƒç”¨ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è§£æžè°ƒç”¨ï¼Œè§£æžè°ƒç”¨æ˜¯åœ¨ç¼–è¯‘æœŸé—´å°±å·²ç»ç¡®å®šäº†ï¼Œåœ¨ç±»è£…è½½çš„è§£æžé˜¶æ®µå°±ä¼šæŠŠç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æŽ¥å¼•ç”¨ï¼Œä¸ä¼šå»¶è¿Ÿåˆ°è¿è¡ŒæœŸé—´å†åŽ»å®Œæˆã€‚è€Œåˆ†æ´¾è°ƒç”¨åˆ™æ—¢å¯ä»¥æ˜¯é™æ€çš„ä¹Ÿå¯ä»¥æ˜¯åŠ¨æ€ï¼ˆå°±æ˜¯è¿™é‡Œçš„é™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾ï¼‰çš„ã€‚ æ–¹æ³•è§£æž å¯¹äºŽæ–¹æ³•çš„è°ƒç”¨ï¼Œè™šæ‹Ÿæœºæä¾›äº†å››æ¡æ–¹æ³•è°ƒç”¨çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†åˆ«æ˜¯ï¼š invokestatic: è°ƒç”¨é™æ€æ–¹æ³• invokespecial: è°ƒç”¨æž„é€ æ–¹æ³•ï¼Œç§æœ‰æ–¹æ³•ï¼Œçˆ¶ç±»æ–¹æ³• invokevirtual: è°ƒç”¨è™šæ–¹æ³• invokeinterface: è°ƒç”¨æŽ¥å£æ–¹æ³• å…¶ä¸­ï¼Œ1å’Œ2éƒ½å¯ä»¥åœ¨ç±»åŠ è½½é˜¶æ®µç¡®å®šæ–¹æ³•çš„å”¯ä¸€ç‰ˆæœ¬ï¼Œå› æ­¤ï¼Œåœ¨ç±»åŠ è½½é˜¶æ®µå°±å¯ä»¥æŠŠç¬¦å·å¼•ç”¨è§£æžä¸ºç›´æŽ¥å¼•ç”¨ï¼Œåœ¨è°ƒç”¨æ—¶åˆ»ç›´æŽ¥æ‰¾åˆ°æ–¹æ³•ä»£ç å—çš„å†…å­˜åœ°å€è¿›è¡Œæ‰§è¡Œï¼ˆç¼–è¯‘æ—¶å·²ç»æ‰¾åˆ°äº†ï¼Œå¹¶ä¸”å­˜åœ¨æ–¹æ³•è°ƒç”¨çš„å…¥å£ï¼‰ï¼›3å’Œ4åˆ™æ˜¯åœ¨è¿è¡ŒæœŸé—´åŠ¨æ€ç»‘å®šæ–¹æ³•çš„ç›´æŽ¥å¼•ç”¨ã€‚ invokestaticæŒ‡ä»¤å’ŒinvokespecialæŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ç§°ä¸ºéžè™šæ–¹æ³•ï¼Œæ³¨æ„ï¼Œfinalä¿®é¥°çš„æ–¹æ³•ä¹Ÿå±žäºŽè™šæ–¹æ³•ã€‚ é™æ€åˆ†æ´¾ é™æ€åˆ†æ´¾åªä¼šæ¶‰åŠé‡è½½ï¼Œè€Œé‡è½½æ˜¯åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šçš„ï¼Œé‚£ä¹ˆé™æ€åˆ†æ´¾è‡ªç„¶æ˜¯ä¸€ä¸ªé™æ€çš„è¿‡ç¨‹ï¼ˆå› ä¸ºè¿˜æ²¡æœ‰æ¶‰åŠåˆ°Javaè™šæ‹Ÿæœºï¼‰ã€‚é™æ€åˆ†æ´¾çš„æœ€ç›´æŽ¥çš„è§£é‡Šæ˜¯åœ¨é‡è½½çš„æ—¶å€™æ˜¯é€šè¿‡å‚æ•°çš„é™æ€ç±»åž‹è€Œä¸æ˜¯å®žé™…ç±»åž‹ä½œä¸ºåˆ¤æ–­ä¾æ®çš„ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ªç±»Oï¼Œåœ¨Oä¸­åˆ›å»ºäº†é™æ€ç±»å†…éƒ¨ç±»Aï¼ŒOä¸­åˆæœ‰ä¸¤ä¸ªé™æ€ç±»å†…éƒ¨ç±»Bã€Cç»§æ‰¿äº†è¿™ä¸ªé™æ€å†…éƒ¨ç±»Aï¼Œé‚£ä¹ˆå®žé™…ä¸Šå½“ç¼–å†™å¦‚ä¸‹çš„ä»£ç ï¼š 123456789101112131415161718192021public class O&#123; static class A&#123;&#125; static class B extends A&#123;&#125; static class C extends A&#123;&#125; public void a(A a)&#123; System.out.println("A method"); &#125; public void a(B b)&#123; System.out.println("B method"); &#125; public void a(C c)&#123; System.out.println("C method"); &#125; public static void main(String[] args)&#123; O o = new O(); A b = new B(); A c = new C(); o.a(b); o.a(c); &#125;&#125; è¿è¡Œçš„ç»“æžœæ˜¯æ‰“å°å‡ºè¿žä¸ªâ€œA methodâ€ã€‚åŽŸå› åœ¨äºŽé™æ€ç±»åž‹çš„å˜åŒ–ä»…ä»…åœ¨ä½¿ç”¨æ—¶å‘ç”Ÿï¼Œå˜é‡æœ¬èº«çš„ç±»åž‹ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œä¸­A b = new B();è™½ç„¶åœ¨åˆ›å»ºçš„æ—¶å€™æ˜¯Bçš„å¯¹è±¡ï¼Œä½†æ˜¯å½“è°ƒç”¨o.a(b)çš„æ—¶å€™æ‰å‘çŽ°æ˜¯Açš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¼šè¾“å‡ºâ€œA methodâ€ã€‚**ä¹Ÿå°±æ˜¯è¯´åœ¨å‘ç”Ÿé‡è½½çš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºæ˜¯é€šè¿‡å‚æ•°çš„é™æ€ç±»åž‹è€Œä¸æ˜¯å®žé™…å‚æ•°ç±»åž‹ä½œä¸ºåˆ¤æ–­ä¾æ®çš„ã€‚**å› æ­¤ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼ŒJavacç¼–è¯‘å™¨é€‰æ‹©äº†a(A a)è¿™ä¸ªé‡è½½æ–¹æ³•ã€‚ è™½ç„¶ç¼–è¯‘å™¨èƒ½å¤Ÿåœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šæ–¹æ³•çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹é‡è½½çš„ç‰ˆæœ¬ä¸æ˜¯å”¯ä¸€çš„ï¼Œåœ¨è¿™ç§æ¨¡ç³Šçš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šé€‰æ‹©ä¸€ä¸ªæ›´åˆé€‚çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œé‡è½½çš„æ–¹æ³•ä¸­ï¼Œå‚æ•°åˆ—è¡¨é™¤äº†å‚æ•°ç±»åž‹ä¸ä¸€æ ·ï¼Œå…¶ä»–éƒ½ä¸€æ ·ï¼Œä¾‹æŽ¥æ”¶çš„å‚æ•°æœ‰char\int\longç­‰ï¼Œä¼ å…¥å‚æ•°â€˜aâ€™ï¼Œåˆ™ä¼šè°ƒç”¨éœ€è¦charç±»åž‹å‚æ•°çš„æ–¹æ³•ï¼ŒåŽ»æŽ‰éœ€è¦charç±»åž‹å‚æ•°çš„æ–¹æ³•ï¼Œåˆ™ä¼šè°ƒç”¨éœ€è¦intç±»åž‹å‚æ•°çš„æ–¹æ³•ã€‚è¿™æ—¶å‘ç”Ÿäº†ä¸€æ¬¡è‡ªåŠ¨ç±»åž‹è½¬æ¢ã€‚åŒæ ·ï¼ŒåŽ»æŽ‰éœ€è¦intç±»åž‹å‚æ•°çš„æ–¹æ³•ï¼Œåˆ™ä¼šè°ƒç”¨éœ€è¦longç±»åž‹å‚æ•°çš„æ–¹æ³•ã€‚è¿™é‡Œå†æ¬¡å‘ç”Ÿç±»åž‹è½¬æ¢ï¼Œä¼šæŒ‰ç…§char-&gt;int-&gt;long-&gt;float-&gt;doubleè½¬æ¢ç±»åž‹ã€‚ åŠ¨æ€åˆ†æ´¾ åŠ¨æ€åˆ†æ´¾ä¸Žé‡å†™(Override)æœ‰ç€å¾ˆå¯†åˆ‡çš„å…³è”ã€‚å¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728package com.xtayfjpk.jvm.chapter8; public class DynamicDispatch &#123; static abstract class Human &#123; protected abstract void sayHello(); &#125; static class Man extends Human &#123; @Override protected void sayHello() &#123; System.out.println("man say hello"); &#125; &#125; static class Woman extends Human &#123; @Override protected void sayHello() &#123; System.out.println("woman say hello"); &#125; &#125; public static void main(String[] args) &#123; Human man = new Man(); Human woman = new Woman(); man.sayHello(); woman.sayHello(); man = new Woman(); man.sayHello(); &#125; &#125; è¿™é‡Œæ˜¾ç„¶ä¸å¯èƒ½æ˜¯æ ¹æ®é™æ€ç±»åž‹æ¥å†³å®šçš„ï¼Œå› ä¸ºé™æ€ç±»åž‹éƒ½æ˜¯Humançš„ä¸¤ä¸ªå˜é‡manå’Œwomanåœ¨è°ƒç”¨sayHello()æ–¹æ³•æ—¶æ‰§è¡Œäº†ä¸åŒçš„è¡Œä¸ºï¼Œå¹¶ä¸”å˜é‡manåœ¨ä¸¤æ¬¡è°ƒç”¨ä¸­æ‰§è¡Œäº†ä¸åŒçš„æ–¹æ³•ã€‚ å¯¼è‡´è¿™ä¸ªçŽ°è±¡çš„åŽŸæ˜¯æ˜¯è¿™ä¸¤ä¸ªå˜é‡çš„å®žé™…ç±»åž‹ä¸åŒã€‚é‚£ä¹ˆJavaè™šæ‹Ÿæœºæ˜¯å¦‚ä½•æ ¹æ®å®žé™…ç±»åž‹æ¥åˆ†æ´¾æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„å‘¢ï¼Œæˆ‘ä»¬ä½¿ç”¨javapå‘½ä»¤è¾“å‡ºè¿™æ®µä»£ç çš„å­—èŠ‚ç ï¼Œç»“æžœå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223public static void main(java.lang.String[]); flags: ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=3, args_size=1 0: new #16 // class com/xtayfjpk/jvm/chapter8/DynamicDispatch$Man 3: dup 4: invokespecial #18 // Method com/xtayfjpk/jvm/chapter8/DynamicDispatch$Man."&lt;init&gt;":()V 7: astore_1 8: new #19 // class com/xtayfjpk/jvm/chapter8/DynamicDispatch$Woman 11: dup 12: invokespecial #21 // Method com/xtayfjpk/jvm/chapter8/DynamicDispatch$Woman."&lt;init&gt;":()V 15: astore_2 16: aload_1 17: invokevirtual #22 // Method com/xtayfjpk/jvm/chapter8/DynamicDispatch$Human.sayHello:()V 20: aload_2 21: invokevirtual #22 // Method com/xtayfjpk/jvm/chapter8/DynamicDispatch$Human.sayHello:()V 24: new #19 // class com/xtayfjpk/jvm/chapter8/DynamicDispatch$Woman 27: dup 28: invokespecial #21 // Method com/xtayfjpk/jvm/chapter8/DynamicDispatch$Woman."&lt;init&gt;":()V 31: astore_1 32: aload_1 33: invokevirtual #22 // Method com/xtayfjpk/jvm/chapter8/DynamicDispatch$Human.sayHello:()V 36: return 0-15è¡Œçš„å­—èŠ‚ç æ˜¯å‡†å¤‡åŠ¨ä½œï¼Œä½œç”¨æ˜¯å»ºç«‹manå’Œwomançš„å†…å­˜ç©ºé—´ï¼Œè°ƒç”¨Manå’ŒWomanç±»çš„å®žä¾‹æž„é€ å™¨ï¼Œå°†è¿™ä¸¤ä¸ªå®žä¾‹çš„å¼•ç”¨å­˜æ”¾åœ¨ç¬¬1å’Œç¬¬2ä¸ªå±€éƒ¨å˜é‡è¡¨Slotä¹‹ä¸­ï¼Œè¿™ä¸ªåŠ¨ä½œå¯¹åº”äº†ä»£ç ä¸­è¿™ä¸¤å¥ï¼š 12Human man = new Man(); Human woman = new Woman(); æŽ¥ä¸‹æ¥çš„ç¬¬16-21è¡Œæ˜¯å…³é”®éƒ¨åˆ†ï¼Œç¬¬16å’Œç¬¬20ä¸¤è¡Œåˆ†åˆ«æŠŠåˆšåˆšåˆ›å»ºçš„ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨åŽ‹åˆ°æ ˆé¡¶ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯å°†æ‰§è¡Œçš„sayHello()æ–¹æ³•çš„æ‰€æœ‰è€…ï¼Œç§°ä¸ºæŽ¥æ”¶è€…(Receiver)ã€‚ ç¬¬17å’Œç¬¬21ä¸¤è¡Œæ˜¯æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ï¼Œå•ä»Žå­—èŠ‚ç çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸¤æ¡è°ƒç”¨æŒ‡ä»¤æ— è®ºæ˜¯æŒ‡ä»¤(éƒ½æ˜¯invokevirtual)è¿˜æ˜¯å‚æ•°(éƒ½æ˜¯å¸¸é‡æ± ä¸­Human.sayHello()çš„ç¬¦å·å¼•ç”¨)éƒ½å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯è¿™ä¸¤æ¡æŒ‡ä»¤æœ€ç»ˆæ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•å¹¶ä¸ç›¸åŒï¼Œå…¶åŽŸå› éœ€è¦ä»ŽinvokevirutalæŒ‡ä»¤çš„å¤šæ€æŸ¥æ‰¾è¿‡ç¨‹å¼€å§‹è¯´èµ·ï¼ŒinvokevirtualæŒ‡ä»¤çš„è¿è¡Œæ—¶è§£æžè¿‡ç¨‹å¤§è‡´åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š æ‰¾åˆ°æ“ä½œæ•°æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€æŒ‡å‘çš„å¯¹è±¡å®žé™…ç±»åž‹ï¼Œè®°ä½œCã€‚ å¦‚æžœåœ¨ç±»åž‹Cä¸­æ‰¾åˆ°ä¸Žå¸¸é‡ä¸­æè¿°ç¬¦å’Œç®€å•åç§°éƒ½ç›¸åŒçš„æ–¹æ³•ï¼Œåˆ™è¿›è¡Œè®¿é—®æƒé™æ ¡éªŒï¼Œå¦‚æžœé€šè¿‡åˆ™è¿”å›žè¿™ä¸ªæ–¹æ³•çš„ç›´æŽ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾ç»“æŸï¼›ä¸é€šè¿‡åˆ™è¿”å›žjava.lang.IllegalAccessErroré”™è¯¯ã€‚ å¦åˆ™ï¼ŒæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»Žä¸‹å¾€ä¸Šä¾æ¬¡å¯¹Cçš„å„ä¸ªçˆ¶ç±»è¿›è¡Œç¬¬2æ­¥çš„æœç´¢ä¸Žæ ¡éªŒè¿‡ç¨‹ã€‚ å¦‚æžœå§‹ç»ˆæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåˆ™æŠ›å‡ºjava.lang.AbstractMethodErroré”™è¯¯ã€‚ ç”±äºŽinvokevirtualæŒ‡ä»¤æ‰§è¡Œçš„ç¬¬ä¸€æ­¥å°±æ˜¯åœ¨è¿è¡ŒæœŸç¡®å®šæŽ¥æ”¶è€…çš„å®žé™…ç±»åž‹ï¼Œæ‰€ä»¥ä¸¤æ¬¡è°ƒç”¨ä¸­çš„invokevirtualæŒ‡ä»¤æŠŠå¸¸é‡æ± ä¸­çš„ç±»æ–¹æ³•ç¬¦å·å¼•ç”¨è§£æžåˆ°äº†ä¸åŒçš„ç›´æŽ¥å¼•ç”¨ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯Javaè¯­è¨€ä¸­æ–¹æ³•é‡å†™çš„æœ¬è´¨ã€‚æˆ‘ä»¬æŠŠè¿™ç§åœ¨è¿è¡ŒæœŸæ ¹æ®å®žé™…ç±»åž‹ç¡®å®šæ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾è¿‡ç¨‹ç§°ä¸ºåŠ¨æ€åˆ†æ´¾ã€‚ å•åˆ†æ´¾ä¸Žå¤šåˆ†æ´¾ æ–¹æ³•çš„æŽ¥æ”¶è€…ä¸Žæ–¹æ³•çš„å‚æ•°ç»Ÿç§°ä¸ºæ–¹æ³•çš„å®—é‡ã€‚æ ¹æ®åˆ†æ´¾åŸºäºŽå¤šå°‘ç§å®—é‡ï¼Œå¯ä»¥å°†åˆ†æ´¾åˆ’åˆ†ä¸ºå•åˆ†æ´¾ä¸Žå¤šåˆ†æ´¾ä¸¤ç§ã€‚å•åˆ†æ´¾æ˜¯æ ¹æ®ä¸€ä¸ªå®—é‡æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œé€‰æ‹©ï¼Œå¤šåˆ†æ´¾åˆ™æ˜¯æ ¹æ®å¤šäºŽä¸€ä¸ªå®—é‡å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œé€‰æ‹©ã€‚ åœ¨ç¼–è¯‘æœŸçš„é™æ€åˆ†æ´¾è¿‡ç¨‹é€‰æ‹©ç›®æ ‡æ–¹æ³•çš„ä¾æ®æœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯é™æ€ç±»åž‹ï¼›äºŒæ˜¯æ–¹æ³•å‚æ•°ï¼Œæ‰€ä»¥Javaè¯­è¨€çš„é™æ€åˆ†æ´¾å±žäºŽå¤šåˆ†æ´¾ç±»åž‹ã€‚åœ¨è¿è¡Œé˜¶æ®µè™šæ‹Ÿæœºçš„åŠ¨æ€åˆ†æ´¾è¿‡ç¨‹åªèƒ½æŽ¥æ”¶è€…çš„å®žé™…ç±»åž‹ä¸€ä¸ªå®—é‡ä½œä¸ºç›®æ ‡æ–¹æ³•é€‰æ‹©ä¾æ®ï¼Œæ‰€ä»¥Javaè¯­è¨€çš„åŠ¨æ€åˆ†æ´¾å±žäºŽå•åˆ†æ´¾ç±»åž‹ã€‚æ‰€ä»¥Javaè¯­è¨€æ˜¯ä¸€é—¨é™æ€å¤šåˆ†æ´¾ï¼ŒåŠ¨æ€å•åˆ†æ´¾è¯­è¨€ã€‚ JVMå®žçŽ°åŠ¨æ€åˆ†æ´¾ åŠ¨æ€åˆ†æ´¾åœ¨Javaä¸­è¢«å¤§é‡ä½¿ç”¨ï¼Œä½¿ç”¨é¢‘çŽ‡åŠå…¶é«˜ï¼Œå¦‚æžœåœ¨æ¯æ¬¡åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ä¸­éƒ½è¦é‡æ–°åœ¨ç±»çš„æ–¹æ³•å…ƒæ•°æ®ä¸­æœç´¢åˆé€‚çš„ç›®æ ‡çš„è¯å°±å¯èƒ½å½±å“åˆ°æ‰§è¡Œæ•ˆçŽ‡ï¼Œå› æ­¤JVMåœ¨ç±»çš„æ–¹æ³•åŒºä¸­å»ºç«‹è™šæ–¹æ³•è¡¨ï¼ˆvirtual method tableï¼‰æ¥æé«˜æ€§èƒ½ã€‚ â­â­â­æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªè™šæ–¹æ³•è¡¨ï¼Œè¡¨ä¸­å­˜æ”¾ç€å„ä¸ªæ–¹æ³•çš„å®žé™…å…¥å£ã€‚å¦‚æžœæŸä¸ªæ–¹æ³•åœ¨å­ç±»ä¸­æ²¡æœ‰è¢«é‡å†™ï¼Œé‚£å­ç±»çš„è™šæ–¹æ³•è¡¨ä¸­è¯¥æ–¹æ³•çš„åœ°å€å…¥å£å’Œçˆ¶ç±»è¯¥æ–¹æ³•çš„åœ°å€å…¥å£ä¸€æ ·ï¼Œå³å­ç±»çš„æ–¹æ³•å…¥å£æŒ‡å‘çˆ¶ç±»çš„æ–¹æ³•å…¥å£ã€‚å¦‚æžœå­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»çš„è™šæ–¹æ³•è¡¨ä¸­è¯¥æ–¹æ³•çš„å®žé™…å…¥å£å°†ä¼šè¢«æ›¿æ¢ä¸ºæŒ‡å‘å­ç±»å®žçŽ°ç‰ˆæœ¬çš„å…¥å£åœ°å€ã€‚ é‚£ä¹ˆè™šæ–¹æ³•è¡¨ä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿè™šæ–¹æ³•è¡¨ä¼šåœ¨ç±»åŠ è½½çš„è¿žæŽ¥é˜¶æ®µè¢«åˆ›å»ºå¹¶å¼€å§‹åˆå§‹åŒ–ï¼Œç±»çš„å˜é‡åˆå§‹å€¼å‡†å¤‡å®Œæˆä¹‹åŽï¼ŒJVMä¼šæŠŠè¯¥ç±»çš„æ–¹æ³•è¡¨ä¹Ÿåˆå§‹åŒ–å®Œæ¯•ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬åä¸€ç¯‡æ–‡ç« ï¼Œå…¶å®žåœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»è¯´åˆ°äº†ç±»åŠ è½½æœºåˆ¶ï¼Œä½†æ˜¯ä¸ºäº†æœ¬æ–‡çš„å®Œæ•´æ€§ï¼Œå‰é¢ä¸€éƒ¨åˆ†è¿˜æ˜¯é‡å¤åœ°æ”¾åœ¨è¿™é‡Œï¼ŒåŽé¢ä¼šç€é‡è¯´æ˜Žåˆå§‹åŒ–è¿‡ç¨‹ã€‚ 1. ç±»åŠ è½½è¿‡ç¨‹ ç±»ä»Žè¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡(Preparation)ã€è§£æž(Resolution)ã€åˆå§‹åŒ–(Initialization)ã€ä½¿ç”¨(Using)å’Œå¸è½½(Unloading)7ä¸ªé˜¶æ®µã€‚å…¶ä¸­å‡†å¤‡ã€éªŒè¯ã€è§£æž3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿žæŽ¥ï¼ˆLinkingï¼‰ã€‚å¦‚å›¾æ‰€ç¤ºï¼š åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™5ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹å¿…é¡»æŒ‰ç…§è¿™ç§é¡ºåºæŒ‰éƒ¨å°±ç­åœ°å¼€å§‹ï¼Œè€Œè§£æžé˜¶æ®µåˆ™ä¸ä¸€å®šï¼šå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åŽå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®šï¼ˆä¹Ÿç§°ä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®šï¼‰ã€‚ä»¥ä¸‹é™ˆè¿°çš„å†…å®¹éƒ½ä»¥HotSpotä¸ºåŸºå‡†ã€‚ 2. åŠ è½½ åœ¨åŠ è½½é˜¶æ®µï¼ˆå¯ä»¥å‚è€ƒjava.lang.ClassLoaderçš„loadClass()æ–¹æ³•ï¼‰ï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹3ä»¶äº‹æƒ…ï¼š é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥èŽ·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼ˆå¹¶æ²¡æœ‰æŒ‡æ˜Žè¦ä»Žä¸€ä¸ªClassæ–‡ä»¶ä¸­èŽ·å–ï¼Œå¯ä»¥ä»Žå…¶ä»–æ¸ é“ï¼Œè­¬å¦‚ï¼šç½‘ç»œã€åŠ¨æ€ç”Ÿæˆã€æ•°æ®åº“ç­‰ï¼‰ï¼› å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æž„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æž„ï¼› åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ï¼› åŠ è½½é˜¶æ®µå’Œè¿žæŽ¥é˜¶æ®µï¼ˆLinkingï¼‰çš„éƒ¨åˆ†å†…å®¹ï¼ˆå¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œï¼‰æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªå®Œæˆï¼Œè¿žæŽ¥é˜¶æ®µå¯èƒ½å·²ç»å¼€å§‹ï¼Œä½†è¿™äº›å¤¹åœ¨åŠ è½½é˜¶æ®µä¹‹ä¸­è¿›è¡Œçš„åŠ¨ä½œï¼Œä»ç„¶å±žäºŽè¿žæŽ¥é˜¶æ®µçš„å†…å®¹ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µçš„å¼€å§‹æ—¶é—´ä»ç„¶ä¿æŒç€å›ºå®šçš„å…ˆåŽé¡ºåºã€‚ 3. éªŒè¯ éªŒè¯æ˜¯è¿žæŽ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚ éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼›ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥é­”æœ¯0xCAFEBABEå¼€å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»åž‹ã€‚ å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æžï¼ˆæ³¨æ„ï¼šå¯¹æ¯”javacç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æžï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼›ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ã€‚ å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’ŒæŽ§åˆ¶æµåˆ†æžï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¡®ä¿è§£æžåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚ éªŒè¯é˜¶æ®µæ˜¯éžå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æžœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨-Xverifynoneå‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æŽªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚ 4. å‡†å¤‡ å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆè¢«staticä¿®é¥°çš„å˜é‡ï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®žä¾‹å˜é‡ï¼Œå®žä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®žä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨å †ä¸­ã€‚å…¶æ¬¡ï¼Œè¿™é‡Œæ‰€è¯´çš„åˆå§‹å€¼â€œé€šå¸¸æƒ…å†µâ€ä¸‹æ˜¯æ•°æ®ç±»åž‹çš„é›¶å€¼ï¼Œå‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼š 1public static int value=123; é‚£å˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åŽçš„åˆå§‹å€¼ä¸º0è€Œä¸æ˜¯123.å› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º123çš„putstaticæŒ‡ä»¤æ˜¯ç¨‹åºè¢«ç¼–è¯‘åŽï¼Œå­˜æ”¾äºŽç±»æž„é€ å™¨()æ–¹æ³•ä¹‹ä¸­ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º123çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚ è‡³äºŽâ€œç‰¹æ®Šæƒ…å†µâ€æ˜¯æŒ‡ï¼špublic static final int value=123ï¼Œå³å½“ç±»å­—æ®µçš„å­—æ®µå±žæ€§æ˜¯ConstantValueæ—¶ï¼Œä¼šåœ¨å‡†å¤‡é˜¶æ®µåˆå§‹åŒ–ä¸ºæŒ‡å®šçš„å€¼ï¼Œæ‰€ä»¥æ ‡æ³¨ä¸ºfinalä¹‹åŽï¼Œvalueçš„å€¼åœ¨å‡†å¤‡é˜¶æ®µåˆå§‹åŒ–ä¸º123è€Œéž0. 5. è§£æž è§£æžé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æŽ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚è§£æžåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æŽ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æŽ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»åž‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚ 6. åˆå§‹åŒ– ç±»åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åŽä¸€æ­¥ï¼Œåˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„javaç¨‹åºä»£ç ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œå˜é‡å·²ç»èµ‹è¿‡ä¸€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œåˆ™æ ¹æ®ç¨‹åºçŒ¿é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’åŽ»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶ä»–èµ„æºï¼Œæˆ–è€…è¯´ï¼šåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æž„é€ å™¨&lt;clinit&gt;()æ–¹æ³•çš„è¿‡ç¨‹. &lt;clinit&gt;()æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—static{}ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºçŽ°çš„é¡ºåºæ‰€å†³å®šçš„ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åŽçš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®ã€‚å¦‚ä¸‹ï¼š 123456789public class Test&#123; static &#123; i=0; System.out.println(i);//è¿™å¥ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼šCannot reference a field before it is definedï¼ˆéžæ³•å‘å‰åº”ç”¨ï¼‰ &#125; static int i=1;&#125; é‚£ä¹ˆåŽ»æŽ‰æŠ¥é”™çš„é‚£å¥ï¼Œæ”¹æˆä¸‹é¢ï¼š 1234567891011121314public class Test&#123; static &#123; i=0;// System.out.println(i); &#125; static int i=1; public static void main(String args[]) &#123; System.out.println(i); &#125;&#125; è¾“å‡ºç»“æžœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå½“ç„¶æ˜¯1å•¦~åœ¨å‡†å¤‡é˜¶æ®µæˆ‘ä»¬çŸ¥é“i=0ï¼Œç„¶åŽç±»åˆå§‹åŒ–é˜¶æ®µæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œé¦–å…ˆæ‰§è¡Œstaticå—ä¸­çš„i=0,æŽ¥ç€æ‰§è¡Œstaticèµ‹å€¼æ“ä½œi=1,æœ€åŽåœ¨mainæ–¹æ³•ä¸­èŽ·å–içš„å€¼ä¸º1ã€‚ &lt;clinit&gt;()æ–¹æ³•ä¸Žå®žä¾‹æž„é€ å™¨&lt;init&gt;()æ–¹æ³•ä¸åŒï¼Œå®ƒä¸éœ€è¦æ˜¾ç¤ºåœ°è°ƒç”¨çˆ¶ç±»æž„é€ å™¨ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»&lt;cinit&gt;()æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„&lt;clinit&gt;()æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•. â­ç”±äºŽçˆ¶ç±»çš„&lt;clinit&gt;()æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—è¦ä¼˜å…ˆäºŽå­ç±»çš„å˜é‡èµ‹å€¼æ“ä½œã€‚ &lt;clinit&gt;()æ–¹æ³•å¯¹äºŽç±»æˆ–è€…æŽ¥å£æ¥è¯´å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æžœä¸€ä¸ªç±»ä¸­æ²¡æœ‰é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿäº§&lt;clinit&gt;()æ–¹æ³•ã€‚ è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„&lt;clinit&gt;()æ–¹æ³•åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸­è¢«æ­£ç¡®çš„åŠ é”ã€åŒæ­¥ï¼Œå¦‚æžœå¤šä¸ªçº¿ç¨‹åŒæ—¶åŽ»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹åŽ»æ‰§è¡Œè¿™ä¸ªç±»çš„&lt;clinit&gt;()æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦é˜»å¡žç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ&lt;clinit&gt;()æ–¹æ³•å®Œæ¯•ã€‚å¦‚æžœåœ¨ä¸€ä¸ªç±»çš„&lt;clinit&gt;()æ–¹æ³•ä¸­æœ‰è€—æ—¶å¾ˆé•¿çš„æ“ä½œï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡žï¼Œåœ¨å®žé™…åº”ç”¨ä¸­è¿™ç§é˜»å¡žå¾€å¾€æ˜¯éšè—çš„ã€‚ è™šæ‹Ÿæœºè§„èŒƒä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰5ä¸­æƒ…å†µï¼ˆjdk1.7ï¼‰å¿…é¡»å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€ï¼ˆè€ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡è‡ªç„¶éœ€è¦åœ¨æ­¤ä¹‹å‰å¼€å§‹ï¼‰ï¼š é‡åˆ° new , getstatic , putstatic , invokestatic è¿™äº›å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æžœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ç”Ÿæˆè¿™4æ¡æŒ‡ä»¤çš„æœ€å¸¸è§çš„Javaä»£ç åœºæ™¯æ˜¯ï¼šâ‘ ä½¿ç”¨newå…³é”®å­—å®žä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ã€â‘¡è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢«finalä¿®é¥°ã€å·²åœ¨ç¼–è¯‘å™¨æŠŠç»“æžœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰çš„æ—¶å€™ï¼Œä»¥åŠâ‘¢è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚ ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æžœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æžœå‘çŽ°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚ ä¸‹é¢è¯´æ˜Žä¸‰ç§è¢«åŠ¨å¼•ç”¨(é™¤äº†ä¸Šé¢æåˆ°çš„äº”ç§æƒ…å†µå¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹æ³•éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œæˆä¸ºè¢«åŠ¨å¼•ç”¨)ã€‚ ç¬¬ä¸€ç§ï¼šé€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–ã€‚ 1234567public class SuperClass &#123; static &#123; System.out.println("superclass static init"); &#125; public static int value = 123;&#125; 12345public class SubClass extends SuperClass&#123; static&#123; System.out.println("SubClass static init"); &#125;&#125; 12345public class Test &#123; public static void main(String[] args) &#123; System.out.println(SubClass.value); &#125;&#125; ç»“æžœæ˜¯ï¼š 12superclass static init123 è¯´æ˜Žï¼šå¯¹äºŽé™æ€å­—æ®µï¼Œåªæœ‰ç›´æŽ¥å®šä¹‰è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œå› æ­¤é€šè¿‡å…¶å­ç±»æ¥å¼•ç”¨çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€å­—æ®µï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–è€Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–ã€‚ ç¬¬äºŒç§ï¼šé€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ– 12345678910package chapter12;//SuperClasså¤ç”¨ä¸Šé¢ä¸ªä»£ç public class NotInitialization&#123; public static void main(String[] args) &#123; SuperClass[] sca = new SuperClass[10]; &#125;&#125; è¿è¡Œç»“æžœï¼šï¼ˆæ— ï¼‰ è¯´æ˜Žï¼šä»Žç»“æžœæ¥çœ‹ï¼Œæ˜¾ç„¶æ²¡æœ‰è§¦å‘ç±»chapter12.SuperClassçš„åˆå§‹åŒ–é˜¶æ®µï¼Œä½†æ˜¯è¿™æ®µä»£ç è§¦å‘äº†å¦ä¸€ä¸ªåå« &quot;[Lchapter12.SuperClass&quot;çš„ç±»çš„åˆå§‹åŒ–é˜¶æ®µã€‚è¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç±»åç§°ï¼Œä»–æ˜¯ç”±è™šæ‹Ÿæœºè‡ªåŠ¨ç”Ÿæˆçš„ã€ç›´æŽ¥ç»§æ‰¿äºŽjava.lang.Objectçš„å­ç±»ï¼Œåˆ›å»ºåŠ¨ä½œç”±å­—èŠ‚ç åˆ¶å®šnewarrayè§¦å‘ã€‚ è¿™ä¸ªç±»ä»£è¡¨äº†ä¸€ä¸ªå…ƒç´ ç±»åž‹ä¸ºchapter12.SuperClassçš„ä¸€ç»´æ•°ç»„ï¼Œæ•°ç»„ä¸­åº”æœ‰çš„å±žæ€§å’Œæ–¹æ³•(ç”¨äºŽå¯ç›´æŽ¥ä½¿ç”¨çš„åªæœ‰è¢«ä¿®é¥°ä¸ºpublicçš„lengthå±žæ€§å’Œclone()æ–¹æ³•)éƒ½å®žçŽ°åœ¨è¿™ä¸ªç±»é‡Œã€‚Javaè¯­è¨€ä¸­å¯¹æ•°ç»„çš„è®¿é—®æ¯”C/C++ç›¸å¯¹å®‰å…¨æ˜¯å› ä¸ºè¿™ä¸ªç±»å°è£…äº†æ•°ç»„å…ƒç´ çš„è®¿é—®æ–¹æ³•ï¼Œè€ŒC/C++ ç›´æŽ¥ç¿»è¯‘ä¸ºå¯¹æ•°ç»„æŒ‡é’ˆçš„ç§»åŠ¨ã€‚ ç¬¬ä¸‰ç§ï¼šå¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æŽ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ– 12345678910111213141516public class ConstClass&#123; static &#123; System.out.println("ConstClass init!"); &#125; public static final String HELLOWORLD = "hello world";&#125;public class NotInitialization&#123; public static void main(String[] args) &#123; System.out.println(ConstClass.HELLOWORLD); &#125;&#125; è¿è¡Œç»“æžœï¼šhello world è¯´æ˜Žï¼šä¸Šè¿°ä»£ç è™½ç„¶åœ¨javaæºç ä¸­å¼•ç”¨äº†ConstClassç±»ä¸­çš„å¸¸é‡hello worldï¼Œä½†æ˜¯å…¶å®žåœ¨ç¼–è¯‘é˜¶æ®µé€šè¿‡å¸¸é‡ä¼ æ’­ä¼˜åŒ–ï¼Œå·²ç»å°†æ­¤å¸¸é‡å€¼hello worldå­˜å‚¨åˆ°äº†NotInitializationçš„å¸¸é‡æ± ä¸­ï¼Œä»¥åŽNotInitializationå¯¹å¸¸é‡ConstClass.HELLOWORLDçš„å¼•ç”¨å®žé™…ä¸Šéƒ½è¢«è½¬åŒ–ä¸ºNotInitializationå¯¹è‡ªèº«å¸¸é‡æ± çš„å¼•ç”¨äº†ã€‚ 7. æŽ¥å£çš„åŠ è½½ æŽ¥å£çš„åŠ è½½è¿‡ç¨‹ä¸Žç±»åŠ è½½è¿‡ç¨‹æœ‰ä¸€äº›ä¸åŒï¼Œé’ˆå¯¹æŽ¥å£éœ€è¦åšä¸€äº›ç‰¹æ®Šè¯´æ˜Žï¼š æŽ¥å£ä¹Ÿæœ‰åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè€ŒæŽ¥å£ä¸­ä¸èƒ½ä½¿ç”¨static{}è¯­å¥å—ï¼Œä½†ç¼–è¯‘å™¨ä»ç„¶ä¼šä¸ºæŽ¥å£ç”Ÿæˆ&quot;&lt;clinit()&gt;&quot;ç±»æž„é€ å™¨ï¼Œç”¨äºŽåˆå§‹åŒ–æŽ¥å£ä¸­æ‰€å®šä¹‰çš„æˆå‘˜å˜é‡ã€‚ æŽ¥å£ä¸Žç±»çœŸæ­£æ‰€åŒºåˆ«çš„æ˜¯å‰é¢è®²è¿°çš„5ç§â€œæœ‰ä¸”ä»…æœ‰â€æƒ…å†µçš„ç¬¬ä¸‰ç§ï¼šå½“ä¸€ä¸ªç±»åœ¨åˆå§‹åŒ–æ—¶ï¼Œè¦æ±‚å…¶çˆ¶ç±»å…¨éƒ¨éƒ½å·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œä½†æ˜¯ä¸€ä¸ªå€Ÿå£åœ¨åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸è¦æ±‚å…¶çˆ¶æŽ¥å£å…¨éƒ¨éƒ½å·²ç»å®Œæˆäº†åˆå§‹åŒ–ï¼Œåªæœ‰åœ¨çœŸæ­£ç”¨åˆ°çˆ¶æŽ¥å£æ—¶ï¼ˆå¦‚å¼•ç”¨æŽ¥å£ä¸­å®šä¹‰çš„å¸¸é‡ï¼‰æ‰ä¼šåˆå§‹åŒ–ã€‚ 8. ä¾‹å­å·©å›º 1234567public class SSClass&#123; static &#123; System.out.println("SSClass"); &#125;&#125; 1234567891011121314public class SuperClass extends SSClass&#123; static &#123; System.out.println("SuperClass init!"); &#125; public static int value = 123; public SuperClass() &#123; System.out.println("init SuperClass"); &#125;&#125; 1234567891011121314public class SubClass extends SuperClass&#123; static &#123; System.out.println("SubClass init"); &#125; static int a; public SubClass() &#123; System.out.println("init SubClass"); &#125;&#125; 1234567public class NotInitialization&#123; public static void main(String[] args) &#123; System.out.println(SubClass.value); &#125;&#125; è¿è¡Œç»“æžœï¼š 123SSClassSuperClass init!123 è¯´æ˜Žï¼šå¯¹äºŽé™æ€å­—æ®µï¼Œåªæœ‰ç›´æŽ¥å®šä¹‰è¿™ä¸ªå­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œå› æ­¤é€šè¿‡å…¶å­ç±»æ¥å¼•ç”¨çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€å­—æ®µï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–è€Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–ã€‚ 9.æ€»ç»“javaæ‰§è¡Œé¡ºåº ä¸¾ä¾‹ç«‹åˆ»æ˜Žç™½ï¼š 123456789101112131415public class Children extends Parent&#123; public Children() &#123; System.out.println("Childrenæž„é€ å‡½æ•°"); &#125; &#123; System.out.println("Childrenæ™®é€šä»£ç å—"); &#125; static &#123; System.out.println("Childrené™æ€ä»£ç å—"); &#125; public static void main(String[] args) &#123; Children children = new Children(); &#125;&#125; 1234567891011public class Parent &#123; public Parent() &#123; System.out.println("Parentæž„é€ å‡½æ•°"); &#125; &#123; System.out.println("Parentæ™®é€šä»£ç å—"); &#125; static &#123; System.out.println("Parenté™æ€ä»£ç å—"); &#125;&#125; æ‰§è¡Œç»“æžœï¼š 123456Parenté™æ€ä»£ç å—Childrené™æ€ä»£ç å—Parentæ™®é€šä»£ç å—Parentæž„é€ å‡½æ•°Childrenæ™®é€šä»£ç å—Childrenæž„é€ å‡½æ•° æ€»ç»“ï¼š 123456çˆ¶ç±»é™æ€å—è‡ªèº«é™æ€å—çˆ¶ç±»å—çˆ¶ç±»æž„é€ å™¨è‡ªèº«å—è‡ªèº«æž„é€ å™¨ 10. æ€»ç»“javaèµ‹å€¼é¡ºåº ä¸¾ä¾‹ç«‹åˆ»æ˜Žç™½ï¼š 12345678910111213141516public class Parent &#123; public String flag = "çˆ¶ç±»æˆå‘˜å˜é‡èµ‹å€¼"; public Parent() &#123; System.out.println(); System.out.println("çˆ¶ç±»æž„é€ å™¨---&gt;" + flag); flag = "çˆ¶ç±»æž„é€ å™¨èµ‹å€¼"; System.out.println("çˆ¶ç±»æž„é€ å™¨---&gt;" + flag); &#125; &#123; System.out.println("çˆ¶ç±»ä»£ç å—---&gt;" + flag); flag = "çˆ¶ç±»ä»£ç å—èµ‹å€¼"; System.out.println("çˆ¶ç±»ä»£ç å—---&gt;" + flag); &#125;&#125; 123456789101112131415161718192021222324252627public class Children extends Parent&#123; public String flag = "æˆå‘˜å˜é‡èµ‹å€¼"; public Children() &#123; System.out.println(); System.out.println("å­ç±»æž„é€ å™¨---&gt;" + flag); flag = "å­ç±»æž„é€ å™¨èµ‹å€¼"; System.out.println("å­ç±»æž„é€ å™¨---&gt;" + flag); &#125; &#123; System.out.println(); System.out.println("å­ç±»ä»£ç å¿«---&gt;" + flag); flag = "å­ç±»ä»£ç å—èµ‹å€¼"; System.out.println("å­ç±»ä»£ç å—---&gt;" + flag); &#125; public void setFlag()&#123; System.out.println(); System.out.println("å­ç±»æ–¹æ³•---&gt;" + flag); &#125; public static void main(String[] args) &#123; Children children = new Children(); children.setFlag(); &#125;&#125; è¿è¡Œç»“æžœï¼š 12345678910111213çˆ¶ç±»ä»£ç å—---&gt;çˆ¶ç±»æˆå‘˜å˜é‡èµ‹å€¼çˆ¶ç±»ä»£ç å—---&gt;çˆ¶ç±»ä»£ç å—èµ‹å€¼çˆ¶ç±»æž„é€ å™¨---&gt;çˆ¶ç±»ä»£ç å—èµ‹å€¼çˆ¶ç±»æž„é€ å™¨---&gt;çˆ¶ç±»æž„é€ å™¨èµ‹å€¼å­ç±»ä»£ç å¿«---&gt;æˆå‘˜å˜é‡èµ‹å€¼å­ç±»ä»£ç å—---&gt;å­ç±»ä»£ç å—èµ‹å€¼å­ç±»æž„é€ å™¨---&gt;å­ç±»ä»£ç å—èµ‹å€¼å­ç±»æž„é€ å™¨---&gt;å­ç±»æž„é€ å™¨èµ‹å€¼å­ç±»æ–¹æ³•---&gt;å­ç±»æž„é€ å™¨èµ‹å€¼ æ€»ç»“ï¼š 12345678910çˆ¶ç±»çš„é™æ€å˜é‡èµ‹å€¼è‡ªèº«çš„é™æ€å˜é‡èµ‹å€¼çˆ¶ç±»æˆå‘˜å˜é‡èµ‹å€¼çˆ¶ç±»å—èµ‹å€¼çˆ¶ç±»æž„é€ å™¨èµ‹å€¼è‡ªèº«æˆå‘˜å˜é‡èµ‹å€¼è‡ªèº«å—èµ‹å€¼è‡ªèº«æž„é€ å™¨èµ‹å€¼]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¡¥å……é˜…è¯»5-Classæ–‡ä»¶ä¸­çš„æ–¹æ³•è¡¨é›†åˆ--methodæ–¹æ³•åœ¨classæ–‡ä»¶ä¸­æ˜¯æ€Žæ ·ç»„ç»‡çš„]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E8%A1%A5%E5%85%85%E9%98%85%E8%AF%BB5-Class%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%96%B9%E6%B3%95%E8%A1%A8%E9%9B%86%E5%90%88--method%E6%96%B9%E6%B3%95%E5%9C%A8class%E6%96%87%E4%BB%B6%E4%B8%AD%E6%98%AF%E6%80%8E%E6%A0%B7%E7%BB%84%E7%BB%87%E7%9A%84%2F</url>
    <content type="text"><![CDATA[ç»§ç»­è®²classæ–‡ä»¶ä¸­çš„æ–¹æ³•è¡¨é›†åˆã€‚ 1. æ–¹æ³•è¡¨é›†åˆæ¦‚è¿° æ–¹æ³•è¡¨é›†åˆæ˜¯æŒ‡ç”±è‹¥å¹²ä¸ªæ–¹æ³•è¡¨ï¼ˆmethod_infoï¼‰ç»„æˆçš„é›†åˆã€‚å¯¹äºŽåœ¨ç±»ä¸­å®šä¹‰çš„è‹¥å¹²ä¸ªç»è¿‡JVMç¼–è¯‘æˆclassæ–‡ä»¶åŽï¼Œä¼šå°†ç›¸åº”çš„methodæ–¹æ³•ä¿¡æ¯ç»„ç»‡åˆ°ä¸€ä¸ªå«åšæ–¹æ³•è¡¨é›†åˆçš„ç»“æž„ä¸­ï¼Œå­—æ®µè¡¨é›†åˆæ˜¯ä¸€ä¸ªç±»æ•°ç»„ç»“æž„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 2. methodæ–¹æ³•çš„æè¿°-æ–¹æ³•è¡¨é›†åˆåœ¨classæ–‡ä»¶ä¸­çš„ä½ç½® methodæ–¹æ³•çš„æè¿°-æ–¹æ³•è¡¨é›†åˆç´§è·Ÿåœ¨å­—æ®µè¡¨é›†åˆçš„åŽé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3. ä¸€ä¸ªç±»ä¸­çš„methodæ–¹æ³•åº”è¯¥åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ----method_infoç»“æž„ä½“çš„å®šä¹‰ å¯¹äºŽä¸€ä¸ªæ–¹æ³•çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬æ ¹æ®æˆ‘ä»¬å¯ä»¥æ¦‚æ‹¬çš„ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š å®žé™…ä¸ŠJVMè¿˜ä¼šå¯¹methodæ–¹æ³•çš„æè¿°æ·»åŠ å…¶ä»–ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†åœ¨åŽé¢è¯¦ç»†è®¨è®ºã€‚å¦‚ä¸Šå›¾ä¸­çš„method_infoç»“æž„ä½“çš„å®šä¹‰ï¼Œè¯¥ç»“æž„ä½“çš„å®šä¹‰è·Ÿæè¿°fieldå­—æ®µ çš„field_infoç»“æž„ä½“çš„ç»“æž„å‡ ä¹Žå®Œå…¨ä¸€è‡´,å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ–¹æ³•è¡¨çš„ç»“æž„ä½“ç”±ï¼šè®¿é—®æ ‡å¿—(access_flags)ã€åç§°ç´¢å¼•(name_index)ã€æè¿°ç´¢å¼•(descriptor_index)ã€å±žæ€§è¡¨(attribute_info)é›†åˆç»„æˆã€‚ è®¿é—®æ ‡å¿—(access_flags)ï¼š method_infoç»“æž„ä½“æœ€å‰é¢çš„ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºçš„è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ï¼Œè®°å½•è¿™è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨åŸŸã€é™æ€oréžé™æ€ã€å¯å˜æ€§ã€æ˜¯å¦å¯åŒæ­¥ã€æ˜¯å¦æœ¬åœ°æ–¹æ³•ã€æ˜¯å¦æŠ½è±¡ç­‰ä¿¡æ¯ï¼Œå®žé™…ä¸Šä¸æ­¢è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬åŽé¢ä¼šè¯¦ç»†ä»‹ç»è®¿é—®æ ‡å¿—è¿™ä¸¤ä¸ªå­—èŠ‚çš„æ¯ä¸€ä½å…·ä½“è¡¨ç¤ºä»€ä¹ˆæ„æ€ã€‚ åç§°ç´¢å¼•(name_index)ï¼š ç´§è·Ÿåœ¨è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰åŽé¢çš„ä¸¤ä¸ªå­—èŠ‚ç§°ä¸ºåç§°ç´¢å¼•ï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚ä¸­çš„å€¼æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„æŸä¸€ä¸ªå¸¸é‡æ± é¡¹ï¼Œè¿™ä¸ªæ–¹æ³•çš„åç§°ä»¥UTF-8æ ¼å¼çš„å­—ç¬¦ä¸²å­˜å‚¨åœ¨è¿™ä¸ªå¸¸é‡æ± é¡¹ä¸­ã€‚å¦‚public void methodName(),å¾ˆæ˜¾ç„¶ï¼Œâ€œmethodNameâ€åˆ™è¡¨ç¤ºç€è¿™ä¸ªæ–¹æ³•çš„åç§°ï¼Œé‚£ä¹ˆåœ¨å¸¸é‡æ± ä¸­ä¼šæœ‰ä¸€ä¸ªCONSTANT_Utf8_infoæ ¼å¼çš„å¸¸é‡æ± é¡¹ï¼Œé‡Œé¢å­˜å‚¨ç€â€œmethodNameâ€å­—ç¬¦ä¸²ï¼Œè€ŒmehodName()æ–¹æ³•çš„æ–¹æ³•è¡¨ä¸­çš„åç§°ç´¢å¼•åˆ™æŒ‡å‘äº†è¿™ä¸ªå¸¸é‡æ± é¡¹ã€‚ æè¿°ç´¢å¼•(descriptor_index)ï¼š æè¿°ç´¢å¼•è¡¨ç¤ºçš„æ˜¯è¿™ä¸ªæ–¹æ³•çš„ç‰¹å¾æˆ–è€…è¯´æ˜¯ç­¾åï¼Œä¸€ä¸ªæ–¹æ³•ä¼šæœ‰è‹¥å¹²ä¸ªå‚æ•°å’Œè¿”å›žå€¼ï¼Œè€Œè‹¥å¹²ä¸ªå‚æ•°çš„æ•°æ®ç±»åž‹å’Œè¿”å›žå€¼çš„æ•°æ®ç±»åž‹æž„æˆäº†è¿™ä¸ªæ–¹æ³•çš„æè¿°ï¼Œå…¶åŸºæœ¬æ ¼å¼ä¸ºï¼š (å‚æ•°æ•°æ®ç±»åž‹æè¿°åˆ—è¡¨)è¿”å›žå€¼æ•°æ®ç±»åž‹ ã€‚æˆ‘ä»¬å°†åœ¨åŽé¢ç»§ç»­è®¨è®ºã€‚ å±žæ€§è¡¨(attribute_info)é›†åˆï¼š è¿™ä¸ªå±žæ€§è¡¨é›†åˆéžå¸¸é‡è¦ï¼Œæ–¹æ³•çš„å®žçŽ°è¢«JVMç¼–è¯‘æˆJVMçš„æœºå™¨ç æŒ‡ä»¤ï¼Œæœºå™¨ç æŒ‡ä»¤å°±å­˜æ”¾åœ¨ä¸€ä¸ªCodeç±»åž‹çš„å±žæ€§è¡¨ä¸­ï¼›å¦‚æžœæ–¹æ³•å£°æ˜Žè¦æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå¼‚å¸¸ä¿¡æ¯ä¼šåœ¨ä¸€ä¸ªExceptionsç±»åž‹çš„å±žæ€§è¡¨ä¸­äºˆä»¥å±•çŽ°ã€‚Codeç±»åž‹çš„å±žæ€§è¡¨å¯ä»¥è¯´æ˜¯éžå¸¸å¤æ‚çš„å†…å®¹ï¼Œä¹Ÿæ˜¯æœ¬æ–‡æœ€éš¾çš„åœ°æ–¹ã€‚ 4. è®¿é—®æ ‡å¿—(access_flags)â€”è®°å½•ç€methodæ–¹æ³•çš„è®¿é—®ä¿¡æ¯ è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰å…±å æœ‰2 ä¸ªå­—èŠ‚ï¼Œåˆ†ä¸º 16 ä½ï¼Œè¿™ 16ä½ è¡¨ç¤ºçš„å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š ä¸¾ä¾‹ï¼šæŸä¸ªç±»ä¸­å®šä¹‰äº†å¦‚ä¸‹æ–¹æ³•ï¼š 12public static synchronized final void greeting()&#123; &#125; greeting()æ–¹æ³•çš„ä¿®é¥°ç¬¦æœ‰ï¼špublicã€staticã€synchronizedã€final è¿™å‡ ä¸ªä¿®é¥°ç¬¦ä¿®é¥°ï¼Œé‚£ä¹ˆç›¸å¯¹åº”åœ°ï¼Œgreeting()æ–¹æ³•çš„è®¿é—®æ ‡å¿—ä¸­çš„ACC_PUBLICã€ACC_STATICã€ACC_SYNCHRONIZEDã€ACC_FINALæ ‡å¿—ä½éƒ½åº”è¯¥æ˜¯1ï¼Œå³ï¼š ä»Žä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºè®¿é—®æ ‡å¿—çš„å€¼åº”è¯¥æ˜¯äºŒè¿›åˆ¶00000000 00111001,å³åå…­è¿›åˆ¶0x0039ã€‚æˆ‘ä»¬å°†åœ¨æ–‡ç« çš„æœ€åŽä¸€ä¸ªä¾‹å­ä¸­è¯å®žè¿™ç‚¹ã€‚ 5. åç§°ç´¢å¼•å’Œæè¿°ç¬¦ç´¢å¼•----ä¸€ä¸ªæ–¹æ³•çš„ç­¾å ç´§æŽ¥ç€è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰åŽé¢çš„ä¸¤ä¸ªå­—èŠ‚ï¼Œå«åšåç§°ç´¢å¼•(name_index)ï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚ä¸­çš„å€¼æ˜¯æŒ‡å‘äº†å¸¸é‡æ± ä¸­æŸä¸ªå¸¸é‡æ± é¡¹çš„ç´¢å¼•ï¼Œè¯¥å¸¸é‡æ± é¡¹è¡¨ç¤ºè¿™è¿™ä¸ªæ–¹æ³•åç§°çš„å­—ç¬¦ä¸²ã€‚ æ–¹æ³•æè¿°ç¬¦ç´¢å¼•(descrptor_index)æ˜¯ç´§è·Ÿåœ¨åç§°ç´¢å¼•åŽé¢çš„ä¸¤ä¸ªå­—èŠ‚ï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚ä¸­çš„å€¼è·Ÿåç§°ç´¢å¼•ä¸­çš„å€¼æ€§è´¨ä¸€æ ·ï¼Œéƒ½æ˜¯æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„æŸä¸ªå¸¸é‡æ± é¡¹ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ä¸­çš„æŒ‡å‘çš„å¸¸é‡æ± é¡¹ï¼Œæ˜¯è¡¨ç¤ºäº†æ–¹æ³•æè¿°ç¬¦çš„å­—ç¬¦ä¸²ã€‚ æ‰€è°“çš„æ–¹æ³•æè¿°ç¬¦ï¼Œå®žè´¨ä¸Šå°±æ˜¯æŒ‡ç”¨ä¸€ä¸ªä»€ä¹ˆæ ·çš„å­—ç¬¦ä¸²æ¥æè¿°ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•æè¿°ç¬¦çš„ç»„æˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸¾ä¾‹ï¼šå¯¹äºŽå¦‚ä¸‹å®šä¹‰çš„çš„greeting()æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„method_infoç»“æž„ä½“ä¸­çš„åç§°ç´¢å¼•å’Œæè¿°ç¬¦ç´¢å¼•ä¿¡æ¯æ˜¯æ€Žæ ·ç»„ç»‡çš„ã€‚ 12public static synchronized final void greeting()&#123; &#125; å¦‚ä¸‹å›¾æ‰€ç¤º,method_infoç»“æž„ä½“çš„åç§°ç´¢å¼•ä¸­å­˜å‚¨äº†ä¸€ä¸ªç´¢å¼•å€¼xï¼ŒæŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬xé¡¹ï¼Œç¬¬ xé¡¹è¡¨ç¤ºçš„æ˜¯å­—ç¬¦ä¸²&quot;greeting&quot;,å³è¡¨ç¤ºè¯¥æ–¹æ³•åç§°æ˜¯&quot;greeting&quot;ï¼›æè¿°ç¬¦ç´¢å¼•ä¸­çš„y å€¼æŒ‡å‘äº†å¸¸é‡æ± çš„ç¬¬yé¡¹ï¼Œè¯¥é¡¹è¡¨ç¤ºå­—ç¬¦ä¸²&quot;()V&quot;ï¼Œå³è¡¨ç¤ºè¯¥æ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œè¿”å›žå€¼æ˜¯voidç±»åž‹ã€‚ 6. å±žæ€§è¡¨é›†åˆâ€“è®°å½•æ–¹æ³•çš„æœºå™¨æŒ‡ä»¤å’ŒæŠ›å‡ºå¼‚å¸¸ç­‰ä¿¡æ¯ å±žæ€§è¡¨é›†åˆè®°å½•äº†æŸä¸ªæ–¹æ³•çš„ä¸€äº›å±žæ€§ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬ï¼š è¿™ä¸ªæ–¹æ³•çš„ä»£ç å®žçŽ°ï¼Œå³æ–¹æ³•çš„å¯æ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤ è¿™ä¸ªæ–¹æ³•å£°æ˜Žçš„è¦æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ è¿™ä¸ªæ–¹æ³•æ˜¯å¦è¢«@deprecatedæ³¨è§£è¡¨ç¤º è¿™ä¸ªæ–¹æ³•æ˜¯å¦æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ å±žæ€§è¡¨ï¼ˆattribute_infoï¼‰ç»“æž„ä½“çš„ä¸€èˆ¬ç»“æž„å¦‚ä¸‹æ‰€ç¤ºï¼š ä¿®æ­£ï¼šå±žæ€§é•¿åº¦ä¸º4ä¸ªå­—èŠ‚ã€‚ 6.1 Codeç±»åž‹çš„å±žæ€§è¡¨â€“methodæ–¹æ³•ä¸­çš„æœºå™¨æŒ‡ä»¤çš„ä¿¡æ¯ Codeç±»åž‹çš„å±žæ€§è¡¨(attribute_info)å¯ä»¥è¯´æ˜¯classæ–‡ä»¶ä¸­æœ€ä¸ºé‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒåŒ…å«çš„æ˜¯JVMå¯ä»¥è¿è¡Œçš„æœºå™¨ç æŒ‡ä»¤ï¼ŒJVMèƒ½å¤Ÿè¿è¡Œè¿™ä¸ªç±»ï¼Œå°±æ˜¯ä»Žè¿™ä¸ªå±žæ€§ä¸­å–å‡ºæœºå™¨ç çš„ã€‚é™¤äº†è¦æ‰§è¡Œçš„æœºå™¨ç ï¼Œå®ƒè¿˜åŒ…å«äº†ä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Codeå±žæ€§è¡¨çš„ç»„æˆéƒ¨åˆ†ï¼š æœºå™¨æŒ‡ä»¤----codeï¼š ç›®å‰çš„JVMä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºæœºå™¨æ“ä½œç ï¼Œå³å¯¹JVMåº•å±‚è€Œè¨€ï¼Œå®ƒèƒ½è¡¨ç¤ºçš„æœºå™¨æ“ä½œç ä¸å¤šäºŽ2çš„ 8 æ¬¡æ–¹ï¼Œå³ 256ä¸ªã€‚classæ–‡ä»¶ä¸­çš„æœºå™¨æŒ‡ä»¤éƒ¨åˆ†æ˜¯classæ–‡ä»¶ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå¹¶ä¸”éžå¸¸å¤æ‚ï¼Œæœ¬æ–‡çš„é‡ç‚¹ä¸æ­¢ä»‹ç»å®ƒ å¼‚å¸¸å¤„ç†è·³è½¬ä¿¡æ¯â€”exception_tableï¼š å¦‚æžœä»£ç ä¸­å‡ºçŽ°äº†try{}catch{}å—ï¼Œé‚£ä¹ˆtry{}å—å†…çš„æœºå™¨æŒ‡ä»¤çš„åœ°å€èŒƒå›´è®°å½•ä¸‹æ¥ï¼Œå¹¶ä¸”è®°å½•å¯¹åº”çš„catch{}å—ä¸­çš„èµ·å§‹æœºå™¨æŒ‡ä»¤åœ°å€ï¼Œå½“è¿è¡Œæ—¶åœ¨tryå—ä¸­æœ‰å¼‚å¸¸æŠ›å‡ºçš„è¯ï¼ŒJVMä¼šå°†catch{}å—å¯¹åº”æ‡‚å¾—å…¶å®žæœºå™¨æŒ‡ä»¤åœ°å€ä¼ é€’ç»™PCå¯„å­˜å™¨ï¼Œä»Žè€Œå®žçŽ°æŒ‡ä»¤è·³è½¬ï¼› Javaæºç è¡Œå·å’Œæœºå™¨æŒ‡ä»¤çš„å¯¹åº”å…³ç³»â€”LineNumberTableå±žæ€§è¡¨ï¼š ç¼–è¯‘å™¨åœ¨å°†javaæºç ç¼–è¯‘æˆclassæ–‡ä»¶æ—¶ï¼Œä¼šå°†æºç ä¸­çš„è¯­å¥è¡Œå·è·Ÿç¼–è¯‘å¥½çš„æœºå™¨æŒ‡ä»¤å…³è”èµ·æ¥ï¼Œè¿™æ ·çš„classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­å¹¶è¿è¡Œæ—¶ï¼Œå¦‚æžœæŠ›å‡ºå¼‚å¸¸ï¼ŒJVMå¯ä»¥æ ¹æ®è¿™ä¸ªå¯¹åº”å…³ç³»ï¼ŒæŠ›å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œå‘Šè¯‰æˆ‘ä»¬æˆ‘ä»¬çš„æºç çš„å¤šå°‘è¡Œæœ‰é—®é¢˜ï¼Œæ–¹ä¾¿æˆ‘ä»¬å®šä½é—®é¢˜ã€‚è¿™ä¸ªä¿¡æ¯ä¸æ˜¯è¿è¡Œæ—¶å¿…ä¸å¯å°‘çš„ä¿¡æ¯ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆè¿™ä¸€é¡¹ä¿¡æ¯ï¼Œå¦‚æžœä½ é¡¹å–æ¶ˆè¿™ä¸€ä¿¡æ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨-g:none æˆ–-g:linesæ¥å–æ¶ˆæˆ–è€…è¦æ±‚è®¾ç½®è¿™ä¸€é¡¹ä¿¡æ¯ã€‚å¦‚æžœä½¿ç”¨äº†-g:noneæ¥ç”Ÿæˆclassæ–‡ä»¶ï¼Œclassæ–‡ä»¶ä¸­å°†ä¸ä¼šæœ‰LineNumberTableå±žæ€§è¡¨ï¼Œé€ æˆçš„å½±å“å°±æ˜¯ å°†æ¥å¦‚æžœä»£ç æŠ¥é”™ï¼Œå°†æ— æ³•å®šä½é”™è¯¯ä¿¡æ¯æŠ¥é”™çš„è¡Œï¼Œå¹¶ä¸”å¦‚æžœé¡¹è°ƒè¯•ä»£ç ï¼Œå°†ä¸èƒ½åœ¨æ­¤ç±»ä¸­æ‰“æ–­ç‚¹ï¼ˆå› ä¸ºæ²¡æœ‰æŒ‡å®šè¡Œå·ã€‚ï¼‰ å±€éƒ¨å˜é‡è¡¨æè¿°ä¿¡æ¯----LocalVariableTableå±žæ€§è¡¨ï¼š å±€éƒ¨å˜é‡è¡¨ä¿¡æ¯ä¼šè®°å½•æ ˆå¸§å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡å’Œjavaæºç ä¸­å®šä¹‰çš„å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œè¿™ä¸ªä¿¡æ¯ä¸æ˜¯è¿è¡Œæ—¶å¿…é¡»çš„å±žæ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šç”Ÿæˆåˆ°classæ–‡ä»¶ä¸­ã€‚ä½ å¯ä»¥æ ¹æ®javacæŒ‡ä»¤çš„-g:noneæˆ–è€…-g:varsé€‰é¡¹æ¥å–æ¶ˆæˆ–è€…è®¾ç½®è¿™ä¸€é¡¹ä¿¡æ¯ã€‚ å®ƒæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ å½“æˆ‘ä»¬ä½¿ç”¨IDEè¿›è¡Œå¼€å‘æ—¶ï¼Œæœ€å–œæ¬¢çš„èŽ«è¿‡äºŽå®ƒä»¬çš„ä»£ç æç¤ºåŠŸèƒ½äº†ã€‚å¦‚æžœåœ¨é¡¹ç›®ä¸­å¼•ç”¨åˆ°äº†ç¬¬ä¸‰æ–¹çš„jaråŒ…ï¼Œè€Œç¬¬ä¸‰æ–¹çš„åŒ…ä¸­çš„classæ–‡ä»¶ä¸­æœ‰æ— LocalVariableTableå±žæ€§è¡¨çš„åŒºåˆ«å¦‚ä¸‹æ‰€ç¤ºï¼š Codeå±žæ€§è¡¨ç»“æž„ä½“çš„è§£é‡Šï¼š attribute_name_index,å±žæ€§åç§°ç´¢å¼•ï¼Œå æœ‰2ä¸ªå­—èŠ‚ï¼Œå…¶å†…çš„å€¼æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„æŸä¸€é¡¹ï¼Œè¯¥é¡¹è¡¨ç¤ºå­—ç¬¦ä¸²â€œCodeâ€; attribute_length,å±žæ€§é•¿åº¦ï¼Œå æœ‰ 4ä¸ªå­—èŠ‚ï¼Œå…¶å†…çš„å€¼è¡¨ç¤ºåŽé¢æœ‰å¤šå°‘ä¸ªå­—èŠ‚æ˜¯å±žäºŽæ­¤Codeå±žæ€§è¡¨çš„ï¼› max_stack,æ“ä½œæ•°æ ˆæ·±åº¦çš„æœ€å¤§å€¼ï¼Œå æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œçš„ä»»æ„æ—¶åˆ»ï¼Œæ“ä½œæ•°æ ˆéƒ½ä¸åº”è¯¥è¶…è¿‡è¿™ä¸ªå€¼ï¼Œè™šæ‹Ÿæœºçš„è¿è¡Œçš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¿™ä¸ªå€¼æ¥è®¾ç½®è¯¥æ–¹æ³•å¯¹åº”çš„æ ˆå¸§(Stack Frame)ä¸­çš„æ“ä½œæ•°æ ˆçš„æ·±åº¦ï¼› max_locals,æœ€å¤§å±€éƒ¨å˜é‡æ•°ç›®ï¼Œå æœ‰ 2ä¸ªå­—èŠ‚ï¼Œå…¶å†…çš„å€¼è¡¨ç¤ºå±€éƒ¨å˜é‡è¡¨æ‰€éœ€è¦çš„å­˜å‚¨ç©ºé—´å¤§å°ï¼› code_length,æœºå™¨æŒ‡ä»¤é•¿åº¦ï¼Œå æœ‰ 4 ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºè·Ÿåœ¨å…¶åŽçš„å¤šå°‘ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ˜¯æœºå™¨æŒ‡ä»¤ï¼› code,æœºå™¨æŒ‡ä»¤åŒºåŸŸï¼Œè¯¥åŒºåŸŸå æœ‰çš„å­—èŠ‚æ•°ç›®ç”± code_lengthä¸­çš„å€¼å†³å®šã€‚JVMæœ€åº•å±‚çš„è¦æ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤å°±å­˜å‚¨åœ¨è¿™é‡Œï¼› exception_table_length,æ˜¾å¼å¼‚å¸¸è¡¨é•¿åº¦ï¼Œå æœ‰2ä¸ªå­—èŠ‚ï¼Œå¦‚æžœåœ¨æ–¹æ³•ä»£ç ä¸­å‡ºçŽ°äº†try{} catch()å½¢å¼çš„ç»“æž„ï¼Œè¯¥å€¼ä¸ä¼šä¸ºç©ºï¼Œç´§è·Ÿå…¶åŽä¼šè·Ÿç€è‹¥å¹²ä¸ªexception_tableç»“æž„ä½“ï¼Œä»¥è¡¨ç¤ºå¼‚å¸¸æ•èŽ·æƒ…å†µï¼› exception_tableï¼Œæ˜¾å¼å¼‚å¸¸è¡¨ï¼Œå æœ‰8 ä¸ªå­—èŠ‚ï¼Œstart_pc,end_pc,handler_pcä¸­çš„å€¼éƒ½è¡¨ç¤ºçš„æ˜¯PCè®¡æ•°å™¨ä¸­çš„æŒ‡ä»¤åœ°å€ã€‚exception_tableè¡¨ç¤ºçš„æ„æ€æ˜¯ï¼šå¦‚æžœå­—èŠ‚ç ä»Žç¬¬start_pcè¡Œåˆ°ç¬¬end_pcè¡Œä¹‹é—´å‡ºçŽ°äº†catch_typeæ‰€æè¿°çš„å¼‚å¸¸ç±»åž‹ï¼Œé‚£ä¹ˆå°†è·³è½¬åˆ°handler_pcè¡Œç»§ç»­å¤„ç†ã€‚ attribute_count,å±žæ€§è®¡æ•°å™¨ï¼Œå æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºCodeå±žæ€§è¡¨çš„å…¶ä»–å±žæ€§çš„æ•°ç›® attribute_info,è¡¨ç¤ºCodeå±žæ€§è¡¨å…·æœ‰çš„å±žæ€§è¡¨ï¼Œå®ƒä¸»è¦åˆ†ä¸ºä¸¤ä¸ªç±»åž‹çš„å±žæ€§è¡¨ï¼šâ€œLineNumberTableâ€ç±»åž‹å’Œâ€œLocalVariableTableâ€ç±»åž‹ã€‚ â€œLineNumberTableâ€ç±»åž‹çš„å±žæ€§è¡¨è®°å½•ç€Javaæºç å’Œæœºå™¨æŒ‡ä»¤ä¹‹é—´çš„å¯¹åº”å…³ç³» â€œLocalVariableTableâ€ç±»åž‹çš„å±žæ€§è¡¨è®°å½•ç€å±€éƒ¨å˜é‡æè¿° ä¸¾ä¾‹ï¼š å¦‚ä¸‹å®šä¹‰Simpleç±»ï¼Œä½¿ç”¨javac -g:none Simple.java ç¼–è¯‘å‡ºSimple.class æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨javap -v Simple &gt; Simple.txt æŸ¥çœ‹åç¼–è¯‘çš„ä¿¡æ¯ï¼Œç„¶åŽçœ‹Simple.classæ–‡ä»¶ä¸­çš„æ–¹æ³•è¡¨é›†åˆæ˜¯æ€Žæ ·ç»„ç»‡çš„ï¼š 12345public class Simple &#123; public static synchronized final void greeting()&#123; int a = 10; &#125; &#125; 1. Simple.classæ–‡ä»¶ç»„ç»‡ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š å¦‚ä¸Šæ‰€ç¤ºï¼Œæ–¹æ³•è¡¨é›†åˆä½¿ç”¨äº†è“è‰²çº¿æ®µåœˆäº†èµ·æ¥ã€‚ è¯·æ³¨æ„ï¼šæ–¹æ³•è¡¨é›†åˆçš„å¤´ä¸¤ä¸ªå­—èŠ‚ï¼Œå³æ–¹æ³•è¡¨è®¡æ•°å™¨ï¼ˆmethod_countï¼‰çš„å€¼æ˜¯0x0002ï¼Œå®ƒè¡¨ç¤ºè¯¥ç±»ä¸­æœ‰2 ä¸ªæ–¹æ³•ã€‚ç»†å¿ƒçš„è¯»è€…ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘ä»¬çš„Simple.javaä¸­å°±å®šä¹‰äº†ä¸€ä¸ªgreeting()æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆclassæ–‡ä»¶ä¸­ä¼šæ˜¾ç¤ºæœ‰ä¸¤ä¸ªæ–¹æ³•å‘¢ï¼Ÿï¼Ÿ JVMä¸ºæ²¡æœ‰æ˜¾å¼å®šä¹‰å®žä¾‹åŒ–æž„é€ æ–¹æ³•çš„ç±»ï¼Œè‡ªåŠ¨ç”Ÿæˆé»˜è®¤çš„å®žä¾‹åŒ–æž„é€ æ–¹æ³•&quot;()&quot; é™¤äº†å®žä¾‹åŒ–æž„é€ æ–¹æ³•ï¼ŒJVMè¿˜ä¼šåœ¨ç‰¹æ®Šçš„æƒ…å†µä¸‹ç”Ÿæˆä¸€ä¸ªå«ç±»æž„é€ æ–¹æ³•&quot;()&quot;ã€‚å¦‚æžœæˆ‘ä»¬åœ¨ç±»ä¸­ä½¿ç”¨åˆ°äº†staticä¿®é¥°çš„ä»£ç å—ï¼Œé‚£ä¹ˆï¼ŒJVMä¼šåœ¨classæ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ªâ€œ()â€æž„é€ æ–¹æ³•ã€‚å…³äºŽå®ƒä»¬çš„å…·ä½“ç»†èŠ‚ï¼Œæˆ‘å°†åœ¨åŽç»­çš„æ–‡ç« ä¸­è¯¦ç»†è®¨è®ºï¼Œåœ¨è¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚ Simple.class ä¸­çš„() æ–¹æ³•: è§£é‡Šï¼š æ–¹æ³•è®¿é—®æ ‡å¿—(access_flags)ï¼š å æœ‰ 2ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0001,å³æ ‡å¿—ä½çš„ç¬¬ 16 ä½ä¸º 1ï¼Œæ‰€ä»¥è¯¥()æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯ï¼šACC_PUBLIC; åç§°ç´¢å¼•(name_index)ï¼š å æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º 0x0004ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç¬¬ 4é¡¹ï¼Œè¯¥é¡¹è¡¨ç¤ºå­—ç¬¦ä¸²â€œâ€ï¼Œå³è¯¥æ–¹æ³•çš„åç§°æ˜¯â€œâ€; æè¿°ç¬¦ç´¢å¼•(descriptor_index): å æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0005,æŒ‡å‘å¸¸é‡æ± çš„ç¬¬ 5 é¡¹ï¼Œè¯¥é¡¹è¡¨ç¤ºå­—ç¬¦ä¸²â€œ()Vâ€ï¼Œå³è¡¨ç¤ºè¯¥æ–¹æ³•ä¸å¸¦å‚æ•°ï¼Œå¹¶ä¸”æ— è¿”å›žå€¼ï¼ˆæž„é€ å‡½æ•°ç¡®å®žä¹Ÿæ²¡æœ‰è¿”å›žå€¼ï¼‰ï¼› å±žæ€§è®¡æ•°å™¨ï¼ˆattribute_count): å æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0001,è¡¨ç¤ºè¯¥æ–¹æ³•è¡¨ä¸­å«æœ‰ä¸€ä¸ªå±žæ€§è¡¨ï¼ŒåŽé¢ä¼šç´§è·Ÿç€ä¸€ä¸ªå±žæ€§è¡¨ï¼› å±žæ€§è¡¨çš„åç§°ç´¢å¼•(attribute_name_index)ï¼šå æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0006,æŒ‡å‘å¸¸é‡æ± ä¸­çš„ç¬¬6 é¡¹ï¼Œè¯¥é¡¹è¡¨ç¤ºå­—ç¬¦ä¸²â€œCodeâ€ï¼Œè¡¨ç¤ºè¿™ä¸ªå±žæ€§è¡¨æ˜¯Codeç±»åž‹çš„å±žæ€§è¡¨ï¼› å±žæ€§é•¿åº¦ï¼ˆattribute_lengthï¼‰ï¼šå æœ‰4ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0000 0011ï¼Œå³åè¿›åˆ¶çš„ 17ï¼Œè¡¨æ˜ŽåŽç»­çš„ 17 ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤ºè¿™ä¸ªCodeå±žæ€§è¡¨çš„å±žæ€§ä¿¡æ¯ï¼› æ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ï¼ˆmax_stackï¼‰ï¼šå æœ‰2ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0001,è¡¨ç¤ºæ ˆå¸§ä¸­æ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦æ˜¯1ï¼› å±€éƒ¨å˜é‡è¡¨çš„æœ€å¤§å®¹é‡ï¼ˆmax_variableï¼‰ï¼šå æœ‰2ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0001, JVMåœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œæ ¹æ®è¿™ä¸ªå€¼è®¾ç½®æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ï¼› æœºå™¨æŒ‡ä»¤æ•°ç›®(code_length)ï¼šå æœ‰4ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0000 0005,è¡¨ç¤ºåŽç»­çš„5 ä¸ªå­—èŠ‚ 0x2A ã€0xB7ã€ 0x00ã€0x01ã€0xB1è¡¨ç¤ºæœºå™¨æŒ‡ä»¤; æœºå™¨æŒ‡ä»¤é›†(code[code_length])ï¼šè¿™é‡Œå…±æœ‰ 5ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x2A ã€0xB7ã€ 0x00ã€0x01ã€0xB1ï¼› æ˜¾å¼å¼‚å¸¸è¡¨é›†åˆï¼ˆexception_table_countï¼‰ï¼š å æœ‰2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0000,è¡¨ç¤ºæ–¹æ³•ä¸­æ²¡æœ‰éœ€è¦å¤„ç†çš„å¼‚å¸¸ä¿¡æ¯ï¼› Codeå±žæ€§è¡¨çš„å±žæ€§è¡¨é›†åˆï¼ˆattribute_countï¼‰ï¼š å æœ‰2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0000ï¼Œè¡¨ç¤ºå®ƒæ²¡æœ‰å…¶ä»–çš„å±žæ€§è¡¨é›†åˆï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†-g:none ç¦æ­¢ç¼–è¯‘å™¨ç”ŸæˆCodeå±žæ€§è¡¨çš„ LineNumberTable å’ŒLocalVariableTable; B. Simple.class ä¸­çš„greeting() æ–¹æ³•: è§£é‡Šï¼š æ–¹æ³•è®¿é—®æ ‡å¿—(access_flags)ï¼š å æœ‰ 2ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º 0x0039 ,å³äºŒè¿›åˆ¶çš„00000000 00111001,å³æ ‡å¿—ä½çš„ç¬¬11ã€12ã€13ã€16ä½ä¸º1ï¼Œæ ¹æ®ä¸Šé¢è®²çš„æ–¹æ³•æ ‡å¿—ä½çš„è¡¨ç¤ºï¼Œå¯ä»¥å¾—åˆ°è¯¥greeting()æ–¹æ³•çš„ä¿®é¥°ç¬¦æœ‰ï¼šACC_SYNCHRONIZEDã€ACC_FINALã€ACC_STATICã€ACC_PUBLIC; åç§°ç´¢å¼•(name_index)ï¼š å æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º 0x0007ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„ç¬¬ 7 é¡¹ï¼Œè¯¥é¡¹è¡¨ç¤ºå­—ç¬¦ä¸²â€œgreetingâ€ï¼Œå³è¯¥æ–¹æ³•çš„åç§°æ˜¯â€œgreetingâ€; æè¿°ç¬¦ç´¢å¼•(descriptor_index): å æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0005,æŒ‡å‘å¸¸é‡æ± çš„ç¬¬ 5 é¡¹ï¼Œè¯¥é¡¹è¡¨ç¤ºå­—ç¬¦ä¸²â€œ()Vâ€ï¼Œå³è¡¨ç¤ºè¯¥æ–¹æ³•ä¸å¸¦å‚æ•°ï¼Œå¹¶ä¸”æ— è¿”å›žå€¼ï¼› å±žæ€§è®¡æ•°å™¨ï¼ˆattribute_count): å æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0001,è¡¨ç¤ºè¯¥æ–¹æ³•è¡¨ä¸­å«æœ‰ä¸€ä¸ªå±žæ€§è¡¨ï¼ŒåŽé¢ä¼šç´§è·Ÿç€ä¸€ä¸ªå±žæ€§è¡¨ï¼› å±žæ€§è¡¨çš„åç§°ç´¢å¼•(attribute_name_index)ï¼šå æœ‰ 2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0006,æŒ‡å‘å¸¸é‡æ± ä¸­çš„ç¬¬6 é¡¹ï¼Œè¯¥é¡¹è¡¨ç¤ºå­—ç¬¦ä¸²â€œCodeâ€ï¼Œè¡¨ç¤ºè¿™ä¸ªå±žæ€§è¡¨æ˜¯Codeç±»åž‹çš„å±žæ€§è¡¨ï¼› å±žæ€§é•¿åº¦ï¼ˆattribute_lengthï¼‰ï¼šå æœ‰4ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0000 0010ï¼Œå³åè¿›åˆ¶çš„16ï¼Œè¡¨æ˜ŽåŽç»­çš„16ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤ºè¿™ä¸ªCodeå±žæ€§è¡¨çš„å±žæ€§ä¿¡æ¯ï¼› æ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ï¼ˆmax_stackï¼‰ï¼šå æœ‰2ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0001,è¡¨ç¤ºæ ˆå¸§ä¸­æ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦æ˜¯1ï¼› å±€éƒ¨å˜é‡è¡¨çš„æœ€å¤§å®¹é‡ï¼ˆmax_variableï¼‰ï¼šå æœ‰2ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0001, JVMåœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œæ ¹æ®è¿™ä¸ªå€¼è®¾ç½®æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ï¼› æœºå™¨æŒ‡ä»¤æ•°ç›®(code_length)ï¼šå æœ‰4 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0000 0004,è¡¨ç¤ºåŽç»­çš„4ä¸ªå­—èŠ‚0x10ã€ 0x0Aã€ 0x3Bã€0xB1çš„æ˜¯è¡¨ç¤ºæœºå™¨æŒ‡ä»¤; æœºå™¨æŒ‡ä»¤é›†(code[code_length])ï¼šè¿™é‡Œå…±æœ‰4 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x10ã€ 0x0Aã€ 0x3Bã€0xB1 ï¼› æ˜¾å¼å¼‚å¸¸è¡¨é›†åˆï¼ˆexception_table_countï¼‰ï¼š å æœ‰2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0000,è¡¨ç¤ºæ–¹æ³•ä¸­æ²¡æœ‰éœ€è¦å¤„ç†çš„å¼‚å¸¸ä¿¡æ¯ï¼› Codeå±žæ€§è¡¨çš„å±žæ€§è¡¨é›†åˆï¼ˆattribute_countï¼‰ï¼š å æœ‰2 ä¸ªå­—èŠ‚ï¼Œå€¼ä¸º0x0000ï¼Œè¡¨ç¤ºå®ƒæ²¡æœ‰å…¶ä»–çš„å±žæ€§è¡¨é›†åˆï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†-g:none ç¦æ­¢ç¼–è¯‘å™¨ç”ŸæˆCodeå±žæ€§è¡¨çš„ LineNumberTable å’ŒLocalVariableTable; 6.2 Exceptionsç±»åž‹çš„å±žæ€§è¡¨----methodæ–¹æ³•å£°æ˜Žçš„è¦æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ æœ‰äº›æ–¹æ³•åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œä¼šå£°æ˜Žè¯¥æ–¹æ³•ä¼šæŠ›å‡ºä»€ä¹ˆç±»åž‹çš„å¼‚å¸¸ï¼Œå¦‚ä¸‹å®šä¹‰ä¸€ä¸ªInterfaceæŽ¥å£ï¼Œå®ƒå£°æ˜Žäº†sayHello()æ–¹æ³•ï¼ŒæŠ›å‡ºExceptionå¼‚å¸¸ï¼š 123public interface Interface &#123; public void sayHello() throws Exception; &#125; çŽ°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹Exceptionsç±»åž‹çš„å±žæ€§è¡¨(attribute_info)ç»“æž„ä½“æ˜¯æ€Žæ ·ç»„ç»‡çš„ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒExceptionsç±»åž‹çš„å±žæ€§è¡¨(attribute_info)ç»“æž„ä½“ç”±ä¸€ä¸‹å…ƒç´ ç»„æˆï¼š å±žæ€§åç§°ç´¢å¼•(attribute_name_index)ï¼šå æœ‰ 2ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­çš„å€¼æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„è¡¨ç¤º&quot;Exceptions&quot;å­—ç¬¦ä¸²çš„å¸¸é‡æ± é¡¹ï¼› å±žæ€§é•¿åº¦(attribute_length)ï¼šå®ƒæ¯”è¾ƒç‰¹æ®Šï¼Œå æœ‰4ä¸ªå­—èŠ‚ï¼Œå®ƒçš„å€¼è¡¨ç¤ºè·Ÿåœ¨å…¶åŽé¢å¤šå°‘ä¸ªå­—èŠ‚è¡¨ç¤ºå¼‚å¸¸ä¿¡æ¯ï¼› å¼‚å¸¸æ•°é‡(number_of_exceptions)ï¼šå æœ‰2 ä¸ªå­—èŠ‚ï¼Œå®ƒçš„å€¼è¡¨ç¤ºæ–¹æ³•å£°æ˜ŽæŠ›å‡ºäº†å¤šå°‘ä¸ªå¼‚å¸¸ï¼Œå³è¡¨ç¤ºè·Ÿåœ¨å…¶åŽæœ‰å¤šå°‘ä¸ªå¼‚å¸¸åç§°ç´¢å¼•ï¼› å¼‚å¸¸åç§°ç´¢å¼•(exceptions_index_table)ï¼šå æœ‰2ä¸ªå­—èŠ‚ï¼Œå®ƒçš„å€¼æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„æŸä¸€é¡¹ï¼Œè¯¥é¡¹æ˜¯ä¸€ä¸ªCONSTANT_Class_infoç±»åž‹çš„é¡¹ï¼Œè¡¨ç¤ºè¿™ä¸ªå¼‚å¸¸çš„å®Œå…¨é™å®šåç§°ï¼› Exceptionsç±»åž‹çš„å±žæ€§è¡¨çš„é•¿åº¦è®¡ç®— å¦‚æžœæŸä¸ªæ–¹æ³•å®šä¹‰ä¸­ï¼Œæ²¡æœ‰å£°æ˜ŽæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•çš„æ–¹æ³•è¡¨(method_info)ç»“æž„ä½“ä¸­çš„å±žæ€§è¡¨é›†åˆä¸­ä¸ä¼šæœ‰Exceptionsç±»åž‹çš„å±žæ€§è¡¨ï¼›æ¢å¥è¯è¯´ï¼Œå¦‚æžœæ–¹æ³•å£°æ˜Žäº†è¦æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæ–¹æ³•è¡¨(method_info)ç»“æž„ä½“ä¸­çš„å±žæ€§è¡¨é›†åˆä¸­å¿…ç„¶ä¼šæœ‰Exceptionsç±»åž‹çš„å±žæ€§è¡¨ï¼Œå¹¶ä¸”è¯¥å±žæ€§è¡¨ä¸­çš„å¼‚å¸¸æ•°é‡ä¸å°äºŽ1ã€‚ æˆ‘ä»¬å‡è®¾å¼‚å¸¸æ•°é‡ä¸­çš„å€¼ä¸º Nï¼Œé‚£ä¹ˆåŽé¢çš„å¼‚å¸¸åç§°ç´¢å¼•çš„æ•°é‡å°±ä¸ºNï¼Œå®ƒä»¬æ€»å…±å æœ‰çš„å­—èŠ‚æ•°ä¸ºN*2ï¼Œè€Œå¼‚å¸¸æ•°é‡å æœ‰2ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°†æœ‰ä¸‹é¢çš„è¿™ä¸ªå…³ç³»å¼ï¼š å±žæ€§é•¿åº¦(attribute_length)ä¸­çš„å€¼= 2 + 2*å¼‚å¸¸æ•°é‡(number_of_exceptions)ä¸­çš„å€¼ Exceptionsç±»åž‹çš„å±žæ€§è¡¨ï¼ˆattribute_infoï¼‰çš„é•¿åº¦=2+4+å±žæ€§é•¿åº¦(attribute_length)ä¸­çš„å€¼ ä¸¾ä¾‹ï¼š å°†ä¸Šé¢å®šä¹‰çš„InterfaceæŽ¥å£ç±»ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œç„¶åŽæˆ‘ä»¬æŸ¥çœ‹Interface.classæ–‡ä»¶ï¼Œæ‰¾å‡ºæ–¹æ³•è¡¨é›†åˆæ‰€åœ¨ä½ç½®å’Œç›¸åº”çš„æ•°æ®ï¼Œå¹¶è¾…åŠ©javap -v Inerface æŸ¥çœ‹ ç”±äºŽsayHello()æ–¹æ³•æ˜¯åœ¨çš„InterfaceæŽ¥å£ç±»ä¸­å£°æ˜Žçš„ï¼Œå®ƒæ²¡æœ‰è¢«å®žçŽ°ï¼Œæ‰€ä»¥å®ƒå¯¹åº”çš„æ–¹æ³•è¡¨(method_info)ç»“æž„ä½“ä¸­çš„å±žæ€§è¡¨é›†åˆä¸­æ²¡æœ‰Codeç±»åž‹çš„å±žæ€§è¡¨ã€‚ æ–¹æ³•è®¡æ•°å™¨ï¼ˆmethods_countï¼‰ä¸­çš„å€¼ä¸º0x0001ï¼Œè¡¨æ˜Žå…¶åŽçš„æ–¹æ³•è¡¨(method_info)å°±ä¸€ä¸ª,å³æˆ‘ä»¬å°±å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶åŽä¼šç´§è·Ÿç€ä¸€ä¸ªæ–¹æ³•è¡¨(method_info)ç»“æž„ä½“ï¼› æ–¹æ³•çš„è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰çš„å€¼æ˜¯0x0401ï¼ŒäºŒè¿›åˆ¶æ˜¯00000100 00000001,ç¬¬6ä½å’Œç¬¬16ä½æ˜¯1ï¼Œå¯¹åº”ä¸Šé¢çš„æ ‡å¿—ä½ä¿¡æ¯ï¼Œå¯ä»¥å¾—å‡ºå®ƒçš„è®¿é—®æ ‡å¿—ç¬¦æœ‰ï¼šACC_ABSTRACTã€ACC_PUBLICã€‚ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘çŽ°ï¼Œåœ¨ä¸Šé¢å£°æ˜Žçš„sayHello()æ–¹æ³•ä¸­å¹¶æ²¡æœ‰å£°æ˜Žä¸ºabstractç±»åž‹å•Šã€‚ç¡®å®žå¦‚æ­¤ï¼Œè¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨å¯¹äºŽæŽ¥å£å†…å£°æ˜Žçš„æ–¹æ³•è‡ªåŠ¨åŠ ä¸ŠACC_ABSTRACTæ ‡å¿—ã€‚ åç§°ç´¢å¼•ï¼ˆname_indexï¼‰ä¸­çš„å€¼ä¸º0x0005ï¼Œ0x0005æŒ‡å‘äº†å¸¸é‡æ± çš„ç¬¬5é¡¹ï¼Œç¬¬äº”é¡¹è¡¨ç¤ºçš„å­—ç¬¦ä¸²ä¸ºâ€œsayHelloâ€ï¼Œå³è¡¨ç¤ºçš„æ–¹æ³•åç§°æ˜¯sayHello æè¿°ç¬¦ç´¢å¼•(descriptor_index)ä¸­çš„å€¼ä¸º0x0006,0x0006æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬6é¡¹ï¼Œç¬¬6é¡¹è¡¨ç¤ºçš„å­—ç¬¦ä¸²ä¸ºâ€œ()Vâ€ è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•çš„æ— å…¥å‚ï¼Œè¿”å›žå€¼ä¸ºvoidç±»åž‹ å±žæ€§è¡¨è®¡æ•°å™¨(attribute_count)ä¸­çš„å€¼ä¸º0x0001,è¡¨ç¤ºåŽé¢çš„å±žæ€§è¡¨çš„ä¸ªæ•°å°±1ä¸ªï¼ŒåŽé¢ç´§è·Ÿç€ä¸€ä¸ªattribute_infoç»“æž„ä½“ï¼› å±žæ€§è¡¨ï¼ˆattribute_infoï¼‰ä¸­çš„å±žæ€§åç§°ç´¢å¼•(attribute_name_index)ä¸­çš„å€¼ä¸º0x0007ï¼Œ0x0007æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬7 é¡¹ï¼Œç¬¬ 7é¡¹æŒ‡å‘å­—ç¬¦ä¸²â€œExceptionsâ€ï¼Œå³è¡¨ç¤ºè¯¥å±žæ€§è¡¨è¡¨ç¤ºçš„å¼‚å¸¸ä¿¡æ¯ï¼› å±žæ€§é•¿åº¦ï¼ˆattribute_lengthï¼‰ä¸­çš„å€¼ä¸ºï¼š0x00000004,å³åŽç»­çš„4ä¸ªå­—èŠ‚å°†ä¼šè¢«è§£æžæˆå±žæ€§å€¼ï¼› å¼‚å¸¸æ•°é‡ï¼ˆnumber_of_exceptionsï¼‰ä¸­çš„å€¼ä¸º0x0001,è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•å£°æ˜ŽæŠ›å‡ºçš„å¼‚å¸¸ä¸ªæ•°æ˜¯1ä¸ªï¼› å¼‚å¸¸åç§°ç´¢å¼•(exception_index_table)ä¸­çš„å€¼ä¸º0x0008,æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬8é¡¹ï¼Œç¬¬8é¡¹è¡¨ç¤ºçš„æ˜¯CONSTANT_Class_infoç±»åž‹çš„å¸¸é‡æ± é¡¹ï¼Œè¡¨ç¤ºâ€œjava/lang/Exceptionâ€ï¼Œå³è¡¨ç¤ºæ­¤æ–¹æ³•æŠ›å‡ºäº†java.lang.Exceptionå¼‚å¸¸ã€‚ 7. IDEä»£ç æç¤ºåŠŸèƒ½å®žçŽ°çš„åŸºæœ¬åŽŸç† æ¯ä¸ªIDEéƒ½æä¾›äº†ä»£ç æç¤ºåŠŸèƒ½ï¼Œå®ƒä»¬å®žçŽ°çš„åŸºæœ¬åŽŸç†å…¶å®žå°±æ˜¯IDEé’ˆå¯¹å®ƒä»¬é¡¹ç›®ä¸‹çš„åŒ…ä¸­æ‰€æœ‰çš„classæ–‡ä»¶è¿›è¡Œå»ºæ¨¡ï¼Œè§£æžå‡ºå®ƒä»¬çš„æ–¹æ³•ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬ä¸€å®šçš„æ¡ä»¶æ—¶ï¼ŒIDEä¼šè‡ªåŠ¨åœ°å°†åˆé€‚æ¡ä»¶çš„æ–¹æ³•åˆ—è¡¨å±•ç¤ºç»™å¼€å‘è€…ï¼Œä¾›å¼€å‘è€…ä½¿ç”¨ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¡¥å……é˜…è¯»4-Classæ–‡ä»¶ä¸­çš„å­—æ®µè¡¨é›†åˆ--fieldå­—æ®µåœ¨classæ–‡ä»¶ä¸­æ˜¯æ€Žæ ·ç»„ç»‡çš„]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E8%A1%A5%E5%85%85%E9%98%85%E8%AF%BB4-Class%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E8%A1%A8%E9%9B%86%E5%90%88--field%E5%AD%97%E6%AE%B5%E5%9C%A8class%E6%96%87%E4%BB%B6%E4%B8%AD%E6%98%AF%E6%80%8E%E6%A0%B7%E7%BB%84%E7%BB%87%E7%9A%84%2F</url>
    <content type="text"><![CDATA[ç»§ç»­è®²classæ–‡ä»¶ä¸­çš„å­—æ®µè¡¨é›†åˆã€‚ 1. å­—æ®µè¡¨é›†åˆæ¦‚è¿° å­—æ®µè¡¨é›†åˆæ˜¯æŒ‡ç”±è‹¥å¹²ä¸ªå­—æ®µè¡¨ï¼ˆfield_infoï¼‰ç»„æˆçš„é›†åˆã€‚å¯¹äºŽåœ¨ç±»ä¸­å®šä¹‰çš„è‹¥å¹²ä¸ªå­—æ®µï¼Œç»è¿‡JVMç¼–è¯‘æˆclassæ–‡ä»¶åŽï¼Œä¼šå°†ç›¸åº”çš„å­—æ®µä¿¡æ¯ç»„ç»‡åˆ°ä¸€ä¸ªå«åšå­—æ®µè¡¨é›†åˆçš„ç»“æž„ä¸­ï¼Œå­—æ®µè¡¨é›†åˆæ˜¯ä¸€ä¸ªç±»æ•°ç»„ç»“æž„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ³¨æ„ï¼šè¿™é‡Œæ‰€è®²çš„å­—æ®µæ˜¯æŒ‡åœ¨ç±»ä¸­å®šä¹‰çš„é™æ€æˆ–è€…éžé™æ€çš„å˜é‡ï¼Œè€Œä¸æ˜¯åœ¨ç±»ä¸­çš„æ–¹æ³•å†…å®šä¹‰çš„å˜é‡ã€‚è¯·æ³¨æ„åŒºåˆ«ã€‚ æ¯”å¦‚ï¼Œå¦‚æžœæŸä¸ªç±»ä¸­å®šä¹‰äº†5ä¸ªå­—æ®µï¼Œé‚£ä¹ˆï¼ŒJVMåœ¨ç¼–è¯‘æ­¤ç±»çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆ5ä¸ªå­—æ®µè¡¨ï¼ˆfield_infoï¼‰ä¿¡æ¯,ç„¶åŽå°†å­—æ®µè¡¨é›†åˆä¸­çš„å­—æ®µè®¡æ•°å™¨çš„å€¼è®¾ç½®æˆ5ï¼Œå°†5ä¸ªå­—æ®µè¡¨ä¿¡æ¯ä¾æ¬¡æ”¾ç½®åˆ°å­—æ®µè®¡æ•°å™¨çš„åŽé¢ã€‚ 2. å­—æ®µè¡¨é›†åˆåœ¨classæ–‡ä»¶ä¸­çš„ä½ç½® å­—æ®µè¡¨é›†åˆç´§è·Ÿåœ¨classæ–‡ä»¶çš„æŽ¥å£ç´¢å¼•é›†åˆç»“æž„çš„åŽé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3. Javaä¸­çš„ä¸€ä¸ªFieldå­—æ®µåº”è¯¥åŒ…å«é‚£äº›ä¿¡æ¯ï¼Ÿ------å­—æ®µè¡¨field_infoç»“æž„ä½“çš„å®šä¹‰ é’ˆå¯¹ä¸Šè¿°çš„å­—æ®µè¡¨ç¤ºï¼ŒJVMè™šæ‹Ÿæœºè§„èŒƒè§„å®šäº†field_infoç»“æž„ä½“æ¥æè¿°å­—æ®µï¼Œå…¶è¡¨ç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š ä¸‹é¢æˆ‘å°†ä¸€ä¸€è®²è§£FIeld_infoçš„ç»„æˆå…ƒç´ ï¼šè®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ã€åç§°ç´¢å¼•ï¼ˆname_indexï¼‰ã€æè¿°ç´¢å¼•ï¼ˆdescriptor_indexï¼‰ã€å±žæ€§è¡¨é›†åˆ 4. fieldå­—æ®µçš„è®¿é—®æ ‡å¿— å¦‚ä¸Šå›¾æ‰€ç¤ºå®šä¹‰çš„field_infoç»“æž„ä½“ï¼Œfieldå­—æ®µçš„è®¿é—®æ ‡å¿—(access_flags)å æœ‰ä¸¤ä¸ªå­—èŠ‚ï¼Œå®ƒèƒ½å¤Ÿè¡¨è¿°çš„ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼š ä¸¾ä¾‹ï¼šå¦‚æžœæˆ‘ä»¬åœ¨æŸä¸ªç±»ä¸­æœ‰å®šä¹‰fieldåŸŸï¼šprivate static String str;ï¼Œé‚£ä¹ˆåœ¨è®¿é—®æ ‡å¿—ä¸Šï¼Œç¬¬15ä½ACC_PRIVATEå’Œç¬¬13ä½ACC_STATICæ ‡å¿—ä½éƒ½åº”è¯¥ä¸º1ã€‚fieldåŸŸstrçš„è®¿é—®æ ‡å¿—ä¿¡æ¯åº”è¯¥æ˜¯å¦‚ä¸‹æ‰€ç¤ºï¼š 5. å­—æ®µçš„æ•°æ®ç±»åž‹è¡¨ç¤ºå’Œå­—æ®µåç§°è¡¨ç¤º classæ–‡ä»¶å¯¹æ•°æ®ç±»åž‹çš„è¡¨ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š fieldå­—æ®µåç§°ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå½¢å¦‚private static String strçš„fieldå­—æ®µï¼Œå…¶ä¸­&quot;str&quot;å°±æ˜¯è¿™ä¸ªå­—æ®µçš„åç§°ã€‚ classæ–‡ä»¶å°†å­—æ®µåç§°å’Œfieldå­—æ®µçš„æ•°æ®ç±»åž‹è¡¨ç¤ºä½œä¸ºå­—ç¬¦ä¸²å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚åœ¨field_infoç»“æž„ä½“ä¸­ï¼Œç´§æŽ¥ç€è®¿é—®æ ‡å¿—çš„ï¼Œå°±æ˜¯å­—æ®µåç§°ç´¢å¼•å’Œå­—æ®µæè¿°ç¬¦ç´¢å¼•ï¼Œå®ƒä»¬åˆ†åˆ«å æœ‰ä¸¤ä¸ªå­—èŠ‚ï¼Œå…¶å†…éƒ¨å­˜å‚¨çš„æ˜¯æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„æŸä¸ªå¸¸é‡æ± é¡¹çš„ç´¢å¼•ï¼Œå¯¹åº”çš„å¸¸é‡æ± é¡¹ä¸­å­˜å‚¨çš„å­—ç¬¦ä¸²ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥å­—æ®µçš„åç§°å’Œå­—æ®µæè¿°ç¬¦ã€‚ 6. å±žæ€§è¡¨é›†åˆ-----é™æ€fieldå­—æ®µçš„åˆå§‹åŒ– åœ¨å®šä¹‰fieldå­—æ®µçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šå¾ˆè‡ªç„¶åœ°å¯¹fieldå­—æ®µç›´æŽ¥èµ‹å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12public static final int MAX=100; public int count=0; å¯¹äºŽè™šæ‹Ÿæœºè€Œè¨€ï¼Œä¸Šè¿°çš„ä¸¤ä¸ªfieldå­—æ®µèµ‹å€¼çš„æ—¶æœºæ˜¯ä¸åŒçš„ï¼š å¯¹äºŽéžé™æ€ï¼ˆå³æ— staticä¿®é¥°ï¼‰çš„fieldå­—æ®µçš„èµ‹å€¼å°†ä¼šå‡ºçŽ°åœ¨å®žä¾‹æž„é€ æ–¹æ³•()ä¸­ å¯¹äºŽé™æ€çš„fieldå­—æ®µï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š1ã€åœ¨é™æ€æž„é€ æ–¹æ³•()ä¸­è¿›è¡Œï¼›2 ã€ä½¿ç”¨ConstantValueå±žæ€§è¿›è¡Œèµ‹å€¼ Sun javacç¼–è¯‘å™¨å¯¹äºŽé™æ€fieldå­—æ®µçš„åˆå§‹åŒ–èµ‹å€¼ç­–ç•¥ï¼š å¦‚æžœä½¿ç”¨finalå’ŒstaticåŒæ—¶ä¿®é¥°ä¸€ä¸ªfieldå­—æ®µï¼Œå¹¶ä¸”è¿™ä¸ªå­—æ®µæ˜¯åŸºæœ¬ç±»åž‹æˆ–è€…Stringç±»åž‹çš„ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™ä¸ªå­—æ®µçš„æ—¶å€™ï¼Œä¼šåœ¨å¯¹åº”çš„field_infoç»“æž„ä½“ä¸­å¢žåŠ ä¸€ä¸ªConstantValueç±»åž‹çš„ç»“æž„ä½“ï¼Œåœ¨èµ‹å€¼çš„æ—¶å€™ä½¿ç”¨è¿™ä¸ªConstantValueè¿›è¡Œèµ‹å€¼ï¼› å¦‚æžœè¯¥fieldå­—æ®µå¹¶æ²¡æœ‰è¢«finalä¿®é¥°ï¼Œæˆ–è€…ä¸æ˜¯åŸºæœ¬ç±»åž‹æˆ–è€…Stringç±»åž‹ï¼Œé‚£ä¹ˆå°†åœ¨ç±»æž„é€ æ–¹æ³•()ä¸­èµ‹å€¼ã€‚ å¯¹äºŽä¸Šè¿°çš„public static final init MAX=100ï¼š javacç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ­¤fieldå­—æ®µæž„å»ºfield_infoç»“æž„ä½“æ—¶ï¼Œé™¤äº†è®¿é—®æ ‡å¿—ã€åç§°ç´¢å¼•ã€æè¿°ç¬¦ç´¢å¼•å¤–ï¼Œä¼šå¢žåŠ ä¸€ä¸ªConstantValueç±»åž‹çš„å±žæ€§è¡¨ã€‚ 7. å®žä¾‹è§£æž å®šä¹‰å¦‚ä¸‹ä¸€ä¸ªç®€å•çš„Simpleç±»ï¼Œç„¶åŽé€šè¿‡æŸ¥çœ‹Simple.classæ–‡ä»¶å†…å®¹å¹¶ç»“åˆjavap -v Simple ç”Ÿæˆçš„å¸¸é‡æ± å†…å®¹ï¼Œåˆ†æžstr fieldå­—æ®µçš„ç»“æž„ï¼š 1234public class Simple &#123; private transient static final String str ="This is a test"; &#125; å­—æ®µè®¡æ•°å™¨ä¸­çš„å€¼ä¸º0x0001,è¡¨ç¤ºè¿™ä¸ªç±»å°±å®šä¹‰äº†ä¸€ä¸ªfieldå­—æ®µ å­—æ®µçš„è®¿é—®æ ‡å¿—æ˜¯0x009A,äºŒè¿›åˆ¶æ˜¯00000000 10011010ï¼Œå³ç¬¬9ã€12ã€13ã€15ä½æ ‡å¿—ä½ä¸º1ï¼Œè¿™ä¸ªå­—æ®µçš„æ ‡å¿—ç¬¦æœ‰ï¼šACC_TRANSIENTã€ACC_FINALã€ACC_STATICã€ACC_PRIVATE; åç§°ç´¢å¼•ä¸­çš„å€¼ä¸º0x0005,æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬5é¡¹ï¼Œä¸ºâ€œstrâ€,è¡¨æ˜Žè¿™ä¸ªfieldå­—æ®µçš„åç§°æ˜¯strï¼› æè¿°ç´¢å¼•ä¸­çš„å€¼ä¸º0x0006,æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬6é¡¹ï¼Œä¸º&quot;Ljava/lang/String;&quot;ï¼Œè¡¨æ˜Žè¿™ä¸ªfieldå­—æ®µçš„æ•°æ®ç±»åž‹æ˜¯java.lang.Stringç±»åž‹ï¼› 5.å±žæ€§è¡¨è®¡æ•°å™¨ä¸­çš„å€¼ä¸º0x0001,è¡¨æ˜Žfield_infoè¿˜æœ‰ä¸€ä¸ªå±žæ€§è¡¨ï¼› 6.å±žæ€§è¡¨åç§°ç´¢å¼•ä¸­çš„å€¼ä¸º0x0007,æŒ‡å‘å¸¸é‡æ± ä¸­çš„ç¬¬7é¡¹ï¼Œä¸ºâ€œConstantValueâ€,è¡¨æ˜Žè¿™ä¸ªå±žæ€§è¡¨çš„åç§°æ˜¯ConstantValueï¼Œå³å±žæ€§è¡¨çš„ç±»åž‹æ˜¯ConstantValueç±»åž‹çš„ï¼› 7.å±žæ€§é•¿åº¦ä¸­çš„å€¼ä¸º0x0002ï¼Œå› ä¸ºæ­¤å±žæ€§è¡¨æ˜¯ConstantValueç±»åž‹ï¼Œå®ƒçš„å€¼å›ºå®šä¸º2ï¼› 8.å¸¸é‡å€¼ç´¢å¼• ä¸­çš„å€¼ä¸º0x0008,æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬8é¡¹ï¼Œä¸ºCONSTANT_String_infoç±»åž‹çš„é¡¹ï¼Œè¡¨ç¤ºâ€œThis is a testâ€ çš„å¸¸é‡ã€‚åœ¨å¯¹æ­¤fieldèµ‹å€¼æ—¶ï¼Œä¼šä½¿ç”¨æ­¤å¸¸é‡å¯¹fieldèµ‹å€¼ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¡¥å……é˜…è¯»3-Classæ–‡ä»¶ä¸­çš„è®¿é—®æ ‡å¿—ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æŽ¥å£ç´¢å¼•é›†åˆ]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E8%A1%A5%E5%85%85%E9%98%85%E8%AF%BB3-Class%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E8%AE%BF%E9%97%AE%E6%A0%87%E5%BF%97%E3%80%81%E7%B1%BB%E7%B4%A2%E5%BC%95%E3%80%81%E7%88%B6%E7%B1%BB%E7%B4%A2%E5%BC%95%E3%80%81%E6%8E%A5%E5%8F%A3%E7%B4%A2%E5%BC%95%E9%9B%86%E5%90%88%2F</url>
    <content type="text"><![CDATA[è®²å®Œäº†classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± ï¼Œæˆ‘ä»¬å°±ç›¸å½“äºŽå…‹æœäº†classæ–‡ä»¶ä¸­æœ€éº»çƒ¦çš„æ¨¡å—äº†ã€‚çŽ°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹classæ–‡ä»¶ä¸­ç´§æŽ¥ç€å¸¸é‡æ± åŽé¢çš„å‡ ä¸ªä¸œè¥¿ï¼šè®¿é—®æ ‡å¿—ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æŽ¥å£ç´¢å¼•é›†åˆã€‚ 1. è®¿é—®æ ‡å¿—ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æŽ¥å£ç´¢å¼•é›†åˆ åœ¨classæ–‡ä»¶ä¸­çš„ä½ç½® 2. è®¿é—®æ ‡å¿—(access_flags)èƒ½å¤Ÿè¡¨ç¤ºä»€ä¹ˆï¼Ÿ è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ç´§æŽ¥ç€å¸¸é‡æ± åŽï¼Œå æœ‰ä¸¤ä¸ªå­—èŠ‚ï¼Œæ€»å…±16ä½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å½“JVMåœ¨ç¼–è¯‘æŸä¸ªç±»æˆ–è€…æŽ¥å£çš„æºä»£ç æ—¶ï¼ŒJVMä¼šè§£æžå‡ºè¿™ä¸ªç±»æˆ–è€…æŽ¥å£çš„è®¿é—®æ ‡å¿—ä¿¡æ¯ï¼Œç„¶åŽï¼Œå°†è¿™äº›æ ‡å¿—è®¾ç½®åˆ°è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰è¿™16ä¸ªä½ä¸Šã€‚JVMä¼šè€ƒè™‘å¦‚ä¸‹è®¾ç½®å¦‚ä¸‹è®¿é—®è¡¨ç¤ºä¿¡æ¯ï¼š a. ç±»æˆ–æŽ¥å£ æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸ªå®šä¹‰çš„ç±»æˆ–è€…æŽ¥å£éƒ½ä¼šç”Ÿæˆclassæ–‡ä»¶ï¼ˆè¿™é‡Œä¹ŸåŒ…æ‹¬å†…éƒ¨ç±»ï¼Œåœ¨æŸä¸ªç±»ä¸­å®šä¹‰çš„é™æ€å†…éƒ¨ç±»ä¹Ÿä¼šå•ç‹¬ç”Ÿæˆä¸€ä¸ªclassæ–‡ä»¶ï¼‰ã€‚ å¯¹äºŽå®šä¹‰çš„ç±»ï¼ŒJVMåœ¨å°†å…¶ç¼–è¯‘æˆclassæ–‡ä»¶æ—¶ï¼Œä¼šå°†classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—çš„ç¬¬11ä½è®¾ç½®ä¸º1 ã€‚ç¬¬11ä½å«åšACC_SUPERæ ‡å¿—ä½ï¼› å¯¹äºŽå®šä¹‰çš„æŽ¥å£ï¼ŒJVMåœ¨å°†å…¶ç¼–è¯‘æˆclassæ–‡ä»¶æ—¶ï¼Œä¼šå°†classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—çš„ç¬¬8ä½ è®¾ç½®ä¸º 1 ã€‚ç¬¬8ä½å«åšACC_INTERFACEæ ‡å¿—ä½ï¼› b. è®¿é—®æƒé™ï¼špublicç±»åž‹å’ŒåŒ…packageç±»åž‹ã€‚ å¦‚æžœç±»æˆ–è€…æŽ¥å£è¢«å£°æ˜Žä¸ºpublicç±»åž‹çš„ï¼Œé‚£ä¹ˆï¼ŒJVMå°†å…¶ç¼–è¯‘æˆclassæ–‡ä»¶æ—¶ï¼Œä¼šå°†classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—çš„ç¬¬16ä½è®¾ç½®ä¸º1 ã€‚ç¬¬16ä½å«åšACC_PUBLICæ ‡å¿—ç¬¦ï¼› c. ç±»æ˜¯å¦ä¸ºæŠ½è±¡ç±»åž‹çš„ï¼Œå³æˆ‘ä»¬å®šä¹‰çš„ç±»æœ‰æ²¡æœ‰è¢«abstractå…³é”®å­—ä¿®é¥°ï¼Œå³æˆ‘ä»¬å®šä¹‰çš„ç±»æ˜¯å¦ä¸ºæŠ½è±¡ç±»ã€‚ 1public abstract class MyClass&#123;......&#125; å®šä¹‰æŸä¸ªç±»æ—¶ï¼ŒJVMå°†å®ƒç¼–è¯‘æˆclassæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šå°†classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—çš„ç¬¬7ä½è®¾ç½®ä¸º1 ã€‚ç¬¬7ä½å«åšACC_ABSTRACTæ ‡å¿—ä½ã€‚ å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºŽå®šä¹‰çš„æŽ¥å£ï¼ŒJVMåœ¨ç¼–è¯‘æŽ¥å£çš„æ—¶å€™ä¹Ÿä¼šå¯¹classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—ä¸Šçš„ACC_ABSTRACTæ ‡å¿—ä½è®¾ç½®ä¸º 1ï¼› d. è¯¥ç±»æ˜¯å¦è¢«å£°æ˜Žäº†finalç±»åž‹,å³è¡¨ç¤ºè¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚ æ­¤æ—¶JVMä¼šåœ¨ç¼–è¯‘classæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°†classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—çš„ç¬¬12ä½è®¾ç½®ä¸º 1 ã€‚ç¬¬12ä½å«åšACC_FINALæ ‡å¿—ä½ï¼› e.æ˜¯å¦æ˜¯JVMé€šè¿‡javaæºä»£ç æ–‡ä»¶ç¼–è¯‘è€Œæˆçš„ å¦‚æžœæˆ‘ä»¬è¿™ä¸ªclassæ–‡ä»¶ä¸æ˜¯JVMé€šè¿‡javaæºä»£ç æ–‡ä»¶ç¼–è¯‘è€Œæˆçš„ï¼Œè€Œæ˜¯ç”¨æˆ·è‡ªå·±é€šè¿‡classæ–‡ä»¶çš„ç»„ç»‡è§„åˆ™ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆï¼Œä¸€èˆ¬ä¼šå¯¹classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—ç¬¬4ä½è®¾ç½®ä¸º 1 ã€‚é€šè¿‡JVMç¼–è¯‘æºä»£ç äº§ç”Ÿçš„classæ–‡ä»¶æ­¤æ ‡å¿—ä½ä¸º 0ï¼Œç¬¬4ä½å«åšACC_SYNTHETICæ ‡å¿—ä½ï¼› f. æžšä¸¾ç±» å¯¹äºŽå®šä¹‰çš„æžšä¸¾ç±»å¦‚ï¼špublic enum EnumTest{â€¦}ï¼ŒJVMä¹Ÿä¼šå¯¹æ­¤æžšä¸¾ç±»ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œè¿™æ—¶ï¼Œå¯¹äºŽè¿™æ ·çš„classæ–‡ä»¶ï¼ŒJVMä¼šå¯¹è®¿é—®æ ‡å¿—ç¬¬2ä½è®¾ç½®ä¸º 1 ï¼Œä»¥è¡¨ç¤ºå®ƒæ˜¯æžšä¸¾ç±»ã€‚ç¬¬2ä½å«åšACC_ENUMæ ‡å¿—ä½ï¼› g. æ³¨è§£ç±» å¯¹äºŽå®šä¹‰çš„æ³¨è§£ç±»å¦‚ï¼špublic @interface{â€¦},JVMä¼šå¯¹æ­¤æ³¨è§£ç±»ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œå¯¹äºŽè¿™æ ·çš„classæ–‡ä»¶ï¼ŒJVMä¼šå°†è®¿é—®æ ‡å¿—ç¬¬3ä½è®¾ç½®ä¸º1ï¼Œä»¥è¡¨ç¤ºè¿™æ˜¯ä¸ªæ³¨è§£ç±»ï¼Œç¬¬3ä½å«åšACC_ANNOTATIONæ ‡å¿—ä½ã€‚ å½“JVMç¡®å®šäº†ä¸Šè¿°æ ‡å¿—ä½çš„å€¼åŽï¼Œå°±å¯ä»¥ç¡®å®šè®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰çš„å€¼äº†ã€‚å®žé™…ä¸ŠJVMä¸Šè¿°æ ‡å¿—ä¼šæ ¹æ®ä¸Šè¿°ç¡®å®šçš„æ ‡å¿—ä½çš„å€¼ï¼Œå¯¹è¿™äº›æ ‡å¿—ä½çš„å€¼å–æˆ–ï¼Œä¾¿å¾—åˆ°äº†è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º: ä¸¾ä¾‹ å®šä¹‰ä¸€ä¸ªæœ€ç®€å•çš„ç±»Simple.javaï¼Œä½¿ç”¨ç¼–è¯‘å™¨ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œç„¶åŽè§‚å¯Ÿclassæ–‡ä»¶ä¸­çš„è®¿é—®æ ‡å¿—çš„å€¼ï¼Œä»¥åŠä½¿ç”¨javap -v Simple æŸ¥çœ‹è®¿é—®æ ‡å¿—ã€‚ 123public class Simple &#123; &#125; ä½¿ç”¨UltraEditæŸ¥çœ‹ç¼–è¯‘æˆçš„classæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸Šè¿°çš„å›¾ä¸­é»„è‰²éƒ¨åˆ†è¡¨ç¤ºçš„æ˜¯å¸¸é‡æ± éƒ¨åˆ†,å¸¸é‡æ± åŽé¢ç´§è·Ÿç€å°±æ˜¯è®¿é—®æ ‡å¿—ï¼Œå®ƒçš„åå…­è¿›åˆ¶å€¼ä¸º0x0021,äºŒè¿›åˆ¶çš„å€¼ä¸ºï¼š00000000 00100001ï¼Œç”±äºŒè¿›åˆ¶çš„1çš„ä½æ•°å¯ä»¥å¾—å‡ºç¬¬11ã€16ä½ä¸º1ï¼Œåˆ†åˆ«å¯¹åº”ACC_SUPERæ ‡å¿—ä½å’ŒACC_PUBLICæ ‡å¿—ä½ã€‚éªŒè¯ä¸€ä¸‹: 3. ç±»ç´¢å¼•(this_class)æ˜¯ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬çŸ¥é“ä¸€èˆ¬æƒ…å†µä¸‹ä¸€ä¸ªJavaç±»æºæ–‡ä»¶ç»è¿‡JVMç¼–è¯‘ä¼šç”Ÿæˆä¸€ä¸ªclassæ–‡ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä¸€ä¸ªJavaç±»æºæ–‡ä»¶ä¸­å®šä¹‰äº†å…¶ä»–ç±»æˆ–è€…å†…éƒ¨ç±»ï¼Œè¿™æ ·ç¼–è¯‘å‡ºæ¥çš„classæ–‡ä»¶å°±ä¸æ­¢ä¸€ä¸ªï¼Œä½†æ¯ä¸€ä¸ªclassæ–‡ä»¶è¡¨ç¤ºæŸä¸€ä¸ªç±»ï¼Œè‡³äºŽè¿™ä¸ªclassè¡¨ç¤ºå“ªä¸€ä¸ªç±»ï¼Œä¾¿å¯ä»¥é€šè¿‡ ç±»ç´¢å¼• è¿™ä¸ªæ•°æ®é¡¹æ¥ç¡®å®šã€‚JVMé€šè¿‡ç±»çš„å®Œå…¨é™å®šåç¡®å®šæ˜¯æŸä¸€ä¸ªç±»ã€‚ ç±»ç´¢å¼•çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸ºäº†æŒ‡å‡ºclassæ–‡ä»¶æ‰€æè¿°çš„è¿™ä¸ªç±»å«ä»€ä¹ˆåå­—ã€‚ ç±»ç´¢å¼•ç´§æŽ¥ç€è®¿é—®æ ‡å¿—çš„åŽé¢ï¼Œå æœ‰ä¸¤ä¸ªå­—èŠ‚ï¼Œåœ¨è¿™ä¸¤ä¸ªå­—èŠ‚ä¸­å­˜å‚¨çš„å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡æ± çš„ä¸€ä¸ªç´¢å¼•ï¼Œè¯¥ç´¢å¼•æŒ‡å‘çš„æ˜¯CONSTANT_Class_infoå¸¸é‡æ± é¡¹. ä»¥ä¸Šé¢å®šä¹‰çš„Simple.class ä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒæŸ¥çœ‹ä»–çš„ç±»ç´¢å¼•åœ¨ä»€ä¹ˆä½ç½®å’Œå–ä»€ä¹ˆå€¼ã€‚ ç”±ä¸Šå¯çŸ¥ï¼Œå®ƒçš„ç±»ç´¢å¼•å€¼ä¸º0x0001,é‚£ä¹ˆï¼Œå®ƒæŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬ä¸€ä¸ªå¸¸é‡æ± é¡¹ï¼Œé‚£æˆ‘ä»¬å†çœ‹ä¸€ä¸‹å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ã€‚ä½¿ç”¨javap -v Simple,å¸¸é‡æ± ä¸­æœ‰ä»¥ä¸‹ä¿¡æ¯ï¼š å¯ä»¥çœ‹åˆ°å¸¸é‡æ± ä¸­çš„ç¬¬ä¸€é¡¹æ˜¯CONSTANT_Class_infoé¡¹ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ª&quot;com/louis/jvm/Simple&quot;çš„ç±»åã€‚å³ç±»ç´¢å¼•æ˜¯å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªclassæ–‡ä»¶æ‰€è¡¨ç¤ºçš„æ˜¯å“ªä¸€ä¸ªç±»ã€‚ 4. çˆ¶ç±»ç´¢å¼•(super_class)æ˜¯ä»€ä¹ˆï¼Ÿ Javaæ”¯æŒå•ç»§æ‰¿æ¨¡å¼ï¼Œé™¤äº†java.lang.Object ç±»é™¤å¤–ï¼Œæ¯ä¸€ä¸ªç±»éƒ½ä¼šæœ‰ä¸”åªæœ‰ä¸€ä¸ªçˆ¶ç±»ã€‚classæ–‡ä»¶ä¸­ç´§æŽ¥ç€ç±»ç´¢å¼•(this_class)ä¹‹åŽçš„ä¸¤ä¸ªå­—èŠ‚åŒºåŸŸè¡¨ç¤ºçˆ¶ç±»ç´¢å¼•ï¼Œè·Ÿç±»ç´¢å¼•ä¸€æ ·ï¼Œçˆ¶ç±»ç´¢å¼•è¿™ä¸¤ä¸ªå­—èŠ‚ä¸­çš„å€¼æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„æŸä¸ªå¸¸é‡æ± é¡¹CONSTANT_Class_infoï¼Œè¡¨ç¤ºè¯¥classè¡¨ç¤ºçš„ç±»æ˜¯ç»§æ‰¿è‡ªå“ªä¸€ä¸ªç±»ã€‚ 5. æŽ¥å£ç´¢å¼•é›†åˆ(interfaces)æ˜¯ä»€ä¹ˆï¼Ÿ ä¸€ä¸ªç±»å¯ä»¥ä¸å®žçŽ°ä»»ä½•æŽ¥å£ï¼Œä¹Ÿå¯ä»¥å®žçŽ°å¾ˆå¤šä¸ªæŽ¥å£ï¼Œä¸ºäº†è¡¨ç¤ºå½“å‰ç±»å®žçŽ°çš„æŽ¥å£ä¿¡æ¯ï¼Œclassæ–‡ä»¶ä½¿ç”¨äº†å¦‚ä¸‹ç»“æž„ä½“æè¿°æŸä¸ªç±»çš„æŽ¥å£å®žçŽ°ä¿¡æ¯: ç”±äºŽç±»å®žçŽ°çš„æŽ¥å£æ•°ç›®ä¸ç¡®å®šï¼Œæ‰€ä»¥æŽ¥å£ç´¢å¼•é›†åˆçš„æè¿°çš„å‰éƒ¨åˆ†å«åšæŽ¥å£è®¡æ•°å™¨ï¼ˆinterfaces_countï¼‰ï¼ŒæŽ¥å£è®¡æ•°å™¨å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­çš„å€¼è¡¨ç¤ºç€è¿™ä¸ªç±»å®žçŽ°äº†å¤šå°‘ä¸ªæŽ¥å£ï¼Œç´§è·Ÿç€æŽ¥å£è®¡æ•°å™¨çš„éƒ¨åˆ†å°±æ˜¯æŽ¥å£ç´¢å¼•éƒ¨åˆ†äº†ï¼Œæ¯ä¸€ä¸ªæŽ¥å£ç´¢å¼•å æœ‰ä¸¤ä¸ªå­—èŠ‚ï¼ŒæŽ¥å£è®¡æ•°å™¨çš„å€¼ä»£è¡¨ç€åŽé¢è·Ÿç€çš„æŽ¥å£ç´¢å¼•çš„ä¸ªæ•°ã€‚æŽ¥å£ç´¢å¼•å’Œç±»ç´¢å¼•å’Œçˆ¶ç±»ç´¢å¼•ä¸€æ ·ï¼Œå…¶å†…çš„å€¼å­˜å‚¨çš„æ˜¯æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„å¸¸é‡æ± é¡¹çš„ç´¢å¼•ï¼Œè¡¨ç¤ºç€è¿™ä¸ªæŽ¥å£çš„å®Œå…¨é™å®šåã€‚ ä¸¾ä¾‹ï¼š å®šä¹‰ä¸€ä¸ªWorkeræŽ¥å£ï¼Œç„¶åŽç±»Programmerå®žçŽ°è¿™ä¸ªWorkeræŽ¥å£ï¼Œç„¶åŽæˆ‘ä»¬è§‚å¯ŸProgrammerçš„æŽ¥å£ç´¢å¼•é›†åˆæ˜¯æ€Žæ ·è¡¨ç¤ºçš„ã€‚ 12345public interface Worker&#123; public void work(); &#125; 1234567public class Programmer implements Worker &#123; @Override public void work() &#123; System.out.println("I'm Programmer,Just coding...."); &#125; &#125;]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¡¥å……é˜…è¯»2-Classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± ]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E8%A1%A5%E5%85%85%E9%98%85%E8%AF%BB2-Class%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%B8%B8%E9%87%8F%E6%B1%A0%2F</url>
    <content type="text"><![CDATA[ä¸Šä¸€èŠ‚Classç±»æ–‡ä»¶ç»“æž„å¤§è‡´åœ°ä»‹ç»äº†classæ–‡ä»¶çš„ç»„ç»‡ç»“æž„ï¼ŒæŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¯ä¸€ä¸ªç»“æž„ï¼Œæ¥è¯¦ç»†äº†è§£å®ƒä»¬ã€‚è¿™ä¸€ç« èŠ‚å‘¢ï¼Œæˆ‘ä»¬å°±æ¥æ‰’ä¸€æ‰’classæ–‡ä»¶ä¸­éžå¸¸é‡è¦ çš„ä¸€ä¸ªæ•°æ®åŒºåŸŸ------å¸¸é‡æ± ã€‚å®ƒåœ¨JVMè™šæ‹Ÿæœºä¸­æ‰®æ¼”äº†éžå¸¸é‡è¦çš„åœ°ä½ã€‚ æœ¬ç¯‡å†…å®¹æ¥è‡ªäºŽjavaè™šæ‹ŸæœºåŽŸç†å›¾è§£ï¼Œè‡ªå·±ä¸€è¾¹ç†è§£ä¸€è¾¹è¿›è¡Œå¤åˆ¶æ•´ç†å¾—æ­¤æ–‡ç« ï¼Œä¹Ÿæ˜¯çœ‹äº†å¾ˆå¤šéï¼Œé€æ¸åœ°å¥½åƒæ‡‚äº†å¸¸é‡æ± æ€Žä¹ˆçŽ©çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦åšæŒï¼Œè¯»ä¸æ‡‚å¤šè¯»å‡ éä¸€å®šå¯ä»¥è¯»æ‡‚çš„ã€‚ æœ¬ç¯‡æ–‡ç« å†…å®¹è¿‡å¤šï¼Œè¿™é‡Œå°†ç›®å½•åˆ—ä¸¾åœ¨æ­¤ã€‚ å¸¸é‡æ± æ˜¯ä»€ä¹ˆ å¸¸é‡æ± åœ¨classæ–‡ä»¶çš„ä»€ä¹ˆä½ç½®ï¼Ÿ å¸¸é‡æ± é‡Œé¢æ˜¯æ€Žä¹ˆç»„ç»‡çš„ï¼Ÿ å¸¸é‡æ± é¡¹ (cp_info) çš„ç»“æž„æ˜¯ä»€ä¹ˆï¼Ÿ å¸¸é‡æ± èƒ½å¤Ÿè¡¨ç¤ºå“ªäº›ä¿¡æ¯ï¼Ÿ intå’Œfloatæ•°æ®ç±»åž‹çš„å¸¸é‡åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·è¡¨ç¤ºå’Œå­˜å‚¨çš„ï¼Ÿ longå’Œ doubleæ•°æ®ç±»åž‹çš„å¸¸é‡åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·è¡¨ç¤ºå’Œå­˜å‚¨çš„ï¼Ÿ Stringç±»åž‹çš„å­—ç¬¦ä¸²å¸¸é‡åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·è¡¨ç¤ºå’Œå­˜å‚¨çš„ï¼Ÿ ç±»æ–‡ä»¶ä¸­å®šä¹‰çš„ç±»åå’Œç±»ä¸­ä½¿ç”¨åˆ°çš„ç±»åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·è¢«ç»„ç»‡å’Œå­˜å‚¨çš„ï¼Ÿ ç±»ä¸­å¼•ç”¨åˆ°çš„fieldå­—æ®µåœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·æè¿°çš„ï¼Ÿ ç±»ä¸­å¼•ç”¨åˆ°çš„methodæ–¹æ³•åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·æè¿°çš„ï¼Ÿ ç±»ä¸­å¼•ç”¨åˆ°æŸä¸ªæŽ¥å£ä¸­å®šä¹‰çš„methodæ–¹æ³•åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·æè¿°çš„ï¼Ÿ æ›´å¥½åœ°æ”¯æŒåŠ¨æ€è¯­è¨€æ‰€å¢žåŠ çš„ä¸‰é¡¹ 1. å¸¸é‡æ± æ˜¯ä»€ä¹ˆ å¯ä»¥ç†è§£ä¸ºclassæ–‡ä»¶ä¹‹ä¸­çš„èµ„æºä»“åº“ï¼Œå®ƒæ˜¯classæ–‡ä»¶ç»“æž„ä¸­ä¸Žå…¶ä»–é¡¹ç›®å…³è”æœ€å¤šçš„æ•°æ®ç±»åž‹ï¼Œä¹Ÿæ˜¯å ç”¨classæ–‡ä»¶ç©ºé—´æœ€å¤§çš„æ•°æ®é¡¹ç›®ä¹‹ä¸€ï¼ŒåŒæ—¶å®ƒè¿˜æ˜¯classæ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªå‡ºçŽ°è¡¨ç±»åž‹çš„æ•°æ®é¡¹ç›®ï¼Ž ç”±äºŽå¸¸é‡æ± çš„æ•°é‡æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨å¸¸é‡æ± å…¥å£éœ€è¦æ”¾ç½®ä¸€é¡¹u2ï¼ˆå³ï¼’ä¸ªå­—èŠ‚ï¼‰ç±»åž‹çš„æ•°æ®ï¼Œä»£è¡¨å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ï¼ˆconstant-pool-countï¼‰(ä»Žï¼‘å¼€å§‹ï¼Œå°†ï¼è¡¨ç¤ºä¸å¼•ç”¨ä»»ä½•å¸¸é‡). å¸¸é‡æ± ä¸­ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨(Synbolic Reference)ï¼Ž å­—é¢é‡ï¼šæ¯”è¾ƒæŽ¥è¿‘äºŽJavaè¯­è¨€å±‚é¢çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå£°æ˜Žä¸ºfinalçš„å¸¸é‡å€¼. ç¬¦å·å¼•ç”¨ï¼šåŒ…æ‹¬å¦‚ä¸‹ä¸‰ç±»å¸¸é‡ï¼š ç±»å’ŒæŽ¥å£çš„å…¨é™å®šåï¼ˆFully Qualified Nameï¼‰ å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼ˆDescriptorï¼‰ æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ 2. å¸¸é‡æ± åœ¨classæ–‡ä»¶çš„ä»€ä¹ˆä½ç½®ï¼Ÿ 3. å¸¸é‡æ± çš„é‡Œé¢æ˜¯æ€Žä¹ˆç»„ç»‡çš„ï¼Ÿ å¸¸é‡æ± çš„ç»„ç»‡å¾ˆç®€å•ï¼Œå‰ç«¯çš„ä¸¤ä¸ªå­—èŠ‚å æœ‰çš„ä½ç½®å«åšå¸¸é‡æ± è®¡æ•°å™¨(constant_pool_count)ï¼Œå®ƒè®°å½•ç€å¸¸é‡æ± çš„ç»„æˆå…ƒç´  å¸¸é‡æ± é¡¹(cp_info) çš„ä¸ªæ•°ã€‚ç´§æŽ¥ç€ä¼šæŽ’åˆ—ç€constant_pool_count-1ä¸ªå¸¸é‡æ± é¡¹(cp_info)ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 4. å¸¸é‡æ± é¡¹ (cp_info) çš„ç»“æž„æ˜¯ä»€ä¹ˆï¼Ÿ æ¯ä¸ªå¸¸é‡æ± é¡¹(cp_info) éƒ½ä¼šå¯¹åº”è®°å½•ç€classæ–‡ä»¶ä¸­çš„æŸç§ç±»åž‹çš„å­—é¢é‡ã€‚è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å¸¸é‡æ± é¡¹(cp_info)çš„ç»“æž„å§ï¼š JVMè™šæ‹Ÿæœºè§„å®šäº†ä¸åŒçš„tagå€¼å’Œä¸åŒç±»åž‹çš„å­—é¢é‡å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š æ‰€ä»¥æ ¹æ®cp_infoä¸­çš„tag ä¸åŒçš„å€¼ï¼Œå¯ä»¥å°†cp_info æ›´ç»†åŒ–ä¸ºä»¥ä¸‹ç»“æž„ä½“ï¼š çŽ°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç»†åŒ–äº†çš„å¸¸é‡æ± çš„ç»“æž„ä¼šæ˜¯ç±»ä¼¼ä¸‹å›¾æ‰€ç¤ºçš„æ ·å­ï¼š 5. å¸¸é‡æ± èƒ½å¤Ÿè¡¨ç¤ºé‚£äº›ä¿¡æ¯ï¼Ÿ 6. intå’Œfloatæ•°æ®ç±»åž‹çš„å¸¸é‡åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·è¡¨ç¤ºå’Œå­˜å‚¨çš„ï¼Ÿ(CONSTANT_Integer_info, CONSTANT_Float_info) Javaè¯­è¨€è§„èŒƒè§„å®šäº† intç±»åž‹å’ŒFloat ç±»åž‹çš„æ•°æ®ç±»åž‹å ç”¨ 4 ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚é‚£ä¹ˆå­˜åœ¨äºŽclasså­—èŠ‚ç æ–‡ä»¶ä¸­çš„è¯¥ç±»åž‹çš„å¸¸é‡æ˜¯å¦‚ä½•å­˜å‚¨çš„å‘¢ï¼Ÿç›¸åº”åœ°ï¼Œåœ¨å¸¸é‡æ± ä¸­ï¼Œå°† intå’ŒFloatç±»åž‹çš„å¸¸é‡åˆ†åˆ«ä½¿ç”¨CONSTANT_Integer_infoå’Œ Constant_float_infoè¡¨ç¤ºï¼Œä»–ä»¬çš„ç»“æž„å¦‚ä¸‹æ‰€ç¤ºï¼š ä¸¾ä¾‹ï¼šå»ºä¸‹é¢çš„ç±» IntAndFloatTest.javaï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬å£°æ˜Žäº†äº”ä¸ªå˜é‡ï¼Œä½†æ˜¯å–å€¼å°±ä¸¤ç§intç±»åž‹çš„10 å’ŒFloatç±»åž‹çš„11f. 123456789public class IntAndFloatTest &#123; private final int a = 10; private final int b = 10; private float c = 11f; private float d = 11f; private float e = 11f; &#125; ç„¶åŽç”¨ç¼–è¯‘å™¨ç¼–è¯‘æˆIntAndFloatTest.classå­—èŠ‚ç æ–‡ä»¶ï¼Œæˆ‘ä»¬é€šè¿‡javap -v IntAndFloatTest æŒ‡ä»¤æ¥çœ‹ä¸€ä¸‹å…¶å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°è™½ç„¶æˆ‘ä»¬åœ¨ä»£ç ä¸­å†™äº†ä¸¤æ¬¡10 å’Œä¸‰æ¬¡11fï¼Œä½†æ˜¯å¸¸é‡æ± ä¸­ï¼Œå°±åªæœ‰ä¸€ä¸ªå¸¸é‡10 å’Œä¸€ä¸ªå¸¸é‡11f,å¦‚ä¸‹å›¾æ‰€ç¤º: ä»Žç»“æžœä¸Šå¯ä»¥çœ‹åˆ°å¸¸é‡æ± ç¬¬#8 ä¸ªå¸¸é‡æ± é¡¹(cp_info) å°±æ˜¯CONSTANT_Integer_info,å€¼ä¸º10ï¼›ç¬¬#23ä¸ªå¸¸é‡æ± é¡¹(cp_info) å°±æ˜¯CONSTANT_Float_info,å€¼ä¸º11fã€‚ ä»£ç ä¸­æ‰€æœ‰ç”¨åˆ° int ç±»åž‹ 10 çš„åœ°æ–¹ï¼Œä¼šä½¿ç”¨æŒ‡å‘å¸¸é‡æ± çš„æŒ‡é’ˆå€¼#8 å®šä½åˆ°ç¬¬#8 ä¸ªå¸¸é‡æ± é¡¹(cp_info)ï¼Œå³å€¼ä¸º 10çš„ç»“æž„ä½“ CONSTANT_Integer_infoï¼Œè€Œç”¨åˆ°floatç±»åž‹çš„11fæ—¶ï¼Œä¹Ÿä¼šæŒ‡å‘å¸¸é‡æ± çš„æŒ‡é’ˆå€¼#23æ¥å®šä½åˆ°ç¬¬#23ä¸ªå¸¸é‡æ± é¡¹(cp_info) å³å€¼ä¸º11fçš„ç»“æž„ä½“CONSTANT_Float_infoã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 7. longå’Œ doubleæ•°æ®ç±»åž‹çš„å¸¸é‡åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·è¡¨ç¤ºå’Œå­˜å‚¨çš„ï¼Ÿ(CONSTANT_Long_infoã€CONSTANT_Double_info ) Javaè¯­è¨€è§„èŒƒè§„å®šäº† long ç±»åž‹å’Œ doubleç±»åž‹çš„æ•°æ®ç±»åž‹å ç”¨8 ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚é‚£ä¹ˆå­˜åœ¨äºŽclass å­—èŠ‚ç æ–‡ä»¶ä¸­çš„è¯¥ç±»åž‹çš„å¸¸é‡æ˜¯å¦‚ä½•å­˜å‚¨çš„å‘¢ï¼Ÿç›¸åº”åœ°ï¼Œåœ¨å¸¸é‡æ± ä¸­ï¼Œå°†longå’Œdoubleç±»åž‹çš„å¸¸é‡åˆ†åˆ«ä½¿ç”¨CONSTANT_Long_infoå’ŒConstant_Double_infoè¡¨ç¤ºï¼Œä»–ä»¬çš„ç»“æž„å¦‚ä¸‹æ‰€ç¤ºï¼š ä»£ç ä¸­æ‰€æœ‰ç”¨åˆ° long ç±»åž‹-6076574518398440533L çš„åœ°æ–¹ï¼Œä¼šä½¿ç”¨æŒ‡å‘å¸¸é‡æ± çš„æŒ‡é’ˆå€¼#18 å®šä½åˆ°ç¬¬ #18 ä¸ªå¸¸é‡æ± é¡¹(cp_info)ï¼Œå³å€¼ä¸º-6076574518398440533L çš„ç»“æž„ä½“CONSTANT_Long_infoï¼Œè€Œç”¨åˆ°doubleç±»åž‹çš„10.1234567890Dæ—¶ï¼Œä¹Ÿä¼šæŒ‡å‘å¸¸é‡æ± çš„æŒ‡é’ˆå€¼#26 æ¥å®šä½åˆ°ç¬¬ #26 ä¸ªå¸¸é‡æ± é¡¹(cp_info) å³å€¼ä¸º10.1234567890Dçš„ç»“æž„ä½“CONSTANT_Double_infoã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 8. Stringç±»åž‹çš„å­—ç¬¦ä¸²å¸¸é‡åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·è¡¨ç¤ºå’Œå­˜å‚¨çš„ï¼Ÿï¼ˆCONSTANT_String_infoã€CONSTANT_Utf8_infoï¼‰ å¯¹äºŽå­—ç¬¦ä¸²è€Œè¨€ï¼ŒJVMä¼šå°†å­—ç¬¦ä¸²ç±»åž‹çš„å­—é¢é‡ä»¥UTF-8 ç¼–ç æ ¼å¼å­˜å‚¨åˆ°åœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­ã€‚è¿™ä¹ˆè¯´å¯èƒ½æœ‰ç‚¹æ‘¸ä¸ç€åŒ—ï¼Œæˆ‘ä»¬å…ˆä»Žç›´è§‚çš„Javaæºç ä¸­ä¸­å‡ºçŽ°çš„ç”¨åŒå¼•å·&quot;&quot; æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²æ¥çœ‹ï¼Œåœ¨ç¼–è¯‘å™¨ç¼–è¯‘çš„æ—¶å€™ï¼Œéƒ½ä¼šå°†è¿™äº›å­—ç¬¦ä¸²è½¬æ¢æˆCONSTANT_String_infoç»“æž„ä½“ï¼Œç„¶åŽæ”¾ç½®äºŽå¸¸é‡æ± ä¸­ã€‚å…¶ç»“æž„å¦‚ä¸‹æ‰€ç¤ºï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºçš„ç»“æž„ä½“ï¼ŒCONSTANT_String_infoç»“æž„ä½“ä¸­çš„string_indexçš„å€¼æŒ‡å‘äº†CONSTANT_Utf8_infoç»“æž„ä½“ï¼Œè€Œå­—ç¬¦ä¸²çš„utf-8ç¼–ç æ•°æ®å°±åœ¨è¿™ä¸ªç»“æž„ä½“ä¹‹ä¸­ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¯·çœ‹ä¸€ä¾‹ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„StringTest.javaç±»ï¼Œç„¶åŽåœ¨è¿™ä¸ªç±»é‡ŒåŠ ä¸€ä¸ª&quot;JVMåŽŸç†&quot; å­—ç¬¦ä¸²ï¼Œç„¶åŽï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒåœ¨classæ–‡ä»¶ä¸­æ˜¯æ€Žæ ·ç»„ç»‡çš„ã€‚ 123456public class StringTest &#123; private String s1 = "JVMåŽŸç†"; private String s2 = "JVMåŽŸç†"; private String s3 = "JVMåŽŸç†"; private String s4 = "JVMåŽŸç†"; &#125; åœ¨ä¸Šé¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°CONSTANT_String_infoç»“æž„ä½“ä½äºŽå¸¸é‡æ± çš„ç¬¬#15ä¸ªç´¢å¼•ä½ç½®ã€‚è€Œå­˜æ”¾&quot;Javaè™šæ‹ŸæœºåŽŸç†&quot; å­—ç¬¦ä¸²çš„ UTF-8ç¼–ç æ ¼å¼çš„å­—èŠ‚æ•°ç»„è¢«æ”¾åˆ°CONSTANT_Utf8_infoç»“æž„ä½“ä¸­ï¼Œè¯¥ç»“æž„ä½“ä½äºŽå¸¸é‡æ± çš„ç¬¬#16ä¸ªç´¢å¼•ä½ç½®ã€‚ä¸Šé¢çš„å›¾åªæ˜¯çœ‹äº†ä¸ªè½®å»“ï¼Œè®©æˆ‘ä»¬å†æ·±å…¥åœ°çœ‹ä¸€ä¸‹å®ƒä»¬çš„ç»„ç»‡å§ã€‚è¯·çœ‹ä¸‹å›¾ï¼š 9. ç±»æ–‡ä»¶ä¸­å®šä¹‰çš„ç±»åå’Œç±»ä¸­ä½¿ç”¨åˆ°çš„ç±»åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·è¢«ç»„ç»‡å’Œå­˜å‚¨çš„ï¼Ÿ(CONSTANT_Class_info) JVMä¼šå°†æŸä¸ªJava ç±»ä¸­æ‰€æœ‰ä½¿ç”¨åˆ°äº†çš„ç±»çš„å®Œå…¨é™å®šå ä»¥äºŒè¿›åˆ¶å½¢å¼çš„å®Œå…¨é™å®šå å°è£…æˆCONSTANT_Class_infoç»“æž„ä½“ä¸­ï¼Œç„¶åŽå°†å…¶æ”¾ç½®åˆ°å¸¸é‡æ± é‡Œã€‚CONSTANT_Class_info çš„tagå€¼ä¸º 7 ã€‚å…¶ç»“æž„å¦‚ä¸‹ï¼š ç±»çš„å®Œå…¨é™å®šåå’ŒäºŒè¿›åˆ¶å½¢å¼çš„å®Œå…¨é™å®šå åœ¨æŸä¸ªJavaæºç ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å¾ˆå¤šä¸ªç±»ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ClassTestçš„ç±»ï¼Œå¹¶æŠŠå®ƒæ”¾åˆ°com.louis.jvm åŒ…ä¸‹ï¼Œåˆ™ ClassTestç±»çš„å®Œå…¨é™å®šåä¸ºcom.louis.jvm.ClassTestï¼Œå°†JVMç¼–è¯‘å™¨å°†ç±»ç¼–è¯‘æˆclassæ–‡ä»¶åŽï¼Œæ­¤å®Œå…¨é™å®šååœ¨classæ–‡ä»¶ä¸­ï¼Œæ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼çš„å®Œå…¨é™å®šåå­˜å‚¨çš„ï¼Œå³å®ƒä¼šæŠŠå®Œå…¨é™å®šç¬¦çš„&quot;.â€œæ¢æˆâ€/&quot; ï¼Œå³åœ¨classæ–‡ä»¶ä¸­å­˜å‚¨çš„ ClassTestç±»çš„å®Œå…¨é™å®šåç§°æ˜¯&quot;com/louis/jvm/ClassTest&quot;ã€‚å› ä¸ºè¿™ç§å½¢å¼çš„å®Œå…¨é™å®šåæ˜¯æ”¾åœ¨äº†classäºŒè¿›åˆ¶å½¢å¼çš„å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å°±ç§°ä¹‹ä¸º äºŒè¿›åˆ¶å½¢å¼çš„å®Œå…¨é™å®šåã€‚ ä¸¾ä¾‹ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¾ˆç®€å•çš„ClassTestç±»ï¼Œæ¥çœ‹ä¸€ä¸‹å¸¸é‡æ± æ˜¯æ€Žä¹ˆå¯¹ç±»çš„å®Œå…¨é™å®šåè¿›è¡Œå­˜å‚¨çš„ã€‚ 123public class ClassTest &#123; private Date date =new Date(); &#125; å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨ClassTest.classæ–‡ä»¶çš„å¸¸é‡æ± ä¸­ï¼Œå…±æœ‰ 3 ä¸ªCONSTANT_Class_infoç»“æž„ä½“ï¼Œåˆ†åˆ«è¡¨ç¤ºClassTest ä¸­ç”¨åˆ°çš„Classä¿¡æ¯ã€‚ æˆ‘ä»¬å°±çœ‹å…¶ä¸­ä¸€ä¸ªè¡¨ç¤ºcom/jvm.ClassTestçš„CONSTANT_Class_info ç»“æž„ä½“ã€‚å®ƒåœ¨å¸¸é‡æ± ä¸­çš„ä½ç½®æ˜¯#1ï¼Œå®ƒçš„name_indexå€¼ä¸º#2ï¼Œå®ƒæŒ‡å‘äº†å¸¸é‡æ± çš„ç¬¬2 ä¸ªå¸¸é‡æ± é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤º: æ³¨æ„ï¼š å¯¹äºŽæŸä¸ªç±»è€Œè¨€ï¼Œå…¶classæ–‡ä»¶ä¸­è‡³å°‘è¦æœ‰ä¸¤ä¸ªCONSTANT_Class_infoå¸¸é‡æ± é¡¹ï¼Œç”¨æ¥è¡¨ç¤ºè‡ªå·±çš„ç±»ä¿¡æ¯å’Œå…¶çˆ¶ç±»ä¿¡æ¯ã€‚(é™¤äº†java.lang.Objectç±»é™¤å¤–ï¼Œå…¶ä»–çš„ä»»ä½•ç±»éƒ½ä¼šé»˜è®¤ç»§æ‰¿è‡ªjava.lang.Objectï¼‰å¦‚æžœç±»å£°æ˜Žå®žçŽ°äº†æŸäº›æŽ¥å£ï¼Œé‚£ä¹ˆæŽ¥å£çš„ä¿¡æ¯ä¹Ÿä¼šç”Ÿæˆå¯¹åº”çš„CONSTANT_Class_infoå¸¸é‡æ± é¡¹ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æžœåœ¨ç±»ä¸­ä½¿ç”¨åˆ°äº†å…¶ä»–çš„ç±»ï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨åˆ°äº†ç›¸åº”çš„ç±»ï¼ŒJDKç¼–è¯‘å™¨æ‰ä¼šå°†ç±»çš„ä¿¡æ¯ç»„æˆCONSTANT_Class_infoå¸¸é‡æ± é¡¹æ”¾ç½®åˆ°å¸¸é‡æ± ä¸­ã€‚å¦‚ä¸‹ï¼š 12345678910import java.util.Date; public class Other&#123; private Date date; public Other() &#123; Date da; &#125; &#125; ä¸Šè¿°çš„Otherçš„ç±»ï¼Œåœ¨JDKå°†å…¶ç¼–è¯‘æˆclassæ–‡ä»¶æ—¶ï¼Œå¸¸é‡æ± ä¸­å¹¶æ²¡æœ‰java.util.Dateå¯¹åº”çš„CONSTANT_Class_infoå¸¸é‡æ± é¡¹ï¼Œä¸ºä»€ä¹ˆå‘¢? åœ¨Otherç±»ä¸­è™½ç„¶å®šä¹‰äº†Dateç±»åž‹çš„ä¸¤ä¸ªå˜é‡dateã€daï¼Œä½†æ˜¯JDKç¼–è¯‘çš„æ—¶å€™ï¼Œè®¤ä¸ºä½ åªæ˜¯å£°æ˜Žäº†â€œLjava/util/Dateâ€ç±»åž‹çš„å˜é‡ï¼Œå¹¶æ²¡æœ‰å®žé™…ä½¿ç”¨åˆ°Ljava/util/Dateç±»ã€‚å°†ç±»ä¿¡æ¯æ”¾ç½®åˆ°å¸¸é‡æ± ä¸­çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†åœ¨åŽç»­çš„ä»£ç ä¸­æœ‰å¯èƒ½ä¼šåå¤ç”¨åˆ°å®ƒã€‚å¾ˆæ˜¾ç„¶ï¼ŒJDKåœ¨ç¼–è¯‘Otherç±»çš„æ—¶å€™ï¼Œä¼šè§£æžåˆ°Dateç±»æœ‰æ²¡æœ‰ç”¨åˆ°ï¼Œå‘çŽ°è¯¥ç±»åœ¨ä»£ç ä¸­å°±æ²¡æœ‰ç”¨åˆ°è¿‡ï¼Œæ‰€ä»¥å°±è®¤ä¸ºæ²¡æœ‰å¿…è¦å°†å®ƒçš„ä¿¡æ¯æ”¾ç½®åˆ°å¸¸é‡æ± ä¸­äº†ã€‚ å°†ä¸Šè¿°çš„Otherç±»æ”¹å†™ä¸€ä¸‹ï¼Œä»…ä½¿ç”¨new Date()ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678import java.util.Date; public class Other&#123; public Other() &#123; new Date(); &#125; &#125; æ€»ç»“ï¼š å¯¹äºŽæŸä¸ªç±»æˆ–æŽ¥å£è€Œè¨€ï¼Œå…¶è‡ªèº«ã€çˆ¶ç±»å’Œç»§æ‰¿æˆ–å®žçŽ°çš„æŽ¥å£çš„ä¿¡æ¯ä¼šè¢«ç›´æŽ¥ç»„è£…æˆCONSTANT_Class_infoå¸¸é‡æ± é¡¹æ”¾ç½®åˆ°å¸¸é‡æ± ä¸­ï¼› ç±»ä¸­æˆ–æŽ¥å£ä¸­ä½¿ç”¨åˆ°äº†å…¶ä»–çš„ç±»ï¼Œåªæœ‰åœ¨ç±»ä¸­å®žé™…ä½¿ç”¨åˆ°äº†è¯¥ç±»æ—¶ï¼Œè¯¥ç±»çš„ä¿¡æ¯æ‰ä¼šåœ¨å¸¸é‡æ± ä¸­æœ‰å¯¹åº”çš„CONSTANT_Class_infoå¸¸é‡æ± é¡¹ï¼› ç±»ä¸­æˆ–æŽ¥å£ä¸­ä»…ä»…å®šä¹‰æŸç§ç±»åž‹çš„å˜é‡ï¼ŒJDKåªä¼šå°†å˜é‡çš„ç±»åž‹æè¿°ä¿¡æ¯ä»¥UTF-8å­—ç¬¦ä¸²ç»„æˆCONSTANT_Utf8_infoå¸¸é‡æ± é¡¹æ”¾ç½®åˆ°å¸¸é‡æ± ä¸­ï¼Œä¸Šé¢åœ¨ç±»ä¸­çš„private Date date;JDKç¼–è¯‘å™¨åªä¼šå°†è¡¨ç¤ºdateçš„æ•°æ®ç±»åž‹çš„â€œLjava/util/Dateâ€å­—ç¬¦ä¸²æ”¾ç½®åˆ°å¸¸é‡æ± ä¸­ã€‚ 10. ç±»ä¸­å¼•ç”¨åˆ°çš„fieldå­—æ®µåœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·æè¿°çš„ï¼Ÿ(CONSTANT_Fieldref_info, CONSTANT_Name_Type_info) ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬åœ¨å®šä¹‰ç±»çš„è¿‡ç¨‹ä¸­ä¼šå®šä¹‰ä¸€äº› field å­—æ®µï¼Œç„¶åŽä¼šåœ¨è¿™ä¸ªç±»çš„å…¶ä»–åœ°æ–¹ï¼ˆå¦‚æ–¹æ³•ä¸­ï¼‰ä½¿ç”¨åˆ°å®ƒã€‚æœ‰å¯èƒ½æˆ‘ä»¬åœ¨ç±»çš„æ–¹æ³•ä¸­åªä½¿ç”¨fieldå­—æ®µä¸€æ¬¡ï¼Œä¹Ÿæœ‰å¯èƒ½æˆ‘ä»¬ä¼šåœ¨ç±»å®šä¹‰çš„æ–¹æ³•ä¸­ä½¿ç”¨å®ƒå¾ˆå¤šå¾ˆå¤šæ¬¡ã€‚ ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬å®šä¸€ä¸ªå«Personçš„ç®€å•java beanï¼Œå®ƒæœ‰nameå’Œageä¸¤ä¸ªfieldå­—æ®µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920public class Person &#123; private String name; private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; &#125; åœ¨ä¸Šé¢å®šä¹‰çš„ç±»ä¸­ï¼Œæˆ‘ä»¬åœ¨Personç±»ä¸­çš„ä¸€ç³»åˆ—æ–¹æ³•é‡Œï¼Œå¤šæ¬¡å¼•ç”¨åˆ°namefieldå­—æ®µ å’Œagefieldå­—æ®µï¼Œå¯¹äºŽJVMç¼–è¯‘å™¨è€Œè¨€ï¼Œnameå’Œageåªæ˜¯ä¸€ä¸ªç¬¦å·è€Œå·²ï¼Œå¹¶ä¸”å®ƒåœ¨ç”±äºŽå®ƒå¯èƒ½ä¼šåœ¨æ­¤ç±»ä¸­é‡å¤å‡ºçŽ°å¤šæ¬¡ï¼Œæ‰€ä»¥JVMæŠŠå®ƒå½“ä½œå¸¸é‡æ¥çœ‹å¾…ï¼Œå°†nameå’Œageä»¥fieldå­—æ®µå¸¸é‡çš„å½¢å¼ä¿å­˜åˆ°å¸¸é‡æ± ä¸­ã€‚ å°†å®ƒnameå’Œageå°è£…æˆ CONSTANT_Fieldref_info å¸¸é‡æ± é¡¹ï¼Œæ”¾åˆ°å¸¸é‡æ± ä¸­ï¼Œåœ¨ç±»ä¸­å¼•ç”¨åˆ°å®ƒçš„åœ°æ–¹ï¼Œç›´æŽ¥æ”¾ç½®ä¸€ä¸ªæŒ‡å‘fieldå­—æ®µæ‰€åœ¨å¸¸é‡æ± çš„ç´¢å¼•ã€‚ ä¸Šé¢çš„Personç±»ï¼Œä½¿ç”¨javap -v PersonæŒ‡ä»¤ï¼ŒæŸ¥çœ‹classæ–‡ä»¶çš„ä¿¡æ¯ï¼Œä½ ä¼šçœ‹åˆ°ï¼Œåœ¨Personç±»ä¸­å¼•ç”¨åˆ°ageå’Œnamefieldå­—æ®µçš„åœ°æ–¹ï¼Œéƒ½æ˜¯æŒ‡å‘äº†å¸¸é‡æ± ä¸­ageå’Œnamefieldå­—æ®µå¯¹åº”çš„å¸¸é‡æ± é¡¹ä¸­ã€‚è¡¨ç¤ºfieldå­—æ®µçš„å¸¸é‡æ± é¡¹å«åšCONSTANT_Fieldref_infoã€‚ æ€Žæ ·æè¿°æŸä¸€ä¸ªfieldå­—æ®µçš„å¼•ç”¨ï¼Ÿ å®žä¾‹è§£æžï¼š çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Personç±»ä¸­å®šä¹‰çš„namefieldå­—æ®µåœ¨å¸¸é‡æ± ä¸­çš„è¡¨ç¤ºã€‚é€šè¿‡ä½¿ç”¨javap -v Personä¼šæŸ¥çœ‹åˆ°å¦‚ä¸‹çš„å¸¸é‡æ± ä¿¡æ¯ï¼š è¯·è¯»è€…çœ‹ä¸Šå›¾ä¸­namefieldå­—æ®µçš„æ•°æ®ç±»åž‹ï¼Œå®ƒåœ¨#6ä¸ªå¸¸é‡æ± é¡¹ï¼Œä»¥UTF-8ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²â€œLjava/lang/String;â€ è¡¨ç¤ºï¼Œè¿™è¡¨ç¤ºç€è¿™ä¸ªfield å­—æ®µæ˜¯java.lang.String ç±»åž‹çš„ã€‚å…³äºŽfieldå­—æ®µçš„æ•°æ®ç±»åž‹ï¼Œclassæ–‡ä»¶ä¸­å­˜å‚¨çš„æ–¹å¼å’Œæˆ‘ä»¬åœ¨æºç ä¸­å£°æ˜Žçš„æœ‰äº›ä¸ä¸€æ ·ã€‚è¯·çœ‹ä¸‹å›¾çš„å¯¹åº”å…³ç³»ï¼š æ³¨æ„ï¼š å¦‚æžœæˆ‘ä»¬åœ¨ç±»ä¸­å®šä¹‰äº†field å­—æ®µï¼Œä½†æ˜¯æ²¡æœ‰åœ¨ç±»ä¸­çš„å…¶ä»–åœ°æ–¹ç”¨åˆ°è¿™äº›å­—æ®µï¼Œå®ƒæ˜¯ä¸ä¼šè¢«ç¼–è¯‘å™¨æ”¾åˆ°å¸¸é‡æ± ä¸­çš„ã€‚ åªæœ‰åœ¨ç±»ä¸­çš„å…¶ä»–åœ°æ–¹å¼•ç”¨åˆ°äº†ï¼Œæ‰ä¼šå°†ä»–æ”¾åˆ°å¸¸é‡æ± ä¸­ã€‚ 11. ç±»ä¸­å¼•ç”¨åˆ°çš„methodæ–¹æ³•åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·æè¿°çš„ï¼Ÿ(CONSTANT_Methodref_info, CONSTANT_Name_Type_info) 1. ä¸¾ä¾‹ è¿˜æ˜¯ä»¥Personç±»ä¸ºä¾‹ã€‚åœ¨Personç±»ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†setName(String name)ã€getName()ã€setAge(int age)ã€getAge()è¿™äº›æ–¹æ³•ï¼š 123456789101112131415161718192021public class Person &#123; private String name; private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; &#125; è™½ç„¶æˆ‘ä»¬å®šä¹‰äº†æ–¹æ³•ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•æ²¡æœ‰åœ¨ç±»æ€»çš„å…¶ä»–åœ°æ–¹è¢«ç”¨åˆ°ï¼ˆå³æ²¡æœ‰åœ¨ç±»ä¸­å…¶ä»–çš„æ–¹æ³•ä¸­å¼•ç”¨åˆ°ï¼‰ï¼Œæ‰€ä»¥å®ƒä»¬çš„æ–¹æ³•å¼•ç”¨ä¿¡æ¯å¹¶ä¸ä¼šæ”¾åˆ°å¸¸é‡ä¸­ã€‚ çŽ°åœ¨æˆ‘ä»¬åœ¨ç±»ä¸­åŠ ä¸€ä¸ªæ–¹æ³• getInfo()ï¼Œè°ƒç”¨äº†getName()å’ŒgetAge() æ–¹æ³•ï¼š 1234public String getInfo() &#123; return getName()+"\t"+getAge(); &#125; è¿™æ—¶å€™JVMç¼–è¯‘å™¨ä¼šå°†getName()å’ŒgetAge()æ–¹æ³•çš„å¼•ç”¨ä¿¡æ¯åŒ…è£…æˆCONSTANT_Methodref_infoç»“æž„ä½“æ”¾å…¥åˆ°å¸¸é‡æ± ä¹‹ä¸­ã€‚ è¿™é‡Œçš„æ–¹æ³•è°ƒç”¨çš„æ–¹å¼ç‰µæ¶‰åˆ°Javaéžå¸¸é‡è¦çš„ä¸€ä¸ªæœ¯è¯­å’Œæœºåˆ¶ï¼Œå«åŠ¨æ€ç»‘å®šã€‚è¿™ä¸ªåŠ¨æ€ç»‘å®šé—®é¢˜ä»¥åŽåœ¨å•ç‹¬è°ˆè°ˆã€‚ 2. è¡¨ç¤ºä¸€ä¸ªæ–¹æ³•å¼•ç”¨ 3. æ–¹æ³•æè¿°ç¬¦çš„ç»„æˆ 4. getName() æ–¹æ³•å¼•ç”¨åœ¨å¸¸é‡æ± ä¸­çš„è¡¨ç¤º 12. ç±»ä¸­å¼•ç”¨åˆ°æŸä¸ªæŽ¥å£ä¸­å®šä¹‰çš„methodæ–¹æ³•åœ¨å¸¸é‡æ± ä¸­æ˜¯æ€Žæ ·æè¿°çš„ï¼Ÿ(CONSTANT_InterfaceMethodref_info, CONSTANT_Name_Type_info) å½“æˆ‘ä»¬åœ¨æŸä¸ªç±»ä¸­ä½¿ç”¨åˆ°äº†æŸä¸ªæŽ¥å£ä¸­çš„æ–¹æ³•ï¼ŒJVMä¼šå°†ç”¨åˆ°çš„æŽ¥å£ä¸­çš„æ–¹æ³•ä¿¡æ¯æ–¹çŸ¥é“è¿™ä¸ªç±»çš„å¸¸é‡æ± ä¸­ã€‚ æ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªWorkeræŽ¥å£ï¼Œå’Œä¸€ä¸ªBossç±»ï¼Œåœ¨Bossç±»ä¸­è°ƒç”¨äº†WorkeræŽ¥å£ä¸­çš„æ–¹æ³•ï¼Œè¿™æ—¶å€™åœ¨Bossç±»çš„å¸¸é‡æ± ä¸­ä¼šæœ‰WorkeræŽ¥å£çš„æ–¹æ³•çš„å¼•ç”¨è¡¨ç¤ºã€‚ 12345public interface Worker&#123; public void work(); &#125; 12345678public class Boss &#123; public void makeMoney(Worker worker) &#123; worker.work(); &#125; &#125; å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨Bossç±»çš„makeMoney()æ–¹æ³•ä¸­è°ƒç”¨äº†WorkeræŽ¥å£çš„work()æ–¹æ³•ï¼Œæœºå™¨æŒ‡ä»¤æ˜¯é€šè¿‡invokeinterfaceæŒ‡ä»¤å®Œæˆçš„ï¼ŒinvokeinterfaceæŒ‡ä»¤åŽé¢çš„æ“ä½œæ•°ï¼Œæ˜¯æŒ‡å‘äº†Bosså¸¸é‡æ± ä¸­WorkeræŽ¥å£çš„work()æ–¹æ³•æè¿°ï¼Œè¡¨ç¤ºçš„æ„æ€å°±æ˜¯ï¼šâ€œæˆ‘è¦è°ƒç”¨WorkeræŽ¥å£çš„work()æ–¹æ³•â€ã€‚ WorkeræŽ¥å£çš„work()æ–¹æ³•å¼•ç”¨ä¿¡æ¯ï¼ŒJVMä¼šä½¿ç”¨CONSTANT_InterfaceMethodref_infoç»“æž„ä½“æ¥æè¿°ï¼ŒCONSTANT_InterfaceMethodref_infoå®šä¹‰å¦‚ä¸‹ï¼š CONSTANT_InterfaceMethodref_infoç»“æž„ä½“å’Œä¸Šé¢ä»‹ç»çš„CONSTANT_Methodref_info ç»“æž„ä½“å¾ˆåŸºæœ¬ä¸Šç›¸åŒï¼Œå®ƒä»¬çš„ä¸åŒç‚¹åªæœ‰ï¼š CONSTANT_InterfaceMethodref_info çš„tag å€¼ä¸º11ï¼Œè€ŒCONSTANT_Methodref_infoçš„tagå€¼ä¸º10ï¼› CONSTANT_InterfaceMethodref_info æè¿°çš„æ˜¯æŽ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œè€ŒCONSTANT_Methodref_infoæè¿°çš„æ˜¯å®žä¾‹ç±»ä¸­çš„æ–¹æ³•ï¼› å…¶ä»–çš„åŸºæœ¬ä¸Žä¸Šé¢ä¸€ä¸ªä¸€æ¯›ä¸€æ ·ã€‚å‚ç…§ä¸Šé¢ä¸ªç†è§£å³å¯ã€‚ 13. CONSTANT_MethodType_infoï¼ŒCONSTANT_MethodHandle_infoï¼ŒCONSTANT_InvokeDynamic_info è¿™ä¸‰é¡¹ä¸»è¦æ˜¯ä¸ºäº†è®©Javaè¯­è¨€æ”¯æŒåŠ¨æ€è¯­è¨€ç‰¹æ€§è€Œåœ¨Java 7 ç‰ˆæœ¬ä¸­æ–°å¢žçš„ä¸‰ä¸ªå¸¸é‡æ± é¡¹ï¼Œåªä¼šåœ¨æžå…¶ç‰¹åˆ«çš„æƒ…å†µèƒ½ç”¨åˆ°å®ƒï¼Œåœ¨classæ–‡ä»¶ä¸­å‡ ä¹Žä¸ä¼šç”Ÿæˆè¿™ä¸‰ä¸ªå¸¸é‡æ± é¡¹ã€‚ å…¶å®žæˆ‘èŠ±äº†ä¸€äº›æ—¶é—´æ¥ç ”ç©¶è¿™ä¸‰é¡¹ï¼Œå¹¶ä¸”æƒ³é€šè¿‡å„ç§æ–¹å¼ç”Ÿæˆè¿™ä¸‰é¡¹ï¼Œä¸è¿‡æ²¡æœ‰æˆåŠŸï¼Œæœ€åŽæžçš„è¿˜æ˜¯è¿·è¿·ç³Šç³Šçš„ã€‚ä»Žæˆ‘äº†è§£åˆ°çš„ä¿¡æ¯æ¥çœ‹ï¼ŒJava 7å¯¹åŠ¨æ€è¯­è¨€çš„æ”¯æŒå¾ˆç¬¨æ‹™ï¼Œå¹¶ä¸”å½“å‰æ²¡æœ‰ä»€ä¹ˆåº”ç”¨ä»·å€¼ï¼Œç„¶åŽå°±å¯¹ç€ä¸‰é¡¹çš„ç ”ç©¶å…ˆæ”¾ä¸€æ”¾äº†ã€‚ï¼‰]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¡¥å……é˜…è¯»1-Classç±»æ–‡ä»¶ç»“æž„]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E8%A1%A5%E5%85%85%E9%98%85%E8%AF%BB-Class%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%2F</url>
    <content type="text"><![CDATA[æ€»ä½“æ¦‚è§ˆä¸€ä¸‹Classæ–‡ä»¶æ˜¯ä»€ä¹ˆä»¥åŠæœ‰ä»€ä¹ˆã€‚ æ•´ä½“æ„ŸçŸ¥ classæ–‡ä»¶æ˜¯ä¸€ç§8ä½å­—èŠ‚çš„äºŒè¿›åˆ¶æµæ–‡ä»¶ï¼Œ å„ä¸ªæ•°æ®é¡¹æŒ‰é¡ºåºç´§å¯†çš„ä»Žå‰å‘åŽæŽ’åˆ—ï¼Œ ç›¸é‚»çš„é¡¹ä¹‹é—´æ²¡æœ‰é—´éš™ï¼Œ è¿™æ ·å¯ä»¥ä½¿å¾—classæ–‡ä»¶éžå¸¸ç´§å‡‘ï¼Œ ä½“ç§¯è½»å·§ï¼Œ å¯ä»¥è¢«JVMå¿«é€Ÿçš„åŠ è½½è‡³å†…å­˜ï¼Œ å¹¶ä¸”å æ®è¾ƒå°‘çš„å†…å­˜ç©ºé—´ã€‚ æˆ‘ä»¬çš„Javaæºæ–‡ä»¶ï¼Œ åœ¨è¢«ç¼–è¯‘ä¹‹åŽï¼Œ æ¯ä¸ªç±»ï¼ˆæˆ–è€…æŽ¥å£ï¼‰éƒ½å•ç‹¬å æ®ä¸€ä¸ªclassæ–‡ä»¶ï¼Œ å¹¶ä¸”ç±»ä¸­çš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šåœ¨classæ–‡ä»¶ä¸­æœ‰ç›¸åº”çš„æè¿°ï¼Œ ç”±äºŽclassæ–‡ä»¶å¾ˆçµæ´»ï¼Œ å®ƒç”šè‡³æ¯”Javaæºæ–‡ä»¶æœ‰ç€æ›´å¼ºçš„æè¿°èƒ½åŠ›ã€‚ Classæ–‡ä»¶æ ¼å¼ æ¢æˆè¡¨æ ¼çš„å½¢å¼ï¼š ç±»åž‹ åç§° æ•°é‡ u4 magic 1 u2 minor_version 1 u2 major_version 1 u2 constant_pool_count 1 cp_info constant_pool constant_pool_count - 1 u2 access_flags 1 u2 this_class 1 u2 super_class 1 u2 interfaces_count 1 u2 interfaces interfaces_count u2 fields_count 1 field_info fields fields_count u2 methods_count 1 method_info methods methods_count u2 attribute_count 1 attribute_info attributes attributes_count NO1. é­”æ•°(magic) æ‰€æœ‰çš„ç”±Javaç¼–è¯‘å™¨ç¼–è¯‘è€Œæˆçš„classæ–‡ä»¶çš„å‰4ä¸ªå­—èŠ‚éƒ½æ˜¯â€œ0xCAFEBABEâ€ å®ƒçš„ä½œç”¨åœ¨äºŽï¼š å½“JVMåœ¨å°è¯•åŠ è½½æŸä¸ªæ–‡ä»¶åˆ°å†…å­˜ä¸­æ¥çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆåˆ¤æ–­æ­¤classæ–‡ä»¶æœ‰æ²¡æœ‰JVMè®¤ä¸ºå¯ä»¥æŽ¥å—çš„â€œç­¾åâ€ï¼Œå³JVMä¼šé¦–å…ˆè¯»å–æ–‡ä»¶çš„å‰4ä¸ªå­—èŠ‚ï¼Œåˆ¤æ–­è¯¥4ä¸ªå­—èŠ‚æ˜¯å¦æ˜¯â€œ0xCAFEBABEâ€ï¼Œå¦‚æžœæ˜¯ï¼Œåˆ™JVMä¼šè®¤ä¸ºå¯ä»¥å°†æ­¤æ–‡ä»¶å½“ä½œclassæ–‡ä»¶æ¥åŠ è½½å¹¶ä½¿ç”¨ã€‚ NO2.ç‰ˆæœ¬å·(minor_version,major_version) ä¸»ç‰ˆæœ¬å·å’Œæ¬¡ç‰ˆæœ¬å·åœ¨classæ–‡ä»¶ä¸­å„å ä¸¤ä¸ªå­—èŠ‚ï¼Œå‰¯ç‰ˆæœ¬å·å ç”¨ç¬¬5ã€6ä¸¤ä¸ªå­—èŠ‚ï¼Œè€Œä¸»ç‰ˆæœ¬å·åˆ™å ç”¨ç¬¬7ï¼Œ8ä¸¤ä¸ªå­—èŠ‚ã€‚JDK1.0çš„ä¸»ç‰ˆæœ¬å·ä¸º45ï¼Œä»¥åŽçš„æ¯ä¸ªæ–°ä¸»ç‰ˆæœ¬éƒ½ä¼šåœ¨åŽŸå…ˆç‰ˆæœ¬çš„åŸºç¡€ä¸ŠåŠ 1ã€‚è‹¥çŽ°åœ¨ä½¿ç”¨çš„æ˜¯JDK1.7ç¼–è¯‘å‡ºæ¥çš„classæ–‡ä»¶ï¼Œåˆ™ç›¸åº”çš„ä¸»ç‰ˆæœ¬å·åº”è¯¥æ˜¯51,å¯¹åº”çš„7ï¼Œ8ä¸ªå­—èŠ‚çš„åå…­è¿›åˆ¶çš„å€¼åº”è¯¥æ˜¯ 0x33ã€‚ JVMåœ¨åŠ è½½classæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šè¯»å–å‡ºä¸»ç‰ˆæœ¬å·ï¼Œç„¶åŽæ¯”è¾ƒè¿™ä¸ªclassæ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·å’ŒJVMæœ¬èº«çš„ç‰ˆæœ¬å·ï¼Œå¦‚æžœJVMæœ¬èº«çš„ç‰ˆæœ¬å·å°äºŽclassæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼ŒJVMä¼šè®¤ä¸ºåŠ è½½ä¸äº†è¿™ä¸ªclassæ–‡ä»¶ï¼Œä¼šæŠ›å‡ºæˆ‘ä»¬ç»å¸¸è§åˆ°çš„&quot;java.lang.UnsupportedClassVersionError: Bad version number in .class file &quot; Erroré”™è¯¯ï¼›åä¹‹ï¼ŒJVMä¼šè®¤ä¸ºå¯ä»¥åŠ è½½æ­¤classæ–‡ä»¶ï¼Œç»§ç»­åŠ è½½æ­¤classæ–‡ä»¶ã€‚ NO3.å¸¸é‡æ± è®¡æ•°å™¨(constant_pool_count) å¸¸é‡æ± æ˜¯classæ–‡ä»¶ä¸­éžå¸¸é‡è¦çš„ç»“æž„ï¼Œå®ƒæè¿°ç€æ•´ä¸ªclassæ–‡ä»¶çš„å­—é¢é‡ä¿¡æ¯ã€‚ å¸¸é‡æ± æ˜¯ç”±ä¸€ç»„constant_poolç»“æž„ä½“æ•°ç»„ç»„æˆçš„ï¼Œè€Œæ•°ç»„çš„å¤§å°åˆ™ç”±å¸¸é‡æ± è®¡æ•°å™¨æŒ‡å®šã€‚å¸¸é‡æ± è®¡æ•°å™¨constant_pool_count çš„å€¼ç­‰äºŽconstant_poolè¡¨ä¸­çš„æˆå‘˜æ•°+ 1ã€‚constant_poolè¡¨çš„ç´¢å¼•å€¼åªæœ‰åœ¨å¤§äºŽ 0 ä¸”å°äºŽconstant_pool_countæ—¶(å³1~(constant_pool_count-1))æ‰ä¼šè¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ã€‚ è¿™ä¸ªå®¹é‡è®¡æ•°æ˜¯ä»Ž1è€Œä¸æ˜¯ä»Ž0å¼€å§‹çš„ï¼Œå¦‚æžœå¸¸é‡æ± å®¹é‡ä¸ºåå…­è¿›åˆ¶æ•°0x0016ï¼Œå³åè¿›åˆ¶22ï¼Œè¿™å°±ä»£è¡¨ç€å¸¸é‡æ± ä¸­æœ‰21ä¸ªå¸¸é‡ï¼Œç´¢å¼•å€¼èŒƒå›´ä¸º1-21ã€‚åœ¨Classæ–‡ä»¶æ ¼å¼è§„èŒƒåˆ¶å®šæ—¶ï¼Œè®¾è®¡è€…å°†ç¬¬0é¡¹å¸¸é‡ç©ºå‡ºæ¥æ˜¯æœ‰ç‰¹æ®Šè€ƒè™‘çš„ï¼Œç”¨äºŽåœ¨ç‰¹å®šæƒ…å†µä¸‹è¡¨è¾¾â€œä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®â€ã€‚ NO4.å¸¸é‡æ± æ•°æ®åŒº(constant_pool[contstant_pool_count-1]) å¸¸é‡æ± ï¼Œconstant_poolæ˜¯ä¸€ç§è¡¨ç»“æž„,å®ƒåŒ…å« Class æ–‡ä»¶ç»“æž„åŠå…¶å­ç»“æž„ä¸­å¼•ç”¨çš„æ‰€æœ‰å­—ç¬¦ä¸²å¸¸é‡ã€ ç±»æˆ–æŽ¥å£åã€å­—æ®µåå’Œå…¶å®ƒå¸¸é‡ã€‚ å¸¸é‡æ± ä¸­çš„æ¯ä¸€é¡¹éƒ½å…·å¤‡ç›¸åŒçš„æ ¼å¼ç‰¹å¾â€”â€”ç¬¬ä¸€ä¸ªå­—èŠ‚ä½œä¸ºç±»åž‹æ ‡è®°ç”¨äºŽè¯†åˆ«è¯¥é¡¹æ˜¯å“ªç§ç±»åž‹çš„å¸¸é‡ï¼Œç§°ä¸º â€œtag byteâ€ ã€‚å¸¸é‡æ± çš„ç´¢å¼•èŒƒå›´æ˜¯ 1 è‡³constant_pool_countâˆ’1ã€‚å¸¸é‡æ± çš„å…·ä½“ç»†èŠ‚æˆ‘ä»¬ä¼šç¨åŽè®¨è®ºã€‚ NO6.è®¿é—®æ ‡å¿—(access_flags) è®¿é—®æ ‡å¿—ï¼Œaccess_flags æ˜¯ä¸€ç§æŽ©ç æ ‡å¿—ï¼Œç”¨äºŽè¡¨ç¤ºæŸä¸ªç±»æˆ–è€…æŽ¥å£çš„è®¿é—®æƒé™åŠåŸºç¡€å±žæ€§ã€‚ NO7.ç±»ç´¢å¼•(this_class) ç±»ç´¢å¼•ï¼Œthis_classçš„å€¼å¿…é¡»æ˜¯å¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚constant_poolè¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºCONSTANT_Class_info ç±»åž‹å¸¸é‡ï¼Œè¡¨ç¤ºè¿™ä¸ª Class æ–‡ä»¶æ‰€å®šä¹‰çš„ç±»æˆ–æŽ¥å£ã€‚ NO8.çˆ¶ç±»ç´¢å¼•(super_class) çˆ¶ç±»ç´¢å¼•ï¼Œå¯¹äºŽç±»æ¥è¯´ï¼Œsuper_class çš„å€¼å¿…é¡»ä¸º 0 æˆ–è€…æ˜¯å¯¹constant_pool è¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚å¦‚æžœå®ƒçš„å€¼ä¸ä¸º 0ï¼Œé‚£ constant_pool è¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºCONSTANT_Class_info ç±»åž‹å¸¸é‡ï¼Œè¡¨ç¤ºè¿™ä¸ª Class æ–‡ä»¶æ‰€å®šä¹‰çš„ç±»çš„ç›´æŽ¥çˆ¶ç±»ã€‚å½“å‰ç±»çš„ç›´æŽ¥çˆ¶ç±»ï¼Œä»¥åŠå®ƒæ‰€æœ‰é—´æŽ¥çˆ¶ç±»çš„access_flag ä¸­éƒ½ä¸èƒ½å¸¦æœ‰ACC_FINAL æ ‡è®°ã€‚å¯¹äºŽæŽ¥å£æ¥è¯´ï¼Œå®ƒçš„Classæ–‡ä»¶çš„super_classé¡¹çš„å€¼å¿…é¡»æ˜¯å¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚constant_poolè¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºä»£è¡¨ java.lang.Object çš„ CONSTANT_Class_info ç±»åž‹å¸¸é‡ ã€‚å¦‚æžœ Class æ–‡ä»¶çš„ super_classçš„å€¼ä¸º 0ï¼Œé‚£è¿™ä¸ªClassæ–‡ä»¶åªå¯èƒ½æ˜¯å®šä¹‰çš„æ˜¯java.lang.Objectç±»ï¼Œåªæœ‰å®ƒæ˜¯å”¯ä¸€æ²¡æœ‰çˆ¶ç±»çš„ç±»ã€‚ NO9.æŽ¥å£è®¡æ•°å™¨(interfaces_count) æŽ¥å£è®¡æ•°å™¨ï¼Œinterfaces_countçš„å€¼è¡¨ç¤ºå½“å‰ç±»æˆ–æŽ¥å£çš„ç›´æŽ¥çˆ¶æŽ¥å£æ•°é‡ã€‚ NO10.æŽ¥å£ä¿¡æ¯æ•°æ®åŒº(interfaces[interfaces_count]) æŽ¥å£è¡¨ï¼Œinterfaces[]æ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ï¼Œ å®ƒçš„é•¿åº¦ä¸º interfaces_countã€‚æ¯ä¸ªæˆå‘˜ interfaces[i] å¿…é¡»ä¸º CONSTANT_Class_infoç±»åž‹å¸¸é‡ï¼Œå…¶ä¸­ 0 â‰¤ i &lt;interfaces_countã€‚åœ¨interfaces[]æ•°ç»„ä¸­ï¼Œæˆå‘˜æ‰€è¡¨ç¤ºçš„æŽ¥å£é¡ºåºå’Œå¯¹åº”çš„æºä»£ç ä¸­ç»™å®šçš„æŽ¥å£é¡ºåºï¼ˆä»Žå·¦è‡³å³ï¼‰ä¸€æ ·ï¼Œå³interfaces[0]å¯¹åº”çš„æ˜¯æºä»£ç ä¸­æœ€å·¦è¾¹çš„æŽ¥å£ã€‚ NO11.å­—æ®µè®¡æ•°å™¨(fields_count) å­—æ®µè®¡æ•°å™¨ï¼Œfields_countçš„å€¼è¡¨ç¤ºå½“å‰ Class æ–‡ä»¶ fields[]æ•°ç»„çš„æˆå‘˜ä¸ªæ•°ã€‚ fields[]æ•°ç»„ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªfield_infoç»“æž„çš„æ•°æ®é¡¹ï¼Œå®ƒç”¨äºŽè¡¨ç¤ºè¯¥ç±»æˆ–æŽ¥å£å£°æ˜Žçš„ç±»å­—æ®µæˆ–è€…å®žä¾‹å­—æ®µã€‚ NO12.å­—æ®µä¿¡æ¯æ•°æ®åŒº(fields[fields_count]) å­—æ®µè¡¨ï¼Œfields[]æ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªfields_infoç»“æž„çš„æ•°æ®é¡¹ï¼Œç”¨äºŽè¡¨ç¤ºå½“å‰ç±»æˆ–æŽ¥å£ä¸­æŸä¸ªå­—æ®µçš„å®Œæ•´æè¿°ã€‚ fields[]æ•°ç»„æè¿°å½“å‰ç±»æˆ–æŽ¥å£å£°æ˜Žçš„æ‰€æœ‰å­—æ®µï¼Œä½†ä¸åŒ…æ‹¬ä»Žçˆ¶ç±»æˆ–çˆ¶æŽ¥å£ç»§æ‰¿çš„éƒ¨åˆ†ã€‚ NO13.æ–¹æ³•è®¡æ•°å™¨(methods_count) æ–¹æ³•è®¡æ•°å™¨ï¼Œ methods_countçš„å€¼è¡¨ç¤ºå½“å‰Class æ–‡ä»¶ methods[]æ•°ç»„çš„æˆå‘˜ä¸ªæ•°ã€‚Methods[]æ•°ç»„ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª method_info ç»“æž„çš„æ•°æ®é¡¹ã€‚ NO14.æ–¹æ³•ä¿¡æ¯æ•°æ®åŒº(methods[methods_count]) æ–¹æ³•è¡¨ï¼Œmethods[] æ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»æ˜¯ä¸€ä¸ª method_info ç»“æž„çš„æ•°æ®é¡¹ï¼Œç”¨äºŽè¡¨ç¤ºå½“å‰ç±»æˆ–æŽ¥å£ä¸­æŸä¸ªæ–¹æ³•çš„å®Œæ•´æè¿°ã€‚å¦‚æžœæŸä¸ªmethod_info ç»“æž„çš„access_flags é¡¹æ—¢æ²¡æœ‰è®¾ç½® ACC_NATIVE æ ‡å¿—ä¹Ÿæ²¡æœ‰è®¾ç½®ACC_ABSTRACT æ ‡å¿—ï¼Œé‚£ä¹ˆå®ƒæ‰€å¯¹åº”çš„æ–¹æ³•ä½“å°±åº”å½“å¯ä»¥è¢« Java è™šæ‹Ÿæœºç›´æŽ¥ä»Žå½“å‰ç±»åŠ è½½ï¼Œè€Œä¸éœ€è¦å¼•ç”¨å…¶å®ƒç±»ã€‚ method_infoç»“æž„å¯ä»¥è¡¨ç¤ºç±»å’ŒæŽ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å®žä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€å®žä¾‹åˆå§‹åŒ–æ–¹æ³•æ–¹æ³•å’Œç±»æˆ–æŽ¥å£åˆå§‹åŒ–æ–¹æ³•æ–¹æ³• ã€‚methods[]æ•°ç»„åªæè¿°å½“å‰ç±»æˆ–æŽ¥å£ä¸­å£°æ˜Žçš„æ–¹æ³•ï¼Œä¸åŒ…æ‹¬ä»Žçˆ¶ç±»æˆ–çˆ¶æŽ¥å£ç»§æ‰¿çš„æ–¹æ³•ã€‚ NO15.å±žæ€§è®¡æ•°å™¨(attributes_count) å±žæ€§è®¡æ•°å™¨ï¼Œattributes_countçš„å€¼è¡¨ç¤ºå½“å‰ Class æ–‡ä»¶attributesè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚attributesè¡¨ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªattribute_info ç»“æž„çš„æ•°æ®é¡¹ã€‚ NO16.å±žæ€§ä¿¡æ¯æ•°æ®åŒº(attributes[attributes_count]) å±žæ€§è¡¨ï¼Œattributes è¡¨çš„æ¯ä¸ªé¡¹çš„å€¼å¿…é¡»æ˜¯attribute_infoç»“æž„ã€‚ åœ¨Java 7 è§„èŒƒé‡Œï¼ŒClassæ–‡ä»¶ç»“æž„ä¸­çš„attributesè¡¨çš„é¡¹åŒ…æ‹¬ä¸‹åˆ—å®šä¹‰çš„å±žæ€§ï¼š InnerClasses ã€ EnclosingMethod ã€ Synthetic ã€Signatureã€SourceFileï¼ŒSourceDebugExtension ã€Deprecatedã€RuntimeVisibleAnnotations ã€RuntimeInvisibleAnnotationsä»¥åŠBootstrapMethodså±žæ€§ã€‚ å¯¹äºŽæ”¯æŒ Class æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·ä¸º 49.0 æˆ–æ›´é«˜çš„ Java è™šæ‹Ÿæœºå®žçŽ°ï¼Œå¿…é¡»æ­£ç¡®è¯†åˆ«å¹¶è¯»å–attributesè¡¨ä¸­çš„Signatureã€RuntimeVisibleAnnotationså’ŒRuntimeInvisibleAnnotationså±žæ€§ã€‚å¯¹äºŽæ”¯æŒClassæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·ä¸º 51.0 æˆ–æ›´é«˜çš„ Java è™šæ‹Ÿæœºå®žçŽ°ï¼Œå¿…é¡»æ­£ç¡®è¯†åˆ«å¹¶è¯»å– attributesè¡¨ä¸­çš„BootstrapMethodså±žæ€§ã€‚Java 7 è§„èŒƒ è¦æ±‚ä»»ä¸€ Java è™šæ‹Ÿæœºå®žçŽ°å¯ä»¥è‡ªåŠ¨å¿½ç•¥ Class æ–‡ä»¶çš„ attributesè¡¨ä¸­çš„è‹¥å¹² ï¼ˆç”šè‡³å…¨éƒ¨ï¼‰ å®ƒä¸å¯è¯†åˆ«çš„å±žæ€§é¡¹ã€‚ä»»ä½•æœ¬è§„èŒƒæœªå®šä¹‰çš„å±žæ€§ä¸èƒ½å½±å“Classæ–‡ä»¶çš„è¯­ä¹‰ï¼Œåªèƒ½æä¾›é™„åŠ çš„æè¿°ä¿¡æ¯ ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å†…å­˜åˆ†é…å’Œå›žæ”¶ç­–ç•¥]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%92%8C%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬åç¯‡æ–‡ç« ï¼Œæœ¬ç« å¯¹å†…å­˜åˆ†é…å’Œåžƒåœ¾å›žæ”¶çš„ç»†èŠ‚å†æ¬¡è¯¦ç»†è¯´æ˜Žä¸€ä¸‹ï¼Œå¹¶ä¸”è¯´æ˜Žä¸€ä¸‹é€ƒé€¸åˆ†æž/æ ˆä¸Šåˆ†é…ä»¥åŠTLABä¸¤ç§æ–¹å¼çš„æ¦‚å¿µå’ŒåŽŸç†ã€‚ 1. å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é… å‰é¢æ–‡ç« æ›¾ä»‹ç»HotSpotè™šæ‹Ÿæœºæ–°ç”Ÿä»£å†…å­˜å¸ƒå±€åŠç®—æ³•: ï¼ˆ1ï¼‰ã€å°†æ–°ç”Ÿä»£å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼› ï¼ˆ2ï¼‰ã€æ¯æ¬¡ä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€å—Survivorï¼› ï¼ˆ3ï¼‰ã€å½“å›žæ”¶æ—¶ï¼Œå°†Edenå’Œä½¿ç”¨ä¸­çš„Survivorä¸­è¿˜å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦å¤–ä¸€å—Survivorï¼› ï¼ˆ4ï¼‰ã€è€ŒåŽæ¸…ç†æŽ‰Edenå’Œä½¿ç”¨è¿‡çš„Survivorç©ºé—´ï¼› ï¼ˆ5ï¼‰ã€åŽé¢å°±ä½¿ç”¨Edenå’Œå¤åˆ¶åˆ°çš„é‚£ä¸€å—Survivorç©ºé—´ï¼Œé‡å¤æ­¥éª¤3ï¼› é»˜è®¤Edenï¼šSurvivor=8:1ï¼Œå³æ¯æ¬¡å¯ä»¥ä½¿ç”¨90%çš„ç©ºé—´ï¼Œåªæœ‰ä¸€å—Survivorçš„ç©ºé—´è¢«æµªè´¹ï¼› å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£EdenåŒºä¸­åˆ†é…ï¼› å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼ŒJVMå°†å‘èµ·ä¸€æ¬¡Minor GCï¼ˆæ–°ç”Ÿä»£GCï¼‰ï¼› Minor GCæ—¶ï¼Œå¦‚æžœå‘çŽ°å­˜æ´»çš„å¯¹è±¡æ— æ³•å…¨éƒ¨æ”¾å…¥Survivorç©ºé—´ï¼Œåªå¥½é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶æå‰è½¬ç§»åˆ°è€å¹´ä»£ã€‚ 2. å¤§å¯¹è±¡ç›´æŽ¥è¿›å…¥è€å¹´ä»£ å¤§å¯¹è±¡æŒ‡éœ€è¦å¤§é‡è¿žç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡ï¼Œå¦‚ï¼Œå¾ˆé•¿çš„å­—ç¬¦ä¸²ã€æ•°ç»„ï¼› ç»å¸¸å‡ºçŽ°å¤§å¯¹è±¡å®¹æ˜“å¯¼è‡´å†…å­˜è¿˜æœ‰ä¸å°‘ç©ºé—´å°±æå‰è§¦å‘GC,ä»¥èŽ·å–è¶³å¤Ÿçš„è¿žç»­ç©ºé—´æ¥å­˜æ”¾å®ƒä»¬ï¼Œæ‰€ä»¥åº”è¯¥å°½é‡é¿å…ä½¿ç”¨åˆ›å»ºå¤§å¯¹è±¡ï¼› -XX:PretenureSizeThresholdï¼š å¯ä»¥è®¾ç½®è¿™ä¸ªé˜ˆå€¼ï¼Œå¤§äºŽè¿™ä¸ªå‚æ•°å€¼çš„å¯¹è±¡ç›´æŽ¥åœ¨è€å¹´ä»£åˆ†é…ï¼› é»˜è®¤ä¸º0ï¼ˆæ— æ•ˆï¼‰ï¼Œä¸”åªå¯¹Serailå’ŒParNewä¸¤æ¬¾æ”¶é›†å™¨æœ‰æ•ˆï¼› å¦‚æžœéœ€è¦ä½¿ç”¨è¯¥å‚æ•°ï¼Œå¯è€ƒè™‘ParNew+CMSç»„åˆã€‚ 3. é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£ JVMç»™æ¯ä¸ªå¯¹è±¡å®šä¹‰ä¸€ä¸ªå¯¹è±¡å¹´é¾„è®¡æ•°å™¨ï¼Œå…¶è®¡ç®—æµç¨‹å¦‚ä¸‹ï¼š åœ¨Edenä¸­åˆ†é…çš„å¯¹è±¡ï¼Œç»Minor GCåŽè¿˜å­˜æ´»ï¼Œå°±å¤åˆ¶ç§»åŠ¨åˆ°SurvivoråŒºï¼Œå¹´é¾„ä¸º1ï¼› è€ŒåŽæ¯ç»ä¸€æ¬¡Minor GCåŽè¿˜å­˜æ´»ï¼Œåœ¨SurvivoråŒºå¤åˆ¶ç§»åŠ¨ä¸€æ¬¡ï¼Œå¹´é¾„å°±å¢žåŠ 1å²ï¼› å¦‚æžœå¹´é¾„è¾¾åˆ°ä¸€å®šç¨‹åº¦ï¼Œå°±æ™‹å‡åˆ°è€å¹´ä»£ä¸­ï¼› -XX:MaxTenuringThresholdï¼š è®¾ç½®æ–°ç”Ÿä»£å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œé»˜è®¤ä¸º15ï¼› 4. åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š JVMä¸ºæ›´å¥½é€‚åº”ä¸åŒç¨‹åºï¼Œä¸æ˜¯æ°¸è¿œè¦æ±‚ç­‰åˆ°MaxTenuringThresholdä¸­è®¾ç½®çš„å¹´é¾„ï¼› å¦‚æžœåœ¨Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°æ€»å’Œå¤§äºŽSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¤§äºŽæˆ–ç­‰äºŽè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æŽ¥è¿›å…¥è€å¹´ä»£ 5. ç©ºé—´åˆ†é…æ‹…ä¿ åœ¨å‰é¢æ›¾ç®€å•ä»‹ç»è¿‡åˆ†é…æ‹…ä¿ï¼š å½“Survivorç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œéœ€è¦ä¾èµ–å…¶ä»–å†…å­˜ï¼ˆè€å¹´ä»£ï¼‰è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆHandle Promotionï¼‰ï¼› åˆ†é…æ‹…ä¿çš„æµç¨‹å¦‚ä¸‹ï¼š åœ¨å‘ç”ŸMinor GCå‰ï¼ŒJVMå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿žç»­ç©ºé—´æ˜¯å¦å¤§äºŽæ–°ç”Ÿæ‰€æœ‰å¯¹è±¡ç©ºé—´ï¼› å¦‚æžœå¤§äºŽï¼Œé‚£å¯ä»¥ç¡®ä¿Minor GCæ˜¯å®‰å…¨çš„ï¼› å¦‚æžœä¸å¤§äºŽï¼Œåˆ™JVMæŸ¥çœ‹HandlePromotionFailureå€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼› å¦‚æžœå…è®¸ï¼Œå°±ç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿žç»­ç©ºé—´æ˜¯å¦å¤§äºŽåŽ†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼› å¦‚æžœå¤§äºŽï¼Œå°†å°è¯•è¿›è¡Œä¸€æ¬¡Minor GCï¼Œä½†è¿™æ˜¯æœ‰é£Žé™©çš„ï¼› å¦‚æžœå°äºŽæˆ–HandlePromotionFailureå€¼ä¸å…è®¸å†’é™©ï¼Œé‚£è¿™äº›ä¹Ÿè¦æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡Full GCï¼› å°è¯•Minor GCçš„é£Žé™©â€“æ‹…ä¿å¤±è´¥ï¼š å› ä¸ºå°è¯•Minor GCå‰é¢ï¼Œæ— æ³•çŸ¥é“å­˜æ´»çš„å¯¹è±¡å¤§å°ï¼Œæ‰€ä»¥ä½¿ç”¨åŽ†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ä½œä¸ºç»éªŒå€¼ï¼› å‡å¦‚å°è¯•çš„Minor GCæœ€ç»ˆå­˜æ´»çš„å¯¹è±¡è¿œè¿œé«˜äºŽç»éªŒå€¼çš„è¯ï¼Œä¼šå¯¼è‡´æ‹…ä¿å¤±è´¥ï¼ˆHandle Promotion Failureï¼‰ï¼› å¤±è´¥åŽåªæœ‰é‡æ–°å‘èµ·ä¸€æ¬¡Full GCï¼Œè¿™ç»•äº†ä¸€ä¸ªå¤§åœˆï¼Œä»£ä»·è¾ƒé«˜ï¼› ä½†ä¸€èˆ¬è¿˜æ˜¯è¦å¼€å¯HandlePromotionFailureï¼Œé¿å…Full GCè¿‡äºŽé¢‘ç¹ï¼Œè€Œä¸”æ‹…ä¿å¤±è´¥æ¦‚çŽ‡è¿˜æ˜¯æ¯”è¾ƒä½Žçš„ï¼› JDK6-u24åŽï¼ŒJVMä»£ç ä¸­å·²ç»ä¸å†ä½¿ç”¨HandlePromotionFailureå‚æ•°äº†ï¼› è§„åˆ™å˜ä¸ºï¼š â­â­â­åªè¦è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿žç»­ç©ºé—´å¤§äºŽæ–°ç”Ÿæ‰€æœ‰å¯¹è±¡ç©ºé—´æˆ–åŽ†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå°±ä¼šè¿›è¡ŒMinor GCï¼›å¦åˆ™è¿›è¡ŒFull GCï¼› â­â­â­å³è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿žç»­ç©ºé—´å°äºŽæ–°ç”Ÿæ‰€æœ‰å¯¹è±¡ç©ºé—´æ—¶ï¼Œä¸å†æ£€æŸ¥HandelPromotionFailureï¼Œè€Œç›´æŽ¥æ£€æŸ¥åŽ†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼› 6. é€ƒé€¸åˆ†æž èˆ¬è®¤ä¸ºnewå‡ºæ¥çš„å¯¹è±¡éƒ½æ˜¯è¢«åˆ†é…åœ¨å †ä¸Šï¼Œä½†æ˜¯è¿™ä¸ªç»“è®ºä¸æ˜¯é‚£ä¹ˆçš„ç»å¯¹ï¼Œé€šè¿‡å¯¹Javaå¯¹è±¡åˆ†é…çš„è¿‡ç¨‹åˆ†æžï¼Œå¯ä»¥çŸ¥é“æœ‰ä¸¤ä¸ªåœ°æ–¹ä¼šå¯¼è‡´Javaä¸­newå‡ºæ¥çš„å¯¹è±¡å¹¶ä¸ä¸€å®šåˆ†é…åœ¨æ‰€è®¤ä¸ºçš„å †ä¸Šã€‚è¿™ä¸¤ä¸ªç‚¹åˆ†åˆ«æ˜¯Javaä¸­çš„é€ƒé€¸åˆ†æžå’ŒTLABï¼ˆThread Local Allocation Bufferï¼‰ã€‚ 6.1 ä»€ä¹ˆæ˜¯æ ˆä¸Šåˆ†é…ï¼Ÿ æ ˆä¸Šåˆ†é…ä¸»è¦æ˜¯æŒ‡åœ¨Javaç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåœ¨æ–¹æ³•ä½“ä¸­å£°æ˜Žçš„å˜é‡ä»¥åŠåˆ›å»ºçš„å¯¹è±¡ï¼Œå°†ç›´æŽ¥ä»Žè¯¥çº¿ç¨‹æ‰€ä½¿ç”¨çš„æ ˆä¸­åˆ†é…ç©ºé—´ã€‚ ä¸€èˆ¬è€Œè¨€ï¼Œåˆ›å»ºå¯¹è±¡éƒ½æ˜¯ä»Žå †ä¸­æ¥åˆ†é…çš„ï¼Œè¿™é‡Œæ˜¯æŒ‡åœ¨æ ˆä¸Šæ¥åˆ†é…ç©ºé—´ç»™æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚ 6.2 ä»€ä¹ˆæ˜¯é€ƒé€¸ï¼Ÿ é€ƒé€¸æ˜¯æŒ‡åœ¨æŸä¸ªæ–¹æ³•ä¹‹å†…åˆ›å»ºçš„å¯¹è±¡ï¼Œé™¤äº†åœ¨æ–¹æ³•ä½“ä¹‹å†…è¢«å¼•ç”¨ä¹‹å¤–ï¼Œè¿˜åœ¨æ–¹æ³•ä½“ä¹‹å¤–è¢«å…¶å®ƒå˜é‡å¼•ç”¨åˆ°ï¼› è¿™æ ·å¸¦æ¥çš„åŽæžœæ˜¯åœ¨è¯¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œè¯¥æ–¹æ³•ä¸­åˆ›å»ºçš„å¯¹è±¡å°†æ— æ³•è¢«GCå›žæ”¶ï¼Œç”±äºŽå…¶è¢«å…¶å®ƒå˜é‡å¼•ç”¨ã€‚ æ­£å¸¸çš„æ–¹æ³•è°ƒç”¨ä¸­ï¼Œæ–¹æ³•ä½“ä¸­åˆ›å»ºçš„å¯¹è±¡å°†åœ¨æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œå°†å›žæ”¶å…¶ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼›è€Œæ­¤æ—¶ç”±äºŽæ— æ³•å›žæ”¶ï¼Œå³æˆä¸ºé€ƒé€¸ã€‚ 123456789101112static V global_v; public void a_method()&#123; V v=b_method(); c_method(); &#125; public V b_method()&#123; V v=new V(); return v; &#125; public void c_method()&#123; global_v=new V(); &#125; å…¶ä¸­b_methodæ–¹æ³•å†…éƒ¨ç”Ÿæˆçš„Vå¯¹è±¡çš„å¼•ç”¨è¢«è¿”å›žç»™a_methodæ–¹æ³•å†…çš„å˜é‡vï¼Œc_methodæ–¹æ³•å†…ç”Ÿæˆçš„Vå¯¹è±¡è¢«èµ‹ç»™äº†å…¨å±€å˜é‡global_vã€‚è¿™ä¸¤ç§åœºæ™¯éƒ½å‘ç”Ÿäº†ï¼ˆå¼•ç”¨ï¼‰é€ƒé€¸ã€‚ 6.3 é€ƒé€¸åˆ†æž åœ¨JDK 6ä¹‹åŽæ”¯æŒå¯¹è±¡çš„æ ˆä¸Šåˆ†æžå’Œé€ƒé€¸åˆ†æžï¼Œåœ¨JDK7ä¸­å®Œå…¨æ”¯æŒæ ˆä¸Šåˆ†é…å¯¹è±¡ã€‚å…¶æ˜¯å¦æ‰“å¼€é€ƒé€¸åˆ†æžä¾èµ–äºŽä»¥ä¸‹JVMçš„è®¾ç½®ï¼š -XX:+DoEscapeAnalysis 6.4 æ ˆä¸Šåˆ†é…ä¸Žé€ƒé€¸åˆ†æžçš„å…³ç³» è¿›è¡Œé€ƒé€¸åˆ†æžä¹‹åŽï¼Œäº§ç”Ÿçš„åŽæžœæ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å°†ç”±æ ˆä¸Šåˆ†é…ï¼Œè€Œéžä»ŽJVMå†…å­˜æ¨¡åž‹ä¸­çš„å †æ¥åˆ†é…ã€‚ 6.5 é€ƒé€¸åˆ†æžï¼æ ˆä¸Šåˆ†é…çš„ä¼˜åŠ£åˆ†æž JVMåœ¨Serveræ¨¡å¼ä¸‹çš„é€ƒé€¸åˆ†æžå¯ä»¥åˆ†æžå‡ºæŸä¸ªå¯¹è±¡æ˜¯å¦æ°¸è¿œåªåœ¨æŸä¸ªæ–¹æ³•ã€çº¿ç¨‹çš„èŒƒå›´å†…ï¼Œå¹¶æ²¡æœ‰â€œé€ƒé€¸â€å‡ºè¿™ä¸ªèŒƒå›´ï¼Œé€ƒé€¸åˆ†æžçš„ä¸€ä¸ªç»“æžœå°±æ˜¯å¯¹äºŽæŸäº›æœªé€ƒé€¸å¯¹è±¡å¯ä»¥ç›´æŽ¥åœ¨æ ˆä¸Šåˆ†é…ï¼Œç”±äºŽè¯¥å¯¹è±¡ä¸€å®šæ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ ˆä¸Šåˆ†é…ä¸ä¼šæœ‰é—®é¢˜ã€‚ æ¶ˆé™¤åŒæ­¥ã€‚ çº¿ç¨‹åŒæ­¥çš„ä»£ä»·æ˜¯ç›¸å½“é«˜çš„ï¼ŒåŒæ­¥çš„åŽæžœæ˜¯é™ä½Žå¹¶å‘æ€§å’Œæ€§èƒ½ã€‚é€ƒé€¸åˆ†æžå¯ä»¥åˆ¤æ–­å‡ºæŸä¸ªå¯¹è±¡æ˜¯å¦å§‹ç»ˆåªè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œå¦‚æžœåªè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆå¯¹è¯¥å¯¹è±¡çš„åŒæ­¥æ“ä½œå°±å¯ä»¥è½¬åŒ–æˆæ²¡æœ‰åŒæ­¥ä¿æŠ¤çš„æ“ä½œï¼Œè¿™æ ·å°±èƒ½å¤§å¤§æé«˜å¹¶å‘ç¨‹åº¦å’Œæ€§èƒ½ã€‚ çŸ¢é‡æ›¿ä»£ã€‚ é€ƒé€¸åˆ†æžæ–¹æ³•å¦‚æžœå‘çŽ°å¯¹è±¡çš„å†…å­˜å­˜å‚¨ç»“æž„ä¸éœ€è¦è¿žç»­è¿›è¡Œçš„è¯ï¼Œå°±å¯ä»¥å°†å¯¹è±¡çš„éƒ¨åˆ†ç”šè‡³å…¨éƒ¨éƒ½ä¿å­˜åœ¨CPUå¯„å­˜å™¨å†…ï¼Œè¿™æ ·èƒ½å¤§å¤§æé«˜è®¿é—®é€Ÿåº¦ã€‚ åŠ£åŠ¿ï¼š æ ˆä¸Šåˆ†é…å—é™äºŽæ ˆçš„ç©ºé—´å¤§å°ï¼Œä¸€èˆ¬è‡ªæˆ‘è¿­ä»£ç±»çš„éœ€æ±‚ä»¥åŠå¤§çš„å¯¹è±¡ç©ºé—´éœ€æ±‚æ“ä½œï¼Œå°†å¯¼è‡´æ ˆçš„å†…å­˜æº¢å‡ºï¼›æ•…åªé€‚ç”¨äºŽä¸€å®šèŒƒå›´ä¹‹å†…çš„å†…å­˜èŒƒå›´è¯·æ±‚ã€‚ 6.6 æµ‹è¯• 123456789101112131415161718192021222324class EscapeAnalysis &#123; private static class Foo &#123; private int x; private static int counter; //ä¼šå‘ç”Ÿé€ƒé€¸ public Foo() &#123; x = (++counter); &#125; &#125; public static void main(String[] args) &#123; //å¼€å§‹æ—¶é—´ long start = System.nanoTime(); for (int i = 0; i &lt; 1000 * 1000 * 10; ++i) &#123; Foo foo = new Foo(); &#125; //ç»“æŸæ—¶é—´ long end = System.nanoTime(); System.out.println("Time cost is " + (end - start)); &#125;&#125; æœªå¼€å¯é€ƒé€¸åˆ†æžè®¾ç½®ä¸ºï¼š -server -verbose:gc åœ¨æœªå¼€å¯é€ƒé€¸åˆ†æžçš„çŠ¶å†µä¸‹è¿è¡Œæƒ…å†µå¦‚ä¸‹ï¼š 12345678910[GC 5376K-&gt;427K(63872K), 0.0006051 secs] [GC 5803K-&gt;427K(63872K), 0.0003928 secs] [GC 5803K-&gt;427K(63872K), 0.0003639 secs] [GC 5803K-&gt;427K(69248K), 0.0003770 secs] [GC 11179K-&gt;427K(69248K), 0.0003987 secs] [GC 11179K-&gt;427K(79552K), 0.0003817 secs] [GC 21931K-&gt;399K(79552K), 0.0004342 secs] [GC 21903K-&gt;399K(101120K), 0.0002175 secs] [GC 43343K-&gt;399K(101184K), 0.0001421 secs] Time cost is 58514571 å¼€å¯é€ƒé€¸åˆ†æžè®¾ç½®ä¸ºï¼š -server -verbose:gc -XX:+DoEscapeAnalysis å¼€å¯é€ƒé€¸åˆ†æžçš„çŠ¶å†µä¸‹ï¼Œè¿è¡Œæƒ…å†µå¦‚ä¸‹ï¼š Time cost is 10031306 æœªå¼€å¯é€ƒé€¸åˆ†æžæ—¶ï¼Œè¿è¡Œä¸Šè¿°ä»£ç ï¼ŒJVMæ‰§è¡Œäº†GCæ“ä½œï¼Œè€Œåœ¨å¼€å¯é€ƒé€¸åˆ†æžæƒ…å†µä¸‹ï¼ŒJVMå¹¶æ²¡æœ‰æ‰§è¡ŒGCæ“ä½œã€‚åŒæ—¶ï¼Œæ“ä½œæ—¶é—´ä¸Šï¼Œå¼€å¯é€ƒé€¸åˆ†æžçš„ç¨‹åºè¿è¡Œæ—¶é—´æ˜¯æœªå¼€å¯é€ƒé€¸åˆ†æžæ—¶é—´çš„1/5ã€‚ 7. å†æ¥èŠèŠTLAB JVMåœ¨å†…å­˜æ–°ç”Ÿä»£Eden Spaceä¸­å¼€è¾Ÿäº†ä¸€å°å—çº¿ç¨‹ç§æœ‰çš„åŒºåŸŸï¼Œç§°ä½œTLABï¼ˆThread-local allocation bufferï¼‰ã€‚é»˜è®¤è®¾å®šä¸ºå ç”¨Eden Spaceçš„1%ã€‚åœ¨Javaç¨‹åºä¸­å¾ˆå¤šå¯¹è±¡éƒ½æ˜¯å°å¯¹è±¡ä¸”ç”¨è¿‡å³ä¸¢ï¼Œå®ƒä»¬ä¸å­˜åœ¨çº¿ç¨‹å…±äº«ä¹Ÿé€‚åˆè¢«å¿«é€ŸGCï¼Œæ‰€ä»¥å¯¹äºŽå°å¯¹è±¡é€šå¸¸JVMä¼šä¼˜å…ˆåˆ†é…åœ¨TLABä¸Šï¼Œå¹¶ä¸”TLABä¸Šçš„åˆ†é…ç”±äºŽæ˜¯çº¿ç¨‹ç§æœ‰æ‰€ä»¥æ²¡æœ‰é”å¼€é”€ã€‚å› æ­¤åœ¨å®žè·µä¸­åˆ†é…å¤šä¸ªå°å¯¹è±¡çš„æ•ˆçŽ‡é€šå¸¸æ¯”åˆ†é…ä¸€ä¸ªå¤§å¯¹è±¡çš„æ•ˆçŽ‡è¦é«˜ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒJavaä¸­æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±çš„ç¼“å†²åŒºç§°ä½œTLABï¼ˆThread-local allocation bufferï¼‰ï¼Œæ¯ä¸ªTLABéƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œï¼ŒTLABç»“åˆbump-the-pointeræŠ€æœ¯å¯ä»¥å®žçŽ°å¿«é€Ÿçš„å¯¹è±¡åˆ†é…ï¼Œè€Œä¸éœ€è¦ä»»ä½•çš„é”è¿›è¡ŒåŒæ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¯¹è±¡åˆ†é…çš„æ—¶å€™ä¸ç”¨é”ä½æ•´ä¸ªå †ï¼Œè€Œåªéœ€è¦åœ¨è‡ªå·±çš„ç¼“å†²åŒºåˆ†é…å³å¯ã€‚ 8. å¯¹è±¡å†…å­˜åˆ†é…è¿‡ç¨‹å†å‡çº§ ç¼–è¯‘å™¨é€šè¿‡é€ƒé€¸åˆ†æžï¼Œç¡®å®šå¯¹è±¡æ˜¯åœ¨æ ˆä¸Šåˆ†é…è¿˜æ˜¯åœ¨å †ä¸Šåˆ†é…ã€‚å¦‚æžœæ˜¯åœ¨å †ä¸Šåˆ†é…ï¼Œåˆ™è¿›å…¥é€‰é¡¹2. å¦‚æžœtlab_top + size &lt;= tlab_endï¼Œåˆ™åœ¨åœ¨TLABä¸Šç›´æŽ¥åˆ†é…å¯¹è±¡å¹¶å¢žåŠ tlab_top çš„å€¼ï¼Œå¦‚æžœçŽ°æœ‰çš„TLABä¸è¶³ä»¥å­˜æ”¾å½“å‰å¯¹è±¡åˆ™3. é‡æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œå¹¶å†æ¬¡å°è¯•å­˜æ”¾å½“å‰å¯¹è±¡ã€‚å¦‚æžœæ”¾ä¸ä¸‹ï¼Œåˆ™4. åœ¨EdenåŒºåŠ é”ï¼ˆè¿™ä¸ªåŒºæ˜¯å¤šçº¿ç¨‹å…±äº«çš„ï¼‰ï¼Œå¦‚æžœeden_top + size &lt;= eden_endåˆ™å°†å¯¹è±¡å­˜æ”¾åœ¨EdenåŒºï¼Œå¢žåŠ eden_top çš„å€¼ï¼Œå¦‚æžœEdenåŒºä¸è¶³ä»¥å­˜æ”¾ï¼Œåˆ™5. æ‰§è¡Œä¸€æ¬¡Young GCï¼ˆminor collectionï¼‰ã€‚ ç»è¿‡Young GCä¹‹åŽï¼Œå¦‚æžœEdenåŒºä»»ç„¶ä¸è¶³ä»¥å­˜æ”¾å½“å‰å¯¹è±¡ï¼Œåˆ™ç›´æŽ¥åˆ†é…åˆ°è€å¹´ä»£ã€‚ è€å¹´ä»£è¿˜æ˜¯ä¸è¶³ï¼Œåˆ™è§¦å‘Full GCï¼Œå†ä¸è¶³å°±OOMé”™è¯¯]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åžƒåœ¾æ”¶é›†å™¨ä»‹ç»]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2F%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬ä¹ç¯‡æ–‡ç« ï¼Œä¸»è¦ä»‹ç»ä¸ƒç§æ¯”è¾ƒç»å…¸çš„åžƒåœ¾æ”¶é›†å™¨çš„å®žçŽ°åŽŸç†ã€‚ åžƒåœ¾æ”¶é›†å™¨ ä»¥ä¸Šæ˜¯ HotSpot è™šæ‹Ÿæœºä¸­çš„ 7 ä¸ªåžƒåœ¾æ”¶é›†å™¨ï¼Œè¿žçº¿è¡¨ç¤ºåžƒåœ¾æ”¶é›†å™¨å¯ä»¥é…åˆä½¿ç”¨ã€‚ 1. Serial æ”¶é›†å™¨ Serial ç¿»è¯‘ä¸ºä¸²è¡Œï¼Œåžƒåœ¾æ”¶é›†å’Œç”¨æˆ·ç¨‹åºä¸èƒ½åŒæ—¶æ‰§è¡Œï¼Œè¿™æ„å‘³ç€åœ¨æ‰§è¡Œåžƒåœ¾æ”¶é›†çš„æ—¶å€™éœ€è¦åœé¡¿ç”¨æˆ·ç¨‹åºã€‚é™¤äº† CMS å’Œ G1 ä¹‹å¤–ï¼Œå…¶å®ƒæ”¶é›†å™¨éƒ½æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œã€‚CMS å’Œ G1 å¯ä»¥ä½¿å¾—åžƒåœ¾æ”¶é›†å’Œç”¨æˆ·ç¨‹åºåŒæ—¶æ‰§è¡Œï¼Œè¢«ç§°ä¸ºå¹¶å‘æ‰§è¡Œã€‚ å®ƒæ˜¯å•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œåªä¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œåžƒåœ¾æ”¶é›†å·¥ä½œã€‚ å®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•é«˜æ•ˆï¼Œå¯¹äºŽå•ä¸ª CPU çŽ¯å¢ƒæ¥è¯´ï¼Œç”±äºŽæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œå› æ­¤æ‹¥æœ‰æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆçŽ‡ã€‚ å®ƒæ˜¯ Client æ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå› ä¸ºåœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸‹ï¼Œåˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸€èˆ¬æ¥è¯´ä¸ä¼šå¾ˆå¤§ã€‚Serial æ”¶é›†å™¨æ”¶é›†å‡ åå…†ç”šè‡³ä¸€ä¸¤ç™¾å…†çš„æ–°ç”Ÿä»£åœé¡¿æ—¶é—´å¯ä»¥æŽ§åˆ¶åœ¨ä¸€ç™¾å¤šæ¯«ç§’ä»¥å†…ï¼Œåªè¦ä¸æ˜¯å¤ªé¢‘ç¹ï¼Œè¿™ç‚¹åœé¡¿æ˜¯å¯ä»¥æŽ¥å—çš„ã€‚ 2. ParNew æ”¶é›†å™¨ å®ƒæ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚ æ˜¯ Serveræ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºé¦–é€‰æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œé™¤äº†æ€§èƒ½åŽŸå› å¤–ï¼Œä¸»è¦æ˜¯å› ä¸ºé™¤äº† Serial æ”¶é›†å™¨ï¼Œåªæœ‰å®ƒèƒ½ä¸Ž CMS æ”¶é›†å™¨é…åˆå·¥ä½œã€‚ é»˜è®¤å¼€å§‹çš„çº¿ç¨‹æ•°é‡ä¸Ž CPU æ•°é‡ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨ -XX:ParallelGCThreads å‚æ•°æ¥è®¾ç½®çº¿ç¨‹æ•°ã€‚ 3. Parallel Scavenge æ”¶é›†å™¨ ä¸Ž ParNew ä¸€æ ·æ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚ å…¶å®ƒæ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åžƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€Œå®ƒçš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æŽ§åˆ¶çš„åžåé‡ï¼Œå®ƒè¢«ç§°ä¸ºâ€œåžåé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ã€‚è¿™é‡Œçš„åžåé‡æŒ‡ CPU ç”¨äºŽè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼ã€‚ åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸Žç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚è€Œé«˜åžåé‡åˆ™å¯ä»¥é«˜æ•ˆçŽ‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åŽå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚ æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºŽç²¾ç¡®æŽ§åˆ¶åžåé‡ï¼Œåˆ†åˆ«æ˜¯æŽ§åˆ¶æœ€å¤§åžƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ -XX:MaxGCPauseMillis å‚æ•°ä»¥åŠç›´æŽ¥è®¾ç½®åžåé‡å¤§å°çš„ -XX:GCTimeRatio å‚æ•°ï¼ˆå€¼ä¸ºå¤§äºŽ 0 ä¸”å°äºŽ 100 çš„æ•´æ•°ï¼‰ã€‚ç¼©çŸ­åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²åžåé‡å’Œæ–°ç”Ÿä»£ç©ºé—´æ¥æ¢å–çš„ï¼šæ–°ç”Ÿä»£ç©ºé—´å˜å°ï¼Œåžƒåœ¾å›žæ”¶å˜å¾—é¢‘ç¹ï¼Œå¯¼è‡´åžåé‡ä¸‹é™ã€‚ è¿˜æä¾›äº†ä¸€ä¸ªå‚æ•° -XX:+UseAdaptiveSizePolicyï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œæ‰“å¼€å‚æ•°åŽï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Eden å’Œ Survivor åŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRatioï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æŽ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„åžåé‡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º GC è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰ã€‚ 4. Serial Old æ”¶é›†å™¨ æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ç»™ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æžœç”¨åœ¨ Server æ¨¡å¼ä¸‹ï¼Œå®ƒæœ‰ä¸¤å¤§ç”¨é€”ï¼š åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯žç”Ÿä»¥å‰ï¼‰ä¸­ä¸Ž Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚ ä½œä¸º CMS æ”¶é›†å™¨çš„åŽå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ Concurrent Mode Failure æ—¶ä½¿ç”¨ã€‚ 5. Parallel Old æ”¶é›†å™¨ æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚ åœ¨æ³¨é‡åžåé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge åŠ  Parallel Old æ”¶é›†å™¨ã€‚ 6. CMS æ”¶é›†å™¨ CMSï¼ˆConcurrent Mark Sweepï¼‰ï¼ŒMark Sweep æŒ‡çš„æ˜¯æ ‡è®° - æ¸…é™¤ç®—æ³•ã€‚ ç‰¹ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½Žåœé¡¿ã€‚å¹¶å‘æŒ‡çš„æ˜¯ç”¨æˆ·çº¿ç¨‹å’Œ GC çº¿ç¨‹åŒæ—¶è¿è¡Œã€‚ åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæµç¨‹ï¼š åˆå§‹æ ‡è®°ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æŽ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦åœé¡¿ã€‚ å¹¶å‘æ ‡è®°ï¼šè¿›è¡ŒGC Roots Tracing çš„è¿‡ç¨‹ï¼Œå®ƒåœ¨æ•´ä¸ªå›žæ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ï¼Œä¸éœ€è¦åœé¡¿ã€‚ é‡æ–°æ ‡è®°ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿ã€‚ å¹¶å‘æ¸…é™¤ï¼šä¸éœ€è¦åœé¡¿ã€‚ åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸Žç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦è¿›è¡Œåœé¡¿ã€‚ å…·æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š åžåé‡ä½Žï¼šä½Žåœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²åžåé‡ä¸ºä»£ä»·çš„ï¼Œå¯¼è‡´ CPU åˆ©ç”¨çŽ‡ä¸å¤Ÿé«˜ã€‚ æ— æ³•å¤„ç†æµ®åŠ¨åžƒåœ¾ï¼Œå¯èƒ½å‡ºçŽ° Concurrent Mode Failureã€‚æµ®åŠ¨åžƒåœ¾æ˜¯æŒ‡å¹¶å‘æ¸…é™¤é˜¶æ®µç”±äºŽç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œäº§ç”Ÿçš„åžƒåœ¾ï¼Œè¿™éƒ¨åˆ†åžƒåœ¾åªèƒ½åˆ°ä¸‹ä¸€æ¬¡ GC æ—¶æ‰èƒ½è¿›è¡Œå›žæ”¶ã€‚ç”±äºŽæµ®åŠ¨åžƒåœ¾çš„å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é¢„ç•™å‡ºä¸€éƒ¨åˆ†å†…å­˜ï¼Œæ„å‘³ç€ CMS æ”¶é›†ä¸èƒ½åƒå…¶å®ƒæ”¶é›†å™¨é‚£æ ·ç­‰å¾…è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›žæ”¶ã€‚å¯ä»¥ä½¿ç”¨ -XX:CMSInitiatingOccupancyFraction æ¥æ”¹å˜è§¦å‘ CMS æ”¶é›†å™¨å·¥ä½œçš„å†…å­˜å ç”¨ç™¾åˆ†ï¼Œå¦‚æžœè¿™ä¸ªå€¼è®¾ç½®çš„å¤ªå¤§ï¼Œå¯¼è‡´é¢„ç•™çš„å†…å­˜ä¸å¤Ÿå­˜æ”¾æµ®åŠ¨åžƒåœ¾ï¼Œå°±ä¼šå‡ºçŽ° Concurrent Mode Failureï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†ä¸´æ—¶å¯ç”¨ Serial Old æ¥æ›¿ä»£ CMSã€‚ æ ‡è®° - æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢Žç‰‡ï¼Œå¾€å¾€å‡ºçŽ°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿žç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡ Full GCã€‚ 7. G1 æ”¶é›†å™¨ G1ï¼ˆGarbage-Firstï¼‰ï¼Œå®ƒæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åžƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨å¤š CPU å’Œå¤§å†…å­˜çš„åœºæ™¯ä¸‹æœ‰å¾ˆå¥½çš„æ€§èƒ½ã€‚HotSpot å¼€å‘å›¢é˜Ÿèµ‹äºˆå®ƒçš„ä½¿å‘½æ˜¯æœªæ¥å¯ä»¥æ›¿æ¢æŽ‰ CMS æ”¶é›†å™¨ã€‚ Java å †è¢«åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ï¼Œå…¶å®ƒæ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€ç”Ÿä»£ï¼Œè€Œ G1 å¯ä»¥ç›´æŽ¥å¯¹æ–°ç”Ÿä»£å’Œæ°¸ä¹…ä»£ä¸€èµ·å›žæ”¶ã€‚ G1 æŠŠæ–°ç”Ÿä»£å’Œè€å¹´ä»£åˆ’åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ–°ç”Ÿä»£å’Œæ°¸ä¹…ä»£ä¸å†ç‰©ç†éš”ç¦»ã€‚ é€šè¿‡å¼•å…¥ Region çš„æ¦‚å¿µï¼Œä»Žè€Œå°†åŽŸæ¥çš„ä¸€æ•´å—å†…å­˜ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªçš„å°ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªå°ç©ºé—´å¯ä»¥å•ç‹¬è¿›è¡Œåžƒåœ¾å›žæ”¶ã€‚è¿™ç§åˆ’åˆ†æ–¹æ³•å¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡åž‹æˆä¸ºå¯èƒ½ã€‚é€šè¿‡è®°å½•æ¯ä¸ª Region åžƒåœ¾å›žæ”¶æ—¶é—´ä»¥åŠå›žæ”¶æ‰€èŽ·å¾—çš„ç©ºé—´ï¼ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡è¿‡åŽ»å›žæ”¶çš„ç»éªŒèŽ·å¾—ï¼‰ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›žæ”¶ä»·å€¼æœ€å¤§çš„ Regionã€‚ æ¯ä¸ª Region éƒ½æœ‰ä¸€ä¸ª Remembered Setï¼Œç”¨æ¥è®°å½•è¯¥ Region å¯¹è±¡çš„å¼•ç”¨å¯¹è±¡æ‰€åœ¨çš„ Regionã€‚é€šè¿‡ä½¿ç”¨ Remembered Setï¼Œåœ¨åšå¯è¾¾æ€§åˆ†æžçš„æ—¶å€™å°±å¯ä»¥é¿å…å…¨å †æ‰«æã€‚ å¦‚æžœä¸è®¡ç®—ç»´æŠ¤ Remembered Set çš„æ“ä½œï¼ŒG1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®° å¹¶å‘æ ‡è®° æœ€ç»ˆæ ‡è®°ï¼šä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„ Remembered Set Logs é‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠ Remembered Set Logs çš„æ•°æ®åˆå¹¶åˆ° Remembered Set ä¸­ã€‚è¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚ ç­›é€‰å›žæ”¶ï¼šé¦–å…ˆå¯¹å„ä¸ª Region ä¸­çš„å›žæ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡ŒæŽ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„ GC åœé¡¿æ˜¯æ—¶é—´æ¥åˆ¶å®šå›žæ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®žä¹Ÿå¯ä»¥åšåˆ°ä¸Žç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›žæ”¶ä¸€éƒ¨åˆ† Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æŽ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆçŽ‡ã€‚ å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š ç©ºé—´æ•´åˆï¼šæ•´ä½“æ¥çœ‹æ˜¯åŸºäºŽâ€œæ ‡è®° - æ•´ç†â€ç®—æ³•å®žçŽ°çš„æ”¶é›†å™¨ï¼Œä»Žå±€éƒ¨ï¼ˆä¸¤ä¸ª Region ä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºŽâ€œå¤åˆ¶â€ç®—æ³•å®žçŽ°çš„ï¼Œè¿™æ„å‘³ç€è¿è¡ŒæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢Žç‰‡ã€‚ å¯é¢„æµ‹çš„åœé¡¿ï¼šèƒ½è®©ä½¿ç”¨è€…æ˜Žç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨ GC ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ã€‚ 8. æ¯”è¾ƒ æ”¶é›†å™¨ ä¸²è¡Œ/å¹¶è¡Œ/å¹¶å‘ æ–°ç”Ÿä»£/è€å¹´ä»£ æ”¶é›†ç®—æ³• ç›®æ ‡ é€‚ç”¨åœºæ™¯ Serial ä¸²è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ å“åº”é€Ÿåº¦ä¼˜å…ˆ å• CPU çŽ¯å¢ƒä¸‹çš„ Client æ¨¡å¼ Serial Old ä¸²è¡Œ è€å¹´ä»£ æ ‡è®°-æ•´ç† å“åº”é€Ÿåº¦ä¼˜å…ˆ å• CPU çŽ¯å¢ƒä¸‹çš„ Client æ¨¡å¼ã€CMS çš„åŽå¤‡é¢„æ¡ˆ ParNew ä¸²è¡Œ + å¹¶è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ç®—æ³• å“åº”é€Ÿåº¦ä¼˜å…ˆ å¤š CPU çŽ¯å¢ƒæ—¶åœ¨ Server æ¨¡å¼ä¸‹ä¸Ž CMS é…åˆ Parallel Scavenge ä¸²è¡Œ + å¹¶è¡Œ æ–°ç”Ÿä»£ å¤åˆ¶ç®—æ³• åžåé‡ä¼˜å…ˆ åœ¨åŽå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ Parallel Old ä¸²è¡Œ + å¹¶è¡Œ è€å¹´ä»£ æ ‡è®°-æ•´ç† åžåé‡ä¼˜å…ˆ åœ¨åŽå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ CMS å¹¶è¡Œ + å¹¶å‘ è€å¹´ä»£ æ ‡è®°-æ¸…é™¤ å“åº”é€Ÿåº¦ä¼˜å…ˆ é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ– B/S ç³»ç»ŸæœåŠ¡ç«¯ä¸Šçš„ Java åº”ç”¨ G1 å¹¶è¡Œ + å¹¶å‘ æ–°ç”Ÿä»£ + è€å¹´ä»£ æ ‡è®°-æ•´ç† + å¤åˆ¶ç®—æ³• å“åº”é€Ÿåº¦ä¼˜å…ˆ é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œå°†æ¥æ›¿æ¢ CMS]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GCç›¸å…³]]></title>
    <url>%2F2019%2F02%2F09%2FJVM%2FGC%E7%9B%B8%E5%85%B3%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬å…«ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒJVMä¸ºæˆ‘ä»¬ç®¡ç†åžƒåœ¾å¯¹è±¡å®žçŽ°è‡ªåŠ¨å›žæ”¶ï¼Œè®©æˆ‘ä»¬ä¸éœ€è¦å¤ªå…³å¿ƒå†…å­˜é‡Šæ”¾é—®é¢˜ï¼Œä¸€å®šç¨‹åº¦ä¸Šå‡å°‘äº†å†…å­˜æº¢å‡ºçš„é”™è¯¯ã€‚è¿™ä¸€åˆ‡çš„èƒŒåŽæ˜¯å¦‚ä½•å®žçŽ°çš„å‘¢ï¼Ÿ ä¸€ã€åžƒåœ¾æ ‡è®°ç®—æ³• 1.1 å¼•ç”¨è®¡æ•°æ³• ç®—æ³•æ€æƒ³ ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼åŠ ä¸€ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨â˜žå‡ä¸€ï¼›ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚ ä¸»è¦ç¼ºé™· æ— æ³•è§£å†³å¯¹è±¡é—´ç›¸äº’å¾ªçŽ¯å¼•ç”¨çš„é—®é¢˜ã€‚ ä¸¾ä¸ªä¾‹å­ 12345678910111213141516171819202122232425public class Test &#123; public Object instance = null; private static final int _1MB = 1024 * 1024; private byte[] bigSize = new byte[2 * _1MB]; public static void testGC() &#123; Test objA = new Test();//count=1 Test objB = new Test();//count=1 objA.instance = objB;//count=2 objB.instance = objA;//count=2 objA = null;//count=1 objB = null;//count=1 System.gc(); &#125; public static void main(String[] args) &#123; testGC(); &#125;&#125; è¾“å…¥å‚æ•° -verbose:gc -XX:+PrintGCDetails ç»“æžœ 1234567891011[GC (System.gc()) [PSYoungGen: 6063K-&gt;600K(37888K)] 6063K-&gt;608K(123904K), 0.0037131 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] [Full GC (System.gc()) [PSYoungGen: 600K-&gt;0K(37888K)] [ParOldGen: 8K-&gt;529K(86016K)] 608K-&gt;529K(123904K), [Metaspace: 2595K-&gt;2595K(1056768K)], 0.0062705 secs] [Times: user=0.03 sys=0.00, real=0.01 secs] Heap PSYoungGen total 37888K, used 328K [0x00000000d6100000, 0x00000000d8b00000, 0x0000000100000000) eden space 32768K, 1% used [0x00000000d6100000,0x00000000d6152030,0x00000000d8100000) from space 5120K, 0% used [0x00000000d8100000,0x00000000d8100000,0x00000000d8600000) to space 5120K, 0% used [0x00000000d8600000,0x00000000d8600000,0x00000000d8b00000) ParOldGen total 86016K, used 529K [0x0000000082200000, 0x0000000087600000, 0x00000000d6100000) object space 86016K, 0% used [0x0000000082200000,0x0000000082284778,0x0000000087600000) Metaspace used 2601K, capacity 4486K, committed 4864K, reserved 1056768K class space used 288K, capacity 386K, committed 512K, reserved 1048576K åˆ†æž æ—¥å¿—ä¸­6063K-&gt;600K(37888K)ï¼Œä»ŽåŽŸæ¥çš„6Må†…å­˜å˜æˆäº†600kï¼Œè¡¨æ˜Žå¯¹è±¡å·²è¢«å›žæ”¶ï¼Œä»Žè€Œè¡¨æ˜ŽJVMæ²¡æœ‰ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ã€‚Javaä¸­ä½¿ç”¨äº†å¯è¾¾æ€§åˆ†æžç®—æ³•æ¥æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚ 1.2 å¯è¾¾æ€§åˆ†æžç®—æ³• è¿™ä¸ªç®—æ³•çš„åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ç§°è°“GC Rootsçš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»Žè¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€æœ‰èµ°è¿‡çš„è·¯å¾„ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾æ—¶ï¼Œåˆ™è¯æ˜Žæ­¤å¯¹è±¡æ—¶ä¸å¯ç”¨çš„ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ä¾‹å­ï¼š ä¸Šé¢çš„è¿™å¼ å›¾ï¼Œå¯¹è±¡object5ã€object6ã€object7è™½ç„¶äº’ç›¸æ²¡æœ‰å…³è”ï¼Œä½†æ˜¯å®ƒä»¬åˆ°GC Rootsæ˜¯ä¸å¯è¾¾çš„ï¼Œæ‰€ä»¥å®ƒä»¬å°†ä¼šè¢«åˆ¤å®šä¸ºæ˜¯å¯å›žæ”¶çš„å¯¹è±¡ æ³¨ï¼šJavaè¯­è¨€ä¸­ï¼Œå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­ç±»é™æ€å±žæ€§å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­JNI(å³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•)å¼•ç”¨çš„å¯¹è±¡ æ´»è·ƒçº¿ç¨‹å¼•ç”¨çš„å¯¹è±¡ äºŒã€Javaä¸­çš„å¼•ç”¨ç±»åž‹ ä»ŽJDK1.2ä¹‹åŽï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ï¼Œè½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ï¼Œè™šå¼•ç”¨ï¼Œè¿™å››ç§å¼•ç”¨çš„å¼ºåº¦ä¸€æ¬¡é€æ¸å‡å¼± å¼ºå¼•ç”¨å°±æ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„ï¼Œç±»ä¼¼ Object obj = new Object() è¿™ç±»çš„å¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œåžƒåœ¾å›žæ”¶å™¨æ°¸è¿œä¸ä¼šå›žæ”¶æŽ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ è½¯å¼•ç”¨æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ä½†å¹¶éžéœ€è¦çš„å¯¹è±¡ï¼Œå¯¹äºŽè½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜å¼‚å¸¸ä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›žæ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›žæ”¶ï¼Œå¦‚æžœè¿™æ¬¡å›žæ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜å¼‚å¸¸ å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°éžå¿…éœ€å¯¹è±¡çš„ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åžƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰ï¼Œå½“åžƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜é‡Šæ”¾è¶³å¤Ÿï¼Œéƒ½ä¼šå›žæ”¶æŽ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ è™šå¼•ç”¨ä¹Ÿç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æž„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®žä¾‹ï¼Œå¯¹ä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›žæ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ ä¸‰ã€ä¸¤æ¬¡æ ‡è®° ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹åŽŸæ–‡ï¼š åœ¨javaæ ¹æœç´¢ç®—æ³•ä¸­åˆ¤æ–­å¯¹è±¡çš„å¯è¾¾æ€§ï¼Œå¯¹äºŽä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶ä¸ä¸€å®šæ˜¯å¿…é¡»æ¸…ç†ã€‚è¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªç¼“åˆ‘æœŸï¼ŒçœŸæ­£çš„åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»è¿‡ä¿©æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š å¦‚æžœå¯¹è±¡åœ¨è¿›è¡Œæ ¹æœç´¢åŽå‘çŽ°æ²¡æœ‰ä¸ŽGC rootsç›¸å…³è”çš„å¼•ç”¨é“¾ï¼Œé‚£ä»–å°†ä¼šç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œå½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•ï¼Œæˆ–è€…finalize()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¿©ç§æƒ…å†µéƒ½è§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ã€‚ å³å½“ä¸€ä¸ªå¯¹è±¡é‡å†™äº†finalize()æ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡è¢«æ”¾ç½®åœ¨F-Queueé˜Ÿåˆ—ä¹‹ä¸­ï¼Œå¹¶åœ¨ç¨åŽç”±ä¸€æ¡ç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½Žä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹åŽ»æ‰§è¡Œã€‚è¿™é‡Œæ‰€è°“çš„æ‰§è¡Œæ˜¯æŒ‡è™šæ‹Ÿæœºä¼šå‡ºå‘è¿™ä¸ªæ–¹æ³•ï¼Œä½†ä¸æ‰¿è¯ºä¼šç­‰å¾…å®ƒè¿è¡Œç»“æŸã€‚è¿™æ ·åšçš„åŽŸå› ï¼šå¦‚æžœä¸€ä¸ªå¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­æ‰§è¡Œç¼“æ…¢ï¼Œæˆ–è€…å‘ç”Ÿäº†æ­»å¾ªçŽ¯ï¼ˆæžç«¯çš„æƒ…å†µä¸‹ï¼‰ï¼Œå°†å¯èƒ½ä¼šå¯¼è‡´F-Queueé˜Ÿåˆ—ä¸­çš„å…¶ä»–å¯¹è±¡æ°¸ä¹…å¤„äºŽç­‰å¾…çŠ¶æ€ï¼Œç”šè‡³å¯¼è‡´æ•´ä¸ªå†…å­˜å›žæ”¶ç³»ç»Ÿå´©æºƒã€‚finalize()æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åŽä¸€æ¬¡æœºä¼šï¼Œç¨åŽGCå°†å¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°ï¼Œå¦‚æžœå¯¹è±¡è¦åœ¨finalize()ä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±----åªè¦é‡æ–°ä¸Žå¼•ç”¨é“¾ä¸Šçš„ä»»ä½•å»ºç«‹å…³è”å³å¯ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å®ƒå°†ä¼šè¢«ç§»å‡ºâ€œå³å°†å›žæ”¶â€çš„é›†åˆï¼›å¦‚æžœå¯¹è±¡è¿™æ—¶å€™æ²¡æœ‰é€ƒè„±ï¼Œå°±ä¼šè¢«å›žæ”¶ã€‚ 3.1 finalizeçš„å·¥ä½œåŽŸç† ä¸€æ—¦åžƒåœ¾æ”¶é›†å™¨å‡†å¤‡å¥½é‡Šæ”¾å¯¹è±¡å ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œå®ƒé¦–å…ˆè°ƒç”¨finalize()ï¼Œè€Œä¸”åªæœ‰åœ¨ä¸‹ä¸€æ¬¡åžƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ï¼Œæ‰ä¼šçœŸæ­£å›žæ”¶å¯¹è±¡çš„å†…å­˜.æ‰€ä»¥å¦‚æžœä½¿ç”¨finalize()ï¼Œå°±å¯ä»¥åœ¨åžƒåœ¾æ”¶é›†æœŸé—´è¿›è¡Œä¸€äº›é‡è¦çš„æ¸…é™¤æˆ–æ¸…æ‰«å·¥ä½œ. 3.2 finalize()åœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨? æ‰€æœ‰å¯¹è±¡è¢«Garbage Collectionæ—¶è‡ªåŠ¨è°ƒç”¨,æ¯”å¦‚è¿è¡ŒSystem.gc()çš„æ—¶å€™. ç¨‹åºé€€å‡ºæ—¶ä¸ºæ¯ä¸ªå¯¹è±¡è°ƒç”¨ä¸€æ¬¡finalizeæ–¹æ³•ã€‚ æ˜¾å¼çš„è°ƒç”¨finalizeæ–¹æ³• è¿™ä¸ªæ–¹æ³•çš„ç”¨é€”å°±æ˜¯ï¼šåœ¨è¯¥å¯¹è±¡è¢«å›žæ”¶ä¹‹å‰ï¼Œè¯¥å¯¹è±¡çš„finalize()æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚è¿™é‡Œçš„å›žæ”¶ä¹‹å‰æŒ‡çš„å°±æ˜¯è¢«æ ‡è®°ä¹‹åŽï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼Œæœ‰æ²¡æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯åŽŸæœ¬ä¸€ä¸ªå¯¹è±¡å¼€å§‹ä¸å†ä¸Šä¸€ç« æ‰€è®²çš„â€œå…³ç³»ç½‘â€ï¼ˆå¼•ç”¨é“¾ï¼‰ä¸­ï¼Œä½†æ˜¯å½“å¼€å‘è€…é‡å†™äº†finalize()åŽï¼Œå¹¶ä¸”å°†è¯¥å¯¹è±¡é‡æ–°åŠ å…¥åˆ°äº†â€œå…³ç³»ç½‘â€ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å¯¹è±¡å¯¹æˆ‘ä»¬è¿˜æœ‰ç”¨ï¼Œä¸åº”è¯¥è¢«å›žæ”¶ï¼Œä½†æ˜¯å·²ç»è¢«æ ‡è®°å•¦ï¼Œæ€Žä¹ˆåŠžå‘¢ï¼Ÿ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œè™šæ‹Ÿæœºçš„åšæ³•æ˜¯è¿›è¡Œä¸¤æ¬¡æ ‡è®°ï¼Œå³ç¬¬ä¸€æ¬¡æ ‡è®°ä¸åœ¨â€œå…³ç³»ç½‘â€ä¸­çš„å¯¹è±¡ï¼Œå¹¶ä¸”è¦åˆ¤æ–­è¯¥å¯¹è±¡æœ‰æ²¡æœ‰å®žçŽ°finalize()æ–¹æ³•äº†ï¼Œå¦‚æžœæ²¡æœ‰å®žçŽ°å°±ç›´æŽ¥åˆ¤æ–­è¯¥å¯¹è±¡å¯å›žæ”¶ã€‚å¦‚æžœå®žçŽ°äº†å°±ä¼šå…ˆæ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¹¶ç”±è™šæ‹Ÿæœºå»ºç«‹çš„ä¸€ä¸ªä½Žä¼˜å…ˆçº§çš„çº¿ç¨‹åŽ»æ‰§è¡Œå®ƒã€‚ éšåŽå°±ä¼šè¿›è¡Œç¬¬äºŒæ¬¡çš„å°è§„æ¨¡æ ‡è®°ï¼Œå¦‚æžœå¯¹è±¡è¿˜æ²¡æœ‰é€ƒè„±ï¼Œåœ¨è¿™æ¬¡è¢«æ ‡è®°çš„å¯¹è±¡å°±ä¼šçœŸæ­£çš„è¢«å›žæ”¶äº†ã€‚ å››ã€åžƒåœ¾æ”¶é›†ç®—æ³• 4.1 æ ‡è®°-æ¸…é™¤ç®—æ³• æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•æ˜¯â€œæ ‡è®°-æ¸…é™¤â€ï¼ˆMark-Sweepï¼‰ç®—æ³•ï¼Œå¦‚å®ƒçš„åå­—ä¸€æ ·ï¼Œç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›žæ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®ŒæˆåŽç»Ÿä¸€å›žæ”¶æŽ‰æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œå®ƒçš„æ ‡è®°è¿‡ç¨‹å…¶å®žåœ¨å‰ä¸€èŠ‚è®²è¿°å¯¹è±¡æ ‡è®°åˆ¤å®šæ—¶å·²ç»åŸºæœ¬ä»‹ç»è¿‡äº†ã€‚ä¹‹æ‰€ä»¥è¯´å®ƒæ˜¯æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œæ˜¯å› ä¸ºåŽç»­çš„æ”¶é›†ç®—æ³•éƒ½æ˜¯åŸºäºŽè¿™ç§æ€è·¯å¹¶å¯¹å…¶ç¼ºç‚¹è¿›è¡Œæ”¹è¿›è€Œå¾—åˆ°çš„ã€‚å®ƒçš„ä¸»è¦ç¼ºç‚¹æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯æ•ˆçŽ‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹çš„æ•ˆçŽ‡éƒ½ä¸é«˜ï¼›å¦å¤–ä¸€ä¸ªæ˜¯ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åŽä¼šäº§ç”Ÿå¤§é‡ä¸è¿žç»­çš„å†…å­˜ç¢Žç‰‡ï¼Œç©ºé—´ç¢Žç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ï¼Œå½“ç¨‹åºåœ¨ä»¥åŽçš„è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿žç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åžƒåœ¾æ”¶é›†åŠ¨ä½œã€‚ æ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¦‚å›¾ï¼š 4.2 å¤åˆ¶ç®—æ³• ä¸ºäº†è§£å†³æ•ˆçŽ‡é—®é¢˜ï¼Œä¸€ç§ç§°ä¸ºâ€œå¤åˆ¶â€ï¼ˆCopyingï¼‰çš„æ”¶é›†ç®—æ³•å‡ºçŽ°äº†ï¼Œå®ƒå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åŽå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æŽ‰ã€‚è¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹å…¶ä¸­çš„ä¸€å—è¿›è¡Œå†…å­˜å›žæ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å†…å­˜ç¢Žç‰‡ç­‰å¤æ‚æƒ…å†µï¼Œåªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼Œå®žçŽ°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆã€‚åªæ˜¯è¿™ç§ç®—æ³•çš„ä»£ä»·æ˜¯å°†å†…å­˜ç¼©å°ä¸ºåŽŸæ¥çš„ä¸€åŠï¼Œæœªå…å¤ªé«˜äº†ä¸€ç‚¹ã€‚ å¤åˆ¶ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¦‚å›¾ï¼š 4.3 æ ‡è®°-æ•´ç†ç®—æ³• å¤åˆ¶æ”¶é›†ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»çŽ‡è¾ƒé«˜æ—¶å°±è¦æ‰§è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆçŽ‡å°†ä¼šå˜ä½Žã€‚æ›´å…³é”®çš„æ˜¯ï¼Œå¦‚æžœä¸æƒ³æµªè´¹50%çš„ç©ºé—´ï¼Œå°±éœ€è¦æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œä»¥åº”å¯¹è¢«ä½¿ç”¨çš„å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½100%å­˜æ´»çš„æžç«¯æƒ…å†µï¼Œæ‰€ä»¥åœ¨è€å¹´ä»£ä¸€èˆ¬ä¸èƒ½ç›´æŽ¥é€‰ç”¨è¿™ç§ç®—æ³•ã€‚ æ ¹æ®è€å¹´ä»£çš„ç‰¹ç‚¹ï¼Œæœ‰äººæå‡ºäº†å¦å¤–ä¸€ç§â€œæ ‡è®°-æ•´ç†â€ï¼ˆMark-Compactï¼‰ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸Žâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åŽç»­æ­¥éª¤ä¸æ˜¯ç›´æŽ¥å¯¹å¯å›žæ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åŽç›´æŽ¥æ¸…ç†æŽ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ï¼Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•çš„ç¤ºæ„å›¾å¦‚å›¾ 4.4 åˆ†ä»£æ”¶é›†ç®—æ³• å½“å‰å•†ä¸šè™šæ‹Ÿæœºçš„åžƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨â€œåˆ†ä»£æ”¶é›†â€ï¼ˆGenerational Collectionï¼‰ç®—æ³•ï¼Œè¿™ç§ç®—æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡çš„å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ã€‚ä¸€èˆ¬æ˜¯æŠŠJavaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åžƒåœ¾æ”¶é›†æ—¶éƒ½å‘çŽ°æœ‰å¤§æ‰¹å¯¹è±¡æ­»åŽ»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé‚£å°±é€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚è€Œè€å¹´ä»£ä¸­å› ä¸ºå¯¹è±¡å­˜æ´»çŽ‡é«˜ã€æ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨â€œæ ‡è®°-æ¸…ç†â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•æ¥è¿›è¡Œå›žæ”¶ äº”ã€æ–°ç”Ÿä»£å’Œè€å¹´ä»£ 5.1 æ–°ç”Ÿä»£ æ–°ç”Ÿä»£åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼Œä¸€ä¸ªEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼Œå®ƒä»¬ä¹‹é—´çš„æ¯”ä¾‹ä¸ºï¼ˆ8ï¼š1ï¼š1ï¼‰ï¼Œè¿™ä¸ªæ¯”ä¾‹ä¹Ÿæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹è±¡ä¸»è¦åˆ†é…åœ¨æ–°ç”Ÿä»£çš„EdenåŒºä¸Šï¼Œå°‘æ•°æƒ…å†µä¸‹ä¹Ÿå¯èƒ½ä¼šç›´æŽ¥åˆ†é…åœ¨è€å¹´ä»£ä¸­ã€‚ Javaè™šæ‹Ÿæœºæ¯æ¬¡ä½¿ç”¨æ–°ç”Ÿä»£ä¸­çš„Edenå’Œå…¶ä¸­ä¸€å—Survivorï¼ˆFromï¼‰ï¼Œåœ¨ç»è¿‡ä¸€æ¬¡MinorGCåŽï¼Œå°†Edenå’ŒSurvivorä¸­è¿˜å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§åœ°å¤åˆ¶åˆ°å¦ä¸€å—Survivorç©ºé—´ä¸Šï¼ˆè¿™é‡Œä½¿ç”¨çš„å¤åˆ¶ç®—æ³•è¿›è¡ŒGCï¼‰ï¼Œæœ€åŽæ¸…ç†æŽ‰Edenå’Œåˆšæ‰ç”¨è¿‡çš„Survivorï¼ˆFromï¼‰ç©ºé—´ã€‚å°†æ­¤æ—¶åœ¨Survivorç©ºé—´å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡çš„å¹´é¾„è®¾ç½®ä¸º1ï¼Œä»¥åŽè¿™äº›å¯¹è±¡æ¯åœ¨SurvivoråŒºç†¬è¿‡ä¸€æ¬¡GCï¼Œå®ƒä»¬çš„å¹´é¾„å°±åŠ 1ï¼Œå½“å¯¹è±¡å¹´é¾„è¾¾åˆ°æŸä¸ªå¹´é¾„ï¼ˆé»˜è®¤å€¼ä¸º15ï¼‰æ—¶ï¼Œå°±ä¼šæŠŠå®ƒä»¬ç§»åˆ°è€å¹´ä»£ä¸­ã€‚ åœ¨æ–°ç”Ÿä»£ä¸­è¿›è¡ŒGCæ—¶ï¼Œæœ‰å¯èƒ½é‡åˆ°å¦å¤–ä¸€å—Survivorç©ºé—´æ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾ä¸Šä¸€æ¬¡æ–°ç”Ÿä»£æ”¶é›†ä¸‹æ¥çš„å­˜æ´»å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°†ç›´æŽ¥é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶è¿›å…¥è€å¹´ä»£ã€‚ æ€»ç»“ï¼š 1ã€Minor GCæ˜¯å‘ç”Ÿåœ¨æ–°ç”Ÿä»£ä¸­çš„åžƒåœ¾æ”¶é›†ï¼Œé‡‡ç”¨çš„å¤åˆ¶ç®—æ³•ï¼› 2ã€æ–°ç”Ÿä»£ä¸­æ¯æ¬¡ä½¿ç”¨çš„ç©ºé—´ä¸è¶…è¿‡90%ï¼Œä¸»è¦ç”¨æ¥å­˜æ”¾æ–°ç”Ÿçš„å¯¹è±¡ï¼› 3ã€Minor GCæ¯æ¬¡æ”¶é›†åŽEdenåŒºå’Œä¸€å—SurvivoråŒºéƒ½è¢«æ¸…ç©ºï¼› 5.1 è€å¹´ä»£ è€å¹´ä»£é‡Œé¢å­˜æ”¾éƒ½æ˜¯ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡ï¼Œå¯¹äºŽä¸€äº›è¾ƒå¤§çš„å¯¹è±¡ï¼ˆå³éœ€è¦åˆ†é…ä¸€å—è¾ƒå¤§çš„è¿žç»­å†…å­˜ç©ºé—´ï¼‰ï¼Œæ˜¯ç›´æŽ¥å­˜å…¥è€å¹´ä»£çš„ï¼Œè¿˜æœ‰å¾ˆå¤šä»Žæ–°ç”Ÿä»£çš„SurvivoråŒºåŸŸä¸­ç†¬è¿‡æ¥çš„å¯¹è±¡ã€‚ è€å¹´ä»£ä¸­ä½¿ç”¨çš„æ˜¯Full GCï¼ŒFull GCæ‰€é‡‡ç”¨çš„æ˜¯æ ‡è®°-æ¸…é™¤æˆ–è€…æ ‡è®°-æ•´ç†ç®—æ³•ã€‚è€å¹´ä»£ä¸­çš„Full GCä¸åƒMinor GCæ“ä½œé‚£ä¹ˆé¢‘ç¹ï¼Œå¹¶ä¸”è¿›è¡Œä¸€æ¬¡Full GCæ‰€éœ€è¦çš„æ—¶é—´è¦æ¯”Minor GCçš„æ—¶é—´é•¿ã€‚ 5.2 è§¦å‘Full GCçš„æ¡ä»¶ è€å¹´ä»£ç©ºé—´ä¸è¶³ JDK8ä»¥å‰çš„æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³ï¼ŒçŽ°åœ¨æ°¸ä¹…ä»£å·²ç»è¢«å…ƒæ•°æ®åŒºä»£æ›¿ CMS GCæ—¶å‡ºçŽ°promotion failedï¼Œconcurrent mode failure(ä¸‹é¢æ–‡ç« è®²åˆ°CMSåžƒåœ¾æ”¶é›†å™¨çš„æ—¶å€™ä¼šè¯´æ˜Ž) minor GCæ™‹å‡åˆ°è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºŽè€å¹´ä»£çš„å‰©ä½™ç©ºé—´ è°ƒç”¨System.gc()æé†’JVMå›žæ”¶ä¸€ä¸‹ï¼Œåªæ˜¯æé†’ 5.3 å¯¹è±¡å¦‚ä½•æ™‹å‡åˆ°è€å¹´ä»£ ä¸€èˆ¬æœ‰å¦‚ä¸‹æƒ…å†µä¼šæ™‹å‡ï¼š ç»åŽ†ä¸€å®šminoræ¬¡æ•°ä¾ç„¶å­˜æ´»çš„å¯¹è±¡ survivoråŒºä¸­å­˜æ”¾ä¸ä¸‹çš„å¯¹è±¡ æ–°ç”Ÿæˆçš„å¤§å¯¹è±¡ 5.4 å¸¸ç”¨çš„è°ƒä¼˜å‚æ•° 5.5 å†…å­˜ç”³è¯·è¿‡ç¨‹ A. JVMä¼šè¯•å›¾ä¸ºç›¸å…³Javaå¯¹è±¡åœ¨Edenä¸­åˆå§‹åŒ–ä¸€å—å†…å­˜åŒºåŸŸ B. å½“Edenç©ºé—´è¶³å¤Ÿæ—¶ï¼Œå†…å­˜ç”³è¯·ç»“æŸã€‚å¦åˆ™åˆ°ä¸‹ä¸€æ­¥ C. JVMè¯•å›¾é‡Šæ”¾åœ¨Edenä¸­æ‰€æœ‰ä¸æ´»è·ƒçš„å¯¹è±¡ï¼ˆMinor GCï¼‰, é‡Šæ”¾åŽè‹¥Edenç©ºé—´ä»ç„¶ä¸è¶³ä»¥æ”¾å…¥æ–°å¯¹è±¡ï¼Œåˆ™è¯•å›¾å°†éƒ¨åˆ†Edenä¸­æ´»è·ƒå¯¹è±¡æ”¾å…¥SurvivoråŒº D. å½“SurvivoråŒºç©ºé—´ä¸å¤Ÿæ—¶æˆ–è€…æŸäº›å¯¹è±¡ç†¬çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œåˆ™SurvivoråŒºè¿™äº›å¯¹è±¡ä¼šè¢«ç§»åˆ°OldåŒº E. å½“OldåŒºç©ºé—´ä¸å¤Ÿæ—¶ï¼ŒJVMä¼šåœ¨OldåŒºè¿›è¡Œå®Œå…¨çš„åžƒåœ¾æ”¶é›†ï¼ˆFull GCï¼‰ F. å®Œå…¨åžƒåœ¾æ”¶é›†åŽï¼Œè‹¥SurvivoråŠOldåŒºä»ç„¶æ— æ³•å­˜æ”¾ä»ŽEdenå¤åˆ¶è¿‡æ¥çš„éƒ¨åˆ†å¯¹è±¡ï¼Œå¯¼è‡´JVMæ— æ³•åœ¨EdenåŒºä¸ºæ–°å¯¹è±¡åˆ›å»ºå†…å­˜åŒºåŸŸï¼Œåˆ™å‡ºçŽ°out of memoryé”™è¯¯.]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAå†…å­˜æ¨¡åž‹å¸¸é—®é¢è¯•é¢˜]]></title>
    <url>%2F2019%2F02%2F08%2FJVM%2FJAVA%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E5%B8%B8%E9%97%AE%E9%9D%A2%E8%AF%95%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬ä¸ƒç¯‡æ–‡ç« ï¼Œä»‹ç»ä¸€äº›é¢è¯•æ¯”è¾ƒå¸¸é—®çš„é—®é¢˜ã€‚ ä¸€ã€JVMä¸‰å¤§æ€§èƒ½è°ƒä¼˜å‚æ•°-Xms -Xmx -Xssçš„å«ä¹‰ ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä»¥ä¸‹å‚æ•°åŽ»è°ƒæ•´å †å’Œå†…å­˜æ‰€å çš„å¤§å°ï¼š 1java -Xms128m -Xmx128m -Xss256k -jar xxx.jar -Xms ï¼šå †çš„åˆå§‹å€¼ -Xmx ï¼šå †èƒ½è¾¾åˆ°çš„æœ€å¤§å€¼ -Xss ï¼šè§„å®šäº†æ¯ä¸ªçº¿ç¨‹è™šæ‹Ÿæœºæ ˆçš„å¤§å° äºŒã€JAVAå†…å­˜æ¨¡åž‹ä¸­å †å’Œæ ˆçš„åŒºåˆ« é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹å‡ ç§ä¸åŒçš„å†…å­˜åˆ†é…ç­–ç•¥ï¼š é™æ€å­˜å‚¨ï¼šç¼–è¯‘æ—¶ç¡®å®šæ¯ä¸ªæ•°æ®ç›®æ ‡åœ¨è¿è¡Œæ—¶çš„å­˜å‚¨ç©ºé—´éœ€æ±‚ï¼Œæ¯”å¦‚staticå£°æ˜Žçš„é™æ€å˜é‡ï¼Œè¿™é‡Œçš„æ•°æ®ä¸€èˆ¬éƒ½æ”¾åœ¨æ–¹æ³•åŒºï¼Œjava8ä¸­è¿™ä¸ªåŒºåŸŸå«åšå…ƒæ•°æ®åŒºï¼Œç”¨çš„æ—¶ç‰©ç†å†…å­˜ï¼Œå¹¶ä¸”ä¹‹å‰åˆåœ¨ä¸€èµ·çš„å­—ç¬¦ä¸²å¸¸é‡æ± ä¹Ÿè¢«ç§»åˆ°äº†å †åŒºï¼Œè¯¦æƒ…è§ä¸Šä¸€ç¯‡æ–‡ç« ã€‚ æ ˆå¼å­˜å‚¨ï¼šæ•°æ®åŽ»éœ€æ±‚åœ¨ç¼–è¯‘æ—¶æœªçŸ¥ï¼Œè¿è¡Œæ—¶æ¨¡å—å…¥å£å‰ç¡®å®šï¼Œæ¯”å¦‚åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œéƒ½æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œæ‰çŸ¥é“æ•°æ®(å­—é¢é‡)åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå¯¹äºŽJVMï¼Œä¸€ä¸ªæ–¹æ³•å†…çš„æ‰§è¡Œï¼Œå±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆçš„å¤§å°æ—¶ç¡®å®šçš„ï¼Œå³å¼•ç”¨å˜é‡å’Œæ ˆç©ºé—´å¤§å°æ˜¯ç¼–è¯‘å™¨ç¡®å®šçš„ï¼Œè‡³äºŽå­—é¢é‡ç­‰è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šã€‚ å †å¼å­˜å‚¨ï¼šç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶æ¨¡å—å…¥å£éƒ½æ— æ³•ç¡®å®šï¼ŒåŠ¨æ€åˆ†é…ï¼Œæ¯”å¦‚å¯å˜é•¿åº¦ä¸²ã€å¯¹è±¡å®žä¾‹ ä¸‹é¢æ¥çœ‹çœ‹æ ˆå’Œå †çš„è”ç³»ï¼š å¼•ç”¨å¯¹è±¡æˆ–è€…æ•°ç»„æ—¶ï¼Œæ ˆé‡Œå®šä¹‰å˜é‡ä¿å­˜å †ä¸­ç›®æ ‡çš„é¦–åœ°å€ã€‚ ä¸‹é¢æ¥çœ‹çœ‹æ ˆå’Œå †çš„åŒºåˆ«ï¼š ç®¡ç†æ–¹å¼ï¼šæ ˆè‡ªåŠ¨é‡Šæ”¾ï¼Œå †éœ€è¦GC ç©ºé—´å¤§å°ï¼šæ ˆæ¯”å †å° ç¢Žç‰‡ç›¸å…³ï¼šæ ˆäº§ç”Ÿçš„ç¢Žç‰‡è¿œå°äºŽå † åˆ†é…æ–¹å¼ï¼šæ ˆæ”¯æŒé™æ€å’ŒåŠ¨æ€åˆ†é…ï¼Œè€Œå †ä»…æ”¯æŒåŠ¨æ€åˆ†é… æ•ˆçŽ‡ï¼šæ ˆçš„æ•ˆçŽ‡æ¯”å †é«˜ ç®€å•æ€»ç»“ï¼šæ ˆæ¯”è¾ƒå°ï¼Œéšç€æ–¹æ³•æ‰§è¡Œå®Œæ¯•è‡ªåŠ¨é‡Šæ”¾ï¼Œæ ˆæ•°æ®ç»“æž„ç®€å•ï¼Œæ‰€ä»¥æ“ä½œä¹Ÿç®€å•é«˜æ•ˆã€‚å †æ”¾å„ç§å¯¹è±¡å®žä¾‹å’Œæ•°ç»„ï¼Œå¿…å®šè¦æ¯”è¾ƒå¤§çš„ç©ºé—´ï¼Œé‚£ä¹ˆéœ€è¦GCæ¥å›žæ”¶ä¸éœ€è¦çš„æ•°æ®ï¼Œæ•ˆçŽ‡ä½Žå¹¶ä¸”ç¢Žç‰‡ä¹Ÿæ¯”è¾ƒå¤šï¼Œç”±äºŽå †çš„æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æ•°æ®ç»“æž„ä¹Ÿå¤æ‚ï¼Œæ•ˆçŽ‡ä½Žã€‚ ä¸‰ã€å…ƒç©ºé—´ã€å †ã€çº¿ç¨‹ç‹¬å éƒ¨åˆ†é—´çš„è”ç³» å…ˆæ¥çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åºï¼š æˆ‘ä»¬åˆ†åˆ«ä»Žå…ƒç©ºé—´ã€å †ã€ä»¥åŠçº¿ç¨‹ç‹¬å çš„éƒ¨åˆ†æ¥çœ‹çœ‹åˆ†åˆ«å­˜å‚¨äº†å•¥ï¼š å­¦åˆ°è¿™é‡Œï¼Œå¯¹äºŽè¿™äº›ä¸œè¥¿å·²ç»ä¸éœ€è¦è§£é‡Šäº†ã€‚é’ˆå¯¹JVMå†…å­˜æ¨¡åž‹çš„çŸ¥è¯†åœ¨è¿™é‡Œå°±ä¸²è”èµ·æ¥äº†ã€‚äº†è§£åˆ°è¿™é‡Œï¼Œå¯¹å†…å­˜æ¨¡åž‹è¿™ä¸€å—åŸºæœ¬çš„çŸ¥è¯†å·²ç»å·®ä¸å¤šäº†ã€‚ å››ã€å†æ¥è¯´è¯´å­—ç¬¦ä¸² ä¹‹å‰åœ¨javaå­—ç¬¦ä¸²æ ¸å¿ƒä¸€ç½‘æ‰“å°½æ–‡ç« ä¸­ï¼Œå…¶å®žæ˜¯å¯¹äºŽJDK8è¿™ä¸ªç‰ˆæœ¬çš„å­—ç¬¦ä¸²ç‰¹æ€§è¿›è¡Œè¯¦ç»†çš„è§£è¯»ï¼Œå…¶ä¸­ä¹Ÿä»‹ç»äº†internè¿™ä¸ªæ–¹æ³•çš„å«ä¹‰å’Œç”¨æ³•ï¼Œç”±äºŽJDK6å’ŒJDK6+å…³äºŽinternæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™é‡Œå¯¹æ¯”ä¸€ä¸‹ã€‚ å¯¹äºŽJDK8ï¼š 12345678910111213public static void main(String[] args) throws ClassNotFoundException &#123; //ç¬¬ä¸€ç§æƒ…å†µ String str1 = new String("a"); str1.intern(); String str2 = "a"; System.out.println(str1 == str2); //ç¬¬äºŒç§æƒ…å†µ String str3 = new String("a") + new String("a"); str3.intern(); String str4 = "aa"; System.out.println(str3 == str4);&#125; è¾“å‡ºç»“æžœä¸ºï¼š 12falsetrue ä½†æ˜¯åœ¨JDK6ä¸­æ‰§è¡Œç»“æžœä¸ºï¼š 12falsefalse è¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘å¾ˆä¹…ï¼Œç”±äºŽä¹‹å‰åŸºç¡€ä¸æ˜¯å¤ªæ‰Žå®žï¼Œæ‰€ä»¥ç›´æŽ¥å°±è·³è¿‡äº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨é¢è¯•çš„æ—¶å€™å‡ ä¹Žä¹Ÿä¸ä¼šå¤ªæ·±ç©¶ï¼Œä½†æ˜¯ä¸€ç›´æˆä¸ºæˆ‘å¿ƒé‡Œçš„åŽã€‚ä»Šå¤©è¦æŠŠä»–è§£å†³æŽ‰ã€‚åœ¨è¯´æ˜Žè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œéœ€è¦è¯´æ˜Žä¸€ä¸‹JVMæœ‰ä¸‰ç§å¸¸é‡æ± ï¼š 4.1 ä¸‰ç§å¸¸é‡æ±  Classæ–‡ä»¶ä¸­çš„å¸¸é‡æ±  è¿™é‡Œé¢ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œç¬¦å·å¼•ç”¨åŒ…å«ä¸‰ç±»å¸¸é‡ï¼š ç±»å’ŒæŽ¥å£çš„å…¨é™å®šå(Full Qualified Name) å­—æ®µçš„åç§°å’Œæè¿°ç¬¦(Descriptor) æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ è¿™ä¸ªç”¨javapçœ‹ä¸€ä¸‹å°±èƒ½æ˜Žç™½ï¼Œè¿™é‡Œåªæ¶‰åŠå­—ç¬¦ä¸²å°±ä¸è°ˆå…¶ä»–çš„äº†ã€‚ç®€å•åœ°è¯´ï¼Œç”¨åŒå¼•å·å¼•èµ·æ¥çš„å­—ç¬¦ä¸²å­—é¢é‡éƒ½ä¼šè¿›è¿™é‡Œé¢ã€‚ 1String str2 = "a"; è¿™é‡Œçš„str2å°±æ˜¯ç¬¦å·å¼•ç”¨ï¼Œaå°±æ˜¯å­—é¢é‡ã€‚ è¿è¡Œæ—¶å¸¸é‡æ±  æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Classæ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æŽ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰å¸¸é‡æ± (Constant Pool Table)ï¼Œå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åŽè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ã€‚ å…¨å±€å­—ç¬¦ä¸² HotSpot VMé‡Œï¼Œè®°å½•interned stringçš„ä¸€ä¸ªå…¨å±€è¡¨å«åšStringTableï¼Œå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸ªHashSet&lt;String&gt;ã€‚è¿™æ˜¯ä¸ªçº¯è¿è¡Œæ—¶çš„ç»“æž„ï¼Œè€Œä¸”æ˜¯æƒ°æ€§ï¼ˆlazyï¼‰ç»´æŠ¤çš„ã€‚ æ³¨æ„ï¼Œå®ƒé‡Œé¢å­˜æ”¾çš„æ˜¯å¼•ç”¨ã€‚ æ‰€ä»¥ï¼Œä¸€èˆ¬æˆ‘ä»¬è¯´ä¸€ä¸ªå­—ç¬¦ä¸²è¿›å…¥äº†å…¨å±€çš„å­—ç¬¦ä¸²å¸¸é‡æ± å…¶å®žæ˜¯è¯´åœ¨è¿™ä¸ªStringTableä¸­ä¿å­˜äº†å¯¹å®ƒçš„å¼•ç”¨ï¼Œåä¹‹ï¼Œå¦‚æžœè¯´æ²¡æœ‰åœ¨å…¶ä¸­å°±æ˜¯è¯´StringTableä¸­æ²¡æœ‰å¯¹å®ƒçš„å¼•ç”¨ã€‚ 4.2 å­—é¢é‡è¿›å…¥å­—ç¬¦ä¸²å¸¸é‡æ± çš„æ—¶æœº å…ˆç»™å‡ºä¸€ä¸ªç»“è®ºï¼šå°±HotSpot VMçš„å®žçŽ°æ¥è¯´ï¼ŒåŠ è½½ç±»çš„æ—¶å€™ï¼Œé‚£äº›å­—ç¬¦ä¸²å­—é¢é‡ä¼šè¿›å…¥åˆ°å½“å‰ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¸ä¼šè¿›å…¥å…¨å±€çš„å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆå³åœ¨StringTableä¸­å¹¶æ²¡æœ‰ç›¸åº”çš„å¼•ç”¨ï¼Œåœ¨å †ä¸­ä¹Ÿæ²¡æœ‰å¯¹åº”çš„å¯¹è±¡äº§ç”Ÿï¼‰ é‚£ä¹ˆåŠ è½½ç±»çš„è¿‡ç¨‹å‘ç”Ÿçš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ Rå¤§çš„ä¸€ç¯‡æ–‡ç« ï¼š åœ¨ç±»åŠ è½½é˜¶æ®µï¼Œ JVMä¼šåœ¨å †ä¸­åˆ›å»º å¯¹åº”è¿™äº› classæ–‡ä»¶å¸¸é‡æ± ä¸­çš„ å­—ç¬¦ä¸²å¯¹è±¡å®žä¾‹ å¹¶åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­é©»ç•™å…¶å¼•ç”¨ã€‚å…·ä½“åœ¨resolveé˜¶æ®µæ‰§è¡Œã€‚è¿™äº›å¸¸é‡å…¨å±€å…±äº«ã€‚ è¿™é‡Œè¯´çš„æ¯”è¾ƒç¬¼ç»Ÿï¼Œæ²¡é”™ï¼Œæ˜¯resolveé˜¶æ®µï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å¤§å®¶æƒ³çš„é‚£æ ·ï¼Œç«‹å³å°±åˆ›å»ºå¯¹è±¡å¹¶ä¸”åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­é©»ç•™äº†å¼•ç”¨ã€‚ JVMè§„èŒƒé‡Œæ˜Žç¡®æŒ‡å®šresolveé˜¶æ®µå¯ä»¥æ˜¯lazyçš„ã€‚ æ‰€ä»¥ï¼Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå¿…å®šè¦åšçš„ä¸œè¥¿æ˜¯ï¼Œå°†classæ–‡ä»¶ä¸­å­—é¢é‡å’Œç¬¦å·å¼•ç”¨æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œè€ŒJVMè§„èŒƒé‡ŒClassæ–‡ä»¶çš„å¸¸é‡æ± é¡¹çš„ç±»åž‹ï¼Œæœ‰ä¸¤ç§ä¸œè¥¿ï¼šCONSTANT_Utf8å’ŒCONSTANT_Stringã€‚åŽè€…æ˜¯Stringå¸¸é‡çš„ç±»åž‹ï¼Œä½†å®ƒå¹¶ä¸ç›´æŽ¥æŒæœ‰Stringå¸¸é‡çš„å†…å®¹ï¼Œè€Œæ˜¯åªæŒæœ‰ä¸€ä¸ªindexï¼Œè¿™ä¸ªindexæ‰€æŒ‡å®šçš„å¦ä¸€ä¸ªå¸¸é‡æ± é¡¹å¿…é¡»æ˜¯ä¸€ä¸ªCONSTANT_Utf8ç±»åž‹çš„å¸¸é‡ï¼Œè¿™é‡Œæ‰çœŸæ­£æŒæœ‰å­—ç¬¦ä¸²çš„å†…å®¹ã€‚ CONSTANT_Utf8ä¼šåœ¨ç±»åŠ è½½çš„è¿‡ç¨‹ä¸­å°±å…¨éƒ¨åˆ›å»ºå‡ºæ¥ï¼Œè€ŒCONSTANT_Stringåˆ™æ˜¯lazy resolveçš„ï¼Œä¾‹å¦‚è¯´åœ¨ç¬¬ä¸€æ¬¡å¼•ç”¨è¯¥é¡¹çš„ldcæŒ‡ä»¤è¢«ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°çš„æ—¶å€™æ‰ä¼šresolveã€‚ 4.3 ldcæŒ‡ä»¤æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ ç®€å•åœ°è¯´ï¼Œå®ƒç”¨äºŽå°†intã€floatæˆ–Stringåž‹å¸¸é‡å€¼ä»Žå¸¸é‡æ± ä¸­æŽ¨é€è‡³æ ˆé¡¶ ä»¥ä¸‹é¢ä»£ç ä¸ºä¾‹ï¼š 12345public class Abc &#123; public static void main(String[] args) &#123; String a = "AA"; &#125; &#125; æŸ¥çœ‹å…¶ç¼–è¯‘åŽçš„Classæ–‡ä»¶å¦‚ä¸‹ï¼š æ ¹æ®ä¸Šé¢è¯´çš„ï¼Œåœ¨ç±»åŠ è½½é˜¶æ®µï¼Œè¿™ä¸ª resolve é˜¶æ®µï¼ˆ constant pool resolutionï¼‰æ˜¯lazyçš„ã€‚æ¢å¥è¯è¯´å¹¶æ²¡æœ‰çœŸæ­£çš„å¯¹è±¡ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± é‡Œè‡ªç„¶ä¹Ÿæ²¡æœ‰ã€‚æ‰§è¡ŒldcæŒ‡ä»¤å°±æ˜¯è§¦å‘è¿™ä¸ªlazy resolutionåŠ¨ä½œçš„æ¡ä»¶ã€‚ ldcå­—èŠ‚ç åœ¨è¿™é‡Œçš„æ‰§è¡Œè¯­ä¹‰æ˜¯ï¼šåˆ°å½“å‰ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± åŽ»æŸ¥æ‰¾è¯¥indexå¯¹åº”çš„é¡¹,å³ä¸Šé¢è¯´çš„CONSTANT_StringæŒ‡å‘çš„indexï¼Œå¦‚æžœè¯¥é¡¹å°šæœªresolveåˆ™resolveä¹‹ï¼Œå¹¶è¿”å›žresolveåŽçš„å†…å®¹ã€‚ åœ¨é‡åˆ°Stringç±»åž‹å¸¸é‡æ—¶ï¼Œresolveçš„è¿‡ç¨‹å¦‚æžœå‘çŽ°StringTableå·²ç»æœ‰äº†å†…å®¹åŒ¹é…çš„java.lang.Stringçš„å¼•ç”¨ï¼Œåˆ™ç›´æŽ¥è¿”å›žè¿™ä¸ªå¼•ç”¨ï¼Œåä¹‹ï¼Œå¦‚æžœStringTableé‡Œå°šæœªæœ‰å†…å®¹åŒ¹é…çš„Stringå®žä¾‹çš„å¼•ç”¨ï¼Œåˆ™ä¼šåœ¨Javaå †é‡Œåˆ›å»ºä¸€ä¸ªå¯¹åº”å†…å®¹çš„Stringå¯¹è±¡ï¼Œç„¶åŽåœ¨StringTableè®°å½•ä¸‹è¿™ä¸ªå¼•ç”¨ï¼Œå¹¶è¿”å›žè¿™ä¸ªå¼•ç”¨å‡ºåŽ»ã€‚ è¿™é‡Œå¾ˆé‡è¦ï¼Œæ˜­ç¤ºäº†ä¸€ä¸ªé‡è¦é—®é¢˜ï¼šString a = &quot;AA&quot;;è¿™ä¸€å¥æ‰§è¡Œå®Œï¼Œè¦çœ‹å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„è¯æ˜¯è¦åœ¨å †ä¸­å…ˆåˆ›å»ºå¯¹è±¡çš„ï¼Œç„¶åŽæŠŠå †åœ°å€ç»™å…¨å±€çš„å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚ ç†è§£åˆ°è¿™ï¼Œæœ‰äº›é—®é¢˜å°±å¯ä»¥è§£å†³äº†ï¼Œè¿™é‡Œå…ˆä¸å›žç­”æœ€ä¸Šé¢çš„é—®é¢˜ï¼Œå…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚æ³¨æ„è¿è¡ŒçŽ¯å¢ƒæ˜¯JDK8ï¼š 123456789class NewTest0 &#123; public static String s1="static"; // ç¬¬ä¸€å¥ public static void main(String[] args) &#123; String s2 = new String("he")+new String("llo"); //ç¬¬äºŒå¥ s2.intern(); // ç¬¬ä¸‰å¥ String s3="hello"; //ç¬¬å››å¥ System.out.println(s2 == s3);//ç¬¬äº”å¥ï¼Œè¾“å‡ºæ˜¯trueã€‚ &#125;&#125; &quot;static&quot; &quot;he&quot; &quot;llo&quot; &quot;hello&quot;éƒ½ä¼šè¿›å…¥Classçš„å¸¸é‡æ± ï¼Œ æŒ‰ç…§ä¸Šé¢è¯´çš„ï¼Œç±»åŠ è½½é˜¶æ®µç”±äºŽresolve é˜¶æ®µæ˜¯lazyçš„ï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šåˆ›å»ºå®žä¾‹ï¼Œæ›´ä¸ä¼šé©»ç•™å­—ç¬¦ä¸²å¸¸é‡æ± äº†ã€‚ ä½†æ˜¯è¦æ³¨æ„è¿™ä¸ªâ€œstaticâ€å’Œå…¶ä»–ä¸‰ä¸ªä¸ä¸€æ ·ï¼Œå®ƒæ˜¯é™æ€çš„ï¼Œåœ¨ç±»åŠ è½½é˜¶æ®µä¸­çš„åˆå§‹åŒ–é˜¶æ®µï¼Œä¼šä¸ºé™æ€å˜é‡æŒ‡å®šåˆå§‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¦æŠŠâ€œstaticâ€èµ‹å€¼ç»™s1ï¼Œè¿™ä¸ªèµ‹å€¼æ“ä½œè¦æ€Žä¹ˆæžå•Šï¼Œå…ˆldcæŒ‡ä»¤æŠŠå®ƒæ”¾åˆ°æ ˆé¡¶ï¼Œç„¶åŽç”¨putstaticæŒ‡ä»¤å®Œæˆèµ‹å€¼ã€‚æ³¨æ„ï¼ŒldcæŒ‡ä»¤ï¼Œæ ¹æ®ä¸Šé¢è¯´çš„ï¼Œä¼šåˆ›å»º&quot;static&quot;å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šä¿å­˜ä¸€ä¸ªæŒ‡å‘å®ƒçš„å¼•ç”¨åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚ è¿è¡Œmainæ–¹æ³•åŽï¼Œé¦–å…ˆæ˜¯ç¬¬äºŒå¥ï¼Œä¸€æ ·çš„ï¼Œè¦å…ˆç”¨ldcæŠŠ&quot;he&quot;å’Œ&quot;llo&quot;é€åˆ°æ ˆé¡¶ï¼Œæ¢å¥è¯è¯´ï¼Œä¼šåˆ›å»ºä»–ä¿©çš„å¯¹è±¡ï¼ˆæ³¨æ„ï¼Œåœ¨å †ä¸­å¼€è¾Ÿæœ¬ä½“æ‰€å çš„ç©ºé—´ï¼Œè¿˜æ²¡åˆ°newçš„é‚£ä¸€æ­¥ï¼‰ï¼Œå¹¶ä¸”ä¼šä¿å­˜å¼•ç”¨åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼ˆæŠŠæœ¬åœ°åœ¨å †ä¸­ç©ºé—´åœ°å€ä¼ ç»™å­—ç¬¦ä¸²å¸¸é‡æ± ï¼‰ï¼›ç„¶åŽæœ‰ä¸ªï¼‹å·å¯¹å§ï¼Œå†…éƒ¨æ˜¯åˆ›å»ºäº†ä¸€ä¸ªStringBuilderå¯¹è±¡ï¼Œä¸€è·¯appendï¼Œæœ€åŽè°ƒç”¨StringBuilderå¯¹è±¡çš„toStringæ–¹æ³•å¾—åˆ°ä¸€ä¸ªStringå¯¹è±¡ï¼ˆå†…å®¹æ˜¯helloï¼Œæ³¨æ„è¿™ä¸ªtoStringæ–¹æ³•ä¼šnewä¸€ä¸ªStringå¯¹è±¡ï¼‰ï¼Œå¹¶æŠŠå®ƒèµ‹å€¼ç»™s2ï¼ˆs2æŒ‡å‘çš„æ˜¯newå‡ºæ¥çš„æ–°å¯¹è±¡ï¼Œæ˜¯æ–°çš„ä¸€å—å†…å­˜ç©ºé—´ï¼‰ã€‚ æ³¨æ„ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰æŠŠhelloçš„å¼•ç”¨æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚ç„¶åŽæ˜¯ç¬¬ä¸‰å¥ï¼Œinternæ–¹æ³•ä¸€çœ‹ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± é‡Œé¢æ²¡æœ‰ï¼Œå®ƒä¼šæŠŠä¸Šé¢çš„è¿™ä¸ªhelloå¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œç„¶åŽè¿”å›žè¿™ä¸ªå¼•ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªè¿”å›žå€¼æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨å˜é‡åŽ»æŽ¥æ”¶ï¼Œæ‰€ä»¥æ²¡ç”¨ã€‚ ç¬¬å››å¥ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± é‡Œé¢å·²ç»æœ‰äº†ï¼Œç›´æŽ¥ç”¨å˜›ã€‚æ‰€ä»¥s2å’Œs3éƒ½æ˜¯s2çš„æŒ‡å‘çš„åœ°å€ã€‚ å†æ¥çœ‹ä¸ªä¾‹å­ï¼š 123456789101112public static void main(String[] args) &#123; // â‘  String s1=new String("he")+new String("llo"); String s2=new String("h")+new String("ello"); // â‘¡ String s3=s1.intern(); // â‘¢ String s4=s2.intern(); // â‘£ System.out.println(s1==s3); System.out.println(s1==s4);&#125; é¦–å…ˆæ˜¯å°†ä¸€äº›ç¬¦å·å¼•ç”¨å’Œå­—é¢é‡ä»Žclassæ–‡ä»¶çš„å¸¸é‡æ± ä¸­æ’žåˆ°è¿è¡Œæ—¶å¸¸é‡æ± ã€‚ç„¶åŽè¿è¡Œmainæ–¹æ³•ï¼Œå…ˆçœ‹ç¬¬ä¸€å¥ï¼Œä¼šåˆ›å»º&quot;he&quot;å’Œ&quot;llo&quot;å¯¹è±¡ï¼Œå¹¶æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œç„¶åŽä¼šåˆ›å»ºä¸€ä¸ª&quot;hello&quot;å¯¹è±¡ï¼Œæ²¡æœ‰æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œs1æŒ‡å‘è¿™ä¸ª&quot;hello&quot;å¯¹è±¡ã€‚ ç¬¬äºŒå¥ï¼Œåˆ›å»º&quot;h&quot;å’Œ&quot;ello&quot;å¯¹è±¡ï¼Œå¹¶æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œç„¶åŽä¼šåˆ›å»ºä¸€ä¸ª&quot;hello&quot;å¯¹è±¡ï¼Œæ²¡æœ‰æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œs2æŒ‡å‘è¿™ä¸ª&quot;hello&quot;å¯¹è±¡ã€‚ ç¬¬ä¸‰å¥ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± é‡Œé¢è¿˜æ²¡æœ‰ï¼ŒäºŽæ˜¯ä¼šæŠŠs1æŒ‡å‘çš„Stringå¯¹è±¡çš„å¼•ç”¨æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆæ¢å¥è¯è¯´ï¼Œæ”¾å…¥æ± ä¸­çš„å¼•ç”¨å’Œs1æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œç„¶åŽä¼šæŠŠè¿™ä¸ªå¼•ç”¨è¿”å›žç»™äº†s3ï¼Œæ‰€ä»¥s3==s1æ˜¯trueã€‚ ç¬¬å››å¥ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± é‡Œé¢å·²ç»æœ‰äº†ï¼Œç›´æŽ¥å°†å®ƒè¿”å›žç»™äº†s4ï¼Œæ‰€ä»¥s4==s1æ˜¯trueã€‚ æ­¤æ—¶ï¼Œå›žåˆ°ä¸€å¼€å§‹ï¼š 123456789101112131415161718192021public static void main(String[] args) throws ClassNotFoundException &#123; //ç¬¬ä¸€ç§æƒ…å†µ //1 String str1 = new String("a"); //2 str1.intern(); //3 String str2 = "a"; //4 System.out.println(str1 == str2); //ç¬¬äºŒç§æƒ…å†µ //5 String str3 = new String("a") + new String("a"); //6 str3.intern(); //7 String str4 = "aa"; //8 System.out.println(str3 == str4);&#125; åœ¨jdk1.6åŠä»¥å‰ï¼Œè°ƒç”¨intern() å¦‚æžœå¸¸é‡æ± ä¸­ä¸å­˜åœ¨å€¼ç›¸ç­‰çš„å­—ç¬¦ä¸²æ—¶ï¼Œjvmä¼šå¤åˆ¶ä¸€ä¸ªå­—ç¬¦ä¸²åˆ°åˆ›é‡æ± ä¸­ï¼Œå¹¶è¿”å›žå¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ã€‚ è€Œåœ¨jdk1.7åŠä»¥åŽï¼Œè°ƒç”¨intern() å¦‚æžœå¸¸é‡æ± ä¸­ä¸å­˜åœ¨å€¼ç›¸ç­‰çš„å­—ç¬¦ä¸²æ—¶ï¼Œjvmåªæ˜¯åœ¨å¸¸é‡æ± è®°å½•å½“å‰å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼Œå¹¶è¿”å›žå½“å‰å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚ æ‰€ä»¥åœ¨JDK6æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯è¿”å›žfalseï¼ŒåŽŸå› æ˜¯ï¼šç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œæ‰§è¡Œç¬¬ä¸€å¥ï¼Œçœ‹åˆ°æœ‰ä¸ªå­—ç¬¦ä¸²&quot;a&quot;ï¼Œé‚£ä¹ˆé¦–å…ˆæ˜¯åˆ›å»º&quot;a&quot;æœ¬ä½“å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠå‰¯æœ¬æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚æ‰§è¡Œç¬¬äºŒå¥ï¼Œå‘çŽ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ”¾äº†ã€‚æ‰§è¡Œç¬¬ä¸‰å¥ï¼Œ s2æŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„&quot;a&quot;ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± &quot;a&quot;æ‰€åœ¨çš„åœ°å€ï¼Œè‚¯å®šä¸Žå †ä¸­çš„æ–°newå‡ºæ¥çš„ä¸ä¸€æ ·ã€‚æ‰€ä»¥è¿”å›žfalseã€‚ ç¬¬äºŒç§æƒ…å†µï¼Œç¬¬ä¸€å¥ç›¸å½“äºŽï¼š å…¶å®žç›¸å½“äºŽ: 123String s1 = new String("a");String s2 = new String("a");String str3 = (new StringBuilder()).apend(s1).apend(s2).toString(); ä¼šå…ˆåœ¨å †ä¸­åˆ›å»ºä¸¤ä¸ªå¯¹è±¡&quot;a&quot;ï¼Œæ‹·è´ä¸€ä¸ªå‰¯æœ¬åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ­¤æ—¶&quot;a&quot;å·²ç»å­˜åœ¨äºŽå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­äº†ã€‚ç„¶åŽæ‹¼æŽ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡&quot;aa&quot;åœ¨å †ä¸­ï¼Œè¿™ç§æ‹¼æŽ¥å‡ºæ¥çš„&quot;aa&quot;æ­¤æ—¶æ˜¯ä¸ä¼šæŠŠå‰¯æœ¬æ”¾è¿›å­—ç¬¦ä¸²å¸¸é‡æ± çš„ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¸¸é‡æ± åªä¿å­˜å·²ç¡®å®šçš„å­—é¢é‡ï¼Œè¿™ç§æ‹¼æŽ¥çš„å±žäºŽè¿è¡Œå®Œæˆæ‰èƒ½ç¡®å®šï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰ï¼Œç›´åˆ°æ‰§è¡Œç¬¬6å¥ï¼Œæ‰ä¼šå°è¯•æŠŠ&quot;aa&quot;å‰¯æœ¬æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œä½†æ˜¯è¿˜æ˜¯è·Ÿä¸Šé¢ä¸€æ ·ï¼Œä¸€ä¸ªæŒ‡å‘å †ï¼Œä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œè‚¯å®šä¸ç›¸ç­‰ã€‚ åœ¨JDK6+æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªè¿”å›žfalseï¼Œç¬¬äºŒä¸ªè¿”å›žtrueã€‚åŽŸå› æ˜¯ï¼šç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œæ‰§è¡Œç¬¬ä¸€å¥ï¼Œé¦–å…ˆæ˜¯åˆ›å»º&quot;a&quot;æœ¬ä½“å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠå¼•ç”¨æ”¾è¿›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œç„¶åŽnewï¼Œå¼€è¾Ÿæ–°çš„åœ°å€ç©ºé—´ï¼Œæ­¤æ—¶str1æŒ‡å‘çš„æ˜¯newå‡ºæ¥çš„ç©ºé—´çš„å¼•ç”¨ã€‚æ‰§è¡Œç¬¬äºŒå¥ï¼Œå°è¯•å°†str1çš„å¼•ç”¨æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œä½†æ˜¯æ± ä¸­å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥ä¸èƒ½æ”¾ï¼Œæ‰€ä»¥ä¸€ä¸ªæŒ‡å‘å †ï¼Œä¸€ä¸ªæ˜¯æœ¬ä½“å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸ºfalseã€‚ç¬¬äºŒç§æƒ…å†µï¼Œ&quot;a&quot;è·Ÿä¸Šé¢ä¸€æ ·ï¼Œåœ¨å †ä¸­å¼€è¾Ÿï¼Œç„¶åŽå¼•ç”¨æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼ŒåŽé¢æ‹¼æŽ¥æˆ&quot;aa&quot;ï¼Œæ­¤æ—¶åªæ˜¯åœ¨å †ä¸­å¼€è¾Ÿç©ºé—´ï¼Œä¸‹é¢æ‰§è¡Œinternå°è¯•æŠŠå®ƒçš„å¼•ç”¨ä¼ ç»™å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œç”±äºŽå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰ï¼Œæ‰€ä»¥å°±æ”¾è¿›åŽ»äº†ã€‚æ­¤æ—¶å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¼•ç”¨ä¸Ž&quot;aa&quot;å¯¹è±¡å®žé™…çš„å †åœ°å€æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¸ºtrue. è¿™è¾¹æœ‰ä¸€ä¸ªäº‹å®žï¼šåœ¨æ‰§è¡ŒString s1 = new String(&quot;a&quot;)çš„newä¹‹å‰ï¼ŒJVMå…ˆçœ‹åˆ°æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²&quot;a&quot;ï¼Œåˆ™ä¼šå…ˆçœ‹çœ‹å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰è¿™ä¸ª&quot;a&quot;ï¼Œæœ‰åˆ™ç›´æŽ¥è¿”å›žå­—ç¬¦ä¸²å¸¸é‡æ± å¼•ç”¨ï¼Œæ²¡æœ‰åˆ™ç»™å®ƒå¼€è¾Ÿç©ºé—´ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªç©ºé—´çš„å¼•ç”¨ä¼ ç»™å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚ æ•´ç†è‡ªï¼šæœ¨å¥³å­©çš„å›žç­”]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å†…è¿žæŽ¥å’Œå¤–è¿žæŽ¥]]></title>
    <url>%2F2019%2F02%2F05%2Fmysql%2F%E5%86%85%E8%BF%9E%E6%8E%A5%E5%92%8C%E5%A4%96%E8%BF%9E%E6%8E%A5%2F</url>
    <content type="text"><![CDATA[åœ¨ç”µä¿¡å®žä¹ çš„æ—¶å€™ï¼Œå¤©å¤©æœ‰äººæ¥é¢è¯•ï¼Œé—®çš„é—®é¢˜æˆ‘éƒ½å¬çš„è›®æ¸…æ¥šçš„ï¼Œæ¯”å¦‚å†…è¿žæŽ¥å’Œå¤–è¿žæŽ¥çš„åŒºåˆ«ï¼Œå¥½åƒå¾ˆç®€å•ï¼Œä½†è¿˜æ˜¯è¯´çš„ä¸å¥½ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚ 12345 Aè¡¨ Bè¡¨id name id name 1 a 1 b 2 b 3 c4 c å†…è¿žæŽ¥ å†…è¿žæŽ¥å°±æ˜¯å·¦è¡¨å’Œå³è¡¨ç›¸åŒçš„æ•°æ®: 1select * from A inner join B on A.id=B.id ç»“æžœï¼š 12id name id name 1 a 1 b å·¦å¤–è¿žæŽ¥ å·¦å¤–è¿žæŽ¥å°±æ˜¯ä»¥å·¦è¡¨ä¸ºå‡†ï¼ŒåŽ»åŒ¹é…å³è¡¨ï¼Œå·¦è¡¨æœ‰å¤šå°‘æ¡æ•°æ®ï¼Œç»“æžœå°±æ˜¯å¤šå°‘æ¡æ•°æ® 1select * from A left join B on A.id=B.id 1234id name id name 1 a 1 b 2 b null null4 c null null å³å¤–è¿žæŽ¥ å³å¤–è¿žæŽ¥å°±æ˜¯ä¸Žå·¦å¤–è¿žæŽ¥åä¹‹ï¼Œä»¥å³è¡¨ä¸ºå‡†ï¼ŒåŽ»åŒ¹é…å·¦è¡¨ï¼Œå³è¡¨æœ‰å¤šå°‘æ¡æ•°æ®ï¼Œç»“æžœå°±æ˜¯å¤šå°‘æ¡æ•°æ® 1select * from A right join B on A.id=B.id 123id name id name 1 a 1 b null null 3 c äº¤å‰è¿žæŽ¥ äº¤å‰è¿žæŽ¥ä¸å¸¦ WHERE å­å¥ï¼Œå®ƒè¿”å›žè¢«è¿žæŽ¥çš„ä¸¤ä¸ªè¡¨æ‰€æœ‰æ•°æ®è¡Œçš„ç¬›å¡å°”ç§¯ï¼Œè¿”å›žåˆ° ç»“æžœé›†åˆä¸­çš„æ•°æ®è¡Œæ•°ç­‰äºŽç¬¬ä¸€ä¸ªè¡¨ä¸­ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ•°æ®è¡Œæ•°ä¹˜ä»¥ç¬¬äºŒä¸ªè¡¨ä¸­ç¬¦åˆæŸ¥ è¯¢æ¡ä»¶çš„æ•°æ®è¡Œæ•°ã€‚ 1select * from A join B 1234567id name id name1 a 1 b1 a 3 c2 b 1 b2 b 3 c4 c 1 b4 c 3 c å†…è¿žæŽ¥å’Œå¤–è¿žæŽ¥çš„åŒºåˆ« å†…è¿žæŽ¥åªåˆ—å‡ºä¸¤å¼ è¡¨å…±åŒåŒ¹é…çš„æ•°æ®è¡Œï¼Œè€Œå¤–è¿žæŽ¥çš„ç»“æžœé›†ä¸­ä¸ä»…åŒ…å«ç¬¦åˆè¿žæŽ¥æ¡ä»¶çš„æ•°æ®è¡Œï¼Œè¿˜åŒ…æ‹¬å·¦è¡¨(å·¦å¤–è¿žæŽ¥æˆ–å·¦è¿žæŽ¥)æˆ–å³è¡¨(å³å¤–è¿žæŽ¥æˆ–å³è¿žæŽ¥)ä¸­çš„æ‰€æœ‰æ•°æ®è¡Œã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAå†…å­˜æ¨¡åž‹-çº¿ç¨‹å…±äº«]]></title>
    <url>%2F2019%2F02%2F05%2FJVM%2FJAVA%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B-%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬å…­ç¯‡æ–‡ç« ï¼Œä»‹ç»çº¿ç¨‹å…±äº«åŒºåŸŸã€‚ ä¸€ã€å†…å­˜æ¨¡åž‹â€“JAVAå † javaå †ä¸€èˆ¬æ˜¯javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚ javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚ å †ä¸Šå­˜æ”¾å¯¹è±¡å®žä¾‹å’Œæ•°ç»„ã€‚ javaå †å¯ä»¥å¤„äºŽç‰©ç†ä¸Šä¸è¿žç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿žç»­çš„å³å¯ã€‚ å¦‚æžœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®žä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ äºŒã€å†…å­˜æ¨¡åž‹â€“æ–¹æ³•åŒº æ–¹æ³•åŒºå’Œå †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚ å®ƒç”¨äºŽå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€åŠæ—¶ç¼–è¯‘å™¨ç¼–è¯‘åŽçš„ä»£ç ç­‰æ•°æ®ã€‚ å…¶ä¸­ï¼Œç±»ä¿¡æ¯åŒ…å«ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æŽ¥å£ã€æ–¹æ³• å…«ã€PermGenä¸ŽMetaspace å…¶å®žï¼Œæ–¹æ³•åŒºå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè§„èŒƒï¼Œjdk6çš„å…·ä½“å®žçŽ°æ˜¯PermGen,è€ŒåŽæ¥çš„ç‰ˆæœ¬å…·ä½“å®žçŽ°æ˜¯Metaspaceã€‚å®ƒä»¬æœ‰ä¸€å®šçš„åŒºåˆ«ã€‚ åœ¨ HotSpot JVM ä¸­ï¼Œæ°¸ä¹…ä»£ä¸­ç”¨äºŽå­˜æ”¾ç±»å’Œæ–¹æ³•çš„å…ƒæ•°æ®ä»¥åŠå¸¸é‡æ± ï¼Œæ¯”å¦‚Classå’ŒMethodã€‚æ¯å½“ä¸€ä¸ªç±»åˆæ¬¡è¢«åŠ è½½çš„æ—¶å€™ï¼Œå®ƒçš„å…ƒæ•°æ®éƒ½ä¼šæ”¾åˆ°æ°¸ä¹…ä»£ä¸­ã€‚ æ°¸ä¹…ä»£æ˜¯æœ‰å¤§å°é™åˆ¶çš„ï¼Œå®ƒç”¨çš„æ˜¯JVMå†…å­˜ï¼Œå³ä¸Žå †å†…å­˜ç­‰ä»·çš„no heapåŒºåŸŸï¼Œå› æ­¤å¦‚æžœåŠ è½½çš„ç±»å¤ªå¤šï¼Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡ºï¼Œå³ä¸‡æ¶çš„ java.lang.OutOfMemoryError: PermGen ï¼Œä¸ºæ­¤æˆ‘ä»¬ä¸å¾—ä¸å¯¹è™šæ‹Ÿæœºåšè°ƒä¼˜ã€‚ ç”±äºŽ PermGen å†…å­˜ç»å¸¸ä¼šæº¢å‡ºï¼Œå¼•å‘æ¼äººçš„ java.lang.OutOfMemoryError: PermGenï¼Œå› æ­¤ JVM çš„å¼€å‘è€…å¸Œæœ›è¿™ä¸€å—å†…å­˜å¯ä»¥æ›´çµæ´»åœ°è¢«ç®¡ç†ï¼Œä¸è¦å†ç»å¸¸å‡ºçŽ°è¿™æ ·çš„ OOM ç§»é™¤ PermGen å¯ä»¥ä¿ƒè¿› HotSpot JVM ä¸Ž JRockit VM çš„èžåˆï¼Œå› ä¸º JRockit æ²¡æœ‰æ°¸ä¹…ä»£ã€‚ æ ¹æ®ä¸Šé¢çš„å„ç§åŽŸå› ï¼ŒPermGen æœ€ç»ˆè¢«ç§»é™¤ï¼Œæ–¹æ³•åŒºç§»è‡³ Metaspaceï¼Œå­—ç¬¦ä¸²å¸¸é‡ç§»è‡³ Java Heapã€‚Metaspaceå¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜,ååˆ†æ–¹ä¾¿ç®¡ç†ï¼Œä¸ä¼šå‡ºçŽ°æ°¸ä¹…å¸¦å†…å­˜æº¢å‡ºé—®é¢˜ï¼Œåžƒåœ¾å›žæ”¶çš„æ—¶å€™è¿™ä¸ªå•ç‹¬åŒºåŸŸæ–¹ä¾¿å¤„ç†ã€‚ ä¸‰ã€è¿è¡Œæ—¶å¸¸é‡æ±  æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚ ç±»æ–‡ä»¶ä¸­é™¤äº†ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æŽ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼Œç”¨äºŽå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åŽè¿›å…¥æ–¹æ³•çš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚ è¿™é‡Œå°¤å…¶å€¼å¾—æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²çš„åˆ›å»ºï¼Œä¼šè¢«æ‰”åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚å¦‚æžœæ˜¯newï¼Œé‚£ä¹ˆè¿˜æ˜¯åœ¨å †é‡åˆ›å»ºçš„ã€‚å½“ç„¶ï¼Œè¿è¡Œæ—¶ä¹Ÿå¯ä»¥äº§ç”Ÿæ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼Œæ¯”å¦‚è®²newå‡ºæ¥çš„å­—ç¬¦ä¸²ç”¨intern()æ–¹æ³•ä¾¿å¯ä»¥åœ¨è¿è¡Œæ—¶å°†å…¶æ”¾åˆ°å¸¸é‡æ± ä¸­ã€‚ ä¸¾ä¾‹ 123456789101112public static void main(String[] args) &#123; String str1 = "hello"; String str2 = "hello"; System.out.println(str1 == str2); //true String str3 = new String("hello"); System.out.println(str1 == str3); //false System.out.println(str1 == str3.intern()); //true &#125; è¯´æ˜Ž å¯¹äºŽç›´æŽ¥å£°æ˜Žçš„å†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå¯¹äºŽstr2æ¥è¯´æ˜¯ä¸éœ€è¦é‡æ–°åˆ†é…åœ°å€çš„ï¼Œå› ä¸ºstr1çš„helloè¿™ä¸ªå¸¸é‡å·²ç»å­˜åœ¨äºŽå¸¸é‡æ± ä¸­äº†ã€‚æ‰€ä»¥ä»–ä»¬ä¸¤ä¸ªå…¶å®žæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚ å¯¹äºŽnewå‡ºæ¥çš„str3ï¼Œæ˜¯ä¸ä¼šç›´æŽ¥æ‰”åˆ°å¸¸é‡æ± ä¸­çš„ï¼Œä»–æ˜¯åœ¨å †ä¸­åˆ†é…ï¼Œåœ°å€ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ˜¾ç„¶æ˜¯falseã€‚ Stringç±»çš„intern()æ–¹æ³•ï¼Œä½¿å¾—è¿è¡Œæ—¶å°†å †ä¸­äº§ç”Ÿçš„å¯¹è±¡æ”¾å…¥å¸¸é‡æ± ä¸­ï¼Œæ‰€ä»¥æ˜¯trueã€‚ è¿™é‡Œæˆ‘åœ¨javaå­—ç¬¦ä¸²æ ¸å¿ƒä¸€ç½‘æ‰“å°½ä¸­å·²ç»è¯¦ç»†è¯´æ˜Žäº†ï¼Œä¸å†èµ˜è¿°ã€‚ å››ã€å¯¹è±¡æŽ¢ç§˜ 4.1 å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ ç±»åŠ è½½æ£€æŸ¥ï¼šæ£€æŸ¥è¯¥å¯¹è±¡çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ã€è§£æžã€åˆå§‹åŒ–è¿‡ï¼Œå¦‚æžœæ²¡æœ‰åˆ™å…ˆè¿›è¡Œç±»åŠ è½½æ“ä½œã€‚ åˆ†é…å†…å­˜ï¼šå¦‚æžœå†…å­˜è§„æ•´ä½¿ç”¨â€œæŒ‡é’ˆç¢°æ’žâ€åˆ†é…ï¼Œå¦åˆ™ä¸€èˆ¬ä½¿ç”¨â€œç©ºé—²åˆ—è¡¨â€åˆ†é…ï¼Œå…·ä½“çœ‹åžƒåœ¾å›žæ”¶å™¨æ˜¯å¦å¸¦æœ‰æ•´ç†ï¼ˆCompactï¼‰ç©ºé—²å†…å­˜åŠŸèƒ½ã€‚ åˆå§‹åŒ–ï¼šå°†å†…å­˜åŒºåˆå§‹åŒ–ç½®é›¶ï¼Œä¸åŒ…å«å¯¹è±¡å¤´ï¼Œè¿™ä¸€æ­¥ä¿è¯äº†å¯¹è±¡çš„å®žä¾‹å­—æ®µåœ¨javaä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå€¼å°±ç›´æŽ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»åž‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚ å¯¹è±¡å¤´è®¾ç½®ï¼šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®žä¾‹ã€å¦‚ä½•æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ä¿¡æ¯ç­‰å³ä¸ºå¯¹è±¡å¤´ å¯¹è±¡çš„æ–¹æ³•ï¼šå³æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ– 4.2 å¯¹è±¡çš„å†…å­˜å¸ƒå±€ å¯¹è±¡å¤´ ä¸€éƒ¨åˆ†ç§°ä¸ºMark Wordï¼Œå­˜å‚¨å¯¹è±¡è‡ªèº«è¿è¡Œæ—¶çš„æ•°æ®ï¼ŒåŒ…å«å“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ç­‰ç­‰ã€‚ é‡‡ç”¨åŽ‹ç¼©å­˜å‚¨ï¼ŒåŽ‹ç¼©åˆ°è™šæ‹Ÿæœºä½æ•°ï¼ˆ32ä½/64ä½ï¼‰ã€‚ç”±äºŽå¯¹è±¡å¤´ä¿¡æ¯æ˜¯ä¸Žå¯¹è±¡è‡ªèº«å®šä¹‰çš„æ•°æ®æ— å…³çš„é¢å¤–å­˜å‚¨æˆæœ¬ï¼Œè€ƒè™‘åˆ°è™šæ‹Ÿæœºçš„ç©ºé—´æ•ˆçŽ‡ï¼ŒMark Wordè¢«è®¾è®¡ä¸ºä¸€ä¸ªéžå›ºå®šçš„æ•°æ®ç»“æž„ä»¥ä¾¿åœ¨æžå°çš„ç©ºé—´å†…å­˜å‚¨å°½é‡å¤šçš„ä¿¡æ¯ï¼Œå®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ã€‚ å¦ä¸€éƒ¨åˆ†ä¸ºç±»åž‹æŒ‡é’ˆï¼ŒæŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®ï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®žä¾‹ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰è™šæ‹Ÿæœºå®žçŽ°éƒ½å¿…é¡»åœ¨å¯¹è±¡æ•°æ®ä¸Šä¿ç•™ç±»åž‹æŒ‡é’ˆï¼Œæ¢å¥è¯è¯´ï¼ŒæŸ¥æ‰¾å¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ä¸ä¸€å®šè¦ç»è¿‡å¯¹è±¡æœ¬èº«ã€‚ å¦‚æžœå¯¹è±¡æ˜¯ä¸€ä¸ªjavaæ•°ç»„ï¼Œé‚£ä¹ˆåœ¨å¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—ç”¨äºŽè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ï¼Œå› ä¸ºè™šæ‹Ÿæœºå¯ä»¥é€šè¿‡æ™®é€šjavaå¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ç¡®å®šjavaå¯¹è±¡çš„å¤§å°ï¼Œä½†æ˜¯ä»Žæ•°ç»„çš„å…ƒæ•°æ®ä¸­å´æ— æ³•ç¡®å®šæ•°ç»„çš„å¤§å°ã€‚ å®žä¾‹æ•°æ® å®žä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­å®šä¹‰çš„å„ç§ç±»åž‹çš„å­—æ®µå†…å®¹ã€‚ æ— è®ºæ˜¯ä»Žçˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œè¿˜æ˜¯åœ¨å­ç±»ä¸­å®šä¹‰çš„ï¼Œéƒ½éœ€è¦è®°å½•èµ·æ¥ã€‚ ä»Žåˆ†é…ç­–ç•¥ä¸­å¯ä»¥çœ‹å‡ºï¼Œç›¸åŒå®½åº¦çš„å­—æ®µæ€»æ˜¯åˆ†é…åœ¨ä¸€èµ·ï¼Œåœ¨æ»¡è¶³è¿™ä¸ªå‰ææ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œåœ¨çˆ¶ç±»ä¸­å®šä¹‰çš„å˜é‡ä¼šå‡ºçŽ°åœ¨å­ç±»ä¹‹å‰ã€‚ å¯¹é½å¡«å…… éžå¿…éœ€ï¼Œåªæœ‰å‰ä¸¤è€…åŠ èµ·æ¥éž8çš„å€æ•°æ—¶æ‰ä¼šæœ‰ã€‚ å› ä¸ºHotSpot VM çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚ä¸å¯¹é½çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥å¡«å……å¯¹é½ã€‚ ä¹ã€å¯¹è±¡çš„è®¿é—®å®šä½ é€šè¿‡å¥æŸ„è®¿é—® é€šè¿‡å¥æŸ„è®¿é—®å¯¹è±¡ï¼šå½“javaè™šæ‹ŸæœºGCç§»åŠ¨å †å¯¹è±¡æ—¶ï¼Œå¹¶ä¸éœ€è¦ä¿®æ”¹referenceï¼Œåªéœ€ä¿®æ”¹å¥æŸ„å¯¹è±¡çš„å®žä¾‹æ•°æ®æŒ‡é’ˆã€‚ é€šè¿‡ç›´æŽ¥æŒ‡é’ˆè®¿é—® é€šè¿‡ç›´æŽ¥æŒ‡é’ˆè®¿é—®å¯¹è±¡ï¼šåŠ å¿«äº†å¯¹è±¡è®¿é—®é€Ÿåº¦ï¼Œæ¯”é—´æŽ¥è®¿é—®å°‘ä¸€æ¬¡å¯¹è±¡å®žä¾‹æ•°æ®çš„è®¿é—®ï¼ŒHotSpotåˆ™é‡‡ç”¨çš„è¿™ç§è®¿é—®æ–¹å¼ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAå†…å­˜æ¨¡åž‹-çº¿ç¨‹ç§æœ‰]]></title>
    <url>%2F2019%2F02%2F05%2FJVM%2FJAVA%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B-%E7%BA%BF%E7%A8%8B%E7%A7%81%E6%9C%89%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬äº”ç¯‡æ–‡ç« ï¼ŒJVMçš„å†…å­˜æ¨¡åž‹ä¸€èˆ¬æ˜¯é¢è¯•å¿…é—®çš„ç‚¹ï¼Œå› ä¸ºå¯¹JVMå†…å­˜æ¨¡åž‹æœ‰æ‰€äº†è§£ï¼Œæ‰ä¼šæœ‰å¯èƒ½çŸ¥é“è°ƒä¼˜æ‰‹æ®µã€‚æœ¬ç¯‡æ–‡ç« é¦–å…ˆä»‹ç»çº¿ç¨‹ç§æœ‰çš„ä¸€äº›åŒºåŸŸã€‚ ä¸€ã€ä»Žæ•´ä½“çœ‹JVMè¿è¡Œæ—¶å†…å­˜æ¨¡åž‹ ä¸‹é¢è¯¦ç»†è¯´è¯´å„ä¸ªéƒ¨åˆ†çš„ä½œç”¨ã€‚ äºŒã€å†…å­˜æ¨¡åž‹â€“ç¨‹åºè®¡æ•°å™¨ å ç”¨å†…å­˜å°ï¼šæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ PCä½œç”¨ï¼šå­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªçŽ¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚ çº¿ç¨‹ç‹¬ç«‹ï¼šä¸ºäº†çº¿ç¨‹åˆ‡æ¢åŽèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„æ¡çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬æˆè¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚ nativeæ–¹æ³•ï¼šå¦‚æžœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªjavaæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æžœæ­£åœ¨æ‰§è¡Œçš„æ˜¯Nativeæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å€¼åˆ™ä¸ºç©º(undefined). æ— å†…å­˜æº¢å‡ºå¼‚å¸¸ï¼šæ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚ ä¸‰ã€å†…å­˜æ¨¡åž‹â€“JAVAè™šæ‹Ÿæœºæ ˆ çº¿ç¨‹ç§æœ‰ï¼Œç”Ÿå‘½å‘¨æœŸä¸Žçº¿ç¨‹ç›¸åŒã€‚ è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•çš„å†…å­˜æ¨¡åž‹ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºŽå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æŽ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸ªæ–¹æ³•ä»Žè°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚ å››ã€æ ˆå¸§ æˆ‘ä»¬å£ä¸­å¸¸å¸¸æåˆ°çš„æ ˆä¸Žå †ï¼Œå…¶ä¸­æ ˆå°±æ˜¯çŽ°åœ¨è®²çš„è™šæ‹Ÿæœºæ ˆï¼Œæˆ–è€…è¯´æ˜¯è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†ã€‚ å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»åž‹(boolean,byte,char,short,int,float,long,double),å¯¹è±¡å¼•ç”¨(å®ƒä¸ç­‰åŒäºŽå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸Žæ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®)ã€returnAddressç±»åž‹(æŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€) å…¶ä¸­64ä½é•¿åº¦çš„longå’Œdoubleç±»åž‹çš„æ•°æ®ä¼šå ç”¨2ä¸ªå±€éƒ¨å˜é‡ç©ºé—´ï¼Œå…¶ä½™çš„æ•°æ®ç±»åž‹åªå ç”¨1ä¸ªã€‚ å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸå®Œæˆåˆ†é…ï¼Œå½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨å¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ã€‚ å¦‚æžœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºŽè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œæ¯”å¦‚é€’å½’å±‚æ•°è¿‡å¤šï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸ï¼›å¦‚æžœè™šæ‹Ÿæœºå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå³è™šæ‹Ÿæœºæ ˆç”³è¯·è¿‡å¤šï¼Œæ‰©å±•æ—¶å´æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ äº”ã€å†…å­˜æ¨¡åž‹â€“æœ¬åœ°æ–¹æ³•æ ˆ æœ¬åœ°æ–¹æ³•æ ˆä¸Žè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨æ˜¯éžå¸¸ç›¸ä¼¼çš„ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆå°¾è™šæ‹Ÿæœºæ‰§è¡Œjavaæ–¹æ³•(ä¹Ÿå°±æ˜¯å­—èŠ‚ç )æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚ Sun HotSpotè™šæ‹Ÿæœºç›´æŽ¥å°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚ ä¸Žè™šæ‹Ÿæœºæ ˆä¸€æ ·ä¼šæŠ›å‡ºStackOverflowErrorå¼‚å¸¸æˆ–è€…OutOfMemoryErrorå¼‚å¸¸ã€‚ ä»€ä¹ˆæ˜¯nativeæ–¹æ³•ï¼Ÿ ç®€å•åœ°è®²ï¼Œä¸€ä¸ªNative Methodå°±æ˜¯ä¸€ä¸ªjavaè°ƒç”¨éžjavaä»£ç çš„æŽ¥å£ã€‚ä¸€ä¸ªNative Methodæ˜¯è¿™æ ·ä¸€ä¸ªjavaçš„æ–¹æ³•ï¼šè¯¥æ–¹æ³•çš„å®žçŽ°ç”±éžjavaè¯­è¨€å®žçŽ°ï¼Œæ¯”å¦‚Cã€‚è¿™ä¸ªç‰¹å¾å¹¶éžjavaæ‰€ç‰¹æœ‰ï¼Œå¾ˆå¤šå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¿™ä¸€æœºåˆ¶ï¼Œæ¯”å¦‚åœ¨Cï¼‹ï¼‹ä¸­ï¼Œä½ å¯ä»¥ç”¨extern â€œCâ€å‘ŠçŸ¥Cï¼‹ï¼‹ç¼–è¯‘å™¨åŽ»è°ƒç”¨ä¸€ä¸ªCçš„å‡½æ•°ã€‚ ä¸‹ä¸€ç¯‡æ¥çœ‹çœ‹çº¿ç¨‹å…±äº«çš„åŒºåŸŸã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç»†è°ˆloadClass]]></title>
    <url>%2F2019%2F02%2F05%2FJVM%2F%E7%BB%86%E8%B0%88loadClass%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬å››ç¯‡æ–‡ç« ï¼Œå¯¹äºŽèŽ·å–Classå¯¹è±¡ï¼Œå…¶å®žæˆ‘ä»¬ä¸çŸ¥ä¸è§‰ä¸­å·²ç»æŽ¥è§¦è¿‡ä¸¤ç§äº†ï¼Œä¸€ç§å°±æ˜¯loadClassï¼Œä¸€ç§å°±æ˜¯åå°„ä¸­çš„forNameï¼Œå®ƒä»¬åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå…¶å®žæ¶‰åŠäº†ç±»åŠ è½½è¿‡ç¨‹çš„åŒºåˆ«ã€‚ä¸‹é¢å¥½å¥½æ¥æŽ¢è®¨ä¸€ä¸‹ã€‚ ä¸€ã€é—®é¢˜çš„æå‡º å¯¹äºŽä¹‹å‰çš„ æµ‹è¯•ä»£ç ï¼š 12345678public class Test &#123; public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException &#123; MyClassLoader myClassLoader = new MyClassLoader("C:\\Users\\swg\\Desktop\\","myClassLoader"); Class c = myClassLoader.loadClass("Robot"); System.out.println(c.getClassLoader()); c.newInstance(); &#125;&#125; ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰ç–‘æƒ‘ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯ç”¨äº†loadClass(name)æ¥åŠ è½½å¯¹åº”çš„Classå¯¹è±¡çš„ï¼Œæœ€åŽè¿˜éœ€è¦è¿›è¡ŒnewInstance()ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è°ƒç”¨newInstance()æ‰è¡Œå‘¢ï¼Ÿ 1.1 newçš„æ–¹å¼æž„å»ºå¯¹è±¡å®žä¾‹ ä¸‹é¢è¦è¿›è¡Œç›¸åº”çš„æµ‹è¯•ã€‚å¯¹äºŽRobot.java: é¦–å…ˆç”¨newçš„æ–¹å¼ï¼š æ˜¾ç¤ºç»“æžœä¸ºï¼š 1hello , i am a robot! 1.2 loadClassæ¥èŽ·å–Classå¯¹è±¡ å¦‚æžœä»…ä»…è¿™æ ·å†™ï¼Œæ˜¾ç¤ºç»“æžœä»…ä»…ä¸ºï¼š 1sun.misc.Launcher$AppClassLoader@18b4aac2 ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸ä¼šè§¦å‘staticé™æ€å—çš„æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç±»æ ¹æœ¬å°±æ²¡æœ‰åˆå§‹åŒ–ã€‚ 1.3 forNameæ¥èŽ·å–Classå¯¹è±¡ æ˜¾ç¤ºç»“æžœä¸ºï¼š 1hello , i am a robot! è§¦å‘äº†é™æ€å—çš„æ‰§è¡Œã€‚ äºŒã€ç±»åŠ è½½è¿‡ç¨‹ è¦æƒ³è¯´æ˜Žä¸Šé¢åŒºåˆ«äº§ç”Ÿçš„åŽŸå› ï¼Œè¿™é‡Œå¿…é¡»è¦ä»‹ç»ä¸€ä¸ªä»Žæœªä½¿ç”¨è¿‡çš„ç±»åŠ è½½çš„è¿‡ç¨‹ã€‚ ç±»ä»Žè¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡(Preparation)ã€è§£æž(Resolution)ã€åˆå§‹åŒ–(Initialization)ã€ä½¿ç”¨(Using)å’Œå¸è½½(Unloading)7ä¸ªé˜¶æ®µã€‚å…¶ä¸­å‡†å¤‡ã€éªŒè¯ã€è§£æž3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿žæŽ¥ï¼ˆLinkingï¼‰ã€‚å¦‚å›¾æ‰€ç¤ºï¼š åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™5ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹å¿…é¡»æŒ‰ç…§è¿™ç§é¡ºåºæŒ‰éƒ¨å°±ç­åœ°å¼€å§‹ï¼Œè€Œè§£æžé˜¶æ®µåˆ™ä¸ä¸€å®šï¼šå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åŽå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®šï¼ˆä¹Ÿç§°ä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®šï¼‰ã€‚ 2.1 åŠ è½½ åœ¨åŠ è½½é˜¶æ®µï¼ˆå¯ä»¥å‚è€ƒjava.lang.ClassLoaderçš„loadClass()æ–¹æ³•ï¼‰ï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹3ä»¶äº‹æƒ…ï¼š é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥èŽ·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼ˆå¹¶æ²¡æœ‰æŒ‡æ˜Žè¦ä»Žä¸€ä¸ªClassæ–‡ä»¶ä¸­èŽ·å–ï¼Œå¯ä»¥ä»Žå…¶ä»–æ¸ é“ï¼Œè­¬å¦‚ï¼šç½‘ç»œã€åŠ¨æ€ç”Ÿæˆã€æ•°æ®åº“ç­‰ï¼‰ï¼› å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æž„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æž„ï¼› åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ï¼› åŠ è½½é˜¶æ®µå’Œè¿žæŽ¥é˜¶æ®µï¼ˆLinkingï¼‰çš„éƒ¨åˆ†å†…å®¹ï¼ˆå¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œï¼‰æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªå®Œæˆï¼Œè¿žæŽ¥é˜¶æ®µå¯èƒ½å·²ç»å¼€å§‹ï¼Œä½†è¿™äº›å¤¹åœ¨åŠ è½½é˜¶æ®µä¹‹ä¸­è¿›è¡Œçš„åŠ¨ä½œï¼Œä»ç„¶å±žäºŽè¿žæŽ¥é˜¶æ®µçš„å†…å®¹ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µçš„å¼€å§‹æ—¶é—´ä»ç„¶ä¿æŒç€å›ºå®šçš„å…ˆåŽé¡ºåºã€‚ 2.2 éªŒè¯ éªŒè¯æ˜¯è¿žæŽ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚ éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼›ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥é­”æœ¯0xCAFEBABEå¼€å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»åž‹ã€‚ å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æžï¼ˆæ³¨æ„ï¼šå¯¹æ¯”javacç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æžï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ï¼›ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ã€‚ å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’ŒæŽ§åˆ¶æµåˆ†æžï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¡®ä¿è§£æžåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚ éªŒè¯é˜¶æ®µæ˜¯éžå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æžœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨-Xverifynoneå‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æŽªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚ 2.3 å‡†å¤‡ å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆè¢«staticä¿®é¥°çš„å˜é‡ï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®žä¾‹å˜é‡ï¼Œå®žä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®žä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨å †ä¸­ã€‚å…¶æ¬¡ï¼Œè¿™é‡Œæ‰€è¯´çš„åˆå§‹å€¼â€œé€šå¸¸æƒ…å†µâ€ä¸‹æ˜¯æ•°æ®ç±»åž‹çš„é›¶å€¼ï¼Œå‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼š 1public static int value=123; é‚£å˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åŽçš„åˆå§‹å€¼ä¸º0è€Œä¸æ˜¯123.å› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º123çš„putstaticæŒ‡ä»¤æ˜¯ç¨‹åºè¢«ç¼–è¯‘åŽï¼Œå­˜æ”¾äºŽç±»æž„é€ å™¨()æ–¹æ³•ä¹‹ä¸­ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º123çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚ è‡³äºŽâ€œç‰¹æ®Šæƒ…å†µâ€æ˜¯æŒ‡ï¼špublic static final int value=123ï¼Œå³å½“ç±»å­—æ®µçš„å­—æ®µå±žæ€§æ˜¯ConstantValueæ—¶ï¼Œä¼šåœ¨å‡†å¤‡é˜¶æ®µåˆå§‹åŒ–ä¸ºæŒ‡å®šçš„å€¼ï¼Œæ‰€ä»¥æ ‡æ³¨ä¸ºfinalä¹‹åŽï¼Œvalueçš„å€¼åœ¨å‡†å¤‡é˜¶æ®µåˆå§‹åŒ–ä¸º123è€Œéž0. 2.4 è§£æž è§£æžé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æŽ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚è§£æžåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æŽ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æŽ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»åž‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚ å¯¹äºŽè¿™é‡Œè¯´çš„ï¼šå°†ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æŽ¥å¼•ç”¨ã€‚å¾ˆå¤šäººåŒ…æ‹¬æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°çš„æ—¶å€™æ„Ÿè§‰èŽ«åå…¶å¦™ï¼Œæ•™æä¸Šä¹Ÿæ˜¯ç›´æŽ¥ç”¨è¿™äº›ä¸“ç”¨åè¯ï¼Œç»™æˆ‘ä»¬çš„å­¦ä¹ å¸¦æ¥äº†æžå¤§çš„å›°æ‰°ã€‚è¿™é‡Œè¿˜æ˜¯è¦è§£é‡Šä¸€ä¸‹ã€‚ æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š 123public static void main(String[] args) &#123; String s = "abc";&#125; sæ˜¯ç¬¦å·å¼•ç”¨ï¼Œè€Œabcæ˜¯å­—é¢é‡ã€‚ æ­¤æ—¶ï¼ŒçŸ¥é“äº†ä»€ä¹ˆæ˜¯ç¬¦å·å¼•ç”¨å°±å¥½åŠžäº†ï¼Œå› ä¸ºç¬¦å·å¼•ç”¨ä¸€èˆ¬éƒ½æ˜¯æ”¾åœ¨æ ˆä¸­çš„ï¼Œè¿™ä¸ªçŽ©æ„è‚¯å®šæ˜¯ä¾èµ–äºŽå®žé™…çš„ä¸œè¥¿ï¼Œç›¸å½“äºŽä¸€ä¸ªæŒ‡é’ˆï¼Œå¤šä»¥æˆ‘ä»¬ç¨‹åºéœ€è¦å°†å…¶è§£æžæˆè¿™ä¸ªå®žé™…ä¸œè¥¿æ‰€åœ¨çš„çœŸæ­£çš„åœ°å€ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦è§£æžäº†ï¼Œé‚£ä¹ˆå†…å­˜ä¸­å¿…ç„¶å®žé™…å­˜åœ¨äº†è¿™ä¸ªå¯¹è±¡ï¼Œå³æ‹¥æœ‰å®žé™…çš„ç‰©ç†åœ°å€äº†ã€‚ 2.5 åˆå§‹åŒ– ç±»åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åŽä¸€æ­¥ï¼Œåˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„javaç¨‹åºä»£ç ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œå˜é‡å·²ç»èµ‹è¿‡ä¸€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œåˆ™æ ¹æ®ç¨‹åºçŒ¿é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’åŽ»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶ä»–èµ„æºï¼Œæˆ–è€…è¯´ï¼šåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æž„é€ å™¨&lt;clinit&gt;()æ–¹æ³•çš„è¿‡ç¨‹. ä¸‰ã€newã€loadClassã€forName æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬æž„å»ºå¯¹è±¡å®žä¾‹æ˜¯é€šè¿‡newçš„æ–¹å¼ï¼Œnewæ˜¯éšå¼æž„å»ºå¯¹è±¡å®žä¾‹ï¼Œä¸éœ€è¦newInstance()ï¼Œå¹¶ä¸”å¯ä»¥ç”¨å¸¦å‚æ•°çš„æž„é€ å™¨æ¥ç”Ÿæˆå¯¹è±¡å®žä¾‹ï¼› å¯¹äºŽnewï¼Œæˆ‘ä»¬æœ‰ç‚¹åŸºç¡€çš„ï¼Œæ˜¯çŸ¥é“ï¼Œå·²ç»ä¸€ç›´æ¥åˆ°äº†æœ€åŽåˆå§‹åŒ–å®Œæˆçš„è¿™ä¸€æ­¥ï¼Œç”Ÿæˆäº†å¯ä»¥ç›´æŽ¥ä½¿ç”¨çš„å¯¹è±¡å®žä¾‹ã€‚ç”±äºŽç¯‡å¹…ä¸å®œå¤ªé•¿ï¼Œä¸æƒ³å±•å¼€è®²newçš„è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè¿™é‡Œå…ˆè´´ä¸ªæˆ‘è§‰å¾—è®²çš„ä¸é”™çš„é“¾æŽ¥ï¼šhttps://www.jianshu.com/p/ebaa1a03c594 ç„¶è€ŒloadClass(name)è¿™ç§æ˜¾ç¤ºè°ƒç”¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰åŠ è½½çš„åŠŸèƒ½ï¼Œè€Œæ²¡æœ‰åŽç»­è¿žæŽ¥ä»¥åŠåˆå§‹åŒ–çš„è¿‡ç¨‹ã€‚ æ‰€ä»¥loadClass(name)éœ€è¦è¿›è¡ŒnewInstance()æ‰èƒ½ç”Ÿæˆå¯¹åº”çš„å¯¹è±¡å®žä¾‹ï¼Œå¹¶ä¸”è¿™ä¸ªnewInstance()æ–¹æ³•ä¸æ”¯æŒå‚æ•°è°ƒç”¨ï¼Œè¦æƒ³å®žçŽ°è¾“å…¥å‚æ•°ç”Ÿæˆå®žä¾‹å¯¹è±¡ï¼Œéœ€è¦é€šè¿‡åå°„èŽ·å–æž„é€ å™¨å¯¹è±¡ä¼ å…¥å‚æ•°å†ç”Ÿæˆå¯¹è±¡å®žä¾‹ã€‚ è¿™é‡Œä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè¦newInstance()ï¼Œå› ä¸ºä¸è¿™æ ·ï¼ŒloadClass(name)åªæ˜¯åŠ è½½ï¼Œå¹¶æ²¡æœ‰åŽç»­è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç±»æ ¹æœ¬å°±æ²¡æœ‰åŠ¨å®ƒï¼Œä»…ä»…æ˜¯åŠ è½½è¿›æ¥è€Œå·²ã€‚ä»Žä»£ç å±‚é¢è°ƒç”¨loadClass()çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¹‹å‰æ•…æ„å¿½è§†çš„ä¸œè¥¿ï¼š è¿™ä¸ªresolveé»˜è®¤æ˜¯ä¼ å…¥falseçš„ï¼Œé‚£ä¹ˆè¿›æ¥çœ‹çœ‹è¿™ä¸ªresolveClass()æ–¹æ³•ï¼š å†ä¸‹åŽ»æ˜¯nativeæ–¹æ³•ï¼Œä¸å¿…å…³å¿ƒï¼Œæˆ‘ä»¬åªçœ‹æ–¹æ³•çš„æ³¨é‡Šå³å¯ï¼Œå†™çš„æ˜¯é“¾æŽ¥æŒ‡å®šçš„ç±»ï¼Œå°±æ˜¯ä¸Šé¢çš„è¿žæŽ¥è¿‡ç¨‹ã€‚æˆ‘ä»¬ç”±ä¸Šé¢çŸ¥é“ï¼Œå¦‚æžœè¿™ä¸ªæ–¹æ³•èƒ½æ‰§è¡Œï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘éªŒè¯ã€å‡†å¤‡ã€è§£æžè¿™ä¸‰ä¸ªè¿‡ç¨‹ï¼Œè€Œå‡†å¤‡é˜¶æ®µæ˜¯ä¼šåŽ»æ‰§è¡Œé™æ€æ–¹æ³•æˆ–é™æ€å—ï¼Œç±»å˜é‡ä¼šè¢«è¿›è¡Œåˆå§‹åŒ–ï¼Œå³åˆ†é…å†…å­˜ï¼Œä½†æ˜¯ä»…ä»…èµ‹åˆå€¼å³å¯ã€‚ æ‰€ä»¥ï¼ŒloadClass(name)æœ‰ä¸€ç§æ‡’åŠ è½½çš„æ€æƒ³åœ¨é‡Œé¢ï¼Œè¦ç”¨äº†å†åŽ»è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯ä¸€å¼€å§‹å°±åˆå§‹åŒ–å¥½ã€‚ æ—¢ç„¶å·²ç»çŸ¥é“äº†newå’ŒloadClassçš„åŒºåˆ«äº†ï¼Œä¸‹é¢å†æ¥çœ‹çœ‹Class.forName(),èªæ˜Žçš„è¯»è€…ä¼°è®¡å·²ç»å¯ä»¥çŒœåˆ°äº†ï¼Œæ²¡é”™ï¼Œæ ¹æ®å®žéªŒçš„ç»“æžœæ¥çœ‹ï¼Œå®ƒè‡³å°‘è¦è¿›è¡Œåˆ°è¿žæŽ¥å®Œï¼Œå®žè´¨å®ƒä¹Ÿå®Œæˆäº†åˆå§‹åŒ–ï¼Œå³å·²ç»åˆ°è¾¾ç¬¬ä¸‰æ­¥ï¼š æ€»ç»“ä¸€ä¸‹ï¼šloadClassä»…ä»…æ˜¯ç¬¬ä¸€æ­¥çš„åŠ è½½ï¼Œè€ŒforNameå’Œnewéƒ½æ˜¯å·²ç»åˆå§‹åŒ–å¥½äº†ã€‚ å­˜åœ¨çš„åŽŸå›  æ‰€è°“å­˜åœ¨å³åˆç†ï¼ŒforNameçš„ç”¨æ³•ï¼Œæœ€å¸¸è§çš„èŽ«è¿‡äºŽç”¨äºŽåŠ è½½æ•°æ®åº“é©±åŠ¨è¿™ï¼Œæˆ‘ä»¬è¿™é‡Œå®žéªŒä¸€ä¸‹ï¼Œé¦–å…ˆå¼•å…¥ç›¸å…³çš„ä¾èµ–ï¼š ç»å…¸å†™æ³•æ¥å•¦ï¼š ç‚¹è¿›åŽ»çœ‹çœ‹ï¼š æˆ‘ä»¬è¿™ä¸ªæ—¶å€™å‘çŽ°ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ªstaticæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦ç«‹å³åˆ›å»ºé©±åŠ¨ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™å¿…é¡»ç”¨fornameæ–¹æ³•å•¦ï¼ é‚£ä¹ˆå¯¹äºŽloadClassï¼Œå…¶å®žä¸Šé¢å·²ç»æåŠäº†ï¼Œå°±æ˜¯æ‡’åŠ è½½ï¼Œè¿™ä¸ªæ€æƒ³å†springä¸­æ˜¯åˆ°å¤„å¯è§çš„ï¼Œbeanåªæ˜¯åŠ è½½ï¼Œä½†æ˜¯æ­¥è¿›è¡Œåˆå§‹åŒ–ï¼Œç­‰ç”¨çš„æ—¶å€™å†åŽ»åˆå§‹åŒ–ï¼Œæé«˜æ€§èƒ½ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŒäº²å§”æ´¾æ¨¡åž‹]]></title>
    <url>%2F2019%2F02%2F05%2FJVM%2F%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œè°ˆåˆ°JVMç±»åŠ è½½æœºåˆ¶ï¼ŒåŒäº²å§”æ´¾æ¨¡åž‹æ˜¯ç»•ä¸å¼€çš„è¯é¢˜ï¼Œåå­—çœ‹å¥½åƒæ˜¯ä¸ªé«˜å¤§ä¸Šã€æ·±ä¸å¯æµ‹çš„çŽ©æ„ï¼Œå…¶å®žé€æ­¥æ­å¼€é¢çº±ä¹‹åŽå¾ˆç®€å•ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥æ­æ­çœ‹ã€‚ å›žé¡¾ç±»åŠ è½½å™¨ ä¸Šä¸€èŠ‚ç®€å•è¯´æ˜Žäº†ç±»åŠ è½½å™¨çš„ä½œç”¨ï¼Œåªè¯´åˆ°ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½æ˜¯åŠ è½½classæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œç»å¯¹æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œç¥žä¹¦ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ç¬¬äºŒç‰ˆå¯¹ç±»åŠ è½½å™¨çš„è¯´æ˜Žï¼š ä»£ç ç¼–è¯‘çš„ç»“æžœä»Žæœ¬åœ°æœºå™¨ç è½¬å˜æˆå­—èŠ‚ç ï¼Œæ˜¯å­˜å‚¨æ ¼å¼çš„ä¸€å°æ­¥ï¼Œå´æ˜¯ç¼–ç¨‹è¯­è¨€å‘å±•çš„ä¸€å¤§æ­¥ã€‚ Javaè™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»ŽClassæ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œè½¬æ¢è§£æžå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æŽ¥ä½¿ç”¨çš„Javaç±»åž‹ï¼Œè¿™å°±æ˜¯è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚ è™šæ‹Ÿæœºè®¾è®¡å›¢é˜ŸæŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥èŽ·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨åŽ»å®žçŽ°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•åŽ»èŽ·å–æ‰€éœ€è¦çš„ç±»ã€‚å®žçŽ°è¿™åŠ¨ä½œçš„ä»£ç æ¨¡å—æˆä¸ºâ€œç±»åŠ è½½å™¨â€ã€‚ ç±»åŠ è½½å™¨è™½ç„¶åªç”¨äºŽå®žçŽ°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œä½†å®ƒåœ¨Javaç¨‹åºä¸­èµ·åˆ°çš„ä½œç”¨å´è¿œè¿œä¸é™äºŽç±»åŠ è½½é˜¶æ®µã€‚å¯¹äºŽä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½ä»–çš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‘½åç©ºé—´ã€‚è¿™å¥è¯å¯ä»¥è¡¨è¾¾çš„æ›´é€šä¿—ä¸€äº›ï¼šæ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥è‡ªåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½ä»–ä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸ªä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ã€‚ å¯¹äºŽä¸Šé¢è¿›è¡Œä¸€äº›è¯´æ˜Žï¼š æ³¨æ„ï¼ŒåŠ è½½ä¹‹åŽè¦å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æž„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æž„ï¼ˆæ–¹æ³•åŒºå°±æ˜¯ç”¨æ¥å­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ï¼Œç¼–è¯‘åŽçš„ä»£ç çš„è¿è¡Œæ—¶å†…å­˜åŒºåŸŸï¼‰ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚è¿™ä¸ªClasså¯¹è±¡å¹¶æ²¡æœ‰è§„å®šæ˜¯åœ¨Javaå †å†…å­˜ä¸­ï¼Œå®ƒæ¯”è¾ƒç‰¹æ®Šï¼Œè™½ä¸ºå¯¹è±¡ï¼Œä½†å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­ã€‚ è¿™æ ·ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±»äº†ã€‚ è¿˜æœ‰ï¼Œå…³äºŽç›¸ç­‰ï¼Œåªæœ‰åœ¨æ»¡è¶³å¦‚ä¸‹ä¸‰ä¸ªç±»â€œç›¸ç­‰â€åˆ¤å®šæ¡ä»¶ï¼Œæ‰èƒ½åˆ¤å®šä¸¤ä¸ªç±»ç›¸ç­‰ã€‚ ä¸¤ä¸ªç±»æ¥è‡ªåŒä¸€ä¸ªClassæ–‡ä»¶ ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½ ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡åž‹ æˆ‘ä»¬ä¸Šä¸€èŠ‚å·²ç»çŸ¥é“äº†æœ‰å››ç§ç±»åŠ è½½å™¨ï¼Œå®ƒä»¬çš„å®žé™…å…³ç³»ä¸ºï¼š ä»Žè¿™ä¸ªå›¾æ¥çœ‹ï¼Œæ˜¯ä¸€ä¸ªç»§æ‰¿çš„å…³ç³»ï¼Œæ˜¯è¿™æ ·å—ï¼Ÿæˆ‘ä»¬ç”¨ä»£ç æ¥çœ‹çœ‹æ˜¯ä¸æ˜¯çœŸçš„æ˜¯è¿™æ ·ã€‚ ä»£ç è¿˜æ˜¯ç”¨ä¸Šä¸€ç¯‡æ–‡ç« è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥æµ‹è¯•ï¼š ç»“æžœæ˜¯ï¼š ä»Žè¿™ä¸ªç»“æžœå°±å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œå±‚çº§å…³ç³»æ˜¯ä¸Žä¸Šå›¾æ‰€è¿°çš„ä¸€æ ·ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªå±‚çº§å…³ç³»å…¶å®žå°±æ˜¯æˆ‘ä»¬ä¸‹é¢è¦è¯´çš„åŒäº²å§”æ´¾æ¨¡åž‹çš„ç»“æž„ã€‚ è¿™é‡Œè¿˜æƒ³è¡¥å……ä¸€ç‚¹ï¼šå°±æ˜¯ä¸ºä»€ä¹ˆæœ€åŽä¸€ä¸ªæ˜¯nullï¼Œå³bootstrapä¸ºä»€ä¹ˆæ˜¾ç¤ºnullï¼Œå…¶å®žæ˜¯å› ä¸ºå®ƒæ˜¯ç”¨C++å®žçŽ°çš„ï¼Œä¸æ˜¯javaè¯­è¨€å®žçŽ°çš„ï¼Œæ‰€ä»¥ä¸Žå…¶ä»–å‡ ä¸ªéƒ½æœ‰åŒºåˆ«ï¼Œè¿™é‡Œæ ¹æ®å°±è°ƒç”¨ä¸åˆ°ï¼Œæ‰€ä»¥æ˜¾ç¤ºnullã€‚å¦‚æžœéžè¦çœ‹bootstrapé‡Œé¢å¤§æ¦‚å¦‚ä½•å®žçŽ°çš„ï¼Œéœ€è¦åŽ»çœ‹çœ‹opjdkçš„ä»£ç ã€‚ ç»“åˆä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException&#123; //1.åŠ é” synchronized (getClassLoadingLock(name)) &#123; //2.é¦–å…ˆçœ‹çœ‹å½“å‰ç±»åŠ è½½å™¨æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œæ²¡æœ‰åˆ™å§”æ´¾ç»™çˆ¶äº²æŸ¥è¯¢ Class&lt;?&gt; c = findLoadedClass(name); //3.å¦‚æžœå½“å‰ç±»åŠ è½½å™¨æ²¡æœ‰åŠ è½½è¿‡ï¼Œè¿›æ¥ if (c == null) &#123; long t0 = System.nanoTime(); try &#123; //4.çœ‹æ˜¯å¦æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œæœ‰åˆ™è¿›æ¥ if (parent != null) &#123; //5.çˆ¶ç±»åŠ è½½å™¨çœ‹çœ‹æ˜¯å¦å·²ç»åŠ è½½è¿‡ //æ³¨æ„ï¼Œè¿™é‡Œæ˜¯å„é€’å½’å‡½æ•°ï¼Œå¦‚æžœç”±ä¸‹è‡³ä¸ŠæŸ¥è¯¢éƒ½æ²¡æœ‰åŠ è½½è¿‡ï¼Œåˆ™ä»Žä¸Šè‡³ä¸‹å°è¯•åŽ»åŠ è½½ c = parent.loadClass(name, false); &#125; else &#123; //è¿›åˆ°è¿™ä¸ªï¼Œæ˜¯æ¥çœ‹çœ‹bootstrapç±»åŠ è½½å™¨æ˜¯å¦åŠ è½½è¿‡ï¼Œæ²¡æœ‰åŠ è½½è¿‡åˆ™åŠ è½½ c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; //6.å¦‚æžœæ‰€æœ‰ç±»åŠ è½½å™¨éƒ½æ²¡æœ‰åŠ è½½è¿‡ï¼Œåˆ™å¼€å§‹å°è¯•ä»Žä¸Šè€Œä¸‹é€çº§åŽ»åŠ è½½ if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. long t1 = System.nanoTime(); //åŽ»åŠ è½½ c = findClass(name); // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; //ä¸€å¼€å§‹æ˜¯false if (resolve) &#123; resolveClass(c); &#125; return c; &#125;&#125; å…¶å®žå¾ˆç®€å•ï¼Œå°±æ˜¯å…ˆä¸€çº§ä¸€çº§å¾€ä¸ŠæŸ¥è¯¢æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼ŒåŠ è½½è¿‡ç›´æŽ¥è¿”å›žå³å¯ï¼›ä¸€ç›´æŸ¥è¯¢åˆ°bootstrapç±»åŠ è½½å™¨ï¼Œéƒ½æ²¡æœ‰åŠ è½½è¿‡ï¼Œé‚£ä¹ˆå°±ä»Žbootstrapç±»åŠ è½½å™¨å¼€å§‹ä¸€çº§ä¸€çº§å‘ä¸‹åˆ°ä»–ä»¬çš„æ‰«æèŒƒå›´å†…å°è¯•åŠ è½½è¿™ä¸ªclassæ–‡ä»¶ï¼ŒçŸ¥é“è‡ªå®šä¹‰ç±»åŠ è½½(å¦‚æžœæœ‰çš„è¯)ï¼Œæ²¡æœ‰åˆ™è¿”å›žæ‰¾ä¸åˆ°ã€‚ è¯´ä¸€ä¸‹ä»£ç çš„å®žçŽ°æ€è·¯ã€‚ä»£ç ä½¿ç”¨é€’å½’å®žçŽ°çš„ï¼Œå…ˆä¸€çº§ä¸€çº§æ‰¾çˆ¶äº²ï¼Œå³ä¸€çº§ä¸€çº§å‘ä¸Šå…¥æ ˆï¼ŒæŸä¸€ä¸ªæŸ¥åˆ°äº†å°±è¿”å›žï¼Œæ¯ä¸€å±‚é€’å½’åœç•™åœ¨c = parent.loadClass(name, false);ï¼›éƒ½æŸ¥ä¸åˆ°ï¼Œå†ä¸€çº§ä¸€çº§å‡ºæ ˆåŽ»æ‰§è¡Œï¼Œé‚£ä¹ˆå°±ä»Žc = findBootstrapClassOrNull(name);åŽé¢çš„ä»£ç ç»§ç»­æ‰§è¡Œï¼Œé‚£ä¹ˆæ˜¾ç„¶å°±æ˜¯æ‰§è¡Œif (c == null) {...}å°è¯•åŽ»åŠ è½½ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨åŒäº²å§”æ´¾æ¨¡åž‹ ä¸ºä»€ä¹ˆéœ€è¦åŒäº²å§”æ´¾æ¨¡åž‹å‘¢ï¼Ÿå‡è®¾æ²¡æœ‰åŒäº²å§”æ´¾æ¨¡åž‹ï¼Œè¯•æƒ³ä¸€ä¸ªåœºæ™¯ï¼š é»‘å®¢è‡ªå®šä¹‰ä¸€ä¸ªjava.lang.Stringç±»ï¼Œè¯¥Stringç±»å…·æœ‰ç³»ç»Ÿçš„Stringç±»ä¸€æ ·çš„åŠŸèƒ½ï¼Œåª æ˜¯åœ¨æŸä¸ªå‡½æ•°ç¨ä½œä¿®æ”¹ã€‚æ¯”å¦‚equalså‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç»å¸¸ä½¿ç”¨ï¼Œå¦‚æžœåœ¨è¿™è¿™ä¸ªå‡½æ•°ä¸­ï¼Œ é»‘å®¢åŠ å…¥ä¸€äº›â€œç—…æ¯’ä»£ç â€ã€‚å¹¶ä¸”é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ å…¥åˆ°JVMä¸­ã€‚æ­¤æ—¶ï¼Œå¦‚æžœæ²¡æœ‰åŒäº² å§”æ´¾æ¨¡åž‹ï¼Œé‚£ä¹ˆJVMå°±å¯èƒ½è¯¯ä»¥ä¸ºé»‘å®¢è‡ªå®šä¹‰çš„java.lang.Stringç±»æ˜¯ç³»ç»Ÿçš„Stringç±»ï¼Œ å¯¼è‡´â€œç—…æ¯’ä»£ç â€è¢«æ‰§è¡Œã€‚ è€Œæœ‰äº†åŒäº²å§”æ´¾æ¨¡åž‹ï¼Œé»‘å®¢è‡ªå®šä¹‰çš„java.lang.Stringç±»æ°¸è¿œéƒ½ä¸ä¼šè¢«åŠ è½½è¿›å†…å­˜ã€‚å› ä¸ºé¦–å…ˆæ˜¯æœ€é¡¶ç«¯çš„ç±»åŠ è½½å™¨åŠ è½½ç³»ç»Ÿçš„java.lang.Stringç±»ï¼Œæœ€ç»ˆè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ— æ³•åŠ è½½java.lang.Stringç±»ã€‚ æˆ–è®¸ä½ ä¼šæƒ³ï¼Œæˆ‘åœ¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨é‡Œé¢å¼ºåˆ¶åŠ è½½è‡ªå®šä¹‰çš„java.lang.Stringç±»ï¼Œä¸åŽ»é€šè¿‡è°ƒç”¨çˆ¶åŠ è½½å™¨ä¸å°±å¥½äº†å—?ç¡®å®žï¼Œè¿™æ ·æ˜¯å¯è¡Œã€‚ä½†æ˜¯ï¼Œåœ¨JVMä¸­ï¼Œåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªç±»åž‹æ—¶ï¼Œå¦‚æžœè¯¥å¯¹è±¡çš„å®žé™…ç±»åž‹ä¸Žå¾…æ¯”è¾ƒçš„ç±»åž‹çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£ä¹ˆä¼šè¿”å›žfalseã€‚ ä¸¾ä¸ªç®€å•ä¾‹å­ï¼š ClassLoader1ã€ClassLoader2éƒ½åŠ è½½java.lang.Stringç±»ï¼Œå¯¹åº”Class1ã€Class2å¯¹è±¡ã€‚ é‚£ä¹ˆClass1å¯¹è±¡ä¸å±žäºŽClassLoad2å¯¹è±¡åŠ è½½çš„java.lang.Stringç±»åž‹ã€‚ å§”æ‰˜æœºåˆ¶çš„æ„ä¹‰ï¼šé˜²æ­¢å†…å­˜ä¸­å‡ºçŽ°å¤šä»½åŒæ ·çš„å­—èŠ‚ç  æ¯”å¦‚ä¸¤ä¸ªç±»Aå’Œç±»Béƒ½è¦åŠ è½½Systemç±»ï¼š å¦‚æžœä¸ç”¨å§”æ‰˜è€Œæ˜¯è‡ªå·±åŠ è½½è‡ªå·±çš„ï¼Œé‚£ä¹ˆç±»Aå°±ä¼šåŠ è½½ä¸€ä»½Systemå­—èŠ‚ç ï¼Œç„¶åŽç±»Båˆä¼šåŠ è½½ä¸€ä»½Systemå­—èŠ‚ç ï¼Œè¿™æ ·å†…å­˜ä¸­å°±å‡ºçŽ°äº†ä¸¤ä»½Systemå­—èŠ‚ç ã€‚ å¦‚æžœä½¿ç”¨å§”æ‰˜æœºåˆ¶ï¼Œä¼šé€’å½’çš„å‘çˆ¶ç±»æŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯é¦–é€‰ç”¨Bootstrapå°è¯•åŠ è½½ï¼Œå¦‚æžœæ‰¾ä¸åˆ°å†å‘ä¸‹ã€‚è¿™é‡Œçš„Systemå°±èƒ½åœ¨Bootstrapä¸­æ‰¾åˆ°ç„¶åŽåŠ è½½ï¼Œå¦‚æžœæ­¤æ—¶ç±»Bä¹Ÿè¦åŠ è½½Systemï¼Œä¹Ÿä»ŽBootstrapå¼€å§‹ï¼Œæ­¤æ—¶Bootstrapå‘çŽ°å·²ç»åŠ è½½è¿‡äº†Systemé‚£ä¹ˆç›´æŽ¥è¿”å›žå†…å­˜ä¸­çš„Systemå³å¯è€Œä¸éœ€è¦é‡æ–°åŠ è½½ï¼Œè¿™æ ·å†…å­˜ä¸­å°±åªæœ‰ä¸€ä»½Systemçš„å­—èŠ‚ç äº†ã€‚ ä¸€ä¸ªé¢è¯•é¢˜ èƒ½ä¸èƒ½è‡ªå·±å†™ä¸ªç±»å«java.lang.Systemï¼Ÿ æ˜¾ç„¶æ˜¯ä¸å¯ä»¥çš„ï¼Œå¯èƒ½æ–¹æ¡ˆæ˜¯è‡ªå·±æžä¸€ä¸ªè¿™ä¸ªç±»æ”¾åœ¨ç‰¹æ®Šç›®å½•ï¼Œç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŽ»åŠ è½½ï¼Œç„¶è€Œç³»ç»Ÿè‡ªèº«çš„ç±»åŠ è½½å™¨ä¼šå…ˆåŽ»åŠ è½½ä½¿ç”¨ï¼Œä¸‹æ¬¡å†ç”¨çš„æ—¶å€™ï¼Œæ˜¯å…ˆé€çº§å‘ä¸ŠæŸ¥è¯¢æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œæ ¹æœ¬æ²¡æœ‰æœºä¼šè®©è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŽ»åŠ è½½ã€‚ æ‰€ä»¥ï¼Œå¦‚æžœéžè¦ç”¨ï¼Œé‚£ä¹ˆå¿…å®šæ˜¯è¦ç ´ååŒäº²å§”æ´¾æ¨¡åž‹äº†ï¼Œé‚£ä¹ˆåˆå›žåˆ°ä¸ºä»€ä¹ˆè¦ç”¨åŒäº²å§”æ´¾æ¨¡åž‹çš„é—®é¢˜ä¸Šäº†ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†è‡ªå·±å†™ä¸€ä¸ªjava.lang.Systemè€Œç ´ååŒäº²å§”æ´¾æ¨¡åž‹ï¼Œæˆ‘åªèƒ½è¯´ï¼Œè„‘å­ç§€é€—äº†ã€‚æ‰€ä»¥ä¸è¦æžè¿™äº›ä¸œè¥¿ï¼ŒåŒ…åæˆ–ç±»åå†™çš„ä¸ä¸€æ ·å³å¯ã€‚ ä¸€ä¸ªé—®é¢˜ é‚£ä¹ˆä¸ºä»€ä¹ˆä¸èƒ½ç”¨ä¸€ä¸ªåŠ è½½å™¨åŽ»ä¸€ä¸ªç›®å½•åŠ è½½æ‰€æœ‰å‘¢ï¼Ÿè¿˜è¦åˆ†è¿™ä¹ˆå¤šçš„ç±»åŠ è½½å™¨ï¼Œä¸æ˜¯éº»çƒ¦ä¹ˆï¼Ÿ å…¶å®žï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯æ¯”è¾ƒå¯ç¬‘çš„ï¼Œæ¯•ç«Ÿæ¯ä¸ªå±‚çº§çš„åŠŸèƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚bootstrapæ˜¯åŠ è½½æœ€æ ¸å¿ƒçš„æ–‡ä»¶ï¼Œæ²¡æœ‰å®ƒï¼Œéƒ½çŽ©ä¸èµ·æ¥ã€‚è€Œè‡ªå®šä¹‰çš„å‘¢ï¼Ÿæ˜¯æ¯”è¾ƒç‰¹æ®Šçš„éœ€æ±‚ï¼Œéœ€è¦çš„æ—¶å€™æ‰ç”¨åˆ°ã€‚å¯¹äºŽè¿™ç§æœ‰ä¸ªæ€§åŒ–çš„è¦æ±‚ï¼Œä¸€å¥—ä»£ç æ¥å®žçŽ°ï¼Œæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚ æ¯”å¦‚è¿™ä¸ªå›žç­”æ˜¯æ ¹æ®åŠ è½½çš„æ–¹å¼æ¥æ€è€ƒçš„ï¼š æ¯ä¸€ä¸ªç±»åŠ è½½å™¨éƒ½æ˜¯ä¸ºäº†åŽ»åœ¨ä¸åŒçš„æƒ…æ™¯ä¸‹åŽ»åŠ è½½ç±»ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ä»Žè”ç½‘æœåŠ¡å™¨ä¸ŠåŠ è½½ä¸€ä¸ªclassæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä»Žè¿œç¨‹webæœåŠ¡å™¨ä¸‹è½½äºŒè¿›åˆ¶ç±»ã€‚è¿™ä¹ˆè®¾è®¡æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦ç±»åŠ è½½å™¨æä¾›ä¸€è‡´çš„æŽ¥å£ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥åŠ è½½ç±»ä½†æ˜¯å´ä¸ç”¨ç®¡ç±»åŠ è½½å™¨åˆ°åº•æ˜¯æ€Žä¹ˆå®žçŽ°çš„ã€‚å¯åŠ¨ç±»åŠ è½½å™¨èƒ½å¤ŸåŠ è½½JVM_HOME/lib ä¸‹çš„ç±»ï¼Œä½†å¦‚æžœæˆ‘ä»¬éœ€è¦åœ¨å…¶ä»–çš„æƒ…å†µä¸‹åŠ è½½ç±»å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼ŒåŠ è½½ç±»çš„æ–¹æ³•æœ‰æ— æ•°ç§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªçµæ´»çš„åŠ è½½å™¨ç³»ç»ŸåŽ»åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹æŒ‰ç…§æˆ‘ä»¬çš„æƒ³æ³•æ¥åŠ è½½ç±»ã€‚ è¿˜æœ‰ä¸€ä¸ªå›žç­”æ˜¯è¯´æ›´æ–¹ä¾¿åœ°å¯¹ç‰¹å®šç±»è¿›è¡Œä¼˜åŒ–ï¼š è™½ç„¶ å¯¹java è™šæ‹Ÿæœºæ²¡æœ‰ç ”ç©¶è¿‡ï¼Œjava ä¸ºä»€ä¹ˆä¸èƒ½ ä¸€ä¸ªåŠ è½½å™¨ åŠ è½½å…¨éƒ¨çš„ç±» å¾ˆæ˜Žæ˜¾ï¼Œ å®žçŽ°èµ·æ¥ä¹Ÿå¯ä»¥ ä½†æ˜¯éœ€è¦ çš„ ä»£ç  æ›´å¤šï¼Œä¹Ÿæ›´éš¾ ä¸ºå„ç§ç±»è¿›è¡Œ ä¼˜åŒ–ï¼Œä¸ºäº†æ›´ç®€å•çš„æŠ½è±¡ æˆ‘åœ¨æ˜Žç¡®çŸ¥é“ è¯¥ç±»æ˜¯å¯åŠ¨ç±»çš„æƒ…å†µä¸‹ï¼Œæˆ‘å°±ä¼š ä¸ºè¯¥ç±» è¿›è¡Œä¼˜åŒ–ã€‚ å¦‚æžœæ˜¯è‡ªå®šä¹‰ç±»ï¼Œå¯èƒ½å°± ä¸ä¼šè¿›è¡Œ æ­¤ç±»ä¼˜åŒ–ã€‚ åœ¨æ˜Žç¡® ç›®çš„çš„æƒ…å†µä¸‹ï¼Œ ä¸“ç”¨ä»£ç  æ¯” é€šç”¨ä»£ç  æ›´ç®€å•ï¼Œä¹Ÿæ›´æœ‰æ•ˆã€‚ æ€»ä¹‹ï¼Œå°±æ˜¯ä¸ºäº†æ¸…æ™°å’Œæ–¹ä¾¿ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è¿›è¡Œè½¯ä»¶è®¾è®¡çš„æ—¶å€™æœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå³ä¸èƒ½å†™æ­»ä»£ç ï¼Œå½±å“æ‰©å±•æ€§ï¼›å±‚æ¬¡ç»“æž„ä¹Ÿä¸èƒ½å†™çš„å¤ªä¹±ï¼Œå½±å“åŽç»­çš„ä¼˜åŒ–ã€‚ è‡³æ­¤ï¼ŒåŒäº²å§”æ´¾æ¨¡åž‹å°±è®²å®Œäº†ã€‚æˆ‘ä»¬ä¹Ÿæ¸…æ™°åœ°çŸ¥é“äº†å…¶è®¾è®¡æ€æƒ³å’Œå¥½å¤„ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµ…è°ˆClassLoader]]></title>
    <url>%2F2019%2F02%2F05%2FJVM%2F%E6%B5%85%E8%B0%88ClassLoader%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œä¸Šä¸€ç¯‡æ–‡ç« åˆæ­¥æåˆ°äº†classæ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ªæœ€ç®€å•ç¨‹åºæ‰§è¡Œçš„æŒ‡ä»¤å«ä¹‰ï¼Œæˆ‘ä»¬æåˆ°ï¼Œæ˜¯ç”±JAVAè™šæ‹Ÿæœºå…ˆåŠ è½½è¿™äº›ç¼–è¯‘å¥½çš„classæ–‡ä»¶ï¼Œç„¶åŽå†åŽ»æ ¹æ®è§£æžå‡ºæ¥çš„æŒ‡ä»¤åŽ»è½¬æ¢ä¸ºå…·ä½“å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤æ‰§è¡Œï¼Œä½†æ˜¯åŠ è½½è¿™ä¸ªclassæ–‡ä»¶æ—¶å¦‚ä½•åŠ è½½çš„å‘¢ï¼Ÿå…¶å®žå°±æ¶‰åŠæ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ï¼šClassLoader æœ‰ä¸€ä¸ªåŸºæœ¬è®¤è¯†ï¼Œä»Žç¼–è¯‘åˆ°å®žä¾‹åŒ–å¯¹è±¡çš„è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š ç¼–è¯‘å™¨å°†xxx.javaæºæ–‡ä»¶ç¼–è¯‘ä¸ºxxx.classå­—èŠ‚ç æ–‡ä»¶ ClassLoaderå°†å­—èŠ‚ç è½¬æ¢ä¸ºJVMç§çš„Class&lt;xxx&gt;å¯¹è±¡ JVMåˆ©ç”¨Class&lt;xxx&gt;å¯¹è±¡å®žä¾‹åŒ–ä¸ºxxxå¯¹è±¡ ä¸€ã€JVMç³»ç»Ÿç»“æž„ ClassLoaderï¼šä¾æ®ç‰¹å®šæ ¼å¼ï¼ŒåŠ è½½classæ–‡ä»¶åˆ°å†…å­˜ Execution Engineï¼šå¯¹å‘½ä»¤è¿›è¡Œè§£æž Native Interfaceï¼šèžåˆä¸åŒå¼€å‘è¯­è¨€çš„åŽŸç”Ÿåº“ä¸ºJavaæ‰€ç”¨ Runtime Data Areaï¼šJVMå†…å­˜ç©ºé—´ç»“æž„æ¨¡åž‹ é¦–å…ˆé€šè¿‡ClassLoaderåŠ è½½ç¬¦åˆæ¡ä»¶çš„å­—èŠ‚ç æ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼Œç„¶åŽé€šè¿‡Execution Engineè§£æžå­—èŠ‚ç æŒ‡ä»¤ï¼Œäº¤ç”±æ“ä½œç³»ç»ŸåŽ»æ‰§è¡Œã€‚ äºŒã€ä»€ä¹ˆæ˜¯ClassLoader ClassLoaderåœ¨javaä¸­æœ‰ç€éžå¸¸é‡è¦çš„ä½œç”¨ï¼Œå®ƒä¸»è¦å·¥ä½œåœ¨Classè£…è½½çš„åŠ è½½é˜¶æ®µï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ä»Žç³»ç»Ÿå¤–éƒ¨èŽ·å¾—ClassäºŒè¿›åˆ¶æ•°æ®æµã€‚ä»–æ˜¯JAVAçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ‰€æœ‰çš„Classéƒ½æ˜¯ç”±ClassLoaderè¿›è¡ŒåŠ è½½çš„ï¼ŒClassLoaderè´Ÿè´£é€šè¿‡å°†Classæ–‡ä»¶é‡Œçš„äºŒè¿›åˆ¶æ•°æ®æµè£…è½½è¿›ç³»ç»Ÿï¼Œç„¶åŽäº¤ç»™JAVAè™šæ‹Ÿæœºè¿›è¡Œè¿žæŽ¥ã€åˆå§‹åŒ–ç­‰æ“ä½œã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯åŠ è½½å­—èŠ‚ç æ–‡ä»¶ã€‚ æˆ‘ä»¬ç¿»å¼€ClassLoaderæºç çœ‹çœ‹ï¼š 1public abstract class ClassLoader &#123;...&#125; å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥è¯´å…·ä½“çš„å®žçŽ°ç±»ã€‚ é‡Œé¢æ¯”è¾ƒé‡è¦çš„æ˜¯loadClass()æ–¹æ³•ï¼š 123public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException &#123; return loadClass(name, false);&#125; å°±æ˜¯æ ¹æ®nameæ¥åŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œè¿”å›žClasså®žä¾‹ï¼ŒåŠ è½½ä¸åˆ°åˆ™æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ã€‚ ä¸‰ã€ClassLoaderçš„ç§ç±» å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼šç”±C++è¯­è¨€å®žçŽ°ï¼ˆé’ˆå¯¹HotSpotï¼‰,åŠ è½½æ ¸å¿ƒåº“java.*ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼šJavaç¼–å†™ï¼ŒåŠ è½½æ‰©å±•åº“javax.* å®ƒæ‰«æçš„æ˜¯å“ªä¸ªè·¯å¾„å‘¢ï¼Ÿ æˆ‘ä»¬çœ‹åˆ°ï¼Œå®ƒè´Ÿè´£å°† &lt;JAVA_HOME &gt;/lib/extæˆ–è€…ç”±ç³»ç»Ÿå˜é‡-Djava.ext.diræŒ‡å®šä½ç½®ä¸­çš„ç±»åº“ åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ï¼šJavaç¼–å†™ï¼ŒåŠ è½½ç¨‹åºæ‰€åœ¨ç›®å½• å®ƒè´Ÿè´£å°† ç”¨æˆ·ç±»è·¯å¾„(java -classpathæˆ–-Djava.class.pathå˜é‡æ‰€æŒ‡çš„ç›®å½•ï¼Œå³å½“å‰ç±»æ‰€åœ¨è·¯å¾„åŠå…¶å¼•ç”¨çš„ç¬¬ä¸‰æ–¹ç±»åº“çš„è·¯å¾„ï¼Œçœ‹æˆªå›¾çš„æœ€åŽä¸€è¡Œï¼Œæ˜¾ç¤ºçš„æ˜¯å½“å‰é¡¹ç›®è·¯å¾„ã€‚ è‡ªå®šä¹‰ClassLoaderï¼šè‡ªå®šä¹‰ å››ã€å¦‚ä½•è‡ªå®šä¹‰ClassLoader è¦è‡ªå·±å®žçŽ°ä¸€ä¸ªClassLoaderï¼Œå…¶æ ¸å¿ƒæ¶‰åŠä¸¤ä¸ªæ–¹æ³•ï¼š 123456789protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; throw new ClassNotFoundException(name);&#125;protected final Class&lt;?&gt; defineClass(byte[] b, int off, int len) throws ClassFormatError&#123; return defineClass(null, b, off, len, null);&#125; é¦–å…ˆæƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸¤ä¸ªç±»ï¼Ÿ å…¶å®žç­”æ¡ˆåœ¨loadClass()è¿™ä¸ªæ–¹æ³•é‡Œé¢ã€‚å¦‚æžœå·²ç»ç†Ÿæ‚‰åŒäº²å§”æ´¾æ¨¡åž‹çš„åŒå­¦ï¼Œéƒ½ä¼šçŸ¥é“åŠ è½½Classå¯¹è±¡æ˜¯å…ˆå§”æ´¾ç»™çˆ¶äº²ï¼Œçœ‹çˆ¶äº²æ˜¯å¦å·²ç»åŠ è½½ï¼Œå¦‚æžœæ²¡æœ‰åŠ è½½è¿‡ï¼Œåˆ™ä»Žæœ€é¡¶å±‚çˆ¶äº²å¼€å§‹é€å±‚å¾€ä¸‹è¿›è¡ŒåŠ è½½ï¼Œè¿™ä¸€å—è¯¦ç»†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è§£é‡Šï¼Œæˆ‘ä»¬å…ˆèµ°é©¬è§‚èŠ±çœ‹çœ‹è¿™ä¸ªçš„æ ¸å¿ƒæ–¹æ³•é•¿å•¥æ ·ï¼š 123456789101112131415161718192021222324252627282930313233343536373839protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException&#123; synchronized (getClassLoadingLock(name)) &#123; //é¦–å…ˆçœ‹çœ‹å½“å‰ç±»åŠ è½½å™¨æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œæ²¡æœ‰åˆ™å§”æ´¾ç»™çˆ¶äº²æŸ¥è¯¢ Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123; //æ³¨æ„ï¼Œè¿™é‡Œæ˜¯å„é€’å½’å‡½æ•°ï¼Œå¦‚æžœç”±ä¸‹è‡³ä¸ŠæŸ¥è¯¢éƒ½æ²¡æœ‰åŠ è½½è¿‡ï¼Œåˆ™ä»Žä¸Šè‡³ä¸‹å°è¯•åŽ»åŠ è½½ c = parent.loadClass(name, false); &#125; else &#123; c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; //å¦‚æžœæ‰€æœ‰ç±»åŠ è½½å™¨éƒ½æ²¡æœ‰åŠ è½½è¿‡ï¼Œåˆ™å¼€å§‹å°è¯•ä»Žä¸Šè€Œä¸‹é€çº§åŽ»åŠ è½½ if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. long t1 = System.nanoTime(); //åŽ»åŠ è½½ c = findClass(name); // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125;&#125; å¦‚æžœæˆ‘ä»¬ä¸åŽ»é‡å†™findClass(name)æ–¹æ³•ï¼Œé»˜è®¤æ˜¯ç›´æŽ¥æŠ›å‡ºæ‰¾ä¸åˆ°çš„å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œé‡å†™ã€‚ ç”±äºŽå­—èŠ‚ç æ–‡ä»¶æ˜¯ä¸€å †äºŒè¿›åˆ¶æµï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥æ ¹æ®è¿™ä¸ªäºŒè¿›åˆ¶æµæ¥å®šä¹‰æˆä¸€ä¸ªç±»ï¼Œå³defineClass()è¿™ä¸ªæ–¹æ³•æ¥å®žçŽ°è¿™ä¸ªåŠŸèƒ½ã€‚ è¯´çš„æ¯”è¾ƒæŠ½è±¡ï¼Œä¸‹é¢æ¥çœŸæ­£å®žè·µä¸€æŠŠï¼ äº”ã€å®žè·µè‡ªå®šä¹‰ClassLoader é¦–å…ˆå†™ä¸€ä¸ªç±»ï¼šRobot.java 12345public class Robot &#123; static &#123; System.out.println("hello , i am a robot!"); &#125;&#125; åœ¨å¯¹Robot.javaç”¨javacç¼–è¯‘ä¹‹åŽå½¢æˆRobot.classæ–‡ä»¶ï¼Œå°±è¦åˆ é™¤æœ¬é¡¹ç›®ä¸‹çš„è¿™ä¸ªRobot.javaæ–‡ä»¶ï¼Œè¦ä¸ç„¶å°±ä¼šè¢«AppClassLoaderç±»åŠ è½½å…ˆåŠ è½½äº†ï¼Œè€Œæ— æ³•å†è¢«æˆ‘ä»¬çš„è‡ªå®šä¹‰ç±»åŠ è½½å™¨å†åŽ»åŠ è½½ã€‚è¿™ä¸ªRobot.classæ–‡ä»¶æˆ‘å°±ç›´æŽ¥æ”¾åˆ°æ¡Œé¢åŽ»äº†ã€‚è·¯å¾„ä¸ºC:/Users/swg/Desktop/. ç„¶åŽå®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ClassLoaderï¼ŒæŒ‰ç…§ä¸Šé¢çš„ç†è®ºï¼Œåªè¦é‡å†™findClasså°±å¯ä»¥æŒ‡å®šåˆ°æŸä¸ªåœ°æ–¹èŽ·å–classå­—èŠ‚ç æ–‡ä»¶ï¼Œæ­¤æ—¶èŽ·å–çš„æ˜¯äºŒè¿›åˆ¶æµæ–‡ä»¶ï¼Œè½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œæœ€åŽå€Ÿç”¨defineClassèŽ·å–çœŸæ­£çš„Classå¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class MyClassLoader extends ClassLoader&#123; //æ‰§è¡ŒåŠ è½½çš„classæ–‡ä»¶çš„è·¯å¾„ private String path; //è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„åå­— private String classLoaderName; MyClassLoader(String path,String classLoaderName)&#123; this.path = path; this.classLoaderName = classLoaderName; &#125; //ç”¨äºŽå¯»æ‰¾ç±»æ–‡ä»¶ @Override protected Class findClass(String name)&#123; byte[] b = loadClassData(name); return defineClass(name,b,0,b.length); &#125; //ç”¨äºŽåŠ è½½ç±»æ–‡ä»¶ private byte[] loadClassData(String name) &#123; name = path + name + ".class"; InputStream in = null; ByteArrayOutputStream out = null; try&#123; in = new FileInputStream(new File(name)); out = new ByteArrayOutputStream(); int i=0; while ((i = in.read()) != -1)&#123; out.write(i); &#125; &#125;catch (Exception e)&#123; e.printStackTrace(); &#125;finally &#123; try &#123; in.close(); out.close(); &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; &#125; return out.toByteArray(); &#125;&#125; æœ€åŽæµ‹è¯•ä¸€ä¸‹èƒ½ä¸èƒ½ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŽ»åŠ è½½åˆ°Robotå¯¹åº”çš„Classå¯¹è±¡ï¼š 12345678public class Test &#123; public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException &#123; MyClassLoader myClassLoader = new MyClassLoader("C:\\Users\\swg\\Desktop\\","myClassLoader"); Class c = myClassLoader.loadClass("Robot"); System.out.println(c.getClassLoader()); c.newInstance(); &#125;&#125; æ‰“å°ç»“æžœï¼š 12MyClassLoader@677327b6hello , i am a robot! å¥½äº†ï¼Œå­¦ä¹ äº†å…³äºŽClassLoaderçš„åˆ†ç±»ä»¥åŠå¦‚ä½•è‡ªå®šä¹‰ClassLoaderï¼Œæˆ‘ä»¬çŸ¥é“äº†ç±»åŠ è½½å™¨çš„åŸºæœ¬å®žçŽ°ï¼Œä¸Šé¢è°ˆåˆ°äº†ä¸€ä¸ªé‡è¦æ–¹æ³•æ˜¯loadClassï¼Œè¿™å°±æ¶‰åŠäº†ç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡åž‹ã€‚ä¸‹ä¸€èŠ‚ä»Žä»£ç å±‚é¢å¥½å¥½æ¥è¯´è¯´è¿™ä¸ªï¼Œå…¶å®žå¾ˆç®€å•ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2019å¹´å±•æœ›]]></title>
    <url>%2F2019%2F02%2F05%2Fsuibi%2F2019%E5%B9%B4%E5%B1%95%E6%9C%9B%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©æ˜¯å¤§å¹´åˆä¸€ï¼Œç®—æ˜¯çœŸæ­£æ­¥å…¥2019å¹´äº†ã€‚ä¿å­˜å‡ å¼ è€å®¶é—¨å£æ‹çš„ç…§ç‰‡ï¼Œä»¥ä½œçºªå¿µã€‚ è€å®¶è¶Šæ¥è¶Šå†·æ¸…ï¼Œè¶Šæ¥è¶Šè§æ¡ã€‚ ä»Šå¹´å››æœˆåº•é¡ºåˆ©æ¯•ä¸šçš„è¯ï¼Œå°±çœŸçš„å·¥ä½œäº†ï¼Œåœ¨å—äº¬ï¼Œæœ¬ç§‘+ç ”ç©¶ç”Ÿè¯»äº†ä¸ƒå¹´ä¹¦ï¼ŒåŠ ä¸Šå°æ—¶å€™æ¯å¹´æš‘å‡éƒ½æ¥å—äº¬çŽ©ï¼Œå¯¹å—äº¬çš„ç†Ÿæ‚‰çš„ç¨‹åº¦è¿œè¿œå¤§äºŽå®¶ä¹¡ç›åŸŽã€‚ æ‰€ä»¥å¸Œæœ›å¯ä»¥åŠªåŠ›ï¼Œåœ¨å—äº¬èƒ½æ‰Žä¸‹æ ¹ï¼Œç„¶åŽä¸€å®¶äººå…¨æ¬è¿‡åŽ»ã€‚ åœ¨æ‰¾å·¥ä½œæ–¹é¢ï¼Œä¸æƒ³è¿‡å¤šåœ°æåŠäº†ï¼Œæˆ‘ç›¸ä¿¡åªè¦ä¸€ç›´åŠªåŠ›ï¼Œå°±ä¸€å®šä¼šæœ‰å¥½çš„ç»“æžœã€‚ åœ¨2018å¹´ï¼Œç®—æ˜¯å­¦ä¹ javaçš„è¿›é˜¶ä¹‹å¹´ï¼Œè‡ªå·±å­¦ä¹ äº†å¾ˆå¤šæ–°çš„æŠ€æœ¯ï¼Œä¹Ÿå¥½å¥½åœ°å¤¯å®žäº†åŸºç¡€ï¼ŒæŠŠä»¥å‰å¾ˆå¤šæ¨¡ç³Šçš„é—®é¢˜æžæ¸…æ¥šäº†ï¼Œç¡®å®žï¼ŒåŸºç¡€çœŸçš„å¤ªé‡è¦çš„ï¼Œå…‰å­¦æ—¶é«¦çš„æ¡†æž¶ï¼Œå¯ä»¥å†™å†™ç®€å•çš„CRUDåº”ç”¨ï¼Œæ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæˆ‘è§‰å¾—ç¨‹åºå‘˜çš„ç›®æ ‡æ˜¯å¯ä»¥é€ å‡ºå¤§å®¶éƒ½è®¤å¯å¹¶ä¸”ä¹äºŽä½¿ç”¨çš„å¼€æºä½œå“ï¼Œæ²¡æœ‰å¥½çš„åŸºç¡€ï¼Œä¾¿æ˜¯å¤©æ–¹å¤œè°­ï¼Œä¹Ÿåªèƒ½æ°¸è¿œåšä¸€ä¸ªæ™®é€šçš„ç å†œã€‚ æ‰€ä»¥ï¼Œæˆ‘ç»™è‡ªå·±å®šä¸€ä¸ªä¸‰å¹´çš„ç›®æ ‡ï¼Œä¸‰å¹´ä»¥åŽï¼Œæ— è®ºæ˜¯æžjavaè¿˜æ˜¯æžå¤§æ•°æ®è¿˜æ˜¯å…¶ä»–ï¼Œæˆ‘å¸Œæœ›èƒ½è¾¾åˆ°ä¸­é«˜çº§æ°´å¹³ï¼Œåœ¨è¿™ä¸ªè¡Œä¸šæ–¹å‘ä¸Šæœ‰è¾ƒå¥½çš„åŸºç¡€å’Œè¾ƒæ·±çš„è®¤è¯†ã€‚ä¸ºåŽç»­æ›´é«˜çš„å‘å±•æ‰“ä¸‹åšå®žçš„åŸºç¡€ã€‚ æˆ‘å¸Œæœ›ï¼ŒgithubçœŸæ­£èƒ½æˆä¸ºæˆ‘å‡ºå‘çš„åœ°æ–¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿèµ°å¾ˆè¿œã€‚çŠ¹è®°å¾—ï¼Œ14å¹´åœ¨å¤§ç¥žå®¤å‹çš„æŽ¨èä¸‹ï¼Œæ³¨å†Œäº†githubï¼Œä½†æ˜¯çœŸæ­£ä½¿ç”¨è¿˜æ˜¯ä»ŽåŽ»å¹´å¼€å§‹å§ã€‚æ‰€ä»¥ç”šæ˜¯æƒ­æ„§ï¼Œå¦‚æžœæ—©ä¸€ç‚¹ä¸Šè·¯ï¼Œè™½ç„¶è¿½èµ¶ä¸ä¸Šå¤§ç¥žçš„è„šæ­¥ï¼ˆå·²ç»è¿›äº†googleï¼‰ï¼Œä½†æ˜¯è¿›ä¸ªäºŒçº¿æ¯”å¦‚äº¬ä¸œã€ç¾Žå›¢ç­‰éƒ½æ˜¯è½»è€Œæ˜“ä¸¾å§ï¼Œä½†æ˜¯è°ˆè¿™äº›ç¡®å®žæ˜¯åºŸè¯ï¼Œæ²¡æœ‰äººæœ‰å‡å¦‚ã€‚ é™¤äº†å¯¹æœªæ¥ä¸‰å¹´çš„ä¸€äº›åˆæ­¥æƒ³æ³•ä¹‹å¤–ï¼Œæˆ‘è¿˜æ˜¯å¸Œæœ›æˆ‘ä¸Žå®¶äººéƒ½æœ‰ä¸€ä¸ªå¥å¥åº·åº·çš„èº«ä½“ï¼Œæ‰€ä»¥å·¥ä½œä»¥åŽèº«ä½“çš„é”»ç‚¼æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå…«å—è…¹è‚Œæ˜¯ä¸æŒ‡æœ›äº†ï¼Œè‡³å°‘çˆ¬å‡ å±‚æ¥¼ä¸ç”¨å–˜å§ã€‚ ä¸€åˆ‡è¿˜æ˜¯è§†å®žé™…æƒ…å†µè€Œå®šï¼Œä½†æ˜¯ç»ˆèº«å­¦ä¹ çš„ä¿¡å¿µè¦åŸ‹è—åœ¨å¿ƒé‡Œï¼Œè¿™ä¸ªæ—¶ä»£ä»¥åŠæœªæ¥çš„æ—¶ä»£ï¼Œé€‰æ‹©äº†è¿™ä¸€è¡Œï¼ŒæŽ‰å¤´å‘æ˜¯æ³¨å®šçš„äº†ï¼Œä½†æ˜¯å¦‚æžœä»…ä»…ä»¥æŽ‰å¤´å‘çš„ä»£ä»·ï¼Œå¯ä»¥è®©å®¶äººèˆ’èˆ’æœæœï¼Œå¥å¥åº·åº·ï¼Œå¼€å¼€å¿ƒå¿ƒçš„è¯ï¼Œé‚£ç»™æˆ‘å‰ƒä¸ªå…‰å¤´ä¹Ÿæ— å¦¨äº†ã€‚ åºŸè¯ä¸å¤šè¯´äº†ï¼Œæˆ‘è¦ç»§ç»­å®Œæˆæœ¬ç¬”è®°çš„JVMéƒ¨åˆ†äº†ï¼Œä¸å¿˜åˆå¿ƒï¼Œå¥—ç”¨å–œå‰§ä¹‹çŽ‹çš„å°è¯ï¼šåŠªåŠ›ï¼Œå¥‹æ–—ï¼]]></content>
      <tags>
        <tag>éšç¬”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å½»åº•ç†è§£javaåå°„æœºåˆ¶]]></title>
    <url>%2F2019%2F02%2F04%2Fjava-basic%2F%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3java%E5%8F%8D%E5%B0%84%2F</url>
    <content type="text"><![CDATA[åå°„æœºåˆ¶è¿™ä¸€å—ä¹Ÿæ˜¯é¢è¯•ç»å¸¸ä¼šè¢«é—®åˆ°çš„ï¼Œæˆ‘ä»Žåå°„çš„åŸºæœ¬æ¦‚å¿µåˆ°åå°„çš„ä¸€äº›é¢è¯•é¢˜å‡ºå‘ï¼Œå¥½å¥½ç†ä¸€ç†åå°„çš„çŸ¥è¯†ã€‚ 1. ä»€ä¹ˆæ˜¯åå°„ æ ‡å‡†å®šä¹‰ï¼šJAVAåå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºŽä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±žæ€§å’Œæ–¹æ³•ï¼›å¯¹äºŽä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±žæ€§ï¼›è¿™ç§åŠ¨æ€èŽ·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨æ–¹æ³•çš„åŠŸèƒ½æˆä¸ºåå°„æœºåˆ¶ã€‚ æ³¨æ„å‡ ä¸ªå…³é”®å­—ï¼šè¿è¡ŒçŠ¶æ€ä¸­ï¼ŒåŠ¨æ€èŽ·å–ã€‚ 2. Classå¯¹è±¡å’Œå®žä¾‹å¯¹è±¡ æƒ³è¦ç†è§£åå°„é¦–å…ˆéœ€è¦çŸ¥é“Classè¿™ä¸ªç±»ï¼Œå®ƒçš„å…¨ç§°æ˜¯java.lang.Classç±»ã€‚javaæ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œè®²ç©¶ä¸‡ç‰©çš†å¯¹è±¡ï¼Œå³ä½¿å¼ºå¤§åˆ°ä¸€ä¸ªç±»ï¼Œå®ƒä¾ç„¶æ˜¯å¦ä¸€ä¸ªç±»ï¼ˆClassç±»ï¼‰çš„å¯¹è±¡ï¼Œæ¢å¥è¯è¯´ï¼Œæ™®é€šç±»æ˜¯Classç±»çš„å¯¹è±¡ï¼Œå³Classæ˜¯æ‰€æœ‰ç±»çš„ç±»ï¼ˆThere is a class named Classï¼‰ã€‚ æˆ‘ä»¬çŸ¥é“javaä¸–ç•Œæ˜¯è¿è¡Œåœ¨JVMä¹‹ä¸Šçš„ï¼Œæˆ‘ä»¬ç¼–å†™çš„ç±»ä»£ç ï¼Œåœ¨ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åŽï¼Œä¼šä¸ºæ¯ä¸ªç±»ç”Ÿæˆå¯¹åº”çš„.classæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯JVMå¯ä»¥åŠ è½½æ‰§è¡Œçš„å­—èŠ‚ç ã€‚ è¿è¡Œæ—¶æœŸé—´ï¼Œå½“æˆ‘ä»¬éœ€è¦å®žä¾‹åŒ–ä»»ä½•ä¸€ä¸ªç±»æ—¶ï¼ŒJVMä¼šé¦–å…ˆå°è¯•çœ‹çœ‹åœ¨å†…å­˜ä¸­æ˜¯å¦æœ‰è¿™ä¸ªç±»ï¼Œå¦‚æžœæœ‰ï¼Œé‚£ä¹ˆä¼šç›´æŽ¥åˆ›å»ºç±»å®žä¾‹ï¼›å¦‚æžœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±ä¼šæ ¹æ®ç±»ååŽ»åŠ è½½è¿™ä¸ªç±»ï¼Œå½“åŠ è½½ä¸€ä¸ªç±»ï¼Œæˆ–è€…å½“åŠ è½½å™¨(class loader)çš„defineClass()è¢«JVMè°ƒç”¨ï¼Œä¾¿ä¼šä¸ºè¿™ä¸ªç±»äº§ç”Ÿä¸€ä¸ªClasså¯¹è±¡ï¼ˆä¸€ä¸ªClassç±»çš„å®žä¾‹ï¼‰ï¼Œç”¨æ¥è¡¨è¾¾è¿™ä¸ªç±»ï¼Œè¯¥ç±»çš„æ‰€æœ‰å®žä¾‹éƒ½å…±åŒæ‹¥æœ‰ç€è¿™ä¸ªClasså¯¹è±¡ï¼Œè€Œä¸”æ˜¯å”¯ä¸€çš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ è½½.classæ–‡ä»¶ä¹‹åŽä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„Classå¯¹è±¡ã€‚ä¸‹é¢è¯´è¯´å¦‚ä½•èŽ·å–è¿™ä¸ªClasså¯¹è±¡ã€‚ 3. å–å¾—Classå¯¹è±¡çš„ä¸‰ç§æ–¹å¼ æˆ‘ä»¬å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªç±»å«MyClassï¼š 1public class MyClass &#123; &#125; ç¬¬ä¸€ç§æ–¹å¼ï¼šé€šè¿‡â€œç±»å.classâ€çš„æ–¹å¼å–å¾— 1Class classInstance= MyClass.class; ä¾‹å¦‚ï¼š 123Class clazz = Car.class;Class cls1 = int.class;Class cls2 = String.class; ç¬¬äºŒç§æ–¹å¼ï¼šé€šè¿‡ç±»åˆ›å»ºçš„å®žä¾‹å¯¹è±¡çš„getClassæ–¹æ³•å–å¾— 12MyClass myClass = new MyClass();Class classInstance = myClass.getClass(); ç¬¬ä¸‰ç§æ–¹å¼ï¼šé€šè¿‡Classç±»çš„é™æ€æ–¹æ³•forNameæ–¹æ³•å–å¾—ï¼ˆå‚æ•°æ˜¯å¸¦åŒ…åçš„å®Œæ•´çš„ç±»åï¼‰ 12345try &#123; Class classInstance = Class.forName("mypackage.MyClass");&#125; catch (ClassNotFoundException e) &#123; e.printStackTrace();&#125; ä¸Šé¢ä¸‰ç§æ–¹æ³•å–å¾—çš„å¯¹è±¡éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æ•ˆæžœä¸Šç­‰ä»·ã€‚ classInstanceæ˜¯ç±»ç±»åž‹ï¼Œé€šè¿‡ç±»ç±»åž‹å¯ä»¥å¾—åˆ°ä¸€ä¸ªç±»çš„å±žæ€§å’Œæ–¹æ³•ç­‰å‚æ•°ï¼Œè¿™æ˜¯åå°„çš„åŸºç¡€ã€‚ 4. åˆ©ç”¨åå°„APIå…¨é¢åˆ†æžç±»çš„ä¿¡æ¯â€”â€”æ–¹æ³•ï¼Œæˆå‘˜å˜é‡ï¼Œæž„é€ å™¨ åå°„çš„ä¸€å¤§ä½œç”¨æ˜¯ç”¨äºŽåˆ†æžç±»çš„ç»“æž„ï¼Œæˆ–è€…è¯´ç”¨äºŽåˆ†æžå’Œè¿™ä¸ªç±»æœ‰å…³çš„æ‰€æœ‰ä¿¡æ¯ã€‚è€Œè¿™äº›ä¿¡æ¯å°±æ˜¯ç±»çš„åŸºæœ¬çš„ç»„æˆï¼š æ–¹æ³•ï¼Œæˆå‘˜å˜é‡å’Œæž„é€ å™¨ã€‚ åœ¨javaç§ä¸‡ç‰©çš†å¯¹è±¡ï¼Œä¸€ä¸ªç±»ä¸­çš„æ–¹æ³•ï¼Œæˆå‘˜å˜é‡å’Œæž„é€ å™¨ä¹Ÿåˆ†åˆ«å¯¹åº”ç€ä¸€ä¸ªå¯¹è±¡ æ¯ä¸ªæ–¹æ³•éƒ½å¯¹åº”æœ‰ä¸€ä¸ªä¿å­˜å’Œè¯¥æ–¹æ³•æœ‰å…³ä¿¡æ¯çš„Methodå¯¹è±¡ï¼Œ è¿™ä¸ªå¯¹è±¡æ‰€å±žçš„ç±»æ˜¯java.lang.reflect.Method; æ¯ä¸ªæˆå‘˜å˜é‡éƒ½å¯¹åº”æœ‰ä¸€ä¸ªä¿å­˜å’Œè¯¥å˜é‡æœ‰å…³ä¿¡æ¯çš„Fieldå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ‰€å±žçš„ç±»æ˜¯ java.lang.reflect.Field æ¯ä¸ªæž„é€ å™¨éƒ½å¯¹åº”æœ‰ä¸€ä¸ªä¿å­˜å’Œè¯¥æž„é€ å™¨æœ‰å…³ä¿¡æ¯çš„Constructorå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ‰€å±žçš„ç±»æ˜¯java.lang.reflect.Constructor å‡è®¾cæ˜¯ä¸€ä¸ªç±»çš„Classå¯¹è±¡ï¼š é€šè¿‡ c.getDeclaredMethods()å¯å–å¾—è¿™ä¸ªç±»ä¸­æ‰€æœ‰å£°æ˜Žæ–¹æ³•å¯¹åº”çš„Methodå¯¹è±¡ç»„æˆçš„æ•°ç»„ é€šè¿‡ c.getDeclaredFields()å¯å–å¾—è¿™ä¸ªç±»ä¸­æ‰€æœ‰å£°æ˜Žçš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ç»„æˆçš„æ•°ç»„ é€šè¿‡ c.getConstructors(); å¯å–å¾—è¿™ä¸ªç±»ä¸­æ‰€æœ‰æž„é€ å‡½æ•°æ‰€å¯¹åº”çš„Constructorå¯¹è±¡æ‰€ç»„æˆçš„æ•°ç»„ 1234567Method [] methods = c.getDeclaredMethods(); // èŽ·å–æ–¹æ³•å¯¹è±¡åˆ—è¡¨ Field [] fields = c.getDeclaredFields(); // èŽ·å–æˆå‘˜å˜é‡å¯¹è±¡åˆ—è¡¨Constructor [] constructors = c.getConstructors(); // èŽ·å–æž„é€ å‡½æ•°å¯¹è±¡åˆ—è¡¨xxx.getName()å°±å¯ä»¥æ‰“å°å‡ºå¯¹åº”çš„åå­—äº†ã€‚ 5. æ›´å¤šçš„åå°„api getMethodså’ŒgetDeclaredMethodsæ–¹æ³• getMethodså–å¾—çš„methodå¯¹åº”çš„æ–¹æ³•åŒ…æ‹¬ä»Žçˆ¶ç±»ä¸­ç»§æ‰¿çš„é‚£ä¸€éƒ¨åˆ†ï¼Œè€Œ getDeclaredMethodså–å¾—çš„methodå¯¹åº”çš„æ–¹æ³•ä¸åŒ…æ‹¬ä»Žçˆ¶ç±»ä¸­ç»§æ‰¿çš„é‚£ä¸€éƒ¨åˆ† ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œä»–ä»¬çš„åŸºç±»éƒ½æ˜¯Objectï¼Œé‚£ä¹ˆå¦‚æžœç”¨getMethodsï¼ŒéåŽ†å¾—åˆ°çš„ç»“æžœï¼Œä¼šå‘çŽ°Objectä¸­çš„åŸºç¡€æ–¹æ³•åéƒ½ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚ è¯¸å¦‚wait(),equals(),toString(),getClass(), notify(),notifyAll(),hashCode()ç­‰ç­‰ã€‚ é€šè¿‡method.getReturnType()èŽ·å–æ–¹æ³•è¿”å›žå€¼å¯¹åº”çš„Classå¯¹è±¡ 12Class returnClass = method.getReturnType(); // èŽ·å–æ–¹æ³•è¿”å›žå€¼å¯¹åº”çš„Classå¯¹è±¡String returnName = returnClass.getName(); //èŽ·å–è¿”å›žå€¼æ‰€å±žç±»çš„ç±»åâ€”â€”ä¹Ÿå³è¿”å›žå€¼ç±»åž‹ é€šè¿‡method.getParameterTypes()èŽ·å–æ–¹æ³•å„å‚æ•°çš„Classå¯¹è±¡ç»„æˆçš„æ•°ç»„ 12345Class [] paramsClasses = method.getParameterTypes();for (Class pc: paramsClasses) &#123; String paramStr = pc.getName(); // èŽ·å–å½“å‰å‚æ•°ç±»åž‹ paramsStr+=paramStr + " ";&#125; èŽ·å–æˆå‘˜å˜é‡ç±»åž‹å¯¹åº”çš„çš„Classå¯¹è±¡ 123Field field = c.getDeclaredField("name"); // å–å¾—åç§°ä¸ºnameçš„fieldå¯¹è±¡field.setAccessible(true); // è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼ï¼ï¼è®¾ç½®ä¸ºtrueæ‰èƒ½è®¿é—®ç§æœ‰æˆå‘˜å˜é‡nameçš„å€¼ï¼String nameValue = (String) field.get(obj); // èŽ·å–objä¸­nameæˆå‘˜å˜é‡çš„å€¼ é€šè¿‡getTypeæ–¹æ³•è¯»å–æˆå‘˜å˜é‡ç±»åž‹çš„Classå¯¹è±¡ 12Field field = class1.getDeclaredField(number");System.out.print(field.getType().getName()); å› ä¸ºjavaæƒé™çš„åŽŸå› ï¼Œç›´æŽ¥è¯»å–ç§æœ‰æˆå‘˜å˜é‡çš„å€¼æ˜¯éžæ³•çš„ï¼ˆåŠ äº†field.setAccessible(true)åŽå°±å¯ä»¥äº†ï¼‰ï¼Œä½†ä»å¯ä»¥ç›´æŽ¥è¯»å–ç§æœ‰æˆå‘˜å˜é‡çš„ç±»åž‹ åˆ©ç”¨åå°„APIåˆ†æžç±»ä¸­æž„é€ å™¨ä¿¡æ¯ 123public class MyClass &#123; public MyClass(int a, String str)&#123;&#125;&#125; 12345678910111213public static void printContructorsMessage (Object obj) &#123;Class c = obj.getClass(); // å–å¾—objæ‰€å±žç±»å¯¹åº”çš„Classå¯¹è±¡Constructor [] constructors = c.getDeclaredConstructors();for (Constructor constructor : constructors) &#123; Class [] paramsClasses = constructor.getParameterTypes(); String paramsStr = ""; for (Class pc : paramsClasses) &#123; String paramStr = pc.getName(); paramsStr+=paramStr + " "; &#125; System.out.println("æž„é€ å‡½æ•°çš„æ‰€æœ‰å‚æ•°çš„ç±»åž‹åˆ—è¡¨ï¼š" + paramsStr);&#125;&#125; è¿è¡Œç»“æžœï¼š 1æž„é€ å‡½æ•°çš„æ‰€æœ‰å‚æ•°çš„ç±»åž‹åˆ—è¡¨ï¼šint java.lang.String 6. åˆ©ç”¨åå°„åŠ¨æ€åŠ è½½ç±»ï¼Œå¹¶ç”¨è¯¥ç±»åˆ›å»ºå®žä¾‹å¯¹è±¡ æˆ‘ä»¬ç”¨æ™®é€šçš„æ–¹å¼ä½¿ç”¨ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œç±»æ˜¯é™æ€åŠ è½½çš„ ï¼Œè€Œä½¿ç”¨Class.forName(â€œXXXâ€)è¿™ç§æ–¹å¼ï¼Œåˆ™å±žäºŽåŠ¨æ€åŠ è½½ä¸€ä¸ªç±» é™æ€åŠ è½½çš„ç±»åœ¨ç¼–è¯‘çš„æ—¶å€™å°±èƒ½ç¡®å®šè¯¥ç±»æ˜¯å¦å­˜åœ¨ï¼Œä½†åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™å´æ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šæ˜¯å¦å­˜åœ¨è¯¥ç±»ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶å€™æ‰èƒ½å¤Ÿç¡®å®šæ˜¯å¦æœ‰è¿™ä¸ªç±»ï¼Œæ‰€ä»¥è¦æ•æ‰å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸. Classå¯¹è±¡æœ‰ä¸€ä¸ªnewInstanceæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºå®žä¾‹å¯¹è±¡ 12Class classInstance = Class.forName("mypackage.MyClass");MyClass myClass = (MyClass) classInstance.newInstance(); 7. æ€»ç»“ åå°„ä¸ºæˆ‘ä»¬æä¾›äº†å…¨é¢çš„åˆ†æžç±»ä¿¡æ¯çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ç±»çš„æ–¹æ³•ï¼Œæˆå‘˜å˜é‡å’Œæž„é€ å™¨ç­‰çš„ç›¸å…³ä¿¡æ¯ï¼Œåå°„èƒ½å¤Ÿè®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„èŽ·å–è¿™äº›ä¿¡æ¯ï¼Œ è€Œå®žçŽ°è¿™ä¸ªèŽ·å–è¿‡ç¨‹çš„å…³é”®æ˜¯å–å¾—ç±»çš„Classå¯¹è±¡ï¼Œç„¶åŽæ ¹æ®Classå¯¹è±¡å–å¾—ç›¸åº”çš„Methodå¯¹è±¡ï¼ŒFieldå¯¹è±¡å’ŒConstructorå¯¹è±¡ï¼Œå†åˆ†åˆ«æ ¹æ®å„è‡ªçš„APIå–å¾—ä¿¡æ¯ã€‚ åå°„è¿˜ä¸ºæˆ‘ä»¬æä¾›åŠ¨æ€åŠ è½½ç±»çš„èƒ½åŠ› APIä¸­getDeclaredXXXå’ŒgetXXXçš„åŒºåˆ«åœ¨äºŽå‰è€…åªèŽ·å–æœ¬ç±»å£°æ˜Žçš„XXXï¼ˆå¦‚æˆå‘˜å˜é‡æˆ–æ–¹æ³•ï¼‰ï¼Œè€Œä¸èŽ·å–è¶…ç±»ä¸­ç»§æ‰¿çš„XXXï¼Œ åŽè€…éƒ½å¯ä»¥èŽ·å– APIä¸­ï¼Œ getXXXsï¼ˆæ³¨æ„åŽé¢çš„sï¼‰è¿”å›žçš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ è€Œå¯¹åº”çš„ getXXXï¼ˆâ€œé”®â€ï¼‰æŒ‰é”®èŽ·å–ä¸€ä¸ªå€¼ï¼ˆè¿™ä¸ªæ—¶å€™å› ä¸ºå¯èƒ½æŠ¥å·²æ£€æŸ¥å¼‚å¸¸æ‰€ä»¥è¦ç”¨try*catchè¯­å¥åŒ…è£¹ï¼‰ ç§æœ‰æˆå‘˜å˜é‡æ˜¯ä¸èƒ½ç›´æŽ¥èŽ·å–åˆ°å€¼çš„ï¼å› ä¸ºjavaæœ¬èº«çš„ä¿æŠ¤æœºåˆ¶ï¼Œå…è®¸ä½ å–å¾—ç§æœ‰æˆå‘˜å˜é‡çš„ç±»åž‹ï¼Œä½†æ˜¯ä¸å…è®¸ç›´æŽ¥èŽ·å–å€¼ï¼Œæ‰€ä»¥è¦å¯¹å¯¹åº”çš„fieldå¯¹è±¡è°ƒç”¨field.setAccessible(true) æ”¾å¼€æƒé™ 8. é¢è¯• ä»€ä¹ˆæ˜¯åå°„ åå°„æ˜¯ä¸€ç§èƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€è®¿é—®ã€ä¿®æ”¹æŸä¸ªç±»ä¸­ä»»æ„å±žæ€§ï¼ˆçŠ¶æ€ï¼‰å’Œæ–¹æ³•ï¼ˆè¡Œä¸ºï¼‰çš„æœºåˆ¶ åå°„åˆ°åº•æœ‰ä»€ä¹ˆå…·ä½“çš„ç”¨å¤„ æ“ä½œå› è®¿é—®æƒé™é™åˆ¶çš„å±žæ€§å’Œæ–¹æ³•ï¼› å®žçŽ°è‡ªå®šä¹‰æ³¨è§£ï¼› åŠ¨æ€åŠ è½½ç¬¬ä¸‰æ–¹jaråŒ…ï¼Œè§£å†³androidå¼€å‘ä¸­æ–¹æ³•æ•°ä¸èƒ½è¶…è¿‡65536ä¸ªçš„é—®é¢˜ï¼› æŒ‰éœ€åŠ è½½ç±»ï¼ŒèŠ‚çœç¼–è¯‘å’Œåˆå§‹åŒ–APKçš„æ—¶é—´ï¼› åå°„çš„åŽŸç†æ˜¯ä»€ä¹ˆ å½“æˆ‘ä»¬ç¼–å†™å®Œä¸€ä¸ªJavaé¡¹ç›®ä¹‹åŽï¼Œæ¯ä¸ªjavaæ–‡ä»¶éƒ½ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ª.classæ–‡ä»¶ï¼Œè¿™äº›Classå¯¹è±¡æ‰¿è½½äº†è¿™ä¸ªç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬çˆ¶ç±»ã€æŽ¥å£ã€æž„é€ å‡½æ•°ã€æ–¹æ³•ã€å±žæ€§ç­‰ï¼Œè¿™äº›classæ–‡ä»¶åœ¨ç¨‹åºè¿è¡Œæ—¶ä¼šè¢«ClassLoaderåŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ã€‚å½“ä¸€ä¸ªç±»è¢«åŠ è½½ä»¥åŽï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šåœ¨å†…å­˜ä¸­è‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªClasså¯¹è±¡ã€‚æˆ‘ä»¬é€šè¿‡newçš„å½¢å¼åˆ›å»ºå¯¹è±¡å®žé™…ä¸Šå°±æ˜¯é€šè¿‡è¿™äº›Classæ¥åˆ›å»ºï¼Œåªæ˜¯è¿™ä¸ªè¿‡ç¨‹å¯¹äºŽæˆ‘ä»¬æ˜¯é€æ˜Žçš„è€Œå·²ã€‚ åå°„çš„å·¥ä½œåŽŸç†å°±æ˜¯å€ŸåŠ©Class.javaã€Constructor.javaã€ Method.javaã€Field.javaè¿™å››ä¸ªç±»åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€è®¿é—®å’Œä¿®æ”¹ä»»ä½•ç±»çš„è¡Œä¸ºå’ŒçŠ¶æ€ã€‚ å¦‚ä½•èŽ·å–Classå¯¹è±¡ Classçš„forName()æ–¹æ³•çš„è¿”å›žå€¼å°±æ˜¯Classç±»åž‹ï¼Œä¹Ÿå°±æ˜¯åŠ¨æ€å¯¼å…¥ç±»çš„Classå¯¹è±¡çš„å¼•ç”¨ 1public static Class&lt;?&gt; forName(String className) throws ClassNotFoundException æ¯ä¸ªç±»éƒ½ä¼šæœ‰ä¸€ä¸ªåç§°ä¸ºClassçš„é™æ€å±žæ€§ï¼Œé€šè¿‡å®ƒä¹Ÿæ˜¯å¯ä»¥èŽ·å–åˆ°Classå¯¹è±¡ 1Class&lt;Student&gt; clazz = Student.class; Objectç±»ä¸­æœ‰ä¸€ä¸ªåä¸ºgetClassçš„æˆå‘˜æ–¹æ³•ï¼Œå®ƒè¿”å›žçš„æ˜¯å¯¹è±¡çš„è¿è¡Œæ—¶ç±»çš„Classå¯¹è±¡ã€‚å› ä¸ºObjectç±»æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•å¾—åˆ°å®ƒè¿è¡Œæ—¶ç±»çš„Classå¯¹è±¡ 12Student stu = new Student();Class&lt;Student&gt; clazz = stu.getClass(); åå°„çš„ç‰¹ç‚¹ ä¼˜ç‚¹ çµæ´»ã€è‡ªç”±åº¦é«˜ï¼šä¸å—ç±»çš„è®¿é—®æƒé™é™åˆ¶ï¼Œæƒ³å¯¹ç±»åšå•¥å°±åšå•¥ ç¼ºç‚¹ æ€§èƒ½é—®é¢˜ é€šè¿‡åå°„è®¿é—®ã€ä¿®æ”¹ç±»çš„å±žæ€§å’Œæ–¹æ³•æ—¶ä¼šè¿œæ…¢äºŽç›´æŽ¥æ“ä½œï¼Œä½†æ€§èƒ½é—®é¢˜çš„ä¸¥é‡ç¨‹åº¦å–å†³äºŽåœ¨ç¨‹åºä¸­æ˜¯å¦‚ä½•ä½¿ç”¨åå°„çš„ã€‚å¦‚æžœä½¿ç”¨å¾—å¾ˆå°‘ï¼Œä¸æ˜¯å¾ˆé¢‘ç¹ï¼Œæ€§èƒ½å°†ä¸ä¼šæ˜¯ä»€ä¹ˆé—®é¢˜ï¼› å®‰å…¨æ€§é—®é¢˜ åå°„å¯ä»¥éšæ„è®¿é—®å’Œä¿®æ”¹ç±»çš„æ‰€æœ‰çŠ¶æ€å’Œè¡Œä¸ºï¼Œç ´åäº†ç±»çš„å°è£…æ€§ï¼Œå¦‚æžœä¸ç†Ÿæ‚‰è¢«åå°„ç±»çš„å®žçŽ°åŽŸç†ï¼Œéšæ„ä¿®æ”¹å¯èƒ½å¯¼è‡´æ½œåœ¨çš„é€»è¾‘é—®é¢˜ï¼› å¦‚ä½•æé«˜åå°„æ€§èƒ½ javaåº”ç”¨åå°„çš„æ—¶å€™ï¼Œæ€§èƒ½å¾€å¾€æ˜¯javaç¨‹åºå‘˜æ‹…å¿ƒçš„åœ°æ–¹ï¼Œé‚£ä¹ˆåœ¨å¤§é‡è¿ç”¨åå°„çš„æ—¶å€™ï¼Œæ€§èƒ½çš„å¾®å¼±æå‡ï¼Œå¯¹è¿™ä¸ªç³»ç»Ÿè€Œè¨€éƒ½æ˜¯å¦‚æ—±åœ°é€¢ç”˜éœ–ã€‚ setAccessible(true),å¯ä»¥é˜²æ­¢å®‰å…¨æ€§æ£€æŸ¥ï¼ˆåšè¿™ä¸ªå¾ˆè´¹æ—¶ï¼‰ åšç¼“å­˜ï¼ŒæŠŠè¦ç»å¸¸è®¿é—®çš„å…ƒæ•°æ®ä¿¡æ¯æ”¾å…¥å†…å­˜ä¸­ï¼Œclass.forName å¤ªè€—æ—¶ getMethods() ç­‰æ–¹æ³•å°½é‡å°‘ç”¨ï¼Œå°½é‡è°ƒç”¨getMethod(name)æŒ‡å®šæ–¹æ³•çš„åç§°ï¼Œå‡å°‘éåŽ†æ¬¡æ•° javaé¢è¯•ä¸­é¢è¯•å®˜è®©ä½ è®²è®²åå°„ï¼Œåº”è¯¥ä»Žä½•è®²èµ·ï¼Ÿ å…ˆè®²åå°„æœºåˆ¶ï¼Œåå°„å°±æ˜¯ç¨‹åºè¿è¡ŒæœŸé—´JVMä¼šå¯¹ä»»æ„ä¸€ä¸ªç±»æ´žæ‚‰å®ƒçš„å±žæ€§å’Œæ–¹æ³•ï¼Œå¯¹ä»»æ„ä¸€ä¸ªå¯¹è±¡éƒ½èƒ½å¤Ÿè®¿é—®å®ƒçš„å±žæ€§å’Œæ–¹æ³•ã€‚ä¾é æ­¤æœºåˆ¶ï¼Œå¯ä»¥åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡å’Œè°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ã€‚ å…¶æ¬¡å°±æ˜¯åå°„ç›¸å…³çš„APIï¼Œåªè®²ä¸€äº›å¸¸ç”¨çš„ï¼Œæ¯”å¦‚èŽ·å–ä¸€ä¸ªClasså¯¹è±¡ã€‚Class.forName(å®Œæ•´ç±»å)ã€‚é€šè¿‡Classå¯¹è±¡èŽ·å–ç±»çš„æž„é€ æ–¹æ³•ï¼Œclass.getConstructorã€‚æ ¹æ®Classå¯¹è±¡èŽ·å–ç±»çš„æ–¹æ³•ï¼ŒgetMethodå’ŒgetMethodsã€‚ä½¿ç”¨Classå¯¹è±¡åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œclass.newInstanceç­‰ã€‚ æœ€åŽå¯ä»¥è¯´ä¸€ä¸‹åå°„çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œä¼˜ç‚¹å°±æ˜¯å¢žåŠ çµæ´»æ€§ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€èŽ·å–å¯¹è±¡å®žä¾‹ã€‚ç¼ºç‚¹æ˜¯åå°„çš„æ•ˆçŽ‡å¾ˆä½Žï¼Œè€Œä¸”ä¼šç ´åå°è£…ï¼Œé€šè¿‡åå°„å¯ä»¥è®¿é—®ç±»çš„ç§æœ‰æ–¹æ³•ï¼Œä¸å®‰å…¨ã€‚]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¦‚ä½•æ‰§è¡Œä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åº]]></title>
    <url>%2F2019%2F02%2F03%2FJVM%2FJava%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E4%B8%80%E4%B8%AA%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E7%A8%8B%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡ä¸ºå­¦ä¹ JAVAè™šæ‹Ÿæœºçš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œéœ€è¦ä¹‹å‰å¯¹JVMæœ‰ä¸€å®šäº†è§£çš„åŸºç¡€ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJAVAå·ç§°ï¼šä¸€æ¬¡ç¼–è¯‘å¤šå¤„è¿è¡Œã€‚è¿™å°±ç¦»ä¸å¼€å­—èŠ‚ç æ–‡ä»¶å’Œè™šæ‹Ÿæœºå•¦ï¼é‚£ä¹ˆï¼Œè™šæ‹Ÿæœºåˆ°åº•æ˜¯å¦‚ä½•åŽ»æ‰§è¡Œä¸€ä¸ªç®€å•çš„ç¨‹åºçš„å‘¢ï¼Ÿç†è§£äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥ç†è§£javaæ—¶å¦‚ä½•åšåˆ°å¹³å°æ— å…³çš„äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æžåˆ†æžã€‚ é¦–å…ˆï¼Œå†™ä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åºï¼š 123456789public class Main &#123; public static void main(String[] args) &#123; int i=1,j=5; i++; ++j; System.out.println(i); System.out.println(j); &#125;&#125; è¿è¡Œä¹‹åŽçš„ç»“æžœæƒ³å¿…å°±ä¸€ç›®äº†ç„¶ï¼Œæˆ‘ä»¬å°±é€šè¿‡è¿™ä¸ªç¨‹åºæ¥åˆ†æžåˆ†æžåˆ°åº•æ˜¯æ€Žä¹ˆæ‰§è¡Œè¿™ä¸ªç¨‹åºé¢çš„ã€‚ é¦–å…ˆå‘¢ï¼Œjavaç¨‹åºçš„æ‰§è¡Œç»åŽ†ç¼–è¯‘ï¼Œç¼–è¯‘æˆç³»ç»Ÿèƒ½è¯†åˆ«çš„æ–‡ä»¶ï¼Œè¿™é‡Œçš„ç³»ç»Ÿå¯¹åº”javaè¯­è¨€å°±æ˜¯JVMï¼Œå³JAVAè™šæ‹Ÿæœºã€‚JVMåœ¨è¯†åˆ«ä¹‹åŽï¼Œå†åŽ»ä¸Žæˆ‘ä»¬çœŸæ­£çš„æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’å’Œå¤„ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œä¸€ä¸ª.javaç¨‹åºï¼Œå¿…é¡»è¦å…ˆè¿›è¡Œç¼–è¯‘ã€‚åˆå­¦è€…éƒ½ä¼šå­¦ä¹ ä¸€ä¸ªæŒ‡ä»¤å«åšjavacï¼š æˆ‘ä»¬ä¼šå‘çŽ°è·¯å¾„ä¸‹é¢å°±ä¼šå¤šä¸€ä¸ª.classæ–‡ä»¶ï¼Œè¿™å°±æ˜¯ç¼–è¯‘ä¹‹åŽçš„æ–‡ä»¶ã€‚ç›´æŽ¥ç‚¹å¼€ï¼š 123456789101112131415161718//// Source code recreated from a .class file by IntelliJ IDEA// (powered by Fernflower decompiler)//public class Main &#123; public Main() &#123; &#125; public static void main(String[] var0) &#123; byte var1 = 1; byte var2 = 5; int var3 = var1 + 1; int var4 = var2 + 1; System.out.println(var3); System.out.println(var4); &#125;&#125; æˆ‘ä»¬çœ‹ç¬¬ä¸€è¡Œæ³¨é‡Šï¼Œè¯´çš„æ˜¯ç¼–è¯‘åŽçš„æ–‡ä»¶å·²ç»è‡ªåŠ¨è¢«IDEAåç¼–è¯‘äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜èƒ½çœ‹å¾—æ‡‚ã€‚çœŸæ­£çš„æ–‡ä»¶æ˜¯ï¼š 12345æ¼±å£• 4          &lt;init&gt; ()V Code LineNumberTable main ([Ljava/lang/String;)V SourceFile Main.java         Main java/lang/Object java/lang/System out Ljava/io/PrintStream; java/io/PrintStream println (I)V !            *? ?       E   &lt;=??? ? ? ? ? æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®žæ˜¯ä¸€å †ä¹±ç ï¼Œæ ¹æœ¬çœ‹ä¸æ‡‚ã€‚è€Œåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œclassæ–‡ä»¶æ˜¯ä¸€ç§8ä½å­—èŠ‚çš„äºŒè¿›åˆ¶æµæ–‡ä»¶ã€‚æ”¾åœ¨sublimeä¸­å¯ä»¥çœ‹åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä»¥16è¿›åˆ¶æ˜¾ç¤ºï¼Œåœ¨JAVAè™šæ‹Ÿæœºä¸­å°†æ¥äº†è§£è¿™å„æ–‡ä»¶çš„å«ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå•è¯æ˜¯cafe babeï¼Œè¡¨æ˜Žè¿™æ˜¯ä¸€ä¸ªclasså­—èŠ‚ç æ–‡ä»¶ï¼‰ï¼š é‚£ä¹ˆæˆ‘ä»¬æƒ³çœ‹çœ‹.classä¸­çš„ä¿¡æ¯ï¼Œè¿˜æ˜¯éœ€è¦åç¼–è¯‘ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç”¨javapæŒ‡ä»¤æ¥åšã€‚å¦‚æžœæˆ‘ä»¬å¯¹å…¶ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥å…ˆæ‰§è¡Œjavap -helpæ¥äº†è§£äº†è§£ã€‚ 12345678910111213141516171819ç”¨æ³•: javap &lt;options&gt; &lt;classes&gt;å…¶ä¸­, å¯èƒ½çš„é€‰é¡¹åŒ…æ‹¬: -help --help -? è¾“å‡ºæ­¤ç”¨æ³•æ¶ˆæ¯ -version ç‰ˆæœ¬ä¿¡æ¯ -v -verbose è¾“å‡ºé™„åŠ ä¿¡æ¯ -l è¾“å‡ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨ -public ä»…æ˜¾ç¤ºå…¬å…±ç±»å’Œæˆå‘˜ -protected æ˜¾ç¤ºå—ä¿æŠ¤çš„/å…¬å…±ç±»å’Œæˆå‘˜ -package æ˜¾ç¤ºç¨‹åºåŒ…/å—ä¿æŠ¤çš„/å…¬å…±ç±» å’Œæˆå‘˜ (é»˜è®¤) -p -private æ˜¾ç¤ºæ‰€æœ‰ç±»å’Œæˆå‘˜ -c å¯¹ä»£ç è¿›è¡Œåæ±‡ç¼– -s è¾“å‡ºå†…éƒ¨ç±»åž‹ç­¾å -sysinfo æ˜¾ç¤ºæ­£åœ¨å¤„ç†çš„ç±»çš„ ç³»ç»Ÿä¿¡æ¯ (è·¯å¾„, å¤§å°, æ—¥æœŸ, MD5 æ•£åˆ—) -constants æ˜¾ç¤ºæœ€ç»ˆå¸¸é‡ -classpath &lt;path&gt; æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½® -cp &lt;path&gt; æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶çš„ä½ç½® -bootclasspath &lt;path&gt; è¦†ç›–å¼•å¯¼ç±»æ–‡ä»¶çš„ä½ç½® æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæœ‰ä¸€ä¸ª-cæ˜¯è¿›è¡Œåæ±‡ç¼–ï¼Œé‚£ä¹ˆå°±ç”¨å®ƒè¯•è¯•: 123456789101112131415161718192021222324252627E:\JavaBasic\src&gt;javap -c Main.classCompiled from &quot;Main.java&quot;public class Main &#123; public Main(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return public static void main(java.lang.String[]); Code: 0: iconst_1 1: istore_1 2: iconst_5 3: istore_2 4: iinc 1, 1 7: iinc 2, 1 10: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 13: iload_1 14: invokevirtual #3 // Method java/io/PrintStream.println:(I)V 17: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 20: iload_2 21: invokevirtual #3 // Method java/io/PrintStream.println:(I)V 24: return&#125; é‚£ä¹ˆè¿™åæ±‡ç¼–å‡ºæ¥çš„ä¸œè¥¿æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯ä¸€è¿žä¸²çš„æŒ‡ä»¤ï¼Œå…¶å®žè¿™äº›æ˜¯åŠ è½½classæ–‡ä»¶æ—¶çœŸæ­£æ‰§è¡Œçš„javaè™šæ‹ŸæœºæŒ‡ä»¤ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å«ä¹‰å§ï¼ ä»”ç»†çœ‹çœ‹ï¼Œå…¶å®žå‘çŽ°å¹¶ä¸ç¥žç§˜ï¼Œä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œæ˜¯ä¸€ä¸ªå…¥æ ˆå‡ºæ ˆçš„è¿‡ç¨‹ã€‚okï¼Œå¤§ä½“äº†è§£äº†å­—èŠ‚ç æ–‡ä»¶æ˜¯ä»€ä¹ˆä»¥åŠé‡Œé¢çš„æŒ‡ä»¤å«ä¹‰ä¹‹åŽï¼Œæˆ‘ä»¬å¯¹javaå¦‚ä½•æ‰§è¡Œå®ƒå·²ç»å¤§ä½“æ¸…æ¥šäº†ã€‚ä¸‹é¢æ‰§è¡Œä¸€ä¸‹ï¼š é‚£ä¹ˆå¦‚ä½•è¿è¡Œå‘¢ï¼Ÿ å…¶å®žè¿™æ˜¯åºŸè¯ï¼Œåˆå­¦javaå…¶å®žæ˜¯java Mainè¿è¡Œçš„ï¼š 1234E:\JavaBasic\src&gt;java Main26 è¿™ä¸ªæ—¶å€™ï¼Œclassæ–‡ä»¶å¯ä»¥ç§»æ¤åˆ°ä»»ä½•å¹³å°ä¸ŠåŽ»ï¼Œæ¯”å¦‚ç›´æŽ¥ä¸Šä¼ åˆ°linuxä¸Šï¼Œåªè¦JDKæˆ–è€…JREçŽ¯å¢ƒç±»ä¼¼å³å¯ï¼Œå°±å¯ä»¥ç›´æŽ¥è¿è¡Œäº†ï¼Œä¸éœ€è¦ç¼–è¯‘ï¼Œä¹Ÿä¸éœ€è¦å…³å¿ƒæ˜¯ä»€ä¹ˆç³»ç»Ÿã€‚è¿™å°±åšåˆ°äº†ä¸€æ¬¡ç¼–è¯‘åˆ°å¤„è¿è¡Œã€‚ ä¸‹é¢æ€»ç»“ä¸€ä¸‹ï¼š Javaæºç é¦–å…ˆè¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå†ç”±ä¸åŒå¹³å°çš„JVMè¿›è¡Œè§£æžï¼ŒJAVAè¯­è¨€åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œæ—¶ä¸éœ€è¦è¿›è¡Œé‡æ–°ç¼–è¯‘ï¼ŒJAVAè™šæ‹Ÿæœºåœ¨æ‰§è¡Œå­—èŠ‚ç çš„æ—¶å€™ï¼ŒæŠŠå­—èŠ‚ç è½¬æ¢ä¸ºå…·ä½“å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤ï¼Œç„¶åŽå„ç§æ“ä½œç³»ç»Ÿå°±å¯ä»¥æ­£ç¡®è¯†åˆ«äº†ã€‚è¿™å°±æ˜¯JAVAå¦‚ä½•æ‰§è¡Œä»£ç å’Œå¹³å°æ— å…³æ€§çš„åŽŸå› ã€‚]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽRedisä¸€äº›é‡è¦çš„é¢è¯•ç‚¹]]></title>
    <url>%2F2019%2F02%2F02%2Fredis%2F%E5%85%B3%E4%BA%8ERedis%E4%B8%80%E4%BA%9B%E9%87%8D%E8%A6%81%E7%9A%84%E9%9D%A2%E8%AF%95%E7%82%B9%2F</url>
    <content type="text"><![CDATA[è¿™é‡Œæ•´ç†ä¸€äº›é¢è¯•é¢˜ç›®ï¼Œå¾ˆå¤šå·²ç»åœ¨å‰é¢çš„æ–‡ç« ä¸­è¯¦ç»†è¯´æ˜Žäº†ï¼Œè¿™é‡Œç®—æ˜¯æ€»ç»“ä¸€ä¸‹ã€‚ä¹Ÿè¡¥å……äº†ä¸€ç‚¹æ–°çš„çŸ¥è¯†ã€‚ Redisæœ‰å“ªäº›æ•°æ®ç»“æž„ï¼Ÿ å­—ç¬¦ä¸² Stringã€å­—å…¸ Hash ã€åˆ—è¡¨ List ã€é›†åˆ Set ã€æœ‰åºé›†åˆ SortedSetã€‚ å¦‚æžœä½ æ˜¯Redisä¸­é«˜çº§ç”¨æˆ·ï¼Œè¿˜éœ€è¦åŠ ä¸Šä¸‹é¢å‡ ç§æ•°æ®ç»“æž„HyperLogLogã€Geoã€Pub/Subã€‚ Stringç±»åž‹çš„åº•å±‚æ•°æ®ç»“æž„ Redis æ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ•°æ®åº“, æ•°æ®åº“çš„å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€é›†åˆã€åˆ—è¡¨ç­‰å¤šç§ç±»åž‹çš„å¯¹è±¡ï¼Œ è€Œæ•°æ®åº“çš„é”®åˆ™æ€»æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ã€‚ å¯¹äºŽé‚£äº›åŒ…å«å­—ç¬¦ä¸²å€¼çš„å­—ç¬¦ä¸²å¯¹è±¡æ¥è¯´ï¼Œ æ¯ä¸ªå­—ç¬¦ä¸²å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ª sds å€¼ã€‚ â€œåŒ…å«å­—ç¬¦ä¸²å€¼çš„å­—ç¬¦ä¸²å¯¹è±¡â€ï¼Œè¿™ç§è¯´æ³•åˆå¬ä¸ŠåŽ»å¯èƒ½ä¼šæœ‰ç‚¹å¥‡æ€ªï¼Œ ä½†æ˜¯åœ¨ Redis ä¸­ï¼Œ ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡é™¤äº†å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²å€¼ä¹‹å¤–ï¼Œ è¿˜å¯ä»¥ä¿å­˜ long ç±»åž‹çš„å€¼ï¼Œ æ‰€ä»¥ä¸ºäº†ä¸¥è°¨èµ·è§ï¼Œ è¿™é‡Œéœ€è¦å¼ºè°ƒä¸€ä¸‹ï¼š å½“å­—ç¬¦ä¸²å¯¹è±¡ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œ å®ƒåŒ…å«çš„æ‰æ˜¯ sds å€¼ï¼Œ å¦åˆ™çš„è¯ï¼Œ å®ƒå°±æ˜¯ä¸€ä¸ª long ç±»åž‹çš„å€¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ ä»¥ä¸‹å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ•°æ®åº“é”®å€¼å¯¹ï¼Œ è¿™ä¸ªé”®å€¼å¯¹çš„é”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ï¼Œ å®ƒä»¬éƒ½åŒ…å«ä¸€ä¸ª sds å€¼ï¼š 12345redis&gt; SET book &quot;Mastering C++ in 21 days&quot;OKredis&gt; GET book&quot;Mastering C++ in 21 days&quot; ç›®å‰æ¥è¯´ï¼Œ åªè¦è®°ä½è¿™ä¸ªäº‹å®žå³å¯ï¼š åœ¨ Redis ä¸­ï¼Œ å®¢æˆ·ç«¯ä¼ å…¥æœåŠ¡å™¨çš„åè®®å†…å®¹ã€ aof ç¼“å­˜ã€ è¿”å›žç»™å®¢æˆ·ç«¯çš„å›žå¤ï¼Œ ç­‰ç­‰ï¼Œ è¿™äº›é‡è¦çš„å†…å®¹éƒ½æ˜¯ç”± sds ç±»åž‹æ¥ä¿å­˜çš„ã€‚ åœ¨ C è¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²å¯ä»¥ç”¨ä¸€ä¸ª \0 ç»“å°¾çš„ char æ•°ç»„æ¥è¡¨ç¤ºã€‚ æ¯”å¦‚è¯´ï¼Œ hello world åœ¨ C è¯­è¨€ä¸­å°±å¯ä»¥è¡¨ç¤ºä¸º &quot;hello world\0&quot; ã€‚ è¿™ç§ç®€å•çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½èƒ½æ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯ï¼Œå®ƒå¹¶ä¸èƒ½é«˜æ•ˆåœ°æ”¯æŒé•¿åº¦è®¡ç®—å’Œè¿½åŠ ï¼ˆappendï¼‰è¿™ä¸¤ç§æ“ä½œï¼š æ¯æ¬¡è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ï¼ˆstrlen(s)ï¼‰çš„å¤æ‚åº¦ä¸º Î¸(N) ã€‚ å¯¹å­—ç¬¦ä¸²è¿›è¡Œ N æ¬¡è¿½åŠ ï¼Œå¿…å®šéœ€è¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œ N æ¬¡å†…å­˜é‡åˆ†é…ï¼ˆreallocï¼‰ã€‚ åœ¨ Redis å†…éƒ¨ï¼Œ å­—ç¬¦ä¸²çš„è¿½åŠ å’Œé•¿åº¦è®¡ç®—å¾ˆå¸¸è§ï¼Œ è€Œ APPEND å’Œ STRLEN æ›´æ˜¯è¿™ä¸¤ç§æ“ä½œï¼Œåœ¨ Redis å‘½ä»¤ä¸­çš„ç›´æŽ¥æ˜ å°„ï¼Œ è¿™ä¸¤ä¸ªç®€å•çš„æ“ä½œä¸åº”è¯¥æˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆã€‚ å¦å¤–ï¼Œ Redis é™¤äº†å¤„ç†å­—ç¬¦ä¸²ä¹‹å¤–ï¼Œ è¿˜éœ€è¦å¤„ç†å•çº¯çš„å­—èŠ‚æ•°ç»„ï¼Œ ä»¥åŠæœåŠ¡å™¨åè®®ç­‰å†…å®¹ï¼Œ æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œ Redis çš„å­—ç¬¦ä¸²è¡¨ç¤ºè¿˜åº”è¯¥æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼š ç¨‹åºä¸åº”å¯¹å­—ç¬¦ä¸²é‡Œé¢ä¿å­˜çš„æ•°æ®åšä»»ä½•å‡è®¾ï¼Œ æ•°æ®å¯ä»¥æ˜¯ä»¥ \0 ç»“å°¾çš„ C å­—ç¬¦ä¸²ï¼Œ ä¹Ÿå¯ä»¥æ˜¯å•çº¯çš„å­—èŠ‚æ•°ç»„ï¼Œ æˆ–è€…å…¶ä»–æ ¼å¼çš„æ•°æ®ã€‚ è€ƒè™‘åˆ°è¿™ä¸¤ä¸ªåŽŸå› ï¼Œ Redis ä½¿ç”¨ sds ç±»åž‹æ›¿æ¢äº† C è¯­è¨€çš„é»˜è®¤å­—ç¬¦ä¸²è¡¨ç¤ºï¼š sds æ—¢å¯é«˜æ•ˆåœ°å®žçŽ°è¿½åŠ å’Œé•¿åº¦è®¡ç®—ï¼Œ åŒæ—¶æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚ åœ¨å‰é¢çš„å†…å®¹ä¸­ï¼Œ æˆ‘ä»¬ä¸€ç›´å°† sds ä½œä¸ºä¸€ç§æŠ½è±¡æ•°æ®ç»“æž„æ¥è¯´æ˜Žï¼Œ å®žé™…ä¸Šï¼Œ å®ƒçš„å®žçŽ°ç”±ä»¥ä¸‹ä¸¤éƒ¨åˆ†ç»„æˆï¼š 1234567891011121314typedef char *sds;struct sdshdr &#123; // buf å·²å ç”¨é•¿åº¦ int len; // buf å‰©ä½™å¯ç”¨é•¿åº¦ int free; // å®žé™…ä¿å­˜å­—ç¬¦ä¸²æ•°æ®çš„åœ°æ–¹ char buf[];&#125;; å…¶ä¸­ï¼Œç±»åž‹ sds æ˜¯ char * çš„åˆ«åï¼ˆaliasï¼‰ï¼Œè€Œç»“æž„ sdshdr åˆ™ä¿å­˜äº† len ã€ free å’Œ buf ä¸‰ä¸ªå±žæ€§ã€‚ ä½œä¸ºä¾‹å­ï¼Œä»¥ä¸‹æ˜¯æ–°åˆ›å»ºçš„ï¼ŒåŒæ ·ä¿å­˜ hello world å­—ç¬¦ä¸²çš„ sdshdr ç»“æž„ï¼š 12345struct sdshdr &#123; len = 11; free = 0; buf = &quot;hello world\0&quot;; // buf çš„å®žé™…é•¿åº¦ä¸º len + 1&#125;; é€šè¿‡ len å±žæ€§ï¼Œ sdshdr å¯ä»¥å®žçŽ°å¤æ‚åº¦ä¸º Î¸(1) çš„é•¿åº¦è®¡ç®—æ“ä½œã€‚ å¦ä¸€æ–¹é¢ï¼Œ é€šè¿‡å¯¹ buf åˆ†é…ä¸€äº›é¢å¤–çš„ç©ºé—´ï¼Œ å¹¶ä½¿ç”¨ free è®°å½•æœªä½¿ç”¨ç©ºé—´çš„å¤§å°ï¼Œ sdshdr å¯ä»¥è®©æ‰§è¡Œè¿½åŠ æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°å¤§å¤§å‡å°‘ã€‚ ä¸ºäº†æ˜“äºŽç†è§£ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª Redis æ‰§è¡Œå®žä¾‹ä½œä¸ºä¾‹å­ï¼Œè§£é‡Šä¸€ä¸‹ï¼Œå½“æ‰§è¡Œä»¥ä¸‹ä»£ç æ—¶ï¼Œ Redis å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼š 12345678redis&gt; SET msg "hello world"OKredis&gt; APPEND msg " again!"(integer) 18redis&gt; GET msg"hello world again!" é¦–å…ˆï¼Œ SET å‘½ä»¤åˆ›å»ºå¹¶ä¿å­˜ hello world åˆ°ä¸€ä¸ª sdshdr ä¸­ï¼Œè¿™ä¸ª sdshdr çš„å€¼å¦‚ä¸‹ï¼š 12345struct sdshdr &#123; len = 11; free = 0; buf = "hello world\0";&#125; å½“æ‰§è¡Œ APPEND å‘½ä»¤æ—¶ï¼Œç›¸åº”çš„ sdshdr è¢«æ›´æ–°ï¼Œå­—ç¬¦ä¸² &quot; again!&quot; ä¼šè¢«è¿½åŠ åˆ°åŽŸæ¥çš„ â€œhello worldâ€ ä¹‹åŽï¼š 12345struct sdshdr &#123; len = 18; free = 18; buf = "hello world again!\0 "; // ç©ºç™½çš„åœ°æ–¹ä¸ºé¢„åˆ†é…ç©ºé—´ï¼Œå…± 18 + 18 + 1 ä¸ªå­—èŠ‚&#125; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ ä¿å­˜ â€œhello world again!â€ å…±éœ€è¦ 18 + 1 ä¸ªå­—èŠ‚ï¼Œ ä½†ç¨‹åºå´ä¸ºæˆ‘ä»¬åˆ†é…äº† 18 + 18 + 1 = 37 ä¸ªå­—èŠ‚ â€”â€” è¿™æ ·ä¸€æ¥ï¼Œ å¦‚æžœå°†æ¥å†æ¬¡å¯¹åŒä¸€ä¸ª sdshdr è¿›è¡Œè¿½åŠ æ“ä½œï¼Œ åªè¦è¿½åŠ å†…å®¹çš„é•¿åº¦ä¸è¶…è¿‡ free å±žæ€§çš„å€¼ï¼Œ é‚£ä¹ˆå°±ä¸éœ€è¦å¯¹ buf è¿›è¡Œå†…å­˜é‡åˆ†é…ã€‚ è¿™ç§åˆ†é…ç­–ç•¥ä¼šæµªè´¹å†…å­˜å—ï¼Ÿ æ‰§è¡Œè¿‡ APPEND å‘½ä»¤çš„å­—ç¬¦ä¸²ä¼šå¸¦æœ‰é¢å¤–çš„é¢„åˆ†é…ç©ºé—´ï¼Œ è¿™äº›é¢„åˆ†é…ç©ºé—´ä¸ä¼šè¢«é‡Šæ”¾ï¼Œ é™¤éžè¯¥å­—ç¬¦ä¸²æ‰€å¯¹åº”çš„é”®è¢«åˆ é™¤ï¼Œ æˆ–è€…ç­‰åˆ°å…³é—­ Redis ä¹‹åŽï¼Œ å†æ¬¡å¯åŠ¨æ—¶é‡æ–°è½½å…¥çš„å­—ç¬¦ä¸²å¯¹è±¡å°†ä¸ä¼šæœ‰é¢„åˆ†é…ç©ºé—´ã€‚ å› ä¸ºæ‰§è¡Œ APPEND å‘½ä»¤çš„å­—ç¬¦ä¸²é”®æ•°é‡é€šå¸¸å¹¶ä¸å¤šï¼Œ å ç”¨å†…å­˜çš„ä½“ç§¯é€šå¸¸ä¹Ÿä¸å¤§ï¼Œ æ‰€ä»¥è¿™ä¸€èˆ¬å¹¶ä¸ç®—ä»€ä¹ˆé—®é¢˜ã€‚ å¦ä¸€æ–¹é¢ï¼Œ å¦‚æžœæ‰§è¡Œ APPEND æ“ä½œçš„é”®å¾ˆå¤šï¼Œ è€Œå­—ç¬¦ä¸²çš„ä½“ç§¯åˆå¾ˆå¤§çš„è¯ï¼Œ é‚£å¯èƒ½å°±éœ€è¦ä¿®æ”¹ Redis æœåŠ¡å™¨ï¼Œ è®©å®ƒå®šæ—¶é‡Šæ”¾ä¸€äº›å­—ç¬¦ä¸²é”®çš„é¢„åˆ†é…ç©ºé—´ï¼Œ ä»Žè€Œæ›´æœ‰æ•ˆåœ°ä½¿ç”¨å†…å­˜ã€‚ å½“ç„¶ï¼Œ sds ä¹Ÿå¯¹æ“ä½œçš„æ­£ç¡®å®žçŽ°æå‡ºäº†è¦æ±‚ â€”â€” æ‰€æœ‰å¤„ç† sdshdr çš„å‡½æ•°ï¼Œéƒ½å¿…é¡»æ­£ç¡®åœ°æ›´æ–° len å’Œ free å±žæ€§ï¼Œå¦åˆ™å°±ä¼šé€ æˆ bug ã€‚ æ›´å¤šå‚è§ï¼šç®€å•åŠ¨æ€å­—ç¬¦ä¸² ä»Žæµ·é‡æ•°æ®ä¸­æŸ¥è¯¢æŸä¸€å›ºå®šå‰ç¼€çš„key ä½¿ç”¨keysæŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ã€‚ å¯¹æ–¹æŽ¥ç€è¿½é—®ï¼šå¦‚æžœè¿™ä¸ªredisæ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ è¿™ä¸ªæ—¶å€™ä½ è¦å›žç­”rediså…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼šredisçš„å•çº¿ç¨‹çš„ã€‚keysæŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡žä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨scanæŒ‡ä»¤ï¼ŒscanæŒ‡ä»¤å¯ä»¥æ— é˜»å¡žçš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚çŽ‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡åŽ»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æŽ¥ç”¨keysæŒ‡ä»¤é•¿ã€‚ åŸºäºŽæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼Œéœ€è¦ä½¿ç”¨ä¸Šä¸€æ¬¡æ¸¸æ ‡å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚æ¸¸æ ‡ä¸º0çš„æ—¶å€™ä»£è¡¨å¼€å§‹æˆ–ç»“æŸã€‚ 1234#æ¨¡å¼scan cursor match pattern count#ç¤ºä¾‹scan 0 match k* count 10 Redisåšå¼‚æ­¥é˜Ÿåˆ— ä¸€èˆ¬ä½¿ç”¨listç»“æž„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ã€‚å½“lpopæ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“sleepä¸€ä¼šå†é‡è¯•ã€‚ å¦‚æžœå¯¹æ–¹è¿½é—®å¯ä¸å¯ä»¥ä¸ç”¨sleepå‘¢ï¼Ÿlistè¿˜æœ‰ä¸ªæŒ‡ä»¤å«blpopï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»å¡žä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚ å¦‚æžœå¯¹æ–¹è¿½é—®èƒ½ä¸èƒ½ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡å‘¢ï¼Ÿä½¿ç”¨pub/subä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®žçŽ°1:Nçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ å¦‚æžœå¯¹æ–¹è¿½é—®pub/subæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿåœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚rabbitmqç­‰ã€‚ å¦‚æžœå¯¹æ–¹è¿½é—®rediså¦‚ä½•å®žçŽ°å»¶æ—¶é˜Ÿåˆ—ï¼Ÿæˆ‘ä¼°è®¡çŽ°åœ¨ä½ å¾ˆæƒ³æŠŠé¢è¯•å®˜ä¸€æ£’æ‰“æ­»å¦‚æžœä½ æ‰‹ä¸Šæœ‰ä¸€æ ¹æ£’çƒæ£çš„è¯ï¼Œæ€Žä¹ˆé—®çš„è¿™ä¹ˆè¯¦ç»†ã€‚ä½†æ˜¯ä½ å¾ˆå…‹åˆ¶ï¼Œç„¶åŽç¥žæ€è‡ªè‹¥çš„å›žç­”é“ï¼šä½¿ç”¨sortedsetï¼Œæ‹¿æ—¶é—´æˆ³ä½œä¸ºscoreï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸ºkeyè°ƒç”¨zaddæ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨zrangebyscoreæŒ‡ä»¤èŽ·å–Nç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚ å¦‚æžœæœ‰å¤§é‡çš„keyéœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ å¦‚æžœå¤§é‡çš„keyè¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡äºŽé›†ä¸­ï¼Œåˆ°è¿‡æœŸçš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œrediså¯èƒ½ä¼šå‡ºçŽ°çŸ­æš‚çš„å¡é¡¿çŽ°è±¡ã€‚ä¸€èˆ¬éœ€è¦åœ¨æ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—è¿‡æœŸæ—¶é—´åˆ†æ•£ä¸€äº›ã€‚ Rediså¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ bgsaveåšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼Œaofåšå¢žé‡æŒä¹…åŒ–ã€‚å› ä¸ºbgsaveä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œä¸å¤Ÿå®žæ—¶ï¼Œåœ¨åœæœºçš„æ—¶å€™ä¼šå¯¼è‡´å¤§é‡ä¸¢å¤±æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦aofæ¥é…åˆä½¿ç”¨ã€‚åœ¨rediså®žä¾‹é‡å¯æ—¶ï¼Œä¼šä½¿ç”¨bgsaveæŒä¹…åŒ–æ–‡ä»¶é‡æ–°æž„å»ºå†…å­˜ï¼Œå†ä½¿ç”¨aofé‡æ”¾è¿‘æœŸçš„æ“ä½œæŒ‡ä»¤æ¥å®žçŽ°å®Œæ•´æ¢å¤é‡å¯ä¹‹å‰çš„çŠ¶æ€ã€‚ å¯¹æ–¹è¿½é—®é‚£å¦‚æžœçªç„¶æœºå™¨æŽ‰ç”µä¼šæ€Žæ ·ï¼Ÿå–å†³äºŽaofæ—¥å¿—syncå±žæ€§çš„é…ç½®ï¼Œå¦‚æžœä¸è¦æ±‚æ€§èƒ½ï¼Œåœ¨æ¯æ¡å†™æŒ‡ä»¤æ—¶éƒ½syncä¸€ä¸‹ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯åœ¨é«˜æ€§èƒ½çš„è¦æ±‚ä¸‹æ¯æ¬¡éƒ½syncæ˜¯ä¸çŽ°å®žçš„ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨å®šæ—¶syncï¼Œæ¯”å¦‚1s1æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¤šå°±ä¼šä¸¢å¤±1sçš„æ•°æ®ã€‚ å¯¹æ–¹è¿½é—®bgsaveçš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ ç»™å‡ºä¸¤ä¸ªè¯æ±‡å°±å¯ä»¥äº†ï¼Œforkå’Œcowã€‚forkæ˜¯æŒ‡redisé€šè¿‡åˆ›å»ºå­è¿›ç¨‹æ¥è¿›è¡Œbgsaveæ“ä½œï¼ŒcowæŒ‡çš„æ˜¯copy on writeï¼Œå­è¿›ç¨‹åˆ›å»ºåŽï¼Œçˆ¶å­è¿›ç¨‹å…±äº«æ•°æ®æ®µï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ï¼Œå†™è„çš„é¡µé¢æ•°æ®ä¼šé€æ¸å’Œå­è¿›ç¨‹åˆ†ç¦»å¼€æ¥ã€‚ Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨pipelineï¼Ÿ å¯ä»¥å°†å¤šæ¬¡IOå¾€è¿”çš„æ—¶é—´ç¼©å‡ä¸ºä¸€æ¬¡ï¼Œå‰ææ˜¯pipelineæ‰§è¡Œçš„æŒ‡ä»¤ä¹‹é—´æ²¡æœ‰å› æžœç›¸å…³æ€§ã€‚ä½¿ç”¨redis-benchmarkè¿›è¡ŒåŽ‹æµ‹çš„æ—¶å€™å¯ä»¥å‘çŽ°å½±å“redisçš„QPSå³°å€¼çš„ä¸€ä¸ªé‡è¦å› ç´ æ˜¯pipelineæ‰¹æ¬¡æŒ‡ä»¤çš„æ•°ç›®ã€‚ Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ Rediså¯ä»¥ä½¿ç”¨ä¸»ä»ŽåŒæ­¥ï¼Œä»Žä»ŽåŒæ­¥ã€‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡bgsaveï¼Œå¹¶åŒæ—¶å°†åŽç»­ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜bufferï¼Œå¾…å®ŒæˆåŽå°†rdbæ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æŽ¥å—å®ŒæˆåŽå°†rdbé•œåƒåŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®ŒæˆåŽï¼Œå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚ æ˜¯å¦ä½¿ç”¨è¿‡Redisé›†ç¾¤ï¼Œé›†ç¾¤çš„åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿ Redis Sentinalç€çœ¼äºŽé«˜å¯ç”¨ï¼Œåœ¨masterå®•æœºæ—¶ä¼šè‡ªåŠ¨å°†slaveæå‡ä¸ºmasterï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚ Redis Clusterç€çœ¼äºŽæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ªrediså†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨Clusterè¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚ æ•´ç†è‡ªï¼š å¤©ä¸‹æ— éš¾è¯•ä¹‹Redisé¢è¯•é¢˜åˆéš¾å¤§å…¨]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‡ ç§ä¸»æµç¼“å­˜æ¡†æž¶ä»‹ç»]]></title>
    <url>%2F2019%2F02%2F02%2Fredis%2F%E5%87%A0%E7%A7%8D%E4%B8%BB%E6%B5%81%E7%BC%93%E5%AD%98%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬åäºŒç¯‡æ–‡ç« ã€‚æœ¬æ–‡å¯¹Guava Cache,Memcacheä»¥åŠredisè¿›è¡Œç®€å•ä»‹ç»å’Œå¯¹æ¯”ã€‚ ç¼“å­˜ç‰¹å¾ ç¼“å­˜éƒ½ä¼šæ¶‰åŠï¼šå‘½ä¸­çŽ‡ã€æœ€å¤§å…ƒç´ ã€æ¸…ç©ºç­–ç•¥(FIFO,LFU,LRU,è¿‡æœŸæ—¶é—´ï¼Œéšæœº) å½±å“ç¼“å­˜å‘½ä¸­çŽ‡å› ç´  ä¸šåŠ¡åœºæ™¯å’Œä¸šåŠ¡éœ€æ±‚ï¼šé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ ç¼“å­˜çš„è®¾è®¡(ç²’åº¦å’Œç­–ç•¥)ï¼šç¼“å­˜ç²’åº¦è¶Šå°ï¼Œå‘½ä¸­çŽ‡è¶Šé«˜ ç¼“å­˜å®¹é‡(ç»å¸¸ç”¨LRU)å’ŒåŸºç¡€è®¾æ–½(æ˜¯å¦å¯æ‰©å±•ï¼Œé¿å…ç¼“å­˜å¤±æ•ˆ-ä¸€è‡´æ€§hashç®—æ³•å’Œå‡ ç‚¹å†—ä½™) ç¼“å­˜åˆ†ç±» æœ¬åœ°ç¼“å­˜ï¼šç¼–ç¨‹å®žçŽ°ï¼ˆæˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡ã€é™æ€å˜é‡ï¼‰ã€Guava Cache åˆ†å¸ƒå¼ç¼“å­˜ï¼šMemcacheï¼ŒRedis æœ¬åœ°ç¼“å­˜ï¼šå„åº”ç”¨ä¹‹é—´æ— æ³•å¾ˆå¥½åœ°å…±äº«ï¼Œä¸Žåº”ç”¨æœ¬èº«è€¦åˆè¿‡ç´§ï¼›è€Œåˆ†å¸ƒå¼ç¼“å­˜ï¼Œæœ¬èº«å°±æ˜¯ç‹¬ç«‹çš„åº”ç”¨ï¼Œå„ç‹¬ç«‹åº”ç”¨ä¹‹é—´å…±äº«ç¼“å­˜ã€‚ Guava Cache è®¾è®¡æ€æƒ³ç±»ä¼¼äºŽjdk1.7ä¸­çš„ConcurrentHashMapï¼Œä¹Ÿæ˜¯ç”¨å¤šä¸ªsegmentsçš„ç»†ç²’åº¦é”ï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŒæ—¶ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯çš„éœ€æ±‚ã€‚ ä¸‹é¢æ•°æ®å­˜å‚¨å°±æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ï¼Œå¦å¤–ï¼Œéœ€è¦å¤„ç†ç¼“å­˜è¿‡æœŸã€åŠ¨æ€åŠ è½½ç­‰ç®—æ³•é€»è¾‘ï¼Œæ‰€ä»¥éœ€è¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯æ¥å®žçŽ°è¿™äº›æ“ä½œã€‚ ä¸»è¦å®žçŽ°çš„åŠŸèƒ½æœ‰ï¼šè‡ªåŠ¨å°†èŠ‚ç‚¹åŠ å…¥åˆ°ç¼“å­˜ç»“æž„ä¸­ï¼Œå½“ç¼“å­˜çš„æ•°æ®è¶…è¿‡è®¾ç½®çš„æœ€å¤§å€¼æ—¶ï¼Œç”¨LRUç®—æ³•æ¥ç§»é™¤ã€‚ä»–å…·å¤‡æ ¹æ®èŠ‚ç‚¹ä¸Šæ¬¡è¢«è®¿é—®æˆ–è€…å†™å…¥çš„æ—¶é—´æ¥è®¡ç®—ä»–çš„è¿‡æœŸæœºåˆ¶ã€‚ memcache memcacheç®€å•è®¤è¯† memcacheæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼çš„å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œå®ƒåœ¨å†…å­˜é‡Œç»´æŠ¤ä¸€ä¸ªç»Ÿä¸€çš„å·¨å¤§çš„hashè¡¨ã€‚èƒ½ç”¨æ¥ç¼“å­˜å„ç§æ ¼å¼çš„æ•°æ®ï¼ŒåŒ…æ‹¬å›¾åƒã€è§†é¢‘ã€æ–‡ä»¶ä»¥åŠæ•°æ®åº“æ£€ç´¢ç­‰ç»“æžœ. memcacheæ˜¯ä»¥å®ˆæŠ¤ç¨‹åºæ–¹å¼è¿è¡ŒäºŽä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ä¸­ï¼Œéšæ—¶ä¼šæŽ¥æ”¶å®¢æˆ·çš„è¿žæŽ¥å’Œæ“ä½œã€‚ å­˜åœ¨memcacheä¸­çš„å¯¹è±¡å®žé™…æ”¾ç½®åœ¨å†…å­˜ä¸­ï¼Œè¿™ä¹Ÿæ˜¯memcacheå¦‚æ­¤é«˜æ•ˆçš„åŽŸå› ã€‚ æœ¬èº«æ˜¯ä¸æä¾›åˆ†å¸ƒå¼çš„è§£å†³æ–¹æ¡ˆçš„ã€‚åˆ†å¸ƒå¼æ˜¯åœ¨å®¢æˆ·ç«¯å®žçŽ°çš„ï¼Œé€šè¿‡å®¢æˆ·ç«¯çš„è·¯ç”±æ¥å¤„ç†è¾¾åˆ°åˆ†å¸ƒå¼çš„ç›®çš„ã€‚ åº”ç”¨æœåŠ¡å™¨æ¯æ¬¡åœ¨å­˜å‚¨æŸä¸ªkeyå’Œvalueçš„æ—¶å€™ï¼Œé€šè¿‡æŸç§ç®—æ³•æŠŠkeyæ˜ å°„åˆ°æŸå°æœåŠ¡å™¨ä¸Šã€‚ ä¸€è‡´æ€§hashç®—æ³• å®¢æˆ·ç«¯å®žçŽ°åˆ†å¸ƒå¼ï¼šä¸€è‡´æ€§hashç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•å·²ç»è¯¦ç»†ä»‹ç»è¿‡äº†ã€‚ memcacheä¸€äº›ç‰¹æ€§ Memcachedå•è¿›ç¨‹åœ¨32ä½ç³»ç»Ÿä¸­æœ€å¤§ä½¿ç”¨å†…å­˜ä¸º2Gï¼Œè‹¥åœ¨64ä½ç³»ç»Ÿåˆ™æ²¡æœ‰é™åˆ¶,è¿™æ˜¯ç”±äºŽ32ä½ç³»ç»Ÿé™åˆ¶å•è¿›ç¨‹æœ€å¤šå¯ä½¿ç”¨2Gå†…å­˜,è¦ä½¿ç”¨æ›´å¤šå†…å­˜ï¼Œå¯ä»¥åˆ†å¤šä¸ªç«¯å£å¼€å¯å¤šä¸ªMemcachedè¿›ç¨‹ã€‚ 32 ä½å¯»å€ç©ºé—´åªæœ‰ 4GB å¤§å°ï¼ŒäºŽæ˜¯ 32 ä½åº”ç”¨ç¨‹åºè¿›ç¨‹æœ€å¤§åªèƒ½ç”¨åˆ° 4GB çš„å†…å­˜ã€‚ç„¶è€Œï¼Œé™¤äº†åº”ç”¨ç¨‹åºæœ¬èº«è¦ç”¨å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¹Ÿéœ€è¦ä½¿ç”¨ã€‚åº”ç”¨ç¨‹åºä½¿ç”¨çš„å†…å­˜ç©ºé—´åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼Œæ¯ä¸ª 32 ä½ç¨‹åºçš„ç”¨æˆ·ç©ºé—´å¯ç‹¬äº«å‰ 2GB ç©ºé—´ï¼ˆæŒ‡é’ˆå€¼ä¸ºæ­£æ•°ï¼‰ï¼Œè€Œå†…æ ¸ç©ºé—´ä¸ºæ‰€æœ‰è¿›ç¨‹å…±äº« 2GB ç©ºé—´ï¼ˆæŒ‡é’ˆå€¼ä¸ºè´Ÿæ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œ32 ä½åº”ç”¨ç¨‹åºå®žé™…èƒ½å¤Ÿè®¿é—®çš„å†…å­˜åœ°å€ç©ºé—´æœ€å¤šåªæœ‰ 2GBã€‚ æœ€å¤§30å¤©çš„æ•°æ®è¿‡æœŸæ—¶é—´ï¼Œè®¾ç½®ä¸ºæ°¸ä¹…ä¹Ÿä¼šåœ¨è¿™ä¸ªæ—¶é—´è¿‡æœŸã€‚æœ€é•¿é”®é•¿ä¸º250å­—èŠ‚ï¼Œå¤§äºŽè¯¥é•¿åº¦æ— æ³•å­˜å‚¨ã€‚æœ€å¤§åŒæ—¶è¿žæŽ¥æ•°æ˜¯200; memcacheæ˜¯ä¸€ç§æ— é˜»å¡žçš„socketé€šä¿¡æ–¹å¼æœåŠ¡ï¼ŒåŸºäºŽlibeventåº“ï¼ŒçŠ¹è±«æ— é˜»å¡žé€šä¿¡ï¼Œå¯¹å†…å­˜è¯»å†™é€Ÿåº¦éžå¸¸å¿«ã€‚ ä¸é€‚ç”¨memcachedçš„ä¸šåŠ¡åœºæ™¯ï¼Ÿ ç¼“å­˜å¯¹è±¡çš„å¤§å°å¤§äºŽ1MB è™šæ‹Ÿä¸»æœºä¸è®©è¿è¡ŒmemcachedæœåŠ¡ keyçš„é•¿åº¦å¤§äºŽ250å­—ç¬¦ éœ€è¦æŒä¹…åŒ– ä¸èƒ½å¤ŸéåŽ†memcachedä¸­æ‰€æœ‰çš„itemï¼Ÿ è¿™ä¸ªæ“ä½œçš„é€Ÿåº¦ç›¸å¯¹ç¼“æ…¢ä¸”é˜»å¡žå…¶ä»–çš„æ“ä½œ memcacheå¦‚ä½•åˆ†é…å†…å­˜ï¼Ÿ è¿™å¼ å›¾ç‰‡é‡Œé¢æ¶‰åŠäº†slab_classã€slabã€pageã€chunkå››ä¸ªæ¦‚å¿µï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ï¼š MemCacheå°†å†…å­˜ç©ºé—´åˆ†ä¸ºä¸€ç»„slab æ¯ä¸ªslabä¸‹åˆæœ‰è‹¥å¹²ä¸ªpageï¼Œæ¯ä¸ªpageé»˜è®¤æ˜¯1Mï¼Œå¦‚æžœä¸€ä¸ªslabå ç”¨100Må†…å­˜çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªslabä¸‹åº”è¯¥æœ‰100ä¸ªpage æ¯ä¸ªpageé‡Œé¢åŒ…å«ä¸€ç»„chunkï¼Œchunkæ˜¯çœŸæ­£å­˜æ”¾æ•°æ®çš„åœ°æ–¹ï¼ŒåŒä¸€ä¸ªslabé‡Œé¢çš„chunkçš„å¤§å°æ˜¯å›ºå®šçš„ æœ‰ç›¸åŒå¤§å°chunkçš„slabè¢«ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç§°ä¸ºslab_class é‚£ä¹ˆæ˜¯å…·ä½“å¦‚ä½•åˆ†é…çš„å‘¢ï¼Ÿ MemCacheä¸­çš„valueè¿‡æ¥å­˜æ”¾çš„åœ°æ–¹æ˜¯ç”±valueçš„å¤§å°å†³å®šçš„ï¼Œvalueæ€»æ˜¯ä¼šè¢«å­˜æ”¾åˆ°ä¸Žchunkå¤§å°æœ€æŽ¥è¿‘çš„ä¸€ä¸ªslabä¸­ï¼Œæ¯”å¦‚slab[1]çš„chunkå¤§å°ä¸º80å­—èŠ‚ã€slab[2]çš„chunkå¤§å°ä¸º100å­—èŠ‚ã€slab[3]çš„chunkå¤§å°ä¸º128å­—èŠ‚ï¼ˆç›¸é‚»slabå†…çš„chunkåŸºæœ¬ä»¥1.25ä¸ºæ¯”ä¾‹è¿›è¡Œå¢žé•¿ï¼ŒMemCacheå¯åŠ¨æ—¶å¯ä»¥ç”¨-fæŒ‡å®šè¿™ä¸ªæ¯”ä¾‹ï¼‰ï¼Œé‚£ä¹ˆè¿‡æ¥ä¸€ä¸ª88å­—èŠ‚çš„valueï¼Œè¿™ä¸ªvalueå°†è¢«æ”¾åˆ°2å·slabä¸­ã€‚ æ”¾slabçš„æ—¶å€™ï¼Œé¦–å…ˆslabè¦ç”³è¯·å†…å­˜ï¼Œç”³è¯·å†…å­˜æ˜¯ä»¥pageä¸ºå•ä½çš„ï¼Œæ‰€ä»¥åœ¨æ”¾å…¥ç¬¬ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œæ— è®ºå¤§å°ä¸ºå¤šå°‘ï¼Œéƒ½ä¼šæœ‰1Må¤§å°çš„pageè¢«åˆ†é…ç»™è¯¥slabã€‚ç”³è¯·åˆ°pageåŽï¼Œslabä¼šå°†è¿™ä¸ªpageçš„å†…å­˜æŒ‰chunkçš„å¤§å°è¿›è¡Œåˆ‡åˆ†ï¼Œè¿™æ ·å°±å˜æˆäº†ä¸€ä¸ªchunkæ•°ç»„ï¼Œæœ€åŽä»Žè¿™ä¸ªchunkæ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ªç”¨äºŽå­˜å‚¨æ•°æ®ã€‚ å¦‚æžœè¿™ä¸ªslabä¸­æ²¡æœ‰chunkå¯ä»¥åˆ†é…äº†æ€Žä¹ˆåŠžï¼Œå¦‚æžœMemCacheå¯åŠ¨æ²¡æœ‰è¿½åŠ -Mï¼ˆç¦æ­¢LRUï¼Œè¿™ç§æƒ…å†µä¸‹å†…å­˜ä¸å¤Ÿä¼šæŠ¥Out Of Memoryé”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆMemCacheä¼šæŠŠè¿™ä¸ªslabä¸­æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„chunkä¸­çš„æ•°æ®æ¸…ç†æŽ‰ï¼Œç„¶åŽæ”¾ä¸Šæœ€æ–°çš„æ•°æ®ã€‚ MemCacheçš„å†…å­˜åˆ†é…chunké‡Œé¢ä¼šæœ‰å†…å­˜æµªè´¹ï¼Œ88å­—èŠ‚çš„valueåˆ†é…åœ¨128å­—èŠ‚ï¼ˆç´§æŽ¥ç€å¤§çš„ç”¨ï¼‰çš„chunkä¸­ï¼Œå°±æŸå¤±äº†30å­—èŠ‚ï¼Œä½†æ˜¯è¿™ä¹Ÿé¿å…äº†ç®¡ç†å†…å­˜ç¢Žç‰‡çš„é—®é¢˜ MemCacheçš„LRUç®—æ³•ä¸æ˜¯é’ˆå¯¹å…¨å±€çš„ï¼Œæ˜¯é’ˆå¯¹slabçš„ è¯¥å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆMemCacheå­˜æ”¾çš„valueå¤§å°æ˜¯é™åˆ¶çš„ï¼Œå› ä¸ºä¸€ä¸ªæ–°æ•°æ®è¿‡æ¥ï¼Œslabä¼šå…ˆä»¥pageä¸ºå•ä½ç”³è¯·ä¸€å—å†…å­˜ï¼Œç”³è¯·çš„å†…å­˜æœ€å¤šå°±åªæœ‰1Mï¼Œæ‰€ä»¥valueå¤§å°è‡ªç„¶ä¸èƒ½å¤§äºŽ1Mäº† æœ€åŽå†æ€»ç»“ä¸€ä¸‹memcache MemCacheä¸­å¯ä»¥ä¿å­˜çš„itemæ•°æ®é‡æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œåªè¦å†…å­˜è¶³å¤Ÿ MemCacheå•è¿›ç¨‹åœ¨32ä½æœºä¸­æœ€å¤§ä½¿ç”¨å†…å­˜ä¸º2Gï¼Œ64ä½æœºåˆ™æ²¡æœ‰é™åˆ¶ Keyæœ€å¤§ä¸º250ä¸ªå­—èŠ‚ï¼Œè¶…è¿‡è¯¥é•¿åº¦æ— æ³•å­˜å‚¨ å•ä¸ªitemæœ€å¤§æ•°æ®æ˜¯1MBï¼Œè¶…è¿‡1MBçš„æ•°æ®ä¸äºˆå­˜å‚¨ MemCacheæœåŠ¡ç«¯æ˜¯ä¸å®‰å…¨çš„ï¼Œæ¯”å¦‚å·²çŸ¥æŸä¸ªMemCacheèŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æŽ¥telnetè¿‡åŽ»ï¼Œå¹¶é€šè¿‡flush_allè®©å·²ç»å­˜åœ¨çš„é”®å€¼å¯¹ç«‹å³å¤±æ•ˆ ä¸èƒ½å¤ŸéåŽ†MemCacheä¸­æ‰€æœ‰çš„itemï¼Œå› ä¸ºè¿™ä¸ªæ“ä½œçš„é€Ÿåº¦ç›¸å¯¹ç¼“æ…¢ä¸”ä¼šé˜»å¡žå…¶ä»–çš„æ“ä½œ MemCacheçš„é«˜æ€§èƒ½æºè‡ªäºŽä¸¤é˜¶æ®µå“ˆå¸Œç»“æž„ï¼šç¬¬ä¸€é˜¶æ®µåœ¨å®¢æˆ·ç«¯ï¼Œé€šè¿‡Hashç®—æ³•æ ¹æ®Keyå€¼ç®—å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼›ç¬¬äºŒé˜¶æ®µåœ¨æœåŠ¡ç«¯ï¼Œé€šè¿‡ä¸€ä¸ªå†…éƒ¨çš„Hashç®—æ³•ï¼ŒæŸ¥æ‰¾çœŸæ­£çš„itemå¹¶è¿”å›žç»™å®¢æˆ·ç«¯ã€‚ä»Žå®žçŽ°çš„è§’åº¦çœ‹ï¼ŒMemCacheæ˜¯ä¸€ä¸ªéžé˜»å¡žçš„ã€åŸºäºŽäº‹ä»¶çš„æœåŠ¡å™¨ç¨‹åº MemCacheè®¾ç½®æ·»åŠ æŸä¸€ä¸ªKeyå€¼çš„æ—¶å€™ï¼Œä¼ å…¥expireä¸º0è¡¨ç¤ºè¿™ä¸ªKeyå€¼æ°¸ä¹…æœ‰æ•ˆï¼Œè¿™ä¸ªKeyå€¼ä¹Ÿä¼šåœ¨30å¤©ä¹‹åŽå¤±æ•ˆ redis redisç‰¹ç‚¹ æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ã€‚ æ”¯æŒæ›´å¤šçš„æ•°æ®ç»“æž„ æ”¯æŒæ•°æ®å¤‡ä»½ æ€§èƒ½æžé«˜ï¼Œè¯»å¯ä»¥è¾¾åˆ°11ä¸‡æ¬¡æ¯ç§’ï¼›å†™è¾¾åˆ°8ä¸‡1åƒæ¬¡æ¯ç§’ redisæ‰€æœ‰æ“ä½œéƒ½æ˜¯åŽŸå­æ€§ï¼Œå¹¶ä¸”æ”¯æŒå‡ ä¸ªæ“ä½œä¸€èµ·çš„åŽŸå­æ€§ æ”¯æŒå‘å¸ƒ-è®¢é˜…åŠŸèƒ½ redisé€‚ç”¨åœºæ™¯ å–æœ€æ–°nä¸ªæ•°æ®ã€æŽ’è¡Œæ¦œ ç²¾å‡†è¿‡æœŸæ—¶é—´ è®¡æ•°å™¨ å”¯ä¸€æ€§æ£€æŸ¥ å®žæ—¶ç³»ç»Ÿã€åžƒåœ¾ç³»ç»Ÿã€ç¼“å­˜ç­‰ redis VS memcache å½“æåˆ°rediså°±é—®memcacheï¼Œå½“æåˆ°memcacheå°±æåˆ°redisï¼Œè¯´æ˜Žè¿™ä¸¤è€…ç”¨çš„éƒ½ååˆ†å¹¿æ³›ï¼Œrediså·ç§°â€œå¼ºåŒ–ç‰ˆmemcachedâ€ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«åˆ°åº•æ˜¯å•¥å‘¢ï¼Ÿ åŸºæœ¬å‘½ä»¤ memcacheæ”¯æŒçš„å‘½ä»¤å¾ˆå°‘ï¼Œå› ä¸ºä»–åªæ”¯æŒStringçš„æ“ä½œï¼Œé€šè®¯åè®®åŒ…æ‹¬æ–‡æœ¬æ ¼å¼å’ŒäºŒè¿›åˆ¶æ ¼å¼ï¼Œç”¨äºŽæ»¡è¶³ç®€å•ç½‘ç»œå®¢æˆ·ç«¯å·¥å…·ï¼ˆå¦‚telnetï¼‰å’Œå¯¹æ€§èƒ½è¦æ±‚æ›´é«˜çš„å®¢æˆ·ç«¯çš„ä¸åŒéœ€æ±‚ï¼›redisæ“ä½œç±»ä¼¼ï¼Œåªæ˜¯æ•°æ®ç»“æž„æ›´å¤æ‚ä»¥æ”¯æŒæ›´å¤šçš„ç‰¹æ€§ï¼Œå¦‚å‘å¸ƒè®¢é˜…ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚redisçš„å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šè®¯åè®®å®Œå…¨é‡‡ç”¨æ–‡æœ¬æ ¼å¼(Redis ClusteræœåŠ¡ç«¯èŠ‚ç‚¹ä¹‹é—´é€šè®¯é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼)ã€‚ äº‹åŠ¡ redisé€šè¿‡multi / watch / execç­‰å‘½ä»¤å¯ä»¥æ”¯æŒäº‹åŠ¡çš„æ¦‚å¿µï¼ŒåŽŸå­æ€§çš„æ‰§è¡Œä¸€æ‰¹å‘½ä»¤; memcache:å³ä½¿åœ¨å¤šçº¿ç¨‹æ¨¡å¼ï¼Œæ‰€æœ‰çš„å‘½ä»¤éƒ½æ˜¯åŽŸå­çš„ï¼›å‘½ä»¤åºåˆ—ä¸æ˜¯åŽŸå­çš„ã€‚åœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ‚¨ä¹Ÿå¯èƒ½è¦†å†™äº†ä¸€ä¸ªè¢«å…¶ä»–è¿›ç¨‹setçš„itemã€‚memcached 1.2.5ä»¥åŠæ›´é«˜ç‰ˆæœ¬ï¼Œæä¾›äº†getså’Œcaså‘½ä»¤ï¼Œå®ƒä»¬å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜ã€‚å¦‚æžœæ‚¨ä½¿ç”¨getså‘½ä»¤æŸ¥è¯¢æŸä¸ªkeyçš„itemï¼Œmemcachedä¼šç»™æ‚¨è¿”å›žè¯¥itemå½“å‰å€¼çš„å”¯ä¸€æ ‡è¯†ã€‚å¦‚æžœæ‚¨è¦†å†™äº†è¿™ä¸ªitemå¹¶æƒ³æŠŠå®ƒå†™å›žåˆ°memcachedä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡caså‘½ä»¤æŠŠé‚£ä¸ªå”¯ä¸€æ ‡è¯†ä¸€èµ·å‘é€ç»™ memcachedã€‚å¦‚æžœè¯¥itemå­˜æ”¾åœ¨memcachedä¸­çš„å”¯ä¸€æ ‡è¯†ä¸Žæ‚¨æä¾›çš„ä¸€è‡´ï¼Œæ‚¨çš„å†™æ“ä½œå°†ä¼šæˆåŠŸã€‚å¦‚æžœå¦ä¸€ä¸ªè¿›ç¨‹åœ¨è¿™æœŸé—´ä¹Ÿä¿®æ”¹äº†è¿™ä¸ª itemï¼Œé‚£ä¹ˆè¯¥itemå­˜æ”¾åœ¨memcachedä¸­çš„å”¯ä¸€æ ‡è¯†å°†ä¼šæ”¹å˜ï¼Œæ‚¨çš„å†™æ“ä½œå°±ä¼šå¤±è´¥ã€‚ æ•°æ®å¤‡ä»½ï¼Œæœ‰æ•ˆæ€§ï¼ŒæŒä¹…åŒ–ç­‰ memcachedä¸ä¿è¯å­˜å‚¨çš„æ•°æ®çš„æœ‰æ•ˆæ€§ï¼Œslabå†…éƒ¨åŸºäºŽLRUä¹Ÿä¼šè‡ªåŠ¨æ·˜æ±°æ—§æ•°æ®;memcachedä¹Ÿä¸åšæ•°æ®çš„æŒä¹…åŒ–å·¥ä½œ; rediså¯ä»¥ä»¥master-slaveçš„æ–¹å¼é…ç½®æœåŠ¡å™¨ï¼ŒslaveèŠ‚ç‚¹å¯¹æ•°æ®è¿›è¡Œreplicaå¤‡ä»½ï¼ŒslaveèŠ‚ç‚¹ä¹Ÿå¯ä»¥å……å½“read onlyçš„èŠ‚ç‚¹åˆ†æ‹…æ•°æ®è¯»å–çš„å·¥ä½œ;rediså†…å»ºæ”¯æŒä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼Œsnapshotå¿«ç…§å’ŒAOFå¢žé‡Logæ–¹å¼ã€‚ æ€§èƒ½ memcachedè‡ªèº«å¹¶ä¸ä¸»åŠ¨å®šæœŸæ£€æŸ¥å’Œæ ‡è®°å“ªäº›æ•°æ®éœ€è¦è¢«æ·˜æ±°ï¼Œåªæœ‰å½“å†æ¬¡è¯»å–ç›¸å…³æ•°æ®æ—¶æ‰æ£€æŸ¥æ—¶é—´æˆ³ï¼Œæˆ–è€…å½“å†…å­˜ä¸å¤Ÿä½¿ç”¨éœ€è¦ä¸»åŠ¨æ·˜æ±°æ•°æ®æ—¶è¿›ä¸€æ­¥æ£€æŸ¥LRUæ•°æ®ã€‚ redisä¸ºäº†å‡å°‘å¤§é‡å°æ•°æ®CMDæ“ä½œçš„ç½‘ç»œé€šè®¯æ—¶é—´å¼€é”€ RTT (Round Trip Time)ï¼Œæ”¯æŒpipelineå’ŒscriptæŠ€æœ¯ã€‚ é›†ç¾¤ memcachedçš„æœåŠ¡å™¨ç«¯äº’ç›¸å®Œå…¨ç‹¬ç«‹ï¼Œå®¢æˆ·ç«¯é€šå¸¸é€šè¿‡å¯¹é”®å€¼åº”ç”¨hashç®—æ³•å†³å®šæ•°æ®çš„åˆ†åŒºï¼Œä¸ºäº†å‡å°‘æœåŠ¡å™¨çš„å¢žå‡å¯¹hashç»“æžœçš„å½±å“ï¼Œå¯¼è‡´å¤§é¢ç§¯çš„ç¼“å­˜å¤±æ•ˆï¼Œå¤šæ•°å®¢æˆ·ç«¯å®žçŽ°äº†ä¸€è‡´æ€§hashç®—æ³•ã€‚ redis3.0å·²ç»æ”¯æŒæœåŠ¡ç«¯é›†ç¾¤äº†ã€‚ æ€§èƒ½å¯¹æ¯” ç”±äºŽredisåªä½¿ç”¨å•æ ¸ï¼Œè€Œmemcachedå¯ä»¥ä½¿ç”¨å¤šæ ¸ï¼Œæ‰€ä»¥å¹³å‡æ¯ä¸€ä¸ªæ ¸ä¸Šredisåœ¨å­˜å‚¨å°æ•°æ®æ—¶æ¯”memcachedæ€§èƒ½æ›´é«˜ã€‚è€Œåœ¨100kä»¥ä¸Šçš„æ•°æ®ä¸­ï¼Œmemcachedæ€§èƒ½è¦é«˜äºŽredisï¼Œè™½ç„¶redisæœ€è¿‘ä¹Ÿåœ¨å­˜å‚¨å¤§æ•°æ®çš„æ€§èƒ½ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯æ¯”èµ·memcachedï¼Œè¿˜æ˜¯ç¨æœ‰é€Šè‰² å†…å­˜ä½¿ç”¨æ•ˆçŽ‡ ä½¿ç”¨ç®€å•çš„key-valueå­˜å‚¨çš„è¯ï¼Œmemcachedçš„å†…å­˜åˆ©ç”¨çŽ‡æ›´é«˜ï¼Œè€Œå¦‚æžœredisé‡‡ç”¨hashç»“æž„æ¥åškey-valueå­˜å‚¨ï¼Œç”±äºŽå…¶ç»„åˆå¼çš„åŽ‹ç¼©ï¼Œå…¶å†…å­˜åˆ©ç”¨çŽ‡ä¼šé«˜äºŽmemcachedã€‚å¦å¤–ï¼Œmemcachedä½¿ç”¨é¢„åˆ†é…çš„å†…å­˜æ± çš„æ–¹å¼ï¼Œå¸¦æ¥ä¸€å®šç¨‹åº¦çš„ç©ºé—´æµªè´¹ å¹¶ä¸”åœ¨å†…å­˜ä»ç„¶æœ‰å¾ˆå¤§ç©ºé—´æ—¶ï¼Œæ–°çš„æ•°æ®ä¹Ÿå¯èƒ½ä¼šè¢«å‰”é™¤ï¼Œè€Œredisä½¿ç”¨çŽ°åœºç”³è¯·å†…å­˜çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®ï¼Œä¸ä¼šå‰”é™¤ä»»ä½•éžä¸´æ—¶æ•°æ® redisæ›´é€‚åˆä½œä¸ºå­˜å‚¨è€Œä¸æ˜¯cacheã€‚ redisæ”¯æŒæœåŠ¡å™¨ç«¯çš„æ•°æ®æ“ä½œ redisç›¸æ¯”memcachedæ¥è¯´ï¼Œæ‹¥æœ‰æ›´å¤šçš„æ•°æ®ç»“æž„å’Œå¹¶æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œï¼Œé€šå¸¸åœ¨memcachedé‡Œï¼Œä½ éœ€è¦å°†æ•°æ®æ‹¿åˆ°å®¢æˆ·ç«¯æ¥è¿›è¡Œç±»ä¼¼çš„ä¿®æ”¹å†setå›žåŽ»ã€‚è¿™å¤§å¤§å¢žåŠ äº†ç½‘ç»œIOçš„æ¬¡æ•°å’Œæ•°æ®ä½“ç§¯ã€‚åœ¨redisä¸­ï¼Œè¿™äº›å¤æ‚çš„æ“ä½œé€šå¸¸å’Œä¸€èˆ¬çš„GET/SETä¸€æ ·é«˜æ•ˆã€‚æ‰€ä»¥ï¼Œå¦‚æžœéœ€è¦ç¼“å­˜èƒ½å¤Ÿæ”¯æŒæ›´å¤æ‚çš„ç»“æž„å’Œæ“ä½œï¼Œé‚£ä¹ˆredisä¼šæ˜¯ä¸é”™çš„é€‰æ‹© ä½•æ—¶åº”è¯¥ä½¿ç”¨memcache: é¦–å…ˆå°±æ˜¯å¯¹å°åž‹é™æ€æ•°æ®è¿›è¡Œç¼“å­˜å¤„ç†ï¼Œæœ€å…·ä»£è¡¨æ€§çš„ä¾‹å­å°±æ˜¯HTMLä»£ç ç‰‡æ®µã€‚è¿™æ˜¯å› ä¸ºmemcachedåœ¨å¤„ç†å…ƒæ•°æ®æ—¶æ‰€æ¶ˆè€—çš„å†…å­˜èµ„æºç›¸å¯¹æ›´å°‘. åœ¨ä»¥å‰ï¼Œredis3.0ç‰ˆæœ¬ä¹‹å‰ï¼Œmemcachedåœ¨æ¨ªå‘æ‰©å±•æ–¹é¢ä¹Ÿæ¯”redisæ›´å…·ä¼˜åŠ¿ã€‚ç”±äºŽå…¶åœ¨è®¾è®¡ä¸Šçš„æ€è·¯å€¾å‘ä»¥åŠç›¸å¯¹æ›´ä¸ºç®€å•çš„åŠŸèƒ½è®¾ç½®ï¼Œmemcachedåœ¨å®žçŽ°æ‰©å±•æ—¶çš„éš¾åº¦æ¯”redisä½Žå¾—å¤šã€‚ ä½•æ—¶åº”è¯¥ä½¿ç”¨redisï¼š å…¶ä»–åœºæ™¯éƒ½å¯ä»¥ç”¨redisæ¥æ›¿æ¢ã€‚ ç›¸æ¯”äºŽæ­¦æ–­çš„LRU(å³æœ€ä½Žè¿‘æœŸä½¿ç”¨é‡)ç®—æ³•ï¼Œrediså…è®¸ç”¨æˆ·æ›´ä¸ºç²¾å‡†åœ°è¿›è¡Œç»†åŒ–æŽ§åˆ¶ï¼Œåˆ©ç”¨å…­ç§ä¸åŒå›žæ”¶ç­–ç•¥ç¡®åˆ‡æé«˜ç¼“å­˜èµ„æºçš„å®žé™…åˆ©ç”¨çŽ‡ã€‚redisè¿˜é‡‡ç”¨æ›´ä¸ºå¤æ‚çš„å†…å­˜ç®¡ç†ä¸Žå›žæ”¶å¯¹è±¡å¤‡é€‰æ–¹æ¡ˆã€‚ memcachedå°†é”®åé™åˆ¶åœ¨250å­—èŠ‚ï¼Œå€¼ä¹Ÿè¢«é™åˆ¶åœ¨ä¸è¶…è¿‡1MBï¼Œä¸”åªé€‚ç”¨äºŽæ™®é€šå­—ç¬¦ä¸²ã€‚redisåˆ™å°†é”®åä¸Žå€¼çš„æœ€å¤§ä¸Šé™å„è‡ªè®¾å®šä¸º512MBï¼Œä¸”æ”¯æŒäºŒè¿›åˆ¶æ ¼å¼ã€‚ å®ƒæ‰€ä¿å­˜çš„æ•°æ®å…·å¤‡é€æ˜ŽåŒ–ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨èƒ½å¤Ÿç›´æŽ¥å¯¹è¿™äº›æ•°æ®è¿›è¡Œæ“ä½œ. redisè¿˜æä¾›å¯é€‰è€Œä¸”èƒ½å¤Ÿå…·ä½“è°ƒæ•´çš„æ•°æ®æŒä¹…æ€§æ–¹æ¡ˆ redisèƒ½å¤Ÿæä¾›å¤åˆ¶åŠŸèƒ½ã€‚å¤åˆ¶åŠŸèƒ½æ—¨åœ¨å¸®åŠ©ç¼“å­˜ä½“ç³»å®žçŽ°é«˜å¯ç”¨æ€§é…ç½®æ–¹æ¡ˆï¼Œä»Žè€Œåœ¨é­é‡æ•…éšœçš„æƒ…å†µä¸‹ç»§ç»­ä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸é—´æ–­çš„ç¼“å­˜æœåŠ¡ã€‚ ä½¿ç”¨redisçš„æ­£ç¡®å§¿åŠ¿ï¼š è¦è¿›è¡Œmaster-slaveé…ç½®ï¼Œå‡ºçŽ°æœåŠ¡æ•…éšœæ—¶å¯ä»¥æ”¯æŒåˆ‡æ¢ã€‚ åœ¨masterä¾§ç¦ç”¨æ•°æ®æŒä¹…åŒ–ï¼Œåªéœ€åœ¨slaveä¸Šé…ç½®æ•°æ®æŒä¹…åŒ–ã€‚ ç‰©ç†å†…å­˜+è™šæ‹Ÿå†…å­˜ä¸è¶³ï¼Œè¿™ä¸ªæ—¶å€™dumpä¸€ç›´æ­»ç€ï¼Œæ—¶é—´ä¹…äº†æœºå™¨æŒ‚æŽ‰ã€‚è¿™ä¸ªæƒ…å†µå°±æ˜¯ç¾éš¾ã€‚ å½“redisç‰©ç†å†…å­˜ä½¿ç”¨è¶…è¿‡å†…å­˜æ€»å®¹é‡çš„3/5æ—¶å°±ä¼šå¼€å§‹æ¯”è¾ƒå±é™©äº†ï¼Œå°±å¼€å§‹åšswap,å†…å­˜ç¢Žç‰‡å¤§ã€‚ å½“è¾¾åˆ°æœ€å¤§å†…å­˜æ—¶ï¼Œä¼šæ¸…ç©ºå¸¦æœ‰è¿‡æœŸæ—¶é—´çš„keyï¼Œå³ä½¿keyæœªåˆ°è¿‡æœŸæ—¶é—´ã€‚ redisä¸ŽDBåŒæ­¥å†™çš„é—®é¢˜ï¼Œå…ˆå†™DBï¼ŒåŽå†™redisï¼Œå› ä¸ºå†™å†…å­˜åŸºæœ¬ä¸Šæ²¡æœ‰é—®é¢˜ã€‚]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisäº‹åŠ¡]]></title>
    <url>%2F2019%2F02%2F02%2Fredis%2FRedis%E4%BA%8B%E5%8A%A1%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬åä¸€ç¯‡æ–‡ç« ã€‚è¯¦ç»†æŽ¢è®¨redisäº‹åŠ¡çš„ç”¨æ³•å’ŒåŽŸç†ã€‚ redis äº‹åŠ¡æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆï¼Œè‡³å°‘æ˜¯ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å‘½ä»¤ï¼Œredis äº‹åŠ¡ä¿è¯è¿™äº›å‘½ä»¤è¢«æ‰§è¡Œæ—¶ä¸­é—´ä¸ä¼šè¢«ä»»ä½•å…¶ä»–æ“ä½œæ‰“æ–­ã€‚ äº‹åŠ¡åŸºæœ¬è®¤è¯† å½“å®¢æˆ·ç«¯å¤„äºŽéžäº‹åŠ¡çŠ¶æ€ä¸‹æ—¶ï¼Œ æ‰€æœ‰å‘é€ç»™æœåŠ¡å™¨ç«¯çš„å‘½ä»¤éƒ½ä¼šç«‹å³è¢«æœåŠ¡å™¨æ‰§è¡Œã€‚ ä½†æ˜¯ï¼Œ å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åŽï¼Œ æœåŠ¡å™¨åœ¨æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤æ—¶ï¼Œ ä¸ä¼šç«‹å³æ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯å°†è¿™äº›å‘½ä»¤å…¨éƒ¨æ”¾è¿›ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—é‡Œï¼Œ ç„¶åŽè¿”å›ž QUEUED ï¼Œ è¡¨ç¤ºå‘½ä»¤å·²å…¥é˜Ÿã€‚ äº‹åŠ¡æ‰§è¡Œ å‰é¢è¯´åˆ°ï¼Œ å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åŽï¼Œ å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤å°±ä¼šè¢«æ”¾è¿›äº‹åŠ¡é˜Ÿåˆ—é‡Œã€‚ ä½†å…¶å®žå¹¶ä¸æ˜¯æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¼šè¢«æ”¾è¿›äº‹åŠ¡é˜Ÿåˆ—ï¼Œ å…¶ä¸­çš„ä¾‹å¤–å°±æ˜¯ EXEC ã€ DISCARD ã€ MULTI å’Œ WATCH è¿™å››ä¸ªå‘½ä»¤ â€”â€” å½“è¿™å››ä¸ªå‘½ä»¤ä»Žå®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œ å®ƒä»¬ä¼šåƒå®¢æˆ·ç«¯å¤„äºŽéžäº‹åŠ¡çŠ¶æ€ä¸€æ ·ï¼Œ ç›´æŽ¥è¢«æœåŠ¡å™¨æ‰§è¡Œï¼š å¦‚æžœå®¢æˆ·ç«¯æ­£å¤„äºŽäº‹åŠ¡çŠ¶æ€ï¼Œ é‚£ä¹ˆå½“ EXEC å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œ æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯æ‰€ä¿å­˜çš„äº‹åŠ¡é˜Ÿåˆ—ï¼Œ ä»¥å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ–¹å¼æ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ï¼š æœ€å…ˆå…¥é˜Ÿçš„å‘½ä»¤æœ€å…ˆæ‰§è¡Œï¼Œ è€Œæœ€åŽå…¥é˜Ÿçš„å‘½ä»¤æœ€åŽæ‰§è¡Œã€‚ äº‹åŠ¡åŸºæœ¬å‘½ä»¤ä»‹ç» é™¤äº† EXEC ä¹‹å¤–ï¼Œ æœåŠ¡å™¨åœ¨å®¢æˆ·ç«¯å¤„äºŽäº‹åŠ¡çŠ¶æ€æ—¶ï¼Œ ä¸åŠ å…¥åˆ°äº‹åŠ¡é˜Ÿåˆ—è€Œç›´æŽ¥æ‰§è¡Œçš„å¦å¤–ä¸‰ä¸ªå‘½ä»¤æ˜¯ DISCARD ã€ MULTI å’Œ WATCH ã€‚ DISCARD å‘½ä»¤ç”¨äºŽå–æ¶ˆä¸€ä¸ªäº‹åŠ¡ï¼Œ å®ƒæ¸…ç©ºå®¢æˆ·ç«¯çš„æ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—ï¼Œ ç„¶åŽå°†å®¢æˆ·ç«¯ä»Žäº‹åŠ¡çŠ¶æ€è°ƒæ•´å›žéžäº‹åŠ¡çŠ¶æ€ï¼Œ æœ€åŽè¿”å›žå­—ç¬¦ä¸² OK ç»™å®¢æˆ·ç«¯ï¼Œ è¯´æ˜Žäº‹åŠ¡å·²è¢«å–æ¶ˆã€‚ Redis çš„äº‹åŠ¡æ˜¯ä¸å¯åµŒå¥—çš„ï¼Œ å½“å®¢æˆ·ç«¯å·²ç»å¤„äºŽäº‹åŠ¡çŠ¶æ€ï¼Œ è€Œå®¢æˆ·ç«¯åˆå†å‘æœåŠ¡å™¨å‘é€ MULTI æ—¶ï¼Œ æœåŠ¡å™¨åªæ˜¯ç®€å•åœ°å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé”™è¯¯ï¼Œ ç„¶åŽç»§ç»­ç­‰å¾…å…¶ä»–å‘½ä»¤çš„å…¥é˜Ÿã€‚ MULTI å‘½ä»¤çš„å‘é€ä¸ä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œ ä¹Ÿä¸ä¼šä¿®æ”¹äº‹åŠ¡é˜Ÿåˆ—ä¸­å·²æœ‰çš„æ•°æ®ã€‚ WATCH åªèƒ½åœ¨å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹å‰æ‰§è¡Œï¼Œ åœ¨äº‹åŠ¡çŠ¶æ€ä¸‹å‘é€ WATCH å‘½ä»¤ä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯ï¼Œ ä½†å®ƒä¸ä¼šé€ æˆæ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œ ä¹Ÿä¸ä¼šä¿®æ”¹äº‹åŠ¡é˜Ÿåˆ—ä¸­å·²æœ‰çš„æ•°æ®ï¼ˆå’Œå‰é¢å¤„ç† MULTI çš„æƒ…å†µä¸€æ ·ï¼‰ã€‚ æ­£å¸¸æƒ…å†µ 123multi//å¼€å¯äº‹åŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤å…ˆä¸æ‰§è¡Œï¼Œå…ˆæš‚æ—¶ä¿å­˜èµ·æ¥set key val//å‘½ä»¤å…¥é˜Ÿexec//æäº¤äº‹åŠ¡ï¼ˆæ‰§è¡Œå‘½ä»¤ï¼‰ å¼‚å¸¸æƒ…å†µ 1234multi//å¼€å¯äº‹åŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤å…ˆä¸æ‰§è¡Œï¼Œå…ˆæš‚æ—¶ä¿å­˜èµ·æ¥set key val//æ­£å¸¸å‘½ä»¤å…¥é˜Ÿset key//é”™è¯¯å‘½ä»¤ï¼Œç›´æŽ¥æŠ¥é”™exec//äº‹åŠ¡è¢«ä¸¢å¼ƒï¼Œæäº¤å¤±è´¥ ä¾‹å¤–æƒ…å†µ 1234multi//å¼€å¯äº‹åŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤å…ˆä¸æ‰§è¡Œï¼Œå…ˆæš‚æ—¶ä¿å­˜èµ·æ¥set key val//æ­£å¸¸å‘½ä»¤å…¥é˜Ÿincr key//è™½ç„¶å­—ç¬¦ä¸²ä¸èƒ½å¢žä¸€ï¼Œä½†æ˜¯ä¸æŠ¥é”™ï¼Œå…¥é˜Ÿexec//è‡ªå¢žä¼šå¤±è´¥ï¼Œä½†æ˜¯keyè¢«è®¾ç½®æˆåŠŸäº†ï¼Œæ•´ä¸ªäº‹åŠ¡æ²¡æœ‰å›žæ»š æ”¾å¼ƒäº‹åŠ¡ 123multi//å¼€å¯äº‹åŠ¡ï¼Œä¸‹é¢çš„å‘½ä»¤å…ˆä¸æ‰§è¡Œï¼Œå…ˆæš‚æ—¶ä¿å­˜èµ·æ¥set key val//æ­£å¸¸å‘½ä»¤å…¥é˜Ÿdiscard ä¹è§‚é” ä¹è§‚é”ï¼šæ¯æ¬¡æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹è¯¥æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰åŽ»æ›´æ–°è¿™æ¡æ•°æ®ï¼Œä¸€èˆ¬ä½¿ç”¨ç‰ˆæœ¬å·è¿›è¡Œåˆ¤æ–­ï¼Œä¹è§‚é”ä½¿ç”¨äºŽè¯»å¤šå†™å°‘çš„åº”ç”¨ç±»åž‹ï¼Œè¿™æ ·å¯ä»¥æé«˜åžåé‡ã€‚ ä¹è§‚é”å¤§å¤šæƒ…å†µæ˜¯æ ¹æ®æ•°æ®ç‰ˆæœ¬å·(version)çš„æœºåˆ¶å®žçŽ°çš„ï¼Œä½•ä¸ºæ•°æ®ç‰ˆæœ¬ï¼Ÿå³ä¸ºæ•°æ®å¢žåŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œåœ¨åŸºäºŽæ•°æ®åº“è¡¨çš„ç‰ˆæœ¬è§£å†³æ–¹æ¡ˆä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“æ·»åŠ ä¸€ä¸ªversionå­—æ®µæ¥å®žçŽ°è¯»å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ­¤ç‰ˆæœ¬å·ä¸€èµ·è¯»å‡ºï¼Œä¹‹åŽæ›´æ–°æ—¶ï¼Œå¯¹æ­¤ç‰ˆæœ¬å·åŠ 1ï¼Œæ­¤æ—¶å°†æäº¤æ•°æ®çš„ç‰ˆæœ¬å·ä¸Žæ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬å·è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æžœæäº¤çš„æ•°æ®ç‰ˆæœ¬å·å¤§äºŽæ•°æ®åº“è¡¨çš„å½“å‰ç‰ˆæœ¬ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ï¼Œä¸äºˆæ›´æ–°ã€‚ A B è¯»å‡ºç‰ˆæœ¬å·ä¸º1ï¼Œæ“ä½œ Aæ“ä½œæ—¶ï¼Œè¯»å‡ºç‰ˆæœ¬å·ä¹Ÿä¸º1ï¼Œè¿›è¡ŒæŸä¸ªæ“ä½œ(ä¿®æ”¹) æ‰§è¡Œä¿®æ”¹ï¼Œversion+1=2ï¼Œå› ä¸º2&gt;1ï¼Œæ‰€ä»¥æ›´æ–° â€¦ â€¦ æ‰§è¡Œä¿®æ”¹ï¼Œversion+1=2ï¼Œå‘çŽ°æ•°æ®åº“è®°å½•çš„ç‰ˆæœ¬ä¹Ÿä¸º2ï¼Œ2=2,æ›´æ–°å¤±è´¥ watchæœºåˆ¶ WATCH å‘½ä»¤ç”¨äºŽåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰ç›‘è§†ä»»æ„æ•°é‡çš„é”®ï¼š å½“è°ƒç”¨ EXEC å‘½ä»¤æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œ å¦‚æžœä»»æ„ä¸€ä¸ªè¢«ç›‘è§†çš„é”®å·²ç»è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹äº†ï¼Œ é‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡ä¸å†æ‰§è¡Œï¼Œ ç›´æŽ¥è¿”å›žå¤±è´¥ã€‚ 123456set k1 1 //è®¾ç½®k1å€¼ä¸º1watch k1 //ç›‘è§†k1(å…¶ä»–å®¢æˆ·ç«¯ä¸èƒ½ä¿®æ”¹k1å€¼)set k1 2 //è®¾ç½®k1å€¼ä¸º2multi //å¼€å§‹äº‹åŠ¡set k1 3 //ä¿®æ”¹k1å€¼ä¸º3exex //æäº¤äº‹åŠ¡ï¼Œk1å€¼ä»ä¸º2ï¼Œå› ä¸ºäº‹åŠ¡å¼€å§‹ä¹‹å‰k1å€¼è¢«ä¿®æ”¹äº† watchæœºåˆ¶ä¸¾ä¾‹ å¤§å®¶å¯èƒ½çŸ¥é“redisæä¾›äº†åŸºäºŽincrå‘½ä»¤æ¥æ“ä½œä¸€ä¸ªæ•´æ•°åž‹æ•°å€¼çš„åŽŸå­é€’å¢žï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡è®¾å¦‚æžœredisæ²¡æœ‰è¿™ä¸ªincrå‘½ä»¤ï¼Œæˆ‘ä»¬è¯¥æ€Žä¹ˆå®žçŽ°è¿™ä¸ªincrçš„æ“ä½œå‘¢ï¼Ÿ æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æƒ³è¦å¯¹ä¸€ä¸ªæ•´å½¢æ•°å€¼åšä¿®æ”¹æ˜¯è¿™ä¹ˆåšçš„(ä¼ªä»£ç å®žçŽ°)ï¼š 123val = GET mykeyval = val + 1SET mykey $val ä½†æ˜¯ä¸Šè¿°çš„ä»£ç ä¼šå‡ºçŽ°ä¸€ä¸ªé—®é¢˜,å› ä¸ºä¸Šé¢å§æ­£å¸¸çš„ä¸€ä¸ªincr(åŽŸå­é€’å¢žæ“ä½œ)åˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†,é‚£ä¹ˆåœ¨å¤šçº¿ç¨‹(åˆ†å¸ƒå¼)çŽ¯å¢ƒä¸­ï¼Œè¿™ä¸ªæ“ä½œå°±æœ‰å¯èƒ½ä¸å†å…·æœ‰åŽŸå­æ€§äº†ã€‚ ç ”ç©¶è¿‡javaçš„jucåŒ…çš„äººåº”è¯¥éƒ½çŸ¥é“casï¼Œé‚£ä¹ˆredisä¹Ÿæä¾›äº†è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ï¼Œå°±æ˜¯åˆ©ç”¨watchå‘½ä»¤æ¥å®žçŽ°çš„ã€‚ å…·ä½“åšæ³•å¦‚ä¸‹: 123456WATCH mykeyval = GET mykeyval = val + 1MULTISET mykey $valEXEC å’Œæ­¤å‰ä»£ç ä¸åŒçš„æ˜¯ï¼Œæ–°ä»£ç åœ¨èŽ·å–mykeyçš„å€¼ä¹‹å‰å…ˆé€šè¿‡WATCHå‘½ä»¤ç›‘æŽ§äº†è¯¥é”®ï¼Œæ­¤åŽåˆå°†setå‘½ä»¤åŒ…å›´åœ¨äº‹åŠ¡ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„ä¿è¯æ¯ä¸ªè¿žæŽ¥åœ¨æ‰§è¡ŒEXECä¹‹å‰ï¼Œå¦‚æžœå½“å‰è¿žæŽ¥èŽ·å–çš„mykeyçš„å€¼è¢«å…¶å®ƒè¿žæŽ¥çš„å®¢æˆ·ç«¯ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“å‰è¿žæŽ¥çš„EXECå‘½ä»¤å°†æ‰§è¡Œå¤±è´¥ã€‚è¿™æ ·è°ƒç”¨è€…åœ¨åˆ¤æ–­è¿”å›žå€¼åŽå°±å¯ä»¥èŽ·æ‚‰valæ˜¯å¦è¢«é‡æ–°è®¾ç½®æˆåŠŸã€‚ ç”±äºŽWATCHå‘½ä»¤çš„ä½œç”¨åªæ˜¯å½“è¢«ç›‘æŽ§çš„é”®å€¼è¢«ä¿®æ”¹åŽé˜»æ­¢ä¹‹åŽä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œï¼Œè€Œä¸èƒ½ä¿è¯å…¶ä»–å®¢æˆ·ç«¯ä¸ä¿®æ”¹è¿™ä¸€é”®å€¼ï¼Œæ‰€ä»¥åœ¨ä¸€èˆ¬çš„æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦åœ¨EXECæ‰§è¡Œå¤±è´¥åŽé‡æ–°æ‰§è¡Œæ•´ä¸ªå‡½æ•°ã€‚ æ‰§è¡ŒEXECå‘½ä»¤åŽä¼šå–æ¶ˆå¯¹æ‰€æœ‰é”®çš„ç›‘æŽ§ï¼Œå¦‚æžœä¸æƒ³æ‰§è¡Œäº‹åŠ¡ä¸­çš„å‘½ä»¤ä¹Ÿå¯ä»¥ä½¿ç”¨UNWATCHå‘½ä»¤æ¥å–æ¶ˆç›‘æŽ§ã€‚ watchæœºåˆ¶åŽŸç† WATCH å‘½ä»¤çš„å®žçŽ° åœ¨æ¯ä¸ªä»£è¡¨æ•°æ®åº“çš„ redis.h/redisDb ç»“æž„ç±»åž‹ä¸­ï¼Œ éƒ½ä¿å­˜äº†ä¸€ä¸ª watched_keys å­—å…¸ï¼Œ å­—å…¸çš„é”®æ˜¯è¿™ä¸ªæ•°æ®åº“è¢«ç›‘è§†çš„é”®ï¼Œ è€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œ é“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰ç›‘è§†è¿™ä¸ªé”®çš„å®¢æˆ·ç«¯ã€‚ æ¯”å¦‚è¯´ï¼Œä»¥ä¸‹å­—å…¸å°±å±•ç¤ºäº†ä¸€ä¸ª watched_keys å­—å…¸çš„ä¾‹å­ï¼š å…¶ä¸­ï¼Œ é”® key1 æ­£åœ¨è¢« client2 ã€ client5 å’Œ client1 ä¸‰ä¸ªå®¢æˆ·ç«¯ç›‘è§†ï¼Œ å…¶ä»–ä¸€äº›é”®ä¹Ÿåˆ†åˆ«è¢«å…¶ä»–åˆ«çš„å®¢æˆ·ç«¯ç›‘è§†ç€ã€‚ WATCH å‘½ä»¤çš„ä½œç”¨ï¼Œ å°±æ˜¯å°†å½“å‰å®¢æˆ·ç«¯å’Œè¦ç›‘è§†çš„é”®åœ¨ watched_keys ä¸­è¿›è¡Œå…³è”ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æžœå½“å‰å®¢æˆ·ç«¯ä¸º client10086 ï¼Œ é‚£ä¹ˆå½“å®¢æˆ·ç«¯æ‰§è¡Œ WATCH key1 key2 æ—¶ï¼Œ å‰é¢å±•ç¤ºçš„ watched_keys å°†è¢«ä¿®æ”¹æˆè¿™ä¸ªæ ·å­ï¼š é€šè¿‡ watched_keys å­—å…¸ï¼Œ å¦‚æžœç¨‹åºæƒ³æ£€æŸ¥æŸä¸ªé”®æ˜¯å¦è¢«ç›‘è§†ï¼Œ é‚£ä¹ˆå®ƒåªè¦æ£€æŸ¥å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªé”®å³å¯ï¼› å¦‚æžœç¨‹åºè¦èŽ·å–ç›‘è§†æŸä¸ªé”®çš„æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œ é‚£ä¹ˆåªè¦å–å‡ºé”®çš„å€¼ï¼ˆä¸€ä¸ªé“¾è¡¨ï¼‰ï¼Œ ç„¶åŽå¯¹é“¾è¡¨è¿›è¡ŒéåŽ†å³å¯ã€‚ WATCH çš„è§¦å‘ åœ¨ä»»ä½•å¯¹æ•°æ®åº“é”®ç©ºé—´ï¼ˆkey spaceï¼‰è¿›è¡Œä¿®æ”¹çš„å‘½ä»¤æˆåŠŸæ‰§è¡Œä¹‹åŽ ï¼ˆæ¯”å¦‚ FLUSHDB ã€ SET ã€ DEL ã€ LPUSH ã€ SADD ã€ ZREM ï¼Œè¯¸å¦‚æ­¤ç±»ï¼‰ï¼Œ multi.c/touchWatchedKey å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ â€”â€” å®ƒæ£€æŸ¥æ•°æ®åº“çš„ watched_keys å­—å…¸ï¼Œ çœ‹æ˜¯å¦æœ‰å®¢æˆ·ç«¯åœ¨ç›‘è§†å·²ç»è¢«å‘½ä»¤ä¿®æ”¹çš„é”®ï¼Œ å¦‚æžœæœ‰çš„è¯ï¼Œ ç¨‹åºå°†æ‰€æœ‰ç›‘è§†è¿™ä¸ª/è¿™äº›è¢«ä¿®æ”¹é”®çš„å®¢æˆ·ç«¯çš„ REDIS_DIRTY_CAS é€‰é¡¹æ‰“å¼€ï¼š å½“å®¢æˆ·ç«¯å‘é€ EXEC å‘½ä»¤ã€è§¦å‘äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œ æœåŠ¡å™¨ä¼šå¯¹å®¢æˆ·ç«¯çš„çŠ¶æ€è¿›è¡Œæ£€æŸ¥ï¼š å¦‚æžœå®¢æˆ·ç«¯çš„ REDIS_DIRTY_CAS é€‰é¡¹å·²ç»è¢«æ‰“å¼€ï¼Œé‚£ä¹ˆè¯´æ˜Žè¢«å®¢æˆ·ç«¯ç›‘è§†çš„é”®è‡³å°‘æœ‰ä¸€ä¸ªå·²ç»è¢«ä¿®æ”¹äº†ï¼Œäº‹åŠ¡çš„å®‰å…¨æ€§å·²ç»è¢«ç ´åã€‚æœåŠ¡å™¨ä¼šæ”¾å¼ƒæ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ï¼Œç›´æŽ¥å‘å®¢æˆ·ç«¯è¿”å›žç©ºå›žå¤ï¼Œè¡¨ç¤ºäº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚ å¦‚æžœ REDIS_DIRTY_CAS é€‰é¡¹æ²¡æœ‰è¢«æ‰“å¼€ï¼Œé‚£ä¹ˆè¯´æ˜Žæ‰€æœ‰ç›‘è§†é”®éƒ½å®‰å…¨ï¼ŒæœåŠ¡å™¨æ­£å¼æ‰§è¡Œäº‹åŠ¡ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ•°æ®åº“çš„ watched_keys å­—å…¸å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æžœæŸä¸ªå®¢æˆ·ç«¯å¯¹ key1 è¿›è¡Œäº†ä¿®æ”¹ï¼ˆæ¯”å¦‚æ‰§è¡Œ DEL key1 ï¼‰ï¼Œ é‚£ä¹ˆæ‰€æœ‰ç›‘è§† key1 çš„å®¢æˆ·ç«¯ï¼Œ åŒ…æ‹¬ client2 ã€ client5 å’Œ client1 çš„ REDIS_DIRTY_CAS é€‰é¡¹éƒ½ä¼šè¢«æ‰“å¼€ï¼Œ å½“å®¢æˆ·ç«¯ client2 ã€ client5 å’Œ client1 æ‰§è¡Œ EXEC çš„æ—¶å€™ï¼Œ å®ƒä»¬çš„äº‹åŠ¡éƒ½ä¼šä»¥å¤±è´¥å‘Šç»ˆã€‚ æœ€åŽï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯ç»“æŸå®ƒçš„äº‹åŠ¡æ—¶ï¼Œæ— è®ºäº‹åŠ¡æ˜¯æˆåŠŸæ‰§è¡Œï¼Œè¿˜æ˜¯å¤±è´¥ï¼Œ watched_keys å­—å…¸ä¸­å’Œè¿™ä¸ªå®¢æˆ·ç«¯ç›¸å…³çš„èµ„æ–™éƒ½ä¼šè¢«æ¸…é™¤ã€‚ äº‹åŠ¡çš„ ACID æ€§è´¨ Redis äº‹åŠ¡ä¿è¯äº†å…¶ä¸­çš„ä¸€è‡´æ€§ï¼ˆå¶å°”ä¹Ÿæœ‰å¯èƒ½ä¸ä¸€è‡´ï¼‰å’Œéš”ç¦»æ€§ï¼Œä½†å¹¶ä¸ä¿è¯åŽŸå­æ€§å’ŒæŒä¹…æ€§ã€‚ åŽŸå­æ€§ï¼ˆAtomicityï¼‰ å•ä¸ª Redis å‘½ä»¤çš„æ‰§è¡Œæ˜¯åŽŸå­æ€§çš„ï¼Œä½† Redis æ²¡æœ‰åœ¨äº‹åŠ¡ä¸Šå¢žåŠ ä»»ä½•ç»´æŒåŽŸå­æ€§çš„æœºåˆ¶ï¼Œæ‰€ä»¥ Redis äº‹åŠ¡çš„æ‰§è¡Œå¹¶ä¸æ˜¯åŽŸå­æ€§çš„ã€‚ å¦‚æžœä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½è¢«æˆåŠŸåœ°æ‰§è¡Œï¼Œé‚£ä¹ˆç§°è¿™ä¸ªäº‹åŠ¡æ‰§è¡ŒæˆåŠŸã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æžœ Redis æœåŠ¡å™¨è¿›ç¨‹åœ¨æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­è¢«åœæ­¢ â€”â€” æ¯”å¦‚æŽ¥åˆ° KILL ä¿¡å·ã€å®¿ä¸»æœºå™¨åœæœºï¼Œç­‰ç­‰ï¼Œé‚£ä¹ˆäº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚ å½“äº‹åŠ¡å¤±è´¥æ—¶ï¼ŒRedis ä¹Ÿä¸ä¼šè¿›è¡Œä»»ä½•çš„é‡è¯•æˆ–è€…å›žæ»šåŠ¨ä½œã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ Redis çš„ä¸€è‡´æ€§é—®é¢˜å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†æ¥è®¨è®ºï¼šå…¥é˜Ÿé”™è¯¯ã€æ‰§è¡Œé”™è¯¯ã€Redis è¿›ç¨‹è¢«ç»ˆç»“ã€‚ å‰é¢ä¸¤è€…ä¸Šé¢å·²ç»è®¨è®ºè¿‡äº†ï¼Œè¿™é‡Œå†é‡å¤ä¸€ä¸‹. å…¥é˜Ÿé”™è¯¯ å…¥é˜Ÿé”™è¯¯ä¸€èˆ¬æ˜¯é”™è¯¯çš„å‘½ä»¤(ä¸è€ƒè™‘èƒ½ä¸èƒ½æ‰§è¡Œï¼Œå‘½ä»¤æœ¬èº«å°±æ˜¯é”™è¯¯çš„)ï¼Œå¸¦æœ‰ä¸æ­£ç¡®å…¥é˜Ÿå‘½ä»¤çš„äº‹åŠ¡ä¸ä¼šè¢«æ‰§è¡Œï¼Œä¹Ÿä¸ä¼šå½±å“æ•°æ®åº“çš„ä¸€è‡´æ€§ï¼› æ‰§è¡Œé”™è¯¯ å¦‚æžœå‘½ä»¤åœ¨äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œæ¯”å¦‚è¯´ï¼Œå¯¹ä¸€ä¸ªä¸åŒç±»åž‹çš„ key æ‰§è¡Œäº†é”™è¯¯çš„æ“ä½œï¼Œ é‚£ä¹ˆ Redis åªä¼šå°†é”™è¯¯åŒ…å«åœ¨äº‹åŠ¡çš„ç»“æžœä¸­ï¼Œ è¿™ä¸ä¼šå¼•èµ·äº‹åŠ¡ä¸­æ–­æˆ–æ•´ä¸ªå¤±è´¥ï¼Œä¸ä¼šå½±å“å·²æ‰§è¡Œäº‹åŠ¡å‘½ä»¤çš„ç»“æžœï¼Œä¹Ÿä¸ä¼šå½±å“åŽé¢è¦æ‰§è¡Œçš„äº‹åŠ¡å‘½ä»¤ï¼Œ æ‰€ä»¥å®ƒå¯¹äº‹åŠ¡çš„ä¸€è‡´æ€§ä¹Ÿæ²¡æœ‰å½±å“ã€‚ Redis è¿›ç¨‹è¢«ç»ˆç»“ å¦‚æžœ Redis æœåŠ¡å™¨è¿›ç¨‹åœ¨æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­è¢«å…¶ä»–è¿›ç¨‹ç»ˆç»“ï¼Œæˆ–è€…è¢«ç®¡ç†å‘˜å¼ºåˆ¶æ€æ­»ï¼Œé‚£ä¹ˆæ ¹æ® Redis æ‰€ä½¿ç”¨çš„æŒä¹…åŒ–æ¨¡å¼ï¼Œå¯èƒ½æœ‰ä»¥ä¸‹æƒ…å†µå‡ºçŽ°ï¼š å†…å­˜æ¨¡å¼ï¼šå¦‚æžœ Redis æ²¡æœ‰é‡‡å–ä»»ä½•æŒä¹…åŒ–æœºåˆ¶ï¼Œé‚£ä¹ˆé‡å¯ä¹‹åŽçš„æ•°æ®åº“æ€»æ˜¯ç©ºç™½çš„ï¼Œæ‰€ä»¥æ•°æ®æ€»æ˜¯ä¸€è‡´çš„ã€‚ RDB æ¨¡å¼ï¼šåœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼ŒRedis ä¸ä¼šä¸­æ–­äº‹åŠ¡åŽ»æ‰§è¡Œä¿å­˜ RDB çš„å·¥ä½œï¼Œåªæœ‰åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹åŽï¼Œä¿å­˜ RDB çš„å·¥ä½œæ‰æœ‰å¯èƒ½å¼€å§‹ã€‚æ‰€ä»¥å½“ RDB æ¨¡å¼ä¸‹çš„ Redis æœåŠ¡å™¨è¿›ç¨‹åœ¨äº‹åŠ¡ä¸­é€”è¢«æ€æ­»æ—¶ï¼Œäº‹åŠ¡å†…æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸ç®¡æˆåŠŸäº†å¤šå°‘ï¼Œéƒ½ä¸ä¼šè¢«ä¿å­˜åˆ° RDB æ–‡ä»¶é‡Œã€‚æ‰€ä»¥æ˜¾ç„¶ä¼šé€ æˆä¸ä¸€è‡´ AOF æ¨¡å¼ï¼šå› ä¸ºä¿å­˜ AOF æ–‡ä»¶çš„å·¥ä½œåœ¨åŽå°çº¿ç¨‹è¿›è¡Œï¼Œæ‰€ä»¥å³ä½¿æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œçš„ä¸­é€”ï¼Œä¿å­˜ AOF æ–‡ä»¶çš„å·¥ä½œä¹Ÿå¯ä»¥ç»§ç»­è¿›è¡Œ,å¦‚æžœäº‹åŠ¡è¯­å¥æœªå†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œé‚£ä¹ˆæ˜¾ç„¶æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºäº‹åŠ¡é‡Œçš„æ“ä½œå…¨éƒ¨å¤±è´¥ï¼›å¦‚æžœäº‹åŠ¡çš„éƒ¨åˆ†è¯­å¥è¢«å†™å…¥åˆ° AOF æ–‡ä»¶ï¼Œå¹¶ä¸” AOF æ–‡ä»¶è¢«æˆåŠŸä¿å­˜ï¼Œé‚£ä¹ˆä¸å®Œæ•´çš„äº‹åŠ¡æ‰§è¡Œä¿¡æ¯å°±ä¼šé—ç•™åœ¨ AOF æ–‡ä»¶é‡Œï¼Œå½“é‡å¯ Redis æ—¶ï¼Œç¨‹åºä¼šæ£€æµ‹åˆ° AOF æ–‡ä»¶å¹¶ä¸å®Œæ•´ï¼ŒRedis ä¼šé€€å‡ºï¼Œå¹¶æŠ¥å‘Šé”™è¯¯ã€‚éœ€è¦ä½¿ç”¨ redis-check-aof å·¥å…·å°†éƒ¨åˆ†æˆåŠŸçš„äº‹åŠ¡å‘½ä»¤ç§»é™¤ä¹‹åŽï¼Œæ‰èƒ½å†æ¬¡å¯åŠ¨æœåŠ¡å™¨ã€‚è¿˜åŽŸä¹‹åŽçš„æ•°æ®æ€»æ˜¯ä¸€è‡´çš„ï¼Œè€Œä¸”æ•°æ®ä¹Ÿæ˜¯æœ€æ–°çš„ï¼ˆç›´åˆ°äº‹åŠ¡æ‰§è¡Œä¹‹å‰ä¸ºæ­¢ï¼‰ã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰ Redis æ˜¯å•è¿›ç¨‹ç¨‹åºï¼Œå¹¶ä¸”å®ƒä¿è¯åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œä¸ä¼šå¯¹äº‹åŠ¡è¿›è¡Œä¸­æ–­ï¼Œäº‹åŠ¡å¯ä»¥è¿è¡Œç›´åˆ°æ‰§è¡Œå®Œæ‰€æœ‰äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒRedis çš„äº‹åŠ¡æ˜¯æ€»æ˜¯å¸¦æœ‰éš”ç¦»æ€§çš„ã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰ åœ¨å•çº¯çš„å†…å­˜æ¨¡å¼ä¸‹ï¼Œäº‹åŠ¡è‚¯å®šæ˜¯ä¸æŒä¹…çš„ã€‚ åœ¨ RDB æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å™¨å¯èƒ½åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹åŽã€RDB æ–‡ä»¶æ›´æ–°ä¹‹å‰çš„è¿™æ®µæ—¶é—´å®•æœºï¼Œæ‰€ä»¥ RDB æ¨¡å¼ä¸‹çš„ Redis äº‹åŠ¡ä¹Ÿæ˜¯ä¸æŒä¹…çš„ã€‚ åœ¨ AOF çš„â€œæ€»æ˜¯ SYNC â€æ¨¡å¼ä¸‹ï¼Œäº‹åŠ¡çš„æ¯æ¡å‘½ä»¤åœ¨æ‰§è¡ŒæˆåŠŸä¹‹åŽï¼Œéƒ½ä¼šç«‹å³è°ƒç”¨ fsync æˆ– fdatasync å°†äº‹åŠ¡æ•°æ®å†™å…¥åˆ° AOF æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™ç§ä¿å­˜æ˜¯ç”±åŽå°çº¿ç¨‹è¿›è¡Œçš„ï¼Œä¸»çº¿ç¨‹ä¸ä¼šé˜»å¡žç›´åˆ°ä¿å­˜æˆåŠŸï¼Œæ‰€ä»¥ä»Žå‘½ä»¤æ‰§è¡ŒæˆåŠŸåˆ°æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¹‹é—´ï¼Œè¿˜æ˜¯æœ‰ä¸€æ®µéžå¸¸å°çš„é—´éš”ï¼ŒæœåŠ¡å™¨ä¹Ÿæœ‰å¯èƒ½å‡ºçŽ°é—®é¢˜ï¼Œæ‰€ä»¥è¿™ç§æ¨¡å¼ä¸‹çš„äº‹åŠ¡ä¹Ÿæ˜¯ä¸æŒä¹…çš„ã€‚ éƒ½æ˜¯ä¸æŒä¹…çš„ã€‚ æ€»ç»“ MULTI å‘½ä»¤çš„æ‰§è¡Œæ ‡è®°ç€äº‹åŠ¡çš„å¼€å§‹ å½“å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹åŽï¼Œ æœåŠ¡å™¨åœ¨æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤æ—¶ï¼Œ ä¸ä¼šç«‹å³æ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯å°†è¿™äº›å‘½ä»¤å…¨éƒ¨æ”¾è¿›ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—é‡Œï¼Œ ç„¶åŽè¿”å›ž QUEUED ï¼Œ è¡¨ç¤ºå‘½ä»¤å·²å…¥é˜Ÿ Redis çš„äº‹åŠ¡ä¿è¯äº† ACID ä¸­çš„ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼ˆå¶å°”ä¹Ÿæœ‰å¯èƒ½ä¸ä¸€è‡´ï¼‰å’Œéš”ç¦»æ€§ï¼ˆIï¼‰ï¼Œä½†å¹¶ä¸ä¿è¯åŽŸå­æ€§ï¼ˆAï¼‰å’ŒæŒä¹…æ€§ï¼ˆDï¼‰ã€‚ ä¸åŠ å…¥åˆ°äº‹åŠ¡é˜Ÿåˆ—è€Œç›´æŽ¥æ‰§è¡Œçš„å››ä¸ªå‘½ä»¤ä¸ºï¼šEXEC ã€ DISCARD ã€ MULTI å’Œ WATCH DISCARD å‘½ä»¤ç”¨äºŽå–æ¶ˆä¸€ä¸ªäº‹åŠ¡ Redis çš„äº‹åŠ¡æ˜¯ä¸å¯åµŒå¥—çš„ WATCH åªèƒ½åœ¨å®¢æˆ·ç«¯è¿›å…¥äº‹åŠ¡çŠ¶æ€ä¹‹å‰æ‰§è¡Œ WATCHæœºåˆ¶çš„åŽŸç† å‚è€ƒï¼š äº‹åŠ¡ redisçš„äº‹åŠ¡å’Œwatch]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisç¼“å­˜æ›´æ–°]]></title>
    <url>%2F2019%2F02%2F02%2Fredis%2FRedis%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬åç¯‡æ–‡ç« ã€‚redisç¼“å­˜æ›´æ–°ç­–ç•¥å­¦ä¹ ã€‚ æ›´æ–°ç¼“å­˜çš„çš„Design Patternæœ‰å››ç§ï¼šCache aside, Read through, Write through, Write behind cachingï¼Œæˆ‘ä»¬ä¸‹é¢ä¸€ä¸€æ¥çœ‹ä¸€ä¸‹è¿™å››ç§Patternã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆä¸è®¨è®ºæ›´æ–°ç¼“å­˜å’Œæ›´æ–°æ•°æ®è¿™ä¸¤ä¸ªäº‹æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„äº‹ï¼Œæˆ–æ˜¯ä¼šæœ‰å¤±è´¥çš„å¯èƒ½ï¼Œæˆ‘ä»¬å…ˆå‡è®¾æ›´æ–°æ•°æ®åº“å’Œæ›´æ–°ç¼“å­˜éƒ½å¯ä»¥æˆåŠŸçš„æƒ…å†µï¼ˆæˆ‘ä»¬å…ˆæŠŠæˆåŠŸçš„ä»£ç é€»è¾‘å…ˆå†™å¯¹ï¼‰ã€‚ å…ˆæ¥çœ‹çœ‹ç¼“å­˜å¯èƒ½å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œç›®çš„æ˜¯çªå‡ºç¼“å­˜ä½¿ç”¨ç­–ç•¥é€‰æ‹©çš„é‡è¦æ€§ã€‚ 1.ç¼“å­˜ç©¿é€ ç¼“å­˜ç©¿é€æ˜¯è¯´è®¿é—®ä¸€ä¸ªç¼“å­˜ä¸­æ²¡æœ‰çš„æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ªæ•°æ®æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ã€‚ è§£å†³æ–¹æ¡ˆæ˜¯ï¼š ç¼“å­˜ç©ºå¯¹è±¡ã€‚å¦‚æžœç¼“å­˜æœªå‘½ä¸­ï¼Œè€Œæ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰è¿™ä¸ªå¯¹è±¡ï¼Œåˆ™å¯ä»¥ç¼“å­˜ä¸€ä¸ªç©ºå¯¹è±¡åˆ°ç¼“å­˜ã€‚å¦‚æžœä½¿ç”¨Redisï¼Œè¿™ç§keyéœ€è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„æ—¶é—´ï¼Œä»¥é˜²å†…å­˜æµªè´¹ã€‚ ç¼“å­˜é¢„æµ‹ã€‚é¢„æµ‹keyæ˜¯å¦å­˜åœ¨ã€‚å¦‚æžœç¼“å­˜çš„é‡ä¸å¤§å¯ä»¥ä½¿ç”¨hashæ¥åˆ¤æ–­ï¼Œå¦‚æžœé‡å¤§å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥åšåˆ¤æ–­ã€‚é‡‡ç”¨å¸ƒéš†ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„BitSetä¸­ï¼Œä¸å­˜åœ¨çš„æ•°æ®å°†ä¼šè¢«æ‹¦æˆªæŽ‰ï¼Œä»Žè€Œé¿å…äº†å¯¹å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢åŽ‹åŠ›ã€‚ 2.ç¼“å­˜å¹¶å‘ å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®ä¸€ä¸ªæ²¡æœ‰åœ¨cacheä¸­çš„æ•°æ®ï¼Œè¿™æ—¶æ¯ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šæ‰§è¡Œä»ŽDBåŠ è½½æ•°æ®setåˆ°ç¼“å­˜ï¼Œå°±ä¼šé€ æˆç¼“å­˜å¹¶å‘ã€‚ ç¼“å­˜é¢„çƒ­ã€‚æå‰æŠŠæ‰€æœ‰é¢„æœŸçš„çƒ­æ•°æ®åŠ åˆ°ç¼“å­˜ã€‚å®šä½çƒ­æ•°æ®è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„äº‹æƒ…ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„æœåŠ¡è®¿é—®æƒ…å†µåŽ»è¯„ä¼°ã€‚è¿™ä¸ªæ–¹æ¡ˆåªèƒ½å‡è½»ç¼“å­˜å¹¶å‘çš„å‘ç”Ÿæ¬¡æ•°ä¸èƒ½å…¨éƒ¨æŠµåˆ¶ã€‚ ç¼“å­˜åŠ é”ã€‚ å¦‚æžœå¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ä¸å­˜åœ¨çš„ç¼“å­˜æ—¶ï¼Œåœ¨æ‰§è¡ŒåŠ è½½æ•°æ®å¹¶setç¼“å­˜è¿™ä¸ªé€»è¾‘ä¹‹å‰å…ˆåŠ é”ï¼Œåªèƒ½è®©ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œè¿™æ®µé€»è¾‘ã€‚ 3.ç¼“å­˜é›ªå´© ç¼“å­˜é›ªå´©æ˜¯ç¼“å­˜æœåŠ¡æš‚æ—¶ä¸èƒ½æä¾›æœåŠ¡ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½ç›´æŽ¥è®¿é—®DBã€‚ è§£å†³æ–¹æ¡ˆï¼š æž„å»ºé«˜å¯ç”¨çš„ç¼“å­˜ç³»ç»Ÿã€‚ç›®å‰å¸¸ç”¨çš„ç¼“å­˜ç³»ç»ŸRediså’ŒMemcacheéƒ½æ”¯æŒé«˜å¯ç”¨çš„éƒ¨ç½²æ–¹å¼ï¼Œæ‰€ä»¥éƒ¨ç½²çš„æ—¶å€™ä¸é˜²å…ˆè€ƒè™‘æ˜¯å¦è¦ä»¥é«˜å¯ç”¨çš„é›†ç¾¤æ–¹å¼éƒ¨ç½²ã€‚ é™æµã€‚Netflixçš„Hystrixæ˜¯éžå¸¸ä¸é”™çš„å·¥å…·ï¼Œåœ¨ç”¨ç¼“å­˜æ—¶ä¸å¦¨æ­é…å®ƒæ¥ä½¿ç”¨ã€‚ 4.Cache Aside Pattern ä¸€ç§é”™è¯¯çš„åšæ³•æ˜¯ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œç„¶åŽå†æ›´æ–°æ•°æ®åº“ï¼Œè€ŒåŽç»­çš„æ“ä½œä¼šæŠŠæ•°æ®å†è£…è½½çš„ç¼“å­˜ä¸­ã€‚è¯•æƒ³ï¼Œä¸¤ä¸ªå¹¶å‘æ“ä½œï¼Œä¸€ä¸ªæ˜¯æ›´æ–°æ“ä½œï¼Œå¦ä¸€ä¸ªæ˜¯æŸ¥è¯¢æ“ä½œï¼Œæ›´æ–°æ“ä½œåˆ é™¤ç¼“å­˜åŽï¼ŒæŸ¥è¯¢æ“ä½œæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œå…ˆæŠŠè€æ•°æ®è¯»å‡ºæ¥åŽæ”¾åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åŽæ›´æ–°æ“ä½œæ›´æ–°äº†æ•°æ®åº“ã€‚äºŽæ˜¯ï¼Œåœ¨ç¼“å­˜ä¸­çš„æ•°æ®è¿˜æ˜¯è€çš„æ•°æ®ï¼Œå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®æ˜¯è„çš„ï¼Œç›´åˆ°è¿™ä¸ªç¼“å­˜å¤±æ•ˆä¸ºæ­¢ã€‚ Cache Aside Patternæ˜¯æœ€å¸¸ç”¨æœ€å¸¸ç”¨çš„patternäº†ã€‚å…¶å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä»Žcacheå–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™ä»Žæ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåŽï¼Œæ”¾åˆ°ç¼“å­˜ä¸­ã€‚ å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä»Žcacheä¸­å–æ•°æ®ï¼Œå–åˆ°åŽè¿”å›žã€‚ æ›´æ–°ï¼šå…ˆæŠŠæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒæˆåŠŸåŽï¼Œå†è®©ç¼“å­˜å¤±æ•ˆã€‚ æ³¨æ„ï¼Œæˆ‘ä»¬çš„æ›´æ–°æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼ŒæˆåŠŸåŽï¼Œè®©ç¼“å­˜å¤±æ•ˆã€‚é‚£ä¹ˆï¼Œè¿™ç§æ–¹å¼æ˜¯å¦å¯ä»¥æ²¡æœ‰æ–‡ç« å‰é¢æåˆ°è¿‡çš„é‚£ä¸ªé—®é¢˜å‘¢ï¼Ÿ ä¸€ä¸ªæ˜¯æŸ¥è¯¢æ“ä½œï¼Œä¸€ä¸ªæ˜¯æ›´æ–°æ“ä½œçš„å¹¶å‘ï¼Œé¦–å…ˆï¼Œæ²¡æœ‰äº†åˆ é™¤cacheæ•°æ®çš„æ“ä½œäº†ï¼Œè€Œæ˜¯å…ˆæ›´æ–°äº†æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæ­¤æ—¶ï¼Œç¼“å­˜ä¾ç„¶æœ‰æ•ˆï¼Œæ‰€ä»¥ï¼Œå¹¶å‘çš„æŸ¥è¯¢æ“ä½œæ‹¿çš„æ˜¯æ²¡æœ‰æ›´æ–°çš„æ•°æ®ï¼Œä½†æ˜¯ï¼Œæ›´æ–°æ“ä½œé©¬ä¸Šè®©ç¼“å­˜çš„å¤±æ•ˆäº†ï¼ŒåŽç»­çš„æŸ¥è¯¢æ“ä½œå†æŠŠæ•°æ®ä»Žæ•°æ®åº“ä¸­æ‹‰å‡ºæ¥ã€‚è€Œä¸ä¼šåƒæ–‡ç« å¼€å¤´çš„é‚£ä¸ªé€»è¾‘äº§ç”Ÿçš„é—®é¢˜ï¼ŒåŽç»­çš„æŸ¥è¯¢æ“ä½œä¸€ç›´éƒ½åœ¨å–è€çš„æ•°æ®ã€‚ ä½†è¿˜æ˜¯å­˜åœ¨é—®é¢˜çš„ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæ˜¯è¯»æ“ä½œï¼Œä½†æ˜¯æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œç„¶åŽå°±åˆ°æ•°æ®åº“ä¸­å–æ•°æ®ï¼Œæ­¤æ—¶æ¥äº†ä¸€ä¸ªå†™æ“ä½œï¼Œå†™å®Œæ•°æ®åº“åŽï¼Œè®©ç¼“å­˜å¤±æ•ˆï¼Œç„¶åŽï¼Œä¹‹å‰çš„é‚£ä¸ªè¯»æ“ä½œå†æŠŠè€çš„æ•°æ®æ”¾è¿›åŽ»ï¼Œæ‰€ä»¥ï¼Œä¼šé€ æˆè„æ•°æ®ã€‚ä¸è¿‡ï¼Œå®žé™…ä¸Šå‡ºçŽ°çš„æ¦‚çŽ‡å¯èƒ½éžå¸¸ä½Ž. æ‰€ä»¥ï¼Œè¿™ä¹Ÿå°±æ˜¯Quoraä¸Šçš„é‚£ä¸ªç­”æ¡ˆé‡Œè¯´çš„ï¼Œè¦ä¹ˆé€šè¿‡2PCæˆ–æ˜¯Paxosåè®®ä¿è¯ä¸€è‡´æ€§ï¼Œè¦ä¹ˆå°±æ˜¯æ‹¼å‘½çš„é™ä½Žå¹¶å‘æ—¶è„æ•°æ®çš„æ¦‚çŽ‡ï¼Œè€ŒFacebookä½¿ç”¨äº†è¿™ä¸ªé™ä½Žæ¦‚çŽ‡çš„çŽ©æ³•ï¼Œå› ä¸º2PCå¤ªæ…¢ï¼Œè€ŒPaxoså¤ªå¤æ‚ã€‚å½“ç„¶ï¼Œæœ€å¥½è¿˜æ˜¯ä¸ºç¼“å­˜è®¾ç½®ä¸Šè¿‡æœŸæ—¶é—´ã€‚ 5.Read/Write Through Pattern Read Throughï¼šè¯»å–æ•°æ®çš„æ—¶å€™å¦‚æžœå½“å‰ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œæƒ¯å¸¸çš„æ“ä½œéƒ½æ˜¯åº”ç”¨ç¨‹åºåŽ»DBåŠ è½½æ•°æ®ï¼Œç„¶åŽåŠ å…¥åˆ°ç¼“å­˜ä¸­ã€‚Read Throughä¸Žä¹‹ä¸åŒçš„æ˜¯æˆ‘ä»¬ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºè‡ªå·±åŠ è½½æ•°æ®äº†ï¼Œç¼“å­˜å±‚ä¼šå¸®å¿™åšä»¶äº‹ã€‚ Write Throughï¼šæ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æžœå‘½ä¸­ç¼“å­˜ï¼Œåˆ™å…ˆæ›´æ–°ç¼“å­˜ç„¶åŽç¼“å­˜åœ¨è´Ÿè´£æŠŠæ•°æ®æ›´æ–°åˆ°æ•°æ®åº“ï¼›å¦‚æžœæ²¡æœ‰å‘½ä¸­ç¼“å­˜åˆ™ç›´æŽ¥æ›´æ–°æ•°æ®åº“ã€‚ è¿™ç§æ–¹å¼ç¼“å­˜å±‚ç›´æŽ¥å±è”½äº†DBï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦æ›´ç¼“å­˜æ‰“äº¤é“ã€‚ä¼˜ç‚¹æ˜¯åº”ç”¨é€»è¾‘ç®€å•äº†ï¼Œè€Œä¸”æ›´é«˜æ•ˆäº†ï¼›ç¼ºç‚¹æ˜¯ç¼“å­˜å±‚çš„å®žçŽ°ç›¸å¯¹å¤æ‚ä¸€äº›ã€‚ 6.Write Back Pattern Write Backå¥—è·¯ï¼Œä¸€å¥è¯´å°±æ˜¯ï¼Œåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªæ›´æ–°ç¼“å­˜ï¼Œä¸æ›´æ–°æ•°æ®åº“ï¼Œè€Œæˆ‘ä»¬çš„ç¼“å­˜ä¼šå¼‚æ­¥åœ°æ‰¹é‡æ›´æ–°æ•°æ®åº“ã€‚è¿™ä¸ªè®¾è®¡çš„å¥½å¤„å°±æ˜¯è®©æ•°æ®çš„I/Oæ“ä½œé£žå¿«æ— æ¯”ï¼ˆå› ä¸ºç›´æŽ¥æ“ä½œå†…å­˜å˜› ï¼‰ï¼Œå› ä¸ºå¼‚æ­¥ï¼Œwrite backgè¿˜å¯ä»¥åˆå¹¶å¯¹åŒä¸€ä¸ªæ•°æ®çš„å¤šæ¬¡æ“ä½œï¼Œæ‰€ä»¥æ€§èƒ½çš„æé«˜æ˜¯ç›¸å½“å¯è§‚çš„ã€‚ ä½†æ˜¯ï¼Œå…¶å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œæ•°æ®ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œè€Œä¸”å¯èƒ½ä¼šä¸¢å¤±ï¼ˆæˆ‘ä»¬çŸ¥é“Unix/Linuxéžæ­£å¸¸å…³æœºä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªäº‹ï¼‰ã€‚åœ¨è½¯ä»¶è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šä¸å¯èƒ½åšå‡ºä¸€ä¸ªæ²¡æœ‰ç¼ºé™·çš„è®¾è®¡ï¼Œå°±åƒç®—æ³•è®¾è®¡ä¸­çš„æ—¶é—´æ¢ç©ºé—´ï¼Œç©ºé—´æ¢æ—¶é—´ä¸€ä¸ªé“ç†ï¼Œæœ‰æ—¶å€™ï¼Œå¼ºä¸€è‡´æ€§å’Œé«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨å’Œé«˜æ€§æ€§æ˜¯æœ‰å†²çªçš„ã€‚ å¦å¤–ï¼ŒWrite Backå®žçŽ°é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºä»–éœ€è¦trackæœ‰å“ªæ•°æ®æ˜¯è¢«æ›´æ–°äº†çš„ï¼Œéœ€è¦åˆ·åˆ°æŒä¹…å±‚ä¸Šã€‚æ“ä½œç³»ç»Ÿçš„write backä¼šåœ¨ä»…å½“è¿™ä¸ªcacheéœ€è¦å¤±æ•ˆçš„æ—¶å€™ï¼Œæ‰ä¼šè¢«çœŸæ­£æŒä¹…èµ·æ¥ï¼Œæ¯”å¦‚ï¼Œå†…å­˜ä¸å¤Ÿäº†ï¼Œæˆ–æ˜¯è¿›ç¨‹é€€å‡ºäº†ç­‰æƒ…å†µï¼Œè¿™åˆå«lazy writeã€‚ 7.å®žé™…ä½¿ç”¨çš„ä¸€äº›ç­–ç•¥ ä¸šåŠ¡æ–¹ï¼ˆè°ƒç”¨è€…ï¼‰æ›´æ–° ä¼ ç»Ÿä¸Šï¼Œæ›´æ–°ç¼“å­˜éƒ½æ˜¯ç”±ä¸šåŠ¡æ–¹æ¥åšï¼Œä¹Ÿå°±æ˜¯ç”±è°ƒç”¨è€…è´Ÿè´£æ›´æ–°DBå’Œç¼“å­˜ã€‚ DBä¸­é—´ä»¶ç›‘å¬DBå˜åŒ–ï¼Œæ›´æ–°ç¼“å­˜ çŽ°åœ¨æœ‰ç§æ–°çš„åŠžæ³•å°±æ˜¯åˆ©ç”¨DBä¸­é—´ä»¶ç›‘å¬DBå˜åŒ–ï¼ˆæ¯”å¦‚é˜¿é‡Œçš„Canalä¸­é—´ä»¶ï¼Œç‚¹è¯„çš„Pumaï¼‰ï¼Œä»Žè€Œå¯¹ç¼“å­˜è¿›è¡Œæ›´æ–°ã€‚ è¿™ç§åŠžæ³•çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼šæŠŠç¼“å­˜çš„æ›´æ–°é€»è¾‘ï¼Œå’Œä¸šåŠ¡é€»è¾‘è§£è—•ã€‚ä¸šåŠ¡åªæ›´æ–°DBï¼Œç¼“å­˜çš„æ›´æ–°è¢«æ”¾åœ¨å¦å¤–ä¸€ä¸ªä¸“é—¨çš„ç³»ç»Ÿé‡Œé¢ã€‚ 8.æ€»ç»“ ä¸€å¥è¯ï¼Œæ— è®ºè°å…ˆè°åŽï¼Œåªè¦æ›´æ–°ç¼“å­˜å’Œæ›´æ–°DBä¸æ˜¯åŽŸå­çš„ï¼Œå°±å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´ã€‚ æ€»ä¹‹ï¼Œåªæ˜¯ä»Žå®žé™…ä¸šåŠ¡æ¥è®²ï¼Œä¸€èˆ¬ç¼“å­˜ä¹Ÿéƒ½æ˜¯ä¿æŒâ€œæœ€ç»ˆä¸€è‡´æ€§â€œï¼Œè€Œä¸æ˜¯å’ŒDBçš„å¼ºä¸€è‡´æ€§ã€‚ å¹¶ä¸”ä¸€èˆ¬å»ºè®®å…ˆæ›´æ–°DBï¼Œå†æ›´æ–°ç¼“å­˜ï¼Œä¼˜å…ˆä¿è¯DBæ•°æ®æ­£ç¡®ã€‚ 9.ä¸€è‡´æ€§é—®é¢˜ ä¸Šé¢ï¼Œæˆ‘ä»¬æ²¡æœ‰è€ƒè™‘ç¼“å­˜ï¼ˆCacheï¼‰å’ŒæŒä¹…å±‚ï¼ˆRepositoryï¼‰çš„æ•´ä½“äº‹åŠ¡çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæ›´æ–°CacheæˆåŠŸï¼Œæ›´æ–°æ•°æ®åº“å¤±è´¥äº†æ€Žä¹ˆå—ï¼Ÿæˆ–æ˜¯åè¿‡æ¥ã€‚å…³äºŽè¿™ä¸ªäº‹ï¼Œå¦‚æžœä½ éœ€è¦å¼ºä¸€è‡´æ€§ï¼Œä½ éœ€è¦ä½¿ç”¨â€œä¸¤é˜¶æ®µæäº¤åè®®â€â€”â€”prepare, commit/rollback.åŽç»­å†æŽ¢è®¨ã€‚ å‚è€ƒ1ï¼šhttps://coolshell.cn/articles/17416.html å‚è€ƒ2ï¼šhttps://www.jianshu.com/p/3c111e4719b8 å‚è€ƒ3ï¼šç¼“å­˜æ›´æ–°ç­–ç•¥/ç¼“å­˜ç©¿é€/ç¼“å­˜é›ªå´©]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisç¼“å­˜è®¾è®¡ä¸Žä¼˜åŒ–]]></title>
    <url>%2F2019%2F02%2F01%2Fredis%2F%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E4%B8%8E%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬ä¹ç¯‡æ–‡ç« ã€‚ä»‹ç»redisç¼“å­˜ä¸­ ä¸€äº›é‡è¦çš„é—®é¢˜ã€‚ 1. ç¼“å­˜æ”¶ç›Šå’Œæˆæœ¬ 1.1 æ”¶ç›Š åŠ é€Ÿè¯»å†™ é™ä½ŽåŽç«¯è´Ÿè½½(é™ä½Žmysqlè´Ÿè½½) 1.2 æˆæœ¬ æ•°æ®ä¸ä¸€è‡´ï¼šç¼“å­˜å±‚å’Œæ•°æ®å±‚æœ‰æ—¶é—´çª—å£ä¸ä¸€è‡´ï¼Œå’Œæ›´æ–°ç­–ç•¥æœ‰å…³ ä»£ç ç»´æŠ¤æˆæœ¬ï¼šå¤šäº†ä¸€å±‚ç¼“å­˜é€»è¾‘ è¿ç»´æˆæœ¬ï¼šä¾‹å¦‚redis cluster 1.3 ä½¿ç”¨åœºæ™¯ é™ä½ŽåŽç«¯è´Ÿè½½ï¼šå¯¹äºŽé«˜æ¶ˆè€—çš„SQLï¼šjoinç»“æžœé›†ã€åˆ†ç»„ç»Ÿè®¡ç»“æžœï¼›å¯¹è¿™äº›ç»“æžœè¿›è¡Œç¼“å­˜ã€‚ åŠ é€Ÿè¯·æ±‚å“åº” å¤§é‡å†™åˆå¹¶ä¸ºæ‰¹é‡å†™ï¼šå¦‚è®¡æ•°å™¨å…ˆredisç´¯åŠ å†æ‰¹é‡å†™å…¥DB 2. ç¼“å­˜çš„æ›´æ–°ç­–ç•¥ LRU/LFU/FIFOç®—æ³•å‰”é™¤ï¼šä¾‹å¦‚maxmemory-policy FIFO(first in first out) å…ˆè¿›å…ˆå‡ºç­–ç•¥ï¼Œæœ€å…ˆè¿›å…¥ç¼“å­˜çš„æ•°æ®åœ¨ç¼“å­˜ç©ºé—´ä¸å¤Ÿçš„æƒ…å†µä¸‹ï¼ˆè¶…å‡ºæœ€å¤§å…ƒç´ é™åˆ¶ï¼‰ä¼šè¢«ä¼˜å…ˆè¢«æ¸…é™¤æŽ‰ï¼Œä»¥è…¾å‡ºæ–°çš„ç©ºé—´æŽ¥å—æ–°çš„æ•°æ®ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒç¼“å­˜å…ƒç´ çš„åˆ›å»ºæ—¶é—´ã€‚åœ¨æ•°æ®å®žæ•ˆæ€§è¦æ±‚åœºæ™¯ä¸‹å¯é€‰æ‹©è¯¥ç±»ç­–ç•¥ï¼Œä¼˜å…ˆä¿éšœæœ€æ–°æ•°æ®å¯ç”¨ã€‚ LFU(less frequently used) æœ€å°‘ä½¿ç”¨ç­–ç•¥ï¼Œæ— è®ºæ˜¯å¦è¿‡æœŸï¼Œæ ¹æ®å…ƒç´ çš„è¢«ä½¿ç”¨æ¬¡æ•°åˆ¤æ–­ï¼Œæ¸…é™¤ä½¿ç”¨æ¬¡æ•°è¾ƒå°‘çš„å…ƒç´ é‡Šæ”¾ç©ºé—´ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒå…ƒç´ çš„hitCountï¼ˆå‘½ä¸­æ¬¡æ•°ï¼‰ã€‚åœ¨ä¿è¯é«˜é¢‘æ•°æ®æœ‰æ•ˆæ€§åœºæ™¯ä¸‹ï¼Œå¯é€‰æ‹©è¿™ç±»ç­–ç•¥ã€‚ LRU(least recently used) æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥ï¼Œæ— è®ºæ˜¯å¦è¿‡æœŸï¼Œæ ¹æ®å…ƒç´ æœ€åŽä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶é—´æˆ³ï¼Œæ¸…é™¤æœ€è¿œä½¿ç”¨æ—¶é—´æˆ³çš„å…ƒç´ é‡Šæ”¾ç©ºé—´ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒå…ƒç´ æœ€è¿‘ä¸€æ¬¡è¢«getä½¿ç”¨æ—¶é—´ã€‚åœ¨çƒ­ç‚¹æ•°æ®åœºæ™¯ä¸‹è¾ƒé€‚ç”¨ï¼Œä¼˜å…ˆä¿è¯çƒ­ç‚¹æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚ è¶…æ—¶å‰”é™¤ï¼šä¾‹å¦‚expire ä¸»åŠ¨æ›´æ–°ï¼šå¼€å‘æŽ§åˆ¶ç”Ÿå‘½å‘¨æœŸï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼Œæ—¶é—´é—´éš”æ¯”è¾ƒçŸ­ï¼‰ ä½Žä¸€è‡´æ€§ï¼šæœ€å¤§å†…å­˜å’Œæ·˜æ±°ç­–ç•¥ é«˜ä¸€è‡´æ€§ï¼šè¶…æ—¶å‰”é™¤å’Œä¸»åŠ¨æ›´æ–°ç»“åˆï¼Œæœ€å¤§å†…å­˜å’Œæ·˜æ±°ç­–ç•¥å…œåº•ã€‚ 3. ç¼“å­˜ç²’åº¦æŽ§åˆ¶ 3.1 ç¼“å­˜ç²’åº¦æŽ§åˆ¶ä¸‰ä¸ªè§’åº¦ é€šç”¨æ€§ï¼šå…¨é‡å±žæ€§æ›´å¥½(æ·»åŠ åˆ é™¤å±žæ€§ä¸éœ€è¦æ”¹ä¸œè¥¿) å ç”¨ç©ºé—´ï¼šéƒ¨åˆ†å±žæ€§æ›´å¥½ ä»£ç ç»´æŠ¤ï¼šè¡¨é¢ä¸Šå…¨é‡å±žæ€§æ›´å¥½(æ·»åŠ åˆ é™¤å±žæ€§ä¸éœ€è¦æ”¹ä¸œè¥¿) 4. ç¼“å­˜ç©¿é€ä¼˜åŒ– 4.1 å®šä¹‰ å¤§é‡è¯·æ±‚ä¸å‘½ä¸­,ç¼“å­˜å·²ç»æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ï¼š 4.2 äº§ç”ŸåŽŸå›  ä¸šåŠ¡ä»£ç è‡ªèº«é—®é¢˜ æ¶æ„æ”»å‡»ã€çˆ¬è™«ç­‰ 4.3 å¦‚ä½•å‘çŽ° ä¸šåŠ¡å“åº”æ—¶é—´ ä¸šåŠ¡æœ¬èº«é—®é¢˜ ç›¸å…³æŒ‡æ ‡ï¼šæ€»è°ƒç”¨æ•°ã€ç¼“å­˜å±‚å‘½ä¸­æ•°ã€å­˜å‚¨å±‚å‘½ä¸­æ•° 4.4 è§£å†³æ–¹æ¡ˆ æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºå¯¹è±¡ å­˜åœ¨çš„é—®é¢˜ éœ€è¦æ›´å¤šçš„é”®:æ¶æ„æ”»å‡»ã€çˆ¬è™«ä¼šæœ‰å¾ˆå¤šä¹±ä¸ƒå…«ç³Ÿçš„é”®ï¼Œå½“é‡å¾ˆå¤§æ—¶ï¼Œä¼šæœ‰é£Žé™©ï¼Œæ‰€ä»¥ä¼šå¯¹è¿™ç§ç©ºå¯¹è±¡è®¾ç½®ç¼“å­˜æ—¶é—´æŽ§åˆ¶é£Žé™© ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚æ•°æ®â€œçŸ­æœŸâ€ä¸ä¸€è‡´ï¼šç¼“å­˜äº†ç©ºå¯¹è±¡ï¼Œä½†æ˜¯å½“ä¸šåŠ¡æ¢å¤äº†ï¼ŒçœŸå®žæ•°æ®åˆå­˜åœ¨äºŽDBä¸­äº†ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªç©ºå¯¹è±¡è¿‡æœŸæ—¶é—´å†…ï¼Œå–åˆ°çš„ä»ç„¶æ˜¯ç©ºå¯¹è±¡ï¼Œé€ æˆçŸ­æœŸå†…æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚è§£å†³ï¼šå¯ä»¥è®¢é˜…æ¶ˆæ¯ï¼Œå½“æ¢å¤æ­£å¸¸åŽæŽ¥å—åˆ°æ¶ˆæ¯ï¼Œç„¶åŽåˆ·æ–°ç¼“å­˜ã€‚ æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆª ä»€ä¹ˆæ˜¯Bloom Filterï¼Ÿ å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„, â€œa space-efficient probabilistic data structureâ€ã€‚å®ƒå®žé™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶çŸ¢é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºŽæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆçŽ‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«çŽ‡å’Œåˆ é™¤å›°éš¾ã€‚ å¦‚æžœæƒ³åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªé›†åˆé‡Œï¼Œä¸€èˆ¬æƒ³åˆ°çš„æ˜¯å°†é›†åˆä¸­æ‰€æœ‰å…ƒç´ ä¿å­˜èµ·æ¥ï¼Œç„¶åŽé€šè¿‡æ¯”è¾ƒç¡®å®šã€‚é“¾è¡¨ã€æ ‘ã€æ•£åˆ—è¡¨ï¼ˆåˆå«å“ˆå¸Œè¡¨ï¼ŒHash tableï¼‰ç­‰ç­‰æ•°æ®ç»“æž„éƒ½æ˜¯è¿™ç§æ€è·¯ã€‚ä½†æ˜¯éšç€é›†åˆä¸­å…ƒç´ çš„å¢žåŠ ï¼Œæˆ‘ä»¬éœ€è¦çš„å­˜å‚¨ç©ºé—´è¶Šæ¥è¶Šå¤§ã€‚åŒæ—¶æ£€ç´¢é€Ÿåº¦ä¹Ÿè¶Šæ¥è¶Šæ…¢ï¼Œä¸Šè¿°ä¸‰ç§ç»“æž„çš„æ£€ç´¢æ—¶é—´å¤æ‚åº¦åˆ†åˆ«ä¸ºO(n),O(log n),O(n/k)ã€‚ å¸ƒéš†è¿‡æ»¤å™¨çš„åŽŸç†æ˜¯ï¼Œå½“ä¸€ä¸ªå…ƒç´ è¢«åŠ å…¥é›†åˆæ—¶ï¼Œé€šè¿‡Kä¸ªæ•£åˆ—å‡½æ•°å°†è¿™ä¸ªå…ƒç´ æ˜ å°„æˆä¸€ä¸ªä½æ•°ç»„ä¸­çš„Kä¸ªç‚¹ï¼ŒæŠŠå®ƒä»¬ç½®ä¸º1ã€‚ ä¼˜ç‚¹ï¼šç›¸æ¯”äºŽå…¶å®ƒçš„æ•°æ®ç»“æž„ï¼Œå¸ƒéš†è¿‡æ»¤å™¨åœ¨ç©ºé—´å’Œæ—¶é—´æ–¹é¢éƒ½æœ‰å·¨å¤§çš„ä¼˜åŠ¿ã€‚å¸ƒéš†è¿‡æ»¤å™¨å­˜å‚¨ç©ºé—´å’Œæ’å…¥/æŸ¥è¯¢æ—¶é—´éƒ½æ˜¯å¸¸æ•°ï¼ˆOï¼ˆkï¼‰ï¼‰ã€‚å¦å¤–, æ•£åˆ—å‡½æ•°ç›¸äº’ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œæ–¹ä¾¿ç”±ç¡¬ä»¶å¹¶è¡Œå®žçŽ°ã€‚å¸ƒéš†è¿‡æ»¤å™¨ä¸éœ€è¦å­˜å‚¨å…ƒç´ æœ¬èº«ï¼Œåœ¨æŸäº›å¯¹ä¿å¯†è¦æ±‚éžå¸¸ä¸¥æ ¼çš„åœºåˆæœ‰ä¼˜åŠ¿ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥è¡¨ç¤ºå…¨é›†ï¼Œå…¶å®ƒä»»ä½•æ•°æ®ç»“æž„éƒ½ä¸èƒ½ï¼›kå’Œmç›¸åŒï¼Œä½¿ç”¨åŒä¸€ç»„æ•£åˆ—å‡½æ•°çš„ä¸¤ä¸ªå¸ƒéš†è¿‡æ»¤å™¨çš„äº¤å¹¶å·®è¿ç®—å¯ä»¥ä½¿ç”¨ä½æ“ä½œè¿›è¡Œã€‚ ç¼ºç‚¹ï¼šä½†æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„ç¼ºç‚¹å’Œä¼˜ç‚¹ä¸€æ ·æ˜Žæ˜¾ã€‚è¯¯ç®—çŽ‡æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚éšç€å­˜å…¥çš„å…ƒç´ æ•°é‡å¢žåŠ ï¼Œè¯¯ç®—çŽ‡éšä¹‹å¢žåŠ ã€‚ä½†æ˜¯å¦‚æžœå…ƒç´ æ•°é‡å¤ªå°‘ï¼Œåˆ™ä½¿ç”¨æ•£åˆ—è¡¨è¶³çŸ£ã€‚å¦å¤–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸èƒ½ä»Žå¸ƒéš†è¿‡æ»¤å™¨ä¸­åˆ é™¤å…ƒç´ ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°æŠŠä½æ•°ç»„å˜æˆæ•´æ•°æ•°ç»„ï¼Œæ¯æ’å…¥ä¸€ä¸ªå…ƒç´ ç›¸åº”çš„è®¡æ•°å™¨åŠ 1,è¿™æ ·åˆ é™¤å…ƒç´ æ—¶å°†è®¡æ•°å™¨å‡æŽ‰å°±å¯ä»¥äº†ã€‚ç„¶è€Œè¦ä¿è¯å®‰å…¨åœ°åˆ é™¤å…ƒç´ å¹¶éžå¦‚æ­¤ç®€å•ã€‚é¦–å…ˆæˆ‘ä»¬å¿…é¡»ä¿è¯åˆ é™¤çš„å…ƒç´ çš„ç¡®åœ¨å¸ƒéš†è¿‡æ»¤å™¨é‡Œé¢ã€‚è¿™ä¸€ç‚¹å•å‡­è¿™ä¸ªè¿‡æ»¤å™¨æ˜¯æ— æ³•ä¿è¯çš„ã€‚å¦å¤–è®¡æ•°å™¨å›žç»•ä¹Ÿä¼šé€ æˆé—®é¢˜ã€‚åœ¨é™ä½Žè¯¯ç®—çŽ‡æ–¹é¢ï¼Œæœ‰ä¸å°‘å·¥ä½œï¼Œä½¿å¾—å‡ºçŽ°äº†å¾ˆå¤šå¸ƒéš†è¿‡æ»¤å™¨çš„å˜ç§ã€‚ æ£€ç´¢æ—¶ï¼Œæˆ‘ä»¬åªè¦çœ‹çœ‹è¿™äº›ç‚¹æ˜¯ä¸æ˜¯éƒ½æ˜¯1å°±ï¼ˆå¤§çº¦ï¼‰çŸ¥é“é›†åˆä¸­æœ‰æ²¡æœ‰å®ƒäº†ï¼šå¦‚æžœè¿™äº›ç‚¹æœ‰ä»»ä½•ä¸€ä¸ª0ï¼Œåˆ™è¢«æ£€å…ƒç´ ä¸€å®šä¸åœ¨ï¼›å¦‚æžœéƒ½æ˜¯1ï¼Œåˆ™è¢«æ£€å…ƒç´ å¾ˆå¯èƒ½åœ¨ã€‚è¿™å°±æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„åŸºæœ¬æ€æƒ³ã€‚ Bloom Filteråº”ç”¨åœºæ™¯ï¼Ÿ ç”¨Redisçš„Bitmapä½œä¸ºä½æ•°ç»„æž„å»ºèµ·æ¥çš„å¯æ‰©å±•çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚ Rediså®žçŽ°çš„å¸ƒéš†è¿‡æ»¤å™¨å¦‚ä½•å¿«é€Ÿæœ‰æ•ˆåˆ é™¤æ•°æ®ï¼Ÿï¼šEXPIRE â€œbitmapçš„keyå€¼â€ 0 4.5 è§£å†³æ–¹æ¡ˆå¯¹æ¯” 5. æ— åº•æ´žé—®é¢˜ä¼˜åŒ– 5.1 é—®é¢˜æè¿° 2010å¹´ï¼Œfacebookæœ‰äº†3000ä¸ªMemcacheèŠ‚ç‚¹ å‘çŽ°é—®é¢˜ï¼š&quot;åŠ &quot;æœºå™¨æ€§èƒ½æ²¡èƒ½æå‡ï¼Œåè€Œä¸‹é™ 5.2 é—®é¢˜åŽŸå›  å½“å­˜åœ¨çš„èŠ‚ç‚¹å¼‚å¸¸å¤šçš„æ—¶å€™ï¼ŒIOçš„ä»£ä»·å·²ç»è¶…è¿‡æ•°æ®ä¼ è¾“ï¼Œä¸Šæ–‡æåˆ°çš„facebookçš„èŠ‚ç‚¹å·²ç»è¶…è¿‡3000ä¸ªï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å†å¢žåŠ èŠ‚ç‚¹å·²ç»æ²¡æ³•å†æé«˜æ•ˆçŽ‡äº†ã€‚ 5.3 é—®é¢˜è§£å†³â€”ä¼˜åŒ–IO å‘½ä»¤æœ¬èº«çš„æ•ˆçŽ‡ï¼šä¾‹å¦‚sqlä¼˜åŒ–ï¼Œå‘½ä»¤ä¼˜åŒ– ç½‘ç»œæ¬¡æ•°ï¼šå‡å°‘é€šä¿¡æ¬¡æ•° é™ä½ŽæŽ¥å…¥æˆæœ¬:é•¿è¿ž/è¿žæŽ¥æ± ,NIOç­‰ã€‚ IOè®¿é—®åˆå¹¶:O(n)åˆ°O(1)è¿‡ç¨‹:æ‰¹é‡æŽ¥å£(mget)ï¼Œå°±æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»çš„å¯¹äºŽmgetçš„å››ä¸ªæ–¹æ¡ˆã€‚ 6. ç¼“å­˜é›ªå´©ä¼˜åŒ– 6.1 ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ ä»Žä¸‹å›¾å¯ä»¥å¾ˆæ¸…æ™°å‡ºä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼šç”±äºŽç¼“å­˜å±‚æ‰¿è½½ç€å¤§é‡è¯·æ±‚ï¼Œæœ‰æ•ˆçš„ä¿æŠ¤äº†å­˜å‚¨å±‚ï¼Œä½†æ˜¯å¦‚æžœç¼“å­˜å±‚ç”±äºŽæŸäº›åŽŸå› æ•´ä½“ä¸èƒ½æä¾›æœåŠ¡ï¼ŒäºŽæ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¾¾åˆ°å­˜å‚¨å±‚ï¼Œå­˜å‚¨å±‚çš„è°ƒç”¨é‡ä¼šæš´å¢žï¼Œé€ æˆå­˜å‚¨å±‚ä¹Ÿä¼šæŒ‚æŽ‰çš„æƒ…å†µã€‚ ç¼“å­˜é›ªå´©çš„è‹±æ–‡åŽŸæ„æ˜¯ stampeding herdï¼ˆå¥”é€ƒçš„é‡Žç‰›ï¼‰ï¼ŒæŒ‡çš„æ˜¯ç¼“å­˜å±‚å®•æŽ‰åŽï¼Œæµé‡ä¼šåƒå¥”é€ƒçš„é‡Žç‰›ä¸€æ ·ï¼Œæ‰“å‘åŽç«¯å­˜å‚¨ã€‚ 6.2 å¦‚ä½•é˜²æ­¢ç¼“å­˜é›ªå´©ï¼Ÿ ä¿è¯ç¼“å­˜å±‚æœåŠ¡é«˜å¯ç”¨æ€§ã€‚ å’Œé£žæœºéƒ½æœ‰å¤šä¸ªå¼•æ“Žä¸€æ ·ï¼Œå¦‚æžœç¼“å­˜å±‚è®¾è®¡æˆé«˜å¯ç”¨çš„ï¼Œå³ä½¿ä¸ªåˆ«èŠ‚ç‚¹ã€ä¸ªåˆ«æœºå™¨ã€ç”šè‡³æ˜¯æœºæˆ¿å®•æŽ‰ï¼Œä¾ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œä¾‹å¦‚å‰é¢ä»‹ç»è¿‡çš„ Redis Sentinel å’Œ Redis Cluster éƒ½å®žçŽ°äº†é«˜å¯ç”¨ã€‚ ä¾èµ–éš”ç¦»ç»„ä»¶ä¸ºåŽç«¯é™æµå¹¶é™çº§ æ— è®ºæ˜¯ç¼“å­˜å±‚è¿˜æ˜¯å­˜å‚¨å±‚éƒ½ä¼šæœ‰å‡ºé”™çš„æ¦‚çŽ‡ï¼Œå¯ä»¥å°†å®ƒä»¬è§†åŒä¸ºèµ„æºã€‚ä½œä¸ºå¹¶å‘é‡è¾ƒå¤§çš„ç³»ç»Ÿï¼Œå‡å¦‚æœ‰ä¸€ä¸ªèµ„æºä¸å¯ç”¨ï¼Œå¯èƒ½ä¼šé€ æˆçº¿ç¨‹å…¨éƒ¨ hang åœ¨è¿™ä¸ªèµ„æºä¸Šï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚é™çº§åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­æ˜¯éžå¸¸æ­£å¸¸çš„ï¼šæ¯”å¦‚æŽ¨èæœåŠ¡ä¸­ï¼Œå¦‚æžœä¸ªæ€§åŒ–æŽ¨èæœåŠ¡ä¸å¯ç”¨ï¼Œå¯ä»¥é™çº§è¡¥å……çƒ­ç‚¹æ•°æ®ï¼Œä¸è‡³äºŽé€ æˆå‰ç«¯é¡µé¢æ˜¯å¼€å¤©çª—ã€‚ åœ¨å®žé™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹é‡è¦çš„èµ„æº ( ä¾‹å¦‚ Redisã€ MySQLã€ Hbaseã€å¤–éƒ¨æŽ¥å£ ) éƒ½è¿›è¡Œéš”ç¦»ï¼Œè®©æ¯ç§èµ„æºéƒ½å•ç‹¬è¿è¡Œåœ¨è‡ªå·±çš„çº¿ç¨‹æ± ä¸­ï¼Œå³ä½¿ä¸ªåˆ«èµ„æºå‡ºçŽ°äº†é—®é¢˜ï¼Œå¯¹å…¶ä»–æœåŠ¡æ²¡æœ‰å½±å“ã€‚ä½†æ˜¯çº¿ç¨‹æ± å¦‚ä½•ç®¡ç†ï¼Œæ¯”å¦‚å¦‚ä½•å…³é—­èµ„æºæ± ï¼Œå¼€å¯èµ„æºæ± ï¼Œèµ„æºæ± é˜€å€¼ç®¡ç†ï¼Œè¿™äº›åšèµ·æ¥è¿˜æ˜¯ç›¸å½“å¤æ‚çš„ï¼Œè¿™é‡ŒæŽ¨èä¸€ä¸ª Java ä¾èµ–éš”ç¦»å·¥å…· Hystrixã€‚è¶…å‡ºèŒƒå›´äº†ã€‚ä¸å†èµ˜è¿°ã€‚ 7. çƒ­ç‚¹keyé‡å»ºä¼˜åŒ– 7.1 é—®é¢˜ çƒ­ç‚¹key( ä¾‹å¦‚ä¸€ä¸ªçƒ­é—¨çš„å¨±ä¹æ–°é—»ï¼‰+è¾ƒé•¿çš„é‡å»ºæ—¶é—´ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚è®¡ç®—ï¼Œä¾‹å¦‚å¤æ‚çš„ SQLã€å¤šæ¬¡ IOã€å¤šä¸ªä¾èµ–ç­‰ï¼‰ å°±æ˜¯è¯´åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼ŒæŸä¸ªkeyåœ¨ç¼“å­˜ä¸­é‡å»ºæ—¶é—´å¤ªé•¿ï¼Œä»¥è‡³äºŽé«˜å¹¶å‘ä¸‹ç¼“å­˜æŸ¥ä¸åˆ°ï¼Œéƒ½åŽ»DBè¿›è¡ŒæŸ¥è¯¢ã€‚å¯¹äºŽDBåŽ‹åŠ›å¾ˆå¤§ï¼Œå¹¶ä¸”å“åº”æ—¶é—´é•¿ã€‚ ä¸‰ä¸ªç›®æ ‡ï¼šè¦å‡å°‘ç¼“å­˜é‡å»ºæ¬¡æ•°ã€æ•°æ®å°½å¯èƒ½ä¸€è‡´ã€å‡å°‘æ½œåœ¨å±é™©ã€‚ ä¸¤ä¸ªè§£å†³ï¼šäº’æ–¥é”ã€æ°¸è¿œä¸è¿‡æœŸ 7.2 äº’æ–¥é”â€”setex,setnx å­˜åœ¨é—®é¢˜ï¼šæœ‰ç­‰å¾…æ—¶é—´ã€‚ ä¼ªä»£ç ï¼š (1) ä»Ž Redis èŽ·å–æ•°æ®ï¼Œå¦‚æžœå€¼ä¸ä¸ºç©ºï¼Œåˆ™ç›´æŽ¥è¿”å›žå€¼ï¼Œå¦åˆ™æ‰§è¡Œ (2.1) å’Œ (2.2)ã€‚ (2) å¦‚æžœ set(nx å’Œ ex) ç»“æžœä¸º trueï¼Œè¯´æ˜Žæ­¤æ—¶æ²¡æœ‰å…¶ä»–çº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹æ‰§è¡Œç¼“å­˜æž„å»ºé€»è¾‘ã€‚ (2.2) å¦‚æžœ setnx(nx å’Œ ex) ç»“æžœä¸º falseï¼Œè¯´æ˜Žæ­¤æ—¶å·²ç»æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨æ‰§è¡Œæž„å»ºç¼“å­˜çš„å·¥ä½œï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°†ä¼‘æ¯æŒ‡å®šæ—¶é—´ ( ä¾‹å¦‚è¿™é‡Œæ˜¯ 50 æ¯«ç§’ï¼Œå–å†³äºŽæž„å»ºç¼“å­˜çš„é€Ÿåº¦ ) åŽï¼Œé‡æ–°æ‰§è¡Œå‡½æ•°ï¼Œç›´åˆ°èŽ·å–åˆ°æ•°æ®ã€‚ 7.3 æ°¸è¿œä¸è¿‡æœŸ è¿™é‡Œæˆ‘æƒ³äº†å¾ˆä¹…åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Œï¼Œï¼Œæˆ‘æ„Ÿè§‰è¿™æ˜¯ä¸€ä¸ªåœºæ™¯ï¼šä¿è¯æ•°æ®çš„å®šæœŸæ›´æ–°ã€‚å¯¹äºŽçƒ­ç‚¹key,æ— éžæ˜¯å¹¶å‘ç‰¹åˆ«å¤§å¹¶ä¸”é‡å»ºç¼“å­˜æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå¦‚æžœç›´æŽ¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆæ—¶é—´åˆ°çš„æ—¶å€™ï¼Œå·¨å¤§çš„è®¿é—®é‡ä¼šåŽ‹è¿«åˆ°æ•°æ®åº“ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å®žé™…ä¸Šï¼Œæ˜¯ä¸ç»™ä»–è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½†æ˜¯ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ€Žä¹ˆåšåˆ°å®šæ—¶æ›´æ–°å‘¢ï¼Ÿè¿™é‡Œçš„æ–¹æ¡ˆæ˜¯ç»™çƒ­ç‚¹keyçš„valå¢žåŠ ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´å­—æ®µï¼Œå¹¶å‘è®¿é—®çš„æ—¶å€™ï¼Œåˆ¤æ–­è¿™ä¸ªé€»è¾‘å­—æ®µçš„æ—¶é—´å€¼æ˜¯å¦å¤§äºŽå½“å‰æ—¶é—´ï¼Œå¤§äºŽäº†è¯´æ˜Žè¦å¯¹ç¼“å­˜è¿›è¡Œæ›´æ–°äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œä¾ç„¶è®©æ‰€æœ‰çº¿ç¨‹è®¿é—®è€çš„ç¼“å­˜ï¼Œå› ä¸ºç¼“å­˜å¹¶æ²¡æœ‰è®¾ç½®è¿‡æœŸï¼Œä½†æ˜¯å¦å¼€ä¸€ä¸ªçº¿ç¨‹å¯¹ç¼“å­˜è¿›è¡Œé‡æž„ã€‚ç­‰é‡æž„æˆåŠŸï¼Œå³æ‰§è¡Œäº†redis setæ“ä½œä¹‹åŽï¼Œæ‰€æœ‰çš„çº¿ç¨‹å°±å¯ä»¥è®¿é—®åˆ°é‡æž„åŽçš„ç¼“å­˜ä¸­çš„æ–°çš„å†…å®¹äº†ã€‚ä¸çŸ¥é“æˆ‘çš„ç†è§£æ˜¯ä¸æ˜¯æ­£ç¡®ã€‚ â€œæ°¸è¿œä¸è¿‡æœŸâ€åŒ…å«ä¸¤å±‚æ„æ€ï¼š ä»Žç¼“å­˜å±‚é¢æ¥çœ‹ï¼Œç¡®å®žæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºçŽ°çƒ­ç‚¹ key è¿‡æœŸåŽäº§ç”Ÿçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯â€œç‰©ç†â€ä¸è¿‡æœŸã€‚ ä»ŽåŠŸèƒ½å±‚é¢æ¥çœ‹ï¼Œä¸ºæ¯ä¸ª value è®¾ç½®ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œå½“å‘çŽ°è¶…è¿‡é€»è¾‘è¿‡æœŸæ—¶é—´åŽï¼Œä¼šä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹åŽ»æž„å»ºç¼“å­˜ã€‚ 2018/6/19 å·è¡¥å……ï¼šç‰©ç†ä¸Šç¼“å­˜ç¡®å®žæ˜¯ä¸è¿‡æœŸçš„ï¼Œä¿è¯æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½è®¿é—®åˆ°ï¼Œä½†æ˜¯æœ‰å¯èƒ½æ˜¯è€çš„æ•°æ®ï¼›é€»è¾‘ä¸Šç»™ value å¢žåŠ è¿‡æœŸæ—¶é—´ï¼Œå¦‚æžœå½“è¿‡æœŸæ—¶é—´è¶…è¿‡å½“å‰æ—¶é—´(æ¯ä¸€ä¸ªçº¿ç¨‹æ‹¿ç¼“å­˜æ•°æ®çš„æ—¶å€™éƒ½ä¼šåˆ¤æ–­ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œä»ç„¶ä½¿ç”¨äº’æ–¥é”ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å‘çŽ°è¿‡æœŸæ—¶é—´è¶…è¿‡å½“å‰æ—¶é—´äº†ï¼Œé‚£ä¹ˆé”ä½ï¼Œå¦å¼€ä¸€ä¸ªçº¿ç¨‹åŽ»å®Œæˆæ•°æ®é‡å»º)ï¼Œæ–°å¼€ä¸€ä¸ªçº¿ç¨‹åŽ»æž„å»ºç¼“å­˜ï¼Œæž„å»ºæˆåŠŸä¹‹åŽï¼Œè®¾ç½®æ–°å†…å®¹åˆ°ç¼“å­˜ä¸­å¹¶ä¸”åˆ é™¤è€ç¼“å­˜ï¼Œå°±å®Œæˆäº†çƒ­ç‚¹ key çš„é‡å»ºã€‚ ä¼ªä»£ç å®žçŽ°ï¼š ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis-Clusterç†è®ºè¯¦è§£]]></title>
    <url>%2F2019%2F02%2F01%2Fredis%2FRedis-Cluster%E7%90%86%E8%AE%BA%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬å…«ç¯‡æ–‡ç« ã€‚ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ äº†redis sentinelï¼ŒçŸ¥é“äº†å®ƒæ˜¯redisé«˜å¯ç”¨çš„ä¸€ç§å®žçŽ°æ–¹æ¡ˆã€‚ä½†æ˜¯é¢å¯¹è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œä¸€å°masteræ˜¯ä¸€å®šä¸èƒ½è§£å†³é—®é¢˜çš„ï¼Œredis 3.0ç»™æˆ‘ä»¬å¸¦æ¥äº†æœåŠ¡ç«¯é›†ç¾¤æ–¹æ¡ˆï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ 1. æ•°æ®åˆ†åŒº é›†ç¾¤ï¼Œé‚£ä¹ˆå°±ä¼šæ¶‰åŠåˆ°æ•°æ®æ˜¯å¦‚ä½•åˆ†ç‰‡çš„ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼šé¡ºåºåˆ†åŒºå’Œå“ˆå¸Œåˆ†åŒº ä¸¤è€…å¯¹æ¯”ï¼š ç›´æŽ¥hashå–æ¨¡è¿›è¡Œæ•°æ®åˆ†ç‰‡æ—¶ï¼Œå½“èŠ‚ç‚¹å¢žåŠ ï¼Œä¼šæœ‰å¾ˆå¤šæ•°æ®å‘½ä¸­ä¸äº†ï¼Œéœ€è¦é‡æ–°æ˜ å°„ã€‚å¦‚æžœå¤§å¤šæ•°æ•°æ®åœ¨å¢žåŠ æˆ–è€…å‡å°‘èŠ‚ç‚¹ä¹‹åŽè¿›è¡Œè¿ç§»çš„è¯ï¼Œå¯¹äºŽæ€§èƒ½å½±å“æ˜¯å¾ˆå¤§çš„ï¼Œå› ä¸ºæ•°æ®è¿ç§»ï¼Œé‚£ä¹ˆç¼“å­˜ä¸­çŽ°åœ¨æ˜¯æ— æ³•å‘½ä¸­çš„ï¼Œå¿…é¡»åŽ»æ•°æ®åº“å–ï¼Œæ˜¯ç¾éš¾æ€§çš„è¡Œä¸ºã€‚ æ—©æœŸçš„åšæ³•å°±æ˜¯è¿™æ ·ï¼Œåœ¨å®¢æˆ·ç«¯hashå–ä½™èŠ‚ç‚¹ä¸ªæ•°æ¥è¿›è¡Œæ•°æ®åˆ†ç‰‡ã€‚å¦‚æžœéžè¦è¿™æ ·ï¼Œé‡‡å–ç¿»å€æ‰©å®¹ä¼šç¨å¾®å¥½ä¸€ç‚¹ï¼Œè¿ç§»æ•°æ®é‡ä¼šå°ä¸€ç‚¹ã€‚ä¸è¿‡æ— è®ºå¦‚ä½•ï¼Œè¿™ç§æ–¹å¼åœ¨å¤§æ•°æ®é‡æƒ…å†µä¸‹æ˜¯ä¸å¯è¡Œçš„ã€‚ 2. ä¸€è‡´æ€§hashç®—æ³• å¯¹äºŽä¸Šé¢æåˆ°çš„ç›´æŽ¥hashå–ä½™çš„æ–¹å¼ï¼Œä¼šå¯¼è‡´å¤§é‡æ•°æ®çš„è¿ç§»ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼ï¼Œåœ¨å¢žåŠ æˆ–å‡å°‘èŠ‚ç‚¹æ—¶ï¼Œåªæœ‰å°‘éƒ¨åˆ†æ•°æ®è¿ç§»å‘¢ï¼Ÿ é’ˆå¯¹ä¸€è‡´æ€§hashç®—æ³•ï¼Œå·²ç»åœ¨ç®€æ˜Žç†è§£ä¸€è‡´æ€§hashç®—æ³•ä¸­è¯¦ç»†è¯´æ˜Žäº†ï¼Œä¸å†èµ˜è¿°ã€‚ å¯¹äºŽredis 3.0ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥å®žçŽ°æ•°æ®åˆ†ç‰‡ã€‚åœ¨redis 3.0ä¹‹åŽï¼Œå°±ä¸éœ€è¦å®¢æˆ·ç«¯æ¥å®žçŽ°åˆ†ç‰‡ç®—æ³•äº†ï¼Œè€Œæ˜¯ç›´æŽ¥ç»™æˆ‘ä»¬æä¾›äº†æœåŠ¡ç«¯é›†ç¾¤æ–¹æ¡ˆredis cluster. 3. è™šæ‹Ÿæ§½ redis clusterå¼•å…¥æ§½çš„æ¦‚å¿µï¼Œä¸€å®šè¦ä¸Žä¸€è‡´æ€§hashçš„æ§½åŒºåˆ†ï¼è¿™é‡Œæ¯ä¸€ä¸ªæ§½æ˜ å°„ä¸€ä¸ªæ•°æ®é›†ã€‚ CRC16(key) &amp; 16383 è¿™é‡Œè®¡ç®—ç»“æžœå‘é€ç»™redis clusterä»»æ„ä¸€ä¸ªredisèŠ‚ç‚¹ï¼Œè¿™ä¸ªredisèŠ‚ç‚¹å‘çŽ°ä»–æ˜¯å±žäºŽè‡ªå·±ç®¡è¾–èŒƒå›´çš„ï¼Œé‚£å°±å°†å®ƒæ”¾è¿›åŽ»ï¼›ä¸å±žäºŽä»–çš„æ§½èŒƒå›´çš„è¯ï¼Œç”±äºŽredisä¹‹é—´æ˜¯ç›¸äº’é€šä¿¡çš„ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ˜¯çŸ¥é“å…¶ä»–redisèŠ‚ç‚¹çš„æ§½çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆä¼šå‘Šè¯‰ä»–åŽ»é‚£ä¸ªredisèŠ‚ç‚¹åŽ»çœ‹çœ‹ã€‚ é‚£ä¹ˆå°±å®žçŽ°äº†æœåŠ¡ç«¯å¯¹äºŽæ§½ã€èŠ‚ç‚¹ã€æ•°æ®çš„ç®¡ç†ã€‚ å½“masterèŠ‚ç‚¹å¢žåŠ æ—¶ï¼Œå³æ‰©å®¹æ—¶ï¼Œå¯¹äºŽä»¥ä¸Šä¸¤ç§æ–¹æ¡ˆï¼Œéƒ½ä¼šå‡ºçŽ°æ•°æ®è¿ç§»ï¼Œé‚£ä¹ˆåªèƒ½ä½œä¸ºç¼“å­˜åœºæ™¯ä½¿ç”¨ã€‚ä½†æ˜¯redis clusterï¼Œç”±äºŽæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤çš„æ§½çš„èŒƒå›´æ˜¯å›ºå®šçš„ï¼Œå½“æœ‰æ–°åŠ å…¥çš„èŠ‚ç‚¹æ—¶ï¼Œæ˜¯ä¸ä¼šå¹²æ‰°åˆ°å…¶ä»–èŠ‚ç‚¹çš„æ§½çš„ï¼Œå¿…é¡»æ˜¯ä»¥å‰çš„èŠ‚ç‚¹å°†ä½¿ç”¨æ§½çš„æƒåˆ©åˆ†é…ç»™ä½ ï¼Œå¹¶ä¸”å°†æ•°æ®åˆ†é…ç»™ä½ ï¼Œè¿™æ ·ï¼Œæ–°çš„èŠ‚ç‚¹æ‰ä¼šçœŸæ­£æ‹¥æœ‰è¿™äº›æ§½å’Œæ•°æ®ã€‚è¿™ç§å®žçŽ°è¿˜å¤„äºŽåŠè‡ªåŠ¨çŠ¶æ€ï¼Œéœ€è¦äººå·¥ä»‹å…¥ã€‚-----ä¸»è¦çš„æ€æƒ³æ˜¯ï¼šæ§½åˆ°é›†ç¾¤èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»è¦æ”¹å˜ï¼Œä¸å˜çš„æ˜¯é”®åˆ°æ§½çš„æ˜ å°„å…³ç³». Redisé›†ç¾¤ï¼Œè¦ä¿è¯16384ä¸ªæ§½å¯¹åº”çš„nodeéƒ½æ­£å¸¸å·¥ä½œï¼Œå¦‚æžœæŸä¸ªnodeå‘ç”Ÿæ•…éšœï¼Œé‚£å®ƒè´Ÿè´£çš„slotsä¹Ÿå°±å¤±æ•ˆï¼Œæ•´ä¸ªé›†ç¾¤å°†ä¸èƒ½å·¥ä½œã€‚ä¸ºäº†å¢žåŠ é›†ç¾¤çš„å¯è®¿é—®æ€§ï¼Œå®˜æ–¹æŽ¨èçš„æ–¹æ¡ˆæ˜¯å°†nodeé…ç½®æˆä¸»ä»Žç»“æž„ï¼Œå³ä¸€ä¸ªmasterä¸»èŠ‚ç‚¹ï¼ŒæŒ‚nä¸ªslaveä»ŽèŠ‚ç‚¹ã€‚è¿™æ—¶ï¼Œå¦‚æžœä¸»èŠ‚ç‚¹å¤±æ•ˆï¼ŒRedis Clusterä¼šæ ¹æ®é€‰ä¸¾ç®—æ³•ä»ŽslaveèŠ‚ç‚¹ä¸­é€‰æ‹©ä¸€ä¸ªä¸Šå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œæ•´ä¸ªé›†ç¾¤ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚ 4. æŸä¸ªMasteråˆæ€Žä¹ˆçŸ¥é“æŸä¸ªæ§½è‡ªå·±æ˜¯ä¸æ˜¯æ‹¥æœ‰å‘¢ï¼Ÿ MasterèŠ‚ç‚¹ç»´æŠ¤ç€ä¸€ä¸ª16384/8å­—èŠ‚çš„ä½åºåˆ—ï¼ŒMasterèŠ‚ç‚¹ç”¨bitæ¥æ ‡è¯†å¯¹äºŽæŸä¸ªæ§½è‡ªå·±æ˜¯å¦æ‹¥æœ‰ã€‚æ¯”å¦‚å¯¹äºŽç¼–å·ä¸º1çš„æ§½ï¼ŒMasteråªè¦åˆ¤æ–­åºåˆ—çš„ç¬¬äºŒä½ï¼ˆç´¢å¼•ä»Ž0å¼€å§‹ï¼‰æ˜¯ä¸æ˜¯ä¸º1å³å¯ã€‚ å¦‚ä¸Šé¢çš„åºåˆ—ï¼Œè¡¨ç¤ºå½“å‰Masteræ‹¥æœ‰ç¼–å·ä¸º1ï¼Œ134çš„æ§½ã€‚é›†ç¾¤åŒæ—¶è¿˜ç»´æŠ¤ç€æ§½åˆ°é›†ç¾¤èŠ‚ç‚¹çš„æ˜ å°„ï¼Œæ˜¯ç”±é•¿åº¦ä¸º16384ç±»åž‹ä¸ºèŠ‚ç‚¹çš„æ•°ç»„å®žçŽ°çš„ï¼Œæ§½ç¼–å·ä¸ºæ•°ç»„çš„ä¸‹æ ‡ï¼Œæ•°ç»„å†…å®¹ä¸ºé›†ç¾¤èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆå¿«åœ°é€šè¿‡æ§½ç¼–å·æ‰¾åˆ°è´Ÿè´£è¿™ä¸ªæ§½çš„èŠ‚ç‚¹ã€‚ä½åºåˆ—è¿™ä¸ªç»“æž„å¾ˆç²¾å·§ï¼Œå³ä¸æµªè´¹å­˜å‚¨ç©ºé—´ï¼Œæ“ä½œèµ·æ¥åˆå¾ˆä¾¿æ·ã€‚ å…·ä½“å‚ç…§ï¼šhttp://blog.jobbole.com/103258/ ,è¿˜æåˆ°äº†slotè¿ç§»çš„ä¸€äº›ç»†èŠ‚ã€‚ 5. redisèŠ‚ç‚¹ä¹‹é—´å¦‚ä½•é€šä¿¡çš„ï¼Ÿ gossipåè®®ï¼šèŠ‚ç‚¹ä¹‹é—´å½¼æ­¤ä¸æ–­é€šä¿¡äº¤æ¢ä¿¡æ¯ï¼Œä¸€æ®µæ—¶é—´åŽæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šçŸ¥é“é›†ç¾¤å®Œæ•´çš„ä¿¡æ¯ã€‚ èŠ‚ç‚¹ä¸ŽèŠ‚ç‚¹ä¹‹é—´é€šè¿‡äºŒè¿›åˆ¶åè®®è¿›è¡Œé€šä¿¡ã€‚ å®¢æˆ·ç«¯å’Œé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´é€šä¿¡å’Œé€šå¸¸ä¸€æ ·ï¼Œé€šè¿‡æ–‡æœ¬åè®®è¿›è¡Œã€‚ é›†ç¾¤èŠ‚ç‚¹ä¸ä¼šä»£ç†æŸ¥è¯¢ã€‚ 6. é›†ç¾¤ä¼¸ç¼© è¿™é‡Œ6385ä¸ºæ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œä¸€å¼€å§‹æ˜¯æ²¡æœ‰æ§½çš„ï¼Œæ‰€ä»¥è¿›è¡Œslotçš„è¿ç§»ã€‚ é›†ç¾¤ä¼¸ç¼©ï¼šæ§½å’Œæ•°æ®åœ¨èŠ‚ç‚¹ä¹‹é—´çš„ç§»åŠ¨ã€‚ è¿ç§»æ•°æ®çš„æµç¨‹å›¾ï¼š è¿ç§»keyå¯ä»¥ç”¨pipelineè¿›è¡Œæ‰¹é‡çš„è¿ç§»ã€‚ å¯¹äºŽæ‰©å®¹ï¼ŒåŽŸç†å·²ç»å¾ˆæ¸…æ™°äº†ï¼Œè‡³äºŽå…·ä½“æ“ä½œï¼Œç½‘ä¸Šå¾ˆå¤šã€‚è‡³äºŽç¼©å®¹ï¼Œä¹Ÿæ˜¯å…ˆæ‰‹åŠ¨å®Œæˆæ•°æ®è¿ç§»ï¼Œå†å…³é—­redisã€‚ 7. å®¢æˆ·ç«¯è·¯ç”± 7.1 movedé‡å®šå‘ å…¶ä¸­ï¼Œæ§½ç›´æŽ¥å‘½ä¸­çš„è¯ï¼Œå°±ç›´æŽ¥è¿”å›žæ§½ç¼–å·ï¼š æ§½ä¸å‘½ä¸­ï¼Œè¿”å›žå¸¦æç¤ºä¿¡æ¯çš„å¼‚å¸¸ï¼Œå®¢æˆ·ç«¯éœ€è¦é‡æ–°å‘é€ä¸€æ¡å‘½ä»¤ï¼š å¯¹äºŽå‘½ä»¤è¡Œçš„å®žéªŒï¼Œç”¨redis-cliåŽ»è¿žæŽ¥é›†ç¾¤ï¼š redis -c -p 7000:åŠ ä¸Š-cï¼Œè¡¨ç¤ºä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡ä¸å‘½ä¸­çš„æƒ…å†µä¸‹è‡ªåŠ¨è·³è½¬åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼š å¦‚æžœä¸åŠ -cçš„è¯ï¼Œä¼šè¿”å›žmovedå¼‚å¸¸ï¼Œä¸ä¼šè‡ªåŠ¨è·³è½¬ï¼š 7.2 aské‡å®šå‘ åœ¨æ‰©å®¹ç¼©å®¹çš„æ—¶å€™ï¼Œç”±äºŽéœ€è¦éåŽ†è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰çš„keyç„¶åŽè¿›è¡Œè¿ç§»ï¼Œæ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå¯¹å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚å› ä¸ºå‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œå®¢æˆ·ç«¯è®¿é—®æŸä¸ªkeyï¼ŒèŠ‚ç‚¹å‘Šè¯‰å®¢æˆ·ç«¯è¿™ä¸ªkeyåœ¨æºèŠ‚ç‚¹ï¼Œå½“æˆ‘ä»¬å†åŽ»æºèŠ‚ç‚¹è®¿é—®çš„æ—¶å€™ï¼Œå´å‘çŽ°keyå·²ç»è¿ç§»åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚ 7.3 movedé‡å®šå‘å’Œaské‡å®šå‘å¯¹æ¯” ä¸¤è€…éƒ½æ˜¯å®¢æˆ·ç«¯çš„é‡å®šå‘ movedï¼šæ§½å·²ç»ç¡®å®šè½¬ç§» ask:æ§½è¿˜åœ¨è¿ç§»ä¸­ é—®é¢˜ï¼šå¦‚æžœèŠ‚ç‚¹ä¼—å¤šï¼Œé‚£ä¹ˆè®©å®¢æˆ·ç«¯éšæœºè®¿é—®èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æŽ¥å‘½ä¸­çš„æ¦‚çŽ‡åªæœ‰ç™¾åˆ†ä¹‹ä¸€ï¼Œè¿˜æœ‰å°±æ˜¯å‘ç”Ÿaskå¼‚å¸¸æ—¶ï¼ˆå³èŠ‚ç‚¹æ­£åœ¨è¿ç§»æ—¶ï¼‰å®¢æˆ·ç«¯å¦‚ä½•è¿˜èƒ½é«˜æ•ˆè¿è½¬ï¼Ÿ æ€»ç»“ä¸€å¥è¯å°±æ˜¯redis clusterçš„å®¢æˆ·ç«¯çš„å®žçŽ°ä¼šæ›´å¤æ‚ã€‚ 8. smartå®¢æˆ·ç«¯ 8.1 è¿½æ±‚ç›®æ ‡ è¿½æ±‚æ€§èƒ½ï¼Œä¸ä¼šä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œè€Œæ˜¯ç›´è¿žå¯¹åº”èŠ‚ç‚¹ã€‚éœ€è¦å¯¹movedå¼‚å¸¸å’Œaskå¼‚å¸¸åšå…¼å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦æœ‰ä¸€ä¸ªè¿™ä¸ªè¯­è¨€å¯¹åº”çš„å®¢æˆ·ç«¯æ¥é«˜æ•ˆå®žçŽ°æŸ¥æ‰¾ç­‰æ“ä½œã€‚ 8.2 smartåŽŸç† ä»Žé›†ç¾¤ä¸­é€‰ä¸€ä¸ªå¯è¿è¡ŒèŠ‚ç‚¹ï¼Œä½¿ç”¨cluster slotsåˆå§‹åŒ–æ§½å’ŒèŠ‚ç‚¹æ˜ å°„ å°†slotä¸ŽnodeèŠ‚ç‚¹çš„ç»“æžœæ˜ å°„åˆ°æœ¬åœ°ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºJedisPool å‡†å¤‡æ‰§è¡Œå‘½ä»¤ ç¬¬ä¸€æ­¥ä¸­å°†slotä¸ŽnodeèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»æ”¾åœ¨äº†mapä¸­ï¼Œå½¢æˆä¸€ä¸ªæ˜ å°„å…³ç³»ï¼›keyæ˜¯é€šè¿‡CRC16ç®—æ³•å†å–ä½™å¾—åˆ°slotï¼Œæ‰€ä»¥keyä¸Žslotçš„æ˜ å°„å…³ç³»ä¹Ÿæ˜¯ç¡®å®šçš„ã€‚æˆ‘ä»¬å°±å¯ä»¥ç›´æŽ¥å‘é€å‘½ä»¤ã€‚åªè¦åŽé¢é›†ç¾¤æ²¡æœ‰å‘ç”Ÿæ•°æ®è¿ç§»ï¼Œé‚£ä¹ˆå°±ä¼šè¿žæŽ¥æˆåŠŸã€‚ä½†æ˜¯å¦‚æžœåœ¨è¿žæŽ¥çš„æ—¶å€™å‡ºçŽ°äº†è¿žæŽ¥å‡ºé”™ï¼Œè¯´æ˜Žè¿™ä¸ªkeyå·²ç»è¿ç§»åˆ°å…¶ä»–çš„nodeä¸Šäº†ã€‚å¦‚æžœå‘çŽ°keyä¸åœåœ°è¿ç§»ï¼Œè¶…è¿‡5æ¬¡å°±æŠ¥é”™ã€‚ åœ¨å‘ç”Ÿmovedå¼‚å¸¸çš„æ—¶å€™ï¼Œåˆ™éœ€è¦åˆ·æ–°ç¼“å­˜ï¼Œå³ä¸€å¼€å§‹ç»´æŠ¤çš„mapã€‚ æœ‰ä¸€ä¸ªæƒ…å†µæ¯”è¾ƒå…¨çš„å›¾ï¼š java redis clusterå®¢æˆ·ç«¯ï¼šjedisClusteråŸºæœ¬ä½¿ç”¨â€“ä¼ªä»£ç  jedisClusterå†…éƒ¨å·²ç»å°è£…å¥½æ± çš„å€Ÿè¿˜æ“ä½œç­‰ã€‚ å…ˆå†™ä¸€ä¸ªJedisClusterFactory: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import redis.clients.jedis.HostAndPort;import redis.clients.jedis.JedisCluster;import redis.clients.jedis.JedisPoolConfig;import java.io.IOException;import java.util.HashSet;import java.util.List;import java.util.Set;public class JedisClusterFactory &#123; private JedisCluster jedisCluster; private List&lt;String&gt; hostPortList; //è¶…æ—¶æ—¶é—´ private int timeout; public void init()&#123; //è¿™é‡Œå¯ä»¥è®¾ç½®ç›¸å…³å‚æ•° JedisPoolConfig jedisPoolConfig = new JedisPoolConfig(); //ä»Žé…ç½®æ–‡ä»¶ä¸­è¯»å–ip:portçš„å‚æ•°æ”¾è¿›Setä¸­ Set&lt;HostAndPort&gt; nodeSet = new HashSet&lt;HostAndPort&gt;(); for(String hostPort : hostPortList)&#123; String[] arr = hostPort.split(":"); if(arr.length != 2)&#123; continue; &#125; nodeSet.add(new HostAndPort(arr[0],Integer.parseInt(arr[1]))); &#125; try &#123; jedisCluster = new JedisCluster(nodeSet,timeout,jedisPoolConfig); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; public void destory()&#123; if(jedisCluster != null)&#123; try &#123; jedisCluster.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public JedisCluster getJedisCluster() &#123; return jedisCluster; &#125; //springæ³¨å…¥hostPortListå’Œtimeout public void setHostPortList(List&lt;String&gt; hostPortList) &#123; this.hostPortList = hostPortList; &#125; public void setTimeout(int timeout) &#123; this.timeout = timeout; &#125;&#125; hostPortList æ”¾å…¥spring beanä¸­ï¼Œspringè‡ªåŠ¨å®Œæˆæ³¨å…¥ã€‚ 8.3 å¤šèŠ‚ç‚¹å‘½ä»¤å®žçŽ° æœ‰çš„æ—¶å€™æˆ‘ä»¬æƒ³æ“ä½œæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ã€‚å¦‚ä½•å®žçŽ°å‘¢ï¼Ÿ 8.4 æ‰¹é‡æ“ä½œ mget,msetå¿…é¡»åœ¨ä¸€ä¸ªæ§½ã€‚è¿™ä¸ªæ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼Œä¸€èˆ¬æ˜¯ä¸èƒ½ä¿è¯çš„ï¼Œé‚£ä¹ˆå¦‚ä½•å®žçŽ°æ‰¹é‡çš„æ“ä½œå‘¢ï¼Ÿ Redis Clusterçš„è¡Œä¸ºå’ŒRedis çš„å•èŠ‚ç‚¹ä¸åŒï¼Œç”šè‡³å’Œä¸€ä¸ªSentinel ç›‘æŽ§çš„ä¸»ä»Žæ¨¡å¼ä¹Ÿä¸ä¸€æ ·ã€‚ä¸»è¦åŽŸå› æ˜¯é›†ç¾¤è‡ªåŠ¨åˆ†ç‰‡ï¼Œå°†ä¸€ä¸ªkey æ˜ å°„åˆ°16384ä¸ªæ§½ä¸­çš„ä¸€ä¸ªï¼Œè¿™äº›æ§½åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚å› æ­¤æ“ä½œå¤šä¸ªkey çš„å‘½ä»¤å¿…é¡»ä¿è¯æ‰€æœ‰çš„key éƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªæ§½ä¸Šï¼Œé¿å…è·¨æ§½æ‰§è¡Œé”™è¯¯ã€‚æ›´è¿›ä¸€æ­¥è¯´ï¼Œä»ŠåŽä¸€ä¸ªå•ç‹¬çš„é›†ç¾¤èŠ‚ç‚¹ï¼ŒåªæœåŠ¡äºŽä¸€ç»„ä¸“ç”¨çš„keysï¼Œè¯·æ±‚ä¸€ä¸ªå‘½ä»¤åˆ°ä¸€ä¸ªServerï¼Œåªèƒ½å¾—åˆ°è¯¥Server ä¸Šæ‹¥æœ‰keys çš„å¯¹åº”ç»“æžœã€‚ä¸€ä¸ªéžå¸¸ç®€å•çš„ä¾‹å­æ˜¯æ‰§è¡ŒKEYSå‘½ä»¤ï¼Œå½“å‘å¸ƒè¯¥å‘½ä»¤åˆ°é›†ç¾¤çŽ¯å¢ƒä¸­çš„æŸä¸ªèŠ‚æ—¶ï¼Œåªèƒ½å¾—åˆ°è¯¥èŠ‚ç‚¹ä¸Šæ‹¥æœ‰çš„keysï¼Œè€Œä¸æ˜¯é›†ç¾¤ä¸­æ‰€æœ‰çš„keysã€‚æ‰€ä»¥è¦å¾—åˆ°é›†ç¾¤ä¸­æ‰€æœ‰çš„keysï¼Œå¿…é¡»ä»Žé›†ç¾¤çš„æ‰€æœ‰ä¸»èŠ‚ç‚¹ä¸ŠèŽ·å–æ‰€æœ‰çš„keysã€‚ å¯¹äºŽåˆ†æ•£åœ¨redisé›†ç¾¤ä¸­ä¸åŒèŠ‚ç‚¹çš„æ•°æ®ï¼Œæˆ‘ä»¬å¦‚ä½•æ¯”è¾ƒé«˜æ•ˆåœ°æ‰¹é‡èŽ·å–æ•°æ®å‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ä¸²è¡Œmgetâ€“åŽŸå§‹æ–¹æ¡ˆï¼Œæ•´ä¸€ä¸ªforå¾ªçŽ¯ ä¸²è¡ŒIO å¯¹keyè¿›è¡ŒRCR16å’Œå–ä½™æ“ä½œå¾—åˆ°slotï¼Œå°†slotsæŒ‰ç…§èŠ‚ç‚¹è¿›è¡Œåˆ†æ‰¹ä¼ é€ï¼š å¹¶è¡ŒIO hash_tag ä¸åšä»»ä½•æ”¹å˜çš„è¯ï¼Œhashä¹‹åŽå°±æ¯”è¾ƒå‡åŒ€åœ°æ•£åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼š é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½åƒä½¿ç”¨å•æœºredisä¸€æ ·ï¼Œä¸€æ¬¡IOå°†æ‰€æœ‰çš„keyå–å‡ºæ¥å‘¢ï¼Ÿhash-tagæä¾›äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œå¦‚æžœå°†ä¸Šè¿°çš„keyæ”¹ä¸ºå¦‚ä¸‹ï¼Œä¹Ÿå°±æ˜¯ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥ç›¸åŒçš„å†…å®¹ï¼Œé‚£ä¹ˆè¿™äº›keyå°±ä¼šåˆ°æŒ‡å®šçš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ åœ¨mgetçš„æ—¶å€™åªéœ€è¦åœ¨ä¸€å°æœºå™¨ä¸ŠåŽ»å³å¯ã€‚ å¯¹æ¯” æ–¹æ¡ˆä¸‰æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬ä¸ç”¨ï¼›æ–¹æ¡ˆå››å¯èƒ½ä¼šå‡ºçŽ°æ•°æ®å€¾æ–œï¼Œä¹Ÿä¸ç”¨ã€‚æ–¹æ¡ˆä¸€åœ¨keyå°çš„æ—¶å€™å¯ä»¥ç”¨ï¼›æ–¹æ¡ˆäºŒç›¸å¯¹æ¥è¯´æœ‰ä¸€ç‚¹ä¼˜åŠ¿ï¼› ä¸ºä»€ä¹ˆè¯´æ˜¯ä¸€ç‚¹ä¼˜åŠ¿å‘¢ï¼Ÿpipelineæ‰¹é‡å¤„ç†ä¸åº”è¯¥æ¯”ä¸²è¡Œå¤„ç†å¥½å¾ˆå¤šå—ï¼Ÿ http://xiezefan.me/2015/12/13/redis_cluster_research_2/ http://trumandu.github.io/2016/05/09/RedisClusteræž„å»ºæ‰¹é‡æ“ä½œæŽ¢è®¨/ 9. æ•…éšœè½¬ç§» 9.1 æ•…éšœå‘çŽ° é€šè¿‡ping/pongæ¶ˆæ¯å®žçŽ°æ•…éšœå‘çŽ°ï¼šä¸éœ€è¦sentinel åˆ†ä¸ºä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ ä¸»è§‚ä¸‹çº¿ï¼š å®¢è§‚ä¸‹çº¿ï¼š pfailæ¶ˆæ¯å°±æ˜¯ä¸»è§‚ä¸‹çº¿çš„ä¿¡æ¯ï¼Œç»´æŠ¤åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œé“¾è¡¨ä¸­åŒ…å«äº†æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å¯¹å…¶ä»–èŠ‚ç‚¹æ‰€æœ‰çš„ä¸»è§‚ä¿¡æ¯ï¼Œæ˜¯æœ‰æ—¶é—´å‘¨æœŸçš„ï¼Œä¸ºäº†é˜²æ­¢å¾ˆæ—©ä»¥å‰çš„ä¸»è§‚ä¸‹çº¿ä¿¡æ¯è¿˜æ®‹ç•™åœ¨è¿™é‡Œã€‚å¯¹è¿™ä¸ªé“¾è¡¨è¿›è¡Œåˆ†æžï¼Œç¬¦åˆæ¡ä»¶å°±å°è¯•å®¢è§‚ä¸‹çº¿ã€‚ 9.2 æ•…éšœæ¢å¤ ä»ŽèŠ‚ç‚¹æŽ¥æ”¶åˆ°ä»–çš„ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿çš„é€šçŸ¥ï¼Œåˆ™è¿›è¡Œæ•…éšœæ¢å¤çš„æ“ä½œã€‚ èµ„æ ¼æ£€æŸ¥ é€‰å–å‡ºç¬¦åˆæ¡ä»¶çš„ä»ŽèŠ‚ç‚¹ï¼šå½“ä»ŽèŠ‚ç‚¹å’Œæ•…éšœä¸»èŠ‚ç‚¹çš„æ–­çº¿æ—¶é—´å¤ªé•¿ï¼Œä¼šè¢«å–æ¶ˆèµ„æ ¼ã€‚ å‡†å¤‡é€‰ä¸¾æ—¶é—´ å°±æ˜¯ä¸ºäº†ä¿è¯åç§»é‡å¤§çš„ä»ŽèŠ‚ç‚¹ä¼˜å…ˆè¢«é€‰ä¸¾æŠ•ç¥¨ é€‰ä¸¾æŠ•ç¥¨ æ›¿æ¢ä¸»èŠ‚ç‚¹ è¿™äº›æ‰€æœ‰æ­¥éª¤åŠ èµ·æ¥ï¼Œå·®ä¸å¤šåå‡ ç§’å·¦å³ã€‚æœ€åŽå¦‚æžœæ•…éšœèŠ‚ç‚¹åˆæ¢å¤åŠŸèƒ½äº†ï¼Œå°±ç§°ä¸ºæ–°çš„Masterçš„slaveèŠ‚ç‚¹ã€‚ 10. å¸¸è§é—®é¢˜ 10.1 é›†ç¾¤å®Œæ•´æ€§ cluster-require-full-coverageé»˜è®¤ä¸ºyes - è¦æ±‚æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨æœåŠ¡ï¼Œé›†ç¾¤ä¸­16384ä¸ªæ§½å…¨éƒ¨å¯ç”¨ï¼šä¿è¯é›†ç¾¤å®Œæ•´æ€§ - èŠ‚ç‚¹æ•…éšœæˆ–è€…æ­£åœ¨æ•…éšœè½¬ç§»ï¼š`(error)CLUSTERDOWN the cluster is down` ä½†æ˜¯å¤§å¤šæ•°ä¸šåŠ¡éƒ½æ— æ³•å®¹å¿ã€‚éœ€è¦å°†cluster-require-full-coverageè®¾ç½®ä¸ºno 10.2 å¸¦å®½æ¶ˆè€— æ¶ˆæ¯å‘é€é¢‘çŽ‡ï¼šèŠ‚ç‚¹å‘çŽ°ä¸Žå…¶ä»–èŠ‚ç‚¹æœ€åŽé€šä¿¡æ—¶é—´è¶…è¿‡cluster-node-timeout/2æ—¶ä¼šç›´æŽ¥å‘é€Pingæ¶ˆæ¯ æ¶ˆæ¯æ•°æ®é‡ï¼šslotsæ§½æ•°ç»„(2kç©ºé—´)å’Œæ•´ä¸ªé›†ç¾¤1ã€10çš„çŠ¶æ€æ•°æ®(10ä¸ªèŠ‚ç‚¹çŠ¶æ€æ•°æ®çº¦10k) èŠ‚ç‚¹éƒ¨ç½²çš„æœºå™¨è§„æ¨¡ï¼šè¿›åŽ»åˆ†å¸ƒçš„æœºå™¨è¶Šå¤šä¸”æ¯å°æœºå™¨åˆ’åˆ†çš„èŠ‚ç‚¹æ•°è¶Šå‡åŒ€ï¼Œåˆ™é›†ç¾¤å†…æ•´ä½“çš„å¯ç”¨å¸¦å®½è¶Šé«˜ã€‚ ä¼˜åŒ–ï¼šé¿å…â€œå¤§â€é›†ç¾¤ï¼Œï¼šé¿å…å¤šä¸šåŠ¡ä½¿ç”¨ä¸€ä¸ªé›†ç¾¤ï¼Œå¤§ä¸šåŠ¡å¯ç”¨å¤šé›†ç¾¤ï¼›cluster-node-timeoutæ—¶é—´è®¾ç½®è¦æ³¨æ„æ˜¯å¸¦å®½å’Œæ•…éšœè½¬ç§»é€Ÿåº¦çš„å‡è¡¡ï¼›å°½é‡å‡åŒ€åˆ†é…åˆ°å¤šæœºå™¨ä¸Šï¼šä¿è¯é«˜å¯ç”¨å’Œå¸¦å®½ã€‚ 10.3 PubSubå¹¿æ’­ é—®é¢˜ï¼špublishåœ¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹å¹¿æ’­ï¼šåŠ é‡å¸¦å®½ã€‚ è§£å†³ï¼šå•ç‹¬â€œèµ°â€ä¸€å¥—redis sentinelã€‚å°±æ˜¯é’ˆå¯¹ç›®æ ‡çš„å‡ ä¸ªèŠ‚ç‚¹æž„å»ºredis sentinelï¼Œåœ¨è¿™ä¸ªé‡Œé¢å®žçŽ°å¹¿æ’­ã€‚ 10.4 æ•°æ®å€¾æ–œ èŠ‚ç‚¹å’Œæ§½åˆ†é…ä¸å‡åŒ€ ./redis-trib.rb info ip:portæŸ¥çœ‹èŠ‚ç‚¹ã€æ§½ã€é”®å€¼åˆ†å¸ƒ æ…Žç”¨rebalanceå‘½ä»¤ ä¸åŒæ§½ä½å¯¹åº”é”®æ•°é‡å·®å¼‚è¾ƒå¤§ CRC16æ­£å¸¸æƒ…å†µä¸‹æ¯”è¾ƒå‡åŒ€ å¯èƒ½å­˜åœ¨hash_tag cluster countKeysinslot {slot}èŽ·å–æ§½å¯¹åº”é”®å€¼ä¸ªæ•° åŒ…å«bigkey ä¾‹å¦‚å¤§å­—ç¬¦ä¸²ã€å‡ ç™¾ä¸‡çš„å…ƒç´ çš„hashã€setç­‰ åœ¨ä»ŽèŠ‚ç‚¹ä¸Šæ‰§è¡Œ:redis-cli --bigkeysæ¥æŸ¥çœ‹bigkeyæƒ…å†µ ä¼˜åŒ–ï¼šä¼˜åŒ–æ•°æ®ç»“æž„ å†…å­˜ç›¸å…³é…ç½®ä¸ä¸€è‡´ å› ä¸ºæŸç§æƒ…å†µä¸‹ï¼ŒæŸä¸ªèŠ‚ç‚¹å¯¹hashæˆ–è€…Setè¿™ç§æ•°æ®ç»“æž„è¿›è¡Œäº†å•ç‹¬çš„ä¼˜åŒ–ï¼Œè€Œå…¶ä»–èŠ‚ç‚¹éƒ½æ²¡æœ‰é…ç½®ï¼Œä¼šå‡ºçŽ°é…ç½®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ 10.5 è¯·æ±‚å€¾æ–œ çƒ­ç‚¹keyï¼šé‡è¦çš„keyæˆ–è€…bigkey ä¼˜åŒ–ï¼šé¿å…bigkey;çƒ­é”®ä¸ä½¿ç”¨hash_tagï¼›å½“ä¸€è‡´æ€§ä¸é«˜æ—¶ï¼Œå¯ä»¥ç”¨æœ¬åœ°ç¼“å­˜+MQ 10.6 è¯»å†™åˆ†ç¦» åªè¯»è¿žæŽ¥ï¼šé›†ç¾¤æ¨¡å¼çš„ä»ŽèŠ‚ç‚¹ä¸æŽ¥å—ä»»ä½•è¯»å†™è¯·æ±‚ é‡å®šå‘åˆ°è´Ÿè´£æ§½çš„ä¸»èŠ‚ç‚¹(å¯¹ä»ŽèŠ‚ç‚¹è¿›è¡Œè¯»ï¼Œéƒ½æ˜¯é‡å®šå‘åˆ°ä¸»èŠ‚ç‚¹å†è¿”å›žä¿¡æ¯) readonlyå‘½ä»¤å¯ä»¥è¯»ï¼šè¿žæŽ¥çº§åˆ«å‘½ä»¤(æ¯æ¬¡é‡æ–°è¿žæŽ¥éƒ½è¦å†™ä¸€æ¬¡) ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œredis cluster é»˜è®¤slave ä¹Ÿæ˜¯ä¸èƒ½è¯»çš„ï¼Œå¦‚æžœè¦è¯»å–ï¼Œéœ€è¦æ‰§è¡Œ readonlyï¼Œå°±å¯ä»¥äº†ã€‚ è¯»å†™åˆ†ç¦»ï¼šæ›´åŠ å¤æ‚ï¼ˆæˆæœ¬å¾ˆé«˜ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ï¼‰ åŒæ ·çš„é—®é¢˜ï¼šå¤åˆ¶å»¶è¿Ÿã€è¯»å–è¿‡æœŸæ•°æ®ã€ä»ŽèŠ‚ç‚¹æ•…éšœ ä¿®æ”¹å®¢æˆ·ç«¯ 10.7 æ•°æ®è¿ç§» åˆ†ä¸ºç¦»çº¿è¿ç§»å’Œåœ¨çº¿è¿ç§»(å”¯å“ä¼šredis-migrate-toolå’Œè±Œè±†èšredis-port)ã€‚ å®˜æ–¹çš„æ–¹å¼ï¼šåªèƒ½ä»Žå•æœºè¿ç§»åˆ°é›†ç¾¤ã€ä¸æ”¯æŒåœ¨çº¿è¿ç§»ã€ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ ã€å•çº¿ç¨‹è¿ç§»å½±å“é€Ÿåº¦ ./redis-trib.rb import --from æºip:port --copy ç›®æ ‡ip:port åŠ å…¥åœ¨è¿ç§»æ—¶å†å¾€æºredisæ’å…¥å‡ æ¡æ•°æ®ï¼Œè¿™å‡ æ¡æ•°æ®ä¼šä¸¢å¤±(ä¸¢å¤±ä¸€éƒ¨åˆ†) 10.8 é›†ç¾¤vså•æœº é›†ç¾¤ä¹Ÿæœ‰ä¸€å®šçš„é™åˆ¶ï¼š åˆ†å¸ƒå¼redisä¸ä¸€å®šæ˜¯å¥½çš„ï¼š 11. ç®€å•æ€»ç»“]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç®€æ˜Žç†è§£ä¸€è‡´æ€§hashç®—æ³•]]></title>
    <url>%2F2019%2F02%2F01%2Fmiscellany%2F15%E7%AE%80%E6%98%8E%E7%90%86%E8%A7%A3%E4%B8%80%E8%87%B4%E6%80%A7hash%E7%AE%97%E6%B3%95%2F</url>
    <content type="text"><![CDATA[åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­ï¼Œå¯¹æœºå™¨çš„æ·»åŠ åˆ é™¤ï¼Œæˆ–è€…æœºå™¨æ•…éšœåŽè‡ªåŠ¨è„±ç¦»é›†ç¾¤è¿™äº›æ“ä½œæ˜¯åˆ†å¸ƒå¼é›†ç¾¤ç®¡ç†æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚å¦‚æžœé‡‡ç”¨å¸¸ç”¨çš„hash(object)%Nç®—æ³•ï¼Œé‚£ä¹ˆåœ¨æœ‰æœºå™¨æ·»åŠ æˆ–è€…åˆ é™¤åŽï¼Œå¾ˆå¤šåŽŸæœ‰çš„æ•°æ®å°±æ— æ³•æ‰¾åˆ°äº†ï¼Œè¿™æ ·ä¸¥é‡çš„è¿åäº†å•è°ƒæ€§åŽŸåˆ™ã€‚æŽ¥ä¸‹æ¥ä¸»è¦è®²è§£ä¸€ä¸‹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å¦‚ä½•è®¾è®¡çš„ã€‚ çŽ¯å½¢Hashç©ºé—´ æŒ‰ç…§å¸¸ç”¨çš„hashç®—æ³•æ¥å°†å¯¹åº”çš„keyå“ˆå¸Œåˆ°ä¸€ä¸ªå…·æœ‰2^32 æ¬¡æ–¹ä¸ªæ¡¶çš„ç©ºé—´ä¸­ï¼Œå³0~(2^32)-1çš„æ•°å­—ç©ºé—´ä¸­ã€‚çŽ°åœ¨æˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ•°å­—å¤´å°¾ç›¸è¿žï¼Œæƒ³è±¡æˆä¸€ä¸ªé—­åˆçš„çŽ¯å½¢ã€‚å¦‚ä¸‹å›¾ æŠŠæ•°æ®é€šè¿‡ä¸€å®šçš„hashç®—æ³•å¤„ç†åŽæ˜ å°„åˆ°çŽ¯ä¸Š çŽ°åœ¨æˆ‘ä»¬å°†object1ã€object2ã€object3ã€object4å››ä¸ªå¯¹è±¡é€šè¿‡ç‰¹å®šçš„Hashå‡½æ•°è®¡ç®—å‡ºå¯¹åº”çš„keyå€¼ï¼Œç„¶åŽæ•£åˆ—åˆ°HashçŽ¯ä¸Šã€‚å¦‚ä¸‹å›¾ï¼š 1234Hash(object1) = key1ï¼›Hash(object2) = key2ï¼›Hash(object3) = key3ï¼›Hash(object4) = key4ï¼› å°†æœºå™¨é€šè¿‡hashç®—æ³•æ˜ å°„åˆ°çŽ¯ä¸Š åœ¨é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åˆ†å¸ƒå¼é›†ç¾¤ä¸­å°†æ–°çš„æœºå™¨åŠ å…¥ï¼Œå…¶åŽŸç†æ˜¯é€šè¿‡ä½¿ç”¨ä¸Žå¯¹è±¡å­˜å‚¨ä¸€æ ·çš„Hashç®—æ³•å°†æœºå™¨ä¹Ÿæ˜ å°„åˆ°çŽ¯ä¸­ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹å¯¹æœºå™¨çš„hashè®¡ç®—æ˜¯é‡‡ç”¨æœºå™¨çš„IPæˆ–è€…æœºå™¨å”¯ä¸€çš„åˆ«åä½œä¸ºè¾“å…¥å€¼ï¼‰ï¼Œç„¶åŽä»¥é¡ºæ—¶é’ˆçš„æ–¹å‘è®¡ç®—ï¼Œå°†æ‰€æœ‰å¯¹è±¡å­˜å‚¨åˆ°ç¦»è‡ªå·±æœ€è¿‘çš„æœºå™¨ä¸­ã€‚ å‡è®¾çŽ°åœ¨æœ‰NODE1ï¼ŒNODE2ï¼ŒNODE3ä¸‰å°æœºå™¨ï¼Œé€šè¿‡Hashç®—æ³•å¾—åˆ°å¯¹åº”çš„KEYå€¼ï¼Œæ˜ å°„åˆ°çŽ¯ä¸­ï¼Œå…¶ç¤ºæ„å›¾å¦‚ä¸‹ï¼š 123Hash(NODE1) = KEY1;Hash(NODE2) = KEY2;Hash(NODE3) = KEY3; é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹å‡ºå¯¹è±¡ä¸Žæœºå™¨å¤„äºŽåŒä¸€å“ˆå¸Œç©ºé—´ä¸­ï¼Œè¿™æ ·æŒ‰é¡ºæ—¶é’ˆè½¬åŠ¨object1å­˜å‚¨åˆ°äº†NODE1ä¸­ï¼Œobject3å­˜å‚¨åˆ°äº†NODE2ä¸­ï¼Œobject2ã€object4å­˜å‚¨åˆ°äº†NODE3ä¸­ã€‚åœ¨è¿™æ ·çš„éƒ¨ç½²çŽ¯å¢ƒä¸­ï¼ŒhashçŽ¯æ˜¯ä¸ä¼šå˜æ›´çš„ï¼Œå› æ­¤ï¼Œé€šè¿‡ç®—å‡ºå¯¹è±¡çš„hashå€¼å°±èƒ½å¿«é€Ÿçš„å®šä½åˆ°å¯¹åº”çš„æœºå™¨ä¸­ï¼Œè¿™æ ·å°±èƒ½æ‰¾åˆ°å¯¹è±¡çœŸæ­£çš„å­˜å‚¨ä½ç½®äº†ã€‚ æœºå™¨çš„åˆ é™¤ä¸Žæ·»åŠ  æ™®é€šhashæ±‚ä½™ç®—æ³•æœ€ä¸ºä¸å¦¥çš„åœ°æ–¹å°±æ˜¯åœ¨æœ‰æœºå™¨çš„æ·»åŠ æˆ–è€…åˆ é™¤ä¹‹åŽä¼šç…§æˆå¤§é‡çš„å¯¹è±¡å­˜å‚¨ä½ç½®å¤±æ•ˆï¼Œè¿™æ ·å°±å¤§å¤§çš„ä¸æ»¡è¶³å•è°ƒæ€§äº†ã€‚ä¸‹é¢æ¥åˆ†æžä¸€ä¸‹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚ èŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰çš„åˆ é™¤ ä»¥ä¸Šé¢çš„åˆ†å¸ƒä¸ºä¾‹ï¼Œå¦‚æžœNODE2å‡ºçŽ°æ•…éšœè¢«åˆ é™¤äº†ï¼Œé‚£ä¹ˆæŒ‰ç…§é¡ºæ—¶é’ˆè¿ç§»çš„æ–¹æ³•ï¼Œobject3å°†ä¼šè¢«è¿ç§»åˆ°NODE3ä¸­ï¼Œè¿™æ ·ä»…ä»…æ˜¯object3çš„æ˜ å°„ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œå…¶å®ƒçš„å¯¹è±¡æ²¡æœ‰ä»»ä½•çš„æ”¹åŠ¨ã€‚å¦‚ä¸‹å›¾ï¼š èŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰çš„æ·»åŠ  å¦‚æžœå¾€é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹NODE4ï¼Œé€šè¿‡å¯¹åº”çš„å“ˆå¸Œç®—æ³•å¾—åˆ°KEY4ï¼Œå¹¶æ˜ å°„åˆ°çŽ¯ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š é€šè¿‡æŒ‰é¡ºæ—¶é’ˆè¿ç§»çš„è§„åˆ™ï¼Œé‚£ä¹ˆobject2è¢«è¿ç§»åˆ°äº†NODE4ä¸­ï¼Œå…¶å®ƒå¯¹è±¡è¿˜ä¿æŒè¿™åŽŸæœ‰çš„å­˜å‚¨ä½ç½®ã€‚é€šè¿‡å¯¹èŠ‚ç‚¹çš„æ·»åŠ å’Œåˆ é™¤çš„åˆ†æžï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨ä¿æŒäº†å•è°ƒæ€§çš„åŒæ—¶ï¼Œè¿˜æ˜¯æ•°æ®çš„è¿ç§»è¾¾åˆ°äº†æœ€å°ï¼Œè¿™æ ·çš„ç®—æ³•å¯¹åˆ†å¸ƒå¼é›†ç¾¤æ¥è¯´æ˜¯éžå¸¸åˆé€‚çš„ï¼Œé¿å…äº†å¤§é‡æ•°æ®è¿ç§»ï¼Œå‡å°äº†æœåŠ¡å™¨çš„çš„åŽ‹åŠ›ã€‚ å¹³è¡¡æ€§ æ ¹æ®ä¸Šé¢çš„å›¾è§£åˆ†æžï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ»¡è¶³äº†å•è°ƒæ€§å’Œè´Ÿè½½å‡è¡¡çš„ç‰¹æ€§ä»¥åŠä¸€èˆ¬hashç®—æ³•çš„åˆ†æ•£æ€§ï¼Œä½†è¿™è¿˜å¹¶ä¸èƒ½å½“åšå…¶è¢«å¹¿æ³›åº”ç”¨çš„åŽŸç”±ï¼Œå› ä¸ºè¿˜ç¼ºå°‘äº†å¹³è¡¡æ€§ã€‚ä¸‹é¢å°†åˆ†æžä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å¦‚ä½•æ»¡è¶³å¹³è¡¡æ€§çš„ã€‚ hashç®—æ³•æ˜¯ä¸ä¿è¯å¹³è¡¡çš„ï¼Œå¦‚ä¸Šé¢åªéƒ¨ç½²äº†NODE1å’ŒNODE3çš„æƒ…å†µï¼ˆNODE2è¢«åˆ é™¤çš„å›¾ï¼‰ï¼Œobject1å­˜å‚¨åˆ°äº†NODE1ä¸­ï¼Œè€Œobject2ã€object3ã€object4éƒ½å­˜å‚¨åˆ°äº†NODE3ä¸­ï¼Œè¿™æ ·å°±ç…§æˆäº†éžå¸¸ä¸å¹³è¡¡çš„çŠ¶æ€ã€‚åœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œä¸ºäº†å°½å¯èƒ½çš„æ»¡è¶³å¹³è¡¡æ€§ï¼Œå…¶å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹ã€‚ â€œè™šæ‹ŸèŠ‚ç‚¹â€ï¼ˆ virtual node ï¼‰æ˜¯å®žé™…èŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰åœ¨ hash ç©ºé—´çš„å¤åˆ¶å“ï¼ˆ replica ï¼‰ï¼Œä¸€å®žé™…ä¸ªèŠ‚ç‚¹ï¼ˆæœºå™¨ï¼‰å¯¹åº”äº†è‹¥å¹²ä¸ªâ€œè™šæ‹ŸèŠ‚ç‚¹â€ï¼Œè¿™ä¸ªå¯¹åº”ä¸ªæ•°ä¹Ÿæˆä¸ºâ€œå¤åˆ¶ä¸ªæ•°â€ï¼Œâ€œè™šæ‹ŸèŠ‚ç‚¹â€åœ¨ hash ç©ºé—´ä¸­ä»¥hashå€¼æŽ’åˆ—ã€‚ ä»¥ä¸Šé¢åªéƒ¨ç½²äº†NODE1å’ŒNODE3çš„æƒ…å†µï¼ˆNODE2è¢«åˆ é™¤çš„å›¾ï¼‰ä¸ºä¾‹ï¼Œä¹‹å‰çš„å¯¹è±¡åœ¨æœºå™¨ä¸Šçš„åˆ†å¸ƒå¾ˆä¸å‡è¡¡ï¼ŒçŽ°åœ¨æˆ‘ä»¬ä»¥2ä¸ªå‰¯æœ¬ï¼ˆå¤åˆ¶ä¸ªæ•°ï¼‰ä¸ºä¾‹ï¼Œè¿™æ ·æ•´ä¸ªhashçŽ¯ä¸­å°±å­˜åœ¨äº†4ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œæœ€åŽå¯¹è±¡æ˜ å°„çš„å…³ç³»å›¾å¦‚ä¸‹ï¼š æ ¹æ®ä¸Šå›¾å¯çŸ¥å¯¹è±¡çš„æ˜ å°„å…³ç³»ï¼šobject1-&gt;NODE1-1ï¼Œobject2-&gt;NODE1-2ï¼Œobject3-&gt;NODE3-2ï¼Œobject4-&gt;NODE3-1ã€‚é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹çš„å¼•å…¥ï¼Œå¯¹è±¡çš„åˆ†å¸ƒå°±æ¯”è¾ƒå‡è¡¡äº†ã€‚é‚£ä¹ˆåœ¨å®žé™…æ“ä½œä¸­ï¼ŒçœŸæ­£çš„å¯¹è±¡æŸ¥è¯¢æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿå¯¹è±¡ä»Žhashåˆ°è™šæ‹ŸèŠ‚ç‚¹åˆ°å®žé™…èŠ‚ç‚¹çš„è½¬æ¢å¦‚ä¸‹å›¾ï¼š â€œè™šæ‹ŸèŠ‚ç‚¹â€çš„hashè®¡ç®—å¯ä»¥é‡‡ç”¨å¯¹åº”èŠ‚ç‚¹çš„IPåœ°å€åŠ æ•°å­—åŽç¼€çš„æ–¹å¼ã€‚ä¾‹å¦‚å‡è®¾NODE1çš„IPåœ°å€ä¸º192.168.1.100ã€‚å¼•å…¥â€œè™šæ‹ŸèŠ‚ç‚¹â€å‰ï¼Œè®¡ç®— cache A çš„ hash å€¼ï¼š 1Hash(â€œ192.168.1.100â€); å¼•å…¥â€œè™šæ‹ŸèŠ‚ç‚¹â€åŽï¼Œè®¡ç®—â€œè™šæ‹ŸèŠ‚â€ç‚¹NODE1-1å’ŒNODE1-2çš„hashå€¼ä¸ºï¼š 12Hash(â€œ192.168.1.100#1â€); // NODE1-1Hash(â€œ192.168.1.100#2â€); // NODE1-2 æ•´ç†è‡ªï¼š äº”åˆ†é’Ÿç†è§£ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis-Sentinelå®žçŽ°é«˜å¯ç”¨è¯»å†™åˆ†ç¦»]]></title>
    <url>%2F2019%2F02%2F01%2Fredis%2FRedis-Sentinel%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%8F%AF%E7%94%A8%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬ä¸ƒç¯‡æ–‡ç« ã€‚Redis Sentinel æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªæž¶æž„ä¸­è¿è¡Œå¤šä¸ª Sentinel è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹ä½¿ç”¨æµè¨€åè®®ï¼ˆgossip protocols)æ¥æŽ¥æ”¶å…³äºŽä¸»æœåŠ¡å™¨æ˜¯å¦ä¸‹çº¿çš„ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨æŠ•ç¥¨åè®®ï¼ˆagreement protocolsï¼‰æ¥å†³å®šæ˜¯å¦æ‰§è¡Œè‡ªåŠ¨æ•…éšœè¿ç§»ï¼Œä»¥åŠé€‰æ‹©å“ªä¸ªä»ŽæœåŠ¡å™¨ä½œä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚ è™½ç„¶ Redis Sentinel æ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯æ‰§è¡Œæ–‡ä»¶ redis-sentinel ï¼Œä½†å®žé™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis æœåŠ¡å™¨ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ä¸€ä¸ªæ™®é€š Redis æœåŠ¡å™¨æ—¶é€šè¿‡ç»™å®š â€“sentinel é€‰é¡¹æ¥å¯åŠ¨ Redis Sentinel ã€‚ å¯åŠ¨æ–¹å¼ä¸€ï¼šä½¿ç”¨sentinelå¯æ‰§è¡Œæ–‡ä»¶ redis-sentinel ç¨‹åºæ¥å¯åŠ¨ Sentinel ç³»ç»Ÿï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 1redis-sentinel /path/to/sentinel.conf sentinelåªæ˜¯è¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„redisæœåŠ¡å™¨ï¼Œä½ å¯ä»¥ç”¨å¯åŠ¨redisæœåŠ¡çš„å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªè¿è¡Œåœ¨ Sentinel æ¨¡å¼ä¸‹çš„ Redis æœåŠ¡å™¨ï¼š 1redis-server /path/to/sentinel.conf --sentinel 1. redis sentinel é¦–å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ redis sentinelï¼Œä¸­æ–‡ç¿»è¯‘æ˜¯rediså“¨å…µã€‚é¡¾åæ€ä¹‰ï¼Œå“¨å…µæ˜¯ç«™å²—ç›‘ç£çªå‘æƒ…å†µçš„ï¼Œé‚£ä¹ˆè¿™é‡Œå…·ä½“çš„åŠŸèƒ½ä¸Šå¾ˆç±»ä¼¼ï¼š ç›‘æŽ§ï¼šSentinel ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„ä¸»æœåŠ¡å™¨å’Œä»ŽæœåŠ¡å™¨æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ æé†’ï¼šå½“è¢«ç›‘æŽ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºçŽ°é—®é¢˜æ—¶ï¼ŒSentinel å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚ è‡ªåŠ¨æ•…éšœè¿ç§»ï¼šå½“ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼ŒSentinel ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä¸­ä¸€ä¸ªä»ŽæœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ï¼Œå¹¶è®©å¤±æ•ˆä¸»æœåŠ¡å™¨çš„å…¶ä»–ä»ŽæœåŠ¡å™¨æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»æœåŠ¡å™¨ï¼›å½“å®¢æˆ·ç«¯è¯•å›¾è¿žæŽ¥å¤±æ•ˆçš„ä¸»æœåŠ¡å™¨æ—¶ï¼Œé›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›žæ–°ä¸»æœåŠ¡å™¨çš„åœ°å€ï¼Œä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨æ–°ä¸»æœåŠ¡å™¨ä»£æ›¿å¤±æ•ˆæœåŠ¡å™¨ã€‚ å…¶ä¸­æ€»ç»“ä¸€ä¸‹æ•…éšœè½¬ç§»çš„åŸºæœ¬åŽŸç†ï¼š å¤šä¸ªsentinelå‘çŽ°å¹¶ç¡®è®¤masteræœ‰é—®é¢˜ é€‰ä¸¾å‡ºä¸€ä¸ªsentinelä½œä¸ºé¢†å¯¼ é€‰å‡ºä¸€ä¸ªå¯ä»¥æˆä¸ºæ–°çš„masterçš„slave é€šçŸ¥å…¶ä»–çš„slaveç§°ä¸ºæ–°çš„masterçš„slave é€šçŸ¥å®¢æˆ·ç«¯ä¸»ä»Žå˜åŒ– ç­‰å¾…è€çš„masterå¤æ´»ç§°ä¸ºæ–°çš„masterçš„slave ä¹Ÿæ”¯æŒå¤šä¸ªmaster-slaveç»“æž„ï¼š 2. å®‰è£…ä¸Žé…ç½® é…ç½®å¼€å¯ä¸»ä»ŽèŠ‚ç‚¹ é…ç½®å¼€å¯sentinelç›‘æŽ§ä¸»èŠ‚ç‚¹ï¼ˆsentinelæ˜¯ç‰¹æ®Šçš„redisï¼‰ å®žé™…åº”è¯¥å¤šå°æœºå™¨ï¼Œä½†æ˜¯æ¼”ç¤ºæ–¹ä¾¿ï¼Œåªç”¨ä¸€å°æœºå™¨æ¥æ­å»º è¯¦ç»†é…ç½®èŠ‚ç‚¹ æœ¬åœ°å®‰è£…çš„ç»“æž„å›¾ï¼š å¯¹äºŽmaster:redis-7000.confé…ç½®ï¼š 12345port 7000daemonize yespidfile /usr/local/redis/data/redis-7000.pidlogfile &quot;7000.log&quot;dir &quot;/usr/local/redis/data&quot; å¯¹äºŽslave:redis-7001å’Œredis-7002é…ç½®ï¼š 123456port 7001daemonize yespidfile /usr/local/redis/data/redis-7001.pidlogfile &quot;7001.log&quot;dir &quot;/usr/local/redis/data&quot;slaveof 127.0.0.1 7000 å¯åŠ¨redisæœåŠ¡ï¼š 1redis-server ../config/redis-7000.conf è®¿é—®7000ç«¯å£çš„master redis: 1redis-cli -p 7000 info replication æ˜¾ç¤ºä»–æœ‰ä¸¤ä¸ªä»ŽèŠ‚ç‚¹ï¼š 12345678910# Replicationrole:masterconnected_slaves:2slave0:ip=127.0.0.1,port=7002,state=online,offset=99550,lag=1slave1:ip=127.0.0.1,port=7001,state=online,offset=99816,lag=0master_repl_offset:99816repl_backlog_active:1repl_backlog_size:1048576repl_backlog_first_byte_offset:2repl_backlog_histlen:99815 å¯¹äºŽsentinelä¸»è¦é…ç½®ï¼š master sentinel config: 123456port 26379daemonize yesdir &quot;/usr/local/redis/data&quot;logfile &quot;26379.log&quot;sentinel monitor mymaster 127.0.0.1 7000 2... å¯åŠ¨redis sentinel: 1redis-sentinel ../config/redis-sentinel-26379.conf è®¿é—®26379 redis sentinel master: 1redis-cli -p 26379 info sentinel æ˜¾ç¤ºï¼š 123456# Sentinelsentinel_masters:1sentinel_tilt:0sentinel_running_scripts:0sentinel_scripts_queue_length:0master0:name=mymaster,status=ok,address=127.0.0.1:7000,slaves=2,sentinels=3 1æŸ¥çœ‹è¿™å…­ä¸ªè¿›ç¨‹æ˜¯å¦éƒ½èµ·æ¥äº†ï¼šps -ef | grep redis æ³¨æ„ï¼Œå¦‚æžœä¸Šé¢æ˜¯é…ç½®åœ¨è™šæ‹Ÿæœºçš„è¯ï¼Œéœ€è¦å°†127.0.0.1æ”¹ä¸ºè™šæ‹Ÿæœºçš„ipï¼Œè¦ä¸ç„¶æ‰¾ä¸ç€ã€‚ 3. æ•…éšœè½¬ç§»æ¼”ç»ƒ 3.1 javaå®¢æˆ·ç«¯ç¨‹åº JedisSentinelPoolåªæ˜¯ä¸€ä¸ªé…ç½®ä¸­å¿ƒï¼Œä¸éœ€è¦å…·ä½“è¿žæŽ¥æŸä¸ªredisï¼Œæ³¨æ„å®ƒä¸æ˜¯ä»£ç†ã€‚ 1234567891011121314151617181920212223242526272829303132333435private Logger logger = LoggerFactory.getLogger(AppTest.class);@Testpublic void test4()&#123; //å“¨å…µé…ç½®ï¼Œæˆ‘ä»¬è®¿é—®redisï¼Œå°±é€šè¿‡sentinelæ¥è®¿é—® String masername = "mymaster"; Set&lt;String&gt; sentinels = new HashSet&lt;&gt;(); sentinels.add("10.128.24.176:26379"); sentinels.add("10.128.24.176:26380"); sentinels.add("10.128.24.176:26381"); JedisSentinelPool sentinelPool = new JedisSentinelPool(masername,sentinels); //ä¸€ä¸ªwhileæ­»å¾ªçŽ¯ï¼Œæ¯éš”ä¸€ç§’å¾€masterå¡žå…¥ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”æ—¥å¿—æ‰“å° while (true)&#123; Jedis jedis = null; try&#123; jedis = sentinelPool.getResource(); int index = new Random().nextInt(100000); String key = "k-" + index; String value = "v-" + index; jedis.set(key,value); logger.info("&#123;&#125; value is &#123;&#125;",key,jedis.get(key)); TimeUnit.MILLISECONDS.sleep(1000); &#125;catch (Exception e)&#123; logger.error(e.getMessage(),e); &#125;finally &#123; if(jedis != null)&#123; jedis.close(); &#125; &#125; &#125;&#125; mavenä¾èµ–æ˜¯ï¼š 123456789101112131415161718&lt;!--jedis--&gt;&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;!--slf4jæ—¥å¿—æŽ¥å£--&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.6&lt;/version&gt;&lt;/dependency&gt;&lt;!--logbackæ—¥å¿—å®žçŽ°--&gt;&lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.1.1&lt;/version&gt;&lt;/dependency&gt; å¯åŠ¨ç¨‹åºï¼Œå‘çŽ°æ˜¯æ­£å¸¸å†™å…¥ï¼š 123456789101112131416:16:01.424 [main] INFO com.njupt.swg.AppTest - k-54795 value is v-5479516:16:02.426 [main] INFO com.njupt.swg.AppTest - k-55630 value is v-5563016:16:03.429 [main] INFO com.njupt.swg.AppTest - k-70642 value is v-7064216:16:04.430 [main] INFO com.njupt.swg.AppTest - k-42978 value is v-4297816:16:05.431 [main] INFO com.njupt.swg.AppTest - k-96297 value is v-9629716:16:06.433 [main] INFO com.njupt.swg.AppTest - k-4220 value is v-422016:16:07.435 [main] INFO com.njupt.swg.AppTest - k-34103 value is v-3410316:16:08.436 [main] INFO com.njupt.swg.AppTest - k-9177 value is v-917716:16:09.437 [main] INFO com.njupt.swg.AppTest - k-24389 value is v-2438916:16:10.439 [main] INFO com.njupt.swg.AppTest - k-32325 value is v-3232516:16:11.440 [main] INFO com.njupt.swg.AppTest - k-68538 value is v-6853816:16:12.441 [main] INFO com.njupt.swg.AppTest - k-36233 value is v-3623316:16:13.443 [main] INFO com.njupt.swg.AppTest - k-305 value is v-30516:16:14.444 [main] INFO com.njupt.swg.AppTest - k-59279 value is v-59279 æˆ‘ä»¬å°†çŽ°åœ¨çš„ç«¯å£ä¸º7000çš„redis master ç»™killæŽ‰ kill -9 masterçš„pid æˆ‘ä»¬ä¼šå‘çŽ°ï¼šå®¢æˆ·ç«¯æŠ¥å¼‚å¸¸ï¼Œä½†æ˜¯åœ¨å¤§æ¦‚åå‡ ç§’ä¹‹åŽï¼Œå°±ç»§ç»­æ­£å¸¸å¡žå€¼äº†ã€‚åŽŸå› æ˜¯æœåŠ¡ç«¯çš„å“¨å…µæœºåˆ¶çš„é€‰ä¸¾matseréœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚ 4. ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡ 4.1 æ¯10ç§’æ¯ä¸ªsentinelå¯¹masterå’Œslaveæ‰§è¡ŒInfo å‘çŽ°slaveèŠ‚ç‚¹ ç¡®è®¤ä¸»ä»Žå…³ç³» 4.2 æ¯2ç§’æ¯ä¸ªsentinelé€šè¿‡masterèŠ‚ç‚¹çš„channeläº¤æ¢ä¿¡æ¯(pub/sub) é€šè¿‡__sentinel__:helloè¿›è¡Œé¢‘é“äº¤äº’ äº¤äº’å¯¹èŠ‚ç‚¹çš„â€œçœ‹æ³•â€å’Œè‡ªèº«ä¿¡æ¯ 4.3 æ¯1ç§’æ¯ä¸ªsentinelå¯¹å…¶ä»–sentinelå’Œredisæ‰§è¡Œping å¿ƒè·³ç›‘æµ‹ï¼Œå¤±è´¥åˆ¤å®šä¾æ® 5. ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ å¯¹äºŽä¹‹å‰çš„Sentinelé…ç½®æ–‡ä»¶ä¸­æœ‰ä¸¤æ¡é…ç½®ï¼š ç›‘æŽ§master redisèŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¯å½“è¶…è¿‡ä¸¤ä¸ªsentinelè®¤ä¸ºmasteræŒ‚äº†ï¼Œåˆ™è®¤ä¸ºmasteræŒ‚äº†ã€‚ sentinel monitor &lt;masterName&gt; &lt;masterIp&gt; &lt;msterPort&gt; &lt;quorum&gt; sentinel monitor mymaster 127.0.0.1 6379 2 è¿™é‡Œæ˜¯æ¯ç§’sentineléƒ½ä¼šåŽ»Pingå‘¨å›´çš„master redisï¼Œè¶…è¿‡30ç§’æ²¡æœ‰ä»»ä½•å“åº”ï¼Œè¯´æ˜Žå…¶æŒ‚äº†ã€‚ sentinel down-after-milliseconds &lt;masterName&gt; &lt;timeout&gt; sentinel down-after-milliseconds mymaster 300000 5.1 ä¸»è§‚ä¸‹çº¿ ä¸»è§‚ä¸‹çº¿ï¼šæ¯ä¸ªsentinelèŠ‚ç‚¹å¯¹RedisèŠ‚ç‚¹å¤±è´¥çš„â€œåè§â€ è¿™æ˜¯ä¸€ç§ä¸»è§‚ä¸‹çº¿ã€‚å› ä¸ºåœ¨å¤æ‚çš„ç½‘ç»œçŽ¯å¢ƒä¸‹ï¼Œè¿™ä¸ªsentinelä¸Žè¿™ä¸ªmasterä¸é€šï¼Œä½†æ˜¯masterä¸Žå…¶ä»–çš„sentineléƒ½æ˜¯é€šçš„å‘¢ï¼Ÿæ‰€ä»¥æ˜¯ä¸€ç§â€œåè§â€ è¿™æ˜¯ä¾é çš„ç¬¬ä¸‰ç§å®šæ—¶ï¼šæ¯ç§’åŽ»pingä¸€ä¸‹å‘¨å›´çš„sentinelå’Œredisã€‚å¯¹äºŽslave redis,å¯ä»¥ä½¿ç”¨è¿™ä¸ªä¸»è§‚ä¸‹çº¿ï¼Œå› ä¸ºä»–ä¸éœ€è¦è¿›è¡Œæ•…éšœè½¬ç§»ã€‚ 5.2 å®¢è§‚ä¸‹çº¿ å®¢è§‚ä¸‹çº¿ï¼šæ‰€æœ‰sentinelèŠ‚ç‚¹å¯¹master RedisèŠ‚ç‚¹å¤±è´¥â€œè¾¾æˆå…±è¯†â€ï¼ˆè¶…è¿‡quorumä¸ªåˆ™ç»Ÿä¸€ï¼‰ è¿™æ˜¯ä¾é çš„ç¬¬äºŒç§å®šæ—¶ï¼šæ¯ä¸¤ç§’ï¼Œsentinelä¹‹é—´è¿›è¡Œâ€œå•†é‡â€ï¼Œä¼ é€’çš„æ¶ˆæ¯æ˜¯:sentinel is-master-down-by-addr å¯¹äºŽmaster redisçš„ä¸‹çº¿ï¼Œå¿…é¡»è¦è¾¾æˆå…±è¯†æ‰å¯ä»¥ï¼Œå› ä¸ºæ¶‰åŠæ•…éšœè½¬ç§»ï¼Œä»…ä»…ä¾é ä¸€ä¸ªsentinelåˆ¤æ–­æ˜¯ä¸å¤Ÿçš„ã€‚ 6. é¢†å¯¼è€…é€‰ä¸¾ åŽŸå› ï¼šåªæœ‰ä¸€ä¸ªsentinelèŠ‚ç‚¹å®Œæˆæ•…éšœè½¬ç§» é€‰ä¸¾ï¼šé€šè¿‡sentinel is-master-down-by-addrå‘½ä»¤éƒ½å¸Œæœ›æˆä¸ºé¢†å¯¼è€… æ¯ä¸ªåšä¸»è§‚ä¸‹çº¿çš„sentinelèŠ‚ç‚¹å‘å…¶ä»–sentinelèŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè¦æ±‚å°†å®ƒè®¾ç½®ä¸ºé¢†å¯¼è€… æ”¶åˆ°å‘½ä»¤çš„sentinelèŠ‚ç‚¹å¦‚æžœè¿˜æ²¡æœ‰åŒæ„è¿‡å…¶ä»–semtinelèŠ‚ç‚¹å‘é€çš„å‘½ä»¤ï¼Œé‚£ä¹ˆå°†åŒæ„è¯¥è¯·æ±‚ï¼Œå¦åˆ™æ‹’ç» å¦‚æžœè¯¥sentinelèŠ‚ç‚¹å‘çŽ°è‡ªå·±çš„ç¥¨æ•°å·²ç»è¶…è¿‡sentinelé›†åˆåŠæ•°å¹¶ä¸”è¶…è¿‡quorumï¼Œé‚£ä¹ˆå®ƒå°†æˆä¸ºé¢†å¯¼è€…ã€‚ å¦‚æžœæ­¤è¿‡ç¨‹ä¸­å¤šä¸ªsentinelèŠ‚ç‚¹æˆä¸ºäº†é¢†å¯¼è€…ï¼Œé‚£ä¹ˆå°†ç­‰å¾…ä¸€æ®µæ—¶é—´é‡æ–°è¿›è¡Œé€‰ä¸¾ 7. æ•…éšœè½¬ç§» ä»ŽslaveèŠ‚ç‚¹ä¸­é€‰å‡ºä¸€ä¸ªâ€œåˆé€‚çš„â€èŠ‚ç‚¹ä½œä¸ºæ–°çš„masterèŠ‚ç‚¹ å¯¹ä¸Šè¿°çš„slaveèŠ‚ç‚¹æ‰§è¡Œâ€œslaveof no oneâ€å‘½ä»¤ä½¿å…¶æˆä¸ºmasterèŠ‚ç‚¹ å‘å‰©ä½™çš„slaveèŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè®©å®ƒä»¬æˆä¸ºæ–°masterèŠ‚ç‚¹çš„slaveèŠ‚ç‚¹ï¼Œå¤åˆ¶è§„åˆ™å’Œparallel-syncså‚æ•°ä¸€æ · æ›´æ–°å¯¹åŽŸæ¥çš„masterèŠ‚ç‚¹é…ç½®ä¸ºslaveï¼Œå¹¶ä¿æŒç€å¯¹å…¶â€œå…³æ³¨â€ï¼Œå½“æ¢å¤åŽå‘½ä»¤ä»–åŽ»å¤åˆ¶æ–°çš„masterèŠ‚ç‚¹ é‚£ä¹ˆï¼Œå¦‚ä½•é€‰æ‹©â€œåˆé€‚â€çš„slaveèŠ‚ç‚¹å‘¢ï¼Ÿ é€‰æ‹©slave-priority(slaveèŠ‚ç‚¹ä¼˜å…ˆçº§)æœ€é«˜çš„slaveèŠ‚ç‚¹ï¼Œå¦‚æžœå­˜åœ¨åˆ™è¿”å›žï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ã€‚ é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„slaveèŠ‚ç‚¹(å¤åˆ¶å¾—æœ€å®Œæ•´)ï¼Œå¦‚æžœå­˜åœ¨åˆ™è¿”å›žï¼Œä¸å­˜åœ¨åˆ™ç»§ç»­ é€‰æ‹©run_idæœ€å°çš„slaveèŠ‚ç‚¹(æœ€æ—©çš„èŠ‚ç‚¹) 8. èŠ‚ç‚¹ä¸‹çº¿ ä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼šsentinel failover &lt;masterName&gt; ä»ŽèŠ‚ç‚¹ä¸‹çº¿è¦æ³¨æ„è¯»å†™åˆ†ç¦»é—®é¢˜ã€‚ 9. æ€»ç»“ä¸Žæ€è€ƒ redis sentinelæ˜¯redisé«˜å¯ç”¨å®žçŽ°æ–¹æ¡ˆï¼šæ•…éšœå‘çŽ°ã€æ•…éšœè‡ªåŠ¨è½¬ç§»ã€é…ç½®ä¸­å¿ƒã€å®¢æˆ·ç«¯é€šçŸ¥ã€‚ redis sentinelä»Žredis2.8ç‰ˆæœ¬æ‰æ­£å¼ç”Ÿäº§å¯ç”¨ï¼Œä¹‹å‰ç‰ˆæœ¬ä¸å¯ç”Ÿäº§ç”¨ã€‚ å°½å¯èƒ½åœ¨ä¸åŒç‰©ç†æœºä¸Šéƒ¨ç½²redis sentinelæ‰€æœ‰èŠ‚ç‚¹ã€‚ redis sentinelä¸­çš„sentinelèŠ‚ç‚¹ä¸ªæ•°åº”è¯¥å¤§äºŽç­‰äºŽ3ä¸”æœ€å¥½æ˜¯å¥‡æ•°ã€‚ redis sentinelä¸­çš„æ•°æ®èŠ‚ç‚¹å’Œæ™®é€šæ•°æ®èŠ‚ç‚¹æ²¡æœ‰åŒºåˆ«ã€‚æ¯ä¸ªsentinelèŠ‚ç‚¹åœ¨æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªrediså®žä¾‹ï¼Œåªä¸è¿‡å’Œredisæ•°æ®èŠ‚ç‚¹ä¸åŒçš„æ˜¯ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ç›‘æŽ§redisæ•°æ®èŠ‚ç‚¹ å®¢æˆ·ç«¯åˆå§‹åŒ–æ—¶è¿žæŽ¥çš„æ˜¯sentinelèŠ‚ç‚¹é›†åˆï¼Œä¸å†æ˜¯å…·ä½“çš„redisèŠ‚ç‚¹ï¼Œä½†sentinelåªæ˜¯é…ç½®ä¸­å¿ƒä¸æ˜¯ä»£ç†ã€‚ redis sentinelé€šè¿‡ä¸‰ä¸ªå®šæ—¶ä»»åŠ¡å®žçŽ°äº†sentinelèŠ‚ç‚¹å¯¹äºŽä¸»èŠ‚ç‚¹ã€ä»ŽèŠ‚ç‚¹ã€å…¶ä½™sentinelèŠ‚ç‚¹çš„ç›‘æŽ§ã€‚ redis sentinelåœ¨å¯¹èŠ‚ç‚¹åšå¤±è´¥åˆ¤å®šæ—¶åˆ†ä¸ºä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿ã€‚ çœ‹æ‡‚redis sentinelæ•…éšœè½¬ç§»æ—¥å¿—å¯¹äºŽredis sentinelä»¥åŠé—®é¢˜æŽ’æŸ¥éžå¸¸æœ‰ç”¨ã€‚ redis sentinelå®žçŽ°è¯»å†™åˆ†ç¦»é«˜å¯ç”¨å¯ä»¥ä¾èµ–sentinelèŠ‚ç‚¹çš„æ¶ˆæ¯é€šçŸ¥ï¼ŒèŽ·å–redisæ•°æ®èŠ‚ç‚¹çš„çŠ¶æ€å˜åŒ–ã€‚ redis sentinelå¯ä»¥å®žçŽ°é«˜å¯ç”¨çš„è¯»å†™åˆ†ç¦»ï¼Œé«˜å¯ç”¨ä½“çŽ°åœ¨æ•…éšœè½¬ç§»ï¼Œé‚£ä¹ˆå®žçŽ°é«˜å¯ç”¨çš„åŸºç¡€å°±æ˜¯è¦æœ‰ä»ŽèŠ‚ç‚¹ï¼Œä¸»ä»ŽèŠ‚ç‚¹è¿˜å®žçŽ°äº†è¯»å†™åˆ†ç¦»ï¼Œå‡å°‘masterçš„åŽ‹åŠ›ã€‚ä½†æ˜¯å¦‚æžœæ˜¯ä»ŽèŠ‚ç‚¹ä¸‹çº¿äº†ï¼Œsentinelæ˜¯ä¸ä¼šå¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»çš„ï¼Œå¹¶ä¸”è¿žæŽ¥ä»ŽèŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¹Ÿæ— æ³•èŽ·å–åˆ°æ–°çš„å¯ç”¨ä»ŽèŠ‚ç‚¹ï¼Œè€Œè¿™äº›é—®é¢˜åœ¨Clusterä¸­éƒ½å¾—åˆ°äº†æœ‰æ•ˆçš„è§£å†³ã€‚ å¯¹äºŽæ€§èƒ½æé«˜ã€å®¹é‡æ‰©å±•çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ¯”è¾ƒæŽ¨èçš„æ˜¯ä½¿ç”¨é›†ç¾¤ï¼Œå°±æ˜¯ä¸‹é¢è®¨è®ºçš„redis cluster!]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°å€¼è®¡ç®—ç²¾åº¦ä¸¢å¤±é—®é¢˜]]></title>
    <url>%2F2019%2F01%2F31%2Fmiscellany%2F14%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æ— è®ºåœ¨ä»€ä¹ˆä¸šåŠ¡ä¸­ï¼Œé’±æ˜¯éžå¸¸é‡è¦çš„ä¸œè¥¿ï¼Œå¯¹è´¦çš„æ—¶å€™ä¸€å®šè¦å¯¹çš„ä¸Šï¼Œä¸èƒ½è¿™è¾¹å°‘ä¸€åˆ†é‚£è¾¹å¤šä¸€åˆ†ã€‚å¯¹äºŽæ•°å€¼çš„è®¡ç®—ï¼Œå°¤å…¶æ˜¯å°æ•°ï¼Œdoubleå’Œdoubleéƒ½æ˜¯ç¦æ­¢ä½¿ç”¨çš„ã€‚ é˜¿é‡Œå¼ºåˆ¶è¦æ±‚å­˜æ”¾å°æ•°æ—¶ä½¿ç”¨ decimalï¼Œç¦æ­¢ä½¿ç”¨ float å’Œ doubleã€‚ è¯´æ˜Žï¼šfloat å’Œ double åœ¨å­˜å‚¨çš„æ—¶å€™ï¼Œå­˜åœ¨ç²¾åº¦æŸå¤±çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½åœ¨å€¼çš„æ¯”è¾ƒæ—¶ï¼Œå¾—åˆ°ä¸æ­£ç¡®çš„ç»“æžœã€‚å¦‚æžœå­˜å‚¨çš„æ•°æ®èŒƒå›´è¶…è¿‡ decimal çš„èŒƒå›´ï¼Œå»ºè®®å°†æ•°æ®æ‹†æˆæ•´æ•°å’Œå°æ•°åˆ†å¼€å­˜å‚¨ã€‚ å¤„ç†æ–¹å¼å¯ä»¥ä¸ºï¼šmysql å¯ä»¥ç”¨ decimal ï¼Œå¦‚æžœä½ æ˜¯ç”¨ javaï¼Œ åœ¨å•†ä¸šè®¡ç®—ä¸­æˆ‘ä»¬è¦ç”¨ java.math.BigDecimalï¼Œæ³¨æ„ï¼šå¦‚æžœéœ€è¦ç²¾ç¡®è®¡ç®—ï¼Œéžè¦ç”¨Stringæ¥å¤Ÿé€ BigDecimalä¸å¯ï¼ é‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ ä¸€ä¸ªä¾‹å­è¯´æ˜Ž åºŸè¯ä¸å¤šè¯´ï¼Œä¸Šå›¾ï¼š é—®é¢˜åŽŸå›  æ— è®ºæ˜¯æˆ‘ä»¬æœ¬æ–‡æåˆ°çš„doubleï¼Œè¿˜æ˜¯floatï¼Œéƒ½æ˜¯æµ®ç‚¹æ•°ã€‚ åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæµ®ç‚¹ï¼ˆè‹±è¯­ï¼šfloating pointï¼Œç¼©å†™ä¸ºFPï¼‰æ˜¯ä¸€ç§å¯¹äºŽå®žæ•°çš„è¿‘ä¼¼å€¼æ•°å€¼è¡¨çŽ°æ³•ï¼Œç”±ä¸€ä¸ªæœ‰æ•ˆæ•°å­—ï¼ˆå³å°¾æ•°ï¼‰åŠ ä¸Šå¹‚æ•°æ¥è¡¨ç¤ºï¼Œé€šå¸¸æ˜¯ä¹˜ä»¥æŸä¸ªåŸºæ•°çš„æ•´æ•°æ¬¡æŒ‡æ•°å¾—åˆ°ã€‚ä»¥è¿™ç§è¡¨ç¤ºæ³•è¡¨ç¤ºçš„æ•°å€¼ï¼Œç§°ä¸ºæµ®ç‚¹æ•°ï¼ˆfloating-point numberï¼‰ã€‚ å…¶å®žæˆ‘è§‰å¾—å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œè®¡ç®—æœºè®¡ç®—åŠ å‡ä¹˜é™¤å•Šï¼Œéƒ½æ˜¯ç”¨çš„åŠ æ³•å™¨ï¼Œå®žè´¨éƒ½æ˜¯äºŒè¿›åˆ¶çš„åŠ æ³•å¤„ç†ã€‚é‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸€ä¸ªäºŒè¿›åˆ¶è¡¨ç¤ºçš„é—®é¢˜ã€‚è¯•æƒ³ï¼Œ4ï¼Œ2ï¼Œ8ä¹‹æµéƒ½æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Œå¯ä»¥å®Œç¾Žç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œè®¡ç®—å½“ç„¶ä¸ä¼šå‡ºçŽ°é—®é¢˜ã€‚å¯¹äºŽ0ï¼Œ1ï¼Œ3ï¼Œ5ä¹‹ç±»ä¹Ÿéƒ½å¯ä»¥ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥ï¼Œæ­£æ•°è‚¯å®šæ˜¯æ²¡é—®é¢˜çš„ã€‚ ä½†æ˜¯å¯¹äºŽå°æ•°å‘¢ï¼Ÿ1ã€0.5ã€0.25é‚£éƒ½æ˜¯å¯ä»¥è½¬æ¢æˆäºŒè¿›åˆ¶çš„å°æ•°ï¼Œå¦‚åè¿›åˆ¶çš„0.1ï¼Œå°±æ— æ³•ç”¨äºŒè¿›åˆ¶å‡†ç¡®çš„è¡¨ç¤ºå‡ºæ¥ã€‚å› æ­¤åªèƒ½ä½¿ç”¨è¿‘ä¼¼å€¼çš„æ–¹å¼è¡¨è¾¾ã€‚ å¦‚æžœæˆ‘ä»¬å°è¯•ç€æŠŠ10è¿›åˆ¶çš„0.1è½¬åŒ–æˆäºŒè¿›åˆ¶ï¼Œä¼šæ€Žä¹ˆè½¬å‘¢ï¼Ÿ åœ¨åè¿›åˆ¶ä¸­ï¼Œ0.1å¦‚ä½•è®¡ç®—å‡ºæ¥çš„å‘¢ï¼Ÿ 0.1 = 1 Ã· 10 é‚£ä¹ˆäºŒè¿›åˆ¶ä¸­ä¹Ÿæ˜¯åŒç†ï¼š 1 Ã· 1010 æˆ‘ä»¬å›žåˆ°å°å­¦çš„è¯¾å ‚ï¼Œæ¥åˆ—ç«–å¼å§ï¼š 123456789101112131415 0.000110011... ------------------1010 ) 1 0000 1010 ------ 1100 1010 ---- 10000 1010 ----- 1100 1010 ---- 10 å¾ˆæ˜¾ç„¶ï¼Œé™¤ä¸å°½ï¼Œé™¤å‡ºäº†ä¸€ä¸ªæ— é™å¾ªçŽ¯å°æ•°ï¼šäºŒè¿›åˆ¶çš„ 0.0001100110011â€¦ é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºè¿™ä¸ªæ— é™ä¸å¾ªçŽ¯çš„å°æ•°å‘¢ï¼Ÿåªèƒ½è€ƒè™‘æŒ‰ç…§ä¸åŒçš„ç²¾åº¦ä¿ç†ä¸åŒçš„ä½æ•°ã€‚ æˆ‘ä»¬çŸ¥é“floatæ˜¯å•ç²¾åº¦çš„ï¼Œdoubleæ˜¯åŒç²¾åº¦çš„ã€‚ä¸åŒçš„ç²¾åº¦ï¼Œå…¶å®žå°±æ˜¯ä¿ç•™çš„æœ‰æ•ˆæ•°å­—ä½æ•°ä¸åŒï¼Œä¿ç•™çš„ä½æ•°è¶Šå¤šï¼Œç²¾åº¦è¶Šé«˜ã€‚ æ‰€ä»¥ï¼Œæµ®ç‚¹æ•°åœ¨Javaä¸­æ˜¯æ— æ³•ç²¾ç¡®è¡¨ç¤ºçš„ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æµ®ç‚¹æ•°è½¬æ¢æˆäºŒè¿›åˆ¶æ˜¯ä¸€ä¸ªæ— é™ä¸å¾ªçŽ¯çš„å°æ•°ï¼Œåªèƒ½é€šè¿‡ä¿ç•™ç²¾åº¦çš„æ–¹å¼è¿›è¡Œè¿‘ä¼¼è¡¨ç¤ºã€‚ é—®é¢˜çš„è§£å†³ String æž„é€ æ–¹æ³•æ˜¯å®Œå…¨å¯é¢„çŸ¥çš„ï¼šå†™å…¥ newBigDecimal(&quot;0.1&quot;) å°†åˆ›å»ºä¸€ä¸ª BigDecimalï¼Œå®ƒæ­£å¥½ç­‰äºŽé¢„æœŸçš„ 0.1ã€‚å› æ­¤ï¼Œæ¯”è¾ƒè€Œè¨€ï¼Œé€šå¸¸å»ºè®®ä¼˜å…ˆä½¿ç”¨Stringæž„é€ æ–¹æ³•ã€‚ ä½¿ç”¨BigDecimal(String val)ï¼ 123456789101112131415161718192021222324252627//åŠ æ³•public static BigDecimal add(double v1, double v2)&#123; BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.add(b2);&#125;//å‡æ³•public static BigDecimal sub(double v1,double v2)&#123; BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.subtract(b2);&#125;//ä¹˜æ³•public static BigDecimal mul(double v1,double v2)&#123; BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.multiply(b2);&#125;//é™¤æ³•public static BigDecimal div(double v1,double v2)&#123; BigDecimal b1 = new BigDecimal(Double.toString(v1)); BigDecimal b2 = new BigDecimal(Double.toString(v2)); return b1.divide(b2,2,BigDecimal.ROUND_HALF_UP);//å››èˆäº”å…¥,ä¿ç•™2ä½å°æ•°,åº”å¯¹é™¤ä¸å°½çš„æƒ…å†µ&#125; é‚£ä¹ˆï¼Œä¸Šé¢çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜å°±è¿Žåˆƒè€Œè§£äº†ã€‚ä½†æ˜¯é™¤ä¸å°½æ€Žä¹ˆåŠžï¼Ÿæ¯”å¦‚10.0é™¤ä»¥è¿™é‡Œçš„3.0ï¼Œä¿ç•™å°æ•°ç‚¹åŽä¸‰ä½æœ‰æ•ˆæ•°å­—ï¼š é‚£ä¹ˆï¼Œæ¯ä¸ªç”¨æˆ·å¾—åˆ°çš„éƒ½æ˜¯3.333å…ƒï¼Œä¸‰ä¸ªç”¨æˆ·åŠ èµ·æ¥æ˜¯å¾—ä¸åˆ°10å—é’±çš„ã€‚ å¯¹äºŽé™¤æ³•ï¼Œå§‹ç»ˆä¼šäº§ç”Ÿé™¤ä¸å°½çš„æƒ…å†µæ€Žä¹ˆåŠžï¼Ÿæœ‰ä¸ªè¯å«è½§å·® ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸¾ä¸ªç®€å•ä¾‹å­ã€‚å‡å¦‚çŽ°åœ¨éœ€è¦æŠŠ10å…ƒåˆ†æˆ3åˆ†ï¼Œå¦‚æžœæ˜¯10é™¤ä»¥3è¿™ä¹ˆé™¤ï¼Œä¼šå‘çŽ°ä¸º3.33333æ— ç©·å°½çš„3ã€‚è¿™äº›æ•°å­—å®Œå…¨æ— æ³•åœ¨ç¨‹åºæˆ–æ•°æ®åº“ä¸­è¿›è¡Œç²¾ç¡®çš„å­˜å‚¨ã€‚ ç®€å•ç†è§£å°±æ˜¯ï¼Œå½“é™¤ä¸å°½æˆ–éœ€åŽ»é™¤å°æ•°ç‚¹çš„æ—¶å€™ï¼Œå‰é¢çš„n-1ç¬”ï¼ˆè¿™é‡Œn=3ï¼‰åšå››èˆäº”å…¥ã€‚æœ€åŽä¸€ç¬”åšå…œåº•ï¼ˆæ€»é‡‘é¢å‡åŽ»å‰é¢n-1ç¬”ä¹‹å’Œï¼‰ã€‚è¿™æ ·ä¿è¯æ€»é‡‘é¢çš„ä¸ä¼šä¸¢å¤±ã€‚ æ¯”å¦‚10å—é’±ï¼Œä¸‰ä¸ªç”¨æˆ·åˆ†ï¼Œå‰é¢ä¸¤ä¸ªç”¨æˆ·åªèƒ½å„åˆ†åˆ°3ã€‚333å—é’±ï¼Œæœ€åŽä¸€ä¸ªç”¨æˆ·åˆ†åˆ°3.334å—é’±ã€‚ä¿è¯æ€»é¢ä¸å˜ã€‚ è‡³äºŽåŽŸç†ï¼Œæœ‰ä¸€ç‚¹ç‚¹æ•°å­¦åŒ–ï¼Œä»¥åŽå†ä½œæŽ¢è®¨å§ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisä¸»ä»Žå¤åˆ¶]]></title>
    <url>%2F2019%2F01%2F31%2Fredis%2FRedis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬å…­ç¯‡æ–‡ç« ã€‚ä»‹ç»redisä¸»ä»Žå¤åˆ¶åŠŸèƒ½å®žçŽ°åŽŸç†ã€‚ä½œä¸ºé«˜å¯ç”¨çš„åŸºç¡€ï¼Œäº†è§£ä¸€ä¸‹å…¶ä¸­çš„é—¨é“æ˜¯æœ‰å¿…è¦çš„ã€‚ 1.å•æœºæœ‰ä»€ä¹ˆé—®é¢˜ æœºå™¨æ•…éšœ å®¹é‡ç“¶é¢ˆ QPSç“¶é¢ˆ 2. ä¸»ä»Žå¤åˆ¶çš„ä½œç”¨ æ•°æ®å‰¯æœ¬ æ‰©å±•è¯»æ€§èƒ½ï¼Œslaveä¸“é—¨ç”¨æ¥è¯» ä¸€ä¸ªmasterå¯ä»¥æœ‰å¤šä¸ªslaveï¼Œä¸€ä¸ªsalveåªèƒ½æœ‰ä¸€ä¸ªmaster 3. ä¸¤ç§å®žçŽ°æ–¹å¼ æ–¹å¼ä¸€ï¼šslaveofå‘½ä»¤ slaveof masterIp masterPort slaveof no one(ä¸ä¼šæ¸…é™¤åŽŸæ¥åŒæ­¥çš„æ•°æ®ï¼Œè€Œæ˜¯æ–°çš„æ•°æ®ä¸ä¼šå†åŒæ­¥ç»™ä»–) æ–¹å¼äºŒï¼šé…ç½® ä¿®æ”¹æŸä¸€è¡Œçš„é…ç½®ï¼šslaveof ip port ä»ŽèŠ‚ç‚¹åªåšè¯»æ“ä½œï¼šslave-read-only yes å¯¹æ¯” å‘½ä»¤çš„ä¼˜ç‚¹ï¼šä¸éœ€è¦é‡å¯ å‘½ä»¤çš„ç¼ºç‚¹ï¼šä¸ä¾¿äºŽç®¡ç† é…ç½®çš„ä¼˜ç‚¹ï¼šç»Ÿä¸€é…ç½® é…ç½®çš„ç¼ºç‚¹ï¼šéœ€è¦é‡å¯ ä¸€ä¸ªåœºæ™¯ï¼Œå‡å¦‚6380æ˜¯6379çš„ä¸€ä¸ªä»ŽèŠ‚ç‚¹ï¼Œç„¶åŽå°†6380æ‰§è¡Œsalveof no oneï¼Œç„¶åŽæ’å…¥ä¸€äº›æ–°çš„æ•°æ®ï¼›å†é‡æ–°å˜æˆ6379çš„ä»ŽèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé‡Œé¢çš„æ–°æ•°æ®ä¼šè¢«æ¸…é™¤æŽ‰ã€‚ æŸ¥çœ‹run_id redis-cli -p 6379 info server | grep run 4. å…¨é‡å¤åˆ¶ å…¨é‡å¤åˆ¶å¼€é”€ bgsaveæ—¶é—´ rdbç½‘ç»œä¼ è¾“æ—¶é—´ ä»ŽèŠ‚ç‚¹æ¸…ç©ºæ•°æ®çš„æ—¶é—´ ä»ŽèŠ‚ç‚¹åŠ è½½RDBçš„æ—¶é—´ å¯èƒ½çš„AOFé‡å†™æ—¶é—´ å­˜åœ¨çš„é—®é¢˜ æ—¶é—´å¼€é”€æ¯”è¾ƒå¤§ å¦‚æžœmasterå’Œslaveä¹‹é—´ç½‘ç»œæ‰°åŠ¨ç”šè‡³æ–­å¼€ï¼Œé‚£ä¹ˆmasteræ­¤é—´æ›´æ–°çš„æ•°æ®å¯¹äºŽslaveæ˜¯ä¸çŸ¥é“çš„ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å†è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œä½†æ˜¯æ˜¾ç„¶ï¼Œæ¶ˆè€—å¤ªå¤§äº†ã€‚ 5. éƒ¨åˆ†å¤åˆ¶ 6. å¼€å‘ä¸Žè¿ç»´çš„é—®é¢˜ è¯»å†™åˆ†ç¦» masteråªåšå†™æ“ä½œï¼Œslaveæ¥åšè¯»æ“ä½œï¼Œæ¥åˆ†æ‘Šæµé‡ã€‚ä½†æ˜¯ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼š å¤åˆ¶æ•°æ®å»¶è¿Ÿ è¯»åˆ°è¿‡æœŸæ•°æ® ä»ŽèŠ‚ç‚¹æ•…éšœ ä¸»ä»Žé…ç½®ä¸ä¸€è‡´ ä¾‹å¦‚maxmemoryä¸ä¸€è‡´ï¼šä¸¢å¤±æ•°æ® æ•°æ®ç»“æž„ä¼˜åŒ–å‚æ•°ï¼šå†…å­˜ä¸ä¸€è‡´ è§„é¿å…¨é‡å¤åˆ¶ ç¬¬ä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼šä¸å¯é¿å…â€”å°ä¸»èŠ‚ç‚¹(maxmemroyä¸è¦å¤ªå¤§)æˆ–è€…åœ¨ä½Žå³°æ—¶è¿›è¡Œæ“ä½œ èŠ‚ç‚¹run_idä¸åŒ¹é…ï¼ˆä¸»èŠ‚ç‚¹é‡å¯ï¼Œé‚£ä¹ˆmasterçš„run_idä¼šå‘ç”Ÿå˜åŒ–ï¼Œslaveå‘çŽ°å…¶run_idå˜åŒ–ï¼Œä¼šè¿›è¡Œå…¨é‡å¤åˆ¶ï¼‰ï¼›æˆ‘ä»¬å¯ä»¥ç”¨æ•…éšœè½¬ç§»ï¼Œä¾‹å¦‚å“¨å…µæˆ–é›†ç¾¤æ¥é¿å…å…¨é‡å¤åˆ¶ã€‚ å¤åˆ¶ç§¯åŽ‹ç¼“å†²åŒºä¸è¶³(ç½‘ç»œä¸­æ–­ï¼Œéƒ¨åˆ†å¤åˆ¶æ— æ³•æ»¡è¶³)ï¼Œå¯ä»¥å¢žå¤§å¤åˆ¶ç¼“å†²åŒºé…ç½®sizeï¼Œç½‘ç»œå¢žå¼º è§„é¿å¤åˆ¶é£Žæš´ æ¦‚å¿µï¼šä¸»èŠ‚ç‚¹å®•æœºé€ æˆå¤§é‡çš„å…¨é‡å¤åˆ¶ å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£Žæš´ï¼šä¸»èŠ‚ç‚¹é‡å¯ï¼Œå¤šä»ŽèŠ‚ç‚¹å¤åˆ¶ï¼›è§£å†³ï¼šæ›´æ¢å¤åˆ¶æ‹“æ‰‘ å•æœºå™¨å¤åˆ¶é£Žæš´ï¼šæœºå™¨å®•æœºåŽï¼ˆè¯¥æœºå™¨å…¨æ˜¯Materï¼‰ï¼Œå¤§é‡å…¨é‡å¤åˆ¶ã€‚è§£å†³ï¼šmasteråˆ†æ•£å¤šæœºå™¨ã€‚ è¯´åˆ°åº•ï¼Œè¿˜æ˜¯éœ€è¦æœ‰ä¸€ç§é«˜å¯ç”¨çš„å®žçŽ°æ–¹å¼ï¼Œåœ¨masterå‡ºçŽ°æ•…éšœä¹‹åŽï¼Œå¦‚ä½•è‡ªåŠ¨å®žçŽ°ä»Žslaveæ™‹å‡ä¸ºmasterç»§ç»­ä½¿ç”¨.è€Œä¸æ˜¯ä¸€ç›´æ­»å®ˆç€åŽŸæ¥è€çš„masterä¸æ”¾ï¼Œå› ä¸ºè€çš„masterå•¥æ—¶å€™æ¢å¤ä¸çŸ¥é“ï¼Œæ¢å¤äº†å¯èƒ½ä¼šé€ æˆå¤åˆ¶é£Žæš´ï¼Œæ—¢ç„¶ä»ŽèŠ‚ç‚¹æœ¬æ¥æ˜¯ä¸€ç›´ä¸ŽmasterèŠ‚ç‚¹ä¿æŒå°½é‡çš„åŒæ­¥çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸å°†æ•°æ®æœ€æ–°çš„ä»ŽèŠ‚ç‚¹å‡çº§ä¸ºä¸»èŠ‚ç‚¹å‘¢ï¼Ÿä¸‹ä¸€ç« ç»§ç»­æ¥åˆ†æžã€‚]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RedisæŒä¹…åŒ–]]></title>
    <url>%2F2019%2F01%2F31%2Fredis%2FRedis%E6%8C%81%E4%B9%85%E5%8C%96%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬äº”ç¯‡æ–‡ç« ã€‚rediså¤„ç†æ•°æ®éƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œæ‰€ä»¥é€Ÿåº¦ç‰¹åˆ«å¿«ï¼ŒåŒæ ·ï¼Œå®ƒä¹Ÿå¯ä»¥æ”¯æŒæŒä¹…åŒ–ï¼Œè¿™é‡Œæ³¨æ„ï¼Œå¹¶ä¸æ˜¯è¯´redisè¦æ¥å……å½“mysqlé‚£ç§è§’è‰²ï¼Œå…¶å®žæ›´å¤šçš„æ˜¯ä¸ºäº†åœ¨å´©æºƒçš„æ—¶å€™å¿«é€Ÿæ¢å¤ä»¥åŠä¸»ä»Žå¤åˆ¶è¿™æ ·çš„åŠŸèƒ½ã€‚redisçš„æŒä¹…åŒ–ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯RDBï¼Œä¸€ç§æ˜¯AOFï¼Œå¯¹äºŽä»–ä»¬çš„åŽŸç†å’ŒåŒºåˆ«éƒ½æ˜¯æ¯”è¾ƒé‡è¦çš„é¢è¯•è€ƒå¯Ÿç‚¹ï¼Œéœ€è¦æŽŒæ¡ã€‚ 1. ä»€ä¹ˆæ˜¯æŒä¹…åŒ– redisæ‰€æœ‰æ•°æ®ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œå¯¹æ•°æ®çš„æ›´æ–°å°†å¼‚æ­¥åœ°ä¿å­˜åˆ°ç£ç›˜ä¸­ã€‚ 2. æŒä¹…åŒ–çš„æ–¹å¼ å¿«ç…§â€”mysql dumpæˆ–è€…redis rdb å†™æ—¥å¿—â€”mysql binlogæˆ–è€…hbase glogæˆ–è€…redis aof 3. RDB ä»€ä¹ˆæ˜¯RDB è§¦å‘æœºåˆ¶ä¸‰ç§ä¸»è¦æ–¹å¼ save(åŒæ­¥æŒä¹…åŒ–ï¼Œä¼šé€ æˆredisä¸»çº¿ç¨‹çš„é˜»å¡žï¼Œä¸æŽ¨èä½¿ç”¨) saveæ˜¯åŒæ­¥çš„ï¼Œå½“ä¿å­˜çš„æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œå¯èƒ½é€ æˆredisçš„é˜»å¡žï¼Œå³å®¢æˆ·ç«¯è®¿é—®redisè¢«é˜»å¡žã€‚ ä»–çš„æ–‡ä»¶ç­–ç•¥æ˜¯ï¼šå¦‚æžœå­˜åœ¨è€çš„RDBæ–‡ä»¶ï¼Œåˆ™æ–°çš„æ›¿æ¢è€çš„ã€‚å¤æ‚åº¦ä¸ºO(n)ã€‚ bgsave(å¼‚æ­¥ï¼Œforkä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸ä¼šé€ æˆä¸»çº¿ç¨‹çš„é˜»å¡ž) ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œforkæ˜¯æ¯”è¾ƒå¿«çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä¼šæ…¢ï¼Œè¿™æ—¶ä¼šé˜»å¡žredisã€‚åªè¦forkä¸æ…¢ï¼Œå®¢æˆ·ç«¯ä¸ä¼šè¢«é˜»å¡žã€‚ ä»–çš„æ–‡ä»¶ç­–ç•¥å’Œå¤æ‚åº¦ä¸Žsaveæ˜¯ä¸€æ ·çš„ã€‚ saveå’Œbgsaveä¸¤è€…å¯¹æ¯”ï¼š è‡ªåŠ¨ redisçš„è‡ªåŠ¨ä¿å­˜çš„é»˜è®¤é…ç½®æ˜¯ï¼š é…ç½® seconds changes save 900 1 save 300 10 save 60 10000 å°±æ˜¯è¯´ï¼Œåœ¨60ç§’å†…æ”¹å˜äº†10000æ¡æ•°æ®ï¼Œå°±è‡ªåŠ¨ä¿å­˜ï¼›åœ¨300ç§’å†…æœ‰10æ¡æ”¹å˜æ‰è‡ªåŠ¨ä¿å­˜ï¼›900ç§’å†…æœ‰1ä¸€æ¡æ”¹å˜å°±ä¿å­˜ã€‚ RDBæ€»ç»“ RDBæ˜¯Rediså†…å­˜åˆ°ç¡¬ç›˜çš„å¿«ç…§ï¼Œç”¨äºŽæŒä¹…åŒ–ã€‚ saveé€šå¸¸ä¼šé˜»å¡žredisã€‚ bgsaveä¸ä¼šé˜»å¡žredisï¼Œä½†æ˜¯ä¼šforkæ–°è¿›ç¨‹ã€‚ saveè‡ªåŠ¨é…ç½®æ»¡è¶³ä»»ä¸€å°±ä¼šè¢«æ‰§è¡Œã€‚ æœ‰äº›è§¦å‘æœºåˆ¶ä¸å®¹å¿½è§†ã€‚ 4. AOF RDBé—®é¢˜ å…¨é‡æ•°æ®å­˜å…¥ç£ç›˜ O(n)æ•°æ®çš„å¤‡ä»½ï¼Œå¾ˆè€—æ—¶é—´ï¼›å¯¹äºŽbgsaveæ¥è¯´ï¼Œfork()æ˜¯ä¸€ä¸ªå¾ˆæ¶ˆè€—å†…å­˜çš„æ“ä½œï¼›å°†æ•°æ®å…¨å†™åˆ°ç¡¬ç›˜ï¼Œå¿…ç„¶å¯¹ç¡¬ç›˜IOå ç”¨å¾ˆå¤§ã€‚ å®•æœºä¸¢å¤±æ•°æ®å¤š è¿˜æœ‰ä¸€ç‚¹æ˜¯ï¼šæŸä¸ªæ—¶é—´ç‚¹å®•æœºï¼Œé‚£ä¹ˆåœ¨æŸä¸ªæ—¶é—´æ®µçš„æ•°æ®å°±ä¸¢å¤±äº†ã€‚ AOFåŽŸç† å°†å¯¹redisçš„æ“ä½œè¿½åŠ åˆ°aofæ–‡ä»¶ä¸­ã€‚å½“rediså®•æœºä¹‹åŽï¼Œä½¿ç”¨aofæ¢å¤æ‰€æœ‰çš„æ“ä½œç»§è€Œå®žçŽ°æ•°æ®çš„æ¢å¤ã€‚ AOFä¸‰ç§ç­–ç•¥ always everysec rediså‡ºçŽ°æ•…éšœï¼Œæœ‰å¯èƒ½ä¸¢å¤±ä¸€ç§’çš„æ•°æ®ã€‚redisé»˜è®¤æ–¹å¼ã€‚ no ä¸‰ç§ç­–ç•¥çš„æ¯”è¾ƒ AOFé‡å†™ å¥½å¤„æ˜¯ï¼šå‡å°‘ç¡¬ç›˜å ç”¨ã€å‡å°‘æ•°æ®ä¸¢å¤± ä¸‹é¢æ˜¯AOFçš„bgrewirteaofçš„è¿‡ç¨‹ï¼š æ³¨æ„ï¼šè¿™é‡Œçš„é‡å†™å¹¶ä¸æ˜¯ä¸Šé¢æ¼”ç¤ºçš„ï¼Œå°†åŽŸæ¥çš„aofæ–‡ä»¶è¿›è¡Œé‡å†™ï¼Œè€Œæ˜¯æ ¹æ®redisçŽ°åœ¨çš„å†…å­˜æ•°æ®è¿›è¡Œä¸€æ¬¡å›žæº¯ã€‚ aofé‡å†™æµç¨‹ ä¹Ÿå°±æ˜¯è¯´ï¼Œå­è¿›ç¨‹åœ¨æ‰§è¡Œ AOF é‡å†™æ—¶ï¼Œä¸»è¿›ç¨‹éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå·¥ä½œï¼š 1.å¤„ç†å‘½ä»¤è¯·æ±‚ï¼› 2.å°†å†™å‘½ä»¤è¿½åŠ åˆ°çŽ°æœ‰çš„ AOF æ–‡ä»¶ä¸­ï¼› 3.å°†å†™å‘½ä»¤è¿½åŠ åˆ° AOF é‡å†™ç¼“å­˜ä¸­ã€‚ å¦‚æ­¤å¯ä»¥ä¿è¯ï¼š çŽ°æœ‰çš„AOFåŠŸèƒ½ç»§ç»­æ‰§è¡Œï¼Œå³ä½¿ AOF é‡å†™æœŸé—´å‘ç”Ÿåœæœºï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ•°æ®ä¸¢å¤±ï¼› æ‰€æœ‰å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹çš„å‘½ä»¤éƒ½ä¼šè¢«è®°å½•åˆ° AOF é‡å†™ç¼“å­˜ä¸­ã€‚ å½“å­è¿›ç¨‹å®Œæˆå¯¹ AOF æ–‡ä»¶é‡å†™ä¹‹åŽï¼Œå®ƒä¼šå‘çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªå®Œæˆä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æŽ¥åˆ°è¯¥å®Œæˆä¿¡å·ä¹‹åŽï¼Œä¼šè°ƒç”¨ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å®Œæˆä»¥ä¸‹å·¥ä½œï¼š(é˜»å¡ž) å°† AOF é‡å†™ç¼“å­˜ä¸­çš„å†…å®¹å…¨éƒ¨å†™å…¥åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼›(çŽ°æœ‰ AOF æ–‡ä»¶ã€æ–°çš„ AOF æ–‡ä»¶å’Œæ•°æ®åº“ä¸‰è€…çš„çŠ¶æ€å°±å®Œå…¨ä¸€è‡´äº†) å¯¹æ–°çš„ AOF æ–‡ä»¶è¿›è¡Œæ”¹åï¼Œè¦†ç›–åŽŸæœ‰çš„ AOF æ–‡ä»¶ã€‚(æ‰§è¡Œå®Œæ¯•åŽï¼Œç¨‹åºå°±å®Œæˆäº†æ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶çš„æ›¿æ¢) å½“è¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œä¸»è¿›ç¨‹å°±å¯ä»¥ç»§ç»­åƒå¾€å¸¸ä¸€æ ·æŽ¥æ”¶å‘½ä»¤è¯·æ±‚äº†ã€‚åœ¨æ•´ä¸ª AOF åŽå°é‡å†™è¿‡ç¨‹ä¸­ï¼Œåªæœ‰æœ€åŽçš„â€œä¸»è¿›ç¨‹å†™å…¥å‘½ä»¤åˆ°AOFç¼“å­˜â€å’Œâ€œå¯¹æ–°çš„ AOF æ–‡ä»¶è¿›è¡Œæ”¹åï¼Œè¦†ç›–åŽŸæœ‰çš„ AOF æ–‡ä»¶â€è¿™ä¸¤ä¸ªæ­¥éª¤ä¼šé€ æˆä¸»è¿›ç¨‹é˜»å¡žï¼Œåœ¨å…¶ä»–æ—¶å€™ï¼Œ AOF åŽå°é‡å†™éƒ½ä¸ä¼šå¯¹ä¸»è¿›ç¨‹é€ æˆé˜»å¡žï¼Œè¿™å°† AOF é‡å†™å¯¹æ€§èƒ½é€ æˆçš„å½±å“é™åˆ°æœ€ä½Žã€‚ å°ç»“ï¼š AOF é‡å†™çš„ç›®çš„æ˜¯è½»é‡åœ°ä¿å­˜æ•°æ®åº“çŠ¶æ€ï¼Œæ•´ä¸ªé‡å†™è¿‡ç¨‹åŸºæœ¬ä¸Šä¸å½±å“ Redis ä¸»è¿›ç¨‹å¤„ç†å‘½ä»¤è¯·æ±‚ï¼› AOFåœ¨rediså®•æœºçš„æ—¶å€™æœ€å¤šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ï¼Œæ¯”RDBè¦å¥½ä¸€ç‚¹ï¼Œå¹¶ä¸”å¯è¯»æ€§é«˜ï¼ŒåŸºæœ¬ä¸Šèƒ½çœ‹å¾—æ‡‚ AOF é‡å†™å…¶å®žæ˜¯ä¸€ä¸ªæœ‰æ­§ä¹‰çš„åå­—ï¼Œå®žé™…ä¸Šé‡å†™å·¥ä½œæ˜¯é’ˆå¯¹æ•°æ®åº“çš„å½“å‰å€¼æ¥è¿›è¡Œçš„ï¼Œé‡å†™è¿‡ç¨‹ä¸­ä¸ä¼šè¯»å†™ã€ä¹Ÿä¸é€‚ç”¨åŽŸæ¥çš„ AOF æ–‡ä»¶ï¼› AOF å¯ä»¥ç”±ç”¨æˆ·æ‰‹åŠ¨è§¦å‘ï¼Œä¹Ÿå¯ä»¥ç”±æœåŠ¡å™¨è‡ªåŠ¨è§¦å‘ã€‚ 5. æŒä¹…åŒ–çš„å–èˆå’Œé€‰æ‹© RDBå’ŒAOFå¯¹æ¯” å¯ä»¥çœ‹å‡ºï¼Œä¸–ç•Œä¸Šæ²¡æœ‰å®Œç¾Žçš„ä¸œè¥¿ï¼Œåªæœ‰åˆé€‚çš„ä¸œè¥¿ã€‚AOFåŒæ ·å­˜åœ¨ä¸€äº›é—®é¢˜ï¼šAOFæ–‡ä»¶çš„ä½“ç§¯é€šå¸¸è¦å¤§äºŽRDBæ–‡ä»¶çš„ä½“ç§¯ã€ä¸”æ¢å¤é€Ÿåº¦æ…¢ã€‚ RDBæœ€ä½³ç­–ç•¥ â€œå…³â€ï¼šå»ºè®®å…³é—­ï¼Œä½†æ˜¯åŽé¢ä¸»ä»Žå¤åˆ¶åŠŸèƒ½æ˜¯éœ€è¦ä»–çš„ï¼Œå› ä¸ºéœ€è¦ä¸»èŠ‚ç‚¹æ‰§è¡Œdbsaveï¼Œç„¶åŽå°†rdbæ–‡ä»¶ä¼ ç»™ä»ŽèŠ‚ç‚¹ã€‚æ‰€ä»¥è¯´ï¼Œå…³ä¸æ˜¯æ°¸ä¹…å…³ã€‚ â€œé›†ä¸­ç®¡ç†â€ï¼šè™½ç„¶RDBå¾ˆé‡ï¼Œä½†æ˜¯å¯¹äºŽæ•°æ®å¤‡ä»½æ˜¯å¾ˆé‡è¦çš„ï¼ŒæŒ‰ç…§å°æ—¶æˆ–è€…å¤©é›†ä¸­åœ°è¿›è¡Œå¤‡ä»½æ¯”è¾ƒå¥½ï¼Œå› ä¸ºä»–çš„æ–‡ä»¶å¾ˆå°ï¼Œåˆ©äºŽä¼ è¾“ã€‚ â€œä¸»ä»Žï¼Œä»Žå¼€â€ï¼šæœ‰æ—¶å€™ä»ŽèŠ‚ç‚¹æ‰“å¼€è¿™ä¸ªåŠŸèƒ½æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œä½†æ˜¯å¤‡ä»½å¤ªé¢‘ç¹ï¼Œå–å†³äºŽå®žé™…çš„åœºæ™¯ã€‚ AOFæœ€ä½³ç­–ç•¥ â€œå¼€â€ï¼šå»ºè®®æ‰“å¼€ï¼Œå¦‚æžœä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªæ™®é€šç¼“å­˜ï¼Œå¯¹äºŽæ•°æ®è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œè¿™æ¬¡æ•°æ®ä¸¢äº†ï¼Œä¸‹æ¬¡å¯ä»¥ä»Žæ•°æ®åº“å–(æ•°æ®åº“åŽ‹åŠ›ä¸æ˜¯å¾ˆå¤§)ï¼Œè¿™ç§æƒ…å†µå°±å»ºè®®å…³é—­ï¼Œå› ä¸ºAOFè¿˜æ˜¯æœ‰æ€§èƒ½å¼€é”€çš„ã€‚ â€œeverysecâ€ Redis4 Redis 4.0 æ–°å¢žäº† RDB-AOF æ··åˆæŒä¹…åŒ–æ ¼å¼ï¼Œ è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„åŠŸèƒ½ï¼Œ åœ¨å¼€å¯äº†è¿™ä¸ªåŠŸèƒ½ä¹‹åŽï¼Œ AOF é‡å†™äº§ç”Ÿçš„æ–‡ä»¶å°†åŒæ—¶åŒ…å« RDB æ ¼å¼çš„å†…å®¹å’Œ AOF æ ¼å¼çš„å†…å®¹ï¼Œ å…¶ä¸­ RDB æ ¼å¼çš„å†…å®¹ç”¨äºŽè®°å½•å·²æœ‰çš„æ•°æ®ï¼Œ è€Œ AOF æ ¼å¼çš„å†…å­˜åˆ™ç”¨äºŽè®°å½•æœ€è¿‘å‘ç”Ÿäº†å˜åŒ–çš„æ•°æ®ï¼Œ è¿™æ · Redis å°±å¯ä»¥åŒæ—¶å…¼æœ‰ RDB æŒä¹…åŒ–å’Œ AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹ â€”â€” æ—¢èƒ½å¤Ÿå¿«é€Ÿåœ°ç”Ÿæˆé‡å†™æ–‡ä»¶ï¼Œ ä¹Ÿèƒ½å¤Ÿåœ¨å‡ºçŽ°é—®é¢˜æ—¶ï¼Œ å¿«é€Ÿåœ°è½½å…¥æ•°æ®ã€‚ RDBå’ŒAOFå…±å­˜çš„æƒ…å†µä¸‹å¦‚ä½•æ¢å¤æ•°æ®ï¼š ä¼˜ç‚¹ï¼š æ··åˆæŒä¹…åŒ–ç»“åˆäº†RDBæŒä¹…åŒ– å’Œ AOF æŒä¹…åŒ–çš„ä¼˜ç‚¹, ç”±äºŽç»å¤§éƒ¨åˆ†éƒ½æ˜¯RDBæ ¼å¼ï¼ŒåŠ è½½é€Ÿåº¦å¿«ï¼ŒåŒæ—¶ç»“åˆAOFï¼Œå¢žé‡çš„æ•°æ®ä»¥AOFæ–¹å¼ä¿å­˜äº†ï¼Œæ•°æ®æ›´å°‘çš„ä¸¢å¤±ã€‚ ç¼ºç‚¹ï¼š å…¼å®¹æ€§å·®ï¼Œä¸€æ—¦å¼€å¯äº†æ··åˆæŒä¹…åŒ–ï¼Œåœ¨4.0ä¹‹å‰ç‰ˆæœ¬éƒ½ä¸è¯†åˆ«è¯¥aofæ–‡ä»¶ï¼ŒåŒæ—¶ç”±äºŽå‰éƒ¨åˆ†æ˜¯RDBæ ¼å¼ï¼Œé˜…è¯»æ€§è¾ƒå·® ç­–ç•¥æ˜¯ï¼š 6. æ€»ç»“ http://www.ywnds.com/?p=4876]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥NginxåŽŸç†]]></title>
    <url>%2F2019%2F01%2F30%2Fmiscellany%2F13%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6Nginx%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[Nginxæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼ŒåŠç”µå­é‚®ä»¶ï¼ˆIMAP/POP3ï¼‰ä»£ç†æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªéžå¸¸é«˜æ•ˆçš„åå‘ä»£ç†ã€è´Ÿè½½å¹³è¡¡ä¸­é—´ä»¶ã€‚æ˜¯éžå¸¸å¸¸ç”¨çš„web server.æˆ‘ä»¬éœ€è¦ç†è§£å®ƒçš„åŽŸç†ï¼Œæ‰èƒ½è¾¾åˆ°æ¸¸åˆƒæœ‰ä½™çš„ç¨‹åº¦ã€‚ æœ¬ç¯‡æ–‡ç« éœ€è¦å¯¹Nginxæœ‰åŸºæœ¬çš„ä½¿ç”¨ä»¥åŠå¯¹IOå¤ç”¨æ¨¡åž‹æœ‰ä¸€å®šçš„äº†è§£ã€‚æ–‡ç« æ¯”è¾ƒé•¿ã€‚ 1.æ­£å‘ä»£ç†å’Œåå‘ä»£ç† æ­£å‘ä»£ç†çš„å·¥ä½œåŽŸç†å°±åƒä¸€ä¸ªè·³æ¿ï¼Œæ¯”å¦‚ï¼šæˆ‘è®¿é—®ä¸äº†google.comï¼Œä½†æ˜¯æˆ‘èƒ½è®¿é—®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨Aï¼ŒAèƒ½è®¿é—®google.comï¼ŒäºŽæ˜¯æˆ‘å…ˆè¿žä¸Šä»£ç†æœåŠ¡å™¨Aï¼Œå‘Šè¯‰ä»–æˆ‘éœ€è¦google.comçš„å†…å®¹ï¼ŒAå°±åŽ»å–å›žæ¥ï¼Œç„¶åŽè¿”å›žç»™æˆ‘ã€‚ä»Žç½‘ç«™çš„è§’åº¦ï¼Œåªåœ¨ä»£ç†æœåŠ¡å™¨æ¥å–å†…å®¹çš„æ—¶å€™æœ‰ä¸€æ¬¡è®°å½•ï¼Œæœ‰æ—¶å€™å¹¶ä¸çŸ¥é“æ˜¯ç”¨æˆ·çš„è¯·æ±‚ï¼Œä¹Ÿéšè—äº†ç”¨æˆ·çš„èµ„æ–™ï¼Œè¿™å–å†³äºŽä»£ç†å‘Šä¸å‘Šè¯‰ç½‘ç«™ã€‚ åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æŽ¥å—internetä¸Šçš„è¿žæŽ¥è¯·æ±‚ï¼Œç„¶åŽå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»ŽæœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æžœè¿”å›žç»™internetä¸Šè¯·æ±‚è¿žæŽ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨çŽ°ä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚ ç®€å•æ¥è¯´ï¼š æ­£å‘ä»£ç†æ˜¯ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯è°ï¼Œä»£ç†æ˜¯ä¸€ä¸ªè·³æ¿ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªè·³æ¿æ¥è®¿é—®åˆ°å¯¹åº”çš„å†…å®¹ã€‚ åå‘ä»£ç†æ˜¯ä¸çŸ¥é“æœåŠ¡ç«¯æ˜¯è°ï¼Œç”¨æˆ·çš„è¯·æ±‚è¢«è½¬å‘åˆ°å†…éƒ¨çš„æŸå°æœåŠ¡å™¨åŽ»å¤„ç†ã€‚ 2.åŸºæœ¬çš„å·¥ä½œæµç¨‹ ç”¨æˆ·é€šè¿‡åŸŸåå‘å‡ºè®¿é—®WebæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œè¯¥åŸŸåè¢«DNSæœåŠ¡å™¨è§£æžä¸ºåå‘ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼› åå‘ä»£ç†æœåŠ¡å™¨æŽ¥å—ç”¨æˆ·çš„è¯·æ±‚ï¼› åå‘ä»£ç†æœåŠ¡å™¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­æŸ¥æ‰¾è¯·æ±‚çš„å†…å®¹ï¼Œæ‰¾åˆ°åŽç›´æŽ¥æŠŠå†…å®¹å‘é€ç»™ç”¨æˆ·ï¼› å¦‚æžœæœ¬åœ°ç¼“å­˜é‡Œæ²¡æœ‰ç”¨æˆ·æ‰€è¯·æ±‚çš„ä¿¡æ¯å†…å®¹ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ä¼šä»£æ›¿ç”¨æˆ·å‘æºæœåŠ¡å™¨è¯·æ±‚åŒæ ·çš„ä¿¡æ¯å†…å®¹ï¼Œå¹¶æŠŠä¿¡æ¯å†…å®¹å‘ç»™ç”¨æˆ·ï¼Œå¦‚æžœä¿¡æ¯å†…å®¹æ˜¯ç¼“å­˜çš„è¿˜ä¼šæŠŠå®ƒä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚ 3.ä¼˜ç‚¹ ä¿æŠ¤äº†çœŸå®žçš„webæœåŠ¡å™¨ï¼Œä¿è¯äº†webæœåŠ¡å™¨çš„èµ„æºå®‰å…¨ èŠ‚çº¦äº†æœ‰é™çš„IPåœ°å€èµ„æº å‡å°‘WEBæœåŠ¡å™¨åŽ‹åŠ›ï¼Œæé«˜å“åº”é€Ÿåº¦(ç¼“å­˜åŠŸèƒ½) è¯·æ±‚çš„ç»Ÿä¸€æŽ§åˆ¶ï¼ŒåŒ…æ‹¬è®¾ç½®æƒé™ã€è¿‡æ»¤è§„åˆ™ç­‰ å®žçŽ°è´Ÿè½½å‡è¡¡ åŒºåˆ†åŠ¨æ€å’Œé™æ€å¯ç¼“å­˜å†…å®¹ â€¦ 4.ä½¿ç”¨åœºæ™¯ Nginxä½œä¸ºHttpä»£ç†ã€åå‘ä»£ç† Nginxä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ Ip hashç®—æ³•ï¼Œå¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„ipè¿›è¡Œhashæ“ä½œï¼Œç„¶åŽæ ¹æ®hashç»“æžœå°†åŒä¸€ä¸ªå®¢æˆ·ç«¯ipçš„è¯·æ±‚åˆ†å‘ç»™åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥è§£å†³sessionä¸å…±äº«çš„é—®é¢˜ã€‚ Nginxä½œä¸ºWebç¼“å­˜ 5.Nginxçš„Master-Workeræ¨¡å¼ å¯åŠ¨NginxåŽï¼Œå…¶å®žå°±æ˜¯åœ¨80ç«¯å£å¯åŠ¨äº†SocketæœåŠ¡è¿›è¡Œç›‘å¬ï¼Œå¦‚å›¾æ‰€ç¤ºï¼ŒNginxæ¶‰åŠMasterè¿›ç¨‹å’ŒWorkerè¿›ç¨‹ã€‚ 6.Masterè¿›ç¨‹çš„ä½œç”¨æ˜¯ï¼Ÿ è¯»å–å¹¶éªŒè¯é…ç½®æ–‡ä»¶nginx.confï¼›ç®¡ç†workerè¿›ç¨‹ï¼› æŽ¥æ”¶æ¥è‡ªå¤–ç•Œçš„ä¿¡å· å‘å„workerè¿›ç¨‹å‘é€ä¿¡å· ç›‘æŽ§workerè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå½“workerè¿›ç¨‹é€€å‡ºåŽ(å¼‚å¸¸æƒ…å†µä¸‹)ï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„workerè¿›ç¨‹ 7.Workerè¿›ç¨‹çš„ä½œç”¨æ˜¯ï¼Ÿ æ¯ä¸€ä¸ªWorkerè¿›ç¨‹éƒ½ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹ï¼ˆé¿å…çº¿ç¨‹åˆ‡æ¢ï¼‰ï¼Œå¤„ç†è¿žæŽ¥å’Œè¯·æ±‚ï¼›æ³¨æ„Workerè¿›ç¨‹çš„ä¸ªæ•°ç”±é…ç½®æ–‡ä»¶å†³å®šï¼Œä¸€èˆ¬å’ŒCPUä¸ªæ•°ç›¸å…³ï¼ˆæœ‰åˆ©äºŽè¿›ç¨‹åˆ‡æ¢ï¼‰ï¼Œé…ç½®å‡ ä¸ªå°±æœ‰å‡ ä¸ªWorkerè¿›ç¨‹ã€‚ æ€è€ƒï¼šNginxå¦‚ä½•åšåˆ°çƒ­éƒ¨ç½²ï¼Ÿ æ‰€è°“çƒ­éƒ¨ç½²ï¼Œå°±æ˜¯é…ç½®æ–‡ä»¶nginx.confä¿®æ”¹åŽï¼Œä¸éœ€è¦stop Nginxï¼Œä¸éœ€è¦ä¸­æ–­è¯·æ±‚ï¼Œå°±èƒ½è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ï¼ˆnginx -s reload é‡æ–°åŠ è½½/nginx -tæ£€æŸ¥é…ç½®/nginx -s stopï¼‰ é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬å·²ç»çŸ¥é“workerè¿›ç¨‹è´Ÿè´£å¤„ç†å…·ä½“çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå¦‚æžœæƒ³è¾¾åˆ°çƒ­éƒ¨ç½²çš„æ•ˆæžœï¼Œå¯ä»¥æƒ³è±¡ï¼š æ–¹æ¡ˆä¸€ï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶nginx.confåŽï¼Œä¸»è¿›ç¨‹masterè´Ÿè´£æŽ¨é€ç»™wokerè¿›ç¨‹æ›´æ–°é…ç½®ä¿¡æ¯ï¼Œwokerè¿›ç¨‹æ”¶åˆ°ä¿¡æ¯åŽï¼Œæ›´æ–°è¿›ç¨‹å†…éƒ¨çš„çº¿ç¨‹ä¿¡æ¯ã€‚ï¼ˆæœ‰ç‚¹volatileçš„å‘³é“ï¼‰ æ–¹æ¡ˆäºŒï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶nginx.confåŽï¼Œé‡æ–°ç”Ÿæˆæ–°çš„workerè¿›ç¨‹ï¼Œå½“ç„¶ä¼šä»¥æ–°çš„é…ç½®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼Œè€Œä¸”æ–°çš„è¯·æ±‚å¿…é¡»éƒ½äº¤ç»™æ–°çš„workerè¿›ç¨‹ï¼Œè‡³äºŽè€çš„workerè¿›ç¨‹ï¼Œç­‰æŠŠé‚£äº›ä»¥å‰çš„è¯·æ±‚å¤„ç†å®Œæ¯•åŽï¼ŒkillæŽ‰å³å¯ã€‚ Nginxé‡‡ç”¨çš„å°±æ˜¯æ–¹æ¡ˆäºŒæ¥è¾¾åˆ°çƒ­éƒ¨ç½²çš„ï¼ æ€è€ƒï¼šNginxå¦‚ä½•åšåˆ°é«˜å¹¶å‘ä¸‹çš„é«˜æ•ˆå¤„ç†ï¼Ÿ ä¸Šæ–‡å·²ç»æåŠNginxçš„workerè¿›ç¨‹ä¸ªæ•°ä¸ŽCPUç»‘å®šã€workerè¿›ç¨‹å†…éƒ¨åŒ…å«ä¸€ä¸ªçº¿ç¨‹é«˜æ•ˆå›žçŽ¯å¤„ç†è¯·æ±‚ï¼Œè¿™çš„ç¡®æœ‰åŠ©äºŽæ•ˆçŽ‡ï¼Œä½†è¿™æ˜¯ä¸å¤Ÿçš„ã€‚ ä½œä¸ºä¸“ä¸šçš„ç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å¯ä»¥å¼€ä¸€ä¸‹è„‘æ´žï¼šBIO/NIO/AIOã€å¼‚æ­¥/åŒæ­¥ã€é˜»å¡ž/éžé˜»å¡žâ€¦ è¦åŒæ—¶å¤„ç†é‚£ä¹ˆå¤šçš„è¯·æ±‚ï¼Œè¦çŸ¥é“ï¼Œæœ‰çš„è¯·æ±‚éœ€è¦å‘ç”ŸIOï¼Œå¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå¦‚æžœç­‰ç€å®ƒï¼Œå°±ä¼šæ‹–æ…¢workerçš„å¤„ç†é€Ÿåº¦ã€‚ Nginxé‡‡ç”¨äº†Linuxçš„epollæ¨¡åž‹ï¼Œepollæ¨¡åž‹åŸºäºŽäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œå®ƒå¯ä»¥ç›‘æŽ§å¤šä¸ªäº‹ä»¶æ˜¯å¦å‡†å¤‡å®Œæ¯•ï¼Œå¦‚æžœOKï¼Œé‚£ä¹ˆæ”¾å…¥epollé˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ã€‚workeråªéœ€è¦ä»Žepollé˜Ÿåˆ—å¾ªçŽ¯å¤„ç†å³å¯ã€‚ æ€è€ƒï¼šNginxæŒ‚äº†æ€Žä¹ˆåŠžï¼Ÿ Nginxæ—¢ç„¶ä½œä¸ºå…¥å£ç½‘å…³ï¼Œå¾ˆé‡è¦ï¼Œå¦‚æžœå‡ºçŽ°å•ç‚¹é—®é¢˜ï¼Œæ˜¾ç„¶æ˜¯ä¸å¯æŽ¥å—çš„ã€‚ ç­”æ¡ˆæ˜¯ï¼šKeepalived+Nginxå®žçŽ°é«˜å¯ç”¨ã€‚ Keepalivedæ˜¯ä¸€ä¸ªé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯ç”¨æ¥é˜²æ­¢æœåŠ¡å™¨å•ç‚¹å‘ç”Ÿæ•…éšœï¼Œå¯ä»¥é€šè¿‡å’ŒNginxé…åˆæ¥å®žçŽ°WebæœåŠ¡çš„é«˜å¯ç”¨ã€‚ï¼ˆå…¶å®žï¼ŒKeepalivedä¸ä»…ä»…å¯ä»¥å’ŒNginxé…åˆï¼Œè¿˜å¯ä»¥å’Œå¾ˆå¤šå…¶ä»–æœåŠ¡é…åˆï¼‰ Keepalived+Nginxå®žçŽ°é«˜å¯ç”¨çš„æ€è·¯ï¼š ç¬¬ä¸€ï¼šè¯·æ±‚ä¸è¦ç›´æŽ¥æ‰“åˆ°Nginxä¸Šï¼Œåº”è¯¥å…ˆé€šè¿‡Keepalivedï¼ˆè¿™å°±æ˜¯æ‰€è°“è™šæ‹ŸIPï¼ŒVIPï¼‰ ç¬¬äºŒï¼šKeepalivedåº”è¯¥èƒ½ç›‘æŽ§Nginxçš„ç”Ÿå‘½çŠ¶æ€ï¼ˆæä¾›ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„è„šæœ¬ï¼Œå®šæœŸæ£€æŸ¥Nginxè¿›ç¨‹çŠ¶æ€ï¼Œè¿›è¡Œæƒé‡å˜åŒ–,ä»Žè€Œå®žçŽ°Nginxæ•…éšœåˆ‡æ¢ï¼‰ 6.nginx.conf ç¬¬ä¸€ï¼šlocationå¯ä»¥è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œåº”è¯¥æ³¨æ„æ­£åˆ™çš„å‡ ç§å½¢å¼ä»¥åŠä¼˜å…ˆçº§ã€‚ï¼ˆè¿™é‡Œä¸å±•å¼€ï¼‰ ç¬¬äºŒï¼šNginxèƒ½å¤Ÿæé«˜é€Ÿåº¦çš„å…¶ä¸­ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ï¼šåŠ¨é™åˆ†ç¦»ï¼Œå°±æ˜¯æŠŠé™æ€èµ„æºæ”¾åˆ°Nginxä¸Šï¼Œç”±Nginxç®¡ç†ï¼ŒåŠ¨æ€è¯·æ±‚è½¬å‘ç»™åŽç«¯ã€‚ ç¬¬ä¸‰ï¼šæˆ‘ä»¬å¯ä»¥åœ¨Nginxä¸‹æŠŠé™æ€èµ„æºã€æ—¥å¿—æ–‡ä»¶å½’å±žåˆ°ä¸åŒåŸŸåä¸‹ï¼ˆä¹Ÿå³æ˜¯ç›®å½•ï¼‰ï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ç»´æŠ¤ã€‚ ç¬¬å››ï¼šNginxå¯ä»¥è¿›è¡ŒIPè®¿é—®æŽ§åˆ¶ï¼Œæœ‰äº›ç”µå•†å¹³å°ï¼Œå°±å¯ä»¥åœ¨Nginxè¿™ä¸€å±‚ï¼Œåšä¸€ä¸‹å¤„ç†ï¼Œå†…ç½®ä¸€ä¸ªé»‘åå•æ¨¡å—ï¼Œé‚£ä¹ˆå°±ä¸å¿…ç­‰è¯·æ±‚é€šè¿‡Nginxè¾¾åˆ°åŽç«¯åœ¨è¿›è¡Œæ‹¦æˆªï¼Œè€Œæ˜¯ç›´æŽ¥åœ¨Nginxè¿™ä¸€å±‚å°±å¤„ç†æŽ‰ã€‚ é™¤äº†å¯ä»¥æ˜ å°„é™æ€èµ„æºï¼Œä¸Šé¢å·²ç»è¯´äº†ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ¥ä½¿ç”¨ã€‚ æ‰€è°“åå‘ä»£ç†ï¼Œå¾ˆç®€å•ï¼Œå…¶å®žå°±æ˜¯åœ¨locationè¿™ä¸€æ®µé…ç½®ä¸­çš„rootæ›¿æ¢æˆproxy_passå³å¯ã€‚rootè¯´æ˜Žæ˜¯é™æ€èµ„æºï¼Œå¯ä»¥ç”±Nginxè¿›è¡Œè¿”å›žï¼›è€Œproxy_passè¯´æ˜Žæ˜¯åŠ¨æ€è¯·æ±‚ï¼Œéœ€è¦è¿›è¡Œè½¬å‘ï¼Œæ¯”å¦‚ä»£ç†åˆ°Tomcatä¸Šã€‚ åå‘ä»£ç†ï¼Œä¸Šé¢å·²ç»è¯´äº†ï¼Œè¿‡ç¨‹æ˜¯é€æ˜Žçš„ï¼Œæ¯”å¦‚è¯´request -&gt; Nginx -&gt; Tomcatï¼Œé‚£ä¹ˆå¯¹äºŽTomcatè€Œè¨€ï¼Œè¯·æ±‚çš„IPåœ°å€å°±æ˜¯Nginxçš„åœ°å€ï¼Œè€ŒéžçœŸå®žçš„requeståœ°å€ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚ä¸è¿‡å¥½åœ¨Nginxä¸ä»…ä»…å¯ä»¥åå‘ä»£ç†è¯·æ±‚ï¼Œè¿˜å¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®HTTP HEADERã€‚ è´Ÿè½½å‡è¡¡ã€upstreamã€‘ ä¸Šé¢çš„åå‘ä»£ç†ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡proxy_passæ¥æŒ‡å®šTomcatçš„åœ°å€ï¼Œå¾ˆæ˜¾ç„¶æˆ‘ä»¬åªèƒ½æŒ‡å®šä¸€å°Tomcatåœ°å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚æžœæƒ³æŒ‡å®šå¤šå°æ¥è¾¾åˆ°è´Ÿè½½å‡è¡¡å‘¢ï¼Ÿ ç¬¬ä¸€ï¼Œé€šè¿‡upstreamæ¥å®šä¹‰ä¸€ç»„Tomcatï¼Œå¹¶æŒ‡å®šè´Ÿè½½ç­–ç•¥ï¼ˆIPHASHã€åŠ æƒè®ºè°ƒã€æœ€å°‘è¿žæŽ¥ï¼‰ï¼Œå¥åº·æ£€æŸ¥ç­–ç•¥ï¼ˆNginxå¯ä»¥ç›‘æŽ§è¿™ä¸€ç»„Tomcatçš„çŠ¶æ€ï¼‰ç­‰ã€‚ ç¬¬äºŒï¼Œå°†proxy_passæ›¿æ¢æˆupstreamæŒ‡å®šçš„å€¼å³å¯ã€‚ è´Ÿè½½å‡è¡¡å¯èƒ½å¸¦æ¥çš„é—®é¢˜ï¼Ÿ è´Ÿè½½å‡è¡¡æ‰€å¸¦æ¥çš„æ˜Žæ˜¾çš„é—®é¢˜æ˜¯ï¼Œä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥åˆ°A serverï¼Œä¹Ÿå¯ä»¥åˆ°B serverï¼Œè¿™å®Œå…¨ä¸å—æˆ‘ä»¬çš„æŽ§åˆ¶ï¼Œå½“ç„¶è¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œåªæ˜¯æˆ‘ä»¬å¾—æ³¨æ„çš„æ˜¯ï¼šç”¨æˆ·çŠ¶æ€çš„ä¿å­˜é—®é¢˜ï¼Œå¦‚Sessionä¼šè¯ä¿¡æ¯ï¼Œä¸èƒ½åœ¨ä¿å­˜åˆ°æœåŠ¡å™¨ä¸Šã€‚ 7.æƒŠç¾¤çŽ°è±¡ å®šä¹‰ï¼šæƒŠç¾¤æ•ˆåº”å°±æ˜¯å½“ä¸€ä¸ªfdçš„äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæ‰€æœ‰ç­‰å¾…è¿™ä¸ªfdçš„çº¿ç¨‹æˆ–è¿›ç¨‹éƒ½è¢«å”¤é†’ã€‚ Nginxçš„IOé€šå¸¸ä½¿ç”¨epollï¼Œepollå‡½æ•°ä½¿ç”¨äº†I/Oå¤ç”¨æ¨¡åž‹ã€‚ä¸ŽI/Oé˜»å¡žæ¨¡åž‹æ¯”è¾ƒï¼ŒI/Oå¤ç”¨æ¨¡åž‹çš„ä¼˜åŠ¿åœ¨äºŽå¯ä»¥åŒæ—¶ç­‰å¾…å¤šä¸ªï¼ˆè€Œä¸åªæ˜¯ä¸€ä¸ªï¼‰å¥—æŽ¥å­—æè¿°ç¬¦å°±ç»ªã€‚Nginxçš„epollå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š masterè¿›ç¨‹å…ˆå»ºå¥½éœ€è¦listençš„socketåŽï¼Œç„¶åŽå†forkå‡ºå¤šä¸ªwokerè¿›ç¨‹ï¼Œè¿™æ ·æ¯ä¸ªworkè¿›ç¨‹éƒ½å¯ä»¥åŽ»acceptè¿™ä¸ªsocket å½“ä¸€ä¸ªclientè¿žæŽ¥åˆ°æ¥æ—¶ï¼Œæ‰€æœ‰acceptçš„workè¿›ç¨‹éƒ½ä¼šå—åˆ°é€šçŸ¥ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥acceptæˆåŠŸï¼Œå…¶å®ƒçš„åˆ™ä¼šacceptå¤±è´¥ï¼ŒNginxæä¾›äº†ä¸€æŠŠå…±äº«é”accept_mutexæ¥ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªworkè¿›ç¨‹åœ¨acceptè¿žæŽ¥ï¼Œä»Žè€Œè§£å†³æƒŠç¾¤é—®é¢˜ å½“ä¸€ä¸ªworkerè¿›ç¨‹acceptè¿™ä¸ªè¿žæŽ¥åŽï¼Œå°±å¼€å§‹è¯»å–è¯·æ±‚ï¼Œè§£æžè¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚ï¼Œäº§ç”Ÿæ•°æ®åŽï¼Œå†è¿”å›žç»™å®¢æˆ·ç«¯ï¼Œæœ€åŽæ‰æ–­å¼€è¿žæŽ¥ï¼Œè¿™æ ·ä¸€ä¸ªå®Œæˆçš„è¯·æ±‚å°±ç»“æŸäº† 8.Nginxæž¶æž„åŠå·¥ä½œæµç¨‹ NginxçœŸæ­£å¤„ç†è¯·æ±‚ä¸šåŠ¡çš„æ˜¯Workerä¹‹ä¸‹çš„çº¿ç¨‹ã€‚workerè¿›ç¨‹ä¸­æœ‰ä¸€ä¸ªngx_worker_process_cycle()å‡½æ•°ï¼Œæ‰§è¡Œæ— é™å¾ªçŽ¯ï¼Œä¸æ–­å¤„ç†æ”¶åˆ°çš„æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶è¿›è¡Œå¤„ç†ï¼Œç›´åˆ°æ•´ä¸ªNginxæœåŠ¡è¢«åœæ­¢ã€‚ å½“ä¸€ä¸ª worker è¿›ç¨‹åœ¨ accept() è¿™ä¸ªè¿žæŽ¥ä¹‹åŽï¼Œå°±å¼€å§‹è¯»å–è¯·æ±‚ï¼Œè§£æžè¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚ï¼Œäº§ç”Ÿæ•°æ®åŽï¼Œå†è¿”å›žç»™å®¢æˆ·ç«¯ï¼Œæœ€åŽæ‰æ–­å¼€è¿žæŽ¥ï¼Œä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ã€‚ä¸€ä¸ªè¯·æ±‚ï¼Œå®Œå…¨ç”± worker è¿›ç¨‹æ¥å¤„ç†ï¼Œè€Œä¸”åªèƒ½åœ¨ä¸€ä¸ª worker è¿›ç¨‹ä¸­å¤„ç†ã€‚ è¿™æ ·åšå¸¦æ¥çš„å¥½å¤„ï¼š èŠ‚çœé”å¸¦æ¥çš„å¼€é”€ã€‚æ¯ä¸ª worker è¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸å…±äº«èµ„æºï¼Œä¸éœ€è¦åŠ é”ã€‚åŒæ—¶åœ¨ç¼–ç¨‹ä»¥åŠé—®é¢˜æŸ¥ä¸Šæ—¶ï¼Œä¹Ÿä¼šæ–¹ä¾¿å¾ˆå¤šã€‚ ç‹¬ç«‹è¿›ç¨‹ï¼Œå‡å°‘é£Žé™©ã€‚é‡‡ç”¨ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå¯ä»¥è®©äº’ç›¸ä¹‹é—´ä¸ä¼šå½±å“ï¼Œä¸€ä¸ªè¿›ç¨‹é€€å‡ºåŽï¼Œå…¶å®ƒè¿›ç¨‹è¿˜åœ¨å·¥ä½œï¼ŒæœåŠ¡ä¸ä¼šä¸­æ–­ï¼Œmaster è¿›ç¨‹åˆ™å¾ˆå¿«é‡æ–°å¯åŠ¨æ–°çš„ worker è¿›ç¨‹ã€‚å½“ç„¶ï¼Œworker è¿›ç¨‹çš„ä¹Ÿèƒ½å‘ç”Ÿæ„å¤–é€€å‡ºã€‚ 9.nginxä¸ºä»€ä¹ˆé«˜æ€§èƒ½ å› ä¸ºnginxæ˜¯å¤šè¿›ç¨‹å•çº¿ç¨‹çš„ä»£è¡¨ï¼Œå¤šè¿›ç¨‹æ¨¡åž‹æ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹åªèƒ½å¤„ç†ä¸€è·¯IOï¼Œé‚£ä¹ˆ Nginxæ˜¯å¦‚ä½•å¤„ç†å¤šè·¯IOå‘¢ï¼Ÿ å¦‚æžœä¸ä½¿ç”¨ IO å¤šè·¯å¤ç”¨ï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼ŒåŒæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯”å¦‚æ‰§è¡Œ accept()ï¼Œå¦‚æžœæ²¡æœ‰è¿žæŽ¥è¿‡æ¥ï¼Œé‚£ä¹ˆç¨‹åºä¼šé˜»å¡žåœ¨è¿™é‡Œï¼Œç›´åˆ°æœ‰ä¸€ä¸ªè¿žæŽ¥è¿‡æ¥ï¼Œæ‰èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ è€Œå¤šè·¯å¤ç”¨ï¼Œå…è®¸æˆ‘ä»¬åªåœ¨äº‹ä»¶å‘ç”Ÿæ—¶æ‰å°†æŽ§åˆ¶è¿”å›žç»™ç¨‹åºï¼Œè€Œå…¶ä»–æ—¶å€™å†…æ ¸éƒ½æŒ‚èµ·è¿›ç¨‹ï¼Œéšæ—¶å¾…å‘½ã€‚ æ ¸å¿ƒï¼šNginxé‡‡ç”¨çš„ IOå¤šè·¯å¤ç”¨æ¨¡åž‹epoll epollé€šè¿‡åœ¨Linuxå†…æ ¸ä¸­ç”³è¯·ä¸€ä¸ªç®€æ˜“çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆæ–‡ä»¶ç³»ç»Ÿä¸€èˆ¬ç”¨ä»€ä¹ˆæ•°æ®ç»“æž„å®žçŽ°ï¼ŸB+æ ‘ï¼‰ï¼Œå…¶å·¥ä½œæµç¨‹åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š è°ƒç”¨ int epoll_create(int size)å»ºç«‹ä¸€ä¸ªepollå¯¹è±¡ï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ªeventpollç»“æž„ä½“ï¼Œç”¨äºŽå­˜æ”¾é€šè¿‡epoll_ctl()å‘epollå¯¹è±¡ä¸­æ·»åŠ è¿›æ¥çš„äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶éƒ½ä¼šæŒ‚è½½åœ¨çº¢é»‘æ ‘ä¸­ã€‚ è°ƒç”¨ int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event) åœ¨ epoll å¯¹è±¡ä¸­ä¸º fd æ³¨å†Œäº‹ä»¶ï¼Œæ‰€æœ‰æ·»åŠ åˆ°epollä¸­çš„äº‹ä»¶éƒ½ä¼šä¸Žè®¾å¤‡é©±åŠ¨ç¨‹åºå»ºç«‹å›žè°ƒå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç›¸åº”çš„äº‹ä»¶å‘ç”Ÿæ—¶ä¼šè°ƒç”¨è¿™ä¸ªsockfdçš„å›žè°ƒæ–¹æ³•ï¼Œå°†sockfdæ·»åŠ åˆ°eventpoll ä¸­çš„åŒé“¾è¡¨ è°ƒç”¨ int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout) æ¥ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼Œtimeout ä¸º -1 æ—¶ï¼Œè¯¥è°ƒç”¨ä¼šé˜»å¡žç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿ è¿™æ ·ï¼Œæ³¨å†Œå¥½äº‹ä»¶ä¹‹åŽï¼Œåªè¦æœ‰ fd ä¸Šäº‹ä»¶å‘ç”Ÿï¼Œepoll_wait() å°±èƒ½æ£€æµ‹åˆ°å¹¶è¿”å›žç»™ç”¨æˆ·ï¼Œç”¨æˆ·å°±èƒ½â€éžé˜»å¡žâ€œåœ°è¿›è¡Œ I/O äº†ã€‚ epoll() ä¸­å†…æ ¸åˆ™ç»´æŠ¤ä¸€ä¸ªé“¾è¡¨ï¼Œepoll_wait ç›´æŽ¥æ£€æŸ¥é“¾è¡¨æ˜¯ä¸æ˜¯ç©ºå°±çŸ¥é“æ˜¯å¦æœ‰æ–‡ä»¶æè¿°ç¬¦å‡†å¤‡å¥½äº†ã€‚ï¼ˆepoll ä¸Ž select ç›¸æ¯”æœ€å¤§çš„ä¼˜ç‚¹æ˜¯ä¸ä¼šéšç€ sockfd æ•°ç›®å¢žé•¿è€Œé™ä½Žæ•ˆçŽ‡ï¼Œä½¿ç”¨ select() æ—¶ï¼Œå†…æ ¸é‡‡ç”¨è½®è®­çš„æ–¹æ³•æ¥æŸ¥çœ‹æ˜¯å¦æœ‰fd å‡†å¤‡å¥½ï¼Œå…¶ä¸­çš„ä¿å­˜ sockfd çš„æ˜¯ç±»ä¼¼æ•°ç»„çš„æ•°æ®ç»“æž„ fd_setï¼Œkey ä¸º fdï¼Œvalue ä¸º 0 æˆ–è€… 1ã€‚ï¼‰ èƒ½è¾¾åˆ°è¿™ç§æ•ˆæžœï¼Œæ˜¯å› ä¸ºåœ¨å†…æ ¸å®žçŽ°ä¸­ epoll æ˜¯æ ¹æ®æ¯ä¸ª sockfd ä¸Šé¢çš„ä¸Žè®¾å¤‡é©±åŠ¨ç¨‹åºå»ºç«‹èµ·æ¥çš„å›žè°ƒå‡½æ•°å®žçŽ°çš„ã€‚é‚£ä¹ˆï¼ŒæŸä¸ª sockfd ä¸Šçš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¸Žå®ƒå¯¹åº”çš„å›žè°ƒå‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œæ¥æŠŠè¿™ä¸ª sockfd åŠ å…¥é“¾è¡¨ï¼Œå…¶ä»–å¤„äºŽâ€œç©ºé—²çš„â€çŠ¶æ€çš„åˆ™ä¸ä¼šã€‚åœ¨è¿™ç‚¹ä¸Šï¼Œepoll å®žçŽ°äº†ä¸€ä¸ªâ€ä¼ªâ€AIOã€‚ä½†æ˜¯å¦‚æžœç»å¤§éƒ¨åˆ†çš„ I/O éƒ½æ˜¯â€œæ´»è·ƒçš„â€ï¼Œæ¯ä¸ª socket ä½¿ç”¨çŽ‡å¾ˆé«˜çš„è¯ï¼Œepollæ•ˆçŽ‡ä¸ä¸€å®šæ¯” select é«˜ï¼ˆå¯èƒ½æ˜¯è¦ç»´æŠ¤é˜Ÿåˆ—å¤æ‚ï¼‰ã€‚ å¯ä»¥çœ‹å‡ºï¼Œå› ä¸ºä¸€ä¸ªè¿›ç¨‹é‡Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹åŒæ—¶åªèƒ½åšä¸€ä»¶äº‹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¸æ–­åœ°åˆ‡æ¢æ¥â€œåŒæ—¶â€å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚ ä¾‹å­ï¼šNginx ä¼šæ³¨å†Œä¸€ä¸ªäº‹ä»¶ï¼šâ€œå¦‚æžœæ¥è‡ªä¸€ä¸ªæ–°å®¢æˆ·ç«¯çš„è¿žæŽ¥è¯·æ±‚åˆ°æ¥äº†ï¼Œå†é€šçŸ¥æˆ‘â€ï¼Œæ­¤åŽåªæœ‰è¿žæŽ¥è¯·æ±‚åˆ°æ¥ï¼ŒæœåŠ¡å™¨æ‰ä¼šæ‰§è¡Œ accept() æ¥æŽ¥æ”¶è¯·æ±‚ã€‚åˆæ¯”å¦‚å‘ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ PHP-FPMï¼‰è½¬å‘è¯·æ±‚ï¼Œå¹¶ç­‰å¾…è¯·æ±‚è¿”å›žæ—¶ï¼Œè¿™ä¸ªå¤„ç†çš„ worker ä¸ä¼šåœ¨è¿™é˜»å¡žï¼Œå®ƒä¼šåœ¨å‘é€å®Œè¯·æ±‚åŽï¼Œæ³¨å†Œä¸€ä¸ªäº‹ä»¶ï¼šâ€œå¦‚æžœç¼“å†²åŒºæŽ¥æ”¶åˆ°æ•°æ®äº†ï¼Œå‘Šè¯‰æˆ‘ä¸€å£°ï¼Œæˆ‘å†å°†å®ƒè¯»è¿›æ¥â€ï¼ŒäºŽæ˜¯è¿›ç¨‹å°±ç©ºé—²ä¸‹æ¥ç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚ è¿™æ ·ï¼ŒåŸºäºŽ å¤šè¿›ç¨‹+epollï¼Œ Nginx ä¾¿èƒ½å®žçŽ°é«˜å¹¶å‘ã€‚ 10.å‡ ç§è´Ÿè½½å‡è¡¡çš„ç®—æ³•ä»‹ç» è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åŽç«¯æœåŠ¡å™¨ï¼Œå¦‚æžœåŽç«¯æœåŠ¡å™¨downæŽ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ weight æŒ‡å®šè½®è¯¢å‡ çŽ‡ï¼Œweightå’Œè®¿é—®æ¯”çŽ‡æˆæ­£æ¯”ï¼Œç”¨äºŽåŽç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ip_hash æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æžœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®åŒä¸€ä¸ªåŽç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚ä½†æ˜¯ä¸èƒ½è§£å†³å®•æœºé—®é¢˜ã€‚ å‰ä¸‰ç§æ˜¯nginxè‡ªå¸¦çš„ï¼Œç›´æŽ¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å³å¯ä½¿ç”¨ã€‚ fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰ æŒ‰åŽç«¯æœåŠ¡å™¨çš„ç›¸åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œç›¸åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰ æŒ‰è®¿é—®urlçš„hashç»“æžœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåŽç«¯æœåŠ¡å™¨ï¼ŒåŽç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ 11.åŸºäºŽä¸åŒå±‚æ¬¡çš„è´Ÿè½½å‡è¡¡ ä¸ƒå±‚å°±æ˜¯åŸºäºŽURLç­‰åº”ç”¨å±‚ä¿¡æ¯çš„è´Ÿè½½å‡è¡¡ï¼› åŒç†ï¼Œè¿˜æœ‰åŸºäºŽMACåœ°å€çš„äºŒå±‚è´Ÿè½½å‡è¡¡å’ŒåŸºäºŽIPåœ°å€çš„ä¸‰å±‚è´Ÿè½½å‡è¡¡ã€‚ æ¢å¥è¯è¯´: äºŒå±‚è´Ÿè½½å‡è¡¡ä¼šé€šè¿‡ä¸€ä¸ªè™šæ‹ŸMACåœ°å€æŽ¥å—è¯·æ±‚ï¼Œç„¶åŽå†åˆ†é…åˆ°çœŸæ˜¯çš„MACåœ°å€ï¼› ä¸‰å±‚è´Ÿè½½å‡è¡¡ä¼šé€šè¿‡ä¸€ä¸ªè™šæ‹ŸIPåœ°å€æŽ¥æ”¶è¯·æ±‚ï¼Œç„¶åŽå†åˆ†é…åˆ°çœŸå®žçš„IPåœ°å€ï¼› å››å±‚é€šè¿‡è™šæ‹Ÿçš„URLæˆ–ä¸»æœºåæŽ¥æ”¶è¯·æ±‚ï¼Œç„¶åŽå†åˆ†é…åˆ°çœŸæ˜¯çš„æœåŠ¡å™¨ã€‚ æ‰€è°“çš„å››åˆ°ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯åœ¨å¯¹åŽå°çš„æœåŠ¡å™¨è¿›è¡Œè´Ÿè½½å‡è¡¡æ—¶ï¼Œä¾æ®å››å±‚çš„ä¿¡æ¯æˆ–ä¸ƒå±‚çš„ä¿¡æ¯æ¥å†³å®šæ€Žä¹ˆæ ·è½¬å‘æµé‡ã€‚ æ¯”å¦‚å››å±‚çš„è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯é€šè¿‡å‘å¸ƒä¸‰å±‚çš„IPåœ°å€ï¼ˆVIPï¼‰ï¼Œç„¶åŽåŠ å››å±‚çš„ç«¯å£å·ï¼Œæ¥å†³å®šå“ªäº›æµé‡éœ€è¦åšè´Ÿè½½å‡è¡¡ï¼Œå¯¹éœ€è¦å¤„ç†çš„æµé‡è¿›è¡ŒNATå¤„ç†ï¼Œè½¬å‘è‡³åŽå°æœåŠ¡å™¨ï¼Œå¹¶è®°å½•ä¸‹è¿™ä¸ªTCPæˆ–è€…UDPçš„æµé‡æ˜¯ç”±å“ªå°æœåŠ¡å™¨å¤„ç†çš„ï¼ŒåŽç»­è¿™ä¸ªè¿žæŽ¥çš„æ‰€æœ‰æµé‡éƒ½åŒæ ·è½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨å¤„ç†ã€‚ ä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯åœ¨å››å±‚çš„åŸºç¡€ä¸Šï¼ˆæ²¡æœ‰å››å±‚æ˜¯ç»å¯¹ä¸å¯èƒ½æœ‰ä¸ƒå±‚çš„ï¼‰ï¼Œå†è€ƒè™‘åº”ç”¨å±‚çš„ç‰¹å¾ï¼Œæ¯”å¦‚åŒä¸€ä¸ªWebæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œé™¤äº†æ ¹æ®VIPåŠ 80ç«¯å£è¾¨åˆ«æ˜¯å¦éœ€è¦å¤„ç†çš„æµé‡ï¼Œè¿˜å¯æ ¹æ®ä¸ƒå±‚çš„URLã€æµè§ˆå™¨ç±»åˆ«ã€è¯­è¨€æ¥å†³å®šæ˜¯å¦è¦è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœä½ çš„WebæœåŠ¡å™¨åˆ†æˆä¸¤ç»„ï¼Œä¸€ç»„æ˜¯ä¸­æ–‡è¯­è¨€çš„ï¼Œä¸€ç»„æ˜¯è‹±æ–‡è¯­è¨€çš„ï¼Œé‚£ä¹ˆä¸ƒå±‚è´Ÿè½½å‡è¡¡å°±å¯ä»¥å½“ç”¨æˆ·æ¥è®¿é—®ä½ çš„åŸŸåæ—¶ï¼Œè‡ªåŠ¨è¾¨åˆ«ç”¨æˆ·è¯­è¨€ï¼Œç„¶åŽé€‰æ‹©å¯¹åº”çš„è¯­è¨€æœåŠ¡å™¨ç»„è¿›è¡Œè´Ÿè½½å‡è¡¡å¤„ç†ã€‚ è´Ÿè½½å‡è¡¡å™¨é€šå¸¸ç§°ä¸ºå››å±‚äº¤æ¢æœºæˆ–ä¸ƒå±‚äº¤æ¢æœºã€‚å››å±‚äº¤æ¢æœºä¸»è¦åˆ†æžIPå±‚åŠTCP/UDPå±‚ï¼Œå®žçŽ°å››å±‚æµé‡è´Ÿè½½å‡è¡¡ã€‚ä¸ƒå±‚äº¤æ¢æœºé™¤äº†æ”¯æŒå››å±‚è´Ÿè½½å‡è¡¡ä»¥å¤–ï¼Œè¿˜æœ‰åˆ†æžåº”ç”¨å±‚çš„ä¿¡æ¯ï¼Œå¦‚HTTPåè®®URIæˆ–Cookieä¿¡æ¯ã€‚ è´Ÿè½½å‡è¡¡è®¾å¤‡ä¹Ÿå¸¸è¢«ç§°ä¸º&quot;å››åˆ°ä¸ƒå±‚äº¤æ¢æœº&quot;ï¼Œé‚£ä¹ˆå››å±‚å’Œä¸ƒå±‚ä¸¤è€…åˆ°åº•åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ ç¬¬ä¸€ï¼ŒæŠ€æœ¯åŽŸç†ä¸Šçš„åŒºåˆ«ã€‚ æ‰€è°“å››å±‚è´Ÿè½½å‡è¡¡ï¼Œä¹Ÿå°±æ˜¯ä¸»è¦é€šè¿‡æŠ¥æ–‡ä¸­çš„ç›®æ ‡åœ°å€å’Œç«¯å£ï¼Œå†åŠ ä¸Šè´Ÿè½½å‡è¡¡è®¾å¤‡è®¾ç½®çš„æœåŠ¡å™¨é€‰æ‹©æ–¹å¼ï¼Œå†³å®šæœ€ç»ˆé€‰æ‹©çš„å†…éƒ¨æœåŠ¡å™¨ã€‚ æ‰€è°“ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œä¹Ÿç§°ä¸ºâ€œå†…å®¹äº¤æ¢â€ï¼Œä¹Ÿå°±æ˜¯ä¸»è¦é€šè¿‡æŠ¥æ–‡ä¸­çš„çœŸæ­£æœ‰æ„ä¹‰çš„åº”ç”¨å±‚å†…å®¹ï¼Œå†åŠ ä¸Šè´Ÿè½½å‡è¡¡è®¾å¤‡è®¾ç½®çš„æœåŠ¡å™¨é€‰æ‹©æ–¹å¼ï¼Œå†³å®šæœ€ç»ˆé€‰æ‹©çš„å†…éƒ¨æœåŠ¡å™¨ã€‚ ç¬¬äºŒï¼Œåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚ ä¸ƒå±‚åº”ç”¨è´Ÿè½½çš„å¥½å¤„ï¼Œæ˜¯ä½¿å¾—æ•´ä¸ªç½‘ç»œæ›´&quot;æ™ºèƒ½åŒ–&quot;ã€‚ä¾‹å¦‚è®¿é—®ä¸€ä¸ªç½‘ç«™çš„ç”¨æˆ·æµé‡ï¼Œå¯ä»¥é€šè¿‡ä¸ƒå±‚çš„æ–¹å¼ï¼Œå°†å¯¹å›¾ç‰‡ç±»çš„è¯·æ±‚è½¬å‘åˆ°ç‰¹å®šçš„å›¾ç‰‡æœåŠ¡å™¨å¹¶å¯ä»¥ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ï¼›å°†å¯¹æ–‡å­—ç±»çš„è¯·æ±‚å¯ä»¥è½¬å‘åˆ°ç‰¹å®šçš„æ–‡å­—æœåŠ¡å™¨å¹¶å¯ä»¥ä½¿ç”¨åŽ‹ç¼©æŠ€æœ¯ã€‚ å¦å¤–ä¸€ä¸ªå¸¸å¸¸è¢«æåˆ°åŠŸèƒ½å°±æ˜¯å®‰å…¨æ€§ã€‚ 12.æ€»ç»“ ç†è§£æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„æ¦‚å¿µ nginxçš„ä¼˜ç‚¹å’Œä½¿ç”¨åœºæ™¯ masterå’Œworkä¸¤ç§è¿›ç¨‹çš„ä½œç”¨ å¦‚ä½•çƒ­éƒ¨ç½² Nginxå•ç‚¹æ•…éšœçš„é¢„é˜² æ˜ å°„é™æ€æ–‡ä»¶ã€åå‘ä»£ç†è·³è½¬åˆ°åŽç«¯æœåŠ¡å™¨å¤„ç†çš„å†™æ³• æƒŠç¾¤çŽ°è±¡ Nginx é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹ï¼ˆå•çº¿ç¨‹ï¼‰ &amp; å¤šè·¯IOå¤ç”¨æ¨¡åž‹(åº•å±‚ä¾é epollå®žçŽ°) å‡ ç§è´Ÿè½½å‡è¡¡çš„ç®—æ³• å››å±‚çš„è´Ÿè½½å‡è¡¡å’Œä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡]]></content>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisä¸ºä»€ä¹ˆå¿«]]></title>
    <url>%2F2019%2F01%2F30%2Fredis%2FRedis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬å››ç¯‡æ–‡ç« ï¼Œæœ¬æ–‡ä¸»è¦æ”»å…‹é¢è¯•é¢˜-Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ã€‚è¿™å°±æ¶‰åŠRedisçš„çº¿ç¨‹æ¨¡åž‹å•¦ã€‚ å®Œå…¨åŸºäºŽå†…å­˜ Redisæ˜¯çº¯å†…å­˜æ•°æ®åº“ï¼Œç›¸å¯¹äºŽè¯»å†™ç£ç›˜ï¼Œè¯»å†™å†…å­˜çš„é€Ÿåº¦å°±ä¸æ˜¯å‡ å€å‡ åå€äº†ï¼Œä¸€èˆ¬ï¼ŒhashæŸ¥æ‰¾å¯ä»¥è¾¾åˆ°æ¯ç§’ç™¾ä¸‡æ¬¡çš„æ•°é‡çº§ã€‚ å¤šè·¯å¤ç”¨IO â€œå¤šè·¯â€æŒ‡çš„æ˜¯å¤šä¸ªç½‘ç»œè¿žæŽ¥ï¼Œâ€œå¤ç”¨â€æŒ‡çš„æ˜¯å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚é‡‡ç”¨å¤šè·¯ I/O å¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªè¿žæŽ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œIOçš„æ—¶é—´æ¶ˆè€—ï¼‰ã€‚ Redisä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„ï¼Ÿ å› ä¸ºCPUä¸æ˜¯Redisçš„ç“¶é¢ˆã€‚Redisçš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®žçŽ°ï¼Œè€Œä¸”CPUä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚ ä¸ºä»€ä¹ˆ Redis ä¸­è¦ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨è¿™ç§æŠ€æœ¯å‘¢ï¼Ÿ é¦–å…ˆï¼ŒRedis æ˜¯è·‘åœ¨å•çº¿ç¨‹ä¸­çš„ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æŒ‰ç…§é¡ºåºçº¿æ€§æ‰§è¡Œçš„ï¼Œä½†æ˜¯ç”±äºŽè¯»å†™æ“ä½œç­‰å¾…ç”¨æˆ·è¾“å…¥æˆ–è¾“å‡ºéƒ½æ˜¯é˜»å¡žçš„ï¼Œæ‰€ä»¥ I/O æ“ä½œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¾€å¾€ä¸èƒ½ç›´æŽ¥è¿”å›žï¼Œè¿™ä¼šå¯¼è‡´æŸä¸€æ–‡ä»¶çš„ I/O é˜»å¡žå¯¼è‡´æ•´ä¸ªè¿›ç¨‹æ— æ³•å¯¹å…¶å®ƒå®¢æˆ·æä¾›æœåŠ¡ï¼Œè€Œ I/O å¤šè·¯å¤ç”¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå‡ºçŽ°çš„ã€‚ å‡è®¾ä½ æ˜¯ä¸€ä¸ªè€å¸ˆï¼Œè®©30ä¸ªå­¦ç”Ÿè§£ç­”ä¸€é“é¢˜ç›®ï¼Œç„¶åŽæ£€æŸ¥å­¦ç”Ÿåšçš„æ˜¯å¦æ­£ç¡®ï¼Œä½ æœ‰ä¸‹é¢å‡ ä¸ªé€‰æ‹©ï¼š ç¬¬ä¸€ç§é€‰æ‹©ï¼šæŒ‰é¡ºåºé€ä¸ªæ£€æŸ¥ï¼Œå…ˆæ£€æŸ¥Aï¼Œç„¶åŽæ˜¯Bï¼Œä¹‹åŽæ˜¯Cã€Dã€‚ã€‚ã€‚è¿™ä¸­é—´å¦‚æžœæœ‰ä¸€ä¸ªå­¦ç”Ÿå¡ä¸»ï¼Œå…¨ç­éƒ½ä¼šè¢«è€½è¯¯ã€‚è¿™ç§æ¨¡å¼å°±å¥½æ¯”ï¼Œä½ ç”¨å¾ªçŽ¯æŒ¨ä¸ªå¤„ç†socketï¼Œæ ¹æœ¬ä¸å…·æœ‰å¹¶å‘èƒ½åŠ›ã€‚ ç¬¬äºŒç§é€‰æ‹©ï¼šä½ åˆ›å»º30ä¸ªåˆ†èº«ï¼Œæ¯ä¸ªåˆ†èº«æ£€æŸ¥ä¸€ä¸ªå­¦ç”Ÿçš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€‚ è¿™ç§ç±»ä¼¼äºŽä¸ºæ¯ä¸€ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å¤„ç†è¿žæŽ¥ã€‚ ç¬¬ä¸‰ç§é€‰æ‹©ï¼Œä½ ç«™åœ¨è®²å°ä¸Šç­‰ï¼Œè°è§£ç­”å®Œè°ä¸¾æ‰‹ã€‚è¿™æ—¶Cã€Dä¸¾æ‰‹ï¼Œè¡¨ç¤ºä»–ä»¬è§£ç­”é—®é¢˜å®Œæ¯•ï¼Œä½ ä¸‹åŽ»ä¾æ¬¡æ£€æŸ¥Cã€Dçš„ç­”æ¡ˆï¼Œç„¶åŽç»§ç»­å›žåˆ°è®²å°ä¸Šç­‰ã€‚æ­¤æ—¶Eã€Aåˆä¸¾æ‰‹ï¼Œç„¶åŽåŽ»å¤„ç†Eå’ŒAã€‚ã€‚ã€‚ ç¬¬ä¸‰ç§å°±æ˜¯IOå¤ç”¨æ¨¡åž‹ï¼ŒLinuxä¸‹çš„selectã€pollå’Œepollå°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚å°†ç”¨æˆ·socketå¯¹åº”çš„fdæ³¨å†Œè¿›epollï¼Œç„¶åŽepollå¸®ä½ ç›‘å¬å“ªäº›socketä¸Šæœ‰æ¶ˆæ¯åˆ°è¾¾ï¼Œè¿™æ ·å°±é¿å…äº†å¤§é‡çš„æ— ç”¨æ“ä½œã€‚æ­¤æ—¶çš„socketåº”è¯¥é‡‡ç”¨éžé˜»å¡žæ¨¡å¼ã€‚è¿™æ ·ï¼Œæ•´ä¸ªè¿‡ç¨‹åªåœ¨è°ƒç”¨selectã€pollã€epollè¿™äº›è°ƒç”¨çš„æ—¶å€™æ‰ä¼šé˜»å¡žï¼Œæ”¶å‘å®¢æˆ·æ¶ˆæ¯æ˜¯ä¸ä¼šé˜»å¡žçš„ï¼Œæ•´ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å°±è¢«å……åˆ†åˆ©ç”¨èµ·æ¥ï¼Œè¿™å°±æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œæ‰€è°“çš„reactoræ¨¡å¼ã€‚ æ‰€ä»¥ï¼ŒI/Oå¤šè·¯å¤ç”¨çš„æœ¬è´¨æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼ˆç³»ç»Ÿå†…æ ¸ç¼“å†²I/Oæ•°æ®ï¼‰ï¼Œè®©å•ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚ è¿™é‡Œè¿˜æ¶‰åŠä¸€ä¸ªåè¯ï¼šfdæ–‡ä»¶æè¿°ç¬¦ã€‚ Linux ç³»ç»Ÿä¸­ï¼ŒæŠŠä¸€åˆ‡éƒ½çœ‹åšæ˜¯æ–‡ä»¶ï¼Œå½“è¿›ç¨‹æ‰“å¼€çŽ°æœ‰æ–‡ä»¶æˆ–åˆ›å»ºæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›žä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ–‡ä»¶æè¿°ç¬¦å°±æ˜¯å†…æ ¸ä¸ºäº†é«˜æ•ˆç®¡ç†å·²è¢«æ‰“å¼€çš„æ–‡ä»¶æ‰€åˆ›å»ºçš„ç´¢å¼•ï¼Œç”¨æ¥æŒ‡å‘è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰€æœ‰æ‰§è¡ŒI/Oæ“ä½œçš„ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ã€‚ redisçš„çº¿ç¨‹æ¨¡åž‹ï¼Ÿ Redis æœåŠ¡é‡‡ç”¨ Reactor çš„æ–¹å¼æ¥å®žçŽ°æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ã€‚ æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨æ¨¡å—åŒæ—¶ç›‘å¬å¤šä¸ª FDï¼Œå½“ acceptã€readã€write å’Œ close æ–‡ä»¶äº‹ä»¶äº§ç”Ÿæ—¶ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šå›žè°ƒ FD ç»‘å®šçš„äº‹ä»¶å¤„ç†å™¨ã€‚ è™½ç„¶æ•´ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯åœ¨å•çº¿ç¨‹ä¸Šè¿è¡Œçš„ï¼Œä½†æ˜¯é€šè¿‡ I/O å¤šè·¯å¤ç”¨æ¨¡å—çš„å¼•å…¥ï¼Œå®žçŽ°äº†åŒæ—¶å¯¹å¤šä¸ª FD è¯»å†™çš„ç›‘æŽ§ï¼Œæé«˜äº†ç½‘ç»œé€šä¿¡æ¨¡åž‹çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¿è¯æ•´ä¸ª Redis æœåŠ¡å®žçŽ°çš„ç®€å•ã€‚ ä¸Šé¢ç®€å•ç†è§£å°±æ˜¯ï¼šå¤šä¸ªç½‘ç»œè¿žæŽ¥å¹¶å‘è¯»å†™redisçš„æ—¶å€™ï¼Œå…ˆå°†å¯¹åº”çš„fdæ³¨å†Œåˆ°epollä¸Šï¼ŒI/Oå¤šè·¯å¤ç”¨æ¨¡å—ä¼šç›‘å¬è¿™äº›ç½‘ç»œè¯·æ±‚çš„æƒ…å†µï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªç½‘ç»œè¿žæŽ¥äº§ç”Ÿäº†acceptã€readã€write å’Œ close æ–‡ä»¶äº‹ä»¶ï¼ŒI/Oå¤šè·¯å¤ç”¨æ¨¡å—å°±ä¼šå‘æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä¼ é€é‚£äº›äº§ç”Ÿäº†äº‹ä»¶çš„ç½‘ç»œè¿žæŽ¥ã€‚ å½“ç„¶äº†ï¼Œä¸Šé¢çš„æ–‡ä»¶äº‹ä»¶å¯èƒ½ä¼šå¹¶å‘äº§ç”Ÿï¼Œè¿™æ—¶çš„ç­–ç•¥æ˜¯ï¼Œå°†æ‰€æœ‰äº§ç”Ÿäº‹ä»¶çš„å¥—æŽ¥å­—ï¼ˆå¯¹åº”ä¸Šé¢çš„ç½‘ç»œè¿žæŽ¥ï¼‰éƒ½å…¥é˜Ÿåˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢ï¼Œ ç„¶åŽé€šè¿‡è¿™ä¸ªé˜Ÿåˆ—ï¼Œ ä»¥æœ‰åºï¼ˆsequentiallyï¼‰ã€åŒæ­¥ï¼ˆsynchronouslyï¼‰ã€æ¯æ¬¡ä¸€ä¸ªå¥—æŽ¥å­—çš„æ–¹å¼å‘æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä¼ é€å¥—æŽ¥å­—ï¼š å½“ä¸Šä¸€ä¸ªå¥—æŽ¥å­—äº§ç”Ÿçš„äº‹ä»¶è¢«å¤„ç†å®Œæ¯•ä¹‹åŽï¼ˆè¯¥å¥—æŽ¥å­—ä¸ºäº‹ä»¶æ‰€å…³è”çš„äº‹ä»¶å¤„ç†å™¨æ‰§è¡Œå®Œæ¯•ï¼‰ï¼Œ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ‰ä¼šç»§ç»­å‘æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä¼ é€ä¸‹ä¸€ä¸ªå¥—æŽ¥å­—ã€‚å†çœ‹çœ‹ä¸‹å›¾ï¼Œä¸Žä¸Šå›¾ä½¿ä¸€æ ·çš„ï¼š æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨æŽ¥æ”¶ I/O å¤šè·¯å¤ç”¨ç¨‹åºä¼ æ¥çš„å¥—æŽ¥å­—ï¼Œ å¹¶æ ¹æ®å¥—æŽ¥å­—äº§ç”Ÿçš„äº‹ä»¶çš„ç±»åž‹ï¼Œ è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚ æœåŠ¡å™¨ä¼šä¸ºæ‰§è¡Œä¸åŒä»»åŠ¡çš„å¥—æŽ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ï¼Œ è¿™äº›å¤„ç†å™¨æ˜¯ä¸€ä¸ªä¸ªå‡½æ•°ï¼Œ å®ƒä»¬å®šä¹‰äº†æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œ æœåŠ¡å™¨åº”è¯¥æ‰§è¡Œçš„åŠ¨ä½œã€‚ æ•´ä¸ªæ¨¡å—ä½¿ Redis èƒ½ä»¥å•è¿›ç¨‹è¿è¡Œçš„åŒæ—¶æœåŠ¡æˆåƒä¸Šä¸‡ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œé¿å…äº†ç”±äºŽå¤šè¿›ç¨‹åº”ç”¨çš„å¼•å…¥å¯¼è‡´ä»£ç å®žçŽ°å¤æ‚åº¦çš„æå‡ï¼Œå‡å°‘äº†å‡ºé”™çš„å¯èƒ½æ€§ï¼Œå•çº¿ç¨‹è¿˜å‡å°‘çº¿ç¨‹åˆ‡æ¢å’Œè°ƒåº¦ï¼Œå®žçŽ°æ›´åŠ ç®€å• æœ€åŽæ€»ç»“ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆredisæ¯”è¾ƒå¿«å¤§æ¦‚æ€è·¯é€šä¿—çš„è¯´å°±æ˜¯ï¼šRedisæ˜¯çº¯å†…å­˜æ•°æ®åº“ï¼Œè¯»å–å¿«ï¼Œç“¶é¢ˆåœ¨äºŽIOä¸Šï¼Œå¦‚æžœä½¿ç”¨é˜»å¡žå¼IOï¼Œå› ä¸ºæ˜¯å•çº¿ç¨‹çš„ç¼˜æ•…ï¼Œå°±ä¼šåœæ­¢ç­‰å¾…ã€‚æ‰€ä»¥é‡‡ç”¨IOå¤šè·¯å¤ç”¨ç›‘å¬æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ï¼Œå°†å¯¹redisçš„å¼€å…³è¯»å†™æ¢æˆäº‹ä»¶ï¼ŒåŠ å…¥é˜Ÿåˆ—è¿›è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†ï¼Œåžåé‡æ¯”è¾ƒå¤§ã€‚ IOå¤ç”¨æ¨¡åž‹çš„é€‰æ‹© å› ä¸º Redis éœ€è¦åœ¨å¤šä¸ªå¹³å°ä¸Šè¿è¡Œï¼ŒåŒæ—¶ä¸ºäº†æœ€å¤§åŒ–æ‰§è¡Œçš„æ•ˆçŽ‡ä¸Žæ€§èƒ½ï¼Œæ‰€ä»¥ä¼šæ ¹æ®ç¼–è¯‘å¹³å°çš„ä¸åŒé€‰æ‹©ä¸åŒçš„ I/O å¤šè·¯å¤ç”¨å‡½æ•°ä½œä¸ºå­æ¨¡å—ï¼Œæä¾›ç»™ä¸Šå±‚ç»Ÿä¸€çš„æŽ¥å£ï¼› å› ä¸º select å‡½æ•°æ˜¯ä½œä¸º POSIX æ ‡å‡†ä¸­çš„ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨ä¸åŒç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿä¸Šéƒ½ä¼šå®žçŽ°ï¼Œæ‰€ä»¥å°†å…¶ä½œä¸ºä¿åº•æ–¹æ¡ˆï¼š Redis ä¼šä¼˜å…ˆé€‰æ‹©æ—¶é—´å¤æ‚åº¦ä¸º O(1) çš„ I/O å¤šè·¯å¤ç”¨å‡½æ•°ä½œä¸ºåº•å±‚å®žçŽ°ï¼ŒåŒ…æ‹¬ Solaries 10 ä¸­çš„ evportã€Linux ä¸­çš„ epoll å’Œ macOS/FreeBSD ä¸­çš„ kqueueï¼Œä¸Šè¿°çš„è¿™äº›å‡½æ•°éƒ½ä½¿ç”¨äº†å†…æ ¸å†…éƒ¨çš„ç»“æž„ï¼Œå¹¶ä¸”èƒ½å¤ŸæœåŠ¡å‡ åä¸‡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ ä½†æ˜¯å¦‚æžœå½“å‰ç¼–è¯‘çŽ¯å¢ƒæ²¡æœ‰ä¸Šè¿°å‡½æ•°ï¼Œå°±ä¼šé€‰æ‹© select ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆï¼Œç”±äºŽå…¶åœ¨ä½¿ç”¨æ—¶ä¼šæ‰«æå…¨éƒ¨ç›‘å¬çš„æè¿°ç¬¦ï¼Œæ‰€ä»¥å…¶æ—¶é—´å¤æ‚åº¦è¾ƒå·® O(n)ï¼Œå¹¶ä¸”åªèƒ½åŒæ—¶æœåŠ¡ 1024 ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥ä¸€èˆ¬å¹¶ä¸ä¼šä»¥ select ä½œä¸ºç¬¬ä¸€æ–¹æ¡ˆä½¿ç”¨ã€‚ reidsåœ¨linuxä¸‹çš„å®‰è£… Rediså¯¹äºŽLinuxæ˜¯å®˜æ–¹æ”¯æŒçš„ï¼Œå®‰è£…èµ·æ¥ä¹Ÿéžå¸¸åœ°ç®€å•ï¼Œç›´æŽ¥ç¼–è¯‘æºç ç„¶åŽè¿›è¡Œå®‰è£…å³å¯ã€‚ è¿™é‡Œä»¥centosä¸ºä¾‹ï¼Œå¤§æ¦‚è¯´ä¸€ä¸‹æ­¥éª¤ï¼š ä¸‹è½½redisç¼–è¯‘å·¥å…·:yum install gccå’Œyum install g++ è§£åŽ‹redis.tar.gzæ–‡ä»¶ï¼Œè¿›åŽ»ä¹‹åŽè¿›è¡Œç¼–è¯‘:make ç„¶åŽå®‰è£…ï¼šmake install PREFIX=/usr/local/redis å®‰è£…æˆåŠŸä¹‹åŽè¿›å…¥/usr/local/redis/binä¸‹å¯åŠ¨redis ./redis-server]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rediså…¶ä»–çš„åŠŸèƒ½ä»‹ç»]]></title>
    <url>%2F2019%2F01%2F29%2Fredis%2FRedis%E5%85%B6%E4%BB%96%E7%9A%84%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»redisä¸€äº›å…¶ä»–çš„åŠŸèƒ½ã€‚é‡åˆ°æŸäº›åœºæ™¯çš„æ—¶å€™å¯ä»¥æƒ³åˆ°redisæ˜¯ä¸æ˜¯å¯ä»¥å®žçŽ°ã€‚ ä¸€ã€æ…¢æŸ¥è¯¢æ—¥å¿— 1.1 ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢æ—¥å¿— æ…¢æŸ¥è¯¢æ—¥å¿—å¸®åŠ©å¼€å‘å’Œè¿ç»´äººå‘˜å®šä½ç³»ç»Ÿå­˜åœ¨çš„æ…¢æ“ä½œã€‚æ…¢æŸ¥è¯¢æ—¥å¿—å°±æ˜¯ç³»ç»Ÿåœ¨å‘½ä»¤æ‰§è¡Œå‰åŽè®¡ç®—æ¯æ¡å‘½ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œå½“è¶…è¿‡é¢„è®¾é˜€å€¼ï¼Œå°±å°†è¿™æ¡å‘½ä»¤çš„ç›¸å…³ä¿¡æ¯ï¼ˆæ…¢æŸ¥è¯¢IDï¼Œå‘ç”Ÿæ—¶é—´æˆ³ï¼Œè€—æ—¶ï¼Œå‘½ä»¤çš„è¯¦ç»†ä¿¡æ¯ï¼‰è®°å½•ä¸‹æ¥ã€‚ 1.2 redisä¸€æ¡å‘½ä»¤ç®€å•çš„ç”Ÿå‘½å‘¨æœŸ æ…¢æŸ¥è¯¢åªä¼šå‡ºçŽ°åœ¨ã€3.æ‰§è¡Œå‘½ä»¤ã€‘è¿™ä¸ªé˜¶æ®µï¼Œå³æ…¢æŸ¥è¯¢åªè®°å½•å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œå¹¶ä¸åŒ…æ‹¬å‘½ä»¤æŽ’é˜Ÿæ—¶é—´å’Œç½‘ç»œä¼ è¾“æ—¶é—´ã€‚ 1.3 æ…¢æŸ¥è¯¢é…ç½®å‚æ•° æ…¢æŸ¥è¯¢çš„é¢„è®¾é˜€å€¼ slowlog-log-slower-than slowlog-log-slower-thanå‚æ•°å°±æ˜¯é¢„è®¾é˜€å€¼ï¼Œå•ä½æ˜¯å¾®ç§’,é»˜è®¤å€¼æ˜¯10000ï¼Œå¦‚æžœä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡10000å¾®å¦™(10æ¯«ç§’)ï¼Œé‚£ä¹ˆå®ƒå°†è¢«è®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ å¦‚æžœslowlog-log-slower-thançš„å€¼æ˜¯0ï¼Œåˆ™ä¼šè®°å½•æ‰€æœ‰å‘½ä»¤ã€‚ å¦‚æžœslowlog-log-slower-thançš„å€¼å°äºŽ0ï¼Œåˆ™ä»»ä½•å‘½ä»¤éƒ½ä¸ä¼šè®°å½•æ—¥å¿—ã€‚ redisçš„æ“ä½œä¸€èˆ¬æ˜¯å¾®å¦™çº§ï¼Œslowlog-log-slower-thanä¸è¦è®¾ç½®å¤ªå¤§ï¼Œä¸€èˆ¬è®¾ç½®ä¸º1æ¯«ç§’ã€‚æ”¯æŒåŠ¨æ€è®¾ç½®ã€‚ æ…¢æŸ¥è¯¢æ—¥å¿—çš„é•¿åº¦slowlog-max-len slowlog-max-lenåªæ˜¯è¯´æ˜Žäº†æ…¢æŸ¥è¯¢æ—¥å¿—æœ€å¤šå­˜å‚¨å¤šå°‘æ¡ã€‚ Redisä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œshowlog-max-lenå°±æ˜¯åˆ—è¡¨çš„æœ€å¤§é•¿åº¦ã€‚ å½“æ…¢æŸ¥è¯¢æ—¥å¿—å·²ç»åˆ°è¾¾åˆ—è¡¨çš„æœ€å¤§é•¿åº¦æ—¶ï¼Œåˆæœ‰æ…¢æŸ¥è¯¢æ—¥å¿—è¦è¿›å…¥åˆ—è¡¨ï¼Œåˆ™æœ€æ—©æ’å…¥åˆ—è¡¨çš„æ—¥å¿—å°†ä¼šè¢«ç§»å‡ºåˆ—è¡¨ï¼Œæ–°æ—¥å¿—è¢«æ’å…¥åˆ—è¡¨çš„æœ«å°¾ã€‚ é»˜è®¤æ˜¯128ï¼Œä½†æ˜¯slowlog-max-lenä¸è¦è®¾ç½®å¤ªå°ï¼Œå¯ä»¥è®¾ç½®ä¸º1000ä»¥ä¸Š. æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œæ…¢æŸ¥è¯¢è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šä¸¢å¤±éƒ¨åˆ†æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œå¯ä»¥å®šæœŸæ‰§è¡Œslow getå‘½ä»¤å°†æ…¢æŸ¥è¯¢æ—¥å¿—æŒä¹…åŒ–åˆ°å…¶ä»–å­˜å‚¨ä¸­ã€‚ç„¶åŽåˆ¶ä½œå¯è§†åŒ–ç•Œé¢æŸ¥è¯¢ã€‚ äºŒã€pipeline 2.1 ä¸ºä»€ä¹ˆä¼šå‡ºçŽ°Pipeline ç”¨æ™®é€šçš„getå’Œsetï¼Œå¦‚æžœåŒæ—¶éœ€è¦æ‰§è¡Œå¤§é‡çš„å‘½ä»¤ï¼Œé‚£å°±æ˜¯ç­‰å¾…ä¸Šä¸€æ¡å‘½ä»¤åº”ç­”åŽå†æ‰§è¡Œï¼Œè¿™ä¸­é—´ä¸ä»…ä»…å¤šäº†RTTï¼ˆRound Time Tripï¼‰ï¼Œè€Œä¸”è¿˜é¢‘ç¹çš„è°ƒç”¨ç³»ç»ŸIOï¼Œå‘é€ç½‘ç»œè¯·æ±‚ã€‚ å¯¹äºŽå¤šæ¡å‘½ä»¤ä¸æ˜¯æœ‰mgetå’Œmsetå—ï¼Ÿç¡®å®žå¯¹äºŽä¸€æ‰¹çš„getå’Œsetå¯ä»¥ç”¨mgetå’Œmsetï¼Œä½†æ˜¯å®ƒçš„é—®é¢˜åœ¨äºŽå¦‚æžœæˆ‘ä»¬éœ€è¦åŒæ—¶ä¼ è¾“getå’Œhgetå‘¢ï¼Ÿæ­¤æ—¶pipeline(æµæ°´çº¿)å°±å‡ºçŽ°äº†ã€‚ æ‰€ä»¥æµæ°´çº¿è§£å†³çš„é—®é¢˜æ˜¯Næ¡å‘½ä»¤ç½‘ç»œé€šä¿¡çš„å‡å°‘ã€‚ ä¸ºä»€ä¹ˆè¯´ç½‘ç»œè€—è´¹æ—¶é—´å¤§å‘¢ï¼Ÿè¿™é‡Œç»™å‡ºä¸€ä¸ªæžç«¯çš„ä¾‹å­ã€‚ pipelineä¸ŽåŽŸç”ŸMæ“ä½œçš„å¯¹æ¯”ã€‚ åŽŸç”ŸMæ“ä½œæ˜¯ä¸€ä¸ªåŽŸå­æ“ä½œã€‚ pipelineéžåŽŸå­å‘½ä»¤ã€‚ å½“æŸä¸ªå‘½ä»¤çš„æ‰§è¡Œéœ€è¦ä¾èµ–å‰ä¸€ä¸ªå‘½ä»¤çš„è¿”å›žç»“æžœæ—¶ï¼Œæ— æ³•ä½¿ç”¨pipelineã€‚ 12mset a â€œa1â€ b â€œbâ€ c â€œc1â€ mget a b c mgetå’Œmsetå‘½ä»¤ä¹Ÿæ˜¯ä¸ºäº†å‡å°‘ç½‘ç»œè¿žæŽ¥å’Œä¼ è¾“æ—¶é—´æ‰€è®¾ç½®çš„ï¼Œå…¶æœ¬è´¨å’Œpipelineçš„åº”ç”¨åŒºåˆ«ä¸å¤§ï¼Œä½†æ˜¯åœ¨ç‰¹å®šåœºæ™¯ä¸‹åªèƒ½ç”¨pipelineå®žçŽ°ï¼Œä¾‹å¦‚ï¼š 12get aset b â€˜1â€™ pipelineé€‚åˆæ‰§è¡Œè¿™ç§è¿žç»­ï¼Œä¸”æ— ç›¸å…³æ€§çš„å‘½ä»¤ã€‚ 2.2 ä¸€ä¸ªdemo æ­å»ºä¸€ä¸ªquickstartçš„mavenå·¥ç¨‹ã€‚è¿‡ç¨‹ç•¥ã€‚ å¼•å…¥ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt; ç›´æŽ¥å†å•å…ƒæµ‹è¯•ä¸­è¿›è¡Œæµ‹è¯•ï¼šæ™®é€šçš„ç›´æŽ¥hset 10000æ¡æ•°æ®ï¼š 1234567891011@Testpublic void test1()&#123; Jedis jedis = new Jedis("127.0.0.1",6379); long before = System.currentTimeMillis(); for(int i=0;i&lt;10000;i++)&#123; jedis.hset("hashkey"+i,"filed"+i,"value"+i); &#125; long after = System.currentTimeMillis(); System.out.println("ä¸€å…±è€—æ—¶: "+(after-before)+"ms");&#125; è¿è¡Œç»“æžœï¼š ä¸€å…±è€—æ—¶: 1526ms ä½†æ˜¯ç”¨pipelineåŽï¼š 123456789101112131415@Testpublic void test2()&#123; Jedis jedis = new Jedis("127.0.0.1",6379); long before = System.currentTimeMillis(); //åˆ†ä¸º10æ¬¡æ‰¹é‡å‘é€ for(int i=0;i&lt;10;i++)&#123; Pipeline pipeline = jedis.pipelined(); for(int j=1000*i;j&lt;(i+1)*1000;j++)&#123; pipeline.hset("hashkey:"+j,"field:"+j,"value:"+j); &#125; pipeline.syncAndReturnAll(); &#125; long after = System.currentTimeMillis(); System.out.println("ä½¿ç”¨pipelineä¸€å…±è€—æ—¶: "+(after-before)+"ms");&#125; è¿è¡Œç»“æžœï¼šä½¿ç”¨pipelineä¸€å…±è€—æ—¶: 139ms å¯ä»¥é¢„è§ï¼Œå¯¹äºŽæ›´å¤šçš„ä¼ è¾“æ¬¡æ•°ï¼Œpipelineçš„ä¼˜åŠ¿å°†è¶Šæ¥è¶Šæ˜Žæ˜¾ã€‚ä½†æ˜¯pipelineæ¯æ¬¡åªèƒ½ä½œç”¨åœ¨ä¸€ä¸ªredisèŠ‚ç‚¹ä¸Šã€‚ ä¸‰ã€å‘å¸ƒè®¢é˜… 3.1 è§’è‰² å‘å¸ƒè€…----é¢‘é“----è®¢é˜…è€… 3.2 æ¨¡åž‹ æ³¨æ„ï¼Œæ–°è®¢é˜…çš„ï¼Œæ˜¯ä¸èƒ½æ”¶åˆ°ä¹‹å‰çš„æ¶ˆæ¯çš„ã€‚ è®¢é˜…è€…1ï¼šsubscribe mytopic è®¢é˜…è€…2ï¼šsubscribe mytopic è®¢é˜…è€…3ï¼šsubscribe mytopic å‘å¸ƒè€…ï¼špublish mytopic â€œhelloâ€ ç¼ºç‚¹æ˜¯ä¸èƒ½ä¿è¯æ¶ˆæ¯å¯è¾¾ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ä¼ è¾¾æ¯”è¾ƒä¿éšœã€‚ ä¸Žå‘å¸ƒè®¢é˜…æ¨¡åž‹å¾ˆç±»ä¼¼çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æ¨¡åž‹ã€‚ åªæœ‰ä¸€ä¸ªæ˜¯å¯ä»¥æ”¶åˆ°æ¶ˆæ¯çš„ã€‚ å››ã€bitMap 4.1 ä½å›¾æ˜¯ä»€ä¹ˆ å°±æ˜¯é€šè¿‡ä¸€ä¸ªbitä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€,å…¶ä¸­çš„keyå°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº«ã€‚æˆ‘ä»¬çŸ¥é“8ä¸ªbitå¯ä»¥ç»„æˆä¸€ä¸ªByteï¼Œæ‰€ä»¥bitmapæœ¬èº«ä¼šæžå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚ Bitmapä¸æ˜¯ä¸€ä¸ªç¡®åˆ‡çš„æ•°æ®ç±»åž‹ï¼Œè€Œæ˜¯åŸºäºŽStringç±»åž‹å®šä¹‰çš„ä¸€ç³»åˆ—é¢å‘ä½æ“ä½œçš„æ–¹æ³•ã€‚å› ä¸ºStringæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„å¹¶ä¸”å®ƒä»¬çš„æœ€å¤§é•¿åº¦æ˜¯512MBï¼Œ æ‰€ä»¥Stringç±»åž‹å¾ˆåˆé€‚åŽ»ä½œä¸ºä¸€ä¸ª2^32é•¿åº¦çš„ä½æ•°ç»„ã€‚ æ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œ set hello big é‚£ä¹ˆè¿™ä¸ªbigå…¶å®žæ˜¯è¿™ä¸ªå½¢æ€ï¼š æ‰§è¡Œgetbit hello 0 å¾—åˆ°0ï¼› æ‰§è¡Œgetbit hello 1 å¾—åˆ°1 setbit hello 7 1ï¼Œé‚£ä¹ˆå†get hello å°†å¾—åˆ°cig 4.2 ä½å›¾æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ ä½å›¾é™¤äº†getbitå’Œsetbitä¹‹å¤–ï¼Œè¿˜æœ‰bitcount key [start end]ï¼Œå°±æ˜¯èŽ·å–æ‰§è¡ŒèŒƒå›´å†…çš„1çš„ä¸ªæ•°ã€‚ bitopä½œç”¨æ˜¯åšå¤šä¸ªBitmapçš„and,or,not,xoræ“ä½œã€‚ ä»¥ä¸€ä¸ªåœºæ™¯ä¸ºä¾‹ï¼šæ—¥æ´»è·ƒç”¨æˆ· æ¯æ¬¡ç”¨æˆ·ç™»å½•æ—¶ä¼šæ‰§è¡Œä¸€æ¬¡redis.setbit(daily_active_users, user_id, 1) å› ä¸ºæ—¥æ´»è·ƒç”¨æˆ·æ¯å¤©éƒ½å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦æ¯å¤©åˆ›å»ºä¸€ä¸ªæ–°çš„bitmapã€‚æˆ‘ä»¬ç®€å•åœ°æŠŠæ—¥æœŸï¼ˆå¹´æœˆæ—¥ï¼‰æ·»åŠ åˆ°keyåŽé¢ï¼Œä»¥åŽå°±å¯ä»¥æ ¹æ®å¹´æœˆæ—¥è¿™ä¸ªkeyæ‰¾åˆ°æŸå¤©æ´»è·ƒç”¨æˆ·ã€‚å®žçŽ°äº†è¿™ä¸ªåŠŸèƒ½ã€‚ ç¬¬äºŒä¸ªåœºæ™¯ï¼šç”¨æˆ·ç­¾åˆ°æƒ…å†µ å°†é‚£å¤©æ‰€ä»£è¡¨çš„ç½‘ç«™çš„ä¸Šçº¿æ—¥ä½œä¸ºoffsetå‚æ•°ï¼Œ æ¯”å¦‚,å¦‚æžœä»Šå¤©æ˜¯ç½‘ç«™ä¸Šçº¿çš„ç¬¬100å¤©,è€Œç”¨æˆ·$uid=10001åœ¨ä»Šå¤©é˜…è§ˆè¿‡ç½‘ç«™, é‚£ä¹ˆæ‰§è¡Œå‘½ä»¤SETBIT peter 100 1. å¦‚æžœæ˜Žå¤©$uid=10001ä¹Ÿç»§ç»­é˜…è§ˆç½‘ç«™,é‚£ä¹ˆæ‰§è¡Œå‘½ä»¤SETBIT peter 101 1 ,ä»¥æ­¤ç±»æŽ¨. ä»”ç»†æƒ³æƒ³ï¼Œç”¨ä½å›¾ï¼Œä¸€å¤©ç­¾åˆ°ä¸€æ¬¡åªè¦å ä¸€ä¸ªbitï¼Œ8å¤©æ‰å ä¸€ä¸ªå­—èŠ‚ã€‚é‚£ä¹ˆä¸€å¹´è¿™ä¸ªç”¨æˆ·ç­¾åˆ°å çš„æ•°æ®æ˜¯365/8=45.625ä¸ªå­—èŠ‚.å¦‚æžœä¸ç”¨ä½å›¾å®žçŽ°ï¼Œä¿å­˜ä¸€æ¡è®°å½•å°†è¿œè¿œå¤§äºŽä¸€ä¸ªæ¯”ç‰¹å§ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œå·®è·å°†ä¼šç‰¹åˆ«å¤§ã€‚ äº”ã€hyperLogLog åŸºäºŽHyperLogLogç®—æ³•ï¼šæžå°ç©ºé—´å®Œæˆç‹¬ç«‹æ•°é‡ç»Ÿè®¡ã€‚æœ¬è´¨è¿˜æ˜¯å­—ç¬¦ä¸²ã€‚ pfadd key element [element...]:å‘hyperloglogæ·»åŠ å…ƒç´  pfcount key [key...]:è®¡ç®—hyperloglogçš„ç‹¬ç«‹æ€»æ•° pfmerge destkey sourcekey [sourcekey...]:åˆå¹¶å¤šä¸ªhyperloglog apiä¾‹å­ ä¸ºä»€ä¹ˆè¦ç”¨hyperLogLogå‘¢ æˆ‘ä»¬ä¸Šé¢ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä»–çš„åŠŸèƒ½ç±»ä¼¼äºŽåŽ»é‡ï¼Œç»Ÿè®¡å‡ºæ‰€æœ‰ä¸ä¸€æ ·å…ƒç´ çš„ä¸ªæ•°ã€‚ ä»–çš„ä¼˜ç‚¹æ˜¯ï¼šå ç”¨å†…å­˜æžå°ã€‚ ç¼ºç‚¹ä¹Ÿæœ‰ï¼š ä»–å¯èƒ½ä¼šå‡ºé”™ï¼Œé”™è¯¯çŽ‡ä¸º0.81%ï¼Œçœ‹ä½ æ˜¯å¦èƒ½å¤Ÿå®¹å¿é”™è¯¯äº† ä¸èƒ½æ‹¿åˆ°å•æ¡æ•°æ® å…­ã€geo å­˜å‚¨ç»çº¬åº¦ã€è®¡ç®—ä¸¤åœ°è·ç¦»ã€èŒƒå›´è®¡ç®—ç­‰ã€‚ æåˆ°LBS(Location Based Service)ï¼ŒåŸºäºŽä½ç½®çš„æœåŠ¡ã€‚æˆ‘ç«‹å³æƒ³èµ·Mongodbçš„GEOå®žçŽ°åœ°ç†åæ ‡æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œå…·ä½“ä»‹ç»ä¸ºåœ°ç†ä½ç½®é™„è¿‘æŸ¥è¯¢çš„GEOHASHè§£å†³æ–¹æ¡ˆã€‚ mongodbæœ€å¤§çš„ç‰¹ç‚¹æ˜¯çµæ´»ï¼Œå› ä¸ºå…¶æ•°æ®æ˜¯ä»¥jsonçš„æ ¼å¼å­˜å‚¨ï¼Œæ‰€ä»¥å­—æ®µéšæ—¶å¯ä»¥å¢žåŠ æˆ–å‡å°‘ï¼›Redisçš„ç‰¹ç‚¹æ˜¯å¿«ï¼Œé€‚åˆå•ä¸€çš„ï¼Œç®€å•çš„ï¼Œå¤§é‡æ•°æ®çš„å­˜å‚¨ï¼›HBaseæˆ‘æ²¡æœ‰åšæ·±å…¥ç ”ç©¶ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å¤§ï¼Œé€‚åˆåšç¦»çº¿ç¼“å­˜ã€‚åœ¨å¤„ç†ç¤¾äº¤è¿™ç§å…³ç³»å¤æ‚çš„æ•°æ®å­˜å‚¨æ—¶ï¼Œä¾ç„¶è¿˜æ˜¯éœ€è¦ç”¨mysqlè¿™ç§å…³ç³»åž‹æ•°æ®åº“ï¼Œnosqlå¹¶ä¸èƒ½å®Œå…¨æ›¿ä»£ã€‚ ä¸ƒã€æ€»ç»“ é¦–å…ˆæ˜¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥å®šæ—¶åœ°æŒä¹…åŒ–ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªå¯è§†åŒ–é¡µé¢è¿›è¡Œç›‘æµ‹ã€‚ pipelineè§£å†³çš„æ˜¯å¯¹æ²¡æœ‰ç›¸äº’ä¾èµ–çš„æ“ä½œçš„æ‰¹é‡æ‰§è¡Œï¼Œå‡å°‘ç½‘ç»œä¼ è¾“å’ŒIOæ—¶é—´ã€‚ä½†æ˜¯å‘¢ï¼Œéœ€è¦æ³¨æ„ä¸€èˆ¬åªèƒ½å¾€ä¸€ä¸ªèŠ‚ç‚¹æ”¾æ•°æ®ï¼Œé¢å¯¹é›†ç¾¤çš„æ—¶å€™ï¼Œå°±éœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥äº†ã€‚msetã€mgetï¼Œç›®å‰åªæ”¯æŒå…·æœ‰ç›¸åŒslotå€¼çš„keyæ‰§è¡Œæ‰¹é‡æ“ä½œã€‚åŽæ–‡å†è®²ã€‚ å¯ä»¥å®žçŽ°å‘å¸ƒè®¢é˜…æ¨¡åž‹ä»¥åŠæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†æ˜¯æ¶ˆæ¯æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸èƒ½ä¿è¯æ¶ˆæ¯ä¸€å®šé€è¾¾ï¼Œæ‰€ä»¥éœ€è¦ç”¨ä¸“ä¸šçš„MQæ¥å®žçŽ°ã€‚ ä½å›¾ï¼Œå¯ä»¥å®žçŽ°æžå°çš„ç©ºé—´å®Œæˆå¯¹å¤§é‡ç”¨æˆ·ä¿¡æ¯çš„ç»Ÿè®¡ã€‚ åœ°ç†åæ ‡æœåŠ¡]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RedisåŸºæœ¬æ•°æ®ç»“æž„å’Œæ“ä½œ]]></title>
    <url>%2F2019%2F01%2F29%2Fredis%2FRedis%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬äºŒç¯‡æ–‡ç« ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»rediså¦‚ä½•å¯åŠ¨ï¼Œä»¥åŠåŸºæœ¬çš„é”®å‘½ä»¤å’Œäº”ç§åŸºæœ¬æ•°æ®ç±»åž‹çš„æ“ä½œã€‚éƒ¨åˆ†å›¾ç‰‡å¯èƒ½çœ‹ä¸æ¸…æ¥šï¼Œå¯ä»¥æ‹–åˆ°æ–°çª—å£æ‰“å¼€ã€‚ ä¸€ã€å¯åŠ¨æ–¹å¼ æˆ‘çš„çŽ¯å¢ƒæ˜¯windowsï¼Œé‚£ä¹ˆç›´æŽ¥è¿›å…¥redisçš„è§£åŽ‹ç›®å½•ä¸­ï¼Œåˆ†åˆ«æ‰§è¡Œredis-server.exeå’Œredis-cli.exeä¸¤ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºã€‚ä¹Ÿå¯ä»¥é€šè¿‡cmdå¯åŠ¨ï¼š ä¸è¦ç›´æŽ¥ç”¨crtl+Cå…³é—­serverï¼Œåœ¨linuxä¸‹ï¼Œç›´æŽ¥åœæŽ‰serverçš„è¯ï¼Œä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ã€‚æ­£ç¡®çš„åšæ³•æ˜¯åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ redis-cli.exe shutdown è¿˜å¯ä»¥æŒ‡å®šç«¯å£å¯åŠ¨ï¼š./redis-server.exe --port 6380 é‚£ä¹ˆå¯¹åº”å®¢æˆ·ç«¯è¿žæŽ¥ä¹Ÿè¦æŒ‡å®šç›¸åº” çš„ç«¯å£æ‰èƒ½è¿žæŽ¥ã€‚å…³é—­æœåŠ¡ç«¯ä¹Ÿè¦æŒ‡å®šç›¸åº”çš„ç«¯å£æ‰è¡Œï¼š -hæŒ‡å®šè¿œç¨‹redisçš„ip é€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨,å¯ä»¥åœ¨ä¸‹é¢è¿™ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šç«¯å£å·ï¼š ç»“åˆé…ç½®æ–‡ä»¶å¯åŠ¨: è¿˜å¯ä»¥è®¾ç½®å¯†ç ï¼š é‚£ä¹ˆå®¢æˆ·ç«¯è¿žæŽ¥å°±å¿…é¡»è¦å¯†ç éªŒè¯äº†ï¼š äºŒã€å‘½ä»¤ 1ã€åŸºç¡€å‘½ä»¤ info:æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ select (0-15)ï¼Œredisä¸€å…±æœ‰16ä¸ªå·¥ä½œåŒºé—´ï¼Œä¸€èˆ¬é»˜è®¤ä»Ž0å¼€å§‹ï¼Œåˆ°15. flushdbï¼šæ¸…ç©ºå½“å‰é€‰æ‹©çš„ç©ºé—´ flushallï¼šæ¸…ç©ºæ‰€æœ‰ dbsizeï¼šå½“å‰ç©ºé—´é‡Œé¢key-valueé”®å€¼å¯¹çš„æ•°ç›® saveï¼šäººå·¥å®žçŽ°redisçš„æŒä¹…åŒ– quitï¼šé€€å‡º 2ã€é”®å‘½ä»¤ del keyæˆåŠŸè¿”å›ž1ï¼Œå¤±è´¥è¿”å›ž0. exits key ttlå’Œexpire type key æŸ¥çœ‹keyçš„ç±»åž‹ randomkey: rename oldkey newkey å¦‚æžœæ˜¯é‡å‘½åä¸ºå·²ç»å­˜åœ¨çš„keyå‘¢ï¼Ÿ renamenx: ä¸‰ã€redisæ•°æ®ç»“æž„ 1ã€Stringå­—ç¬¦ä¸² setex&amp;psetex getrange&amp;getset mset&amp;mget&amp;strlen setnx&amp;msetnx æ•°å€¼æ“ä½œ 2ã€hash 3ã€list 4ã€set 5ã€sorted set]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆæ­¥è®¤è¯†Redis]]></title>
    <url>%2F2019%2F01%2F29%2Fredis%2F%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86Redis%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸ºrediså­¦ä¹ ç¬”è®°çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦ä»Žæ„Ÿæ€§å±‚é¢æ¥è®¤è¯†ä¸€ä¸‹è¿™ä¸ªå¼€å‘ä¸­çš„å® å„¿ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆåº”ç”¨ï¼Œåªè¦æœ‰ç‚¹ç”¨æˆ·é‡çš„ï¼Œä¸ä¸Šredisæ˜¯ä¸å¯èƒ½çš„ã€‚ä½œä¸ºå½“ä»Šæœ€ä¼˜ç§€çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œæ²¡æœ‰ç†ç”±ä¸åŽ»æ·±å…¥äº†è§£å®ƒï¼ ä¸€ã€redisæ˜¯ä»€ä¹ˆ rediså¾ˆå¿«ï¼Œå®˜æ–¹å®£ç§°QPS(æ¯ç§’æŸ¥è¯¢çŽ‡)è¾¾10ä¸‡ã€‚ Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å•è¿›ç¨‹å•çº¿ç¨‹ã€å¯åŸºäºŽå†…å­˜äº¦å¯æŒä¹…åŒ–ã€ä¸€ä¸ªé«˜æ€§èƒ½çš„key-valueæ•°æ®åº“ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ä¸€ä¸ªç¼“å­˜æ•°æ®åº“ï¼ŒåŸºäºŽå†…å­˜ï¼Œä¹Ÿå¯ä»¥æŒä¹…åŒ–ï¼Œé€Ÿåº¦è´¼å¿«ï¼Œå‡ ä¹Žæ‰€æœ‰äº’è”ç½‘å…¬å¸éƒ½åœ¨ä½¿ç”¨ã€‚ æœ‰çš„åˆå­¦è€…å¯èƒ½çœ‹åˆ°æ•°æ®åº“è¿™ä¸ªå­—çœ¼ï¼Œå°±æŠŠä»–å½’ç±»äºŽmysqlä¹‹ç±»ï¼Œå…¶å®žä¸æ˜¯ï¼Œmysqlæ˜¯ä¸€ç§å…³ç³»åž‹æ•°æ®åº“ï¼Œæ˜¯å­˜åœ¨ç£ç›˜ä¸­çš„ã€‚æ ¸å¿ƒçš„æ•°æ®æ˜¯ä¸€å®šè¦è½åœ°åˆ°mysqlä¹‹ç±»çš„æ•°æ®åº“ä¸­çš„ã€‚rediså…¶å®žä½¿ç”¨æœ€å¤šçš„åŠŸèƒ½æ˜¯ç¼“å­˜ï¼Œæ—¢ç„¶èƒ½å­˜ä¸œè¥¿ï¼Œé‚£ä¹ˆå¿…ç„¶ä¹Ÿæœ‰æ•°æ®åº“çš„åŠŸèƒ½ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šé€ æˆæ•°æ®çš„ç¼ºå¤±ã€‚æ‰€ä»¥ï¼Œæ•°æ®ä¸€å®šæ˜¯è¦è½å…¥æ•°æ®åº“æ‰ä¿é™©ï¼Œrediså¯ä»¥ä½œä¸ºç¼“å­˜ï¼Œç¼“å­˜çƒ­ç‚¹æ•°æ®æˆ–è€…åªè¯»æ•°æ®ï¼Œæé«˜æ€§èƒ½å¹¶ä¿æŠ¤æ•°æ®åº“ã€‚ äºŒã€ä¸ºä»€ä¹ˆè¦ç”¨redis å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç¼“å­˜ä¸­é—´ä»¶ã€‚é‚£ä¹ˆå¿…ç„¶ä¸€å¤§åŠŸèƒ½æ˜¯ä½œä¸ºç¼“å­˜ä½¿ç”¨ã€‚é‚£ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜å‘¢ï¼Ÿç›´æŽ¥ä»Žæ•°æ®åº“æŸ¥ä¸å°±è¡Œäº†ç ï¼Ÿ åœ¨å®žé™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œç”¨æˆ·é‡ä¸€ä¸Šæ¥ï¼Œæ•°æ®åº“æ˜¯åƒä¸æ¶ˆçš„ã€‚æ•°æ®åº“æ˜¯æ€§èƒ½çš„ä¸€å¤§ç“¶é¢ˆï¼Œå¦‚æžœä¸é‡‡å–æŽªæ–½ï¼Œç”¨æˆ·çš„æ“ä½œå°†å¡åœ¨æ•°æ®åº“å¤„ç†è¿™ä¸€å—ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´ä¸å¯ç”¨ã€‚ é‚£ä¹ˆï¼Œæ­¤æ—¶ï¼ŒåŠ å…¥ç¼“å­˜ï¼Œæ¯”å¦‚å•†åŸŽé¦–é¡µæœ‰å¾ˆå¤šå¾ˆå¤šå†…å®¹ï¼Œè¿™äº›å†…å®¹ä¸å¯èƒ½ç»å¸¸å˜åŒ–ï¼Œè‡³å°‘ä¹Ÿè¦ä¸¤ä¸‰å¤©å§ï¼Ÿæ‰€ä»¥ï¼Œå¯ä»¥å°†è¿™äº›æ•°æ®æ”¾åˆ°redisä¸­ï¼Œç”¨æˆ·è¿›å•†åŸŽä¹‹åŽï¼Œæ•°æ®ç›´æŽ¥ä»Žredisä¸­èŽ·å–å³å¯ã€‚é€Ÿåº¦æžå¿«ï¼Œæé«˜äº†ç”¨æˆ·çš„ä½“éªŒã€‚ æ—¢ç„¶æ˜¯ç¼“å­˜ï¼Œé‚£ä¹ˆå¿…å®šä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ‰€ä»¥ç¼“å­˜æœ€é€‚åˆäºŽè¯»å¤šå†™å°‘çš„æƒ…å†µï¼Œå½“ç„¶å•¦ï¼Œè¦ä¿®æ”¹ç¼“å­˜è‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¦æ³¨æ„çƒ­ç‚¹keyçš„é—®é¢˜ï¼Œæ¯”å¦‚å¾®åšæœ€ç«çš„ä¸€ç‰‡æ–°é—»ï¼Œæ­¤æ—¶æœ‰å‡ ç™¾ä¸‡äººå†çœ‹ï¼Œä½ å´è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œè‚¯å®šæ˜¯è¦æ³¨æ„ç‚¹ä»€ä¹ˆä¸œè¥¿æ‰è¡Œçš„ï¼ŒåŽç»­çš„æ–‡ç« ä¼šè®²åˆ°å¦‚ä½•å¤„ç†çƒ­ç‚¹keyä¿®æ”¹çš„é—®é¢˜ã€‚ ä¸‰ã€Redisä¸Žå…¶ä»–key-valueå­˜å‚¨æœ‰ä»€ä¹ˆä¸åŒ è¿™é‡Œå…ˆç®€å•è¯´è¯´ï¼ŒåŽé¢ä¼šæœ‰æ–‡ç« è¯¦ç»†æ¯”ä»·ä¸€ä¸‹ã€‚ å¤šæ ·çš„æ•°æ®ç»“æž„å’ŒåŽŸå­æ€§æ“ä½œ Redisæœ‰ç€æ›´ä¸ºå¤æ‚çš„æ•°æ®ç»“æž„å¹¶ä¸”æä¾›å¯¹ä»–ä»¬çš„åŽŸå­æ€§æ“ä½œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸åŒäºŽå…¶ä»–æ•°æ®åº“çš„è¿›åŒ–è·¯å¾„ã€‚redisä¸­çš„å•ä¸ªå‘½ä»¤éƒ½æ˜¯åŽŸå­æ€§çš„ï¼Œä»€ä¹ˆæ˜¯åŽŸå­æ€§ï¼Œå°±æ˜¯è¯¥å‘½ä»¤ä¸å¯åˆ†å‰²ã€‚ è¿è¡ŒäºŽå†…å­˜+æŒä¹…åŒ–äºŽç£ç›˜ Redisè¿è¡Œåœ¨å†…å­˜ä¸­ä½†æ˜¯å¯ä»¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥åœ¨å¯¹ä¸åŒæ•°æ®é›†è¿›è¡Œé«˜é€Ÿè¯»å†™æ—¶éœ€è¦æƒè¡¡å†…å­˜ï¼Œå› ä¸ºæ•°æ®é‡ä¸èƒ½å¤§äºŽç¡¬ä»¶å†…å­˜ã€‚å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œ ç›¸æ¯”åœ¨ç£ç›˜ä¸Šç›¸åŒçš„å¤æ‚çš„æ•°æ®ç»“æž„ï¼Œåœ¨å†…å­˜ä¸­æ“ä½œèµ·æ¥éžå¸¸ç®€å•ï¼Œè¿™æ ·Rediså¯ä»¥åšå¾ˆå¤šå†…éƒ¨å¤æ‚æ€§å¾ˆå¼ºçš„äº‹æƒ…ã€‚ åŒæ—¶ï¼Œåœ¨ç£ç›˜æ ¼å¼æ–¹é¢ä»–ä»¬æ˜¯ç´§å‡‘çš„ä»¥è¿½åŠ çš„æ–¹å¼äº§ç”Ÿçš„ï¼Œå› ä¸ºä»–ä»¬å¹¶ä¸éœ€è¦è¿›è¡Œéšæœºè®¿é—®ã€‚ æ³¨ï¼šæˆ‘ä»¬è¦çŸ¥é“ï¼Œå¯¹äºŽç£ç›˜çš„é¡ºåºè®¿é—®é€Ÿåº¦æ˜¯è¿œå¤§äºŽéšæœºè®¿é—®çš„ã€‚è¿™ç§åœ¨ç¡¬ç›˜ä¸Šé¡ºåºè¿½åŠ æ•ˆçŽ‡å¾ˆé«˜ã€‚ å››ã€redisç‰¹ç‚¹ é€Ÿåº¦å¿«ï¼š åŸºäºŽå†…å­˜,è¿™æ˜¯å¿«çš„æœ€ä¸»è¦åŽŸå› ã€‚ æŒä¹…åŒ–ï¼š å¯ä»¥åŒæ­¥æˆ–å¼‚æ­¥ä¿å­˜åˆ°ç£ç›˜ä¸­ å¤šç§æ•°æ®ç»“æž„ï¼š é™¤äº†äº”ç§åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œè¿˜æ”¯æŒä½å›¾ã€HyperLogLogï¼ŒGEOç­‰ æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å®¢æˆ·ç«¯ï¼š javaï¼Œpythonï¼Œrubyï¼ŒLuaâ€¦ åŠŸèƒ½ä¸°å¯Œï¼š å¯ä»¥å®žçŽ°å‘å¸ƒ-è®¢é˜…ï¼Œæ”¯æŒäº‹åŠ¡ã€Luaè„šæœ¬ ç®€å•ï¼š ä¸ä¾èµ–ä¸Žå¤–éƒ¨åº“ã€å•çº¿ç¨‹æ¨¡åž‹ ä¸»ä»Žå¤åˆ¶ï¼š ä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®åˆ°ä»ŽæœåŠ¡å™¨ï¼Œæ˜¯é«˜å¯ç”¨çš„åŸºç¡€ é«˜å¯ç”¨ã€åˆ†å¸ƒå¼ï¼š é«˜å¯ç”¨ï¼šredis-Sentinel(v2.8ç‰ˆæœ¬)ï¼›åˆ†å¸ƒå¼ï¼šredis-cluster(v3.0ç‰ˆæœ¬) äº”ã€rediså…¸åž‹åº”ç”¨åœºæ™¯ ç¼“å­˜ç³»ç»Ÿï¼šè¿™ä¸ªå°±ä¸å¤šè¯´äº†ï¼Œredisä½œä¸ºé«˜é€Ÿç¼“å­˜æ˜¯å…¶ä¸»è¦å­˜åœ¨ä»·å€¼ã€‚ è®¡æ•°å™¨ï¼šå› ä¸ºæ˜¯åŽŸå­æ“ä½œincr+å•çº¿ç¨‹ï¼Œä½œä¸ºè®¡æ•°å™¨æ°¸è¿œä¸ä¼šå‡ºé”™ æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼šæ•°æ®ç»“æž„listå¯ä»¥å®žçŽ°è¿™ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ æŽ’è¡Œæ¦œï¼šæœ‰åºé›†åˆsorted setå°±å¯ä»¥å®žçŽ° ç¤¾äº¤ç½‘ç»œï¼šredisä¸Žç¤¾äº¤ç½‘ç»œå°±æ˜¯ä¸€å®¶ï¼Œéžå¸¸æ–¹ä¾¿ç”¨setå°±èƒ½å®žçŽ°è¯¸å¦‚å…±åŒå¥½å‹è¿™äº›åŠŸèƒ½ã€‚ å…­ã€redisä¼˜åŠ¿ ç¼“å­˜ç®¡ç†ï¼šå¯ä»¥åœ¨å¿…è¦æ—¶å°†æ— æ•ˆçš„æ—§æ•°æ®ä»Žå†…å­˜ä¸­åˆ é™¤ï¼Œä¸ºæ–°æ•°æ®è…¾å‡ºæ–°çš„ç©ºé—´ æä¾›æ›´å¤§çš„çµæ´»æ€§ï¼šredisæ”¯æŒå¤šç§ç±»åž‹ï¼Œå¹¶ä¸”é‡‡ç”¨key-value çš„å½¢å¼å­˜å‚¨ï¼Œkeyå’Œvalueçš„å¤§å°é™åˆ¶éƒ½æ˜¯512Mb,ä¸Žç¼–ç æ— å…³ï¼Œæ‰€ä»¥æ•°æ®å®‰å…¨ã€‚ä½†æ˜¯memcachedé™åˆ¶keyæœ€å¤§ä¸º250å­—èŠ‚ï¼Œvalueä¸º1MBï¼Œå†µä¸”åªæ”¯æŒStringç±»åž‹ã€‚ redisæä¾›ä¸»ä»Žå¤åˆ¶ï¼šå®žçŽ°é«˜å¯ç”¨çš„cacheç³»ç»Ÿï¼Œæ”¯æŒé›†ç¾¤ä¸­å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚ æ•°æ®æŒä¹…åŒ–ï¼šrediså¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å°†æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§„é¿ç¼“å­˜ä¸­çš„æ•°æ®ä¸ç¨³å®šçš„é—®é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨é‡å¯æœåŠ¡å™¨æ—¶æœ€å¿«çš„æ¢å¤ç¼“å­˜ä¸­æ‰€éœ€çš„æ•°æ®ï¼Œæé«˜äº†æ•ˆçŽ‡çš„åŒæ—¶å‡è½»äº†ä¸»æ•°æ®åº“ç³»ç»Ÿçš„å¼€é”€ã€‚ ä¸Žä¼ ç»Ÿçš„Memcachedç›¸æ¯”ï¼Œä¼˜åŠ¿è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œä¸¤è€…çš„å…·ä½“å¯¹æ¯”æˆ‘ä¼šåœ¨åŽç»­çš„æ–‡ç« ä¸­è¯¦ç»†è¯´æ˜Žã€‚è¿™é‡Œæ³¨æ„å­˜åœ¨å³åˆç†ï¼ŒMemcachedä¹Ÿæœ‰ä¸å¯æ›¿ä»£çš„é€‚ç”¨åœºæ™¯ï¼š å­˜å‚¨ä¸€äº›ç²’åº¦æ¯”è¾ƒå°çš„é™æ€æ•°æ®ï¼Œæ¯”å¦‚ä¸€äº›htmlç‰‡æ®µï¼ŒMemcachedä¾¿æ˜¯æˆ‘ä»¬æ›´å¥½çš„é€‰æ‹©ã€‚ç›¸å¯¹äºŽredisè€Œè¨€ï¼ŒMemcachedçš„å…ƒæ•°æ®metadataæ›´å°äº›ï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è®²å¯¹äºŽæ•°æ®å­˜å‚¨ç®¡ç†çš„æ€§èƒ½æ›´é«˜ï¼Œé¢å¤–å¼€é”€æ›´å°ã€‚ Memcachedçš„ç‰¹ç‚¹ï¼šMemcachedå”¯ä¸€æ”¯æŒçš„æ•°æ®ç±»åž‹æ˜¯String,æ‰€ä»¥æ›´é€‚åˆå­˜å‚¨åªè¯»æ•°æ®ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¹¶ä¸ä¼šå› ä¸ºé¢å¤–çš„å¤„ç†é€ æˆé¢å¤–çš„å¼€é”€ã€‚æ¯•ç«ŸMemcachedæ¯æ¬¡æ›´æ–°ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œéƒ½éœ€è¦é‡å¤æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼šèŽ·å–æ•´ä¸ªå­—ç¬¦ä¸²-&gt;ååºåˆ—åŒ–ä¸ºå¯¹è±¡-&gt;ä¿®æ”¹å…¶ä¸­çš„å€¼-&gt;å†æ¬¡åºåˆ—åŒ–è¯¥å¯¹è±¡-&gt;åœ¨ç¼“å­˜ä¸­å°†æ•´ä¸ªå­—ç¬¦ä¸²æ›¿æ¢ä¸ºæ–°å­—ç¬¦ä¸²ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ›´æ–°å­˜å‚¨æ•°æ®å°±ä¼šæœ‰æ›´é«˜çš„æ¶ˆè€—ï¼Œå¯èƒ½å°±ä¸æ˜¯æˆ‘ä»¬çš„æœ€ä½³é€‰æ‹©äº†ã€‚ ä¸ƒã€æ€»ç»“ åªè¦è®°ä½redisä¸‰ä¸ªå…³é”®å­—ï¼šå¿«ã€æŒä¹…åŒ–ã€é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åœ°ç†ä½ç½®é™„è¿‘æŸ¥è¯¢çš„GEOHASHè§£å†³æ–¹æ¡ˆ]]></title>
    <url>%2F2019%2F01%2F29%2Fmiscellany%2F12%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E9%99%84%E8%BF%91%E6%9F%A5%E8%AF%A2%E7%9A%84GEOHASH%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%2F</url>
    <content type="text"><![CDATA[åœ°ç†ä½ç½®é™„è¿‘æŸ¥è¯¢çš„GEOHASHè§£å†³æ–¹æ¡ˆ 1.éœ€æ±‚åœºæ™¯ çŽ°ä»Šäº’è”ç½‘ç¡®å®žä»Žæ–¹æ–¹é¢é¢å½±å“æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚çŽ°åœ¨æˆ‘ä»¬å¯ä»¥è¶³ä¸å‡ºæˆ·å°±èƒ½ä¹°åˆ°æˆ‘ä»¬å¿ƒä»ªçš„è¡£æœï¼Œæ‰¾åˆ°é™„è¿‘çš„ç¾Žé£Ÿã€‚å½“æˆ‘ä»¬ç‚¹å¼€ä¸€ä¸ªå¤–å–çš„appå°±èƒ½çœ‹åˆ°è‡ªå·±é™„è¿‘çš„é¤åŽ…ï¼Œé‚£æˆ‘ä»¬æœ‰æ²¡æœ‰æƒ³è¿‡è¿™æ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿ 2.å°è¯•è§£å†³ é¦–å…ˆæˆ‘ä»¬èƒ½æƒ³åˆ°çš„å°±æ˜¯æŠŠæ‰€æœ‰é¤åŽ…çš„ç»çº¬åº¦å­˜ä¸‹æ¥ ç„¶åŽå½“ç”¨æˆ·é€‰æ‹©é™„è¿‘é¤åŽ…æ—¶ æˆ‘ä»¬å…ˆèŽ·å–ç”¨æˆ·çš„ç»çº¬åº¦ï¼Œç„¶åŽåˆ°æ•°æ®åº“ä¸­æŸ¥å‡ºæ‰€æœ‰çš„ç»çº¬åº¦ï¼Œä¾æ¬¡è®¡ç®—å®ƒä»¬å’Œç”¨æˆ·é—´çš„è·ç¦»ã€‚ æœ€åŽæ ¹æ®ç”¨æˆ·è¾“å…¥çš„è·ç¦»èŒƒå›´è¿‡æ»¤å‡ºåˆé€‚çš„é¤åŽ…ï¼Œå¹¶æ ¹æ®è·ç¦»åšä¸€ä¸ªå‡åºæŽ’åˆ—ã€‚ è¿™æ ·è²Œä¼¼èƒ½æŸ¥å‡ºé™„è¿‘çš„é¤åŽ…ï¼Œä½†æ˜¯é¤åŽ…çš„æ•°é‡è¿™ä¹ˆå¤šï¼Œç›´æŽ¥å…¨æŸ¥å‡ºæ¥å†…å­˜ä¹Ÿè¦çˆ†æŽ‰ï¼Œå³ä½¿åˆ†æ‰¹å¤„ç†è®¡ç®—é‡ä¹Ÿååˆ†å¤§ã€‚è¿™æ ·ç”¨æˆ·ç­‰å¾…çš„æ—¶é—´å°±ä¼šç‰¹åˆ«é•¿ã€‚é‚£æœ‰ä»€ä¹ˆåŠžæ³•èƒ½å‡å°‘æˆ‘ä»¬çš„è®¡ç®—é‡å‘¢ï¼Ÿ å…¶å®žå¾ˆç®€å•ï¼Œæˆ‘ä»¬åº”è¯¥åªè®¡ç®—ç”¨æˆ·å…³å¿ƒçš„é‚£ä¸€ç‰‡æ•°æ®ï¼Œè€Œä¸æ˜¯è®¡ç®—æ‰€æœ‰çš„ã€‚ä¾‹å¦‚ç”¨æˆ·åœ¨åŒ—äº¬ï¼Œé‚£å®Œå…¨æ²¡å¿…è¦è®¡ç®—æµ·å—ï¼Œé»‘é¾™æ±Ÿï¼Œæ–°ç–†ï¼Œæµ™æ±Ÿç­‰å…¶å®ƒåœ°åŒºçš„æ•°æ®ã€‚å¦‚æžœæˆ‘ä»¬èƒ½å¿«é€Ÿå®šä½åˆ°åŒ—äº¬ç”šè‡³æŸä¸ªåŒºï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è®¡ç®—é‡å°†å¤§å¤§å‡å°‘ã€‚æˆ‘ä»¬å‘çŽ°è¿™å…¶å®žå°±æ˜¯ç´¢å¼•çš„åŠŸèƒ½ï¼Œä½†æ˜¯MySQLå¯¹è¿™ç§äºŒç»´çš„åœ°ç†ä½ç½®çš„ç´¢å¼•æ”¯æŒå¹¶ä¸å‹å¥½ï¼ˆmongodbæœ‰ç›´æŽ¥çš„åœ°ç†ä½ç½®ç´¢å¼•ï¼‰ï¼Œå®ƒå¯¹ä¸€ç»´çš„åƒå­—ç¬¦ä¸²è¿™æ ·çš„æ”¯æŒå¾ˆå¥½ã€‚é‚£å¦‚æžœæˆ‘ä»¬çš„æ•°æ®åœ¨MySQLä¸­ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½å°†æˆ‘ä»¬çš„äºŒç»´åæ ‡è½¬æ¢ä¸ºä¸€ç§å¯æ¯”è¾ƒçš„å­—ç¬¦ä¸²å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„geohashç®—æ³•ã€‚ 3.åŸºæœ¬æ€æƒ³ geohashç®€å•æ¥è¯´å°±æ˜¯å°†ä¸€ä¸ªåœ°ç†åæ ‡è½¬æ¢ä¸ºä¸€ä¸ªå¯æ¯”è¾ƒçš„å­—ç¬¦ä¸²çš„ç®—æ³•ã€‚ä¸è¿‡ç”Ÿæˆçš„å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªçŸ©å½¢çš„èŒƒå›´ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªç‚¹ã€‚ æ¯”å¦‚è¥¿äºŒæ——åœ°é“é™„è¿‘è¿™ä¸€ç‰‡çŸ©å½¢åŒºåŸŸå°±å¯ä»¥ç”¨wx4eyu82è¿™ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¹¶ä¸”è¶Šé å‰çš„ç¼–ç è¡¨ç¤ºé¢èŒƒå›´è¶Šå¤§ï¼Œæ¯”å¦‚ä¸­å›½ç»å¤§éƒ¨åˆ†åœ°åŒºå¯ä»¥ç”¨wè¿™ä¸ªå­—æ¯è¡¨ç¤ºçš„çŸ©å½¢åŒºåŸŸå†…ã€‚åƒwx4eyu82è¡¨ç¤ºçš„åŒºåŸŸä¸€å®šåœ¨wx4eè¡¨ç¤ºçš„åŒºåŸŸèŒƒå›´å†…ã€‚åˆ©ç”¨è¿™äº›ç‰¹æ€§æˆ‘ä»¬å°±å¯ä»¥å®žçŽ°é™„è¿‘é¤åŽ…çš„åŠŸèƒ½äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›æŸ¥çœ‹è¥¿äºŒæ——åœ°é“é™„è¿‘çš„é¤åŽ…å°±å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼šselect * from table where geohash like 'wx4eyu82%'; è¿™æ ·å°±å¯ä»¥åˆ©ç”¨ç´¢å¼•ï¼Œå¿«é€ŸæŸ¥è¯¢å‡ºç›¸å…³é¤åŽ…çš„ä¿¡æ¯äº†ã€‚å¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥ç”¨wx4eyu82ä¸ºkeyï¼Œé¤åŽ…ä¿¡æ¯ä¸ºvalueåšç¼“å­˜ã€‚ é€šè¿‡ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬çŸ¥é“äº†GeoHashå°±æ˜¯ä¸€ç§å°†ç»çº¬åº¦è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿å¾—åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸²å‰ç¼€åŒ¹é…è¶Šå¤šçš„è·ç¦»è¶Šè¿‘. 4.GeoHashç®—æ³•çš„æ­¥éª¤ é¦–å…ˆæˆ‘ä»¬å°†ç»åº¦å’Œçº¬åº¦éƒ½å•ç‹¬è½¬æ¢ä¸ºä¸€ä¸ªäºŒè¿›åˆ¶ç¼–ç  å¾—åˆ°ç»åº¦å’Œçº¬åº¦çš„äºŒè¿›åˆ¶ç¼–ç åŽï¼Œæˆ‘ä»¬æŒ‰ç…§å¥‡æ•°ä½æ”¾çº¬åº¦ï¼Œå¶æ•°ä¸ºæ”¾ç»åº¦çš„è§„åˆ™ï¼ˆæˆ‘ä»¬è¿™é‡Œå¥‡æ•°å¶æ•°ä¸‹æ ‡æ˜¯ä»Ž0å¼€å§‹ï¼‰å°†å®ƒä»¬åˆæˆä¸€ä¸ªäºŒè¿›åˆ¶ç¼–ç  æœ€åŽæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªäºŒè¿›åˆ¶ç¼–ç è½¬æ¢ä¸ºbase32ç¼–ç  ä¸¾ä¾‹ åœ°çƒçº¬åº¦åŒºé—´æ˜¯[-90,90]ï¼Œ åŒ—æµ·å…¬å›­çš„çº¬åº¦æ˜¯39.928167ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢ç®—æ³•å¯¹çº¬åº¦39.928167è¿›è¡Œé€¼è¿‘ç¼–ç : åŒºé—´[-90,90]è¿›è¡ŒäºŒåˆ†ä¸º[-90,0),[0,90]ï¼Œç§°ä¸ºå·¦å³åŒºé—´ï¼Œå¯ä»¥ç¡®å®š39.928167å±žäºŽå³åŒºé—´[0,90]ï¼Œç»™æ ‡è®°ä¸º1ï¼› æŽ¥ç€å°†åŒºé—´[0,90]è¿›è¡ŒäºŒåˆ†ä¸º [0,45),[45,90]ï¼Œå¯ä»¥ç¡®å®š39.928167å±žäºŽå·¦åŒºé—´ [0,45)ï¼Œç»™æ ‡è®°ä¸º0ï¼› é€’å½’ä¸Šè¿°è¿‡ç¨‹39.928167æ€»æ˜¯å±žäºŽæŸä¸ªåŒºé—´[a,b]ã€‚éšç€æ¯æ¬¡è¿­ä»£åŒºé—´[a,b]æ€»åœ¨ç¼©å°ï¼Œå¹¶è¶Šæ¥è¶Šé€¼è¿‘39.928167ï¼› å¦‚æžœç»™å®šçš„çº¬åº¦xï¼ˆ39.928167ï¼‰å±žäºŽå·¦åŒºé—´ï¼Œåˆ™è®°å½•0ï¼Œå¦‚æžœå±žäºŽå³åŒºé—´åˆ™è®°å½•1ï¼Œè¿™æ ·éšç€ç®—æ³•çš„è¿›è¡Œä¼šäº§ç”Ÿä¸€ä¸ªåºåˆ—1011100ï¼Œåºåˆ—çš„é•¿åº¦è·Ÿç»™å®šçš„åŒºé—´åˆ’åˆ†æ¬¡æ•°æœ‰å…³ã€‚ é€šè¿‡ä¸Šè¿°è®¡ç®—ï¼Œçº¬åº¦äº§ç”Ÿçš„ç¼–ç ä¸º10111 00011ï¼Œç»åº¦äº§ç”Ÿçš„ç¼–ç ä¸º11010 01011ã€‚å¶æ•°ä½æ”¾ç»åº¦ï¼Œå¥‡æ•°ä½æ”¾çº¬åº¦ï¼ŒæŠŠ2ä¸²ç¼–ç ç»„åˆç”Ÿæˆæ–°ä¸²ï¼š11100 11101 00100 01111ã€‚ æœ€åŽä½¿ç”¨ç”¨0-9ã€b-zï¼ˆåŽ»æŽ‰a, i, l, oï¼‰è¿™32ä¸ªå­—æ¯è¿›è¡Œbase32ç¼–ç ï¼Œé¦–å…ˆå°†11100 11101 00100 01111è½¬æˆåè¿›åˆ¶ï¼Œå¯¹åº”ç€28ã€29ã€4ã€15ï¼Œåè¿›åˆ¶å¯¹åº”çš„ç¼–ç å°±æ˜¯wx4gã€‚ 5.ç¼ºé™·-geohashçš„è¾¹ç•Œé—®é¢˜ æ¯”å¦‚çº¢è‰²çš„ç‚¹æ˜¯æˆ‘ä»¬çš„ä½ç½®ï¼Œç»¿è‰²çš„ä¸¤ä¸ªç‚¹åˆ†åˆ«æ˜¯é™„è¿‘çš„ä¸¤ä¸ªé¤é¦†ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¼šå‘çŽ°è·ç¦»è¾ƒè¿œé¤é¦†çš„GeoHashç¼–ç ä¸Žæˆ‘ä»¬ä¸€æ ·ï¼ˆå› ä¸ºåœ¨åŒä¸€ä¸ªGeoHashåŒºåŸŸå—ä¸Šï¼‰ï¼Œè€Œè¾ƒè¿‘é¤é¦†çš„GeoHashç¼–ç ä¸Žæˆ‘ä»¬ä¸ä¸€è‡´ã€‚ ç›®å‰æ¯”è¾ƒé€šè¡Œçš„åšæ³•å°±æ˜¯æˆ‘ä»¬ä¸ä»…èŽ·å–å½“å‰æˆ‘ä»¬æ‰€åœ¨çš„çŸ©å½¢åŒºåŸŸï¼Œè¿˜èŽ·å–å‘¨å›´8ä¸ªçŸ©å½¢å—ä¸­çš„ç‚¹ã€‚é‚£ä¹ˆæ€Žæ ·å®šä½å‘¨å›´8ä¸ªç‚¹å‘¢ï¼Ÿå…³é”®å°±æ˜¯éœ€è¦èŽ·å–å‘¨å›´8ä¸ªç‚¹çš„ç»çº¬åº¦ï¼Œé‚£æˆ‘ä»¬å·²ç»çŸ¥é“è‡ªå·±çš„ç»çº¬åº¦ï¼Œåªéœ€è¦ç”¨è‡ªå·±çš„ç»çº¬åº¦å‡åŽ»æœ€å°åˆ’åˆ†å•ä½çš„ç»çº¬åº¦å°±è¡Œã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“ç»çº¬åº¦çš„èŒƒå›´,åˆçŸ¥é“éœ€è¦åˆ’åˆ†çš„æ¬¡æ•°ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å°±èƒ½è®¡ç®—å‡ºæœ€å°åˆ’åˆ†å•ä½çš„ç»çº¬åº¦ã€‚ 6.å‡ ç§å®žçŽ°geohashæ–¹æ¡ˆçš„å¯¹æ¯” 6.1æ”¯æŒäºŒç»´ç´¢å¼•çš„å­˜å‚¨æ•°æ®åº“ï¼šmongodb mongoDBæ”¯æŒäºŒç»´ç©ºé—´ç´¢å¼•,ä½¿ç”¨ç©ºé—´ç´¢å¼•,mongoDBæ”¯æŒä¸€ç§ç‰¹æ®ŠæŸ¥è¯¢,å¦‚æŸåœ°å›¾ç½‘ç«™ä¸Šå¯ä»¥æŸ¥æ‰¾ç¦»ä½ æœ€è¿‘çš„å’–å•¡åŽ…,é“¶è¡Œç­‰ä¿¡æ¯ã€‚è¿™ä¸ªä½¿ç”¨mongoDBçš„ç©ºé—´ç´¢å¼•ç»“åˆç‰¹æ®Šçš„æŸ¥è¯¢æ–¹æ³•å¾ˆå®¹æ˜“å®žçŽ°ã€‚ APIç›´æŽ¥æ”¯æŒï¼Œå¾ˆæ–¹ä¾¿ æ”¯æŒæŒ‰ç…§è·ç¦»æŽ’åºï¼Œå¹¶æ”¯æŒåˆ†é¡µã€‚æ”¯æŒå¤šæ¡ä»¶ç­›é€‰ã€‚ å¯æ»¡è¶³å®žæ—¶æ€§éœ€æ±‚ã€‚ èµ„æºå ç”¨å¤§ï¼Œæ•°æ®é‡è¾¾åˆ°ç™¾ä¸‡çº§è¯·æµé‡åœ¨10wå·¦å³æŸ¥è¯¢é€Ÿåº¦æ˜Žæ˜¾ä¸‹é™ã€‚ 6.2å‡çº§Mysqlè‡³5.7ï¼Œæ”¯æŒGeohash MySQL 5.7.5 å¢žåŠ äº†å¯¹GeoHashçš„æ”¯æŒï¼Œæä¾›äº†ä¸€ç³»åˆ—geohashçš„å‡½æ•°ï¼Œä½†æ˜¯å…¶å®žMysqlå¹¶æ²¡æœ‰æä¾›ç±»ä¼¼mogodbç±»åž‹nearè¿™æ ·çš„å‡½æ•°ï¼Œä»…ä»…æä¾›äº†ä¸€äº›ç»çº¬åº¦è½¬hashã€hashå–ç»çº¬åº¦çš„ä¸€äº›å‡½æ•°ã€‚ ä¼˜ç‚¹:å‡½æ•°ç›´æŽ¥è°ƒç”¨ï¼Œç”Ÿæˆç›®æ ‡hashã€æ ¹æ®hashèŽ·å–ç»çº¬åº¦ã€‚ ç¼ºç‚¹ï¼šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢å‡½æ•°ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†å‘¨è¾¹8ç‚¹çš„é—®é¢˜ï¼Œéœ€è¦è¡¥å……geoçš„ç®—æ³• 6.3Redis Commands: Geography Edition GEO ç‰¹æ€§åœ¨ Redis 3.2 ç‰ˆå‘å¸ƒï¼Œ è¿™ä¸ªåŠŸèƒ½å¯ä»¥å°†ç”¨æˆ·ç»™å®šçš„åœ°ç†ä½ç½®ä¿¡æ¯å‚¨å­˜èµ·æ¥ï¼Œ å¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œæ“ä½œï¼ŒGEOé€šè¿‡å¦‚ä¸‹å‘½ä»¤æ¥å®ŒæˆGEOéœ€æ±‚. å‘½ä»¤ æè¿° geoadd æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªç»çº¬åº¦åœ°ç†ä½ç½® georadius èŽ·å–æŒ‡å®šèŒƒå›´å†…çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å¢žåŠ å‚æ•°withdistanceç›´æŽ¥ç®—å‡ºè·ç¦»ï¼Œä¹Ÿå¯ä»¥å¢žåŠ å‚æ•°descending/ascending è¿›è¡Œè·ç¦»æŽ’åº georadiusbymember é€šè¿‡æŒ‡å®šçš„å¯¹è±¡ï¼ŒèŽ·å–å…¶å‘¨è¾¹å¯¹è±¡ geoencode è½¬æ¢ä¸ºgeohashï¼Œ52-bitï¼ŒåŒæ—¶è¿”å›žè¯¥åŒºåŸŸæœ€å°è§’çš„geohash,æœ€å¤§è§’çš„geohashï¼ŒåŠä¸­å¿ƒç‚¹ geodecode åŒä¸Šé€†æ“ä½œ ä¼˜ç‚¹:æ•ˆçŽ‡é«˜ï¼ŒAPIä¸°å¯Œ ç¼ºç‚¹ï¼š3.2ç‰ˆæœ¬æ˜¯å¦ç¨³å®šï¼Ÿ é¢è¯•çš„æ—¶å€™ï¼Œé—®åˆ°geohashç®—æ³•ä»¥åŠæŠ€æœ¯é€‰åž‹å¤§æ¦‚ä¹Ÿèƒ½è¯´ä¸€è¯´äº†â€¦ æœ¬æ–‡ç« å€Ÿé‰´å¾ˆå¤šä¼˜ç§€æ–‡ç« ï¼Œä¸ƒæ‹¼å…«å‡‘è€Œå‡ºã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¡¥ç çš„å‰ä¸–ä»Šç”Ÿ]]></title>
    <url>%2F2019%2F01%2F29%2Fjava-basic%2F%E8%A1%A5%E7%A0%81%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%2F</url>
    <content type="text"><![CDATA[è®¡ç®—æœºå¦‚ä½•æ¥ä¿å­˜è´Ÿæ•°å‘¢ï¼Ÿå…¶å®žåªè¦è¾¾åˆ°è¿™æ ·çš„ç›®çš„ï¼šæ­£æ•°è´Ÿæ•°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†å³å¯ï¼Œä½†æ˜¯ï¼Œæ­£å¦‚äººç±»ç”¨+1å’Œ-1æ¥è¡¨ç¤ºå¯ä»¥æé«˜æ•ˆçŽ‡ä¸€æ ·ï¼Œä¹Ÿå¾—æœ‰ä¸€ä¸ªæ¯”è¾ƒé€‚å½“çš„é€‚åˆæˆ‘ä»¬çš„è®¡ç®—æœºè¯†åˆ«çš„ä¸€ä¸ªæ–¹å¼ã€‚ä¸‹é¢æ¥è¯¦ç»†è®²è§£ã€‚ é—®é¢˜çš„ç”±æ¥ ä¸‹é¢ä¸ºäº†è¡¨ç¤ºæ–¹ä¾¿ï¼Œå…ˆå‡è®¾å­˜å‚¨ä¸€ä¸ªæ•´åž‹æ•°å­—ç”¨4ä¸ªbitã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œ+2åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶çš„0010ï¼Œé‚£ä¹ˆ-2æ€Žä¹ˆè¡¨ç¤ºå‘¢ï¼Ÿ å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¯ä»¥å°†ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆbitï¼‰ä¸“é—¨è§„å®šä¸ºç¬¦å·ä½ï¼Œå®ƒç­‰äºŽ0æ—¶å°±è¡¨ç¤ºæ­£æ•°ï¼Œç­‰äºŽ1æ—¶å°±è¡¨ç¤ºè´Ÿæ•°ã€‚æ¯”å¦‚ï¼Œåœ¨8ä½æœºä¸­ï¼Œè§„å®šæ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ä¸ºç¬¦å·ä½ã€‚é‚£ä¹ˆï¼Œ+2å°±æ˜¯0010ï¼Œè€Œ-8åˆ™æ˜¯1010ã€‚ æ›´å¤šçš„ä¾‹å­å¦‚ä¸‹ï¼š è¿™å°±æ˜¯ç›´æŽ¥ç”¨åŽŸç çš„æ–¹å¼æ¥å­˜å‚¨ï¼Œè™½ç„¶è¯´è¿™ç§æ–¹å¼ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œæ¯•ç«Ÿæ¯ä¸ªæ•°æˆ‘éƒ½å”¯ä¸€æ ‡è¯†äº†ã€‚ ä½†æ˜¯è¿™ç§æ–¹å¼å­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›+1å’Œ-1ç›¸åŠ ä¸º0ï¼Œä½†æ˜¯é€šè¿‡è¿™ä¸ªæ–¹å¼ç®—å‡ºæ¥çš„æ˜¯ï¼š0001+1001=1010 (-2)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‰ç…§æ­£å¸¸ä¸€æ­¥å¤´çš„æ–¹å¼å¾—ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æžœã€‚ ä¸ºäº†è§£å†³äº†â€œæ­£è´Ÿç›¸åŠ ç­‰äºŽ0â€çš„é—®é¢˜ï¼Œäººä»¬å‘æ˜Žäº†åç ã€‚ åç  â€œåç â€è¡¨ç¤ºæ–¹å¼æ˜¯ç”¨æ¥å¤„ç†è´Ÿæ•°çš„ï¼Œç¬¦å·ä½ç½®ä¸å˜ï¼Œå…¶ä½™ä½ç½®ç›¸åã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬å†æ¥ç®—ä¸€ä¸‹+1å’Œ-1ç›¸åŠ ï¼Œå˜æˆäº†0001+1110=1111ï¼Œåˆšå¥½åç è¡¨ç¤ºæ–¹å¼ä¸­ï¼Œ1111è±¡å¾-0ã€‚ æ­¤æ—¶ï¼Œå¥½åƒæ˜¯è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å‘çŽ°ï¼Œ0è¿™ä¸ªæ—¶å€™æœ‰äº†ä¸¤ç§è¡¨è¾¾ï¼š0000å’Œ1111ã€‚ å³åœ¨ç”¨åç è¡¨ç¤ºçš„æƒ…å†µä¸‹ï¼Œ0ç«Ÿç„¶å¯ä»¥ç”¨ä¸¤ä¸ªå€¼æ¥è¡¨ç¤ºï¼Œè¿™æ˜¾ç„¶ä¸å¥½å§ã€‚æ¯•ç«Ÿ+0å’Œ-0å°±æ˜¯åŒä¸€ä¸ªçŽ©æ„å•Šã€‚ è¿™ä¸ªæ—¶å€™è¡¥ç é—ªäº®ç™»åœºã€‚ è¡¥ç  å¾ˆç®€å•ï¼Œåœ¨åˆšæ‰åç çš„åŸºç¡€ä¸ŠåŠ 1ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬è¿™é‡Œå‡å®šæ•´å½¢åªæœ‰4ä½ã€‚é‚£ä¹ˆ-0è¡¨ç¤ºä¸º1111+1=10000ï¼Œæ˜¾ç„¶æº¢å‡ºäº†ï¼Œå°±éœ€è¦ä¸¢å¼ƒæœ€é«˜ä½ï¼Œå˜æˆ0000. æ­¤æ—¶ï¼Œç¥žå¥‡åœ°å‘çŽ°ï¼Œè¾¾åˆ°äº†ç»Ÿä¸€ï¼Œ+0å’Œ-0éƒ½æ˜¯ç”¨0000æ¥è¡¨ç¤ºäº†ã€‚ æ­¤æ—¶ï¼Œä¹Ÿæ»¡è¶³æ­£è´Ÿæ•°ç›¸åŠ ä¸º0çš„æ¡ä»¶ã€‚æ¯”å¦‚+2ä¸º0010ï¼Œ-2ä¸º1110.æ­¤æ—¶ä¸¤è€…ç›¸åŠ ä¸ºï¼š0010+1110=(0)0000ï¼Œä¸¢æŽ‰æœ€é«˜ä½å°±æ˜¯0000 é‚£ä¹ˆå¯¹äºŽæ™®é€šæƒ…å†µï¼Œæ¯”å¦‚7+(-4)å‘¢?å³0111+1100=0011ï¼Œå°±æ˜¯3ã€‚OKï¼Œå¤§åŠŸå‘Šæˆã€‚ è¡¥ç æ€Žä¹ˆæ±‚ ä¸Šé¢å·²ç»è¯´çš„å¾ˆè¯¦ç»†å•¦ï¼Œæ¯”å¦‚-4ï¼Œå°±æ˜¯åœ¨4(0100)çš„åŸºç¡€ä¸Šå–å(1011)å†åŠ ä¸€(1100). ä¸Šé¢ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆè¦ç”¨è¡¥ç ã€‚å³ä¿è¯äº†å¯¹ç§°çš„æ­£è´Ÿæ•°ç›¸åŠ ä¸º0å¹¶ä¸”0åªæœ‰ä¸€ç§è¡¨ç¤ºæ–¹å¼ã€‚ è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹å°±æ˜¯ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œ7-4å…¶å®žæˆ‘ä»¬éƒ½æ˜¯è½¬æ¢æˆ7+(-4)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è®¡ç®—æœºä¸­ï¼Œå‡æ³•éƒ½æ˜¯ç”¨åŠ æ³•çš„é€»è¾‘å®žçŽ°çš„ã€‚ å³ï¼šä¸€å¥—åŠ æ³•çš„ç”µè·¯å®žçŽ°åŠ å‡æ³•ã€‚æ­¤å¤–ï¼Œä¹˜æ³•å’Œé™¤æ³•å…¶å®žéƒ½æ˜¯åŠ æ³•è¿™å¥—ç”µè·¯å®žçŽ°çš„ã€‚ è¡¥ç çš„æœ¬è´¨ è¿™é‡Œå‡è®¾å­˜å‚¨ä¸€ä¸ªæ•´åž‹ç”¨8ä¸ªbitã€‚ è¦å°†æ­£æ•°è½¬æˆå¯¹åº”çš„è´Ÿæ•°ï¼Œå…¶å®žåªè¦ç”¨0å‡åŽ»è¿™ä¸ªæ•°å°±å¯ä»¥äº†ã€‚æ¯”å¦‚ï¼Œ-8å…¶å®žå°±æ˜¯0-8ã€‚ åˆ™8çš„äºŒè¿›åˆ¶æ˜¯00001000ï¼Œ-8å°±å¯ä»¥ç”¨ä¸‹é¢çš„å¼å­æ±‚å‡ºï¼š 123 ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ å› ä¸º00000000ï¼ˆè¢«å‡æ•°ï¼‰å°äºŽ0000100ï¼ˆå‡æ•°ï¼‰ï¼Œæ‰€ä»¥ä¸å¤Ÿå‡ã€‚è¯·å›žå¿†ä¸€ä¸‹å°å­¦ç®—æœ¯ï¼Œå¦‚æžœè¢«å‡æ•°çš„æŸä¸€ä½å°äºŽå‡æ•°ï¼Œæˆ‘ä»¬æ€Žä¹ˆåŠžï¼Ÿå¾ˆç®€å•ï¼Œé—®ä¸Šä¸€ä½å€Ÿ1å°±å¯ä»¥äº†ã€‚ æ‰€ä»¥ï¼Œ0000000ä¹Ÿé—®ä¸Šä¸€ä½å€Ÿäº†1ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¢«å‡æ•°å…¶å®žæ˜¯100000000ï¼Œç®—å¼ä¹Ÿå°±æ”¹å†™æˆï¼š 1234ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼ï¼ï¼ è¿›ä¸€æ­¥è§‚å¯Ÿï¼Œå¯ä»¥å‘çŽ°100000000 = 11111111 + 1ï¼Œæ‰€ä»¥ä¸Šé¢çš„å¼å­å¯ä»¥æ‹†æˆä¸¤ä¸ªï¼š 1234567 ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ï¼‘ï¼‘ï¼‘ï¼‘ï¼ï¼‘ï¼‘ï¼‘ï¼‹ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‘ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼ï¼ï¼ é€šè¿‡è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±ä»Žæ•°å­¦ä¸ŠçŸ¥é“äº†ä¸ºä»€ä¹ˆè¡¥ç æ˜¯å–ååŠ ä¸€äº†ã€‚ ä½ çœ‹ï¼Œæ±‚ä»»ä½•ä¸€ä¸ªè´Ÿæ•°ï¼Œéƒ½æ˜¯0-æ­£æ•°ï¼Œé‚£ä¹ˆå°±ç”¨å€Ÿä½çš„æ€æƒ³æ¥ï¼Œåˆ™å˜æˆ100000000ã€‚ 100000000åˆ™å¯ä»¥åˆ†è§£ä¸º11111111+00000001ã€‚ æ­¤æ—¶æ±‚è´Ÿæ•°çš„è¿‡ç¨‹å°±å°±å˜æˆ11111111-X+1 è€Œå…ˆç”¨11111111æ¥å‡è¿™ä¸ªæ­£æ•°ï¼Œè¿™ä¸ªç»“æžœå°±æ˜¯å¯¹æ­£æ•°å–åã€‚ æ­¤æ—¶å†åŠ ä¸Šå¦å¤–ä¸€ä¸ª1. è¿™ä¸Žæˆ‘ä»¬æ±‚è¡¥ç çš„è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆè¦è¿™æ ·æ±‚è¡¥ç ã€‚ è¯æ˜Ž(å¯ä¸çœ‹) å°†ä¸Šé¢çš„ç‰¹ä¾‹æŠ½è±¡ä¸€ä¸‹ï¼Œç”¨ç»Ÿä¸€è¡¨è¾¾å¼æ¥è¯æ˜Žä¸€ä¸‹ã€‚ æˆ‘ä»¬è¦è¯æ˜Žçš„æ˜¯ï¼ŒX-Yæˆ–X+(-Y)å¯ä»¥ç”¨XåŠ ä¸ŠYçš„è¡¥ç å®Œæˆã€‚ Yçš„è¡¥ç ç­‰äºŽ(11111111-Y)+1ã€‚æ‰€ä»¥ï¼ŒXåŠ ä¸ŠYè¡¥ç ï¼Œå°±ç­‰äºŽï¼š 1X + (11111111-Y) + 1 æˆ‘ä»¬å‡å®šè¿™ä¸ªç®—å¼çš„ç»“æžœç­‰äºŽZï¼Œå³ 1Z = X + (11111111-Y) + 1 æŽ¥ä¸‹æ¥ï¼Œåˆ†æˆä¸¤ç§æƒ…å†µè®¨è®ºã€‚ ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚æžœXå°äºŽYï¼Œé‚£ä¹ˆZæ˜¯ä¸€ä¸ªè´Ÿæ•°ã€‚ ç”±Yçš„è¡¥ç ç­‰äºŽ(11111111-Y)+1ï¼Œæ ‡è®°ä¸ºF=(11111111-Y)+1,é‚£ä¹ˆå¦‚ä½•æ ¹æ®Fé€†å‘æ±‚Yå‘¢ï¼Ÿ 1Y=1111111-(F-1) OK,å› ä¸ºæ­¤æ—¶Zæ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œé‚£ä¹ˆZè¿›è¡Œè¡¥ç çš„é€†è¿ç®—å°±å¯ä»¥æ±‚å‡ºå®ƒçš„ç»å¯¹å€¼ï¼Œå³æ­£æ•°ã€‚å†åŠ ä¸€ä¸ªç¬¦å·ï¼Œä¸¤è€…ç›¸ç­‰ã€‚ 1Z = -[11111111-(Z-1)] = -[11111111-(X + (11111111-Y) + 1-1)] = X - Y ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æžœXå¤§äºŽY è¿™æ„å‘³ç€Zè‚¯å®šå¤§äºŽ11111111ï¼Œä½†æ˜¯æˆ‘ä»¬è§„å®šäº†è¿™æ˜¯8ä½æœºï¼Œæœ€é«˜çš„ç¬¬9ä½æ˜¯æº¢å‡ºä½ï¼Œå¿…é¡»è¢«èˆåŽ»ï¼Œè¿™ç›¸å½“äºŽå‡åŽ»100000000ã€‚æ‰€ä»¥ï¼Œ 1Z = Z - 100000000 = X + (11111111-Y) + 1 - 100000000 = X - Y è¿™å°±è¯æ˜Žäº†ï¼Œåœ¨æ­£å¸¸çš„åŠ æ³•è§„åˆ™ä¸‹ï¼Œå¯ä»¥åˆ©ç”¨2çš„è¡¥ç å¾—åˆ°æ­£æ•°ä¸Žè´Ÿæ•°ç›¸åŠ çš„æ­£ç¡®ç»“æžœã€‚æ¢è¨€ä¹‹ï¼Œè®¡ç®—æœºåªè¦éƒ¨ç½²åŠ æ³•ç”µè·¯å’Œè¡¥ç ç”µè·¯ï¼Œå°±å¯ä»¥å®Œæˆæ‰€æœ‰æ•´æ•°çš„åŠ æ³•ã€‚ æœ¬æ–‡æ•´ç†è‡ªï¼š å…³äºŽ2çš„è¡¥ç  çŸ¥ä¹Žç¬¬ä¸€æ¡è¯„è®º]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SpringBootä½¿ç”¨logbackå®žçŽ°æ—¥å¿—æŒ‰å¤©æ»šåŠ¨]]></title>
    <url>%2F2019%2F01%2F28%2Fmiscellany%2F11SpringBoot%E4%BD%BF%E7%94%A8logback%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E6%8C%89%E5%A4%A9%E6%BB%9A%E5%8A%A8%2F</url>
    <content type="text"><![CDATA[æ—¥å¿—æ˜¯ä»»ä½•ä¸€ä¸ªç³»ç»Ÿéƒ½å¿…å¤‡çš„ä¸œè¥¿ï¼Œæ—¥å¿—çš„é‡è¦ç¨‹åº¦ä¸æ¯«ä¸äºšäºŽä»£ç ã€‚è€Œspringbootä¸­ç»å¸¸ä½¿ç”¨çš„æ˜¯logbackï¼Œé‚£ä¹ˆä»Šå¤©æˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸€ä¸‹åœ¨springbootä¸‹å¦‚ä½•é…ç½®logbackæ—¥å¿—ã€‚ç†è§£äº†è¿™é‡Œçš„é…ç½®ï¼Œå¯¹äºŽä»»ä½•çš„æ—¥å¿—éƒ½æ˜¯ä¸€æ ·çš„ã€‚ éœ€æ±‚ æ—¥å¿—æŒ‰å¤©æ»šåŠ¨åˆ†å‰² infoå’Œerroræ—¥å¿—è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ ä¸ºä»€ä¹ˆä½¿ç”¨Logback Logbackæ˜¯Log4jçš„å‡çº§ç‰ˆï¼Œä½œè€…ä¸ºåŒä¸€ä¸ªäººï¼Œä½œè€…ä¸æƒ³å†åŽ»æ”¹Log4jï¼Œæ‰€ä»¥å†™äº†Logback ä½¿ç”¨æ—¥å¿—æ¡†æž¶çš„æœ€ä½³å®žè·µæ˜¯é€‰æ‹©ä¸€æ¬¾æ—¥å¿—é—¨é¢+ä¸€æ¬¾æ—¥å¿—å®žçŽ°ï¼Œè¿™é‡Œé€‰æ‹©Slf4j+Logback,Slf4jä½œè€…ä¹Ÿæ˜¯Logbackçš„ä½œè€… SpringBootä»Ž1.4ç‰ˆæœ¬å¼€å§‹ï¼Œå†…ç½®çš„æ—¥å¿—æ¡†æž¶å°±æ˜¯Logback Logbackåœ¨SpringBootä¸­é…ç½®æ–¹å¼ä¸€ å¯ä»¥ç›´æŽ¥åœ¨applicatin.propertiesæˆ–è€…application.ymlä¸­é…ç½® ä»¥åœ¨application.ymlä¸­é…ç½®ä¸ºä¾‹ 123456logging: pattern: console: "%d - %msg%n" file: /var/log/tomcat/sell.log level: com.imooc.LoggerTest: debug å¯ä»¥å‘çŽ°ï¼Œè¿™ç§é…ç½®æ–¹å¼ç®€å•ï¼Œä½†èƒ½å®žçŽ°çš„åŠŸèƒ½ä¹Ÿå¾ˆå±€é™ï¼Œåªèƒ½ å®šåˆ¶è¾“å‡ºæ ¼å¼ è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„ æŒ‡å®šæŸä¸ªåŒ…ä¸‹çš„æ—¥å¿—çº§åˆ« å¦‚æžœéœ€è¦å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™å°±å¾—ç”¨ç¬¬äºŒç§é…ç½®äº† Logbackåœ¨SpringBootä¸­é…ç½®æ–¹å¼äºŒ åœ¨resourceç›®å½•ä¸‹æ–°å»ºlogback-spring.xml, å†…å®¹å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;configuration&gt; &lt;!--æ‰“å°åˆ°æŽ§åˆ¶å°çš„æ ¼å¼--&gt; &lt;appender name="consoleLog" class="ch.qos.logback.core.ConsoleAppender"&gt; &lt;layout class="ch.qos.logback.classic.PatternLayout"&gt; &lt;pattern&gt; %d - %msg%n &lt;/pattern&gt; &lt;/layout&gt; &lt;/appender&gt; &lt;!--é™¤äº†errorçº§åˆ«çš„æ—¥å¿—æ–‡ä»¶ä¿å­˜æ ¼å¼ä»¥åŠæ»šåŠ¨ç­–ç•¥--&gt; &lt;appender name="fileInfoLog" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;!--è¿‡æ»¤å™¨ï¼Œå°†errorçº§åˆ«è¿‡æ»¤æŽ‰--&gt; &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;DENY&lt;/onMatch&gt; &lt;onMismatch&gt;ACCEPT&lt;/onMismatch&gt; &lt;/filter&gt; &lt;encoder&gt; &lt;pattern&gt; %msg%n &lt;/pattern&gt; &lt;/encoder&gt; &lt;!--æ»šåŠ¨ç­–ç•¥--&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;!--è·¯å¾„--&gt; &lt;fileNamePattern&gt;/var/log/tomcat/sell/info.%d.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;!--errorçº§åˆ«æ—¥å¿—æ–‡ä»¶ä¿å­˜æ ¼å¼ä»¥åŠæ»šåŠ¨ç­–ç•¥--&gt; &lt;appender name="fileErrorLog" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt; &lt;!--åªè®©errorçº§åˆ«çš„æ—¥å¿—è¿›æ¥--&gt; &lt;filter class="ch.qos.logback.classic.filter.ThresholdFilter"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;/filter&gt; &lt;encoder&gt; &lt;pattern&gt; %msg%n &lt;/pattern&gt; &lt;/encoder&gt; &lt;!--æ»šåŠ¨ç­–ç•¥--&gt; &lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt; &lt;!--è·¯å¾„--&gt; &lt;fileNamePattern&gt;/var/log/tomcat/sell/error.%d.log&lt;/fileNamePattern&gt; &lt;/rollingPolicy&gt; &lt;/appender&gt; &lt;root level="info"&gt; &lt;appender-ref ref="consoleLog" /&gt; &lt;appender-ref ref="fileInfoLog" /&gt; &lt;appender-ref ref="fileErrorLog" /&gt; &lt;/root&gt;&lt;/configuration&gt; æ¯ä¸€ä¸ªappenderä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ—¥å¿—å¤„ç†ç­–ç•¥ã€‚ ç¬¬ä¸€ä¸ªappenderçš„name=&quot;consoleLog&quot;, åå­—æ˜¯è‡ªå·±éšæ„å–çš„ï¼Œå–è¿™ä¸ªåå­—ï¼Œè¡¨ç¤ºè¿™ä¸ªç­–ç•¥ç”¨äºŽæŽ§åˆ¶å°çš„æ—¥å¿—ã€‚ æˆ‘ä»¬é‡ç‚¹çœ‹ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªappender,å› ä¸ºè¦æŠŠinfoå’Œerroræ—¥å¿—è¾“å…¥åˆ°ä¸åŒæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†åˆ«å»ºäº†ä¸¤ä¸ªappenderã€‚ rollingPolicyæ˜¯æ»šåŠ¨ç­–ç•¥ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®æŒ‰æ—¶é—´æ»šåŠ¨ filteræ˜¯æ—¥å¿—çš„è¿‡æ»¤æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨fileInfoLogé‡Œåšäº†å¦‚ä¸‹è¿‡æ»¤ 123&lt;level&gt;ERROR&lt;/level&gt;&lt;onMatch&gt;DENY&lt;/onMatch&gt;&lt;onMismatch&gt;ACCEPT&lt;/onMismatch&gt; ä¸Šè¿°ä»£ç ç¿»è¯‘ä¹‹åŽï¼šæ‹¦æˆªERRORçº§åˆ«çš„æ—¥å¿—ã€‚å¦‚æžœåŒ¹é…åˆ°äº†ï¼Œåˆ™ç¦ç”¨å¤„ç†ã€‚å¦‚æžœä¸åŒ¹é…ï¼Œåˆ™æŽ¥å—ï¼Œå¼€å§‹å¤„ç†æ—¥å¿—ã€‚ é‚£æœ‰çš„åŒå­¦è¦é—®äº†ï¼Œä¸èƒ½è¿™æ ·å†™å— 1&lt;level&gt;INFO&lt;/level&gt; è¿™æ ·ä¸æ˜¯åªæ‹¦æˆªINFOæ—¥å¿—äº†å—ï¼Ÿ ä¸å¯¹ï¼ è¿™å°±å¾—è¯´ä¸€ä¸‹æ—¥å¿—çº§åˆ«äº† DEBUG -&gt;INFO -&gt; WARN -&gt;ERROR å¦‚æžœä½ è®¾ç½®çš„æ—¥å¿—çº§åˆ«æ˜¯INFOï¼Œé‚£ä¹ˆæ˜¯ä¼šæ‹¦æˆªERRORæ—¥å¿—çš„å“¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœç›´æŽ¥å†™infoï¼Œé‚£ä¹ˆå¤§äºŽç­‰äºŽinfoçº§åˆ«çš„æ—¥å¿—éƒ½ä¼šå†™è¿›åŽ»ï¼Œè¿èƒŒäº†æˆ‘ä»¬çš„éœ€æ±‚ã€‚ æ•´ç†è‡ªï¼š http://www.imooc.com/article/19005]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlé¢è¯•é«˜é¢‘ç†è®ºçŸ¥è¯†]]></title>
    <url>%2F2019%2F01%2F27%2Fmysql%2Fmysql%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86%2F</url>
    <content type="text"><![CDATA[æ•´ç†ä¸€äº›é¢è¯•é¢˜ï¼Œç®€å•çœ‹çœ‹ã€‚ ç›®å½• æ•°æ®åº“ä¸‰èŒƒå¼ äº‹åŠ¡ mysqlæ•°æ®åº“é»˜è®¤æœ€å¤§è¿žæŽ¥æ•° åˆ†é¡µ è§¦å‘å™¨ å­˜å‚¨è¿‡ç¨‹ ç”¨jdbcæ€Žä¹ˆè°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼Ÿ å¯¹jdbcçš„ç†è§£ å†™ä¸€ä¸ªç®€å•çš„jdbcçš„ç¨‹åºã€‚å†™ä¸€ä¸ªè®¿é—®oracleæ•°æ®çš„jdbcç¨‹åº JDBCä¸­çš„PreparedStatementç›¸æ¯”Statementçš„å¥½å¤„ æ•°æ®åº“è¿žæŽ¥æ± ä½œç”¨ é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“Ž æ•°æ®åº“ä¼˜åŒ–-ç´¢å¼• æ•°æ®åº“ä¼˜åŒ–-åˆ†è¡¨ æ•°æ®åº“ä¼˜åŒ–-è¯»å†™åˆ†ç¦» æ•°æ®åº“ä¼˜åŒ–-ç¼“å­˜ æ•°æ®åº“ä¼˜åŒ–-sqlè¯­å¥ä¼˜åŒ–çš„æŠ€å·§ jdbcæ‰¹é‡æ’å…¥å‡ ç™¾ä¸‡æ•°æ®æ€Žä¹ˆå®žçŽ° èšç°‡ç´¢å¼•å’Œéžèšç°‡ç´¢å¼• sqlæ³¨å…¥é—®é¢˜ mysqlæ‚²è§‚é”å’Œä¹è§‚é” 1. æ•°æ®åº“ä¸‰èŒƒå¼ 1.1 èŒƒå¼æ˜¯ä»€ä¹ˆ èŒƒå¼å°±æ˜¯è§„èŒƒï¼Œè¦æ»¡è¶³ç¬¬äºŒèŒƒå¼å¿…é¡»å…ˆæ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œè¦æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œå¿…é¡»è¦å…ˆæ»¡è¶³ç¬¬äºŒèŒƒå¼ã€‚ 1NF(ç¬¬ä¸€èŒƒå¼)ï¼šåˆ—æ•°æ®ä¸å¯åˆ†å‰²ï¼Œå³ä¸€åˆ—ä¸èƒ½æœ‰å¤šä¸ªå€¼ 2NF(ç¬¬äºŒèŒƒå¼)ï¼šä¸»é”®(æ¯ä¸€è¡Œéƒ½æœ‰å”¯ä¸€æ ‡è¯†) 3NF(ç¬¬ä¸‰èŒƒå¼)ï¼šå¤–é”®(è¡¨ä¸­ä¸åŒ…å«å·²åœ¨å…¶ä»–è¡¨ä¸­åŒ…å«çš„éžä¸»å…³é”®ä¿¡æ¯) 1.2 åä¸‰èŒƒå¼ åä¸‰èŒƒå¼ï¼šæœ‰æ—¶ä¸ºäº†æ•ˆçŽ‡ï¼Œå¯ä»¥è®¾ç½®é‡å¤æˆ–è€…æŽ¨å¯¼å‡ºçš„å­—æ®µï¼Œä¾‹å¦‚ï¼šè®¢å•æ€»ä»·æ ¼è®¢å•é¡¹çš„å•ä»·ï¼Œè¿™ä¸ªè®¢å•æ€»ä»·è™½ç„¶å¯ä»¥ç”±è®¢å•é¡¹è®¡ç®—å‡ºæ¥ï¼Œä½†æ˜¯å½“è®¢å•æ•°ç›®åºžå¤§æ—¶ï¼Œæ•ˆçŽ‡æ¯”è¾ƒä½Žï¼Œæ‰€ä»¥è®¢å•çš„æ€»ä»·è¿™ä¸ªå­—æ®µæ˜¯å¿…è¦çš„ã€‚ 2. äº‹åŠ¡ 2.1 å«ä¹‰ äº‹åŠ¡æ—¶å¹¶å‘æŽ§åˆ¶çš„å•ä½ï¼Œæ˜¯ç”¨æˆ·å®šä¹‰çš„ä¸€ä¸ªæ“ä½œåºåˆ—ï¼Œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åšï¼Œæ˜¯ä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚ 2.2 äº‹åŠ¡çš„å››ä¸ªç‰¹å¾(ACIDç‰¹æ€§) åŽŸå­æ€§ï¼šè¡¨ç¤ºäº‹åŠ¡å†…æ“ä½œä¸å¯åˆ†å‰² ä¸€è‡´æ€§ï¼šè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ï¼Œè‹¥åŽé¢å¤±è´¥ï¼Œå‰é¢åˆ™å›žæ»š éš”ç¦»æ€§ï¼šä¸€ä¸ªäº‹åŠ¡å¼€å§‹äº†ï¼Œä¸è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰° æŒä¹…æ€§ï¼šäº‹åŠ¡å¼€å§‹äº†ï¼Œå°±ä¸èƒ½çªç„¶ç»ˆæ­¢ 3. mysqlæ•°æ®åº“é»˜è®¤æœ€å¤§è¿žæŽ¥æ•° 3.1 ä¸ºä»€ä¹ˆéœ€è¦æœ€å¤§è¿žæŽ¥æ•° ç‰¹å®šæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“åªèƒ½æ”¯æŒä¸€å®šæ•°ç›®åŒæ—¶è¿žæŽ¥ï¼Œè¿™æ—¶éœ€è¦æˆ‘ä»¬è®¾ç½®æœ€å¤§è¿žæŽ¥æ•°ï¼ˆæœ€å¤šåŒæ—¶æœåŠ¡å¤šå°‘è¿žæŽ¥ï¼‰ã€‚åœ¨æ•°æ®åº“å®‰è£…æ—¶ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„æœ€å¤§è¿žæŽ¥æ•°ã€‚ my.iniä¸­max_connections=100 4. åˆ†é¡µ 4.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ†é¡µï¼Ÿ åœ¨å¾ˆå¤šæ•°æ®æ—¶ï¼Œä¸å¯èƒ½å®Œå…¨æ˜¾ç¤ºæ•°æ®ã€‚è¿›è¡Œåˆ†æ®µæ˜¾ç¤º. 4.2 mysqlå¦‚ä½•åˆ†é¡µ 12String sql = "select * from students order by id limit " + pageSize*(pageNumber-1) + "," + pageSize; 4.3 oracleåˆ†é¡µ æ˜¯ä½¿ç”¨äº†ä¸‰å±‚åµŒå¥—æŸ¥è¯¢ã€‚ 1234String sql = &quot;select * from &quot; + (select *,rownum rid from (select * from students order by postime desc) where rid&lt;=&quot; + pagesize*pagenumber + &quot;) as t&quot; + &quot;where t&gt;&quot; + pageSize*(pageNumber-1); 5. è§¦å‘å™¨ ç•¥ã€‚ 6. å­˜å‚¨è¿‡ç¨‹ 6.1 æ•°æ®åº“å­˜å‚¨è¿‡ç¨‹å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š 1ã€å­˜å‚¨è¿‡ç¨‹åªåœ¨åˆ›å»ºæ—¶è¿›è¡Œç¼–è¯‘ï¼Œä»¥åŽæ¯æ¬¡æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹éƒ½ä¸éœ€å†é‡æ–°ç¼–è¯‘ï¼Œè€Œä¸€èˆ¬ SQL è¯­å¥æ¯æ‰§è¡Œä¸€æ¬¡å°±ç¼–è¯‘ä¸€æ¬¡ï¼Œå› æ­¤ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹å¯ä»¥å¤§å¤§æé«˜æ•°æ®åº“æ‰§è¡Œé€Ÿåº¦ã€‚ 2ã€é€šå¸¸ï¼Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘éœ€è¦å¤šæ¡ SQL è¯­å¥ã€‚è¿™äº›è¯­å¥è¦åˆ†åˆ«åœ°ä»Žå®¢æˆ·æœºå‘é€åˆ°æœåŠ¡å™¨ï¼Œå½“å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ“ä½œå¾ˆå¤šæ—¶ï¼Œå°†äº§ç”Ÿå¤§é‡çš„ç½‘ç»œä¼ è¾“ã€‚å¦‚æžœå°†è¿™äº›æ“ä½œæ”¾åœ¨ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ä¸­ï¼Œé‚£ä¹ˆå®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œä¼ è¾“å°±ä¼šå¤§å¤§å‡å°‘ï¼Œé™ä½Žäº†ç½‘ç»œè´Ÿè½½ã€‚ 3ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»ºä¸€æ¬¡ä¾¿å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œä»Žè€Œå¯ä»¥å‡å°‘æ•°æ®åº“å¼€å‘äººå‘˜çš„å·¥ä½œé‡ã€‚ 4ã€å®‰å…¨æ€§é«˜ï¼Œå­˜å‚¨è¿‡ç¨‹å¯ä»¥å±è”½å¯¹åº•å±‚æ•°æ®åº“å¯¹è±¡çš„ç›´æŽ¥è®¿é—®ï¼Œä½¿ç”¨ EXECUTE æƒé™è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œæ— éœ€æ‹¥æœ‰è®¿é—®åº•å±‚æ•°æ®åº“å¯¹è±¡çš„æ˜¾å¼æƒé™ã€‚ 6.2 å®šä¹‰å­˜å‚¨è¿‡ç¨‹: 12345678create procedure insert_Student (_name varchar(50),_age int ,out _id int)begin insert into student value(null,_name,_age); select max(stuId) into _id from student;end;call insert_Student('wfz',23,@id);select @id; 7. ç”¨jdbcæ€Žä¹ˆè°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼Ÿ è´¾çæ¬²æ‰§äº‹ åŠ è½½é©±åŠ¨ èŽ·å–è¿žæŽ¥ è®¾ç½®å‚æ•° æ‰§è¡Œ é‡Šæ”¾è¿žæŽ¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import java.sql.CallableStatement;import java.sql.Connection;import java.sql.DriverManager;import java.sql.SQLException;import java.sql.Types;public class JdbcTest &#123; /** * @param args */ public static void main(String[] args) &#123; // TODO Auto-generated method stub Connection cn = null; CallableStatement cstmt = null; try &#123; //è¿™é‡Œæœ€å¥½ä¸è¦è¿™ä¹ˆå¹²ï¼Œå› ä¸ºé©±åŠ¨åå†™æ­»åœ¨ç¨‹åºä¸­äº† Class.forName("com.mysql.jdbc.Driver"); //å®žé™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œåº”ç”¨DataSourceæ•°æ®ï¼Œå¦‚æžœç”¨æ¡†æž¶ï¼Œ //è¿™ä¸ªæ•°æ®æºä¸éœ€è¦æˆ‘ä»¬ç¼–ç åˆ›å»ºï¼Œæˆ‘ä»¬åªéœ€Datasource ds = context.lookup() //cn = ds.getConnection(); cn = DriverManager.getConnection("jdbc:mysql:///test","root","root"); cstmt = cn.prepareCall("&#123;call insert_Student(?,?,?)&#125;"); cstmt.registerOutParameter(3,Types.INTEGER); cstmt.setString(1, "wangwu"); cstmt.setInt(2, 25); cstmt.execute(); //getç¬¬å‡ ä¸ªï¼Œä¸åŒçš„æ•°æ®åº“ä¸ä¸€æ ·ï¼Œå»ºè®®ä¸å†™ System.out.println(cstmt.getString(3)); &#125; catch (Exception e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; finally &#123; /*try&#123;cstmt.close();&#125;catch(Exception e)&#123;&#125; try&#123;cn.close();&#125;catch(Exception e)&#123;&#125;*/ try &#123; if(cstmt != null) cstmt.close(); if(cn != null) cn.close(); &#125; catch (SQLException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; &#125; 8. å¯¹jdbcçš„ç†è§£ Java database connection javaæ•°æ®åº“è¿žæŽ¥.æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(mysql oracleç­‰)æ˜¯å¾ˆå¤šï¼Œæ¯ä¸ªæ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ”¯æŒçš„å‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„ã€‚ Javaåªå®šä¹‰æŽ¥å£ï¼Œè®©æ•°æ®åº“åŽ‚å•†è‡ªå·±å®žçŽ°æŽ¥å£ï¼Œå¯¹äºŽæˆ‘ä»¬è€…è€Œè¨€ã€‚åªéœ€è¦å¯¼å…¥å¯¹åº”åŽ‚å•†å¼€å‘çš„å®žçŽ°å³å¯ã€‚ç„¶åŽä»¥æŽ¥å£æ–¹å¼è¿›è¡Œè°ƒç”¨.(mysql + mysqlé©±åŠ¨ï¼ˆå®žçŽ°ï¼‰+jdbc) 9. å†™ä¸€ä¸ªç®€å•çš„jdbcçš„ç¨‹åºã€‚å†™ä¸€ä¸ªè®¿é—®oracleæ•°æ®çš„jdbcç¨‹åº è´¾çæ¬²æ‰§äº‹ åŠ è½½é©±åŠ¨(com.mysql.jdbc.Driver,oracle.jdbc.driver.OracleDriver) å–è¿žæŽ¥(DriverManager.getConnection(url,usernam,passord)) è®¾ç½®å‚æ•° Statement PreparedStatement cstmt.setXXX(index, value); æ‰§è¡Œ executeQuery executeUpdate é‡Šæ”¾è¿žæŽ¥(æ˜¯å¦è¿žæŽ¥è¦ä»Žå°åˆ°å¤§ï¼Œå¿…é¡»æ”¾åˆ°finnaly) 10. JDBCä¸­çš„PreparedStatementç›¸æ¯”Statementçš„å¥½å¤„ å¤§å¤šæ•°æˆ‘ä»¬éƒ½ä½¿ç”¨PreparedStatementä»£æ›¿Statement 1ï¼šPreparedStatementæ˜¯é¢„ç¼–è¯‘çš„ï¼Œæ¯”Statementé€Ÿåº¦å¿« 2ï¼šä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ è™½ç„¶ç”¨PreparedStatementæ¥ä»£æ›¿Statementä¼šä½¿ä»£ç å¤šå‡ºå‡ è¡Œ,ä½†è¿™æ ·çš„ä»£ç æ— è®ºä»Žå¯è¯»æ€§è¿˜æ˜¯å¯ç»´æŠ¤æ€§ä¸Šæ¥è¯´.éƒ½æ¯”ç›´æŽ¥ç”¨Statementçš„ä»£ç é«˜å¾ˆå¤šæ¡£æ¬¡ï¼š 123456789stmt.executeUpdate("insert into tb_name (col1,col2,col2,col4) values('"+var1+"','"+var2+"',"+var3+",'"+var4+"')"); perstmt = con.prepareStatement("insert into tb_name (col1,col2,col2,col4) values (?,?,?,?)");perstmt.setString(1,var1);perstmt.setString(2,var2);perstmt.setString(3,var3);perstmt.setString(4,var4);perstmt.executeUpdate(); 3ï¼šå®‰å…¨æ€§ PreparedStatementå¯ä»¥é˜²æ­¢SQLæ³¨å…¥æ”»å‡»ï¼Œè€ŒStatementå´ä¸èƒ½ã€‚ æ¯”å¦‚è¯´ï¼š String sql = â€œselect * from tb_name where name= 'â€+varname+&quot;â€™ and passwd=â€™&quot;+varpasswd+&quot;â€™&quot;; å¦‚æžœæˆ‘ä»¬æŠŠ[' or '1' = '1]ä½œä¸ºvarpasswdä¼ å…¥è¿›æ¥.ç”¨æˆ·åéšæ„,çœ‹çœ‹ä¼šæˆä¸ºä»€ä¹ˆ? select * from tb_name = â€˜éšæ„â€™ and passwd = â€˜â€™ or â€˜1â€™ = â€˜1â€™; å› ä¸º'1'='1'è‚¯å®šæˆç«‹ï¼Œæ‰€ä»¥å¯ä»¥ä»»ä½•é€šè¿‡éªŒè¯ã€‚ æ›´æœ‰ç”šè€…ï¼šæŠŠ[';drop table tb_name;]ä½œä¸ºvarpasswdä¼ å…¥è¿›æ¥,åˆ™ï¼š select * from tb_name = â€˜éšæ„â€™ and passwd = â€˜â€™;drop table tb_name; æœ‰äº›æ•°æ®åº“æ˜¯ä¸ä¼šè®©ä½ æˆåŠŸçš„ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šæ•°æ®åº“å°±å¯ä»¥ä½¿è¿™äº›è¯­å¥å¾—åˆ°æ‰§è¡Œã€‚ è€Œå¦‚æžœä½ ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ä½ ä¼ å…¥çš„ä»»ä½•å†…å®¹å°±ä¸ä¼šå’ŒåŽŸæ¥çš„è¯­å¥å‘ç”Ÿä»»ä½•åŒ¹é…çš„å…³ç³»ï¼Œåªè¦å…¨ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ä½ å°±ç”¨ä¸ç€å¯¹ä¼ å…¥çš„æ•°æ®åšä»»ä½•è¿‡è™‘ã€‚è€Œå¦‚æžœä½¿ç”¨æ™®é€šçš„statement,æœ‰å¯èƒ½è¦å¯¹dropç­‰åšè´¹å°½å¿ƒæœºçš„åˆ¤æ–­å’Œè¿‡è™‘ã€‚ 11. æ•°æ®åº“è¿žæŽ¥æ± ä½œç”¨ 1ã€é™å®šæ•°æ®åº“çš„ä¸ªæ•°ï¼Œä¸ä¼šå¯¼è‡´ç”±äºŽæ•°æ®åº“è¿žæŽ¥è¿‡å¤šå¯¼è‡´ç³»ç»Ÿè¿è¡Œç¼“æ…¢æˆ–å´©æºƒ 2ã€æ•°æ®åº“è¿žæŽ¥ä¸éœ€è¦æ¯æ¬¡éƒ½åŽ»åˆ›å»ºæˆ–é”€æ¯ï¼ŒèŠ‚çº¦äº†èµ„æº 3ã€æ•°æ®åº“è¿žæŽ¥ä¸éœ€è¦æ¯æ¬¡éƒ½åŽ»åˆ›å»ºï¼Œå“åº”æ—¶é—´æ›´å¿«ã€‚ 12. é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“Ž åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„å­˜å‚¨å¼•æ“Ž myisam / innodb/ memory MyISAMå­˜å‚¨å¼•æ“Ž å¦‚æžœè¡¨å¯¹äº‹åŠ¡è¦æ±‚ä¸é«˜ï¼ŒåŒæ—¶æ˜¯ä»¥æŸ¥è¯¢å’Œæ·»åŠ ä¸ºä¸»çš„ï¼Œæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨myisamå­˜å‚¨å¼•æ“Ž. æ¯”å¦‚ bbs ä¸­çš„ å‘å¸–è¡¨ï¼Œå›žå¤è¡¨. INNODBå­˜å‚¨å¼•æ“Ž: å¯¹äº‹åŠ¡è¦æ±‚é«˜ï¼Œä¿å­˜çš„æ•°æ®éƒ½æ˜¯é‡è¦æ•°æ®ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨INNODB,æ¯”å¦‚è®¢å•è¡¨ï¼Œè´¦å·è¡¨. Memory å­˜å‚¨ æˆ‘ä»¬æ•°æ®å˜åŒ–é¢‘ç¹ï¼Œä¸éœ€è¦å…¥åº“ï¼ŒåŒæ—¶åˆé¢‘ç¹çš„æŸ¥è¯¢å’Œä¿®æ”¹ï¼Œæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨memory, é€Ÿåº¦æžå¿«. MyISAM å’Œ INNODBçš„åŒºåˆ«(ä¸»è¦) äº‹åŠ¡å®‰å…¨ myisamä¸æ”¯æŒäº‹åŠ¡è€Œinnodbæ”¯æŒ æŸ¥è¯¢å’Œæ·»åŠ é€Ÿåº¦ myisamä¸ç”¨æ”¯æŒäº‹åŠ¡å°±ä¸ç”¨è€ƒè™‘åŒæ­¥é”ï¼ŒæŸ¥æ‰¾å’Œæ·»åŠ å’Œæ·»åŠ çš„é€Ÿåº¦å¿« æ”¯æŒå…¨æ–‡ç´¢å¼• myisamæ”¯æŒinnodbä¸æ”¯æŒ é”æœºåˆ¶ myisamæ”¯æŒè¡¨é”è€Œinnodbæ”¯æŒè¡Œé”(äº‹åŠ¡) å¤–é”® MyISAM ä¸æ”¯æŒå¤–é”®ï¼Œ INNODBæ”¯æŒå¤–é”®. (é€šå¸¸ä¸è®¾ç½®å¤–é”®ï¼Œé€šå¸¸æ˜¯åœ¨ç¨‹åºä¸­ä¿è¯æ•°æ®çš„ä¸€è‡´) ä¸‹é¢æ˜¯æ•°æ®åº“çš„ä¼˜åŒ–æ‰‹æ®µï¼Œä½†æ˜¯åªæ˜¯è¡¨é¢ï¼Œéœ€è¦ä»¥åŽå†å¥½å¥½æŽ¢ç©¶ åœ¨é¡¹ç›®è‡ªéªŒé¡¹ç›®è½¬æµ‹è¯•ä¹‹å‰ï¼Œåœ¨å¯åŠ¨mysqlæ•°æ®åº“æ—¶å¼€å¯æ…¢æŸ¥è¯¢ï¼Œå¹¶ä¸”æŠŠæ‰§è¡Œæ…¢çš„è¯­å¥å†™åˆ°æ—¥å¿—ä¸­ï¼Œåœ¨è¿è¡Œä¸€å®šæ—¶é—´åŽã€‚é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ‰¾åˆ°æ…¢æŸ¥è¯¢è¯­å¥ã€‚ 1234567891011121314151617181920212223242526272829show variables like '%slow%'; #æŸ¥çœ‹MySQLæ…¢æŸ¥è¯¢æ˜¯å¦å¼€å¯set global slow_query_log=ON; #å¼€å¯MySQLæ…¢æŸ¥è¯¢åŠŸèƒ½show variables like "long_query_time"; #æŸ¥çœ‹MySQLæ…¢æŸ¥è¯¢æ—¶é—´è®¾ç½®ï¼Œé»˜è®¤10ç§’set global long_query_time=5; #ä¿®æ”¹ä¸ºè®°å½•5ç§’å†…çš„æŸ¥è¯¢select sleep(6); #æµ‹è¯•MySQLæ…¢æŸ¥è¯¢show variables like "%slow%"; #æŸ¥çœ‹MySQLæ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„show global status like '%slow%'; #æŸ¥çœ‹MySQLæ…¢æŸ¥è¯¢çŠ¶æ€æˆ–è€…vi /etc/my.cnf #ç¼–è¾‘ï¼Œåœ¨[mysqld]æ®µæ·»åŠ ä»¥ä¸‹ä»£ç slow-query-log = on #å¼€å¯MySQLæ…¢æŸ¥è¯¢åŠŸèƒ½slow_query_log_file = /var/run/mysqld/mysqld-slow.log #è®¾ç½®MySQLæ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„long_query_time = 5 #ä¿®æ”¹ä¸ºè®°å½•5ç§’å†…çš„æŸ¥è¯¢ï¼Œé»˜è®¤ä¸è®¾ç½®æ­¤å‚æ•°ä¸ºè®°å½•10ç§’å†…çš„æŸ¥è¯¢log-queries-not-using-indexes = on #è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢:wq! #ä¿å­˜é€€å‡ºservice mysqld restart #é‡å¯MySQLæœåŠ¡ 13. æ•°æ®åº“ä¼˜åŒ–-ç´¢å¼• 13.1 ç´¢å¼•çš„æ¦‚å¿µ ç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©DBMSé«˜æ•ˆèŽ·å–æ•°æ®çš„æ•°æ®ç»“æž„ã€‚ 13.2 ç´¢å¼•æœ‰å“ªäº› åˆ†ç±»ï¼šæ™®é€šç´¢å¼•/å”¯ä¸€ç´¢å¼•/ä¸»é”®ç´¢å¼•/å…¨æ–‡ç´¢å¼• æ™®é€šç´¢å¼•:å…è®¸é‡å¤çš„å€¼å‡ºçŽ° å”¯ä¸€ç´¢å¼•:é™¤äº†ä¸èƒ½æœ‰é‡å¤çš„è®°å½•å¤–ï¼Œå…¶å®ƒå’Œæ™®é€šç´¢å¼•ä¸€æ ·(ç”¨æˆ·åã€ç”¨æˆ·èº«ä»½è¯ã€email,tel) ä¸»é”®ç´¢å¼•ï¼šæ˜¯éšç€è®¾å®šä¸»é”®è€Œåˆ›å»ºçš„ï¼Œä¹Ÿå°±æ˜¯æŠŠæŸä¸ªåˆ—è®¾ä¸ºä¸»é”®çš„æ—¶å€™ï¼Œæ•°æ®åº“å°±ä¼šçµ¦æ”¹åˆ—åˆ›å»ºç´¢å¼•ã€‚è¿™å°±æ˜¯ä¸»é”®ç´¢å¼•.å”¯ä¸€ä¸”æ²¡æœ‰nullå€¼ å…¨æ–‡ç´¢å¼•:ç”¨æ¥å¯¹è¡¨ä¸­çš„æ–‡æœ¬åŸŸ(charï¼Œvarcharï¼Œtext)è¿›è¡Œç´¢å¼•ï¼Œ å…¨æ–‡ç´¢å¼•é’ˆå¯¹MyIsam explain select * from articles where match(title,body) against(â€˜databaseâ€™);ã€ä¼šä½¿ç”¨å…¨æ–‡ç´¢å¼•ã€‘ 13.3 ä½¿ç”¨ç´¢å¼•çš„æ³¨æ„äº‹é¡¹ ç´¢å¼•å¼Šç«¯ å ç”¨ç£ç›˜ç©ºé—´ã€‚ å¯¹dml(æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤)æ“ä½œæœ‰å½±å“ï¼Œå˜æ…¢ã€‚ ä½¿ç”¨åœºæ™¯ï¼š è‚¯å®šåœ¨whereæ¡ä»¶ç»å¸¸ä½¿ç”¨,å¦‚æžœä¸åšæŸ¥è¯¢å°±æ²¡æœ‰æ„ä¹‰ è¯¥å­—æ®µçš„å†…å®¹ä¸æ˜¯å”¯ä¸€çš„å‡ ä¸ªå€¼(sex) å­—æ®µå†…å®¹ä¸æ˜¯é¢‘ç¹å˜åŒ–. æ³¨æ„äº‹é¡¹ å¯¹äºŽåˆ›å»ºçš„å¤šåˆ—ç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ï¼‰ï¼Œä¸æ˜¯ä½¿ç”¨çš„ç¬¬ä¸€éƒ¨åˆ†å°±ä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚ 123alter table dept add index my_ind (dname,loc); // dname å·¦è¾¹çš„åˆ—,locå°±æ˜¯å³è¾¹çš„åˆ—explain select * from dept where dname='aaa'\G ä¼šä½¿ç”¨åˆ°ç´¢å¼•explain select * from dept where loc='aaa'\G å°±ä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼• å¯¹äºŽä½¿ç”¨likeçš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å¦‚æžœæ˜¯%aaaä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼•è€Œaaa%ä¼šä½¿ç”¨åˆ°ç´¢å¼•ã€‚ 12explain select * from dept where dname like '%aaa'\Gä¸èƒ½ä½¿ç”¨ç´¢å¼•explain select * from dept where dname like 'aaa%'\Gä½¿ç”¨ç´¢å¼•. æ‰€ä»¥åœ¨likeæŸ¥è¯¢æ—¶ï¼Œâ€˜å…³é”®å­—â€™çš„æœ€å‰é¢ä¸èƒ½ä½¿ç”¨% æˆ–è€… _è¿™æ ·çš„å­—ç¬¦ï¼Œå¦‚æžœä¸€å®šè¦å‰é¢æœ‰å˜åŒ–çš„å€¼ï¼Œåˆ™è€ƒè™‘ä½¿ç”¨ å…¨æ–‡ç´¢å¼•-&gt;sphinx. ç´¢å¼•åˆ—æŽ’åº MySQLæŸ¥è¯¢åªä½¿ç”¨ä¸€ä¸ªç´¢å¼•ï¼Œå› æ­¤å¦‚æžœwhereå­å¥ä¸­å·²ç»ä½¿ç”¨äº†ç´¢å¼•çš„è¯ï¼Œé‚£ä¹ˆorder byä¸­çš„åˆ—æ˜¯ä¸ä¼šä½¿ç”¨ç´¢å¼•çš„ã€‚å› æ­¤æ•°æ®åº“é»˜è®¤æŽ’åºå¯ä»¥ç¬¦åˆè¦æ±‚çš„æƒ…å†µä¸‹ä¸è¦ä½¿ç”¨æŽ’åºæ“ä½œï¼›å°½é‡ä¸è¦åŒ…å«å¤šä¸ªåˆ—çš„æŽ’åºï¼Œå¦‚æžœéœ€è¦æœ€å¥½ç»™è¿™äº›åˆ—åˆ›å»ºå¤åˆç´¢å¼•ã€‚ å¦‚æžœåˆ—ç±»åž‹æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¸€å®šè¦åœ¨æ¡ä»¶ä¸­å°†æ•°æ®ä½¿ç”¨å¼•å·å¼•ç”¨èµ·æ¥ã€‚å¦åˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚ 123expain select * from dept where dname=â€™111â€™;expain select * from dept where dname=111;ï¼ˆæ•°å€¼è‡ªåŠ¨è½¬å­—ç¬¦ä¸²ï¼‰expain select * from dept where dname=qqq;æŠ¥é”™ ä¹Ÿå°±æ˜¯ï¼Œå¦‚æžœåˆ—æ˜¯å­—ç¬¦ä¸²ç±»åž‹ï¼Œæ— è®ºæ˜¯ä¸æ˜¯å­—ç¬¦ä¸²æ•°å­—å°±ä¸€å®šè¦ç”¨ â€˜â€™ æŠŠå®ƒåŒ…æ‹¬èµ·æ¥. å¦‚æžœmysqlä¼°è®¡ä½¿ç”¨å…¨è¡¨æ‰«æè¦æ¯”ä½¿ç”¨ç´¢å¼•å¿«ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚ è¡¨é‡Œé¢åªæœ‰ä¸€æ¡è®°å½• ç´¢å¼•ä¸ä¼šåŒ…å«æœ‰NULLå€¼çš„åˆ— åªè¦åˆ—ä¸­åŒ…å«æœ‰NULLå€¼éƒ½å°†ä¸ä¼šè¢«åŒ…å«åœ¨MySQLç´¢å¼•ä¸­ï¼Œå¤åˆç´¢å¼•ä¸­åªè¦æœ‰ä¸€åˆ—å«æœ‰NULLå€¼ï¼Œé‚£ä¹ˆè¿™ä¸€åˆ—å¯¹äºŽæ­¤å¤åˆç´¢å¼•å°±æ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æ•°æ®åº“è®¾è®¡æ—¶ä¸è¦è®©å­—æ®µçš„é»˜è®¤å€¼ä¸ºNULLã€‚ ä½¿ç”¨çŸ­ç´¢å¼• å¯¹ä¸²åˆ—è¿›è¡Œç´¢å¼•ï¼Œå¦‚æžœå¯èƒ½åº”è¯¥æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæœ‰ä¸€ä¸ªCHAR(255)çš„åˆ—ï¼Œå¦‚æžœåœ¨å‰10ä¸ªæˆ–20ä¸ªå­—ç¬¦å†…ï¼Œå¤šæ•°å€¼æ˜¯æƒŸä¸€çš„ï¼Œé‚£ä¹ˆå°±ä¸è¦å¯¹æ•´ä¸ªåˆ—è¿›è¡Œç´¢å¼•ã€‚çŸ­ç´¢å¼•ä¸ä»…å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦è€Œä¸”å¯ä»¥èŠ‚çœç£ç›˜ç©ºé—´å’ŒI/Oæ“ä½œã€‚ ä¸è¦åœ¨åˆ—ä¸Šè¿›è¡Œè¿ç®—ï¼Œä¸ä½¿ç”¨NOT INå’Œ&lt;&gt;æ“ä½œï¼Œä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚ 14. æ•°æ®åº“ä¼˜åŒ–-åˆ†è¡¨ åˆ†è¡¨åˆ†ä¸ºæ°´å¹³(æŒ‰è¡Œ)åˆ†è¡¨å’Œåž‚ç›´(æŒ‰åˆ—)åˆ†è¡¨ æ°´å¹³åˆ†è¡¨æƒ…å½¢ï¼š æ ¹æ®ç»éªŒï¼ŒMysqlè¡¨æ•°æ®ä¸€èˆ¬è¾¾åˆ°ç™¾ä¸‡çº§åˆ«ï¼ŒæŸ¥è¯¢æ•ˆçŽ‡ä¼šå¾ˆä½Žï¼Œå®¹æ˜“é€ æˆè¡¨é”ï¼Œç”šè‡³å †ç§¯å¾ˆå¤šè¿žæŽ¥ï¼Œç›´æŽ¥æŒ‚æŽ‰ï¼›æ°´å¹³åˆ†è¡¨èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦è¾ƒå°‘è¿™äº›åŽ‹åŠ›ã€‚ åž‚ç›´åˆ†è¡¨æƒ…å½¢ï¼š å¦‚æžœä¸€å¼ è¡¨ä¸­æŸä¸ªå­—æ®µå€¼éžå¸¸å¤š(é•¿æ–‡æœ¬ã€äºŒè¿›åˆ¶ç­‰)ï¼Œè€Œä¸”åªæœ‰åœ¨å¾ˆå°‘çš„æƒ…å†µä¸‹ä¼šæŸ¥è¯¢ã€‚è¿™æ—¶å€™å°±å¯ä»¥æŠŠå­—æ®µå¤šä¸ªå•ç‹¬æ”¾åˆ°ä¸€ä¸ªè¡¨ï¼Œé€šè¿‡å¤–é”®å…³è”èµ·æ¥ã€‚è€ƒè¯•è¯¦æƒ…ï¼Œä¸€èˆ¬æˆ‘ä»¬åªå…³æ³¨åˆ†æ•°ï¼Œä¸å…³æ³¨è¯¦æƒ…ã€‚ æ°´å¹³åˆ†è¡¨ç­–ç•¥ï¼š 1.æŒ‰æ—¶é—´åˆ†è¡¨ è¿™ç§åˆ†è¡¨æ–¹å¼æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå½“æ•°æ®æœ‰è¾ƒå¼ºçš„å®žæ•ˆæ€§ï¼Œå¦‚å¾®åšå‘é€è®°å½•ã€å¾®ä¿¡æ¶ˆæ¯è®°å½•ç­‰ï¼Œè¿™ç§æ•°æ®å¾ˆå°‘æœ‰ç”¨æˆ·ä¼šæŸ¥è¯¢å‡ ä¸ªæœˆå‰çš„æ•°æ®ï¼Œå¦‚éœ€è¦å°±å¯ä»¥æŒ‰æœˆåˆ†è¡¨ã€‚ 2.æŒ‰åŒºé—´èŒƒå›´åˆ†è¡¨ ä¸€èˆ¬åœ¨æœ‰ä¸¥æ ¼çš„è‡ªå¢židéœ€æ±‚ä¸Šï¼Œå¦‚æŒ‰ç…§user_idæ°´å¹³åˆ†è¡¨ï¼š 123table_1 user_idä»Ž1~100w table_2 user_idä»Ž101~200w table_3 user_idä»Ž201~300w 3.hashåˆ†è¡¨ é€šè¿‡ä¸€ä¸ªåŽŸå§‹ç›®æ ‡çš„IDæˆ–è€…åç§°é€šè¿‡ä¸€å®šçš„hashç®—æ³•è®¡ç®—å‡ºæ•°æ®å­˜å‚¨è¡¨çš„è¡¨åï¼Œç„¶åŽè®¿é—®ç›¸åº”çš„è¡¨ã€‚ 15. æ•°æ®åº“ä¼˜åŒ–-è¯»å†™åˆ†ç¦» ä¸€å°æ•°æ®åº“æ”¯æŒçš„æœ€å¤§å¹¶å‘è¿žæŽ¥æ•°æ˜¯æœ‰é™çš„ï¼Œå¦‚æžœç”¨æˆ·å¹¶å‘è®¿é—®å¤ªå¤šã€‚ä¸€å°æœåŠ¡å™¨æ»¡è¶³ä¸è¦è¦æ±‚æ˜¯å°±å¯ä»¥é›†ç¾¤å¤„ç†ã€‚Mysqlçš„é›†ç¾¤å¤„ç†æŠ€æœ¯æœ€å¸¸ç”¨çš„å°±æ˜¯è¯»å†™åˆ†ç¦»ã€‚ ä¸»ä»ŽåŒæ­¥ æ•°æ®åº“æœ€ç»ˆä¼šæŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå¦‚æžœé›†ç¾¤å¿…é¡»ç¡®ä¿æ¯ä¸ªæ•°æ®åº“æœåŠ¡å™¨çš„æ•°æ®æ˜¯ä¸€ç›´çš„ã€‚èƒ½æ”¹å˜æ•°æ®åº“æ•°æ®çš„æ“ä½œéƒ½å¾€ä¸»æ•°æ®åº“åŽ»å†™ï¼Œè€Œå…¶ä»–çš„æ•°æ®åº“ä»Žä¸»æ•°æ®åº“ä¸ŠåŒæ­¥æ•°æ®ã€‚ è¯»å†™åˆ†ç¦» ä½¿ç”¨è´Ÿè½½å‡è¡¡æ¥å®žçŽ°å†™çš„æ“ä½œéƒ½å¾€ä¸»æ•°æ®åŽ»ï¼Œè€Œè¯»çš„æ“ä½œå¾€ä»ŽæœåŠ¡å™¨åŽ»ã€‚ 16. æ•°æ®åº“ä¼˜åŒ–-ç¼“å­˜ ä»€ä¹ˆæ˜¯ç¼“å­˜ åœ¨æŒä¹…å±‚(dao)å’Œæ•°æ®åº“(db)ä¹‹é—´æ·»åŠ ä¸€ä¸ªç¼“å­˜å±‚ï¼Œå¦‚æžœç”¨æˆ·è®¿é—®çš„æ•°æ®å·²ç»ç¼“å­˜èµ·æ¥æ—¶ï¼Œåœ¨ç”¨æˆ·è®¿é—®æ—¶ç›´æŽ¥ä»Žç¼“å­˜ä¸­èŽ·å–ï¼Œä¸ç”¨è®¿é—®æ•°æ®åº“ã€‚è€Œç¼“å­˜æ˜¯åœ¨æ“ä½œå†…å­˜çº§ï¼Œè®¿é—®é€Ÿåº¦å¿«ã€‚ ä½œç”¨ å‡å°‘æ•°æ®åº“æœåŠ¡å™¨åŽ‹åŠ›ï¼Œå‡å°‘è®¿é—®æ—¶é—´ã€‚ Javaä¸­å¸¸ç”¨çš„ç¼“å­˜æœ‰ hibernateçš„äºŒçº§ç¼“å­˜ã€‚è¯¥ç¼“å­˜ä¸èƒ½å®Œæˆåˆ†å¸ƒå¼ç¼“å­˜ã€‚ å¯ä»¥ä½¿ç”¨redis(memcaheç­‰)æ¥ä½œä¸ºä¸­å¤®ç¼“å­˜ã€‚å¯¹ç¼“å­˜çš„æ•°æ®è¿›è¡Œé›†ä¸­å¤„ç† 17. æ•°æ®åº“ä¼˜åŒ–-sqlè¯­å¥ä¼˜åŒ–çš„æŠ€å·§ DDLä¼˜åŒ– é€šè¿‡ç¦ç”¨ç´¢å¼•æ¥æä¾›å¯¼å…¥æ•°æ®æ€§èƒ½ï¼Œè¿™ä¸ªæ“ä½œä¸»è¦é’ˆå¯¹çŽ°æœ‰æ•°æ®åº“çš„è¡¨è¿½åŠ æ•°æ® 123456//åŽ»é™¤é”®alter table test3 DISABLE keys;//æ‰¹é‡æ’å…¥æ•°æ®insert into test3 ***//æ¢å¤é”®alter table test3 ENABLE keys; å…³é—­å”¯ä¸€æ ¡éªŒ 12set unique_checks=0 å…³é—­set unique_checks=1 å¼€å¯ ä¿®æ”¹äº‹åŠ¡æäº¤æ–¹å¼(å¯¼å…¥)ï¼ˆå˜å¤šæ¬¡æäº¤ä¸ºä¸€æ¬¡ï¼‰ 123set autocommit=0 å…³é—­//æ‰¹é‡æ’å…¥set autocommit=1 å¼€å¯ DMLä¼˜åŒ–ï¼ˆå˜å¤šæ¬¡æäº¤ä¸ºä¸€æ¬¡ï¼‰ 12345insert into test values(1,2);insert into test values(1,3);insert into test values(1,4);//åˆå¹¶å¤šæ¡ä¸ºä¸€æ¡insert into test values(1,2),(1,3),(1,4) DQLä¼˜åŒ– Order byä¼˜åŒ– å¤šç”¨ç´¢å¼•æŽ’åº æ™®é€šç»“æžœæŽ’åºï¼ˆéžç´¢å¼•æŽ’åºï¼‰Filesort group byä¼˜åŒ– ä½¿ç”¨order by null,å–æ¶ˆé»˜è®¤æŽ’åº ç­‰ç­‰ç­‰ç­‰â€¦ 18. jdbcæ‰¹é‡æ’å…¥å‡ ç™¾ä¸‡æ•°æ®æ€Žä¹ˆå®žçŽ° 1ã€å˜å¤šæ¬¡æäº¤ä¸ºä¸€æ¬¡ 2ã€ä½¿ç”¨æ‰¹é‡æ“ä½œ 3ã€åƒè¿™æ ·çš„æ‰¹é‡æ’å…¥æ“ä½œèƒ½ä¸ä½¿ç”¨ä»£ç æ“ä½œå°±ä¸ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¥å®žçŽ° mysqlä¼˜åŒ–æ‰‹æ®µä»‹ç»åˆ°è¿™é‡Œã€‚ 19. èšç°‡ç´¢å¼•å’Œéžèšç°‡ç´¢å¼• ç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•å’Œéžèšç°‡ç´¢å¼•ã€‚ â€œèšç°‡ç´¢å¼•â€ ä»¥ä¸€æœ¬è‹±æ–‡è¯¾æœ¬ä¸ºä¾‹ï¼Œè¦æ‰¾ç¬¬8è¯¾ï¼Œç›´æŽ¥ç¿»ä¹¦ï¼Œè‹¥å…ˆç¿»åˆ°ç¬¬5è¯¾ï¼Œåˆ™å¾€åŽç¿»ï¼Œå†ç¿»åˆ°ç¬¬10è¯¾ï¼Œåˆ™åˆå¾€å‰ç¿»ã€‚è¿™æœ¬ä¹¦æœ¬èº«å°±æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œå³â€œèšç°‡ç´¢å¼•â€ã€‚ â€œéžèšç°‡ç´¢å¼•â€ å¦‚æžœè¦æ‰¾&quot;fireâ€è¿™ä¸ªå•è¯ï¼Œä¼šç¿»åˆ°ä¹¦åŽé¢çš„é™„å½•ï¼Œè¿™ä¸ªé™„å½•æ˜¯æŒ‰å­—æ¯æŽ’åºçš„ï¼Œæ‰¾åˆ°Få­—æ¯é‚£ä¸€å—ï¼Œå†æ‰¾åˆ°&quot;fireâ€ï¼Œå¯¹åº”çš„ä¼šæ˜¯å®ƒåœ¨ç¬¬å‡ è¯¾ã€‚è¿™ä¸ªé™„å½•ï¼Œä¸ºâ€œéžèšç°‡ç´¢å¼•â€ã€‚ ç”±æ­¤å¯è§ï¼Œèšç°‡ç´¢å¼•ï¼Œç´¢å¼•çš„é¡ºåºå°±æ˜¯æ•°æ®å­˜æ”¾çš„é¡ºåºï¼Œæ‰€ä»¥ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œä¸€å¼ æ•°æ®è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚ èšç°‡ç´¢å¼•è¦æ¯”éžèšç°‡ç´¢å¼•æŸ¥è¯¢æ•ˆçŽ‡é«˜å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯èŒƒå›´æŸ¥è¯¢çš„æ—¶å€™ã€‚æ‰€ä»¥ï¼Œè‡³äºŽèšç°‡ç´¢å¼•åˆ°åº•åº”è¯¥ä¸ºä¸»é”®ï¼Œè¿˜æ˜¯å…¶ä»–å­—æ®µï¼Œè¿™ä¸ªå¯ä»¥å†è®¨è®ºã€‚ 1ã€MYSQLçš„ç´¢å¼• mysqlä¸­ï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“Žå¯¹ç´¢å¼•çš„å®žçŽ°æ–¹å¼ä¸åŒï¼Œå¤§è‡´è¯´ä¸‹MyISAMå’ŒInnoDBä¸¤ç§å­˜å‚¨å¼•æ“Žã€‚ MyISAMå­˜å‚¨å¼•æ“Žçš„ç´¢å¼•å®žçŽ° MyISAMçš„B+Treeçš„å¶å­èŠ‚ç‚¹ä¸Šçš„dataï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯æ•°æ®å­˜æ”¾çš„åœ°å€ã€‚ä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ²¡å•¥åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•ä¸­çš„keyä¸€å®šå¾—æ˜¯å”¯ä¸€çš„ã€‚è¿™é‡Œçš„ç´¢å¼•éƒ½æ˜¯éžèšç°‡ç´¢å¼•ã€‚ MyISAMè¿˜é‡‡ç”¨åŽ‹ç¼©æœºåˆ¶å­˜å‚¨ç´¢å¼•ï¼Œæ¯”å¦‚ï¼Œç¬¬ä¸€ä¸ªç´¢å¼•ä¸ºâ€œherâ€ï¼Œç¬¬äºŒä¸ªç´¢å¼•ä¸ºâ€œhereâ€ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªç´¢å¼•ä¼šè¢«å­˜å‚¨ä¸ºâ€œ3,eâ€ï¼Œè¿™æ ·çš„ç¼ºç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„ç´¢å¼•åªèƒ½é‡‡ç”¨é¡ºåºæŸ¥æ‰¾ã€‚ InnoDBå­˜å‚¨å¼•æ“Žçš„ç´¢å¼•å®žçŽ° InnoDB çš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼ŒB+Treeçš„å¶å­èŠ‚ç‚¹ä¸Šçš„dataå°±æ˜¯æ•°æ®æœ¬èº«ï¼Œkeyä¸ºä¸»é”®ï¼Œè¿™æ˜¯èšç°‡ç´¢å¼•ã€‚éžèšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹ä¸Šçš„dataæ˜¯ä¸»é”® (æ‰€ä»¥èšç°‡ç´¢å¼•çš„keyï¼Œä¸èƒ½è¿‡é•¿)ã€‚ä¸ºä»€ä¹ˆå­˜æ”¾çš„ä¸»é”®ï¼Œè€Œä¸æ˜¯è®°å½•æ‰€åœ¨åœ°å€å‘¢ï¼Œç†ç”±ç›¸å½“ç®€å•ï¼Œå› ä¸ºè®°å½•æ‰€åœ¨åœ°å€å¹¶ä¸èƒ½ä¿è¯ä¸€å®šä¸ä¼šå˜ï¼Œä½†ä¸»é”®å¯ä»¥ä¿è¯ã€‚ è‡³äºŽä¸ºä»€ä¹ˆä¸»é”®é€šå¸¸å»ºè®®ä½¿ç”¨è‡ªå¢židå‘¢ï¼Ÿ 2.èšç°‡ç´¢å¼• èšç°‡ç´¢å¼•çš„æ•°æ®çš„ç‰©ç†å­˜æ”¾é¡ºåºä¸Žç´¢å¼•é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œå³ï¼šåªè¦ç´¢å¼•æ˜¯ç›¸é‚»çš„ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®ä¸€å®šä¹Ÿæ˜¯ç›¸é‚»åœ°å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„ã€‚å¦‚æžœä¸»é”®ä¸æ˜¯è‡ªå¢židï¼Œé‚£ä¹ˆå¯ä»¥æƒ³ è±¡ï¼Œå®ƒä¼šå¹²äº›ä»€ä¹ˆï¼Œä¸æ–­åœ°è°ƒæ•´æ•°æ®çš„ç‰©ç†åœ°å€ã€åˆ†é¡µï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶ä»–ä¸€äº›æŽªæ–½æ¥å‡å°‘è¿™äº›æ“ä½œï¼Œä½†å´æ— æ³•å½»åº•é¿å…ã€‚ä½†ï¼Œå¦‚æžœæ˜¯è‡ªå¢žçš„ï¼Œé‚£å°±ç®€å•äº†ï¼Œå®ƒåªéœ€è¦ä¸€ é¡µä¸€é¡µåœ°å†™ï¼Œç´¢å¼•ç»“æž„ç›¸å¯¹ç´§å‡‘ï¼Œç£ç›˜ç¢Žç‰‡å°‘ï¼Œæ•ˆçŽ‡ä¹Ÿé«˜ã€‚ èšç°‡ç´¢å¼•ä¸ä½†åœ¨æ£€ç´¢ä¸Šå¯ä»¥å¤§å¤§æ»´æé«˜æ•ˆçŽ‡ï¼Œåœ¨æ•°æ®è¯»å–ä¸Šä¹Ÿä¸€æ ·ã€‚æ¯”å¦‚ï¼šéœ€è¦æŸ¥è¯¢f~tçš„æ‰€æœ‰å•è¯ã€‚ ä¸€ä¸ªä½¿ç”¨MyISAMçš„ä¸»ç´¢å¼•ï¼Œä¸€ä¸ªä½¿ç”¨InnoDBçš„èšç°‡ç´¢å¼•ã€‚ä¸¤ç§ç´¢å¼•çš„B+Treeæ£€ç´¢æ—¶é—´ä¸€æ ·ï¼Œä½†è¯»å–æ—¶å´æœ‰äº†å·®å¼‚ã€‚ å› ä¸ºMyISAMçš„ä¸»ç´¢å¼•å¹¶éžèšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆä»–çš„æ•°æ®çš„ç‰©ç†åœ°å€å¿…ç„¶æ˜¯å‡Œä¹±çš„ï¼Œæ‹¿åˆ°è¿™äº›ç‰©ç†åœ°å€ï¼ŒæŒ‰ç…§åˆé€‚çš„ç®—æ³•è¿›è¡ŒI/Oè¯»å–ï¼ŒäºŽæ˜¯å¼€å§‹ä¸åœçš„å¯»é“ä¸åœçš„æ—‹è½¬ã€‚èšç°‡ç´¢å¼•åˆ™åªéœ€ä¸€æ¬¡I/Oã€‚ ä¸è¿‡ï¼Œå¦‚æžœæ¶‰åŠåˆ°å¤§æ•°æ®é‡çš„æŽ’åºã€å…¨è¡¨æ‰«æã€countä¹‹ç±»çš„æ“ä½œçš„è¯ï¼Œè¿˜æ˜¯MyISAMå ä¼˜åŠ¿äº›ï¼Œå› ä¸ºç´¢å¼•æ‰€å ç©ºé—´å°ï¼Œè¿™äº›æ“ä½œæ˜¯éœ€è¦åœ¨å†…å­˜ä¸­å®Œæˆçš„ã€‚ é‰´äºŽèšç°‡ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢æ•ˆçŽ‡ï¼Œå¾ˆå¤šäººè®¤ä¸ºä½¿ç”¨ä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•å¤ªå¤šæµªè´¹ï¼Œæ¯•ç«Ÿå‡ ä¹Žä¸ä¼šä½¿ç”¨ä¸»é”®è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚ä½†è‹¥å†è€ƒè™‘åˆ°èšç°‡ç´¢å¼•çš„å­˜å‚¨ï¼Œå°±ä¸å¥½å®šè®ºäº†ã€‚ 20. sqlæ³¨å…¥é—®é¢˜ 20.1 ä»€ä¹ˆæ˜¯sqlæ³¨å…¥ sqlæ³¨å…¥å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œæ˜¯ä¸€ç§å¸¸è§çš„æ”»å‡»æ–¹å¼ï¼Œæ”»å‡»è€…åœ¨ç•Œé¢çš„è¡¨å•ä¿¡æ¯æˆ–urlä¸Šè¾“å…¥ä¸€äº›å¥‡æ€ªçš„sqlç‰‡æ®µï¼Œä¾‹å¦‚â€œor â€˜1â€™=â€™1â€™â€è¿™æ ·çš„è¯­å¥ï¼Œæœ‰å¯èƒ½å…¥ä¾µå‚æ•°æ ¡éªŒä¸è¶³çš„åº”ç”¨ç¨‹åºã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­éœ€è¦åšä¸€äº›å·¥ä½œï¼Œæ¥é˜²å¤‡è¿™æ ·çš„æ”»å‡»æ–¹å¼ã€‚åœ¨ä¸€äº›å®‰å…¨æ€§å¾ˆé«˜çš„åº”ç”¨ä¸­ï¼Œæ¯”å¦‚é“¶è¡Œè½¯ä»¶ï¼Œç»å¸¸ä½¿ç”¨å°†sqlè¯­å¥å…¨éƒ¨æ›¿æ¢ä¸ºå­˜å‚¨è¿‡ç¨‹è¿™æ ·çš„æ–¹å¼ï¼Œæ¥é˜²æ­¢sqlæ³¨å…¥ï¼Œè¿™å½“ç„¶æ˜¯ä¸€ç§å¾ˆå®‰å…¨çš„æ–¹å¼ï¼Œä½†æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­ï¼Œå¯èƒ½ä¸éœ€è¦è¿™ç§æ­»æ¿çš„æ–¹å¼ã€‚ 20.2 PrepareStatementè§£å†³SQLæ³¨å…¥çš„é—®é¢˜ åœ¨ä½¿ç”¨JDBCçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨PrepareStatementè¿›è¡Œé¢„å¤„ç†ï¼Œé¢„å¤„ç†çš„ä¼˜åŠ¿å°±æ˜¯é¢„é˜²ç»å¤§å¤šæ•°çš„SQLæ³¨å…¥ï¼›è€Œä¸”é’ˆå¯¹å¤šæ¬¡æ“ä½œæ•°æ®åº“çš„æƒ…å†µï¼Œå¯ä»¥æžå¤§çš„æé«˜è®¿é—®æ•°æ®åº“çš„æ•ˆçŽ‡ã€‚ é‚£ä¸ºä»€ä¹ˆå®ƒè¿™æ ·å¤„ç†å°±èƒ½é¢„é˜²SQLæ³¨å…¥æé«˜å®‰å…¨æ€§å‘¢ï¼Ÿå…¶å®žæ˜¯å› ä¸ºSQLè¯­å¥åœ¨ç¨‹åºè¿è¡Œå‰å·²ç»è¿›è¡Œäº†é¢„ç¼–è¯‘ã€‚åœ¨ç¨‹åºè¿è¡Œæ—¶ç¬¬ä¸€æ¬¡æ“ä½œæ•°æ®åº“ä¹‹å‰ï¼ŒSQLè¯­å¥å·²ç»è¢«æ•°æ®åº“åˆ†æžï¼Œç¼–è¯‘å’Œä¼˜åŒ–ï¼Œå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ä¹Ÿä¼šç¼“å­˜ä¸‹æ¥å¹¶å…è®¸æ•°æ®åº“ä»¥å‚æ•°åŒ–çš„å½¢å¼è¿›è¡ŒæŸ¥è¯¢ã€‚å½“è¿è¡Œæ—¶åŠ¨æ€åœ°æŠŠå‚æ•°ä¼ ç»™PreprareStatementæ—¶ï¼Œå³ä½¿å‚æ•°é‡Œæœ‰æ•æ„Ÿå­—ç¬¦å¦‚ or â€˜1=1â€™ï¼Œæ•°æ®åº“ä¹Ÿä¼šä½œä¸ºä¸€ä¸ªå‚æ•°ä¸€ä¸ªå­—æ®µçš„å±žæ€§å€¼æ¥å¤„ç†è€Œä¸ä¼šä½œä¸ºä¸€ä¸ªSQLæŒ‡ä»¤ã€‚å¦‚æ­¤ï¼Œå°±èµ·åˆ°äº†SQLæ³¨å…¥çš„ä½œç”¨äº†ï¼ 20.3 MyBatiså¦‚ä½•é˜²æ­¢sqlæ³¨å…¥ mybatisæ¡†æž¶ä½œä¸ºä¸€æ¬¾åŠè‡ªåŠ¨åŒ–çš„æŒä¹…å±‚æ¡†æž¶ï¼Œå…¶sqlè¯­å¥éƒ½è¦æˆ‘ä»¬è‡ªå·±æ¥æ‰‹åŠ¨ç¼–å†™ï¼Œè¿™ä¸ªæ—¶å€™å½“ç„¶éœ€è¦é˜²æ­¢sqlæ³¨å…¥ã€‚å…¶å®žMybatisçš„sqlæ˜¯ä¸€ä¸ªå…·æœ‰â€œè¾“å…¥+è¾“å‡ºâ€åŠŸèƒ½ï¼Œç±»ä¼¼äºŽå‡½æ•°çš„ç»“æž„ï¼Œå¦‚ä¸‹ï¼š 12345&lt;select id=â€œgetBlogByIdâ€œ resultType=â€œBlogâ€œ parameterType=â€intâ€&gt; select id,title,author,content from blog where id=#&#123;id&#125; &lt;/select&gt; è¿™é‡Œï¼ŒparameterTypeæ ‡ç¤ºäº†è¾“å…¥çš„å‚æ•°ç±»åž‹ï¼ŒresultTypeæ ‡ç¤ºäº†è¾“å‡ºçš„å‚æ•°ç±»åž‹ã€‚å›žåº”ä¸Šæ–‡ï¼Œå¦‚æžœæˆ‘ä»¬æƒ³é˜²æ­¢sqlæ³¨å…¥ï¼Œç†æ‰€å½“ç„¶åœ°è¦åœ¨è¾“å…¥å‚æ•°ä¸Šä¸‹åŠŸå¤«ã€‚ä¸Šé¢ä»£ç ä¸­â€œ#{id}â€å³è¾“å…¥å‚æ•°åœ¨sqlä¸­æ‹¼æŽ¥çš„éƒ¨åˆ†ï¼Œä¼ å…¥å‚æ•°åŽï¼Œæ‰“å°å‡ºæ‰§è¡Œçš„sqlè¯­å¥ï¼Œä¼šçœ‹åˆ°sqlæ˜¯è¿™æ ·çš„ï¼š select id,title,author,content from blog where id = ? ä¸ç®¡è¾“å…¥ä»€ä¹ˆå‚æ•°ï¼Œæ‰“å°å‡ºçš„sqléƒ½æ˜¯è¿™æ ·çš„ã€‚è¿™æ˜¯å› ä¸ºmybatiså¯ç”¨äº†é¢„ç¼–è¯‘åŠŸèƒ½ï¼Œåœ¨sqlæ‰§è¡Œå‰ï¼Œä¼šå…ˆå°†ä¸Šé¢çš„sqlå‘é€ç»™æ•°æ®åº“è¿›è¡Œç¼–è¯‘ï¼Œæ‰§è¡Œæ—¶ï¼Œç›´æŽ¥ä½¿ç”¨ç¼–è¯‘å¥½çš„sqlï¼Œæ›¿æ¢å ä½ç¬¦â€œï¼Ÿâ€å°±å¯ä»¥äº†ã€‚å› ä¸ºsqlæ³¨å…¥åªèƒ½å¯¹ç¼–è¯‘è¿‡ç¨‹èµ·ä½œç”¨ï¼Œæ‰€ä»¥è¿™æ ·çš„æ–¹å¼å°±å¾ˆå¥½åœ°é¿å…äº†sqlæ³¨å…¥çš„é—®é¢˜ã€‚ mybatisæ˜¯å¦‚ä½•åšåˆ°sqlé¢„ç¼–è¯‘çš„å‘¢ï¼Ÿå…¶å®žåœ¨æ¡†æž¶åº•å±‚ï¼Œæ˜¯jdbcä¸­çš„PreparedStatementç±»åœ¨èµ·ä½œç”¨ï¼ŒPreparedStatementæ˜¯æˆ‘ä»¬å¾ˆç†Ÿæ‚‰çš„Statementçš„å­ç±»ï¼Œå®ƒçš„å¯¹è±¡åŒ…å«äº†ç¼–è¯‘å¥½çš„sqlè¯­å¥ã€‚è¿™ç§â€œå‡†å¤‡å¥½â€çš„æ–¹å¼ä¸ä»…èƒ½æé«˜å®‰å…¨æ€§ï¼Œè€Œä¸”åœ¨å¤šæ¬¡æ‰§è¡Œä¸€ä¸ªsqlæ—¶ï¼Œèƒ½å¤Ÿæé«˜æ•ˆçŽ‡ï¼ŒåŽŸå› æ˜¯sqlå·²ç¼–è¯‘å¥½ï¼Œå†æ¬¡æ‰§è¡Œæ—¶æ— éœ€å†ç¼–è¯‘ã€‚ è¡¥å…… 12345&lt;select id=â€œorderBlogâ€œ resultType=â€œBlogâ€œ parameterType=â€mapâ€&gt; select id,title,author,content from blog order by $&#123;orderParam&#125; &lt;/select&gt; ä»”ç»†è§‚å¯Ÿï¼Œå†…è”å‚æ•°çš„æ ¼å¼ç”±â€œ#{xxx}â€å˜ä¸ºäº†${xxx}ã€‚å¦‚æžœæˆ‘ä»¬ç»™å‚æ•°â€œorderParamâ€èµ‹å€¼ä¸ºâ€idâ€,å°†sqlæ‰“å°å‡ºæ¥ï¼Œæ˜¯è¿™æ ·çš„ï¼š select id,title,author,content from blog order by id æ˜¾ç„¶ï¼Œè¿™æ ·æ˜¯æ— æ³•é˜»æ­¢sqlæ³¨å…¥çš„ã€‚åœ¨mybatisä¸­ï¼Œâ€${xxx}â€è¿™æ ·æ ¼å¼çš„å‚æ•°ä¼šç›´æŽ¥å‚ä¸Žsqlç¼–è¯‘ï¼Œä»Žè€Œä¸èƒ½é¿å…æ³¨å…¥æ”»å‡»ã€‚ä½†æ¶‰åŠåˆ°åŠ¨æ€è¡¨åå’Œåˆ—åæ—¶ï¼Œåªèƒ½ä½¿ç”¨â€œ${xxx}â€è¿™æ ·çš„å‚æ•°æ ¼å¼ï¼Œæ‰€ä»¥ï¼Œè¿™æ ·çš„å‚æ•°éœ€è¦æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰‹å·¥è¿›è¡Œå¤„ç†æ¥é˜²æ­¢æ³¨å…¥ã€‚ 21. mysqlæ‚²è§‚é”å’Œä¹è§‚é” 21.1 æ‚²è§‚é” æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡åŽ»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ æ‚²è§‚é”ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œã€‚ Java synchronized å°±å±žäºŽæ‚²è§‚é”çš„ä¸€ç§å®žçŽ°ï¼Œæ¯æ¬¡çº¿ç¨‹è¦ä¿®æ”¹æ•°æ®æ—¶éƒ½å…ˆèŽ·å¾—é”ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ“ä½œæ•°æ®ï¼Œå…¶ä»–çº¿ç¨‹åˆ™ä¼šè¢«blockã€‚ 21.2 ä¹è§‚é” ä¹è§‚é”ï¼ˆOptimistic Lockï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡åŽ»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æäº¤æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰åŽ»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚ä¹è§‚é”é€‚ç”¨äºŽè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ï¼Œè¿™æ ·å¯ä»¥æé«˜åžåé‡ã€‚ ä¹è§‚é”ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚ ä¹è§‚é”ä¸€èˆ¬æ¥è¯´æœ‰ä»¥ä¸‹2ç§æ–¹å¼ï¼š ä½¿ç”¨æ•°æ®ç‰ˆæœ¬ï¼ˆVersionï¼‰è®°å½•æœºåˆ¶å®žçŽ°ï¼Œè¿™æ˜¯ä¹è§‚é”æœ€å¸¸ç”¨çš„ä¸€ç§å®žçŽ°æ–¹å¼ã€‚ä½•è°“æ•°æ®ç‰ˆæœ¬ï¼Ÿå³ä¸ºæ•°æ®å¢žåŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢žåŠ ä¸€ä¸ªæ•°å­—ç±»åž‹çš„ version å­—æ®µæ¥å®žçŽ°ã€‚å½“è¯»å–æ•°æ®æ—¶ï¼Œå°†versionå­—æ®µçš„å€¼ä¸€åŒè¯»å‡ºï¼Œæ•°æ®æ¯æ›´æ–°ä¸€æ¬¡ï¼Œå¯¹æ­¤versionå€¼åŠ ä¸€ã€‚å½“æˆ‘ä»¬æäº¤æ›´æ–°çš„æ—¶å€™ï¼Œåˆ¤æ–­æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯ä¸Žç¬¬ä¸€æ¬¡å–å‡ºæ¥çš„versionå€¼è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æžœæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ä¸Žç¬¬ä¸€æ¬¡å–å‡ºæ¥çš„versionå€¼ç›¸ç­‰ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚ ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ã€‚ä¹è§‚é”å®šçš„ç¬¬äºŒç§å®žçŽ°æ–¹å¼å’Œç¬¬ä¸€ç§å·®ä¸å¤šï¼ŒåŒæ ·æ˜¯åœ¨éœ€è¦ä¹è§‚é”æŽ§åˆ¶çš„tableä¸­å¢žåŠ ä¸€ä¸ªå­—æ®µï¼Œåç§°æ— æ‰€è°“ï¼Œå­—æ®µç±»åž‹ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆtimestampï¼‰, å’Œä¸Šé¢çš„versionç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™æ£€æŸ¥å½“å‰æ•°æ®åº“ä¸­æ•°æ®çš„æ—¶é—´æˆ³å’Œè‡ªå·±æ›´æ–°å‰å–åˆ°çš„æ—¶é—´æˆ³è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æžœä¸€è‡´åˆ™OKï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚ Java JUCä¸­çš„atomicåŒ…å°±æ˜¯ä¹è§‚é”çš„ä¸€ç§å®žçŽ°ï¼ŒAtomicInteger é€šè¿‡CASï¼ˆCompare And Setï¼‰æ“ä½œå®žçŽ°çº¿ç¨‹å®‰å…¨çš„è‡ªå¢žã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤æ‚æŸ¥è¯¢åŸºç¡€]]></title>
    <url>%2F2019%2F01%2F27%2Fmysql%2F%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[è¿™ä¸€èŠ‚ä»Žgroup byå’Œhavingä¸¤ä¸ªå…³é”®è¯­æ³•å…¥æ‰‹ï¼Œå­¦ä¹ ä¸€ä¸‹å†™sqlçš„åŸºæœ¬æ€è·¯ã€‚ æ•°æ®åº“å‡†å¤‡ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677-- ------------------------------ å­¦ç”Ÿè¡¨-- ----------------------------DROP TABLE IF EXISTS `student`;CREATE TABLE `student` ( `student_id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(32) DEFAULT NULL, `age` int(11) DEFAULT NULL, `sex` varchar(8) DEFAULT NULL, PRIMARY KEY (`student_id`)) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4;-- ------------------------------ studentè¡¨æ•°æ®-- ----------------------------INSERT INTO `student` VALUES ('1', 'lilei', '19', 'female');INSERT INTO `student` VALUES ('2', 'huangmeimei', '18', 'male');INSERT INTO `student` VALUES ('3', 'pollu', '17', 'female');INSERT INTO `student` VALUES ('4', 'tom', '18', 'male');INSERT INTO `student` VALUES ('5', 'david', '17', 'male');INSERT INTO `student` VALUES ('6', 'lucy', '19', 'female');INSERT INTO `student` VALUES ('7', 'jacky', '20', 'male');-- ------------------------------ è¯¾ç¨‹è¡¨-- ----------------------------DROP TABLE IF EXISTS `course`;CREATE TABLE `course` ( `course_id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(20) DEFAULT NULL, PRIMARY KEY (`course_id`)) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4;-- ------------------------------ courseè¡¨æ•°æ®-- ----------------------------INSERT INTO `course` VALUES ('1', 'chinese');INSERT INTO `course` VALUES ('2', 'math');INSERT INTO `course` VALUES ('3', 'english');INSERT INTO `course` VALUES ('4', 'physics');-- ------------------------------ åˆ†æ•°è¡¨-- ----------------------------DROP TABLE IF EXISTS `score`;CREATE TABLE `score` ( `student_id` int(11) DEFAULT NULL, `course_id` int(11) DEFAULT NULL, `score` int(11) DEFAULT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;-- ------------------------------ scoreè¡¨æ•°æ®-- ----------------------------INSERT INTO `score` VALUES ('1', '2', '78');INSERT INTO `score` VALUES ('1', '3', '67');INSERT INTO `score` VALUES ('1', '4', '67');INSERT INTO `score` VALUES ('2', '1', '52');INSERT INTO `score` VALUES ('2', '2', '81');INSERT INTO `score` VALUES ('2', '3', '92');INSERT INTO `score` VALUES ('2', '4', '67');INSERT INTO `score` VALUES ('3', '1', '52');INSERT INTO `score` VALUES ('3', '2', '47');INSERT INTO `score` VALUES ('3', '3', '88');INSERT INTO `score` VALUES ('3', '4', '67');INSERT INTO `score` VALUES ('4', '2', '88');INSERT INTO `score` VALUES ('4', '3', '90');INSERT INTO `score` VALUES ('4', '4', '67');INSERT INTO `score` VALUES ('5', '1', '52');INSERT INTO `score` VALUES ('5', '3', '78');INSERT INTO `score` VALUES ('5', '4', '67');INSERT INTO `score` VALUES ('6', '1', '52');INSERT INTO `score` VALUES ('6', '2', '68');INSERT INTO `score` VALUES ('6', '4', '67');INSERT INTO `score` VALUES ('1', '1', '52');INSERT INTO `score` VALUES ('5', '2', '72');INSERT INTO `score` VALUES ('7', '2', '72'); ç¬¬ä¸€ä¸ªé—®é¢˜ æŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦å·ã€é€‰è¯¾æ•°ã€æ€»æˆç»© é’ˆå¯¹sqlé—®é¢˜ï¼Œä¸éœ€è¦ä¸€å£æ°”å…¨éƒ¨å†™å‡ºæ¥ï¼Œæˆ‘ä»¬å…ˆåˆ†è§£é€ä¸ªå‡»ç ´ï¼Œæœ€åŽå†åˆä½“ã€‚ åˆ†æžé¢˜ç›®ï¼Œä»–è¦æŸ¥è¯¢çš„æ˜¯æ¯ä¸ªå­¦ç”Ÿçš„å­¦å·ï¼Œé€‰è¯¾æ•°ï¼Œæ€»æˆç»© é‚£ä¹ˆå…ˆæŠŠå…³é”®å­—åˆ—å‡ºæ¥ï¼š 12345#é¦–å…ˆæ˜¯è¦æŸ¥è¯¢ï¼Œè‚¯å®šæœ‰selectå…³é”®å­—select#è¦æŸ¥è¯¢çš„å‡ ä¸ªå…³é”®å­—æ®µstudent_id,count(course_id),sum(score) æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ‰ä¸€äº›å‡½æ•°åœ¨é‡Œé¢ï¼Œæ¯”å¦‚countå’Œsumï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šæƒ³åˆ°ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸Žgroup byç»“åˆä½¿ç”¨çš„ã€‚ å› ä¸ºæ˜¯æŸ¥è¯¢æ¯ä¸ªå­¦ç”Ÿï¼Œé‚£ä¹ˆå¿…ç„¶æ˜¯æ ¹æ®æ¯ä¸ªå­¦ç”Ÿçš„idè¿›è¡Œåˆ†ç»„äº†ã€‚ 1group by student_id æ­¤æ—¶ï¼Œå› ä¸ºæ¶‰åŠçš„student_id,course_idä»¥åŠscoreåªéœ€è¦ä¸€å¼ scoreè¡¨å°±å¯ä»¥è§£å†³,é‚£ä¹ˆæ‹¼æŽ¥èµ·æ¥å°±æ˜¯ï¼š æˆ‘ä»¬è¿›è¡Œexplainåˆ†æžä¸€ä¸‹ï¼š 123explain SELECT student_id,count(course_id),sum(score)from scoregroup by student_id æ˜¾ç¤ºï¼š åŸºæœ¬çš„åŽŸç†å°±æ˜¯ï¼šé¦–å…ˆæ ¹æ®group byè¿›è¡Œåˆ†ç»„ï¼Œåˆ†ç»„å‡ºæ¥çš„æ•°æ®ç¼“å­˜åˆ°ä¸€å¼ ä¸´æ—¶è¡¨ä¸­ï¼Œç„¶åŽå†åšcountä¹‹ç±»çš„è®¡ç®—æ˜¾ç¤ºã€‚ å¹¶ä¸”ï¼Œæœ¬é¢˜æ˜¯é’ˆå¯¹ä¸€å¼ è¡¨ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªè§„åˆ™æ˜¯ï¼šå¦‚æžœç”¨group byï¼Œé‚£ä¹ˆä½ çš„selectè¯­å¥ä¸­é€‰å‡ºçš„åˆ—è¦ä¹ˆæ˜¯group byé‡Œç”¨åˆ°çš„åˆ—ï¼Œè¦ä¹ˆå°±æ˜¯sum minç­‰åˆ—å‡½æ•°çš„åˆ—ã€‚æ‰€ä»¥è¿™é‡Œgroup byå’ŒåŽé¢æ˜¯student_idï¼Œæ‰€ä»¥selectåŽé¢å¯ä»¥æŸ¥è¯¢student_idï¼Œä½†æ˜¯ä¸èƒ½æŸ¥è¯¢course_idç­‰å­—æ®µã€‚ ç¬¬äºŒä¸ªé—®é¢˜ æŸ¥è¯¢æ‰€æœ‰åŒå­¦çš„å­¦å·ã€å§“åã€é€‰è¯¾æ•°ã€æ€»æˆç»© æ³¨æ„è§‚å¯Ÿï¼Œå…¶å®žå°±æ˜¯æ¯”ä¸Šä¸€ä¸ªé—®é¢˜å¤šä¸€ä¸ªå­—æ®µnameï¼Œä½†æ˜¯åŒºåˆ«æ¯”è¾ƒå¤§ï¼Œå› ä¸ºä¸€å¼ scoreè¡¨å·²ç»ä¸å¤Ÿç”¨äº†ã€‚è¿™ä¸ªæ—¶å€™è¿˜éœ€è¦studentè¡¨äº†ï¼Œå³ä¸¤å¼ è¡¨è”åˆæŸ¥è¯¢ã€‚é‚£ä¹ˆåªè¦æžä¸€ä¸ªè¿žæŽ¥æ¡ä»¶å³å¯ï¼š ç¬¬ä¸‰ä¸ªé—®é¢˜ æŸ¥è¯¢å¹³å‡æˆç»©å¤§äºŽ60åˆ†çš„åŒå­¦çš„å­¦å·å’Œå¹³å‡æˆç»© æˆ‘ä»¬å†æ¥åˆ†è§£çœ‹çœ‹ï¼š 12345678#æŸ¥è¯¢è‚¯å®šç”¨åˆ°selectselect #è¦æŸ¥è¯¢çš„ä¸¤ä¸ªå­—æ®µstudent_id,avg(score) #ç”±äºŽå­˜åœ¨avgï¼Œé‚£ä¹ˆå¿…ç„¶è¦åˆ†ç»„group by student_id æœ€åŽï¼Œæœ‰ä¸€ä¸ªæ¡ä»¶æ˜¯ï¼šå¹³å‡æˆç»©å¤§äºŽ60åˆ†ï¼Œæ­¤æ—¶å°±éœ€è¦å¯¹æŸ¥è¯¢å‡ºæ¥çš„åˆ†ç»„è¿›è¡Œè¿‡æ»¤ç­›é€‰äº†ï¼Œæ­¤æ—¶havingé—ªäº®ç™»åœºã€‚ æµ‹è¯•äº†ä¸€ä¸‹ï¼Œä¸‹é¢ä¸¤æ¡sqléƒ½æ˜¯ä¸€æ ·çš„æ•ˆæžœï¼š 12select * from course where course_id = 1select * from course having course_id = 1 ç¬¬å››ä¸ªé—®é¢˜ æŸ¥è¯¢æ²¡æœ‰å­¦å…¨æ‰€æœ‰è¯¾çš„åŒå­¦çš„å­¦å·ã€å§“å è¿™ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œæˆ‘ä»¬è¿˜æ˜¯åˆ†è§£æ¥çœ‹çœ‹ï¼š 1234567891011#æŸ¥è¯¢è‚¯å®šç”¨åˆ°selectselect #è¦æŸ¥è¯¢çš„ä¸¤ä¸ªå­—æ®µstudent_id,name#ç”±äºŽå­˜åœ¨avgï¼Œé‚£ä¹ˆå¿…ç„¶è¦åˆ†ç»„group by student_id#ä¸¤å¼ è¡¨è¿žæŽ¥ï¼Œè¦èµ·ä¸ªåˆ«åwhere sc.student_id = stu.student_id å› ä¸ºéœ€è¦æŸ¥è¯¢è¯¾ç¨‹æ²¡æœ‰å­¦æ»¡çš„å­¦ç”Ÿï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹çš„æ•°é‡ï¼š 1select count(1) from course æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä½œä¸ºç»“æžœå†è¿›è¡ŒæŸ¥è¯¢ï¼Œå³å­æŸ¥è¯¢ã€‚å¯¹äºŽä¸Šé¢çš„åˆ†ç»„è¦è¿›è¡Œç­›é€‰ 1having count(sc.course_id) &lt; (select count(1) from course) æ‰€ä»¥æœ€ç»ˆçš„è¯­å¥æ˜¯ï¼š]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SQLå¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹æç‚¼]]></title>
    <url>%2F2019%2F01%2F27%2Fmysql%2FSQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯å¯¹ã€Šmysqlå¿…çŸ¥å¿…ä¼šã€‹çš„çŸ¥è¯†æç‚¼ã€‚ ä¸€ã€åŸºç¡€ æ¨¡å¼å®šä¹‰äº†æ•°æ®å¦‚ä½•å­˜å‚¨ã€å­˜å‚¨ä»€ä¹ˆæ ·çš„æ•°æ®ä»¥åŠæ•°æ®å¦‚ä½•åˆ†è§£ç­‰ä¿¡æ¯ï¼Œæ•°æ®åº“å’Œè¡¨éƒ½æœ‰æ¨¡å¼ã€‚ ä¸»é”®çš„å€¼ä¸å…è®¸ä¿®æ”¹ï¼Œä¹Ÿä¸å…è®¸å¤ç”¨ï¼ˆä¸èƒ½ä½¿ç”¨å·²ç»åˆ é™¤çš„ä¸»é”®å€¼èµ‹ç»™æ–°æ•°æ®è¡Œçš„ä¸»é”®ï¼‰ã€‚ SQLï¼ˆStructured Query Language)ï¼Œæ ‡å‡† SQL ç”± ANSI æ ‡å‡†å§”å‘˜ä¼šç®¡ç†ï¼Œä»Žè€Œç§°ä¸º ANSI SQLã€‚å„ä¸ª DBMS éƒ½æœ‰è‡ªå·±çš„å®žçŽ°ï¼Œå¦‚ PL/SQLã€Transact-SQL ç­‰ã€‚ SQL è¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯æ•°æ®åº“è¡¨åã€åˆ—åå’Œå€¼æ˜¯å¦åŒºåˆ†ä¾èµ–äºŽå…·ä½“çš„ DBMS ä»¥åŠé…ç½®ã€‚ SQL æ”¯æŒä»¥ä¸‹ä¸‰ç§æ³¨é‡Šï¼š 12345# æ³¨é‡ŠSELECT *FROM mytable; -- æ³¨é‡Š/* æ³¨é‡Š1 æ³¨é‡Š2 */ äºŒã€åˆ›å»ºè¡¨ 123456CREATE TABLE mytable ( id INT NOT NULL AUTO_INCREMENT, col1 INT NOT NULL DEFAULT 1, col2 VARCHAR(45) NULL, col3 DATE NULL, PRIMARY KEY (`id`)); ä¸‰ã€ä¿®æ”¹è¡¨ æ·»åŠ åˆ— 12ALTER TABLE mytableADD col CHAR(20); åˆ é™¤åˆ— 12ALTER TABLE mytableDROP COLUMN col; åˆ é™¤è¡¨ 1DROP TABLE mytable; å››ã€æ’å…¥ æ™®é€šæ’å…¥ 12INSERT INTO mytable(col1, col2)VALUES(val1, val2); æ’å…¥æ£€ç´¢å‡ºæ¥çš„æ•°æ® 123INSERT INTO mytable1(col1, col2)SELECT col1, col2FROM mytable2; å°†ä¸€ä¸ªè¡¨çš„å†…å®¹æ’å…¥åˆ°ä¸€ä¸ªæ–°è¡¨ 12CREATE TABLE newtable ASSELECT * FROM mytable; äº”ã€æ›´æ–° 123UPDATE mytableSET col = valWHERE id = 1; å…­ã€åˆ é™¤ 12DELETE FROM mytableWHERE id = 1; TRUNCATE TABLE å¯ä»¥æ¸…ç©ºè¡¨ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤æ‰€æœ‰è¡Œã€‚ 1TRUNCATE TABLE mytable; ä½¿ç”¨æ›´æ–°å’Œåˆ é™¤æ“ä½œæ—¶ä¸€å®šè¦ç”¨ WHERE å­å¥ï¼Œä¸ç„¶ä¼šæŠŠæ•´å¼ è¡¨çš„æ•°æ®éƒ½ç ´åã€‚å¯ä»¥å…ˆç”¨ SELECT è¯­å¥è¿›è¡Œæµ‹è¯•ï¼Œé˜²æ­¢é”™è¯¯åˆ é™¤ã€‚ ä¸ƒã€æŸ¥è¯¢ DISTINCT ç›¸åŒå€¼åªä¼šå‡ºçŽ°ä¸€æ¬¡ã€‚å®ƒä½œç”¨äºŽæ‰€æœ‰åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰åˆ—çš„å€¼éƒ½ç›¸åŒæ‰ç®—ç›¸åŒã€‚ 12SELECT DISTINCT col1, col2FROM mytable; LIMIT é™åˆ¶è¿”å›žçš„è¡Œæ•°ã€‚å¯ä»¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ·å§‹è¡Œï¼Œä»Ž 0 å¼€å§‹ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿”å›žçš„æ€»è¡Œæ•°ã€‚ è¿”å›žå‰ 5 è¡Œï¼š 123SELECT *FROM mytableLIMIT 5; 123SELECT *FROM mytableLIMIT 0, 5; è¿”å›žç¬¬ 3 ~ 5 è¡Œï¼š 123SELECT *FROM mytableLIMIT 2, 3; å…«ã€æŽ’åº ASC ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰ DESC ï¼šé™åº å¯ä»¥æŒ‰å¤šä¸ªåˆ—è¿›è¡ŒæŽ’åºï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªåˆ—æŒ‡å®šä¸åŒçš„æŽ’åºæ–¹å¼ï¼š 123SELECT *FROM mytableORDER BY col1 DESC, col2 ASC; ä¹ã€è¿‡æ»¤ ä¸è¿›è¡Œè¿‡æ»¤çš„æ•°æ®éžå¸¸å¤§ï¼Œå¯¼è‡´é€šè¿‡ç½‘ç»œä¼ è¾“äº†å¤šä½™çš„æ•°æ®ï¼Œä»Žè€Œæµªè´¹äº†ç½‘ç»œå¸¦å®½ã€‚å› æ­¤å°½é‡ä½¿ç”¨ SQL è¯­å¥æ¥è¿‡æ»¤ä¸å¿…è¦çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¼ è¾“æ‰€æœ‰çš„æ•°æ®åˆ°å®¢æˆ·ç«¯ä¸­ç„¶åŽç”±å®¢æˆ·ç«¯è¿›è¡Œè¿‡æ»¤ã€‚ 123SELECT *FROM mytableWHERE col IS NULL; ä¸‹è¡¨æ˜¾ç¤ºäº† WHERE å­å¥å¯ç”¨çš„æ“ä½œç¬¦ æ“ä½œç¬¦ è¯´æ˜Ž = ç­‰äºŽ &lt; å°äºŽ &gt; å¤§äºŽ &lt;&gt; != ä¸ç­‰äºŽ &lt;= !&gt; å°äºŽç­‰äºŽ &gt;= !&lt; å¤§äºŽç­‰äºŽ BETWEEN åœ¨ä¸¤ä¸ªå€¼ä¹‹é—´ IS NULL ä¸º NULL å€¼ åº”è¯¥æ³¨æ„åˆ°ï¼ŒNULL ä¸Ž 0ã€ç©ºå­—ç¬¦ä¸²éƒ½ä¸åŒã€‚ AND å’Œ OR ç”¨äºŽè¿žæŽ¥å¤šä¸ªè¿‡æ»¤æ¡ä»¶ã€‚ä¼˜å…ˆå¤„ç† ANDï¼Œå½“ä¸€ä¸ªè¿‡æ»¤è¡¨è¾¾å¼æ¶‰åŠåˆ°å¤šä¸ª AND å’Œ OR æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ () æ¥å†³å®šä¼˜å…ˆçº§ï¼Œä½¿å¾—ä¼˜å…ˆçº§å…³ç³»æ›´æ¸…æ™°ã€‚ IN æ“ä½œç¬¦ç”¨äºŽåŒ¹é…ä¸€ç»„å€¼ï¼Œå…¶åŽä¹Ÿå¯ä»¥æŽ¥ä¸€ä¸ª SELECT å­å¥ï¼Œä»Žè€ŒåŒ¹é…å­æŸ¥è¯¢å¾—åˆ°çš„ä¸€ç»„å€¼ã€‚ NOT æ“ä½œç¬¦ç”¨äºŽå¦å®šä¸€ä¸ªæ¡ä»¶ã€‚ åã€é€šé…ç¬¦ é€šé…ç¬¦ä¹Ÿæ˜¯ç”¨åœ¨è¿‡æ»¤è¯­å¥ä¸­ï¼Œä½†å®ƒåªèƒ½ç”¨äºŽæ–‡æœ¬å­—æ®µã€‚ % åŒ¹é… &gt;=0 ä¸ªä»»æ„å­—ç¬¦ï¼› \_ åŒ¹é… ==1 ä¸ªä»»æ„å­—ç¬¦ï¼› [ ] å¯ä»¥åŒ¹é…é›†åˆå†…çš„å­—ç¬¦ï¼Œä¾‹å¦‚ [ab] å°†åŒ¹é…å­—ç¬¦ a æˆ–è€… bã€‚ç”¨è„±å­—ç¬¦ ^ å¯ä»¥å¯¹å…¶è¿›è¡Œå¦å®šï¼Œä¹Ÿå°±æ˜¯ä¸åŒ¹é…é›†åˆå†…çš„å­—ç¬¦ã€‚ ä½¿ç”¨ Like æ¥è¿›è¡Œé€šé…ç¬¦åŒ¹é…ã€‚ 123SELECT *FROM mytableWHERE col LIKE '[^AB]%'; -- ä¸ä»¥ A å’Œ B å¼€å¤´çš„ä»»æ„æ–‡æœ¬ ä¸è¦æ»¥ç”¨é€šé…ç¬¦ï¼Œé€šé…ç¬¦ä½äºŽå¼€å¤´å¤„åŒ¹é…ä¼šéžå¸¸æ…¢ã€‚ åä¸€ã€è®¡ç®—å­—æ®µ åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šå®Œæˆæ•°æ®çš„è½¬æ¢å’Œæ ¼å¼åŒ–çš„å·¥ä½œå¾€å¾€æ¯”å®¢æˆ·ç«¯ä¸Šå¿«å¾—å¤šï¼Œå¹¶ä¸”è½¬æ¢å’Œæ ¼å¼åŒ–åŽçš„æ•°æ®é‡æ›´å°‘çš„è¯å¯ä»¥å‡å°‘ç½‘ç»œé€šä¿¡é‡ã€‚ è®¡ç®—å­—æ®µé€šå¸¸éœ€è¦ä½¿ç”¨ AS æ¥å–åˆ«åï¼Œå¦åˆ™è¾“å‡ºçš„æ—¶å€™å­—æ®µåä¸ºè®¡ç®—è¡¨è¾¾å¼ã€‚ 12SELECT col1 * col2 AS aliasFROM mytable; CONCAT() ç”¨äºŽè¿žæŽ¥ä¸¤ä¸ªå­—æ®µã€‚è®¸å¤šæ•°æ®åº“ä¼šä½¿ç”¨ç©ºæ ¼æŠŠä¸€ä¸ªå€¼å¡«å……ä¸ºåˆ—å®½ï¼Œå› æ­¤è¿žæŽ¥çš„ç»“æžœä¼šå‡ºçŽ°ä¸€äº›ä¸å¿…è¦çš„ç©ºæ ¼ï¼Œä½¿ç”¨ TRIM() å¯ä»¥åŽ»é™¤é¦–å°¾ç©ºæ ¼ã€‚ 12SELECT CONCAT(TRIM(col1), '(', TRIM(col2), ')') AS concat_colFROM mytable; åäºŒã€å‡½æ•° æ±‡æ€» å‡½ æ•° è¯´ æ˜Ž AVG() è¿”å›žæŸåˆ—çš„å¹³å‡å€¼ COUNT() è¿”å›žæŸåˆ—çš„è¡Œæ•° MAX() è¿”å›žæŸåˆ—çš„æœ€å¤§å€¼ MIN() è¿”å›žæŸåˆ—çš„æœ€å°å€¼ SUM() è¿”å›žæŸåˆ—å€¼ä¹‹å’Œ AVG() ä¼šå¿½ç•¥ NULL è¡Œã€‚ ä½¿ç”¨ DISTINCT å¯ä»¥è®©æ±‡æ€»å‡½æ•°å€¼æ±‡æ€»ä¸åŒçš„å€¼ã€‚ 12SELECT AVG(DISTINCT col1) AS avg_colFROM mytable; æ–‡æœ¬å¤„ç† å‡½æ•° è¯´æ˜Ž LEFT() å·¦è¾¹çš„å­—ç¬¦ RIGHT() å³è¾¹çš„å­—ç¬¦ LOWER() è½¬æ¢ä¸ºå°å†™å­—ç¬¦ UPPER() è½¬æ¢ä¸ºå¤§å†™å­—ç¬¦ LTRIM() åŽ»é™¤å·¦è¾¹çš„ç©ºæ ¼ RTRIM() åŽ»é™¤å³è¾¹çš„ç©ºæ ¼ LENGTH() é•¿åº¦ SOUNDEX() è½¬æ¢ä¸ºè¯­éŸ³å€¼ å…¶ä¸­ï¼Œ SOUNDEX() å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å…¶è¯­éŸ³è¡¨ç¤ºçš„å­—æ¯æ•°å­—æ¨¡å¼ã€‚ 123SELECT *FROM mytableWHERE SOUNDEX(col1) = SOUNDEX('apple') æ—¥æœŸå’Œæ—¶é—´å¤„ç† æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DD æ—¶é—´æ ¼å¼ï¼šHH:MM:SS å‡½ æ•° è¯´ æ˜Ž AddDate() å¢žåŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰ AddTime() å¢žåŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰ CurDate() è¿”å›žå½“å‰æ—¥æœŸ CurTime() è¿”å›žå½“å‰æ—¶é—´ Date() è¿”å›žæ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ† DateDiff() è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·® Date_Add() é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•° Date_Format() è¿”å›žä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸² Day() è¿”å›žä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ† DayOfWeek() å¯¹äºŽä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›žå¯¹åº”çš„æ˜ŸæœŸå‡  Hour() è¿”å›žä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ† Minute() è¿”å›žä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ† Month() è¿”å›žä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ† Now() è¿”å›žå½“å‰æ—¥æœŸå’Œæ—¶é—´ Second() è¿”å›žä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ† Time() è¿”å›žä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ† Year() è¿”å›žä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ† 1mysql&gt; SELECT NOW(); 12018-4-14 20:25:11 æ•°å€¼å¤„ç† å‡½æ•° è¯´æ˜Ž SIN() æ­£å¼¦ COS() ä½™å¼¦ TAN() æ­£åˆ‡ ABS() ç»å¯¹å€¼ SQRT() å¹³æ–¹æ ¹ MOD() ä½™æ•° EXP() æŒ‡æ•° PI() åœ†å‘¨çŽ‡ RAND() éšæœºæ•° åä¸‰ã€åˆ†ç»„ åˆ†ç»„å°±æ˜¯æŠŠå…·æœ‰ç›¸åŒçš„æ•°æ®å€¼çš„è¡Œæ”¾åœ¨åŒä¸€ç»„ä¸­ã€‚ å¯ä»¥å¯¹åŒä¸€åˆ†ç»„æ•°æ®ä½¿ç”¨æ±‡æ€»å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æ±‚åˆ†ç»„æ•°æ®çš„å¹³å‡å€¼ç­‰ã€‚ æŒ‡å®šçš„åˆ†ç»„å­—æ®µé™¤äº†èƒ½æŒ‰è¯¥å­—æ®µè¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿä¼šè‡ªåŠ¨æŒ‰è¯¥å­—æ®µè¿›è¡ŒæŽ’åºã€‚ 123SELECT col, COUNT(*) AS numFROM mytableGROUP BY col; GROUP BY è‡ªåŠ¨æŒ‰åˆ†ç»„å­—æ®µè¿›è¡ŒæŽ’åºï¼ŒORDER BY ä¹Ÿå¯ä»¥æŒ‰æ±‡æ€»å­—æ®µæ¥è¿›è¡ŒæŽ’åºã€‚ 1234SELECT col, COUNT(*) AS numFROM mytableGROUP BY colORDER BY num; WHERE è¿‡æ»¤è¡Œï¼ŒHAVING è¿‡æ»¤åˆ†ç»„ï¼Œè¡Œè¿‡æ»¤åº”å½“å…ˆäºŽåˆ†ç»„è¿‡æ»¤ã€‚ 12345SELECT col, COUNT(*) AS numFROM mytableWHERE col &gt; 2GROUP BY colHAVING num &gt;= 2; åˆ†ç»„è§„å®šï¼š GROUP BY å­å¥å‡ºçŽ°åœ¨ WHERE å­å¥ä¹‹åŽï¼ŒORDER BY å­å¥ä¹‹å‰ï¼› é™¤äº†æ±‡æ€»å­—æ®µå¤–ï¼ŒSELECT è¯­å¥ä¸­çš„æ¯ä¸€å­—æ®µéƒ½å¿…é¡»åœ¨ GROUP BY å­å¥ä¸­ç»™å‡ºï¼› NULL çš„è¡Œä¼šå•ç‹¬åˆ†ä¸ºä¸€ç»„ï¼› å¤§å¤šæ•° SQL å®žçŽ°ä¸æ”¯æŒ GROUP BY åˆ—å…·æœ‰å¯å˜é•¿åº¦çš„æ•°æ®ç±»åž‹ã€‚ åå››ã€å­æŸ¥è¯¢ å­æŸ¥è¯¢ä¸­åªèƒ½è¿”å›žä¸€ä¸ªå­—æ®µçš„æ•°æ®ã€‚ å¯ä»¥å°†å­æŸ¥è¯¢çš„ç»“æžœä½œä¸º WHRER è¯­å¥çš„è¿‡æ»¤æ¡ä»¶ï¼š 1234SELECT *FROM mytable1WHERE col1 IN (SELECT col2 FROM mytable2); ä¸‹é¢çš„è¯­å¥å¯ä»¥æ£€ç´¢å‡ºå®¢æˆ·çš„è®¢å•æ•°é‡ï¼Œå­æŸ¥è¯¢è¯­å¥ä¼šå¯¹ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ£€ç´¢å‡ºçš„æ¯ä¸ªå®¢æˆ·æ‰§è¡Œä¸€æ¬¡ï¼š 123456SELECT cust_name, (SELECT COUNT(*) FROM Orders WHERE Orders.cust_id = Customers.cust_id) AS orders_numFROM CustomersORDER BY cust_name; åäº”ã€è¿žæŽ¥ è¿žæŽ¥ç”¨äºŽè¿žæŽ¥å¤šä¸ªè¡¨ï¼Œä½¿ç”¨ JOIN å…³é”®å­—ï¼Œå¹¶ä¸”æ¡ä»¶è¯­å¥ä½¿ç”¨ ON è€Œä¸æ˜¯ WHEREã€‚ è¿žæŽ¥å¯ä»¥æ›¿æ¢å­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ¯”å­æŸ¥è¯¢çš„æ•ˆçŽ‡ä¸€èˆ¬ä¼šæ›´å¿«ã€‚ å¯ä»¥ç”¨ AS ç»™åˆ—åã€è®¡ç®—å­—æ®µå’Œè¡¨åå–åˆ«åï¼Œç»™è¡¨åå–åˆ«åæ˜¯ä¸ºäº†ç®€åŒ– SQL è¯­å¥ä»¥åŠè¿žæŽ¥ç›¸åŒè¡¨ã€‚ å†…è¿žæŽ¥ å†…è¿žæŽ¥åˆç§°ç­‰å€¼è¿žæŽ¥ï¼Œä½¿ç”¨ INNER JOIN å…³é”®å­—ã€‚ 123SELECT A.value, B.valueFROM tablea AS A INNER JOIN tableb AS BON A.key = B.key; å¯ä»¥ä¸æ˜Žç¡®ä½¿ç”¨ INNER JOINï¼Œè€Œä½¿ç”¨æ™®é€šæŸ¥è¯¢å¹¶åœ¨ WHERE ä¸­å°†ä¸¤ä¸ªè¡¨ä¸­è¦è¿žæŽ¥çš„åˆ—ç”¨ç­‰å€¼æ–¹æ³•è¿žæŽ¥èµ·æ¥ã€‚ 123SELECT A.value, B.valueFROM tablea AS A, tableb AS BWHERE A.key = B.key; åœ¨æ²¡æœ‰æ¡ä»¶è¯­å¥çš„æƒ…å†µä¸‹è¿”å›žç¬›å¡å°”ç§¯ã€‚ è‡ªè¿žæŽ¥ è‡ªè¿žæŽ¥å¯ä»¥çœ‹æˆå†…è¿žæŽ¥çš„ä¸€ç§ï¼Œåªæ˜¯è¿žæŽ¥çš„è¡¨æ˜¯è‡ªèº«è€Œå·²ã€‚ ä¸€å¼ å‘˜å·¥è¡¨ï¼ŒåŒ…å«å‘˜å·¥å§“åå’Œå‘˜å·¥æ‰€å±žéƒ¨é—¨ï¼Œè¦æ‰¾å‡ºä¸Ž Jim å¤„åœ¨åŒä¸€éƒ¨é—¨çš„æ‰€æœ‰å‘˜å·¥å§“åã€‚ å­æŸ¥è¯¢ç‰ˆæœ¬ 123456SELECT nameFROM employeeWHERE department = ( SELECT department FROM employee WHERE name = "Jim"); è‡ªè¿žæŽ¥ç‰ˆæœ¬ 1234SELECT e1.nameFROM employee AS e1 INNER JOIN employee AS e2ON e1.department = e2.department AND e2.name = "Jim"; è‡ªç„¶è¿žæŽ¥ è‡ªç„¶è¿žæŽ¥æ˜¯æŠŠåŒååˆ—é€šè¿‡ç­‰å€¼æµ‹è¯•è¿žæŽ¥èµ·æ¥çš„ï¼ŒåŒååˆ—å¯ä»¥æœ‰å¤šä¸ªã€‚ å†…è¿žæŽ¥å’Œè‡ªç„¶è¿žæŽ¥çš„åŒºåˆ«ï¼šå†…è¿žæŽ¥æä¾›è¿žæŽ¥çš„åˆ—ï¼Œè€Œè‡ªç„¶è¿žæŽ¥è‡ªåŠ¨è¿žæŽ¥æ‰€æœ‰åŒååˆ—ã€‚ 12SELECT A.value, B.valueFROM tablea AS A NATURAL JOIN tableb AS B; å¤–è¿žæŽ¥ å¤–è¿žæŽ¥ä¿ç•™äº†æ²¡æœ‰å…³è”çš„é‚£äº›è¡Œã€‚åˆ†ä¸ºå·¦å¤–è¿žæŽ¥ï¼Œå³å¤–è¿žæŽ¥ä»¥åŠå…¨å¤–è¿žæŽ¥ï¼Œå·¦å¤–è¿žæŽ¥å°±æ˜¯ä¿ç•™å·¦è¡¨æ²¡æœ‰å…³è”çš„è¡Œã€‚ æ£€ç´¢æ‰€æœ‰é¡¾å®¢çš„è®¢å•ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿˜æ²¡æœ‰è®¢å•ä¿¡æ¯çš„é¡¾å®¢ã€‚ 123SELECT Customers.cust_id, Orders.order_numFROM Customers LEFT OUTER JOIN OrdersON Customers.cust_id = Orders.cust_id; customers è¡¨ï¼š cust_id cust_name 1 a 2 b 3 c orders è¡¨ï¼š order_id cust_id 1 1 2 1 3 3 4 3 ç»“æžœï¼š cust_id cust_name order_id 1 a 1 1 a 2 3 c 3 3 c 4 2 b Null åå…­ã€ç»„åˆæŸ¥è¯¢ ä½¿ç”¨ UNION æ¥ç»„åˆä¸¤ä¸ªæŸ¥è¯¢ï¼Œå¦‚æžœç¬¬ä¸€ä¸ªæŸ¥è¯¢è¿”å›ž M è¡Œï¼Œç¬¬äºŒä¸ªæŸ¥è¯¢è¿”å›ž N è¡Œï¼Œé‚£ä¹ˆç»„åˆæŸ¥è¯¢çš„ç»“æžœä¸€èˆ¬ä¸º M+N è¡Œã€‚ æ¯ä¸ªæŸ¥è¯¢å¿…é¡»åŒ…å«ç›¸åŒçš„åˆ—ã€è¡¨è¾¾å¼å’Œèšé›†å‡½æ•°ã€‚ é»˜è®¤ä¼šåŽ»é™¤ç›¸åŒè¡Œï¼Œå¦‚æžœéœ€è¦ä¿ç•™ç›¸åŒè¡Œï¼Œä½¿ç”¨ UNION ALLã€‚ åªèƒ½åŒ…å«ä¸€ä¸ª ORDER BY å­å¥ï¼Œå¹¶ä¸”å¿…é¡»ä½äºŽè¯­å¥çš„æœ€åŽã€‚ 1234567SELECT colFROM mytableWHERE col = 1UNIONSELECT colFROM mytableWHERE col =2; åä¸ƒã€è§†å›¾ è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œä¹Ÿå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œç´¢å¼•æ“ä½œã€‚ å¯¹è§†å›¾çš„æ“ä½œå’Œå¯¹æ™®é€šè¡¨çš„æ“ä½œä¸€æ ·ã€‚ è§†å›¾å…·æœ‰å¦‚ä¸‹å¥½å¤„ï¼š ç®€åŒ–å¤æ‚çš„ SQL æ“ä½œï¼Œæ¯”å¦‚å¤æ‚çš„è¿žæŽ¥ï¼› åªä½¿ç”¨å®žé™…è¡¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼› é€šè¿‡åªç»™ç”¨æˆ·è®¿é—®è§†å›¾çš„æƒé™ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼› æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚ 1234CREATE VIEW myview ASSELECT Concat(col1, col2) AS concat_col, col3*col4 AS compute_colFROM mytableWHERE col5 = val; åå…«ã€å­˜å‚¨è¿‡ç¨‹ å­˜å‚¨è¿‡ç¨‹å¯ä»¥çœ‹æˆæ˜¯å¯¹ä¸€ç³»åˆ— SQL æ“ä½œçš„æ‰¹å¤„ç†ï¼› ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„ï¼š ä»£ç å°è£…ï¼Œä¿è¯äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼› ä»£ç å¤ç”¨ï¼› ç”±äºŽæ˜¯é¢„å…ˆç¼–è¯‘ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚ å‘½ä»¤è¡Œä¸­åˆ›å»ºå­˜å‚¨è¿‡ç¨‹éœ€è¦è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œå› ä¸ºå‘½ä»¤è¡Œæ˜¯ä»¥ ; ä¸ºç»“æŸç¬¦ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¹ŸåŒ…å«äº†åˆ†å·ï¼Œå› æ­¤ä¼šé”™è¯¯æŠŠè¿™éƒ¨åˆ†åˆ†å·å½“æˆæ˜¯ç»“æŸç¬¦ï¼Œé€ æˆè¯­æ³•é”™è¯¯ã€‚ åŒ…å« inã€out å’Œ inout ä¸‰ç§å‚æ•°ã€‚ ç»™å˜é‡èµ‹å€¼éƒ½éœ€è¦ç”¨ select into è¯­å¥ã€‚ æ¯æ¬¡åªèƒ½ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œä¸æ”¯æŒé›†åˆçš„æ“ä½œã€‚ 123456789101112delimiter //create procedure myprocedure( out ret int ) begin declare y int; select sum(col1) from mytable into y; select y*y into ret; end //delimiter ; 12call myprocedure(@ret);select @ret; åä¹ã€æ¸¸æ ‡ åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨æ¸¸æ ‡å¯ä»¥å¯¹ä¸€ä¸ªç»“æžœé›†è¿›è¡Œç§»åŠ¨éåŽ†ã€‚ æ¸¸æ ‡ä¸»è¦ç”¨äºŽäº¤äº’å¼åº”ç”¨ï¼Œå…¶ä¸­ç”¨æˆ·éœ€è¦å¯¹æ•°æ®é›†ä¸­çš„ä»»æ„è¡Œè¿›è¡Œæµè§ˆå’Œä¿®æ”¹ã€‚ ä½¿ç”¨æ¸¸æ ‡çš„å››ä¸ªæ­¥éª¤ï¼š å£°æ˜Žæ¸¸æ ‡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰å®žé™…æ£€ç´¢å‡ºæ•°æ®ï¼› æ‰“å¼€æ¸¸æ ‡ï¼› å–å‡ºæ•°æ®ï¼› å…³é—­æ¸¸æ ‡ï¼› 1234567891011121314151617181920delimiter //create procedure myprocedure(out ret int) begin declare done boolean default 0; declare mycursor cursor for select col1 from mytable; # å®šä¹‰äº†ä¸€ä¸ª continue handlerï¼Œå½“ sqlstate '02000' è¿™ä¸ªæ¡ä»¶å‡ºçŽ°æ—¶ï¼Œä¼šæ‰§è¡Œ set done = 1 declare continue handler for sqlstate '02000' set done = 1; open mycursor; repeat fetch mycursor into ret; select ret; until done end repeat; close mycursor; end // delimiter ; äºŒåã€è§¦å‘å™¨ è§¦å‘å™¨ä¼šåœ¨æŸä¸ªè¡¨æ‰§è¡Œä»¥ä¸‹è¯­å¥æ—¶è€Œè‡ªåŠ¨æ‰§è¡Œï¼šDELETEã€INSERTã€UPDATEã€‚ è§¦å‘å™¨å¿…é¡»æŒ‡å®šåœ¨è¯­å¥æ‰§è¡Œä¹‹å‰è¿˜æ˜¯ä¹‹åŽè‡ªåŠ¨æ‰§è¡Œï¼Œä¹‹å‰æ‰§è¡Œä½¿ç”¨ BEFORE å…³é”®å­—ï¼Œä¹‹åŽæ‰§è¡Œä½¿ç”¨ AFTER å…³é”®å­—ã€‚BEFORE ç”¨äºŽæ•°æ®éªŒè¯å’Œå‡€åŒ–ï¼ŒAFTER ç”¨äºŽå®¡è®¡è·Ÿè¸ªï¼Œå°†ä¿®æ”¹è®°å½•åˆ°å¦å¤–ä¸€å¼ è¡¨ä¸­ã€‚ INSERT è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º NEW çš„è™šæ‹Ÿè¡¨ã€‚ 1234CREATE TRIGGER mytrigger AFTER INSERT ON mytableFOR EACH ROW SELECT NEW.col into @result;SELECT @result; -- èŽ·å–ç»“æžœ DELETE è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œå¹¶ä¸”æ˜¯åªè¯»çš„ã€‚ UPDATE è§¦å‘å™¨åŒ…å«ä¸€ä¸ªåä¸º NEW å’Œä¸€ä¸ªåä¸º OLD çš„è™šæ‹Ÿè¡¨ï¼Œå…¶ä¸­ NEW æ˜¯å¯ä»¥è¢«ä¿®æ”¹åœ°ï¼Œè€Œ OLD æ˜¯åªè¯»çš„ã€‚ MySQL ä¸å…è®¸åœ¨è§¦å‘å™¨ä¸­ä½¿ç”¨ CALL è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚ äºŒåä¸€ã€äº‹åŠ¡å¤„ç† åŸºæœ¬æœ¯è¯­ï¼š äº‹åŠ¡ï¼ˆtransactionï¼‰æŒ‡ä¸€ç»„ SQL è¯­å¥ï¼› å›žé€€ï¼ˆrollbackï¼‰æŒ‡æ’¤é”€æŒ‡å®š SQL è¯­å¥çš„è¿‡ç¨‹ï¼› æäº¤ï¼ˆcommitï¼‰æŒ‡å°†æœªå­˜å‚¨çš„ SQL è¯­å¥ç»“æžœå†™å…¥æ•°æ®åº“è¡¨ï¼› ä¿ç•™ç‚¹ï¼ˆsavepointï¼‰æŒ‡äº‹åŠ¡å¤„ç†ä¸­è®¾ç½®çš„ä¸´æ—¶å ä½ç¬¦ï¼ˆplaceholderï¼‰ï¼Œä½ å¯ä»¥å¯¹å®ƒå‘å¸ƒå›žé€€ï¼ˆä¸Žå›žé€€æ•´ä¸ªäº‹åŠ¡å¤„ç†ä¸åŒï¼‰ã€‚ ä¸èƒ½å›žé€€ SELECT è¯­å¥ï¼Œå›žé€€ SELECT è¯­å¥ä¹Ÿæ²¡æ„ä¹‰ï¼›ä¹Ÿä¸èƒ½å›žé€€ CREATE å’Œ DROP è¯­å¥ã€‚ MySQL çš„äº‹åŠ¡æäº¤é»˜è®¤æ˜¯éšå¼æäº¤ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥å°±æŠŠè¿™æ¡è¯­å¥å½“æˆä¸€ä¸ªäº‹åŠ¡ç„¶åŽè¿›è¡Œæäº¤ã€‚å½“å‡ºçŽ° START TRANSACTION è¯­å¥æ—¶ï¼Œä¼šå…³é—­éšå¼æäº¤ï¼›å½“ COMMIT æˆ– ROLLBACK è¯­å¥æ‰§è¡ŒåŽï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å…³é—­ï¼Œé‡æ–°æ¢å¤éšå¼æäº¤ã€‚ é€šè¿‡è®¾ç½® autocommit ä¸º 0 å¯ä»¥å–æ¶ˆè‡ªåŠ¨æäº¤ï¼Œç›´åˆ° autocommit è¢«è®¾ç½®ä¸º 1 æ‰ä¼šæäº¤ï¼›autocommit æ ‡è®°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿žæŽ¥è€Œä¸æ˜¯é’ˆå¯¹æœåŠ¡å™¨çš„ã€‚ å¦‚æžœæ²¡æœ‰è®¾ç½®ä¿ç•™ç‚¹ï¼ŒROLLBACK ä¼šå›žé€€åˆ° START TRANSACTION è¯­å¥å¤„ï¼›å¦‚æžœè®¾ç½®äº†ä¿ç•™ç‚¹ï¼Œå¹¶ä¸”åœ¨ ROLLBACK ä¸­æŒ‡å®šè¯¥ä¿ç•™ç‚¹ï¼Œåˆ™ä¼šå›žé€€åˆ°è¯¥ä¿ç•™ç‚¹ã€‚ 1234567START TRANSACTION// ...SAVEPOINT delete1// ...ROLLBACK TO delete1// ...COMMIT äºŒåäºŒã€å­—ç¬¦é›† åŸºæœ¬æœ¯è¯­ï¼š å­—ç¬¦é›†ä¸ºå­—æ¯å’Œç¬¦å·çš„é›†åˆï¼› ç¼–ç ä¸ºæŸä¸ªå­—ç¬¦é›†æˆå‘˜çš„å†…éƒ¨è¡¨ç¤ºï¼› æ ¡å¯¹å­—ç¬¦æŒ‡å®šå¦‚ä½•æ¯”è¾ƒï¼Œä¸»è¦ç”¨äºŽæŽ’åºå’Œåˆ†ç»„ã€‚ é™¤äº†ç»™è¡¨æŒ‡å®šå­—ç¬¦é›†å’Œæ ¡å¯¹å¤–ï¼Œä¹Ÿå¯ä»¥ç»™åˆ—æŒ‡å®šï¼š 123CREATE TABLE mytable(col VARCHAR(10) CHARACTER SET latin COLLATE latin1_general_ci )DEFAULT CHARACTER SET hebrew COLLATE hebrew_general_ci; å¯ä»¥åœ¨æŽ’åºã€åˆ†ç»„æ—¶æŒ‡å®šæ ¡å¯¹ï¼š 123SELECT *FROM mytableORDER BY col COLLATE latin1_general_ci; äºŒåä¸‰ã€æƒé™ç®¡ç† MySQL çš„è´¦æˆ·ä¿¡æ¯ä¿å­˜åœ¨ mysql è¿™ä¸ªæ•°æ®åº“ä¸­ã€‚ 12USE mysql;SELECT user FROM user; åˆ›å»ºè´¦æˆ· 1CREATE USER myuser IDENTIFIED BY 'mypassword'; æ–°åˆ›å»ºçš„è´¦æˆ·æ²¡æœ‰ä»»ä½•æƒé™ã€‚ ä¿®æ”¹è´¦æˆ·å 1RENAME myuser TO newuser; åˆ é™¤è´¦æˆ· 1DROP USER myuser; æŸ¥çœ‹æƒé™ 1SHOW GRANTS FOR myuser; æŽˆäºˆæƒé™ 1GRANT SELECT, INSERT ON mydatabase.* TO myuser; è´¦æˆ·ç”¨ username@host çš„å½¢å¼å®šä¹‰ï¼Œusername@% ä½¿ç”¨çš„æ˜¯é»˜è®¤ä¸»æœºåã€‚ åˆ é™¤æƒé™ 1REVOKE SELECT, INSERT ON mydatabase.* FROM myuser; GRANT å’Œ REVOKE å¯åœ¨å‡ ä¸ªå±‚æ¬¡ä¸ŠæŽ§åˆ¶è®¿é—®æƒé™ï¼š æ•´ä¸ªæœåŠ¡å™¨ï¼Œä½¿ç”¨ GRANT ALL å’Œ REVOKE ALLï¼› æ•´ä¸ªæ•°æ®åº“ï¼Œä½¿ç”¨ ON database.\*ï¼› ç‰¹å®šçš„è¡¨ï¼Œä½¿ç”¨ ON database.tableï¼› ç‰¹å®šçš„åˆ—ï¼› ç‰¹å®šçš„å­˜å‚¨è¿‡ç¨‹ã€‚ æ›´æ”¹å¯†ç  å¿…é¡»ä½¿ç”¨ Password() å‡½æ•° 1SET PASSWROD FOR myuser = Password('new_password'); è½¬è‡ªï¼š SQL]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“äº‹åŠ¡æ ¸å¿ƒé—®é¢˜]]></title>
    <url>%2F2019%2F01%2F27%2Fmysql%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»Žäº‹åŠ¡å¼•å‡ºäº†Mysql InnoDB RRéš”ç¦»çº§åˆ«ä¸‹æ˜¯å¦‚ä½•é˜²æ­¢å¹»è¯»çš„ã€‚ 1. æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ æœ€é‡è¦çš„æ˜¯ACIDç‰¹æ€§ã€‚ åŽŸå­æ€§(Atomicity)ï¼šäº‹åŠ¡è¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥ ä¸€è‡´æ€§(Consistency)ï¼šå…³ç³»åž‹æ•°æ®åº“æœ‰å¾ˆå¤šçº¦æŸï¼Œäº‹åŠ¡å‰åŽéƒ½è¦æ»¡è¶³è¿™äº›çº¦æŸ(ä¸ä»…ä»…æ˜¯æ•°æ®åº“ç‰©ç†çº¦æŸï¼Œè¿˜åŒ…æ‹¬å†…éƒ¨é€»è¾‘ä¸Šçš„ä¸€äº›å‡è®¾) éš”ç¦»æ€§(Isolation)ï¼šä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç‹¬ç«‹ï¼Œä¸èƒ½äº’ç›¸å¹²æ‰° æŒä¹…æ€§(Durability)ï¼šäº‹åŠ¡æ‰§è¡ŒæˆåŠŸä¹‹åŽç»“æžœå¯ä»¥æŒä¹…åŒ–ï¼Œæ°¸ä¹…å­˜å‚¨ä¸‹æ¥(redoæ—¥å¿—) å¯¹äºŽä¸€è‡´æ€§ï¼Œå¯èƒ½è§£é‡Šæ¯”è¾ƒæŠ½è±¡ï¼Œä»–çš„å®žé™…å«ä¹‰æ˜¯ï¼šæ•°æ®åº“çš„æ•°æ®åº”æ»¡è¶³å®Œæ•´æ€§çº¦æŸã€‚æ‹¿è½¬è´¦ä¸šåŠ¡æ¥è¯´ï¼Œå‡è®¾ç”¨æˆ·Aå’Œç”¨æˆ·Bä¸€å…±æœ‰2000å—é’±ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´æ— è®ºå¦‚ä½•è½¬è´¦ï¼Œæ€»å…±çš„é’±åº”è¯¥éƒ½æ˜¯2000. 2. äº‹åŠ¡å¹¶å‘è®¿é—®å¼•èµ·çš„é—®é¢˜ æ›´æ–°ä¸¢å¤±-mysqlæ‰€æœ‰äº‹åŠ¡éš”ç¦»çº§åˆ«åœ¨æ•°æ®åº“å±‚é¢å‡å¯é¿å… å–æ¬¾äº‹åŠ¡ å­˜æ¬¾äº‹åŠ¡ å¼€å§‹äº‹åŠ¡ å¼€å§‹äº‹åŠ¡ æŸ¥è¯¢ä½™é¢ä¸º100å…ƒ æ—  æ—  æŸ¥è¯¢ä½™é¢ä¸º100å…ƒ æ—  å­˜å…¥20ï¼Œä½™é¢å˜ä¸º120å…ƒ æ—  æäº¤äº‹åŠ¡ å–å‡º10å…ƒï¼Œä½™é¢æ”¹ä¸º90å…ƒ æ—  å›žæ»šäº‹åŠ¡ï¼Œä½™é¢æ¢å¤ä¸º100å…ƒ æ›´æ–°ä¸¢å¤± è„è¯»é—®é¢˜-ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ® ä¸å¯é‡å¤è¯»-äº‹åŠ¡Aå¤šæ¬¡è¯»å–æ•°æ®ï¼Œæœªæäº¤æ•°æ®ï¼Œæ­¤æ—¶äº‹åŠ¡Bæäº¤æ–°çš„æ•°æ®ï¼Œå¯¼è‡´Aå¤šæ¬¡è¯»å–æ•°æ®æœŸé—´æ•°æ®ä¸ä¸€è‡´ï¼Œä¸æ»¡è¶³éš”ç¦»æ€§ å¹»è¯»-äº‹åŠ¡Aå—åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥æ–°çš„ä¸€è¡Œæˆ–è€…åˆ é™¤ä¸€è¡Œçš„å½±å“ï¼Œå¯¼è‡´å¹»è§‰ ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹: åŒæ ·çš„æ¡ä»¶çš„select, ä½ è¯»å–è¿‡çš„æ•°æ®, å†æ¬¡è¯»å–å‡ºæ¥å‘çŽ°å€¼ä¸ä¸€æ ·äº† å¹»è¯»çš„é‡ç‚¹åœ¨äºŽæ–°å¢žæˆ–è€…åˆ é™¤: åŒæ ·çš„æ¡ä»¶çš„select, ç¬¬1æ¬¡å’Œç¬¬2æ¬¡è¯»å‡ºæ¥çš„è®°å½•æ•°ä¸ä¸€æ · å…·ä½“å¯ä»¥è‡ªå·±è®¾ç½®ä¸åŒçš„éš”ç¦»çº§åˆ«è¿›è¡Œæ¼”ç¤ºã€‚ 3. äº‹åŠ¡çš„éš”ç¦»çº§åˆ« Read uncommittedï¼šè¯»åˆ°å…¶ä»–äº‹åŠ¡æœªcommitçš„å€¼ Read committedï¼šè§£å†³äº†è„è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¼šè¯»åˆ°å…¶ä»–äº‹åŠ¡commitçš„å€¼ï¼Œè¯»ä¸¤æ¬¡å¯èƒ½ä¼šè¯»åˆ°ä¸¤ä¸ªå€¼ï¼Œæ‰€ä»¥åˆå«ä¸å¯é‡å¤è¯» Repeatable Readï¼šè§£å†³äº†ä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œå¯é‡å¤è¯»ï¼Œåˆ«äººcommitå¯¹æˆ‘æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯å¯¹äºŽåˆ«çš„äº‹åŠ¡æ’å…¥æ“ä½œï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¹»è¯» Serializableï¼šä¸²è¡ŒåŒ–ï¼Œå½“å‘ç”Ÿä¸¤ä¸ªäº‹åŠ¡åŒæ—¶æäº¤ï¼Œç»“æžœåªå¯èƒ½æœ‰ä¸€ä¸ªï¼Œç›¸å½“äºŽä¸²è¡Œæ‰§è¡ŒåŽçš„æŸä¸ªç»“æžœ çº§åˆ«è¶Šæ¥è¶Šé«˜ï¼Œå®‰å…¨æ€§ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œä½†æ˜¯ä½†æ˜¯æ€§èƒ½è¶Šæ¥è¶Šä½Žã€‚è¯´æ˜Žä¸€ä¸‹ï¼Œå‡ºçŽ°å¹»è¯»åªæ˜¯é’ˆå¯¹è¿™ç§Repeatable Readéš”ç¦»çº§åˆ«ï¼Œä½†æ˜¯InnoDBå·²ç»ä¸å­˜åœ¨å¹»è¯»é—®é¢˜äº†ï¼Œå¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿä¸»è¦æ˜¯ç”¨next-keyé”æ¥è§£å†³ï¼Œä¸‹æ–‡ä¼šè®²åˆ°ã€‚ 4. å½“å‰è¯»å’Œå¿«ç…§è¯» 4.1 å½“å‰è¯» è¯»å–çš„éƒ½æ˜¯å½“å‰æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨è¯»çš„æ—¶å€™å¯¹å…¶åŠ é”ï¼Œä¸å…è®¸å…¶ä»–äº‹åŠ¡è¿›è¡Œä¿®æ”¹æ“ä½œã€‚ select ... lock in share modeï¼ˆå…±äº«é”ï¼‰ä»¥åŠ select ... for updateã€updateã€deleteã€insertï¼ˆæŽ’ä»–é”ï¼‰è¿™äº›æ“ä½œéƒ½æ˜¯å½“å‰è¯»ã€‚ ä¸ºä»€ä¹ˆå°† æ’å…¥/æ›´æ–°/åˆ é™¤ æ“ä½œï¼Œéƒ½å½’ä¸ºå½“å‰è¯»ï¼Ÿå¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ª æ›´æ–° æ“ä½œï¼Œåœ¨æ•°æ®åº“ä¸­çš„æ‰§è¡Œæµç¨‹ï¼š ä»Žå›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªUpdateæ“ä½œçš„å…·ä½“æµç¨‹ã€‚å½“Update SQLè¢«å‘ç»™MySQLåŽï¼ŒMySQL Serverä¼šæ ¹æ®whereæ¡ä»¶ï¼Œå‘å‡ºcurrent read è¯»å–ç¬¬ä¸€æ¡æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œç„¶åŽInnoDBå¼•æ“Žä¼šå°†ç¬¬ä¸€æ¡è®°å½•è¿”å›žï¼Œå¹¶åŠ é” (current read)ã€‚ å¾…MySQL Serveræ”¶åˆ°è¿™æ¡åŠ é”çš„è®°å½•ä¹‹åŽï¼Œä¼šå†å‘èµ·ä¸€ä¸ªUpdateè¯·æ±‚ï¼Œæ›´æ–°è¿™æ¡è®°å½•ã€‚ ä¸€æ¡è®°å½•æ“ä½œå®Œæˆï¼Œå†è¯»å–ä¸‹ä¸€æ¡è®°å½•ï¼Œç›´è‡³æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•ä¸ºæ­¢ã€‚å› æ­¤ï¼ŒUpdateæ“ä½œå†…éƒ¨ï¼Œå°±åŒ…å«äº†ä¸€ä¸ªå½“å‰è¯»ã€‚ 4.2 å¿«ç…§è¯» ä¸åŠ é”çš„éžé˜»å¡žè¯»ï¼Œç®€å•çš„selectï¼ˆå‰ææ˜¯äº‹åŠ¡çº§åˆ«ä¸æ˜¯serializableï¼Œå› ä¸ºåœ¨serializableçº§åˆ«ä¸‹éƒ½æ˜¯ä¸²è¡Œè¯»ï¼Œæ™®é€šçš„selectä¹Ÿä¼šé€€åŒ–ä¸ºå½“å‰è¯»å³select ... lock in share modeï¼‰ å¿«ç…§è¯»çš„å®žçŽ°æ˜¯åŸºäºŽå¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ï¼ˆMVCCï¼‰å®žçŽ°ï¼Œæ—¨åœ¨æé«˜æ€§èƒ½ã€‚æœ‰å¯èƒ½è¯»åˆ°çš„ä¸æ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ã€‚ï¼ˆåˆ›å»ºå¿«ç…§çš„æ—¶æœºå†³å®šäº†è¯»åˆ°çš„æ•°æ®çš„ç‰ˆæœ¬ï¼Œå¦‚æžœäº‹åŠ¡Aå…ˆå¿«ç…§è¯»ï¼Œäº‹åŠ¡Bä¿®æ”¹ï¼Œé‚£ä¹ˆäº‹åŠ¡Aå†å¿«ç…§è¯»å°±è¿˜æ˜¯æ›´æ–°å‰çš„ç‰ˆæœ¬ï¼Œäº‹åŠ¡Açš„å½“å‰è¯»ä¼šè¯»åˆ°æœ€æ–°çš„æ•°æ®ï¼›è€Œå½“äº‹åŠ¡Bå…ˆæ›´æ–°ï¼Œäº‹åŠ¡Aå†å¿«ç…§è¯»ï¼Œå°±ä¼šè¯»åˆ°æ•°æ®æœ€æ–°ç‰ˆæœ¬äº†ï¼‰ 4.3 MVCC MVCCåœ¨MySQLçš„InnoDBä¸­çš„å®žçŽ° åœ¨InnoDBä¸­ï¼Œä¼šåœ¨æ¯è¡Œæ•°æ®åŽæ·»åŠ ä¸¤ä¸ªé¢å¤–çš„éšè—çš„å€¼æ¥å®žçŽ°MVCCï¼Œè¿™ä¸¤ä¸ªå€¼ä¸€ä¸ªè®°å½•è¿™è¡Œæ•°æ®ä½•æ—¶è¢«åˆ›å»ºï¼Œå¦å¤–ä¸€ä¸ªè®°å½•è¿™è¡Œæ•°æ®ä½•æ—¶è¿‡æœŸï¼ˆæˆ–è€…è¢«åˆ é™¤ï¼‰ã€‚ åœ¨å®žé™…æ“ä½œä¸­ï¼Œå­˜å‚¨çš„å¹¶ä¸æ˜¯æ—¶é—´ï¼Œè€Œæ˜¯äº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œæ¯å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œäº‹åŠ¡çš„ç‰ˆæœ¬å·å°±ä¼šé€’å¢žã€‚ åœ¨å¯é‡è¯»Repeatable readsäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼š SELECTæ—¶ï¼Œè¯»å–åˆ›å»ºç‰ˆæœ¬å·&lt;=å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œåˆ é™¤ç‰ˆæœ¬å·ä¸ºç©ºæˆ–&gt;å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ã€‚ INSERTæ—¶ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œçš„åˆ›å»ºç‰ˆæœ¬å· DELETEæ—¶ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œçš„åˆ é™¤ç‰ˆæœ¬å· UPDATEæ—¶ï¼Œæ’å…¥ä¸€æ¡æ–°çºªå½•ï¼Œä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ä¸ºè¡Œåˆ›å»ºç‰ˆæœ¬å·ï¼ŒåŒæ—¶ä¿å­˜å½“å‰äº‹åŠ¡ç‰ˆæœ¬å·åˆ°åŽŸæ¥åˆ é™¤çš„è¡Œ é€šè¿‡MVCCï¼Œè™½ç„¶æ¯è¡Œè®°å½•éƒ½éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œæ›´å¤šçš„è¡Œæ£€æŸ¥å·¥ä½œä»¥åŠä¸€äº›é¢å¤–çš„ç»´æŠ¤å·¥ä½œï¼Œä½†å¯ä»¥å‡å°‘é”çš„ä½¿ç”¨ï¼Œå¤§å¤šæ•°è¯»æ“ä½œéƒ½ä¸ç”¨åŠ é”ï¼Œè¯»æ•°æ®æ“ä½œå¾ˆç®€å•ï¼Œæ€§èƒ½å¾ˆå¥½ï¼Œå¹¶ä¸”ä¹Ÿèƒ½ä¿è¯åªä¼šè¯»å–åˆ°ç¬¦åˆæ ‡å‡†çš„è¡Œï¼Œä¹Ÿåªé”ä½å¿…è¦è¡Œã€‚ è¯´ç™½äº†ï¼Œå°±æ˜¯ä¹è§‚é”çš„ä¸€ç§å®žçŽ°ã€‚å…åŽ»äº†åŠ é”è§£é”çš„è¿‡ç¨‹ï¼Œå¯¹äºŽè¯»å¤šå†™å°‘çš„åœºæ™¯ç‰¹åˆ«é€‚ç”¨ã€‚ 5. RCï¼ŒRRçº§åˆ«ä¸‹çš„InnoDBéžé˜»å¡žè¯»ï¼ˆå¿«ç…§è¯»ï¼‰å¦‚ä½•å®žçŽ° é€šè¿‡æ•°æ®è¡Œé‡Œçš„DB_TRX_IDã€DB_ROLL_PTRã€DB_ROW_IDè¿™ä¸‰ä¸ªå­—æ®µ DB_TRX_IDï¼Œæœ€åŽä¸€æ¬¡ä¿®æ”¹æœ¬è¡Œäº‹åŠ¡çš„ID DB_ROLL_PTRï¼Œå³å›žæ»šæŒ‡é’ˆ,ä¸Žundoæ—¥å¿—é…åˆ DB_ROW_IDï¼Œéšç€æ–°è¡Œæ’å…¥è€Œå•è°ƒé€’å¢žçš„è¡Œå·ï¼ˆinnoDBä¸­å¦‚æžœæ—¢æ²¡æœ‰ä¸»é”®ç´¢å¼•ä¹Ÿæ²¡æœ‰å”¯ä¸€ç´¢å¼•çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšè—ä¸»é”®ï¼Œå°±æ˜¯è¿™ä¸ªçŽ©æ„ï¼‰ è¿™ä¸‰ä¸ªå­—æ®µç»“åˆundoæ—¥å¿—ï¼Œè¿™ä¸ªæ—¥å¿—é‡Œé¢è®°å½•çš„éƒ½æ˜¯è€ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¿™æ ·ï¼Œå¿«ç…§è¯»å°±å¯ä»¥è¯»å‡ºé€‚åˆçš„ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®å‡ºæ¥ã€‚åœ¨æ•°æ®åº“ä¸­ï¼Œæ—¥å¿—æ˜¯éžå¸¸é‡è¦çš„ä¸œè¥¿ï¼Œå¯ä»¥è¯´å…¶é‡è¦æ€§æ˜¯å¤§äºŽæ•°æ®æœ¬èº«çš„ï¼Œå› ä¸ºæ•°æ®ä¸¢å¤±å¯ä»¥é€šè¿‡æ—¥å¿—æ‰¾å›žæ¥ï¼Œä½†æ˜¯æ—¥å¿—ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆä»¥åŽæ•°æ®åº“å‡ºçŽ°å´©æºƒç­‰å°±éº»çƒ¦äº†ã€‚ 6. æ—¥å¿— æ•°æ®åº“æ•°æ®å­˜æ”¾çš„æ–‡ä»¶ç§°ä¸ºdata fileï¼›æ—¥å¿—æ–‡ä»¶ç§°ä¸ºlog fileï¼›æ•°æ®åº“æ•°æ®æ˜¯æœ‰ç¼“å­˜çš„ï¼Œå¦‚æžœæ²¡æœ‰ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½å†™æˆ–è€…è¯»ç‰©ç†diskï¼Œé‚£æ€§èƒ½å°±å¤ªä½Žä¸‹äº†ã€‚æ•°æ®åº“æ•°æ®çš„ç¼“å­˜ç§°ä¸ºdata bufferï¼Œæ—¥å¿—ï¼ˆredoï¼‰ç¼“å­˜ç§°ä¸ºlog bufferï¼›æ—¢ç„¶æ•°æ®åº“æ•°æ®æœ‰ç¼“å­˜ï¼Œå°±å¾ˆéš¾ä¿è¯ç¼“å­˜æ•°æ®ï¼ˆè„æ•°æ®ï¼‰ä¸Žç£ç›˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚æ¯”å¦‚æŸæ¬¡æ•°æ®åº“æ“ä½œï¼š 1update driver_info set driver_status = 2 where driver_id = 10001; æ›´æ–°driver_statuså­—æ®µçš„æ•°æ®ä¼šå­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œç­‰å¾…å­˜å‚¨å¼•æ“Žå°†driver_statusåˆ·æ–°data_fileï¼Œå¹¶è¿”å›žç»™ä¸šåŠ¡æ–¹æ›´æ–°æˆåŠŸã€‚å¦‚æžœæ­¤æ—¶æ•°æ®åº“å®•æœºï¼Œç¼“å­˜ä¸­çš„æ•°æ®å°±ä¸¢å¤±äº†ï¼Œä¸šåŠ¡æ–¹å´ä»¥ä¸ºæ›´æ–°æˆåŠŸäº†ï¼Œæ•°æ®ä¸ä¸€è‡´ï¼Œä¹Ÿæ²¡æœ‰æŒä¹…åŒ–å­˜å‚¨ã€‚ ä¸Šé¢çš„é—®é¢˜å°±å¯ä»¥é€šè¿‡äº‹åŠ¡çš„ACIDç‰¹æ€§æ¥ä¿è¯ã€‚ 12345BEGIN transï¼›update driver_info set driver_status = 2 where driver_id = 10001;COMMIT; è¿™æ ·æ‰§è¡ŒåŽï¼Œæ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚ä¸šåŠ¡æ–¹çš„è¿”å›žå’Œæ•°æ®åº“data fileä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚è¦ä¿è¯è¿™æ ·çš„ç‰¹æ€§è¿™å°±ä¸å¾—ä¸è¯´å­˜å‚¨å¼•æ“Žinnodbçš„redoå’Œundoæ—¥å¿—ã€‚ 6.1 undoæ˜¯å•¥ undoæ—¥å¿—ç”¨äºŽå­˜æ”¾æ•°æ®ä¿®æ”¹è¢«ä¿®æ”¹å‰çš„å€¼ï¼Œå‡è®¾ä¿®æ”¹ tba è¡¨ä¸­ id=2çš„è¡Œæ•°æ®ï¼ŒæŠŠName=â€˜Bâ€™ ä¿®æ”¹ä¸ºName = â€˜B2â€™ ï¼Œé‚£ä¹ˆundoæ—¥å¿—å°±ä¼šç”¨æ¥å­˜æ”¾Name='Bâ€™çš„è®°å½•ï¼Œå¦‚æžœè¿™ä¸ªä¿®æ”¹å‡ºçŽ°å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨undoæ—¥å¿—æ¥å®žçŽ°å›žæ»šæ“ä½œï¼Œä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚ å¯¹æ•°æ®çš„å˜æ›´æ“ä½œï¼Œä¸»è¦æ¥è‡ª INSERT UPDATE DELETEï¼Œè€ŒUNDO LOGä¸­åˆ†ä¸ºä¸¤ç§ç±»åž‹ï¼Œä¸€ç§æ˜¯ INSERT_UNDOï¼ˆINSERTæ“ä½œï¼Œäº‹åŠ¡æäº¤åŽå¯ä»¥ç«‹å³ä¸¢å¼ƒï¼‰ï¼Œè®°å½•æ’å…¥çš„å”¯ä¸€é”®å€¼ï¼›ä¸€ç§æ˜¯ UPDATE_UNDOï¼ˆåŒ…å«UPDATEåŠDELETEæ“ä½œï¼‰ï¼Œè®°å½•ä¿®æ”¹çš„å”¯ä¸€é”®å€¼ä»¥åŠold columnè®°å½•ã€‚ 6.2 redoæ˜¯å•¥ å­˜å‚¨å¼•æ“Žä¹Ÿä¼šä¸ºredo undoæ—¥å¿—å¼€è¾Ÿå†…å­˜ç¼“å­˜ç©ºé—´ï¼Œlog bufferã€‚ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶ç§°ä¸ºlog fileï¼Œæ˜¯é¡ºåºè¿½åŠ çš„ï¼Œæ€§èƒ½éžå¸¸é«˜ï¼Œæ³¨ï¼šç£ç›˜çš„é¡ºåºå†™æ€§èƒ½æ¯”å†…å­˜çš„å†™æ€§èƒ½å·®ä¸äº†å¤šå°‘ã€‚ redoæ—¥å¿—è®°å½•äº‹åŠ¡æ‰§è¡ŒåŽçš„çŠ¶æ€ï¼Œç”¨æ¥æ¢å¤æœªå†™å…¥data fileçš„å·²æˆåŠŸäº‹åŠ¡æ›´æ–°çš„æ•°æ®ã€‚ä¾‹å¦‚æŸä¸€äº‹åŠ¡çš„äº‹åŠ¡åºå·ä¸ºT1ï¼Œå…¶å¯¹æ•°æ®Xè¿›è¡Œä¿®æ”¹ï¼Œè®¾Xçš„åŽŸå€¼æ˜¯5ï¼Œä¿®æ”¹åŽçš„å€¼ä¸º15ï¼Œé‚£ä¹ˆUndoæ—¥å¿—ä¸º&lt;T1, X, 5&gt;ï¼ŒRedoæ—¥å¿—ä¸º&lt;T1, X, 15&gt;ã€‚ æ¢³ç†ä¸‹äº‹åŠ¡æ‰§è¡Œçš„å„ä¸ªé˜¶æ®µï¼š å†™undoæ—¥å¿—åˆ°log bufferï¼› æ‰§è¡Œäº‹åŠ¡ï¼Œå¹¶å†™redoæ—¥å¿—åˆ°log bufferï¼› å¦‚æžœinnodb_flush_log_at_trx_commit=1ï¼Œåˆ™å°†redoæ—¥å¿—å†™åˆ°log fileï¼Œå¹¶åˆ·æ–°è½ç›˜ã€‚ æäº¤äº‹åŠ¡ã€‚ é‚£redoæ—¥å¿—æ˜¯å†™è¿›åŽ»äº†ï¼Œä½†æ˜¯æ•°æ®å‘¢ï¼Ÿ åœ¨æ•°æ®åº“çš„ä¸–ç•Œé‡Œï¼Œæ•°æ®ä»Žæ¥éƒ½ä¸é‡è¦ï¼Œæ—¥å¿—æ‰æ˜¯æœ€é‡è¦çš„ï¼Œæœ‰äº†æ—¥å¿—å°±æœ‰äº†ä¸€åˆ‡ã€‚ å› ä¸ºdata bufferä¸­çš„æ•°æ®ä¼šåœ¨åˆé€‚çš„æ—¶é—´ ç”±å­˜å‚¨å¼•æ“Žå†™å…¥åˆ°data fileï¼Œå¦‚æžœåœ¨å†™å…¥ä¹‹å‰ï¼Œæ•°æ®åº“å®•æœºäº†ï¼Œæ ¹æ®è½ç›˜çš„redoæ—¥å¿—ï¼Œå®Œå…¨å¯ä»¥å°†äº‹åŠ¡æ›´æ”¹çš„æ•°æ®æ¢å¤ã€‚å¥½äº†ï¼Œçœ‹å‡ºæ—¥å¿—çš„é‡è¦æ€§äº†å§ã€‚å…ˆæŒä¹…åŒ–æ—¥å¿—çš„ç­–ç•¥å«åšWrite Ahead Logï¼Œå³é¢„å†™æ—¥å¿—ã€‚ 6.3 Undo + Redoäº‹åŠ¡çš„ç®€åŒ–è¿‡ç¨‹ å‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®ï¼Œå€¼åˆ†åˆ«ä¸º1,2ï¼Œå¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡çš„æ“ä½œå†…å®¹ä¸ºï¼šæŠŠ1ä¿®æ”¹ä¸º3ï¼Œ2ä¿®æ”¹ä¸º4ï¼Œé‚£ä¹ˆå®žé™…çš„è®°å½•å¦‚ä¸‹ï¼ˆç®€åŒ–ï¼‰ï¼š äº‹åŠ¡å¼€å§‹. è®°å½•A=1åˆ°undo log buffer. ä¿®æ”¹A=3. è®°å½•A=3åˆ°redo log buffer. è®°å½•B=2åˆ°undo log buffer. ä¿®æ”¹B=4. è®°å½•B=4åˆ°redo log buffer. å°†redo logå†™å…¥ç£ç›˜ã€‚ äº‹åŠ¡æäº¤ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ2ï¼Œ4ï¼Œ5ï¼Œ7ï¼Œ8éƒ½æ˜¯æ–°å¢žæ“ä½œï¼Œä½†æ˜¯2ï¼Œ4ï¼Œ5ï¼Œ7éƒ½æ˜¯ç¼“å†²åˆ°bufferåŒºï¼Œåªæœ‰8æ˜¯ç£ç›˜IOæ“ä½œã€‚ä¸ºäº†ä¿è¯Redo Logæœ‰è¾ƒå¥½çš„IOæ€§èƒ½ï¼Œè®¾è®¡ä¸€èˆ¬æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å°½é‡ä¿æŒRedo Logå­˜å‚¨åœ¨ä¸€æ®µè¿žç»­çš„ç©ºé—´ä¸Šã€‚å› æ­¤åœ¨ç³»ç»Ÿç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶å°±ä¼šå°†æ—¥å¿—æ–‡ä»¶çš„ç©ºé—´å®Œå…¨åˆ†é…ã€‚ ä»¥é¡ºåºè¿½åŠ çš„æ–¹å¼è®°å½•Redo Log,é€šè¿‡é¡ºåºIOæ¥æ”¹å–„æ€§èƒ½ã€‚ æ‰¹é‡å†™å…¥æ—¥å¿—ã€‚æ—¥å¿—å¹¶ä¸æ˜¯ç›´æŽ¥å†™å…¥æ–‡ä»¶ï¼Œè€Œæ˜¯å…ˆå†™å…¥redo log buffer.å½“éœ€è¦å°†æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜æ—¶ (å¦‚äº‹åŠ¡æäº¤),å°†è®¸å¤šæ—¥å¿—ä¸€èµ·å†™å…¥ç£ç›˜. å¹¶å‘çš„äº‹åŠ¡å…±äº«Redo Logçš„å­˜å‚¨ç©ºé—´ï¼Œå®ƒä»¬çš„Redo LogæŒ‰è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œä¾æ¬¡äº¤æ›¿çš„è®°å½•åœ¨ä¸€èµ·ï¼Œ ä»¥å‡å°‘æ—¥å¿—å ç”¨çš„ç©ºé—´ã€‚ä¾‹å¦‚,Redo Logä¸­çš„è®°å½•å†…å®¹å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š è®°å½•1: &lt;trx1, insert â€¦&gt; è®°å½•2: &lt;trx2, update â€¦&gt; è®°å½•3: &lt;trx1, delete â€¦&gt; è®°å½•4: &lt;trx3, update â€¦&gt; è®°å½•5: &lt;trx2, insert â€¦&gt; å› ä¸ºä¸Šä¸€æ¡çš„åŽŸå› ,å½“ä¸€ä¸ªäº‹åŠ¡å°†Redo Logå†™å…¥ç£ç›˜æ—¶ï¼Œä¹Ÿä¼šå°†å…¶ä»–æœªæäº¤çš„äº‹åŠ¡çš„æ—¥å¿—å†™å…¥ç£ç›˜ Redo Logä¸Šåªè¿›è¡Œé¡ºåºè¿½åŠ çš„æ“ä½œï¼Œå½“ä¸€ä¸ªäº‹åŠ¡éœ€è¦å›žæ»šæ—¶ï¼Œå®ƒçš„Redo Logè®°å½•ä¹Ÿä¸ä¼šä»ŽRedo Logä¸­åˆ é™¤æŽ‰ã€‚ 6.4 å›žæ»š å‰é¢è¯´åˆ°æœªæäº¤çš„äº‹åŠ¡å’Œå›žæ»šäº†çš„äº‹åŠ¡ä¹Ÿä¼šè®°å½•Redo Logï¼Œå› æ­¤åœ¨è¿›è¡Œæ¢å¤æ—¶,è¿™äº›äº‹åŠ¡è¦è¿›è¡Œç‰¹æ®Šçš„çš„å¤„ç†ã€‚æœ‰2ç§ä¸åŒçš„æ¢å¤ç­–ç•¥ï¼š è¿›è¡Œæ¢å¤æ—¶ï¼Œåªé‡åšå·²ç»æäº¤äº†çš„äº‹åŠ¡ã€‚ è¿›è¡Œæ¢å¤æ—¶ï¼Œé‡åšæ‰€æœ‰äº‹åŠ¡åŒ…æ‹¬æœªæäº¤çš„äº‹åŠ¡å’Œå›žæ»šäº†çš„äº‹åŠ¡ã€‚ç„¶åŽé€šè¿‡Undo Logå›žæ»šé‚£äº›æœªæäº¤çš„äº‹åŠ¡ã€‚ MySQLæ•°æ®åº“InnoDBå­˜å‚¨å¼•æ“Žä½¿ç”¨äº†ç¬¬äºŒä¸ªç­–ç•¥ã€‚ InnoDBå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯» è¡¨è±¡åŽŸå› :å¿«ç…§è¯»ï¼ˆéžé˜»å¡žè¯»ï¼‰â€“ä¼ªMVCC å†…åœ¨åŽŸå› ï¼šnext-keyé”ï¼ˆè¡Œé”+gapé”ï¼‰ 6.5 next-keyé” åœ¨ RR çº§åˆ«ä¸‹ï¼Œå¦‚æžœæŸ¥è¯¢æ¡ä»¶èƒ½ä½¿ç”¨ä¸Šå”¯ä¸€ç´¢å¼•ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æŸ¥è¯¢æ¡ä»¶ï¼Œé‚£ä¹ˆä»…åŠ è¡Œé”ï¼Œå¦‚æžœæ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œé‚£ä¹ˆå°±ä¼šç»™è¿™ä¸ªèŒƒå›´åŠ ä¸Š gap é”æˆ–è€… next-keyé” (è¡Œé”+gapé”)ã€‚ é‚£ä¹ˆgapé”å•¥æ—¶å€™å‡ºçŽ°å‘¢ï¼Ÿ ä½¿ç”¨ä¸»é”®ç´¢å¼•æˆ–è€…å”¯ä¸€ç´¢å¼•æ—¶ï¼š å¦‚æžœwhereæ¡ä»¶å…¨éƒ¨å‘½ä¸­ï¼Œåˆ™ä¸ä¼šç”¨Gapé”ï¼Œåªä¼šåŠ è®°å½•é” å¦‚æžœwhereæ¡ä»¶éƒ¨åˆ†å‘½ä¸­æˆ–è€…å…¨ä¸å‘½ä¸­ï¼Œåˆ™ä¼šåŠ Gapé” åœ¨èµ°éžå”¯ä¸€ç´¢å¼•æˆ–è€…ä¸èµ°ç´¢å¼•çš„å½“å‰è¯»ä¸­ï¼Œä¹Ÿä¼šå‡ºçŽ°Gapé”ã€‚å¯¹äºŽä¸èµ°ç´¢å¼•çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±ä¼šé”ä½æ•´å¼ è¡¨ã€‚ æ€»ç»“ä¸€ä¸‹ï¼šåªæœ‰å¯¹å”¯ä¸€ç´¢å¼•+å…¨éƒ¨å‘½ä¸­æ‰ä¸ä¼šåŠ gapé”ã€‚ å…·ä½“æ¥ä¸ªä¾‹å­è¯´æ˜Žé—´éš™é”å¦‚ä½•å·¥ä½œã€‚ 7. ä¾‹å­-èµ°å”¯ä¸€ç´¢å¼• 7.1 å‡†å¤‡å·¥ä½œ æœ‰è¿™æ ·ä¸€ä¸ªè¡¨testï¼Œå…¶ä¸­nameä¸ºä¸»é”®ï¼Œidä¸ºå”¯ä¸€é”®ã€‚ 123456CREATE TABLE `test` ( `name` varchar(11) primary key, `id` int, unique KEY `id` (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into test(name,id) values ("f",1), ("h",2), ("b",3), ("a",5), ("c",6),("d",9); name id f 1 h 2 b 3 a 5 c 6 d 9 é¦–å…ˆéªŒè¯ä¸€ä¸‹ä½¿ç”¨ä¸»é”®ç´¢å¼•æˆ–è€…å”¯ä¸€ç´¢å¼•æ—¶ä¼šæ€Žä¹ˆæ ·ã€‚ 7.2 ç¬¬ä¸€ç§æƒ…å†µï¼šå”¯ä¸€ç´¢å¼•+å‘½ä¸­æ‰€æœ‰æ•°æ® session1æ‰§è¡Œ 1delete from test where id = 3; session2æ‰§è¡Œï¼š 1insert into test(name,id) values("swg",4); æ­¤æ—¶ç”±äºŽidæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¹¶ä¸”æ˜¯å‘½ä¸­çš„ï¼Œæ‰€ä»¥åªæ˜¯å¯¹è¿™ä¸€è¡ŒåŠ æŽ’ä»–é”ï¼Œè€Œæ²¡æœ‰åŠ gapé”ï¼Œæ‰€ä»¥session2æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„ï¼Œä¸èƒ½è¢«é˜»å¡žã€‚ 7.3 ç¬¬ä¸€ç§æƒ…å†µï¼šå”¯ä¸€ç´¢å¼•+ä¸å‘½ä¸­æ•°æ® session1æ‰§è¡Œ 1delete from test where id = 7; session2æ‰§è¡Œï¼š 1insert into test(name,id) values("swg",8); æ­¤æ—¶session2ä¼šé˜»å¡žä½ï¼Œè¯æ˜Žid=7å‘¨å›´åŠ äº†gapé”ã€‚gapé”çš„èŒƒå›´éµä»Žå·¦å¼€å³é—­çš„åŽŸåˆ™ï¼Œè¿™é‡Œå°±æ˜¯(6,7ï¼‰ä»¥åŠ(7,9)éƒ½ä¼šè¢«é”ä½ã€‚åŠ ä¸Šrecordé”ç»„æˆnext-keyé”ï¼Œæ‰€ä»¥next-keyé”çš„èŒƒå›´æ˜¯(6,7]ä»¥åŠ(7,9]è¿™ä¸ªèŒƒå›´ã€‚ 7.4 ç¬¬ä¸‰ç§æƒ…å†µï¼šå”¯ä¸€ç´¢å¼•+ä¸å‘½ä¸­æ‰€æœ‰æ•°æ® session1æ‰§è¡Œ 1select * from test where id in (5,7,9) lock in share mode; è¿™é‡Œæ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œ5å’Œ9éƒ½æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯7ä¸å­˜åœ¨ï¼Œå³éƒ¨åˆ†æ•°æ®ä¸å­˜åœ¨ã€‚ session2æ‰§è¡Œï¼š 1234567insert into test(name,id) values("swg",4);&lt;!--å¯ä»¥--&gt;insert into test(name,id) values("swg",7);&lt;!--ä¸å¯ä»¥--&gt;insert into test(name,id) values("swg",8);&lt;!--ä¸å¯ä»¥--&gt;insert into test(name,id) values("swg",10);&lt;!--å¯ä»¥--&gt; é‚£ä¹ˆå¯¹äºŽ(5,9]çš„èŒƒå›´å†…å°±é˜»å¡žä½äº†ï¼Œé‚£ä¹ˆéƒ¨åˆ†å‘½ä¸­å°±æ˜¯éƒ¨åˆ†åŠ gapé”ã€‚ 7.5 ç¬¬å››ç§æƒ…å†µï¼šå”¯ä¸€ç´¢å¼•+å‘½ä¸­æ‰€æœ‰æ•°æ® session1æ‰§è¡Œ 1select * from test where id in (5,6,9) lock in share mode; è¿™é‡Œå…¨éƒ¨å‘½ä¸­ï¼Œé‚£ä¹ˆ session2æ‰§è¡Œï¼š 123insert into test(name,id) values("swg",7);&lt;!--å¯ä»¥--&gt;insert into test(name,id) values("swg",8);&lt;!--å¯ä»¥--&gt; è¿™ä¸ªæ—¶å€™å°±ä¸ä¼šåŠ gapé”äº†ã€‚ 8. ä¾‹å­-ä¸èµ°å”¯ä¸€ç´¢å¼•æˆ–è€…ä¸èµ°ç´¢å¼• ä¸‹é¢æ¥çœ‹çœ‹ä¸èµ°éžå”¯ä¸€ç´¢å¼•çš„å½“å‰è¯»æ˜¯ä»€ä¹ˆæƒ…å†µã€‚ æ­¤æ—¶è¡¨çš„æ•°æ®ä¸ºï¼š name id h 2 c 6 b 9 d 9 f 11 a 15 æŠŠidä¸Šçš„å”¯ä¸€ç´¢å¼•æ¢æˆäº†æ™®é€šç´¢å¼•ã€‚ 8.1 ç¬¬äº”ç§æƒ…å†µï¼šéžå”¯ä¸€ç´¢å¼• session1æ‰§è¡Œ 1delete from test where id = 9; session2æ‰§è¡Œï¼š 1insert into test(name,id) values("swg",9); æ­¤æ—¶session2æ˜¯ä¼šè¢«blockä½çš„ã€‚gapçš„èŒƒå›´æ˜¯(6,9]ä»¥åŠ(9,11]. 12345insert into test(name,id) values("swg",5);&lt;!--å¯ä»¥--&gt;insert into test(name,id) values("swg",7);&lt;!--ä¸å¯ä»¥--&gt;insert into test(name,id) values("swg",12);&lt;!--å¯ä»¥--&gt; ä¸Šé¢çš„åŽŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³åªè¦æ˜¯6å’Œ11ä¹‹é—´çš„æ•°ï¼Œä¸åŒ…å«ä¸´ç•Œå€¼çš„æ—¶å€™ï¼Œæ— è®ºæ’å…¥ä»€ä¹ˆæ•°æ®ï¼Œéƒ½æ˜¯ä¼šé˜»å¡žçš„ã€‚ ä½†æ˜¯å…³äºŽä¸´ç•Œå€¼6å’Œ11ï¼Œè¿™é‡Œå°±æ¯”è¾ƒç‰¹æ®Šäº†ï¼Œå› ä¸ºéœ€è¦åŠ ä¸Šä¸»é”®çš„å€¼æ‰èƒ½è¿›è¡Œç²¾å‡†çš„åˆ¤æ–­ã€‚ 123insert into test(name,id) values(&quot;bb&quot;,6);&lt;!--å¯ä»¥--&gt;insert into test(name,id) values(&quot;dd&quot;,6);&lt;!--ä¸å¯ä»¥--&gt; è¿™æ˜¯ä»€ä¹ˆåŽŸå› å‘¢ï¼Ÿ æˆ‘ä»¬å°†æ•°æ®ç”»æˆå›¾ï¼š è¿™é‡Œçš„gapåŒºé—´å¯èƒ½æ˜¯(è´Ÿæ— ç©·ï¼Œ2],(2,6],(6,9],(9,11],(11,15],(15,æ­£æ— ç©·) æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œidä¸º6çš„è¡Œï¼Œå¯¹åº”çš„nameä¸ºc(ä¸è¦å¿˜è®°nameæ˜¯ä¸»é”®ï¼Œä¸»é”®æŒ‰ç…§é¡ºåºæŽ’åº)ï¼Œé‚£ä¹ˆä¸»é”®ä¸­å°±æ˜¯æŒ‰ç…§å­—æ¯è¡¨çš„é¡ºåºè¿›è¡ŒæŽ’åˆ—çš„ï¼ˆASCIIç ï¼‰ï¼Œå¦‚æžœæ’å…¥çš„nameå°äºŽcï¼Œé‚£ä¹ˆå°±ä¸åœ¨gapçš„èŒƒå›´å†…(c,)ï¼Œå°±å¯ä»¥æ’å…¥ï¼Œä½†æ˜¯ddåœ¨gapçš„èŒƒå›´å†…,æ‰€ä»¥å°±ä¼šé˜»å¡žä½ã€‚ 8.2 ç¬¬äº”ç§æƒ…å†µï¼šä¸èµ°ç´¢å¼• è¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰çš„é—´éš™éƒ½ä¼šåŠ ä¸Šé—´éš™é”ï¼Œé‚£ä¹ˆå°±æ˜¯é”è¡¨äº†ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é”æ¨¡å—]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2F%E9%94%81%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[æœ¬ç« å¯¹è¡Œé”è¡¨æ‰€ã€å…±äº«é”æŽ’ä»–é”è¿›è¡Œè¯¦ç»†è¯´æ˜Žã€‚è¿™æ˜¯æ•°æ®åº“é”çš„æ ¸å¿ƒçŸ¥è¯†ã€‚ MySQLä¸­å‡ ç§é‡è¦çš„é”æ¦‚å¿µ å…±äº«é”ï¼ˆSï¼‰å’Œ æŽ’ä»–é”ï¼ˆXï¼‰ InnoDB å®žçŽ°äº†æ ‡å‡†çš„è¡Œçº§é”ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼šå…±äº«é”ï¼ˆç®€ç§° s é”ï¼‰ã€æŽ’å®ƒé”ï¼ˆç®€ç§° x é”ï¼‰ å…±äº«é”å…è®¸æŒé”äº‹åŠ¡è¯»å–ä¸€è¡Œ æŽ’å®ƒé”å…è®¸æŒé”äº‹åŠ¡æ›´æ–°æˆ–è€…åˆ é™¤ä¸€è¡Œ å¦‚æžœäº‹åŠ¡ T1 æŒæœ‰è¡Œ r çš„ s é”ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªäº‹åŠ¡ T2 è¯·æ±‚ r çš„é”æ—¶ï¼Œä¼šåšå¦‚ä¸‹å¤„ç†ï¼š T2 è¯·æ±‚ s é”ç«‹å³è¢«å…è®¸ï¼Œç»“æžœ T1 T2 éƒ½æŒæœ‰ r è¡Œçš„ s é” T2 è¯·æ±‚ x é”ä¸èƒ½è¢«ç«‹å³å…è®¸ å¦‚æžœ T1 æŒæœ‰ r çš„ x é”ï¼Œé‚£ä¹ˆ T2 è¯·æ±‚ r çš„ xã€s é”éƒ½ä¸èƒ½è¢«ç«‹å³å…è®¸ï¼ŒT2 å¿…é¡»ç­‰å¾…T1é‡Šæ”¾ x é”æ‰è¡Œã€‚ æ„å‘é” innodbçš„æ„å‘é”ä¸»è¦ç”¨æˆ·å¤šç²’åº¦çš„é”å¹¶å­˜çš„æƒ…å†µã€‚æ¯”å¦‚äº‹åŠ¡Aè¦åœ¨ä¸€ä¸ªè¡¨ä¸ŠåŠ Sé”ï¼Œå¦‚æžœè¡¨ä¸­çš„ä¸€è¡Œå·²è¢«äº‹åŠ¡BåŠ äº†Xé”ï¼Œé‚£ä¹ˆè¯¥é”çš„ç”³è¯·ä¹Ÿåº”è¢«é˜»å¡žã€‚å¦‚æžœè¡¨ä¸­çš„æ•°æ®å¾ˆå¤šï¼Œé€è¡Œæ£€æŸ¥é”æ ‡å¿—çš„å¼€é”€å°†å¾ˆå¤§ï¼Œç³»ç»Ÿçš„æ€§èƒ½å°†ä¼šå—åˆ°å½±å“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨è¡¨çº§ä¸Šå¼•å…¥æ–°çš„é”ç±»åž‹æ¥è¡¨ç¤ºå…¶æ‰€å±žè¡Œçš„åŠ é”æƒ…å†µï¼Œè¿™å°±å¼•å‡ºäº†â€œæ„å‘é”â€çš„æ¦‚å¿µã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœè¡¨ä¸­è®°å½•1äº¿ï¼Œäº‹åŠ¡AæŠŠå…¶ä¸­æœ‰å‡ æ¡è®°å½•ä¸Šäº†è¡Œé”äº†ï¼Œè¿™æ—¶äº‹åŠ¡Béœ€è¦ç»™è¿™ä¸ªè¡¨åŠ è¡¨çº§é”ï¼Œå¦‚æžœæ²¡æœ‰æ„å‘é”çš„è¯ï¼Œé‚£å°±è¦åŽ»è¡¨ä¸­æŸ¥æ‰¾è¿™ä¸€äº¿æ¡è®°å½•æ˜¯å¦ä¸Šé”äº†ã€‚å¦‚æžœå­˜åœ¨æ„å‘é”ï¼Œé‚£ä¹ˆå‡å¦‚äº‹åŠ¡ï¼¡åœ¨æ›´æ–°ä¸€æ¡è®°å½•ä¹‹å‰ï¼Œå…ˆåŠ æ„å‘é”ï¼Œå†åŠ ï¼¸é”ï¼Œäº‹åŠ¡Bå…ˆæ£€æŸ¥è¯¥è¡¨ä¸Šæ˜¯å¦å­˜åœ¨æ„å‘é”ï¼Œå­˜åœ¨çš„æ„å‘é”æ˜¯å¦ä¸Žè‡ªå·±å‡†å¤‡åŠ çš„é”å†²çªï¼Œå¦‚æžœæœ‰å†²çªï¼Œåˆ™ç­‰å¾…ç›´åˆ°äº‹åŠ¡ï¼¡é‡Šæ”¾ï¼Œè€Œæ— é¡»é€æ¡è®°å½•åŽ»æ£€æµ‹ã€‚äº‹åŠ¡ï¼¢æ›´æ–°è¡¨æ—¶ï¼Œå…¶å®žæ— é¡»çŸ¥é“åˆ°åº•å“ªä¸€è¡Œè¢«é”äº†ï¼Œå®ƒåªè¦çŸ¥é“åæ­£æœ‰ä¸€è¡Œè¢«é”äº†å°±è¡Œäº†ã€‚ è¯´ç™½äº†æ„å‘é”çš„ä¸»è¦ä½œç”¨æ˜¯å¤„ç†è¡Œé”å’Œè¡¨é”ä¹‹é—´çš„çŸ›ç›¾ï¼Œèƒ½å¤Ÿæ˜¾ç¤ºâ€œæŸä¸ªäº‹åŠ¡æ­£åœ¨æŸä¸€è¡Œä¸ŠæŒæœ‰äº†é”ï¼Œæˆ–è€…å‡†å¤‡åŽ»æŒæœ‰é”â€ æ„å‘æŽ’å®ƒé”ï¼ˆç®€ç§° IX é”ï¼‰è¡¨æ˜Žä¸€ä¸ªäº‹åŠ¡æ„å›¾åœ¨æŸä¸ªè¡¨ä¸­è®¾ç½®æŸäº›è¡Œçš„ x é” æ„å‘å…±äº«é”ï¼ˆç®€ç§° IS é”ï¼‰è¡¨æ˜Žä¸€ä¸ªäº‹åŠ¡æ„å›¾åœ¨æŸä¸ªè¡¨ä¸­è®¾ç½®æŸäº›è¡Œçš„ s é” ä¾‹å¦‚ï¼Œ SELECT ... LOCK IN SHARE MODE è®¾ç½®ä¸€ä¸ª IS é”, SELECT ... FOR UPDATE è®¾ç½®ä¸€ä¸ª IX é”ã€‚ æ„å‘é”çš„åŽŸåˆ™å¦‚ä¸‹ï¼š ä¸€ä¸ªäº‹åŠ¡å¿…é¡»å…ˆæŒæœ‰è¯¥è¡¨ä¸Šçš„ IS æˆ–è€…æ›´å¼ºçš„é”æ‰èƒ½æŒæœ‰è¯¥è¡¨ä¸­æŸè¡Œçš„ S é” ä¸€ä¸ªäº‹åŠ¡å¿…é¡»å…ˆæŒæœ‰è¯¥è¡¨ä¸Šçš„ IX é”æ‰èƒ½æŒæœ‰è¯¥è¡¨ä¸­æŸè¡Œçš„ X é” next-keyé” InnoDBæœ‰ä¸‰ç§è¡Œé”çš„ç®—æ³•ï¼š Record Lockï¼šå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚åˆ†ä¸ºS Lockå’ŒX Lock Gap Lockï¼šé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†ä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚GAPé”çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åŒä¸€äº‹åŠ¡çš„ä¸¤æ¬¡å½“å‰è¯»ï¼Œå‡ºçŽ°å¹»è¯»çš„æƒ…å†µã€‚ Next-Key Lockï¼š1+2ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚å¯¹äºŽè¡Œçš„æŸ¥è¯¢ï¼Œéƒ½æ˜¯é‡‡ç”¨è¯¥æ–¹æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯è§£å†³å¹»è¯»çš„é—®é¢˜ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œmysqlçš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼Œå¹¶ä¸”innodb_locks_unsafe_for_binlogå‚æ•°ä¸º0ï¼Œè¿™æ—¶é»˜è®¤é‡‡ç”¨next-key locksã€‚æ‰€è°“Next-Key Locksï¼Œå°±æ˜¯Record lockå’Œgap lockçš„ç»“åˆï¼Œå³é™¤äº†é”ä½è®°å½•æœ¬èº«ï¼Œè¿˜è¦å†é”ä½ç´¢å¼•ä¹‹é—´çš„é—´éš™ã€‚ ä¾‹å­ï¼šå‡è®¾ä¸€ä¸ªç´¢å¼•åŒ…å«å€¼ 10,11,13å’Œ20ï¼Œç´¢å¼•ä¸Šå¯èƒ½çš„NK é”åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªåŒºé—´ï¼ˆæ³¨æ„å¼€é—­åŒºé—´ï¼‰ 12345(negative infinity, 10](10, 11](11, 13](13, 20](20, positive infinity) Innodbä½¿ç”¨NK é”æ¥è¿›è¡Œç´¢å¼•æœç´¢å’Œæ‰«æï¼Œé˜»æ­¢äº†å¹»è¯»ã€‚ é—´éš™é”åœ¨Innodbä¸­æ˜¯è¢«â€œåè¶³çš„æŠ‘åˆ¶â€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä»¬åªé˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥åˆ°é—´éš™ä¸­ï¼Œä»–ä»¬ä¸é˜»æ­¢å…¶ä»–äº‹ç‰©åœ¨åŒä¸€ä¸ªé—´éš™ä¸ŠèŽ·å¾—é—´éš™é”ã€‚ ä¸‹ç¯‡æ–‡ç« ä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚ MyISAMå’ŒInnoDBå…³äºŽé”æ–¹é¢çš„åŒºåˆ« ç»“è®ºï¼š MyISAMé»˜è®¤ä½¿ç”¨çš„æ˜¯è¡¨çº§é”ï¼Œä¸æ”¯æŒè¡Œçº§é” InnoDBé»˜è®¤ä½¿ç”¨çš„æ˜¯è¡Œçº§é”ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é” æ‰€è°“è¡¨çº§é”ï¼Œå°±æ˜¯é”ä½æ•´å¼ è¡¨ã€‚å¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºçŽ°æ­»é”ï¼Œé”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚çŽ‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½Žã€‚ MyISAMåœ¨æ‰§è¡Œselectçš„æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªè¡¨å…±äº«è¯»é”ï¼Œå½“è¿›è¡Œæ›´æ–°ç­‰æ“ä½œçš„æ—¶å€™ä¼šäº§ç”Ÿè¡¨ç‹¬å å†™é”ï¼ˆæŽ’ä»–é”ï¼‰ã€‚æ‰€ä»¥ï¼š myISAMè¡¨çš„è¯»æ“ä½œï¼Œä¸ä¼šé˜»å¡žå…¶ä»–ç”¨æˆ·å¯¹åŒä¸€ä¸ªè¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡žå¯¹åŒä¸€ä¸ªè¡¨çš„å†™è¯·æ±‚ã€‚ myISAMè¡¨çš„å†™æ“ä½œï¼Œä¼šé˜»å¡žå…¶ä»–ç”¨æˆ·å¯¹åŒä¸€ä¸ªè¡¨çš„è¯»å’Œå†™æ“ä½œã€‚ myISAMè¡¨çš„è¯»ã€å†™æ“ä½œä¹‹é—´ã€ä»¥åŠå†™æ“ä½œä¹‹é—´æ˜¯ä¸²è¡Œçš„ã€‚ è¿™é‡Œçš„è¯»æ˜¯å…±äº«é”ï¼Œä¹Ÿå¯ä»¥å°†å…¶å˜ä¸ºæŽ’ä»–é”ï¼Œè¯­æ³•æ˜¯select â€¦ for update ä¸Šé¢è¯´å®Œäº†MyISAMçš„è¡¨é”ï¼Œä¸‹é¢è¦è¯´è¯´InnoDBå•¦ã€‚InnoDBæ”¯æŒè¡Œçº§é”ã€‚ æ‰€è°“è¡Œçº§é”ï¼Œå°±æ˜¯é”ä½ä¸€è¡Œæ•°æ®ã€‚å¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºçŽ°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚çŽ‡æœ€ä½Žï¼Œå¹¶å‘æ€§ä¹Ÿæœ€é«˜ã€‚ SELECT â€¦ LOCK IN SHARE MODE å’Œ SELECT â€¦ FOR UPDATE å¦‚æžœä½ åœ¨æŸ¥è¯¢æ•°æ®ï¼Œç„¶åŽåœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œæ’å…¥æˆ–è€…ä¿®æ”¹ç›¸å…³çš„æ•°æ®ï¼Œå¸¸è§„çš„ select è¯­å¥ä¸ä¼šæä¾›è¶³å¤Ÿçš„ä¿æŠ¤ã€‚å…¶ä»–çš„äº‹åŠ¡å¯ä»¥ä¿®æ”¹æˆ–è€…åˆ é™¤ä½ æ­£åœ¨æŸ¥è¯¢çš„è¡Œã€‚InnoDB æ”¯æŒä¸¤ç§å¯ä»¥æä¾›å®‰å…¨æœºåˆ¶çš„è¯»å–é”ï¼š SELECT ... LOCK IN SHARE MODE SELECT ... FOR UPDATE SELECT â€¦ LOCK IN SHARE MODE åœ¨è¯»å–çš„è¡Œä¸Šè®¾ç½®ä¸€ä¸ªå…±äº«é”ï¼Œå…¶ä»–çš„sessionå¯ä»¥è¯»è¿™äº›è¡Œï¼Œä½†åœ¨ä½ çš„äº‹åŠ¡æäº¤ä¹‹å‰ä¸å¯ä»¥ä¿®æ”¹å®ƒä»¬ã€‚å¦‚æžœè¿™äº›è¡Œé‡Œæœ‰è¢«å…¶ä»–çš„è¿˜æ²¡æœ‰æäº¤çš„äº‹åŠ¡ä¿®æ”¹ï¼Œä½ çš„æŸ¥è¯¢ä¼šç­‰åˆ°é‚£ä¸ªäº‹åŠ¡ç»“æŸä¹‹åŽä½¿ç”¨æœ€æ–°çš„å€¼ã€‚ ç´¢å¼•æœç´¢é‡åˆ°çš„è®°å½•ï¼ŒSELECT â€¦ FOR UPDATE ä¼šé”ä½è¡ŒåŠä»»ä½•å…³è”çš„ç´¢å¼•æ¡ç›®ï¼Œå’Œä½ å¯¹é‚£äº›è¡Œæ‰§è¡Œ update è¯­å¥ç›¸åŒã€‚å…¶ä»–çš„äº‹åŠ¡ä¼šè¢«é˜»å¡žåœ¨æ¯”å¦‚æ‰§è¡Œ update æ“ä½œï¼ŒèŽ·å–å…±äº«é”ï¼Œæˆ–ä»ŽæŸäº›äº‹åŠ¡éš”ç¦»çº§åˆ«è¯»å–æ•°æ®ç­‰æ“ä½œã€‚ ä½¿ç”¨ SELECT FOR UPDATE ä¸º update æ“ä½œé”å®šè¡Œï¼Œåªé€‚ç”¨äºŽ autocommit è¢«ç¦ç”¨ï¼ˆå½“ä½¿ç”¨ START TRANSACTION å¼€å§‹äº‹åŠ¡æˆ–è€…è®¾ç½® autocommit ä¸º0æ—¶ï¼‰ã€‚å¦‚æžœ autocommit å·²å¯ç”¨ï¼Œç¬¦åˆè§„èŒƒçš„è¡Œä¸ä¼šè¢«é”å®šã€‚ ä»¥ä¸Šæ˜¯å¯¹å®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘è§£è¯»ã€‚ SELECT â€¦ LOCK IN SHARE MODE ï¼šå…±äº«é”(Sé”, share locks)ã€‚å…¶ä»–äº‹åŠ¡å¯ä»¥è¯»å–æ•°æ®ï¼Œä½†ä¸èƒ½å¯¹è¯¥æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œç›´åˆ°æ‰€æœ‰çš„å…±äº«é”è¢«é‡Šæ”¾ã€‚ å¦‚æžœäº‹åŠ¡å¯¹æŸè¡Œæ•°æ®åŠ ä¸Šå…±äº«é”ä¹‹åŽï¼Œå¯è¿›è¡Œè¯»å†™æ“ä½œï¼›å…¶ä»–äº‹åŠ¡å¯ä»¥å¯¹è¯¥æ•°æ®åŠ å…±äº«é”ï¼Œä½†ä¸èƒ½åŠ æŽ’ä»–é”ï¼Œä¸”åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚ SELECT â€¦ FOR UPDATEï¼šæŽ’ä»–é”(Xé”, exclusive locks)ã€‚å¦‚æžœäº‹åŠ¡å¯¹æ•°æ®åŠ ä¸ŠæŽ’ä»–é”ä¹‹åŽï¼Œåˆ™å…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹è¯¥æ•°æ®åŠ ä»»ä½•çš„é”ã€‚èŽ·å–æŽ’ä»–é”çš„äº‹åŠ¡æ—¢èƒ½è¯»å–æ•°æ®ï¼Œä¹Ÿèƒ½ä¿®æ”¹æ•°æ®ã€‚ æ³¨ï¼šæ™®é€š select è¯­å¥é»˜è®¤ä¸åŠ é”ï¼Œè€ŒCUDæ“ä½œé»˜è®¤åŠ æŽ’ä»–é”ã€‚ å½“å‰äº‹åŠ¡èŽ·å–å…±äº«é”åŽï¼Œå¯ä»¥è¯»å†™ï¼Œå…¶ä»–äº‹åŠ¡æ˜¯å¦å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œå’ŒèŽ·å–å…±äº«é”ï¼šå¯ä»¥è¯»ï¼Œå¯ä»¥èŽ·å–å…±äº«é”ï¼Œä¸å¯ä»¥å†™ ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶èŽ·å–å…±äº«é”åŽï¼Œæ˜¯å¦å¯ä»¥è¿›è¡Œupdateæ“ä½œï¼šä¸å¯ä»¥ å½“å‰äº‹åŠ¡èŽ·å–æŽ’ä»–é”åŽï¼Œå…¶ä»–äº‹åŠ¡æ˜¯å¦å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œå’ŒèŽ·å–å…±äº«é”ï¼šå…¶ä»–äº‹åŠ¡å¯ä»¥è¯»ï¼Œä¸å¯ä»¥èŽ·å–å…±äº«é”ï¼Œä¸å¯ä»¥å†™ æ˜¯å¦å¯å¯¹ä¸€æ¡æ•°æ®åŠ å¤šä¸ªæŽ’ä»–é”ï¼šä¸å¯ä»¥ è¡Œé”å’Œç´¢å¼•çš„å…³ç³»ï¼šæŸ¥è¯¢å­—æ®µæœªåŠ ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ã€æ™®é€šç´¢å¼•ç­‰ï¼‰æ—¶ï¼Œä½¿ç”¨è¡¨é” æ³¨ï¼šInnoDBè¡Œçº§é”åŸºäºŽç´¢å¼•å®žçŽ°ã€‚ æœªåŠ ç´¢å¼•æ—¶ï¼Œä¸¤ç§è¡Œé”æƒ…å†µä¸ºï¼ˆä½¿ç”¨è¡¨é”ï¼‰ï¼š äº‹åŠ¡1èŽ·å–æŸè¡Œæ•°æ®å…±äº«é”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„å…±äº«é”ï¼Œä¸å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„æŽ’ä»–é” äº‹åŠ¡1èŽ·å–æŸè¡Œæ•°æ®æŽ’ä»–é”ï¼Œå…¶ä»–äº‹åŠ¡ä¸å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„å…±äº«é”ã€æŽ’ä»–é” åŠ ç´¢å¼•åŽï¼Œä¸¤ç§è¡Œé”ä¸ºï¼ˆä½¿ç”¨è¡Œé”ï¼‰ï¼š äº‹åŠ¡1èŽ·å–æŸè¡Œæ•°æ®å…±äº«é”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„æŽ’ä»–é” äº‹åŠ¡1èŽ·å–æŸè¡Œæ•°æ®æŽ’ä»–é”ï¼Œå…¶ä»–äº‹åŠ¡å¯ä»¥èŽ·å–ä¸åŒè¡Œæ•°æ®çš„å…±äº«é”ã€æŽ’ä»–é” ç´¢å¼•æ•°æ®é‡å¤çŽ‡å¤ªé«˜ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼šå½“è¡¨ä¸­ç´¢å¼•å­—æ®µæ•°æ®é‡å¤çŽ‡å¤ªé«˜ï¼Œåˆ™MySQLå¯èƒ½ä¼šå¿½ç•¥ç´¢å¼•ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ­¤æ—¶ä½¿ç”¨è¡¨é”ã€‚å¯ä½¿ç”¨ force index å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•ã€‚ æ€»ç»“ï¼ˆå¾ˆé‡è¦ï¼‰ MyISAMé»˜è®¤ä½¿ç”¨çš„æ˜¯è¡¨çº§é”ï¼Œä¸æ”¯æŒè¡Œçº§é” æ‰§è¡Œselectçš„æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªè¡¨å…±äº«è¯»é” å½“è¿›è¡Œæ›´æ–°ç­‰æ“ä½œçš„æ—¶å€™ä¼šäº§ç”Ÿè¡¨ç‹¬å å†™é”ï¼ˆæŽ’ä»–é”ï¼‰ è¯»ä¸ä¼šé˜»å¡žå…¶ä»–sessionçš„è¯»ä»¥åŠèŽ·å–è¡¨å…±äº«è¯»é” å†™ä¼šé˜»å¡žå…¶ä»–sessionè¯»å’Œå†™æ“ä½œ å†™ä¸Žè¯»ä¹‹é—´æ˜¯ä¸²è¡Œçš„ InnoDBé»˜è®¤ä½¿ç”¨çš„æ˜¯è¡Œçº§é”ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é” InnoDB æ”¯æŒä¸¤ç§å¯ä»¥æä¾›å®‰å…¨æœºåˆ¶çš„è¯»å–é”ï¼šSELECT â€¦ LOCK IN SHARE MODEä»¥åŠSELECT â€¦ FOR UPDATE SELECT â€¦ LOCK IN SHARE MODE åœ¨è¯»å–çš„è¡Œä¸Šè®¾ç½®ä¸€ä¸ªå…±äº«é” SELECT â€¦ FOR UPDATEï¼šæŽ’ä»–é” ä¸€ä¸ªsessionå¯¹æŸä¸€è¡Œä¸Šå…±äº«é”ï¼Œå…¶ä»–çš„sessionå¯ä»¥è¯»è¿™è¡Œï¼Œä¹Ÿå¯ä»¥èŽ·å–å…±äº«é”ï¼Œä½†æ˜¯ä¸å…è®¸å†™ï¼Œæ›´ä¸å…è®¸èŽ·å–å†™é”ã€‚å¯¹äºŽå…¶ä»–è¡Œï¼Œå¯ä»¥è¯»å†™å…¶ä»–è¡Œæ•°æ®ä¹Ÿå¯ä»¥ä¸Šè¯»å†™é”ã€‚ ä¸€ä¸ªsessionå¯¹æŸä¸€è¡Œä¸ŠæŽ’ä»–é”ï¼Œå…¶ä»–çš„sessionåˆ™ä¸èƒ½åŠ ä»»ä½•é”ï¼ŒåŒ…æ‹¬å…±äº«é”ã€‚å…è®¸è¯»è¿™ä¸€è¡Œï¼Œä½†æ˜¯ä¸èƒ½å†™ã€‚å…è®¸å¯¹å…¶ä»–è¡Œæ•°æ®è¿›è¡Œè¯»å†™ä»¥åŠä¸Šè¯»å†™é”ã€‚ InnoDBä¸­è¡Œçº§é”åŸºäºŽç´¢å¼•å®žçŽ°ï¼Œæ‰€ä»¥åœ¨ä¸åŠ ç´¢å¼•çš„æ—¶å€™ï¼Œè¿™ä¸¤è€…ä¸Šçš„å…¶å®žéƒ½æ˜¯è¡¨é”ï¼›åŠ ä¸Šç´¢å¼•ä¹‹åŽï¼Œä½¿ç”¨è¡Œé”ã€‚ ä»¥ä¸Šçš„å†…å®¹éƒ½æ˜¯ä»Žåšå®¢ï¼šhttps://blog.csdn.net/u012099869/article/details/52778728 ä¸­æ•´ç†è€Œæ¥ï¼Œå…·ä½“çš„å®žéªŒä¹Ÿåœ¨ä»–çš„åšå®¢ä¸­è¿›è¡Œäº†è¯¦ç»†çš„å±•ç¤ºã€‚ MyISAMé€‚åˆåœºæ™¯ é¢‘ç¹æ‰§è¡Œå…¨è¡¨countè¯­å¥(MyISAMå·²ç»ç”¨ä¸€ä¸ªè¡¨ä¿å­˜äº†è¡Œæ•°) å¯¹æ•°æ®è¿›è¡Œå¢žåˆ æ”¹çš„é¢‘çŽ‡ä¸é«˜ï¼ŒæŸ¥è¯¢éžå¸¸é¢‘ç¹ æ²¡æœ‰äº‹åŠ¡ InnoDBé€‚åˆåœºæ™¯ æ•°æ®å¢žåˆ æ”¹æŸ¥éƒ½ç›¸å½“é¢‘ç¹ å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè¦æ±‚æ”¯æŒäº‹åŠ¡]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽç´¢å¼•å¤±æ•ˆå’Œè”åˆç´¢å¼•]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2F%E5%85%B3%E4%BA%8E%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%92%8C%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%2F</url>
    <content type="text"><![CDATA[ç†è§£æœ€å·¦å‰ç¼€åŽŸåˆ™ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…ç´¢å¼•å¤±æ•ˆã€‚ ç´¢å¼•å¤±æ•ˆ æŸ¥è¯¢æ¡ä»¶åŒ…å«or å½“orå·¦å³æŸ¥è¯¢å­—æ®µåªæœ‰ä¸€ä¸ªæ˜¯ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å¤±æ•ˆï¼Œexplainæ‰§è¡Œè®¡åˆ’key=nullï¼›åªæœ‰å½“orå·¦å³æŸ¥è¯¢å­—æ®µå‡ä¸ºç´¢å¼•æ—¶ï¼Œæ‰ä¼šç”Ÿæ•ˆï¼› ç»„åˆç´¢å¼•ï¼Œä¸æ˜¯ä½¿ç”¨ç¬¬ä¸€åˆ—ç´¢å¼•ï¼Œç´¢å¼•å¤±æ•ˆ å¦‚æžœselect * from key1=1 and key2= 2;å»ºç«‹ç»„åˆç´¢å¼•ï¼ˆkey1ï¼Œkey2ï¼‰; select * from key1 = 1;ç»„åˆç´¢å¼•æœ‰æ•ˆï¼› select * from key1 = 1 and key2= 2;ç»„åˆç´¢å¼•æœ‰æ•ˆï¼› select * from key2 = 2;ç»„åˆç´¢å¼•å¤±æ•ˆï¼›ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŽŸåˆ™ like ä»¥%å¼€å¤´ ä½¿ç”¨likeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå½“%åœ¨å‰ç¼€æ—¶ï¼Œç´¢å¼•å¤±æ•ˆï¼› å¦‚ä½•åˆ—ç±»åž‹æ˜¯å­—ç¬¦ä¸²ï¼Œwhereæ—¶ä¸€å®šç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ å½“å…¨è¡¨æ‰«æé€Ÿåº¦æ¯”ç´¢å¼•é€Ÿåº¦å¿«æ—¶ï¼Œmysqlä¼šä½¿ç”¨å…¨è¡¨æ‰«æï¼Œæ­¤æ—¶ç´¢å¼•å¤±æ•ˆ æœ€å·¦å‰ç¼€åŽŸåˆ™ å»ºç«‹ä»¥ä¸‹sqlï¼š 123456789CREATE TABLE IF NOT EXISTS `test_index`( `id` int(4) NOT NULL AUTO_INCREMENT, `a` int(4) NOT NULL DEFAULT '0', `b` int(4) NOT NULL DEFAULT '0', `c` int(4) NOT NULL DEFAULT '0', `data` int(4) NOT NULL DEFAULT '0', PRIMARY KEY (`id`), KEY `union_index` (`a`,`b`,`c`))ENGINE=InnoDB ROW_FORMAT=DYNAMIC DEFAULT CHARSET=binary; æµ‹è¯•çš„mysqlç‰ˆæœ¬æ˜¯ 5.7. é¦–å…ˆä»¥åˆ—aä½œä¸ºæ¡ä»¶æŸ¥è¯¢æ•°æ®ï¼Œæˆ‘ä»¬çœ‹åˆ° type: ref è¡¨ç¤ºå¼•ç”¨æŸ¥æ‰¾, key_len: 4 è¡¨ç¤ºç´¢å¼•é•¿åº¦ä¸º4ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ä¸Šäº†ç´¢å¼•æ¥è¿›è¡ŒæŸ¥æ‰¾: 123456789101112131415explain select data from test_index where a = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 4 ref: const rows: 70 filtered: 100.00 Extra: NULL1 row in set, 1 warning (0.01 sec) ç„¶åŽä»¥åˆ—bä½œä¸ºæ¡ä»¶æŸ¥è¯¢æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°type: ALLè¡¨ç¤ºå…¨è¡¨æŸ¥æ‰¾, key_len: NULL è¡¨ç¤ºæ²¡æœ‰ç´¢å¼•ï¼Œä¹Ÿå°±è¯´æ˜Žå¦‚æžœåªä½¿ç”¨bä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œä¸èƒ½åˆ©ç”¨ç´¢å¼•æ¥åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦. 123456789101112131415explain select data from test_index where b = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: ALLpossible_keys: NULL key: NULL key_len: NULL ref: NULL rows: 716173 filtered: 10.00 Extra: Using where1 row in set, 1 warning (0.00 sec) æŽ¥ç€ä»¥åˆ—cä½œä¸ºæ¡ä»¶æŸ¥è¯¢æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°type: ALLè¡¨ç¤ºå…¨è¡¨æŸ¥æ‰¾, key_len: NULL è¡¨ç¤ºæ²¡æœ‰ç´¢å¼•ï¼Œæƒ…å†µä¸Žç”¨bä½œä¸ºæ¡ä»¶ä¸€æ ·ï¼Œåªä½¿ç”¨cä½œä¸ºæŸ¥è¯¢æ¡ä»¶ä¹Ÿä¸èƒ½åˆ©ç”¨ç´¢å¼•æ¥åŠ å¿«æŸ¥æ‰¾é€Ÿåº¦ 123456789101112131415explain select data from test_index where c = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: ALLpossible_keys: NULL key: NULL key_len: NULL ref: NULL rows: 716173 filtered: 10.00 Extra: Using where1 row in set, 1 warning (0.00 sec) çŽ°åœ¨æ¥æµ‹ä¸€ä¸‹ä½¿ç”¨aã€bä½œä¸ºæ¡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬çœ‹åˆ° type: ref è¡¨ç¤ºå¼•ç”¨æŸ¥æ‰¾, key_len: 8 è¡¨ç¤ºç´¢å¼•é•¿åº¦ä¸º8ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åˆ©ç”¨ä¸Šäº†aã€bè”åˆç´¢å¼•æ¥è¿›è¡ŒæŸ¥æ‰¾ 123456789101112131415explain select data from test_index where a = 1 and b = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 8 ref: const,const rows: 1 filtered: 100.00 Extra: NULL1 row in set, 1 warning (0.00 sec) ç´§æŽ¥ç€æ¥æµ‹ä¸€ä¸‹ä½¿ç”¨aã€cä½œä¸ºæ¡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬çœ‹åˆ° type: ref è¡¨ç¤ºå¼•ç”¨æŸ¥æ‰¾, key_len: 4 è¡¨ç¤ºç´¢å¼•é•¿åº¦ä¸º4ï¼Œè¿™å°±å¥‡æ€ªäº†ï¼ŒæŒ‰ç…§æœ€å·¦åŽŸåˆ™æ¥è¯´ï¼Œaã€cä¸Šæ˜¯ä¸ä¼šå»ºç«‹ç´¢å¼•çš„ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ç´¢å¼•é•¿åº¦å‘¢ï¼Ÿå…¶å®žä¸Žaã€bä¸Šçš„ç´¢å¼•ä¸€æ¯”è¾ƒæˆ‘ä»¬å°±èƒ½å‘çŽ°ï¼Œaã€cä¸Šçš„ç´¢å¼•é•¿åº¦åªæœ‰4ï¼Œè€Œä¸”å•ç‹¬çš„cä¸Šæ˜¯æ²¡æœ‰ç´¢å¼•çš„ï¼Œæ‰€ä»¥4å­—èŠ‚é•¿åº¦çš„ç´¢å¼•åªèƒ½æ˜¯aä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç§æƒ…å†µæˆ‘ä»¬åªä½¿ç”¨äº†aåˆ—ä¸Šçš„ç´¢å¼•æ¥è¿›è¡ŒæŸ¥æ‰¾ 123456789101112131415explain select data from test_index where a = 1 and c = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 4 ref: const rows: 70 filtered: 10.00 Extra: Using index condition1 row in set, 1 warning (0.00 sec) ä¸ºäº†è¿›ä¸€æ­¥éªŒè¯ä¸Šé¢çš„æƒ³æ³•ï¼Œè¿™ä¸€æ¬¡æµ‹ä¸€ä¸‹ä½¿ç”¨bã€cä½œä¸ºæ¡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬çœ‹åˆ° type: ALL è¡¨ç¤ºå…¨è¡¨æŸ¥æ‰¾, key_len: NULL è¡¨ç¤ºæ²¡æœ‰ç´¢å¼•å¯ä»¥ä½¿ç”¨ï¼ŒæŒ‰ç…§æœ€å·¦åŽŸåˆ™æ¥è¯´ï¼Œbåˆ—ä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œcåˆ—ä¸Šä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼ŒåŒæ—¶bã€cçš„ä¸Šä¹Ÿä¸å­˜åœ¨è”åˆç´¢å¼•ï¼Œæ‰€ä»¥ä½¿ç”¨bã€cä½œä¸ºæŸ¥è¯¢æ¡ä»¶æ—¶æ— æ³•åˆ©ç”¨è”åˆç´¢å¼• 123456789101112131415explain select data from test_index where b = 1 and c = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: ALLpossible_keys: NULL key: NULL key_len: NULL ref: NULL rows: 716173 filtered: 1.00 Extra: Using where1 row in set, 1 warning (0.00 sec) æµ‹è¯•å®Œä¸¤ä¸ªæ¡ä»¶çš„æƒ…å†µï¼ŒæŽ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹ä½¿ç”¨aã€bã€cä½œä¸ºæ¡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬çœ‹åˆ° type: ref è¡¨ç¤ºå¼•ç”¨æŸ¥æ‰¾, key_len: 12 è¡¨ç¤ºç´¢å¼•é•¿åº¦ä¸º12ï¼Œè¿™å®Œå…¨ç¬¦åˆè”åˆç´¢å¼•çš„æœ€å·¦åŽŸåˆ™ï¼ŒåŒæ—¶ä½¿ç”¨3ä¸ªæ¡ä»¶æŸ¥è¯¢å¯ä»¥åˆ©ç”¨è”åˆç´¢å¼• 123456789101112131415explain select data from test_index where a = 1 and b = 1 and c = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 12 ref: const,const,const rows: 1 filtered: 100.00 Extra: NULL1 row in set, 1 warning (0.00 sec) ä¸‹é¢è¿™ç§æƒ…å†µä¹Ÿèƒ½åˆ©ç”¨aã€bä¸Šçš„è”åˆç´¢å¼•ï¼Œç´¢å¼•é•¿åº¦ä¸º8 123456789101112131415explain select data from test_index where b = 1 and a = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 8 ref: const,const rows: 1 filtered: 100.00 Extra: NULL1 row in set, 1 warning (0.00 sec) å†æ¥è¯•è¯•è¿™ç§æƒ…å†µï¼ŒæŒ‰ç…§æœ€å·¦åŽŸåˆ™ï¼Œcä¸Šæ²¡æœ‰å»ºç«‹ç´¢å¼•ï¼Œaä¸Šæœ‰ç´¢å¼•ï¼Œcã€aæ²¡æœ‰å»ºç«‹è”åˆç´¢å¼•ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨aä¸Šçš„ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼Œç»“æžœç´¢å¼•é•¿åº¦åªæœ‰4ï¼ŒéªŒè¯äº†æˆ‘ä»¬çš„æƒ³æ³•ï¼Œè”åˆæŸ¥è¯¢æ¡ä»¶ä½¿ç”¨ç´¢å¼•æ—¶æ»¡è¶³â€œäº¤æ¢å¾‹â€ 123456789101112131415explain select data from test_index where c = 1 and a = 1*************************** 1. row *************************** id: 1select_type: SIMPLE table: test_indexpartitions: NULL type: refpossible_keys: union_index key: union_index key_len: 4 ref: const rows: 70 filtered: 10.00 Extra: Using index condition1 row in set, 1 warning (0.00 sec) è”åˆç´¢å¼•æ€»ç»“ è”åˆç´¢å¼•çš„æœ€å·¦åŽŸåˆ™å°±æ˜¯å»ºç«‹ç´¢å¼•KEY union_index (a,b,c)æ—¶ï¼Œç­‰äºŽå»ºç«‹äº†(a)ã€(a,b)ã€(a,b,c)ä¸‰ä¸ªç´¢å¼•ï¼Œä»Žå½¢å¼ä¸Šçœ‹å°±æ˜¯ç´¢å¼•å‘å·¦ä¾§èšé›†ï¼Œæ‰€ä»¥å«åšæœ€å·¦åŽŸåˆ™ï¼Œå› æ­¤æœ€å¸¸ç”¨çš„æ¡ä»¶åº”è¯¥æ”¾åˆ°è”åˆç´¢å¼•çš„ç»„å·¦ä¾§ã€‚ **å¯¹äºŽ&quot;=&quot;å’Œ&quot;in&quot;å¯ä»¥ä¹±åºã€‚**åˆ©ç”¨è”åˆç´¢å¼•åŠ é€ŸæŸ¥è¯¢æ—¶ï¼Œè”åˆæŸ¥è¯¢æ¡ä»¶ç¬¦åˆâ€œäº¤æ¢å¾‹â€ï¼Œä¹Ÿå°±æ˜¯where a = 1 and b = 1 ç­‰ä»·äºŽ where b = 1 and a = 1ã€‚è¿™å½’åŠŸäºŽmysqlæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ŒmysqlæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šåˆ¤æ–­çº æ­£è¿™æ¡sqlè¯­å¥è¯¥ä»¥ä»€ä¹ˆæ ·çš„é¡ºåºæ‰§è¡Œæ•ˆçŽ‡æœ€é«˜ï¼Œæœ€åŽæ‰ç”ŸæˆçœŸæ­£çš„æ‰§è¡Œè®¡åˆ’ã€‚ mysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&lt;,&gt;,between,like)å°±åœæ­¢åŒ¹é…ã€‚æ¯”å¦‚a=3 and b=4 and c&gt;5 and d=6ï¼Œå¦‚æžœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ã€‚å¦‚æžœå»ºç«‹(a,b,d,c)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚ å¯¹äºŽæœ€å·¦åŒ¹é…åŽŸåˆ™çš„ç†è§£ mysqlç´¢å¼•æœ€å·¦åŒ¹é…åŽŸåˆ™çš„ç†è§£?â€“æ²ˆæ°çš„å›žç­” å…¶å®žæˆ‘è§‰å¾—åªè¦ç†è§£ä¸€ç‚¹å°±æ˜¯ï¼Œåªè¦æœ‰æœ€å·¦è¾¹çš„ç´¢å¼•å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªç´¢å¼•ç»“æž„ä¸€å®šæ˜¯æŒ‰ç…§æœ€å·¦ç´¢å¼•å…ƒç´ æŽ’åºçš„ï¼ŒåŽåºçš„ç´¢å¼•å…ƒç´ ä¹Ÿæ˜¯ä¾èµ–äºŽæœ€å·¦å…ƒç´ ä¹‹åŽæ‰æœ‰å¯èƒ½å˜å¾—æœ‰æ„ä¹‰ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLè°ƒä¼˜]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2FMySQL%E8%B0%83%E4%BC%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»‹ç»æœ€åŸºæœ¬çš„sqlè°ƒä¼˜æ‰‹æ®µã€‚ æ ¹æ®æ…¢æ—¥å¿—å®šä½æ…¢æŸ¥è¯¢sql 12&lt;!--è¿™é‡Œæ˜¯ç”¨æ¨¡ç³ŠæŸ¥è¯¢æŸ¥å‡ºå…³äºŽæŸ¥è¯¢çš„ä¸€äº›é…ç½®é¡¹--&gt;show variables like '%query%' æˆ‘ä»¬å…³æ³¨slow_query_logï¼šOFFï¼Œè¡¨ç¤ºæ…¢æŸ¥è¯¢å¤„äºŽå…³é—­çŠ¶æ€ã€‚å…³æ³¨long_query_timeï¼šè¶…å‡ºè¿™ä¸ªæ—¶é—´å°±æ˜¯æ…¢æŸ¥è¯¢ï¼Œè®°å½•åˆ°slow_query_log_fileæ–‡ä»¶ä¸­ã€‚ 1show status like '%slow_queries%' è¿™ä¸€å¥ä½œç”¨æ˜¯ç»Ÿè®¡æ…¢æŸ¥è¯¢çš„æ•°é‡ã€‚ å¦‚ä½•æ‰“å¼€æ…¢æŸ¥è¯¢å‘¢ï¼Ÿ 1234&lt;!--æ‰“å¼€æ…¢æŸ¥è¯¢--&gt;set global slow_query_log = on;&lt;!--æ…¢æŸ¥è¯¢çš„æ ‡å‡†æ˜¯1ç§’--&gt;set global long_query_time = 1; æ³¨æ„è¦é‡å¯ä¸€ä¸‹å®¢æˆ·ç«¯ã€‚æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œé‡å¯æœåŠ¡ç«¯å°±æ°¸ä¹…ä¿ç•™äº†ã€‚ explainåˆ†æžæ…¢æ—¥å¿— ä¸Šä¸€æ­¥æ—¶æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚ä¸‹é¢è¦è¿›è¡Œåˆ†æžã€‚ 1explain select ... å¯¹è¿™ä¸ªå‘½ä»¤è¿›è¡Œåˆ†æžã€‚æœ‰ä¸¤ä¸ªå…³é”®å­—æ®µï¼š typeï¼šè¡¨ç¤ºmysqlæ‰¾åˆ°æ•°æ®è¡Œçš„æ–¹å¼ï¼Œä¸‹é¢çš„é¡ºåºæ˜¯ç”±å¿«åˆ°æ…¢ï¼š system&gt;const&gt; eq_ref&gt;ref&gt;fulltext&gt;ref_or_null&gt;index_merge&gt;unique_subquery&gt;index_subquery&gt;range&gt;index&gt;all å…¶ä¸­indexå’Œallä¸ºå…¨è¡¨æ‰«æã€‚è¯´æ˜Žéœ€è¦ä¼˜åŒ–ã€‚ extraï¼š using_filesortï¼šè¡¨ç¤ºMySQLä¼šå¯¹ç»“æžœä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨ç´¢å¼•æŽ’åºï¼Œè€Œä¸æ˜¯ä»Žè¡¨é‡ŒæŒ‰ç´¢å¼•æ¬¡åºè¯»åˆ°ç›¸å…³å†…å®¹ã€‚å¯èƒ½åœ¨å†…å­˜æˆ–è€…ç£ç›˜ä¸Šè¿›è¡ŒæŽ’åºã€‚MqSQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æŽ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æŽ’åºâ€ using temporaryï¼šè¡¨ç¤ºMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æžœæŽ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äºŽæŽ’åºorder by å’Œåˆ†ç»„æŸ¥è¯¢ group byã€‚ å½“extraä¸­å‡ºçŽ°ä»¥ä¸Šä¸¤é¡¹æ„å‘³ç€MYSQLæ ¹æœ¬ä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œæ•ˆçŽ‡ä¼šå—åˆ°é‡å¤§å½±å“ï¼Œåº”å°½å¯èƒ½å¯¹æ­¤è¿›è¡Œä¼˜åŒ–ã€‚ ä¿®æ”¹sqlæˆ–è€…å°½é‡è®©sqlèµ°ç´¢å¼• ä¸Šä¸€æ­¥åˆ†æžå®Œä¹‹åŽï¼Œå°±è¦é‡‡å–ä¸€å®šçš„æŽªæ–½æ¥ä¿®æ­£ã€‚ å¦‚æžœæ˜¯æ²¡æœ‰åŠ ç´¢å¼•ï¼Œå¯ä»¥å¯¹å…¶åŠ ä¸Šç´¢å¼•ã€‚extraå°±ä¼šå˜æˆusing indexï¼Œè¡¨ç¤ºèµ°äº†ç´¢å¼•ã€‚ ç´¢å¼•æ˜¯è¶Šå¤šè¶Šå¥½å— æ•°æ®é‡å°çš„è¡¨ä¸éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œå»ºç«‹ä¼šå¢žåŠ é¢å¤–çš„ç´¢å¼•å¼€é”€ æ•°æ®å˜æ›´éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œå› æ­¤æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€æ›´å¤šçš„ç»´æŠ¤æˆæœ¬ æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€ä¹Ÿéœ€è¦æ›´å¤šçš„ç©ºé—´ å¯ä»¥ç†è§£ä¸ºï¼Œä¸€ä¸ªå‡ é¡µçš„å®£ä¼ æ‰‹å†Œ å¯¹äºŽå‡ é¡µçš„å®£ä¼ æ‰‹å†Œæˆ‘ä»¬è¿˜éœ€è¦å»ºç«‹ä¸€ä¸ªç›®å½•å—ï¼Ÿ å˜æ›´è¿™ä¸ªå°çš„å®£ä¼ æ‰‹å†Œé‡Œé¢çš„ç« èŠ‚è¿˜è¦ä¿®æ”¹ç›®å½•ä¸æ˜¯æ›´çƒ¦å—ï¼Ÿ ä¸€ä¸ªå®£ä¼ æ‰‹å†Œå†…å®¹å°±ä¸¤é¡µï¼Œç»“æžœä½ çš„ç›®å½•å°±å äº†ä¸€é¡µï¼Œè¿™åˆç†å—ï¼Ÿ]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLç´¢å¼•å…¨é¢è§£è¯»]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2FMySQL%E7%B4%A2%E5%BC%95%E5%85%A8%E9%9D%A2%E8%A7%A3%E8%AF%BB%2F</url>
    <content type="text"><![CDATA[å½»åº•ç†è§£MySQLçš„å­˜å‚¨å¼•æ“Žæ•°æ®ç»“æž„ä»¥åŠèšé›†ç´¢å¼•ã€‚ 1.ä¸ºä»€ä¹ˆéœ€è¦ç´¢å¼• å¦‚æžœä¸ç”¨ç´¢å¼•ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æ–¹æ¡ˆæ˜¯ï¼šå°†æ•°æ®å…¨éƒ¨æˆ–è€…åˆ†æ‰¹æ¬¡åœ°åŠ è½½åˆ°å†…å­˜ï¼Œå› ä¸ºæ•°æ®æ˜¯ä»¥é¡µçš„å½¢å¼å­˜å‚¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è½®è¯¢è¿™äº›é¡µï¼Œæ‰¾å‡ºæœ‰æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚ åœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œæ˜¾ç„¶æ˜¯ä¼šéžå¸¸æ…¢çš„ã€‚å› ä¸ºå®ƒè¦è¿›è¡Œå…¨è¡¨çš„æ‰«æã€‚ è€Œç´¢å¼•çš„çµæ„Ÿæ¥æºäºŽå­—å…¸ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ–°åŽå­—å…¸å‰é¢æœ‰æŒ‰ç…§æ‹¼éŸ³æˆ–è€…æŒ‰åæ—éƒ¨é¦–æŽ’åºçš„ä¸€ä¸ªåˆ—è¡¨é¡µï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ°æ ¹æ®è¿™ä¸ªç´¢å¼•ç›®å½•è¿…é€Ÿå®šä½åˆ°æŸå‡ é¡µï¼Œç„¶åŽæˆ‘ä»¬åˆ°è¿™ä¸ªæŸå‡ é¡µæ‰¾ä¸€ä¸‹å°±å¯ä»¥æ‰¾åˆ°äº†ã€‚ä¸éœ€è¦å…¨è¡¨æ‰«æã€‚ 2.ç´¢å¼•çš„æ•°æ®ç»“æž„ 2.1 äºŒå‰æŸ¥æ‰¾æ ‘ä¸Šé˜µ äºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹ç‚¹ï¼š äºŒåˆ†æœç´¢æ ‘æœ¬è´¨ä¸Šæ˜¯ä¸€æ£µäºŒå‰æ ‘ã€‚ä¸éœ€è¦æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ã€‚ æ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼å¤§äºŽå·¦å­©å­ æ¯ä¸ªèŠ‚ç‚¹çš„é”®å€¼å°äºŽå³å­©å­ ä»¥å·¦å³å­©å­ä¸ºæ ¹çš„å­æ ‘ä»ä¸ºäºŒåˆ†æœç´¢æ ‘ äºŒå‰æŸ¥æ‰¾æ ‘æœ‰ç‚¹å¾ˆæ˜Žæ˜¾ï¼Œæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ªæ•°æ®åªéœ€è¦O(logn)çš„æ—¶é—´ã€‚ä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªè‡´å‘½é—®é¢˜ï¼š æˆ‘ä»¬æœ‰æ—¶ä¼šåˆ é™¤å¢žåŠ æ•°æ®ï¼Œæžçš„ä¸å¥½ï¼Œä¼šæŠŠä»–æ¶åŒ–æˆä¸€ä¸ªé“¾è¡¨ã€‚ ä½†æ˜¯æœ‰çš„åŒå­¦è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çº¢é»‘æ ‘ä¹‹ç±»çš„æ•°æ®ç»“æž„æ¥ç»´æŒä½å¹³è¡¡äºŒå‰æ ‘çš„ç‰¹æ€§ï¼Œè¿™æ ·ä¸å°±å¥½äº†å—ï¼Ÿ è¿™é‡Œè¿˜å­˜åœ¨å¦ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯IOã€‚æˆ‘ä»¬çŸ¥é“ä»Žç£ç›˜æŸ¥è¯¢æ•°æ®ï¼Œå½±å“æ€§èƒ½çš„å…³é”®ç‚¹æ˜¯iOçš„æ¬¡æ•°ï¼Œç„¶åŽè¿™ç§ä¸€ä¸ªèŠ‚ç‚¹åªæœ‰ä¸¤ä¸ªå­©å­ï¼Œåœ¨æµ·é‡æ•°æ®é‡Œï¼ŒIOçš„æ¬¡æ•°è¿˜æ˜¯å¤ªå¤šï¼Œå½±å“æ€§èƒ½ã€‚ æˆ‘ä»¬è¿™ä¸ªæ—¶å€™å°±çŸ¥é“äº†æ–¹å‘ï¼Œæˆ‘ä»¬æƒ³æ‰¾ä¸€ä¸ªæ•°æ®ç»“æž„ï¼Œå®ƒæ—¢åŒ…å«äº†äºŒå‰æ ‘çš„ä¼˜ç‚¹ï¼Œè¿˜è¦æ˜¯å¹³è¡¡çš„æ ‘ï¼Œè¿˜èƒ½ä½¿æ ‘çš„é«˜åº¦å˜çŸ®ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ›´å¤šçš„æ•°æ®ã€‚ 2.2 BTreeä¸Šé˜µ Bæ•°åˆå«å¹³è¡¡å¤šè·¯æŸ¥æ‰¾æ ‘ã€‚Mé˜¶ä»£è¡¨ä¸€ä¸ªæ ‘èŠ‚ç‚¹æœ€å¤šæœ‰å¤šå°‘ä¸ªæŸ¥æ‰¾è·¯å¾„ï¼ŒM=Mè·¯,å½“M=2åˆ™æ˜¯2å‰æ ‘,M=3åˆ™æ˜¯3å‰ æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š æ ¹èŠ‚ç‚¹è‡³å°‘åŒ…å«ä¸¤ä¸ªå­©å­ æŽ’åºæ–¹å¼ï¼šæ‰€æœ‰èŠ‚ç‚¹å…³é”®å­—æ˜¯æŒ‰é€’å¢žæ¬¡åºæŽ’åˆ—ï¼Œå¹¶éµå¾ªå·¦å°å³å¤§åŽŸåˆ™ å­èŠ‚ç‚¹æ•°ï¼šæ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å«mä¸ªå­©å­(m&gt;=2)ï¼›é™¤æ ¹èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹å¤–ï¼Œå…¶ä»–æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ceil(m/2)ä¸ªå­©å­ å…³é”®å­—æ•°ï¼šæžèŠ‚ç‚¹çš„å…³é”®å­—æ•°é‡å¤§äºŽç­‰äºŽceil(m/2)-1ä¸ªä¸”å°äºŽç­‰äºŽm-1ä¸ªï¼ˆåˆ†åˆ«æ¯”å­©å­æ•°å°‘ä¸€ä¸ªï¼‰ æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½ä½äºŽåŒä¸€å±‚ï¼Œå³æ‰€æœ‰å¶å­èŠ‚ç‚¹é«˜åº¦éƒ½ä¸€æ · æˆ‘ä»¬ç»“åˆè¿™ä¸ªå›¾æ¥ç†è§£ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ª3è·¯Bæ ‘ï¼Œæ ¹èŠ‚ç‚¹æœ‰3ä¸ªå­©å­ï¼Œæœ‰2ä¸ªå…³é”®å­—ã€‚æ ¹æ®è§„åˆ™ï¼Œå­èŠ‚ç‚¹æ•°æœ€å¤šä¸ºmä¸ªå³3ä¸ªï¼Œæœ€å°‘ä¸ºceil(1.5)ä¸ªå³2ä¸ªï¼›å…³é”®å­—æ•°æœ€å¤šä¸ºm-1ä¸ªå³2ä¸ªï¼Œæœ€å°‘ä¸ºäºŽceil(1.5)-1ä¸ªå³1ä¸ª. é‚£ä¹ˆæˆ‘ä»¬è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œå…³é”®å­—è¿™é‡Œæœ€å¤šä¸º2ä¸ªï¼Œæ‰€ä»¥å¤§äºŽ2å°±è¦è¿›è¡Œæ‹†åˆ†ã€‚ å¦‚ä½•æ‹†åˆ†å‘¢ï¼Ÿæ‹¿ä¸ªä¾‹å­æ¥ï¼š å®šä¹‰ä¸€ä¸ª5é˜¶æ ‘ï¼ˆå¹³è¡¡5è·¯æŸ¥æ‰¾æ ‘;ï¼‰ï¼ŒçŽ°åœ¨æˆ‘ä»¬è¦æŠŠ3ã€8ã€31ã€11ã€23ã€29ã€50ã€28 è¿™äº›æ•°å­—æž„å»ºå‡ºä¸€ä¸ª5é˜¶æ ‘å‡ºæ¥; é‚£ä¹ˆå…³é”®å­—æœ€å¤šä¸º4ä¸ªï¼Œè¶…è¿‡4ä¸ªå°±æ‹†åˆ†ã€‚ å…ˆæ’å…¥ 3ã€8ã€31ã€11 å†æ’å…¥23ã€29 å†æ’å…¥50ã€28 å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„æµç¨‹ã€‚æ€»ä¹‹è¦ç»´æŠ¤ä¸€ä¸ªä»Žå·¦åˆ°å³é€æ¸å¢žå¤§çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å¹³è¡¡çš„ã€‚(å¤§æ¦‚å¿½ç•¥é‡Œé¢å¯èƒ½å­˜åœ¨çš„ä¸€äº›å°é”™è¯¯ï¼Œç†è§£å…¶ä¸­æ„æ€å³å¯) å¯¹äºŽåˆ é™¤ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¦æ»¡è¶³ä»¥ä¸Šçš„ç‰¹æ€§æ‰è¡Œï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚ å¯¹Bæ ‘æ€»ç»“ä¸€ä¸‹ï¼š Bæ ‘ç›¸å¯¹äºŽå¹³è¡¡äºŒå‰æ ‘çš„ä¸åŒæ˜¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„å…³é”®å­—å¢žå¤šäº†ï¼Œç‰¹åˆ«æ˜¯åœ¨Bæ ‘åº”ç”¨åˆ°æ•°æ®åº“ä¸­çš„æ—¶å€™ï¼Œæ•°æ®åº“å……åˆ†åˆ©ç”¨äº†ç£ç›˜å—çš„åŽŸç†ï¼ˆç£ç›˜æ•°æ®å­˜å‚¨æ˜¯é‡‡ç”¨å—çš„å½¢å¼å­˜å‚¨çš„ï¼Œæ¯ä¸ªå—çš„å¤§å°ä¸º4Kï¼Œæ¯æ¬¡IOè¿›è¡Œæ•°æ®è¯»å–æ—¶ï¼ŒåŒä¸€ä¸ªç£ç›˜å—çš„æ•°æ®å¯ä»¥ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼‰æŠŠèŠ‚ç‚¹å¤§å°é™åˆ¶å’Œå……åˆ†ä½¿ç”¨åœ¨ç£ç›˜å¿«å¤§å°èŒƒå›´ï¼›æŠŠæ ‘çš„èŠ‚ç‚¹å…³é”®å­—å¢žå¤šåŽæ ‘çš„å±‚çº§æ¯”åŽŸæ¥çš„äºŒå‰æ ‘å°‘äº†ï¼Œå‡å°‘æ•°æ®æŸ¥æ‰¾çš„æ¬¡æ•°å’Œå¤æ‚åº¦; 2.3 B+æ ‘ æ˜¯Bæ ‘çš„å˜ä½“ï¼Œå…¶å®šä¹‰åŸºæœ¬ä¸Šä¸ŽBæ ‘æ˜¯å·®ä¸å¤šçš„ã€‚é™¤äº†ï¼š éžå¶å­èŠ‚ç‚¹çš„å­æ ‘æŒ‡é’ˆä¸Žå…³é”®å­—ä¸ªæ•°ç›¸åŒ éžå¶å­èŠ‚ç‚¹ä»…ç”¨æ¥ç´¢å¼•ï¼Œæ•°æ®éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­ æ‰€æœ‰å¶å­èŠ‚ç‚¹å‡æœ‰ä¸€ä¸ªé“¾æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹ è¿™å°±æ˜¯B+æ ‘ç›¸å¯¹äºŽBæ ‘çš„æ”¹è¿›çš„å‡ ä¸ªç‚¹ã€‚ ç”±äºŽæ•°æ®å­˜åœ¨å¶å­èŠ‚ç‚¹ï¼Œä¼˜ç‚¹æ˜¯éžå¶å­èŠ‚ç‚¹ä¿å­˜çš„å…³é”®å­—æ›´å¤šäº†ï¼Œæ ‘çš„é«˜åº¦å°±ä¼šæ›´çŸ®ã€‚ 2.4 æ€»ç»“ B+æ ‘æ›´é€‚åˆç”¨æ¥åšå­˜å‚¨ç´¢å¼•ï¼š B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½Žï¼ˆå› ä¸ºå†…éƒ¨ä¸å­˜æ”¾æ•°æ®ï¼Œä¸€æ¬¡æ€§è¯»å–çš„å…³é”®å­—æ›´å¤šï¼ŒIOæ¬¡æ•°é™ä½Žï¼‰ B+æ ‘çš„æŸ¥è¯¢æ•ˆçŽ‡æ›´åŠ ç¨³å®šï¼ˆä»»ä½•å…³é”®å­—çš„æŸ¥æ‰¾éƒ½è¦åˆ°å¶å­èŠ‚ç‚¹ï¼Œå¯¼è‡´æ¯ä¸ªæŸ¥è¯¢éƒ½å·®ä¸å¤šï¼‰ B+æ ‘æœ‰åˆ©äºŽå¯¹æ•°æ®åº“æ‰«æï¼ˆéåŽ†å¶å­èŠ‚ç‚¹å°±å¯ä»¥ç›´æŽ¥æ‰«ææ•´ä¸ªè¡¨ï¼Œè¿™ä¸ªé€‚åˆåšèŒƒå›´æŸ¥è¯¢ï¼‰ 2.5 Hashç´¢å¼•ä¹Ÿå¯ä»¥è€ƒè™‘ä¸€ä¸‹ Hashç»“æž„å¯ä»¥ä¸€æ¬¡æ€§åœ°å®šä½åˆ°å“åº”ä½ç½®ã€‚å¦‚æžœé‡åˆ°ç¢°æ’žçš„æƒ…å†µï¼Œåªéœ€è¦éåŽ†é“¾è¡¨å³å¯ã€‚é‚£ä¹ˆæ€§èƒ½è¿™ä¹ˆé«˜ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç”¨Hashç´¢å¼•å‘¢ï¼Ÿ å®ƒä¹Ÿæœ‰ç¼ºç‚¹ï¼š åªèƒ½åšç­‰å€¼æ“ä½œï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ hashç´¢å¼•ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºå­˜å‚¨ï¼Œæ— æ³•ä½¿ç”¨äºŽæŽ’åºã€‚ ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢ï¼ˆæ¯”å¦‚ç»„åˆç´¢å¼•ï¼Œhashç´¢å¼•æ˜¯å¯¹è¿™å‡ ä¸ªç´¢å¼•ä¸€èµ·hashè®¡ç®—çš„ï¼Œè€Œæˆ‘ä»¬ç”¨ç»„åˆç´¢å¼•ä¸­çš„éƒ¨åˆ†ç´¢å¼•æ—¶å°±æ— æ³•ç”¨äº†ï¼‰ ä¸èƒ½é¿å…è¡¨æ‰«æï¼ˆä¼šå‡ºçŽ°hashså†²çªï¼Œå¿…ç„¶è¦æ‰«æé‡Œé¢å…·ä½“çš„æ•°æ®æ‰è¡Œï¼‰ é‡åˆ°å¤§é‡hashå€¼ç›¸ç­‰çš„æ—¶å€™æ€§èƒ½ä¸ä¸€å®šæ¯”Bæ ‘é«˜(åŒä¸Š) 3. èšé›†ç´¢å¼• 3.1 ä»€ä¹ˆæ˜¯èšé›†ç´¢å¼• åœ¨èšé›†ç´¢å¼•ä¸­ï¼Œè¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸Žé”®å€¼çš„é€»è¾‘ï¼ˆç´¢å¼•ï¼‰é¡ºåºç›¸åŒã€‚ä¸€ä¸ªè¡¨åªèƒ½åŒ…å«ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚ å¦‚æžœæŸç´¢å¼•ä¸æ˜¯èšé›†ç´¢å¼•ï¼Œåˆ™è¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸Žé”®å€¼çš„é€»è¾‘é¡ºåºä¸åŒ¹é…ã€‚ä¸Žéžèšé›†ç´¢å¼•ç›¸æ¯”ï¼Œèšé›†ç´¢å¼•é€šå¸¸æä¾›æ›´å¿«çš„æ•°æ®è®¿é—®é€Ÿåº¦ã€‚ 3.2 MyISAMå’ŒInnoDBç´¢å¼•å®žçŽ° ç¬¬ä¸€ä¸ªä¸åŒæ˜¯ï¼šInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚è€ŒMyISAMçš„ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€çš„ã€‚ MyISAMå¼•æ“Žä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æž„ï¼Œå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ï¼Œæ˜¯æ²¡æœ‰ä»»ä½•é¡ºåºè€Œè¨€çš„ï¼Œæ‰€ä»¥MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéžèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸ŽInnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚ MyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æžœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åŽä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚ åœ¨MyISAMä¸­ï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æž„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„keyå¯ä»¥é‡å¤ã€‚ InnoDBä¹Ÿä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æž„ã€‚InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œå³ InnoDB è¡¨æ˜¯åŸºäºŽèšç°‡ç´¢å¼•å»ºç«‹çš„ã€‚ MyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ï¼ˆè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡åœ¨dataç›®å½•ä¸‹æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶éªŒè¯ã€‚Innodbæ¯ä¸€ä¸ªæ•°æ®åº“åªæœ‰ä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼Œè€ŒMyisamåˆ™æœ‰ä¸‰ä¸ªï¼ˆæ•°æ®æ–‡ä»¶ã€ç´¢å¼•æ–‡ä»¶ã€è¡¨ç»“æž„æ–‡ä»¶ï¼‰ï¼‰ã€‚ è€Œåœ¨InnoDBä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æž„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚ ä¸Šå›¾æ˜¯InnoDBä¸»ç´¢å¼•ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æ•°æ®æ–‡ä»¶ï¼‰çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ç§ç´¢å¼•å«åšèšé›†ç´¢å¼•ã€‚èšé›†ç´¢å¼•çš„ç¡®å®šè§„åˆ™ä¸ºï¼š è‹¥ä¸€ä¸ªä¸»é”®è¢«å®šä¹‰ï¼Œè¯¥ä¸»é”®åˆ™ä½œä¸ºèšé›†ç´¢å¼• è‹¥æ²¡æœ‰ä¸»é”®è¢«å®šä¹‰ï¼Œè¯¥è¡¨çš„ç¬¬ä¸€ä¸ªå”¯ä¸€éžç©ºç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼• è‹¥ä¸Šè¿°éƒ½æ‰¾ä¸åˆ°ï¼Œinnodbå†…éƒ¨ä¼šç”Ÿæˆä¸€ä¸ªéšè—ä¸»é”®(èšé›†ç´¢å¼•) éžä¸»é”®ç´¢å¼•å­˜å‚¨ç›¸å…³é”®ä½å’Œå…¶å¯¹åº”çš„ä¸»é”®å€¼ï¼ŒåŒ…å«ä¸¤æ¬¡æŸ¥æ‰¾ ç¬¬äºŒä¸ªä¸ŽMyISAMç´¢å¼•çš„ä¸åŒæ˜¯InnoDBçš„è¾…åŠ©ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚ æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚ èšé›†ç´¢å¼•è¿™ç§å®žçŽ°æ–¹å¼ä½¿å¾—æŒ‰ä¸»é”®çš„æœç´¢ååˆ†é«˜æ•ˆï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•èŽ·å¾—ä¸»é”®ï¼Œç„¶åŽç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢èŽ·å¾—è®°å½•ã€‚ äº†è§£ä¸åŒå­˜å‚¨å¼•æ“Žçš„ç´¢å¼•å®žçŽ°æ–¹å¼å¯¹äºŽæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éžå¸¸æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚çŸ¥é“äº†InnoDBçš„ç´¢å¼•å®žçŽ°åŽï¼Œå°±å¾ˆå®¹æ˜“æ˜Žç™½ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚å†ä¾‹å¦‚ï¼Œç”¨éžå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œéžå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½Žæ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢žå­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹© 4. æ€»ç»“ æœ¬æ–‡é¦–å…ˆä»‹ç»çš„æ˜¯ä¸ºä»€ä¹ˆè¦ç´¢å¼•ã€‚è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ã€‚ ç„¶åŽä»‹ç»äº†å‡ ç§æ•°æ®ç»“æž„ï¼šäºŒå‰æœç´¢æ ‘ã€äºŒå‰å¹³è¡¡æ ‘ã€Bæ ‘ä»¥åŠB+æ ‘ã€‚ä¸€æ­¥ä¸€æ­¥å¼•å‡ºä¸ºä»€ä¹ˆæœ€ç»ˆæ˜¯B+æ ‘ã€‚é¢è¯•çš„æ—¶å€™å°±çœ‹è§£å†³ï¼šä¸ºä»€ä¹ˆä¸èƒ½ç”¨äºŒå‰æœç´¢æ ‘ã€ä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘ã€Bæ ‘å’ŒB+æ ‘å„è‡ªçš„æ•°æ®ç»“æž„ç‰¹ç‚¹ã€B+æ ‘çš„ä¼˜ç‚¹ æœ€åŽä»‹ç»äº†èšé›†ç´¢å¼•ï¼Œå› ä¸ºè¿™æ˜¯MyISAMä¸ŽInnoDBç´¢å¼•ç»“æž„æœ€å¤§çš„ä¸åŒã€‚ ä¹‹å‰è¿˜æ˜¯ä¸èƒ½å¤ªå‡†ç¡®ç†è§£èšé›†ç´¢å¼•ï¼Œè¿™ä¸¤ç§å­˜å‚¨å¼•æ“Žéƒ½æ˜¯ä»¥B+æ ‘æ•°æ®ç»“æž„å»ºç«‹ç´¢å¼•ç»“æž„çš„ï¼Œä½†æ˜¯InnoDBæœ¬èº«è¿™ä¸ªB+æ ‘å°±ä½œä¸ºäº†ç´¢å¼•æ–‡ä»¶ï¼Œå³ç´¢å¼•ä¸Žæ•°æ®æ˜¯æ”¾åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥é€»è¾‘ä¸Šè¿™æ ·æŽ’çš„æ•°æ®ï¼Œå®ƒç‰©ç†ä¸Šä¹Ÿæ˜¯è¿™ä¹ˆæŽ’ã€‚ è€ŒMyISAMçš„ç´¢å¼•ç»“æž„(B+æ ‘)ä¸Žæ•°æ®æ˜¯åˆ†ç¦»çš„ï¼Œè™½ç„¶B+æ ‘å¯èƒ½æ˜¯æŒ‰ç…§ä¸»é”®æœ‰åºåœ°ç»„ç»‡ï¼Œä½†æ˜¯è¡¨çš„æ•°æ®åœ¨å¦ä¸€ä¸ªåœ°æ–¹æ˜¯éšæœºæ”¾çš„ï¼Œæ‰¾æ•°æ®æ˜¯æ ¹æ®åœ°å€æ¥æ‰¾å³å¯ï¼Œæ‰€ä»¥è¿™ç§ç»“æž„å°±ä¸æ˜¯èšé›†çš„ã€‚ ç†è§£äº†è¿™ä¸ªï¼Œä¸‹é¢å°±éžå¸¸å¥½ç†è§£äº†ï¼ŒInnoDBè¿™ä¸ªB+æ ‘ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¶å­èŠ‚ç‚¹çš„æ ¸å¿ƒæ•°æ®å°±æ˜¯ä¸»é”®ã€‚æ‰€ä»¥æ˜¯æŒ‰ç…§ä¸»é”®é€’å¢žçš„æ–¹å¼è¿›è¡ŒæŽ’åˆ—ã€‚è¿™æ ·å­ï¼Œæ— è®ºæ˜¯æŒ‰ç…§ä¸»é”®æŽ’åºè¿˜æ˜¯èŒƒå›´æœç´¢ï¼Œéƒ½ä¼šéžå¸¸åœ°å¿«ã€‚ é‚£ä¹ˆå¦‚æžœæ˜¯éžä¸»é”®ç´¢å¼•çš„è¾…åŠ©ç´¢å¼•å‘¢ï¼ŸInnoDBåªèƒ½é€šè¿‡ä¸¤æ¬¡æŸ¥è¯¢æ¥å®žçŽ°äº†ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥æ˜¯æ ¹æ®è¿™ä¸ªè¾…åŠ©ç´¢å¼•æ‰¾åˆ°å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸­çš„ä¸»é”®å€¼ï¼Œç„¶åŽæ ¹æ®ä¸»é”®å†åŽ»ä¸»é”®ç´¢å¼•ä¸­åŽ»æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ã€‚ è€ŒMyISAMç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•å°±åŒºåˆ«ä¸å¤§äº†ã€‚éƒ½æ˜¯å•ç‹¬ä¸€ä¸ªç´¢å¼•ç»“æž„ï¼Œç„¶åŽæ ¹æ®æœ€åŽå¶å­èŠ‚ç‚¹ä¸­çš„è¯¥æ¡æ•°æ®çš„åœ°å€åŽ»æ‰¾ã€‚ ä¸Šé¢è¯´çš„æŒ‰ç…§ä¸»é”®æŽ’åˆ—ï¼Œå°±æ˜¯è¿™é‡Œæ‰€è°“çš„èšé›†ç´¢å¼•å•¦ã€‚å½“ç„¶äº†ï¼Œå¦‚æžœæ²¡æœ‰æŒ‡å®šä¸»é”®ï¼Œä¼šæŒ‰ç…§ä¸Šé¢æ‰€è¯´çš„è§„åˆ™åŽ»æž„å»ºèšé›†ç´¢å¼•ã€‚ é‚£ä¹ˆï¼Œé¢è¯•çš„æ—¶å€™ï¼Œå°±å¯ä»¥åº”å¯¹InnoDBä¸ŽMyISAMç´¢å¼•ç»“æž„çš„å„è‡ªçš„å®žçŽ°å’Œä¸åŒç‚¹å•¦ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“ç´¢å¼•å…¥é—¨]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­æé«˜æ€§èƒ½çš„ä¸€å¤§åˆ©å™¨ã€‚æœ¬ç¯‡å…¥é—¨ç´¢å¼•çš„åŸºæœ¬çŸ¥è¯†ã€‚ 1. ä»€ä¹ˆæ˜¯ç´¢å¼• åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æž„ï¼Œè¿™äº›æ•°æ®ç»“æž„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æž„ä¸Šå®žçŽ°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ç§æ•°æ®ç»“æž„ï¼Œå°±æ˜¯ç´¢å¼•ã€‚ 2. ä¸ºä»€ä¹ˆè¦ç”¨ç´¢å¼• ç´¢å¼•ä¸»è¦å°±æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢é€Ÿåº¦ç”¨çš„ã€‚ 3. ç´¢å¼•çš„ä¸€äº›ç¼ºç‚¹ ç¬¬ä¸€ï¼Œåˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œè¿™ç§æ—¶é—´éšç€æ•°æ®é‡çš„å¢žåŠ è€Œå¢žåŠ ã€‚ ç¬¬äºŒï¼Œç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œå¦‚æžœè¦å»ºç«‹èšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆéœ€è¦çš„ç©ºé—´å°±ä¼šæ›´å¤§ã€‚ ç¬¬ä¸‰ï¼Œå½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢žåŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œè¿™æ ·å°±é™ä½Žäº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚ 4. å“ªäº›å­—æ®µé€‚åˆç”¨ç´¢å¼• åœ¨ç»å¸¸éœ€è¦æœç´¢çš„åˆ—ä¸Šï¼Œå¯ä»¥åŠ å¿«æœç´¢çš„é€Ÿåº¦ï¼› åœ¨ä½œä¸ºä¸»é”®çš„åˆ—ä¸Šï¼Œå¼ºåˆ¶è¯¥åˆ—çš„å”¯ä¸€æ€§å’Œç»„ç»‡è¡¨ä¸­æ•°æ®çš„æŽ’åˆ—ç»“æž„ï¼› åœ¨ç»å¸¸ç”¨åœ¨è¿žæŽ¥çš„åˆ—ä¸Šï¼Œè¿™äº›åˆ—ä¸»è¦æ˜¯ä¸€äº›å¤–é”®ï¼Œå¯ä»¥åŠ å¿«è¿žæŽ¥çš„é€Ÿåº¦ï¼› åœ¨ç»å¸¸éœ€è¦æ ¹æ®èŒƒå›´è¿›è¡Œæœç´¢çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æŽ’åºï¼Œå…¶æŒ‡å®šçš„èŒƒå›´æ˜¯è¿žç»­çš„ï¼› åœ¨ç»å¸¸éœ€è¦æŽ’åºçš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æŽ’åºï¼Œè¿™æ ·æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æŽ’åºï¼ŒåŠ å¿«æŽ’åºæŸ¥è¯¢æ—¶é—´ï¼› åœ¨ç»å¸¸ä½¿ç”¨åœ¨WHEREå­å¥ä¸­çš„åˆ—ä¸Šé¢åˆ›å»ºç´¢å¼•ï¼ŒåŠ å¿«æ¡ä»¶çš„åˆ¤æ–­é€Ÿåº¦ã€‚ï¼ˆè¿™åŒä¸€ï¼‰ 5. ä¸åº”è¯¥åˆ›å»ºç´¢å¼•çš„çš„è¿™äº›åˆ—å…·æœ‰ä¸‹åˆ—ç‰¹ç‚¹ ç¬¬ä¸€ï¼Œå¯¹äºŽé‚£äº›åœ¨æŸ¥è¯¢ä¸­å¾ˆå°‘ä½¿ç”¨æˆ–è€…å‚è€ƒçš„åˆ—ä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ—¢ç„¶è¿™äº›åˆ—å¾ˆå°‘ä½¿ç”¨åˆ°ï¼Œå› æ­¤æœ‰ç´¢å¼•æˆ–è€…æ— ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚ç›¸åï¼Œç”±äºŽå¢žåŠ äº†ç´¢å¼•ï¼Œåè€Œé™ä½Žäº†ç³»ç»Ÿçš„ç»´æŠ¤é€Ÿåº¦å’Œå¢žå¤§äº†ç©ºé—´éœ€æ±‚ã€‚ ç¬¬äºŒï¼Œå¯¹äºŽé‚£äº›åªæœ‰å¾ˆå°‘æ•°æ®å€¼çš„åˆ—ä¹Ÿä¸åº”è¯¥å¢žåŠ ç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºï¼Œç”±äºŽè¿™äº›åˆ—çš„å–å€¼å¾ˆå°‘ï¼Œä¾‹å¦‚äººäº‹è¡¨çš„æ€§åˆ«åˆ—ï¼Œåœ¨æŸ¥è¯¢çš„ç»“æžœä¸­ï¼Œç»“æžœé›†çš„æ•°æ®è¡Œå äº†è¡¨ä¸­æ•°æ®è¡Œçš„å¾ˆå¤§æ¯”ä¾‹ï¼Œå³éœ€è¦åœ¨è¡¨ä¸­æœç´¢çš„æ•°æ®è¡Œçš„æ¯”ä¾‹å¾ˆå¤§ã€‚å¢žåŠ ç´¢å¼•ï¼Œå¹¶ä¸èƒ½æ˜Žæ˜¾åŠ å¿«æ£€ç´¢é€Ÿåº¦ã€‚ ç¬¬ä¸‰ï¼Œå¯¹äºŽé‚£äº›å®šä¹‰ä¸ºtext, imageå’Œbitæ•°æ®ç±»åž‹çš„åˆ—ä¸åº”è¯¥å¢žåŠ ç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºï¼Œè¿™äº›åˆ—çš„æ•°æ®é‡è¦ä¹ˆç›¸å½“å¤§ï¼Œè¦ä¹ˆå–å€¼å¾ˆå°‘ã€‚ ç¬¬å››ï¼Œå½“ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºŽæ£€ç´¢æ€§èƒ½æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºï¼Œä¿®æ”¹æ€§èƒ½å’Œæ£€ç´¢æ€§èƒ½æ˜¯äº’ç›¸çŸ›ç›¾çš„ã€‚å½“å¢žåŠ ç´¢å¼•æ—¶ï¼Œä¼šæé«˜æ£€ç´¢æ€§èƒ½ï¼Œä½†æ˜¯ä¼šé™ä½Žä¿®æ”¹æ€§èƒ½ã€‚å½“å‡å°‘ç´¢å¼•æ—¶ï¼Œä¼šæé«˜ä¿®æ”¹æ€§èƒ½ï¼Œé™ä½Žæ£€ç´¢æ€§èƒ½ã€‚å› æ­¤ï¼Œå½“ä¿®æ”¹æ€§èƒ½è¿œè¿œå¤§äºŽæ£€ç´¢æ€§èƒ½æ—¶ï¼Œä¸åº”è¯¥åˆ›å»ºç´¢å¼•ã€‚ 6. ç´¢å¼•çš„åˆ†ç±» B-Tree ç´¢å¼•ï¼Œ Hash ç´¢å¼•ï¼Œ Fulltext ç´¢å¼•å’ŒR-Tree ç´¢å¼• æœ€ä¸»è¦å…³å¿ƒçš„æ˜¯B-Tree ç´¢å¼•ã€‚ä¸‹é¢å†æä¸€ä¸‹èšé›†ç´¢å¼•ï¼Œå› ä¸ºè¿™æ˜¯innodbæœ€ä¸»è¦çš„ç»„ç»‡æ–¹å¼ã€‚ åœ¨èšé›†ç´¢å¼•ä¸­ï¼Œè¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸Žé”®å€¼çš„é€»è¾‘ï¼ˆç´¢å¼•ï¼‰é¡ºåºç›¸åŒã€‚ä¸€ä¸ªè¡¨åªèƒ½åŒ…å«ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚ å¦‚æžœæŸç´¢å¼•ä¸æ˜¯èšé›†ç´¢å¼•ï¼Œåˆ™è¡¨ä¸­è¡Œçš„ç‰©ç†é¡ºåºä¸Žé”®å€¼çš„é€»è¾‘é¡ºåºä¸åŒ¹é…ã€‚ä¸Žéžèšé›†ç´¢å¼•ç›¸æ¯”ï¼Œèšé›†ç´¢å¼•é€šå¸¸æä¾›æ›´å¿«çš„æ•°æ®è®¿é—®é€Ÿåº¦ã€‚ ä¸‹ä¸€èŠ‚ä¼šè¯¦ç»†è®²åˆ°InnoDBå’ŒMyISAMçš„ç´¢å¼•å®žçŽ°æ–¹å¼ï¼Œä»–ä»¬æœ€å¤§çš„åŒºåˆ«å°±æ˜¯InnoDBæ˜¯èšé›†ç´¢å¼•ï¼Œè€ŒMyISAMä¸æ˜¯ã€‚ 7. å±€éƒ¨æ€§åŽŸç†ä¸Žç£ç›˜é¢„è¯» ç”±äºŽå­˜å‚¨ä»‹è´¨çš„ç‰¹æ€§ï¼Œç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œå†åŠ ä¸Šæœºæ¢°è¿åŠ¨è€—è´¹ï¼Œç£ç›˜çš„å­˜å–é€Ÿåº¦å¾€å¾€æ˜¯ä¸»å­˜çš„å‡ ç™¾åˆ†ä¹‹ä¸€ï¼Œå› æ­¤ä¸ºäº†æé«˜æ•ˆçŽ‡ï¼Œè¦å°½é‡å‡å°‘ç£ç›˜I/Oã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ï¼Œå³ä½¿åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œç£ç›˜ä¹Ÿä¼šä»Žè¿™ä¸ªä½ç½®å¼€å§‹ï¼Œé¡ºåºå‘åŽè¯»å–ä¸€å®šé•¿åº¦çš„æ•°æ®æ”¾å…¥å†…å­˜ã€‚è¿™æ ·åšçš„ç†è®ºä¾æ®æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è‘—åçš„å±€éƒ¨æ€§åŽŸç†ï¼šå½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚ç¨‹åºè¿è¡ŒæœŸé—´æ‰€éœ€è¦çš„æ•°æ®é€šå¸¸æ¯”è¾ƒé›†ä¸­ã€‚ ç”±äºŽç£ç›˜é¡ºåºè¯»å–çš„æ•ˆçŽ‡å¾ˆé«˜ï¼ˆä¸éœ€è¦å¯»é“æ—¶é—´ï¼Œåªéœ€å¾ˆå°‘çš„æ—‹è½¬æ—¶é—´ï¼‰ï¼Œå› æ­¤å¯¹äºŽå…·æœ‰å±€éƒ¨æ€§çš„ç¨‹åºæ¥è¯´ï¼Œé¢„è¯»å¯ä»¥æé«˜I/Oæ•ˆçŽ‡ã€‚ é¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µï¼ˆpageï¼‰çš„æ•´å€æ•°ã€‚é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿žç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œé¡µå¾—å¤§å°é€šå¸¸ä¸º4kï¼‰ï¼Œä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚å½“ç¨‹åºè¦è¯»å–çš„æ•°æ®ä¸åœ¨ä¸»å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå‘ç£ç›˜å‘å‡ºè¯»ç›˜ä¿¡å·ï¼Œç£ç›˜ä¼šæ‰¾åˆ°æ•°æ®çš„èµ·å§‹ä½ç½®å¹¶å‘åŽè¿žç»­è¯»å–ä¸€é¡µæˆ–å‡ é¡µè½½å…¥å†…å­˜ä¸­ï¼Œç„¶åŽå¼‚å¸¸è¿”å›žï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚ 8.Bæ ‘/B+æ ‘ æƒ³è¦ç†è§£ç´¢å¼•åŽŸç†å¿…é¡»æ¸…æ¥šä¸€ç§æ•°æ®ç»“æž„ã€Œå¹³è¡¡æ ‘ã€(éžäºŒå‰)ï¼Œä¹Ÿå°±æ˜¯B treeæˆ–è€… B+ treeï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼šâ€œå¹³è¡¡æ ‘ï¼Œå¹³è¡¡æ ‘ï¼Œå¹³è¡¡æ ‘â€ã€‚å½“ç„¶ï¼Œ æœ‰çš„æ•°æ®åº“ä¹Ÿä½¿ç”¨å“ˆå¸Œæ¡¶ä½œç”¨ç´¢å¼•çš„æ•°æ®ç»“æž„ ï¼Œ ç„¶è€Œï¼Œ ä¸»æµçš„RDBMSéƒ½æ˜¯æŠŠå¹³è¡¡æ ‘å½“åšæ•°æ®è¡¨é»˜è®¤çš„ç´¢å¼•æ•°æ®ç»“æž„çš„ã€‚ æˆ‘ä»¬å¹³æ—¶å»ºè¡¨çš„æ—¶å€™éƒ½ä¼šä¸ºè¡¨åŠ ä¸Šä¸»é”®ï¼Œ åœ¨æŸäº›å…³ç³»æ•°æ®åº“ä¸­ï¼Œ å¦‚æžœå»ºè¡¨æ—¶ä¸æŒ‡å®šä¸»é”®ï¼Œæ•°æ®åº“ä¼šæ‹’ç»å»ºè¡¨çš„è¯­å¥æ‰§è¡Œã€‚ äº‹å®žä¸Šï¼Œ ä¸€ä¸ªåŠ äº†ä¸»é”®çš„è¡¨ï¼Œå¹¶ä¸èƒ½è¢«ç§°ä¹‹ä¸ºã€Œè¡¨ã€ã€‚ä¸€ä¸ªæ²¡åŠ ä¸»é”®çš„è¡¨ï¼Œå®ƒçš„æ•°æ®æ— åºçš„æ”¾ç½®åœ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œä¸€è¡Œä¸€è¡Œçš„æŽ’åˆ—çš„å¾ˆæ•´é½ï¼Œ è·Ÿæˆ‘è®¤çŸ¥ä¸­çš„ã€Œè¡¨ã€å¾ˆæŽ¥è¿‘ã€‚ å¦‚æžœç»™è¡¨ä¸Šäº†ä¸»é”®ï¼Œé‚£ä¹ˆè¡¨åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨ç»“æž„å°±ç”±æ•´é½æŽ’åˆ—çš„ç»“æž„è½¬å˜æˆäº†æ ‘çŠ¶ç»“æž„ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„ã€Œå¹³è¡¡æ ‘ã€ç»“æž„ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ•´ä¸ªè¡¨å°±å˜æˆäº†ä¸€ä¸ªç´¢å¼•ã€‚æ²¡é”™ï¼Œ å†è¯´ä¸€éï¼Œ æ•´ä¸ªè¡¨å˜æˆäº†ä¸€ä¸ªç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ã€Œèšé›†ç´¢å¼•ã€ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œ ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªã€Œèšé›†ç´¢å¼•ã€ï¼Œå› ä¸ºä¸»é”®çš„ä½œç”¨å°±æ˜¯æŠŠã€Œè¡¨ã€çš„æ•°æ®æ ¼å¼è½¬æ¢æˆã€Œç´¢å¼•ï¼ˆå¹³è¡¡æ ‘ï¼‰ã€çš„æ ¼å¼æ”¾ç½®ã€‚ ä¸Šå›¾å°±æ˜¯å¸¦æœ‰ä¸»é”®çš„è¡¨ï¼ˆèšé›†ç´¢å¼•ï¼‰çš„ç»“æž„å›¾ã€‚å…¶ä¸­æ ‘çš„æ‰€æœ‰ç»“ç‚¹ï¼ˆåº•éƒ¨é™¤å¤–ï¼‰çš„æ•°æ®éƒ½æ˜¯ç”±ä¸»é”®å­—æ®µä¸­çš„æ•°æ®æž„æˆï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æˆ‘ä»¬æŒ‡å®šä¸»é”®çš„idå­—æ®µã€‚æœ€ä¸‹é¢éƒ¨åˆ†æ˜¯çœŸæ­£è¡¨ä¸­çš„æ•°æ®ã€‚ å‡å¦‚æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªSQLè¯­å¥ï¼š select * from table where id = 1256; é¦–å…ˆæ ¹æ®ç´¢å¼•å®šä½åˆ°1256è¿™ä¸ªå€¼æ‰€åœ¨çš„å¶ç»“ç‚¹ï¼Œç„¶åŽå†é€šè¿‡å¶ç»“ç‚¹å–åˆ°idç­‰äºŽ1256çš„æ•°æ®è¡Œã€‚ è¿™é‡Œä¸è®²è§£å¹³è¡¡æ ‘çš„è¿è¡Œç»†èŠ‚ï¼Œ ä½†æ˜¯ä»Žä¸Šå›¾èƒ½çœ‹å‡ºï¼Œæ ‘ä¸€å…±æœ‰ä¸‰å±‚ï¼Œ ä»Žæ ¹èŠ‚ç‚¹è‡³å¶èŠ‚ç‚¹åªéœ€è¦ç»è¿‡ä¸‰æ¬¡æŸ¥æ‰¾å°±èƒ½å¾—åˆ°ç»“æžœã€‚å¦‚ä¸‹å›¾ è¿™ä¸€èŠ‚å…ˆå¯¹ç´¢å¼•å…¥ä¸ªé—¨ï¼Œå…³äºŽB+æ ‘ä»¥åŠèšé›†ç´¢å¼•ä¸‹ç¯‡æ–‡ç« æ¥å…·ä½“åˆ†æžã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»åž‹æ•°æ®åº“]]></title>
    <url>%2F2019%2F01%2F26%2Fmysql%2F%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç©ºçš„é¢è¯•é¢˜ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹å¦‚ä½•å›žç­”ã€‚ å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»åž‹æ•°æ®åº“ æˆ‘ä»¬è€ƒè™‘å¼€å‘ä¸€ä¸ªæ•°æ®åº“æœ€é‡è¦çš„æ¨¡å—æ˜¯ä»€ä¹ˆã€‚é¦–å…ˆæ•°æ®å­˜å‚¨æ˜¯å…¶æ ¸å¿ƒåŠŸèƒ½ã€‚å› æ­¤ä¼šæœ‰ä¸€ä¸ªå­˜å‚¨æ¨¡å—æ¥å­˜å‚¨æ•°æ®ã€‚ä»‹è´¨ä¸»è¦æ˜¯ç¡¬ç›˜ã€‚ å¯æ˜¯ï¼Œå…‰æœ‰å­˜å‚¨æ˜¯ä¸è¡Œçš„ã€‚æˆ‘ä»¬éœ€è¦æœ‰ä»¥ä¸‹ç¨‹åºæ¨¡å—å¯¹æ•°æ®è¿›è¡Œç»„ç»‡ã€‚ å­˜å‚¨ç®¡ç† æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®çš„æ ¼å¼å’Œæ–‡ä»¶çš„åˆ†éš”è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ï¼Œé€šè¿‡é€»è¾‘çš„å½¢å¼æ¥ç»„åˆå’Œè¡¨ç¤ºå‡ºæ¥ã€‚ æˆ‘ä»¬çŸ¥é“ç¨‹åºå¤„ç†ï¼Œéœ€è¦å°†æ•°æ®å…ˆåŠ è½½åˆ°å†…å­˜ä¸­åŽ»ï¼Œä¸å¯èƒ½ç›´æŽ¥åœ¨ç¡¬ç›˜ä¸Šè¿›è¡Œå¤„ç†ã€‚ æˆ‘ä»¬é€šè¿‡ioè¯»å–ç£ç›˜æ•°æ®ï¼Œç£ç›˜çš„ioæ˜¯éžå¸¸è€—æ—¶çš„ï¼Œæ‰€ä»¥ç¡¬ç›˜ä»¥é¡µçš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œæ ¹æ®å±€éƒ¨æ€§åŽŸç†ï¼Œå¾€å¾€ç”¨æˆ·è¦æŸ¥è¯¢çš„æ•°æ®å‘¨å›´çš„æ•°æ®ä¹Ÿä¼šè¢«æŸ¥è¯¢åˆ°ï¼Œæ‰€ä»¥å–æ•°æ®éƒ½æ˜¯ä»¥é¡µä¸ºå•ä½æŸ¥å–å¤šä¸ªæ•°æ®ï¼Œæé«˜æ•ˆçŽ‡ã€‚ ç¼“å­˜æœºåˆ¶ ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„ï¼Œä¸€æ¬¡IOä¸ä¼šåªå–ç”¨æˆ·æ‰€éœ€è¦çš„ä¸€ç‚¹æ•°æ®ï¼Œæ‰€ä»¥ä¼šæ¶‰åŠåˆ°ç¼“å­˜ï¼Œç¼“å­˜å¯èƒ½ä¼šä¸å¤Ÿæ”¾ï¼Œé‚£å°±æ¶‰åŠä¸€äº›ç¼“å­˜æ·˜æ±°çš„ç®—æ³•ï¼Œæ¯”å¦‚æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯LRUç®—æ³•ã€‚ SQLè§£æž å°†SQLè¿›è¡Œç¼–è¯‘æ‰§è¡Œã€‚å¦‚ä½•æé«˜SQLè§£æžæ•ˆçŽ‡å‘¢ï¼Ÿå¯èƒ½ä¹Ÿç”¨ç¼“å­˜ï¼Œç¼“å­˜å¥½SQLè§£æžåŽçš„ç»“æžœï¼Œä¸‹æ¬¡å†æ‰§è¡Œä¸€æ ·çš„SQLå°±å¯ä»¥å…åŽ»è§£æžçš„è¿‡ç¨‹ã€‚ æ—¥å¿—ç®¡ç† è¦è®°å½•SQLæ“ä½œï¼Œæ–¹ä¾¿ä¸»ä»ŽåŒæ­¥ã€ç¾éš¾æ¢å¤ç­‰ã€‚è¿™é‡Œè¦äº†è§£ä¸€ä¸‹binlog. æƒé™åˆ’åˆ† å°±æ˜¯æƒé™ã€‚ å®¹ç¾æœºåˆ¶ è¦å¯¹å¼‚å¸¸æƒ…å†µåšå¥½å‡†å¤‡ï¼Œæ¯”å¦‚æ•°æ®åº“æŒ‚äº†æ€Žä¹ˆåŠžã€‚ ç´¢å¼•ç®¡ç† ä¼˜åŒ–æ•°æ®åº“æ‰§è¡Œæ•ˆçŽ‡ã€‚ é”æ¨¡å— ä½¿å¾—æ•°æ®åº“æ”¯æŒå¹¶å‘æ“ä½œã€‚ æ€»ç»“ äº†è§£äº†ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹è¿™ä¸ªé—®é¢˜åšä¸€ä¸ªç®€å•çš„æ€»ç»“æ€§å›žç­”äº†ï¼Œå¦‚ä½•è®¾è®¡å…³ç³»åž‹æ•°æ®åº“å‘¢ï¼Ÿé¦–å…ˆæ•°æ®åº“æœ‰ä¸€ä¸ªå­˜å‚¨çš„åŠŸèƒ½ï¼Œä½¿å¾—å®ƒèƒ½å­˜å‚¨åœ¨æ¯”å¦‚æœºæ¢°ç¡¬ç›˜æˆ–è€…å›ºæ€ç¡¬ç›˜ä¸Šé¢ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­˜å‚¨ç®¡ç†æ¨¡å—æ¥æ˜ å°„ç¨‹åºé€»è¾‘ä¸Žç‰©ç†åœ°å€ï¼Œå®žçŽ°å­˜å‚¨ç®¡ç†ã€‚è¿˜éœ€è¦ç¼“å­˜æœºåˆ¶ï¼Œå¯¹ä¸€äº›æ•°æ®è¿›è¡Œç¼“å­˜æé«˜æ•ˆçŽ‡ï¼Œå¹¶ä¸”ç¼“å­˜ä¸èƒ½å¤ªå¤§ï¼Œå¿…é¡»é…å¤‡ç¼“å­˜æ·˜æ±°æœºåˆ¶ï¼›ç„¶åŽéœ€è¦ä¸€ä¸ªSQLè§£æžæ¨¡å—ï¼Œæ¥è§£æžSQLï¼›ç„¶åŽéœ€è¦æ—¥å¿—ç®¡ç†æ¥æä¾›ä¸»ä»Žèµ‹å€¼ã€ä¸»ä»ŽåŒæ­¥ç­‰åŠŸèƒ½ï¼›è¿˜éœ€è¦ä¸€ä¸ªæƒé™åˆ’åˆ†æ¨¡å—ï¼Œæ¥æä¾›ç»™å¤šç”¨æˆ·ä½¿ç”¨åœºæ™¯ï¼›è¿˜éœ€è¦å®¹ç¾æœºåˆ¶é¢å¯¹å¼‚å¸¸æƒ…å†µï¼›æœ€åŽï¼Œä¸ºäº†æé«˜æ•°æ®æŸ¥è¯¢æ•ˆçŽ‡éœ€è¦æœ‰ç´¢å¼•ç®¡ç†æ¨¡å—ï¼›ä¸ºäº†æ”¯æŒå¹¶å‘æ“ä½œéœ€è¦æœ‰é”æ¨¡å—ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[deleteå’Œtruncateä»¥åŠdropåŒºåˆ«]]></title>
    <url>%2F2019%2F01%2F25%2Fmysql%2Fdelete%E5%92%8Ctruncate%E4%BB%A5%E5%8F%8Adrop%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[è¿™ä¸ªé¢˜ç›®æˆ‘è‡ªå·±ä¹Ÿè¢«é—®è¿‡ï¼Œè¿™é‡Œç®€å•æ•´ç†ä¸€ä¸‹ã€‚ å…ˆæ¥ä¸ªæ€»ç»“ï¼š dropç›´æŽ¥åˆ æŽ‰è¡¨ï¼› truncateåˆ é™¤çš„æ˜¯è¡¨ä¸­çš„æ•°æ®ï¼Œå†æ’å…¥æ•°æ®æ—¶è‡ªå¢žé•¿çš„æ•°æ®idåˆé‡æ–°ä»Ž1å¼€å§‹ï¼› deleteåˆ é™¤è¡¨ä¸­æ•°æ®ï¼Œå¯ä»¥åœ¨åŽé¢æ·»åŠ whereå­—å¥ã€‚ æ—¥å¿—æ˜¯å¦è®°å½• DELETEè¯­å¥æ‰§è¡Œåˆ é™¤æ“ä½œçš„è¿‡ç¨‹æ˜¯æ¯æ¬¡ä»Žè¡¨ä¸­åˆ é™¤ä¸€è¡Œï¼Œå¹¶ä¸”åŒæ—¶å°†è¯¥è¡Œçš„åˆ é™¤æ“ä½œä½œä¸ºäº‹åŠ¡è®°å½•åœ¨æ—¥å¿—ä¸­ä¿å­˜ä»¥ä¾¿è¿›è¡Œè¿›è¡Œå›žæ»šæ“ä½œã€‚ TRUNCATE TABLE åˆ™ä¸€æ¬¡æ€§åœ°ä»Žè¡¨ä¸­åˆ é™¤æ‰€æœ‰çš„æ•°æ®å¹¶ä¸æŠŠå•ç‹¬çš„åˆ é™¤æ“ä½œè®°å½•è®°å…¥æ—¥å¿—ä¿å­˜ï¼Œåˆ é™¤è¡Œæ˜¯ä¸èƒ½æ¢å¤çš„ã€‚å¹¶ä¸”åœ¨åˆ é™¤çš„è¿‡ç¨‹ä¸­ä¸ä¼šæ¿€æ´»ä¸Žè¡¨æœ‰å…³çš„åˆ é™¤è§¦å‘å™¨ã€‚æ‰§è¡Œé€Ÿåº¦å¿«ã€‚ æ˜¯å¦å¯ä»¥å›žæ»š delete è¿™ä¸ªæ“ä½œä¼šè¢«æ”¾åˆ° rollback segment ä¸­,äº‹åŠ¡æäº¤åŽæ‰ç”Ÿæ•ˆã€‚truncateã€dropæ˜¯DLLï¼ˆdata define language),æ“ä½œç«‹å³ç”Ÿæ•ˆï¼ŒåŽŸæ•°æ®ä¸æ”¾åˆ° rollback segment ä¸­ï¼Œä¸èƒ½å›žæ»š. æ‰€ä»¥åœ¨æ²¡æœ‰å¤‡ä»½æƒ…å†µä¸‹ï¼Œè°¨æ…Žä½¿ç”¨ drop ä¸Ž truncateã€‚ è¡¨å’Œç´¢å¼•å çš„ç©ºé—´ å½“è¡¨è¢« TRUNCATE åŽï¼Œè¿™ä¸ªè¡¨å’Œç´¢å¼•æ‰€å ç”¨çš„ç©ºé—´ä¼šæ¢å¤åˆ°åˆå§‹å¤§å°ã€‚ è€Œ DELETE æ“ä½œä¸ä¼šå‡å°‘è¡¨æˆ–ç´¢å¼•æ‰€å ç”¨çš„ç©ºé—´ã€‚ dropè¯­å¥å°†è¡¨æ‰€å ç”¨çš„ç©ºé—´å…¨é‡Šæ”¾æŽ‰ã€‚ TRUNCATE å’Œ DELETE åªåˆ é™¤æ•°æ®ï¼Œè€Œ DROP åˆ™åˆ é™¤æ•´ä¸ªè¡¨ï¼ˆç»“æž„å’Œæ•°æ®ï¼‰ æ‰€ä»¥ä»Žå¹²å‡€ç¨‹åº¦ï¼Œdrop &gt; truncate &gt; delete okï¼Œå·®ä¸å¤šäº†ã€‚]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlæœ€åŸºç¡€çŸ¥è¯†å°ç»“]]></title>
    <url>%2F2019%2F01%2F25%2Fmysql%2Fmysql%E6%9C%80%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%B0%8F%E7%BB%93%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä»‹ç»å…³äºŽæ•°æ®åº“çš„æœ€æœ€æœ€æœ€åŸºæœ¬çš„ä¸€äº›è¯­æ³•çŸ¥è¯†ï¼Œå¦‚æžœè¿™äº›éƒ½ä¸ç†Ÿæ‚‰ï¼Œå»ºè®®å¤šå¤šç»ƒä¹ ï¼Œå› ä¸ºåŽç»­çš„æ–‡ç« ä¼šæ¯”è¾ƒæ·±å…¥åŽŸç†ã€‚ ä¸€ã€DDLè¯­å¥ 1ã€åˆ›å»ºæ•°æ®åº“ï¼šcreate database dbname; 2ã€åˆ é™¤æ•°æ®åº“ï¼šdrop database dbname; 3ã€åˆ›å»ºè¡¨ï¼šcreate table tname; 4ã€åˆ é™¤è¡¨ï¼šdrop table tname; 5ã€ä¿®æ”¹è¡¨ï¼šç•¥ï¼Œæ‡’å¾—çœ‹ äºŒã€DMLè¯­å¥ æ’å…¥ï¼š 1insert into table(å­—æ®µ1ï¼Œå­—æ®µ2ï¼Œ...) values (value1,value2,...) , (value3,value4,..) æ›´æ–°ï¼š 1update table set å­—æ®µ=value where ... åˆ é™¤ï¼š 1delete from table where ... è¿™é‡Œè¦æ³¨æ„ä¸‹deleteå’Œtruncateä»¥åŠdropä¸‰è€…çš„åŒºåˆ«ï¼Œä¸‹ç¯‡æ–‡ç« è¯¦è§£ã€‚ å•è¡¨æŸ¥è¯¢ï¼š 1select å­—æ®µ from table è¿žè¡¨æŸ¥è¯¢æ–¹å¼1ï¼š 1select åˆ«å1.å­—æ®µ,åˆ«å2.å­—æ®µ from table1 åˆ«å1,table2 åˆ«å2 where ... è¿žè¡¨æŸ¥è¯¢æ–¹å¼2ï¼š 1select åˆ«å1.å­—æ®µ,åˆ«å2.å­—æ®µ from table1 åˆ«å1 join table2 åˆ«å2 on ... è¿™æ˜¯å…¨è¿žæŽ¥ï¼Œè¿™é‡Œå°±è¦äº†è§£ä¸€ä¸‹ç¬›å¡å„¿ç§¯ï¼Œç®€å•æ¥è¯´ï¼Œæœ€åŽè¡Œæ•°æ˜¯å·¦è¾¹è¡¨çš„å‡½æ•°ä¹˜ä»¥å³è¾¹è¡¨çš„è¡Œæ•°ã€‚è¯¦ç»†çš„å¯ä»¥è‡ªè¡Œgoogle. æŸ¥è¯¢ä¸é‡å¤çš„è®°å½•ï¼š 1select distinct å­—æ®µ from table ... æŽ’åºï¼šé»˜è®¤æ˜¯å‡åº 1select å­—æ®µ from table where ... order by ... asc/desc limitï¼šä¸»è¦ç”¨äºŽåˆ†é¡µ 1select * from table where ... order by ... asc/desc limit èµ·å§‹åç§»ä½ç½®ï¼Œæ˜¾ç¤ºæ¡æ•° èšåˆï¼š 1select count(*)/avg(..)/sum(...)/max(...)/min(...) from table group by ... having .... æ³¨æ„è¿™é‡Œçš„havingå’Œwhereçš„åŒºåˆ«ï¼šwhereæ˜¯å¯¹è¡¨ç»“æžœè¿›è¡Œç­›é€‰ï¼Œhaving æ˜¯å¯¹æŸ¥è¯¢ç»“æžœè¿›è¡Œç­›é€‰ï¼Œä¸Žgroup by åˆç”¨ å·¦è¿žæŽ¥å’Œå³è¿žæŽ¥ å·¦è¿žæŽ¥æ„æ€å°±æ˜¯å·¦è¡¨ä¸­çš„è®°å½•éƒ½åœ¨ï¼Œå³è¡¨æ²¡æœ‰åŒ¹é…é¡¹å°±ä»¥nullæ˜¾ç¤ºã€‚è®°å½•æ•°ç­‰äºŽå·¦è¡¨çš„è¡Œæ•°ã€‚ å³è¿žæŽ¥ä¸Žä¹‹åŒç†ï¼Œå°½é‡è½¬ä¸ºå·¦è¿žæŽ¥åšã€‚ å­æŸ¥è¯¢ï¼š 1select * from table where ... in (select ....) æ‰€è°“å­æŸ¥è¯¢å°±æ˜¯æ ¹æ®å¦ä¸€ä¸ªselectçš„ç»“æžœå†è¿›è¡Œç­›é€‰ï¼Œå¸¸ç”¨çš„æ˜¯in,not in,=,!=,exits,not exits union ä¸»è¦ç”¨äºŽä¸¤å¼ è¡¨ä¸­çš„æ•°æ®çš„åˆå¹¶ï¼š 1select å­—æ®µ from table1 union all select å­—æ®µ from table2 è¦æƒ³ä¸é‡å¤ç”¨union]]></content>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€äº›å¸¸è§çš„é¢è¯•é¢˜]]></title>
    <url>%2F2019%2F01%2F25%2Fnetwork%2F8.%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E9%9D%A2%E8%AF%95%E9%A2%98%2F</url>
    <content type="text"><![CDATA[å¯¹è¿™ä¸€å—æ•´ç†ä¸€äº›å¸¸è§çš„é¢è¯•é¢˜ã€‚ 1.TCPä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ è¿™éƒ¨åˆ†ç•¥ã€‚å‰é¢å·²ç»è¯´çš„å¾ˆè¯¦ç»†ï¼ŒåŒ…æ‹¬æ¡æ‰‹ä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡ã€ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡ï¼Œä¸ºä»€ä¹ˆæŒ¥æ‰‹è¦ç­‰2MSLçš„æ—¶é—´ã€‚ 2.å¸¸è§çš„HTTPçŠ¶æ€ç åŠå…¶å«ä¹‰ 200 OKï¼šæ­£å¸¸è¿”å›žä¿¡æ¯ 400 Bad Reqestï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£ 401 Unauthorizedï¼šè¯·æ±‚æœªç»æŽˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ç å¿…é¡»ä¸ŽWWW-AuthenticateæŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨ 403 Forbiddenï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡ 404 Not Foundï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ 500 Internal Server Errorï¼šæœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯ 503 Server Unavilableï¼šæœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åŽå¯èƒ½æ¢å¤æ­£å¸¸ 3.Getè¯·æ±‚å’ŒPostè¯·æ±‚çš„åŒºåˆ« HttpæŠ¥æ–‡å±‚é¢ï¼šGETå°†è¯·æ±‚ä¿¡æ¯æ”¾åœ¨URLï¼ŒPOSTåˆ™æ”¾åœ¨æŠ¥æ–‡ä½“ä¸­ æ•°æ®åº“å±‚é¢ï¼šGETç¬¦åˆå¹‚ç­‰æ€§å’Œå®‰å…¨æ€§(æŸ¥è¯¢ä¸ä¼šæ”¹å˜æ•°æ®åº“)ï¼ŒPOSTä¸ç¬¦åˆ å…¶ä»–å±‚é¢ï¼šGETå¯ä»¥è¢«ç¼“å­˜ã€è¢«å­˜å‚¨ä¸ºä¹¦ç­¾ï¼Œè€ŒPOSTä¸è¡Œ 4.Cookieå’ŒSessionçš„åŒºåˆ« å¯¹äºŽsessionï¼Œå­—é¢ä¸Šç†è§£æ˜¯ä¼šè¯ï¼Œå¯ä»¥ç†è§£ä¸ºç”¨æˆ·ä¸ŽæœåŠ¡ç«¯ä¸€å¯¹ä¸€çš„äº¤äº’ã€‚æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µã€‚ ä½†æ˜¯æˆ‘ä»¬å¸¸è¯´çš„sessionå…¶å®žæ˜¯è¿™é‡ŒæŠ½è±¡æ¦‚å¿µçš„ä¸€ç§å®žçŽ°æ–¹å¼ç½¢äº†ï¼Œæˆ‘è§‰å¾—æ²¡æœ‰å¿…è¦å’¬æ–‡åš¼å­—ï¼Œä¸‹é¢ç›´æŽ¥ä»Žé¢è¯•è§’åº¦æ¥åˆ†æžä¸€ä¸‹ã€‚ ç”±äºŽHTTPåè®®æ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦è®°å½•ç”¨æˆ·çš„çŠ¶æ€æ—¶ï¼Œå°±éœ€è¦ç”¨æŸç§æœºåˆ¶æ¥è¯†å…·ä½“çš„ç”¨æˆ·ï¼Œè¿™ä¸ªæœºåˆ¶å°±æ˜¯Session.å…¸åž‹çš„åœºæ™¯æ¯”å¦‚è´­ç‰©è½¦ï¼Œå½“ä½ ç‚¹å‡»ä¸‹å•æŒ‰é’®æ—¶ï¼Œç”±äºŽHTTPåè®®æ— çŠ¶æ€ï¼Œæ‰€ä»¥å¹¶ä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œæ‰€ä»¥æœåŠ¡ç«¯è¦ä¸ºç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºäº†ç‰¹å®šçš„Sessionï¼Œç”¨ç”¨äºŽæ ‡è¯†è¿™ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”è·Ÿè¸ªç”¨æˆ·ï¼Œè¿™æ ·æ‰çŸ¥é“è´­ç‰©è½¦é‡Œé¢æœ‰å‡ æœ¬ä¹¦ã€‚ è¿™ä¸ªSessionæ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ï¼Œæœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªå”¯ä¸€æ ‡è¯†å¯¹åº”ä¸€ä¸ªç”¨æˆ·ã€‚åœ¨æœåŠ¡ç«¯ä¿å­˜Sessionçš„æ–¹æ³•å¾ˆå¤šï¼Œå†…å­˜ã€æ•°æ®åº“ã€æ–‡ä»¶éƒ½æœ‰ã€‚ æœåŠ¡ç«¯è§£å†³äº†ç”¨æˆ·æ ‡è¯†é—®é¢˜ï¼Œä½†æ˜¯æœåŠ¡ç«¯æ€Žä¹ˆçŸ¥é“æ­¤æ—¶æ“ä½œæµè§ˆå™¨çš„ç”¨æˆ·æ˜¯è°å‘¢ï¼Ÿ è¿™ä¸ªæ—¶å€™Cookieå°±ç™»åœºäº†ã€‚æ¯æ¬¡HTTPè¯·æ±‚çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šå‘é€ç›¸åº”çš„Cookieä¿¡æ¯åˆ°æœåŠ¡ç«¯ã€‚ å®žé™…ä¸Šå¤§å¤šæ•°çš„åº”ç”¨éƒ½æ˜¯ç”¨ Cookie æ¥å®žçŽ°Sessionè·Ÿè¸ªçš„ï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºSessionçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šåœ¨HTTPåè®®ä¸­å‘Šè¯‰å®¢æˆ·ç«¯(æ”¾åœ¨å“åº”å¤´ä¸­è¿”å›ž)ï¼Œéœ€è¦åœ¨ Cookie é‡Œé¢è®°å½•ä¸€ä¸ªSession IDï¼Œä»¥åŽæ¯æ¬¡è¯·æ±‚(è¯·æ±‚å¤´)æŠŠè¿™ä¸ªä¼šè¯IDå‘é€åˆ°æœåŠ¡å™¨ï¼Œæˆ‘å°±çŸ¥é“ä½ æ˜¯è°äº†ã€‚ æœ‰äººé—®ï¼Œå¦‚æžœå®¢æˆ·ç«¯çš„æµè§ˆå™¨ç¦ç”¨äº† Cookie æ€Žä¹ˆåŠžï¼Ÿä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ä¸€ç§å«åšURLé‡å†™çš„æŠ€æœ¯æ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼Œå³æ¯æ¬¡HTTPäº¤äº’ï¼ŒURLåŽé¢éƒ½ä¼šè¢«é™„åŠ ä¸Šä¸€ä¸ªè¯¸å¦‚ sid=xxxxx è¿™æ ·çš„å‚æ•°ï¼ŒæœåŠ¡ç«¯æ®æ­¤æ¥è¯†åˆ«ç”¨æˆ·ã€‚ Cookieå…¶å®žè¿˜å¯ä»¥ç”¨åœ¨ä¸€äº›æ–¹ä¾¿ç”¨æˆ·çš„åœºæ™¯ä¸‹ï¼Œè®¾æƒ³ä½ æŸæ¬¡ç™»é™†è¿‡ä¸€ä¸ªç½‘ç«™ï¼Œä¸‹æ¬¡ç™»å½•çš„æ—¶å€™ä¸æƒ³å†æ¬¡è¾“å…¥è´¦å·äº†ï¼Œæ€Žä¹ˆåŠžï¼Ÿè¿™ä¸ªä¿¡æ¯å¯ä»¥å†™åˆ°Cookieé‡Œé¢ï¼Œè®¿é—®ç½‘ç«™çš„æ—¶å€™ï¼Œç½‘ç«™é¡µé¢çš„è„šæœ¬å¯ä»¥è¯»å–è¿™ä¸ªä¿¡æ¯ï¼Œå°±è‡ªåŠ¨å¸®ä½ æŠŠç”¨æˆ·åç»™å¡«äº†ï¼Œèƒ½å¤Ÿæ–¹ä¾¿ä¸€ä¸‹ç”¨æˆ·ã€‚è¿™ä¹Ÿæ˜¯Cookieåç§°çš„ç”±æ¥ï¼Œç»™ç”¨æˆ·çš„ä¸€ç‚¹ç”œå¤´ã€‚ æ€»ç»“ï¼š Sessionæ˜¯åœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¸€ä¸ªæ•°æ®ç»“æž„ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥ä¿å­˜åœ¨é›†ç¾¤ã€æ•°æ®åº“ã€æ–‡ä»¶ä¸­ï¼› Cookieæ˜¯å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å®žçŽ°Sessionçš„ä¸€ç§æ–¹å¼ã€‚ ä¸‹é¢è¯´ä¸€ä¸‹å¾ˆå¸¸è§çš„ä¸€ç§å†™æ³•ã€‚æ¯”å¦‚åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘æ­¤æ—¶ç™»é™†ä½ çš„ç½‘ç«™äº†ï¼Œä½ å¯ä»¥å°†æˆ‘çš„ä¿¡æ¯ä¿å­˜åœ¨sessionä¸­ï¼š 12User currentUserInfo = userService.getUserByUsernameAndPasswd(username,password);session.setAttribute("currentUser",currentUserInfo); ä¸‹æ¬¡ï¼Œæˆ‘å°±å¯ä»¥åœ¨æˆ‘ä»¬ä¹‹é—´çš„ä¼šè¯ä¸­éšæ—¶èŽ·å–æˆ‘çš„ä¸ªäººä¿¡æ¯ï¼š 1User currentUser = session.getAttribute("currentUser"); å…¶å®žè¿™äº›å°±æ˜¯åˆ©ç”¨å­˜æ”¾åœ¨Cookieä¸­çš„JSESSIONIDæ¥å®žçŽ°çš„ã€‚ 5.HTTPå’ŒHRTTPSçš„å…³ç³» æ¥è¯´ä¸€ä¸‹SSL(Security Sockets Layerï¼Œå®‰å…¨å¥—æŽ¥å±‚) ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®® æ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–çš„APIï¼ŒSSL3.0ä¹‹åŽæ›´åä¸ºTLS é‡‡ç”¨èº«ä»½éªŒè¯å’Œæ•°æ®åŠ å¯†ä¿è¯ç½‘ç»œé€šä¿¡çš„å®‰å…¨å’Œæ•°æ®çš„å®Œæ•´æ€§ HTTPSæ•°æ®ä¼ è¾“æµç¨‹ï¼š æµè§ˆå™¨å°†æ”¯æŒçš„åŠ å¯†ç®—æ³•ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ æœåŠ¡å™¨é€‰æ‹©ä¸€å¥—æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†ç®—æ³•ï¼Œä»¥è¯ä¹¦çš„å½¢å¼å›žå‘æµè§ˆå™¨ æµè§ˆå™¨éªŒè¯è¯ä¹¦åˆæ³•æ€§ï¼Œå¹¶ç»“åˆè¯ä¹¦å…¬é’¥åŠ å¯†ä¿¡æ¯å‘ç»™æœåŠ¡å™¨ æœåŠ¡å™¨ä½¿ç”¨ç§é’¥è§£å¯†ä¿¡æ¯ï¼ŒéªŒè¯å“ˆå¸Œï¼ŒåŠ å¯†å“åº”æ¶ˆæ¯å›žå‘æµè§ˆå™¨ æµè§ˆå™¨è§£å¯†å“åº”æ¶ˆæ¯ï¼Œå¹¶å¯¹æ¶ˆæ¯è¿›è¡ŒéªŒè¯ï¼Œä¹‹åŽè¿›è¡ŒåŠ å¯†äº¤äº’æ•°æ® è¿™ä¸ªä¹Ÿå°±ä¸èµ˜è¿°äº†ï¼Œä¸‹é¢ç›´æŽ¥è¯´è¯´åŒºåˆ«ã€‚ HTTPSéœ€è¦åˆ°CAç”³è¯·è¯ä¹¦ï¼ŒHTTPä¸éœ€è¦ HTTPSå¯†æ–‡ä¼ è¾“ï¼ŒHTTPæ˜Žæ–‡ä¼ è¾“ è¿žæŽ¥æ–¹å¼ä¸åŒï¼ŒHTTPSé»˜è®¤ä½¿ç”¨443ç«¯å£ï¼ŒHTTPä½¿ç”¨80ç«¯å£ HTTPS=HTTP+åŠ å¯†+è®¤è¯+å®Œæ•´æ€§ä¿æŠ¤ï¼Œæ›´å®‰å…¨ ä½†æ˜¯ä»ç„¶å­˜åœ¨ä¸€å®šçš„é£Žé™©ï¼š æµè§ˆå™¨é»˜è®¤å¡«å……http://ï¼Œè¯·æ±‚éœ€è¦è¿›è¡Œè·³è½¬ï¼Œæœ‰è¢«åŠ«æŒçš„é£Žé™© å¯ä»¥ä½¿ç”¨HSTS(HTTP Strict Transport Security)ä¼˜åŒ–ï¼ˆè¿™ä¸ªè¿˜ä¸æœªä¸»æµï¼Œé¢è¯•é—®çš„å°‘ï¼‰ Socketç®€ä»‹ æˆ‘ä»¬çŸ¥é“ï¼Œè¿›ç¨‹ä¸Žè¿›ç¨‹ç›´æŽ¥çš„é€šä¿¡æœ€åŸºæœ¬çš„è¦æ±‚æ˜¯ï¼šå¯ä»¥å”¯ä¸€ç¡®å®šè¿›ç¨‹ã€‚ åœ¨æœ¬åœ°è¿›ç¨‹é€šä¿¡ä¸­ï¼Œå¯ä»¥ç”¨PIDæ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ã€‚ ä½†æ˜¯PIDåªåœ¨æœ¬åœ°å”¯ä¸€ï¼Œç½‘ç»œä¸­PIDå†²çªçš„å‡ çŽ‡è¿˜æ˜¯å­˜åœ¨çš„ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œåˆ°IPå±‚å°±å¯ä»¥å”¯ä¸€å®šä½åˆ°ä¸€å°ä¸»æœºäº†ï¼ŒTCPå±‚(tcpåè®®+ç«¯å£å·)å¯ä»¥å”¯ä¸€å®šä½ä¸€å°ä¸»æœºä¸­çš„ä¸€ä¸ªè¿›ç¨‹ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ipåœ°å€+åè®®+ç«¯å£å·å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€å°ä¸»æœºçš„ä¸€ä¸ªè¿›ç¨‹ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡socketè¿›è¡Œç½‘ç»œé€šä¿¡äº†ã€‚ socketæ˜¯å¯¹TCP/IPåè®®çš„æŠ½è±¡ï¼Œæ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–å¼€æ”¾çš„æŽ¥å£ã€‚ socketèµ·æºäºŽunixï¼Œè€Œunixæ˜¯éµä»Žä¸€åˆ‡çš†æ–‡ä»¶çš„å“²å­¦ã€‚Socketæ˜¯ä¸€ç§åŸºäºŽä»Žæ‰“å¼€ã€è¯»/å†™ã€å…³é—­çš„æ¨¡å¼å®žçŽ°çš„ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å„è‡ªç»´æŠ¤ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿žæŽ¥å»ºç«‹åŽï¼Œå¯ä»¥ä¾›å¯¹æ–¹è¯»å–æˆ–è€…è¯»å–å¯¹æ–¹å†…å®¹ã€‚ socketç›¸å…³é¢˜ç›® ç¼–å†™ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å­—ç¬¦ä¸²ä¹‹åŽæ‰“å°åˆ°å‘½ä»¤è¡Œä¸Šï¼Œç„¶åŽå‘å®¢æˆ·ç«¯è¿”å›žè¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæœ€åŽï¼Œå®¢æˆ·ç«¯è¾“å‡ºæœåŠ¡ç«¯è¿”å›žçš„è¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ†åˆ«ç”¨TCPå’ŒUDPä¸¤ç§æ–¹å¼åŽ»å®žçŽ°ã€‚ ä»£ç åœ°å€ï¼šhttps://github.com/sunweiguo/TcpAndUdp/]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JAVAåŸºç¡€æ ¸å¿ƒ-ç†è§£ç±»ã€å¯¹è±¡ã€é¢å‘å¯¹è±¡ç¼–ç¨‹ã€é¢å‘æŽ¥å£ç¼–ç¨‹]]></title>
    <url>%2F2019%2F01%2F24%2Fjava-basic%2FJAVA%E5%9F%BA%E7%A1%80%E6%A0%B8%E5%BF%83-%E7%90%86%E8%A7%A3%E7%B1%BB%E3%80%81%E5%AF%B9%E8%B1%A1%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%E3%80%81%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯ç±»ï¼Œä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Œä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä»€ä¹ˆæ˜¯é¢å‘æŽ¥å£ç¼–ç¨‹ã€‚å­¦ä¹ é¢å‘å¯¹è±¡æ€æƒ³çš„è¯­è¨€ï¼Œæ¯”å¦‚javaï¼Œç¬¬ä¸€å…³å¯èƒ½å°±æ˜¯è¦ç†è§£è¿™äº›æ¦‚å¿µã€‚ä¸‹é¢å°±æ¥å¥½å¥½ç¢ç£¨ä¸€ä¸‹ã€‚ ç±»å’Œå¯¹è±¡çš„æ¦‚å¿µ é¦–å…ˆæ€»ç»“ä¸€ä¸‹ï¼šç±»æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯¹è±¡å°±æ˜¯ç”¨è¿™ä¸ªæ¨¡æ¿åˆ›é€ å‡ºæ¥çš„ä¸œè¥¿ã€‚ æ¯”å¦‚ï¼Œç”·å­©ï¼Œä»–å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œç”·çš„å°±è¡Œï¼Œé‚£ä¹ˆå¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯å…·ä½“æŸä¸ªç”·å­©ï¼Œæ¯”å¦‚ç”·å­©BOBï¼Œç”·å­©fourColor. è¯·çœ‹ä¸‹é¢ä¸€å¼ å›¾ï¼š ç”·å­©å¥³å­©æ˜¯æ¯”è¾ƒæŠ½è±¡çš„æ¦‚å¿µï¼Œæ˜¯æ¨¡æ¿ï¼Œå·¦è¾¹ä¸€æŽ’å°±æ˜¯å…¶å…·ä½“çš„ä¸€äº›å¯¹è±¡ã€‚ä½ çœ‹é•¿çš„éƒ½ä¸ä¸€æ ·ï¼Œæœ‰çš„é»‘ï¼Œæœ‰çš„ç™½ï¼Œæœ‰çš„é«˜ï¼Œæœ‰çš„çŸ®ï¼Œå›½å®¶åœ°åŒºä¹Ÿä¸ä¸€æ ·ã€‚ä½†æ˜¯ä»–ä»¬éƒ½å±žäºŽç”·å­©æˆ–è€…å¥³å­©ã€‚ é‚£ä¹ˆåŒç†ï¼Œäººå°±æ˜¯ä¸€ä¸ªç±»ï¼Œç”·å­©å¥³å­©å°±æ˜¯äººçš„å­ç±»ï¼Œå› ä¸ºäººå¯èƒ½ä¸ä»…åŒ…æ‹¬ç”·å­©å¥³å­©ï¼Œè¿˜åŒ…æ‹¬ç¬¬ä¸‰æ€§åˆ«è¿™ä¸ªç±»ã€‚ è¿™é‡Œè¿˜å¼•å‡ºäº†JAVAç‰¹æ€§ä¸­çš„ç»§æ‰¿ã€‚ç»§æ‰¿ç®€å•ç†è§£å°±æ˜¯çˆ¶ç±»æœ‰çš„ä¸œè¥¿(è®¿é—®çº§åˆ«ä¸èƒ½æ˜¯private)çš„ï¼Œé‚£éƒ½æ˜¯ä½ çš„ã€‚æ¯”å¦‚ä½ è€çˆ¸çš„æˆ¿å­ï¼Œå°±æ˜¯å±žäºŽä½ çš„ï¼Œä½ å‡ºå…¥è‡ªç”±ã€‚ äººè¿˜å¯ä»¥åˆ†ä¸ºèƒ–äººå’Œç˜¦äººè¿™ä¸ªå­ç±»ã€‚æ‰€ä»¥åªè¦æ˜¯æŠ½è±¡çš„æ¨¡æ¿ï¼Œå°±æ˜¯ä¸€ä¸ªç±»ã€‚ å¯¹è±¡ï¼šå¯¹è±¡æ˜¯ç±»çš„ä¸€ä¸ªå®žä¾‹ï¼ˆå¯¹è±¡ä¸æ˜¯æ‰¾ä¸ªå¥³æœ‹å‹ï¼‰ï¼Œæœ‰çŠ¶æ€å’Œè¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä¸€æ¡ç‹—æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„çŠ¶æ€æœ‰ï¼šé¢œè‰²ã€åå­—ã€å“ç§ï¼›è¡Œä¸ºæœ‰ï¼šæ‘‡å°¾å·´ã€å«ã€åƒç­‰ã€‚ ç±»ï¼šç±»æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå®ƒæè¿°ä¸€ç±»å¯¹è±¡çš„è¡Œä¸ºå’ŒçŠ¶æ€ã€‚ ä¸‹é¢å°±æ‹¿ç‹—è¿™ä¸ªç±»æ¥è¯´äº‹ã€‚ç‹—æ˜¯åŠ¨ç‰©è¿™ä¸ªç±»çš„å­ç±»ã€‚ Javaä¸­åˆ›å»ºç±» æž„é€ å™¨æ–¹æ³•è¯´æ˜Ž éœ€è¦åˆ›é€ ä¸€ä¸ªç±»å¯¹è±¡å‡ºæ¥çš„æ—¶å€™ï¼Œè¦ç”¨åˆ°è¿™ä¸ªç±»çš„æž„é€ å™¨æ–¹æ³•ï¼Œé‚£ä¹ˆå•¥æ˜¯æž„é€ å™¨æ–¹æ³•å‘¢ï¼Ÿæž„é€ å™¨æ–¹æ³•å°±æ˜¯åˆ›é€ ç±»æ—¶çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå’Œç±»åŒåçš„æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨é‡Œé¢å†™è‡ªå·±çš„ä»£ç  1234567891011121314151617181920//æ¨¡ç‰ˆclass ç±»åç§° &#123; è®¿é—®æƒé™ æž„é€ æ–¹æ³•åç§°()&#123; &#125;&#125;//ä¾‹å­public class Dog&#123; //æž„é€ æ–¹æ³•ä¸€ public Dog()&#123; System.out.println("nothing to do..."); &#125; //æž„é€ æ–¹æ³•äºŒ public Dog(String name)&#123; //è¿™é‡Œå°±å¯ä»¥ç»™æ¯æ¡newå‡ºæ¥çš„å¯¹è±¡(ç‹—)åˆå§‹åŒ–ä¸€ä¸ªåå­— System.out.println("hi,my name is "+name); &#125;&#125; ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå®Œæ•´çš„ç±» 1234567891011121314151617181920212223242526272829//æ¨¡ç‰ˆclass ç±»åç§° &#123; //æž„é€ å™¨æ–¹æ³• //å£°æ˜Žæˆå‘˜å˜é‡---è¿™ä¸ªå˜é‡å±žäºŽè¿™ä¸ªç±» //å£°æ˜Žæˆå‘˜æ–¹æ³• //åœ¨æ–¹æ³•é‡Œé¢å®šä¹‰çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼ŒåŒºåˆ«äºŽæˆå‘˜å˜é‡&#125;//ä¾‹å­public class Dog &#123; //æž„é€ æ–¹æ³•ä¸€ public Dog()&#123; System.out.println("nothing to do..."); &#125; //æž„é€ æ–¹æ³•äºŒ public Dog(String name)&#123; //è¿™é‡Œå°±å¯ä»¥ç»™æ¯æ¡newå‡ºæ¥çš„å¯¹è±¡(ç‹—)åˆå§‹åŒ–ä¸€ä¸ªåå­— System.out.println("hi,my name is "+name); &#125; //ç‹—çš„é¢œè‰²--æˆå‘˜å±žæ€§ public String color;//ä¸€èˆ¬æ˜¯privateï¼Œèµ‹å€¼ç”¨setæ–¹æ³•ï¼Œå–å€¼ç”¨getæ–¹æ³•ï¼Œè¿™é‡Œåªæ˜¯æ¼”ç¤º //ç‹—çš„è¡Œä¸ºï¼Œå®ƒä¼šå«---æˆå‘˜æ–¹æ³• private void say()&#123; int i = 0;//å±€éƒ¨å˜é‡ System.out.println("æˆ‘ä¼šå«ï¼šæ±ªæ±ªæ±ª~"); &#125;&#125; åˆ›å»ºå¯¹è±¡ è¯­æ³•ï¼š ç±»å å¯¹è±¡å = new ç±»å() ; ä¸¾ä¾‹ï¼š 12Dog fourcolor ; // å…ˆå£°æ˜Žä¸€ä¸ª Dog ç±»çš„å¯¹è±¡ fourcolorfourcolor = new Dog(&quot;fourcolor&quot;) ; // ç”¨ new å…³é”®å­—å®žä¾‹åŒ– Dog çš„å¯¹è±¡ fourcolor,æ­¤æ—¶è°ƒç”¨æž„é€ æ–¹æ³•äºŒ é€šè¿‡Dogè¿™ä¸ªç±»å¯ä»¥åˆ›é€ å‡ºfourcolorå¯¹è±¡.ä¸‹é¢æˆ‘æ‰èƒ½æ“ä½œè¿™ä¸ªå¯¹è±¡ï¼š 1234//è®©å®ƒçš„é¢œè‰²ä¸ºé»‘è‰²fourcolor.color = &quot;black&quot;;//è®©å®ƒå«fourcolor.say(); é¢å‘å¯¹è±¡ åœ¨ç†è§£äº†ä»€ä¹ˆæ˜¯ç±»ï¼Œä»€ä¹ˆæ˜¯å¯¹è±¡ï¼Œå°±å¯ä»¥æ¥è¯´è¯´é¢å‘å¯¹è±¡åˆ°åº•æ˜¯ä»€ä¹ˆäº†ã€‚ å…ˆæ¥è¯´è¯´é¢å‘è¿‡ç¨‹ï¼Œå¤§å®¶éƒ½å­¦ä¹ è¿‡Cè¯­è¨€ã€‚Cè¯­è¨€å°±æ˜¯å…¸åž‹çš„é¢å‘è¿‡ç¨‹çš„è¯­è¨€ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šè¦æŠŠå¤§è±¡è£…è¿›å†°ç®±é‡Œï¼Œè¿™ä»¶äº‹ï¼Œé¢å‘è¿‡ç¨‹çš„ç¨‹åºå‘˜æ˜¯è¿™æ ·æ€è€ƒçš„ï¼š æŠŠå†°ç®±é—¨å„¿æ‰“å¼€ã€‚ æŠŠå¤§è±¡è£…è¿›åŽ»ã€‚ æŠŠå†°ç®±é—¨å„¿å…³ä¸Šã€‚ ä¸Šé¢çš„æ¯ä¸€ä»¶äº‹éƒ½ç”¨ä¸€ä¸ªå‡½æ•°æ¥å®žçŽ°ã€‚æŠ½è±¡ä¸ºä¸‹é¢ä¸‰ä¸ªå‡½æ•°ï¼š openTheDoor()ï¼› pushElephant()ï¼› closeTheDoor()ï¼› è¿™æ ·ä¸æŒºå¥½çš„å—ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨é¢å‘è¿‡ç¨‹çš„è¿™ç§æ€ç»´æ¥ç¼–ç¨‹å‘¢ï¼Œè¿˜è¦æžå‡ºä»€ä¹ˆé¢å‘å¯¹è±¡æ¥ã€‚ éœ€æ±‚åˆæ¥å•¦ï¼š ã€Œæˆ‘è¦æŠŠå¤§è±¡è£…å¾®æ³¢ç‚‰é‡Œã€ ã€Œæˆ‘è¦æŠŠç‹®å­ä¹Ÿè£…å†°ç®±é‡Œã€ ã€Œæˆ‘è¦æŠŠå¤§è±¡è£…å†°ç®±ï¼Œä½†æ˜¯é—¨åˆ«å…³ï¼Œæ•žç€å°±è¡Œã€ è¿™ä¸ªæ—¶å€™ï¼Œé¢å‘è¿‡ç¨‹çš„ç¨‹åºå‘˜å°±æ‚²å‰§äº†ï¼Œæ¥ä¸€ä¸ªéœ€æ±‚æˆ‘å°±å†™ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘è¿˜èƒ½ä¸‹ç­å—ï¼Ÿ é¢å‘å¯¹è±¡ä»Žå¦ä¸€ä¸ªè§’åº¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒæŠ›å¼ƒäº†å‡½æ•°ï¼ŒæŠŠã€Œå¯¹è±¡ã€ä½œä¸ºç¨‹åºçš„åŸºæœ¬å•å…ƒã€‚ é¢å‘å¯¹è±¡çš„ä¸–ç•Œé‡Œï¼Œåˆ°å¤„éƒ½æ˜¯å¯¹è±¡ã€‚å³ï¼šä¸‡ç‰©çš†å¯¹è±¡ã€‚ æ¯”å¦‚äººè¿™ä¸ªç±»ï¼Œæ¯ä¸ªå…·ä½“çš„äºº(å¯¹è±¡)éƒ½è¦æœ‰è¿™æ ·çš„å±žæ€§ï¼šèº«é«˜ã€ä½“é‡ã€å¹´é¾„ã€‚æ¯ä¸ªäººéƒ½æœ‰è¿™æ ·çš„è¡Œä¸ºï¼šåƒé¥­ã€ç¡è§‰ã€ä¸ŠåŽ•æ‰€ã€‚ é‚£ä¹ˆï¼Œè¿™äº›é€šç”¨çš„å±žæ€§+æ–¹æ³•å¯ä»¥æž„å»ºä¸€ä¸ªæ¨¡æ¿ï¼šäººè¿™ä¸ªç±»ã€‚å› ä¸ºæ¯ä¸ªå…·ä½“çš„äººï¼ˆå¯¹è±¡ï¼‰éƒ½éœ€è¦è¿™äº›åŸºæœ¬çš„ä¸œè¥¿ã€‚å½“ç„¶äº†ï¼Œæ¯ä¸ªäººå…·ä½“ä»€ä¹ˆèº«é«˜ã€ä»€ä¹ˆä½“é‡ã€åƒä»€ä¹ˆéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ¯ä¸ªå¯¹è±¡ä¸€èˆ¬éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚ä½†æ˜¯æ¨¡æ¿æ˜¯ä¸€æ ·çš„ã€‚ é‚£ä¹ˆï¼Œå›žåˆ°åˆšæ‰çš„éœ€æ±‚ï¼Œé¢å‘å¯¹è±¡æ˜¯å¦‚ä½•æ€è€ƒè¿™ä»¶äº‹çš„å‘¢ï¼Ÿ å‘å†°ç®±ä¸‹è¾¾ã€Œå¼€é—¨ã€çš„å‘½ä»¤ã€‚ å‘å¤§è±¡ä¸‹è¾¾ã€Œè¿›å†°ç®±ã€çš„å‘½ä»¤ã€‚ å‘å†°ç®±ä¸‹è¾¾ã€Œå…³é—¨ã€çš„å‘½ä»¤ã€‚ å°±æ˜¯è¯´ï¼Œæˆ‘ä¸ç”¨äº²è‡ªç®¡å¼€é—¨çš„ç»†èŠ‚ï¼Œæˆ‘åªè¦å«ä»–å¼€é—¨å³å¯ã€‚ æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡ï¼Œåº”è¯¥æ˜¯åˆšåˆšå¥½èƒ½åšå®Œå®ƒèƒ½åšçš„äº‹æƒ…ï¼Œä¸å¤šåšï¼Œä¸å°‘åšã€‚å¤šåšäº†å®¹æ˜“è€¦åˆï¼Œå„ç§åŠŸèƒ½æ‚ç³…åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œã€‚æ¯”å¦‚æˆ‘æœ‰ä¸€ä¸ªå¯¹è±¡å«ã€Œæ±½è½¦ã€ï¼Œå¯ä»¥ã€Œè¡Œé©¶ã€ï¼Œå¯ä»¥ã€Œè½½äººã€ï¼ŒçŽ°åœ¨çš„éœ€æ±‚æ˜¯è¦å®žçŽ°ã€Œè½½äººé£žè¡Œã€ï¼Œå°±ä¸èƒ½é‡ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æ–°å®šä¹‰ä¸€ä¸ªå¯¹è±¡ã€Œé£žæœºã€æ¥åšã€‚å¦‚æžœä½ ç»™ã€Œæ±½è½¦ã€æ’ä¸Šäº†ç¿…è†€ï¼Œèµ‹äºˆäº†å®ƒã€Œé£žè¡Œã€çš„èƒ½åŠ›ï¼Œé‚£ä¹ˆæ–°æ¥çš„åŒå­¦é¢å¯¹ä½ çš„ä»£ç å°±ä¼šèŽ«åå…¶å¦™ï¼Œæ— ä»Žä¸‹æ‰‹ã€‚ ä½†æ˜¯ä¸ç¦è¦é—®ï¼šæ€Žä¹ˆå®žçŽ°è¿™ç§ä¸‹è¾¾å‘½ä»¤å°±å¯ä»¥è‡ªåŠ¨åŽ»æ‰§è¡Œçš„æ•ˆæžœå‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œæˆ‘æ€Žä¹ˆçŸ¥é“å®ƒæœ‰è¿™ä¸ªåŠŸèƒ½å•Šï¼ é¢å‘æŽ¥å£ç¼–ç¨‹ çŽ°åœ¨æˆ‘ä»¬æŠŠã€Œæ•°æ®ã€å’Œã€Œè¡Œä¸ºã€éƒ½å°è£…åˆ°äº†å¯¹è±¡é‡Œï¼Œç›¸å½“äºŽå¯¹è±¡æˆäº†ä¸€ä¸ªé»‘åŒ£å­ï¼Œé‚£æˆ‘ä»¬æ€Žä¹ˆçŸ¥é“å¯¹è±¡å…·æœ‰ä»€ä¹ˆæ ·çš„èƒ½åŠ›å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜çš„å…³é”®å°±æ˜¯æŽ¥å£ã€‚ å› ä¸ºæ— è®ºæ˜¯æŠŠå¤§è±¡è£…è¿›æ´—è¡£æœºè¿˜æ˜¯å†°ç®±ï¼Œéƒ½è¦æ±‚æ´—è¡£æœºæˆ–è€…å†°ç®±æœ‰å¼€é—¨å’Œå…³é—¨çš„åŠŸèƒ½ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠ½è±¡å‡ºæ¥ä¸€ä¸ªæŽ¥å£ï¼šã€è‡ªåŠ¨é—¨ã€‘ã€‚è¿™ä¸ªæŽ¥å£é‡Œé¢å®šä¹‰ä¸¤ä¸ªèƒ½åŠ›ï¼šã€å¼€é—¨ã€‘å’Œã€å…³é—¨ã€‘ã€‚ è®©æ´—è¡£æœºã€å†°ç®±ã€å¾®æ³¢ç‚‰è¿™äº›å¸¦é—¨çš„ä¸œè¥¿å…¨éƒ¨å®žçŽ°ã€è‡ªåŠ¨é—¨ã€‘æŽ¥å£ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæ¯ä¸ªå…·ä½“çš„å®žçŽ°å¯èƒ½ç•¥æœ‰ä¸åŒï¼Œæ¯”å¦‚å†°ç®±å¼€é—¨æ˜¯å¾€å¤–æ‹½ï¼Œä½†æ˜¯æ´—è¡£æœºå¼€é—¨å¯èƒ½æ˜¯å¾€ä¸Šç¿»ç›–å­ã€‚ æ­¤æ—¶ï¼Œæˆ‘æœ‰ä¸€ä¸ªéœ€æ±‚ï¼ŒæŠŠå¤§è±¡æ”¾è¿›å†°ç®±ã€‚æˆ‘ä¸€çœ‹ï¼Œå†°ç®±å®žçŽ°äº†ã€è‡ªåŠ¨é—¨ã€‘è¿™ä¸ªæŽ¥å£ï¼Œé‡Œé¢æœ‰ã€å¼€é—¨ã€‘å’Œã€å…³é—¨ã€‘ä¸¤ä¸ªæ–¹æ³•ï¼Œokï¼Œæˆ‘çŸ¥é“å†°ç®±æ˜¯å¯ä»¥å¼€é—¨å’Œå…³é—¨äº†ï¼Œé‚£å°±å¥½åŠžäº†ã€‚æˆ‘ç›´æŽ¥ä¸‹è¾¾å‘½ä»¤å³å¯ã€‚è¿˜æ˜¯è·Ÿä¸Šé¢ä¸€æ ·çš„æ­¥éª¤. å‘å†°ç®±ä¸‹è¾¾ã€Œå¼€é—¨ã€çš„å‘½ä»¤ã€‚ å‘å¤§è±¡ä¸‹è¾¾ã€Œè¿›å†°ç®±ã€çš„å‘½ä»¤ã€‚ å‘å†°ç®±ä¸‹è¾¾ã€Œå…³é—¨ã€çš„å‘½ä»¤ã€‚ æ­¤æ—¶ï¼Œéœ€è¦å°†ç‹®å­ä¹Ÿè£…å†°ç®±é‡Œã€‚é‚£è¿˜æ˜¯ä¸€æ ·ï¼š å‘å†°ç®±ä¸‹è¾¾ã€Œå¼€é—¨ã€çš„å‘½ä»¤ã€‚ å‘ç‹®å­ä¸‹è¾¾ã€Œè¿›å†°ç®±ã€çš„å‘½ä»¤ã€‚ å‘å†°ç®±ä¸‹è¾¾ã€Œå…³é—¨ã€çš„å‘½ä»¤ã€‚ æ­¤æ—¶ï¼Œæˆ‘è¦æŠŠå¤§è±¡è£…å†°ç®±ï¼Œä½†æ˜¯é—¨åˆ«å…³ï¼Œæ•žç€å°±è¡Œï¼Œé‚£å°±ï¼š å‘å†°ç®±ä¸‹è¾¾ã€Œå¼€é—¨ã€çš„å‘½ä»¤ã€‚ å‘å¤§è±¡ä¸‹è¾¾ã€Œè¿›å†°ç®±ã€çš„å‘½ä»¤ã€‚ æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿå†°ç®±ä¹Ÿå¯ä»¥æ¢ï¼Œæˆ‘å¯ä»¥æ¢æˆä»»ä½•ä¸œè¥¿ï¼Œåªè¦å®žçŽ°äº†è¿™ä¸ªæŽ¥å£ï¼Œè¿™äº›ä¸œè¥¿å°±éƒ½æœ‰è¿™äº›èƒ½åŠ›ï¼Œé‚£æˆ‘æ‰ä¸ç®¡é‡Œé¢åˆ°åº•æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Œç›´æŽ¥ä¸‹è¾¾ã€å¼€é—¨ã€‘ã€å…³é—¨ã€‘å‘½ä»¤å³å¯ã€‚ è¿™ä¹Ÿå¼•å…¥äº†JAVAç‰¹æ€§ä¸­å¦ä¸€ä¸ªç‰¹æ€§ï¼šå°è£…ã€‚å¤–ç•Œä¸çŸ¥é“é‡Œé¢å®žçŽ°ç»†èŠ‚ï¼Œåªéœ€è¦çŸ¥é“å®ƒçš„åŠŸèƒ½å’Œå…¥å‚å³å¯ã€‚ è¿™å°±æ˜¯é¢å‘è¿‡ç¨‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹çš„åŒºåˆ«ï¼Œä¹Ÿé¡ºå¸¦åœ°ç†è§£äº†ä»€ä¹ˆæ˜¯é¢å‘æŽ¥å£ç¼–ç¨‹ã€‚è¿™æ˜¯å­¦ä¹ JAVAæœ€åŸºç¡€ä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„ç‚¹ã€‚ æ•´ç†è‡ªï¼š https://tryenough.com/java05 http://www.woshipm.com/pmd/294180.html]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå­—ç¬¦ä¸²æ ¸å¿ƒä¸€ç½‘æ‰“å°½]]></title>
    <url>%2F2019%2F01%2F23%2Fjava-basic%2Fjava%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%B8%E5%BF%83%E4%B8%80%E7%BD%91%E6%89%93%E5%B0%BD%2F</url>
    <content type="text"><![CDATA[å¯¹å­—ç¬¦ä¸²ä¸­æœ€æ ¸å¿ƒçš„ç‚¹ï¼šå¯¹è±¡åˆ›å»ºå’ŒåŠ¨æ€åŠ å…¥å¸¸é‡æ± è¿™äº›ç‚¹è¿›è¡Œæ·±å…¥åˆ†æžã€‚ æ¯”å¦‚æœ‰ä¸¤ä¸ªé¢è¯•é¢˜ï¼š Q1ï¼šString s = new String(&quot;abc&quot;); å®šä¹‰äº†å‡ ä¸ªå¯¹è±¡ã€‚ Q2ï¼šå¦‚ä½•ç†è§£Stringçš„internæ–¹æ³•ï¼Ÿ A1ï¼šå¯¹äºŽé€šè¿‡ new äº§ç”Ÿçš„å¯¹è±¡ï¼Œä¼šå…ˆåŽ»å¸¸é‡æ± æ£€æŸ¥æœ‰æ²¡æœ‰ â€œabcâ€ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œå…ˆåœ¨å¸¸é‡æ± åˆ›å»ºä¸€ä¸ª â€œabcâ€ å¯¹è±¡ï¼Œç„¶åŽåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå¸¸é‡æ± ä¸­æ­¤ â€œabcâ€ å¯¹è±¡çš„æ‹·è´å¯¹è±¡ã€‚æ‰€ä»¥ç­”æ¡ˆæ˜¯ï¼šä¸€ä¸ªæˆ–ä¸¤ä¸ªã€‚å¦‚æžœå¸¸é‡æ± ä¸­åŽŸæ¥æ²¡æœ‰ â€abcâ€, å°±æ˜¯ä¸¤ä¸ªã€‚å¦‚æžœåŽŸæ¥çš„å¸¸é‡æ± ä¸­å­˜åœ¨â€œabcâ€æ—¶ï¼Œå°±æ˜¯ä¸€ä¸ªã€‚ A2ï¼šå½“ä¸€ä¸ªStringå®žä¾‹è°ƒç”¨intern()æ–¹æ³•æ—¶ï¼ŒJVMä¼šæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç›¸åŒUnicodeçš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¦‚æžœæœ‰ï¼Œåˆ™è¿”å›žå…¶çš„å¼•ç”¨ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­å¢žåŠ ä¸€ä¸ªUnicodeç­‰äºŽstrçš„å­—ç¬¦ä¸²å¹¶è¿”å›žå®ƒçš„å¼•ç”¨ï¼› å­—é¢é‡å’Œè¿è¡Œæ—¶å¸¸é‡æ±  JVMä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ï¼Œåœ¨å®žä¾‹åŒ–å­—ç¬¦ä¸²å¸¸é‡çš„æ—¶å€™è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ã€‚ä¸ºäº†å‡å°‘åœ¨JVMä¸­åˆ›å»ºçš„å­—ç¬¦ä¸²çš„æ•°é‡ï¼Œå­—ç¬¦ä¸²ç±»ç»´æŠ¤äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ã€‚ åœ¨JVMè¿è¡Œæ—¶åŒºåŸŸçš„æ–¹æ³•åŒºä¸­ï¼Œæœ‰ä¸€å—åŒºåŸŸæ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚ äº†è§£è¿‡JVMå°±ä¼šçŸ¥é“ï¼Œåœ¨javaä»£ç è¢«javacç¼–è¯‘ä¹‹åŽï¼Œæ–‡ä»¶ç»“æž„ä¸­æ˜¯åŒ…å«ä¸€éƒ¨åˆ†Constant poolçš„ã€‚æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š 123public static void main(String[] args) &#123; String s = "abc";&#125; ç»è¿‡ç¼–è¯‘åŽï¼Œå¸¸é‡æ± å†…å®¹å¦‚ä¸‹ï¼š 1234567891011Constant pool: #1 = Methodref #4.#20 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = String #21 // abc #3 = Class #22 // StringDemo #4 = Class #23 // java/lang/Object ... #16 = Utf8 s .. #21 = Utf8 abc #22 = Utf8 StringDemo #23 = Utf8 java/lang/Object ä¸Šé¢çš„Classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå†…å®¹ï¼š 123#16 = Utf8 s#21 = Utf8 abc#22 = Utf8 StringDemo ä¸Šé¢å‡ ä¸ªå¸¸é‡ä¸­ï¼Œså°±æ˜¯å‰é¢æåˆ°çš„ç¬¦å·å¼•ç”¨ï¼Œè€Œabcå°±æ˜¯å‰é¢æåˆ°çš„å­—é¢é‡ã€‚è€ŒClassæ–‡ä»¶ä¸­çš„å¸¸é‡æ± éƒ¨åˆ†çš„å†…å®¹ï¼Œä¼šåœ¨è¿è¡ŒæœŸè¢«è¿è¡Œæ—¶å¸¸é‡æ± åŠ è½½è¿›åŽ»ã€‚ new Stringåˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ ä¸‹é¢ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ†æžä¸‹String s = new String(&quot;abc&quot;);åˆ›å»ºå¯¹è±¡æƒ…å†µäº†ã€‚ è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œåœ¨ç¼–è¯‘æœŸï¼Œç¬¦å·å¼•ç”¨så’Œå­—é¢é‡abcä¼šè¢«åŠ å…¥åˆ°Classæ–‡ä»¶çš„å¸¸é‡æ± ä¸­ã€‚ç”±äºŽæ˜¯newçš„æ–¹å¼ï¼Œåœ¨ç±»åŠ è½½æœŸé—´ï¼Œå…ˆåŽ»å¸¸é‡æ± æ£€æŸ¥æœ‰æ²¡æœ‰ â€œabcâ€ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œå…ˆåœ¨å¸¸é‡æ± åˆ›å»ºä¸€ä¸ª â€œabcâ€ å¯¹è±¡ã€‚ åœ¨è¿è¡ŒæœŸé—´ï¼Œåœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå¸¸é‡æ± ä¸­æ­¤ â€œabcâ€ å¯¹è±¡çš„æ‹·è´å¯¹è±¡ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± çš„åŠ¨æ€æ‰©å±• ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨æ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€éƒ¨åˆ†æ¥æºï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚é‚£ä¹ˆè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå¯ä»¥åœ¨è¿è¡ŒæœŸåƒè¿è¡Œæ—¶å¸¸é‡æ± ä¸­å¢žåŠ å¸¸é‡ã€‚é‚£å°±æ˜¯Stringçš„internæ–¹æ³•ã€‚ å½“ä¸€ä¸ªStringå®žä¾‹è°ƒç”¨intern()æ–¹æ³•æ—¶ï¼ŒJVMä¼šæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç›¸åŒUnicodeçš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¦‚æžœæœ‰ï¼Œåˆ™è¿”å›žå…¶çš„å¼•ç”¨ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­å¢žåŠ ä¸€ä¸ªUnicodeç­‰äºŽstrçš„å­—ç¬¦ä¸²å¹¶è¿”å›žå®ƒçš„å¼•ç”¨ï¼› intern()æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œç¬¬ä¸€ä¸ªæ˜¯å°†å­—ç¬¦ä¸²å­—é¢é‡æ”¾å…¥å¸¸é‡æ± ï¼ˆå¦‚æžœæ± æ²¡æœ‰çš„è¯ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯è¿”å›žè¿™ä¸ªå¸¸é‡çš„å¼•ç”¨ã€‚ ä¸€ä¸ªä¾‹å­ï¼š 123456789String s1 = "hello world";String s2 = new String("hello world");System.out.println("s==s1:"+(s==s1));String s3 = new String("hello world").intern();System.out.println("s==s2:"+(s==s2)); è¿è¡Œç»“æžœæ˜¯ï¼š 12s1==s2:falses2==s3:true ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸ºString s1 = &quot;hello world&quot;;å’ŒString s3 = new String(&quot;hello world&quot;).intern();åšçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ï¼ˆä½†å®žé™…æœ‰äº›åŒºåˆ«ï¼Œè¿™é‡Œæš‚ä¸å±•å¼€ï¼‰ã€‚éƒ½æ˜¯å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åŽå°†å…¶å­—ç¬¦ä¸²å­—é¢é‡ä¿å­˜åœ¨å¸¸é‡æ± ä¸­ï¼Œå¹¶æŠŠè¿™ä¸ªå­—é¢é‡çš„å¼•ç”¨è¿”å›žç»™å®šä¹‰å¥½çš„å¯¹è±¡å¼•ç”¨ã€‚ å¯¹äºŽString s3 = new String(&quot;hello world&quot;).intern();ï¼Œåœ¨ä¸è°ƒinternæƒ…å†µï¼Œs3æŒ‡å‘çš„æ˜¯JVMåœ¨å †ä¸­åˆ›å»ºçš„é‚£ä¸ªå¯¹è±¡çš„å¼•ç”¨çš„ï¼ˆå¦‚s2ï¼‰ã€‚ä½†æ˜¯å½“æ‰§è¡Œäº†internæ–¹æ³•æ—¶ï¼Œs3å°†æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„é‚£ä¸ªå­—ç¬¦ä¸²å¸¸é‡ã€‚ ç”±äºŽs1å’Œs3éƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—é¢é‡çš„å¼•ç”¨ï¼Œæ‰€ä»¥s1==s3ã€‚ä½†æ˜¯ï¼Œs2çš„å¼•ç”¨æ˜¯å †ä¸­çš„å¯¹è±¡ï¼Œæ‰€ä»¥s2!=s1ã€‚ internçš„æ­£ç¡®ç”¨æ³• ä¸çŸ¥é“ï¼Œä½ æœ‰æ²¡æœ‰å‘çŽ°ï¼Œåœ¨String s3 = new String(&quot;abc&quot;).intern();ä¸­ï¼Œå…¶å®žinternæ˜¯å¤šä½™çš„ï¼Ÿ å› ä¸ºå°±ç®—ä¸ç”¨internï¼Œâ€œabc&quot;ä½œä¸ºä¸€ä¸ªå­—é¢é‡ä¹Ÿä¼šè¢«åŠ è½½åˆ°Classæ–‡ä»¶çš„å¸¸é‡æ± â€&quot;ï¼Œè¿›è€ŒåŠ å…¥åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä¸ºå•¥è¿˜è¦å¤šæ­¤ä¸€ä¸¾å‘¢ï¼Ÿåˆ°åº•ä»€ä¹ˆåœºæ™¯ä¸‹æ‰ä¼šç”¨åˆ°internå‘¢? åœ¨è§£é‡Šè¿™ä¸ªä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä»¥ä¸‹ä»£ç ï¼š 1234String s1 = "hello";String s2 = "world";String s3 = s1 + s2;String s4 = "hello" + "world"; åœ¨ç»è¿‡åç¼–è¯‘åŽï¼Œå¾—åˆ°ä»£ç å¦‚ä¸‹ï¼š 1234String s1 = "hello";String s2 = "world";String s3 = (new StringBuilder()).append(s1).append(s2).toString();String s4 = "helloworld"; è¿™å°±æ˜¯é˜¿é‡Œå·´å·´æ–‡æ¡£é‡Œä¸ºä»€ä¹ˆè§„å®šå¾ªçŽ¯æ‹¼æŽ¥å­—ç¬¦ä¸²ä¸å‡†ä½¿ç”¨&quot;+&quot;è€Œå¿…é¡»ä½¿ç”¨StringBuilderï¼Œå› ä¸ºåç¼–è¯‘å‡ºçš„å­—èŠ‚ç æ–‡ä»¶æ˜¾ç¤ºæ¯æ¬¡å¾ªçŽ¯éƒ½ä¼š new å‡ºä¸€ä¸ª StringBuilder å¯¹è±¡ï¼Œç„¶åŽè¿›è¡Œappend æ“ä½œï¼Œæœ€åŽé€šè¿‡ toString æ–¹æ³•è¿”å›ž String å¯¹è±¡ï¼Œé€ æˆå†…å­˜èµ„æºæµªè´¹ã€‚ ä¸æ°å½“çš„æ–¹å¼å½¢å¦‚ï¼š 1234String str = "start";for (int i = 0; i &lt; 100; i++) &#123; str = str + "hello";&#125; å¥½äº†ï¼Œè¨€å½’æ­£ä¼ ï¼Œå¯ä»¥å‘çŽ°ï¼ŒåŒæ ·æ˜¯å­—ç¬¦ä¸²æ‹¼æŽ¥ï¼Œs3å’Œs4åœ¨ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åŽçš„å®žçŽ°æ–¹å¼å¹¶ä¸ä¸€æ ·ã€‚s3è¢«è½¬åŒ–æˆStringBuilderåŠappendï¼Œè€Œs4è¢«ç›´æŽ¥æ‹¼æŽ¥æˆæ–°çš„å­—ç¬¦ä¸²ã€‚ å¦‚æžœä½ æ„Ÿå…´è¶£ï¼Œä½ è¿˜èƒ½å‘çŽ°ï¼ŒString s4 = s1 + s2; ç»è¿‡ç¼–è¯‘ä¹‹åŽï¼Œå¸¸é‡æ± ä¸­æ˜¯æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å¸¸é‡çš„åˆ†åˆ«æ˜¯ helloã€worldï¼ˆå…¶å®žhelloå’Œworldæ˜¯String s1 = &quot;hello&quot;;å’ŒString s2 = &quot;world&quot;;å®šä¹‰å‡ºæ¥çš„ï¼‰ï¼Œæ‹¼æŽ¥ç»“æžœhelloworldå¹¶ä¸åœ¨å¸¸é‡æ± ä¸­ã€‚ å¦‚æžœä»£ç åªæœ‰String s4 = &quot;hello&quot; + &quot;world&quot;;ï¼Œé‚£ä¹ˆå¸¸é‡æ± ä¸­å°†åªæœ‰helloworldè€Œæ²¡æœ‰helloå’Œ worldã€‚ ç©¶å…¶åŽŸå› ï¼Œæ˜¯å› ä¸ºå¸¸é‡æ± è¦ä¿å­˜çš„æ˜¯å·²ç¡®å®šçš„å­—é¢é‡å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºŽå­—ç¬¦ä¸²çš„æ‹¼æŽ¥ï¼Œçº¯å­—é¢é‡å’Œå­—é¢é‡çš„æ‹¼æŽ¥ï¼Œä¼šæŠŠæ‹¼æŽ¥ç»“æžœä½œä¸ºå¸¸é‡ä¿å­˜åˆ°å­—ç¬¦ä¸²ã€‚ å¦‚æžœåœ¨å­—ç¬¦ä¸²æ‹¼æŽ¥ä¸­ï¼Œæœ‰ä¸€ä¸ªå‚æ•°æ˜¯éžå­—é¢é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªå˜é‡çš„è¯ï¼Œæ•´ä¸ªæ‹¼æŽ¥æ“ä½œä¼šè¢«ç¼–è¯‘æˆStringBuilder.appendï¼Œè¿™ç§æƒ…å†µç¼–è¯‘å™¨æ˜¯æ— æ³•çŸ¥é“å…¶ç¡®å®šå€¼çš„ã€‚åªæœ‰åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šã€‚ é‚£ä¹ˆï¼Œæœ‰äº†è¿™ä¸ªç‰¹æ€§äº†ï¼Œinternå°±æœ‰ç”¨æ­¦ä¹‹åœ°äº†ã€‚é‚£å°±æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºä¸­ç”¨åˆ°çš„å­—ç¬¦ä¸²æ˜¯åªæœ‰åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šçš„ï¼Œåœ¨ç¼–è¯‘æœŸæ˜¯æ— æ³•ç¡®å®šçš„ï¼Œé‚£ä¹ˆä¹Ÿå°±æ²¡åŠžæ³•åœ¨ç¼–è¯‘æœŸè¢«åŠ å…¥åˆ°å¸¸é‡æ± ä¸­ã€‚ è¿™æ—¶å€™ï¼Œå¯¹äºŽé‚£ç§å¯èƒ½ç»å¸¸ä½¿ç”¨çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨internè¿›è¡Œå®šä¹‰ï¼Œæ¯æ¬¡JVMè¿è¡Œåˆ°è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šç›´æŽ¥æŠŠå¸¸é‡æ± ä¸­è¯¥å­—é¢å€¼çš„å¼•ç”¨è¿”å›žï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å¤§é‡å­—ç¬¦ä¸²å¯¹è±¡çš„åˆ›å»ºäº†ã€‚ æ€»ç»“ ç¬¬ä¸€ç§æƒ…å†µï¼š 12String str1 = "abc"; System.out.println(str1 == "abc"); æ ˆä¸­å¼€è¾Ÿä¸€å—ç©ºé—´å­˜æ”¾å¼•ç”¨str1ï¼› Stringæ± ä¸­å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œå­˜æ”¾Stringå¸¸é‡&quot;abc&quot;ï¼› å¼•ç”¨str1æŒ‡å‘æ± ä¸­Stringå¸¸é‡&quot;abc&quot;ï¼› str1æ‰€æŒ‡ä»£çš„åœ°å€å³å¸¸é‡&quot;abc&quot;æ‰€åœ¨åœ°å€ï¼Œè¾“å‡ºä¸ºtrue ç¬¬äºŒç§æƒ…å†µï¼š 12String str2 = new String("abc"); System.out.println(str2 == "abc"); æ ˆä¸­å¼€è¾Ÿä¸€å—ç©ºé—´å­˜æ”¾å¼•ç”¨str2ï¼› å †ä¸­å¼€è¾Ÿä¸€å—ç©ºé—´å­˜æ”¾ä¸€ä¸ªæ–°å»ºçš„Stringå¯¹è±¡&quot;abc&quot;ï¼› å¼•ç”¨str2æŒ‡å‘å †ä¸­çš„æ–°å»ºçš„Stringå¯¹è±¡&quot;abc&quot;ï¼› str2æ‰€æŒ‡ä»£çš„å¯¹è±¡åœ°å€ä¸ºå †ä¸­åœ°å€ï¼Œè€Œå¸¸é‡&quot;abc&quot;åœ°å€åœ¨æ± ä¸­ï¼Œè¾“å‡ºä¸ºfalseï¼› ç¬¬ä¸‰ã€å››ç§æƒ…å†µ 1234567891011121314//ï¼ˆ3ï¼‰String str1 = "a"ï¼›String str2 = "b"ï¼›String str3 = str1 + "b"ï¼›//str1 å’Œ str2 æ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†ã€‚//str3 ä¸­æœ‰ä¸ª str1 æ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨ç¼–è¯‘æœŸç¡®å®šã€‚//åˆå› ä¸ºStringæ˜¯ final ç±»åž‹çš„ï¼Œæ‰€ä»¥åœ¨ str1 + "b" çš„æ—¶å€™å®žé™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œåœ¨æŠŠæ–°å¯¹è±¡çš„å¼•ç”¨ä¼ ç»™str3ã€‚//ï¼ˆ4ï¼‰final String str1 = "a"ï¼›String str2 = "b"ï¼›String str3 = str1 + "b"ï¼›//è¿™é‡Œå’Œ(3)çš„ä¸åŒå°±æ˜¯ç»™ str1 åŠ ä¸Šäº†ä¸€ä¸ªfinalï¼Œè¿™æ ·str1å°±å˜æˆäº†ä¸€ä¸ªå¸¸é‡ã€‚//è¿™æ · str3 å°±å¯ä»¥åœ¨ç¼–è¯‘æœŸä¸­å°±ç¡®å®šäº† è¿™é‡Œçš„ç»†èŠ‚åœ¨ä¸Šé¢å·²ç»è¯¦ç»†è¯´æ˜Žäº†ã€‚ ç¬¬äº”ç§æƒ…å†µ 1234String str1 = "ab"ï¼›String str2 = new String("ab");System.out.println(str1== str2);//falseSystem.out.println(str2.intern() == str1);//true æ•´ç†è‡ªï¼š æˆ‘ç»ˆäºŽæžæ¸…æ¥šäº†å’ŒStringæœ‰å…³çš„é‚£ç‚¹äº‹å„¿ https://www.jianshu.com/p/2624036c9daa]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå­—ç¬¦ä¸²]]></title>
    <url>%2F2019%2F01%2F23%2Fjava-basic%2Fjava%E5%AD%97%E7%AC%A6%E4%B8%B2%2F</url>
    <content type="text"><![CDATA[å…³äºŽjavaå­—ç¬¦ä¸²ä¸å¯å˜ç‰¹æ€§çš„æ·±å…¥ç†è§£ã€‚ ä»€ä¹ˆæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Ÿ ä¼—æ‰€å‘¨çŸ¥ï¼Œ åœ¨Javaä¸­ï¼Œ Stringç±»æ˜¯ä¸å¯å˜çš„ã€‚é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ˜¯ä¸å¯å˜çš„å¯¹è±¡å‘¢ï¼Ÿ å¯ä»¥è¿™æ ·è®¤ä¸ºï¼šå¦‚æžœä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å®ƒåˆ›å»ºå®Œæˆä¹‹åŽï¼Œä¸èƒ½å†æ”¹å˜å®ƒçš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯ä¸å¯å˜çš„ã€‚ä¸èƒ½æ”¹å˜çŠ¶æ€çš„æ„æ€æ˜¯ï¼Œä¸èƒ½æ”¹å˜å¯¹è±¡å†…çš„æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»åž‹çš„å€¼ä¸èƒ½æ”¹å˜ï¼Œå¼•ç”¨ç±»åž‹çš„å˜é‡ä¸èƒ½æŒ‡å‘å…¶ä»–çš„å¯¹è±¡ï¼Œå¼•ç”¨ç±»åž‹æŒ‡å‘çš„å¯¹è±¡çš„çŠ¶æ€ä¹Ÿä¸èƒ½æ”¹å˜ã€‚ åŒºåˆ†å¯¹è±¡å’Œå¯¹è±¡çš„å¼•ç”¨ å¯¹äºŽJavaåˆå­¦è€…ï¼Œ å¯¹äºŽStringæ˜¯ä¸å¯å˜å¯¹è±¡æ€»æ˜¯å­˜æœ‰ç–‘æƒ‘ã€‚çœ‹ä¸‹é¢ä»£ç ï¼š 12345String s = "ABCabc"; System.out.println("s = " + s); s = "123456"; System.out.println("s = " + s); æ‰“å°ç»“æžœ: 12s = ABCabcs = 123456 é¦–å…ˆåˆ›å»ºä¸€ä¸ª String å¯¹è±¡ s ï¼Œç„¶åŽè®© s çš„å€¼ä¸º ABCabc ï¼Œ ç„¶åŽåˆè®© s çš„å€¼ä¸º 123456 ã€‚ ä»Žæ‰“å°ç»“æžœå¯ä»¥çœ‹å‡ºï¼Œs çš„å€¼ç¡®å®žæ”¹å˜äº†ã€‚é‚£ä¹ˆæ€Žä¹ˆè¿˜è¯´ String å¯¹è±¡æ˜¯ä¸å¯å˜çš„å‘¢ï¼Ÿ å…¶å®žè¿™é‡Œå­˜åœ¨ä¸€ä¸ªè¯¯åŒºï¼šsåªæ˜¯ä¸€ä¸ªStringå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚ å¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯ä¸€å—å†…å­˜åŒºï¼Œæˆå‘˜å˜é‡è¶Šå¤šï¼Œè¿™å—å†…å­˜åŒºå çš„ç©ºé—´è¶Šå¤§ã€‚ å¼•ç”¨åªæ˜¯ä¸€ä¸ª4å­—èŠ‚çš„æ•°æ®ï¼Œé‡Œé¢å­˜æ”¾äº†å®ƒæ‰€æŒ‡å‘çš„å¯¹è±¡çš„åœ°å€ï¼Œé€šè¿‡è¿™ä¸ªåœ°å€å¯ä»¥è®¿é—®å¯¹è±¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œs åªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå®ƒæŒ‡å‘äº†ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œå½“ s=â€œ123456â€; è¿™å¥ä»£ç æ‰§è¡Œè¿‡ä¹‹åŽï¼Œåˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡â€œ123456â€ï¼Œ è€Œå¼•ç”¨sé‡æ–°æŒ‡å‘äº†è¿™ä¸ªæ–°çš„å¯¹è±¡ï¼ŒåŽŸæ¥çš„å¯¹è±¡â€œABCabcâ€è¿˜åœ¨å†…å­˜ä¸­å­˜åœ¨ï¼Œå¹¶æ²¡æœ‰æ”¹å˜ã€‚å†…å­˜ç»“æž„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸ºä»€ä¹ˆStringå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Ÿ è¦ç†è§£ String çš„ä¸å¯å˜æ€§ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹ String ç±»ä¸­éƒ½æœ‰å“ªäº›æˆå‘˜å˜é‡ã€‚ åœ¨JDK1.6ä¸­ï¼ŒString çš„æˆå‘˜å˜é‡æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š 1234567891011121314public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; /** The value is used for character storage. */ private final char value[]; /** The offset is the first index of the storage that is used. */ private final int offset; /** The count is the number of characters in the String. */ private final int count; /** Cache the hash code for the string */ private int hash; // Default to 0 åœ¨JDK1.7å’Œ1.8ä¸­ï¼ŒString ç±»åšäº†ä¸€äº›æ”¹åŠ¨ï¼Œä¸»è¦æ˜¯æ”¹å˜äº†substringæ–¹æ³•æ‰§è¡Œæ—¶çš„è¡Œä¸ºï¼Œè¿™å’Œæœ¬æ–‡çš„ä¸»é¢˜ä¸ç›¸å…³ã€‚JDK1.7ä¸­ String ç±»çš„ä¸»è¦æˆå‘˜å˜é‡å°±å‰©ä¸‹äº†ä¸¤ä¸ªï¼š 1234567public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; /** The value is used for character storage. */ private final char value[]; /** Cache the hash code for the string */ private int hash; // Default to 0 ç”±ä»¥ä¸Šçš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ åœ¨Javaä¸­ String ç±»å…¶å®žå°±æ˜¯å¯¹å­—ç¬¦æ•°ç»„çš„å°è£…ã€‚ JDK6ä¸­ï¼Œ valueæ˜¯Stringå°è£…çš„æ•°ç»„ï¼Œoffsetæ˜¯Stringåœ¨è¿™ä¸ªvalueæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®ï¼Œcountæ˜¯Stringæ‰€å çš„å­—ç¬¦çš„ä¸ªæ•°ã€‚ åœ¨JDK7ä¸­ï¼Œåªæœ‰ä¸€ä¸ªvalueå˜é‡ï¼Œä¹Ÿå°±æ˜¯valueä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯å±žäºŽStringè¿™ä¸ªå¯¹è±¡çš„ã€‚è¿™ä¸ªæ”¹å˜ä¸å½±å“æœ¬æ–‡çš„è®¨è®ºã€‚ é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªhashæˆå‘˜å˜é‡ï¼Œæ˜¯è¯¥ String å¯¹è±¡çš„å“ˆå¸Œå€¼çš„ç¼“å­˜ï¼Œè¿™ä¸ªæˆå‘˜å˜é‡ä¹Ÿå’Œæœ¬æ–‡çš„è®¨è®ºæ— å…³ã€‚åœ¨Javaä¸­ï¼Œæ•°ç»„ä¹Ÿæ˜¯å¯¹è±¡ã€‚ æ‰€ä»¥valueä¹Ÿåªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªçœŸæ­£çš„æ•°ç»„å¯¹è±¡ã€‚å…¶å®žæ‰§è¡Œäº† 1String s = â€œABCabc"; è¿™å¥ä»£ç ä¹‹åŽï¼ŒçœŸæ­£çš„å†…å­˜å¸ƒå±€åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š valueï¼Œoffsetå’Œcountè¿™ä¸‰ä¸ªå˜é‡éƒ½æ˜¯privateçš„ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›setValueï¼Œ setOffsetå’ŒsetCountç­‰å…¬å…±æ–¹æ³•æ¥ä¿®æ”¹è¿™äº›å€¼ï¼Œæ‰€ä»¥åœ¨Stringç±»çš„å¤–éƒ¨æ— æ³•ä¿®æ”¹Stringã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½ä¿®æ”¹ï¼Œ å¹¶ä¸”åœ¨Stringç±»çš„å¤–éƒ¨ä¸èƒ½è®¿é—®è¿™ä¸‰ä¸ªæˆå‘˜ã€‚ æ­¤å¤–ï¼Œvalueï¼Œoffsetå’Œcountè¿™ä¸‰ä¸ªå˜é‡éƒ½æ˜¯finalçš„ï¼Œ ä¹Ÿå°±æ˜¯è¯´åœ¨ String ç±»å†…éƒ¨ï¼Œä¸€æ—¦è¿™ä¸‰ä¸ªå€¼åˆå§‹åŒ–äº†ï¼Œ ä¹Ÿä¸èƒ½è¢«æ”¹å˜ã€‚æ‰€ä»¥å¯ä»¥è®¤ä¸º String å¯¹è±¡æ˜¯ä¸å¯å˜çš„äº†ã€‚ é‚£ä¹ˆåœ¨ String ä¸­ï¼Œæ˜Žæ˜Žå­˜åœ¨ä¸€äº›æ–¹æ³•ï¼Œè°ƒç”¨ä»–ä»¬å¯ä»¥å¾—åˆ°æ”¹å˜åŽçš„å€¼ã€‚è¿™äº›æ–¹æ³•åŒ…æ‹¬substringï¼Œ replaceï¼Œ replaceAllï¼Œ toLowerCaseç­‰ã€‚ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š 1234String a = "ABCabc"; System.out.println("a = " + a); //ABCabca = a.replace('A', 'a'); System.out.println("a = " + a); //aBCabc é‚£ä¹ˆaçš„å€¼çœ‹ä¼¼æ”¹å˜äº†ï¼Œå…¶å®žä¹Ÿæ˜¯åŒæ ·çš„è¯¯åŒºã€‚å†æ¬¡è¯´æ˜Žï¼Œ aåªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œ ä¸æ˜¯çœŸæ­£çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåœ¨è°ƒç”¨a.replace('A', 'a')æ—¶ï¼Œ æ–¹æ³•å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œå¹¶æŠŠè¿™ä¸ªå¿ƒçš„å¯¹è±¡é‡æ–°èµ‹ç»™äº†å¼•ç”¨aã€‚Stringä¸­replaceæ–¹æ³•çš„æºç å¯ä»¥è¯´æ˜Žé—®é¢˜ï¼š 1234567891011121314151617181920212223242526public String replace(char oldChar, char newChar) &#123; if (oldChar != newChar) &#123; int len = value.length; int i = -1; char[] val = value; /* avoid getfield opcode */ while (++i &lt; len) &#123; if (val[i] == oldChar) &#123; break; &#125; &#125; if (i &lt; len) &#123; char buf[] = new char[len]; for (int j = 0; j &lt; i; j++) &#123; buf[j] = val[j]; &#125; while (i &lt; len) &#123; char c = val[i]; buf[i] = (c == oldChar) ? newChar : c; i++; &#125; return new String(buf, true);//newå‡ºäº†æ–°çš„Stringå¯¹è±¡ &#125; &#125; return this;&#125; Stringå¯¹è±¡çœŸçš„ä¸å¯å˜å—ï¼Ÿ ä»Žä¸Šæ–‡å¯çŸ¥Stringçš„æˆå‘˜å˜é‡æ˜¯private final çš„ï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–ä¹‹åŽä¸å¯æ”¹å˜ã€‚é‚£ä¹ˆåœ¨è¿™å‡ ä¸ªæˆå‘˜ä¸­ï¼Œ valueæ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸ºä»–æ˜¯ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„å¯¹è±¡ã€‚ valueæ˜¯finalä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´finalä¸èƒ½å†æŒ‡å‘å…¶ä»–æ•°ç»„å¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘èƒ½æ”¹å˜valueæŒ‡å‘çš„æ•°ç»„å—ï¼Ÿ æ¯”å¦‚å°†æ•°ç»„ä¸­çš„æŸä¸ªä½ç½®ä¸Šçš„å­—ç¬¦å˜ä¸ºä¸‹åˆ’çº¿â€œ_â€ã€‚ è‡³å°‘åœ¨æˆ‘ä»¬è‡ªå·±å†™çš„æ™®é€šä»£ç ä¸­ä¸èƒ½å¤Ÿåšåˆ°ï¼Œå› ä¸ºæˆ‘ä»¬æ ¹æœ¬ä¸èƒ½å¤Ÿè®¿é—®åˆ°è¿™ä¸ªvalueå¼•ç”¨ï¼Œæ›´ä¸èƒ½é€šè¿‡è¿™ä¸ªå¼•ç”¨åŽ»ä¿®æ”¹æ•°ç»„ã€‚ é‚£ä¹ˆç”¨ä»€ä¹ˆæ–¹å¼å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜å‘¢ï¼Ÿ æ²¡é”™ï¼Œç”¨åå°„ï¼Œ å¯ä»¥åå°„å‡ºStringå¯¹è±¡ä¸­çš„valueå±žæ€§ï¼Œ è¿›è€Œæ”¹å˜é€šè¿‡èŽ·å¾—çš„valueå¼•ç”¨æ”¹å˜æ•°ç»„çš„ç»“æž„ã€‚ä¸‹é¢æ˜¯å®žä¾‹ä»£ç ï¼š 123456789101112131415161718192021public static void testReflection() throws Exception &#123; //åˆ›å»ºå­—ç¬¦ä¸²"Hello World"ï¼Œ å¹¶èµ‹ç»™å¼•ç”¨s String s = "Hello World"; System.out.println("s = " + s); //Hello World //èŽ·å–Stringç±»ä¸­çš„valueå­—æ®µ Field valueFieldOfString = String.class.getDeclaredField("value"); //æ”¹å˜valueå±žæ€§çš„è®¿é—®æƒé™ valueFieldOfString.setAccessible(true); //èŽ·å–så¯¹è±¡ä¸Šçš„valueå±žæ€§çš„å€¼ char[] value = (char[]) valueFieldOfString.get(s); //æ”¹å˜valueæ‰€å¼•ç”¨çš„æ•°ç»„ä¸­çš„ç¬¬5ä¸ªå­—ç¬¦ value[5] = '_'; System.out.println("s = " + s); //Hello_World &#125; åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œså§‹ç»ˆå¼•ç”¨çš„åŒä¸€ä¸ª String å¯¹è±¡ï¼Œä½†æ˜¯å†åå°„å‰åŽï¼Œè¿™ä¸ª String å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡åå°„æ˜¯å¯ä»¥ä¿®æ”¹æ‰€è°“çš„â€œä¸å¯å˜â€å¯¹è±¡çš„ã€‚ä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬ä¸è¿™ä¹ˆåšã€‚ è¿™ä¸ªåå°„çš„å®žä¾‹è¿˜å¯ä»¥è¯´æ˜Žä¸€ä¸ªé—®é¢˜ï¼šå¦‚æžœä¸€ä¸ªå¯¹è±¡ï¼Œä»–ç»„åˆçš„å…¶ä»–å¯¹è±¡çš„çŠ¶æ€æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å¾ˆå¯èƒ½ä¸æ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¾‹å¦‚ä¸€ä¸ªCarå¯¹è±¡ï¼Œå®ƒç»„åˆäº†ä¸€ä¸ªWheelå¯¹è±¡ï¼Œè™½ç„¶è¿™ä¸ªWheelå¯¹è±¡å£°æ˜Žæˆäº†private final çš„ï¼Œä½†æ˜¯è¿™ä¸ªWheelå¯¹è±¡å†…éƒ¨çš„çŠ¶æ€å¯ä»¥æ”¹å˜ï¼Œ é‚£ä¹ˆå°±ä¸èƒ½å¾ˆå¥½çš„ä¿è¯Carå¯¹è±¡ä¸å¯å˜ã€‚ å‚è€ƒï¼š https://blog.csdn.net/zhangjg_blog/article/details/18319521]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Integeræ‹†ç®±å’Œè£…ç®±]]></title>
    <url>%2F2019%2F01%2F23%2Fjava-basic%2FInteger%E6%8B%86%E7%AE%B1%E5%92%8C%E8%A3%85%E7%AE%B1%2F</url>
    <content type="text"><![CDATA[ç”±äºŽç¬”è¯•ç»å¸¸é‡åˆ°ï¼Œæ‰€ä»¥è¿™é‡Œæ•´ç†ä¸€ä¸‹ã€‚å°†Integerè¿™ä¸€å—ä¸€ç½‘æ‰“å°½ã€‚ æ‹†ç®±å’Œè£…ç®± è¿™é‡Œä»¥é¢è¯•ç¬”è¯•ç»å¸¸å‡ºçŽ°çš„Integerç±»åž‹ä¸ºä¾‹ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647public static void main(String[] args) &#123; /*ç¬¬ä¸€ç»„*/ Integer i = new Integer(128); Integer i2 = 128; System.out.println(i == i2); Integer i3 = new Integer(127); Integer i4 = 127; System.out.println(i3 == i4); /*ç¬¬äºŒç»„*/ Integer i5 = 128; Integer i6 = 128; System.out.println(i5 == i6); Integer i7 = 127; Integer i8 = 127; System.out.println(i7 == i8); /*ç¬¬ä¸‰ç»„*/ Integer i9 = new Integer(128); int i10 = 128; System.out.println(i9 == i10); Integer i11 = new Integer(127); int i12 = 127; System.out.println(i11== i12); /*ç¬¬å››ç»„*/ Integer i13 = new Integer(128); Integer i14 = Integer.valueOf(128); System.out.println(i13 == i14); Integer i15 = new Integer(127); Integer i16 = Integer.valueOf(127); System.out.println(i13 == i14); /*ç¬¬äº”ç»„*/ Integer i17 = Integer.valueOf(128); Integer i18 = 128; System.out.println(i17 == i18); Integer i19 = Integer.valueOf(127); Integer i20 = 127; System.out.println(i19 == i20);&#125; æ‰§è¡Œç»“æžœä¸ºï¼š 1234567891011121314falsefalsefalsetruetruetruefalsefalsefalsetrue ç¿»å¼€æºç (jdk8)ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç§æœ‰çš„é™æ€ç±»ï¼Œå«åšæ•´å½¢ç¼“å­˜ã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç¼“å­˜æŸäº›æ•´åž‹å€¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒé»˜è®¤å°†-127-128ä¹‹é—´æ•°å­—å°è£…æˆå¯¹è±¡ï¼Œæ”¾è¿›ä¸€ä¸ªå¸¸é‡æ± ä¸­ï¼Œä»¥åŽå®šä¹‰ç±»ä¼¼äºŽInteger a = 1é‡Œé¢çš„aå°±å¯ä»¥ç›´æŽ¥ä»Žè¿™ä¸ªå¸¸é‡æ± ä¸­å–å¯¹è±¡å³å¯ï¼Œä¸éœ€è¦é‡æ–°new 123456789101112131415161718192021222324252627282930313233private static class IntegerCache &#123; static final int low = -128; static final int high; static final Integer cache[]; static &#123; // high value may be configured by property int h = 127; String integerCacheHighPropValue = sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high"); if (integerCacheHighPropValue != null) &#123; try &#123; int i = parseInt(integerCacheHighPropValue); i = Math.max(i, 127); // Maximum array size is Integer.MAX_VALUE h = Math.min(i, Integer.MAX_VALUE - (-low) -1); &#125; catch( NumberFormatException nfe) &#123; // If the property cannot be parsed into an int, ignore it. &#125; &#125; high = h; cache = new Integer[(high - low) + 1]; int j = low; for(int k = 0; k &lt; cache.length; k++) cache[k] = new Integer(j++); // range [-128, 127] must be interned (JLS7 5.1.7) assert IntegerCache.high &gt;= 127; &#125; private IntegerCache() &#123;&#125;&#125; å¯¹äºŽInteger.valueOf(): 12345public static Integer valueOf(int i) &#123; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i);&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¹Ÿæ˜¯å…ˆçœ‹çœ‹æ˜¯ä¸æ˜¯åœ¨-127åˆ°128ä¹‹é—´çš„èŒƒå›´ï¼Œæ˜¯çš„è¯å°±ä»Ž cache ä¸­å–å‡ºç›¸åº”çš„ Integer å¯¹è±¡å³å¯ã€‚ ç¬¬ä¸€ç»„ä¸­ ç¬¬ä¸€ç§æƒ…å†µï¼Œi æ˜¯åˆ›å»ºçš„ä¸€ä¸ªIntegerçš„å¯¹è±¡ï¼Œå–å€¼æ˜¯128ã€‚i2 æ˜¯è¿›è¡Œè‡ªåŠ¨è£…ç®±çš„å®žä¾‹ï¼Œå› ä¸ºè¿™é‡Œè¶…å‡ºäº†-128åˆ°127çš„èŒƒå›´ï¼Œæ‰€ä»¥æ˜¯åˆ›å»ºäº†æ–°çš„Integerå¯¹è±¡ã€‚ç”±äºŽ==æ¯”è¾ƒçš„æ˜¯åœ°å€ï¼Œæ‰€ä»¥ä¸¤è€…å¿…ç„¶ä¸ä¸€æ ·ã€‚ ç¬¬äºŒç§æƒ…å†µå°±ä¸ä¸€æ ·äº†ï¼Œi4æ˜¯ä¸éœ€è¦è‡ªå·±newï¼Œè€Œæ˜¯å¯ä»¥ç›´æŽ¥ä»Žç¼“å­˜ä¸­å–ï¼Œä½†æ˜¯i3æ˜¯newå‡ºæ¥çš„ï¼Œåœ°å€è¿˜æ˜¯ä¸ä¸€æ ·ã€‚ ç¬¬äºŒç»„ä¸­ ç¬¬ä¸€ç§æƒ…å†µæ˜¯éƒ½è¶…å‡ºèŒƒå›´äº†ï¼Œæ‰€ä»¥éƒ½è¦è‡ªå·±åˆ†åˆ«åŽ»newï¼Œæ‰€ä»¥ä¸ä¸€æ · ç¬¬äºŒç§æƒ…å†µæ˜¯åœ¨èŒƒå›´å†…ï¼Œéƒ½åŽ»ç¼“å­˜ä¸­å–ï¼Œå®žé™…ä¸Šéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä¸€æ · ç¬¬ä¸‰ç»„ä¸­ i10å’Œi12éƒ½æ˜¯intåž‹ï¼Œi9å’Œi11ä¸Žå®ƒä»¬æ¯”è¾ƒçš„æ—¶å€™éƒ½è¦è‡ªåŠ¨æ‹†ç®±ï¼Œæ‰€ä»¥æ¯”è¾ƒçš„æ˜¯æ•°å€¼ï¼Œæ‰€ä»¥éƒ½ä¸€æ · ç¬¬å››ç»„ä¸­ ä¸Žç¬¬ä¸€ç»„åŽŸç†ä¸€æ · å››äº”ç»„ä¸­ ä¸Žç¬¬äºŒç»„åŽŸç†ä¸€æ · æ‰€ä»¥å•Šï¼Œnew Integer()æ˜¯æ¯æ¬¡éƒ½ç›´æŽ¥newå¯¹è±¡å‡ºæ¥ï¼Œè€ŒInteger.valueOf()å¯èƒ½ä¼šç”¨åˆ°ç¼“å­˜ï¼Œæ‰€ä»¥åŽè€…æ•ˆçŽ‡é«˜ä¸€ç‚¹ã€‚ æ€»ç»“ int å’Œ Integer åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œ Integer ä¼šè¿›è¡Œæ‹†ç®±ï¼Œè½¬ä¸º int å€¼ä¸Žint` è¿›è¡Œæ¯”è¾ƒã€‚ Integer ä¸Ž Integer æ¯”è¾ƒçš„æ—¶å€™ï¼Œç”±äºŽç›´æŽ¥èµ‹å€¼çš„æ—¶å€™ä¼šè¿›è¡Œè‡ªåŠ¨çš„è£…ç®±ï¼Œé‚£ä¹ˆè¿™é‡Œå°±éœ€è¦æ³¨æ„ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯ -128&lt;= x&lt;=127 çš„æ•´æ•°ï¼Œå°†ä¼šç›´æŽ¥ç¼“å­˜åœ¨ IntegerCache ä¸­ï¼Œé‚£ä¹ˆå½“èµ‹å€¼åœ¨è¿™ä¸ªåŒºé—´çš„æ—¶å€™ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„ Integer å¯¹è±¡ï¼Œè€Œæ˜¯ä»Žç¼“å­˜ä¸­èŽ·å–å·²ç»åˆ›å»ºå¥½çš„ Integer å¯¹è±¡ã€‚äºŒï¼šå½“å¤§äºŽè¿™ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œç›´æŽ¥ new Integer æ¥åˆ›å»º Integer å¯¹è±¡ã€‚ new Integer(1) å’Œ Integer a = 1 ä¸åŒï¼Œå‰è€…ä¼šåˆ›å»ºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨å †ä¸­ï¼Œè€ŒåŽè€…å› ä¸ºåœ¨-128åˆ°127çš„èŒƒå›´å†…ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä»Ž IntegerCache ä¸­èŽ·å–çš„ã€‚é‚£ä¹ˆ Integer a = 128, å¤§äºŽè¯¥èŒƒå›´çš„è¯æ‰ä¼šç›´æŽ¥é€šè¿‡ new Integer(128)åˆ›å»ºå¯¹è±¡ï¼Œè¿›è¡Œè£…ç®±ã€‚]]></content>
      <tags>
        <tag>javaåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ€è€ƒ]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F10%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%80%9D%E8%80%83%2F</url>
    <content type="text"><![CDATA[åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ€å¤´ç–¼çš„å°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Œå¤„ç†èµ·æ¥ä¸€å®šè¦å°å¿ƒç¿¼ç¿¼ã€‚ç”±äºŽæ²¡æœ‰æ­¤æ–¹é¢å®žæˆ˜ï¼Œæœ¬æ–‡å°±ä»Žç†è®ºä¸Šçœ‹çœ‹æ¯”è¾ƒå¥½çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†æ–¹æ¡ˆã€‚ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ ä¼—æ‰€å‘¨çŸ¥ï¼Œæ•°æ®åº“èƒ½å®žçŽ°æœ¬åœ°äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œä½ å¯ä»¥å…è®¸ä¸€ç»„æ“ä½œè¦ä¹ˆå…¨éƒ½æ­£ç¡®æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚è¿™é‡Œç‰¹åˆ«å¼ºè°ƒäº†æœ¬åœ°äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç›®å‰çš„æ•°æ®åº“åªèƒ½æ”¯æŒåŒä¸€ä¸ªæ•°æ®åº“ä¸­çš„äº‹åŠ¡ã€‚ä½†çŽ°åœ¨çš„ç³»ç»Ÿå¾€å¾€é‡‡ç”¨å¾®æœåŠ¡æž¶æž„ï¼Œä¸šåŠ¡ç³»ç»Ÿæ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œå› æ­¤å°±å‡ºçŽ°äº†è·¨å¤šä¸ªæ•°æ®åº“çš„äº‹åŠ¡éœ€æ±‚ï¼Œè¿™ç§äº‹åŠ¡å³ä¸ºâ€œåˆ†å¸ƒå¼äº‹åŠ¡â€ã€‚é‚£ä¹ˆåœ¨ç›®å‰æ•°æ®åº“ä¸æ”¯æŒè·¨åº“äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿ æ¯”å¦‚ç”¨æˆ·ä¸‹å•è¿‡ç¨‹ã€‚å½“æˆ‘ä»¬çš„ç³»ç»Ÿé‡‡ç”¨äº†å¾®æœåŠ¡æž¶æž„åŽï¼Œä¸€ä¸ªç”µå•†ç³»ç»Ÿå¾€å¾€è¢«æ‹†åˆ†æˆå¦‚ä¸‹å‡ ä¸ªå­ç³»ç»Ÿï¼šå•†å“ç³»ç»Ÿã€è®¢å•ç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€ç§¯åˆ†ç³»ç»Ÿç­‰ã€‚æ•´ä¸ªä¸‹å•çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š ç”¨æˆ·é€šè¿‡å•†å“ç³»ç»Ÿæµè§ˆå•†å“ï¼Œä»–çœ‹ä¸­äº†æŸä¸€é¡¹å•†å“ï¼Œä¾¿ç‚¹å‡»ä¸‹å• æ­¤æ—¶è®¢å•ç³»ç»Ÿä¼šç”Ÿæˆä¸€æ¡è®¢å• è®¢å•åˆ›å»ºæˆåŠŸåŽï¼Œæ”¯ä»˜ç³»ç»Ÿæä¾›æ”¯ä»˜åŠŸèƒ½ å½“æ”¯ä»˜å®ŒæˆåŽï¼Œç”±ç§¯åˆ†ç³»ç»Ÿä¸ºè¯¥ç”¨æˆ·å¢žåŠ ç§¯åˆ† ä¸Šè¿°æ­¥éª¤2ã€3ã€4éœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆã€‚å¯¹äºŽä¼ ç»Ÿå•ä½“åº”ç”¨è€Œè¨€ï¼Œå®žçŽ°äº‹åŠ¡éžå¸¸ç®€å•ï¼Œåªéœ€å°†è¿™ä¸‰ä¸ªæ­¥éª¤æ”¾åœ¨ä¸€ä¸ªæ–¹æ³•Aä¸­ï¼Œå†ç”¨Springçš„@Transactionalæ³¨è§£æ ‡è¯†è¯¥æ–¹æ³•å³å¯ã€‚Springé€šè¿‡æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼Œä¿è¯è¿™äº›æ­¥éª¤è¦ä¹ˆå…¨éƒ½æ‰§è¡Œå®Œæˆï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚ä½†åœ¨è¿™ä¸ªå¾®æœåŠ¡æž¶æž„ä¸­ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤æ¶‰åŠä¸‰ä¸ªç³»ç»Ÿï¼Œæ¶‰åŠä¸‰ä¸ªæ•°æ®åº“ï¼Œæ­¤æ—¶æˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®åº“å’Œåº”ç”¨ç³»ç»Ÿä¹‹é—´ï¼Œé€šè¿‡æŸé¡¹é»‘ç§‘æŠ€ï¼Œå®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒã€‚ æ–¹æ¡ˆ1ï¼šåŸºäºŽå¯é æ¶ˆæ¯æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ åœ¨ç³»ç»ŸAå¤„ç†ä»»åŠ¡Aå‰ï¼Œé¦–å…ˆå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€ä¸€æ¡æ¶ˆæ¯ æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°åŽå°†è¯¥æ¡æ¶ˆæ¯æŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æŠ•é€’ã€‚æ­¤æ—¶ä¸‹æ¸¸ç³»ç»ŸBä»ç„¶ä¸çŸ¥é“è¯¥æ¡æ¶ˆæ¯çš„å­˜åœ¨ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶æŒä¹…åŒ–æˆåŠŸåŽï¼Œä¾¿å‘ç³»ç»ŸAè¿”å›žä¸€ä¸ªç¡®è®¤åº”ç­”ï¼› ç³»ç»ŸAæ”¶åˆ°ç¡®è®¤åº”ç­”åŽï¼Œåˆ™å¯ä»¥å¼€å§‹å¤„ç†ä»»åŠ¡Aï¼› ä»»åŠ¡Aå¤„ç†å®ŒæˆåŽï¼Œå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€Commitè¯·æ±‚ã€‚è¯¥è¯·æ±‚å‘é€å®ŒæˆåŽï¼Œå¯¹ç³»ç»ŸAè€Œè¨€ï¼Œè¯¥äº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ­¤æ—¶å®ƒå¯ä»¥å¤„ç†åˆ«çš„ä»»åŠ¡äº†ã€‚ ä½†commitæ¶ˆæ¯å¯èƒ½ä¼šåœ¨ä¼ è¾“é€”ä¸­ä¸¢å¤±ï¼Œä»Žè€Œæ¶ˆæ¯ä¸­é—´ä»¶å¹¶ä¸ä¼šå‘ç³»ç»ŸBæŠ•é€’è¿™æ¡æ¶ˆæ¯ï¼Œä»Žè€Œç³»ç»Ÿå°±ä¼šå‡ºçŽ°ä¸ä¸€è‡´æ€§ã€‚è¿™ä¸ªé—®é¢˜ç”±æ¶ˆæ¯ä¸­é—´ä»¶çš„äº‹åŠ¡å›žæŸ¥æœºåˆ¶å®Œæˆï¼Œä¸‹æ–‡ä¼šä»‹ç»ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°CommitæŒ‡ä»¤åŽï¼Œä¾¿å‘ç³»ç»ŸBæŠ•é€’è¯¥æ¶ˆæ¯ï¼Œä»Žè€Œè§¦å‘ä»»åŠ¡Bçš„æ‰§è¡Œï¼› å½“ä»»åŠ¡Bæ‰§è¡Œå®ŒæˆåŽï¼Œç³»ç»ŸBå‘æ¶ˆæ¯ä¸­é—´ä»¶è¿”å›žä¸€ä¸ªç¡®è®¤åº”ç­”ï¼Œå‘Šè¯‰æ¶ˆæ¯ä¸­é—´ä»¶è¯¥æ¶ˆæ¯å·²ç»æˆåŠŸæ¶ˆè´¹ï¼Œæ­¤æ—¶ï¼Œè¿™ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡å®Œæˆã€‚ ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œå¦‚æžœä»»åŠ¡Aå¤„ç†å¤±è´¥ï¼Œé‚£ä¹ˆéœ€è¦è¿›å…¥å›žæ»šæµç¨‹: è‹¥ç³»ç»ŸAåœ¨å¤„ç†ä»»åŠ¡Aæ—¶å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€Rollbackè¯·æ±‚ã€‚å’Œå‘é€Commitè¯·æ±‚ä¸€æ ·ï¼Œç³»ç»ŸAå‘å®Œä¹‹åŽä¾¿å¯ä»¥è®¤ä¸ºå›žæ»šå·²ç»å®Œæˆï¼Œå®ƒä¾¿å¯ä»¥åŽ»åšå…¶ä»–çš„äº‹æƒ…ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°å›žæ»šè¯·æ±‚åŽï¼Œç›´æŽ¥å°†è¯¥æ¶ˆæ¯ä¸¢å¼ƒï¼Œè€Œä¸æŠ•é€’ç»™ç³»ç»ŸBï¼Œä»Žè€Œä¸ä¼šè§¦å‘ç³»ç»ŸBçš„ä»»åŠ¡Bã€‚ ä¸Šé¢æ‰€ä»‹ç»çš„Commitå’ŒRollbackéƒ½å±žäºŽç†æƒ³æƒ…å†µï¼Œä½†åœ¨å®žé™…ç³»ç»Ÿä¸­ï¼ŒCommitå’ŒRollbackæŒ‡ä»¤éƒ½æœ‰å¯èƒ½åœ¨ä¼ è¾“é€”ä¸­ä¸¢å¤±ã€‚é‚£ä¹ˆå½“å‡ºçŽ°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶æ˜¯å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆå°±æ˜¯è¶…æ—¶è¯¢é—®æœºåˆ¶ã€‚ ç³»ç»ŸAé™¤äº†å®žçŽ°æ­£å¸¸çš„ä¸šåŠ¡æµç¨‹å¤–ï¼Œè¿˜éœ€æä¾›ä¸€ä¸ªäº‹åŠ¡è¯¢é—®çš„æŽ¥å£ï¼Œä¾›æ¶ˆæ¯ä¸­é—´ä»¶è°ƒç”¨ã€‚å½“æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°ä¸€æ¡äº‹åŠ¡åž‹æ¶ˆæ¯åŽä¾¿å¼€å§‹è®¡æ—¶ï¼Œå¦‚æžœåˆ°äº†è¶…æ—¶æ—¶é—´ä¹Ÿæ²¡æ”¶åˆ°ç³»ç»ŸAå‘æ¥çš„Commitæˆ–RollbackæŒ‡ä»¤çš„è¯ï¼Œå°±ä¼šä¸»åŠ¨è°ƒç”¨ç³»ç»ŸAæä¾›çš„äº‹åŠ¡è¯¢é—®æŽ¥å£è¯¢é—®è¯¥ç³»ç»Ÿç›®å‰çš„çŠ¶æ€ã€‚è¯¥æŽ¥å£ä¼šè¿”å›žä¸‰ç§ç»“æžœï¼š æäº¤ è‹¥èŽ·å¾—çš„çŠ¶æ€æ˜¯â€œæäº¤â€ï¼Œåˆ™å°†è¯¥æ¶ˆæ¯æŠ•é€’ç»™ç³»ç»ŸBã€‚ å›žæ»š è‹¥èŽ·å¾—çš„çŠ¶æ€æ˜¯â€œå›žæ»šâ€ï¼Œåˆ™ç›´æŽ¥å°†æ¡æ¶ˆæ¯ä¸¢å¼ƒã€‚ å¤„ç†ä¸­ è‹¥èŽ·å¾—çš„çŠ¶æ€æ˜¯â€œå¤„ç†ä¸­â€ï¼Œåˆ™ç»§ç»­ç­‰å¾…ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶å‘ä¸‹æ¸¸ç³»ç»ŸæŠ•é€’å®Œæ¶ˆæ¯åŽä¾¿è¿›å…¥é˜»å¡žç­‰å¾…çŠ¶æ€ï¼Œä¸‹æ¸¸ç³»ç»Ÿä¾¿ç«‹å³è¿›è¡Œä»»åŠ¡çš„å¤„ç†ï¼Œä»»åŠ¡å¤„ç†å®ŒæˆåŽä¾¿å‘æ¶ˆæ¯ä¸­é—´ä»¶è¿”å›žåº”ç­”ã€‚æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°ç¡®è®¤åº”ç­”åŽä¾¿è®¤ä¸ºè¯¥äº‹åŠ¡å¤„ç†å®Œæ¯•ï¼ å¦‚æžœæ¶ˆæ¯åœ¨æŠ•é€’è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œæˆ–æ¶ˆæ¯çš„ç¡®è®¤åº”ç­”åœ¨è¿”å›žé€”ä¸­ä¸¢å¤±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶åœ¨ç­‰å¾…ç¡®è®¤åº”ç­”è¶…æ—¶ä¹‹åŽå°±ä¼šé‡æ–°æŠ•é€’ï¼Œç›´åˆ°ä¸‹æ¸¸æ¶ˆè´¹è€…è¿”å›žæ¶ˆè´¹æˆåŠŸå“åº”ä¸ºæ­¢ã€‚å½“ç„¶ï¼Œä¸€èˆ¬æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥è®¾ç½®æ¶ˆæ¯é‡è¯•çš„æ¬¡æ•°å’Œæ—¶é—´é—´éš”ï¼Œæ¯”å¦‚ï¼šå½“ç¬¬ä¸€æ¬¡æŠ•é€’å¤±è´¥åŽï¼Œæ¯éš”äº”åˆ†é’Ÿé‡è¯•ä¸€æ¬¡ï¼Œä¸€å…±é‡è¯•3æ¬¡ã€‚å¦‚æžœé‡è¯•3æ¬¡ä¹‹åŽä»ç„¶æŠ•é€’å¤±è´¥ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯å°±éœ€è¦äººå·¥å¹²é¢„ã€‚ æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ¡ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—å…·æœ‰äº‹åŠ¡æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œé˜¿é‡Œçš„RocketMQå¯ä»¥å®žçŽ°è¿™ä¸ªç›®æ ‡ã€‚å…¶ä»–çš„MQè¿˜ä¸è¡Œã€‚ æ–¹æ¡ˆ2ï¼šæœ€å¤§åŠªåŠ›é€šçŸ¥ï¼ˆå®šæœŸæ ¡å¯¹ï¼‰ ä¸Šæ¸¸ç³»ç»Ÿåœ¨å®Œæˆä»»åŠ¡åŽï¼Œå‘æ¶ˆæ¯ä¸­é—´ä»¶åŒæ­¥åœ°å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œç¡®ä¿æ¶ˆæ¯ä¸­é—´ä»¶æˆåŠŸæŒä¹…åŒ–è¿™æ¡æ¶ˆæ¯ï¼Œç„¶åŽä¸Šæ¸¸ç³»ç»Ÿå¯ä»¥åŽ»åšåˆ«çš„äº‹æƒ…äº†ï¼› æ¶ˆæ¯ä¸­é—´ä»¶æ”¶åˆ°æ¶ˆæ¯åŽè´Ÿè´£å°†è¯¥æ¶ˆæ¯åŒæ­¥æŠ•é€’ç»™ç›¸åº”çš„ä¸‹æ¸¸ç³»ç»Ÿï¼Œå¹¶è§¦å‘ä¸‹æ¸¸ç³»ç»Ÿçš„ä»»åŠ¡æ‰§è¡Œï¼› å½“ä¸‹æ¸¸ç³»ç»Ÿå¤„ç†æˆåŠŸåŽï¼Œå‘æ¶ˆæ¯ä¸­é—´ä»¶åé¦ˆç¡®è®¤åº”ç­”ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶ä¾¿å¯ä»¥å°†è¯¥æ¡æ¶ˆæ¯åˆ é™¤ï¼Œä»Žè€Œè¯¥äº‹åŠ¡å®Œæˆã€‚ ä¸Šé¢æ˜¯ä¸€ä¸ªç†æƒ³åŒ–çš„è¿‡ç¨‹ï¼Œä½†åœ¨å®žé™…åœºæ™¯ä¸­ï¼Œå¾€å¾€ä¼šå‡ºçŽ°å¦‚ä¸‹å‡ ç§æ„å¤–æƒ…å†µï¼š æ¶ˆæ¯ä¸­é—´ä»¶å‘ä¸‹æ¸¸ç³»ç»ŸæŠ•é€’æ¶ˆæ¯å¤±è´¥ ä¸Šæ¸¸ç³»ç»Ÿå‘æ¶ˆæ¯ä¸­é—´ä»¶å‘é€æ¶ˆæ¯å¤±è´¥ å¯¹äºŽç¬¬ä¸€ç§æƒ…å†µï¼Œæ¶ˆæ¯ä¸­é—´ä»¶å…·æœ‰é‡è¯•æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆæ¯ä¸­é—´ä»¶ä¸­è®¾ç½®æ¶ˆæ¯çš„é‡è¯•æ¬¡æ•°å’Œé‡è¯•æ—¶é—´é—´éš”ï¼Œå¯¹äºŽç½‘ç»œä¸ç¨³å®šå¯¼è‡´çš„æ¶ˆæ¯æŠ•é€’å¤±è´¥çš„æƒ…å†µï¼Œå¾€å¾€é‡è¯•å‡ æ¬¡åŽæ¶ˆæ¯ä¾¿å¯ä»¥æˆåŠŸæŠ•é€’ï¼Œå¦‚æžœè¶…è¿‡äº†é‡è¯•çš„ä¸Šé™ä»ç„¶æŠ•é€’å¤±è´¥ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¸­é—´ä»¶ä¸å†æŠ•é€’è¯¥æ¶ˆæ¯ï¼Œè€Œæ˜¯è®°å½•åœ¨å¤±è´¥æ¶ˆæ¯è¡¨ä¸­ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶éœ€è¦æä¾›å¤±è´¥æ¶ˆæ¯çš„æŸ¥è¯¢æŽ¥å£ï¼Œä¸‹æ¸¸ç³»ç»Ÿä¼šå®šæœŸæŸ¥è¯¢å¤±è´¥æ¶ˆæ¯ï¼Œå¹¶å°†å…¶æ¶ˆè´¹ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œå®šæœŸæ ¡å¯¹â€ã€‚ å¦‚æžœé‡å¤æŠ•é€’å’Œå®šæœŸæ ¡å¯¹éƒ½ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå¾€å¾€æ˜¯å› ä¸ºä¸‹æ¸¸ç³»ç»Ÿå‡ºçŽ°äº†ä¸¥é‡çš„é”™è¯¯ï¼Œæ­¤æ—¶å°±éœ€è¦äººå·¥å¹²é¢„ã€‚ å¯¹äºŽç¬¬äºŒç§æƒ…å†µï¼Œéœ€è¦åœ¨ä¸Šæ¸¸ç³»ç»Ÿä¸­å»ºç«‹æ¶ˆæ¯é‡å‘æœºåˆ¶ã€‚å¯ä»¥åœ¨ä¸Šæ¸¸ç³»ç»Ÿå»ºç«‹ä¸€å¼ æœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œå¹¶å°† ä»»åŠ¡å¤„ç†è¿‡ç¨‹ å’Œ å‘æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­æ’å…¥æ¶ˆæ¯ è¿™ä¸¤ä¸ªæ­¥éª¤æ”¾åœ¨ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­å®Œæˆã€‚å¦‚æžœå‘æœ¬åœ°æ¶ˆæ¯è¡¨æ’å…¥æ¶ˆæ¯å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘å›žæ»šï¼Œä¹‹å‰çš„ä»»åŠ¡å¤„ç†ç»“æžœå°±ä¼šè¢«å–æ¶ˆã€‚ å¦‚æžœè¿™ä¸¤æ­¥éƒ½æ‰§è¡ŒæˆåŠŸï¼Œé‚£ä¹ˆè¯¥æœ¬åœ°äº‹åŠ¡å°±å®Œæˆäº†ã€‚æŽ¥ä¸‹æ¥ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„æ¶ˆæ¯å‘é€è€…ä¸æ–­åœ°å‘é€æœ¬åœ°æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯ï¼Œå¦‚æžœå‘é€å¤±è´¥å®ƒä¼šè¿”å›žé‡è¯•ã€‚å½“ç„¶ï¼Œä¹Ÿè¦ç»™æ¶ˆæ¯å‘é€è€…è®¾ç½®é‡è¯•çš„ä¸Šé™ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¾¾åˆ°é‡è¯•ä¸Šé™ä»ç„¶å‘é€å¤±è´¥ï¼Œé‚£å°±æ„å‘³ç€æ¶ˆæ¯ä¸­é—´ä»¶å‡ºçŽ°ä¸¥é‡çš„é—®é¢˜ï¼Œæ­¤æ—¶ä¹Ÿåªæœ‰äººå·¥å¹²é¢„æ‰èƒ½è§£å†³é—®é¢˜ã€‚ å¯¹äºŽä¸æ”¯æŒäº‹åŠ¡åž‹æ¶ˆæ¯çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¦‚æžœè¦å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡çš„è¯ï¼Œå°±å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚å®ƒèƒ½å¤Ÿé€šè¿‡é‡è¯•æœºåˆ¶+å®šæœŸæ ¡å¯¹å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†ç›¸æ¯”äºŽç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œå®ƒè¾¾åˆ°æ•°æ®ä¸€è‡´æ€§çš„å‘¨æœŸè¾ƒé•¿ï¼Œè€Œä¸”è¿˜éœ€è¦åœ¨ä¸Šæ¸¸ç³»ç»Ÿä¸­å®žçŽ°æ¶ˆæ¯é‡è¯•å‘å¸ƒæœºåˆ¶ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯æˆåŠŸå‘å¸ƒç»™æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œè¿™æ— ç–‘å¢žåŠ äº†ä¸šåŠ¡ç³»ç»Ÿçš„å¼€å‘æˆæœ¬ï¼Œä½¿å¾—ä¸šåŠ¡ç³»ç»Ÿä¸å¤Ÿçº¯ç²¹ï¼Œå¹¶ä¸”è¿™äº›é¢å¤–çš„ä¸šåŠ¡é€»è¾‘æ— ç–‘ä¼šå ç”¨ä¸šåŠ¡ç³»ç»Ÿçš„ç¡¬ä»¶èµ„æºï¼Œä»Žè€Œå½±å“æ€§èƒ½ã€‚ å› æ­¤ï¼Œå°½é‡é€‰æ‹©æ”¯æŒäº‹åŠ¡åž‹æ¶ˆæ¯çš„æ¶ˆæ¯ä¸­é—´ä»¶æ¥å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¦‚RocketMQã€‚è¿˜æœ‰å…¶ä»–çš„ä¸€äº›è§£å†³æ€è·¯ï¼Œè¿™é‡Œå°±æš‚æ—¶åªæè¿°è¿™äº›ã€‚åŽç»­å†å­¦ä¹ ã€‚ å‚è€ƒè‡ªï¼šhttps://juejin.im/post/5aa3c7736fb9a028bb189bca]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åº“å­˜æ‰£å‡é—®é¢˜]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F09%E5%BA%93%E5%AD%98%E6%89%A3%E5%87%8F%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[åº“å­˜æ‰£å‡é—®é¢˜ä¸€ç›´æ˜¯ç§’æ€ä¸­æœ€å…³é”®çš„ä¸€ä¸ªç‚¹ã€‚å¦‚æžœæŠŠæŽ§ä¸å¥½ï¼Œæ‰£æˆè´Ÿæ•°ï¼Œé‚£å¯å°±éº»çƒ¦äº†ï¼Œå¦‚ä¹ˆå¦‚ä½•ä¿è¯ä¸ä¼šå‡ºçŽ°è¶…å–è¿˜èƒ½ä¿è¯æ€§èƒ½å‘¢ï¼Ÿ ä¸€ã€æ‰£å‡åº“å­˜é—®é¢˜åˆ†æž åœ¨æäº¤è®¢å•çš„æ—¶å€™ï¼Œè¦æ‰£å‡åº“å­˜ï¼Œå¯¹äºŽsqlï¼Œæ˜¯è¿™ä¹ˆå†™çš„ï¼š 1update t_stcok set stock = stock-2 where sku_id = 1 é¦–å…ˆè¿™æ¡sqlå­˜åœ¨è¶…å–é—®é¢˜ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå‡æˆè´Ÿæ•°ã€‚å¯èƒ½ä¼šæ”¹æˆå¦‚ä¸‹ï¼š 1update t_stcok set stock = stock-2 where sku_id = 1 and stock &gt; 2 è¿™æ ·å¥½åƒè§£å†³äº†è¶…å–é—®é¢˜ã€‚ä½†æ˜¯å¼•å…¥äº†æ–°çš„é—®é¢˜ã€‚ç”±äºŽåº“å­˜ç‰µæ¶‰è¿›è´§ã€è¡¥è´§ç­‰ç³»ç»Ÿï¼Œæ‰€ä»¥æ˜¯ä¸ªç‹¬ç«‹çš„æœåŠ¡ã€‚ å¹¶ä¸”ï¼Œæ¯”å¦‚æˆ‘æ˜¯é€šè¿‡MQåŽ»é€šçŸ¥åº“å­˜è¿›è¡Œæ‰£å‡åº“å­˜ï¼Œä½†æ˜¯ç”±äºŽç½‘ç»œæŠ–åŠ¨ï¼Œè¯·æ±‚æ‰£å‡åº“å­˜æ²¡æœ‰ç»“æžœï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½éœ€è¦è¿›è¡Œé‡è¯•ã€‚é‡è¯•ä¹‹åŽï¼Œå¯èƒ½æˆåŠŸäº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæœ‰å¯èƒ½è¿™ä¸¤æ¬¡éƒ½æˆåŠŸäº†ã€‚é‚£ä¹ˆï¼Œä¸€ä¸ªç”¨æˆ·ä¹°ä¸€æ ·ä¸œè¥¿ï¼Œä½†æ˜¯åº“å­˜æ‰£äº†ä¸¤éã€‚è¿™å°±æ˜¯å¹‚ç­‰ã€‚å¦‚æžœä¸åšå¹‚ç­‰å¤„ç†ï¼Œé‡è¯•ä¼šå‡ºçŽ°ä¸Šè¿°è¿™ç§è‡´å‘½é—®é¢˜ã€‚ é‚£ä¹ˆå¦‚ä½•åšåˆ°å¹‚ç­‰å‘¢ï¼Ÿ å®žé™…ä¸Šå°±æ˜¯è¿½æ±‚æ•°æ®ä¸€è‡´æ€§ã€‚é‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘é”æ¥ä¿è¯ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œç”¨ä¹è§‚é”æ¥å®žçŽ°ï¼š 123select stock,version from t_stock;if(stock &gt; ç”¨æˆ·è´­ä¹°æ•°é‡) update t_stcok set stock = stock-2 where sku_id = 1 and version = last_version ä½†æ˜¯ï¼Œä¸€æ—¦å‡ºçŽ°å¹¶å‘ï¼Œé‚£ä¹ˆå¯èƒ½è¿™ä¸ªç”¨æˆ·æ˜¯æ‰§è¡Œupdateå¤±è´¥çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦åŽ»é‡è¯•(guava retryæˆ–è€…spring retryéƒ½å¯ä»¥ä¼˜é›…åœ°å®žçŽ°é‡è¯•)ï¼Œç›´åˆ°æˆåŠŸæˆ–è€…åº“å­˜å·²ç»ä¸è¶³ã€‚ é‚£ä¹ˆï¼Œåœ¨å°‘é‡å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä¹è§‚é”ï¼Œè¦ä¸ç„¶ä¼šå¤§é‡å¤±è´¥ï¼Œæ­¤æ—¶éœ€è¦ç”¨æ‚²è§‚é”ï¼š 12select * from t_stock for update;ä¸‹é¢æ‰§è¡Œupdateæ“ä½œã€‚ã€‚ã€‚ åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œç¬¬ä¸€å¥ä¸ºselect for updateï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œæ•°æ®å°±ä¼šè¢«æœ¬çº¿ç¨‹é”ä½ï¼Œæ•´ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæ‰èƒ½å…è®¸å…¶ä»–çº¿ç¨‹è¿›æ¥ã€‚ å­˜åœ¨çš„é—®é¢˜ï¼šä¸€ä¸ªçº¿ç¨‹é”ä½è¿™è¡Œæ•°æ®ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹éƒ½è¦ç­‰å¾…ï¼Œæ•ˆçŽ‡å¾ˆä½Žã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œè¿˜å¯ä»¥æé«˜æ•ˆçŽ‡å‘¢ï¼Ÿ å¯¹äºŽæ‰£å‡åº“å­˜ï¼Œå¾€å¾€æ˜¯å…ˆåœ¨redisä¸­è¿›è¡Œæ‰£å‡åº“å­˜ã€‚redisæ˜¯å•çº¿ç¨‹ï¼Œæ˜¯é«˜é€Ÿä¸²è¡Œæ‰§è¡Œï¼Œä¸å­˜åœ¨å¹¶å‘é—®é¢˜ã€‚ å¦‚æžœæ˜¯å•æœºredisï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ä¿è¯ä¸€æ¬¡æ€§æ‰§è¡Œ: 12345watch stockmultiif stock &gt; count stock = stock - count;exec ä½†æ˜¯ä¸èƒ½åœ¨é›†ç¾¤ä¸­ç”¨ï¼ˆåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šæ—¶ï¼‰ï¼Œæ‰€ä»¥ç”¨watchä¸é€šç”¨ã€‚ rediséƒ½æ˜¯åŽŸå­æ“ä½œï¼Œæ¯”å¦‚è‡ªå¢ž:incrbyï¼Œç”¨è¿™ä¸ªå°±å¯ä»¥åˆ¤æ–­åº“å­˜æ˜¯å¦å¤Ÿã€‚å°±æ˜¯æ‰€è°“çš„redisé¢„å‡åº“å­˜ã€‚ ä½†æ˜¯åœ¨å®žé™…ä¸­ï¼Œåº“å­˜è¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µï¼šåº“å­˜å’Œé”å®šåº“å­˜ã€‚ é”å®šåº“å­˜æ˜¯è¡¨ç¤ºå¤šå°‘ç”¨æˆ·çœŸæ­£ä¸‹å•äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ”¯ä»˜ã€‚é”å®šåº“å­˜+åº“å­˜=æ€»åº“å­˜ï¼Œç­‰ç”¨æˆ·çœŸæ­£æ”¯ä»˜ä¹‹åŽï¼Œå°±å¯ä»¥å°†é”å®šåº“å­˜å‡æŽ‰ã€‚é‚£ä¹ˆï¼Œæ­¤æ—¶ï¼Œredisä¸­éœ€è¦å­˜åº“å­˜å’Œé”å®šåº“å­˜è¿™ä¸¤ä¸ªå€¼ï¼Œä¸Šé¢å•ä¸€çš„åŽŸå­æ“ä½œå°±ä¸è¡Œäº†ã€‚ è§£å†³æ–¹æ¡ˆï¼šredis+lua ä¸ºä»€ä¹ˆè¦ç”¨luaå‘¢ï¼Ÿå¯ä»¥ç”¨luaå°†ä¸€ç³»åˆ—æ“ä½œå°è£…èµ·æ¥æ‰§è¡Œï¼Œè¾“å…¥è‡ªå·±çš„å‚æ•°å³å¯ã€‚luaè„šæœ¬åœ¨redisä¸­æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ã€åŽŸå­æ€§çš„ã€‚ OKï¼Œä¸‹é¢å°±å®žæˆ˜ä¸€æ³¢ï¼šæ ¹æ®skuIdæŸ¥è¯¢ç¼“å­˜ä¸­çš„åº“å­˜å€¼ã€‚ äºŒã€æŸ¥è¯¢åº“å­˜ï¼ˆè®¾ç½®åº“å­˜ï¼‰ é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜Žç¡®ä¸€ç‚¹ï¼Œredisä¸­çš„åº“å­˜åˆå§‹å€¼æ˜¯ç”±åŽå°çš„ç³»ç»Ÿäººå·¥æå‰é…ç½®å¥½çš„ï¼Œåœ¨è¿›è¡Œå•†å“é”€å”®æ—¶ï¼ˆç”¨æˆ·ä¸‹å•æ—¶ï¼‰ï¼Œç›´æŽ¥ä»Žredisä¸­å…ˆè¿›è¡Œåº“å­˜çš„æ‰£å‡ã€‚ è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œæ˜¯åœ¨ç¨‹åºä¸­è¿›è¡Œåˆ¤æ–­ï¼šå¦‚æžœrediså·²ç»æœ‰äº†è¿™ä¸ªåº“å­˜å€¼ï¼Œå°±å°†ä»–æŸ¥è¯¢å‡ºæ¥è¿”å›žï¼›å¦åˆ™ï¼Œå°±åŽ»æ•°æ®åº“æŸ¥è¯¢ï¼Œç„¶åŽå¯¹redisè¿›è¡Œåˆå§‹åŒ–ã€‚ è¿™é‡Œçš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚æžœå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬åˆå§‹åŒ–ä¸¤ä¸ªå€¼ï¼ˆåº“å­˜å€¼å’Œåº“å­˜é”å®šå€¼ï¼‰ï¼Œè¿™é‡Œé‡‡ç”¨luaè„šæœ¬ï¼Œåœ¨luaè„šæœ¬ä¸­å®Œæˆåˆå§‹åŒ–ï¼Œå¹¶ä¸”å¯¹äºŽä¸¤ä¸ªç”¨æˆ·åŒæ—¶è¿›è¡Œåˆå§‹åŒ–åº“å­˜çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨luaä¸­è¿›è¡Œåˆ¤æ–­,å› ä¸ºredisæ˜¯å•çº¿ç¨‹ï¼Œluaä¹Ÿæ˜¯å•çº¿ç¨‹ï¼Œä¸ç”¨æ‹…å¿ƒä¼šåŒæ—¶åˆå§‹åŒ–ä¸¤æ¬¡ã€‚ ä¸‹é¢é¦–å…ˆå†™ä¸€ä¸ªæŽ¥å£ï¼Œæ ¹æ®skuidæŸ¥è¯¢åº“å­˜(åº“å­˜å’Œé”å®šåº“å­˜)ï¼š 123456789101112@RequestMapping("/query/&#123;skuId&#125;")public ApiResult&lt;Stock&gt; queryStock(@PathVariable long skuId)&#123; ApiResult&lt;Stock&gt; result = new ApiResult(Constants.RESP_STATUS_OK,"åº“å­˜æŸ¥è¯¢æˆåŠŸ"); Stock stock = new Stock(); stock.setSkuId(skuId); int stockCount = stockService.queryStock(skuId); stock.setStock(stockCount); result.setData(stock); return result;&#125; serviceå±‚ï¼š 123456789101112131415161718192021222324252627282930@Overridepublic int queryStock(long skuId) &#123; //å…ˆæŸ¥redis Stock stock ; String stockKey = Constants.CACHE_PRODUCT_STOCK+":"+skuId; String stockLockKey = Constants.CACHE_PRODUCT_STOCK_LOCK+":"+skuId; //åªéœ€è¦æŸ¥è¯¢ä¸€ä¸ªå³å¯ï¼Œæ¯”å¦‚æˆ‘è¿™é‡ŒåªæŸ¥è¯¢åº“å­˜å°±è¡Œ Object stockObj = redisTemplate.opsForValue().get(stockKey); Integer stockInRedis = null ; if(stockObj!=null)&#123; stockInRedis = Integer.valueOf(stockObj.toString()); &#125; //æ²¡æœ‰ï¼Œé‚£ä¹ˆæˆ‘å°±éœ€è¦å°†æ•°æ®åº“ä¸­çš„æ•°æ®åˆå§‹åŒ–åˆ°redisä¸­ if(stockInRedis==null)&#123; //åŽ»æ•°æ®åº“æŸ¥è¯¢ ç„¶åŽå¯¹redisè¿›è¡Œåˆå§‹åŒ– stock = stockMapper.selectBySkuId(skuId); //ä¸¤ä¸ªkeyå’Œä¸¤ä¸ªåº“å­˜å€¼é€šè¿‡luaè„šæœ¬å¡žåˆ°redisä¸­ //è¿™é‡Œå¦‚æžœå‘ç”Ÿä¸¤ä¸ªç”¨æˆ·å¹¶å‘åˆå§‹åŒ–redisï¼Œè„šæœ¬ä¸­ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æžœå·²ç»åˆå§‹åŒ–äº†ï¼Œè„šæœ¬å°±ä¼šåœæ­¢æ‰§è¡Œ // è®¾ç½®åº“å­˜ä¸åº”è¯¥åœ¨è¿™é…ç½®ï¼Œåº”è¯¥æ˜¯åŽå°ç®¡ç†ç³»ç»Ÿè¿›è¡Œè®¾ç½®ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™é‡Œredisä¸­åº”è¯¥æ˜¯å¿…ç„¶å­˜åœ¨çš„ //å¦‚æžœæ˜¯åœ¨åŽå°é…ç½®ï¼Œå°±æ²¡æœ‰å¿…è¦è¿™ä¹ˆå¤æ‚äº† redisUtils.skuStockInit(stockKey,stockLockKey,stock.getStock().toString(),stock.getLockStock().toString()); &#125;else&#123; return stockInRedis;//ç¼“å­˜ä¸­æœ‰å°±ç›´æŽ¥è¿”å›ž &#125; //ç¼“å­˜ç»“æžœå¯èƒ½ä¼šè¿”å›žè®¾ç½®ä¸æˆåŠŸï¼Œæ‰€ä»¥è¿˜æ˜¯è¿”å›žæ•°æ®åº“æŸ¥è¯¢ç»“æžœ return stock.getStock();&#125; é‚£ä¹ˆè¿™ä¸ªå·¥å…·ç±»ä¸ºï¼š 123456789101112131415161718192021222324252627282930313233/** * æŸ¥çœ‹redisæ˜¯å¦å·²ç»åˆå§‹åŒ–å¥½åº“å­˜åˆå§‹å€¼ï¼Œæ²¡æœ‰å°±åˆå§‹åŒ– */public static final String STOCK_CACHE_LUA = "local stock = KEYS[1] " + "local stock_lock = KEYS[2] " + "local stock_val = tonumber(ARGV[1]) " + "local stock_lock_val = tonumber(ARGV[2]) " + "local is_exists = redis.call(\"EXISTS\", stock) " + "if is_exists == 1 then " + " return 0 " + "else " + " redis.call(\"SET\", stock, stock_val) " + " redis.call(\"SET\", stock_lock, stock_lock_val) " + " return 1 " + "end"; /** * @Description ç¼“å­˜skuåº“å­˜ ä»¥åŠé”å®šåº“å­˜ */public boolean skuStockInit(String stockKey,String stockLockKey,String stock,String stockLock)&#123; //ç”¨jedisåŽ»æ‰§è¡Œluaè„šæœ¬ è¾“å…¥çš„å‚æ•°è¦æ³¨æ„é¡ºåº éƒ½æ˜¯å†™æ­»çš„ ç¬¬ä¸€ç»„æ˜¯keyï¼Œç¬¬äºŒç»„æ˜¯stock Object result = redisTemplate.execute((RedisCallback&lt;Object&gt;) redisConnection -&gt; &#123; Jedis jedis = (Jedis)redisConnection.getNativeConnection(); return jedis.eval(STOCK_CACHE_LUA, Collections.unmodifiableList(Arrays.asList(stockKey,stockLockKey)) ,Collections.unmodifiableList(Arrays.asList(stock, stockLock))); &#125;); if (EXCUTE_SUCCESS.equals(result)) &#123; return true; &#125; return false;&#125; å¯¹äºŽluaè„šæœ¬è¿›è¡Œç¨å¾®çš„è§£é‡Šä¸€ä¸‹ï¼š 12345678910111213141516171819202122//ç¬¬ä¸€ç»„æ•°æ®æ˜¯keyæ•°ç»„ï¼›ç¬¬äºŒç»„æ•°æ®æ˜¯argsæ•°ç»„ï¼Œæ˜¯ä¸Žkeyæ•°ç»„å¯¹åº”çš„å€¼ï¼Œå°±æ˜¯åº“å­˜//æˆ‘ä»¬è¿™é‡Œç¬¬ä¸€ç»„ä¸º[stockKey,stockLockKey],å°±æ˜¯å­˜åœ¨redisä¸­çš„åå­—ï¼Œè¿™é‡Œæ˜¯åœ¨serviceå±‚ä¸­å®šä¹‰å¥½äº†//ç¬¬äºŒç»„ä¸º[50,0]ï¼Œè¿™ä¸ªå€¼å°±æ˜¯å¯ä»¥ä»Žæ•°æ®åº“è¡¨t_stockä¸­æŸ¥è¯¢å‡ºæ¥çš„//å› ä¸ºæ‰§è¡Œè¿™æ®µluaè„šæœ¬çš„è¯ï¼Œè¯´æ˜Žredisä¸­æ²¡æœ‰ç¼“å­˜çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åŽå°†ç¼“å­˜è®¾ç½®å¥½//luaä¸­å®šä¹‰å˜é‡ç”¨locallocal stock = KEYS[1]local stock_lock = KEYS[2]local stock_val = tonumber(ARGV[1])local stock_lock_val = tonumber(ARGV[2])//å†æŸ¥è¯¢ä¸€éç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œé˜²æ­¢ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥è®¾ç½®ç¼“å­˜//å­˜åœ¨å°±ä¸ç”¨è®¾ç½®ç¼“å­˜äº†ï¼Œå¦åˆ™å°±è®¾ç½®ç¼“å­˜local is_exists = redis.call("EXISTS", stock)if is_exists == 1 then return 0else redis.call("SET", stock, stock_val) redis.call("SET", stock_lock, stock_lock_val) return 1end é‚£ä¹ˆï¼Œå¯åŠ¨å·¥ç¨‹mama-buy-stockï¼šå‡å¦‚æˆ‘åŽ»æŸ¥è¯¢skuId=1çš„å•†å“ï¼š ç¬¬ä¸€æ¬¡åº“å­˜ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šåŽ»æŸ¥è¯¢æ•°æ®åº“ï¼š æˆ‘ä»¬å†æ¥çœ‹çœ‹redisä¸­çš„æ•°æ®ï¼š ä¸‰ã€æ‰£å‡åº“å­˜ ä¸‹é¢æ¥çœ‹çœ‹æ‰£å‡åº“å­˜æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚å› ä¸ºæäº¤è®¢å•åŽï¼Œå¾€å¾€æ˜¯ä¸æ­¢ä¸€ä»¶å•†å“çš„ï¼Œå¾€å¾€è´­ç‰©è½¦å†…æœ‰å¾ˆå¤šä»¶å•†å“ï¼ŒåŒæ—¶è¿‡æ¥ï¼Œå‡è®¾æœ‰äº”ä»¶å•†å“ï¼Œä½†æ˜¯å…¶ä¸­åªæœ‰ä¸€ä»¶æš‚æ—¶æ²¡æœ‰åº“å­˜äº†ï¼Œé‚£ä¹ˆæˆ‘è¿˜æ˜¯å¸Œæœ›å…¶ä»–çš„å››ä»¶å•†å“èƒ½å¤Ÿå–å‡ºåŽ»ï¼Œåªæ˜¯æ²¡æœ‰åº“å­˜çš„å•†å“å°±ä¸ç®—é’±äº†ã€‚æ‰€ä»¥æ‰£å‡åº“å­˜ç”¨ä¸€ä¸ªmapæ¥è£…ï¼Œå³Map&lt;skuId,count&gt; controllerå±‚ï¼š 1234567@RequestMapping("/reduce")public ApiResult&lt;Map&lt;Long,Integer&gt;&gt; reduceStock(@RequestBody List&lt;StockReduce&gt; stockReduceList)&#123; ApiResult result = new ApiResult(Constants.RESP_STATUS_OK,"åº“å­˜æ‰£å‡æˆåŠŸ"); Map&lt;Long,Integer&gt; resultMap = stockService.reduceStock(stockReduceList); result.setData(resultMap); return result;&#125; serviceå±‚ï¼š 1234567891011121314151617181920212223242526272829303132333435@Override@Transactionalpublic Map&lt;Long, Integer&gt; reduceStock(List&lt;StockReduce&gt; stockReduceList) &#123; Map&lt;Long, Integer&gt; resultMap = new HashMap&lt;&gt;(); //éåŽ†åŽ»å‡redisä¸­åº“å­˜ï¼Œå¢žåŠ é”å®šåº“å­˜ stockReduceList.stream().forEach(param -&gt; &#123; String stockKey = Constants.CACHE_PRODUCT_STOCK+":"+param.getSkuId(); String stockLockKey = Constants.CACHE_PRODUCT_STOCK_LOCK+":"+param.getSkuId(); Object result = redisUtils.reduceStock(stockKey, stockLockKey, param.getReduceCount().toString(),//incrbyä¸€ä¸ªè´Ÿæ•°ï¼Œå°±æ˜¯å‡ String.valueOf(Math.abs(param.getReduceCount())));//incrbyä¸€ä¸ªæ­£æ•°ï¼Œå°±æ˜¯åŠ  if(result instanceof Long)&#123; //åº“å­˜ä¸å­˜åœ¨æˆ–è€…ä¸è¶³ æ‰£å‡å¤±è´¥ skuä¸‹å•å¤±è´¥ è®°å½•ä¸‹æ¥ resultMap.put(param.getSkuId(),-1); &#125;else if (result instanceof List)&#123; //æ‰£å‡æˆåŠŸ è®°å½•æ‰£å‡æµæ°´ List resultList = ((List) result); int stockAftChange = ((Long)resultList.get(0)).intValue(); int stockLockAftChange = ((Long) resultList.get(1)).intValue(); StockFlow stockFlow = new StockFlow(); stockFlow.setOrderNo(param.getOrderNo()); stockFlow.setSkuId(param.getSkuId()); stockFlow.setLockStockAfter(stockLockAftChange); stockFlow.setLockStockBefore(stockLockAftChange+param.getReduceCount()); stockFlow.setLockStockChange(Math.abs(param.getReduceCount())); stockFlow.setStockAfter(stockAftChange); stockFlow.setStockBefore(stockAftChange+Math.abs(param.getReduceCount())); stockFlow.setStockChange(param.getReduceCount()); stockFlowMapper.insertSelective(stockFlow); resultMap.put(param.getSkuId(),1); &#125; &#125;); return resultMap;&#125; å¯¹äºŽredisçš„æ“ä½œï¼ŒåŸºæœ¬ä¸Žä¸Šä¸€è‡´ï¼š 12345678910111213141516171819202122232425262728293031323334/** * @Description æ‰£å‡åº“å­˜luaè„šæœ¬ * @Return 0 keyä¸å­˜åœ¨ é”™è¯¯ -1 åº“å­˜ä¸è¶³ è¿”å›žlist æ‰£å‡æˆåŠŸ */public static final String STOCK_REDUCE_LUA= "local stock = KEYS[1]\n" + "local stock_lock = KEYS[2]\n" + "local stock_change = tonumber(ARGV[1])\n" + "local stock_lock_change = tonumber(ARGV[2])\n" + "local is_exists = redis.call(\"EXISTS\", stock)\n" + "if is_exists == 1 then\n" + " local stockAftChange = redis.call(\"INCRBY\", stock,stock_change)\n" + " if(stockAftChange&lt;0) then\n" + " redis.call(\"DECRBY\", stock,stock_change)\n" + " return -1\n" + " else \n" + " local stockLockAftChange = redis.call(\"INCRBY\", stock_lock,stock_lock_change)\n" + " return &#123;stockAftChange,stockLockAftChange&#125;\n" + " end " + "else \n" + " return 0\n" + "end"; public Object reduceStock(String stockKey,String stockLockKey,String stockChange,String stockLockChange)&#123; Object result = redisTemplate.execute((RedisCallback&lt;Object&gt;) redisConnection -&gt; &#123; Jedis jedis = (Jedis)redisConnection.getNativeConnection(); return jedis.eval(STOCK_REDUCE_LUA, Collections.unmodifiableList(Arrays.asList(stockKey,stockLockKey)) ,Collections.unmodifiableList(Arrays.asList(stockChange, stockLockChange))); &#125;); return result;&#125; æ­¤æ—¶ï¼Œä¸€æ—¦æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šå›žæ»šï¼Œä½†æ˜¯redisä¸­æ˜¯æ— æ³•å›žæ»šçš„ã€‚è¿™ä¸ªé—®é¢˜ä¸ç”¨æ‹…å¿ƒï¼Œå› ä¸ºæ•°æ®åº“å‘ç”Ÿå¼‚å¸¸æ˜¯åŠå…¶ä¸¥é‡çš„é—®é¢˜ï¼Œæ˜¯å¾ˆå°‘ä¼šå‘ç”Ÿçš„ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œåªéœ€è¦åŽ»è¿™ä¸ªæµæ°´çš„è¡¨ä¸­åŽ»æŸ¥çœ‹æƒ…å†µï¼Œç„¶åŽåŽ»æ‰§è¡Œè„šæœ¬åŽ»åˆå§‹åŒ–è¿™ä¸ªrediså³å¯ã€‚æ‰€ä»¥æ˜¯å¯ä»¥è¡¥æ•‘çš„ã€‚ ä½†æ˜¯æŽ¥å£çš„å¹‚ç­‰æ€§è¿˜æ²¡æœ‰åšã€‚é‡å¤å°è¯•è°ƒç”¨è¿™ä¸ªæŽ¥å£ï¼ˆé€šå¸¸æ˜¯å‘ç”Ÿåœ¨MQçš„å¤±è´¥é‡ä¼ æœºåˆ¶ï¼Œå®¢æˆ·ç«¯çš„è¿žç»­ç‚¹å‡»ä¸€èˆ¬æ˜¯å¯ä»¥é¿å…çš„ï¼‰ï¼Œå¯èƒ½ä¼šé‡å¤å‡redisåº“å­˜å¹¶ä¸”é‡å¤åœ°åŽ»æ’å…¥æµæ°´è®°å½•ã€‚è¿™ä¸ªé—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ å››ã€redisåˆ†å¸ƒå¼é”æ¥å®žçŽ°å¹‚ç­‰æ€§ ä¸»æµçš„æ–¹æ¡ˆï¼Œæ¯”å¦‚æœ‰ç”¨ä¸€å¼ è¡¨æ¥æŽ§åˆ¶ï¼Œæ¯”å¦‚ä»¥è¿™ä¸ªorderIDä¸ºå”¯ä¸€ä¸»é”®ï¼Œä¸€æ—¦æ’å…¥æˆåŠŸï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªå”¯ä¸€ä¸»é”®çš„å­˜åœ¨ä¸Žå¦åˆ¤æ–­æ˜¯å¦ä¸ºé‡å¤è¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œçš„æ‰£å‡åº“å­˜å’Œæ’å…¥åŽ»é‡è¡¨æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œï¼ŒåŽ»é‡è¡¨ä¸­æœ‰ä¸€ä¸ªå­—æ®µä¸ºorderIdï¼Œå…¨å±€å”¯ä¸€ä¸é‡å¤ï¼Œç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œçº¦æŸï¼Œé‚£ä¹ˆæ’å…¥çš„æ—¶å€™åˆ¤æ–­è¿™ä¸ªåŽ»é‡è¡¨æ˜¯å¦å¯ä»¥æ’å…¥æˆåŠŸï¼Œå¦‚æžœä¸æˆåŠŸï¼Œé‚£ä¹ˆæ•°æ®åº“æ“ä½œå…¨éƒ¨å›žæ»šï¼‰ã€‚ å¯ä»¥ç”¨redisåˆ†å¸ƒå¼é”ç»™è¿™ä¸ªè®¢å•ä¸Šé”ã€‚ä»¥è®¢å•idä¸ºé”ï¼Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹æ¥æ‰£å‡åº“å­˜ï¼Œæ‰€ä»¥ä¸å½±å“æ€§èƒ½ã€‚ é’ˆå¯¹è¿™ä¸ªè®¢å•ï¼Œç¬¬ä¸€æ¬¡è‚¯å®šæ˜¯å¯ä»¥åŽ»æ‰£å‡åº“å­˜çš„ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡å†æŽ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆå°±è¦è¿”å›žå·²ç»æˆåŠŸäº†ï¼Œä¸è¦å†é‡å¤æ‰£å‡ã€‚ å¯¹äºŽreduceStock()è¿™ä¸ªæ–¹æ³•æœ€å‰é¢å¢žåŠ é”ï¼š 123456789//é˜²æ­¢æ‰£å‡åº“å­˜æ—¶MQæ­£å¸¸é‡è¯•æ—¶çš„ä¸å¹‚ç­‰//ä»¥è®¢å•ID åŠ ä¸ªç¼“å­˜é” é˜²æ­¢ç¨‹åºçŸ­æ—¶é—´é‡è¯• é‡å¤æ‰£å‡åº“å­˜ ä¸ç”¨è§£é” è‡ªå·±è¶…æ—¶Long orderNo = stockReduceList.get(0).getOrderNo();boolean lockResult = redisUtils.distributeLock(Constants.ORDER_RETRY_LOCK+orderNo.toString(),orderNo.toString(),300000);if(!lockResult)&#123; //é”å®šå¤±è´¥ é‡å¤æäº¤ è¿”å›žä¸€ä¸ªç©ºmap return Collections.EMPTY_MAP;&#125;... 123456789101112131415161718192021222324252627282930313233343536373839404142private static final String LOCK_SUCCESS = "OK";private static final String SET_IF_NOT_EXIST = "NX";private static final String SET_WITH_EXPIRE_TIME = "PX";private static final Long EXCUTE_SUCCESS = 1L;/**luaè„šæœ¬ åœ¨redisä¸­ luaè„šæœ¬æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ åŽŸå­çš„ */private static final String UNLOCK_LUA= "if redis.call('get', KEYS[1]) == ARGV[1] then " + " return redis.call('del', KEYS[1]) " + "else " + " return 0 " + "end";/** * @Description èŽ·å–åˆ†å¸ƒå¼é” * @Return boolean */public boolean distributeLock(String lockKey, String requestId, int expireTime)&#123; String result = redisTemplate.execute((RedisCallback&lt;String&gt;) redisConnection -&gt; &#123; JedisCommands commands = (JedisCommands)redisConnection.getNativeConnection(); return commands.set(lockKey,requestId,SET_IF_NOT_EXIST,SET_WITH_EXPIRE_TIME,expireTime);//ä¸€æ¡å‘½ä»¤å®žçŽ°setnxå’Œsetexpireè¿™äº›æ“ä½œï¼ŒåŽŸå­æ€§ &#125;); if (LOCK_SUCCESS.equals(result)) &#123; return true; &#125; return false;&#125;/** * @Description é‡Šæ”¾åˆ†å¸ƒå¼é” * @Return boolean */public boolean releaseDistributelock(String lockKey, String requestId)&#123; Object result = redisTemplate.execute((RedisCallback&lt;Object&gt;) redisConnection -&gt; &#123; Jedis jedis = (Jedis)redisConnection.getNativeConnection(); return jedis.eval(UNLOCK_LUA, Collections.singletonList(lockKey), Collections.singletonList(requestId));//luaè„šæœ¬ä¸­åŽŸå­æ€§å®žçŽ°ï¼šgetæŸ¥è¯¢å’Œdeleteåˆ é™¤è¿™ä¸¤ä¸ªæ“ä½œ &#125;); if (EXCUTE_SUCCESS.equals(result)) &#123; return true; &#125; return false;&#125; æ³¨æ„ï¼Œè¿™é‡Œä¸éœ€è¦æˆ‘ä»¬ä¸»åŠ¨åŽ»é‡Šæ”¾åˆ†å¸ƒå¼é”ï¼Œåªè¦è®¾ç½®ä¸€ä¸ªå¤§äºŽé‡è¯•æ—¶é—´çš„è¿‡æœŸæ—¶é—´å³å¯ã€‚è®©å®ƒè‡ªå·±åˆ é™¤ã€‚ æ³¨æ„redisåœ¨é›†ç¾¤ä¸‹åšåˆ†å¸ƒå¼é”ï¼Œæœ€å¥½è¦ç”¨Redissionã€‚è¿™é‡Œå¦‚æžœç”¨äºŽé›†ç¾¤ï¼Œå¦‚ä½•luaè„šæœ¬åœ¨ä¸€ä¸ªäº‹åŠ¡é‡ŒåŒæ—¶æ“ä½œå¤šä¸ªkeyçš„æ—¶å€™ï¼Œå¦‚æžœè¦ä¿è¯è¿™ä¸ªäº‹åŠ¡ç”Ÿæ•ˆï¼Œå°±éœ€è¦ä¿è¯è¿™å‡ ä¸ªkeyéƒ½è¦åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ä½†æ˜¯ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„ä¸¤ä¸ªkeyï¼š 12public static final String CACHE_PRODUCT_STOCK = "product:stock";public static final String CACHE_PRODUCT_STOCK_LOCK = "product:stock:lock"; å› ä¸ºæˆ‘ä»¬è¿™é‡Œè¦åŒæ—¶å¯¹åº“å­˜å’Œé”å®šåº“å­˜è¿™ä¸¤ä¸ªkeyè¿›è¡Œæ“ä½œï¼Œéœ€è¦æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡å†…æ‰§è¡Œï¼Œä¸å¤„ç†çš„è¯ï¼Œä¸€æ—¦ä»–ä»¬ä¸åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆäº‹åŠ¡å°±ä¸ä¼šç”Ÿæ•ˆï¼Œè§£å†³æ–¹æ¡ˆï¼š 12public static final String CACHE_PRODUCT_STOCK = "&#123;product:stock&#125;";public static final String CACHE_PRODUCT_STOCK_LOCK = "&#123;product:stock&#125;:lock"; å¦‚æžœåŠ ä¸ŠèŠ±æ‹¬å·ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œè®¡ç®—hashå€¼çš„æ—¶å€™ï¼Œä»–ä»¬ä¸¤å°±ä¼šæ˜¯ä¸€æ ·çš„ï¼Œä¼šè¢«æŠ•æ”¾åˆ°åŒä¸€ä¸ªslotä¸­ï¼Œè‡ªç„¶å°±ä¿è¯äº†åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ äº”ã€æµ‹è¯•ä¸€ä¸‹]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ELKå¹³å°æ­å»º]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F08ELK%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[å› ä¸ºè¦å®Œæˆäº§å“çš„å…¨æ–‡æœç´¢è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦å‡†å¤‡ä¸€ä¸‹ESçš„çŽ¯å¢ƒã€‚æœ¬èŠ‚å®‰è£…ELKã€‚ ELKç”±Elasticsearchã€Logstashå’ŒKibanaä¸‰éƒ¨åˆ†ç»„ä»¶ç»„æˆã€‚ å‰è¨€ Elasticsearchæ˜¯ä¸ªå¼€æºåˆ†å¸ƒå¼æœç´¢å¼•æ“Žï¼Œå®ƒçš„ç‰¹ç‚¹æœ‰ï¼šåˆ†å¸ƒå¼ï¼Œé›¶é…ç½®ï¼Œè‡ªåŠ¨å‘çŽ°ï¼Œç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ï¼Œç´¢å¼•å‰¯æœ¬æœºåˆ¶ï¼Œrestfulé£Žæ ¼æŽ¥å£ï¼Œå¤šæ•°æ®æºï¼Œè‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰ã€‚ ç®€å•æ¥è¯´ï¼Œä»–æ˜¯ä¸ªå…¨æ–‡æœç´¢å¼•æ“Žï¼Œå¯ä»¥å¿«é€Ÿåœ°å‚¨å­˜ã€æœç´¢å’Œåˆ†æžæµ·é‡æ•°æ®ã€‚ Logstashæ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„å·¥å…·ï¼Œå®ƒå¯ä»¥æŠŠåˆ†æ•£çš„ã€å¤šæ ·åŒ–çš„æ—¥å¿—æ—¥å¿—ï¼Œæˆ–è€…æ˜¯å…¶ä»–æ•°æ®æºçš„æ•°æ®ä¿¡æ¯è¿›è¡Œæ”¶é›†ã€åˆ†æžã€å¤„ç†ï¼Œå¹¶å°†å…¶å­˜å‚¨ä¾›ä»¥åŽä½¿ç”¨ã€‚ Kibanaæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æžå’Œå¯è§†åŒ–å¹³å°ï¼Œè®¾è®¡ç”¨äºŽå’ŒElasticsearchä¸€èµ·å·¥ä½œã€‚ ä½ ç”¨Kibanaæ¥æœç´¢ï¼ŒæŸ¥çœ‹ï¼Œå¹¶å’Œå­˜å‚¨åœ¨Elasticsearchç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œäº¤äº’ã€‚ ä½ å¯ä»¥è½»æ¾åœ°æ‰§è¡Œé«˜çº§æ•°æ®åˆ†æžï¼Œå¹¶ä¸”ä»¥å„ç§å›¾æ ‡ã€è¡¨æ ¼å’Œåœ°å›¾çš„å½¢å¼å¯è§†åŒ–æ•°æ®ã€‚ Kibanaä½¿å¾—ç†è§£å¤§é‡æ•°æ®å˜å¾—å¾ˆå®¹æ˜“ã€‚å®ƒç®€å•çš„ã€åŸºäºŽæµè§ˆå™¨çš„ç•Œé¢ä½¿ä½ èƒ½å¤Ÿå¿«é€Ÿåˆ›å»ºå’Œå…±äº«åŠ¨æ€ä»ªè¡¨æ¿ï¼Œå®žæ—¶æ˜¾ç¤ºElasticsearchæŸ¥è¯¢çš„å˜åŒ–ã€‚ ä¸€ã€å®‰è£…ES 1.1 é¦–å…ˆæ˜¯å®‰è£…JDKï¼š 12345cd /opt/wget --no-cookies --no-check-certificate --header &quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot; &quot;http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz&quot;tar xzf jdk-8u141-linux-x64.tar.gz 1.2 æ·»åŠ çŽ¯å¢ƒå˜é‡ï¼š 123456789101112vim /etc/profileJAVA_HOME=/opt/jdk1.8.0_141JAVA_JRE=$JAVA_HOME/jreCLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/libPATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/binexport JAVA_HOME JRE_HOME CLASS_PATH PATHsource /etc/profilejava -version 1.3 ä¸‹è½½6.2.4ç‰ˆæœ¬ï¼š 123456wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.tar.gztar -xzvf elasticsearch-6.2.4.tar.gztar -zxvf elasticsearch-6.2.4.tar.gzmv elasticsearch-6.2.4 elasticsearch 1.4 é…ç½®sysctl.conf 1234567891011#ä¿®æ”¹sysctlé…ç½®vim /etc/sysctl.conf #æ·»åŠ å¦‚ä¸‹é…ç½®vm.max_map_count=262144 #è®©é…ç½®ç”Ÿæ•ˆsysctl -p #æŸ¥çœ‹é…ç½®çš„æ•°ç›®sysctl -a|grep vm.max_map_count 1.5 elasticsearchä»Ž5.0ç‰ˆæœ¬ä¹‹åŽä¸å…è®¸rootè´¦æˆ·å¯åŠ¨ 1234567891011121314151617181920#æ·»åŠ ç”¨æˆ·adduser dev #è®¾å®šå¯†ç passwd dev #æ·»åŠ æƒé™chown -R dev /opt/elasticsearch #åˆ‡æ¢ç”¨æˆ·su dev #æŸ¥çœ‹å½“å‰ç”¨æˆ·who am i #å¯åŠ¨./elasticsearch/bin/elasticsearch #åŽå°å¯åŠ¨./elasticsearch/bin/elasticsearch -d 1.6 é…ç½®limits.conf 123456789101112131415vim /etc/security/limits.conf æŠŠ* soft nofile 65535* hard nofile 65535 æ”¹ä¸º* soft nofile 65536* hard nofile 65536 #åˆ‡æ¢ç”¨æˆ·su dev #æŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆulimit -Hn 1.7 é…ç½®æ‰€æœ‰ç”¨æˆ·è®¿é—® 1vim /opt/elasticsearch/config/elasticsearch.yml 1.8 æ·»åŠ ä¸€ä¸‹å†…å®¹ 1network.host: 0.0.0.0 1.9 é‡å¯ 12ps -ef | grep elastickill -9 xxxx 1.10 æµ‹è¯•ï¼š 1curl http://localhost:9200/ æ˜¾ç¤ºï¼š 123456789101112131415&#123; &quot;name&quot; : &quot;MmiaBfA&quot;, &quot;cluster_name&quot; : &quot;elasticsearch&quot;, &quot;cluster_uuid&quot; : &quot;zjX-q5PDRLyrWMy5TiBDkw&quot;, &quot;version&quot; : &#123; &quot;number&quot; : &quot;6.2.4&quot;, &quot;build_hash&quot; : &quot;ccec39f&quot;, &quot;build_date&quot; : &quot;2018-04-12T20:37:28.497551Z&quot;, &quot;build_snapshot&quot; : false, &quot;lucene_version&quot; : &quot;7.2.1&quot;, &quot;minimum_wire_compatibility_version&quot; : &quot;5.6.0&quot;, &quot;minimum_index_compatibility_version&quot; : &quot;5.0.0&quot; &#125;, &quot;tagline&quot; : &quot;You Know, for Search&quot;&#125; å°±è¯´æ˜ŽæˆåŠŸäº†ã€‚ äºŒã€å®‰è£…Kibana 6.2.4 1234567wget https://artifacts.elastic.co/downloads/kibana/kibana-6.2.4-linux-x86_64.tar.gztar -zxvf kibana-6.2.4-linux-x86_64.tar.gzmv kibana-6.2.4-linux-x86_64 kibanavim /opt/kibana/config/kibana.yml 2.1 æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 123server.port: 5601server.host: &quot;0.0.0.0&quot;elasticsearch.url: &quot;http://127.0.0.1:9200&quot; 2.2 åˆ‡æ¢åˆ°binç›®å½•ä¸‹ï¼Œå¯åŠ¨å³å¯ã€‚ 12345#ä¸èƒ½å…³é—­ç»ˆç«¯./kibana #å¯å…³é—­ç»ˆç«¯nohup ./kibana &amp; 2.3 å¼€æ”¾é˜²ç«å¢™å’Œå®‰å…¨ç»„å¯¹åº”çš„è¿™ä¸ªç«¯å£ æµè§ˆå™¨è®¿é—®ï¼šhttp://106.14.163.235:5601 çœ‹åˆ°ä¸€ä¸ªæŽ§åˆ¶å°é¡µé¢å°±æˆåŠŸå•¦ã€‚ 2.4 å…³é—­è¿™ä¸ªè¿›ç¨‹ 1234567891011121314ps -ef|grep kibana ps -ef|grep 5601 éƒ½æ‰¾ä¸åˆ° å°è¯• ä½¿ç”¨ fuser -n tcp 5601 kill -9 ç«¯å£ å¯åŠ¨å³å¯ ./kibanaæˆ–è€…åŽ»è¿™ä¸ªç›®å½•ä¸‹çš„.outæ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°çœ‹åˆ°å®ƒå ç”¨çš„pid ä¸‰ã€logstash 1234567891011# ä¸‹è½½wget https://artifacts.elastic.co/downloads/logstash/logstash-6.2.4.tar.gz# è§£åŽ‹tar -zxvf logstash-6.2.4.tar.gz# é‡å‘½åmv logstash-6.2.4.tar.gz logstash# è¿›å…¥cd logstash 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061# æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ æˆ‘è¿™é‡Œæ˜¯mysqltones.confinput &#123; stdin &#123; &#125; jdbc &#123; jdbc_connection_string =&gt; &quot;jdbc:mysql://127.0.0.1:3306/mama-buy-trade&quot; jdbc_user =&gt; &quot;root&quot; jdbc_password =&gt; &quot;root&quot; jdbc_driver_library =&gt; &quot;/opt/logstash/mysql-connector-java-5.1.46-bin.jar&quot; # the name of the driver class for mysql jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot; jdbc_paging_enabled =&gt; &quot;true&quot; jdbc_page_size =&gt; &quot;50000&quot; # mysqlæ–‡ä»¶, ä¹Ÿå¯ä»¥ç›´æŽ¥å†™SQLè¯­å¥åœ¨æ­¤å¤„ï¼Œå¦‚ä¸‹ï¼š statement =&gt; &quot;SELECT * from t_product&quot; # statement_filepath =&gt; &quot;/opt/logstash/conf/jdbc.sql&quot; # è¿™é‡Œç±»ä¼¼crontab,å¯ä»¥å®šåˆ¶å®šæ—¶æ“ä½œï¼Œæ¯”å¦‚æ¯10åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡åŒæ­¥(åˆ† æ—¶ å¤© æœˆ å¹´) schedule =&gt; &quot;*/10 * * * *&quot; type =&gt; &quot;jdbc&quot; # æ˜¯å¦è®°å½•ä¸Šæ¬¡æ‰§è¡Œç»“æžœ, å¦‚æžœä¸ºçœŸ,å°†ä¼šæŠŠä¸Šæ¬¡æ‰§è¡Œåˆ°çš„ tracking_column å­—æ®µçš„å€¼è®°å½•ä¸‹æ¥,ä¿å­˜åˆ° last_run_metadata_path æŒ‡å®šçš„æ–‡ä»¶ä¸­ record_last_run =&gt; &quot;true&quot; # æ˜¯å¦éœ€è¦è®°å½•æŸä¸ªcolumn çš„å€¼,å¦‚æžœrecord_last_runä¸ºçœŸ,å¯ä»¥è‡ªå®šä¹‰æˆ‘ä»¬éœ€è¦ track çš„ column åç§°ï¼Œæ­¤æ—¶è¯¥å‚æ•°å°±è¦ä¸º true. å¦åˆ™é»˜è®¤ track çš„æ˜¯ timestamp çš„å€¼. use_column_value =&gt; &quot;true&quot; # å¦‚æžœ use_column_value ä¸ºçœŸ,éœ€é…ç½®æ­¤å‚æ•°. track çš„æ•°æ®åº“ column å,è¯¥ column å¿…é¡»æ˜¯é€’å¢žçš„. ä¸€èˆ¬æ˜¯mysqlä¸»é”® tracking_column =&gt; &quot;id&quot; last_run_metadata_path =&gt; &quot;/opt/logstash/conf/last_id&quot; # æ˜¯å¦æ¸…é™¤ last_run_metadata_path çš„è®°å½•,å¦‚æžœä¸ºçœŸé‚£ä¹ˆæ¯æ¬¡éƒ½ç›¸å½“äºŽä»Žå¤´å¼€å§‹æŸ¥è¯¢æ‰€æœ‰çš„æ•°æ®åº“è®°å½• clean_run =&gt; &quot;false&quot; # æ˜¯å¦å°† å­—æ®µ(column) åç§°è½¬å°å†™ lowercase_column_names =&gt; &quot;false&quot; &#125;&#125;# æ­¤å¤„æˆ‘ä¸åšè¿‡æ»¤å¤„ç†filter &#123;&#125;output &#123; # è¾“å‡ºåˆ°elasticsearchçš„é…ç½® elasticsearch &#123; hosts =&gt; [&quot;127.0.0.1:9200&quot;] index =&gt; &quot;jdbc&quot; # å°†&quot;_id&quot;çš„å€¼è®¾ä¸ºmysqlçš„autoidå­—æ®µ document_id =&gt; &quot;%&#123;id&#125;&quot; template_overwrite =&gt; true &#125; # è¿™é‡Œè¾“å‡ºè°ƒè¯•ï¼Œæ­£å¼è¿è¡Œæ—¶å¯ä»¥æ³¨é‡ŠæŽ‰ stdout &#123; codec =&gt; json_lines &#125;&#125; 12# å¯åŠ¨./bin/logstash -f ./mysqltones.conf çœ‹åˆ°è¿™ä¸ªå°±è¯´æ˜ŽæˆåŠŸäº†ï¼š å®‰è£…mysqlæ•°æ®åº“ è¿™ä¸€æ­¥è¦åœ¨æ‰§è¡Œlogstashä¹‹å‰æžå®šï¼Œæˆ‘çš„æ˜¯é˜¿é‡Œäº‘centos7.3ç‰ˆæœ¬ï¼Œmysqlç‰ˆæœ¬æ˜¯5.7ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839# ä¸‹è½½MySQLæºå®‰è£…åŒ…: wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm# å®‰è£…MySQLæºï¼šyum localinstall mysql57-community-release-el7-8.noarch.rpm # æ£€æŸ¥MySQLæºå®‰è£…æƒ…å†µï¼š yum repolist enabled | grep &quot;mysql.*-community.*&quot;# å®‰è£…MySQL: yum install mysql-community-server# å¯åŠ¨MySQL: systemctl start mysqld# æŸ¥çœ‹MySQLçŠ¶æ€: systemctl status mysqld# è®¾ç½®å¼€æœºå¯åŠ¨MySQLï¼šsystemctl enable mysqld systemctl daemon-reload# æŸ¥æ‰¾å¹¶ä¿®æ”¹MySQLé»˜è®¤å¯†ç ï¼ˆæ³¨æ„å¯†ç è¦ç¬¦åˆè§„èŒƒï¼Œå¦åˆ™ä¼šå¤±è´¥ï¼‰ï¼šgrep &apos;temporary password&apos; /var/log/mysqld.log mysql -uroot -p alter user root@localhost identified by &apos;ä½ çš„æ–°å¯†ç &apos;;# è¿œç¨‹è¿žæŽ¥æµ‹è¯•æ·»åŠ è¿œç¨‹è´¦æˆ·ï¼šGRANT ALL PRIVILEGES ON *.* TO &apos;ç”¨æˆ·&apos;@&apos;%&apos; IDENTIFIED BY &apos;å¯†ç &apos; WITH GRANT OPTION;# ç«‹å³ç”Ÿæ•ˆï¼šflush privileges;# é€€å‡ºMySQLï¼šexit# æœ€åŽè¿œç¨‹å°†æ•°æ®ç»™å¯¼å…¥æ•°æ®åº“ å®‰è£…åˆ†è¯å™¨ ik_max_wordæ˜¯åˆ†è¯æ¯”è¾ƒç»†è…»çš„ä¸€æ¬¾ï¼Œæˆ‘ä»¬å°±ç”¨å®ƒæ¥åšåˆ†è¯ï¼Œé¦–å…ˆéœ€è¦å®‰è£…ä¸€ä¸‹ï¼š 12345678# ç›´æŽ¥å®‰è£…./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.2.4/elasticsearch-analysis-ik-6.2.4.zip # é‡æ–°å¯åŠ¨ESps -ef | grep elastickill -9 xxxxsu dev./bin/elasticsearch -d å¯¹è¿™ä¸ªåˆ†è¯å™¨åœ¨kibanaä¸­è¿›è¡Œæµ‹è¯•ï¼š ä¸‹é¢ç»“åˆæ•°æ®åº“æ¨¡æ‹Ÿä¸€ä¸‹ï¼š]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Curator]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F07Curator%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%2F</url>
    <content type="text"><![CDATA[ä»ŽæŠ€æœ¯è§’åº¦å‡ºå‘ï¼Œæ³¨å†Œä¸€ä¸ªç½‘ç«™ï¼Œå†é«˜å¹¶å‘çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å‡ºçŽ°ç”¨æˆ·åé‡å¤è¿™æ ·çš„é—®é¢˜ï¼ˆè™½ç„¶ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šå‡ºçŽ°è¿™ç§é—®é¢˜ï¼‰ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿ ä»Žæ•°æ®åº“è§’åº¦ï¼Œå¯¹äºŽå•è¡¨ï¼Œæˆ‘å¯ä»¥ç”¨select .. for updateæ‚²è§‚é”å®žçŽ°ï¼Œæˆ–è€…ç”¨versionè¿™ç§ä¹è§‚é”çš„æ€æƒ³ã€‚ æ›´å¥½çš„æ–¹æ³•æ˜¯å°†è¿™ä¸ªå­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•ï¼Œç”¨æ•°æ®åº“æ¥ä¿è¯ä¸ä¼šé‡å¤ã€‚ä¸€æ—¦æ’å…¥é‡å¤ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºå°±å¯ä»¥æ•èŽ·åˆ°ã€‚ ä½†æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬è¿™é‡Œåˆ†è¡¨äº†ï¼Œä»¥ä¸Šéƒ½æ˜¯é’ˆå¯¹å•è¡¨ï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯é”è¡¨ï¼Œä¸è¡Œï¼Œè®¾ç½®å”¯ä¸€ç´¢å¼•æ˜¯æ²¡æœ‰ç”¨ã€‚æ€Žä¹ˆåŠžå‘¢ï¼Ÿ è§£å†³æ–¹æ¡ˆï¼šç”¨ZKåšä¸€ä¸ªåˆ†å¸ƒå¼é”ã€‚ é¦–å…ˆå‡†å¤‡ä¸€ä¸ªZKå®¢æˆ·ç«¯ï¼Œç”¨çš„æ˜¯Curatoræ¥è¿žæŽ¥æˆ‘ä»¬çš„ZKï¼š 1234567891011121314151617181920@Componentpublic class ZkClient &#123; @Autowired private Parameters parameters; @Bean public CuratorFramework getZkClient()&#123; CuratorFrameworkFactory.Builder builder= CuratorFrameworkFactory.builder() .connectString(parameters.getZkHost()) .connectionTimeoutMs(3000) .retryPolicy(new RetryNTimes(5, 10)); CuratorFramework framework = builder.build(); framework.start(); return framework; &#125;&#125; æ³¨å†Œç”¨ä¸€ä¸ªåˆ†å¸ƒå¼é”æ¥æŽ§åˆ¶ï¼š 1234567891011121314151617181920212223242526272829303132333435@Overridepublic void registerUser(User user) throws Exception &#123; InterProcessLock lock = null; try&#123; lock = new InterProcessMutex(zkClient, Constants.USER_REGISTER_DISTRIBUTE_LOCK_PATH); boolean retry = true; do&#123; if (lock.acquire(3000, TimeUnit.MILLISECONDS))&#123; //æŸ¥è¯¢é‡å¤ç”¨æˆ· User repeatedUser = userMapper.selectByEmail(user.getEmail()); if(repeatedUser!=null)&#123; throw new MamaBuyException("ç”¨æˆ·é‚®ç®±é‡å¤"); &#125; user.setPassword(passwordEncoder.encode(user.getPassword())); user.setNickname("ç ç è´­ç”¨æˆ·"+user.getEmail()); userMapper.insertSelective(user); //è·³å‡ºå¾ªçŽ¯ retry = false; &#125; //å¯ä»¥é€‚å½“ä¼‘æ¯ä¸€ä¼š...ä¹Ÿå¯ä»¥è®¾ç½®é‡å¤æ¬¡æ•°ï¼Œä¸è¦æ— é™å¾ªçŽ¯ &#125;while (retry); &#125;catch (Exception e)&#123; log.error("ç”¨æˆ·æ³¨å†Œå¼‚å¸¸",e); throw e; &#125;finally &#123; if(lock != null)&#123; try &#123; lock.release(); log.info(user.getEmail()+Thread.currentThread().getName()+"é‡Šæ”¾é”"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; æ€è·¯éžå¸¸ç®€å•ï¼Œå°±æ˜¯å…ˆå°è¯•ä¸Šé”ï¼Œå³acquireï¼Œä½†æ˜¯æœ‰å¯èƒ½å¤±è´¥ï¼Œæ‰€ä»¥è¿™é‡Œç”¨ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå³3000msä¹‹å†…ä¸Šä¸äº†é”å°±å¤±è´¥ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªçŽ¯ã€‚æœ€åŽé‡Šæ”¾é”å³å¯ã€‚ okï¼Œè¿™é‡Œè¦æ¥è¯´è¯´ZKå®žçŽ°åˆ†å¸ƒå¼é”äº†ã€‚è¿™é‡Œç”¨äº†å¼€æºå®¢æˆ·ç«¯Curatorï¼Œä»–å¯¹äºŽå®žçŽ°åˆ†å¸ƒå¼é”è¿›è¡Œäº†å°è£…ï¼Œä½†æ˜¯ï¼Œæˆ‘è¿˜æ˜¯æƒ³äº†è§£ä¸€ä¸‹å®ƒçš„å®žçŽ°åŽŸç†ï¼š æ¯ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸ªæ–¹æ³•åŠ é”æ—¶ï¼Œåœ¨zookeeperä¸Šçš„ä¸Žè¯¥æ–¹æ³•å¯¹åº”çš„æŒ‡å®šèŠ‚ç‚¹çš„ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„çž¬æ—¶æœ‰åºèŠ‚ç‚¹ã€‚ åˆ¤æ–­æ˜¯å¦èŽ·å–é”çš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­æœ‰åºèŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ä¸€ä¸ªã€‚ å½“é‡Šæ”¾é”çš„æ—¶å€™ï¼Œåªéœ€å°†è¿™ä¸ªçž¬æ—¶èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚åŒæ—¶ï¼Œå…¶å¯ä»¥é¿å…æœåŠ¡å®•æœºå¯¼è‡´çš„é”æ— æ³•é‡Šæ”¾ï¼Œè€Œäº§ç”Ÿçš„æ­»é”é—®é¢˜ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹å°±æ˜¯Leaderï¼Œè¿›æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸ºé‚£ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯çš„è¯å°±å¯ä»¥èŽ·å–åˆ°é”ï¼Œåä¹‹ä¸è¡Œã€‚ ä¸ºä»€ä¹ˆä¸èƒ½é€šè¿‡å¤§å®¶ä¸€èµ·åˆ›å»ºèŠ‚ç‚¹ï¼Œå¦‚æžœè°æˆåŠŸäº†å°±ç®—èŽ·å–åˆ°äº†é”ã€‚ å¤šä¸ªclientåˆ›å»ºä¸€ä¸ªåŒåçš„èŠ‚ç‚¹ï¼Œå¦‚æžœèŠ‚ç‚¹è°åˆ›å»ºæˆåŠŸé‚£ä¹ˆè¡¨ç¤ºèŽ·å–åˆ°äº†é”ï¼Œåˆ›å»ºå¤±è´¥è¡¨ç¤ºæ²¡æœ‰èŽ·å–åˆ°é”ã€‚ ç­”ï¼šä½¿ç”¨ä¸´æ—¶é¡ºåºèŠ‚ç‚¹å¯ä»¥ä¿è¯èŽ·å¾—é”çš„å…¬å¹³æ€§ï¼ŒåŠè°å…ˆæ¥è°å°±å…ˆå¾—åˆ°é”ï¼Œè¿™ç§æ–¹å¼æ˜¯éšæœºèŽ·å–é”ï¼Œä¼šé€ æˆæ— åºå’Œé¥¥é¥¿ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Session]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F06Spring%20Session%2F</url>
    <content type="text"><![CDATA[åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨http sessionåŽ»ç®¡ç†ç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯åˆ°äº†åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹ï¼Œæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºsessionå¯¹äºŽä¸åŒçš„æœºå™¨æ˜¯éš”ç¦»çš„ï¼Œè€Œhttpæœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œé‚£ä¹ˆå°±æ— æ³•åˆ¤æ–­å‡ºç”¨æˆ·åœ¨å“ªä¸€ä¸ªæœåŠ¡å™¨ä¸Šç™»é™†çš„ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„åœ°æ–¹å­˜å‚¨ç”¨æˆ·sessionã€‚spring sessionå¯ä»¥åšåˆ°æ— ä»£ç ä¾µå…¥çš„æ–¹å¼å®žçŽ°åˆ†å¸ƒå¼sessionå­˜å‚¨ã€‚ åœ¨spring bootå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å…ˆæ³¨å†Œç›¸åº”beanå¹¶ä¸”æ‰“å¼€ç›¸åº”çš„æ³¨è§£ï¼š 1234567891011121314151617181920212223242526272829@Configuration@EnableRedisHttpSession //(maxInactiveIntervalInSeconds = 604800)//sessionè¶…æ—¶public class HttpSessionConfig &#123; @Autowired private Parameters parameters; @Bean public HttpSessionStrategy httpSessionStrategy()&#123; return new HeaderHttpSessionStrategy(); &#125; @Bean public JedisConnectionFactory connectionFactory()&#123; JedisConnectionFactory connectionFactory = new JedisConnectionFactory(); String redisHost = parameters.getRedisNode().split(":")[0]; int redisPort = Integer.valueOf(parameters.getRedisNode().split(":")[1]); connectionFactory.setTimeout(2000); connectionFactory.setHostName(redisHost); connectionFactory.setPort(redisPort);// connectionFactory.setPassword(parameters.getRedisAuth()); return connectionFactory; &#125;&#125; okï¼Œè¿™æ ·å­å…¶å®žå°±é…ç½®å¥½äº†ï¼Œä¸€å¼€å§‹æˆ‘ä¹Ÿäº‘é‡Œé›¾é‡Œçš„ï¼Œè¿™æ˜¯å•¥çŽ©æ„ï¼Ÿ å…¶å®žå®˜ç½‘çš„æ–‡æ¡£ä¸­è®²çš„æ˜¯æœ€å‡†ç¡®çš„ã€‚æ‰€ä»¥è¿˜æ˜¯å®˜ç½‘çœ‹çœ‹å§ï¼ okï¼Œæ¥spring sessionçš„å®˜ç½‘(https://spring.io/projects/spring-session)æ¥çœ‹çœ‹æŠŠï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹1.3.4GAç‰ˆæœ¬çš„æ–‡æ¡£(https://docs.spring.io/spring-session/docs/1.3.4.RELEASE/reference/html5/#httpsession-rest). spring sessionå¯ä»¥å­˜åœ¨å¾ˆå¤šä»‹è´¨ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æ•°æ®æºï¼Œæ¯”å¦‚redisï¼Œç”šè‡³æ˜¯mongodbç­‰ã€‚ä½†æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯å­˜åœ¨redisä¸­ï¼Œç»“åˆredisçš„è¿‡æœŸæœºåˆ¶æ¥åšã€‚ æ‰€ä»¥å…¶å®žæˆ‘ä»¬åªè¦å…³å¿ƒå¦‚ä½•è·Ÿredisæ•´åˆï¼Œä»¥åŠrestfulæŽ¥å£ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€å¼€å§‹æ–‡æ¡£å°±å‘Šè¯‰æˆ‘ä»¬è¦é…ç½®ä¸€ä¸‹HttpSessionStrategyå’Œå­˜å‚¨ä»‹è´¨ã€‚ä»ŽHttpSessionStrategyè¯­ä¹‰å°±èƒ½å¤§è‡´çœ‹å‡ºé…ç½®çš„æ˜¯å®ƒçš„ç­–ç•¥ï¼Œæ˜¯åŸºäºŽheaderçš„ç­–ç•¥ã€‚è¿™ä¸ªæ˜¯ä»€ä¹ˆæ„æ€ï¼Œä¸‹é¢ä¼šæåˆ°ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹çœ‹æ–‡æ¡£å§ï¼ å¥½äº†ï¼Œæˆ‘ä»¬çŸ¥é“äº†å®ƒçš„åŸºæœ¬åŽŸç†ï¼Œä¸‹é¢æ¥çœ‹çœ‹æ˜¯å¦‚ä½•åœ¨restfulæŽ¥å£ä¸­å®žçŽ°ç”¨æˆ·sessionçš„ç®¡ç†çš„ï¼š ä¹Ÿå°±æ˜¯è¯´è¦æƒ³åœ¨restfulæŽ¥å£åº”ç”¨ä¸­ç”¨è¿™ç§æ–¹å¼ï¼Œç›´æŽ¥å‘Šè¯‰spring session:return new HeaderHttpSessionStrategy();å³å¯ã€‚è¿›å…¥æºç æˆ‘ä»¬å°±ä¼šçŸ¥é“ï¼Œå®ƒé»˜è®¤ç»™è¿™ä¸ªheaderé‡Œé¢æ”¾ç½®çš„ä¸€æ¡ç±»ä¼¼äºŽtokençš„åå­—æ˜¯private String headerName = &quot;x-auth-token&quot;;ã€‚ é‚£ä¹ˆåœ¨ç”¨æˆ·ç™»é™†æˆåŠŸä¹‹åŽï¼Œåˆ°åº•å­˜åˆ°æ˜¯ä»€ä¹ˆå‘¢ï¼Œå…ˆæ¥çœ‹çœ‹å“åº”æ•°æ®çš„headeré‡Œé¢æ˜¯ä»€ä¹ˆï¼š è¿™ä¸€ä¸²æ•°å­—æ­£å¥½å¯ä»¥è·Ÿredisä¸­å¯¹åº”ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¥redisä¸­çœ‹çœ‹åˆ°åº•åœ¨é‡Œé¢å­˜å‚¨äº†å•¥çŽ©æ„ï¼š æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†æƒ³è¦çœ‹åˆ°çš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹redisä¸­å­˜å‚¨çš„ä¸œè¥¿ï¼š spring:sessionæ˜¯é»˜è®¤çš„Redis HttpSessionå‰ç¼€ï¼ˆredisä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨â€™:â€™ä½œä¸ºåˆ†å‰²ç¬¦ï¼‰ æ¯ä¸€ä¸ªsessionéƒ½ä¼šæœ‰ä¸‰ä¸ªç›¸å…³çš„keyï¼Œç¬¬ä¸€ä¸ªkey(spring:session:sessions:37...)æœ€ä¸ºé‡è¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªHASHæ•°æ®ç»“æž„ï¼Œå°†å†…å­˜ä¸­çš„sessionä¿¡æ¯åºåˆ—åŒ–åˆ°äº†redisä¸­ã€‚å¦‚æœ¬é¡¹ç›®ä¸­ç”¨æˆ·ä¿¡æ¯,è¿˜æœ‰ä¸€äº›metaä¿¡æ¯ï¼Œå¦‚åˆ›å»ºæ—¶é—´ï¼Œæœ€åŽè®¿é—®æ—¶é—´ç­‰ã€‚ å¦å¤–ä¸¤ä¸ªkeyï¼Œä¸€ä¸ªæ˜¯spring:session:expirationï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯spring:session:sessions:expiresï¼Œå‰è€…æ˜¯ä¸€ä¸ªSETç±»åž‹ï¼ŒåŽè€…æ˜¯ä¸€ä¸ªSTRINGç±»åž‹ï¼Œå¯èƒ½ä¼šæœ‰è¯»è€…å‘å‡ºè¿™æ ·çš„ç–‘é—®ï¼Œredisè‡ªèº«å°±æœ‰è¿‡æœŸæ—¶é—´çš„è®¾ç½®æ–¹å¼TTLï¼Œä¸ºä»€ä¹ˆè¦é¢å¤–æ·»åŠ ä¸¤ä¸ªkeyæ¥ç»´æŒsessionè¿‡æœŸçš„ç‰¹æ€§å‘¢ï¼Ÿredisæ¸…é™¤è¿‡æœŸkeyçš„è¡Œä¸ºæ˜¯ä¸€ä¸ªå¼‚æ­¥è¡Œä¸ºä¸”æ˜¯ä¸€ä¸ªä½Žä¼˜å…ˆçº§çš„è¡Œä¸ºï¼Œç”¨æ–‡æ¡£ä¸­çš„åŽŸè¯æ¥è¯´ä¾¿æ˜¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´sessionä¸è¢«æ¸…é™¤ã€‚äºŽæ˜¯å¼•å…¥äº†ä¸“é—¨çš„expiresKeyï¼Œæ¥ä¸“é—¨è´Ÿè´£sessionçš„æ¸…é™¤ï¼ŒåŒ…æ‹¬æˆ‘ä»¬è‡ªå·±åœ¨ä½¿ç”¨redisæ—¶ä¹Ÿéœ€è¦å…³æ³¨è¿™ä¸€ç‚¹ã€‚ è¿™æ ·å­ï¼Œå°±å¯ä»¥ç”¨ç‹¬ç«‹çš„redisæ¥å­˜å‚¨ç”¨æˆ·çš„ä¿¡æ¯ï¼Œé€šè¿‡å‰ç«¯ä¼ æ¥çš„headeré‡Œé¢çš„tokenï¼Œå°±å¯ä»¥åˆ°redisæ‹¿å‡ºå½“å‰ç™»é™†ç”¨æˆ·çš„ä¿¡æ¯äº†ã€‚ OKï¼Œåœ¨è§£å†³äº†spring sessionçš„é—®é¢˜ä¹‹åŽï¼Œä¸‹é¢å°±å¯ä»¥æ¥å®žçŽ°ç™»é™†å•¦ï¼š controller: 1234567891011121314@RequestMapping("login")public ApiResult login(@RequestBody @Valid User user, HttpSession session)&#123; ApiResult&lt;UserElement&gt; result = new ApiResult&lt;&gt;(Constants.RESP_STATUS_OK,"ç™»å½•æˆåŠŸ"); UserElement ue= userService.login(user); if(ue != null)&#123; if(session.getAttribute(Constants.REQUEST_USER_SESSION) == null)&#123; session.setAttribute(Constants.REQUEST_USER_SESSION,ue); &#125; result.setData(ue); &#125; return result;&#125; å°±è·Ÿä»¥å‰ä¸€æ ·ï¼Œå°†sessionç›´æŽ¥å­˜è¿›åŽ»å°±å¯ä»¥äº†ã€‚ 12345678910111213141516171819202122@Overridepublic UserElement login(User user) &#123; UserElement ue = null; User userExist = userMapper.selectByEmail(user.getEmail()); if(userExist != null)&#123; //å¯¹å¯†ç ä¸Žæ•°æ®åº“å¯†ç è¿›è¡Œæ ¡éªŒ boolean result = passwordEncoder.matches(user.getPassword(),userExist.getPassword()); if(!result)&#123; throw new MamaBuyException("å¯†ç é”™è¯¯"); &#125;else&#123; //æ ¡éªŒå…¨éƒ¨é€šè¿‡ï¼Œç™»é™†é€šè¿‡ ue = new UserElement(); ue.setUserId(userExist.getId()); ue.setEmail(userExist.getEmail()); ue.setNickname(userExist.getNickname()); ue.setUuid(userExist.getUuid()); &#125; &#125;else &#123; throw new MamaBuyException("ç”¨æˆ·ä¸å­˜åœ¨"); &#125; return ue;&#125;]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼IDç”Ÿæˆç­–ç•¥]]></title>
    <url>%2F2019%2F01%2F23%2Fmiscellany%2F05%E5%88%86%E5%B8%83%E5%BC%8FID%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹å¦‚ä½•ä¿è¯IDçš„ä¸é‡å¤å‘¢ï¼Ÿä¸€èˆ¬æˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°ç”¨UUIDæ¥å®žçŽ°å˜›ã€‚ä½†æ˜¯UUIDä¸€èˆ¬å¯ä»¥èŽ·å–å½“å‰æ—¶é—´çš„æ¯«ç§’æ•°å†åŠ ç‚¹éšæœºæ•°ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘ä¸‹ä»ç„¶å¯èƒ½é‡å¤ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¦‚æžœæˆ‘è¦ç”¨è¿™ç§UUIDæ¥ç”Ÿæˆåˆ†è¡¨çš„å”¯ä¸€IDçš„è¯ï¼Œé‡å¤ä¸è°ˆï¼Œè¿™ç§éšæœºçš„å­—ç¬¦ä¸²å¯¹äºŽæˆ‘ä»¬çš„innodbå­˜å‚¨å¼•æ“Žçš„æ’å…¥æ•ˆçŽ‡æ˜¯å¾ˆä½Žçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç”Ÿæˆçš„IDå¦‚æžœä½œä¸ºä¸»é”®ï¼Œæœ€å¥½æœ‰ä¸¤ç§ç‰¹æ€§ï¼šåˆ†å¸ƒå¼å”¯ä¸€å’Œæœ‰åºã€‚ å”¯ä¸€æ€§å°±ä¸ç”¨è¯´äº†ï¼Œæœ‰åºä¿è¯äº†å¯¹ç´¢å¼•å­—æ®µçš„æ’å…¥çš„é«˜æ•ˆæ€§ã€‚æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ShardingJDBCçš„åˆ†å¸ƒå¼IDç”Ÿæˆç­–ç•¥æ˜¯å¦‚ä½•ä¿è¯ã€‚ snowflakeç®—æ³• sharding-jdbcçš„åˆ†å¸ƒå¼IDé‡‡ç”¨twitterå¼€æºçš„snowflakeç®—æ³•ï¼Œä¸éœ€è¦ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œè¿™æ ·å…¶æ‰©å±•æ€§å’Œç»´æŠ¤æ€§å¾—åˆ°æœ€å¤§çš„ç®€åŒ–ï¼›ä½†æ˜¯snowflakeç®—æ³•çš„ç¼ºé™·ï¼ˆå¼ºä¾èµ–æ—¶é—´ï¼Œå¦‚æžœæ—¶é’Ÿå›žæ‹¨ï¼Œå°±ä¼šç”Ÿæˆé‡å¤çš„IDï¼‰ã€‚ é›ªèŠ±ç®—æ³•æ˜¯ç”±Twitterå…¬å¸ƒçš„åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆç®—æ³•ï¼Œå®ƒèƒ½å¤Ÿä¿è¯ä¸åŒè¿›ç¨‹ä¸»é”®çš„ä¸é‡å¤æ€§ï¼Œä»¥åŠç›¸åŒè¿›ç¨‹ä¸»é”®çš„æœ‰åºæ€§ã€‚ åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå®ƒé¦–å…ˆæ˜¯é€šè¿‡æ—¶é—´ä½ä¿è¯ä¸é‡å¤ï¼Œå¦‚æžœæ—¶é—´ç›¸åŒåˆ™æ˜¯é€šè¿‡åºåˆ—ä½ä¿è¯ã€‚ åŒæ—¶ç”±äºŽæ—¶é—´ä½æ˜¯å•è°ƒé€’å¢žçš„ï¼Œä¸”å„ä¸ªæœåŠ¡å™¨å¦‚æžœå¤§ä½“åšäº†æ—¶é—´åŒæ­¥ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ä¸»é”®åœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒå¯ä»¥è®¤ä¸ºæ˜¯æ€»ä½“æœ‰åºçš„ï¼Œè¿™å°±ä¿è¯äº†å¯¹ç´¢å¼•å­—æ®µçš„æ’å…¥çš„é«˜æ•ˆæ€§ã€‚ä¾‹å¦‚MySQLçš„Innodbå­˜å‚¨å¼•æ“Žçš„ä¸»é”®ã€‚ ä½¿ç”¨é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ä¸»é”®ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼åŒ…å«4éƒ¨åˆ†ï¼Œä»Žé«˜ä½åˆ°ä½Žä½åˆ†è¡¨ä¸ºï¼š1bitç¬¦å·ä½ã€41bitæ—¶é—´æˆ³ä½ã€10bitå·¥ä½œè¿›ç¨‹ä½ä»¥åŠ12bitåºåˆ—å·ä½ã€‚ é›ªèŠ±ç®—æ³•ä¸»é”®çš„è¯¦ç»†ç»“æž„è§ä¸‹å›¾ã€‚ ç¬¦å·ä½(1bit) é¢„ç•™çš„ç¬¦å·ä½ï¼Œæ’ä¸ºé›¶ã€‚ æ—¶é—´æˆ³ä½(41bit) 41ä½çš„æ—¶é—´æˆ³å¯ä»¥å®¹çº³çš„æ¯«ç§’æ•°æ˜¯2çš„41æ¬¡å¹‚ï¼Œä¸€å¹´æ‰€ä½¿ç”¨çš„æ¯«ç§’æ•°æ˜¯ï¼š365 * 24 * 60 * 60 * 1000ã€‚é€šè¿‡è®¡ç®—å¯çŸ¥ï¼š 1Math.pow(2, 41) / (365 * 24 * 60 * 60 * 1000L); ç»“æžœçº¦ç­‰äºŽ69.73å¹´ã€‚ShardingSphereçš„é›ªèŠ±ç®—æ³•çš„æ—¶é—´çºªå…ƒä»Ž2016å¹´11æœˆ1æ—¥é›¶ç‚¹å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ°2086å¹´ï¼Œç›¸ä¿¡èƒ½æ»¡è¶³ç»å¤§éƒ¨åˆ†ç³»ç»Ÿçš„è¦æ±‚ã€‚ å·¥ä½œè¿›ç¨‹ä½(10bit) è¯¥æ ‡å¿—åœ¨Javaè¿›ç¨‹å†…æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æžœæ˜¯åˆ†å¸ƒå¼åº”ç”¨éƒ¨ç½²åº”ä¿è¯æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„idæ˜¯ä¸åŒçš„ã€‚è¯¥å€¼é»˜è®¤ä¸º0ï¼Œå¯é€šè¿‡è°ƒç”¨é™æ€æ–¹æ³•DefaultKeyGenerator.setWorkerId()è®¾ç½®ã€‚ åºåˆ—å·ä½(12bit) è¯¥åºåˆ—æ˜¯ç”¨æ¥åœ¨åŒä¸€ä¸ªæ¯«ç§’å†…ç”Ÿæˆä¸åŒçš„IDã€‚å¦‚æžœåœ¨è¿™ä¸ªæ¯«ç§’å†…ç”Ÿæˆçš„æ•°é‡è¶…è¿‡4096(2çš„12æ¬¡å¹‚)ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨ä¼šç­‰å¾…åˆ°ä¸‹ä¸ªæ¯«ç§’ç»§ç»­ç”Ÿæˆã€‚ æ—¶é’Ÿå›žæ‹¨ æœåŠ¡å™¨æ—¶é’Ÿå›žæ‹¨ä¼šå¯¼è‡´äº§ç”Ÿé‡å¤åºåˆ—ï¼Œå› æ­¤é»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨æä¾›äº†ä¸€ä¸ªæœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›žæ‹¨æ¯«ç§’æ•°ã€‚ å¦‚æžœæ—¶é’Ÿå›žæ‹¨çš„æ—¶é—´è¶…è¿‡æœ€å¤§å®¹å¿çš„æ¯«ç§’æ•°é˜ˆå€¼ï¼Œåˆ™ç¨‹åºæŠ¥é”™ï¼›å¦‚æžœåœ¨å¯å®¹å¿çš„èŒƒå›´å†…ï¼Œé»˜è®¤åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆå™¨ä¼šç­‰å¾…æ—¶é’ŸåŒæ­¥åˆ°æœ€åŽä¸€æ¬¡ä¸»é”®ç”Ÿæˆçš„æ—¶é—´åŽå†ç»§ç»­å·¥ä½œã€‚ æœ€å¤§å®¹å¿çš„æ—¶é’Ÿå›žæ‹¨æ¯«ç§’æ•°çš„é»˜è®¤å€¼ä¸º0ï¼Œå¯é€šè¿‡è°ƒç”¨é™æ€æ–¹æ³•DefaultKeyGenerator.setMaxTolerateTimeDifferenceMilliseconds()è®¾ç½®ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[springMVCå…¨å±€å¼‚å¸¸+springåŒ…æ‰«æåŒ…éš”ç¦»+springäº‹åŠ¡ä¼ æ’­]]></title>
    <url>%2F2019%2F01%2F22%2Fmiscellany%2F04springMVC%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%2Bspring%E5%8C%85%E6%89%AB%E6%8F%8F%E5%8C%85%E9%9A%94%E7%A6%BB%2Bspring%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%2F</url>
    <content type="text"><![CDATA[åœ¨å¼€å‘ä¸­ï¼ŒspringMVCå…¨å±€å¼‚å¸¸+springåŒ…æ‰«æåŒ…éš”ç¦»+springäº‹åŠ¡ä¼ æ’­è¿™ä¸‰ä¸ªä¸å¯èƒ½ä¸ä¼šé‡åˆ°ã€‚ä¸‹é¢æ¥å¥½å¥½è¯´è¯´ä»–ä»¬å§ã€‚ 1ã€å…¨å±€å¼‚å¸¸å¼•å…¥åŽŸå›  å‡è®¾åœ¨æˆ‘ä»¬çš„login.doçš„controlleræ–¹æ³•ä¸­ç¬¬ä¸€è¡Œå¢žåŠ ä¸€å¥ï¼š 1int i = 1/0; é‡æ–°å¯åŠ¨æœåŠ¡å™¨è¿›è¡Œç”¨æˆ·ç™»å½•æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š 123java.lang.ArithmeticException: / by zero com.swg.controller.portal.UserController.login(UserController.java:37) ...å…¶ä»–çš„å †æ ˆä¿¡æ¯ è¿™äº›ä¿¡æ¯ä¼šç›´æŽ¥æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šï¼Œå¦‚æžœæ˜¯å…³äºŽæ•°æ®åº“çš„é”™è¯¯ï¼ŒåŒæ ·ï¼Œä¼šè¯¦ç»†åœ°å°†æ•°æ®åº“ä¸­çš„å­—æ®µéƒ½æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè¿™å¯¹äºŽæˆ‘ä»¬çš„é¡¹ç›®æ¥è¯´æ˜¯å­˜åœ¨å¾ˆå¤§çš„å®‰å…¨éšæ‚£çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦ç”¨å…¨å±€å¼‚å¸¸æ¥å¤„ç†ï¼Œå¦‚æžœå‘ç”Ÿå¼‚å¸¸ï¼Œæˆ‘ä»¬å°±å¯¹å…¶è¿›è¡Œæ‹¦æˆªï¼Œå¹¶ä¸”åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæˆ‘ä»¬ç»™å‡ºçš„æç¤ºä¿¡æ¯ã€‚ å¯¹äºŽSpringBootï¼Œä¸€èˆ¬å…¨å±€å¼‚å¸¸æ˜¯: 1234567891011121314151617@ControllerAdvice@ResponseBody@Slf4jpublic class ExceptionHandlerAdvice &#123; @ExceptionHandler(Exception.class) public ServerResponse handleException(Exception e)&#123; log.error(e.getMessage(),e); return ServerResponse.createByErrorCodeMessage(Constants.RESP_STATUS_INTERNAL_ERROR,"ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åŽå†è¯•"); &#125; @ExceptionHandler(SnailmallException.class) public ServerResponse handleException(SnailmallException e)&#123; log.error(e.getMessage(),e); return ServerResponse.createByErrorCodeMessage(e.getExceptionStatus(),e.getMessage()); &#125;&#125; 2ã€å¼•å…¥å…¨å±€å¼‚å¸¸ 12345678910111213@Slf4j@Componentpublic class ExceptionResolver implements HandlerExceptionResolver&#123; @Override public ModelAndView resolveException(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e) &#123; log.error("exception:&#123;&#125;",httpServletRequest.getRequestURI(),e); ModelAndView mv = new ModelAndView(new MappingJacksonJsonView()); mv.addObject("status",ResponseEnum.ERROR.getCode()); mv.addObject("msg","æŽ¥å£å¼‚å¸¸ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹æ—¥å¿—ä¸­çš„å¼‚å¸¸ä¿¡æ¯"); mv.addObject("data",e.toString()); return mv; &#125;&#125; é‚£ä¹ˆï¼Œå†æ‰§è¡Œç™»é™†æ“ä½œä¹‹åŽï¼Œå°±ä¸ä¼šåœ¨é¡µé¢ä¸Šç›´æŽ¥æ˜¾ç¤ºå¼‚å¸¸ä¿¡æ¯äº†ã€‚æœ‰æ•ˆåœ°å±è”½äº†å…³é”®ä¿¡æ¯ã€‚ 3ã€springå’Œspringmvcé…ç½®æ–‡ä»¶çš„ä¼˜åŒ– 3.1 åŒ…éš”ç¦»ä¼˜åŒ– åœ¨ç¼–å†™å…¨å±€å¼‚å¸¸ä¹‹å‰ï¼Œå…ˆè¿›è¡Œäº†åŒ…éš”ç¦»å’Œä¼˜åŒ–ï¼Œä¸€æœŸä¸­çš„æ‰«æåŒ…çš„å†™æ³•æ˜¯ï¼š 12345&lt;!--spring:--&gt;&lt;context:component-scan base-package="com.swg" annotation-config="true"/&gt;&lt;!--springmvc:--&gt;&lt;context:component-scan base-package="com.swg" annotation-config="true"/&gt; å³springå’Œspringmvcæ‰«æåŒ…ä¸‹é¢çš„æ‰€æœ‰çš„beanå’Œcontroller.ä¼˜åŒ–åŽçš„ä»£ç é…ç½®ï¼š 1234567891011#spring&lt;context:component-scan base-package="com.swg" annotation-config="true"&gt;&lt;!--å°†controllerçš„æ‰«ææŽ’é™¤æŽ‰--&gt; &lt;context:exclude-filter type="annotation" expression="org.springframework.stereotype.Controller"/&gt;&lt;/context:component-scan&gt;#springmvc&lt;context:component-scan base-package="com.swg.controller" annotation-config="true" use-default-filters="false"&gt;&lt;!--æ·»åŠ ç™½åå•ï¼Œåªæ‰«æcontrollerï¼Œæ€»ä¹‹è¦å°†serviceç»™æŽ’é™¤æŽ‰å³å¯--&gt; &lt;context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/&gt;&lt;/context:component-scan&gt; è¿™æ ·åšçš„åŽŸå› æ˜¯ï¼šSpringå’ŒSpringMVCæ˜¯æœ‰çˆ¶å­å®¹å™¨å…³ç³»çš„ï¼Œè€Œä¸”æ­£æ˜¯å› ä¸ºè¿™ä¸ªæ‰å¾€å¾€ä¼šå‡ºçŽ°åŒ…æ‰«æçš„é—®é¢˜ã€‚ é’ˆå¯¹åŒ…æ‰«æåªè¦è®°ä½ä»¥ä¸‹å‡ ç‚¹å³å¯ï¼š springæ˜¯çˆ¶å®¹å™¨ï¼Œspringmvcæ˜¯å­å®¹å™¨ï¼Œå­å®¹å™¨å¯ä»¥è®¿é—®çˆ¶å®¹å™¨çš„bean,çˆ¶å®¹å™¨ä¸èƒ½è®¿é—®å­å®¹å™¨çš„beanã€‚ åªæœ‰é¡¶çº§å®¹å™¨ï¼ˆspringï¼‰æ‰æœ‰åŠ å¼ºçš„äº‹åŠ¡èƒ½åŠ›ï¼Œè€Œspringmvcå®¹å™¨çš„serviceæ˜¯æ²¡æœ‰çš„ã€‚ å¦‚æžœspringmvcä¸é…ç½®åŒ…æ‰«æçš„è¯ï¼Œé¡µé¢404. 3.2 äº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶ é’ˆå¯¹äº‹åŠ¡ï¼Œä¸å¾—ä¸å±•å¼€è¯´æ˜Žspringäº‹åŠ¡çš„å‡ ç§ä¼ æ’­æœºåˆ¶äº†ã€‚åœ¨ spring çš„ TransactionDefinition æŽ¥å£ä¸­ä¸€å…±å®šä¹‰äº†ä¸ƒç§äº‹åŠ¡ä¼ æ’­å±žæ€§ï¼š PROPAGATION_REQUIRED â€“ æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚è¿™æ˜¯æœ€å¸¸è§çš„é€‰æ‹©ï¼ˆé»˜è®¤ï¼‰ã€‚ PROPAGATION_SUPPORTS â€“ æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éžäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚ PROPAGATION_MANDATORY â€“ æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚ PROPAGATION_REQUIRES_NEW â€“ æ–°å»ºäº‹åŠ¡ï¼Œå¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ PROPAGATION_NOT_SUPPORTED â€“ ä»¥éžäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ PROPAGATION_NEVER â€“ ä»¥éžäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ PROPAGATION_NESTED â€“ å¦‚æžœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æžœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™è¿›è¡Œä¸ŽPROPAGATION_REQUIREDç±»ä¼¼çš„æ“ä½œã€‚ 4ã€è¡¥å…… Springé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå¯¹è¿è¡ŒæœŸä¾‹å¤–(RunTimeException)ï¼Œå³uncheckå¼‚å¸¸ï¼Œè¿›è¡Œäº‹åŠ¡å›žæ»šã€‚å¦‚æžœé‡åˆ°checkedå¼‚å¸¸å°±ä¸å›žæ»šã€‚å¦‚ä½•æ”¹å˜é»˜è®¤è§„åˆ™ï¼š è®©checkedä¾‹å¤–ä¹Ÿå›žæ»šï¼šåœ¨æ•´ä¸ªæ–¹æ³•å‰åŠ ä¸Š @Transactional(rollbackFor=Exception.class) è®©uncheckedä¾‹å¤–ä¸å›žæ»šï¼š @Transactional(notRollbackFor=RunTimeException.class) ä¸éœ€è¦äº‹åŠ¡ç®¡ç†çš„(åªæŸ¥è¯¢çš„)æ–¹æ³•ï¼š@Transactional(propagation=Propagation.NOT_SUPPORTED) 5ã€é‚£ä¹ˆä»€ä¹ˆæ˜¯åµŒå¥—äº‹åŠ¡å‘¢ï¼Ÿ åµŒå¥—æ˜¯å­äº‹åŠ¡å¥—åœ¨çˆ¶äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿›å…¥å­äº‹åŠ¡ä¹‹å‰ï¼Œçˆ¶äº‹åŠ¡å»ºç«‹ä¸€ä¸ªå›žæ»šç‚¹ï¼Œå«åšsave pointï¼Œç„¶åŽæ‰§è¡Œå­äº‹åŠ¡ï¼Œè¿™ä¸ªå­äº‹åŠ¡çš„æ‰§è¡Œä¹Ÿç®—æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åŽå­äº‹åŠ¡æ‰§è¡Œç»“æŸï¼Œçˆ¶äº‹åŠ¡ç»§ç»­æ‰§è¡Œã€‚é‡ç‚¹åœ¨äºŽé‚£ä¸ªsave pointï¼Œçœ‹ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š é—®é¢˜1ï¼šå¦‚æžœå­äº‹åŠ¡å›žæ»šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ çˆ¶äº‹åŠ¡ä¼šå›žåˆ°è¿›å…¥å­äº‹åŠ¡å‰å»ºç«‹çš„save pointï¼Œç„¶åŽå°è¯•å…¶ä»–çš„äº‹åŠ¡æˆ–è€…å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ï¼Œçˆ¶äº‹åŠ¡ä¹‹å‰çš„æ“ä½œä¸ä¼šå—åˆ°å½±å“ï¼Œæ›´ä¸ä¼šè‡ªåŠ¨å›žæ»šã€‚ é—®é¢˜2ï¼šå¦‚æžœçˆ¶äº‹åŠ¡å›žæ»šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ çˆ¶äº‹åŠ¡å›žæ»šï¼Œå­äº‹åŠ¡ä¹Ÿä¼šè·Ÿç€å›žæ»šï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºçˆ¶äº‹åŠ¡ç»“æŸä¹‹å‰ï¼Œå­äº‹åŠ¡æ˜¯ä¸ä¼šæäº¤çš„ï¼Œæˆ‘ä»¬è¯´å­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œæ­£æ˜¯è¿™ä¸ªé“ç†/ é—®é¢˜3ï¼šçˆ¶äº‹åŠ¡å…ˆæäº¤ï¼Œç„¶åŽå­äº‹åŠ¡å†æäº¤ï¼›è¿˜æ˜¯å­äº‹åŠ¡å…ˆæäº¤ï¼Œç„¶åŽçˆ¶äº‹åŠ¡å†æäº¤å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ç¬¬äºŒç§æƒ…å†µï¼Œå­äº‹åŠ¡æ˜¯çˆ¶äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œç”±çˆ¶äº‹åŠ¡åŒæ„æäº¤ã€‚ 6ã€springé…ç½®æ–‡ä»¶çš„ä¸€äº›ç†è§£ï¼š å®¹å™¨ åœ¨Springæ•´ä½“æ¡†æž¶çš„æ ¸å¿ƒæ¦‚å¿µä¸­ï¼Œå®¹å™¨æ˜¯æ ¸å¿ƒæ€æƒ³ï¼Œå°±æ˜¯ç”¨æ¥ç®¡ç†Beançš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„ï¼Œè€Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå®¹å™¨ä¸ä¸€å®šåªæœ‰ä¸€ä¸ªï¼ŒSpringä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªå®¹å™¨ï¼Œè€Œä¸”å®¹å™¨æœ‰ä¸Šä¸‹å±‚å…³ç³»ï¼Œç›®å‰æœ€å¸¸è§çš„ä¸€ç§åœºæ™¯å°±æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å¼•å…¥Springå’ŒSpringMVCè¿™ä¸¤ä¸ªæ¡†æž¶ï¼Œé‚£ä¹ˆå®ƒå…¶å®žå°±æ˜¯ä¸¤ä¸ªå®¹å™¨ï¼ŒSpringæ˜¯çˆ¶å®¹å™¨ï¼ŒSpringMVCæ˜¯å…¶å­å®¹å™¨ï¼Œå¹¶ä¸”åœ¨Springçˆ¶å®¹å™¨ä¸­æ³¨å†Œçš„Beanå¯¹äºŽSpringMVCå®¹å™¨ä¸­æ˜¯å¯è§çš„ï¼Œè€Œåœ¨SpringMVCå®¹å™¨ä¸­æ³¨å†Œçš„Beanå¯¹äºŽSpringçˆ¶å®¹å™¨ä¸­æ˜¯ä¸å¯è§çš„ï¼Œä¹Ÿå°±æ˜¯å­å®¹å™¨å¯ä»¥çœ‹è§çˆ¶å®¹å™¨ä¸­çš„æ³¨å†Œçš„Beanï¼Œåä¹‹å°±ä¸è¡Œã€‚ 1&lt;context:component-scan base-package="com.springmvc.test" /&gt; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„å¦‚ä¸‹æ³¨è§£é…ç½®æ¥å¯¹Beanè¿›è¡Œæ‰¹é‡æ³¨å†Œï¼Œè€Œä¸éœ€è¦å†ç»™æ¯ä¸ªBeanå•ç‹¬ä½¿ç”¨xmlçš„æ–¹å¼è¿›è¡Œé…ç½®ã€‚ ä»ŽSpringæä¾›çš„å‚è€ƒæ‰‹å†Œä¸­æˆ‘ä»¬å¾—çŸ¥è¯¥é…ç½®çš„åŠŸèƒ½æ˜¯æ‰«æé…ç½®çš„base-packageåŒ…ä¸‹çš„æ‰€æœ‰ä½¿ç”¨äº†@Componentæ³¨è§£çš„ç±»ï¼Œå¹¶ä¸”å°†å®ƒä»¬è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼ŒåŒæ—¶ä¹Ÿæ‰«æ@Controllerï¼Œ@Serviceï¼Œ@Respositoryè¿™ä¸‰ä¸ªæ³¨è§£ï¼Œå› ä¸ºä»–ä»¬æ˜¯ç»§æ‰¿è‡ª@Componentã€‚ 1&lt;context:annotation-config/&gt; å…¶å®žæœ‰äº†ä¸Šé¢çš„é…ç½®ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥çœç•¥æŽ‰çš„ï¼Œå› ä¸ºä¸Šé¢çš„é…ç½®ä¼šé»˜è®¤æ‰“å¼€ä»¥ä¸‹é…ç½®ã€‚ä»¥ä¸‹é…ç½®ä¼šé»˜è®¤å£°æ˜Žäº†@Requiredã€@Autowiredã€ @PostConstructã€@PersistenceContextã€@Resourceã€@PreDestroyç­‰æ³¨è§£ã€‚ 1&lt;mvc:annotation-driven /&gt; è¿™ä¸ªæ˜¯SpringMVCå¿…é¡»è¦é…ç½®çš„ï¼Œå› ä¸ºå®ƒå£°æ˜Žäº†@RequestMappingã€@RequestBodyã€@ResponseBodyç­‰ã€‚å¹¶ä¸”ï¼Œè¯¥é…ç½®é»˜è®¤åŠ è½½å¾ˆå¤šçš„å‚æ•°ç»‘å®šæ–¹æ³•ï¼Œæ¯”å¦‚jsonè½¬æ¢è§£æžå™¨ç­‰ã€‚ 7ã€æ€»ç»“ åœ¨å®žé™…å·¥ç¨‹ä¸­ä¼šåŒ…æ‹¬å¾ˆå¤šé…ç½®ï¼Œæˆ‘ä»¬æŒ‰ç…§å®˜æ–¹æŽ¨èæ ¹æ®ä¸åŒçš„ä¸šåŠ¡æ¨¡å—æ¥åˆ’åˆ†ä¸åŒå®¹å™¨ä¸­æ³¨å†Œä¸åŒç±»åž‹çš„Beanï¼šSpringçˆ¶å®¹å™¨è´Ÿè´£æ‰€æœ‰å…¶ä»–éž@Controlleræ³¨è§£çš„Beançš„æ³¨å†Œï¼Œè€ŒSpringMVCåªè´Ÿè´£@Controlleræ³¨è§£çš„Beançš„æ³¨å†Œï¼Œä½¿å¾—ä»–ä»¬å„è´Ÿå…¶è´£ã€æ˜Žç¡®è¾¹ç•Œã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[rediså®žçŽ°åˆ†å¸ƒå¼é”]]></title>
    <url>%2F2019%2F01%2F22%2Fmiscellany%2F03redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%2F</url>
    <content type="text"><![CDATA[ä¸ºäº†è®²è§£redisåˆ†å¸ƒå¼é”ï¼Œæˆ‘å°†å¼•å…¥ä¸€ä¸ªåœºæ™¯ï¼šå®šæ—¶å…³å•ã€‚å› ä¸ºå¾€å¾€è®¢å•æœåŠ¡æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œé‚£ä¹ˆå®šæ—¶å™¨ä¼šåŒæ—¶è§¦å‘è¿™äº›é›†ç¾¤åŽ»å–æ¶ˆè®¢å•ï¼Œæ˜¾ç„¶æ˜¯æµªè´¹æœºå™¨èµ„æºçš„ï¼Œæ‰€ä»¥ç›®çš„æ˜¯ï¼šåªè®©å…¶ä¸­ä¸€å°æœºå™¨åŽ»æ‰§è¡Œå–æ¶ˆè®¢å•å³å¯ã€‚è¿™é‡Œå¯ä»¥ç”¨åˆ†å¸ƒå¼é”æ¥å®žçŽ°ã€‚ é¡¹ç›®æ˜¯ä»Žç»ƒæ‰‹é¡¹ç›®ä¸­æˆªå–å‡ºæ¥çš„ï¼Œæ¡†æž¶æ˜¯åŸºäºŽSSMçš„XMLå½¢å¼æž„æˆï¼Œæ‰€ä»¥ä¸‹é¢è¿˜æ¶‰åŠä¸€ç‚¹XMlå¯¹äºŽå®šæ—¶å™¨spring scheduleçš„é…ç½®å†…å®¹ã€‚ 1ã€å¼•å…¥ç›®æ ‡ å®šæ—¶è‡ªåŠ¨å¯¹è¶…è¿‡ä¸¤ä¸ªå°æ—¶è¿˜æœªæ”¯ä»˜çš„è®¢å•å¯¹å…¶è¿›è¡Œå–æ¶ˆï¼Œå¹¶ä¸”é‡ç½®åº“å­˜ã€‚ 2ã€é…ç½® é¦–å…ˆæ˜¯springé…ç½®æ–‡ä»¶å¼•å…¥spring-schedule 123456xmlns:task="http://www.springframework.org/schema/task"...http://www.springframework.org/schema/taskhttp://www.springframework.org/schema/task/spring-task.xsd...&lt;task:annotation-driven/&gt; è¡¥å……ï¼šé’ˆå¯¹applicationContext-datasource.xmlä¸­çš„dataSourceè¯»å–é…ç½®æ–‡ä»¶çš„ä¿¡æ¯æ— æ³•å±•çŽ°çš„é—®é¢˜ï¼Œåœ¨springçš„é…ç½®æ–‡ä»¶ä¸­å¢žåŠ ä¸€æ¡é…ç½®ï¼š 1&lt;context:property-placeholder location="classpath:datasource.properties"/&gt; 3ã€å®šæ—¶è°ƒåº¦ä»£ç  æ­¤ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯ï¼šå®šæ—¶è°ƒç”¨å–æ¶ˆè®¢å•æœåŠ¡ã€‚ 1234567891011121314@Component@Slf4jpublic class CloseOrderTask &#123; @Autowired private OrderService orderService; @Scheduled(cron = "0 */1 * * * ?")//æ¯éš”ä¸€åˆ†é’Ÿæ‰§è¡Œï¼Œä¸€åˆ†é’Ÿçš„æ•´æ•°å€çš„æ—¶å€™æ‰§è¡Œ public void closeOrderTaskV1()&#123; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡å¯åŠ¨"); int hour = Integer.parseInt(PropertiesUtil.getProperty("close.order.task.time.hour","2")); orderService.closeOrder(hour); log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡ç»“æŸ"); &#125;&#125; @Componentä¸€å®šè¦åŠ ï¼Œå¦åˆ™springæ‰«æä¸åˆ°ã€‚ close.order.task.time.hour ä¹Ÿæ˜¯é…ç½®åœ¨snailmall.propertiesä¸­çš„ï¼Œè¿™é‡Œé…ç½®çš„æ˜¯é»˜è®¤çš„2ï¼Œå³ä¸¤ä¸ªå°æ—¶ï¼Œä¸‹è®¢å•è¶…è¿‡ä¸¤ä¸ªå°æ—¶ä»ç„¶ä¸æ”¯ä»˜ï¼Œå°±å–æ¶ˆè¯¥è®¢å•ã€‚ å¯¹äºŽorderServiceé‡Œé¢çš„å…·ä½“æ–¹æ³•ï¼š è¿™é‡Œæ˜¯å…³å•çš„å…·ä½“é€»è¾‘ï¼Œç»†èŠ‚æ˜¯è¡Œé”ã€‚è¿™æ®µä»£ç åªè¦çŸ¥é“ä»–æ˜¯å…·ä½“å…³å•çš„é€»è¾‘å³å¯ï¼Œä¸éœ€è¦ä»”ç»†äº†è§£ä»£ç ã€‚ 1234567891011121314151617181920212223242526@Overridepublic void closeOrder(int hour) &#123; Date closeDateTime = DateUtils.addHours(new Date(),-hour); //æ‰¾åˆ°çŠ¶æ€ä¸ºæœªæ”¯ä»˜å¹¶ä¸”ä¸‹å•æ—¶é—´æ˜¯æ—©äºŽå½“å‰æ£€æµ‹æ—¶é—´çš„ä¸¤ä¸ªå°æ—¶çš„æ—¶é—´,å°±å°†å…¶ç½®ä¸ºå–æ¶ˆ //SELECT &lt;include refid="Base_Column_List"/&gt; from mmall_order WHERE status = #&#123;status&#125; &lt;![CDATA[ and create_time &lt;= #&#123;date&#125; ]]&gt; order by create_time desc List&lt;Order&gt; orderList = orderMapper.selectOrderStatusByCreateTime(Const.OrderStatusEnum.NO_PAY.getCode(),DateTimeUtil.dateToStr(closeDateTime)); for(Order order:orderList)&#123; List&lt;OrderItem&gt; orderItemList = orderItemMapper.getByOrderNo(order.getOrderNo()); for(OrderItem orderItem:orderItemList)&#123; //ä¸€å®šè¦ç”¨ä¸»é”®whereæ¡ä»¶ï¼Œé˜²æ­¢é”è¡¨ã€‚åŒæ—¶å¿…é¡»æ˜¯æ”¯æŒMySQLçš„InnoDB. Integer stock = productMapper.selectStockByProductId(orderItem.getProductId()); if(stock == null)&#123; continue; &#125; //æ›´æ–°äº§å“åº“å­˜ Product product = new Product(); product.setId(orderItem.getProductId()); product.setStock(stock+orderItem.getQuantity()); productMapper.updateByPrimaryKeySelective(product); &#125; //å…³é—­order //UPDATE mmall_order set status = 0 where id = #&#123;id&#125; orderMapper.closeOrderByOrderId(order.getId()); log.info("å…³é—­è®¢å•OrderNo:&#123;&#125;",order.getOrderNo()); &#125;&#125; è¿™æ ·ï¼Œdebugå¯åŠ¨é¡¹ç›®ï¼Œä¸€åˆ†é’ŸåŽå°±ä¼šè‡ªåŠ¨æ‰§è¡ŒcloseOrderTaskV1æ–¹æ³•äº†ã€‚æ‰¾ä¸€ä¸ªæœªæ”¯ä»˜çš„è®¢å•ï¼Œè¿›è¡Œç›¸åº”æµ‹è¯•ã€‚ 4ã€å­˜åœ¨çš„é—®é¢˜ ç»è¿‡å®žéªŒå‘çŽ°ï¼ŒåŒæ—¶éƒ¨ç½²ä¸¤å°tomcatæœåŠ¡å™¨ï¼Œæ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ—¶å€™æ˜¯ä¸¤å°éƒ½åŒæ—¶æ‰§è¡Œçš„ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬é›†ç¾¤çš„ç›®æ ‡ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€å°æœåŠ¡å™¨æ‰§è¡Œè¿™ä¸ªå®šæ—¶ä»»åŠ¡å³å¯ã€‚é‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ˜¯å¼•å…¥redisåˆ†å¸ƒå¼é”ã€‚ rediså®žçŽ°åˆ†å¸ƒå¼é”ï¼Œæ ¸å¿ƒå‘½ä»¤å¼setnxå‘½ä»¤ã€‚æ‰€ä»¥é˜…è¯»ä¸‹é¢ï¼Œæ‚¨éœ€è¦å¯¹redisåˆ†å¸ƒå¼é”çš„åŸºæœ¬å®žçŽ°åŽŸç†å¿…é¡»è¦å…ˆæœ‰ä¸€å®šçš„è®¤è¯†æ‰è¡Œã€‚ 5ã€ç¬¬ä¸€ç§æ–¹æ¡ˆ ç¬¬ä¸€æ­¥ï¼šsetnxè¿›åŽ»ï¼Œå¦‚æžœæˆåŠŸï¼Œè¯´æ˜Žå¡žå…¥redisæˆåŠŸï¼ŒæŠ¢å åˆ°é” ç¬¬äºŒæ­¥ï¼šæŠ¢åˆ°é”ä¹‹åŽï¼Œå…ˆè®¾ç½®ä¸€ä¸‹è¿‡æœŸæ—¶é—´ï¼Œå³åŽé¢å¦‚æžœæ‰§è¡Œä¸åˆ°deleteï¼Œä¹Ÿä¼šå°†è¿™ä¸ªé”è‡ªåŠ¨é‡Šæ”¾æŽ‰ï¼Œé˜²æ­¢æ­»é” ç¬¬ä¸‰æ­¥ï¼šå…³é—­è®¢å•ï¼Œåˆ é™¤redisé” å­˜åœ¨çš„é—®é¢˜ï¼šå¦‚æžœå› ä¸ºtomcatå…³é—­æˆ–tomcatè¿›ç¨‹åœ¨æ‰§è¡ŒcloseOrder()æ–¹æ³•çš„æ—¶å€™ï¼Œå³è¿˜æ²¡æ¥å¾—åŠè®¾ç½®é”çš„è¿‡æœŸæ—¶é—´çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™ä¼šé€ æˆæ­»é”ã€‚éœ€è¦æ”¹è¿›ã€‚ 123456789101112131415161718192021222324252627//ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨çªç„¶å…³é—­tomcatçš„æ—¶å€™æœ‰å¯èƒ½å‡ºçŽ°æ­»é”@Scheduled(cron = "0 */1 * * * ?")//æ¯éš”ä¸€åˆ†é’Ÿæ‰§è¡Œï¼Œä¸€åˆ†é’Ÿçš„æ•´æ•°å€public void closeOrderTaskV2()&#123; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡å¯åŠ¨"); //è®¾ç½®é”ï¼Œvalueæ˜¯ç”¨å½“å‰æ—¶é—´+timeoutè¿›è¡Œè®¾ç½®çš„ long timeout = Long.parseLong(PropertiesUtil.getProperty("lock.timeout")); Long setnxResult = RedisShardPoolUtil.setnx(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,String.valueOf(System.currentTimeMillis()+timeout)); if(setnxResult != null &amp;&amp; setnxResult.intValue() ==1)&#123; //è¯´æ˜Žè¢«å½“å‰çš„tomcatè¿›ç¨‹æŠ¢åˆ°é”ï¼Œä¸‹é¢å°±å¯ä»¥å…³é—­è®¢å• closeOrder(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125;else &#123; log.info("æ²¡æœ‰èŽ·å–åˆ†å¸ƒå¼é”ï¼š&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡ç»“æŸ");&#125;private void closeOrder(String lockName) &#123; //ç»™é”ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå¦‚æžœå› ä¸ºæŸä¸ªåŽŸå› å¯¼è‡´ä¸‹é¢çš„é”æ²¡æœ‰è¢«åˆ é™¤ï¼Œé€ æˆæ­»é” RedisShardPoolUtil.expire(lockName,50); log.info("èŽ·å–&#123;&#125;ï¼ŒThreadName:&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName()); int hour = Integer.parseInt(PropertiesUtil.getProperty("close.order.task.time.hour","2")); orderService.closeOrder(hour); //å…³é—­è®¢å•ä¹‹åŽå°±ç«‹å³åˆ é™¤è¿™ä¸ªé” RedisShardPoolUtil.del(lockName); log.info("é‡Šæ”¾&#123;&#125;ï¼ŒThreadName:&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,Thread.currentThread().getName()); System.out.println("=============================================");&#125; 6ã€æ”¹è¿› å›¾çœ‹ä¸æ¸…ï¼Œå¯ä»¥é‡æ–°æ‰“å¼€ä¸€ä¸ªçª—å£çœ‹ã€‚å…·ä½“çš„é€»è¾‘ä»£ç ï¼š 12345678910111213141516171819202122232425262728@Scheduled(cron = "0 */1 * * * ?")//æ¯éš”ä¸€åˆ†é’Ÿæ‰§è¡Œï¼Œä¸€åˆ†é’Ÿçš„æ•´æ•°å€public void closeOrderTaskV3()&#123; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡å¯åŠ¨"); //è®¾ç½®é”ï¼Œvalueæ˜¯ç”¨å½“å‰æ—¶é—´+timeoutè¿›è¡Œè®¾ç½®çš„ long timeout = Long.parseLong(PropertiesUtil.getProperty("lock.timeout")); Long setnxResult = RedisShardPoolUtil.setnx(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,String.valueOf(System.currentTimeMillis()+timeout)); if(setnxResult != null &amp;&amp; setnxResult.intValue() ==1)&#123; //è¯´æ˜Žè¢«å½“å‰çš„tomcatè¿›ç¨‹æŠ¢åˆ°é”ï¼Œä¸‹é¢å°±å¯ä»¥å…³é—­è®¢å• closeOrder(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125;else &#123; //åœ¨æ²¡æœ‰æ‹¿åˆ°é”çš„æƒ…å†µä¸‹ï¼Œä¹Ÿè¦è¿›è¡Œç›¸åº”çš„åˆ¤æ–­ï¼Œç¡®ä¿ä¸æ­»é” String lockValueStr = RedisShardPoolUtil.get(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); //å¦‚æžœåˆ¤æ–­é”æ˜¯å­˜åœ¨çš„å¹¶ä¸”çŽ°åœ¨å·²ç»è¶…æ—¶äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™ä¸ªè¿›ç¨‹å°±æœ‰æœºä¼šåŽ»å æœ‰è¿™æŠŠé” if(lockValueStr != null &amp;&amp; System.currentTimeMillis() &gt; Long.parseLong(lockValueStr))&#123; //å½“å‰è¿›ç¨‹è¿›è¡Œget setæ“ä½œï¼Œæ‹¿åˆ°è€çš„keyï¼Œå†å¡žè¿›æ–°çš„è¶…æ—¶æ—¶é—´ String getSetResult = RedisShardPoolUtil.getset(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK,String.valueOf(System.currentTimeMillis()+timeout)); //å¦‚æžœæ‹¿åˆ°çš„æ˜¯ç©ºçš„ï¼Œè¯´æ˜Žè€çš„é”å·²ç»é‡Šæ”¾ï¼Œé‚£ä¹ˆå½“å‰è¿›ç¨‹æœ‰æƒå æœ‰è¿™æŠŠé”è¿›è¡Œæ“ä½œï¼› //å¦‚æžœæ‹¿åˆ°çš„ä¸æ˜¯ç©ºçš„ï¼Œè¯´æ˜Žè€çš„é”ä»ç„¶å æœ‰ï¼Œå¹¶ä¸”è¿™æ¬¡getsetæ‹¿åˆ°çš„keyä¸Žä¸Šé¢æŸ¥è¯¢getå¾—åˆ°çš„keyä¸€æ ·çš„è¯ï¼Œè¯´æ˜Žæ²¡æœ‰è¢«å…¶ä»–è¿›ç¨‹åˆ·æ–°ï¼Œé‚£ä¹ˆæœ¬è¿›ç¨‹è¿˜æ˜¯æœ‰æƒå æœ‰è¿™æŠŠé”è¿›è¡Œæ“ä½œ if(getSetResult == null || (getSetResult != null &amp;&amp; StringUtils.equals(lockValueStr,getSetResult)))&#123; closeOrder(Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125;else &#123; log.info("æ²¡æœ‰èŽ·å–åˆ†å¸ƒå¼é”ï¼š&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125; &#125;else &#123; log.info("æ²¡æœ‰èŽ·å–åˆ†å¸ƒå¼é”ï¼š&#123;&#125;",Const.REDIS_LOCK.CLOSE_ORDER_TASK_LOCK); &#125; &#125; log.info("å…³é—­è®¢å•å®šæ—¶ä»»åŠ¡ç»“æŸ");&#125; è¿™æ ·ä¸¤æ¬¡çš„é˜²æ­»é”æŽªæ–½ï¼Œä¸ä»…å¯ä»¥é˜²æ­¢æ­»é”ï¼Œè¿˜å¯ä»¥æé«˜æ•ˆçŽ‡ã€‚ 7ã€æ‰©å±• mysqlå››ç§äº‹åŠ¡éš”ç¦»æœºåˆ¶ read uncommitted:è¯»å–æœªæäº¤å†…å®¹ ä¸¤ä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†æ›´æ–°æ“ä½œï¼Œä½†æ˜¯æ²¡æœ‰æäº¤ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨äº‹åŠ¡å†…å°±ä¼šè¯»åˆ°è¯¥çº¿ç¨‹æœªæäº¤çš„æ•°æ®ã€‚ read committed:è¯»å–æäº¤å†…å®¹ï¼ˆä¸å¯é‡å¤è¯»ï¼‰ é’ˆå¯¹ç¬¬ä¸€ç§æƒ…å†µï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸ä¼šè¯»å–å¦ä¸€ä¸ªçº¿ç¨‹æœªæäº¤çš„æ•°æ®äº†ã€‚ä½†æ˜¯ï¼Œè¯»åˆ°äº†å¦ä¸€ä¸ªçº¿ç¨‹æ›´æ–°åŽæäº¤çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´é‡å¤è¯»è¡¨çš„æ—¶å€™ï¼Œæ•°æ®ä¼šä¸ä¸€è‡´ã€‚æ˜¾ç„¶è¿™ç§æƒ…å†µä¹Ÿæ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥å«ä¸å¯é‡å¤è¯»ã€‚ repeatable read:å¯é‡å¤è¯»ï¼ˆé»˜è®¤ï¼‰ å¯é‡å¤è¯»ï¼Œæ˜¾ç„¶è§£å†³2ä¸­çš„é—®é¢˜ï¼Œå³ä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸ä¼šå†è¯»å–åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æäº¤çš„æ•°æ®ï¼Œä¿è¯äº†è¯¥çº¿ç¨‹åœ¨è¿™ä¸ªäº‹åŠ¡å†…çš„æ•°æ®çš„ä¸€è‡´æ€§ã€‚ å¯¹äºŽæŸäº›æƒ…å†µï¼Œè¿™ç§æ–¹æ¡ˆä¼šå‡ºçŽ°å¹»å½±è¯»ï¼Œä»–å¯¹äºŽæ›´æ–°æ“ä½œæ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„äº†ï¼Œä½†æ˜¯å¯¹äºŽæ’å…¥æ“ä½œï¼Œæœ‰å¯èƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡å†…è¯»åˆ°æ–°æ’å…¥çš„æ•°æ®ï¼ˆä½†æ˜¯MySQLä¸­ç”¨å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶æœºåˆ¶è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œæ‰€ä»¥é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªæœºåˆ¶ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ serializable:åºåˆ—åŒ– ç•¥ã€‚ å­˜å‚¨å¼•æ“Ž MySQLé»˜è®¤ä½¿ç”¨çš„æ˜¯InnoDBï¼Œæ”¯æŒäº‹åŠ¡ã€‚è¿˜æœ‰ä¾‹å¦‚MyISAM,è¿™ç§å­˜å‚¨å¼•æ“Žä¸æ”¯æŒäº‹åŠ¡ï¼Œåªæ”¯æŒåªè¯»æ“ä½œï¼Œåœ¨ç”¨åˆ°æ•°æ®çš„ä¿®æ”¹çš„åœ°æ–¹ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨é»˜è®¤çš„InnoDBå­˜å‚¨å¼•æ“Žã€‚ ç´¢å¼•çš„ä¸€ä¸ªæ³¨æ„ç‚¹ ä¸€èˆ¬ç±»åž‹ä¸ºnormalå’Œuniqueï¼Œç”¨btreeå®žçŽ°ï¼Œå¯¹äºŽè”åˆç´¢å¼•(å­—æ®µ1å’Œå­—æ®µ2)ï¼Œåœ¨æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œä¾‹å¦‚ 1select * from xxx where å­—æ®µ1="xxx" ... æ˜¯å¯ä»¥åˆ©ç”¨åˆ°ç´¢å¼•çš„é«˜æ€§èƒ½æŸ¥è¯¢çš„ï¼Œä½†æ˜¯å¦‚æžœæ˜¯ 1select * from xxx where å­—æ®µ2="xxx" ... æ•ˆçŽ‡è·Ÿæ™®é€šçš„æŸ¥è¯¢æ—¶ä¸€æ ·çš„ï¼Œå› ä¸ºç”¨ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œæœ€å·¦è¾¹çš„é‚£ä¸ªå­—æ®µå¿…é¡»è¦æœ‰ï¼Œå¦åˆ™æ— æ•ˆã€‚ æ‰©å±•çš„å†…å®¹çŸ¥è¯†é¡ºä¾¿æä¸€ä¸‹ï¼Œåœ¨æ•°æ®åº“è¿™ä¸€å—ï¼Œä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redissonå®žçŽ°Redisåˆ†å¸ƒå¼é”åŽŸç†]]></title>
    <url>%2F2019%2F01%2F22%2Fmiscellany%2F02Redisson%E5%AE%9E%E7%8E%B0Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥å®žçŽ°ä¸€ä¸ªredisåˆ†å¸ƒå¼é”ï¼Œä½†æ˜¯å¦‚ä½•ç”¨Redissonä¼˜é›…åœ°å®žçŽ°å‘¢ï¼Ÿæœ¬æ–‡æŽ¢è®¨ä¸€ä¸‹å®ƒçš„åŽŸç†ã€‚ ç”¨Redissonæ¥å®žçŽ°åˆ†å¸ƒå¼é”å¼‚å¸¸åœ°ç®€å•ï¼Œå½¢å¦‚ï¼š è¿˜æ”¯æŒrediså•å®žä¾‹ã€rediså“¨å…µã€redis clusterã€redis master-slaveç­‰å„ç§éƒ¨ç½²æž¶æž„ï¼Œéƒ½å¯ä»¥ç»™ä½ å®Œç¾Žå®žçŽ°ã€‚ åŠ é” åŽŸç†å›¾ï¼š çŽ°åœ¨æŸä¸ªå®¢æˆ·ç«¯è¦åŠ é”ã€‚å¦‚æžœè¯¥å®¢æˆ·ç«¯é¢å¯¹çš„æ˜¯ä¸€ä¸ªredis clusteré›†ç¾¤ï¼Œä»–é¦–å…ˆä¼šæ ¹æ®hashèŠ‚ç‚¹é€‰æ‹©ä¸€å°æœºå™¨ã€‚ç´§æŽ¥ç€ï¼Œå°±ä¼šå‘é€ä¸€æ®µluaè„šæœ¬åˆ°redisä¸Šï¼Œé‚£æ®µluaè„šæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š ä¸ºå•¥è¦ç”¨luaè„šæœ¬å‘¢ï¼Ÿå› ä¸ºä¸€å¤§å¨å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥é€šè¿‡å°è£…åœ¨luaè„šæœ¬ä¸­å‘é€ç»™redisï¼Œä¿è¯è¿™æ®µå¤æ‚ä¸šåŠ¡é€»è¾‘æ‰§è¡Œçš„åŽŸå­æ€§ã€‚ è§£é‡Šä¸€ä¸‹è¿™æ®µè„šæœ¬çš„æ„æ€ã€‚ è¿™é‡Œçš„KEYS[1]ä»£è¡¨çš„æ˜¯ä½ åŠ é”çš„é‚£ä¸ªkeyçš„åå­—ã€‚è¿™ä¸ªkeyå°±æ˜¯æˆ‘ä»¬å¸¸çœ‹åˆ°çš„ï¼š 1RLock lock = redisson.getLock("myLock"); ä¸­çš„myLockï¼Œæˆ‘å°±æ˜¯å¯¹è¿™ä¸ªkeyè¿›è¡ŒåŠ é”ã€‚ è¿™é‡Œçš„ARGV[1]ä»£è¡¨çš„å°±æ˜¯é”keyçš„é»˜è®¤ç”Ÿå­˜æ—¶é—´ï¼Œé»˜è®¤30ç§’ã€‚ARGV[2]ä»£è¡¨çš„æ˜¯åŠ é”çš„å®¢æˆ·ç«¯çš„ID:æ¯”å¦‚8743c9c0-0795-4907-87fd-6c719a6b4586:1 ç¬¬ä¸€æ®µifåˆ¤æ–­è¯­å¥ï¼Œå°±æ˜¯ç›¸å½“äºŽç”¨exists myLockå‘½ä»¤åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æžœä½ è¦åŠ é”çš„é‚£ä¸ªé”keyä¸å­˜åœ¨çš„è¯ï¼Œä½ å°±è¿›è¡ŒåŠ é”ã€‚å¦‚ä½•åŠ é”å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤ï¼šhset myLockã€‚ æ‰§è¡Œå®Œhestä¹‹åŽï¼Œè®¾ç½®äº†ä¸€ä¸ªhashæ•°æ®ç»“æž„ï¼š8743c9c0-0795-4907-87fd-6c719a6b4586:1 1ï¼Œè¿™è¡Œå‘½ä»¤æ‰§è¡ŒåŽï¼Œä¼šå‡ºçŽ°ä¸€ä¸ªç±»ä¼¼ä¸‹é¢çš„æ•°æ®ç»“æž„ï¼š ç´§æŽ¥ç€ä¼šæ‰§è¡Œpexpire myLock 30000å‘½ä»¤ï¼Œè®¾ç½®myLockè¿™ä¸ªé”keyçš„ç”Ÿå­˜æ—¶é—´æ˜¯30ç§’ã€‚å¥½äº†ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œokï¼ŒåŠ é”å®Œæˆäº†ã€‚ é”äº’æ–¥ é‚£ä¹ˆåœ¨è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æžœå®¢æˆ·ç«¯2æ¥å°è¯•åŠ é”ï¼Œæ‰§è¡Œäº†åŒæ ·çš„ä¸€æ®µluaè„šæœ¬ï¼Œä¼šå’‹æ ·å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œç¬¬ä¸€ä¸ªifåˆ¤æ–­ä¼šæ‰§è¡Œexists myLockï¼Œå‘çŽ°myLockè¿™ä¸ªé”keyå·²ç»å­˜åœ¨äº†ã€‚æŽ¥ç€ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œåˆ¤æ–­ä¸€ä¸‹ï¼ŒmyLocké”keyçš„hashæ•°æ®ç»“æž„ä¸­ï¼Œæ˜¯å¦åŒ…å«å®¢æˆ·ç«¯2çš„IDï¼Œä½†æ˜¯æ˜Žæ˜¾ä¸æ˜¯çš„ï¼Œå› ä¸ºé‚£é‡ŒåŒ…å«çš„æ˜¯å®¢æˆ·ç«¯1çš„IDã€‚ æ‰€ä»¥è¿™ä¸ªå®¢æˆ·ç«¯2ä¸¤ä¸ªiféƒ½ä¸èƒ½è¿›å…¥ï¼Œåªèƒ½æ‰§è¡Œæœ€åŽçš„pttl myLockï¼Œè¿”å›žå€¼ä»£è¡¨äº†myLockè¿™ä¸ªé”keyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚æ¯”å¦‚è¿˜å‰©15000æ¯«ç§’çš„ç”Ÿå­˜æ—¶é—´ã€‚æ­¤æ—¶å®¢æˆ·ç«¯2ä¼šè¿›å…¥ä¸€ä¸ªwhileå¾ªçŽ¯ï¼Œä¸åœçš„å°è¯•åŠ é”ã€‚ watch dogè‡ªåŠ¨å»¶æœŸæœºåˆ¶ å®¢æˆ·ç«¯1åŠ é”çš„é”keyé»˜è®¤ç”Ÿå­˜æ—¶é—´æ‰30ç§’ï¼Œå¦‚æžœè¶…è¿‡äº†30ç§’ï¼Œå®¢æˆ·ç«¯1è¿˜æƒ³ä¸€ç›´æŒæœ‰è¿™æŠŠé”ï¼Œæ€Žä¹ˆåŠžå‘¢ï¼Ÿ ç®€å•ï¼åªè¦å®¢æˆ·ç«¯1ä¸€æ—¦åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogçœ‹é—¨ç‹—ï¼Œä»–æ˜¯ä¸€ä¸ªåŽå°çº¿ç¨‹ï¼Œä¼šæ¯éš”10ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æžœå®¢æˆ·ç«¯1è¿˜æŒæœ‰é”keyï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚ å¯é‡å…¥åŠ é”æœºåˆ¶ çœ‹ä¸€ä¸‹ä»£ç ï¼Œç›¸åŒçš„å®¢æˆ·è¿›æ¥ï¼Œä¼šè¿›å…¥ç¬¬äºŒä¸ªifï¼Œä¼šæ‰§è¡Œhincrbyï¼Œå³å¢ž1ï¼Œé‚£ä¹ˆè¿™ä¸ªhashç»“æž„å°±ä¼šå˜æˆï¼š é‡Šæ”¾é” å¦‚æžœæ‰§è¡Œlock.unlock()ï¼Œå°±å¯ä»¥é‡Šæ”¾åˆ†å¸ƒå¼é”ï¼Œæ­¤æ—¶çš„ä¸šåŠ¡é€»è¾‘ä¹Ÿæ˜¯éžå¸¸ç®€å•çš„ã€‚å…¶å®žè¯´ç™½äº†ï¼Œå°±æ˜¯æ¯æ¬¡éƒ½å¯¹myLockæ•°æ®ç»“æž„ä¸­çš„é‚£ä¸ªåŠ é”æ¬¡æ•°å‡1ã€‚å¦‚æžœå‘çŽ°åŠ é”æ¬¡æ•°æ˜¯0äº†ï¼Œè¯´æ˜Žè¿™ä¸ªå®¢æˆ·ç«¯å·²ç»ä¸å†æŒæœ‰é”äº†ï¼Œæ­¤æ—¶å°±ä¼šç”¨ï¼šdel myLockå‘½ä»¤ï¼Œä»Žredisé‡Œåˆ é™¤è¿™ä¸ªkeyã€‚ç„¶åŽå‘¢ï¼Œå¦å¤–çš„å®¢æˆ·ç«¯2å°±å¯ä»¥å°è¯•å®ŒæˆåŠ é”äº†ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„åˆ†å¸ƒå¼é”çš„å¼€æºRedissonæ¡†æž¶çš„å®žçŽ°æœºåˆ¶ã€‚ å­˜åœ¨çš„é—®é¢˜ å…¶å®žä¸Šé¢é‚£ç§æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜ï¼Œå°±æ˜¯å¦‚æžœä½ å¯¹æŸä¸ªredis masterå®žä¾‹ï¼Œå†™å…¥äº†myLockè¿™ç§é”keyçš„valueï¼Œæ­¤æ—¶ä¼šå¼‚æ­¥å¤åˆ¶ç»™å¯¹åº”çš„master slaveå®žä¾‹ã€‚ ä½†æ˜¯å¤åˆ¶çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€æ—¦å‘ç”Ÿredis masterå®•æœºï¼Œä¸»å¤‡åˆ‡æ¢ï¼Œredis slaveå˜ä¸ºäº†redis masterã€‚ å‡è®¾å®¢æˆ·ç«¯1åœ¨redis masterä¸ŠèŽ·å¾—é”ï¼Œç„¶åŽä¸»æœºå®•æœºï¼Œredis slaveæˆä¸ºæ–°çš„redis masterï¼Œä½†æ˜¯è¿˜æœªåŒæ­¥åˆ°redis slaveä¸Šï¼Œä½†æ˜¯å®¢æˆ·ç«¯1å·²ç»è§‰å¾—è‡ªå·±èŽ·å–åˆ°äº†é”ã€‚ æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯2æ¥å°è¯•åŠ é”çš„æ—¶å€™ï¼Œåœ¨æ–°çš„redis masterä¸Šå®Œæˆäº†åŠ é”ï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿå¤šä¸ªå®¢æˆ·ç«¯å®Œæˆå¯¹ä¸€ä¸ªkeyçš„åŠ é”ã€‚è¿™æ—¶ç³»ç»Ÿåœ¨ä¸šåŠ¡è¯­ä¹‰ä¸Šä¸€å®šä¼šå‡ºçŽ°é—®é¢˜ï¼Œå¯¼è‡´å„ç§è„æ•°æ®çš„äº§ç”Ÿã€‚ æ‰€ä»¥è¿™ä¸ªå°±æ˜¯redis clusterï¼Œæˆ–è€…æ˜¯redis master-slaveæž¶æž„çš„ä¸»ä»Žå¼‚æ­¥å¤åˆ¶å¯¼è‡´çš„redisåˆ†å¸ƒå¼é”çš„æœ€å¤§ç¼ºé™·ï¼šåœ¨redis masterå®žä¾‹å®•æœºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å®ŒæˆåŠ é”ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[springäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º]]></title>
    <url>%2F2019%2F01%2F22%2Fmiscellany%2F01%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA%2F</url>
    <content type="text"><![CDATA[ç»å¸¸å¬åˆ°åˆ«äººè¯´äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºå‘¢ï¼Ÿ 1.ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡æ˜¯æŒ‡ï¼šç”±ä¸€ç³»åˆ—æ•°æ®åº“æ“ä½œç»„æˆçš„ä¸€ä¸ªå®Œæ•´çš„é€»è¾‘è¿‡ç¨‹ã€‚ä¾‹å¦‚é“¶è¡Œè½¬å¸ï¼Œä»ŽåŽŸè´¦æˆ·æ‰£é™¤é‡‘é¢ï¼Œä»¥åŠå‘ç›®æ ‡è´¦æˆ·æ·»åŠ é‡‘é¢ï¼Œè¿™ä¸¤ä¸ªæ•°æ®åº“æ“ä½œçš„æ€»å’Œï¼Œæž„æˆä¸€ä¸ªå®Œæ•´çš„é€»è¾‘è¿‡ç¨‹ï¼Œä¸å¯æ‹†åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºä¸€ä¸ªäº‹åŠ¡ï¼Œå…·æœ‰ACIDç‰¹æ€§ã€‚ è¿™é‡Œæ³¨æ„ï¼Œå…¶å®žäº‹åŠ¡å°±æ˜¯æ•°æ®åº“æ‰èƒ½ä¿è¯çš„ï¼Œæ‰€ä»¥æŠ›å¼€æ•°æ®åº“å±‚é¢æ¥è°ˆäº‹åŠ¡æœ¬èº«å°±æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥äº‹åŠ¡çš„æ¦‚å¿µå°±æ˜¯æ•°æ®åº“ä¸€ç³»åˆ—æ“ä½œçš„ä¸€ä¸ªå®Œæ•´å•å…ƒã€‚ 2.ä»€ä¹ˆæ˜¯ACIDï¼Ÿ ACIDæ˜¯æŒ‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿåœ¨å†™å…¥æˆ–æ›´æ–°èµ„æ–™çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä¿è¯äº‹åŠ¡æ˜¯æ­£ç¡®å¯é çš„ï¼Œæ‰€å¿…é¡»å…·å¤‡çš„å››ä¸ªç‰¹æ€§ï¼šåŽŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ã€‚ Atomicityï¼šä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªçŽ¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›žæ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»Žæ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚ Consistencyï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åŽï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾çº¦æŸã€è§¦å‘å™¨ã€çº§è”å›žæ»šç­‰ã€‚ Isolationï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºŽäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš” ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤(Read uncommitted)ã€è¯»æäº¤(read committed)ã€å¯é‡å¤è¯»(repeatable read)å’Œä¸²è¡ŒåŒ–(Serializable)ã€‚ Durabilityï¼šäº‹åŠ¡å¤„ç†ç»“æŸåŽï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ 3.springäº‹åŠ¡ä¼ æ’­è¡Œä¸º åœ¨æˆ‘ä»¬ç”¨SSMå¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å°†äº‹åŠ¡è®¾ç½®åœ¨Serviceå±‚ é‚£ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨Serviceå±‚çš„ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™å®ƒèƒ½å¤Ÿä¿è¯æˆ‘ä»¬çš„è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œçš„æ‰€æœ‰çš„å¯¹æ•°æ®åº“çš„æ›´æ–°æ“ä½œä¿æŒåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œåœ¨äº‹åŠ¡å±‚é‡Œé¢è°ƒç”¨çš„è¿™äº›æ–¹æ³•è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚é‚£ä¹ˆäº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ä¹Ÿæ˜¯ä»Žè¿™é‡Œè¯´èµ·çš„ã€‚ å¦‚æžœä½ åœ¨ä½ çš„`Service`å±‚çš„è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé™¤äº†è°ƒç”¨äº†`Dao`å±‚çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜è°ƒç”¨äº†æœ¬ç±»çš„å…¶ä»–çš„`Service`æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨å…¶ä»–çš„`Service`æ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹åŠ¡æ˜¯æ€Žä¹ˆè§„å®šçš„å‘¢ï¼Œæˆ‘å¿…é¡»ä¿è¯æˆ‘åœ¨æˆ‘æ–¹æ³•é‡Œè°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•ä¸Žæˆ‘æœ¬èº«çš„æ–¹æ³•å¤„åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¦åˆ™å¦‚æžœä¿è¯äº‹ç‰©çš„ä¸€è‡´æ€§ã€‚äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„. åœ¨Springä¸­æœ‰é’ˆå¯¹ä¼ æ’­ç‰¹æ€§çš„å¤šç§é…ç½®æˆ‘ä»¬å¤§å¤šæ•°æƒ…å†µä¸‹åªç”¨å…¶ä¸­çš„ä¸€ç§:PROPGATION_REQUIREDï¼šè¿™ä¸ªé…ç½®é¡¹çš„æ„æ€æ˜¯è¯´å½“æˆ‘è°ƒç”¨serviceå±‚çš„æ–¹æ³•çš„æ—¶å€™å¼€å¯ä¸€ä¸ªäº‹åŠ¡(å…·ä½“è°ƒç”¨é‚£ä¸€å±‚çš„æ–¹æ³•å¼€å§‹åˆ›å»ºäº‹åŠ¡ï¼Œè¦çœ‹ä½ çš„aopçš„é…ç½®),é‚£ä¹ˆåœ¨è°ƒç”¨è¿™ä¸ªserviceå±‚é‡Œé¢çš„å…¶ä»–çš„æ–¹æ³•çš„æ—¶å€™,å¦‚æžœå½“å‰æ–¹æ³•äº§ç”Ÿäº†äº‹åŠ¡å°±ç”¨å½“å‰æ–¹æ³•äº§ç”Ÿçš„äº‹åŠ¡ï¼Œå¦åˆ™å°±åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚è¿™ä¸ªå·¥ä½œä½¿ç”±Springæ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆçš„ã€‚ é»˜è®¤æƒ…å†µä¸‹å½“å‘ç”Ÿ`RuntimeException`çš„æƒ…å†µä¸‹ï¼Œäº‹åŠ¡æ‰ä¼šå›žæ»šï¼Œæ‰€ä»¥è¦æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æžœä½ åœ¨ç¨‹åºå‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¸‹ï¼Œæœ‰è‡ªå·±çš„å¼‚å¸¸å¤„ç†æœºåˆ¶å®šä¹‰è‡ªå·±çš„`Exception`ï¼Œå¿…é¡»ä»Ž`RuntimeException`ç±»ç»§æ‰¿ï¼Œè¿™æ ·äº‹åŠ¡æ‰ä¼šå›žæ»šï¼ 4.äº‹åŠ¡éš”ç¦»çº§åˆ« 1ã€Serializableï¼šæœ€ä¸¥æ ¼çš„çº§åˆ«ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œèµ„æºæ¶ˆè€—æœ€å¤§ï¼› 2ã€REPEATABLE READï¼šä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼šä¿®æ”¹å·²ç»ç”±å¦ä¸€ä¸ªäº‹åŠ¡è¯»å–ä½†æœªæäº¤ï¼ˆå›žæ»šï¼‰çš„æ•°æ®ã€‚é¿å…äº†â€œè„è¯»å–â€å’Œâ€œä¸å¯é‡å¤è¯»å–â€çš„æƒ…å†µï¼Œä½†æ˜¯å¸¦æ¥äº†æ›´å¤šçš„æ€§èƒ½æŸå¤±ã€‚ 3ã€READ COMMITTED:å¤§å¤šæ•°ä¸»æµæ•°æ®åº“çš„é»˜è®¤äº‹åŠ¡ç­‰çº§ï¼Œä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼šè¯»åˆ°å¦ä¸€ä¸ªå¹¶è¡Œäº‹åŠ¡å·²ä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®ï¼Œé¿å…äº†â€œè„è¯»å–â€ã€‚è¯¥çº§åˆ«é€‚ç”¨äºŽå¤§å¤šæ•°ç³»ç»Ÿã€‚ 4ã€Read Uncommittedï¼šä¿è¯äº†è¯»å–è¿‡ç¨‹ä¸­ä¸ä¼šè¯»å–åˆ°éžæ³•æ•°æ®ã€‚ 5.æ€»ç»“ æœ¬æ–‡çš„é‡ç‚¹æ˜¯åœ¨äºŽç†è§£äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºè¿™ä¸ªæ¦‚å¿µï¼Œä»Žäº‹åŠ¡çš„æ¦‚å¿µï¼Œåˆ°äº‹åŠ¡çš„ACIDä»‹ç»ï¼Œå¼•å‡ºäº‹åŠ¡ä¼ æ’­ä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«è¿™ä¸¤ä¸ªæ¦‚å¿µåŠ ä»¥ç†è§£ã€‚]]></content>
      <tags>
        <tag>miscellany</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ConcurrentHashMap]]></title>
    <url>%2F2019%2F01%2F22%2Fjava-collection%2F12.ConcurrentHashMap%2F</url>
    <content type="text"><![CDATA[å¯¹äºŽå¹¶å‘åœºæ™¯ä¸‹ï¼ŒæŽ¨èä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ concurrentHashMap ï¼Œè€Œä¸æ˜¯ HashMap æˆ–è€…æ˜¯ HashTable .concurrentHashMapåœ¨JDK7å’ŒJDK8ä¸­çš„å®žçŽ°åŽŸç†æ˜¯ä¸ä¸€æ ·çš„ã€‚æœ¬æ–‡åˆ†åˆ«å¯¹å…¶æ ¸å¿ƒæ€æƒ³å’Œæ–¹æ³•è¿›è¡Œé˜è¿°ã€‚ ä¸€ã€JDK7å®žçŽ° ConcurrentHashMap çš„å†…éƒ¨ç»†åˆ†äº†è‹¥å¹²ä¸ªå°çš„ HashMap ï¼Œç§°ä¹‹ä¸ºæ®µï¼ˆ SEGMENT ï¼‰ã€‚ ConcurrentHashMap æ˜¯ä¸€ä¸ª Segment æ•°ç»„ï¼ŒSegment é€šè¿‡ç»§æ‰¿ ReentrantLock æ¥è¿›è¡ŒåŠ é”ï¼Œæ‰€ä»¥æ¯æ¬¡éœ€è¦åŠ é”çš„æ“ä½œé”ä½çš„æ˜¯ä¸€ä¸ª segment ï¼Œè¿™æ ·åªè¦ä¿è¯æ¯ä¸ª Segment æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿå°±å®žçŽ°äº†å…¨å±€çš„çº¿ç¨‹å®‰å…¨ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¯ç”± Segment æ•°ç»„ã€HashEntry æ•°ç»„ç»„æˆï¼Œå’Œ HashMap ä¸€æ ·ï¼Œä»ç„¶æ˜¯æ•°ç»„åŠ é“¾è¡¨ç»„æˆã€‚ ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”æŠ€æœ¯ï¼Œå…¶ä¸­ Segment ç»§æ‰¿äºŽ ReentrantLockã€‚ä¸ä¼šåƒ HashTable é‚£æ ·ä¸ç®¡æ˜¯ put è¿˜æ˜¯ get æ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç†ï¼Œç†è®ºä¸Š ConcurrentHashMap æ”¯æŒ CurrencyLevel ( Segment æ•°ç»„æ•°é‡)çš„çº¿ç¨‹å¹¶å‘ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®ä¸€ä¸ª Segment æ—¶ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚ 1.1 getæ–¹æ³• ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯éžå¸¸é«˜æ•ˆçš„ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”ã€‚ åªéœ€è¦å°† Key é€šè¿‡ Hash ä¹‹åŽå®šä½åˆ°å…·ä½“çš„ Segment ï¼Œå†é€šè¿‡ä¸€æ¬¡ Hash å®šä½åˆ°å…·ä½“çš„å…ƒç´ ä¸Šã€‚ç”±äºŽ HashEntry ä¸­çš„ value å±žæ€§æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡èŽ·å–æ—¶éƒ½æ˜¯æœ€æ–°å€¼. å†…éƒ¨ HashEntry ç±» ï¼š 12345678910111213static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next; HashEntry(int hash, K key, V value, HashEntry&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125;&#125; 1.2 putæ–¹æ³• è™½ç„¶ HashEntry ä¸­çš„ value æ˜¯ç”¨ volatile å…³é”®è¯ä¿®é¥°çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¹¶å‘çš„åŽŸå­æ€§ï¼Œæ‰€ä»¥ put æ“ä½œæ—¶ä»ç„¶éœ€è¦åŠ é”å¤„ç†ã€‚ é¦–å…ˆä¹Ÿæ˜¯é€šè¿‡ Key çš„ Hash å®šä½åˆ°å…·ä½“çš„ Segmentï¼Œåœ¨ put ä¹‹å‰ä¼šè¿›è¡Œä¸€æ¬¡æ‰©å®¹æ ¡éªŒã€‚è¿™é‡Œæ¯” HashMap è¦å¥½çš„ä¸€ç‚¹æ˜¯ï¼šHashMap æ˜¯æ’å…¥å…ƒç´ ä¹‹åŽå†çœ‹æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œæœ‰å¯èƒ½æ‰©å®¹ä¹‹åŽåŽç»­å°±æ²¡æœ‰æ’å…¥å°±æµªè´¹äº†æœ¬æ¬¡æ‰©å®¹(æ‰©å®¹éžå¸¸æ¶ˆè€—æ€§èƒ½)ã€‚ è€Œ ConcurrentHashMap ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯åœ¨å°†æ•°æ®æ’å…¥ä¹‹å‰æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œä¹‹åŽå†åšæ’å…¥æ“ä½œã€‚ 1.3 sizeæ–¹æ³• æ¯ä¸ª Segment éƒ½æœ‰ä¸€ä¸ª volatile ä¿®é¥°çš„å…¨å±€å˜é‡ count ,æ±‚æ•´ä¸ª ConcurrentHashMap çš„ size æ—¶å¾ˆæ˜Žæ˜¾å°±æ˜¯å°†æ‰€æœ‰çš„ count ç´¯åŠ å³å¯ã€‚ä½†æ˜¯ volatile ä¿®é¥°çš„å˜é‡å´ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹çš„åŽŸå­æ€§ï¼Œæ‰€æœ‰ç›´æŽ¥ç´¯åŠ å¾ˆå®¹æ˜“å‡ºçŽ°å¹¶å‘é—®é¢˜ã€‚ ä½†å¦‚æžœæ¯æ¬¡è°ƒç”¨ size æ–¹æ³•å°†å…¶ä½™çš„ä¿®æ”¹æ“ä½œåŠ é”æ•ˆçŽ‡ä¹Ÿå¾ˆä½Žã€‚æ‰€ä»¥åšæ³•æ˜¯å…ˆå°è¯•ä¸¤æ¬¡å°† count ç´¯åŠ ï¼Œå¦‚æžœå®¹å™¨çš„ count å‘ç”Ÿäº†å˜åŒ–å†åŠ é”æ¥ç»Ÿè®¡ sizeã€‚ åœ¨ JDK7 ä¸­ï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆä»–ä¼šä½¿ç”¨ä¸åŠ é”çš„æ¨¡å¼åŽ»å°è¯•å¤šæ¬¡è®¡ç®— ConcurrentHashMap çš„ sizeï¼Œæœ€å¤šä¸‰æ¬¡ï¼Œæ¯”è¾ƒå‰åŽä¸¤æ¬¡è®¡ç®—çš„ç»“æžœï¼Œç»“æžœä¸€è‡´å°±è®¤ä¸ºå½“å‰æ²¡æœ‰å…ƒç´ åŠ å…¥ï¼Œè®¡ç®—çš„ç»“æžœæ˜¯å‡†ç¡®çš„ã€‚ ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯å¦‚æžœç¬¬ä¸€ç§æ–¹æ¡ˆä¸ç¬¦åˆï¼Œä»–å°±ä¼šç»™æ¯ä¸ª Segment åŠ ä¸Šé”ï¼Œç„¶åŽè®¡ç®— ConcurrentHashMap çš„ size è¿”å›žã€‚å…¶æºç å®žçŽ°: 12345678910111213141516171819202122232425262728293031323334353637public int size() &#123; final Segment&lt;K,V&gt;[] segments = this.segments; int size; boolean overflow; // true if size overflows 32 bits long sum; // sum of modCounts long last = 0L; // previous sum int retries = -1; // first iteration isn't retry try &#123; for (;;) &#123; if (retries++ == RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) ensureSegment(j).lock(); // force creation &#125; sum = 0L; size = 0; overflow = false; for (int j = 0; j &lt; segments.length; ++j) &#123; Segment&lt;K,V&gt; seg = segmentAt(segments, j); if (seg != null) &#123; sum += seg.modCount; int c = seg.count; if (c &lt; 0 || (size += c) &lt; 0) overflow = true; &#125; &#125; if (sum == last) break; last = sum; &#125; &#125; finally &#123; if (retries &gt; RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) segmentAt(segments, j).unlock(); &#125; &#125; return overflow ? Integer.MAX_VALUE : size;&#125; å…¶ä¸­ 12// é”ä¹‹å‰é‡è¯•æ¬¡æ•°static final int RETRIES_BEFORE_LOCK = 2; äºŒã€JDK8å®žçŽ° jdk8 ä¸­çš„ ConcurrentHashMap æ•°æ®ç»“æž„å’Œå®žçŽ°ä¸Ž jdk7 è¿˜æ˜¯æœ‰ç€æ˜Žæ˜¾çš„å·®å¼‚ã€‚ å…¶ä¸­æŠ›å¼ƒäº†åŽŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚ ä¹Ÿå°† jdk7 ä¸­å­˜æ”¾æ•°æ®çš„ HashEntry æ”¹ä¸º Nodeï¼Œä½†ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ã€‚ å…¶ä¸­çš„ val next éƒ½ç”¨äº† volatile ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ã€‚ 2.1 putæ–¹æ³• é‡ç‚¹æ¥çœ‹çœ‹ put å‡½æ•°ï¼š æ ¹æ® key è®¡ç®—å‡º hashcode ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚ f å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æžœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚ å¦‚æžœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1,åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚ å¦‚æžœéƒ½ä¸æ»¡è¶³(ä¸éœ€è¦åˆå§‹åŒ–ã€Nodeä¸ä¸ºç©ºã€ä¸éœ€è¦æ‰©å®¹)ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®ã€‚ å¦‚æžœæ•°é‡å¤§äºŽ TREEIFY_THRESHOLD åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ 2.2 getæ–¹æ³• æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hashcode å¯»å€ï¼Œå¦‚æžœå°±åœ¨æ¡¶ä¸Šé‚£ä¹ˆç›´æŽ¥è¿”å›žå€¼ã€‚ å¦‚æžœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼èŽ·å–å€¼ã€‚ éƒ½ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éåŽ†èŽ·å–å€¼ã€‚ 2.3 sizeæ–¹æ³• JDK8 å®žçŽ°ç›¸æ¯” JDK7 ç®€å•å¾ˆå¤šï¼Œåªæœ‰ä¸€ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬ç›´æŽ¥çœ‹ size() ä»£ç ï¼š 123456789101112131415161718192021public int size() &#123; long n = sumCount(); return ((n &lt; 0L) ? 0 : (n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)n); &#125;final long sumCount() &#123; CounterCell[] as = counterCells; CounterCell a; //èŽ·å–baseCountå€¼ long sum = baseCount; //éåŽ†CounterCellæ•°ç»„å…¨éƒ¨åŠ åˆ°baseCountä¸Šï¼Œå®ƒä»¬çš„å’Œå°±æ˜¯size if (as != null) &#123; for (int i = 0; i &lt; as.length; ++i) &#123; if ((a = as[i]) != null) sum += a.value; &#125; &#125; return sum; &#125; å¯èƒ½ä½ ä¼šæœ‰æ‰€ç–‘é—®ï¼ŒConcurrentHashMap ä¸­çš„ baseCount å±žæ€§ä¸å°±æ˜¯è®°å½•çš„æ‰€æœ‰é”®å€¼å¯¹çš„æ€»æ•°å—ï¼Ÿç›´æŽ¥è¿”å›žå®ƒä¸å°±è¡Œäº†å—ï¼Ÿ ä¹‹æ‰€ä»¥æ²¡æœ‰è¿™ä¹ˆåšï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬çš„ addCount æ–¹æ³•ç”¨äºŽ CAS æ›´æ–° baseCountï¼Œä½†å¾ˆæœ‰å¯èƒ½åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆè¿™äº›èŠ‚ç‚¹è™½ç„¶å·²ç»è¢«æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­äº†ï¼Œä½†æ˜¯æ•°é‡å´æ²¡æœ‰è¢«ç»Ÿè®¡ã€‚ è¿˜å¥½ï¼ŒaddCount æ–¹æ³•åœ¨æ›´æ–° baseCount å¤±è´¥çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ fullAddCount å°†è¿™äº›å¤±è´¥çš„ç»“ç‚¹åŒ…è£…æˆä¸€ä¸ª CounterCell å¯¹è±¡ï¼Œä¿å­˜åœ¨ CounterCell æ•°ç»„ä¸­ã€‚é‚£ä¹ˆæ•´å¼ è¡¨å®žé™…çš„ size å…¶å®žæ˜¯ baseCount åŠ ä¸Š CounterCellæ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚ ä¸‰ã€æ€»ç»“ å¹¶å‘æƒ…å†µä¸‹è¯·ä½¿ç”¨concurrentHashMap åœ¨jdk7ä¸­ï¼Œç”¨çš„æ˜¯åˆ†æ®µé”ï¼Œé»˜è®¤æ˜¯12æ®µï¼Œé‚£ä¹ˆå¹¶å‘é‡æœ€å¤šä¹Ÿå°±12. getä¸åŠ é”ï¼Œç¬¬ä¸€æ¬¡hashå®šä½åˆ°segmentï¼Œç¬¬äºŒæ¬¡hashå®šä½åˆ°å…ƒç´ ï¼Œå…ƒç´ å€¼æ˜¯ç”¨volatileä¿è¯å†…å­˜å¯è§æ€§ putéœ€è¦åŠ é”ï¼Œhashå®šä½åˆ°segmentåŽï¼Œå…ˆæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹å†æ’å…¥ã€‚ sizeå…ˆä½¿ç”¨ä¸åŠ é”çš„æ¨¡å¼åŽ»å°è¯•å¤šæ¬¡è®¡ç®—sizeï¼Œæœ€å¤šä¸‰æ¬¡ï¼Œæ¯”è¾ƒå‰åŽä¸¤æ¬¡è®¡ç®—çš„ç»“æžœï¼Œç»“æžœä¸€è‡´å°±è®¤ä¸ºå½“å‰æ²¡æœ‰å…ƒç´ åŠ å…¥ï¼›å¦‚æžœä¸ä¸€è‡´ï¼Œç»™æ¯ä¸ª Segment åŠ ä¸Šé”å†ä¾æ¬¡åŽ»è®¡ç®—ä¸ªæ•° åœ¨jdk8ä¸­ï¼Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ putçš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œç®€å•æ¥è¯´æ˜¯ï¼šå…ˆè®¡ç®—hashå®šä½åˆ°nodeâ€”ã€‹åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ–â€”ã€‹å¦‚æžœnodeä¸ºç©ºåˆ™è¡¨ç¤ºå¯ä»¥æ’å…¥ï¼Œç”¨casæ’å…¥â€”ã€‹åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹â€”ã€‹å¦‚æžœä¸éœ€è¦åˆå§‹åŒ–ã€Nodeä¸ä¸ºç©ºã€ä¸éœ€è¦æ‰©å®¹ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®â€”ã€‹åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ getå°±æ¯”è¾ƒç®€å•ï¼Œç›´æŽ¥æ ¹æ®hashå®šä½åˆ°nodeï¼Œç„¶åŽä»¥é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„æ–¹å¼æ‹¿åˆ° sizeæ–¹æ³•å°±ä¸€ç§æ–¹æ¡ˆï¼šbaseCount+CounterCell[]ä¸­æ‰€æœ‰å…ƒç´  æ•´ç†è‡ªï¼š https://crossoverjie.top/JCSprout/#/thread/ConcurrentHashMap?id=size-æ–¹æ³• https://www.jianshu.com/p/e99e3fcface4]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMapæ­»å¾ªçŽ¯é—®é¢˜]]></title>
    <url>%2F2019%2F01%2F21%2Fjava-collection%2F11.HashMap%E6%AD%BB%E5%BE%AA%E7%8E%AF%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[JDK1.7æˆ–è€…æ›´è€çš„ç‰ˆæœ¬ä¸­åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹æ˜¯ä¼šå­˜åœ¨æ­»å¾ªçŽ¯é—®é¢˜ï¼Œç©¶å…¶åŽŸå› æ˜¯putè¿‡ç¨‹ä¸­çš„resizeæ–¹æ³•åœ¨è°ƒç”¨transferæ–¹æ³•çš„æ—¶å€™å¯¼è‡´çš„æ­»é”ã€‚è¿™æ¬¡æˆ‘ä»¬æ¥çœ‹çœ‹åˆ°åº•æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼ æ ¸å¿ƒæºç  åœ¨JDK8ä¸­ï¼Œå†…éƒ¨å·²ç»è°ƒæ•´ï¼Œè§£å†³äº†æ­»å¾ªçŽ¯é—®é¢˜ï¼Œæ˜¯å¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿå°†JDK7ä¸­å¤´æ’å…¥æ³•æ”¹ä¸ºæœ«ç«¯æ’å…¥ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚å…³äºŽè¿™ä¸ªï¼Œå¯ä»¥æŸ¥çœ‹jdk8æºç ä¸­çš„resizeæ–¹æ³•ã€‚ ä¸Šé¢æåˆ°æ˜¯ç”±äºŽputæ—¶å‡ºçŽ°é—®é¢˜ï¼Œé‚£ä¹ˆå…ˆæ¥åˆ°put()ä¸­çœ‹çœ‹ï¼š æˆ‘ä»¬çœ‹åˆ°ï¼Œputä¸€ä¸ªä¸å­˜åœ¨çš„æ–°å…ƒç´ ï¼Œå¿…ç„¶å¢žåŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¿›å…¥è¿™ä¸ªå¢žåŠ èŠ‚ç‚¹çš„æ–¹æ³•ï¼š æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œéœ€è¦çš„è¯å°±resize: ä¸‹é¢å°±æ˜¯å¯¹é“¾è¡¨æ•°æ®è¿›è¡Œè¿ç§»ï¼š æ ¸å¿ƒçš„ä»£ç å°±æ˜¯è¿™ä¹ˆå¤šï¼Œé¦–å…ˆè¦å¼ºè°ƒä¸€ä¸‹ï¼šä¸¤ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œæ˜¯åˆ†åˆ«å»ºç«‹äº†ä¸¤ä¸ªç‹¬ç«‹çš„æ‰©å®¹åŽçš„æ•°ç»„ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯ä¸¤ä¸ªé•¿åº¦ä¸º4çš„æ•°ç»„ã€‚è€çš„æ•°ç»„ä¸º2ä¸ªæ•°å°±æ˜¯å”¯ä¸€çš„ã€‚æ‰€ä»¥åœ¨ç¬¬ä¸€æ­¥ï¼Œçº¿ç¨‹2è¿è¡Œç»“æŸæ—¶ï¼Œè€çš„æ•°ç»„å…ƒç´ å·²ç»ç©ºäº†ã€‚ ä¸‹é¢å…ˆæ¼”ç¤ºä¸€ä¸‹æ­£å¸¸çš„rehashè¿‡ç¨‹ã€‚ æ­£å¸¸æƒ…å†µ å‡è®¾äº†æˆ‘ä»¬çš„hashç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨ key mod ä¸€ä¸‹æ•°ç»„(hashè¡¨)çš„å¤§å° æœ€ä¸Šé¢çš„æ˜¯old hash è¡¨ï¼Œå…¶ä¸­çš„Hashè¡¨çš„size=2, æ‰€ä»¥key = 3, 7, 5ï¼Œåœ¨mod 2ä»¥åŽéƒ½å†²çªåœ¨table[1]è¿™é‡Œäº†ã€‚ æŽ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯Hashè¡¨ resize æˆ4ï¼Œç„¶åŽæ‰€æœ‰çš„ &lt;key,value&gt; é‡æ–° rehash çš„è¿‡ç¨‹ æ³¨æ„åˆ°ï¼Œåœ¨JDK7ä¸­ï¼Œæ˜¯æŒ‰ç…§å¤´æ’å…¥æ³•ä¾æ¬¡æ’å…¥çš„ã€‚æ‰€ä»¥7æ’åˆ°äº†3å‰é¢ã€‚ å¹¶å‘æƒ…å†µ 1.åˆå§‹æƒ…å†µ å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªçº¿ç¨‹ã€‚æˆ‘ç”¨çº¢è‰²å’Œæµ…è“è‰²æ ‡æ³¨äº†ä¸€ä¸‹ã€‚ å¯¹äºŽç¬¬ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œå®Œè¿™ä¸€è¡Œï¼Œç„¶åŽæŒ‚èµ·ï¼Œæ­¤æ—¶ e å’Œ next éƒ½é™„å¥½å€¼äº†ï¼š è€Œè®©çº¿ç¨‹äºŒæ‰§è¡Œå®Œæˆã€‚äºŽæ˜¯æˆ‘ä»¬æœ‰ä¸‹é¢çš„è¿™ä¸ªæ ·å­ï¼š å› ä¸ºThread1çš„ e æŒ‡å‘äº† key(3) ï¼Œè€Œ next æŒ‡å‘äº† key(7) ï¼Œå…¶åœ¨ Thread2 rehashåŽï¼ŒæŒ‡å‘äº† Thread2 é‡ç»„åŽçš„é“¾è¡¨ã€‚ 2.Thread1è¢«è°ƒåº¦å›žæ¥æ‰§è¡Œ å…ˆæ˜¯æ‰§è¡Œ newTalbe[i] = e ï¼šæ­¤æ—¶çº¿ç¨‹1çš„ç¬¬ä¸‰ä¸ªä½ç½®å°±æ˜¯æŒ‡å‘å…ƒç´ 3; ç„¶åŽæ˜¯ e = nextï¼Œå¯¼è‡´äº† e æŒ‡å‘äº† key(7) ; è€Œä¸‹ä¸€æ¬¡å¾ªçŽ¯çš„ next = e.next å¯¼è‡´äº† next æŒ‡å‘äº† key(3) ; 3.ä¸€åˆ‡å®‰å¥½ çº¿ç¨‹ä¸€æŽ¥ç€å·¥ä½œã€‚æŠŠ key(7) æ‘˜ä¸‹æ¥ï¼Œæ”¾åˆ° newTable[i] çš„ç¬¬ä¸€ä¸ªï¼Œç„¶åŽæŠŠ e å’Œ next å¾€ä¸‹ç§»ã€‚ 4.çŽ¯å½¢é“¾æŽ¥å‡ºçŽ° e.next = newTable[i] å¯¼è‡´ key(3).next æŒ‡å‘äº† key(7) æ³¨æ„ï¼šæ­¤æ—¶çš„ key(7).next å·²ç»æŒ‡å‘äº† key(3)ï¼Œ çŽ¯å½¢é“¾è¡¨å°±è¿™æ ·å‡ºçŽ°äº†ã€‚ è‡ªå·±çš„ç®€å•æ•´ç† è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒç»•çš„ï¼Œç†è§£çš„æœ€å¥½æ–¹å¼å·¦è¾¹æ”¾æºç ï¼Œå³è¾¹æ”¾å›¾ï¼Œä¸­é—´ç”¨è‰ç¨¿çº¸ç”»ä¸€ç”»ã€‚ é‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘åœ¨å¯¹å…¶è¿‡ç¨‹å°½å¯èƒ½åœ°è®²æ˜Žç™½ä¸€ç‚¹ã€‚æˆ‘ä»¬å…ˆç¡®å®š7å’Œ3ä¼šå…¨éƒ¨è½åˆ°æ‰©å®¹åŽçš„ä¸‹æ ‡ä¸º3çš„ä½ç½®(3%4=3,7%4=3)ã€‚ è§„å®šçº¿ç¨‹1å¼€è¾Ÿçš„æ•°ç»„ä¸º arr1 ï¼Œçº¿ç¨‹2å¼€è¾Ÿçš„æ•°ç»„ä¸º arr2; 1. åˆå§‹çŠ¶æ€ çº¿ç¨‹ä¸€ï¼š e -&gt; key3 , next -&gt; key7 çº¿ç¨‹äºŒï¼š æ•°ç»„3å·ä½ç½® arr2[3] -&gt; key7 -&gt; key3 æ³¨æ„æ­¤æ—¶ key7 æŒ‡å‘ key3 . æˆ‘ä»¬è¦æ˜Žç¡®ä¸€ä¸‹ï¼Œå‘ç”Ÿæ­»å¾ªçŽ¯ï¼Œæ˜¯æŒ‡åœ¨putæ“ä½œå®Œæ¯•ä¹‹åŽï¼Œæœ€ç»ˆç”Ÿæˆçš„æ•°ç»„ä¸­æœ‰æ­»å¾ªçŽ¯å¼•ç”¨æ‰è¡Œï¼Œåƒä¸‡ä¸è¦ä¸€å¼€å§‹çœ‹çº¿ç¨‹ä¸€ç§key3æŒ‡å‘key7ï¼Œç„¶åŽçº¿ç¨‹äºŒç§key7æŒ‡å‘key3å°±æ˜¯æ­»å¾ªçŽ¯äº†ã€‚ã€‚ã€‚ 2. çº¿ç¨‹ä¸€ç»§ç»­æ‰§è¡Œ i = 3 e.next = key7,æ­¤æ—¶ e=key3 ,æ‰€ä»¥æ˜¯ key3.next = key7ï¼ˆè¿™æ˜¯çº¿ç¨‹1çš„åˆå§‹çŠ¶æ€å†³å®šçš„ï¼‰ arr1[3] æŒ‡å‘ key3 e ä¸º key7 3.ç”±äºŽeä¸ä¸ºç©ºï¼Œæ‰€ä»¥è¿˜ä¼šå¾ªçŽ¯ï¼š ä¸Šä¸€æ­¥ e ä¸º key7ï¼Œæ‰€ä»¥ next = key7.next ï¼Œåˆ°çº¿ç¨‹2ä¸­ä¸€çœ‹æ˜¯ key3 ï¼Œæ‰€ä»¥ next = key3ï¼ˆçº¿ç¨‹2ä¸­key7.nextå°±æ˜¯key3ï¼‰ i = 3 e.next = key3------æ³¨æ„ï¼Œè¿™é‡Œå°±æ˜¯Key7æŒ‡å‘äº†key3,key7çš„nextå¼•ç”¨ä¸‹é¢æ²¡æœ‰å˜è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œåšä¸€ä¸‹è®°å½•ï¼Œå³key7æŒ‡å‘key3 newTable[3] = key7 e = key3 4.ç”±äºŽeä¸ä¸ºç©ºï¼Œæ‰€ä»¥è¿˜ä¼šå¾ªçŽ¯ï¼š ä¸Šä¸€æ­¥ e=key3 , next=null i=3 key3.next = key7ï¼Œæ³¨æ„,ç”±äºŽkey7å·²ç»æŒ‡å‘äº†key3ï¼Œæ­¤æ—¶key3åˆæŒ‡å‘key7,å‘ç”Ÿæ­»å¾ªçŽ¯ newTable[3] = key3 e = null 5.eä¸ºnullï¼Œè·³å‡ºå¾ªçŽ¯ã€‚ æ­¤æ—¶å‘çŽ°key3åˆæŒ‡å‘äº†key7ã€‚å‘ç”Ÿæ­»å¾ªçŽ¯ã€‚ æ•´ç†è‡ª:https://coolshell.cn/articles/9606.html/comment-page-2#comments]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxé‡è¦çš„ä¸€äº›å‘½ä»¤]]></title>
    <url>%2F2019%2F01%2F21%2Flinux%E9%87%8D%E8%A6%81%E7%9A%84%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[å¾ˆå¤šå‘½ä»¤ä¹‹æ‰€ä»¥é‡è¦ï¼Œæ˜¯å› ä¸ºç”¨å®ƒä»¬ä¼šå¤§å¹…æé«˜å·¥ä½œæ•ˆçŽ‡ã€‚æ‰€ä»¥ï¼Œç†Ÿæ‚‰å®ƒä»¬æ˜¯æˆ‘ä»¬å¿…é¡»è¦åšçš„ä¸€ä»¶äº‹æƒ…ã€‚ä¸‹é¢ç€é‡æå–äº†findã€grepã€ç®¡é“ã€wcã€awkä»¥åŠsedç­‰å‡ ä¸ªå‘½ä»¤æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ã€‚ ä¸€ã€Linuxä½“ç³»ç»“æž„ å¯¹è¿™å¹…å›¾è¿›è¡Œè¯¦ç»†è¯´æ˜Žä¸€ä¸‹ã€‚ ä½“ç³»ç»“æž„ä¸»è¦åˆ†ä¸ºç”¨æˆ·æ€(ç”¨æˆ·ä¸Šå±‚æ´»åŠ¨)å’Œå†…æ ¸æ€ å†…æ ¸ï¼šæœ¬è´¨æ˜¯ä¸€æ®µç®¡ç†è®¡ç®—æœºç¡¬ä»¶è®¾å¤‡çš„ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºç›´æŽ¥ç®¡ç†ç¡¬ä»¶ï¼šåŒ…æ‹¬CPUã€å†…å­˜ç©ºé—´ã€ç¡¬ç›˜æŽ¥å£ã€ç½‘ç»œæŽ¥å£ç­‰ã€‚æ‰€æœ‰çš„è®¡ç®—æœºæ“ä½œéƒ½è¦é€šè¿‡å†…æ ¸æ¥æ“ä½œã€‚ ç³»ç»Ÿè°ƒç”¨ï¼šå†…æ ¸çš„è®¿é—®æŽ¥å£ï¼Œæ˜¯ä¸€ç§ä¸èƒ½å†ç®€åŒ–çš„æ“ä½œ(å¯ä»¥è®¤ä¸ºç³»ç»Ÿè°ƒç”¨å·²ç»æ˜¯æœ€å°çš„åŽŸå­æ“ä½œï¼Œä¸Šå±‚å®Œæˆä¸€ä¸ªåŠŸèƒ½è¦ä¾æ‰˜äºŽè‹¥å¹²ç³»ç»Ÿè°ƒç”¨æ‰èƒ½å®Œæˆ) ç”±äºŽç³»ç»Ÿè°ƒç”¨æ¯”è¾ƒåŸºç¡€ï¼Œè¦å®Œæˆä¸€ä¸ªåŠŸèƒ½éœ€è¦å¾ˆå¤šç³»ç»Ÿè°ƒç”¨ç»„åˆæ‰èƒ½å®žçŽ°ï¼Œå¯¹äºŽç¨‹åºå‘˜æ¥è¯´æ¯”è¾ƒå¤æ‚ã€‚è¿™ä¸ªæ—¶å€™æ€Žä¹ˆåŠžå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è°ƒç”¨å…¬å…±å‡½æ•°åº“ï¼šç³»ç»Ÿè°ƒç”¨çš„ç»„åˆæ‹³ã€‚ç®€åŒ–ç¨‹åºå‘˜æ“ä½œã€‚ Shellä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„åº”ç”¨ç¨‹åºï¼Œæ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šå™¨ï¼Œå¯ä»¥ç¼–ç¨‹ã€‚ Shellä¸‹é€šç³»ç»Ÿè°ƒç”¨ï¼Œä¸Šé€šå„ç§åº”ç”¨ï¼Œæ˜¯ä¸Šå±‚å’Œä¸‹å±‚ä¹‹é—´ç²˜åˆçš„èƒ¶æ°´ï¼Œè®©ä¸åŒç¨‹åºå¯ä»¥å•åŒå·¥ä½œã€‚ åœ¨æ²¡æœ‰å›¾å½¢ç•Œé¢ä¹‹å‰ï¼Œç”¨æˆ·é€šè¿‡shellå‘½ä»¤è¡Œæˆ–è€…å¯ç¼–ç¨‹çš„shellè„šæœ¬å¯ä»¥å®Œæˆå¾ˆå¤šäº‹æƒ…ã€‚ äºŒã€å¦‚ä½•æ ¹æ®æ–‡ä»¶åæ£€ç´¢æ–‡ä»¶ find åœ¨æŒ‡å®šç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶ è¯­æ³• find path [options] params 2.1 ç²¾ç¡®æŸ¥æ‰¾æ–‡ä»¶ æ¯”å¦‚æˆ‘åœ¨å½“å‰ç›®å½•(å¯èƒ½åœ¨å­ç›®å½•ä¸‹)ä¸‹æ‰¾ä¸€ä¸ªæ–‡ä»¶å«åštest.javaï¼š 1find -name "test.java" è¿™ä¸ªæŒ‡ä»¤å°±å¯ä»¥åœ¨æœ¬ç›®å½•ä»¥åŠå­ç›®å½•ä¸‹é€’å½’æŸ¥æ‰¾è¿™ä¸ªæ–‡ä»¶äº†ã€‚ å®žä¾‹ï¼šç²¾ç¡®æŸ¥è¯¢åå­—å«snailmall-api-gateway-8080.jarè¿™ä¸ªæ–‡ä»¶ï¼š 2.2 å…¨å±€æœç´¢ å¦‚æžœæ˜¯å…¨å±€æŸ¥æ‰¾ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ— éžæ˜¯ä»Žæ ¹ç›®å½•å¼€å§‹é€’å½’æŸ¥æ‰¾ã€‚ 1find / -name "test.java" å®žä¾‹ï¼šæˆ‘å¯¹è¿™å°æœåŠ¡å™¨å…¨å±€æŸ¥æ‰¾æ–‡ä»¶åä»¥snailmallå¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶ï¼š 2.3 æ¨¡ç³ŠæŸ¥è¯¢ å¦‚æžœæ‰¾ä»¥testæ‰“å¤´çš„æ–‡ä»¶ï¼š 1find -name "test*" å³ç”¨ * é€šé…ç¬¦å°±å¯ä»¥æ¨¡ç³ŠæŸ¥è¯¢åˆ°ä»¥ test æ‰“å¤´çš„æ–‡ä»¶ã€‚ å®žä¾‹ï¼Œæˆ‘çš„è¿™å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†å‡ ä¸ªå…³äºŽå•†åŸŽçš„æœåŠ¡ï¼Œè¿™ä¸ªç›®å½•ä¸‹æˆ‘æ”¾äº†jaråŒ…å’Œç›¸åº”çš„å¯åŠ¨ä¿¡æ¯æ–‡ä»¶ã€‚æˆ‘å¯¹å…¶è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼š 2.4 å¿½ç•¥å¤§å°å†™ 1find -iname "test*" ä¸‰ã€å¦‚ä½•æ ¹æ®æ–‡ä»¶å†…çš„å†…å®¹è¿›è¡Œæ£€ç´¢ 3.1 grepå‘½ä»¤ grep æŸ¥æ‰¾æ–‡ä»¶é‡Œç¬¦åˆæ¡ä»¶çš„å­—ç¬¦ä¸² è¯­æ³•ï¼šgrep [options] pattern file æ¯”å¦‚ test.java ä¸­æœ‰ä¸€å¥è¯æ˜¯ï¼š 1System.out.println("i love java"); é‚£ä¹ˆå¦‚ä½•æŸ¥æ‰¾ test.java ä¸­çš„ java å‘¢ï¼Ÿ 1grep "java" test* è¿™å¥è¯æ„æ€å°±æ˜¯æŸ¥æ‰¾ä»¥ test æ‰“å¤´çš„æ–‡ä»¶ä¸­çš„åŒ…å« java å­—ç¬¦ä¸²æ‰€åœ¨çš„è¡Œã€‚ ç›´æŽ¥è¾“å…¥ï¼š 1grep "hello" ä¼šç­‰å¾…ç”¨æˆ·è¾“å…¥æ–‡æœ¬ã€‚ç„¶åŽå†å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œæ£€ç´¢ã€‚ 3.2 ç®¡é“æ“ä½œç¬¦ | å¯å°†æŒ‡ä»¤è¿žæŽ¥èµ·æ¥ï¼Œå‰ä¸€ä¸ªæŒ‡ä»¤çš„è¾“å‡ºä½œä¸ºåŽä¸€ä¸ªæŒ‡ä»¤çš„è¾“å…¥ã€‚ 1find / | grep "test" ä½œç”¨åŒï¼š 1find / -name "test" æ³¨æ„ï¼š åªæœ‰å‰ä¸€ä¸ªæŒ‡ä»¤æ­£ç¡®æ‰ä¼šå†å¤„ç†ã€‚ ç®¡é“å³è¾¹å‘½ä»¤å¿…é¡»èƒ½æŽ¥æ”¶æ ‡å‡†è¾“å…¥æµï¼Œå¦åˆ™ä¼ é€’è¿‡ç¨‹ä¸­æ•°æ®ä¼šè¢«æŠ›å¼ƒ 3.3 grepç»“åˆç®¡é“ 1grep 'xxx' hello.info å¯ä»¥å°† xxx æ‰€åœ¨çš„è¡Œå…¨éƒ¨ç­›é€‰å‡ºæ¥ï¼Œä½†æ˜¯è¿˜æ˜¯ç‰¹åˆ«å¤šï¼Œæˆ‘æ¯”å¦‚å…³å¿ƒè¿™æ¯ä¸€è¡Œä¸­æŸä¸ªå­—æ®µçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ˜¯ param[xx12]è¿™ç§ä¿¡æ¯ã€‚å¦‚ä½•å®žçŽ°ç­›é€‰å‘¢ï¼Ÿ 1grep 'xxx' hello.info | grep -o 'param\[[0-9a-z]*\]' è¿™æ ·å°±åªæŠŠç±»ä¼¼äºŽ param[xx12] è¿™æ ·çš„ä¿¡æ¯æ¸…æ™°åœ°å±•çŽ°å‡ºæ¥ã€‚ å¦‚ä½•è¿‡æ»¤æŽ‰ä¸è¦çš„ä¿¡æ¯å‘¢ï¼Ÿå¯ä»¥ç”¨ï¼š 1grep -v æ¯”å¦‚æˆ‘ä»¬æŸ¥è¯¢ tomcat è¿›ç¨‹ä¿¡æ¯ï¼š 1ps -ef | grep tomcat æˆ‘ä»¬ä¼šå‘çŽ°ï¼Œä¸ä»… tomcat çš„ä¿¡æ¯å±•çŽ°å‡ºæ¥äº†ï¼Œæ‰§è¡Œ grep å‘½ä»¤æœ¬èº«çš„è¿›ç¨‹ä¿¡æ¯ä¹Ÿå±•ç¤ºå‡ºæ¥äº†ã€‚æˆ‘ä»¬è¦å°†è¿™ä¸ª grep å‘½ä»¤è¿‡æ»¤æŽ‰ï¼Œåªå±•çŽ° tomcat è¿›ç¨‹ä¿¡æ¯ï¼Œå¯ä»¥ï¼š 1ps -ef | grep tomcat | grep -v "grep" è¿™æ ·å°±æŠŠ grep è¿›ç¨‹ä¿¡æ¯è¿‡æ»¤æŽ‰äº†ã€‚ å››ã€å¦‚ä½•å¯¹æ–‡ä»¶å†…å®¹åšç»Ÿè®¡ awk ä¸€æ¬¡è¯»å–ä¸€è¡Œæ–‡æœ¬ï¼ŒæŒ‰è¾“å…¥åˆ†éš”ç¬¦è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡æˆå¤šä¸ªç»„æˆéƒ¨åˆ† å°†åˆ‡ç‰‡ç›´æŽ¥ä¿å­˜å†å†…å»ºçš„å˜é‡ä¸­ï¼Œ$1$2â€¦($0è¡¨ç¤ºè¡Œçš„å…¨éƒ¨) æ”¯æŒå¯¹å•ä¸ªåˆ‡ç‰‡çš„åˆ¤æ–­ï¼Œæ”¯æŒå¾ªçŽ¯åˆ¤æ–­ï¼Œé»˜è®¤åˆ†éš”ç¬¦ä¸ºç©ºæ ¼ è¯­æ³•ï¼šawk [options] â€˜cmdâ€™ file æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶text1.txtï¼š 123456789proto Recv-Q Send-Q Local Address Foreign Address statetcp 0 48 111.34.134.2:ssh 124.213.2.12:12565 ESTABLISHEDtcp 0 48 localhost:mysql 124.213.2.12:12565 ESTABLISHEDudp 0 48 111.34.13.2:s0 124.213.2.12:12565 ESTABLISHEDtcp 0 48 localhost:mysql 124.213.2.12:12565 ESTABLISHEDudp 1 48 localhots:webcac 124.213.2.12:12565 ESTABLISHEDtcp 1 48 111.34.134.2:s1 124.213.2.12:12565 ESTABLISHEDudp 1 48 111.34.134.2:s2 124.213.2.12:12565 ESTABLISHEDudp 0 48 111.34.134.2:s3 124.213.2.12:12565 ESTABLISHED åˆ—å‡ºåˆ‡åˆ†å‡ºæ¥çš„ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—ï¼š 1awk '&#123;print $1,$2&#125;' test1.txt ç»“æžœï¼š ç­›é€‰å‡ºç¬¬ä¸€åˆ—ä¸ºtcpå’Œç¬¬äºŒåˆ—ä¸º1çš„æ‰€åœ¨è¡Œï¼Œå°†è¿™äº›è¡Œæ•°æ®å…¨éƒ¨æ‰“å°å‡ºæ¥ï¼š 1awk '$1="tcp" &amp;&amp; $2==1&#123;print $0&#125;' test1.txt ç»“æžœï¼š æ‰“å°å¸¦æœ‰è¡¨å¤´çš„æ•°æ®ï¼š 1awk '($1="tcp" &amp;&amp; $2==1) || NR==1 &#123;print $0&#125;' test1.txt é»˜è®¤æ˜¯ä»¥ç©ºæ ¼åˆ†éš”ï¼Œé‚£ä¹ˆä»¥é€—å·æˆ–è€…å…¶ä»–ç¬¦å·å¯ä»¥å—ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥ã€‚å¯¹äºŽè¿™æ ·çš„æ–‡ä»¶text2.txtï¼š 12345adas,123wqe,54412321,dddfsdaasd,1235465547,fjigj 1awk -F "," '&#123;print $2&#125;' text2.txt äº”ã€WCç»Ÿè®¡ æœ‰ä¸€ä¸ªæ–‡ä»¶test2.txtï¼Œé‡Œé¢çš„å†…å®¹æ˜¯ï¼š 123swg123eh shwfshsfswg7 121 32n dswg17328 123swg1 2h1jhwjqbsjwqbsh ddddh wg ehdedhd dhsjh å…­ã€sedå‘½ä»¤ sedæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–‡ä»¶å¤„ç†å·¥å…·ï¼Œæœ¬èº«æ˜¯ä¸€ä¸ªç®¡é“å‘½ä»¤ï¼Œä¸»è¦æ˜¯ä»¥è¡Œä¸ºå•ä½è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥å°†æ•°æ®è¡Œè¿›è¡Œæ›¿æ¢ã€åˆ é™¤ã€æ–°å¢žã€é€‰å–ç­‰ç‰¹å®šå·¥ä½œ sed [-n/e/f/r/i] â€˜commandâ€™ è¾“å…¥æ–‡æœ¬ å¸¸ç”¨é€‰é¡¹ï¼š -nâˆ¶ä½¿ç”¨å®‰é™(silent)æ¨¡å¼ã€‚åœ¨ä¸€èˆ¬ sed çš„ç”¨æ³•ä¸­ï¼Œæ‰€æœ‰æ¥è‡ª STDINçš„èµ„æ–™ä¸€èˆ¬éƒ½ä¼šè¢«åˆ—å‡ºåˆ°è¤å¹•ä¸Šã€‚ä½†å¦‚æžœåŠ ä¸Š -n å‚æ•°åŽï¼Œåˆ™åªæœ‰ç»è¿‡sed ç‰¹æ®Šå¤„ç†çš„é‚£ä¸€è¡Œ(æˆ–è€…åŠ¨ä½œ)æ‰ä¼šè¢«åˆ—å‡ºæ¥ã€‚ -eâˆ¶ç›´æŽ¥åœ¨æŒ‡ä»¤åˆ—æ¨¡å¼ä¸Šè¿›è¡Œ sed çš„åŠ¨ä½œç¼–è¾‘ï¼› -fâˆ¶ç›´æŽ¥å°† sed çš„åŠ¨ä½œå†™åœ¨ä¸€ä¸ªæ¡£æ¡ˆå†…ï¼Œ -f filename åˆ™å¯ä»¥æ‰§è¡Œ filename å†…çš„sed åŠ¨ä½œï¼› -râˆ¶sed çš„åŠ¨ä½œæ”¯æ´çš„æ˜¯å»¶ä¼¸åž‹æ­£è§„è¡¨ç¤ºæ³•çš„è¯­æ³•ã€‚(é¢„è®¾æ˜¯åŸºç¡€æ­£è§„è¡¨ç¤ºæ³•è¯­æ³•) -iâˆ¶ç›´æŽ¥ä¿®æ”¹è¯»å–çš„æ¡£æ¡ˆå†…å®¹ï¼Œè€Œä¸æ˜¯ç”±è¤å¹•è¾“å‡ºã€‚ å¸¸ç”¨å‘½ä»¤ï¼š a âˆ¶æ–°å¢žï¼Œ a çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºçŽ°(ç›®å‰çš„ä¸‹ä¸€è¡Œ)ï½ž c âˆ¶å–ä»£ï¼Œ c çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè¿™äº›å­—ä¸²å¯ä»¥å–ä»£ n1,n2 ä¹‹é—´çš„è¡Œï¼ d âˆ¶åˆ é™¤ï¼Œå› ä¸ºæ˜¯åˆ é™¤å•Šï¼Œæ‰€ä»¥ d åŽé¢é€šå¸¸ä¸æŽ¥ä»»ä½•å’šå’šï¼› i âˆ¶æ’å…¥ï¼Œ i çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºçŽ°(ç›®å‰çš„ä¸Šä¸€è¡Œ)ï¼› p âˆ¶åˆ—å°ï¼Œäº¦å³å°†æŸä¸ªé€‰æ‹©çš„èµ„æ–™å°å‡ºã€‚é€šå¸¸ p ä¼šä¸Žå‚æ•° sed -n ä¸€èµ·è¿ä½œï½ž s âˆ¶å–ä»£ï¼Œå¯ä»¥ç›´æŽ¥è¿›è¡Œå–ä»£çš„å·¥ä½œå“©ï¼é€šå¸¸è¿™ä¸ª s çš„åŠ¨ä½œå¯ä»¥æ­é…æ­£è§„è¡¨ç¤ºæ³•ï¼ä¾‹å¦‚ 1,20s/old/new/g å°±æ˜¯å•¦ï¼ è¿™é‡Œæˆ‘å°±ä¸»è¦çœ‹ä¸€ä¸‹æ‰¹é‡æ›¿æ¢è¿™ä¸ªåŠŸèƒ½ã€‚ å¦‚æžœåªæ˜¯ç»™ä¸€ä¸ªæ–‡ä»¶ä¸­çš„è‹¥å¹²å­—ç¬¦ä¸²æ‰¹é‡æ›¿æ¢ï¼Œåªéœ€è¦ï¼š 1sed -i "s/oldstring/newstring/g" filename å¦‚æžœæ˜¯å¯¹æŸä¸€è·¯å¾„ä¸‹å¾ˆå¤šçš„æ–‡ä»¶æ‰¹é‡æ›¿æ¢ï¼š 1sed -i &quot;s/oldstring/newstring/g&quot; `grep oldstring -rl path` å…¶ä¸­ï¼Œoldstringæ˜¯å¾…è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²ï¼Œnewstringæ˜¯å¾…æ›¿æ¢oldstringçš„æ–°å­—ç¬¦ä¸²ï¼Œgrepæ“ä½œä¸»è¦æ˜¯æŒ‰ç…§æ‰€ç»™çš„è·¯å¾„æŸ¥æ‰¾oldstringï¼Œpathæ˜¯æ‰€æ›¿æ¢æ–‡ä»¶çš„è·¯å¾„ï¼› -ié€‰é¡¹æ˜¯ç›´æŽ¥åœ¨æ–‡ä»¶ä¸­æ›¿æ¢ï¼Œä¸åœ¨ç»ˆç«¯è¾“å‡ºï¼› -ré€‰é¡¹æ˜¯æ‰€ç»™çš„pathä¸­çš„ç›®å½•é€’å½’æŸ¥æ‰¾ï¼› -lé€‰é¡¹æ˜¯è¾“å‡ºæ‰€æœ‰åŒ¹é…åˆ°oldstringçš„æ–‡ä»¶ï¼› è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿä¸€ä¸‹ï¼Œå°†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæ‰¹é‡ä¿®æ”¹ï¼š]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç«™ç‚¹æ–‡ç« æ±‡æ€»]]></title>
    <url>%2F2019%2F01%2F21%2F%E7%AB%99%E7%82%B9%E6%96%87%E7%AB%A0%E6%B1%87%E6%80%BB%2F</url>
    <content type="text"><![CDATA[ðŸ‘‰è¯·å…ˆç§»æ­¥è¿™é‡Œâ˜ï¸â˜ï¸â˜ï¸ðŸ”ðŸ”ðŸ”æœ¬æ–‡ä¸ºç½®é¡¶æ–‡ç« ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†å’ŒæŸ¥é˜…ï¼Œåœ¨è¿™é‡Œè¯¦ç»†å±•ç¤ºç›®å½•ç´¢å¼•ï¼Œçœ‹å®Œç´¢å¼•ï¼Œä½ å°±çŸ¥é“æœ¬ç«™çš„å¤§ä½“å†…å®¹å•¦ï¼æˆ‘ç›¸ä¿¡ä¸€å®šä¼šç»™å°ä¼™ä¼´ä»¬ä¸€äº›æ”¶èŽ·ï¼ðŸƒðŸƒðŸƒðŸƒæŒç»­æ›´æ–°ä¸­ï¼ å†æ¬¡å¼ºè°ƒï¼Œå®Œå…¨çš„javaå°ç™½æ˜¯ä¸é€‚åˆçœ‹æœ¬ç«™å†…å®¹çš„ï¼Œå› ä¸ºå¾ˆå¤šçŸ¥è¯†æ˜¯è¦é»˜è®¤å·²ç»æŽŒæ¡ï¼Œæ‰€ä»¥æ–‡ç« ä¸€èˆ¬æ˜¯æ¯”è¾ƒç²¾ç‚¼çš„ï¼Œå¹¶ä¸”javaæœ€åŸºç¡€çš„çŸ¥è¯†ä¹Ÿä¸ä¼šå‡ºçŽ°åœ¨è¿™é‡Œäº†ã€‚ è®¡ç®—æœºç½‘ç»œðŸ­ðŸ­ðŸ­ è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯å…³äºŽHTTPå’ŒTCPçš„å¿…å¤‡çŸ¥è¯†ã€‚ ã€Šè®¡ç®—æœºç½‘ç»œç›¸å…³ç³»åˆ—ã€‹ï¼š ã€Šä»Žä¸‹åˆ°ä¸Šçœ‹äº”å±‚æ¨¡åž‹ã€‹ ã€Šä»Žä¸Šåˆ°ä¸‹çœ‹äº”å±‚æ¨¡åž‹ã€‹ ã€ŠHTTPçš„å‰ä¸–ä»Šç”Ÿã€‹ ã€ŠTCPåè®®å…¥é—¨ã€‹ ã€ŠTCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ã€‹ ã€ŠHTTPåŸºç¡€çŸ¥è¯†æç‚¼ã€‹ ã€Šä¸€æ­¥ä¸€æ­¥ç†è§£HTTPSã€‹ ã€Šä¸€äº›å¸¸è§çš„é¢è¯•é¢˜ã€‹ JAVAå®¹å™¨ðŸ±ðŸ±ðŸ± è¿™ä¸€éƒ¨åˆ†æ˜¯JAVAå®¹å™¨ä¸€ç³»åˆ—æ–‡ç« ï¼Œä¸»è¦è®²äº†å¸¸ç”¨JAVAå®¹å™¨çš„æºç å’Œä¸€äº›ç‰¹æ€§ï¼Œé¢è¯•å¿…é—®ç‚¹ã€‚ ã€ŠJAVAå®¹å™¨ã€‹ï¼š ã€ŠArrayList/Vectorã€‹ ã€ŠLinkedListã€‹ ã€ŠCopyOnWriteArrayListã€‹ ã€ŠHashCode/Equalsã€‹ ã€ŠHashMapã€‹ ã€ŠHashSetã€‹ ã€ŠLinkedHashMapã€‹ ã€ŠHashMapå’ŒLinkedHashMapéåŽ†æœºåˆ¶ã€‹ ã€ŠHashTableã€‹ ã€ŠLinkedHashSetã€‹ ã€ŠJDK7ä¸­HashMapæ­»å¾ªçŽ¯åŽŸå› å‰–æžã€‹ ã€ŠConcurrentHashMapã€‹ Linux&amp;æ“ä½œç³»ç»ŸðŸ¶ðŸ¶ðŸ¶ ä¸€äº›å¿…å¤‡çš„Liunxç›¸å…³çš„çŸ¥è¯†ç‚¹æ•´ç†ã€‚ ã€ŠLinuxã€‹ï¼š ã€ŠLinuxé¢è¯•é‡è¦å‘½ä»¤ã€‹ ã€Šæ“ä½œç³»ç»Ÿç›¸å…³ã€‹ï¼š ã€Šé¢è¯•-è¿›ç¨‹ä¸Žçº¿ç¨‹ã€‹ ã€ŠSocketã€‹ï¼š ã€ŠSocketåŸºç¡€ã€‹ï¼š JAVAè™šæ‹Ÿæœºç›¸å…³ðŸ¹ðŸ¹ðŸ¹ ä¸»è¦æ˜¯ä»‹ç»JVMç›¸å…³çŸ¥è¯†ã€‚è½»æ¾åº”ä»˜é¢è¯•ã€‚ ã€ŠJVMã€‹ï¼š ã€ŠJavaå¦‚ä½•æ‰§è¡Œä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åºã€‹ ã€Šæµ…è°ˆClassLoaderã€‹ ã€ŠåŒäº²å§”æ´¾æ¨¡åž‹ã€‹ ã€Šç»†è°ˆloadClassã€‹ ã€ŠJAVAå†…å­˜æ¨¡åž‹-çº¿ç¨‹ç§æœ‰ã€‹ ã€ŠJAVAå†…å­˜æ¨¡åž‹-çº¿ç¨‹å…±äº«ã€‹ ã€ŠJAVAå†…å­˜æ¨¡åž‹å¸¸é—®é¢è¯•é¢˜ã€‹ ã€ŠGCç›¸å…³ã€‹ ã€Šåžƒåœ¾æ”¶é›†å™¨ä»‹ç»ã€‹ ã€Šå†…å­˜åˆ†é…å’Œå›žæ”¶ç­–ç•¥ã€‹ ã€Šç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‹ ã€Šé™æ€åˆ†æ´¾å’ŒåŠ¨æ€åˆ†æ´¾ã€‹ ã€Šå®žä¾‹è¯´æ˜Žç±»åŠ è½½è¿‡ç¨‹ã€‹ ä»¥ä¸‹æ˜¯æ‰©å±•é˜…è¯»éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯å¯¹Classæ–‡ä»¶çš„ç»“æž„è¿›è¡Œè¯¦ç»†çš„è§£è¯» ã€Šè¡¥å……é˜…è¯»1-Classç±»æ–‡ä»¶ç»“æž„ã€‹ ã€Šè¡¥å……é˜…è¯»2-Classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± ã€‹ ã€Šè¡¥å……é˜…è¯»3-Classæ–‡ä»¶ä¸­çš„è®¿é—®æ ‡å¿—ã€ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æŽ¥å£ç´¢å¼•é›†åˆã€‹ ã€Šè¡¥å……é˜…è¯»4-Classæ–‡ä»¶ä¸­çš„å­—æ®µè¡¨é›†åˆâ€“fieldå­—æ®µåœ¨classæ–‡ä»¶ä¸­æ˜¯æ€Žæ ·ç»„ç»‡çš„ã€‹ ã€Šè¡¥å……é˜…è¯»5-Classæ–‡ä»¶ä¸­çš„æ–¹æ³•è¡¨é›†åˆâ€“methodæ–¹æ³•åœ¨classæ–‡ä»¶ä¸­æ˜¯æ€Žæ ·ç»„ç»‡çš„ã€‹ JAVAæ ¸å¿ƒåŸºç¡€çŸ¥è¯†ðŸºðŸºðŸº ä¸»è¦æ˜¯ä»‹ç»æ¯”è¾ƒæ ¸å¿ƒçš„JAVAåŸºç¡€çŸ¥è¯†ï¼Œå±žäºŽJAVAåŸºç¡€è¿›é˜¶ã€‚ ã€ŠjavaåŸºç¡€ã€‹ï¼š ã€ŠIntegeræ‹†ç®±å’Œè£…ç®±ã€‹ ã€ŠStringä¸ºä»€ä¹ˆä¸å¯å˜ã€‹ ã€Šjavaå­—ç¬¦ä¸²æ ¸å¿ƒä¸€ç½‘æ‰“å°½ã€‹ ã€ŠJAVAåŸºç¡€æ ¸å¿ƒ-ç†è§£ç±»ã€å¯¹è±¡ã€é¢å‘å¯¹è±¡ç¼–ç¨‹ã€é¢å‘æŽ¥å£ç¼–ç¨‹ã€‹ ã€Šè¡¥ç çš„å‰ä¸–ä»Šç”Ÿã€‹ ã€Šæ•°å€¼è®¡ç®—ç²¾åº¦ä¸¢å¤±é—®é¢˜ã€‹ ã€Šå½»åº•ç†è§£javaåå°„æœºåˆ¶ã€‹ ã€ŠjavaåŸºç¡€ä¹‹å†°å·è¡¨é¢ã€‹ ã€ŠjavaåŸºç¡€ä¹‹æ³¨è§£ã€‹ ã€ŠjavaåŸºç¡€ä¹‹JDKåŠ¨æ€ä»£ç†ã€‹ ã€ŠjavaåŸºç¡€ä¹‹å¼‚å¸¸ã€‹ ã€ŠjavaåŸºç¡€ä¹‹å…‹éš†ã€‹ ã€ŠjavaåŸºç¡€ä¹‹æ³›åž‹ä¸Šã€‹ ã€ŠjavaåŸºç¡€ä¹‹æ³›åž‹ä¸‹ã€‹ ã€ŠjavaåŸºç¡€ä¹‹NIOã€‹ ã€ŠjavaåŸºç¡€ä¹‹ThreadLocalè¯¦è§£ã€‹ ã€ŠjavaåŸºç¡€ä¹‹ThreadLocalå†…å­˜æ³„æ¼é—®é¢˜ã€‹ ã€ŠjavaåŸºç¡€ä¹‹ThreadLocalè‡ªé—®è‡ªç­”ã€‹ JAVAå¤šçº¿ç¨‹ðŸ¸ðŸ¸ðŸ¸ å¤šçº¿ç¨‹è¿™ä¸€å—æ¯”è¾ƒæ£˜æ‰‹ï¼Œä¸”å­¦ä¸”ä¿é‡ã€‚ ã€ŠJAVAå¤šçº¿ç¨‹å’Œå¹¶å‘ã€‹ï¼š ã€Šçº¿ç¨‹åŸºæœ¬çŸ¥è¯†æ¢³ç†ã€‹ ã€Šjavaå¤šçº¿ç¨‹ä¹‹ä¼ å‚å’Œè¿”å›žå€¼å¤„ç†ã€‹ ã€Šçº¿ç¨‹çš„çŠ¶æ€ã€‹ ã€Šçº¿ç¨‹é‡è¦çš„ç›¸å…³æ–¹æ³•ã€‹ ã€Šä»Žå–ç¥¨ç¨‹åºåˆæ­¥çœ‹synchronizedçš„ç‰¹æ€§ã€‹ ã€Šä»Žåº•å±‚ç†è§£synchronizedã€‹ ã€Švolatileè¯¦è§£ã€‹ ã€Šä»ŽReentrantLockå¼•å‡ºAQSçš„åŽŸç†ã€‹ ã€ŠAQSå®žçŽ°çš„ä¸€äº›å¹¶å‘å·¥å…·ç±»ã€‹ ã€Šè¯»å†™é”ReentrantReadWriteLockã€‹ ã€Šä»ŽCASåˆ°AtomicåŒ…åŽŸç†ã€‹ ã€Šçº¿ç¨‹æ± åŽŸç†è¯¦è§£ã€‹ ã€ŠJUCç»„ä»¶æ‹“å±•-ForkJoinç®€ä»‹ã€‹ ã€ŠJUCç»„ä»¶æ‹“å±•-BlockingQueueã€‹ ã€Šçº¿ç¨‹é—´é€šä¿¡æ–¹å¼æ€»ç»“ã€‹ ã€Šå®žçŽ°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ã€‹ ã€ŠConditionè¯¦è§£ã€‹ ã€Šè‡ªå·±å®žçŽ°ä¸€ä¸ªç®€å•çš„webæœåŠ¡å™¨ã€‹ RedisðŸ¯ðŸ¯ðŸ¯ ç³»ç»Ÿå­¦ä¹ redisçš„ç¬”è®°æ•´ç†ã€‚ ã€ŠRedisã€‹ï¼š ã€Šåˆæ­¥è®¤è¯†Redisã€‹ ã€ŠRedisåŸºæœ¬æ•°æ®ç»“æž„å’Œæ“ä½œã€‹ ã€ŠRediså…¶ä»–çš„åŠŸèƒ½ä»‹ç»ã€‹ ã€ŠRedisä¸ºä»€ä¹ˆå¿«ã€‹ ã€ŠRedisæŒä¹…åŒ–ã€‹ ã€ŠRedisä¸»ä»Žå¤åˆ¶ã€‹ ã€ŠRedis-Sentinelå®žçŽ°é«˜å¯ç”¨è¯»å†™åˆ†ç¦»ã€‹ ã€ŠRedis-Clusterç†è®ºè¯¦è§£ã€‹ ã€ŠRedisç¼“å­˜è®¾è®¡ä¸Žä¼˜åŒ–ã€‹ ã€ŠRedisç¼“å­˜æ›´æ–°é—®é¢˜ã€‹ ã€ŠRedisäº‹åŠ¡ã€‹ ã€Šå‡ ç§ä¸»æµç¼“å­˜æ¡†æž¶ä»‹ç»ã€‹ ã€Šå…³äºŽRedisä¸€äº›é‡è¦çš„é¢è¯•ç‚¹ã€‹ MySQLæ•°æ®åº“ðŸ¨ðŸ¨ðŸ¨ ä½œä¸ºå¿…å¤‡æŠ€èƒ½ï¼Œç”¨æ³•å’ŒåŽŸç†éƒ½è¦ä¼šã€‚ ã€ŠMySQLã€‹ï¼š ã€Šmysqlæœ€åŸºç¡€çŸ¥è¯†å°ç»“ã€‹ ã€ŠSQLå¿…çŸ¥å¿…ä¼šçŸ¥è¯†ç‚¹æç‚¼ã€‹ ã€Šå¤æ‚æŸ¥è¯¢åŸºç¡€ã€‹ ã€Šå†…è¿žæŽ¥å’Œå¤–è¿žæŽ¥ã€‹ ã€Šdeleteå’Œtruncateä»¥åŠdropåŒºåˆ«ã€‹ ã€Šå¦‚ä½•è®¾è®¡ä¸€ä¸ªå…³ç³»åž‹æ•°æ®åº“ã€‹ ã€Šæ•°æ®åº“ç´¢å¼•å…¥é—¨ã€‹ ã€ŠMySQLç´¢å¼•å…¨é¢è§£è¯»ã€‹ ã€ŠMySQLè°ƒä¼˜ã€‹ ã€Šå…³äºŽç´¢å¼•å¤±æ•ˆå’Œè”åˆç´¢å¼•ã€‹ ã€Šé”æ¨¡å—ã€‹ ã€Šæ•°æ®åº“äº‹åŠ¡æ ¸å¿ƒé—®é¢˜ã€‹ ã€Šmysqlé¢è¯•é«˜é¢‘ç†è®ºçŸ¥è¯†ã€‹ ç®—æ³•ðŸ»ðŸ»ðŸ» ç®—æ³•è¿™ä¸€å—ä¹Ÿæ˜¯é¢è¯•ç—›ç‚¹å’Œéš¾ç‚¹ï¼Œå¤´å‘è¶Šæ¥è¶Šå°‘äº†å‘¢ï¼ SpringðŸ·ðŸ·ðŸ· å¤§åŽ‚å¿…é—®å•Šå•Šå•Šå•Šï¼Œæºç ç»ˆç©¶è¿˜æ˜¯è¦è¯»çš„~ Spring Cloudç›¸å…³ðŸ®ðŸ®ðŸ® è¿™ä¸€å—å°±æ¯”è¾ƒåå®žè·µäº†ã€‚åˆ†å¸ƒå¼ã€‚ã€‚ã€‚è·¯æ¼«æ¼«ã€‚ã€‚ã€‚ ðŸ˜„ã€Šä»Žå¤©æ°”é¡¹ç›®å…¥é—¨å¾®æœåŠ¡ã€‹ï¼š ã€Š1.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-ç®€å•æŽ¥å£è°ƒç”¨ã€‹ ã€Š2.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-redisæå‡æ€§èƒ½ã€‹ ã€Š3.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å¤©æ°”æ•°æ®åŒæ­¥ã€‹ ã€Š4.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å‰ç«¯æ ·å¼ã€‹ ã€Š5.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-æœåŠ¡æ‹†åˆ†å’Œä¸šåŠ¡å»ºæ¨¡ã€‹ ã€Š6.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-æ‹†åˆ†æœ¬ç³»ç»Ÿã€‹ ã€Š7.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å¾®æœåŠ¡çš„æ³¨å†Œå’Œå‘çŽ°ã€‹ ã€Š8.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-å¾®æœåŠ¡çš„æ¶ˆè´¹ã€‹ ã€Š9.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-APIç½‘å…³ã€‹ ã€Š10.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-é›†ä¸­åŒ–é…ç½®ã€‹ ã€Š11.å¤©æ°”é¢„æŠ¥ç³»ç»Ÿ-ç†”æ–­æœºåˆ¶ã€‹ ðŸ˜†ã€Šspringcloudç»„ä»¶ç³»ç»Ÿå­¦ä¹ ã€‹ï¼š ã€Š1.EurekaæœåŠ¡æ²»ç†ã€‹ ã€Š2.Ribbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‹ ã€Š3.Hystrixè¯·æ±‚ç†”æ–­æœåŠ¡é™çº§ã€‹ ã€Š4.Hystrixè¯·æ±‚åˆå¹¶ã€‹ ã€Š5.Feignå£°æ˜Žå¼æœåŠ¡è°ƒç”¨ã€‹æš‚æ—¶æ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œçœ‹ä¸Šé¢ä¸ªå°±è¡Œ ã€Š6.Zuulç½‘å…³æœåŠ¡ã€‹ ã€Š7.Configåˆ†å¸ƒå¼é…ç½®ç®¡ç†ã€‹ ã€Š8.Busæ¶ˆæ¯æ€»çº¿ã€‹ ã€Š9.Streamæ¶ˆæ¯é©±åŠ¨ã€‹ ã€Š10.SleuthæœåŠ¡è¿½è¸ªã€‹ ZookeeperðŸ—ðŸ—ðŸ— ä½œä¸ºå½“ä»Šåˆ†å¸ƒå¼åè°ƒä¸­å¿ƒï¼Œæ ¸å¿ƒçš„Paxosç®—æ³•ä½ ä¸æƒ³äº†è§£ä¸€ä¸‹å—ï¼Ÿ ã€Šzookpeeperå­¦ä¹ ç¬”è®°ã€‹ï¼š ã€ŠZookeeperç¬”è®°1-CAPå’ŒBASEç†è®ºã€‹ ã€ŠZookeeperç¬”è®°2-2PC&amp;3PCã€‹ ã€ŠZookeeperç¬”è®°3-paxosç®—æ³•ã€‹ ã€ŠZookeeperç¬”è®°4-Zookeeperä»‹ç»ã€‹ ã€ŠZookeeperç¬”è®°5-ZABåè®®ã€‹ æ‚è®°ðŸµðŸµðŸµ åœ¨è¿™ä¸ªæ¿å—ï¼Œä¸åˆ’åˆ†ç±»åˆ«ï¼Œæ–‡ç« å°½å¯èƒ½åœ°ç®€çŸ­ï¼Œä¹Ÿå¯è°“ä¹‹è®°å¿†ç¢Žç‰‡ã€‚ ã€ŠæŠ€æœ¯çŸ­æ–‡æ‚è®°ã€‹ï¼š ã€Šspringäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‹ ã€ŠRedissonå®žçŽ°Redisåˆ†å¸ƒå¼é”åŽŸç†ã€‹ ã€Šrediså®žçŽ°åˆ†å¸ƒå¼é”ã€‹ ã€ŠspringMVCå…¨å±€å¼‚å¸¸+springåŒ…æ‰«æåŒ…éš”ç¦»+springäº‹åŠ¡ä¼ æ’­ã€‹ ã€Šåˆ†å¸ƒå¼IDç”Ÿæˆç­–ç•¥ã€‹ ã€ŠSpring Sessionã€‹ ã€ŠCuratorã€‹ ã€ŠELKå¹³å°æ­å»ºã€‹ ã€Šåº“å­˜æ‰£å‡é—®é¢˜ã€‹ ã€Šåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ€è€ƒã€‹ ã€ŠSpringBootä½¿ç”¨logbackå®žçŽ°æ—¥å¿—æŒ‰å¤©æ»šåŠ¨ã€‹ ã€Šåœ°ç†ä½ç½®é™„è¿‘æŸ¥è¯¢çš„GEOHASHè§£å†³æ–¹æ¡ˆã€‹ ã€Šæ·±å…¥æŽ¢ç©¶NginxåŽŸç†ã€‹ ã€Šç®€æ˜Žç†è§£ä¸€è‡´æ€§hashç®—æ³•ã€‹ ã€ŠSpringBooté€šç”¨çŸ¥è¯†æ·±å…¥â€“åˆ‡é¢ã€å¼‚å¸¸ã€å•å…ƒæµ‹è¯•ã€‹ éšç¬”ðŸ–ðŸ–ðŸ– ã€Šéšç¬”ã€‹ï¼š ã€Š2019å¹´å±•æœ›ã€‹ å®žæˆ˜ä½œå“ðŸ°ðŸ°ðŸ° è®°å½•ä¸€äº›å®žæˆ˜ä½œå“ï¼Œä»£ç ä¸»è¦å­˜æ”¾åœ¨githubä¸Šã€‚ ã€Šæˆ‘çš„å®žæˆ˜ã€‹ï¼š ã€Šå¿«ä¹èœ—ç‰›å•†åŸŽä»£ç ã€‹ ã€Šç ç è´­åˆ†å¸ƒå¼ç”µå•†å®žæˆ˜ä»£ç ã€‹]]></content>
      <tags>
        <tag>æ±‡æ€»</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedHashSet]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F10.LinkedHashSet%2F</url>
    <content type="text"><![CDATA[HashSet å’Œ LinkedHashSet çš„å…³ç³»ç±»ä¼¼äºŽ HashMap å’Œ LinkedHashMap çš„å…³ç³»ï¼Œå³åŽè€…ç»´æŠ¤åŒå‘é“¾è¡¨ï¼Œå®žçŽ°è¿­ä»£é¡ºåºå¯ä¸ºæ’å…¥é¡ºåºæˆ–æ˜¯è®¿é—®é¡ºåºã€‚æ‰€ä»¥ä¹Ÿå°±è½»æ¾åŠ æ„‰å¿«å¿«é€Ÿäº†è§£ä¸€ä¸‹å³å¯ã€‚ ä»Žæºç ä¸­å¯ä»¥çœ‹åˆ°å…¶ç©ºçš„æž„é€ å‡½æ•°ä¸ºï¼š 123public LinkedHashSet() &#123; super(16, .75f, true);&#125; è¿™ä¸ªsuperå³çˆ¶ç±»æ˜¯HashSetï¼Œä»Žå®ƒçš„ç»§æ‰¿å…³ç³»å°±å¯ä»¥æ˜¾ç„¶çœ‹åˆ°ï¼š 123public class LinkedHashSet&lt;E&gt; extends HashSet&lt;E&gt; implements Set&lt;E&gt;, Cloneable, java.io.Serializable é‚£ä¹ˆHashSetå†…éƒ¨çš„æ•°æ®ç»“æž„å°±æ˜¯ä¸€ä¸ª HashMapï¼Œå…¶æ–¹æ³•çš„å†…éƒ¨å‡ ä¹Žå°±æ˜¯åœ¨è°ƒç”¨ HashMap çš„æ–¹æ³•ã€‚ LinkedHashSet é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯å®ƒæ˜¯ä¸€ä¸ª Set çš„å®žçŽ°ï¼Œæ‰€ä»¥å®ƒå…¶ä¸­å­˜çš„è‚¯å®šä¸æ˜¯é”®å€¼å¯¹ï¼Œè€Œæ˜¯å€¼ã€‚æ­¤å®žçŽ°ä¸Ž HashSet çš„ä¸åŒä¹‹å¤„åœ¨äºŽï¼ŒLinkedHashSet ç»´æŠ¤ç€ä¸€ä¸ªè¿è¡ŒäºŽæ‰€æœ‰æ¡ç›®çš„åŒå‘å¾ªçŽ¯é“¾è¡¨ã€‚ è¿™ä¸€åˆ‡éƒ½ä¸ŽLinkedHashMapç±»ä¼¼ã€‚ LinkedHashSet å†…éƒ¨æœ‰ä¸ªå±žæ€§ accessOrder æŽ§åˆ¶ç€éåŽ†æ¬¡åºã€‚é»˜è®¤æƒ…å†µä¸‹è¯¥å€¼ä¸º false ,å³æŒ‰æ’å…¥æŽ’åºè®¿é—®ã€‚å¦‚æžœå°†è¯¥å€¼è®¾ç½®ä¸º true çš„è¯ï¼Œåˆ™æŒ‰è®¿é—®æ¬¡åºæŽ’åº(å³æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ”¾åœ¨é“¾è¡¨å¤´éƒ¨ï¼Œæœ€è¿‘è®¿é—®çš„åˆ™åœ¨é“¾è¡¨å°¾éƒ¨)ã€‚ ä¸€ã€ ç¤ºä¾‹ HashSetçš„éåŽ†ï¼š 123456789101112public static void main(String[] args) &#123; Set&lt;String&gt; linkedHashSet = new HashSet&lt;&gt;(); linkedHashSet.add("aaa"); linkedHashSet.add("eee"); linkedHashSet.add("ccc"); linkedHashSet.add("bbb"); Iterator&lt;String&gt; it = linkedHashSet.iterator(); while(it.hasNext())&#123; System.out.println(it.next()); &#125;&#125; è¾“å‡ºç»“æžœæ˜¯ï¼š aaa ccc bbb eee LinkedHashSetçš„éåŽ†ï¼š 1234567891011121314public static void main(String[] args) &#123; Set&lt;String&gt; linkedHashSet = new LinkedHashSet&lt;&gt;(); linkedHashSet.add("aaa"); linkedHashSet.add("eee"); linkedHashSet.add("ccc"); linkedHashSet.add("bbb"); linkedHashSet.add(null); Iterator&lt;String&gt; it = linkedHashSet.iterator(); while(it.hasNext())&#123; System.out.println(it.next()); &#125; &#125; è¾“å‡ºç»“æžœæ˜¯ï¼š aaa eee ccc bbb null å¯ä»¥çœ‹åˆ°ä¸Žè¾“å…¥é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hashtable]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F9.HashTable%2F</url>
    <content type="text"><![CDATA[Hashtable æ˜¯ä¸ªè¿‡æ—¶çš„é›†åˆç±»ï¼Œä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ HashMap æ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ ConcurrentHashMap æ›¿æ¢ã€‚ä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬ä¸åŽ»äº†è§£å®ƒçš„ç†ç”±ã€‚æœ€èµ·ç  Hashtable å’Œ HashMap çš„é¢è¯•é¢˜åœ¨é¢è¯•ä¸­ç»å¸¸è¢«é—®åˆ°ã€‚ ä¸€ã€å‰è¨€ Hashtableå’ŒHashMapï¼Œä»Žå­˜å‚¨ç»“æž„å’Œå®žçŽ°æ¥è®²åŸºæœ¬ä¸Šéƒ½æ˜¯ç›¸åŒçš„ã€‚ å®ƒå’ŒHashMapçš„æœ€å¤§çš„ä¸åŒæ˜¯å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦å¤–å®ƒä¸å…è®¸keyå’Œvalueä¸ºnullã€‚ ä¸ºäº†èƒ½åœ¨å“ˆå¸Œè¡¨ä¸­æˆåŠŸåœ°ä¿å­˜å’Œå–å‡ºå¯¹è±¡ï¼Œç”¨ä½œkeyçš„å¯¹è±¡å¿…é¡»å®žçŽ°hashCodeæ–¹æ³•å’Œequalsæ–¹æ³•ã€‚ äºŒã€fail-fastæœºåˆ¶ iteratoræ–¹æ³•è¿”å›žçš„è¿­ä»£å™¨æ˜¯fail-fastçš„ã€‚å¦‚æžœåœ¨è¿­ä»£å™¨è¢«åˆ›å»ºåŽhashtableè¢«ç»“æž„åž‹åœ°ä¿®æ”¹äº†ï¼Œé™¤äº†è¿­ä»£å™¨è‡ªå·±çš„removeæ–¹æ³•ï¼Œè¿­ä»£å™¨ä¼šæŠ›å‡ºä¸€ä¸ªConcurrentModificationExceptionå¼‚å¸¸ã€‚ å› æ­¤ï¼Œé¢å¯¹åœ¨å¹¶å‘çš„ä¿®æ”¹ï¼Œè¿­ä»£å™¨å¹²è„†åˆ©è½çš„å¤±è´¥ï¼Œè€Œä¸æ˜¯å†’é™©çš„ç»§ç»­ã€‚ å…³äºŽè¿™ä¸ªçš„ç†è§£ï¼Œå…¶å®žåœ¨ä¸Šä¸€ç« è®²LinkedHashMapä¸­çš„ç¬¬å…«ç‚¹æåˆ°ï¼š å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒafterNodeAccess() å‡½æ•°ä¸­ï¼Œä¼šä¿®æ”¹modCount,å› æ­¤å½“ä½ æ­£åœ¨accessOrder=trueçš„æ¨¡å¼ä¸‹,è¿­ä»£LinkedHashMapæ—¶ï¼Œå¦‚æžœåŒæ—¶æŸ¥è¯¢è®¿é—®æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´fail-fastï¼Œå› ä¸ºè¿­ä»£çš„é¡ºåºå·²ç»æ”¹å˜ã€‚ ç®€å•è¯´ï¼Œå°±æ˜¯ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åˆ†åˆ«è¿›è¡Œä¿®æ”¹å’ŒéåŽ†æ—¶ï¼Œä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚ é¢è¯•é¢˜ï¼šé›†åˆåœ¨éåŽ†è¿‡ç¨‹ä¸­æ˜¯å¦å¯ä»¥åˆ é™¤å…ƒç´ ï¼Œä¸ºä»€ä¹ˆè¿­ä»£å™¨å°±å¯ä»¥å®‰å…¨åˆ é™¤å…ƒç´ ï¼Ÿ é›†åˆåœ¨ä½¿ç”¨ for å¾ªçŽ¯è¿­ä»£çš„è¿‡ç¨‹ä¸­ä¸å…è®¸ä½¿ç”¨ï¼Œé›†åˆæœ¬èº«çš„ remove æ–¹æ³•åˆ é™¤å…ƒç´ ï¼Œå¦‚æžœè¿›è¡Œé”™è¯¯æ“ä½œå°†ä¼šå¯¼è‡´ ConcurrentModificationException å¼‚å¸¸çš„å‘ç”Ÿ Iterator å¯ä»¥åˆ é™¤è®¿é—®çš„å½“å‰å…ƒç´ (current)ï¼Œä¸€æ—¦åˆ é™¤çš„å…ƒç´ æ˜¯Iterator å¯¹è±¡ä¸­ next æ‰€æ­£åœ¨å¼•ç”¨çš„ï¼Œåœ¨ Iterator åˆ é™¤å…ƒç´ é€šè¿‡ ä¿®æ”¹ modCount ä¸Ž expectedModCount çš„å€¼ï¼Œå¯ä»¥ä½¿ä¸‹æ¬¡åœ¨è°ƒç”¨ remove çš„æ–¹æ³•æ—¶å€™ä¸¤è€…ä»ç„¶ç›¸åŒå› æ­¤ä¸ä¼šæœ‰å¼‚å¸¸äº§ç”Ÿã€‚ è¿­ä»£å™¨çš„fail-fastæœºåˆ¶å¹¶ä¸èƒ½å¾—åˆ°ä¿è¯ï¼Œå®ƒä¸èƒ½å¤Ÿä¿è¯ä¸€å®šå‡ºçŽ°è¯¥é”™è¯¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œfail-fastä¼šå°½æœ€å¤§åŠªåŠ›æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚å› æ­¤ï¼Œä¸ºæé«˜æ­¤ç±»æ“ä½œçš„æ­£ç¡®æ€§è€Œç¼–å†™ä¸€ä¸ªä¾èµ–äºŽæ­¤å¼‚å¸¸çš„ç¨‹åºæ˜¯é”™è¯¯çš„åšæ³•ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼šConcurrentModificationException åº”è¯¥ä»…ç”¨äºŽæ£€æµ‹ bugã€‚ Hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æžœä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„å®žçŽ°æ˜¯ä¸éœ€è¦çš„ï¼ŒæŽ¨èä½¿ç”¨HashMapä»£æ›¿Hashtableã€‚å¦‚æžœéœ€è¦çº¿ç¨‹å®‰å…¨çš„å®žçŽ°ï¼ŒæŽ¨èä½¿ç”¨java.util.concurrent.ConcurrentHashMapä»£æ›¿Hashtableã€‚ äºŒã€ç»§æ‰¿å…³ç³» 123public class Hashtable&lt;K,V&gt; extends Dictionary&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, java.io.Serializable&#123;&#125; extends Dictionary&lt;K,V&gt;ï¼šDictionaryç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨æ¥å­˜å‚¨é”®/å€¼å¯¹ï¼Œä½œç”¨å’ŒMapç±»ç›¸ä¼¼ã€‚ implements Map&lt;K,V&gt;ï¼šå®žçŽ°äº†Mapï¼Œå®žçŽ°äº†Mapä¸­å£°æ˜Žçš„æ“ä½œå’Œdefaultæ–¹æ³•ã€‚ hashMapä»¥åŠTreeMapçš„æºç ï¼Œéƒ½æ²¡æœ‰ç»§æ‰¿äºŽè¿™ä¸ªç±»ã€‚ä¸è¿‡å½“æˆ‘çœ‹åˆ°æ³¨é‡Šä¸­çš„è§£é‡Šä¹Ÿå°±æ˜Žç™½äº†ï¼Œå…¶ Dictionary æºç æ³¨é‡Šæ˜¯è¿™æ ·çš„ï¼šNOTE: This class is obsolete. New implementations should implement the Map interface, rather than extending this class. è¯¥è¯æŒ‡å‡º Dictionary è¿™ä¸ªç±»è¿‡æ—¶äº†ï¼Œæ–°çš„å®žçŽ°ç±»åº”è¯¥å®žçŽ°MapæŽ¥å£ã€‚ ä¸‰ã€å±žæ€§ 1234567891011121314//å“ˆå¸Œè¡¨private transient Entry&lt;?,?&gt;[] table;//è®°å½•å“ˆå¸Œè¡¨ä¸­é”®å€¼å¯¹çš„ä¸ªæ•°private transient int count;//æ‰©å®¹çš„é˜ˆå€¼private int threshold;//è´Ÿè½½å› å­private float loadFactor;//hashtableè¢«ç»“æž„åž‹ä¿®æ”¹çš„æ¬¡æ•°ã€‚private transient int modCount = 0; HashTableå¹¶æ²¡æœ‰åƒHashMapé‚£æ ·å®šä¹‰äº†å¾ˆå¤šçš„å¸¸é‡ï¼Œè€Œæ˜¯ç›´æŽ¥å†™æ­»åœ¨äº†æ–¹æ³•é‡Œã€‚ Hashtableä¸è¦æ±‚åº•å±‚æ•°ç»„çš„å®¹é‡ä¸€å®šè¦ä¸º2çš„æ•´æ•°æ¬¡å¹‚ï¼Œè€ŒHashMapåˆ™è¦æ±‚ä¸€å®šä¸º2çš„æ•´æ•°æ¬¡å¹‚ã€‚ å››ã€æž„é€ å‡½æ•° 12345678/** * ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–å®¹é‡ï¼ˆ11ï¼‰å’Œé»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰æ¥æž„é€ ä¸€ä¸ªç©ºçš„hashtable. * * è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒHashtableé»˜è®¤åˆå§‹åŒ–å®¹é‡ä¸º16ï¼Œè€ŒHashMapçš„é»˜è®¤åˆå§‹åŒ–å®¹é‡ä¸º11ã€‚ */public Hashtable() &#123; this(11, 0.75f);&#125; æˆ‘ä»¬å¯ä»¥èŽ·å–åˆ°è¿™äº›ä¿¡æ¯ï¼šHashTableé»˜è®¤çš„åˆå§‹åŒ–å®¹é‡ä¸º11ï¼ˆä¸ŽHashMapä¸åŒï¼‰ï¼Œè´Ÿè½½å› å­é»˜è®¤ä¸º0.75ï¼ˆä¸ŽHashMapç›¸åŒï¼‰ã€‚è€Œæ­£å› ä¸ºé»˜è®¤åˆå§‹åŒ–å®¹é‡çš„ä¸åŒï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰å¯¹å®¹é‡åšè°ƒæ•´çš„ç­–ç•¥ï¼Œæ‰€ä»¥å¯ä»¥å…ˆæŽ¨æ–­å‡ºï¼ŒHashTableä½¿ç”¨çš„å“ˆå¸Œå‡½æ•°è·ŸHashMapæ˜¯ä¸ä¸€æ ·çš„ï¼ˆäº‹å®žä¹Ÿç¡®å®žå¦‚æ­¤ï¼‰ã€‚ äº”ã€é‡è¦æ–¹æ³• 5.1 getæ–¹æ³• 12345678910111213public synchronized V get(Object key) &#123; Entry&lt;?,?&gt; tab[] = table; int hash = key.hashCode(); //é€šè¿‡å“ˆå¸Œå‡½æ•°ï¼Œè®¡ç®—å‡ºkeyå¯¹åº”çš„æ¡¶çš„ä½ç½® int index = (hash &amp; 0x7FFFFFFF) % tab.length; //éåŽ†è¯¥æ¡¶çš„æ‰€æœ‰å…ƒç´ ï¼Œå¯»æ‰¾è¯¥key for (Entry&lt;?,?&gt; e = tab[index] ; e != null ; e = e.next) &#123; if ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123; return (V)e.value; &#125; &#125; return null;&#125; è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒHashtableå’ŒHashMapç¡®è®¤keyåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•çš„æ–¹æ³•ä¸åŒã€‚ Hashtableé€šè¿‡index = (hash &amp; 0x7FFFFFFF) % tab.length;æ¥ç¡®è®¤ HashMapé€šè¿‡i = (n - 1) &amp; hash;æ¥ç¡®è®¤ è·ŸHashMapç›¸æ¯”ï¼ŒHashTableçš„getæ–¹æ³•éžå¸¸ç®€å•ã€‚æˆ‘ä»¬é¦–å…ˆå¯ä»¥çœ‹è§getæ–¹æ³•ä½¿ç”¨äº†synchronizedæ¥ä¿®é¥°ï¼Œæ‰€ä»¥å®ƒèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å¹¶ä¸”å®ƒæ˜¯é€šè¿‡é“¾è¡¨çš„æ–¹å¼æ¥å¤„ç†å†²çªçš„ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹è§HashTableå¹¶æ²¡æœ‰åƒHashMapé‚£æ ·å°è£…ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œè€Œæ˜¯ç›´æŽ¥æŠŠå“ˆå¸Œå‡½æ•°å†™åœ¨äº†æ–¹æ³•ä¸­ã€‚è€Œå“ˆå¸Œå‡½æ•°ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå®ƒä»…å¯¹å“ˆå¸Œè¡¨çš„é•¿åº¦è¿›è¡Œäº†å–æ¨¡ã€‚ 5.2 putæ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public synchronized V put(K key, V value) &#123; // ç¡®è®¤valueä¸ä¸ºnull if (value == null) &#123; throw new NullPointerException(); &#125; Entry&lt;?,?&gt; tab[] = table; int hash = key.hashCode(); //æ‰¾åˆ°keyåœ¨tableä¸­çš„ç´¢å¼• int index = (hash &amp; 0x7FFFFFFF) % tab.length; @SuppressWarnings("unchecked") //èŽ·å–keyæ‰€åœ¨ç´¢å¼•çš„entry Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index]; //éåŽ†entryï¼Œåˆ¤æ–­keyæ˜¯å¦å·²ç»å­˜åœ¨ for(; entry != null ; entry = entry.next) &#123; //å¦‚æžœkeyå·²ç»å­˜åœ¨ if ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) &#123; //ä¿å­˜æ—§çš„value V old = entry.value; //æ›¿æ¢value entry.value = value; //è¿”å›žæ—§çš„value return old; &#125; &#125; //å¦‚æžœkeyåœ¨hashtableä¸æ˜¯å·²ç»å­˜åœ¨ï¼Œå°±ç›´æŽ¥å°†é”®å€¼å¯¹æ·»åŠ åˆ°tableä¸­ï¼Œè¿”å›žnull addEntry(hash, key, value, index); return null;&#125;private void addEntry(int hash, K key, V value, int index) &#123; modCount++; Entry&lt;?,?&gt; tab[] = table; //å“ˆå¸Œè¡¨çš„é”®å€¼å¯¹ä¸ªæ•°è¾¾åˆ°äº†é˜ˆå€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ if (count &gt;= threshold) &#123; // Rehash the table if the threshold is exceeded rehash(); tab = table; hash = key.hashCode(); index = (hash &amp; 0x7FFFFFFF) % tab.length; &#125; // Creates the new entry. @SuppressWarnings("unchecked") Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;) tab[index]; //æŠŠæ–°èŠ‚ç‚¹æ’å…¥æ¡¶ä¸­ï¼ˆå¤´æ’æ³•ï¼‰ tab[index] = new Entry&lt;&gt;(hash, key, value, e); count++;&#125; ä»Žä»£ç ä¸­å¯ä»¥æ€»ç»“å‡ºHashtableçš„putæ–¹æ³•çš„æ€»ä½“æ€è·¯ï¼š ç¡®è®¤valueä¸ä¸ºnullã€‚å¦‚æžœä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ æ‰¾åˆ°keyåœ¨tableä¸­çš„ç´¢å¼•ï¼ŒèŽ·å–keyæ‰€åœ¨ä½ç½®çš„entry éåŽ†entryï¼Œåˆ¤æ–­keyæ˜¯å¦å·²ç»å­˜åœ¨ å¦‚æžœkeyå·²ç»å­˜åœ¨ï¼Œæ›¿æ¢valueï¼Œè¿”å›žæ—§çš„value å¦‚æžœkeyåœ¨hashtableä¸æ˜¯å·²ç»å­˜åœ¨ï¼Œå°±ç›´æŽ¥æ·»åŠ ï¼Œå¦åˆ™ç›´æŽ¥å°†é”®å€¼å¯¹æ·»åŠ åˆ°tableä¸­ï¼Œè¿”å›žnull åœ¨æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨éåŽ†æ¡¶ä¸­å…ƒç´ æ—¶ï¼Œæ˜¯æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éåŽ†çš„ã€‚å¯ä»¥å°è¯ï¼ŒHashMapçš„æ¡¶ä¸­å¯èƒ½ä¸ºé“¾è¡¨æˆ–è€…æ ‘ã€‚ä½†Hashtableçš„æ¡¶ä¸­åªå¯èƒ½æ˜¯é“¾è¡¨ã€‚ 5.3 removeæ–¹æ³• 12345678910111213141516171819202122232425public synchronized V remove(Object key) &#123; Entry&lt;?,?&gt; tab[] = table; int hash = key.hashCode(); //è®¡ç®—keyåœ¨hashtableä¸­çš„ç´¢å¼• int index = (hash &amp; 0x7FFFFFFF) % tab.length; @SuppressWarnings("unchecked") Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)tab[index]; //éåŽ†entryï¼Œå¦‚æžœentryä¸­å­˜åœ¨keyä¸ºå‚æ•°keyçš„é”®å€¼å¯¹ï¼Œå°±åˆ é™¤é”®å€¼å¯¹ï¼Œå¹¶è¿”å›žé”®å€¼å¯¹çš„value for(Entry&lt;K,V&gt; prev = null ; e != null ; prev = e, e = e.next) &#123; if ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123; modCount++; if (prev != null) &#123; prev.next = e.next; &#125; else &#123; tab[index] = e.next; &#125; count--; V oldValue = e.value; e.value = null; return oldValue; &#125; &#125; //å¦‚æžœä¸å­˜åœ¨keyä¸ºå‚æ•°keyçš„é”®å€¼å¯¹ï¼Œè¿”å›žvalue return null;&#125; ä»Žä»£ç ä¸­å¯ä»¥æ€»ç»“å‡ºHashtableçš„removeæ–¹æ³•çš„æ€»ä½“æ€è·¯ï¼š æ‰¾åˆ°keyåœ¨tableä¸­çš„ç´¢å¼•ï¼ŒèŽ·å–keyæ‰€åœ¨ä½ç½®çš„entry éåŽ†entryï¼Œåˆ¤æ–­keyæ˜¯å¦å·²ç»å­˜åœ¨ å¦‚æžœkeyå­˜åœ¨ï¼Œåˆ é™¤keyæ˜ å°„çš„é”®å€¼å¯¹ï¼Œè¿”å›žæ—§çš„value å¦‚æžœkeyåœ¨hashtableä¸å­˜åœ¨ï¼Œè¿”å›žnull 5.4 rehashæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * å¢žåŠ hashtableçš„å®¹é‡ï¼Œä¸ºäº†æ›´æœ‰æ•ˆåœ°å­˜æ”¾å’Œæ‰¾åˆ°å®ƒçš„entryã€‚ * å½“é”®å€¼å¯¹çš„æ•°é‡è¶…è¿‡äº†ä¸´ç•Œå€¼ï¼ˆcapacity*load factorï¼‰è¿™ä¸ªæ–¹æ³•è‡ªåŠ¨è°ƒç”¨ * é•¿åº¦å˜ä¸ºåŽŸæ¥çš„2å€+1 * */@SuppressWarnings("unchecked")protected void rehash() &#123; //è®°å½•æ—§å®¹é‡ int oldCapacity = table.length; //è®°å½•æ—§æ¡¶çš„æ•°ç»„ Entry&lt;?,?&gt;[] oldMap = table; // overflow-conscious code //æ–°çš„å®¹é‡ä¸ºæ—§çš„å®¹é‡çš„2å€+1 int newCapacity = (oldCapacity &lt;&lt; 1) + 1; //å¦‚æžœæ–°çš„å®¹é‡å¤§äºŽå®¹é‡çš„æœ€å¤§å€¼MAX_ARRAY_SIZE if (newCapacity - MAX_ARRAY_SIZE &gt; 0) &#123; //å¦‚æžœæ—§å®¹é‡ä¸ºMAX_ARRAY_SIZEï¼Œå®¹é‡ä¸å˜ï¼Œä¸­æ–­æ–¹æ³•çš„æ‰§è¡Œ if (oldCapacity == MAX_ARRAY_SIZE) // Keep running with MAX_ARRAY_SIZE buckets return; //å¦‚æžœæ—§å®¹é‡ä¸ä¸ºMAX_ARRAY_SIZEï¼Œæ–°å®¹é‡å˜ä¸ºMAX_ARRAY_SIZE newCapacity = MAX_ARRAY_SIZE; &#125; //åˆ›å»ºæ–°çš„æ•°ç»„ï¼Œå®¹é‡ä¸ºæ–°å®¹é‡ Entry&lt;?,?&gt;[] newMap = new Entry&lt;?,?&gt;[newCapacity]; //ç»“æž„æ€§ä¿®æ”¹æ¬¡æ•°+1 modCount++; //è®¡ç®—æ‰©å®¹çš„ä¸´ç•Œå€¼ threshold = (int)Math.min(newCapacity * loadFactor, MAX_ARRAY_SIZE + 1); table = newMap; //å°†æ—§çš„æ•°ç»„ä¸­çš„é”®å€¼å¯¹è½¬ç§»åˆ°æ–°æ•°ç»„ä¸­ for (int i = oldCapacity ; i-- &gt; 0 ;) &#123; for (Entry&lt;K,V&gt; old = (Entry&lt;K,V&gt;)oldMap[i] ; old != null ; ) &#123; Entry&lt;K,V&gt; e = old; old = old.next; int index = (e.hash &amp; 0x7FFFFFFF) % newCapacity; e.next = (Entry&lt;K,V&gt;)newMap[index]; newMap[index] = e; &#125; &#125;&#125; çœ‹å®Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºrehashçš„æ€»ä½“æ€è·¯ä¸ºï¼š æ–°å»ºå˜é‡æ–°çš„å®¹é‡ï¼Œå€¼ä¸ºæ—§çš„å®¹é‡çš„2å€+1 å¦‚æžœæ–°çš„å®¹é‡å¤§äºŽå®¹é‡çš„æœ€å¤§å€¼MAX_ARRAY_SIZE å¦‚æžœæ—§å®¹é‡ä¸ºMAX_ARRAY_SIZEï¼Œå®¹é‡ä¸å˜ï¼Œä¸­æ–­æ–¹æ³•çš„æ‰§è¡Œ å¦‚æžœæ—§å®¹é‡ä¸ä¸ºMAX_ARRAY_SIZEï¼Œæ–°å®¹é‡å˜ä¸ºMAX_ARRAY_SIZE åˆ›å»ºæ–°çš„æ•°ç»„ï¼Œå®¹é‡ä¸ºæ–°å®¹é‡ å°†æ—§çš„æ•°ç»„ä¸­çš„é”®å€¼å¯¹è½¬ç§»åˆ°æ–°æ•°ç»„ä¸­ è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒHashMapæ‰©å®¹åŽå®¹é‡å˜ä¸ºåŽŸæ¥çš„ä¸¤å€ï¼Œè€ŒHashtableæ‰©å®¹åŽå®¹é‡å˜ä¸ºåŽŸæ¥çš„ä¸¤å€åŠ ä¸€ã€‚ HashTableçš„rehashæ–¹æ³•ç›¸å½“äºŽHashMapçš„resizeæ–¹æ³•ã€‚è·ŸHashMapé‚£ç§å·§å¦™çš„rehashæ–¹å¼ç›¸æ¯”ï¼ŒHashTableçš„rehashè¿‡ç¨‹éœ€è¦å¯¹æ¯ä¸ªé”®å€¼å¯¹éƒ½é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œè€Œæ¯”èµ·å¼‚æˆ–å’Œä¸Žæ“ä½œï¼Œå–æ¨¡æ˜¯ä¸€ä¸ªéžå¸¸è€—æ—¶çš„æ“ä½œï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯å¯¼è‡´æ•ˆçŽ‡è¾ƒä½Žçš„åŽŸå› ä¹‹ä¸€ã€‚ å…­ã€éåŽ† å¯ä»¥ä½¿ç”¨ä¸ŽHashMapä¸€æ ·çš„éåŽ†æ–¹å¼ï¼Œä½†æ˜¯ç”±äºŽåŽ†å²åŽŸå› ï¼Œå¤šäº†Enumerationçš„æ–¹å¼ã€‚ é’ˆå¯¹Enumerationï¼Œè¿™é‡Œä¸Žiteratorè¿›è¡Œå¯¹æ¯”ä¸€ä¸‹ã€‚ ç›¸åŒç‚¹ Iteratorå’ŒEnumerationéƒ½å¯ä»¥å¯¹æŸäº›å®¹å™¨è¿›è¡ŒéåŽ†ã€‚ Iteratorå’ŒEnumerationéƒ½æ˜¯æŽ¥å£ã€‚ ä¸åŒç‚¹ Iteratoræœ‰å¯¹å®¹å™¨è¿›è¡Œä¿®æ”¹çš„æ–¹æ³•ã€‚è€ŒEnumerationåªèƒ½éåŽ†ã€‚ Iteratoræ”¯æŒfail-fastï¼Œè€ŒEnumerationä¸æ”¯æŒã€‚ Iteratoræ¯”Enumerationè¦†ç›–èŒƒå›´å¹¿ï¼ŒåŸºæœ¬æ‰€æœ‰å®¹å™¨ä¸­éƒ½æœ‰Iteratorè¿­ä»£å™¨ï¼Œè€Œåªæœ‰Vectorã€Hashtableæœ‰Enumerationã€‚ Enumerationåœ¨JDK 1.0å°±å·²ç»å­˜åœ¨äº†ï¼Œè€ŒIteratoræ˜¯JDK2.0æ–°åŠ çš„æŽ¥å£ã€‚ ä¸ƒã€Hashtableä¸ŽHashMapå¯¹æ¯” HashTableçš„åº”ç”¨éžå¸¸å¹¿æ³›ï¼ŒHashMapæ˜¯æ–°æ¡†æž¶ä¸­ç”¨æ¥ä»£æ›¿HashTableçš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´å»ºè®®ä½¿ç”¨HashMapã€‚ ä¸‹é¢ç€é‡æ¯”è¾ƒä¸€ä¸‹äºŒè€…çš„åŒºåˆ«ï¼š 1.ç»§æ‰¿ä¸åŒ Hashtableæ˜¯åŸºäºŽé™ˆæ—§çš„Dictionaryç±»çš„ï¼ŒHashMapæ˜¯java1.2å¼•è¿›çš„MapæŽ¥å£çš„ä¸€ä¸ªå®žçŽ°ã€‚ 2.åŒæ­¥ Hashtable ä¸­çš„æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œä¿è¯äº†Hashtableä¸­çš„å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ HashMapä¸­çš„æ–¹æ³•åœ¨ç¼ºçœæƒ…å†µä¸‹æ˜¯éžåŒæ­¥çš„,HashMapä¸­çš„å¯¹è±¡å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„çŽ¯å¢ƒä¸‹ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨Hashtableï¼Œä½†æ˜¯è¦ä½¿ç”¨HashMapçš„è¯å°±è¦è‡ªå·±å¢žåŠ åŒæ­¥å¤„ç†äº†ã€‚ 3.æ•ˆçŽ‡ å•çº¿ç¨‹ä¸­, HashMapçš„æ•ˆçŽ‡å¤§äºŽHashtableã€‚å› ä¸ºåŒæ­¥çš„è¦æ±‚ä¼šå½±å“æ‰§è¡Œçš„æ•ˆçŽ‡ï¼Œæ‰€ä»¥å¦‚æžœä½ ä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼ŒHashMapæ˜¯Hashtableçš„è½»é‡çº§å®žçŽ°ï¼Œè¿™æ ·å¯ä»¥é¿å…ç”±äºŽåŒæ­¥å¸¦æ¥çš„ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ï¼Œä»Žè€Œæé«˜æ•ˆçŽ‡ã€‚ 4.nullå€¼ Hashtableä¸­ï¼Œkeyå’Œvalueéƒ½ä¸å…è®¸å‡ºçŽ°nullå€¼ï¼Œå¦åˆ™å‡ºçŽ°NullPointerExceptionã€‚ åœ¨HashMapä¸­ï¼Œnullå¯ä»¥ä½œä¸ºé”®ï¼Œè¿™æ ·çš„é”®åªæœ‰ä¸€ä¸ªï¼›å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ‰€å¯¹åº”çš„å€¼ä¸ºnullã€‚å½“get()æ–¹æ³•è¿”å›žnullå€¼æ—¶ï¼Œå³å¯ä»¥è¡¨ç¤º HashMapä¸­æ²¡æœ‰è¯¥é”®ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºè¯¥é”®æ‰€å¯¹åº”çš„å€¼ä¸ºnullã€‚å› æ­¤ï¼Œåœ¨HashMapä¸­ä¸èƒ½ç”±get()æ–¹æ³•æ¥åˆ¤æ–­HashMapä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé”®ï¼Œè€Œåº”è¯¥ç”¨containsKey()æ–¹æ³•æ¥åˆ¤æ–­ã€‚ 5.éåŽ†æ–¹å¼ Hashtableã€HashMapéƒ½ä½¿ç”¨äº† Iteratorã€‚è€Œç”±äºŽåŽ†å²åŽŸå› ï¼ŒHashtableå¯ä»¥ä½¿ç”¨Enumerationçš„æ–¹å¼ã€‚ 6.å®¹é‡ Hashtableå’ŒHashMapå®ƒä»¬ä¸¤ä¸ªå†…éƒ¨å®žçŽ°æ–¹å¼çš„æ•°ç»„çš„åˆå§‹å¤§å°å’Œæ‰©å®¹çš„æ–¹å¼ã€‚ HashTableä¸­hashæ•°ç»„é»˜è®¤å¤§å°æ˜¯11ï¼Œå¢žåŠ çš„æ–¹å¼æ˜¯ old*2+1ã€‚ HashMapä¸­hashæ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯16ï¼Œè€Œä¸”ä¸€å®šæ˜¯2çš„æŒ‡æ•°ã€‚ å…«ã€æ€»ç»“ æ— è®ºä»€ä¹ˆæ—¶å€™æœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®ç›¸åŒå®žä¾‹çš„å¯èƒ½æ—¶ï¼Œå°±åº”è¯¥ä½¿ç”¨Hashtableï¼Œåä¹‹ä½¿ç”¨HashMapã€‚éžçº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æž„èƒ½å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ã€‚ å¦‚æžœåœ¨å°†æ¥æœ‰ä¸€ç§å¯èƒ½â€”ä½ éœ€è¦æŒ‰é¡ºåºèŽ·å¾—é”®å€¼å¯¹çš„æ–¹æ¡ˆæ—¶ï¼ŒHashMapæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºæœ‰HashMapçš„ä¸€ä¸ªå­ç±» LinkedHashMapã€‚ æ‰€ä»¥å¦‚æžœä½ æƒ³å¯é¢„æµ‹çš„æŒ‰é¡ºåºè¿­ä»£ï¼ˆé»˜è®¤æŒ‰æ’å…¥çš„é¡ºåºï¼‰ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿ç”¨LinkedHashMapæ›¿æ¢HashMapã€‚åè§‚è¦æ˜¯ä½¿ç”¨çš„Hashtableå°±æ²¡é‚£ä¹ˆç®€å•äº†ã€‚ å¦‚æžœæœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®HashMapï¼ŒCollections.synchronizedMapï¼ˆï¼‰å¯ä»¥ä»£æ›¿ï¼Œæ€»çš„æ¥è¯´HashMapæ›´çµæ´»ï¼Œæˆ–è€…ç›´æŽ¥ç”¨å¹¶å‘å®¹å™¨ConcurrentHashMapã€‚ æ•´ç†è‡ªï¼š http://blog.csdn.net/panweiwei1994/article/details/77428710 http://blog.csdn.net/u013124587/article/details/52655042]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMapå’ŒLinkedHashMapéåŽ†æœºåˆ¶]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F8.HashMap%E5%92%8CLinkedHashMap%E9%81%8D%E5%8E%86%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[æœ¬ç¯‡å•ç‹¬è®²ä¸€ä¸‹HashMapå’ŒLinkedHashMapéåŽ†æ–¹å¼ã€‚ ä¸€ã€å¯¹HashMapå’ŒLinkedHashMapéåŽ†çš„å‡ ç§æ–¹æ³• è¿™é‡Œä»¥HashMapä¸ºä¾‹ï¼ŒLinkedHashMapä¸€æ ·çš„æ–¹å¼ã€‚ 12345Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; entryIterator = map.entrySet().iterator();while (entryIterator.hasNext()) &#123; Map.Entry&lt;String, Integer&gt; next = entryIterator.next(); System.out.println("key=" + next.getKey() + " value=" + next.getValue());&#125; 123456Iterator&lt;String&gt; iterator = map.keySet().iterator();while (iterator.hasNext())&#123; String key = iterator.next(); System.out.println("key=" + key + " value=" + map.get(key));&#125; 123map.forEach((key,value)-&gt;&#123; System.out.println("key=" + key + " value=" + value);&#125;); å¼ºçƒˆå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ EntrySet è¿›è¡ŒéåŽ†ã€‚ ç¬¬ä¸€ç§å¯ä»¥æŠŠ key value åŒæ—¶å–å‡ºï¼Œç¬¬äºŒç§è¿˜å¾—éœ€è¦é€šè¿‡ key å–ä¸€æ¬¡ valueï¼Œæ•ˆçŽ‡è¾ƒä½Ž, ç¬¬ä¸‰ç§éœ€è¦ JDK1.8 ä»¥ä¸Šï¼Œé€šè¿‡å¤–å±‚éåŽ† tableï¼Œå†…å±‚éåŽ†é“¾è¡¨æˆ–çº¢é»‘æ ‘ã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒHashMapçš„è¾“å‡ºé¡ºåºä¸Žå…ƒç´ çš„è¾“å…¥é¡ºåºæ— å…³ï¼ŒLinkedHashMapå¯ä»¥æŒ‰ç…§è¾“å…¥é¡ºåºè¾“å‡ºï¼Œä¹Ÿå¯ä»¥æ ¹æ®è¯»å–å…ƒç´ çš„é¡ºåºè¾“å‡ºã€‚è¿™ä¸€çŽ°è±¡ï¼Œå·²ç»åœ¨ä¸Šä¸€ç¯‡ä¸­å±•ç¤ºå‡ºæ¥äº†ã€‚ äºŒã€HashMapçš„éåŽ†æœºåˆ¶ HashMap æä¾›äº†ä¸¤ä¸ªéåŽ†è®¿é—®å…¶å†…éƒ¨å…ƒç´ Entry&lt;k,v&gt;çš„æŽ¥å£ï¼š Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet()-------&gt;è¿”å›žæ­¤æ˜ å°„æ‰€åŒ…å«çš„æ˜ å°„å…³ç³»çš„ Set è§†å›¾ã€‚ Set&lt;K&gt; keySet()--------&gt;è¿”å›žæ­¤æ˜ å°„ä¸­æ‰€åŒ…å«çš„é”®çš„ Set è§†å›¾ã€‚ å®žé™…ä¸Šï¼Œç¬¬äºŒä¸ªæŽ¥å£è¡¨ç¤ºçš„Keyçš„é¡ºåºï¼Œå’Œç¬¬ä¸€ä¸ªæŽ¥å£è¿”å›žçš„Entryé¡ºåºæ˜¯å¯¹åº”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šè¿™ä¸¤ç§æŽ¥å£å¯¹HashMapçš„å…ƒç´ éåŽ†çš„é¡ºåºç›¸ç›¸åŒçš„ã€‚ é‚£ä¹ˆï¼ŒHashMapéåŽ†å†…éƒ¨Entry&lt;K,V&gt; çš„é¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æžæ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œå…ˆè¦çŸ¥é“å…¶å†…éƒ¨ç»“æž„æ˜¯æ€Žæ ·çš„ã€‚ HashMapåœ¨å­˜å‚¨Entryå¯¹è±¡çš„æ—¶å€™ï¼Œæ˜¯æ ¹æ®Keyçš„hashå€¼åˆ¤å®šå­˜å‚¨åˆ°Entry[] tableæ•°ç»„çš„å“ªä¸€ä¸ªç´¢å¼•å€¼è¡¨ç¤ºçš„é“¾è¡¨ä¸Šã€‚ å¯¹HashMapéåŽ†Entryå¯¹è±¡çš„é¡ºåºå’ŒEntryå¯¹è±¡çš„å­˜å‚¨é¡ºåºä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ HashMapæ•£åˆ—å›¾ã€Hashtableæ•£åˆ—è¡¨æ˜¯æŒ‰â€œæœ‰åˆ©äºŽéšæœºæŸ¥æ‰¾çš„æ•£åˆ—(hash)çš„é¡ºåºâ€ã€‚å¹¶éžæŒ‰è¾“å…¥é¡ºåºã€‚éåŽ†æ—¶åªèƒ½å…¨éƒ¨è¾“å‡ºï¼Œè€Œæ²¡æœ‰é¡ºåºã€‚ç”šè‡³å¯ä»¥rehash()é‡æ–°æ•£åˆ—ï¼Œæ¥èŽ·å¾—æ›´åˆ©äºŽéšæœºå­˜å–çš„å†…éƒ¨é¡ºåºã€‚ æ‰€ä»¥å¯¹HashMapçš„éåŽ†ï¼Œç”±å†…éƒ¨çš„æœºåˆ¶å†³å®šçš„ï¼Œè¿™ä¸ªæœºåˆ¶æ˜¯åªè€ƒè™‘åˆ©äºŽå¿«é€Ÿå­˜å–ï¼Œä¸è€ƒè™‘è¾“å…¥ç­‰é¡ºåºã€‚ ä¸‰ã€LinkedHashMap çš„éåŽ†æœºåˆ¶ LinkedHashMap æ˜¯HashMapçš„å­ç±»ï¼Œå®ƒå¯ä»¥å®žçŽ°å¯¹å®¹å™¨å†…Entryçš„å­˜å‚¨é¡ºåºå’Œå¯¹Entryçš„éåŽ†é¡ºåºä¿æŒä¸€è‡´ã€‚ ä¸ºäº†å®žçŽ°è¿™ä¸ªåŠŸèƒ½ï¼ŒLinkedHashMapå†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªEntryç±»åž‹çš„åŒå‘é“¾è¡¨ï¼Œç”¨è¿™ä¸ªåŒå‘é“¾è¡¨è®°å½•Entryçš„å­˜å‚¨é¡ºåºã€‚å½“éœ€è¦å¯¹è¯¥Mapè¿›è¡ŒéåŽ†çš„æ—¶å€™ï¼Œå®žé™…ä¸Šæ˜¯éåŽ†çš„æ˜¯è¿™ä¸ªåŒå‘é“¾è¡¨ã€‚ LinkedHashMapå†…éƒ¨ä½¿ç”¨çš„LinkedHashMap.Entryç±»ç»§æ‰¿è‡ªMap.Entryç±»ï¼Œåœ¨å…¶åŸºç¡€ä¸Šå¢žåŠ äº†LinkedHashMap.Entryç±»åž‹çš„ä¸¤ä¸ªå­—æ®µï¼Œç”¨æ¥å¼•ç”¨è¯¥Entryåœ¨åŒå‘é“¾è¡¨ä¸­çš„å‰é¢çš„Entryå¯¹è±¡å’ŒåŽé¢çš„Entryå¯¹è±¡ã€‚ å®ƒçš„å†…éƒ¨ä¼šåœ¨Map.Entryç±»çš„åŸºç¡€ä¸Šï¼Œå¢žåŠ ä¸¤ä¸ªEntryç±»åž‹çš„å¼•ç”¨ï¼šbeforeï¼Œafterã€‚LinkedHashMapä½¿ç”¨ä¸€ä¸ªåŒå‘è¿žè¡¨ï¼Œå°†å…¶å†…éƒ¨æ‰€æœ‰çš„Entryä¸²èµ·æ¥ã€‚ 1234LinkedHashMap linkedHashMap = new LinkedHashMap(); linkedHashMap.put("name","louis"); linkedHashMap.put("age","24"); linkedHashMap.put("sex","male"); å¯¹LinkedHashMapè¿›è¡ŒéåŽ†çš„ç­–ç•¥ï¼š ä»Ž header.after æŒ‡å‘çš„Entryå¯¹è±¡å¼€å§‹ï¼Œç„¶åŽä¸€ç›´æ²¿ç€æ­¤é“¾è¡¨éåŽ†ä¸‹åŽ»ï¼Œç›´åˆ°æŸä¸ªentry.after == header ä¸ºæ­¢ï¼Œå®ŒæˆéåŽ†ã€‚ æ ¹æ®Entry&lt;K,V&gt;æ’å…¥LinkedHashMapçš„é¡ºåºè¿›è¡ŒéåŽ†çš„æ–¹å¼å«åšï¼šæŒ‰æ’å…¥é¡ºåºéåŽ†ã€‚ å¦å¤–ï¼ŒLinkedHashMapè¿˜æ”¯æŒä¸€ç§éåŽ†é¡ºåºï¼Œå«åšï¼šGetè¯»å–é¡ºåºã€‚ å¦‚æžœLinkedHashMapçš„è¿™ä¸ªGetè¯»å–éåŽ†é¡ºåºå¼€å¯ï¼Œé‚£ä¹ˆï¼Œå½“æˆ‘ä»¬åœ¨LinkedHashMapä¸Šè°ƒç”¨get(key) æ–¹æ³•æ—¶ï¼Œä¼šå¯¼è‡´å†…éƒ¨keyå¯¹åº”çš„Entryåœ¨åŒå‘é“¾è¡¨ä¸­çš„ä½ç½®ç§»åŠ¨åˆ°åŒå‘é“¾è¡¨çš„æœ€åŽã€‚ å››ã€éåŽ†æœºåˆ¶çš„æ€»ç»“ HashMapå¯¹å…ƒç´ çš„éåŽ†é¡ºåºè·ŸEntryæ’å…¥çš„é¡ºåºæ— å…³ï¼Œè€ŒLinkedHashMapå¯¹å…ƒç´ çš„éåŽ†é¡ºåºå¯ä»¥è·ŸEntry&lt;K,V&gt;æ’å…¥çš„é¡ºåºä¿æŒä¸€è‡´ï¼šä»ŽåŒå‘ã€‚ å½“LinkedHashMapå¤„äºŽGetèŽ·å–é¡ºåºéåŽ†æ¨¡å¼ä¸‹ï¼Œå½“æ‰§è¡Œget() æ“ä½œæ—¶ï¼Œä¼šå°†å¯¹åº”çš„Entry&lt;k,v&gt;ç§»åˆ°éåŽ†çš„æœ€åŽä½ç½®ã€‚ LinkedHashMapå¤„äºŽæŒ‰æ’å…¥é¡ºåºéåŽ†çš„æ¨¡å¼ä¸‹ï¼Œå¦‚æžœæ–°æ’å…¥çš„&lt;key,value&gt; å¯¹åº”çš„keyå·²ç»å­˜åœ¨ï¼Œå¯¹åº”çš„Entryåœ¨éåŽ†é¡ºåºä¸­çš„ä½ç½®å¹¶ä¸ä¼šæ”¹å˜ã€‚ é™¤äº†éåŽ†é¡ºåºå¤–ï¼Œå…¶ä»–ç‰¹æ€§HashMapå’ŒLinkedHashMapåŸºæœ¬ç›¸åŒã€‚]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedHashMap]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F7.LinkedHashMap%2F</url>
    <content type="text"><![CDATA[å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªè¦ä¸æ¶‰åŠçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œ Map åŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨ HashMap ï¼Œä¸è¿‡ HashMap æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿­ä»£ HashMap çš„é¡ºåºå¹¶ä¸æ˜¯ HashMap æ”¾ç½®çš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯æ— åºã€‚ HashMap çš„è¿™ä¸€ç¼ºç‚¹å¾€å¾€ä¼šå¸¦æ¥å›°æ‰°ï¼Œå› ä¸ºæœ‰äº›åœºæ™¯ï¼Œæˆ‘ä»¬æœŸå¾…ä¸€ä¸ªæœ‰åºçš„ Mapã€‚ ç¯‡å¹…æœ‰ç‚¹é•¿ï¼Œä½†æ˜¯åœ¨ç†è§£äº†HashMapä¹‹åŽå°±æ¯”è¾ƒç®€å•äº†ã€‚ è¿™ä¸ªæ—¶å€™ï¼ŒLinkedHashMapå°±é—ªäº®ç™»åœºäº†ï¼Œå®ƒè™½ç„¶å¢žåŠ äº†æ—¶é—´å’Œç©ºé—´ä¸Šçš„å¼€é”€ï¼Œä½†æ˜¯å¯ä»¥è§£å†³æœ‰æŽ’åºéœ€æ±‚çš„åœºæ™¯ã€‚ å®ƒçš„åº•å±‚æ˜¯ç»§æ‰¿äºŽ HashMap å®žçŽ°çš„ï¼Œç”±ä¸€ä¸ªåŒå‘å¾ªçŽ¯é“¾è¡¨æ‰€æž„æˆã€‚ LinkedHashMap çš„æŽ’åºæ–¹å¼æœ‰ä¸¤ç§ï¼š æ ¹æ®å†™å…¥é¡ºåºæŽ’åºã€‚ æ ¹æ®è®¿é—®é¡ºåºæŽ’åºã€‚ å…¶ä¸­æ ¹æ®è®¿é—®é¡ºåºæŽ’åºæ—¶ï¼Œæ¯æ¬¡ get éƒ½ä¼šå°†è®¿é—®çš„å€¼ç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾ï¼Œè¿™æ ·é‡å¤æ“ä½œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæŒ‰ç…§è®¿é—®é¡ºåºæŽ’åºçš„é“¾è¡¨ã€‚ ä¸€ã€LinkedHashMapæ•°æ®ç»“æž„ LinkedHashMapæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å’ŒåŒå‘å¾ªçŽ¯é“¾è¡¨å®žçŽ°çš„ï¼Œå®ƒé€šè¿‡ç»´æŠ¤ä¸€ä¸ªåŒå‘å¾ªçŽ¯é“¾è¡¨æ¥ä¿è¯å¯¹å“ˆå¸Œè¡¨è¿­ä»£æ—¶çš„æœ‰åºæ€§ï¼Œè€Œè¿™ä¸ªæœ‰åºæ˜¯æŒ‡é”®å€¼å¯¹æ’å…¥çš„é¡ºåºã€‚ æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒéåŽ†æ‰€æœ‰å…ƒç´ åªéœ€è¦ä»Žheaderå¼€å§‹éåŽ†å³å¯ï¼Œä¸€ç›´éåŽ†åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯headerç»“æŸã€‚ å¦å¤–ï¼Œå½“å‘å“ˆå¸Œè¡¨ä¸­é‡å¤æ’å…¥æŸä¸ªé”®çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“åˆ°åŽŸæ¥çš„æœ‰åºæ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾ä½ æ’å…¥çš„é”®çš„é¡ºåºä¸º1ã€2ã€3ã€4ï¼ŒåŽæ¥å†æ¬¡æ’å…¥2ï¼Œè¿­ä»£æ—¶çš„é¡ºåºè¿˜æ˜¯1ã€2ã€3ã€4ï¼Œè€Œä¸ä¼šå› ä¸ºåŽæ¥æ’å…¥çš„2å˜æˆ1ã€3ã€4ã€2ã€‚ï¼ˆä½†å…¶å®žæˆ‘ä»¬å¯ä»¥æ”¹å˜å®ƒçš„è§„åˆ™ï¼Œä½¿å®ƒå˜æˆ1ã€3ã€4ã€2ï¼‰ LinkedHashMapçš„å®žçŽ°ä¸»è¦åˆ†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å“ˆå¸Œè¡¨ï¼Œå¦å¤–ä¸€éƒ¨åˆ†æ˜¯é“¾è¡¨ã€‚å“ˆå¸Œè¡¨éƒ¨åˆ†ç»§æ‰¿äº†HashMapï¼Œæ‹¥æœ‰äº†HashMapé‚£ä¸€å¥—é«˜æ•ˆçš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦çœ‹çš„å°±æ˜¯LinkedHashMapä¸­é“¾è¡¨çš„éƒ¨åˆ†ï¼Œäº†è§£å®ƒæ˜¯å¦‚ä½•æ¥ç»´æŠ¤æœ‰åºæ€§çš„ã€‚ äºŒã€demoç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public static void main(String[] args) &#123; /** * HashMapæ’å…¥æ•°æ®ï¼ŒéåŽ†è¾“å‡ºæ— åº */ System.out.println("----------HashMapæ’å…¥æ•°æ®--------"); Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(); map.put("apple", "a"); map.put("watermelon", "b"); map.put("banana", "c"); map.put("peach", "d"); Iterator iter = map.entrySet().iterator(); while (iter.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter.next(); System.out.println(entry.getKey() + "=" + entry.getValue()); &#125; /** * LinkedHashMapæ’å…¥æ•°æ®ï¼ŒéåŽ†ï¼Œé»˜è®¤ä»¥æ’å…¥é¡ºåºä¸ºåº */ System.out.println("----------LinkedHashMapæ’å…¥æ•°æ®,æŒ‰ç…§æ’å…¥é¡ºåºè¿›è¡ŒæŽ’åº--------"); Map&lt;String, String&gt; linkedHashMap = new LinkedHashMap&lt;&gt;(); linkedHashMap.put("apple", "a"); linkedHashMap.put("watermelon", "b"); linkedHashMap.put("banana", "c"); linkedHashMap.put("peach", "d"); Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iterator = linkedHashMap.entrySet().iterator(); while (iterator.hasNext()) &#123; System.out.println(iterator.next()); &#125; /** * LinkedHashMapæ’å…¥æ•°æ®ï¼Œè®¾ç½®accessOrder=trueå®žçŽ°ä½¿å¾—å…¶éåŽ†é¡ºåºæŒ‰ç…§è®¿é—®çš„é¡ºåºè¾“å‡ºï¼Œè¿™é‡Œå…ˆç”¨getæ–¹æ³•æ¥æ¼”ç¤º */ System.out.println("----------LinkedHashMapæ’å…¥æ•°æ®,accessOrder=true:æŒ‰ç…§è®¿é—®é¡ºåºè¿›è¡ŒæŽ’åº--------"); Map&lt;String, String&gt; linkedHashMap2 = new LinkedHashMap&lt;String, String&gt;(16,0.75f,true); linkedHashMap2.put("apple", "aa"); linkedHashMap2.put("watermelon", "bb"); linkedHashMap2.put("banana", "cc"); linkedHashMap2.put("peach", "dd"); linkedHashMap2.get("banana");//bananaç§»åŠ¨åˆ°äº†å†…éƒ¨çš„é“¾è¡¨æœ«å°¾ linkedHashMap2.get("apple");//appleç§»åŠ¨åˆ°äº†å†…éƒ¨çš„é“¾è¡¨æœ«å°¾ Iterator iter2 = linkedHashMap2.entrySet().iterator(); while (iter2.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter2.next(); System.out.println(entry.getKey() + "=" + entry.getValue()); &#125; /** * LinkedHashMapçš„putæ–¹æ³•åœ¨accessOrder=trueçš„æƒ…å†µä¸‹ */ System.out.println("-----------"); linkedHashMap2.put("watermelon", "bb");//watermelonç§»åŠ¨åˆ°äº†å†…éƒ¨çš„é“¾è¡¨æœ«å°¾ linkedHashMap2.put("stawbarrey", "ee");//æœ«å°¾æ’å…¥æ–°å…ƒç´ stawbarrey linkedHashMap2.put(null, null);//æ’å…¥æ–°çš„èŠ‚ç‚¹ null Iterator iter3 = linkedHashMap2.entrySet().iterator(); while (iter3.hasNext()) &#123; Map.Entry entry = (Map.Entry) iter3.next(); System.out.println(entry.getKey() + "=" + entry.getValue()); &#125; &#125; è¾“å‡ºç»“æžœæ˜¯: 12345678910111213141516171819202122----------HashMapæ’å…¥æ•°æ®--------banana=capple=apeach=dwatermelon=b----------LinkedHashMapæ’å…¥æ•°æ®,æŒ‰ç…§æ’å…¥é¡ºåºè¿›è¡ŒæŽ’åº--------apple=awatermelon=bbanana=cpeach=d----------LinkedHashMapæ’å…¥æ•°æ®,æŒ‰ç…§è®¿é—®é¡ºåºè¿›è¡ŒæŽ’åº--------watermelon=bbpeach=ddbanana=cc//bananaåˆ°äº†æœ«å°¾apple=aa//appleåˆ°äº†æœ«å°¾-----------peach=ddbanana=ccapple=aawatermelon=bb//watermelonåˆ°äº†é“¾è¡¨æœ«å°¾stawbarrey=ee//æ–°æ’å…¥çš„æ”¾åœ¨æœ«å°¾null=null//æ–°æ’å…¥çš„æ”¾åœ¨æœ«å°¾ ä¸‰ã€å±žæ€§ LinkedHashMapå¯ä»¥è®¤ä¸ºæ˜¯HashMap+LinkedListï¼Œå³å®ƒæ—¢ä½¿ç”¨HashMapæ“ä½œæ•°æ®ç»“æž„ï¼Œåˆä½¿ç”¨LinkedListç»´æŠ¤æ’å…¥å…ƒç´ çš„å…ˆåŽé¡ºåº 3.1 ç»§æ‰¿å…³ç³» 123public class LinkedHashMap&lt;K,V&gt; extends HashMap&lt;K,V&gt; implements Map&lt;K,V&gt; LinkedHashMapæ˜¯HashMapçš„å­ç±»ï¼Œè‡ªç„¶LinkedHashMapä¹Ÿå°±ç»§æ‰¿äº†HashMapä¸­æ‰€æœ‰éžprivateçš„æ–¹æ³•ã€‚æ‰€ä»¥å®ƒå·²ç»ä»Ž HashMap é‚£é‡Œç»§æ‰¿äº†ä¸Žå“ˆå¸Œè¡¨ç›¸å…³çš„æ“ä½œäº†ï¼Œé‚£ä¹ˆåœ¨LinkedHashMapä¸­ï¼Œå®ƒå¯ä»¥ä¸“æ³¨äºŽé“¾è¡¨å®žçŽ°çš„é‚£éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸Žé“¾è¡¨å®žçŽ°ç›¸å…³çš„å±žæ€§å¦‚ä¸‹ã€‚ 3.2 å±žæ€§ä»‹ç» 1234567891011121314151617//LinkedHashMapçš„é“¾è¡¨èŠ‚ç‚¹ç»§æ‰¿äº†HashMapçš„èŠ‚ç‚¹ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†å‰æŒ‡é’ˆå’ŒåŽæŒ‡é’ˆï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123; Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125;&#125;//å¤´æŒ‡é’ˆtransient LinkedHashMap.Entry&lt;K,V&gt; head;//å°¾æŒ‡é’ˆtransient LinkedHashMap.Entry&lt;K,V&gt; tail;//é»˜è®¤ä¸ºfalseã€‚å½“ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºé“¾è¡¨ä¸­é”®å€¼å¯¹çš„é¡ºåºä¸Žæ¯ä¸ªé”®çš„æ’å…¥é¡ºåºä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´é‡å¤æ’å…¥é”®ï¼Œä¹Ÿä¼šæ›´æ–°é¡ºåº//ç®€å•æ¥è¯´ï¼Œä¸ºfalseæ—¶ï¼Œå°±æ˜¯ä¸Šé¢æ‰€æŒ‡çš„1ã€2ã€3ã€4çš„æƒ…å†µï¼›ä¸ºtrueæ—¶ï¼Œå°±æ˜¯1ã€3ã€4ã€2çš„æƒ…å†µfinal boolean accessOrder; äº”ã€æž„é€ æ–¹æ³• 1234public LinkedHashMap() &#123; super(); accessOrder = false;&#125; å…¶å®žå°±æ˜¯è°ƒç”¨çš„ HashMap çš„æž„é€ æ–¹æ³•: HashMap å®žçŽ°ï¼š 123456789101112131415public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); this.loadFactor = loadFactor; threshold = initialCapacity; //HashMap åªæ˜¯å®šä¹‰äº†æ”¹æ–¹æ³•ï¼Œå…·ä½“å®žçŽ°äº¤ç»™äº† LinkedHashMap init();&#125; å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ªç©ºçš„ init()ï¼Œå…·ä½“æ˜¯ç”± LinkedHashMap æ¥å®žçŽ°çš„ï¼š 12345@Overridevoid init() &#123; header = new Entry&lt;&gt;(-1, null, null, null); header.before = header.after = header;&#125; å…¶å®žä¹Ÿå°±æ˜¯å¯¹ header è¿›è¡Œäº†åˆå§‹åŒ–ã€‚ å…­ã€æ·»åŠ å…ƒç´  LinkedHashMapå¹¶æ²¡æœ‰é‡å†™ä»»ä½•putæ–¹æ³•ã€‚ä½†æ˜¯å…¶é‡å†™äº†æž„å»ºæ–°èŠ‚ç‚¹çš„newNode()æ–¹æ³•. newNode() ä¼šåœ¨HashMapçš„putVal() æ–¹æ³•é‡Œè¢«è°ƒç”¨ï¼ŒputVal() æ–¹æ³•ä¼šåœ¨æ‰¹é‡æ’å…¥æ•°æ®putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict) æˆ–è€…æ’å…¥å•ä¸ªæ•°æ®public V put(K key, V value)æ—¶è¢«è°ƒç”¨ã€‚ LinkedHashMapé‡å†™äº†newNode(),åœ¨æ¯æ¬¡æž„å»ºæ–°èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡linkNodeLast(p);å°†æ–°èŠ‚ç‚¹é“¾æŽ¥åœ¨å†…éƒ¨åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚ 12345678910111213141516171819//åœ¨æž„å»ºæ–°èŠ‚ç‚¹æ—¶ï¼Œæž„å»ºçš„æ˜¯`LinkedHashMap.Entry` ä¸å†æ˜¯`Node`.Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; e) &#123; LinkedHashMap.Entry&lt;K,V&gt; p = new LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e); linkNodeLast(p); return p;&#125;//å°†æ–°å¢žçš„èŠ‚ç‚¹ï¼Œè¿žæŽ¥åœ¨é“¾è¡¨çš„å°¾éƒ¨private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) &#123; LinkedHashMap.Entry&lt;K,V&gt; last = tail; tail = p; //é›†åˆä¹‹å‰æ˜¯ç©ºçš„ if (last == null) head = p; else &#123;//å°†æ–°èŠ‚ç‚¹è¿žæŽ¥åœ¨é“¾è¡¨çš„å°¾éƒ¨ p.before = last; last.after = p; &#125;&#125; ä»¥åŠHashMapä¸“é—¨é¢„ç•™ç»™LinkedHashMapçš„afterNodeAccess() ã€afterNodeInsertion() ã€afterNodeRemoval() æ–¹æ³•ã€‚ 1234// Callbacks to allow LinkedHashMap post-actionsvoid afterNodeAccess(Node&lt;K,V&gt; p) &#123; &#125;void afterNodeInsertion(boolean evict) &#123; &#125;void afterNodeRemoval(Node&lt;K,V&gt; p) &#123; &#125; å¦‚æžœä½ æ²¡æœ‰æ³¨æ„åˆ°æ³¨é‡Šçš„è§£é‡Šçš„è¯ï¼Œä½ å¯èƒ½ä¼šå¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆä¼šæœ‰ä¸‰ä¸ªç©ºæ–¹æ³•ï¼Œè€Œä¸”æœ‰ä¸å°‘åœ°æ–¹è¿˜è°ƒç”¨è¿‡å®ƒä»¬ã€‚å…¶å®žè¿™ä¸‰ä¸ªæ–¹æ³•è¡¨ç¤ºçš„æ˜¯åœ¨è®¿é—®ã€æ’å…¥ã€åˆ é™¤æŸä¸ªèŠ‚ç‚¹ä¹‹åŽï¼Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œå®ƒä»¬åœ¨LinkedHashMapæœ‰å„è‡ªçš„å®žçŽ°ã€‚LinkedHashMapæ­£æ˜¯é€šè¿‡é‡å†™è¿™ä¸‰ä¸ªæ–¹æ³•æ¥ä¿è¯é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤çš„æœ‰åºæ€§ã€‚ 123456789101112131415161718//å›žè°ƒå‡½æ•°ï¼Œæ–°èŠ‚ç‚¹æ’å…¥ä¹‹åŽå›žè°ƒ,åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ é™¤æœ€è€æ’å…¥çš„èŠ‚ç‚¹ã€‚//å¦‚æžœå®žçŽ°LruCacheä¼šç”¨åˆ°è¿™ä¸ªæ–¹æ³•ã€‚void afterNodeInsertion(boolean evict) &#123; // possibly remove eldest LinkedHashMap.Entry&lt;K,V&gt; first; //LinkedHashMap é»˜è®¤è¿”å›žfalse åˆ™ä¸åˆ é™¤èŠ‚ç‚¹ if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) &#123; K key = first.key; removeNode(hash(key), key, null, false, true); &#125;&#125;//LinkedHashMap é»˜è®¤è¿”å›žfalse åˆ™ä¸åˆ é™¤èŠ‚ç‚¹ã€‚ //è¿”å›žtrue ä»£è¡¨è¦åˆ é™¤æœ€æ—©çš„èŠ‚ç‚¹ã€‚//é€šå¸¸æž„å»ºä¸€ä¸ªLruCacheä¼šåœ¨è¾¾åˆ°Cacheçš„ä¸Šé™æ˜¯è¿”å›žtrueprotected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false;&#125; void afterNodeInsertion(boolean evict)ä»¥åŠboolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) æ˜¯æž„å»ºLruCacheéœ€è¦çš„å›žè°ƒï¼Œåœ¨è¿™å¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚ ä¸ƒã€åˆ é™¤å…ƒç´  LinkedHashMapä¹Ÿæ²¡æœ‰é‡å†™remove() æ–¹æ³•ï¼Œå› ä¸ºå®ƒçš„åˆ é™¤é€»è¾‘å’ŒHashMapå¹¶æ— åŒºåˆ«ã€‚ ä½†å®ƒé‡å†™äº†afterNodeRemoval() è¿™ä¸ªå›žè°ƒæ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šåœ¨Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) æ–¹æ³•ä¸­å›žè°ƒï¼ŒremoveNode() ä¼šåœ¨æ‰€æœ‰æ¶‰åŠåˆ°åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œä¸Šæ–‡åˆ†æžè¿‡ï¼Œæ˜¯åˆ é™¤èŠ‚ç‚¹æ“ä½œçš„çœŸæ­£æ‰§è¡Œè€…ã€‚ 1234567891011121314151617//åœ¨åˆ é™¤èŠ‚ç‚¹eæ—¶ï¼ŒåŒæ­¥å°†eä»ŽåŒå‘é“¾è¡¨ä¸Šåˆ é™¤void afterNodeRemoval(Node&lt;K,V&gt; e) &#123; // unlink LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; //å¾…åˆ é™¤èŠ‚ç‚¹ p çš„å‰ç½®åŽç½®èŠ‚ç‚¹éƒ½ç½®ç©º p.before = p.after = null; //å¦‚æžœå‰ç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™çŽ°åœ¨çš„å¤´ç»“ç‚¹åº”è¯¥æ˜¯åŽç½®èŠ‚ç‚¹a if (b == null) head = a; else//å¦åˆ™å°†å‰ç½®èŠ‚ç‚¹bçš„åŽç½®èŠ‚ç‚¹æŒ‡å‘a b.after = a; //åŒç†å¦‚æžœåŽç½®èŠ‚ç‚¹æ—¶null ï¼Œåˆ™å°¾èŠ‚ç‚¹åº”æ˜¯b if (a == null) tail = b; else//å¦åˆ™æ›´æ–°åŽç½®èŠ‚ç‚¹açš„å‰ç½®èŠ‚ç‚¹ä¸ºb a.before = b;&#125; å…«ã€æŸ¥è¯¢å…ƒç´  LinkedHashMapé‡å†™äº†get()å’ŒgetOrDefault() æ–¹æ³•ï¼š 12345678910111213141516public V get(Object key) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return null; if (accessOrder) afterNodeAccess(e); return e.value;&#125;public V getOrDefault(Object key, V defaultValue) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return defaultValue; if (accessOrder) afterNodeAccess(e); return e.value;&#125; å¯¹æ¯”HashMapä¸­çš„å®žçŽ°,LinkedHashMapåªæ˜¯å¢žåŠ äº†åœ¨æˆå‘˜å˜é‡(æž„é€ å‡½æ•°æ—¶èµ‹å€¼)accessOrderä¸ºtrueçš„æƒ…å†µä¸‹ï¼Œè¦åŽ»å›žè°ƒvoid afterNodeAccess(Node&lt;K,V&gt; e) å‡½æ•°ã€‚ 1234public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125; åœ¨afterNodeAccess() å‡½æ•°ä¸­ï¼Œä¼šå°†å½“å‰è¢«è®¿é—®åˆ°çš„èŠ‚ç‚¹eï¼Œç§»åŠ¨è‡³å†…éƒ¨çš„åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚ 12345678910111213141516171819202122232425262728293031void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last LinkedHashMap.Entry&lt;K,V&gt; last;//åŽŸå°¾èŠ‚ç‚¹ //å¦‚æžœaccessOrder æ˜¯true ï¼Œä¸”åŽŸå°¾èŠ‚ç‚¹ä¸ç­‰äºŽe if (accessOrder &amp;&amp; (last = tail) != e) &#123; //èŠ‚ç‚¹eå¼ºè½¬æˆåŒå‘é“¾è¡¨èŠ‚ç‚¹p LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; //pçŽ°åœ¨æ˜¯å°¾èŠ‚ç‚¹ï¼Œ åŽç½®èŠ‚ç‚¹ä¸€å®šæ˜¯null p.after = null; //å¦‚æžœpçš„å‰ç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™pä»¥å‰æ˜¯å¤´ç»“ç‚¹ï¼Œæ‰€ä»¥æ›´æ–°çŽ°åœ¨çš„å¤´ç»“ç‚¹æ˜¯pçš„åŽç½®èŠ‚ç‚¹a if (b == null) head = a; else//å¦åˆ™æ›´æ–°pçš„å‰ç›´æŽ¥ç‚¹bçš„åŽç½®èŠ‚ç‚¹ä¸º a b.after = a; //å¦‚æžœpçš„åŽç½®èŠ‚ç‚¹ä¸æ˜¯nullï¼Œåˆ™æ›´æ–°åŽç½®èŠ‚ç‚¹açš„å‰ç½®èŠ‚ç‚¹ä¸ºb if (a != null) a.before = b; else//å¦‚æžœåŽŸæœ¬pçš„åŽç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™på°±æ˜¯å°¾èŠ‚ç‚¹ã€‚ æ­¤æ—¶ æ›´æ–°lastçš„å¼•ç”¨ä¸º pçš„å‰ç½®èŠ‚ç‚¹b last = b; if (last == null) //åŽŸæœ¬å°¾èŠ‚ç‚¹æ˜¯null åˆ™ï¼Œé“¾è¡¨ä¸­å°±ä¸€ä¸ªèŠ‚ç‚¹ head = p; else &#123;//å¦åˆ™ æ›´æ–° å½“å‰èŠ‚ç‚¹pçš„å‰ç½®èŠ‚ç‚¹ä¸º åŽŸå°¾èŠ‚ç‚¹lastï¼Œ lastçš„åŽç½®èŠ‚ç‚¹æ˜¯p p.before = last; last.after = p; &#125; //å°¾èŠ‚ç‚¹çš„å¼•ç”¨èµ‹å€¼æˆp tail = p; //ä¿®æ”¹modCountã€‚ ++modCount; &#125;&#125; å›¾ç¤º(æ³¨æ„è¿™ä¸ªå›¾ï¼Œ1å’Œ6ä¹Ÿåº”è¯¥æ˜¯è¿žåœ¨ä¸€èµ·çš„ï¼Œå› ä¸ºæ˜¯åŒå‘å¾ªçŽ¯é“¾è¡¨ï¼Œæ‰€ä»¥è§†ä¸ºä¸€ä¸ªå°é”™è¯¯)ï¼š è¯´æ˜Žï¼šä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç»“ç‚¹3é“¾æŽ¥åˆ°äº†å°¾ç»“ç‚¹åŽé¢ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒafterNodeAccess() å‡½æ•°ä¸­ï¼Œä¼šä¿®æ”¹modCount,å› æ­¤å½“ä½ æ­£åœ¨accessOrder=trueçš„æ¨¡å¼ä¸‹,è¿­ä»£LinkedHashMapæ—¶ï¼Œå¦‚æžœåŒæ—¶æŸ¥è¯¢è®¿é—®æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´fail-fastï¼Œå› ä¸ºè¿­ä»£çš„é¡ºåºå·²ç»æ”¹å˜ã€‚ ä¹ã€åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ å®ƒé‡å†™äº†è¯¥æ–¹æ³•ï¼Œç›¸æ¯”HashMapçš„å®žçŽ°ï¼Œæ›´ä¸ºé«˜æ•ˆã€‚ 123456789public boolean containsValue(Object value) &#123; //éåŽ†ä¸€éé“¾è¡¨ï¼ŒåŽ»æ¯”è¾ƒæœ‰æ²¡æœ‰valueç›¸ç­‰çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›ž for (LinkedHashMap.Entry&lt;K,V&gt; e = head; e != null; e = e.after) &#123; V v = e.value; if (v == value || (value != null &amp;&amp; value.equals(v))) return true; &#125; return false;&#125; å¯¹æ¯”HashMapï¼Œæ˜¯ç”¨ä¸¤ä¸ªforå¾ªçŽ¯éåŽ†ï¼Œç›¸å¯¹ä½Žæ•ˆã€‚ 12345678910111213public boolean containsValue(Object value) &#123; Node&lt;K,V&gt;[] tab; V v; if ((tab = table) != null &amp;&amp; size &gt; 0) &#123; for (int i = 0; i &lt; tab.length; ++i) &#123; for (Node&lt;K,V&gt; e = tab[i]; e != null; e = e.next) &#123; if ((v = e.value) == value || (value != null &amp;&amp; value.equals(v))) return true; &#125; &#125; &#125; return false;&#125; åã€æ›¿æ¢æŸä¸ªå…ƒç´  1234567891011121314// ç”¨dstæ›¿æ¢srcprivate void transferLinks(LinkedHashMap.Entry&lt;K,V&gt; src, LinkedHashMap.Entry&lt;K,V&gt; dst) &#123; LinkedHashMap.Entry&lt;K,V&gt; b = dst.before = src.before; LinkedHashMap.Entry&lt;K,V&gt; a = dst.after = src.after; if (b == null) head = dst; else b.after = dst; if (a == null) tail = dst; else a.before = dst;&#125; åäºŒã€æ€»ç»“ LinkedHashMapç›¸å¯¹äºŽHashMapçš„æºç æ¯”ï¼Œæ˜¯å¾ˆç®€å•çš„ã€‚å› ä¸ºå¤§æ ‘åº•ä¸‹å¥½ä¹˜å‡‰ã€‚å®ƒç»§æ‰¿äº†HashMapï¼Œä»…é‡å†™äº†å‡ ä¸ªæ–¹æ³•ï¼Œä»¥æ”¹å˜å®ƒè¿­ä»£éåŽ†æ—¶çš„é¡ºåºã€‚è¿™ä¹Ÿæ˜¯å…¶ä¸ŽHashMapç›¸æ¯”æœ€å¤§çš„ä¸åŒã€‚ åœ¨æ¯æ¬¡æ’å…¥æ•°æ®ï¼Œæˆ–è€…è®¿é—®ã€ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¼šå¢žåŠ èŠ‚ç‚¹ã€æˆ–è°ƒæ•´é“¾è¡¨çš„èŠ‚ç‚¹é¡ºåºã€‚ä»¥å†³å®šè¿­ä»£æ—¶è¾“å‡ºçš„é¡ºåºã€‚ accessOrderé»˜è®¤æ˜¯falseï¼Œåˆ™è¿­ä»£æ—¶è¾“å‡ºçš„é¡ºåºæ˜¯æ’å…¥èŠ‚ç‚¹çš„é¡ºåºã€‚è‹¥ä¸ºtrueï¼Œåˆ™è¾“å‡ºçš„é¡ºåºæ˜¯æŒ‰ç…§è®¿é—®èŠ‚ç‚¹çš„é¡ºåºã€‚ä¸ºtrueæ—¶ï¼Œå¯ä»¥åœ¨è¿™åŸºç¡€ä¹‹ä¸Šæž„å»ºä¸€ä¸ªLruCache. LinkedHashMapå¹¶æ²¡æœ‰é‡å†™ä»»ä½•putæ–¹æ³•ã€‚ä½†æ˜¯å…¶é‡å†™äº†æž„å»ºæ–°èŠ‚ç‚¹çš„newNode()æ–¹æ³•.åœ¨æ¯æ¬¡æž„å»ºæ–°èŠ‚ç‚¹æ—¶ï¼Œå°†æ–°èŠ‚ç‚¹é“¾æŽ¥åœ¨å†…éƒ¨åŒå‘é“¾è¡¨çš„å°¾éƒ¨ accessOrder=trueçš„æ¨¡å¼ä¸‹,åœ¨afterNodeAccess()å‡½æ•°ä¸­ï¼Œä¼šå°†å½“å‰è¢«è®¿é—®åˆ°çš„èŠ‚ç‚¹eï¼Œç§»åŠ¨è‡³å†…éƒ¨çš„åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒafterNodeAccess()å‡½æ•°ä¸­ï¼Œä¼šä¿®æ”¹modCount,å› æ­¤å½“ä½ æ­£åœ¨accessOrder=trueçš„æ¨¡å¼ä¸‹,è¿­ä»£LinkedHashMapæ—¶ï¼Œå¦‚æžœåŒæ—¶æŸ¥è¯¢è®¿é—®æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´fail-fastï¼Œå› ä¸ºè¿­ä»£çš„é¡ºåºå·²ç»æ”¹å˜ã€‚ nextNode() å°±æ˜¯è¿­ä»£å™¨é‡Œçš„next()æ–¹æ³• ã€‚è¯¥æ–¹æ³•çš„å®žçŽ°å¯ä»¥çœ‹å‡ºï¼Œè¿­ä»£LinkedHashMapï¼Œå°±æ˜¯ä»Žå†…éƒ¨ç»´æŠ¤çš„åŒé“¾è¡¨çš„è¡¨å¤´å¼€å§‹å¾ªçŽ¯è¾“å‡ºã€‚ è€ŒåŒé“¾è¡¨èŠ‚ç‚¹çš„é¡ºåºåœ¨LinkedHashMapçš„å¢žã€åˆ ã€æ”¹ã€æŸ¥æ—¶éƒ½ä¼šæ›´æ–°ã€‚ä»¥æ»¡è¶³æŒ‰ç…§æ’å…¥é¡ºåºè¾“å‡ºï¼Œè¿˜æ˜¯è®¿é—®é¡ºåºè¾“å‡ºã€‚ å®ƒä¸ŽHashMapæ¯”ï¼Œè¿˜æœ‰ä¸€ä¸ªå°å°çš„ä¼˜åŒ–ï¼Œé‡å†™äº†containsValue()æ–¹æ³•ï¼Œç›´æŽ¥éåŽ†å†…éƒ¨é“¾è¡¨åŽ»æ¯”å¯¹valueå€¼æ˜¯å¦ç›¸ç­‰ã€‚ æ•´ç†è‡ªï¼š http://blog.csdn.net/zxt0601/article/details/77429150 http://wiki.jikexueyuan.com/project/java-collection/linkedhashmap.html http://blog.csdn.net/u013124587/article/details/52659741 http://www.cnblogs.com/leesf456/p/5248868.html]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashSet]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F6.HashSet%2F</url>
    <content type="text"><![CDATA[HashSet æ˜¯ä¸€ä¸ªä¸å…è®¸å­˜å‚¨é‡å¤å…ƒç´ çš„é›†åˆï¼Œå®ƒæ˜¯åŸºäºŽ HashMap å®žçŽ°çš„ï¼Œ HashSet åº•å±‚ä½¿ç”¨ HashMap æ¥ä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œå› æ­¤ HashSet çš„å®žçŽ°æ¯”è¾ƒç®€å•ï¼Œç›¸å…³ HashSet çš„æ“ä½œï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç›´æŽ¥è°ƒç”¨åº•å±‚ HashMap çš„ç›¸å…³æ–¹æ³•æ¥å®Œæˆã€‚æ‰€ä»¥åªè¦ç†è§£äº† HashMapï¼ŒHashSet å°±æ°´åˆ°æ¸ æˆäº†ã€‚ æˆå‘˜å˜é‡ é¦–å…ˆäº†è§£ä¸‹HashSetçš„æˆå‘˜å˜é‡: 1234private transient HashMap&lt;E,Object&gt; map;// Dummy value to associate with an Object in the backing Mapprivate static final Object PRESENT = new Object(); å‘çŽ°ä¸»è¦å°±ä¸¤ä¸ªå˜é‡: map ï¼šç”¨äºŽå­˜æ”¾æœ€ç»ˆæ•°æ®çš„ã€‚ PRESENT ï¼šæ˜¯æ‰€æœ‰å†™å…¥mapçš„valueå€¼ã€‚ æž„é€ æ–¹æ³• 1234567public HashSet() &#123; map = new HashMap&lt;&gt;();&#125;public HashSet(int initialCapacity, float loadFactor) &#123; map = new HashMap&lt;&gt;(initialCapacity, loadFactor);&#125; æž„é€ å‡½æ•°å¾ˆç®€å•ï¼Œåˆ©ç”¨äº†HashMapåˆå§‹åŒ–äº†mapã€‚ add 123public boolean add(E e) &#123; return map.put(e, PRESENT)==null;&#125; æ¯”è¾ƒå…³é”®çš„å°±æ˜¯è¿™ä¸ª add() æ–¹æ³•ã€‚ å¯ä»¥çœ‹å‡ºå®ƒæ˜¯å°†å­˜æ”¾çš„å¯¹è±¡å½“åšäº† HashMap çš„å¥ï¼Œvalue éƒ½æ˜¯ç›¸åŒçš„ PRESENT ã€‚ç”±äºŽ HashMap çš„ key æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œæ‰€ä»¥æ¯å½“æœ‰é‡å¤çš„å€¼å†™å…¥åˆ° HashSet æ—¶ï¼Œvalue ä¼šè¢«è¦†ç›–ï¼Œä½† key ä¸ä¼šå—åˆ°å½±å“ï¼Œè¿™æ ·å°±ä¿è¯äº† HashSet ä¸­åªèƒ½å­˜æ”¾ä¸é‡å¤çš„å…ƒç´ ã€‚ è¯¥æ–¹æ³•å¦‚æžœæ·»åŠ çš„æ˜¯åœ¨ HashSet ä¸­ä¸å­˜åœ¨çš„ï¼Œåˆ™è¿”å›ž trueï¼›å¦‚æžœæ·»åŠ çš„å…ƒç´ å·²ç»å­˜åœ¨ï¼Œè¿”å›ž falseã€‚å…¶åŽŸå› åœ¨äºŽæˆ‘ä»¬ä¹‹å‰æåˆ°çš„å…³äºŽ HashMap çš„ put æ–¹æ³•ã€‚è¯¥æ–¹æ³•åœ¨æ·»åŠ  key ä¸é‡å¤çš„é”®å€¼å¯¹çš„æ—¶å€™ï¼Œä¼šè¿”å›ž nullã€‚ æ€»ç»“ HashSet çš„åŽŸç†æ¯”è¾ƒç®€å•ï¼Œå‡ ä¹Žå…¨éƒ¨å€ŸåŠ©äºŽ HashMap æ¥å®žçŽ°çš„ã€‚ æ‰€ä»¥ HashMap ä¼šå‡ºçŽ°çš„é—®é¢˜ HashSet ä¾ç„¶ä¸èƒ½é¿å…ã€‚ å¯¹äºŽ HashSet ä¸­ä¿å­˜çš„å¯¹è±¡ï¼Œè¯·æ³¨æ„æ­£ç¡®é‡å†™å…¶ equals å’Œ hashCode æ–¹æ³•ï¼Œä»¥ä¿è¯æ”¾å…¥çš„å¯¹è±¡çš„å”¯ä¸€æ€§ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HashMap]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F5.HashMap%2F</url>
    <content type="text"><![CDATA[HashMapåŸºæœ¬æ˜¯é¢è¯•å¿…é—®çš„ç‚¹ï¼Œå› ä¸ºè¿™ä¸ªæ•°æ®ç»“æž„ç”¨çš„å¤ªé¢‘ç¹äº†ï¼Œjdk1.8ä¸­çš„ä¼˜åŒ–ä¹Ÿæ˜¯æ¯”è¾ƒå·§å¦™ã€‚æœ‰å¿…è¦åŽ»æ·±å…¥æŽ¢è®¨ä¸€ä¸‹ã€‚ä½†æ˜¯æ¶‰åŠçš„å†…å®¹æ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªå…ˆæŽ¢è®¨jdk8ä¸­HashMapçš„å®žçŽ°ï¼Œè‡³äºŽjdk7ä¸­HashMapçš„æ­»å¾ªçŽ¯é—®é¢˜ã€çº¢é»‘æ ‘çš„åŽŸç†ç­‰éƒ½ä¸ä¼šåœ¨æœ¬ç¯‡æ–‡ç« æ‰©å±•åˆ°ã€‚å…¶ä»–çš„æ–‡ç« å°†ä¼šå†åŽ»æŽ¢è®¨æ•´ç†ã€‚ æœ¬ç¯‡æ–‡ç« è¾ƒé•¿ï¼Œé«˜èƒ½é¢„è­¦ã€‚ ä¸€ã€å‰è¨€ ä¹‹å‰çš„Listï¼Œè®²äº†ArrayListã€LinkedListï¼Œæœ€åŽè®²åˆ°äº†CopyOnWriteArrayListï¼Œå°±å‰ä¸¤è€…è€Œè¨€ï¼Œåæ˜ çš„æ˜¯ä¸¤ç§æ€æƒ³ï¼š ï¼ˆ1ï¼‰ArrayListä»¥æ•°ç»„å½¢å¼å®žçŽ°ï¼Œé¡ºåºæ’å…¥ã€æŸ¥æ‰¾å¿«ï¼Œæ’å…¥ã€åˆ é™¤è¾ƒæ…¢ ï¼ˆ2ï¼‰LinkedListä»¥é“¾è¡¨å½¢å¼å®žçŽ°ï¼Œé¡ºåºæ’å…¥ã€æŸ¥æ‰¾è¾ƒæ…¢ï¼Œæ’å…¥ã€åˆ é™¤æ–¹ä¾¿ é‚£ä¹ˆæ˜¯å¦æœ‰ä¸€ç§æ•°æ®ç»“æž„èƒ½å¤Ÿç»“åˆä¸Šé¢ä¸¤ç§çš„ä¼˜ç‚¹å‘¢ï¼Ÿæœ‰ï¼Œç­”æ¡ˆå°±æ˜¯HashMapã€‚ HashMapæ˜¯ä¸€ç§éžå¸¸å¸¸è§ã€æ–¹ä¾¿å’Œæœ‰ç”¨çš„é›†åˆï¼Œæ˜¯ä¸€ç§é”®å€¼å¯¹ï¼ˆK-Vï¼‰å½¢å¼çš„å­˜å‚¨ç»“æž„ï¼Œåœ¨æœ‰äº†HashCodeçš„åŸºç¡€åŽï¼Œä¸‹é¢å°†è¿˜æ˜¯ç”¨å›¾ç¤ºçš„æ–¹å¼è§£è¯»HashMapçš„å®žçŽ°åŽŸç†ã€‚ Javaä¸ºæ•°æ®ç»“æž„ä¸­çš„æ˜ å°„å®šä¹‰äº†ä¸€ä¸ªæŽ¥å£java.util.Mapï¼Œæ­¤æŽ¥å£ä¸»è¦æœ‰å››ä¸ªå¸¸ç”¨çš„å®žçŽ°ç±»ï¼Œåˆ†åˆ«æ˜¯HashMapã€Hashtableã€LinkedHashMapå’ŒTreeMapï¼Œç±»ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š (1) HashMapï¼šå®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æŽ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éåŽ†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚HashMapéžçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æžœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚ (2) Hashtableï¼šHashtableæ˜¯é—ç•™ç±»ï¼Œå¾ˆå¤šæ˜ å°„çš„å¸¸ç”¨åŠŸèƒ½ä¸ŽHashMapç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ‰¿è‡ªDictionaryç±»ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»»ä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™Hashtableï¼Œå¹¶å‘æ€§ä¸å¦‚ConcurrentHashMapï¼Œå› ä¸ºConcurrentHashMapå¼•å…¥äº†åˆ†æ®µé”ã€‚Hashtableä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨HashMapæ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ConcurrentHashMapæ›¿æ¢ã€‚ (3) LinkedHashMapï¼šLinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ç”¨IteratoréåŽ†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æž„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæŽ’åºã€‚ (4) TreeMapï¼šTreeMapå®žçŽ°SortedMapæŽ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æŽ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæŽ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæŽ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨IteratoréåŽ†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æŽ’è¿‡åºçš„ã€‚å¦‚æžœä½¿ç”¨æŽ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®žçŽ°ComparableæŽ¥å£æˆ–è€…åœ¨æž„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»åž‹çš„å¼‚å¸¸ã€‚ å¯¹äºŽä¸Šè¿°å››ç§Mapç±»åž‹çš„ç±»ï¼Œè¦æ±‚æ˜ å°„ä¸­çš„keyæ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡æ˜¯è¯¥å¯¹è±¡åœ¨åˆ›å»ºåŽå®ƒçš„å“ˆå¸Œå€¼ä¸ä¼šè¢«æ”¹å˜ã€‚å¦‚æžœå¯¹è±¡çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–ï¼ŒMapå¯¹è±¡å¾ˆå¯èƒ½å°±å®šä½ä¸åˆ°æ˜ å°„çš„ä½ç½®äº†ã€‚ äºŒã€HashMapçš„ç»“æž„ å…¶ä¸­å“ˆå¸Œè¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬ç»å¸¸æŠŠæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ç§°ä¸ºä¸€ä¸ªæ¡¶ï¼Œå“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”¨æ¥å­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹ã€‚ åœ¨æ’å…¥å…ƒç´ æ—¶ï¼Œå¦‚æžœå‘ç”Ÿå†²çªï¼ˆå³å¤šä¸ªé”®å€¼å¯¹æ˜ å°„åˆ°åŒä¸€ä¸ªæ¡¶ä¸Šï¼‰çš„è¯ï¼Œå°±ä¼šé€šè¿‡é“¾è¡¨çš„å½¢å¼æ¥è§£å†³å†²çªã€‚ å› ä¸ºä¸€ä¸ªæ¡¶ä¸Šå¯èƒ½å­˜åœ¨å¤šä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥åœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œä¼šå…ˆé€šè¿‡keyçš„å“ˆå¸Œå€¼å…ˆå®šä½åˆ°æ¡¶ï¼Œå†éåŽ†æ¡¶ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œæ‰¾å‡ºkeyç›¸ç­‰çš„é”®å€¼å¯¹ï¼Œä»Žè€Œæ¥èŽ·å–valueã€‚ å¦‚å›¾æ‰€ç¤ºï¼ŒHashMap åº•å±‚æ˜¯åŸºäºŽæ•°ç»„å’Œé“¾è¡¨å®žçŽ°çš„ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼š å®¹é‡ è´Ÿè½½å› å­ å®¹é‡çš„é»˜è®¤å¤§å°æ˜¯ 16ï¼Œè´Ÿè½½å› å­æ˜¯ 0.75ï¼Œå½“ HashMap çš„ size &gt; 16*0.75 æ—¶å°±ä¼šå‘ç”Ÿæ‰©å®¹(å®¹é‡å’Œè´Ÿè½½å› å­éƒ½å¯ä»¥è‡ªç”±è°ƒæ•´)ã€‚ ä¸‰ã€ç»§æ‰¿å…³ç³» 12public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable è¯´æ˜Žï¼š HashMapç»§æ‰¿è‡ªAbstractMapï¼ŒAbstractMapæ˜¯MapæŽ¥å£çš„éª¨å¹²å®žçŽ°ï¼ŒAbstractMapä¸­å®žçŽ°äº†Mapä¸­æœ€é‡è¦æœ€å¸¸ç”¨å’Œæ–¹æ³•ï¼Œè¿™æ ·HashMapç»§æ‰¿AbstractMapå°±ä¸éœ€è¦å®žçŽ°Mapçš„æ‰€æœ‰æ–¹æ³•ï¼Œè®©HashMapå‡å°‘äº†å¤§é‡çš„å·¥ä½œã€‚ å››ã€å±žæ€§ 123456789101112131415161718192021222324252627//é»˜è®¤çš„åˆå§‹å®¹é‡ä¸º16static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16//æœ€å¤§çš„å®¹é‡ä¸Šé™ä¸º2^30static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;//é»˜è®¤çš„è´Ÿè½½å› å­ä¸º0.75static final float DEFAULT_LOAD_FACTOR = 0.75f;//å˜æˆæ ‘åž‹ç»“æž„çš„ä¸´ç•Œå€¼ä¸º8static final int TREEIFY_THRESHOLD = 8;//æ¢å¤é“¾å¼ç»“æž„çš„ä¸´ç•Œå€¼ä¸º6static final int UNTREEIFY_THRESHOLD = 6;/** * å“ˆå¸Œè¡¨çš„æœ€å°æ ‘å½¢åŒ–å®¹é‡ * å½“å“ˆå¸Œè¡¨ä¸­çš„å®¹é‡å¤§äºŽè¿™ä¸ªå€¼æ—¶ï¼Œè¡¨ä¸­çš„æ¡¶æ‰èƒ½è¿›è¡Œæ ‘å½¢åŒ– * å¦åˆ™æ¡¶å†…å…ƒç´ å¤ªå¤šæ—¶ä¼šæ‰©å®¹ï¼Œè€Œä¸æ˜¯æ ‘å½¢åŒ– * ä¸ºäº†é¿å…è¿›è¡Œæ‰©å®¹ã€æ ‘å½¢åŒ–é€‰æ‹©çš„å†²çªï¼Œè¿™ä¸ªå€¼ä¸èƒ½å°äºŽ 4 * TREEIFY_THRESHOLD */static final int MIN_TREEIFY_CAPACITY = 64;//å“ˆå¸Œè¡¨transient Node&lt;K,V&gt;[] table;//å“ˆå¸Œè¡¨ä¸­é”®å€¼å¯¹çš„ä¸ªæ•°transient int size;//å“ˆå¸Œè¡¨è¢«ä¿®æ”¹çš„æ¬¡æ•°transient int modCount;//å®ƒæ˜¯é€šè¿‡capacity*load factorè®¡ç®—å‡ºæ¥çš„ï¼Œå½“sizeåˆ°è¾¾è¿™ä¸ªå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹æ“ä½œint threshold;//è´Ÿè½½å› å­final float loadFactor; 4.1 å‡ ä¸ªå±žæ€§çš„è¯¦ç»†è¯´æ˜Ž 1234int threshold; // æ‰€èƒ½å®¹çº³çš„key-valueå¯¹æžé™ final float loadFactor; // è´Ÿè½½å› å­int modCount; int size; é¦–å…ˆï¼ŒNode[] tableçš„åˆå§‹åŒ–é•¿åº¦length(é»˜è®¤å€¼æ˜¯16)ï¼ŒLoad factorä¸ºè´Ÿè½½å› å­(é»˜è®¤å€¼æ˜¯0.75)ï¼Œthresholdæ˜¯HashMapæ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®é‡çš„Node(é”®å€¼å¯¹)ä¸ªæ•°ã€‚threshold = length * Load factorã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•°ç»„å®šä¹‰å¥½é•¿åº¦ä¹‹åŽï¼Œè´Ÿè½½å› å­è¶Šå¤§ï¼Œæ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹ä¸ªæ•°è¶Šå¤šã€‚ ç»“åˆè´Ÿè½½å› å­çš„å®šä¹‰å…¬å¼å¯çŸ¥ï¼Œthresholdå°±æ˜¯åœ¨æ­¤Load factorå’Œlength(æ•°ç»„é•¿åº¦)å¯¹åº”ä¸‹å…è®¸çš„æœ€å¤§å…ƒç´ æ•°ç›®ï¼Œè¶…è¿‡è¿™ä¸ªæ•°ç›®å°±é‡æ–°resize(æ‰©å®¹)ï¼Œæ‰©å®¹åŽçš„HashMapå®¹é‡æ˜¯ä¹‹å‰å®¹é‡çš„ä¸¤å€ï¼ˆä¸ºä»€ä¹ˆæ˜¯ä¸¤å€ä¸‹æ–‡ä¼šè¯´æ˜Žï¼‰ã€‚ é»˜è®¤çš„è´Ÿè½½å› å­0.75æ˜¯å¯¹ç©ºé—´å’Œæ—¶é—´æ•ˆçŽ‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ï¼Œå»ºè®®å¤§å®¶ä¸è¦ä¿®æ”¹ï¼Œé™¤éžåœ¨æ—¶é—´å’Œç©ºé—´æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå¦‚æžœå†…å­˜ç©ºé—´å¾ˆå¤šè€Œåˆå¯¹æ—¶é—´æ•ˆçŽ‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½Žè´Ÿè½½å› å­`Load factor`çš„å€¼ï¼›ç›¸åï¼Œå¦‚æžœå†…å­˜ç©ºé—´ç´§å¼ è€Œå¯¹æ—¶é—´æ•ˆçŽ‡è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢žåŠ è´Ÿè½½å› å­`loadFactor`çš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥å¤§äºŽ1ã€‚ sizeè¿™ä¸ªå­—æ®µå…¶å®žå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯HashMapä¸­å®žé™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡ã€‚æ³¨æ„sizeå’Œtableçš„é•¿åº¦lengthã€å®¹çº³æœ€å¤§é”®å€¼å¯¹æ•°é‡thresholdçš„åŒºåˆ«ã€‚ è€ŒmodCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æž„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼Œä¸»è¦ç”¨äºŽè¿­ä»£çš„å¿«é€Ÿå¤±è´¥ã€‚å¼ºè°ƒä¸€ç‚¹ï¼Œå†…éƒ¨ç»“æž„å‘ç”Ÿå˜åŒ–æŒ‡çš„æ˜¯ç»“æž„å‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚putæ–°é”®å€¼å¯¹ï¼Œä½†æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼è¢«è¦†ç›–ä¸å±žäºŽç»“æž„å˜åŒ–ã€‚ åœ¨HashMapä¸­ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„tableçš„é•¿åº¦lengthå¤§å°å¿…é¡»ä¸º2çš„næ¬¡æ–¹(ä¸€å®šæ˜¯åˆæ•°)ï¼Œè¿™æ˜¯ä¸€ç§éžå¸¸è§„çš„è®¾è®¡ï¼Œå› ä¸ºå¸¸è§„çš„è®¾è®¡æ˜¯æŠŠæ¡¶çš„å¤§å°è®¾è®¡ä¸ºç´ æ•°ã€‚ç›¸å¯¹æ¥è¯´ç´ æ•°å¯¼è‡´å†²çªçš„æ¦‚çŽ‡è¦å°äºŽåˆæ•°ï¼Œå…·ä½“è¯æ˜Žå¯ä»¥å‚è€ƒ http://blog.csdn.net/liuqiyao_01/article/details/14475159 ï¼ŒHashtableåˆå§‹åŒ–æ¡¶å¤§å°ä¸º11ï¼Œå°±æ˜¯æ¡¶å¤§å°è®¾è®¡ä¸ºç´ æ•°çš„åº”ç”¨ï¼ˆHashtableæ‰©å®¹åŽä¸èƒ½ä¿è¯è¿˜æ˜¯ç´ æ•°ï¼‰ã€‚HashMapé‡‡ç”¨è¿™ç§éžå¸¸è§„è®¾è®¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨å–æ¨¡å’Œæ‰©å®¹æ—¶åšä¼˜åŒ–ï¼ŒåŒæ—¶ä¸ºäº†å‡å°‘å†²çªï¼ŒHashMapå®šä½å“ˆå¸Œæ¡¶ç´¢å¼•ä½ç½®æ—¶ï¼Œä¹ŸåŠ å…¥äº†é«˜ä½å‚ä¸Žè¿ç®—çš„è¿‡ç¨‹ã€‚ä¸‹æ–‡ä¼šè¯´æ˜Žã€‚ è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿è´Ÿè½½å› å­å’ŒHashç®—æ³•è®¾è®¡çš„å†åˆç†ï¼Œä¹Ÿå…ä¸äº†ä¼šå‡ºçŽ°æ‹‰é“¾è¿‡é•¿çš„æƒ…å†µï¼Œä¸€æ—¦å‡ºçŽ°æ‹‰é“¾è¿‡é•¿ï¼Œåˆ™ä¼šä¸¥é‡å½±å“HashMapçš„æ€§èƒ½ã€‚äºŽæ˜¯ï¼Œåœ¨JDK1.8ç‰ˆæœ¬ä¸­ï¼Œå¯¹æ•°æ®ç»“æž„åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº†çº¢é»‘æ ‘ã€‚è€Œå½“é“¾è¡¨é•¿åº¦å¤ªé•¿ï¼ˆé»˜è®¤è¶…è¿‡8ï¼‰æ—¶ï¼Œå¹¶ä¸”é“¾è¡¨çš„é•¿åº¦è¶…è¿‡64æ—¶ï¼Œé“¾è¡¨å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåˆ©ç”¨çº¢é»‘æ ‘å¿«é€Ÿå¢žåˆ æ”¹æŸ¥çš„ç‰¹ç‚¹æé«˜HashMapçš„æ€§èƒ½ï¼Œå…¶ä¸­ä¼šç”¨åˆ°çº¢é»‘æ ‘çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰ç®—æ³•ã€‚ è¿™é‡Œç€é‡æä¸€ä¸‹MIN_TREEIFY_CAPACITYå­—æ®µï¼Œå®¹æ˜“ä¸ŽTREEIFY_THRESHOLDæ‰“æž¶ï¼ŒTREEIFY_THRESHOLDæ˜¯æŒ‡æ¡¶ä¸­å…ƒç´ è¾¾åˆ°8ä¸ªï¼Œå°±å°†å…¶æœ¬æ¥çš„é“¾è¡¨ç»“æž„æ”¹ä¸ºçº¢é»‘æ ‘ï¼Œæé«˜æŸ¥è¯¢çš„æ•ˆçŽ‡ã€‚MIN_TREEIFY_CAPACITYæ˜¯æŒ‡æœ€å°æ ‘åŒ–çš„å“ˆå¸Œè¡¨å…ƒç´ ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°äºŽè¿™ä¸ªå€¼ï¼Œå°±ç®—ä½ (æ•°ç»„)æ¡¶é‡Œçš„å…ƒç´ æ•°é‡å¤§äºŽ8äº†ï¼Œè¿˜æ˜¯è¦ç”¨é“¾è¡¨å­˜å‚¨ï¼Œåªæœ‰åŒæ—¶æ»¡è¶³ï¼šè¡¨ä¸­æ•°æ®å®¹é‡å·²ç»æ‰©å®¹åˆ°MIN_TREEIFY_CAPACITYè¿™ä¸ªé•¿åº¦ï¼Œå¹¶ä¸”æ¡¶é‡Œçš„æ•°æ®ä¸ªæ•°è¾¾åˆ°8ä¸ªçš„æ—¶å€™ï¼Œæ‰ä¼šå°†è¯¥æ¡¶é‡Œçš„ç»“æž„è¿›è¡Œæ ‘åŒ–ã€‚æ³¨æ„æ‰©å®¹æ˜¯æ•°ç»„çš„å¤åˆ¶ã€‚ 4.2 Nodeç»“æž„ 1234567891011121314static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; //ç”¨æ¥å®šä½æ•°ç»„ç´¢å¼•ä½ç½® final K key; V value; Node&lt;K,V&gt; next; //é“¾è¡¨çš„ä¸‹ä¸€ä¸ªnode Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; ... &#125; public final K getKey()&#123; ... &#125; public final V getValue() &#123; ... &#125; public final String toString() &#123; ... &#125; public final int hashCode() &#123; ... &#125; public final V setValue(V newValue) &#123; ... &#125; public final boolean equals(Object o) &#123; ... &#125;&#125; Nodeæ˜¯HashMapçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®žçŽ°äº†Map.EntryæŽ¥å£ï¼Œæœ¬è´¨æ˜¯å°±æ˜¯ä¸€ä¸ªæ˜ å°„(é”®å€¼å¯¹)ã€‚ä¸Šå›¾ä¸­çš„æ¯ä¸ªé»‘è‰²åœ†ç‚¹å°±æ˜¯ä¸€ä¸ªNodeå¯¹è±¡ã€‚ ä¾‹å¦‚ç¨‹åºæ‰§è¡Œä¸‹é¢ä»£ç ï¼š 1map.put("ç¾Žå›¢","å°ç¾Ž"); ç³»ç»Ÿå°†è°ƒç”¨&quot;ç¾Žå›¢&quot;è¿™ä¸ªkeyçš„hashCode()æ–¹æ³•å¾—åˆ°å…¶hashCodeå€¼ï¼ˆè¯¥æ–¹æ³•é€‚ç”¨äºŽæ¯ä¸ªJavaå¯¹è±¡ï¼‰ã€‚ ç„¶åŽå†é€šè¿‡Hashç®—æ³•æ¥å®šä½è¯¥é”®å€¼å¯¹çš„å­˜å‚¨ä½ç½®ï¼Œæœ‰æ—¶ä¸¤ä¸ªkeyä¼šå®šä½åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†Hashç¢°æ’žã€‚ å½“ç„¶Hashç®—æ³•è®¡ç®—ç»“æžœè¶Šåˆ†æ•£å‡åŒ€ï¼ŒHashç¢°æ’žçš„æ¦‚çŽ‡å°±è¶Šå°ï¼Œmapçš„å­˜å–æ•ˆçŽ‡å°±ä¼šè¶Šé«˜ã€‚ å¦‚æžœå“ˆå¸Œæ¡¶æ•°ç»„å¾ˆå¤§ï¼Œå³ä½¿è¾ƒå·®çš„Hashç®—æ³•ä¹Ÿä¼šæ¯”è¾ƒåˆ†æ•£ï¼Œå¦‚æžœå“ˆå¸Œæ¡¶æ•°ç»„æ•°ç»„å¾ˆå°ï¼Œå³ä½¿å¥½çš„Hashç®—æ³•ä¹Ÿä¼šå‡ºçŽ°è¾ƒå¤šç¢°æ’žï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ç©ºé—´æˆæœ¬å’Œæ—¶é—´æˆæœ¬ä¹‹é—´æƒè¡¡ï¼Œå…¶å®žå°±æ˜¯åœ¨æ ¹æ®å®žé™…æƒ…å†µç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡å¥½çš„hashç®—æ³•å‡å°‘Hashç¢°æ’žã€‚ é‚£ä¹ˆé€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥æŽ§åˆ¶mapä½¿å¾—Hashç¢°æ’žçš„æ¦‚çŽ‡åˆå°ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„ï¼ˆNode[] tableï¼‰å ç”¨ç©ºé—´åˆå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¥½çš„Hashç®—æ³•(5.4èŠ‚)å’Œæ‰©å®¹æœºåˆ¶(5.5èŠ‚)ã€‚ä¸‹æ–‡ä¼šè®²åˆ°ã€‚ äº”ã€æ–¹æ³• 5.1 getæ–¹æ³• 123456789101112131415161718192021222324252627282930//getæ–¹æ³•ä¸»è¦è°ƒç”¨çš„æ˜¯getNodeæ–¹æ³•ï¼Œæ‰€ä»¥é‡ç‚¹è¦çœ‹getNodeæ–¹æ³•çš„å®žçŽ°public V get(Object key) &#123; Node&lt;K,V&gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; //å¦‚æžœå“ˆå¸Œè¡¨ä¸ä¸ºç©º &amp;&amp; keyå¯¹åº”çš„æ¡¶ä¸Šä¸ä¸ºç©º if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; //æ˜¯å¦ç›´æŽ¥å‘½ä¸­ if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; //åˆ¤æ–­æ˜¯å¦æœ‰åŽç»­èŠ‚ç‚¹ if ((e = first.next) != null) &#123; //å¦‚æžœå½“å‰çš„æ¡¶æ˜¯é‡‡ç”¨çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„getæ–¹æ³•åŽ»èŽ·å–èŠ‚ç‚¹ if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); //ä¸æ˜¯çº¢é»‘æ ‘çš„è¯ï¼Œé‚£å°±æ˜¯ä¼ ç»Ÿçš„é“¾å¼ç»“æž„äº†ï¼Œé€šè¿‡å¾ªçŽ¯çš„æ–¹æ³•åˆ¤æ–­é“¾ä¸­æ˜¯å¦å­˜åœ¨è¯¥key do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; å®žçŽ°æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š é€šè¿‡hashå€¼èŽ·å–è¯¥keyæ˜ å°„åˆ°çš„æ¡¶ã€‚ æ¡¶ä¸Šçš„keyå°±æ˜¯è¦æŸ¥æ‰¾çš„keyï¼Œåˆ™ç›´æŽ¥å‘½ä¸­ã€‚ æ¡¶ä¸Šçš„keyä¸æ˜¯è¦æŸ¥æ‰¾çš„keyï¼Œåˆ™æŸ¥çœ‹åŽç»­èŠ‚ç‚¹ï¼š å¦‚æžœåŽç»­èŠ‚ç‚¹æ˜¯æ ‘èŠ‚ç‚¹ï¼Œé€šè¿‡è°ƒç”¨æ ‘çš„æ–¹æ³•æŸ¥æ‰¾è¯¥keyã€‚ å¦‚æžœåŽç»­èŠ‚ç‚¹æ˜¯é“¾å¼èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡å¾ªçŽ¯éåŽ†é“¾æŸ¥æ‰¾è¯¥keyã€‚ 5.2 putæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960//putæ–¹æ³•çš„å…·ä½“å®žçŽ°ä¹Ÿæ˜¯åœ¨putValæ–¹æ³•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹é¢çš„putValæ–¹æ³•public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125;final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; //å¦‚æžœå“ˆå¸Œè¡¨ä¸ºç©ºï¼Œåˆ™å…ˆåˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; //å¦‚æžœå½“å‰æ¡¶æ²¡æœ‰ç¢°æ’žå†²çªï¼Œåˆ™ç›´æŽ¥æŠŠé”®å€¼å¯¹æ’å…¥ï¼Œå®Œäº‹ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; //å¦‚æžœæ¡¶ä¸ŠèŠ‚ç‚¹çš„keyä¸Žå½“å‰keyé‡å¤ï¼Œé‚£ä½ å°±æ˜¯æˆ‘è¦æ‰¾çš„èŠ‚ç‚¹äº† if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; //å¦‚æžœæ˜¯é‡‡ç”¨çº¢é»‘æ ‘çš„æ–¹å¼å¤„ç†å†²çªï¼Œåˆ™é€šè¿‡çº¢é»‘æ ‘çš„putTreeValæ–¹æ³•åŽ»æ’å…¥è¿™ä¸ªé”®å€¼å¯¹ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); //å¦åˆ™å°±æ˜¯ä¼ ç»Ÿçš„é“¾å¼ç»“æž„ else &#123; //é‡‡ç”¨å¾ªçŽ¯éåŽ†çš„æ–¹å¼ï¼Œåˆ¤æ–­é“¾ä¸­æ˜¯å¦æœ‰é‡å¤çš„key for (int binCount = 0; ; ++binCount) &#123; //åˆ°äº†é“¾å°¾è¿˜æ²¡æ‰¾åˆ°é‡å¤çš„keyï¼Œåˆ™è¯´æ˜ŽHashMapæ²¡æœ‰åŒ…å«è¯¥é”® if ((e = p.next) == null) &#123; //åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹æ’å…¥åˆ°å°¾éƒ¨ p.next = newNode(hash, key, value, null); //å¦‚æžœé“¾çš„é•¿åº¦å¤§äºŽTREEIFY_THRESHOLDè¿™ä¸ªä¸´ç•Œå€¼ï¼Œåˆ™æŠŠé“¾å˜ä¸ºçº¢é»‘æ ‘ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; //æ‰¾åˆ°äº†é‡å¤çš„key if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; //è¿™é‡Œè¡¨ç¤ºåœ¨ä¸Šé¢çš„æ“ä½œä¸­æ‰¾åˆ°äº†é‡å¤çš„é”®ï¼Œæ‰€ä»¥è¿™é‡ŒæŠŠè¯¥é”®çš„å€¼æ›¿æ¢ä¸ºæ–°å€¼ if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; //åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; 1234567891011121314151617181920final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) &#123; int n, index; Node&lt;K,V&gt; e; if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY) resize(); else if ((e = tab[index = (n - 1) &amp; hash]) != null) &#123; TreeNode&lt;K,V&gt; hd = null, tl = null; do &#123; TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null); if (tl == null) hd = p; else &#123; p.prev = tl; tl.next = p; &#125; tl = p; &#125; while ((e = e.next) != null); if ((tab[index] = hd) != null) hd.treeify(tab); &#125;&#125; putæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œå®žçŽ°æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š å…ˆé€šè¿‡hashå€¼è®¡ç®—å‡ºkeyæ˜ å°„åˆ°å“ªä¸ªæ¡¶ã€‚ å¦‚æžœæ¡¶ä¸Šæ²¡æœ‰ç¢°æ’žå†²çªï¼Œåˆ™ç›´æŽ¥æ’å…¥ã€‚ å¦‚æžœå‡ºçŽ°ç¢°æ’žå†²çªäº†ï¼Œåˆ™éœ€è¦å¤„ç†å†²çªï¼š å¦‚æžœè¯¥æ¡¶ä½¿ç”¨çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ’å…¥ã€‚ å¦åˆ™é‡‡ç”¨ä¼ ç»Ÿçš„é“¾å¼æ–¹æ³•æ’å…¥ã€‚å¦‚æžœé“¾çš„é•¿åº¦åˆ°è¾¾ä¸´ç•Œå€¼ï¼Œåˆ™æŠŠé“¾è½¬å˜ä¸ºçº¢é»‘æ ‘ã€‚ å¦‚æžœæ¡¶ä¸­å­˜åœ¨é‡å¤çš„é”®ï¼Œåˆ™ä¸ºè¯¥é”®æ›¿æ¢æ–°å€¼ã€‚ å¦‚æžœsizeå¤§äºŽé˜ˆå€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ã€‚ 5.3 removeæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//removeæ–¹æ³•çš„å…·ä½“å®žçŽ°åœ¨removeNodeæ–¹æ³•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹é¢çš„removeNodeæ–¹æ³•public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value;&#125;final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; //å¦‚æžœå½“å‰keyæ˜ å°„åˆ°çš„æ¡¶ä¸ä¸ºç©º if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; K k; V v; //å¦‚æžœæ¡¶ä¸Šçš„èŠ‚ç‚¹å°±æ˜¯è¦æ‰¾çš„keyï¼Œåˆ™ç›´æŽ¥å‘½ä¸­ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; //å¦‚æžœæ˜¯ä»¥çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™æž„å»ºä¸€ä¸ªæ ‘èŠ‚ç‚¹ if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); //å¦‚æžœæ˜¯ä»¥é“¾å¼çš„æ–¹å¼å¤„ç†å†²çªï¼Œåˆ™é€šè¿‡éåŽ†é“¾è¡¨æ¥å¯»æ‰¾èŠ‚ç‚¹ else &#123; do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; //æ¯”å¯¹æ‰¾åˆ°çš„keyçš„valueè·Ÿè¦åˆ é™¤çš„æ˜¯å¦åŒ¹é… if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) &#123; //é€šè¿‡è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ¥åˆ é™¤èŠ‚ç‚¹ if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); //ä½¿ç”¨é“¾è¡¨çš„æ“ä½œæ¥åˆ é™¤èŠ‚ç‚¹ else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); return node; &#125; &#125; return null;&#125; 5.4 hashæ–¹æ³•(ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®) ä¸ç®¡å¢žåŠ ã€åˆ é™¤ã€æŸ¥æ‰¾é”®å€¼å¯¹ï¼Œå®šä½åˆ°å“ˆå¸Œæ¡¶æ•°ç»„çš„ä½ç½®éƒ½æ˜¯å¾ˆå…³é”®çš„ç¬¬ä¸€æ­¥ã€‚å‰é¢è¯´è¿‡HashMapçš„æ•°æ®ç»“æž„æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ªHashMapé‡Œé¢çš„å…ƒç´ ä½ç½®å°½é‡åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨hashç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œä¸ç”¨éåŽ†é“¾è¡¨ï¼Œå¤§å¤§ä¼˜åŒ–äº†æŸ¥è¯¢çš„æ•ˆçŽ‡ã€‚HashMapå®šä½æ•°ç»„ç´¢å¼•ä½ç½®ï¼Œç›´æŽ¥å†³å®šäº†hashæ–¹æ³•çš„ç¦»æ•£æ€§èƒ½ã€‚ æ³¨æ„getæ–¹æ³•å’Œputæ–¹æ³•æºç ä¸­éƒ½éœ€è¦å…ˆè®¡ç®—keyæ˜ å°„åˆ°å“ªä¸ªæ¡¶ä¸Šï¼Œç„¶åŽæ‰è¿›è¡Œä¹‹åŽçš„æ“ä½œï¼Œè®¡ç®—çš„ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š 1(n - 1) &amp; hash ä¸Šé¢ä»£ç ä¸­çš„næŒ‡çš„æ˜¯å“ˆå¸Œè¡¨çš„å¤§å°ï¼ŒhashæŒ‡çš„æ˜¯keyçš„å“ˆå¸Œå€¼ï¼Œhashæ˜¯é€šè¿‡ä¸‹é¢è¿™ä¸ªæ–¹æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œé‡‡ç”¨äº†äºŒæ¬¡å“ˆå¸Œçš„æ–¹å¼ï¼Œå…¶ä¸­keyçš„hashCodeæ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼š 123456static final int hash(Object key) &#123; //jdk1.8 &amp; jdk1.7 int h; // h = key.hashCode() ä¸ºç¬¬ä¸€æ­¥ å–hashCodeå€¼ // h ^ (h &gt;&gt;&gt; 16) ä¸ºç¬¬äºŒæ­¥ é«˜ä½å‚ä¸Žè¿ç®— return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; å¯¹äºŽä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„hashCode()è¿”å›žå€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„Hashç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠhashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œæ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåœ¨HashMapä¸­æ˜¯è¿™æ ·åšçš„ï¼šè°ƒç”¨æ–¹æ³•äºŒæ¥è®¡ç®—è¯¥å¯¹è±¡åº”è¯¥ä¿å­˜åœ¨tableæ•°ç»„çš„å“ªä¸ªç´¢å¼•å¤„ã€‚ è¿™ä¸ªæ–¹æ³•éžå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡h &amp; (table.length -1)æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€ŒHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™æ˜¯HashMapåœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚å½“lengthæ€»æ˜¯2çš„næ¬¡æ–¹æ—¶ï¼Œh&amp; (length-1)è¿ç®—ç­‰ä»·äºŽå¯¹lengthå–æ¨¡ï¼Œä¹Ÿå°±æ˜¯h%lengthï¼Œä½†æ˜¯&amp;æ¯”%å…·æœ‰æ›´é«˜çš„æ•ˆçŽ‡ã€‚ åœ¨JDK1.8çš„å®žçŽ°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½Ž16ä½å®žçŽ°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»Žé€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½ŽBitéƒ½å‚ä¸Žåˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚ æ€»ç»“å°±æ˜¯ï¼šç”±äºŽåœ¨è®¡ç®—ä¸­ä½è¿ç®—æ¯”å–æ¨¡è¿ç®—æ•ˆçŽ‡é«˜çš„å¤šï¼Œæ‰€ä»¥ HashMap è§„å®šæ•°ç»„çš„é•¿åº¦ä¸º 2^n ã€‚è¿™æ ·ç”¨ 2^n - 1 åšä½è¿ç®—ä¸Žå–æ¨¡æ•ˆæžœä¸€è‡´ï¼Œå¹¶ä¸”æ•ˆçŽ‡è¿˜è¦é«˜å‡ºè®¸å¤šã€‚è¿™æ ·å›žç­”äº†ä¸Šæ–‡ä¸­ï¼šå¥½çš„Hashç®—æ³•åˆ°åº•æ˜¯ä»€ä¹ˆã€‚ 5.5 resizeæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; //è®¡ç®—æ‰©å®¹åŽçš„å¤§å° if (oldCap &gt; 0) &#123; //å¦‚æžœå½“å‰å®¹é‡è¶…è¿‡æœ€å¤§å®¹é‡ï¼Œåˆ™æ— æ³•è¿›è¡Œæ‰©å®¹ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; //æ²¡è¶…è¿‡æœ€å¤§å€¼åˆ™æ‰©ä¸ºåŽŸæ¥çš„ä¸¤å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold &#125; else if (oldThr &gt; 0) // initial capacity was placed in threshold newCap = oldThr; else &#123; // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; //æ–°çš„resizeé˜ˆå€¼ threshold = newThr; //åˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨ @SuppressWarnings(&#123;"rawtypes","unchecked"&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; if (oldTab != null) &#123; //éåŽ†æ—§å“ˆå¸Œè¡¨çš„æ¯ä¸ªæ¡¶ï¼Œé‡æ–°è®¡ç®—æ¡¶é‡Œå…ƒç´ çš„æ–°ä½ç½® for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; oldTab[j] = null; //å¦‚æžœæ¡¶ä¸Šåªæœ‰ä¸€ä¸ªé”®å€¼å¯¹ï¼Œåˆ™ç›´æŽ¥æ’å…¥ if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; //å¦‚æžœæ˜¯é€šè¿‡çº¢é»‘æ ‘æ¥å¤„ç†å†²çªçš„ï¼Œåˆ™è°ƒç”¨ç›¸å…³æ–¹æ³•æŠŠæ ‘åˆ†ç¦»å¼€ else if (e instanceof TreeNode) ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); //å¦‚æžœé‡‡ç”¨é“¾å¼å¤„ç†å†²çª else &#123; // preserve order Node&lt;K,V&gt; loHead = null, loTail = null; Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; //é€šè¿‡ä¸Šé¢è®²çš„æ–¹æ³•æ¥è®¡ç®—èŠ‚ç‚¹çš„æ–°ä½ç½® do &#123; next = e.next; if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab;&#125; HashMapåœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œä½¿ç”¨çš„rehashæ–¹å¼éžå¸¸å·§å¦™ï¼Œå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸ŽåŽŸæ¥è®¡ç®—ï¼ˆn-1ï¼‰&amp;hashçš„ç»“æžœç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªbitä½ï¼Œæ‰€ä»¥èŠ‚ç‚¹è¦ä¹ˆå°±åœ¨åŽŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ°â€œåŽŸä½ç½®+æ—§å®¹é‡â€è¿™ä¸ªä½ç½®ã€‚ ä¾‹å¦‚ï¼ŒåŽŸæ¥çš„å®¹é‡ä¸º32ï¼Œé‚£ä¹ˆåº”è¯¥æ‹¿hashè·Ÿ31ï¼ˆ0x11111ï¼‰åšä¸Žæ“ä½œï¼›åœ¨æ‰©å®¹æ‰©åˆ°äº†64çš„å®¹é‡ä¹‹åŽï¼Œåº”è¯¥æ‹¿hashè·Ÿ63ï¼ˆ0x111111ï¼‰åšä¸Žæ“ä½œã€‚æ–°å®¹é‡è·ŸåŽŸæ¥ç›¸æ¯”åªæ˜¯å¤šäº†ä¸€ä¸ªbitä½ï¼Œå‡è®¾åŽŸæ¥çš„ä½ç½®åœ¨23ï¼Œé‚£ä¹ˆå½“æ–°å¢žçš„é‚£ä¸ªbitä½çš„è®¡ç®—ç»“æžœä¸º0æ—¶ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹è¿˜æ˜¯åœ¨23ï¼›ç›¸åï¼Œè®¡ç®—ç»“æžœä¸º1æ—¶ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¼šè¢«åˆ†é…åˆ°23+31çš„æ¡¶ä¸Šã€‚ è¿™æ ·åšçš„å¥½å¤„ï¼šæ­£æ˜¯å› ä¸ºè¿™æ ·å·§å¦™çš„rehashæ–¹å¼ï¼Œä¿è¯äº†rehashä¹‹åŽæ¯ä¸ªæ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°å¿…å®šå°äºŽç­‰äºŽåŽŸæ¥æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°ï¼Œå³ä¿è¯äº†rehashä¹‹åŽä¸ä¼šå‡ºçŽ°æ›´ä¸¥é‡çš„å†²çªã€‚å›žç­”äº†ä¸Šæ–‡ä¸­å¥½çš„æ‰©å®¹æœºåˆ¶ã€‚ å…­ã€æ€»ç»“ HashMapçš„ç»“æž„åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªæ¡¶ï¼ŒåŽé¢å¯èƒ½ä¼šè¿žç€ä¸€ä¸²å› ä¸ºç¢°æ’žè€Œèšåœ¨ä¸€èµ·çš„(key,value)èŠ‚ç‚¹ï¼Œä»¥é“¾è¡¨çš„å½¢å¼æˆ–è€…æ ‘çš„å½¢å¼æŒ‚ç€ æŒ‰ç…§åŽŸæ¥çš„æ‹‰é“¾æ³•æ¥è§£å†³å†²çªï¼Œå¦‚æžœä¸€ä¸ªæ¡¶ä¸Šçš„å†²çªå¾ˆä¸¥é‡çš„è¯ï¼Œæ˜¯ä¼šå¯¼è‡´å“ˆå¸Œè¡¨çš„æ•ˆçŽ‡é™ä½Žè‡³Oï¼ˆnï¼‰ï¼Œè€Œé€šè¿‡çº¢é»‘æ ‘çš„æ–¹å¼ï¼Œå¯ä»¥æŠŠæ•ˆçŽ‡æ”¹è¿›è‡³Oï¼ˆlognï¼‰ã€‚ç›¸æ¯”é“¾å¼ç»“æž„çš„èŠ‚ç‚¹ï¼Œæ ‘åž‹ç»“æž„çš„èŠ‚ç‚¹ä¼šå ç”¨æ¯”è¾ƒå¤šçš„ç©ºé—´ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ”¹è¿›æ–¹å¼ã€‚ thresholdæ˜¯æ•°ç»„é•¿åº¦æ‰©å®¹çš„ä¸´ç•Œå€¼ modCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æž„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼Œè¿™é‡Œç»“æž„å˜åŒ–å¿…é¡»æ˜¯æ–°çš„å€¼å¡žè¿›æ¥æˆ–è€…æŸä¸ªå€¼åˆ é™¤è¿™ç§ç±»åž‹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ˜¯è¦†ç›– åªæœ‰åŒæ—¶æ»¡è¶³ï¼šè¡¨ä¸­æ•°æ®å®¹é‡å·²ç»æ‰©å®¹åˆ°MIN_TREEIFY_CAPACITYè¿™ä¸ªé•¿åº¦ï¼Œå¹¶ä¸”æ¡¶é‡Œçš„æ•°æ®ä¸ªæ•°è¾¾åˆ°8ä¸ªçš„æ—¶å€™ï¼Œæ‰ä¼šå°†è¯¥æ¡¶é‡Œçš„ç»“æž„è¿›è¡Œæ ‘åŒ–ã€‚ å¥½çš„hashç®—æ³•ï¼šç”±äºŽåœ¨è®¡ç®—ä¸­ä½è¿ç®—æ¯”å–æ¨¡è¿ç®—æ•ˆçŽ‡é«˜çš„å¤šï¼Œæ‰€ä»¥HashMapè§„å®šæ•°ç»„çš„é•¿åº¦ä¸º 2^n ã€‚è¿™æ ·ç”¨ 2^n - 1 ä¸Ž hash åšä½è¿ç®—ä¸Žå–æ¨¡æ•ˆæžœä¸€è‡´ï¼Œå¹¶ä¸”æ•ˆçŽ‡è¿˜è¦é«˜å‡ºè®¸å¤šã€‚ å¥½çš„æ‰©å®¹æœºåˆ¶ï¼šå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸ŽåŽŸæ¥è®¡ç®—ï¼ˆn-1ï¼‰&amp;hashçš„ç»“æžœç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªbitä½ï¼Œæ‰€ä»¥èŠ‚ç‚¹è¦ä¹ˆå°±åœ¨åŽŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ°â€œåŽŸä½ç½®+æ—§å®¹é‡â€è¿™ä¸ªä½ç½®ã€‚è¿™æ ·åšçš„å¥½å¤„ï¼šæ­£æ˜¯å› ä¸ºè¿™æ ·å·§å¦™çš„rehashæ–¹å¼ï¼Œä¿è¯äº†rehashä¹‹åŽæ¯ä¸ªæ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°å¿…å®šå°äºŽç­‰äºŽåŽŸæ¥æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°ï¼Œå³ä¿è¯äº†rehashä¹‹åŽä¸ä¼šå‡ºçŽ°æ›´ä¸¥é‡çš„å†²çªã€‚ è¿˜æœ‰å°±æ˜¯è¦è®°ä½putçš„è¿‡ç¨‹ã€‚ æ•´ç†è‡ªï¼š https://zhuanlan.zhihu.com/p/21673805 http://blog.csdn.net/u013124587/article/details/52649867]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hashcode/Equals]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F4.hashcode%E5%92%8Cequals%2F</url>
    <content type="text"><![CDATA[hashcodeæ¶‰åŠåˆ°é›†åˆHashMapç­‰é›†åˆï¼Œæ­¤ç¯‡ä¾§é‡äºŽäº†è§£hashcodeå’Œequalsæ–¹æ³•çš„ä½œç”¨çš„åŽŸç†ã€‚æœ‰åŠ©äºŽä¸‹ä¸€ç¯‡HashMapçš„ç†è§£ã€‚ ä¸€ã€Hashæ˜¯ä»€ä¹ˆ Hashæ˜¯æ•£åˆ—çš„æ„æ€ï¼Œå°±æ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œé€šè¿‡æ•£åˆ—ç®—æ³•å˜æ¢æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¯¥è¾“å‡ºå°±æ˜¯æ•£åˆ—å€¼ã€‚è¿™ä¸ªçŽ©æ„è¿˜å¯ä»¥åšåŠ å¯†ã€‚ ä¸åŒå…³é”®å­—ç»è¿‡æ•£åˆ—ç®—æ³•å˜æ¢åŽå¯èƒ½å¾—åˆ°åŒä¸€ä¸ªæ•£åˆ—åœ°å€ï¼Œè¿™ç§çŽ°è±¡ç§°ä¸ºç¢°æ’žã€‚ å¦‚æžœä¸¤ä¸ªHashå€¼ä¸åŒï¼ˆå‰ææ˜¯åŒä¸€Hashç®—æ³•ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªHashå€¼å¯¹åº”çš„åŽŸå§‹è¾“å…¥å¿…å®šä¸åŒ äºŒã€ä»€ä¹ˆæ˜¯hashcode HashCodeçš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†æŸ¥æ‰¾çš„å¿«æ·æ€§ï¼ŒHashCodeæ˜¯ç”¨æ¥åœ¨æ•£åˆ—å­˜å‚¨ç»“æž„ä¸­ç¡®å®šå¯¹è±¡çš„å­˜å‚¨åœ°å€çš„ã€‚ å¦‚æžœä¸¤ä¸ªå¯¹è±¡çš„HashCodeç›¸åŒï¼Œä¸ä»£è¡¨ä¸¤ä¸ªå¯¹è±¡å°±ç›¸åŒï¼Œåªèƒ½è¯´æ˜Žè¿™ä¸¤ä¸ªå¯¹è±¡åœ¨æ•£åˆ—å­˜å‚¨ç»“æž„ä¸­ï¼Œå­˜æ”¾äºŽåŒä¸€ä¸ªä½ç½®ã€‚ å¦‚æžœå¯¹è±¡çš„equalsæ–¹æ³•è¢«é‡å†™ï¼Œé‚£ä¹ˆå¯¹è±¡çš„HashCodeæ–¹æ³•ä¹Ÿå°½é‡é‡å†™ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸‹æ–‡ä¼šè¯´ã€‚ ä¸‰ã€HashCodeæœ‰ä»€ä¹ˆç”¨ æ¯”æ–¹è¯´Seté‡Œé¢å·²ç»æœ‰1000ä¸ªå…ƒç´ äº†ï¼Œé‚£ä¹ˆç¬¬1001ä¸ªå…ƒç´ è¿›æ¥çš„æ—¶å€™ï¼Œæœ€å¤šå¯èƒ½è°ƒç”¨1000æ¬¡equalsæ–¹æ³•ï¼Œå¦‚æžœequalsæ–¹æ³•å†™å¾—å¤æ‚ï¼Œå¯¹æ¯”çš„ä¸œè¥¿ç‰¹åˆ«å¤šï¼Œé‚£ä¹ˆæ•ˆçŽ‡ä¼šå¤§å¤§é™ä½Žã€‚ ä½¿ç”¨HashCodeå°±ä¸ä¸€æ ·äº†ï¼Œæ¯”æ–¹è¯´HashSetï¼Œåº•å±‚æ˜¯åŸºäºŽHashMapå®žçŽ°çš„ï¼Œå…ˆé€šè¿‡HashCodeå–ä¸€ä¸ªæ¨¡ï¼Œè¿™æ ·ä¸€ä¸‹å­å°±å›ºå®šåˆ°æŸä¸ªä½ç½®äº†ï¼Œå¦‚æžœè¿™ä¸ªä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‚¯å®šHashSetä¸­å¿…å®šæ²¡æœ‰å’Œæ–°æ·»åŠ çš„å…ƒç´ equalsçš„å…ƒç´ ï¼Œå°±å¯ä»¥ç›´æŽ¥å­˜æ”¾äº†ï¼Œéƒ½ä¸éœ€è¦æ¯”è¾ƒï¼› å¦‚æžœè¿™ä¸ªä½ç½®ä¸Šæœ‰å…ƒç´ äº†ï¼Œé€ä¸€æ¯”è¾ƒï¼Œæ¯”è¾ƒçš„æ—¶å€™å…ˆæ¯”è¾ƒHashCodeï¼ŒHashCodeéƒ½ä¸åŒæŽ¥ä¸‹åŽ»éƒ½ä¸ç”¨æ¯”äº†ï¼Œè‚¯å®šä¸ä¸€æ ·ï¼ŒHashCodeç›¸ç­‰ï¼Œå†equalsæ¯”è¾ƒï¼Œæ²¡æœ‰ç›¸åŒçš„å…ƒç´ å°±å­˜ï¼Œæœ‰ç›¸åŒçš„å…ƒç´ å°±ä¸å­˜ã€‚ å¦‚æžœåŽŸæ¥çš„Seté‡Œé¢æœ‰ç›¸åŒçš„å…ƒç´ ï¼Œåªè¦HashCodeçš„ç”Ÿæˆæ–¹å¼å®šä¹‰å¾—å¥½ï¼ˆä¸é‡å¤ï¼‰ï¼Œä¸ç®¡Seté‡Œé¢åŽŸæ¥æœ‰å¤šå°‘å…ƒç´ ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡çš„equalså°±å¯ä»¥äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œå®žé™…è°ƒç”¨equalsæ–¹æ³•çš„æ¬¡æ•°å¤§å¤§é™ä½Žï¼Œæé«˜äº†æ•ˆçŽ‡ã€‚ å½“ä¿©ä¸ªå¯¹è±¡çš„`hashCode`å€¼ç›¸åŒçš„æ—¶å€™ï¼Œ`Hashset`ä¼šå°†å¯¹è±¡ä¿å­˜åœ¨åŒä¸€ä¸ªä½ç½®ï¼Œä½†æ˜¯ä»–ä»¬`equals`è¿”å›ž`false`ï¼Œæ‰€ä»¥å®žé™…ä¸Šè¿™ä¸ªä½ç½®é‡‡ç”¨é“¾å¼ç»“æž„æ¥ä¿å­˜å¤šä¸ªå¯¹è±¡ã€‚ å››ã€ä¸ºä»€ä¹ˆé‡å†™Objectçš„equals()æ–¹æ³•å°½é‡è¦é‡å†™Objectçš„hashCode()æ–¹æ³• é¢ä¸´é—®é¢˜ï¼šè‹¥ä¸¤ä¸ªå¯¹è±¡equalsç›¸ç­‰ï¼Œä½†ç”±äºŽä¸åœ¨ä¸€ä¸ªåŒºé—´ï¼Œå› ä¸ºhashCodeçš„å€¼åœ¨é‡å†™ä¹‹å‰æ˜¯å¯¹å†…å­˜åœ°å€è®¡ç®—å¾—å‡ºï¼Œæ‰€ä»¥æ ¹æœ¬æ²¡æœ‰æœºä¼šè¿›è¡Œæ¯”è¾ƒï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ä¸åŒçš„å¯¹è±¡(è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿˜è¦é‡å†™hashcodeæ–¹æ³•äº†)ã€‚æ‰€ä»¥Javaå¯¹äºŽeqaulsæ–¹æ³•å’ŒhashCodeæ–¹æ³•æ˜¯è¿™æ ·è§„å®šçš„ï¼š 1 å¦‚æžœä¸¤ä¸ªå¯¹è±¡ç›¸åŒ(equalsä¸ºtrue)ï¼Œé‚£ä¹ˆå®ƒä»¬çš„hashCodeå€¼ä¸€å®šè¦ç›¸åŒã€‚ä¹Ÿå‘Šè¯‰æˆ‘ä»¬é‡å†™equalsæ–¹æ³•ï¼Œä¸€å®šè¦é‡å†™hashCodeæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´hashCodeå€¼è¦å’Œç±»ä¸­çš„æˆå‘˜å˜é‡æŒ‚ä¸Šé’©ï¼Œå¯¹è±¡ç›¸åŒâ€“&gt;æˆå‘˜å˜é‡ç›¸åŒâ€”-&gt;hashCodeå€¼ä¸€å®šç›¸åŒã€‚ 2 å¦‚æžœä¸¤ä¸ªå¯¹è±¡çš„hashCodeç›¸åŒ(åªæ˜¯æ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®è€Œå·²)ï¼Œå®ƒä»¬å¹¶ä¸ä¸€å®šç›¸åŒï¼Œè¿™é‡Œçš„å¯¹è±¡ç›¸åŒæŒ‡çš„æ˜¯ç”¨eqaulsæ–¹æ³•æ¯”è¾ƒã€‚ ç®€å•æ¥è¯´ï¼Œå¦‚æžœåªé‡å†™equalsæ–¹æ³•è€Œä¸é‡å†™hashcodeæ–¹æ³•ï¼Œä¼šå¯¼è‡´é‡å¤å…ƒç´ çš„äº§ç”Ÿã€‚å…·ä½“é€šè¿‡ä¸‹é¢çš„ä¾‹å­è¿›è¡Œè¯´æ˜Žã€‚ äº”ã€ä¸¾ä¾‹ 6.1 Studentç±» å¾ˆç®€å•ï¼Œå®šä¹‰äº†idå’Œnameä¸¤ä¸ªå­—æ®µï¼Œæ— å‚å’Œæœ‰å‚æž„é€ å‡½æ•°ï¼ŒtoStringæ–¹æ³•ã€‚ 1234567891011121314151617181920public class Student &#123; private int id; private String name; get(),set()ç•¥... public Student()&#123;&#125; public Student(int id, String name) &#123; super(); this.id = id; this.name = name; &#125; @Override public String toString() &#123; return "Student [id=" + id + ", name=" + name + "]"; &#125;&#125; 6.2 mainæ–¹æ³• 1234567891011121314151617181920public static void main(String[] args) &#123; Student student1 = new Student(1,"hh"); Student student2 = new Student(1,"hh"); Student student3 = new Student(2,"gg"); HashSet&lt;Student&gt; set = new HashSet&lt;Student&gt;(); set.add(student1); set.add(student2); set.add(student3); set.add(student1);//é‡å¤æ·»åŠ äº†student1 System.out.println("seté›†åˆå®¹é‡ä¸º: "+set.size()); Iterator&lt;Student&gt; iterator = set.iterator(); while (iterator.hasNext()) &#123; Student student = iterator.next(); System.out.println(student+"---"+student.hashCode()); &#125; &#125; æ‰§è¡Œç»“æžœï¼š 1234seté›†åˆå®¹é‡ä¸º: 3Student [id=1, name=hh]---1735600054Student [id=1, name=hh]---356573597Student [id=2, name=gg]---21685669 æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåªè¦æ˜¯newçš„å¯¹è±¡ï¼Œä»–ä»¬çš„hashcodeæ˜¯ä¸ä¸€æ ·çš„ã€‚æ‰€ä»¥ï¼Œå°±ä¼šè®¤ä¸ºä»–ä»¬æ˜¯ä¸ä¸€æ ·çš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œé›†åˆé‡Œé¢æ•°é‡ä¸º3. 6.3 åªé‡å†™equals()æ–¹æ³•ï¼Œè€Œä¸é‡å†™HashCode()æ–¹æ³• è¾“å‡ºï¼š 1234seté›†åˆå®¹é‡ä¸º: 3Student [id=2, name=gg]---2018699554Student [id=1, name=hh]---366712642Student [id=1, name=hh]---1829164700 ç»“è®ºï¼šè¦†ç›–equalsï¼ˆObject objï¼‰ä½†ä¸è¦†ç›–hashCode(),å¯¼è‡´æ•°æ®ä¸å”¯ä¸€æ€§ã€‚ åœ¨è¿™é‡Œï¼Œå…¶å®žæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œstudent1å’Œstudent2å…¶å®žæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ç”±äºŽéƒ½æ˜¯newå¹¶ä¸”æ²¡æœ‰é‡å†™hashcodeå¯¼è‡´ä»–ä»¬å˜æˆäº†ä¸¤ä¸ªä¸ä¸€æ ·çš„å¯¹è±¡ã€‚ åˆ†æžï¼š ï¼ˆ1ï¼‰å½“æ‰§è¡Œset.add(student1)æ—¶ï¼Œé›†åˆä¸ºç©ºï¼Œç›´æŽ¥å­˜å…¥é›†åˆï¼› ï¼ˆ2ï¼‰å½“æ‰§è¡Œset.add(student2)æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­è¯¥å¯¹è±¡ï¼ˆstudent2ï¼‰çš„hashCodeå€¼æ‰€åœ¨çš„å­˜å‚¨åŒºåŸŸæ˜¯å¦æœ‰ç›¸åŒçš„hashCodeï¼Œå› ä¸ºæ²¡æœ‰è¦†ç›–hashCodeæ–¹æ³•ï¼Œæ‰€ä»¥jdkä½¿ç”¨é»˜è®¤Objectçš„hashCodeæ–¹æ³•ï¼Œè¿”å›žå†…å­˜åœ°å€è½¬æ¢åŽçš„æ•´æ•°ï¼Œå› ä¸ºä¸åŒå¯¹è±¡çš„åœ°å€å€¼ä¸åŒï¼Œæ‰€ä»¥è¿™é‡Œä¸å­˜åœ¨ä¸Žstudent2ç›¸åŒhashCodeå€¼çš„å¯¹è±¡ï¼Œå› æ­¤jdké»˜è®¤ä¸åŒhashCodeå€¼ï¼Œequalsä¸€å®šè¿”å›žfalseï¼Œæ‰€ä»¥ç›´æŽ¥å­˜å…¥é›†åˆã€‚ ï¼ˆ3ï¼‰å½“æ‰§è¡Œset.add(student3)æ—¶,ä¸Ž2åŒç†ã€‚ ï¼ˆ4ï¼‰å½“æœ€åŽæ‰§è¡Œset.add(student1)æ—¶ï¼Œå› ä¸ºstudent1å·²ç»å­˜å…¥é›†åˆï¼ŒåŒä¸€å¯¹è±¡è¿”å›žçš„hashCodeå€¼æ˜¯ä¸€æ ·çš„ï¼Œç»§ç»­åˆ¤æ–­equalsæ˜¯å¦è¿”å›žtrueï¼Œå› ä¸ºæ˜¯åŒä¸€å¯¹è±¡æ‰€ä»¥è¿”å›žtrueã€‚æ­¤æ—¶jdkè®¤ä¸ºè¯¥å¯¹è±¡å·²ç»å­˜åœ¨äºŽé›†åˆä¸­ï¼Œæ‰€ä»¥èˆå¼ƒã€‚ 6.4 åªé‡å†™HashCode()æ–¹æ³•ï¼Œequals()æ–¹æ³•ç›´æŽ¥è¿”å›žfalse 1234seté›†åˆå®¹é‡ä¸º: 3Student [id=1, name=hh]---4320Student [id=1, name=hh]---4320Student [id=2, name=gg]---4319 æŒ‰ç…§ä¸Šé¢çš„åˆ†æžï¼Œå¯èƒ½ä¼šè§‰å¾—é‡Œé¢åº”è¯¥è£…4ä¸ªï¼Œå› ä¸ºä¸¤æ¬¡addçš„student1ï¼Œè™½ç„¶ä»–ä»¬çš„hashcodeä¸€æ ·ï¼Œä½†æ˜¯equalsç›´æŽ¥è¿”å›žfalseï¼Œé‚£ä¹ˆåº”è¯¥åˆ¤å®šä¸ºä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ã€‚ä½†æ˜¯ç»“æžœç¡®è·Ÿæˆ‘ä»¬é¢„æƒ³çš„ä¸ä¸€æ ·ã€‚ åˆ†æžï¼š é¦–å…ˆstudent1å’Œstudent2çš„å¯¹è±¡æ¯”è¾ƒhashCodeï¼Œå› ä¸ºé‡å†™äº†HashCodeæ–¹æ³•ï¼Œæ‰€ä»¥hashcodeç›¸ç­‰,ç„¶åŽæ¯”è¾ƒä»–ä»¬ä¸¤çš„equalsæ–¹æ³•ï¼Œå› ä¸ºequalsæ–¹æ³•å§‹ç»ˆè¿”å›žfalse,æ‰€ä»¥student1å’Œstudent2ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥student2ä¹Ÿè¢«æ”¾è¿›äº†set é¦–å…ˆstudent1(student2)å’Œstudent3çš„å¯¹è±¡æ¯”è¾ƒhashCodeï¼Œä¸ç›¸ç­‰ï¼Œæ‰€ä»¥student3æ”¾è¿›setä¸­ æœ€åŽå†çœ‹æœ€åŽé‡å¤æ·»åŠ çš„student1,ä¸Žç¬¬ä¸€ä¸ªstudent1çš„hashCodeæ˜¯ç›¸ç­‰çš„ï¼Œåœ¨æ¯”è¾ƒequalsæ–¹æ³•ï¼Œå› ä¸ºequalsè¿”å›žfalse,æ‰€ä»¥student1å’Œstudent4ä¸ç›¸ç­‰;åŒæ ·ï¼Œstudent2å’Œstudent4ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„;student3å’Œstudent4çš„hashcodeéƒ½ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥è‚¯å®šä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥æœ€åŽä¸€ä¸ªé‡å¤çš„student1åº”è¯¥å¯ä»¥æ”¾åˆ°seté›†åˆä¸­ï¼Œé‚£ä¹ˆç»“æžœåº”è¯¥æ˜¯size:4,é‚£ä¸ºä»€ä¹ˆä¼šæ˜¯3å‘¢ï¼Ÿ è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æŸ¥çœ‹HashSetçš„æºç äº†ï¼Œä¸‹é¢æ˜¯HashSetä¸­çš„addæ–¹æ³•çš„æºç ï¼š 123public boolean add(E e) &#123; return map.put(e, PRESENT)==null;&#125; è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å®žHashSetæ˜¯åŸºäºŽHashMapå®žçŽ°çš„ï¼Œæˆ‘ä»¬åœ¨ç‚¹å‡»HashMapçš„putæ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š 123public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null;&#125; é¦–å…ˆæ˜¯åˆ¤æ–­hashCodeæ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰çš„è¯ï¼Œç›´æŽ¥è·³è¿‡ï¼Œç›¸ç­‰çš„è¯ï¼Œç„¶åŽå†æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰æˆ–è€…è¿™ä¸¤ä¸ªå¯¹è±¡çš„equalsæ–¹æ³•ï¼Œå› ä¸ºæ˜¯è¿›è¡Œçš„æˆ–æ“ä½œï¼Œæ‰€ä»¥åªè¦æœ‰ä¸€ä¸ªæˆç«‹å³å¯ï¼Œé‚£è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥è§£é‡Šäº†ï¼Œå…¶å®žä¸Šé¢çš„é‚£ä¸ªé›†åˆçš„å¤§å°æ˜¯3,å› ä¸ºæœ€åŽçš„ä¸€ä¸ªr1æ²¡æœ‰æ”¾è¿›åŽ»ï¼Œä»¥ä¸ºr1==r1è¿”å›žtrueçš„ï¼Œæ‰€ä»¥æ²¡æœ‰æ”¾è¿›åŽ»äº†ã€‚æ‰€ä»¥é›†åˆçš„å¤§å°æ˜¯3ï¼Œå¦‚æžœæˆ‘ä»¬å°†hashCodeæ–¹æ³•è®¾ç½®æˆå§‹ç»ˆè¿”å›žfalseçš„è¯ï¼Œè¿™ä¸ªé›†åˆå°±æ˜¯4äº†ã€‚ 6.5 åŒæ—¶é‡å†™ æˆ‘çš„å†™æ³•æ˜¯ï¼š 12345678910111213141516171819@Overridepublic int hashCode() &#123; int result = 17; result = result * 31 + name.hashCode(); result = result * 31 + id; return result;&#125;@Overridepublic boolean equals(Object obj) &#123; if(obj == this) return true; if(!(obj instanceof Student)) return false; Student o = (Student)obj; return o.name.equals(name) &amp;&amp; o.id == id;&#125; ç»“æžœï¼š 123seté›†åˆå®¹é‡ä¸º: 2Student [id=2, name=gg]---118515Student [id=1, name=hh]---119506 è¾¾åˆ°æˆ‘ä»¬é¢„æœŸçš„æ•ˆæžœã€‚ å…­ã€å†…å­˜æ³„éœ² æˆ‘ä»¬ä¸Šé¢å®žéªŒäº†é‡å†™equalså’Œhashcodeæ–¹æ³•ï¼Œæ‰§è¡Œmainï¼Œæ‰§è¡Œç»“æžœæ˜¯ï¼š 123seté›†åˆå®¹é‡ä¸º: 2Student [id=1, name=hh]---4320Student [id=2, name=gg]---4319 å°†mainæ–¹æ³•æ”¹ä¸ºï¼š 1234567891011121314151617181920212223242526272829public static void main(String[] args) &#123; Student student1 = new Student(1,"hh"); Student student2 = new Student(1,"hh"); Student student3 = new Student(2,"gg"); HashSet&lt;Student&gt; set = new HashSet&lt;Student&gt;(); set.add(student1); set.add(student2); set.add(student3); set.add(student1);//é‡å¤æ·»åŠ äº†student1 System.out.println("seté›†åˆå®¹é‡ä¸º: "+set.size()); //------æ–°å¢žçš„å¼€å§‹------- student3.setId(11); set.remove(student3); System.out.println("seté›†åˆå®¹é‡ä¸º: "+set.size()); //------æ–°å¢žçš„ç»“æŸ------- Iterator&lt;Student&gt; iterator = set.iterator(); while (iterator.hasNext()) &#123; Student student = iterator.next(); System.out.println(student+"---"+student.hashCode()); &#125; &#125; è¿è¡Œç»“æžœæ˜¯ï¼š 1234seté›†åˆå®¹é‡ä¸º: 2seté›†åˆå®¹é‡ä¸º: 2Student [id=1, name=hh]---4320Student [id=11, name=gg]---4598 æˆ‘ä»¬è°ƒç”¨äº†removeåˆ é™¤student3å¯¹è±¡ï¼Œä»¥ä¸ºåˆ é™¤äº†student3,ä½†äº‹å®žä¸Šå¹¶æ²¡æœ‰åˆ é™¤ï¼Œè¿™å°±å«åšå†…å­˜æ³„éœ²ï¼Œå°±æ˜¯ä¸ç”¨çš„å¯¹è±¡ä½†æ˜¯ä»–è¿˜åœ¨å†…å­˜ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¤šæ¬¡è¿™æ ·æ“ä½œä¹‹åŽï¼Œå†…å­˜å°±çˆ†äº†ã€‚ åŽŸå› ï¼š åœ¨è°ƒç”¨removeæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…ˆä½¿ç”¨å¯¹è±¡çš„hashCodeå€¼åŽ»æ‰¾åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œç„¶åŽè¿›è¡Œåˆ é™¤ï¼Œè¿™ç§é—®é¢˜å°±æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä¿®æ”¹äº†å¯¹è±¡student3çš„idå±žæ€§çš„å€¼ï¼Œåˆå› ä¸ºRectObjectå¯¹è±¡çš„hashCodeæ–¹æ³•ä¸­æœ‰idå€¼å‚ä¸Žè¿ç®—,æ‰€ä»¥student3å¯¹è±¡çš„hashCodeå°±å‘ç”Ÿæ”¹å˜äº†ï¼Œæ‰€ä»¥removeæ–¹æ³•ä¸­å¹¶æ²¡æœ‰æ‰¾åˆ°student3äº†ï¼Œæ‰€ä»¥åˆ é™¤å¤±è´¥ã€‚å³student3çš„hashCodeå˜äº†ï¼Œä½†æ˜¯ä»–å­˜å‚¨çš„ä½ç½®æ²¡æœ‰æ›´æ–°ï¼Œä»ç„¶åœ¨åŽŸæ¥çš„ä½ç½®ä¸Šï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ç”¨ä»–çš„æ–°çš„hashCodeåŽ»æ‰¾è‚¯å®šæ˜¯æ‰¾ä¸åˆ°äº†ã€‚ æ€»ç»“ï¼š ä¸Šé¢çš„è¿™ä¸ªå†…å­˜æ³„éœ²å‘Šè¯‰æˆ‘ä¸€ä¸ªä¿¡æ¯ï¼šå¦‚æžœæˆ‘ä»¬å°†å¯¹è±¡çš„å±žæ€§å€¼å‚ä¸Žäº†hashCodeçš„è¿ç®—ä¸­ï¼Œåœ¨è¿›è¡Œåˆ é™¤çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å¯¹å…¶å±žæ€§å€¼è¿›è¡Œä¿®æ”¹ï¼Œå¦åˆ™ä¼šå‡ºçŽ°ä¸¥é‡çš„é—®é¢˜ã€‚ ä¸ƒã€æ€»ç»“ hashCodeæ˜¯ä¸ºäº†æé«˜åœ¨æ•£åˆ—ç»“æž„å­˜å‚¨ä¸­æŸ¥æ‰¾çš„æ•ˆçŽ‡ï¼Œåœ¨çº¿æ€§è¡¨ä¸­æ²¡æœ‰ä½œç”¨ã€‚ equalså’ŒhashCodeéœ€è¦åŒæ—¶è¦†ç›–ã€‚ è‹¥ä¸¤ä¸ªå¯¹è±¡equalsè¿”å›žtrueï¼Œåˆ™hashCodeæœ‰å¿…è¦ä¹Ÿè¿”å›žç›¸åŒçš„intæ•°ã€‚ è‹¥ä¸¤ä¸ªå¯¹è±¡equalsè¿”å›žfalseï¼Œåˆ™hashCodeä¸ä¸€å®šè¿”å›žä¸åŒçš„intæ•°,ä½†ä¸ºä¸ç›¸ç­‰çš„å¯¹è±¡ç”Ÿæˆä¸åŒhashCodeå€¼å¯ä»¥æé«˜å“ˆå¸Œè¡¨çš„æ€§èƒ½ã€‚ è‹¥ä¸¤ä¸ªå¯¹è±¡hashCodeè¿”å›žç›¸åŒintæ•°ï¼Œåˆ™equalsä¸ä¸€å®šè¿”å›žtrueã€‚ åŒä¸€å¯¹è±¡åœ¨æ‰§è¡ŒæœŸé—´è‹¥å·²ç»å­˜å‚¨åœ¨é›†åˆä¸­ï¼Œåˆ™ä¸èƒ½ä¿®æ”¹å½±å“hashCodeå€¼çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚ æ•´ç†è‡ªï¼š http://blog.csdn.net/haobaworenle/article/details/53819838 http://www.cnblogs.com/xrq730/p/4842028.html http://blog.csdn.net/qq_21688757/article/details/53067814 http://blog.csdn.net/fyxxq/article/details/42066843]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CopyOnWriteArrayList]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F3.CopyOnWriteArrayList%2F</url>
    <content type="text"><![CDATA[CopyOnWriteArrayListæ˜¯ArrayListçš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å˜ä½“ï¼Œå…¶ä¸­æ‰€æœ‰å¯å˜æ“ä½œï¼ˆaddã€set ç­‰ç­‰ï¼‰éƒ½æ˜¯é€šè¿‡å¯¹åº•å±‚æ•°ç»„è¿›è¡Œä¸€æ¬¡æ–°çš„å¤åˆ¶æ¥å®žçŽ°çš„ã€‚ CopyOnWriteArrayListæ˜¯ä¸€ä¸ªå†™æ—¶å¤åˆ¶çš„å®¹å™¨ï¼Œé‡‡ç”¨äº†è¯»å†™åˆ†ç¦»çš„æ€æƒ³ã€‚é€šä¿—ç‚¹æ¥è®²ï¼Œåœ¨å¯¹å®¹å™¨è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œä¸ç›´æŽ¥ä¿®æ”¹å½“å‰å®¹å™¨ï¼Œè€Œæ˜¯å…ˆå¯¹å½“å‰å®¹å™¨è¿›è¡Œæ‹·è´å¾—åˆ°ä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åŽå¯¹å‰¯æœ¬è¿›è¡Œå†™æ“ä½œï¼Œæœ€åŽå†å°†åŽŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ‹·è´å‡ºæ¥çš„å‰¯æœ¬ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¯ä»¥å¯¹å®¹å™¨è¿›è¡Œå¹¶å‘è¯»è€Œä¸ç”¨è¿›è¡ŒåŠ é”ã€‚ ä¸€ã€ç±»çš„ç»§æ‰¿å…³ç³» 12public class CopyOnWriteArrayList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable å«ä¹‰ä¸éœ€è¦å†èµ˜è¿°äº†ã€‚ äºŒã€ç±»çš„å±žæ€§ 12345678910111213141516171819202122/** ç”¨äºŽåœ¨å¯¹æ•°ç»„äº§ç”Ÿå†™æ“ä½œçš„æ–¹æ³•åŠ é”. */final transient ReentrantLock lock = new ReentrantLock();/** åº•å±‚çš„å­˜å‚¨ç»“æž„. */private transient volatile Object[] array;/** åå°„æœºåˆ¶. */private static final sun.misc.Unsafe UNSAFE;/** lockåŸŸçš„å†…å­˜åç§»é‡.æ˜¯é€šè¿‡åå°„æ‹¿åˆ°çš„ */private static final long lockOffset;static &#123; try &#123; UNSAFE = sun.misc.Unsafe.getUnsafe(); Class&lt;?&gt; k = CopyOnWriteArrayList.class; lockOffset = UNSAFE.objectFieldOffset (k.getDeclaredField("lock")); &#125; catch (Exception e) &#123; throw new Error(e); &#125;&#125; ä¸‰ã€æ•°ç»„æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´  12345678910111213141516171819202122public boolean add(E e) &#123; // å¯é‡å…¥é” final ReentrantLock lock = this.lock; // èŽ·å–é” lock.lock(); try &#123; // å…ƒç´ æ•°ç»„ Object[] elements = getArray(); // æ•°ç»„é•¿åº¦ int len = elements.length; // å¤åˆ¶æ•°ç»„ Object[] newElements = Arrays.copyOf(elements, len + 1); // å°†è¦æ·»åŠ çš„å…ƒç´ æ”¾åˆ°å‰¯æœ¬æ•°ç»„çš„æœ«å°¾åŽ» newElements[len] = e; // è®¾ç½®æ•°ç»„ setArray(newElements); return true; &#125; finally &#123; // é‡Šæ”¾é” lock.unlock(); &#125;&#125; åŸºæœ¬åŽŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯å¯¹å½“å‰æ•°ç»„åŠ é”ï¼Œå†…éƒ¨å¤åˆ¶ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¤„ç†å®Œæ¯•ï¼Œä¿®æ”¹å¼•ç”¨å³å¯ï¼Œè¾¾åˆ°æœ€ç»ˆä¸€è‡´çš„æ•ˆæžœã€‚ å››ã€å¦‚æžœæ²¡æœ‰è¿™ä¸ªå…ƒç´ åˆ™æ·»åŠ  12345public boolean addIfAbsent(E e) &#123; Object[] snapshot = getArray(); return indexOf(e, snapshot, 0, snapshot.length) &gt;= 0 ? false : addIfAbsent(e, snapshot);&#125; è¯¥å‡½æ•°ç”¨äºŽæ·»åŠ å…ƒç´ ï¼ˆå¦‚æžœæ•°ç»„ä¸­ä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ ï¼›å¦åˆ™ï¼Œä¸æ·»åŠ ï¼Œç›´æŽ¥è¿”å›žï¼‰ã€‚å¦‚ä½•å¯ä»¥ä¿è¯å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ä¸ä¼šé‡å¤æ·»åŠ å…ƒç´ ï¼Ÿ ç­”æ¡ˆï¼šé€šè¿‡å¿«ç…§æ•°ç»„å’Œå½“å‰æ•°ç»„è¿›è¡Œå¯¹æ¯”æ¥ç¡®å®šæ˜¯å¦ä¸€è‡´ï¼Œç¡®ä¿æ·»åŠ å…ƒç´ çš„çº¿ç¨‹å®‰å…¨ 12345678910111213141516171819202122232425262728293031323334private boolean addIfAbsent(E e, Object[] snapshot) &#123; // é‡å…¥é” final ReentrantLock lock = this.lock; // èŽ·å–é” lock.lock(); try &#123; // èŽ·å–æ•°ç»„ Object[] current = getArray(); // æ•°ç»„é•¿åº¦ int len = current.length; if (snapshot != current) &#123; // å¿«ç…§ä¸ç­‰äºŽå½“å‰æ•°ç»„ï¼Œå¯¹æ•°ç»„è¿›è¡Œäº†ä¿®æ”¹ // å–è¾ƒå°è€… int common = Math.min(snapshot.length, len); for (int i = 0; i &lt; common; i++) // éåŽ† if (current[i] != snapshot[i] &amp;&amp; eq(e, current[i])) // å½“å‰æ•°ç»„çš„å…ƒç´ ä¸Žå¿«ç…§çš„å…ƒç´ ä¸ç›¸ç­‰å¹¶ä¸”eä¸Žå½“å‰å…ƒç´ ç›¸ç­‰ // è¡¨ç¤ºåœ¨snapshotä¸Žcurrentä¹‹é—´ä¿®æ”¹äº†æ•°ç»„ï¼Œå¹¶ä¸”è®¾ç½®äº†æ•°ç»„æŸä¸€å…ƒç´ ä¸ºeï¼Œå·²ç»å­˜åœ¨ // è¿”å›žfalse return false; if (indexOf(e, current, common, len) &gt;= 0) // åœ¨å½“å‰æ•°ç»„ä¸­æ‰¾åˆ°eå…ƒç´  // è¿”å›žfalse return false; &#125; // å¤åˆ¶æ•°ç»„ Object[] newElements = Arrays.copyOf(current, len + 1); // å¯¹æ•°ç»„lenç´¢å¼•çš„å…ƒç´ èµ‹å€¼ä¸ºe newElements[len] = e; // è®¾ç½®æ•°ç»„ setArray(newElements); return true; &#125; finally &#123; // é‡Šæ”¾é” lock.unlock(); &#125;&#125; è¯¥å‡½æ•°çš„æµç¨‹å¦‚ä¸‹ï¼š èŽ·å–é”ï¼ŒèŽ·å–å½“å‰æ•°ç»„ä¸ºcurrentï¼Œcurrenté•¿åº¦ä¸ºlenï¼Œåˆ¤æ–­æ•°ç»„ä¹‹å‰çš„å¿«ç…§snapshotæ˜¯å¦ç­‰äºŽå½“å‰æ•°ç»„currentï¼Œè‹¥ä¸ç›¸ç­‰ï¼Œåˆ™è¿›å…¥æ­¥éª¤2ï¼›å¦åˆ™ï¼Œè¿›å…¥æ­¥éª¤3 ä¸ç›¸ç­‰ï¼Œè¡¨ç¤ºåœ¨snapshotä¸Žcurrentä¹‹é—´ï¼Œå¯¹æ•°ç»„è¿›è¡Œäº†ä¿®æ”¹ï¼Œç›´æŽ¥è¿”å›žfalseç»“æŸ; è¯´æ˜Žå½“å‰æ•°ç»„ç­‰äºŽå¿«ç…§æ•°ç»„ï¼Œè¯´æ˜Žæ•°ç»„æ²¡æœ‰è¢«æ”¹å˜ã€‚åœ¨å½“å‰æ•°ç»„ä¸­ç´¢å¼•æŒ‡å®šå…ƒç´ ï¼Œè‹¥èƒ½å¤Ÿæ‰¾åˆ°ï¼Œè¯´æ˜Žå·²ç»å­˜åœ¨æ­¤å…ƒç´ ï¼Œç›´æŽ¥è¿”å›žfalseç»“æŸï¼›å¦åˆ™è¿›å…¥4 è¯´æ˜Žæ²¡æœ‰å½“å‰è¦æ’å…¥çš„å…ƒç´ ï¼Œé€šè¿‡æ•°ç»„å¤åˆ¶çš„æ–¹å¼æ·»åŠ åˆ°æœ«å°¾ æ— è®ºå¦‚ä½•ï¼Œéƒ½è¦é‡Šæ”¾é” äº”ã€èŽ·å–æŒ‡å®šç´¢å¼•çš„å…ƒç´  1234567public E get(int index) &#123; return get(getArray(), index);&#125;private E get(Object[] a, int index) &#123; return (E) a[index];&#125; é€šè¿‡å†™æ—¶å¤åˆ¶çš„æ–¹å¼ï¼ŒCopyOnWriteArrayList çš„ get æ–¹æ³•ä¸ç”¨åŠ é”ä¹Ÿå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥ CopyOnWriteArrayList å¹¶å‘è¯»çš„æ•ˆçŽ‡æ˜¯éžå¸¸é«˜çš„ï¼Œå®ƒæ˜¯ç›´æŽ¥é€šè¿‡æ•°ç»„ä¸‹æ ‡èŽ·å–å…ƒç´ çš„ã€‚ å…­ã€æ€»ç»“ ç®€å•è€Œè¨€è¦è®°ä½å®ƒçš„ä¸‰ä¸ªç‰¹ç‚¹ï¼š CopyOnWriteArrayList æ˜¯ä¸€ä¸ªå¹¶å‘çš„æ•°ç»„å®¹å™¨ï¼Œå®ƒçš„åº•å±‚å®žçŽ°æ˜¯æ•°ç»„ã€‚ CopyOnWriteArrayList é‡‡ç”¨å†™æ—¶å¤åˆ¶çš„æ–¹å¼æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ é€šè¿‡å†™æ—¶å¤åˆ¶çš„æ–¹å¼ï¼Œå¯ä»¥é«˜æ•ˆçš„è¿›è¡Œå¹¶å‘è¯»ï¼Œä½†æ˜¯å¯¹äºŽå†™æ“ä½œï¼Œæ¯æ¬¡éƒ½è¦è¿›è¡ŒåŠ é”ä»¥åŠæ‹·è´å‰¯æœ¬ï¼Œæ•ˆçŽ‡éžå¸¸ä½Žï¼Œæ‰€ä»¥ CopyOnWriteArrayList ä»…é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚ Vectorè™½ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯åªæ˜¯ä¸€ç§ç›¸å¯¹çš„çº¿ç¨‹å®‰å…¨è€Œä¸æ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ï¼Œå®ƒåªèƒ½å¤Ÿä¿è¯å¢žã€åˆ ã€æ”¹ã€æŸ¥çš„å•ä¸ªæ“ä½œä¸€å®šæ˜¯åŽŸå­çš„ï¼Œä¸ä¼šè¢«æ‰“æ–­ï¼Œä½†æ˜¯å¦‚æžœç»„åˆèµ·æ¥ç”¨ï¼Œå¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚ CopyOnWriteArrayListåœ¨å¹¶å‘ä¸‹ä¸ä¼šäº§ç”Ÿä»»ä½•çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ å¦å¤–ï¼Œæœ‰ä¸¤ç‚¹å¿…é¡»è®²ä¸€ä¸‹ã€‚ æˆ‘è®¤ä¸ºCopyOnWriteArrayListè¿™ä¸ªå¹¶å‘ç»„ä»¶ï¼Œå…¶å®žåæ˜ çš„æ˜¯ä¸¤ä¸ªååˆ†é‡è¦çš„åˆ†å¸ƒå¼ç†å¿µï¼š ï¼ˆ1ï¼‰è¯»å†™åˆ†ç¦» æˆ‘ä»¬è¯»å–CopyOnWriteArrayListçš„æ—¶å€™è¯»å–çš„æ˜¯CopyOnWriteArrayListä¸­çš„Object[] arrayï¼Œä½†æ˜¯ä¿®æ”¹çš„æ—¶å€™ï¼Œæ“ä½œçš„æ˜¯ä¸€ä¸ªæ–°çš„Object[] arrayï¼Œè¯»å’Œå†™æ“ä½œçš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å°±æ˜¯è¯»å†™åˆ†ç¦»ã€‚è¿™ç§æŠ€æœ¯æ•°æ®åº“ç”¨çš„éžå¸¸å¤šï¼Œåœ¨é«˜å¹¶å‘ä¸‹ä¸ºäº†ç¼“è§£æ•°æ®åº“çš„åŽ‹åŠ›ï¼Œå³ä½¿åšäº†ç¼“å­˜ä¹Ÿè¦å¯¹æ•°æ®åº“åšè¯»å†™åˆ†ç¦»ï¼Œè¯»çš„æ—¶å€™ä½¿ç”¨è¯»åº“ï¼Œå†™çš„æ—¶å€™ä½¿ç”¨å†™åº“ï¼Œç„¶åŽè¯»åº“ã€å†™åº“ä¹‹é—´è¿›è¡Œä¸€å®šçš„åŒæ­¥ï¼Œè¿™æ ·å°±é¿å…åŒä¸€ä¸ªåº“ä¸Šè¯»ã€å†™çš„IOæ“ä½œå¤ªå¤š ï¼ˆ2ï¼‰æœ€ç»ˆä¸€è‡´ å¯¹CopyOnWriteArrayListæ¥è¯´ï¼Œçº¿ç¨‹1è¯»å–é›†åˆé‡Œé¢çš„æ•°æ®ï¼Œæœªå¿…æ˜¯æœ€æ–°çš„æ•°æ®ã€‚å› ä¸ºçº¿ç¨‹2ã€çº¿ç¨‹3ã€çº¿ç¨‹4å››ä¸ªçº¿ç¨‹éƒ½ä¿®æ”¹äº†CopyOnWriteArrayListé‡Œé¢çš„æ•°æ®ï¼Œä½†æ˜¯çº¿ç¨‹1æ‹¿åˆ°çš„è¿˜æ˜¯æœ€è€çš„é‚£ä¸ªObject[] arrayï¼Œæ–°æ·»åŠ è¿›åŽ»çš„æ•°æ®å¹¶æ²¡æœ‰ï¼Œæ‰€ä»¥çº¿ç¨‹1è¯»å–çš„å†…å®¹æœªå¿…å‡†ç¡®ã€‚ä¸è¿‡è¿™äº›æ•°æ®è™½ç„¶å¯¹äºŽçº¿ç¨‹1æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯å¯¹äºŽä¹‹åŽçš„çº¿ç¨‹ä¸€å®šæ˜¯ä¸€è‡´çš„ï¼Œå®ƒä»¬æ‹¿åˆ°çš„Object[] arrayä¸€å®šæ˜¯ä¸‰ä¸ªçº¿ç¨‹éƒ½æ“ä½œå®Œæ¯•ä¹‹åŽçš„Object array[]ï¼Œè¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´ã€‚æœ€ç»ˆä¸€è‡´å¯¹äºŽåˆ†å¸ƒå¼ç³»ç»Ÿä¹Ÿéžå¸¸é‡è¦ï¼Œå®ƒé€šè¿‡å®¹å¿ä¸€å®šæ—¶é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œæå‡æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§ä¸Žåˆ†åŒºå®¹é”™æ€§ã€‚å½“ç„¶ï¼Œæœ€ç»ˆä¸€è‡´å¹¶ä¸æ˜¯ä»»ä½•åœºæ™¯éƒ½é€‚ç”¨çš„ï¼Œåƒç«è½¦ç«™å”®ç¥¨è¿™ç§ç³»ç»Ÿç”¨æˆ·å¯¹äºŽæ•°æ®çš„å®žæ—¶æ€§è¦æ±‚éžå¸¸éžå¸¸é«˜ï¼Œå°±å¿…é¡»åšæˆå¼ºä¸€è‡´æ€§çš„ã€‚ æœ€åŽæ€»ç»“ä¸€ç‚¹ï¼Œéšç€CopyOnWriteArrayListä¸­å…ƒç´ çš„å¢žåŠ ï¼ŒCopyOnWriteArrayListçš„ä¿®æ”¹ä»£ä»·å°†è¶Šæ¥è¶Šæ˜‚è´µï¼Œå› æ­¤ï¼ŒCopyOnWriteArrayListé€‚ç”¨äºŽè¯»æ“ä½œè¿œå¤šäºŽä¿®æ”¹æ“ä½œçš„å¹¶å‘åœºæ™¯ä¸­ã€‚ æ„Ÿè°¢ http://www.cnblogs.com/xrq730/p/5020760.html http://blog.csdn.net/u013124587/article/details/52863533 https://www.cnblogs.com/leesf456/p/5547853.html]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedList]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F2.LinkedList%2F</url>
    <content type="text"><![CDATA[æåˆ°ArrayListï¼Œå°±ä¼šæ¯”è¾ƒä¸ŽLinkedListçš„åŒºåˆ«ã€‚æœ¬æ–‡æ¥çœ‹çœ‹LinkedListçš„æ ¸å¿ƒåŽŸç†ã€‚ å¦‚å›¾æ‰€ç¤º LinkedList åº•å±‚æ˜¯åŸºäºŽåŒå‘é“¾è¡¨å®žçŽ°çš„ï¼Œä¹Ÿæ˜¯å®žçŽ°äº† List æŽ¥å£ï¼Œæ‰€ä»¥ä¹Ÿæ‹¥æœ‰ List çš„ä¸€äº›ç‰¹ç‚¹(JDK1.7/8 ä¹‹åŽå–æ¶ˆäº†å¾ªçŽ¯ï¼Œä¿®æ”¹ä¸ºåŒå‘é“¾è¡¨)ã€‚ ä¸€ã€LinkedListå±žæ€§ 123456//é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°.transient int size = 0;//Pointer to first node.transient Node&lt;E&gt; first;//Pointer to last node.transient Node&lt;E&gt; last; äºŒã€Nodeçš„ç»“æž„ 1234567891011private static class Node&lt;E&gt; &#123; E item; Node&lt;E&gt; next;//åŽç½®æŒ‡é’ˆ Node&lt;E&gt; prev;//å‰ç½®æŒ‡é’ˆ Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123; this.item = element; this.next = next; this.prev = prev; &#125;&#125; ä¸‰ã€æ·»åŠ å…ƒç´  3.1 LinkedListè¡¨å¤´æ·»åŠ ä¸€ä¸ªå…ƒç´  å½“å‘è¡¨å¤´æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¾ˆæ˜¾ç„¶å½“å‰èŠ‚ç‚¹çš„å‰é©±ä¸€å®šä¸º nullï¼Œè€ŒåŽç»§ç»“ç‚¹æ˜¯ first æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ï¼Œå½“ç„¶è¿˜è¦ä¿®æ”¹ first æŒ‡é’ˆæŒ‡å‘æ–°çš„å¤´èŠ‚ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒåŽŸæ¥çš„å¤´èŠ‚ç‚¹å˜æˆäº†ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿˜è¦ä¿®æ”¹åŽŸæ¥å¤´èŠ‚ç‚¹çš„å‰é©±æŒ‡é’ˆï¼Œä½¿å®ƒæŒ‡å‘è¡¨å¤´èŠ‚ç‚¹ï¼Œæºç çš„å®žçŽ°å¦‚ä¸‹ï¼š 1234567891011121314151617public void addFirst(E e) &#123; linkFirst(e);&#125;private void linkFirst(E e) &#123; final Node&lt;E&gt; f = first; //æ–°èŠ‚ç‚¹å‰ç½®æŒ‡é’ˆæŒ‡å‘ç©ºï¼ŒåŽç½®æŒ‡é’ˆæŒ‡å‘firstèŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(null, e, f); //æ–°èŠ‚ç‚¹ä½œä¸ºæ–°çš„firstèŠ‚ç‚¹ first = newNode; if (f == null) last = newNode;//åˆå§‹å°±æ˜¯ä¸ªç©ºLinkedListçš„è¯ï¼ŒlastæŒ‡å‘å½“å‰æ–°èŠ‚ç‚¹ else f.prev = newNode;//åˆå§‹å€¼ä¸ä¸ºç©ºï¼Œå°†å…¶å‰ç½®æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ size++; modCount++;&#125; 3.2 LinkedListè¡¨å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´  å½“å‘è¡¨å°¾æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå¾ˆæ˜¾ç„¶å½“å‰èŠ‚ç‚¹çš„åŽç»§ä¸€å®šä¸º nullï¼Œè€Œå‰é©±ç»“ç‚¹æ˜¯ last æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ï¼Œç„¶åŽè¿˜è¦ä¿®æ”¹ last æŒ‡é’ˆæŒ‡å‘æ–°çš„å°¾èŠ‚ç‚¹ã€‚æ­¤å¤–ï¼Œè¿˜è¦ä¿®æ”¹åŽŸæ¥å°¾èŠ‚ç‚¹çš„åŽç»§æŒ‡é’ˆï¼Œä½¿å®ƒæŒ‡å‘æ–°çš„å°¾èŠ‚ç‚¹ï¼Œæºç çš„å®žçŽ°å¦‚ä¸‹ï¼š 123456789101112131415161718public void addLast(E e) &#123; linkLast(e);&#125;void linkLast(E e) &#123; final Node&lt;E&gt; l = last; //æ–°èŠ‚ç‚¹å‰ç½®æŒ‡é’ˆæŒ‡å‘ç©ºï¼ŒåŽç½®æŒ‡é’ˆæŒ‡å‘firstèŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null); //æ–°èŠ‚ç‚¹ä½œä¸ºæ–°çš„lastèŠ‚ç‚¹ last = newNode; //å¦‚æžœåŽŸæ¥æœ‰å°¾èŠ‚ç‚¹ï¼Œåˆ™æ›´æ–°åŽŸæ¥èŠ‚ç‚¹çš„åŽç»§æŒ‡é’ˆï¼Œå¦åˆ™æ›´æ–°å¤´æŒ‡é’ˆ if (l == null) first = newNode; else l.next = newNode; size++; modCount++;&#125; 3.3 LinkedListåœ¨æŒ‡å®šèŠ‚ç‚¹å‰æ·»åŠ ä¸€ä¸ªå…ƒç´  12345678910111213141516171819202122232425262728293031323334public void add(int index, E element) &#123; //åˆ¤æ–­æ•°ç»„æ˜¯å¦è¶Šç•Œ checkPositionIndex(index); if (index == size) linkLast(element);//ç›´æŽ¥æ’åœ¨æœ€åŽä¸€ä¸ª else linkBefore(element, node(index));//åœ¨indexèŠ‚ç‚¹ä¹‹å‰æ’å…¥&#125;private void checkPositionIndex(int index) &#123; if (!isPositionIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index));&#125;private boolean isPositionIndex(int index) &#123; return index &gt;= 0 &amp;&amp; index &lt;= size;&#125;void linkBefore(E e, Node&lt;E&gt; succ) &#123; // assert succ != null; //æ‰¾åˆ°ç´¢å¼•ä½ç½®çš„å‰é¢ä¸€ä¸ªå…ƒç´ pred final Node&lt;E&gt; pred = succ.prev; //æ–°èŠ‚ç‚¹ï¼Œå‰ç½®æŒ‡é’ˆæŒ‡å‘pred,åŽç½®æŒ‡é’ˆæŒ‡å‘ç´¢å¼•å¤„å…ƒç´  final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ); //ä¿®æ”¹ç´¢å¼•å‡ºå…ƒç´ çš„å‰ç½®æŒ‡é’ˆä¸ºæ–°èŠ‚ç‚¹ succ.prev = newNode; if (pred == null) first = newNode;//è¯´æ˜Žæ˜¯æ’åœ¨è¡¨å¤´ else pred.next = newNode;//è¯´æ˜Žæ˜¯æ’åœ¨éžè¡¨å¤´ä½ç½®ï¼Œä¿®æ”¹predåŽç½®æŒ‡é’ˆä¸ºæ–°æŒ‡é’ˆ size++; modCount++;&#125; å¯è§æ¯æ¬¡æ’å…¥éƒ½æ˜¯ç§»åŠ¨æŒ‡é’ˆï¼Œå’Œ ArrayList çš„æ‹·è´æ•°ç»„æ¥è¯´æ•ˆçŽ‡è¦é«˜ä¸Šä¸å°‘ã€‚ å››ã€åˆ é™¤å…ƒç´  åˆ é™¤æ“ä½œä¸Žæ·»åŠ æ“ä½œå¤§åŒå°å¼‚ï¼Œä¾‹å¦‚åˆ é™¤æŒ‡å®šèŠ‚ç‚¹çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œéœ€è¦æŠŠå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹çš„åŽç»§ä¿®æ”¹ä¸ºå½“å‰èŠ‚ç‚¹çš„åŽç»§ï¼Œä»¥åŠå½“å‰èŠ‚ç‚¹çš„åŽç»§ç»“ç‚¹çš„å‰é©±ä¿®æ”¹ä¸ºå½“å‰èŠ‚ç‚¹çš„å‰é©±ã€‚ å°±ä¸èµ˜è¿°äº†ã€‚ äº”ã€èŽ·å–å…ƒç´  12345678910111213141516171819202122//èŽ·å–æŒ‡å®šç´¢å¼•å¯¹åº”çš„å…ƒç´ public E get(int index) &#123; checkElementIndex(index); return node(index).item;&#125;//å¯»æ‰¾å…ƒç´ çš„æ–¹å‘æ˜¯æ ¹æ®indexåœ¨è¡¨ä¸­çš„ä½ç½®å†³å®šçš„Node&lt;E&gt; node(int index) &#123; // assert isElementIndex(index); if (index &lt; (size &gt;&gt; 1)) &#123;//ç´¢å¼•å°äºŽè¡¨é•¿çš„ä¸€åŠï¼Œä»Žè¡¨å¤´å¼€å§‹å¾€åŽæ‰¾ Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123;//ç´¢å¼•å¤§äºŽè¡¨é•¿çš„ä¸€åŠï¼Œä»Žè¡¨å°¾å¾€å‰å¼€å§‹æ‰¾ Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; &#125;&#125; ä¸Šè¿°ä»£ç ï¼Œåˆ©ç”¨äº†åŒå‘é“¾è¡¨çš„ç‰¹æ€§ï¼Œå¦‚æžœindexç¦»é“¾è¡¨å¤´æ¯”è¾ƒè¿‘ï¼Œå°±ä»ŽèŠ‚ç‚¹å¤´éƒ¨éåŽ†ã€‚å¦åˆ™å°±ä»ŽèŠ‚ç‚¹å°¾éƒ¨å¼€å§‹éåŽ†ã€‚ä½¿ç”¨ç©ºé—´ï¼ˆåŒå‘é“¾è¡¨ï¼‰æ¥æ¢å–æ—¶é—´ã€‚ node()ä¼šä»¥O(n/2)çš„æ€§èƒ½åŽ»èŽ·å–ä¸€ä¸ªç»“ç‚¹ å¦‚æžœç´¢å¼•å€¼å¤§äºŽé“¾è¡¨å¤§å°çš„ä¸€åŠï¼Œé‚£ä¹ˆå°†ä»Žå°¾ç»“ç‚¹å¼€å§‹éåŽ† è¿™æ ·çš„æ•ˆçŽ‡æ˜¯éžå¸¸ä½Žçš„ï¼Œç‰¹åˆ«æ˜¯å½“ index è¶ŠæŽ¥è¿‘ size çš„ä¸­é—´å€¼æ—¶ã€‚ æ€»ç»“ 1ã€ç†è®ºä¸Šæ— å®¹é‡é™åˆ¶ï¼Œåªå—è™šæ‹Ÿæœºè‡ªèº«é™åˆ¶å½±å“ï¼Œæ‰€ä»¥æ²¡æœ‰æ‰©å®¹æ–¹æ³•ã€‚ 2ã€å’ŒArrayListä¸€æ ·ï¼ŒLinkedListä¹Ÿæ˜¯æ˜¯æœªåŒæ­¥çš„ï¼Œå¤šçº¿ç¨‹å¹¶å‘è¯»å†™æ—¶éœ€è¦å¤–éƒ¨åŒæ­¥ï¼Œå¦‚æžœä¸å¤–éƒ¨åŒæ­¥ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨Collections.synchronizedListæ–¹æ³•å¯¹LinkedListçš„å®žä¾‹è¿›è¡Œä¸€æ¬¡å°è£…ã€‚ 3ã€å’ŒArrayListä¸€æ ·ï¼ŒLinkedListä¹Ÿå¯¹å­˜å‚¨çš„å…ƒç´ æ— é™åˆ¶ï¼Œå…è®¸nullå…ƒç´ ã€‚ 4ã€é¡ºåºæ’å…¥é€Ÿåº¦ArrayListä¼šæ¯”è¾ƒå¿«ï¼Œå› ä¸ºArrayListæ˜¯åŸºäºŽæ•°ç»„å®žçŽ°çš„ï¼Œæ•°ç»„æ˜¯äº‹å…ˆnewå¥½çš„ï¼Œåªè¦å¾€æŒ‡å®šä½ç½®å¡žä¸€ä¸ªæ•°æ®å°±å¥½äº†ï¼›LinkedListåˆ™ä¸åŒï¼Œæ¯æ¬¡é¡ºåºæ’å…¥çš„æ—¶å€™LinkedListå°†newä¸€ä¸ªå¯¹è±¡å‡ºæ¥ï¼Œå¦‚æžœå¯¹è±¡æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆnewçš„æ—¶é—´åŠ¿å¿…ä¼šé•¿ä¸€ç‚¹ï¼Œå†åŠ ä¸Šä¸€äº›å¼•ç”¨èµ‹å€¼çš„æ“ä½œï¼Œæ‰€ä»¥é¡ºåºæ’å…¥LinkedListå¿…ç„¶æ…¢äºŽArrayList 5ã€åŸºäºŽä¸Šä¸€ç‚¹ï¼Œå› ä¸ºLinkedListé‡Œé¢ä¸ä»…ç»´æŠ¤äº†å¾…æ’å…¥çš„å…ƒç´ ï¼Œè¿˜ç»´æŠ¤äº†Entryçš„å‰ç½®Entryå’ŒåŽç»§Entryï¼Œå¦‚æžœä¸€ä¸ªLinkedListä¸­çš„Entryéžå¸¸å¤šï¼Œé‚£ä¹ˆLinkedListå°†æ¯”ArrayListæ›´è€—è´¹ä¸€äº›å†…å­˜ 6ã€æ•°æ®éåŽ†çš„é€Ÿåº¦ï¼Œçœ‹æœ€åŽä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œå°±ä¸ç»†è®²äº†ï¼Œç»“è®ºæ˜¯ï¼šä½¿ç”¨å„è‡ªéåŽ†æ•ˆçŽ‡æœ€é«˜çš„æ–¹å¼ï¼ŒArrayListçš„éåŽ†æ•ˆçŽ‡ä¼šæ¯”LinkedListçš„éåŽ†æ•ˆçŽ‡é«˜ä¸€äº› 7ã€æœ‰äº›è¯´æ³•è®¤ä¸ºLinkedListåšæ’å…¥å’Œåˆ é™¤æ›´å¿«ï¼Œè¿™ç§è¯´æ³•å…¶å®žæ˜¯ä¸å‡†ç¡®çš„ï¼š LinkedListåšæ’å…¥ã€åˆ é™¤çš„æ—¶å€™ï¼Œæ…¢åœ¨å¯»å€ï¼Œå¿«åœ¨åªéœ€è¦æ”¹å˜å‰åŽEntryçš„å¼•ç”¨åœ°å€ ArrayListåšæ’å…¥ã€åˆ é™¤çš„æ—¶å€™ï¼Œæ…¢åœ¨æ•°ç»„å…ƒç´ çš„æ‰¹é‡copyï¼Œå¿«åœ¨å¯»å€ æ‰€ä»¥ï¼Œå¦‚æžœå¾…æ’å…¥ã€åˆ é™¤çš„å…ƒç´ æ˜¯åœ¨æ•°æ®ç»“æž„çš„å‰åŠæ®µå°¤å…¶æ˜¯éžå¸¸é å‰çš„ä½ç½®çš„æ—¶å€™ï¼ŒLinkedListçš„æ•ˆçŽ‡å°†å¤§å¤§å¿«è¿‡ArrayListï¼Œå› ä¸ºArrayListå°†æ‰¹é‡copyå¤§é‡çš„å…ƒç´ ï¼›è¶Šå¾€åŽï¼Œå¯¹äºŽLinkedListæ¥è¯´ï¼Œå› ä¸ºå®ƒæ˜¯åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥åœ¨ç¬¬2ä¸ªå…ƒç´ åŽé¢æ’å…¥ä¸€ä¸ªæ•°æ®å’Œåœ¨å€’æ•°ç¬¬2ä¸ªå…ƒç´ åŽé¢æ’å…¥ä¸€ä¸ªå…ƒç´ åœ¨æ•ˆçŽ‡ä¸ŠåŸºæœ¬æ²¡æœ‰å·®åˆ«ï¼Œä½†æ˜¯ArrayListç”±äºŽè¦æ‰¹é‡copyçš„å…ƒç´ è¶Šæ¥è¶Šå°‘ï¼Œæ“ä½œé€Ÿåº¦å¿…ç„¶è¿½ä¸Šä¹ƒè‡³è¶…è¿‡LinkedListã€‚ ä»Žè¿™ä¸ªåˆ†æžçœ‹å‡ºï¼Œå¦‚æžœä½ ååˆ†ç¡®å®šä½ æ’å…¥ã€åˆ é™¤çš„å…ƒç´ æ˜¯åœ¨å‰åŠæ®µï¼Œé‚£ä¹ˆå°±ä½¿ç”¨LinkedListï¼›å¦‚æžœä½ ååˆ†ç¡®å®šä½ åˆ é™¤ã€åˆ é™¤çš„å…ƒç´ åœ¨æ¯”è¾ƒé åŽçš„ä½ç½®ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ArrayListã€‚å¦‚æžœä½ ä¸èƒ½ç¡®å®šä½ è¦åšçš„æ’å…¥ã€åˆ é™¤æ˜¯åœ¨å“ªå„¿å‘¢ï¼Ÿé‚£è¿˜æ˜¯å»ºè®®ä½ ä½¿ç”¨LinkedListå§ï¼Œå› ä¸ºä¸€æ¥LinkedListæ•´ä½“æ’å…¥ã€åˆ é™¤çš„æ‰§è¡Œæ•ˆçŽ‡æ¯”è¾ƒç¨³å®šï¼Œæ²¡æœ‰ArrayListè¿™ç§è¶Šå¾€åŽè¶Šå¿«çš„æƒ…å†µï¼›äºŒæ¥æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œå¼„å¾—ä¸å¥½ArrayListå°±è¦è¿›è¡Œä¸€æ¬¡æ‰©å®¹ï¼Œè®°ä½ï¼ŒArrayListåº•å±‚æ•°ç»„æ‰©å®¹æ˜¯ä¸€ä¸ªæ—¢æ¶ˆè€—æ—¶é—´åˆæ¶ˆè€—ç©ºé—´çš„æ“ä½œ. 8ã€ArrayListä½¿ç”¨æœ€æ™®é€šçš„forå¾ªçŽ¯éåŽ†ï¼ŒLinkedListä½¿ç”¨foreachå¾ªçŽ¯æ¯”è¾ƒå¿«.æ³¨æ„åˆ°ArrayListæ˜¯å®žçŽ°äº†RandomAccessæŽ¥å£è€ŒLinkedListåˆ™æ²¡æœ‰å®žçŽ°è¿™ä¸ªæŽ¥å£.å…³äºŽRandomAccessè¿™ä¸ªæŽ¥å£çš„ä½œç”¨ï¼Œçœ‹ä¸€ä¸‹JDK APIä¸Šçš„è¯´æ³•ï¼š 9ã€å¦‚æžœä½¿ç”¨æ™®é€šforå¾ªçŽ¯éåŽ†LinkedListï¼Œåœ¨å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œå…¶éåŽ†é€Ÿåº¦å°†æ…¢å¾—ä»¤äººå‘æŒ‡ æ•´ç†è‡ªï¼š 1ã€http://www.cnblogs.com/xrq730/p/5005347.html 2ã€http://blog.csdn.net/u013124587/article/details/52837848 3ã€http://blog.csdn.net/u011392897/article/details/57115818 4ã€http://blog.csdn.net/fighterandknight/article/details/61476335]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ArrayList/Vector]]></title>
    <url>%2F2019%2F01%2F20%2Fjava-collection%2F1.ArrayList%E5%92%8CVector%2F</url>
    <content type="text"><![CDATA[é¢è¯•ä¸­ï¼Œå…³äºŽjavaçš„ä¸€äº›å®¹å™¨ï¼ŒArrayListæ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸é—®çš„ï¼Œå°¤å…¶æ˜¯é‡Œé¢çš„æ‰©å®¹æœºåˆ¶ã€‚ ArrayList 12public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable ArrayList å®žçŽ°äºŽ Listã€RandomAccess æŽ¥å£ã€‚å¯ä»¥æ’å…¥ç©ºæ•°æ®ï¼Œä¹Ÿæ”¯æŒéšæœºè®¿é—®ã€‚ æž„é€ å‡½æ•°ä¸ºï¼š 123456789101112131415161718//ç”¨åˆå§‹å®¹é‡ä½œä¸ºå‚æ•°çš„æž„é€ æ–¹æ³•public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; //åˆå§‹å®¹é‡å¤§äºŽ0ï¼Œå®žä¾‹åŒ–æ•°ç»„ this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; //åˆå§‹å®¹é‡ç­‰äºŽ0ï¼Œèµ‹äºˆç©ºæ•°ç»„ this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; throw new IllegalArgumentException("Illegal Capacity: "+ initialCapacity); &#125;&#125;//æ— å‚çš„æž„é€ æ–¹æ³•public ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;&#125; ä»Žæž„é€ æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒelementDataæ˜¯ä¸€ä¸ªå¤§å°ä¸º0çš„ç©ºæ•°ç»„ï¼Œå½“æˆ‘ä»¬æŒ‡å®šäº†åˆå§‹å¤§å°çš„æ—¶å€™ï¼ŒelementDataçš„åˆå§‹å¤§å°å°±å˜æˆäº†æˆ‘ä»¬æ‰€æŒ‡å®šçš„åˆå§‹å¤§å°äº†ã€‚ ArrayListç›¸å½“äºŽåŠ¨æ€æ•°æ®ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªå±žæ€§åˆ†åˆ«æ˜¯: elementData æ•°ç»„ï¼Œä»¥åŠ size å¤§å°ã€‚ åœ¨è°ƒç”¨ add() æ–¹æ³•çš„æ—¶å€™ï¼š 12345public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true;&#125; é¦–å…ˆè¿›è¡Œæ‰©å®¹æ ¡éªŒã€‚ å°†æ’å…¥çš„å€¼æ”¾åˆ°å°¾éƒ¨ï¼Œå¹¶å°† size + 1 ã€‚ å¦‚æžœæ˜¯è°ƒç”¨ add(index,e) åœ¨æŒ‡å®šä½ç½®æ·»åŠ çš„è¯ï¼š 12345678910public void add(int index, E element) &#123; rangeCheckForAdd(index); ensureCapacityInternal(size + 1); // Increments modCount!! //å¤åˆ¶ï¼Œå‘åŽç§»åŠ¨ System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++;&#125; ä¹Ÿæ˜¯é¦–å…ˆæ‰©å®¹æ ¡éªŒã€‚ æŽ¥ç€å¯¹æ•°æ®è¿›è¡Œå¤åˆ¶ï¼Œç›®çš„æ˜¯æŠŠ index ä½ç½®ç©ºå‡ºæ¥æ”¾æœ¬æ¬¡æ’å…¥çš„æ•°æ®ï¼Œå¹¶å°†åŽé¢çš„æ•°æ®å‘åŽç§»åŠ¨ä¸€ä¸ªä½ç½®ã€‚ å…¶å®žæ‰©å®¹æœ€ç»ˆè°ƒç”¨çš„ä»£ç : 1234567891011private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity);&#125; ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„å¤åˆ¶çš„è¿‡ç¨‹ï¼ŒArrayListæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯æ‰©1.5å€ï¼Œç„¶åŽè°ƒç”¨Arraysç±»çš„copyOfæ–¹æ³•ï¼ŒæŠŠå…ƒç´ é‡æ–°æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­åŽ»ã€‚ ç”±æ­¤å¯è§ ArrayList çš„ä¸»è¦æ¶ˆè€—æ˜¯æ•°ç»„æ‰©å®¹ä»¥åŠåœ¨æŒ‡å®šä½ç½®æ·»åŠ æ•°æ®ï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨æ—¶æœ€å¥½æ˜¯æŒ‡å®šå¤§å°ï¼Œå°½é‡å‡å°‘æ‰©å®¹ã€‚æ›´è¦å‡å°‘åœ¨æŒ‡å®šä½ç½®æ’å…¥æ•°æ®çš„æ“ä½œã€‚ åºåˆ—åŒ– ç”±äºŽ ArrayList æ˜¯åŸºäºŽåŠ¨æ€æ•°ç»„å®žçŽ°çš„ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ã€‚å› æ­¤ä½¿ç”¨äº† transient ä¿®é¥°ï¼Œå¯ä»¥é˜²æ­¢è¢«è‡ªåŠ¨åºåˆ—åŒ–ã€‚ 1transient Object[] elementData; å› æ­¤ ArrayList è‡ªå®šä¹‰äº†åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException&#123; // Write out element count, and any hidden stuff int expectedModCount = modCount; s.defaultWriteObject(); // Write out size as capacity for behavioural compatibility with clone() s.writeInt(size); // Write out all elements in the proper order. //åªåºåˆ—åŒ–äº†è¢«ä½¿ç”¨çš„æ•°æ® for (int i=0; i&lt;size; i++) &#123; s.writeObject(elementData[i]); &#125; if (modCount != expectedModCount) &#123; throw new ConcurrentModificationException(); &#125;&#125;private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException &#123; elementData = EMPTY_ELEMENTDATA; // Read in size, and any hidden stuff s.defaultReadObject(); // Read in capacity s.readInt(); // ignored if (size &gt; 0) &#123; // be like clone(), allocate array based upon size not capacity ensureCapacityInternal(size); Object[] a = elementData; // Read in all elements in the proper order. for (int i=0; i&lt;size; i++) &#123; a[i] = s.readObject(); &#125; &#125;&#125; å½“å¯¹è±¡ä¸­è‡ªå®šä¹‰äº† writeObject å’Œ readObject æ–¹æ³•æ—¶ï¼ŒJVM ä¼šè°ƒç”¨è¿™ä¸¤ä¸ªè‡ªå®šä¹‰æ–¹æ³•æ¥å®žçŽ°åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–ã€‚ ä»Žå®žçŽ°ä¸­å¯ä»¥çœ‹å‡º ArrayList åªåºåˆ—åŒ–äº†è¢«ä½¿ç”¨çš„æ•°æ®ã€‚ Vector Vector ä¹Ÿæ˜¯å®žçŽ°äºŽ List æŽ¥å£ï¼Œåº•å±‚æ•°æ®ç»“æž„å’Œ ArrayList ç±»ä¼¼,ä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„å­˜æ”¾æ•°æ®ã€‚ä¸è¿‡æ˜¯åœ¨ add() æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨ synchronized è¿›è¡ŒåŒæ­¥å†™æ•°æ®ï¼Œä½†æ˜¯å¼€é”€è¾ƒå¤§ï¼Œæ‰€ä»¥ Vector æ˜¯ä¸€ä¸ªåŒæ­¥å®¹å™¨å¹¶ä¸æ˜¯ä¸€ä¸ªå¹¶å‘å®¹å™¨ã€‚ Vectoræ¯”ArrayListå¤šäº†ä¸€ä¸ªå±žæ€§ï¼š 1protected int capacityIncrement; è¿™ä¸ªå±žæ€§æ˜¯åœ¨æ‰©å®¹çš„æ—¶å€™ç”¨åˆ°çš„ï¼Œå®ƒè¡¨ç¤ºæ¯æ¬¡æ‰©å®¹åªæ‰©capacityIncrementä¸ªç©ºé—´å°±è¶³å¤Ÿäº†ã€‚è¯¥å±žæ€§å¯ä»¥é€šè¿‡æž„é€ æ–¹æ³•ç»™å®ƒèµ‹å€¼ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹æž„é€ æ–¹æ³•ï¼š 123456789101112131415public Vector(int initialCapacity, int capacityIncrement) &#123; super(); if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal Capacity: "+initialCapacity); this.elementData = new Object[initialCapacity]; this.capacityIncrement = capacityIncrement;&#125;public Vector(int initialCapacity) &#123; this(initialCapacity, 0);&#125;public Vector() &#123; this(10);&#125; ä»Žæž„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºVectorçš„é»˜è®¤å¤§å°ä¹Ÿæ˜¯10ï¼Œè€Œä¸”å®ƒåœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±å·²ç»åˆ›å»ºäº†æ•°ç»„äº†ï¼Œè¿™ç‚¹è·ŸArrayListä¸ä¸€æ ·ã€‚å†æ¥çœ‹ä¸€ä¸‹growæ–¹æ³•ï¼š 12345678910private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); elementData = Arrays.copyOf(elementData, newCapacity);&#125; ä»Žgrowæ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼ŒnewCapacityé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸¤å€çš„oldCapacityï¼Œè€Œå½“æŒ‡å®šäº†capacityIncrementçš„å€¼ä¹‹åŽï¼ŒnewCapacityå˜æˆäº†oldCapacity+capacityIncrementã€‚ ä»¥ä¸‹æ˜¯ add() æ–¹æ³•ï¼š 123456public synchronized boolean add(E e) &#123; modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = e; return true;&#125; ä»¥åŠæŒ‡å®šä½ç½®æ’å…¥æ•°æ®: 12345678910111213public void add(int index, E element) &#123; insertElementAt(element, index);&#125;public synchronized void insertElementAt(E obj, int index) &#123; modCount++; if (index &gt; elementCount) &#123; throw new ArrayIndexOutOfBoundsException(index + " &gt; " + elementCount); &#125; ensureCapacityHelper(elementCount + 1); System.arraycopy(elementData, index, elementData, index + 1, elementCount - index); elementData[index] = obj; elementCount++;&#125;]]></content>
      <tags>
        <tag>javaå®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2018å¹´çš„æœ€åŽä¸€å¤©ï¼Œå¯¹å•†åŸŽé¡¹ç›®çš„æž¶æž„åšä¸ªæ”¹é€ ]]></title>
    <url>%2F2019%2F01%2F20%2F2018%E5%B9%B4%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9%EF%BC%8C%E5%AF%B9%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%9E%B6%E6%9E%84%E5%81%9A%E4%B8%AA%E6%94%B9%E9%80%A0%2F</url>
    <content type="text"><![CDATA[ä¸€ç›´ä»¥æ¥éƒ½æ˜¯å­¦ä¹ æ…•è¯¾çš„å®žæˆ˜è§†é¢‘ï¼Œè™½ç„¶ä¹Ÿè·Ÿç€åšå‡ºäº†ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯æ€è·¯éƒ½æ˜¯åˆ«äººæä¾›å¥½çš„ï¼Œè„±ç¦»äº†è€å¸ˆï¼Œæˆ‘ä¸€ç›´åœ¨é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šèƒ½ä¸èƒ½ç‹¬ç«‹åœ°æŒ‰ç…§è‡ªå·±çš„æ€è·¯åšå‡ºä¸€äº›ä¸œè¥¿æ¥ï¼Ÿ å‰æ–¹å›¾ç‰‡é«˜èƒ½â€¦æ›´æœ‰å‡ åå…†gifæ¼”ç¤ºåŠ¨ç”»ï¼Œå›¾ç‰‡å…¨éƒ¨å­˜æ”¾äºŽä¸ƒç‰›äº‘ä¸Šã€‚ åœ¨åŽ»å¹´ï¼Œå³2017å¹´å¹´åº•ï¼Œæˆ‘åœ¨æ…•è¯¾ä¸Šå­¦ä¹ äº†è¿™ä¸¤é—¨è¯¾ç¨‹ï¼š ç¬¬ä¸€æœŸé¡¹ç›®å®žçŽ°äº†æ¯”è¾ƒç®€å•çš„ç”µå•†ä¸šåŠ¡ï¼Œæ•´åˆSSMï¼Œå¹¶ä¸”éƒ¨ç½²åˆ°äº‘ç«¯ã€‚ ç¬¬äºŒæœŸå®žçŽ°äº†tomcaté›†ç¾¤ï¼Œé…åˆrediså®žçŽ°åˆ†å¸ƒå¼sessionï¼Œè¿˜æœ‰ä¸€äº›å®šæ—¶ä»»åŠ¡ã€redisåˆ†å¸ƒå¼é”ã€mavençŽ¯å¢ƒéš”ç¦»çš„ä¸€äº›ä¸œè¥¿ï¼Œè¿˜æ¶‰åŠå¾ˆå¤šspringå’Œspringmvcçš„æœ‰ç”¨çš„æœºå·§ã€‚ æ•´ä½“æ„Ÿè§‰æ˜¯ï¼šä¸€æœŸå®žçŽ°ä¸šåŠ¡ï¼ŒäºŒæœŸå¯¹äºŽä¸€æœŸçš„æé«˜ä¸æ˜¯å¤ªå¤§ï¼Œè·Ÿåˆ†å¸ƒå¼æ— å¤ªå¤§å…³ç³»ï¼Œä»…ä»…å®žçŽ°äº†å•ç‚¹ç™»é™†å’Œåˆ†å¸ƒå¼sessionå­˜å‚¨è€Œå·²ã€‚ ä¸ªäººæ„Ÿè§‰ä¸‹ä¸€æœŸçš„è¯¾ç¨‹åº”è¯¥æ˜¯springCloudçš„åˆ†å¸ƒå¼æ”¹é€ ï¼Œè¿›è¡ŒæœåŠ¡æ‹†åˆ†å’Œæ²»ç†ã€‚æ‰€ä»¥ï¼Œåœ¨æ•´åˆè¿™ä¸¤ä¸ªè¯¾ç¨‹çš„åŸºç¡€ä¸Šç”¨springCloudè¿›è¡Œå¾®æœåŠ¡æ²»ç†ã€‚ é¡¹ç›®è¯¦ç»†æè¿° é¡¹ç›®æºç åœ°å€ï¼šhttps://github.com/sunweiguo/MMall æ•´ä½“æ•ˆæžœæ¼”ç¤ºï¼š ä¸‹é¢è´´ä¸ªå°ä¸€ç‚¹çš„gif: éƒ¨åˆ†é¡µé¢æˆªå›¾ï¼š ç»è¿‡ä¸€ééæµ‹è¯•ï¼Œå•†åŸŽè¿˜æ˜¯å­˜åœ¨ä¸€äº›æ— ä¼¤å¤§é›…çš„bugï¼Œä½†æ˜¯ä¸»è¦è¿˜æ˜¯é”»ç‚¼è‡ªå·±çš„èƒ½åŠ›å˜›ï¼ ä¸‹è®¢å•çš„æ—¶å€™ï¼ŒæŠ¥é”™ï¼šå•†å“ä¸å­˜åœ¨æˆ–åº“å­˜ä¸è¶³ï¼Œæ˜¯å› ä¸ºæˆ‘æ¨¡æ‹Ÿçš„ç§’æ€ï¼Œæ‰€ä»¥å•†å“çš„åº“å­˜è¦æå‰é¢„ç½®äºŽredisä¸­ï¼ŒåŽç«¯ç®¡ç†ç³»ç»Ÿçš„å•†å“ç®¡ç†é¡µé¢æœ‰é¢„ç½®åº“å­˜çš„æŒ‰é’®ã€‚ æ–°å¢žå•†å“çš„æ—¶å€™ï¼Œå¯¹äºŽä¸Šä¼ å›¾ç‰‡ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ä¸€ä¼šï¼Œéœ€è¦ç­‰å¾…FTPæœåŠ¡å™¨ä¸Šä¼ å®Œæ¯•ï¼Œç»™ä¸€ä¸ªè¿”å›žä¿¡æ¯(Mapï¼Œæ˜¯å›¾ç‰‡çš„æ–‡ä»¶å)æ‰èƒ½çœŸæ­£æ˜¾ç¤ºï¼ˆå¯¹äºŽå¯Œæ–‡æœ¬ä¸­çš„å›¾ç‰‡ä¸Šä¼ ï¼Œåœ¨ä¸Šä¼ ä¹‹åŽéœ€è¦ç­‰å¾…ä¸€ä¼šï¼Œæ—¶é—´ä¸Žå°å›¾ä¸Šä¼ å·®ä¸å¤šï¼Œå¦åˆ™ç›´æŽ¥ä¿å­˜ä¸æŠ¥é”™ï¼Œä½†æ˜¯å‰ç«¯çœ‹ä¸åˆ°å›¾ï¼Œå› ä¸ºè¿˜æ²¡ä¸Šä¼ å®Œæ¯•,urlè¿˜æ²¡å›žä¼ å›žæ¥ï¼‰ æ™®é€šæ³¨å†Œçš„è´¦å·ï¼Œæ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæ‰€ä»¥ä¸èƒ½ç™»é™†åŽå°ç®¡ç†ç³»ç»Ÿã€‚ åŽæ¥åšäº†eurekaé›†ç¾¤ï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶è¿˜æ˜¯åªæŒ‡å‘å…¶ä¸­ä¸€ä¸ªeureka åœ¨å­¦ä¹ çš„è§†é¢‘ä¸­ï¼Œä¸€æœŸåªæ˜¯å®žçŽ°ä¸šåŠ¡åŠŸèƒ½ï¼Œå•ä½“æž¶æž„ï¼Œä¸€ä¸ªtomcatã€‚äºŒæœŸå¯¹å…¶åšäº†é›†ç¾¤ï¼Œå¹¶ä¸”è§£å†³äº†é›†ç¾¤æ¨¡å¼ä¸‹sessionå­˜å‚¨é—®é¢˜ï¼Œå®žçŽ°äº†æ¯”è¾ƒç®€å•çš„å•ç‚¹ç™»é™†åŠŸèƒ½ã€‚æž¶æž„å¦‚ä¸‹ï¼š å¯¹äºŽä¸Šé¢çš„æž¶æž„æ¥è¯´ï¼Œåªæ˜¯åšäº†ä¸€äº›é›†ç¾¤è¿›è¡Œä¼˜åŒ–ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œç”¨æˆ·æœåŠ¡ç­‰å…¶ä»–æœåŠ¡å¿…ç„¶è¦æ‹†åˆ†å‡ºæ¥ç‹¬ç«‹æˆä¸ºä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸€æ–¹é¢ä¸€ä¸ªå›¢é˜Ÿè´Ÿè´£ä¸€ä¸ªæœåŠ¡å¯ä»¥æé«˜å¼€å‘æ•ˆçŽ‡ï¼Œå¦å¤–ï¼Œå¯¹äºŽæ‰©å±•æ€§ä¹Ÿæ˜¯éžå¸¸æœ‰åˆ©çš„ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œä¼šå¸¦æ¥å¾ˆå¤šçš„å¤æ‚æ€§ï¼Œå°¤å…¶æ˜¯å¼•å…¥äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ‰€ä»¥ä¸èƒ½ä¸ºäº†åˆ†å¸ƒå¼è€Œåˆ†å¸ƒå¼ï¼Œè€Œæ˜¯é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯è€Œé‡‡ç”¨åˆé€‚çš„æž¶æž„ã€‚ å¾®æœåŠ¡çš„å®žçŽ°ï¼Œä¸»è¦æœ‰ä¸¤ç§ï¼Œå›½å†…æ˜¯é˜¿é‡Œç³»çš„ä»¥dubbo+zookeeperä¸ºæ ¸å¿ƒçš„ä¸€å¥—æœåŠ¡æ²»ç†å’Œå‘çŽ°ç”Ÿæ€ã€‚å¦ä¸€ä¸ªåˆ™æ˜¯å¤§åé¼Žé¼Žçš„spring cloudæ ˆã€‚ spring cloudå¹¶ä¸æ˜¯åƒspringæ˜¯ä¸€ä¸ªæ¡†æž¶ï¼Œä»–æ˜¯è§£å†³å¾®æœåŠ¡çš„ä¸€ç§æ–¹æ¡ˆï¼Œæ˜¯ç”±å„ç§ä¼˜ç§€å¼€æºç»„ä»¶å…±åŒé…åˆè€Œå®žçŽ°çš„å¾®æœåŠ¡æ²»ç†æž¶æž„ã€‚ä¸‹é¢çš„å›¾æ˜¯æˆ‘æž„æ€çš„é¡¹ç›®ç»“æž„å›¾ï¼š æœ€å‰é¢æ˜¯Nginxï¼Œè¿™é‡Œå°±ä½œä¸ºä¸€ä¸ªé™æ€èµ„æºæ˜ å°„å’Œè´Ÿè½½å‡è¡¡ï¼Œnginxä¸­æœ‰å‡ ä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºwww.oursnail.cn.confï¼Œè¿™ä¸ªä¸»è¦æ˜¯å¯¹zuulç½‘å…³åœ°å€åšä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼ŒæŒ‡å‘ç½‘å…³æ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ‰¾åˆ°å‰å°é¡µé¢æ‰€åœ¨ä½ç½®å¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“ã€‚admin.oursnail.cn.confï¼Œè¿™ä¸ªä¸»è¦æ˜¯é…ç½®åŽç«¯ä»¥åŠåŽç«¯çš„é¡µé¢æ–‡ä»¶ï¼›img.oursnail.cn.confæ˜¯å¯¹å›¾ç‰‡æœåŠ¡å™¨åœ°å€è¿›è¡Œæ˜ å°„ã€‚ ç„¶åŽæ˜¯zuulç½‘å…³ï¼Œè¿™é‡Œä¸»è¦æ˜¯ç”¨æ¥é™æµã€é‰´æƒä»¥åŠè·¯ç”±è½¬å‘ã€‚ å†åŽé¢å°±æ˜¯æˆ‘ä»¬çš„åº”ç”¨æœåŠ¡å™¨å•¦ã€‚å¯¹æœåŠ¡å™¨è¿›è¡Œäº†æœåŠ¡è¿½è¸ª(sleuth)ï¼Œå®žçŽ°äº†åŠ¨æ€åˆ·æ–°é…ç½®(spring cloud config+bus)ç­‰åŠŸèƒ½ã€‚ä»¥http restfulçš„æ–¹å¼è¿›è¡Œé€šä¿¡(openFeign),æž„å»ºèµ·ä»¥eurekaä¸ºæ³¨å†Œä¸­å¿ƒçš„åˆ†å¸ƒå¼æž¶æž„ã€‚ æ¯ä¸ªæœåŠ¡éƒ½æ˜¯åŸºäºŽspringbootæ‰“é€ ï¼Œç»“åˆmybatisæŒä¹…å±‚æ“ä½œçš„æ¡†æž¶ï¼Œå®ŒæˆåŸºæœ¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚springbootåŸºäºŽspringï¼Œç‰¹ç‚¹æ˜¯å¿«é€Ÿå¯åŠ¨ã€å†…ç½®tomcatä»¥åŠæ— xmlé…ç½®ã€‚å°†å¾ˆå¤šä¸œè¥¿å°è£…èµ·æ¥ï¼Œå¼•å…¥pomå°±å¯ä»¥ç›´æŽ¥ä½¿ç”¨ï¼Œæ¯”å¦‚springMVCå°±åŸºæœ¬ä¸Šå¼•å…¥starter-webå³å¯ã€‚ ç”±äºŽèµ„æºçš„åŽŸå› ï¼Œåªæœ‰ä¸‰å°æœ€ä½Žé…çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥æœ¬æ¥æƒ³åšçš„åŸºäºŽESçš„å…¨æ–‡æ£€ç´¢æœåŠ¡æ²¡æœ‰åšï¼Œä¹Ÿæ²¡æœ‰åˆ†åº“åˆ†è¡¨ã€‚ è‡³äºŽå®šæ—¶ä»»åŠ¡ä»¥åŠHystrixæœåŠ¡ç†”æ–­å’Œé™çº§ï¼Œæ¯”è¾ƒç®€å•ï¼Œå°±ä¸åšäº†ã€‚ é¡¹ç›®çš„æŽ¥å£æ–‡æ¡£è¯¦è§wikiï¼šhttps://github.com/sunweiguo/spring-cloud-for-snailmall/wiki é¡¹ç›®çš„æ•°æ®åº“è¡¨è®¾è®¡ï¼šsnailmall.sql ä¸‹é¢è¯¦ç»†ä»‹ç»æ¯ä¸ªæ¨¡å—å®žçŽ°çš„å¤§ä½“æ€è·¯ï¼ˆä»…ä¾›å‚è€ƒï¼Œæ¯•ç«Ÿåº”å±Šç”Ÿï¼ŒçœŸå®žé¡¹ç›®æ²¡åšè¿‡ï¼‰ï¼š ç”¨æˆ·æ¨¡å— å…³äºŽç”¨æˆ·æ¨¡å—ï¼Œæ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ç™»é™†ã€‚å†æ ¸å¿ƒæ˜¯å¦‚ä½•éªŒè¯ä»¥åŠå¦‚ä½•å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€‚è¿™é‡Œé‡‡å–çš„æ–¹æ¡ˆä¸ºï¼š å¯¹äºŽç”¨æˆ·æ³¨å†Œï¼Œæˆ‘è¿™é‡Œå°±æ˜¯ç”¨æˆ·åï¼ˆæ˜µç§°ï¼‰ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯ä¸é‡å¤å‘¢ï¼ˆé«˜å¹¶å‘ï¼‰ï¼Ÿè¿™é‡Œè¿˜æ˜¯ç”¨äº†åˆ†å¸ƒå¼é”æ¥ä¿è¯çš„ã€‚ å¯¹äºŽæœªç™»é™†ç« å°ä¸‹ç”¨æˆ·ä¿®æ”¹å¯†ç ï¼Œé€»è¾‘ä¸ºï¼š è´­ç‰©è½¦æ¨¡å— è®¢å•æ¨¡å— é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œæˆ‘æƒ³è¯´ä¸€ä¸‹æˆ‘çš„æ€è·¯ã€‚ å¯¹äºŽå¹‚ç­‰æ€§ï¼Œè¿™é‡Œäº§ç”Ÿå¹‚ç­‰æ€§çš„ä¸»è¦åŽŸå› åœ¨äºŽMQçš„é‡ä¼ æœºåˆ¶ï¼Œå¯èƒ½ç¬¬ä¸€ä¸ªæ¶ˆæ¯ä¹…ä¹…æ²¡æœ‰å‘å‡ºåŽ»ï¼Œç„¶åŽé‡æ–°å‘é€ä¸€æ¡ï¼Œç»“æžœç¬¬ä¸€æ¡æ¶ˆæ¯çªç„¶åˆå¥½äº†ï¼Œé‚£ä¹ˆå°±ä¼šé‡å¤å‘ä¸¤è·³ï¼Œå¯¹äºŽç”¨æˆ·æ¥è¯´ï¼Œåªä¸‹ä¸€æ¬¡å•ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸‹äº†å¤šæ¬¡è®¢å•ã€‚ç½‘ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜çš„æ€è·¯æ˜¯åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¦‚æžœæ˜¯é‡å¤çš„è®¢å•å·ï¼Œå°±ä¸å¯èƒ½åˆ›å»ºå¤šæ¬¡äº†ã€‚è¿˜æœ‰ä¸€ç§å¯èƒ½æ–¹æ¡ˆæ˜¯ç”¨åˆ†å¸ƒå¼é”å¯¹è¯¥è®¢å•å·é”ä½ä¸€æ®µæ—¶é—´ï¼Œç”±äºŽåªæ˜¯é”ä½è®¢å•å·ï¼Œæ‰€ä»¥ä¸å½±å“æ€§èƒ½ï¼Œåœ¨è¿™ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸å¯ä»¥å†æ”¾åŒä¸€ä¸ªè®¢å•å·çš„è¯·æ±‚è¿›æ¥ã€‚ å¯¹äºŽMQæ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œåªèƒ½æ˜¯è®¢é˜…æ¨¡å¼äº†ã€‚æ¶ˆæ¯å‘å‡ºåŽ»ä¹‹åŽï¼Œæ¶ˆè´¹ç«¯ç»™MQå›žå¤ä¸€ä¸ªæŽ¥æ”¶åˆ°çš„ä¿¡æ¯ï¼ŒMQæœ¬æ¬¡æ¶ˆè´¹æˆåŠŸï¼Œç»™è®¢é˜…è€…ä¸€ä¸ªå›žå¤ã€‚ å¯¹äºŽå…¨å±€å”¯ä¸€IDç”Ÿæˆï¼Œè¿™é‡Œç”¨çš„æ˜¯é›ªèŠ±ç®—æ³•ï¼Œå…·ä½“ä»‹ç»å¯ä»¥çœ‹æˆ‘çš„ç¬”è®° å¯¹äºŽåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå…¶å®žå¹¶æ²¡æœ‰çœŸæ­£å¤„ç†ï¼Œå¯¹äºŽæ•°æ®åº“æ‰£å‡åº“å­˜å’Œæ•°æ®åº“æ’å…¥è®¢å•ï¼Œä»–ä»¬åœ¨ä¸åŒçš„æ•°æ®åº“ï¼Œå»–å¸ˆå…„æ¯”è¾ƒå€¾å‘çš„æ–¹å¼æ˜¯ï¼š è¿™ä¸€åˆ‡çš„åŸºç¡€è¿˜æ˜¯éœ€è¦æœ‰ä¸€ä¸ªå¯é çš„æ¶ˆæ¯æœåŠ¡ï¼Œç¡®ä¿æ¶ˆæ¯è¦èƒ½é€è¾¾ã€‚ é’ˆå¯¹redisé¢„å‡åº“å­˜å­˜åœ¨çš„å¹¶å‘é—®é¢˜ï¼Œè¿™é‡Œçš„æ€è·¯æ˜¯ç”¨lua+redisï¼Œåœ¨é¢„å‡ä¹‹å‰åˆ¤æ–­åº“å­˜æ˜¯å¦å¤Ÿï¼Œè¿™ä¸¤ä¸ªæ“ä½œè¦åœ¨ä¸€ä¸ªåŽŸå­æ“ä½œé‡Œé¢æ‰è¡Œï¼Œluaæ°å¥½å¯ä»¥å®žçŽ°åŽŸå­æ€§ã€é¡ºåºæ€§åœ°æ“ä½œã€‚ æ”¯ä»˜æ¨¡å— è¿™é‡Œå¯¹æŽ¥çš„æ˜¯æ”¯ä»˜å®-æ‰«ç æ”¯ä»˜ï¼Œç”¨åˆ°æ˜¯æ”¯ä»˜å®æ²™ç®±çŽ¯å¢ƒã€‚æ”¯ä»˜çš„æ‰«ç æ”¯ä»˜è¯¦ç»†æµç¨‹åœ¨è¿™é‡ŒèŠä¸€èŠå“ˆã€‚ å•†æˆ·å‰å°å°†å•†å“å‚æ•°å‘é€è‡³å•†æˆ·åŽå°ï¼Œå•†æˆ·åŽå°ç”Ÿæˆå†…éƒ¨è®¢å•å·å¹¶ç”¨äºŽè¯·æ±‚æ”¯ä»˜å¹³å°åˆ›å»ºé¢„ä¸‹å•ï¼Œæ”¯ä»˜å¹³å°åˆ›å»ºå®Œé¢„è®¢å•åŽå°†è®¢å•äºŒç»´ç ä¿¡æ¯è¿”è¿˜ç»™å•†æˆ·ï¼Œæ­¤æ—¶ç”¨æˆ·å³å¯æ‰«å–äºŒç»´ç è¿›è¡Œä»˜æ¬¾æ“ä½œã€‚ å†…éƒ¨è®¢å•å·ï¼šè¿™æ˜¯ç›¸å¯¹äºŽæ”¯ä»˜å®å¹³å°è€Œè¨€çš„ï¼Œè¿™ä¸ªè®¢å•å·æ˜¯æˆ‘ä»¬å•†åŸŽè‡ªå·±ç”Ÿæˆçš„ï¼Œå¯¹äºŽæˆ‘ä»¬å•†åŸŽæ¥è¯´æ˜¯å†…éƒ¨è®¢å•å·ï¼Œä½†æ˜¯å¯¹äºŽæ”¯ä»˜å®æ¥è¯´æ˜¯å¤–éƒ¨è®¢å•å·ã€‚ å°†ä¸€ç³»åˆ—çš„æ•°æ®æŒ‰ç…§æ”¯ä»˜å®çš„è¦æ±‚å‘é€ç»™æ”¯ä»˜å®å¹³å°ï¼ŒåŒ…æ‹¬å•†å“ä¿¡æ¯ï¼Œç”Ÿæˆçš„éªŒç­¾signï¼Œå…¬é’¥ï¼›æ”¯ä»˜å®åŽ»å°†signè§£å¯†ï¼Œè¿›è¡Œå•†å“çš„å„ç§ä¿¡æ¯æ ¡éªŒã€‚æ ¡éªŒé€šè¿‡ï¼ŒåŒæ­¥è¿”å›žäºŒç»´ç ä¸²ã€‚ æ”¯ä»˜ä¸šåŠ¡æµç¨‹å›¾ï¼š åœ¨èŽ·å–æ”¯ä»˜çš„äºŒç»´ç ä¸²ä¹‹åŽï¼Œç”¨å·¥å…·åŒ…å°†å…¶è½¬æ¢æœªäºŒç»´ç å±•ç¤ºç»™ç”¨æˆ·æ‰«ç ã€‚ ç”¨æˆ·æ‰«ç åŽï¼Œä¼šæ”¶åˆ°ç¬¬ä¸€æ¬¡æ”¯ä»˜å®çš„å›žè°ƒï¼Œå±•ç¤ºè¦æ”¯ä»˜çš„é‡‘é¢ï¼Œå•†å“ä¿¡æ¯ç­‰ã€‚ ç”¨æˆ·è¾“å…¥å¯†ç æˆåŠŸåŽï¼Œæ­£å¸¸æƒ…å†µä¼šæ”¶åˆ°æ”¯ä»˜å®çš„ç¬¬äºŒæ¬¡å›žè°ƒï¼Œå³æ”¯ä»˜æˆåŠŸä¿¡æ¯ã€‚ ä½†æ˜¯ä¹Ÿå¯èƒ½ä¼šç”±äºŽç½‘ç»œç­‰åŽŸå› ï¼Œè¿Ÿè¿Ÿæ”¶ä¸åˆ°æ”¯ä»˜å®çš„å›žè°ƒï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸»åŠ¨å‘èµ·è½®è¯¢åŽ»æŸ¥çœ‹æ”¯ä»˜çŠ¶æ€ã€‚ åœ¨æ”¯ä»˜æˆåŠŸä¹‹åŽï¼ŒæŽ¥æ”¶å›žè°ƒçš„æŽ¥å£è¦è®°å¾—è¿”å›žsuccesså‘Šè¯‰æ”¯ä»˜å®æˆ‘å·²ç»æ”¶åˆ°ä½ çš„å›žè°ƒäº†ï¼Œä¸è¦å†é‡å¤å‘ç»™æˆ‘äº†ã€‚æŽ¥æ”¶å›žè°ƒçš„æŽ¥å£ä¹Ÿè¦åšå¥½åŽ»é™¤é‡å¤æ¶ˆæ¯çš„é€»è¾‘ã€‚ è¿™ä¸ªæµç¨‹æ˜¯å¤šä¹ˆåœ°ç®€å•è€Œç†æ‰€å½“ç„¶ï¼ å¯¹åº”äºŽä»£ç å±‚é¢ï¼Œå…¶å®žå°±æ˜¯ä¸¤ä¸ªæŽ¥å£ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·ç‚¹å‡»åŽ»æ”¯ä»˜æŒ‰é’®ï¼Œæ­¤æ—¶å‘èµ·é¢„ä¸‹å•ï¼Œå±•ç¤ºä»˜æ¬¾äºŒç»´ç ï¼Œå¦ä¸€ä¸ªæ˜¯æŽ¥æ”¶æ”¯ä»˜å®å›žè°ƒï¼š é¢„ä¸‹å•ï¼š æŽ¥æ”¶æ”¯ä»˜å®æ”¯ä»˜çŠ¶æ€å›žè°ƒï¼š é¡¹ç›®è¿›å±• [x] 2018/12/31 å®Œæˆäº†èšåˆå·¥ç¨‹çš„åˆ›å»ºã€EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒã€spring cloud config+gitHub+spring cloud busï¼ˆrabbitMQï¼‰å®žçŽ°é…ç½®è‡ªåŠ¨åˆ·æ–°â€“v1.0 [x] 2018/12/31 å°†Eurekaæ³¨å†Œä¸­å¿ƒ(å•æœº)å’Œé…ç½®ä¸­å¿ƒéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ¯”è¾ƒå›ºå®šï¼Œæ‰€ä»¥å…ˆéƒ¨ç½²ä¸ŠåŽ»ï¼Œä»¥åŽæœ¬åœ°å°±ç›´æŽ¥ç”¨è¿™ä¸¤ä¸ªå³å¯ï¼Œå¯¹é…ç½®è¿›è¡Œäº†ä¸€ç‚¹ç‚¹ä¿®æ”¹ [ ] 2018/12/31 å…³äºŽé…ç½®çš„è‡ªåŠ¨åˆ·æ–°ï¼Œç”¨postmanå‘é€postè¯·æ±‚æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç”¨github webhookä¸è¡Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„é—®é¢˜ [x] 2018/12/31 ç”¨æˆ·æ¨¡å—çš„é€»è¾‘å®žçŽ°,é¦–å…ˆå¢žåŠ äº†ä¸€äº›pomæ–‡ä»¶çš„æ”¯æŒï¼Œæ•´åˆmybatisï¼Œæµ‹è¯•æ•°æ®åº“éƒ½é€šè¿‡ï¼Œä¸‹é¢å°±å¯ä»¥çœŸæ­£åŽ»å®žçŽ°ä¸šåŠ¡ä»£ç äº† [x] 2019/1/1 å®Œæˆç”¨æˆ·æ³¨å†Œã€ç™»é™†ã€æ ¡éªŒç”¨æˆ·åé‚®ç®±æœ‰æ•ˆæ€§ã€æŸ¥çœ‹ç™»é™†ç”¨æˆ·ä¿¡æ¯ã€æ ¹æ®ç”¨æˆ·ååŽ»æ‹¿åˆ°å¯¹åº”çš„é—®é¢˜ã€æ ¡éªŒç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€é‡ç½®å¯†ç è¿™ä¸ªå‡ ä¸ªæŽ¥å£ï¼Œåœ¨æ³¨å†Œè¿™ä¸ªæŽ¥å£ï¼Œå¢žåŠ ä¸€ä¸ªZKåˆ†å¸ƒå¼é”æ¥é˜²æ­¢åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å‡ºçŽ°ç”¨æˆ·åæˆ–é‚®ç®±é‡å¤é—®é¢˜ [x] 2019/1/2 ä¸Šåˆå®Œæˆé—¨æˆ·ç”¨æˆ·æ¨¡å—æ‰€æœ‰æŽ¥å£â€“v2.0 [x] 2019/1/2 ä¸‹åˆå®Œæˆå“ç±»ç®¡ç†æ¨¡å—ï¼Œå…³äºŽç¹ççš„èŽ·å–ç”¨æˆ·å¹¶ä¸”é‰´æƒå·¥ä½œï¼Œè¿™é‡Œå…ˆæ”¾æ¯ä¸ªæŽ¥å£é‡Œé¢å¤„ç†ï¼ŒåŽé¢æ”¾åˆ°ç½‘å…³ä¸­åŽ»å®žçŽ°â€“v3.0 [x] 2019/1/3 ä¸Šåˆå¼•å…¥ç½‘å…³æœåŠ¡ï¼Œå°†åŽå°é‡å¤çš„æƒé™æ ¡éªŒç»Ÿä¸€æ”¾åˆ°ç½‘å…³ä¸­åŽ»åšï¼Œå¹¶ä¸”åŠ äº†é™æµï¼Œè§£å†³äº†ä¸€ä¸‹è·¨åŸŸé—®é¢˜ã€‚â€“v4.0 [x] 2019/1/3 ä¸‹åˆå’Œæ™šä¸Šå®Œæˆé—¨æˆ·å’ŒåŽå°çš„å•†å“ç®¡ç†æ¨¡å—æ‰€æœ‰çš„æŽ¥å£åŠŸèƒ½ï¼Œé™¤äº†ä¸Šä¼ æ–‡ä»¶çš„ä¸¤ä¸ªæŽ¥å£æ²¡æœ‰æµ‹è¯•ä»¥å¤–ï¼Œå…¶ä»–æŽ¥å£éƒ½è¿›è¡Œäº†ç®€å•çš„æµ‹è¯•ï¼Œå…¶ä¸­è¿˜ç”¨FeignåŽ»è°ƒç”¨äº†å“ç±»æœåŠ¡æŽ¥å£â€“v5.0 [x] 2019/1/3 åˆæ­¥æŠŠè´­ç‰©è½¦æ¨¡å—å’Œæ¨¡å—å¼•å…¥ï¼Œé€šè¿‡åŸºç¡€æµ‹è¯•ï¼ŒåŽé¢åœ¨æ­¤åŸºç¡€ä¸Šç›´æŽ¥å¼€å‘ä»£ç å³å¯ï¼Œæ˜Žå¤©ä¸‹åˆçœ‹ã€Šå¤§é»„èœ‚ã€‹ï¼Œæ™šä¸Šå¸ˆé—¨èšé¤åƒç«é”…ï¼Œæ˜Žå¤©æ—©ä¸Šèµ¶ä¸€èµ¶å§ï¼Œä»Šå¤©ä»»åŠ¡ç»“æŸï¼ [x] 2019/1/4 æ•´ç†äº†æŽ¥å£æ–‡æ¡£ï¼Œå¹¶ä¸”ç”»äº†ä¸€ä¸‹è´­ç‰©è½¦æ¨¡å—çš„æµç¨‹å›¾ä»¥åŠè®¢å•æœåŠ¡çš„æµç¨‹å›¾ï¼Œé’ˆå¯¹è®¢å•æœåŠ¡ä¸­ï¼Œè®°å½•äº†éœ€è¦ä¸€äº›æ³¨æ„çš„é—®é¢˜ï¼Œå°½å¯èƒ½åœ°å®Œå–„ï¼Œæé«˜å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚å¹¶ä¸”å®Œæˆè´­ç‰©è½¦æ¨¡å—çš„controllerå±‚ã€‚ [x] 2019/1/5 å®Œæˆè´­ç‰©è½¦æ¨¡å—ï¼Œå¹¶ä¸”è¿›è¡Œäº†ç®€å•çš„æµ‹è¯•ï¼Œè¿™é‡Œè¿›è¡Œäº†ä¸¤å¤„æ”¹é€ ï¼Œä¸€ä¸ªæ˜¯åˆ¤æ–­äº†ä¸€ä¸‹æ˜¯å¦éœ€è¦åˆ¤æ–­åº“å­˜ï¼›å¦ä¸€ä¸ªæ˜¯å•†å“ä¿¡æ¯ä»Žredisä¸­å–ï¼Œå–ä¸å‡ºæ¥åˆ™è°ƒç”¨å•†å“æœåŠ¡åˆå§‹åŒ–å€¼ [x] 2019/1/5 æ”¶è´§åœ°å€ç®¡ç†æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å°±æ˜¯ä¸ªå¢žåˆ æ”¹æŸ¥ï¼Œæ²¡å•¥ä¸œè¥¿å†™ï¼Œè¿™é‡Œå°±ä¸åŠ ç¼“å­˜äº†ã€‚ [x] 2019/1/6 å®Œæˆäº†åŽå°è®¢å•ç®¡ç†æ¨¡å—å¹¶ä¸”è¿›è¡Œäº†æµ‹è¯•ï¼Œè°ƒç”¨æ”¶è´§åœ°å€æœåŠ¡æ—¶ï¼Œå‘çŽ°æ”¶è´§åœ°å€æœåŠ¡æ— æ³•è¯»å–åˆ°cookieï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•(https://blog.csdn.net/WYA1993/article/details/84304243) æš‚æ—¶è§£å†³äº†é—®é¢˜ [x] 2019/1/6 é¢„ç½®æ‰€æœ‰å•†å“åº“å­˜åˆ°redisä¸­ï¼›é¢„ç½®æ‰€æœ‰å•†å“åˆ°redisä¸­ï¼›å¤§æ¦‚ç¡®å®šå¥½è®¢å•æœåŠ¡æ€è·¯ï¼šé¢„å‡åº“å­˜ï¼ˆredisåˆ¤æ–­åº“å­˜ï¼‰â€”å¯¹userIDå¢žåŠ åˆ†å¸ƒå¼é”é˜²æ­¢ç”¨æˆ·é‡å¤æäº¤è®¢å•â€“MQå¼‚æ­¥ä¸‹è®¢å• [x] 2019/1/6 æ–°å¢žå…¨å±€å”¯ä¸€IDç”ŸæˆæœåŠ¡ï¼Œé›ªèŠ±ç®—æ³•å®žçŽ° [x] 2019/1/7 å®Œå–„è®¢å•æœåŠ¡-è¿™ä¸€å—æ¶‰åŠè·¨åº“æ“ä½œï¼Œå¹¶ä¸”ä¸åœåœ°è°ƒç”¨å…¶ä»–æœåŠ¡ï¼Œè„‘å­éƒ½å¿«æ™•äº†ï¼Œè¿™é‡Œé‡‡å–çš„ç­–ç•¥æ˜¯ï¼šç”¨åˆ°è´­ç‰©è½¦çš„æ—¶å€™ï¼ŒåŽ»è°ƒç”¨è´­ç‰©è½¦æœåŠ¡èŽ·å–ï¼›äº§å“è¯¦æƒ…ä»Žredisä¸­èŽ·å–ã€‚é¦–å…ˆå°†å•†å“ä»¥åŠå•†å“åº“å­˜å…¨éƒ¨ç¼“å­˜åˆ°redisä¸­ï¼Œç„¶åŽç”¨æˆ·ä¸‹å•ï¼Œå…ˆä»Žredisä¸­åˆ¤æ–­åº“å­˜ï¼Œå¤Ÿåˆ™å‡ï¼Œåˆ¤æ–­ å’Œæ‰£å‡æ”¾åœ¨luaè„šæœ¬ä¸­åŽŸå­æ‰§è¡Œï¼Œç„¶åŽMQå¼‚æ­¥å‡ºåŽ»ç”Ÿæˆè®¢å•ï¼ˆç”Ÿæˆè®¢å•ä¸»è¡¨å’Œè®¢å•è¯¦æƒ…è¡¨æ”¾åœ¨ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­ï¼‰ï¼Œè¿™ä¸¤æ­¥æ“ä½œæˆåŠŸä¹‹åŽï¼Œå†ç”¨MQåŽ»å¼‚æ­¥åˆ é™¤è´­ç‰©è½¦ã€‚MQæ¶ˆè´¹ä¸æˆåŠŸåˆ™é‡è¯•ã€‚ å¯¹äºŽæ‰£å‡åº“å­˜è¿™ä¸€æ­¥ï¼Œæƒ³æ³•æ˜¯ç”¨å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä¸Žredisä¸­è¿›è¡ŒåŒæ­¥ã€‚è¿™é‡Œæ˜¯æ¨¡æ‹Ÿäº†ç§’æ€åœºæ™¯ï¼Œé¢„å‡åº“å­˜+MQå¼‚æ­¥ï¼Œæäº¤è®¢å•â€“&gt;redisåˆ¤æ–­å¹¶ä¸”å‡åº“å­˜â€“&gt;è°ƒç”¨cart-serviceèŽ·å–è´­ç‰©è½¦â€“&gt;MQå¼‚æ­¥(userId,shippingId)ç”Ÿæˆè®¢å•ä¸»è¡¨å’Œè¯¦æƒ…è¡¨â€“&gt;ä¸Šé¢éƒ½æˆåŠŸï¼Œåˆ™MQå¼‚æ­¥(userId) åŽ»æ¸…é™¤è´­ç‰©è½¦ï¼Œåº“å­˜ç”¨å®šæ—¶ä»»åŠ¡åŽ»åŒæ­¥(æœªåš)ï¼Œç†æƒ³çš„åšæ³•æ˜¯ï¼šMQå¼‚æ­¥æ‰£å‡åº“å­˜ï¼Œè®¢å•æœåŠ¡è®¢é˜…æ‰£å‡åº“å­˜æ¶ˆæ¯ï¼Œä¸€æ—¦åº“å­˜æ‰£å‡æˆåŠŸï¼Œåˆ™è¿›è¡Œè®¢å•ç”Ÿæˆã€‚ [x] 2019/1/8 ç»§ç»­å®Œå–„è®¢å•æŽ¥å£ï¼Œå®Œæˆæ”¯ä»˜æœåŠ¡ï¼Œå°±ç›´æŽ¥æ”¾åœ¨è®¢å•æœåŠ¡é‡Œé¢äº†ï¼Œå› ä¸ºä¸Žè®¢å•é€»è¾‘ç´§å¯†ï¼Œå°±æ”¾åœ¨ä¸€èµ·äº†ã€‚ [x] 2019/1/8 ä½¿ç”¨äº†ä¸€ä¸‹swaggerï¼Œå‘çŽ°ä»£ç ä¾µå…¥æ¯”è¾ƒå¼ºï¼Œæ¯ä¸€ä¸ªæŽ¥å£ä¸Šé¢éƒ½è¦æ‰‹åŠ¨æ‰“ä¸Šå“åº”çš„æ³¨è§£ [x] 2019/1/8 å…³äºŽhystrixç†”æ–­ä¸Žé™çº§ï¼Œå¯ä»¥å¼•å…¥hystrixçš„ä¾èµ–ï¼Œç”¨@HystrixCommandæ³¨è§£æ¥æŽ§åˆ¶è¶…æ—¶æ—¶é—´ã€æœåŠ¡é™çº§ä»¥åŠæœåŠ¡ç†”æ–­ã€‚ä¹Ÿå¯ä»¥ç›´æŽ¥å†@FeignClientæŽ¥å£ä¸­æŒ‡å®šæœåŠ¡é™çº§çš„ç±»ï¼Œè¿™é‡Œä¸æ¼”ç¤ºäº†ï¼Œå› ä¸ºè®¾ç½®æ¯”å¦‚è¶…æ—¶æ—¶é—´ï¼Œæˆ‘è¿˜è¦é‡æ–°æµ‹è¯•ï¼Œå†™èµ·æ¥å¾ˆç®€å•ï¼Œæµ‹èµ·æ¥æœ‰ç‚¹å„¿éº»çƒ¦ [x] 2019/1/9 æœåŠ¡è·Ÿè¸ªï¼ŒæœåŠ¡ç«¯æ˜¯ç›´æŽ¥ç”¨çš„çº¿ç¨‹çš„ï¼Œåªéœ€è¦ä¸‹è½½ï¼šwget -O zipkin.jar â€˜https://search.maven.org/remote_content?g=io.zipkin.java&amp;a=zipkin-server&amp;v=LATEST&amp;c=execâ€™ï¼Œç„¶åŽnohup java -jar zipkin.jar &gt; zipkin.server.out &amp; ï¼Œå¼€æ”¾9411ç«¯å£ï¼Œæ‰“å¼€æµè§ˆå™¨http://ip:9411çœ‹åˆ°é¡µé¢å³å¯ã€‚ å®¢æˆ·ç«¯åªéœ€è¦æ·»åŠ ç›¸åº”ä¾èµ–å’Œé…ç½®æ–‡ä»¶å³å¯ã€‚ç”¨å®¢æˆ·ç«¯æµ‹è¯•ï¼Œå‘çŽ°æ­»æ´»ä¸å‡ºçŽ°æˆ‘çš„è¯·æ±‚ï¼Œç»è¿‡æœç´¢ï¼Œå‘çŽ°éœ€è¦å¢žåŠ spring.zipkin.sender.type= webè¿™ä¸ªé…ç½®é¡¹æ‰è¡Œ. [x] 2019/1/10 åˆæ­¥æŠŠé¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿›è¡Œæµ‹è¯•ï¼Œbugå¤šå¤šï¼Œä¿®æ”¹ä¸­â€¦ [x] 2019/1/10 æ”¹äº†ä¸€å¤©çš„bugï¼Œå…¶ä¸­ç½‘å…³çš„è¶…æ—¶æ—¶é—´ä»¥åŠfeignçš„è¶…æ—¶æ—¶é—´éƒ½è¦æ”¹å¤§ä¸€ç‚¹ï¼Œå¦åˆ™ä¼šè¶…æ—¶æŠ¥é”™ã€‚æœ€ç»ˆæˆåŠŸï¼ŒèŠ±äº†ä¸‰å°æœåŠ¡å™¨ï¼Œéƒ¨ç½²äº†11ä¸ªæœåŠ¡ã€‚åŽé¢æŠŠéƒ¨ç½²è¿‡ç¨‹å†™ä¸€ä¸‹ã€‚ [x] 2019/1/11 å°†æ³¨å†Œä¸­å¿ƒåšæˆé›†ç¾¤ï¼Œå› ä¸ºæ—©ä¸Šä¸€èµ·æ¥ï¼Œæ³¨å†Œä¸­å¿ƒæŒ‚äº†ï¼Ÿï¼Ÿï¼Ÿ [ ] 2019/1/11 dockeréƒ¨ç½²(å•†åŸŽç¬¬å››æœŸçš„æ”¹é€ ç›®æ ‡:å®¹å™¨åŒ–+å®¹å™¨ç¼–æŽ’)ï¼Œæœ¬æœŸæ”¹é€ ç»“æŸã€‚ [x] 2019/1/11 å®Œå–„readmeæ–‡æ¡£ [x] 2019/1/12 ä¸¤æ¬¡å‘çŽ°redisæ•°æ®è¢«èŽ«åå…¶å¦™æ¸…ç©ºï¼Œæˆ‘ç¡®å®šä¸æ˜¯ç¼“å­˜åˆ°æœŸï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè®¾ç½®äº†redisçš„å¯†ç ï¼Œæ˜Žå¤©çœ‹ç¼“å­˜æ•°æ®è¿˜åœ¨ä¸åœ¨ã€‚ [x] 2019/1/14 redisæ•°æ®æ²¡æœ‰å†ä¸¢å¤±ï¼Œä¿®å¤ç”¨æˆ·æ›´æ–°ä¿¡æ¯çš„bug é¡¹ç›®å¯åŠ¨ å®‰è£…redisã€zookeeperã€mysqlã€jdkã€nginxä»¥åŠrabbitMQã€‚ å¯¹ä»£ç è¿›è¡Œmaven-packageæ“ä½œã€‚æ‰“åŒ…æˆjaråŒ…ã€‚å°†å…¶æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼š æ‰§è¡Œnohup java -jar snailmall-user-service.8081 &gt; user-service.out &amp;åŽå°å¯åŠ¨å³å¯ã€‚ è¡¥å……ï¼šé’ˆå¯¹é…ç½®åˆ·æ–°ï¼Œä¿®æ”¹äº†githubä¿¡æ¯ï¼Œç”¨postmanè¯·æ±‚http://xxxxx:8079/actuator/bus-refresh è§¦å‘æ›´æ–°ã€‚ æœ¬æ”¹é€ æ˜¯åŸºäºŽå¿«ä¹æ…•å•†åŸŽä¸€æœŸå’Œå¿«ä¹æ…•å•†åŸŽäºŒæœŸçš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹é€ ã€‚æ‰€ä»¥éœ€è¦åœ¨å…¶ä¸šåŠ¡åŸºç¡€ä¸Šæ”¹é€ ä¼šæ¯”è¾ƒé¡ºæ‰‹ã€‚å…³äºŽå¾®æœåŠ¡ï¼Œå°¤å…¶æ˜¯ç”µå•†ä¸­çš„ä¸€äº›å¤„ç†æ‰‹æ®µï¼Œå¾ˆå¤šæ€è·¯éƒ½æ˜¯å­¦ä¹ äºŽç å—åœ¨çº¿ä¸­åˆ†å¸ƒå¼ç”µå•†é¡¹ç›®ã€‚å†åŠ ä¸Šæ…•è¯¾ç½‘å»–å¸ˆå…„çš„spring cloudå¾®æœåŠ¡å®žè·µã€‚ å‰å°é¡¹ç›® åªè¦é˜…è¯»readmeæ–‡æ¡£å³å¯ã€‚ä»£ç ä»“åº“ä¸ºï¼šhttps://github.com/sunweiguo/snailmall-front å­¦ä¹ ä¸ä»…è¦æœ‰è¾“å…¥ï¼Œæ›´è¦æœ‰è‡ªå·±çš„è¾“å‡ºï¼Œå®žè·µæ˜¯æå‡çš„æ·å¾„ï¼]]></content>
      <tags>
        <tag>å®žæˆ˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¢è¯•-è¿›ç¨‹ä¸Žçº¿ç¨‹]]></title>
    <url>%2F2019%2F01%2F19%2F%E9%9D%A2%E8%AF%95-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[éƒ½æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†çš„å¯¹è±¡ï¼Œæ¯”è¾ƒå®¹æ˜“æ··æ·†ï¼Œä½†æ˜¯åˆæ˜¯ä¸¤æ ·å®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼Œå› æ­¤åŒºåˆ«å¾ˆå¤šã€‚ä»Žä»–ä»¬åŒºåˆ«ä¹Ÿå¯ä»¥å‘æ•£å‡ºå¾ˆå¤šå…³äºŽæ“ä½œç³»ç»Ÿæ¯”è¾ƒé‡è¦çš„çŸ¥è¯†ã€‚æ‰€ä»¥é¢è¯•æ¯”è¾ƒå¸¸é—®ã€‚ 1. è¿›ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ ç¿»äº†ä¸€ä¸‹ä¹¦ï¼šã€Šæ“ä½œç³»ç»Ÿæ¦‚å¿µã€‹ç¬¬ä¸‰ç« ä¸­æåŠäº†è¿›ç¨‹çš„æ¦‚å¿µã€‚ä»–æ˜¯è¿™æ ·è¯´çš„ï¼š è¿›ç¨‹æ˜¯æ‰§è¡Œä¸­çš„ç¨‹åºï¼Œè¿™æ˜¯ä¸€ç§éžæ­£å¼è¯´æ³•ã€‚è¿›ç¨‹ä¸åªæ˜¯ç¨‹åºä»£ç ï¼ˆä»£ç å—ï¼‰ï¼Œè¿›ç¨‹è¿˜åŒ…å«äº†å½“å‰æ´»åŠ¨ï¼Œé€šè¿‡ç¨‹åºè®¡æ•°å™¨çš„å€¼å’Œå¤„ç†å™¨å¯„å­˜å™¨çš„å†…å®¹æ¥è¡¨ç¤ºã€‚æ­¤å¤–ï¼Œè¿›ç¨‹è¿˜åŒ…å«è¿›ç¨‹å †æ ˆæ®µï¼ˆåŒ…æ‹¬ä¸´æ—¶æ•°æ®ï¼Œå¦‚å‡½æ•°å‚æ•°ã€è¿”å›žåœ°å€å’Œå±€éƒ¨å˜é‡ï¼‰å’Œæ•°æ®æ®µï¼ˆåŒ…æ‹¬å…¨å±€å˜é‡ï¼‰ã€‚è¿›ç¨‹è¿˜å¯èƒ½åŒ…å«å †ï¼Œæ˜¯åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚ ç¨‹åºæœ¬èº«ä¸æ˜¯è¿›ç¨‹ã€‚ç¨‹åºåªæ˜¯è¢«åŠ¨å®žä½“ï¼Œå¦‚å­˜å‚¨åœ¨ç£ç›˜ä¸ŠåŒ…å«ä¸€ç³»åˆ—æŒ‡ä»¤çš„æ–‡ä»¶å†…å®¹ã€‚è€Œè¿›ç¨‹æ˜¯æ´»åŠ¨å®žä½“ï¼Œå®ƒæœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨æ¥è¡¨ç¤ºä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å‘½ä»¤å’Œç›¸å…³èµ„æºé›†åˆã€‚å½“ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è¢«è£…å…¥å†…å­˜æ—¶ï¼Œä¸€ä¸ªç¨‹åºæ‰èƒ½æˆä¸ºè¿›ç¨‹ã€‚ æ€»ç»“ä¸€ä¸‹è¿›ç¨‹æ˜¯ä»€ä¹ˆï¼Œæ˜¯æˆ‘ä¸ªäººç†è§£ï¼šå®ƒæ˜¯ä¸€ä¸ªæ´»åŠ¨å®žä½“ï¼Œè¿è¡Œåœ¨å†…å­˜ä¸Šã€‚ç„¶åŽå®ƒå ç”¨å¾ˆå¤šç‹¬ç«‹çš„èµ„æºï¼Œæ¯”å¦‚ï¼šå†…å­˜èµ„æºã€ç¨‹åºè¿è¡Œè‚¯å®šæ¶‰åŠCPUè®¡ç®—ã€å ç”¨çš„ç«¯å£èµ„æºï¼ˆå…¬å…±çš„ï¼‰ã€æ–‡ä»¶èµ„æºï¼ˆå…¬å…±çš„ï¼‰ã€ç½‘ç»œèµ„æºï¼ˆå…¬å…±çš„ï¼‰ç­‰ç­‰ç­‰ã€‚è¦æƒ³æ‰§è¡Œè¿™ä¸ªè¿›ç¨‹ï¼Œé¦–å…ˆè¦æœ‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæœ‰äº†è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿˜è¦æœ‰ç›¸åº”çš„æ‰§è¡Œéœ€è¦çš„èµ„æºã€‚æ‰€ä»¥å°†å¯æ‰§è¡Œæ–‡ä»¶ã€å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ã€å†…å­˜ç­‰èµ„æºç»“åˆèµ·æ¥ï¼Œæ‰æ˜¯ä¸€ä¸ªçœŸæ­£çš„è¿›ç¨‹ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥ç†è§£ä¸€å¥è¯ï¼šè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚ è¿›ç¨‹ä¸­çš„å†…å­˜ç©ºé—´ï¼ˆè™½ç„¶ç©ºé—´å¤§å°éƒ½ä¸€æ ·ï¼Œä¸‹æ–‡ä¼šè¯´æ˜Žï¼‰æ˜¯ç‹¬ç«‹çš„ï¼Œå¦åˆ™å°±ä¼šå‡ºçŽ°ä¸€ç§æƒ…å†µï¼šä¿®æ”¹è‡ªå·±ç¨‹åºä¸­çš„æŸä¸ªæŒ‡é’ˆå°±å¯ä»¥æŒ‡å‘å…¶ä»–ç¨‹åºä¸­çš„åœ°å€ï¼Œç„¶åŽæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ï¼Œå²‚ä¸æ˜¯å¾ˆææ€–çš„åœºæ™¯ï¼Ÿ å¦‚ä¸Šå›¾ï¼Œè¿›ç¨‹ä¸­åŒ…å«äº†çº¿ç¨‹ã€‚æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šè¿è¡Œå‡ ç™¾ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹ä¸­ä¹Ÿå¯èƒ½æœ‰å‡ ä¸ªåˆ°å‡ ç™¾ä¸ªçº¿ç¨‹åœ¨è¿è¡Œã€‚ æ–‡ä»¶å’Œç½‘ç»œå¥æŸ„æ˜¯æ‰€æœ‰è¿›ç¨‹å…±äº«çš„ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥åŽ»æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼ŒåŽ»æŠ¢å åŒä¸€ä¸ªç½‘ç»œç«¯å£ã€‚ å›¾ä¸­è¿˜æœ‰ä¸ªå†…å­˜ã€‚è¿™ä¸ªå†…å­˜ä¸æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„å†…å­˜æ¡ï¼Œå³ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯è™šæ‹Ÿå†…å­˜ï¼Œæ˜¯è¿›ç¨‹ç‹¬ç«‹çš„ï¼Œå¤§å°ä¸Žå®žé™…ç‰©ç†å†…å­˜æ— å…³ã€‚ 2. å¯»å€ç©ºé—´ æ¯”å¦‚8086åªæœ‰20æ ¹åœ°å€çº¿ï¼Œé‚£ä¹ˆå®ƒçš„å¯»å€ç©ºé—´å°±æ˜¯1MBï¼Œæˆ‘ä»¬å°±è¯´8086èƒ½æ”¯æŒ1MBçš„ç‰©ç†å†…å­˜ï¼ŒåŠæ—¶æˆ‘ä»¬å®‰è£…äº†128Mçš„å†…å­˜æ¡åœ¨æ¿å­ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½è¯´8086æ‹¥æœ‰1MBçš„ç‰©ç†å†…å­˜ç©ºé—´ã€‚ ä»¥å‰å«å–çš„32ä½çš„æœºå­ï¼Œ32ä½æ˜¯æŒ‡å¯»å€ç©ºé—´ä¸º2çš„32æ¬¡æ–¹ã€‚32ä½çš„386ä»¥ä¸ŠCPUå°±å¯ä»¥æ”¯æŒæœ€å¤§4GBçš„ç‰©ç†å†…å­˜ç©ºé—´äº†ã€‚ 3. ä¸ºä»€ä¹ˆä¼šæœ‰è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„åŒºåˆ« æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œä»–æ‰€éœ€çš„å†…å­˜æ˜¯æœ‰å¯èƒ½å¤§äºŽå†…å­˜æ¡å®¹é‡ä¹‹å’Œçš„ï¼Œæ¯”å¦‚ä½ çš„å†…å­˜æ¡æ˜¯256Mï¼Œä½ çš„ç¨‹åºå´è¦åˆ›å»ºä¸€ä¸ª2Gçš„æ•°æ®åŒºï¼Œé‚£ä¹ˆä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½èƒ½ä¸€èµ·åŠ è½½åˆ°å†…å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰ä¸­ï¼ŒåŠ¿å¿…æœ‰ä¸€éƒ¨åˆ†æ•°æ®è¦æ”¾åˆ°å…¶ä»–ä»‹è´¨ä¸­ï¼ˆæ¯”å¦‚ç¡¬ç›˜ï¼‰ï¼Œå¾…è¿›ç¨‹éœ€è¦è®¿é—®é‚£éƒ¨åˆ†æ•°æ®æ—¶ï¼Œåœ¨é€šè¿‡è°ƒåº¦è¿›å…¥ç‰©ç†å†…å­˜ã€‚ æ‰€ä»¥ï¼Œè™šæ‹Ÿå†…å­˜æ˜¯è¿›ç¨‹è¿è¡Œæ—¶æ‰€æœ‰å†…å­˜ç©ºé—´çš„æ€»å’Œï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€éƒ¨åˆ†ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè€Œç‰©ç†å†…å­˜å°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ‰€äº†è§£çš„å†…å­˜æ¡ã€‚ å…³é”®çš„æ˜¯ä¸è¦æŠŠè™šæ‹Ÿå†…å­˜è·ŸçœŸå®žçš„æ’åœ¨ä¸»æ¿ä¸Šçš„å†…å­˜æ¡ç›¸æŒ‚é’©ï¼Œè™šæ‹Ÿå†…å­˜å®ƒæ˜¯â€œè™šæ‹Ÿçš„â€ä¸å­˜åœ¨ï¼Œå‡çš„å•¦ï¼Œå®ƒåªæ˜¯å†…å­˜ç®¡ç†çš„ä¸€ç§æŠ½è±¡ï¼ 4. è™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€æ˜¯å¦‚ä½•æ˜ å°„å‘¢ å‡è®¾ä½ çš„è®¡ç®—æœºæ˜¯32ä½ï¼Œé‚£ä¹ˆå®ƒçš„åœ°å€æ€»çº¿æ˜¯32ä½çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒå¯ä»¥å¯»å€0 ~ 0xFFFFFFFFï¼ˆ4Gï¼‰çš„åœ°å€ç©ºé—´ï¼Œä½†å¦‚æžœä½ çš„è®¡ç®—æœºåªæœ‰256Mçš„ç‰©ç†å†…å­˜0x~0x0FFFFFFFï¼ˆ256Mï¼‰ï¼ŒåŒæ—¶ä½ çš„è¿›ç¨‹äº§ç”Ÿäº†ä¸€ä¸ªä¸åœ¨è¿™256Måœ°å€ç©ºé—´ä¸­çš„åœ°å€ï¼Œé‚£ä¹ˆè®¡ç®—æœºè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿå›žç­”è¿™ä¸ªé—®é¢˜å‰ï¼Œå…ˆè¯´æ˜Žè®¡ç®—æœºçš„å†…å­˜åˆ†é¡µæœºåˆ¶ã€‚ è®¡ç®—æœºä¼šå¯¹è™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´ï¼ˆ32ä½ä¸º4Gï¼‰åˆ†é¡µäº§ç”Ÿé¡µï¼ˆpageï¼‰ï¼Œå¯¹ç‰©ç†å†…å­˜åœ°å€ç©ºé—´ï¼ˆå‡è®¾256Mï¼‰åˆ†é¡µäº§ç”Ÿé¡µå¸§ï¼ˆpage frameï¼‰ï¼Œè¿™ä¸ªé¡µå’Œé¡µå¸§çš„å¤§å°æ˜¯ä¸€æ ·å¤§çš„ï¼Œæ‰€ä»¥å‘¢ï¼Œåœ¨è¿™é‡Œï¼Œè™šæ‹Ÿå†…å­˜é¡µçš„ä¸ªæ•°åŠ¿å¿…è¦å¤§äºŽç‰©ç†å†…å­˜é¡µå¸§çš„ä¸ªæ•°ã€‚ åœ¨è®¡ç®—æœºä¸Šæœ‰ä¸€ä¸ªé¡µè¡¨ï¼ˆpage tableï¼‰ï¼Œå°±æ˜¯æ˜ å°„è™šæ‹Ÿå†…å­˜é¡µåˆ°ç‰©ç†å†…å­˜é¡µçš„ï¼Œæ›´ç¡®åˆ‡çš„è¯´æ˜¯é¡µå·åˆ°é¡µå¸§å·çš„æ˜ å°„ï¼Œè€Œä¸”æ˜¯ä¸€å¯¹ä¸€çš„æ˜ å°„ã€‚ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œè™šæ‹Ÿå†…å­˜é¡µçš„ä¸ªæ•° &gt; ç‰©ç†å†…å­˜é¡µå¸§çš„ä¸ªæ•°ï¼Œå²‚ä¸æ˜¯æœ‰äº›è™šæ‹Ÿå†…å­˜é¡µçš„åœ°å€æ°¸è¿œæ²¡æœ‰å¯¹åº”çš„ç‰©ç†å†…å­˜åœ°å€ç©ºé—´ï¼Ÿ ä¸æ˜¯çš„ï¼Œæ“ä½œç³»ç»Ÿæ˜¯è¿™æ ·å¤„ç†çš„ã€‚æ“ä½œç³»ç»Ÿæœ‰ä¸ªé¡µé¢å¤±æ•ˆï¼ˆpage faultï¼‰åŠŸèƒ½ã€‚æ“ä½œç³»ç»Ÿæ‰¾åˆ°ä¸€ä¸ªæœ€å°‘ä½¿ç”¨çš„é¡µå¸§ï¼Œè®©ä»–å¤±æ•ˆï¼Œå¹¶æŠŠå®ƒå†™å…¥ç£ç›˜ï¼ŒéšåŽä»Žç£ç›˜ä¸­æŠŠæŠŠéœ€è¦è®¿é—®çš„æ•°æ®æ‰€åœ¨çš„é¡µæ”¾åˆ°æœ€å°‘ä½¿ç”¨çš„é¡µå¸§ä¸­ï¼Œå¹¶ä¿®æ”¹é¡µè¡¨ä¸­çš„æ˜ å°„ï¼ˆå³ä¿®æ”¹é¡µå·æŒ‡å‘å½“å‰é¡µå¸§ï¼‰ï¼Œè¿™æ ·å°±ä¿è¯æ‰€æœ‰çš„é¡µéƒ½æœ‰è¢«è°ƒåº¦çš„å¯èƒ½äº†ã€‚è¿™å°±æ˜¯å¤„ç†è™šæ‹Ÿå†…å­˜åœ°å€åˆ°ç‰©ç†å†…å­˜çš„æ­¥éª¤ã€‚ è‡³äºŽé‡Œé¢å¦‚ä½•å®žçŽ°çš„ç»†èŠ‚ï¼Œæˆ‘æ²¡æœ‰è¿‡å¤šåŽ»æŽ¢ç©¶ã€‚ 5. ä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€ è™šæ‹Ÿå†…å­˜åœ°å€ç”±é¡µå·å’Œåç§»é‡ç»„æˆã€‚é¡µå·å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ã€‚åç§»é‡å°±æ˜¯æˆ‘ä¸Šé¢è¯´çš„é¡µï¼ˆæˆ–è€…é¡µå¸§ï¼‰çš„å¤§å°ï¼Œå³è¿™ä¸ªé¡µï¼ˆæˆ–è€…é¡µå¸§ï¼‰åˆ°åº•èƒ½å­˜å¤šå°‘æ•°æ®ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªè™šæ‹Ÿåœ°å€å®ƒçš„é¡µå·æ˜¯4ï¼Œåç§»é‡æ˜¯20ï¼Œé‚£ä¹ˆä»–çš„å¯»å€è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆåˆ°é¡µè¡¨ä¸­æ‰¾åˆ°é¡µå·4å¯¹åº”çš„é¡µå¸§å·ï¼ˆæ¯”å¦‚ä¸º8ï¼‰ï¼Œå¦‚æžœæ‰¾ä¸åˆ°å¯¹åº”çš„é¡µæ¡¢ï¼Œåˆ™ç”¨å¤±æ•ˆæœºåˆ¶è°ƒå…¥é¡µã€‚å¦‚æžœå­˜åœ¨ï¼ŒæŠŠé¡µå¸§å·å’Œåç§»é‡ä¼ ç»™MMUï¼ˆCPUçš„å†…å­˜ç®¡ç†å•å…ƒï¼‰ç»„æˆä¸€ä¸ªç‰©ç†ä¸ŠçœŸæ­£å­˜åœ¨çš„åœ°å€ï¼ŒæŽ¥ç€å°±æ˜¯è®¿é—®ç‰©ç†å†…å­˜ä¸­çš„æ•°æ®äº†ã€‚ 6. çº¿ç¨‹é‡Œé¢æœ‰ä»€ä¹ˆ å†™åˆ°è¿™é‡Œï¼Œå¥½åƒè¿˜ä¸Žæœ¬æ ‡é¢˜æ— å…³ï¼Œå³è¿›ç¨‹å’Œçº¿ç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«ç­‰ã€‚ä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“ï¼Œé¢è¯•æˆ–è€…å­¦ä¹ ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œä¸æ˜¯ä¸ºäº†å­¦ä¹ è¿™ä¸ªåŒºåˆ«è€Œå­¦ä¹ ï¼Œ æˆ‘ä»¬åº”è¯¥å­¦ä¹ ä¸ºä»€ä¹ˆæœ‰è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œæœ‰äº†è¿›ç¨‹è¿˜éœ€è¦çº¿ç¨‹å—ï¼Ÿæœ‰äº†çº¿ç¨‹è¿˜è¦è¿›ç¨‹å—ï¼Ÿä½ è¯´è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„å•ä½ï¼Œåˆ†é…çš„æ˜¯ä»€ä¹ˆèµ„æºå‘¢ï¼Ÿè¿›ç¨‹ä¸­çš„å†…å­˜æ˜¯å’‹ç®¡ç†çš„å‘¢ï¼Ÿè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€ï¼Ÿç­‰ç­‰ç­‰ï¼Œæ‰€ä»¥é¢è¯•æ˜¯åƒå˜ä¸‡åŒ–çš„ï¼Œé‡è¦çš„æ˜¯æˆ‘ä»¬å°½å¯èƒ½åœ°å¤šé—®è‡ªå·±å‡ ä¸ªä¸ºä»€ä¹ˆï¼Œç„¶åŽä»Žä¸ºä»€ä¹ˆå¼€å§‹åŽ»é€ä¸ªå‡»ç ´ï¼Œå½¢æˆä¸€ä¸ªä½“ç³»ã€‚ è¯´è¯´è¿™ä¸ªæ ˆï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ‰§è¡Œç¨‹åºä»Žä¸»ç¨‹åºå…¥å£è¿›å…¥å¼€å§‹ï¼Œå¯èƒ½ä¼šè°ƒç”¨å¾ˆå¤šçš„å‡½æ•°ï¼Œé‚£ä¹ˆè¿™äº›å‡½æ•°çš„å‚æ•°å’Œè¿”å›žåœ°å€éƒ½ä¼šè¢«åŽ‹å…¥æ ˆä¸­ï¼ŒåŒ…æ‹¬è¿™äº›å‡½æ•°ä¸­å®šä¹‰çš„ä¸´æ—¶å±€éƒ¨å˜é‡éƒ½ä¼šåŽ‹å…¥æ ˆä¸­ï¼Œéšç€å‡½æ•°çš„æ‰§è¡Œå®Œæ¯•ï¼Œå†é€å±‚åœ°å¼¹å‡ºæ ˆï¼Œå›žåˆ°ä¸»å‡½æ•°è¿è¡Œçš„åœ°æ–¹ï¼Œå†ç»§ç»­æ‰§è¡Œã€‚ PC(program counter)ï¼Œå°±æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ŒæŒ‡å‘çš„ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œçš„åœ°å€ã€‚ ç”±æ­¤å¯è§ï¼Œæ“ä½œç³»ç»Ÿè¿è¡Œçš„å…¶å®žæ˜¯ä¸€ä¸ªä¸€ä¸ªçš„çº¿ç¨‹ï¼Œè€Œè¿›ç¨‹åªæ˜¯ä¸€ä¸ªéš”ç¦»èµ„æºçš„å®¹å™¨ã€‚ ä¸Šé¢è¯´åˆ°ï¼ŒPCæ˜¯æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œçš„åœ°å€ã€‚è€Œè¿™äº›æŒ‡ä»¤æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ã€‚ æˆ‘ä»¬çš„è®¡ç®—æœºå¤§å¤šæ•°æ˜¯å­˜å‚¨ç¨‹åºåž‹çš„ã€‚å°±æ˜¯è¯´æ•°æ®å’Œç¨‹åºæ˜¯åŒæ—¶å­˜å‚¨åœ¨åŒä¸€ç‰‡å†…å­˜é‡Œçš„ã€‚ æ‰€ä»¥æˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°ä¸€ä¸ªæ¼æ´žå«åšâ€œç¼“å†²åŒºæº¢å‡ºâ€ï¼šæ¯”å¦‚æœ‰ä¸€ä¸ªåœ°æ–¹è®©ç”¨æˆ·è¾“å…¥ç”¨æˆ·åï¼Œä½†æ˜¯é»‘å®¢è¾“å…¥å¾ˆé•¿å¾ˆé•¿çš„å­—ç¬¦ä¸²è¿›åŽ»ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å°±ä¼šè¶…å‡ºå­˜æ”¾è¿™ä¸ªç”¨æˆ·åçš„ä¸€ç‰‡ç¼“å†²åŒºï¼Œè€Œç›´æŽ¥ä¾µå…¥åˆ°å­˜æ”¾ç¨‹åºçš„åœ°æ–¹ï¼Œé‚£ä¹ˆé»‘å®¢å°±å¯ä»¥æ¤å…¥ç¨‹åºåŽ»æ‰§è¡Œã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯é™åˆ¶è¾“å…¥çš„ç”¨æˆ·åé•¿åº¦ï¼Œä¸è¦è¶…è¿‡ç¼“å†²åŒºå¤§å°ã€‚ è¿˜æœ‰ä¸€å—æ˜¯TLS(thread local storage)ï¼Œæˆ‘ä»¬çŸ¥é“è¿›ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„çº¿ç¨‹èƒ½ä¸èƒ½ä¹Ÿæœ‰ä¸€å°å—å±žäºŽè‡ªå·±çš„å†…å­˜åŒºåŸŸå‘¢ï¼Ÿ è¿™ä¸ªä¸œè¥¿ï¼Œå…¶å®žå¾ˆç®€å•ï¼Œå°±æ˜¯è¯´ï¼Œæ¯”å¦‚newä¸€ä¸ªå¯¹è±¡ï¼Œå¾€å¾€æ˜¯åœ¨å †ä¸­å¼€è¾Ÿç©ºé—´çš„ï¼Œä½†æ˜¯çŽ°åœ¨çš„æƒ…å†µæ˜¯ï¼šåœ¨ä¸€ä¸ªå‡½æ•°å†…ï¼Œnewå‡ºæ¥ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸å¼•ç”¨å¤–éƒ¨å¯¹è±¡ï¼Œä¹Ÿä¸ä¼šè¢«å¤–éƒ¨å¼•ç”¨ï¼Œæ˜¯çº¯ç²¹å±žäºŽè¿™ä¸ªå‡½æ•°æ®µï¼Œå¯ä»¥ç†è§£ä¸ºè¿™ä¸ªå¯¹è±¡æ˜¯å±žäºŽè¿™ä¸ªå‡½æ•°çš„å±€éƒ¨ä¸´æ—¶å˜é‡ã€‚ æ­¤æ—¶ï¼Œnewè¿™ä¸ªå¯¹è±¡å°±ä¸éœ€è¦å†åŽ»å †ä¸­å¼€è¾Ÿç©ºé—´äº†ï¼Œå› ä¸ºä¸€æ–¹é¢ä¸éœ€è¦å…±äº«ï¼Œå¦ä¸€æ–¹é¢æ˜¯åœ¨å †ä¸­å¼€è¾Ÿæ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå¹¶ä¸”å¯èƒ½æœ‰å¾ˆå¤šå‡½æ•°ï¼Œè¿™ç§å±€éƒ¨å¯¹è±¡é›¶é›¶æ€»æ€»åŠ èµ·æ¥è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œåœ¨å †ä¸­å¼€è¾Ÿä¼šæµªè´¹ç©ºé—´ã€‚ æ‰€ä»¥ï¼Œèƒ½ä¸èƒ½åœ¨æ ˆä¸­å°±å¯ä»¥newå‡ºè¿™ä¸ªå¯¹è±¡ï¼Œåæ­£ç”¨å®Œå°±æ‰”ã€‚TLSå¯ä»¥æ˜¯çŽ°åœ¨è¿™ä¸ªã€‚æ ˆä¸­ç›´æŽ¥newå¤šæ–¹ä¾¿å¤šå¿«ï¼Œå› ä¸ºä¸éœ€è¦èµ°åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼Œè¿˜é¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å¯ä»¥åŽ»æœç´¢ï¼šæ ˆä¸Šåˆ†é…å’Œé€ƒé€¸åˆ†æž 7. çº¿ç¨‹VSè¿›ç¨‹ åˆ°è¿™é‡Œï¼Œå°±æ¸…æ™°äº†å¾ˆå¤šã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å¤šå¤šå°‘å°‘ç†è§£ä»–ä»¬çš„åŒºåˆ«ã€‚ å¯ä»¥åšä¸ªç®€å•çš„æ¯”å–»ï¼Œä¾¿äºŽè®°å¿†ï¼šè¿›ç¨‹=ç«è½¦ï¼Œçº¿ç¨‹=è½¦åŽ¢ çº¿ç¨‹åœ¨è¿›ç¨‹ä¸‹è¡Œè¿›ï¼ˆå•çº¯çš„è½¦åŽ¢æ— æ³•è¿è¡Œï¼‰ ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼ˆä¸€è¾†ç«è½¦å¯ä»¥æœ‰å¤šä¸ªè½¦åŽ¢ï¼‰ ä¸åŒè¿›ç¨‹é—´æ•°æ®å¾ˆéš¾å…±äº«ï¼ˆä¸€è¾†ç«è½¦ä¸Šçš„ä¹˜å®¢å¾ˆéš¾æ¢åˆ°å¦å¤–ä¸€è¾†ç«è½¦ï¼Œæ¯”å¦‚ç«™ç‚¹æ¢ä¹˜ï¼‰ åŒä¸€è¿›ç¨‹ä¸‹ä¸åŒçº¿ç¨‹é—´æ•°æ®å¾ˆæ˜“å…±äº«ï¼ˆAè½¦åŽ¢æ¢åˆ°Bè½¦åŽ¢å¾ˆå®¹æ˜“ï¼‰ è¿›ç¨‹è¦æ¯”çº¿ç¨‹æ¶ˆè€—æ›´å¤šçš„è®¡ç®—æœºèµ„æºï¼ˆé‡‡ç”¨å¤šåˆ—ç«è½¦ç›¸æ¯”å¤šä¸ªè½¦åŽ¢æ›´è€—èµ„æºï¼‰ è¿›ç¨‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œä¸€ä¸ªçº¿ç¨‹æŒ‚æŽ‰å°†å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æŒ‚æŽ‰ï¼ˆä¸€åˆ—ç«è½¦ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€åˆ—ç«è½¦ï¼Œä½†æ˜¯å¦‚æžœä¸€åˆ—ç«è½¦ä¸Šä¸­é—´çš„ä¸€èŠ‚è½¦åŽ¢ç€ç«äº†ï¼Œå°†å½±å“åˆ°æ‰€æœ‰è½¦åŽ¢ï¼‰ è¿›ç¨‹å¯ä»¥æ‹“å±•åˆ°å¤šæœºï¼Œè¿›ç¨‹æœ€å¤šé€‚åˆå¤šæ ¸ï¼ˆä¸åŒç«è½¦å¯ä»¥å¼€åœ¨å¤šä¸ªè½¨é“ä¸Šï¼ŒåŒä¸€ç«è½¦çš„è½¦åŽ¢ä¸èƒ½åœ¨è¡Œè¿›çš„ä¸åŒçš„è½¨é“ä¸Šï¼‰ è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥ä¸Šé”ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸäº›å…±äº«å†…å­˜æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å®ƒç»“æŸï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸€å—å†…å­˜ã€‚ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„æ´—æ‰‹é—´ï¼‰ï¼â€œäº’æ–¥é”â€ è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥é™å®šä½¿ç”¨é‡ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„é¤åŽ…ï¼Œæœ€å¤šåªå…è®¸å¤šå°‘äººè¿›å…¥ï¼Œå¦‚æžœæ»¡äº†éœ€è¦åœ¨é—¨å£ç­‰ï¼Œç­‰æœ‰äººå‡ºæ¥äº†æ‰èƒ½è¿›åŽ»ï¼‰ï¼â€œä¿¡å·é‡â€ å†è¡¥å……å‡ å¥ã€‚ çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ è¿›ç¨‹é—´æ²¡æœ‰å…±äº«å†…å­˜ï¼Œæ‰€ä»¥äº¤äº’è¦é€šè¿‡TCP/IPç«¯å£çš„ç­‰æ–¹å¼æ¥å®žçŽ°ã€‚çº¿ç¨‹é—´ç”±äºŽæœ‰å…±äº«å†…å­˜ï¼Œæ‰€ä»¥äº¤äº’æ¯”è¾ƒæ–¹ä¾¿ã€‚ çº¿ç¨‹å ç”¨å¾ˆå¤šèµ„æºï¼Œè€Œçº¿ç¨‹åªéœ€è¦åˆ†é…æ ˆå’ŒPCå³å¯ã€‚ 8. é’ˆå¯¹è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„æ€»ç»“ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„4G(32ä½ç³»ç»Ÿä¸‹)å†…å­˜ç©ºé—´ï¼Œå„ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´å…·æœ‰ç±»ä¼¼çš„ç»“æž„ ä¸€ä¸ªæ–°è¿›ç¨‹å»ºç«‹çš„æ—¶å€™ï¼Œå°†ä¼šå»ºç«‹èµ·è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œæ­¤è¿›ç¨‹çš„æ•°æ®ï¼Œä»£ç ç­‰ä»Žç£ç›˜æ‹·è´åˆ°è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ï¼ˆå»ºç«‹ä¸€ä¸ªè¿›ç¨‹ï¼Œå°±è¦æŠŠç£ç›˜ä¸Šçš„ç¨‹åºæ–‡ä»¶æ‹·è´åˆ°è¿›ç¨‹å¯¹åº”çš„å†…å­˜ä¸­åŽ»ï¼Œå¯¹äºŽä¸€ä¸ªç¨‹åºå¯¹åº”çš„å¤šä¸ªè¿›ç¨‹è¿™ç§æƒ…å†µï¼Œæµªè´¹å†…å­˜ï¼ï¼‰ï¼Œå“ªäº›æ•°æ®åœ¨å“ªé‡Œï¼Œéƒ½ç”±è¿›ç¨‹æŽ§åˆ¶è¡¨ä¸­çš„task_structè®°å½• æ¯ä¸ªè¿›ç¨‹çš„4Gå†…å­˜ç©ºé—´åªæ˜¯è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œæ¯æ¬¡è®¿é—®å†…å­˜ç©ºé—´çš„æŸä¸ªåœ°å€ï¼Œéƒ½éœ€è¦æŠŠåœ°å€ç¿»è¯‘ä¸ºå®žé™…ç‰©ç†å†…å­˜åœ°å€ æ‰€æœ‰è¿›ç¨‹å…±äº«åŒä¸€ç‰©ç†å†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹åªæŠŠè‡ªå·±ç›®å‰éœ€è¦çš„è™šæ‹Ÿå†…å­˜ç©ºé—´æ˜ å°„å¹¶å­˜å‚¨åˆ°ç‰©ç†å†…å­˜ä¸Šã€‚ è¿›ç¨‹è¦çŸ¥é“å“ªäº›å†…å­˜åœ°å€ä¸Šçš„æ•°æ®åœ¨ç‰©ç†å†…å­˜ä¸Šï¼Œå“ªäº›ä¸åœ¨ï¼Œè¿˜æœ‰åœ¨ç‰©ç†å†…å­˜ä¸Šçš„å“ªé‡Œï¼Œéœ€è¦ç”¨é¡µè¡¨æ¥è®°å½• é¡µè¡¨çš„æ¯ä¸€ä¸ªè¡¨é¡¹åˆ†ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†è®°å½•æ­¤é¡µæ˜¯å¦åœ¨ç‰©ç†å†…å­˜ä¸Šï¼Œç¬¬äºŒéƒ¨åˆ†è®°å½•ç‰©ç†å†…å­˜é¡µçš„åœ°å€ï¼ˆå¦‚æžœåœ¨çš„è¯ï¼‰ å½“è¿›ç¨‹è®¿é—®æŸä¸ªè™šæ‹Ÿåœ°å€ï¼ŒåŽ»çœ‹é¡µè¡¨ï¼Œå¦‚æžœå‘çŽ°å¯¹åº”çš„æ•°æ®ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œåˆ™ç¼ºé¡µå¼‚å¸¸ ç¼ºé¡µå¼‚å¸¸çš„å¤„ç†è¿‡ç¨‹ï¼Œå°±æ˜¯æŠŠè¿›ç¨‹éœ€è¦çš„æ•°æ®ä»Žç£ç›˜ä¸Šæ‹·è´åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œå¦‚æžœå†…å­˜å·²ç»æ»¡äº†ï¼Œæ²¡æœ‰ç©ºåœ°æ–¹äº†ï¼Œé‚£å°±æ‰¾ä¸€ä¸ªé¡µè¦†ç›–ï¼Œå½“ç„¶å¦‚æžœè¢«è¦†ç›–çš„é¡µæ›¾ç»è¢«ä¿®æ”¹è¿‡ï¼Œéœ€è¦å°†æ­¤é¡µå†™å›žç£ç›˜ 9. å…³äºŽè¿›ç¨‹å’Œçº¿ç¨‹æ›´æ·±çš„è®¤è¯† å…³äºŽä¸ºä»€ä¹ˆè¦åˆ†è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œå…ˆæŠ›å‡ºç»“è®ºï¼š è¿›ç¨‹processï¼šè¿›ç¨‹å°±æ˜¯æ—¶é—´æ€»å’Œ=æ‰§è¡ŒçŽ¯å¢ƒåˆ‡æ¢æ—¶é—´+ç¨‹åºæ‰§è¡Œæ—¶é—´------&gt;CPUåŠ è½½æ‰§è¡ŒçŽ¯å¢ƒ-&gt;CPUæ‰§è¡Œç¨‹åº-&gt;CPUä¿å­˜æ‰§è¡ŒçŽ¯å¢ƒ çº¿ç¨‹threadï¼šçº¿ç¨‹ä¹Ÿæ˜¯æ—¶é—´æ€»å’Œ=æ‰§è¡ŒçŽ¯å¢ƒåˆ‡æ¢æ—¶é—´ï¼ˆå…±äº«è¿›ç¨‹çš„ï¼‰+ç¨‹åºæ¨¡å—æ‰§è¡Œæ—¶é—´------&gt;CPUåŠ è½½æ‰§è¡ŒçŽ¯å¢ƒï¼ˆå…±äº«è¿›ç¨‹çš„ï¼‰-&gt;CPUæ‰§è¡Œç¨‹åºæ‘¸å—-&gt;CPUä¿å­˜æ‰§è¡ŒçŽ¯å¢ƒï¼ˆå…±äº«è¿›ç¨‹çš„ï¼‰ è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯æè¿°CPUå·¥ä½œçš„æ—¶é—´æ®µï¼Œçº¿ç¨‹æ˜¯æ›´ç»†å°çš„æ—¶é—´æ®µã€‚ é‚£ä¹ˆï¼Œå¦‚æžœCPUæ—¶é—´ç‰‡ä¸´å¹¸æœ¬è¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹åœ¨æ¢å¤æ‰§è¡ŒçŽ¯å¢ƒä¹‹åŽï¼Œæ‰§è¡Œé‡Œé¢çš„è‹¥å¹²çº¿ç¨‹å°±ä¸éœ€è¦å†ä¸åœåœ°åˆ‡æ¢æ‰§è¡ŒçŽ¯å¢ƒäº†ï¼Œæ‰€ä»¥è¯´ï¼Œçº¿ç¨‹ç›¸æ¯”äºŽè¿›ç¨‹æ˜¯æ¯”è¾ƒè½»é‡çš„ã€‚ åœ¨CPUçœ‹æ¥æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„è½®æµæ‰§è¡Œçš„ï¼Œå…·ä½“çš„è½®æµæ–¹æ³•å°±æ˜¯ï¼šå…ˆåŠ è½½ç¨‹åºAçš„ä¸Šä¸‹æ–‡ï¼Œç„¶åŽå¼€å§‹æ‰§è¡ŒAï¼Œä¿å­˜ç¨‹åºAçš„ä¸Šä¸‹æ–‡ï¼Œè°ƒå…¥ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ç¨‹åºBçš„ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç„¶åŽå¼€å§‹æ‰§è¡ŒB,ä¿å­˜ç¨‹åºBçš„ä¸Šä¸‹æ–‡ã€‚ã€‚ã€‚ã€‚ è¿›ç¨‹å°±æ˜¯åŒ…æ¢ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç¨‹åºæ‰§è¡Œæ—¶é—´æ€»å’Œ = CPUåŠ è½½ä¸Šä¸‹æ–‡+CPUæ‰§è¡Œ+CPUä¿å­˜ä¸Šä¸‹æ–‡ çº¿ç¨‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿›ç¨‹çš„é¢—ç²’åº¦å¤ªå¤§ï¼Œæ¯æ¬¡éƒ½è¦æœ‰ä¸Šä¸‹çš„è°ƒå…¥ï¼Œä¿å­˜ï¼Œè°ƒå‡ºã€‚å¦‚æžœæˆ‘ä»¬æŠŠè¿›ç¨‹æ¯”å–»ä¸ºä¸€ä¸ªè¿è¡Œåœ¨ç”µè„‘ä¸Šçš„è½¯ä»¶ï¼Œé‚£ä¹ˆä¸€ä¸ªè½¯ä»¶çš„æ‰§è¡Œä¸å¯èƒ½æ˜¯ä¸€æ¡é€»è¾‘æ‰§è¡Œçš„ï¼Œå¿…å®šæœ‰å¤šä¸ªåˆ†æ”¯å’Œå¤šä¸ªç¨‹åºæ®µï¼Œå°±å¥½æ¯”è¦å®žçŽ°ç¨‹åºAï¼Œå®žé™…åˆ†æˆ aï¼Œbï¼Œcç­‰å¤šä¸ªå—ç»„åˆè€Œæˆã€‚é‚£ä¹ˆè¿™é‡Œå…·ä½“çš„æ‰§è¡Œå°±å¯èƒ½å˜æˆï¼šç¨‹åºAå¾—åˆ°CPU =ã€‹CPUåŠ è½½ä¸Šä¸‹æ–‡ï¼Œå¼€å§‹æ‰§è¡Œç¨‹åºAçš„aå°æ®µï¼Œç„¶åŽæ‰§è¡ŒAçš„bå°æ®µï¼Œç„¶åŽå†æ‰§è¡ŒAçš„cå°æ®µï¼Œæœ€åŽCPUä¿å­˜Açš„ä¸Šä¸‹æ–‡ã€‚ è¿™é‡Œaï¼Œbï¼Œcçš„æ‰§è¡Œæ˜¯å…±äº«äº†Açš„ä¸Šä¸‹æ–‡ï¼ŒCPUåœ¨æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„ã€‚è¿™é‡Œçš„aï¼Œbï¼Œcå°±æ˜¯çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ˜¯å…±äº«äº†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡çŽ¯å¢ƒã€æ›´ä¸ºç»†å°çš„CPUæ—¶é—´æ®µã€‚ è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯ä¸€ä¸ªæ—¶é—´æ®µçš„æè¿°ï¼Œæ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ï¼Œä¸è¿‡æ˜¯é¢—ç²’å¤§å°ä¸åŒã€‚ æ•´ç†è‡ªï¼š https://www.zhihu.com/question/25532384 https://blog.csdn.net/moshenglv/article/details/52242153 https://blog.csdn.net/u012861978/article/details/53048077]]></content>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€æ­¥ä¸€æ­¥ç†è§£HTTPS]]></title>
    <url>%2F2019%2F01%2F18%2Fnetwork%2F7.%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E7%90%86%E8%A7%A3HTTPS%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬ä¸ƒç¯‡æ–‡ç« ã€‚HTTPSï¼ˆSSL/TLSï¼‰çš„åŠ å¯†æœºåˆ¶æ˜¯å‰ç«¯åŽç«¯ioså®‰å“ç­‰éƒ½åº”äº†è§£çš„åŸºæœ¬é—®é¢˜ã€‚ä¹Ÿæ˜¯é¢è¯•ç»å¸¸é—®çš„ç‚¹ã€‚ ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦åŠ å¯†ï¼Ÿ å°æ—¶å€™çœ‹è°æˆ˜ç‰‡ï¼Œæƒ…æŠ¥å‘è¿‡æ¥äº†ä¹‹åŽï¼Œç”¨ä¸€ä¸ªå°æœ¬æœ¬è¿›è¡Œç¿»è¯‘ï¼Œç„¶åŽè§£å¯†å‡ºæƒ…æŠ¥ã€‚åŠ å¯†å°±æ˜¯é˜²æ­¢æ˜Žæ–‡è¢«åˆ«äººçœ‹åˆ°ç”šè‡³ç¯¡æ”¹å˜›ï¼ å›žåˆ°äº’è”ç½‘ï¼Œå› ä¸ºhttpçš„å†…å®¹æ˜¯æ˜Žæ–‡ä¼ è¾“çš„ï¼Œæ˜Žæ–‡æ•°æ®ä¼šç»è¿‡ä¸­é—´ä»£ç†æœåŠ¡å™¨ã€è·¯ç”±å™¨ã€wifiçƒ­ç‚¹ã€é€šä¿¡æœåŠ¡è¿è¥å•†ç­‰å¤šä¸ªç‰©ç†èŠ‚ç‚¹ï¼Œå¦‚æžœä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«åŠ«æŒï¼Œä¼ è¾“çš„å†…å®¹å°±å®Œå…¨æš´éœ²äº†ï¼Œä»–è¿˜å¯ä»¥ç¯¡æ”¹ä¼ è¾“çš„ä¿¡æ¯ä¸”ä¸è¢«åŒæ–¹å¯Ÿè§‰ï¼Œè¿™å°±æ˜¯ä¸­é—´äººæ”»å‡»ã€‚æ‰€ä»¥æˆ‘ä»¬æ‰éœ€è¦å¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†ã€‚æœ€ç®€å•å®¹æ˜“ç†è§£çš„å°±æ˜¯å¯¹ç§°åŠ å¯† ã€‚ äºŒã€ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†ï¼Ÿ å°æ˜Žå†™ä¸ªæ±‚çˆ±ä¿¡ç»™å°çº¢ï¼Œå°æ˜Žæ‹…å¿ƒå°çº¢çš„å¦ˆå¦ˆçœ‹åˆ°è¿™å°ä¿¡çš„å†…å®¹ï¼Œä»–çµæœºä¸€åŠ¨ï¼Œå¯¹ä¿¡åŠ ä¸ªå¯†ï¼Œå¹¶ç¡®å®šå¥½æˆ‘ç”¨è¿™ä¸ªå¯†é’¥åŠ å¯†çš„ï¼Œå°çº¢æ”¶åˆ°ä¹‹åŽä¹Ÿç”¨è¿™ä¸ªå¯†é’¥è§£å¯†æ‰è¡Œã€‚ ä½†æ˜¯å‘¢ï¼Œè¿™é‡Œæœ‰ä¸ªéº»çƒ¦çš„åœ°æ–¹å°±æ˜¯ï¼Œå°æ˜Žå’Œå°çº¢ä¸åœ¨ä¸€ä¸ªå­¦æ ¡ï¼Œè¿™ä¸ªé’¥åŒ™å‘¢ï¼Œä¸æ–¹ä¾¿ç›´æŽ¥é€åˆ°æ‰‹é‡Œã€‚æ‰€ä»¥å‘¢ï¼Œå°æ˜Žå¾—æƒ³åŠžæ³•æŠŠè¿™ä¸ªé’¥åŒ™å¯„ä¸€ä¸ªé€ç»™å°çº¢ï¼Œå¥½å§ï¼Œå°±ç”¨æœ€è´µçš„é¡ºä¸°å§ï¼ å°±æ˜¯æœ‰ä¸€ä¸ªå¯†é’¥ï¼Œå®ƒå¯ä»¥å¯¹ä¸€æ®µå†…å®¹åŠ å¯†ï¼ŒåŠ å¯†åŽåªèƒ½ç”¨å®ƒæ‰èƒ½è§£å¯†çœ‹åˆ°åŽŸæœ¬çš„å†…å®¹ï¼Œå’Œæˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­ç”¨çš„é’¥åŒ™ä½œç”¨å·®ä¸å¤šã€‚ ä¸‰ã€ç”¨å¯¹ç§°åŠ å¯†å¯è¡Œå—ï¼Ÿ é¡ºä¸°å¿«é€’åˆ°äº†ï¼Œç»“æžœå°çº¢ä¸åœ¨å®¶ï¼Œå°çº¢çš„å¦ˆå¦ˆæ”¶åˆ°äº†ï¼Œä¸€çœ‹æ˜¯ä¸ªç”·åŒå­¦å¯„çš„ï¼Œæ€Žä¹ˆèƒ½å¿ä½ï¼Œèµ¶ç´§æ‰“å¼€ï¼Œä»¥çœ‹æ˜¯ä¸€æŠŠé’¥åŒ™ï¼Œä½œä¸ºç¨‹åºçŒ¿ï¼Œå¦ˆå¦ˆå¾—æ„ä¸€ç¬‘ï¼šå“¼å“¼ï¼Œè¿˜èƒ½é€ƒè¿‡æˆ‘çš„çœ¼ç›ï¼Ÿæˆ‘èµ¶ç´§å¤åˆ¶ä¸€æŠŠè—ç€ï¼Œæˆ‘å€’è¦çœ‹çœ‹ä»–åŽé¢è¦å¯„å•¥æ¥ï¼Œè¿˜è¦åŠ å¯†ï¼Ÿï¼ æžœç„¶å°çº¢çš„å¦ˆå¦ˆç­‰åˆ°äº†æ¥è‡ªå°æ˜Žå¯„è¿‡æ¥çš„æƒ…ä¹¦ï¼Œè§£å¯†ä¸€çœ‹ï¼Œå®žé”¤æ—©æ‹ã€‚ åŒæ ·åœ°ï¼Œå°æ˜Žè¿™è¾¹ä¹Ÿéžå¸¸å±é™©ï¼Œå¿«é€’å‘˜åˆšå‡ºå‘ï¼Œå°±è¢«å°æ˜Žçš„å¦ˆå¦ˆæ‹¦æˆªäº†ï¼Œæ‹¿åˆ°äº†è¿™ä¸ªé’¥åŒ™ï¼Œé‚£å°æ˜Žè¿˜æ²¡å¯„å‡ºçš„ä¿¡å·²ç»è¢«å¦ˆå¦ˆçœ‹å…‰äº†ã€‚ æ‰€ä»¥é—®é¢˜çš„æ ¹æœ¬å°±æ˜¯ï¼Œè¿™æŠŠé’¥åŒ™è¦ä¼ è¾“ï¼Œä¼ è¾“å°±å¯èƒ½è¢«æˆªå–ã€‚ å›žåˆ°äº’è”ç½‘ï¼Œå¦‚æžœé€šä¿¡åŒæ–¹éƒ½å„è‡ªæŒæœ‰åŒä¸€ä¸ªå¯†é’¥ï¼Œä¸”æ²¡æœ‰åˆ«äººçŸ¥é“ï¼Œè¿™ä¸¤æ–¹çš„é€šä¿¡å®‰å…¨å½“ç„¶æ˜¯å¯ä»¥è¢«ä¿è¯çš„ï¼ˆé™¤éžå¯†é’¥è¢«ç ´è§£ï¼‰ã€‚ ç„¶è€Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯è¿™ä¸ªå¯†é’¥æ€Žä¹ˆè®©ä¼ è¾“çš„åŒæ–¹çŸ¥æ™“ï¼ŒåŒæ—¶ä¸è¢«åˆ«äººçŸ¥é“ã€‚ å¦‚æžœç”±æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¹¶ä¼ è¾“ç»™æµè§ˆå™¨ï¼Œé‚£è¿™ä¸ªä¼ è¾“è¿‡ç¨‹ä¸­å¯†é’¥è¢«åˆ«äººåŠ«æŒå¼„åˆ°æ‰‹äº†æ€Žä¹ˆåŠžï¼Ÿ æ¢ç§æ€è·¯ï¼Ÿè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æžœæµè§ˆå™¨å†…éƒ¨å°±é¢„å­˜äº†ç½‘ç«™Açš„å¯†é’¥ï¼Œä¸”å¯ä»¥ç¡®ä¿é™¤äº†æµè§ˆå™¨å’Œç½‘ç«™Aï¼Œä¸ä¼šæœ‰ä»»ä½•å¤–äººçŸ¥é“è¯¥å¯†é’¥ï¼Œé‚£ç†è®ºä¸Šç”¨å¯¹ç§°åŠ å¯†æ˜¯å¯ä»¥çš„ï¼Œè¿™æ ·æµè§ˆå™¨åªè¦é¢„å­˜å¥½ä¸–ç•Œä¸Šæ‰€æœ‰HTTPSç½‘ç«™çš„å¯†é’¥å°±è¡Œå•¦ï¼è¿™ä¹ˆåšæ˜¾ç„¶ä¸çŽ°å®žã€‚ æ€Žä¹ˆåŠžï¼Ÿæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ç¥žå¥‡çš„éžå¯¹ç§°åŠ å¯†ã€‚ å››ã€ä»€ä¹ˆæ˜¯éžå¯¹ç§°åŠ å¯†ï¼Ÿ æœ‰ä¸¤æŠŠå¯†é’¥ï¼Œé€šå¸¸ä¸€æŠŠå«åšå…¬é’¥ã€ä¸€æŠŠå«åšç§é’¥ã€‚ ç”¨å…¬é’¥åŠ å¯†çš„å†…å®¹å¿…é¡»ç”¨ç§é’¥æ‰èƒ½è§£å¼€ï¼ŒåŒæ ·ï¼Œç§é’¥åŠ å¯†çš„å†…å®¹åªæœ‰å…¬é’¥èƒ½è§£å¼€ã€‚ äº”ã€ç”¨éžå¯¹ç§°åŠ å¯†å¯è¡Œå—ï¼Ÿ å…¬é’¥å‘¢ï¼Œè¿˜æ˜¯è¦é€šè¿‡å¿«é€’å‘˜é€ç»™å°çº¢çš„ã€‚OKï¼Œå‡è®¾å°çº¢è¦å›žä¿¡ï¼Œå†™å¥½äº†ç”¨å…¬é’¥åŠ å¯†ï¼Œå°çº¢çš„å¦ˆå¦ˆå› ä¸ºæ‹¿ä¸åˆ°ç§é’¥ï¼Œçœ‹ä¸åˆ°ä¿¡çš„å†…å®¹ã€‚ OKï¼Œä½†æ˜¯åè¿‡æ¥å‘¢ï¼Ÿå°æ˜Žç”¨ç§é’¥åŠ å¯†ä¼ ç»™å°çº¢ï¼Œé‚£ä¹ˆå°çº¢çš„å¦ˆå¦ˆå¯å°±èƒ½è§£å¯†äº†ï¼ˆå› ä¸ºå…¬é’¥å¯èƒ½ä¼šè¢«å°çº¢çš„å¦ˆå¦ˆæ‹¿åˆ°ï¼‰ã€‚ å›žåˆ°äº’è”ç½‘ï¼ŒæœåŠ¡å™¨å…ˆæŠŠå…¬é’¥ç›´æŽ¥æ˜Žæ–‡ä¼ è¾“ç»™æµè§ˆå™¨ï¼Œä¹‹åŽæµè§ˆå™¨å‘æœåŠ¡å™¨ä¼ æ•°æ®å‰éƒ½å…ˆç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†å¥½å†ä¼ ï¼Œè¿™æ¡æ•°æ®çš„å®‰å…¨ä¼¼ä¹Žå¯ä»¥ä¿éšœäº†ï¼å› ä¸ºåªæœ‰æœåŠ¡å™¨æœ‰ç›¸åº”çš„ç§é’¥èƒ½è§£å¼€è¿™æ¡æ•°æ®ã€‚ ç„¶è€Œç”±æœåŠ¡å™¨åˆ°æµè§ˆå™¨çš„è¿™æ¡è·¯æ€Žä¹ˆä¿éšœå®‰å…¨ï¼Ÿ å¦‚æžœæœåŠ¡å™¨ç”¨å®ƒçš„çš„ç§é’¥åŠ å¯†æ•°æ®ä¼ ç»™æµè§ˆå™¨ï¼Œé‚£ä¹ˆæµè§ˆå™¨ç”¨å…¬é’¥å¯ä»¥è§£å¯†å®ƒï¼Œè€Œè¿™ä¸ªå…¬é’¥æ˜¯ä¸€å¼€å§‹é€šè¿‡æ˜Žæ–‡ä¼ è¾“ç»™æµè§ˆå™¨çš„ï¼Œè¿™ä¸ªå…¬é’¥è¢«è°åŠ«æŒåˆ°çš„è¯ï¼Œä»–ä¹Ÿèƒ½ç”¨è¯¥å…¬é’¥è§£å¯†æœåŠ¡å™¨ä¼ æ¥çš„ä¿¡æ¯äº†ã€‚ æ‰€ä»¥ç›®å‰ä¼¼ä¹Žåªèƒ½ä¿è¯ç”±æµè§ˆå™¨å‘æœåŠ¡å™¨ä¼ è¾“æ•°æ®æ—¶çš„å®‰å…¨æ€§ï¼ˆå…¶å®žä»æœ‰æ¼æ´žï¼Œä¸‹æ–‡ä¼šè¯´ï¼‰ã€‚ å…­ã€æ”¹è‰¯çš„éžå¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œä¼¼ä¹Žå¯ä»¥ï¼Ÿ å°æ˜Žå’Œå°çº¢å¹´çºªä¸å¤§ï¼Œä½†æ˜¯å¾ˆèªæ˜Žï¼Œé’ˆå¯¹è¿™ä¸ªæƒ…å†µï¼Œè¿˜æ˜¯è¿…é€Ÿå‡çº§åŠ å¯†æ–¹æ³•ã€‚ä»–ä»¬æƒ³åˆ°æ—¢ç„¶ä¸€ç»„å…¬é’¥ç§é’¥ä¸å¤Ÿï¼Œé‚£ä¸¤ç»„å‘¢ï¼Ÿ OKï¼Œå°æ˜Žå’Œå°çº¢å„é€ äº†ä¸€å¯¹ã€‚ä¸‹é¢å°±æ˜¯äº’ç›¸äº¤æ¢å…¬é’¥ã€‚é‚£ä¹ˆå°±å˜æˆï¼š ä¸‹é¢å°±å¥½åŠžå•¦ï¼Œå°æ˜Žå†™ä¿¡ç”¨å…¬é’¥BåŠ å¯†ï¼Œé‚£ä¹ˆä¿¡çš„å†…å®¹åªæœ‰å°çº¢èƒ½ç ´è§£ï¼Œå› ä¸ºå°çº¢æ˜¯éšèº«æºå¸¦ç§é’¥Bã€‚ç›¸åï¼Œå°çº¢ç”¨å…¬é’¥Aå¯¹ä¿¡åŠ å¯†ï¼Œè¿™æ ·åªæœ‰å°æ˜Žèƒ½ç ´è§£ï¼Œå› ä¸ºå°æ˜Žä¹Ÿæ˜¯éšèº«æºå¸¦ç§é’¥Aã€‚å¥½åƒå¾ˆå®‰å…¨å•¦ï¼é™¤äº†ä¸‹é¢æåˆ°çš„æ¼æ´žï¼Œå”¯ä¸€çš„ç¼ºç‚¹å¯èƒ½æ˜¯ï¼šå°çº¢å¾—èŠ±åŠå¤©æ—¶é—´æ‰èƒ½è§£å¯†å®Œè¿™å°ä¿¡ï¼Œæœ‰ç‚¹å—ä¸äº†ã€‚ å›žåˆ°äº’è”ç½‘ã€‚è¯·çœ‹ä¸‹é¢çš„è¿‡ç¨‹ï¼š æŸç½‘ç«™æ‹¥æœ‰ç”¨äºŽéžå¯¹ç§°åŠ å¯†çš„å…¬é’¥Aã€ç§é’¥Aï¼›æµè§ˆå™¨æ‹¥æœ‰ç”¨äºŽéžå¯¹ç§°åŠ å¯†çš„å…¬é’¥Bã€ç§é’¥Bã€‚ æµè§ˆå™¨åƒç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥Aæ˜Žæ–‡ç»™ä¼ è¾“æµè§ˆå™¨ã€‚ æµè§ˆå™¨æŠŠå…¬é’¥Bæ˜Žæ–‡ä¼ è¾“ç»™æœåŠ¡å™¨ã€‚ ä¹‹åŽæµè§ˆå™¨å‘æœåŠ¡å™¨ä¼ è¾“çš„æ‰€æœ‰ä¸œè¥¿éƒ½ç”¨å…¬é’¥AåŠ å¯†ï¼ŒæœåŠ¡å™¨æ”¶åˆ°åŽç”¨ç§é’¥Aè§£å¯†ã€‚ç”±äºŽåªæœ‰æœåŠ¡å™¨æ‹¥æœ‰è¿™ä¸ªç§é’¥Aå¯ä»¥è§£å¯†ï¼Œæ‰€ä»¥èƒ½ä¿è¯è¿™æ¡æ•°æ®çš„å®‰å…¨ã€‚ æœåŠ¡å™¨å‘æµè§ˆå™¨ä¼ è¾“çš„æ‰€æœ‰ä¸œè¥¿éƒ½ç”¨å…¬é’¥BåŠ å¯†ï¼Œæµè§ˆå™¨æ”¶åˆ°åŽç”¨ç§é’¥Bè§£å¯†ã€‚åŒä¸Šä¹Ÿå¯ä»¥ä¿è¯è¿™æ¡æ•°æ®çš„å®‰å…¨ã€‚ çš„ç¡®å¯ä»¥ï¼æŠ›å¼€è¿™é‡Œé¢ä»æœ‰çš„æ¼æ´žä¸è°ˆï¼ˆä¸‹æ–‡ä¼šè®²ï¼‰ï¼ŒHTTPSçš„åŠ å¯†å´æ²¡ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿæœ€ä¸»è¦çš„åŽŸå› æ˜¯éžå¯¹ç§°åŠ å¯†ç®—æ³•éžå¸¸è€—æ—¶ï¼Œç‰¹åˆ«æ˜¯åŠ å¯†è§£å¯†ä¸€äº›è¾ƒå¤§æ•°æ®çš„æ—¶å€™æœ‰äº›åŠ›ä¸ä»Žå¿ƒã€‚ ä¸ƒã€éžå¯¹ç§°åŠ å¯†+å¯¹ç§°åŠ å¯†ï¼Ÿ å°æ˜Žä¹ŸçŸ¥é“ï¼Œè¿™ä¸ªä¿¡å¾ˆé•¿ï¼Œç”¨éžå¯¹ç§°åŠ å¯†ï¼Œå¤ªæ…¢ï¼åŠžæ³•ä¹Ÿæœ‰ï¼Œæ²¡æœ‰å¿…è¦å¯¹é‚£ä¹ˆé•¿çš„ä¿¡åŠ å¯†ï¼Œæˆ‘åªè¦ä¿è¯è¿™ä¸ªçœŸæ­£è§£å¯†çš„é’¥åŒ™ä¸è¢«åˆ«äººæ‹¿åˆ°å°±è¡Œï¼Œé‚£ä¹ˆä»–çµæœºä¸€åŠ¨æƒ³åˆ°è¿™ä¸ªæ–¹æ³•ï¼š å°æ˜Žå’Œå°çº¢åˆ©ç”¨éžå¯¹ç§°åŠ å¯†å¯¹é’¥åŒ™åŠ å¯†ï¼Œå§‘ä¸”è®¤ä¸ºæ˜¯è¿™ä¸ªé’¥åŒ™è¢«æ”¾åœ¨äº†ä¸€ä¸ªç›’å­é‡Œï¼Œè¿™ä¸ªç›’å­ä¹Ÿè¢«é”èµ·æ¥äº†ï¼Œåªæœ‰å°çº¢æˆ–è€…å°æ˜Žæ‰èƒ½æ‰“å¼€ç›’å­ï¼Œå†ç”¨é’¥åŒ™åŽ»è§£å¯†ã€‚ è¿™ä¸ªçœŸæ­£ç”¨äºŽå¯¹ç§°åŠ å¯†è§£å¯†çš„é’¥åŒ™åˆ«äººå°±æ‹¿ä¸åˆ°å•¦ï¼ è‡ªä»Žç”¨äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œæ„Ÿè§‰åˆå®‰å…¨ï¼Œè§£å¯†åˆå¿«ï¼Œæ„Ÿæƒ…åˆæ·±æ¸©äº†å‘¢ï¼ å›žåˆ°äº’è”ç½‘ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š æŸç½‘ç«™æ‹¥æœ‰ç”¨äºŽéžå¯¹ç§°åŠ å¯†çš„å…¬é’¥Aã€ç§é’¥Aã€‚ æµè§ˆå™¨åƒç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥Aæ˜Žæ–‡ç»™ä¼ è¾“æµè§ˆå™¨ã€‚ æµè§ˆå™¨éšæœºç”Ÿæˆä¸€ä¸ªç”¨äºŽå¯¹ç§°åŠ å¯†çš„å¯†é’¥Xï¼Œç”¨å…¬é’¥AåŠ å¯†åŽä¼ ç»™æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨æ‹¿åˆ°åŽç”¨ç§é’¥Aè§£å¯†å¾—åˆ°å¯†é’¥Xã€‚ è¿™æ ·åŒæ–¹å°±éƒ½æ‹¥æœ‰å¯†é’¥Xäº†ï¼Œä¸”åˆ«äººæ— æ³•çŸ¥é“å®ƒã€‚ä¹‹åŽåŒæ–¹æ‰€æœ‰æ•°æ®éƒ½ç”¨å¯†é’¥XåŠ å¯†è§£å¯†ã€‚ HTTPSçš„åŸºæœ¬æ€æƒ³å°±æ˜¯åŸºäºŽè¿™ä¸ªã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆä¹Ÿå­˜åœ¨ä¸Šé¢ä¸€ç›´åœ¨è¯´çš„æ¼æ´žã€‚ å…«ã€ä¸­é—´äººæ”»å‡» åƒå¦ˆå¦ˆè¿™æ ·çº§åˆ«çš„ç¨‹åºçŒ¿å¯èƒ½æ˜¯é‚£ä»–ä»¬ä¸¤æ²¡åŠžæ³•å•¦ï¼Œä½†æ˜¯å‘¢ï¼Œæ ¡åŒºæœ‰ä¸ªçœ‹é—¨çš„å¤§çˆ·ï¼Œä»¥å‰æ˜¯ä¸ªé»‘å®¢ï¼Œä¹Ÿä¸çŸ¥é“å’‹å›žäº‹ï¼Œæ˜Žæ˜Žæ‰50å²ï¼Œä½†æ˜¯çœ‹èµ·æ¥åƒ80å²ï¼Œå¤´ä¸Šå…‰æºœæºœçš„ï¼Œå†¬å¤©å†·å‘¢ã€‚æ•´å¤©åœ¨é‚£èƒ¡è¨€ä¹±è¯­ï¼šdockerç‰›é€¼å•Šï¼Œspring cloudç‰›é€¼å•Šï¼Œè¿™ä¸ªå¼€æºè½¯ä»¶XXXå†™çš„çœŸå¥½ï¼Œè·Ÿå‘¨å›´çš„è€å¤§çˆ·è€å¤§å¦ˆæ ¹æœ¬è°ˆä¸åˆ°ä¸€èµ·åŽ»ã€‚ ä»–ä¹Ÿæ˜¯é—²çš„è›‹ç–¼ï¼Œéžè¦æŽºå’Œï¼Œå› ä¸ºæ®è¯´ä»–ä»¥å‰å•èº«30å¹´ï¼Œè‹¦é€¼æ•²ä»£ç ï¼Œä¸çŸ¥é“è°ˆæ‹çˆ±æ˜¯å•¥æ»‹å‘³ï¼Œå§‘ä¸”è®¤ä¸ºä»–å¥½å¥‡å¿ƒé‡å§ã€‚ åœ¨å°æ˜Žç¬¬ä¸€æ¬¡å¯„å…¬é’¥Açš„æ—¶å€™ï¼Œå¤§çˆ·å‡ºæ‰‹äº†ï¼Œæˆªå–ä¸‹æ¥ã€‚æ¢æˆè‡ªå·±åšçš„å…¬é’¥Bã€‚ç„¶åŽé€ç»™å°çº¢ã€‚ å°çº¢å“ªé‡Œä¼šçŸ¥é“è¿™å…¬é’¥è¢«æŽ‰åŒ…äº†å‘¢ï¼Œæ‰€ä»¥ç›´æŽ¥å°±ç”¨äº†ï¼ŒæŒ‰ç…§æ­£å¸¸æ­¥éª¤ï¼Œå°çº¢æƒ³äº†ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œè¿™æ¬¡å°±å«xiaomingwoxuanniå§ï¼ŒOKï¼Œç”¨è¿™ä¸ªå…¬é’¥Bå¯¹è¿™ä¸ªå­—ç¬¦ä¸²åŠ ä¸ªå¯†ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±è¢«é”è¿›äº†ç”¨å¤§çˆ·å…¬é’¥Bé”çš„ç›’å­é‡Œã€‚ è€å¤§çˆ·åœ¨é—¨å£å®ˆç€å‘¢ï¼Œä¸€çœ‹åˆ°å°çº¢å¯„ä¸œè¥¿äº†ï¼Œåˆå·å·åœ°æˆªå–ä¸‹æ¥ï¼Œç”¨è‡ªå·±çš„ç§é’¥Bæ¥è§£å¯†è¿™ä¸ªç›’å­ã€‚è½»æ˜“åœ°æ‹¿åˆ°äº†é‡Œé¢çš„å­—ç¬¦ä¸²ï¼ŒOKï¼Œæ€•å°æ˜Žå¯Ÿè§‰ï¼Œå†ç”¨å°æ˜Žå¯„æ¥çš„å…¬é’¥AåŠ å¯†ä¼ ç»™å°æ˜Žï¼Œè¿™æ ·åŒæ–¹éƒ½ä¸çŸ¥é“ä»–ä»¬çš„é’¥åŒ™å·²ç»è¢«å¤§çˆ·ç»™èŽ·å–äº†ã€‚ å°æ˜Žå’Œå°çº¢ä¹‹é—´çš„ä¿¡å°±ç”¨xiaomingwoxuanniè¿™ä¸ªé’¥åŒ™è¿›è¡Œå¯¹ç§°åŠ å¯†å’Œå¯¹ç§°è§£å¯†ï¼Œå®Œå…¨ä¸çŸ¥é“æœ‰ä¸ªå¤§çˆ·å°±å¤©å¤©æ‹¿ç€è¿™ä¸ªå­—ç¬¦ä¸²åŽ»è§£å¯†ä¿¡ä»¶ï¼Œçœ‹çš„ä¸äº¦ä¹ä¹Žï¼Œç”šè‡³è¿˜å·å·æ”¹å‡ ä¸ªå­—å‘¢ã€‚ å›žåˆ°äº’è”ç½‘ã€‚ä¸­é—´äººçš„ç¡®æ— æ³•å¾—åˆ°æµè§ˆå™¨ç”Ÿæˆçš„å¯†é’¥Bï¼Œè¿™ä¸ªå¯†é’¥æœ¬èº«è¢«å…¬é’¥AåŠ å¯†äº†ï¼Œåªæœ‰æœåŠ¡å™¨æ‰æœ‰ç§é’¥Aè§£å¼€æ‹¿åˆ°å®ƒå‘€ï¼ç„¶è€Œä¸­é—´äººå´å®Œå…¨ä¸éœ€è¦æ‹¿åˆ°å¯†é’¥Aå°±èƒ½å¹²åäº‹äº†ã€‚è¯·çœ‹ï¼š æŸç½‘ç«™æ‹¥æœ‰ç”¨äºŽéžå¯¹ç§°åŠ å¯†çš„å…¬é’¥Aã€ç§é’¥Aã€‚ æµè§ˆå™¨å‘ç½‘ç«™æœåŠ¡å™¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŠŠå…¬é’¥Aæ˜Žæ–‡ç»™ä¼ è¾“æµè§ˆå™¨ã€‚ ä¸­é—´äººåŠ«æŒåˆ°å…¬é’¥Aï¼Œä¿å­˜ä¸‹æ¥ï¼ŒæŠŠæ•°æ®åŒ…ä¸­çš„å…¬é’¥Aæ›¿æ¢æˆè‡ªå·±ä¼ªé€ çš„å…¬é’¥Bï¼ˆå®ƒå½“ç„¶ä¹Ÿæ‹¥æœ‰å…¬é’¥Bå¯¹åº”çš„ç§é’¥Bï¼‰ã€‚ æµè§ˆå™¨éšæœºç”Ÿæˆä¸€ä¸ªç”¨äºŽå¯¹ç§°åŠ å¯†çš„å¯†é’¥Xï¼Œç”¨å…¬é’¥Bï¼ˆæµè§ˆå™¨ä¸çŸ¥é“å…¬é’¥è¢«æ›¿æ¢äº†ï¼‰åŠ å¯†åŽä¼ ç»™æœåŠ¡å™¨ã€‚ ä¸­é—´äººåŠ«æŒåŽç”¨ç§é’¥Bè§£å¯†å¾—åˆ°å¯†é’¥Xï¼Œå†ç”¨å…¬é’¥AåŠ å¯†åŽä¼ ç»™æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨æ‹¿åˆ°åŽç”¨ç§é’¥Aè§£å¯†å¾—åˆ°å¯†é’¥Xã€‚ è¿™æ ·åœ¨åŒæ–¹éƒ½ä¸ä¼šå‘çŽ°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸­é—´äººå¾—åˆ°äº†å¯†é’¥Bã€‚æ ¹æœ¬åŽŸå› æ˜¯æµè§ˆå™¨æ— æ³•ç¡®è®¤è‡ªå·±æ”¶åˆ°çš„å…¬é’¥æ˜¯ä¸æ˜¯ç½‘ç«™è‡ªå·±çš„ã€‚åªè¦è§£å†³äº†è¿™ä¸ªå…¬é’¥ä¸€å®šæ˜¯è¿™ä¸ªç½‘ç«™å‘æ¥çš„ï¼Œé‚£ä¹ˆåŸºæœ¬å°±OKäº† ä¹ã€å¦‚ä½•è¯æ˜Žæµè§ˆå™¨æ”¶åˆ°çš„å…¬é’¥ä¸€å®šæ˜¯è¯¥ç½‘ç«™çš„å…¬é’¥ï¼Ÿ çŽ°å®žç”Ÿæ´»ä¸­ï¼Œå¦‚æžœæƒ³è¯æ˜ŽæŸèº«ä»½è¯å·ä¸€å®šæ˜¯å°æ˜Žçš„ï¼Œæ€Žä¹ˆåŠžï¼Ÿçœ‹èº«ä»½è¯ã€‚è¿™é‡Œæ”¿åºœæœºæž„èµ·åˆ°äº†â€œå…¬ä¿¡â€çš„ä½œç”¨ï¼Œèº«ä»½è¯æ˜¯ç”±å®ƒé¢å‘çš„ï¼Œå®ƒæœ¬èº«çš„æƒå¨å¯ä»¥å¯¹ä¸€ä¸ªäººçš„èº«ä»½ä¿¡æ¯ä½œå‡ºè¯æ˜Žã€‚äº’è”ç½‘ä¸­èƒ½ä¸èƒ½æžè¿™ä¹ˆä¸ªå…¬ä¿¡æœºæž„å‘¢ï¼Ÿç»™ç½‘ç«™é¢å‘ä¸€ä¸ªâ€œèº«ä»½è¯â€ï¼Ÿ åã€æ•°å­—è¯ä¹¦ ç½‘ç«™åœ¨ä½¿ç”¨HTTPSå‰ï¼Œéœ€è¦å‘â€œCAæœºæž„â€ç”³è¯·é¢å‘ä¸€ä»½æ•°å­—è¯ä¹¦ï¼Œå³SSLè¯ä¹¦ï¼Œæ•°å­—è¯ä¹¦é‡Œæœ‰è¯ä¹¦æŒæœ‰è€…ã€è¯ä¹¦æŒæœ‰è€…çš„å…¬é’¥ç­‰ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æŠŠè¯ä¹¦ä¼ è¾“ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä»Žè¯ä¹¦é‡Œå–å…¬é’¥å°±è¡Œäº†ï¼Œè¯ä¹¦å°±å¦‚èº«ä»½è¯ä¸€æ ·ï¼Œå¯ä»¥è¯æ˜Žâ€œè¯¥å…¬é’¥å¯¹åº”è¯¥ç½‘ç«™â€ã€‚ç„¶è€Œè¿™é‡Œåˆæœ‰ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„é—®é¢˜äº†ï¼Œè¯ä¹¦æœ¬èº«çš„ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•é˜²æ­¢è¢«ç¯¡æ”¹ï¼Ÿå³å¦‚ä½•è¯æ˜Žè¯ä¹¦æœ¬èº«çš„çœŸå®žæ€§ï¼Ÿèº«ä»½è¯æœ‰ä¸€äº›é˜²ä¼ªæŠ€æœ¯ï¼Œæ•°å­—è¯ä¹¦æ€Žä¹ˆé˜²ä¼ªå‘¢ï¼Ÿè§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å°±åŸºæœ¬æŽ¥è¿‘èƒœåˆ©äº†ï¼ SSLè¯ä¹¦å†…å®¹ï¼š è¯ä¹¦çš„å‘å¸ƒæœºæž„CA è¯ä¹¦çš„æœ‰æ•ˆæœŸ å…¬é’¥ è¯ä¹¦æ‰€æœ‰è€… ç­¾å åä¸€ã€å¦‚ä½•æ”¾é˜²æ­¢æ•°å­—è¯ä¹¦è¢«ç¯¡æ”¹ï¼Ÿ æˆ‘ä»¬æŠŠè¯ä¹¦å†…å®¹ç”Ÿæˆä¸€ä»½â€œç­¾åâ€ï¼Œæ¯”å¯¹è¯ä¹¦å†…å®¹å’Œç­¾åæ˜¯å¦ä¸€è‡´å°±èƒ½å¯Ÿè§‰æ˜¯å¦è¢«ç¯¡æ”¹ã€‚è¿™ç§æŠ€æœ¯å°±å«æ•°å­—ç­¾åã€‚ æåˆ°æ•°å­—ç­¾åï¼Œå…¶å®žåŽŸç†å¾ˆç®€å•å•¦ï¼Œå°±æ˜¯æ¯”å¦‚æˆ‘è¦ä¼ è¾“ä¸€å¥è¯å«ï¼šâ€œä½ ç»™æˆ‘è½¬100å—é’±ï¼Œæˆ‘çš„è´¦å·æ˜¯123456ï¼Œè½¬å®Œäº†å‘Šè¯‰æˆ‘ä¸€å£°ã€‚â€ï¼Œå¦‚æžœä¸åšä»»ä½•å¤„ç†ï¼Œè¢«åˆšæ‰çš„è€å¤§çˆ·æˆªå–äº†ï¼Œä»–å·å·åœ°æ”¹ä¸€ä¸‹å†…å®¹â€œä½ ç»™æˆ‘è½¬200å—é’±ï¼Œæˆ‘çš„è´¦å·æ˜¯654321ï¼Œä¸è¦å‘Šè¯‰ä»»ä½•äººï¼Œå°¤å…¶æ˜¯ä½ å«‚å­ã€‚â€ æ˜¯ä¸æ˜¯å¤ªåäº†ï¼Œå¼„ä¸å¥½è¢«æŠ“ï¼Œå¤§çˆ·å¯ä¸æ•¢åšå¤§çš„ï¼Œåªæ•¢éª—ä¸ªå–é…’é’±ã€‚ é‚£ä¹ˆæ€Žä¹ˆé˜²æ­¢å¤§çˆ·è¿™ç§çŒ¥çæŠ€æœ¯åˆé«˜çš„äººç¯¡æ”¹å‘¢ï¼Ÿæ•°å­—ç­¾åæŽ’ä¸Šç”¨åœºå•¦ï¼ ä»¥åŽå†ä¼ æ¶ˆæ¯å°±æ˜¯â€œä½ ç»™æˆ‘è½¬100å—é’±ï¼Œæˆ‘çš„è´¦å·æ˜¯123456ï¼Œè½¬å®Œäº†å‘Šè¯‰æˆ‘ä¸€å£°ã€‚â€+â€œï¼â€¦â€¦@&amp;@%#â€¦â€¦ï¼ï¿¥@ï¿¥ï¼@%â€¦â€¦#ï¿¥ï¼%â€¦â€¦â€,åŽé¢é‚£ä¸€ä¸²ä¸œè¥¿å°±æ˜¯æ•°å­—ç­¾åï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æƒ³åŠžæ³•å¯¹å‰é¢çš„å†…å®¹è¿›è¡Œéžå¯¹ç§°åŠ å¯†ï¼ˆè¿™æ ·åˆ«äººæ ¹æœ¬ä¸çŸ¥é“ä½ åŠ å¯†çš„ç§é’¥æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå°±ä¼ªè£…ä¸äº†ç­¾åäº†ï¼‰ã€‚ä¼ è¿‡åŽ»ä¹‹åŽï¼Œæˆ‘è¦å¯¹å…¶è¿›è¡Œè§£å¯†ï¼Œä¸Žä¼ è¿‡æ¥çš„æ˜Žæ–‡ä¸€ä¸€å¯¹æ¯”å‚æ•°ï¼Œçœ‹æœ‰æ²¡æœ‰è¢«æ”¹åŠ¨è¿‡ã€‚ä¸€æ—¦å‘çŽ°å“ªé‡Œä¸å¯¹åº”ï¼Œè¯´æ˜Žå·²ç»è¢«ç¯¡æ”¹äº†ã€‚ â€œCAæœºæž„â€åˆ¶ä½œç­¾åçš„è¿‡ç¨‹ï¼š CAæ‹¥æœ‰éžå¯¹ç§°åŠ å¯†çš„ç§é’¥å’Œå…¬é’¥ã€‚ CAå¯¹è¯ä¹¦æ˜Žæ–‡ä¿¡æ¯è¿›è¡Œhashã€‚ å¯¹hashåŽçš„å€¼ç”¨ç§é’¥åŠ å¯†ï¼Œå¾—åˆ°æ•°å­—ç­¾åã€‚ æ˜Žæ–‡å’Œæ•°å­—ç­¾åå…±åŒç»„æˆäº†æ•°å­—è¯ä¹¦ï¼Œè¿™æ ·ä¸€ä»½æ•°å­—è¯ä¹¦å°±å¯ä»¥é¢å‘ç»™ç½‘ç«™äº†ã€‚ç½‘ç«™æŠŠè¿™ä¸ªæ•°å­—è¯ä¹¦ä¼ ç»™æµè§ˆå™¨ã€‚ é‚£æµè§ˆå™¨æ‹¿åˆ°æœåŠ¡å™¨ä¼ æ¥çš„æ•°å­—è¯ä¹¦åŽï¼Œå¦‚ä½•éªŒè¯å®ƒæ˜¯ä¸æ˜¯çœŸçš„ï¼Ÿï¼ˆæœ‰æ²¡æœ‰è¢«ç¯¡æ”¹ã€æŽ‰åŒ…ï¼‰ æµè§ˆå™¨éªŒè¯è¿‡ç¨‹ï¼š æ‹¿åˆ°è¯ä¹¦ï¼Œå¾—åˆ°æ˜Žæ–‡Tï¼Œæ•°å­—ç­¾åSã€‚ ç”¨CAæœºæž„çš„å…¬é’¥å¯¹Sè§£å¯†ï¼ˆç”±äºŽæ˜¯æµè§ˆå™¨ä¿¡ä»»çš„æœºæž„ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¿æœ‰å®ƒçš„å…¬é’¥ã€‚è¯¦æƒ…è§ä¸‹æ–‡ï¼‰ï¼Œå¾—åˆ°Sâ€™ã€‚ ç”¨è¯ä¹¦é‡Œè¯´æ˜Žçš„hashç®—æ³•å¯¹æ˜Žæ–‡Tè¿›è¡Œhashå¾—åˆ°Tâ€™ã€‚ æ¯”è¾ƒSâ€™æ˜¯å¦ç­‰äºŽTâ€™ï¼Œç­‰äºŽåˆ™è¡¨æ˜Žè¯ä¹¦å¯ä¿¡ã€‚ ä¸ºä»€ä¹ˆè¿™æ ·å¯ä»¥è¯æ˜Žè¯ä¹¦å¯ä¿¡å‘¢ï¼Ÿæˆ‘ä»¬æ¥ä»”ç»†æƒ³ä¸€ä¸‹ã€‚ åäºŒã€ä¸­é—´äººæœ‰å¯èƒ½ç¯¡æ”¹è¯¥è¯ä¹¦å—ï¼Ÿ è€å¤§çˆ·å°±ç®—æœ‰å¤©å¤§çš„èƒ½è€ï¼Œä¹Ÿæ‹¿ä¸åˆ°åŠ å¯†çš„ç§é’¥ï¼Œé‚£ä¹ˆåªæ˜¯å•çº¯åœ°ç¯¡æ”¹æ˜Žæ–‡ï¼Œåªä¼šé€ æˆæ ¡éªŒä¸é€šè¿‡ã€‚ å›žåˆ°äº’è”ç½‘ï¼Œå‡è®¾ä¸­é—´äººç¯¡æ”¹äº†è¯ä¹¦çš„åŽŸæ–‡ï¼Œç”±äºŽä»–æ²¡æœ‰CAæœºæž„çš„ç§é’¥ï¼Œæ‰€ä»¥æ— æ³•å¾—åˆ°æ­¤æ—¶åŠ å¯†åŽç­¾åï¼Œæ— æ³•ç›¸åº”åœ°ç¯¡æ”¹ç­¾åã€‚ æµè§ˆå™¨æ”¶åˆ°è¯¥è¯ä¹¦åŽä¼šå‘çŽ°åŽŸæ–‡å’Œç­¾åè§£å¯†åŽçš„å€¼ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜Žè¯ä¹¦å·²è¢«ç¯¡æ”¹ï¼Œè¯ä¹¦ä¸å¯ä¿¡ï¼Œä»Žè€Œç»ˆæ­¢å‘æœåŠ¡å™¨ä¼ è¾“ä¿¡æ¯ï¼Œé˜²æ­¢ä¿¡æ¯æ³„éœ²ç»™ä¸­é—´äººã€‚ åä¸‰ã€ä¸­é—´äººæœ‰å¯èƒ½æŠŠè¯ä¹¦æŽ‰åŒ…å—ï¼Ÿ å‡è®¾æœ‰å¦ä¸€ä¸ªç½‘ç«™Bä¹Ÿæ‹¿åˆ°äº†CAæœºæž„è®¤è¯çš„è¯ä¹¦ï¼Œå®ƒæƒ³æžåž®ç½‘ç«™Aï¼Œæƒ³åŠ«æŒç½‘ç«™Açš„ä¿¡æ¯ã€‚äºŽæ˜¯å®ƒæˆä¸ºä¸­é—´äººæ‹¦æˆªåˆ°äº†Aä¼ ç»™æµè§ˆå™¨çš„è¯ä¹¦ï¼Œç„¶åŽæ›¿æ¢æˆè‡ªå·±çš„è¯ä¹¦ï¼Œä¼ ç»™æµè§ˆå™¨ï¼Œä¹‹åŽæµè§ˆå™¨å°±ä¼šé”™è¯¯åœ°æ‹¿åˆ°Bçš„è¯ä¹¦é‡Œçš„å…¬é’¥äº†ï¼Œä¼šå¯¼è‡´ä¸Šæ–‡æåˆ°çš„æ¼æ´žã€‚ å…¶å®žè¿™å¹¶ä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºè¯ä¹¦é‡ŒåŒ…å«äº†ç½‘ç«™Açš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸŸåï¼Œæµè§ˆå™¨æŠŠè¯ä¹¦é‡Œçš„åŸŸåä¸Žè‡ªå·±è¯·æ±‚çš„åŸŸåæ¯”å¯¹ä¸€ä¸‹å°±çŸ¥é“æœ‰æ²¡æœ‰è¢«æŽ‰åŒ…äº†ã€‚ æ€»ç»“ï¼šå› ä¸ºä¸€ä¸ªç½‘ç«™åŸŸåå¯¹åº”ä¸€ä¸ªè¯ä¹¦ï¼Œä½ çš„è¯ä¹¦æ ¹å…¶ä»–äººçš„è¯ä¹¦è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œé‚£ä¹ˆä½ å°±ç®—æ‹¿åˆ°äº†å…¶ä»–äººçš„è¯ä¹¦å†æŽ‰åŒ…æˆè‡ªå·±çš„ï¼Œä¹Ÿæ²¡ç”¨ï¼Œæ¯•ç«Ÿæµè§ˆå™¨é‚£è¾¹åªè¦çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯æˆ‘è¦æŸ¥çœ‹çš„åŸŸåã€‚ åå››ã€ä¸ºä»€ä¹ˆåˆ¶ä½œæ•°å­—ç­¾åæ—¶éœ€è¦hashä¸€æ¬¡ï¼Ÿ æœ€æ˜¾ç„¶çš„æ˜¯æ€§èƒ½é—®é¢˜ï¼Œå‰é¢æˆ‘ä»¬å·²ç»è¯´äº†éžå¯¹ç§°åŠ å¯†æ•ˆçŽ‡è¾ƒå·®ï¼Œè¯ä¹¦ä¿¡æ¯ä¸€èˆ¬è¾ƒé•¿ï¼Œæ¯”è¾ƒè€—æ—¶ã€‚è€ŒhashåŽå¾—åˆ°çš„æ˜¯å›ºå®šé•¿åº¦çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚ç”¨md5ç®—æ³•hashåŽå¯ä»¥å¾—åˆ°å›ºå®šçš„128ä½çš„å€¼ï¼‰ï¼Œè¿™æ ·åŠ å¯†è§£å¯†å°±ä¼šå¿«å¾ˆå¤šã€‚ åäº”ã€æ€Žä¹ˆè¯æ˜ŽCAæœºæž„çš„å…¬é’¥æ˜¯å¯ä¿¡çš„ï¼Ÿ è®©æˆ‘ä»¬å›žæƒ³ä¸€ä¸‹æ•°å­—è¯ä¹¦åˆ°åº•æ˜¯å¹²å•¥çš„ï¼Ÿæ²¡é”™ï¼Œä¸ºäº†è¯æ˜ŽæŸå…¬é’¥æ˜¯å¯ä¿¡çš„ï¼Œå³â€œè¯¥å…¬é’¥æ˜¯å¦å¯¹åº”è¯¥ç½‘ç«™/æœºæž„ç­‰â€ï¼Œé‚£è¿™ä¸ªCAæœºæž„çš„å…¬é’¥æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ç”¨æ•°å­—è¯ä¹¦æ¥è¯æ˜Žï¼Ÿæ²¡é”™ï¼Œæ“ä½œç³»ç»Ÿã€æµè§ˆå™¨æœ¬èº«ä¼šé¢„è£…ä¸€äº›å®ƒä»¬ä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œå¦‚æžœå…¶ä¸­æœ‰è¯¥CAæœºæž„çš„æ ¹è¯ä¹¦ï¼Œé‚£å°±å¯ä»¥æ‹¿åˆ°å®ƒå¯¹åº”çš„å¯ä¿¡å…¬é’¥äº†ã€‚ å®žé™…ä¸Šè¯ä¹¦ä¹‹é—´çš„è®¤è¯ä¹Ÿå¯ä»¥ä¸æ­¢ä¸€å±‚ï¼Œå¯ä»¥Aä¿¡ä»»Bï¼ŒBä¿¡ä»»Cï¼Œä»¥æ­¤ç±»æŽ¨ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšä¿¡ä»»é“¾æˆ–æ•°å­—è¯ä¹¦é“¾ï¼Œä¹Ÿå°±æ˜¯ä¸€è¿žä¸²çš„æ•°å­—è¯ä¹¦ï¼Œç”±æ ¹è¯ä¹¦ä¸ºèµ·ç‚¹ï¼Œé€è¿‡å±‚å±‚ä¿¡ä»»ï¼Œä½¿ç»ˆç«¯å®žä½“è¯ä¹¦çš„æŒæœ‰è€…å¯ä»¥èŽ·å¾—è½¬æŽˆçš„ä¿¡ä»»ï¼Œä»¥è¯æ˜Žèº«ä»½ã€‚ å¦å¤–ï¼Œä¸çŸ¥ä½ ä»¬æ˜¯å¦é‡åˆ°è¿‡ç½‘ç«™è®¿é—®ä¸äº†ã€æç¤ºè¦å®‰è£…è¯ä¹¦çš„æƒ…å†µï¼Ÿè¿™é‡Œå®‰è£…çš„å°±æ˜¯æ ¹è¯ä¹¦ã€‚è¯´æ˜Žæµè§ˆå™¨ä¸è®¤ç»™è¿™ä¸ªç½‘ç«™é¢å‘è¯ä¹¦çš„æœºæž„ï¼Œé‚£ä¹ˆæ²¡æœ‰è¯¥æœºæž„çš„æ ¹è¯ä¹¦ï¼Œä½ å°±å¾—æ‰‹åŠ¨ä¸‹è½½å®‰è£…ï¼ˆé£Žé™©è‡ªå·±æ‰¿æ‹…XDï¼‰ã€‚å®‰è£…è¯¥æœºæž„çš„æ ¹è¯ä¹¦åŽï¼Œä½ å°±æœ‰äº†å®ƒçš„å…¬é’¥ï¼Œå°±å¯ä»¥ç”¨å®ƒéªŒè¯æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ˜¯å¦å¯ä¿¡äº†ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¬é’¥æ˜¯ä»Žè¯ä¹¦ä¸­èŽ·å–çš„ã€‚è¯ä¹¦æ˜¯ç½‘ç«™ä»Žæœºæž„é‚£è¾¹ç”³è¯·æ¥çš„ï¼Œè¯ä¹¦+ç­¾åä¼ ç»™æµè§ˆå™¨ã€‚åªè¦æ ¡éªŒé€šè¿‡ï¼Œé‚£ä¹ˆå…¬é’¥å¿…ç„¶æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ï¼Œå¹¶ä¸”ä¸€å®šæ˜¯è¿™ä¸ªç½‘ç«™ä¼ æ¥çš„ï¼Œé‚£ä¹ˆè§£å†³äº†æˆ‘ä»¬æœ€æ ¸å¿ƒçš„é—®é¢˜ï¼šç¡®å®šå…¬é’¥æ˜¯æˆ‘ä»¬æŒ‡å®šçš„ç½‘ç«™ä¼ æ¥çš„ã€‚ æ—¢ç„¶å…¬é’¥æ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°çº¢å°±ä¼šç”¨æ­£ç¡®çš„å…¬é’¥å¯¹éšæœºå­—ç¬¦ä¸²åŠ å¯†ï¼Œä¸­é—´ä¸ä¼šå‡ºçŽ°ç¯¡æ”¹ã€‚ åå…­ã€HTTPSå¿…é¡»åœ¨æ¯æ¬¡è¯·æ±‚ä¸­éƒ½è¦å…ˆåœ¨SSL/TLSå±‚è¿›è¡Œæ¡æ‰‹ä¼ è¾“å¯†é’¥å—ï¼Ÿ è¿™ä¹Ÿæ˜¯æˆ‘å½“æ—¶çš„å›°æƒ‘ä¹‹ä¸€ï¼Œæ˜¾ç„¶æ¯æ¬¡è¯·æ±‚éƒ½ç»åŽ†ä¸€æ¬¡å¯†é’¥ä¼ è¾“è¿‡ç¨‹éžå¸¸è€—æ—¶ï¼Œé‚£æ€Žä¹ˆè¾¾åˆ°åªä¼ è¾“ä¸€æ¬¡å‘¢ï¼Ÿç”¨sessionå°±è¡Œã€‚ æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæµè§ˆå™¨ï¼ˆæˆ–å®¢æˆ·ç«¯è½¯ä»¶ï¼‰ç»´æŠ¤ä¸€ä¸ªsession IDï¼Œåœ¨TSLæ¡æ‰‹é˜¶æ®µä¼ ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ç”Ÿæˆå¥½å¯†é’¥ä¼ ç»™æœåŠ¡å™¨åŽï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯¥å¯†é’¥å­˜åˆ°ç›¸åº”çš„session IDä¸‹ï¼Œä¹‹åŽæµè§ˆå™¨æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦session IDï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®session IDæ‰¾åˆ°ç›¸åº”çš„å¯†é’¥å¹¶è¿›è¡Œè§£å¯†åŠ å¯†æ“ä½œï¼Œè¿™æ ·å°±ä¸å¿…è¦æ¯æ¬¡é‡æ–°åˆ¶ä½œã€ä¼ è¾“å¯†é’¥äº†ï¼ åä¸ƒã€HTTPSåŽŸç† ä¸‹é¢å†æ¥çœ‹çœ‹HTTPSåŽŸç†å°±ç‰¹åˆ«ç®€å•å•¦ï¼ HTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šå¯ä»¥ç†è§£ä¸ºHTTP+SSL/TLSï¼Œ å³ HTTP ä¸‹åŠ å…¥ SSL å±‚ï¼ŒHTTPS çš„å®‰å…¨åŸºç¡€æ˜¯ SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦ SSLï¼Œç”¨äºŽå®‰å…¨çš„ HTTP æ•°æ®ä¼ è¾“ã€‚ 1234HTTPSSL/TLSTCPIP æˆ‘ä»¬åªè¦çŸ¥é“ï¼Œåœ¨SSLå±‚é‡Œé¢å¯ä»¥å®Œæˆæ ¡éªŒå’Œå¯†é’¥çš„ä¼ è¾“ã€‚ ç†è§£äº†ä¸Šé¢ï¼Œè¿™ä¸ªå›¾ä¹Ÿå°±æ²¡å•¥å¥½è§£é‡Šçš„äº†ã€‚ æ•´ç†è‡ªï¼šhttps://zhuanlan.zhihu.com/p/43789231]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HTTPåŸºç¡€çŸ¥è¯†æç‚¼]]></title>
    <url>%2F2019%2F01%2F18%2Fnetwork%2F6.HTTP%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%8F%90%E7%82%BC%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬å…­ç¯‡æ–‡ç« ã€‚è¿™é‡Œç®€å•è®°å½•ä¸€äº›å…³äºŽHTTPçš„åŸºæœ¬æ¦‚å¿µï¼Œæ¯”è¾ƒåŸºç¡€ã€‚ä¸‹é¢çš„å†…å®¹æ˜¯å¯¹ã€Šå›¾è§£HTTPã€‹æç‚¼çš„å†æç‚¼ï¼Œä¸»è¦åŽŸå› æ˜¯å¾ˆå¤šé‡è¦çš„ä¸œè¥¿å‰é¢å·²ç»è¯¦ç»†è¯´è¿‡äº†ï¼Œè¿˜æœ‰ä¸€äº›ä¸œè¥¿çŸ¥é“å³å¯ï¼Œç”¨åˆ°å†åŽ»æŸ¥ï¼Œä½œä¸ºä¸€ä¸ªåŽç«¯æ”»åŸŽç‹®ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦äº†è§£é‚£ä¹ˆçç¢Žã€‚ HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®® HTTPæ˜¯æ— çŠ¶æ€åè®®ã€‚è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ï¼ˆå³ä¸åšæŒä¹…åŒ–å¤„ç†ï¼‰ã€‚ HTTPä¹‹æ‰€ä»¥è®¾è®¡å¾—å¦‚æ­¤ç®€å•ï¼Œæ˜¯ä¸ºäº†æ›´å¿«åœ°å¤„ç†å¤§é‡äº‹ç‰©ï¼Œç¡®ä¿åè®®çš„å¯ä¼¸ç¼©æ€§ã€‚ HTTP/1.1 éšæ—¶æ— çŠ¶æ€åè®®ï¼Œä½†å¯é€šè¿‡ Cookie æŠ€æœ¯ä¿å­˜çŠ¶æ€ã€‚ å‘ŠçŸ¥æœåŠ¡å™¨æ„å›¾çš„HTTPæ–¹æ³• GETï¼šèŽ·å–èµ„æº POSTï¼šä¼ è¾“å®žä½“ä¸»ä½“ PUTï¼šä¼ è¾“æ–‡ä»¶ HEADï¼šèŽ·å¾—æŠ¥æ–‡é¦–éƒ¨ï¼Œä¸ŽGETæ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯ä¸è¿”å›žæŠ¥æ–‡ä¸»ä½“å†…å®¹ã€‚ç”¨äºŽç¡®è®¤URIçš„æœ‰æ•ˆæ€§åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰ã€‚ DELETEï¼šåˆ é™¤æ–‡ä»¶ï¼Œä¸ŽPUTç›¸åï¼ˆå“åº”è¿”å›ž204 No Contentï¼‰ã€‚ OPTIONSï¼šè¯¢é—®æ”¯æŒçš„æ–¹æ³•ï¼ŒæŸ¥è¯¢é’ˆå¯¹è¯·æ±‚URIæŒ‡å®šçš„èµ„æºæ”¯æŒçš„æ–¹æ³•ï¼ˆAllow:GETã€POSTã€HEADã€OPTIONSï¼‰ã€‚ TRACEï¼šè¿½è¸ªè·¯å¾„ CONNECTï¼šè¦æ±‚ç”¨éš§é“åè®®è¿žæŽ¥ä»£ç†ï¼ˆä¸»è¦ä½¿ç”¨SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æŽ¥å±‚ï¼‰å’ŒTLSï¼ˆTransport Layer Securityï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æŠŠé€šä¿¡å†…å®¹åŠ å¯†åŽç»ç½‘ç»œéš§é“ä¼ è¾“ï¼‰ã€‚ URIã€URL å®˜æ–¹è§£é‡Šéƒ½æ˜¯ä»€ä¹ˆä¹±èµ·å…«ç³Ÿçš„ä¸œè¥¿ã€‚å„ç§åšå®¢ä¹Ÿæ˜¯è·Ÿç€æŠ„ï¼Œè¿™ä¸¤è€…åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å’Œæ„ä¹‰ï¼Ÿ ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦URIå°±æ˜¯åœ¨æŸä¸€è§„åˆ™ä¸‹èƒ½æŠŠä¸€ä¸ªèµ„æºç‹¬ä¸€æ— äºŒåœ°æ ‡è¯†å‡ºæ¥ã€‚ å¯¹åº”äºŽå®žé™…ä¾‹å­å°±æ˜¯ï¼šæ¯ä¸ªäººéƒ½æœ‰èº«ä»½è¯ï¼Œè¿™ä¸ªèº«ä»½è¯å·ç å°±å¯¹åº”è¿™ä¸ªäººã€‚æ¯”å¦‚å¼ ä¸‰çš„èº«ä»½è¯å·ç ä¸º123456ï¼Œé‚£ä¹ˆæˆ‘åªè¦çŸ¥é“123456å°±å¯ä»¥æ‰¾åˆ°è¿™ä¸ªäººã€‚ é‚£ä»€ä¹ˆæ˜¯URLå‘¢ï¼Ÿä»Žåå­—çœ‹æ˜¯ï¼šç»Ÿä¸€èµ„æºå®šä½å™¨ã€‚ å¦‚æžœåšç±»æ¯”ï¼ŒURLå°±æ˜¯ï¼šåŠ¨ç‰©ä½å€åè®®://åœ°çƒ/ä¸­å›½/æµ™æ±Ÿçœ/æ­å·žå¸‚/è¥¿æ¹–åŒº/æŸå¤§å­¦/14å·å®¿èˆæ¥¼/525å·å¯/å¼ ä¸‰.äºº æˆ‘ä»¬é€šè¿‡è¿™ä¸ªè¯¦ç»†çš„åœ°å€ä¹Ÿå¯ä»¥æ‰¾åˆ°å¼ ä¸‰è¿™ä¸ªäººã€‚ é‚£ä¹ˆä»–ä»¬ä¿©åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ URIæ˜¯ä»¥æŸç§è§„åˆ™å”¯ä¸€åœ°æ ‡è¯†èµ„æºï¼Œæ‰‹æ®µä¸é™ï¼Œæ¯”å¦‚èº«ä»½è¯å·ã€‚å½“ç„¶äº†ï¼Œåœ°å€å¯ä»¥å”¯ä¸€æ ‡è¯†ï¼Œé‚£ä¹ˆä¹Ÿå±žäºŽURIçš„ä¸€ç§æ‰‹æ®µã€‚æ‰€ä»¥è¯´URLæ˜¯URIçš„å­é›†ã€‚ å›žåˆ°Webä¸Šï¼Œå‡è®¾æ‰€æœ‰çš„Htmlæ–‡æ¡£éƒ½æœ‰å”¯ä¸€çš„ç¼–å·ï¼Œè®°ä½œhtml:xxxxxï¼Œxxxxxæ˜¯ä¸€ä¸²æ•°å­—ï¼Œå³Htmlæ–‡æ¡£çš„èº«ä»½è¯å·ç ï¼Œè¿™ä¸ªèƒ½å”¯ä¸€æ ‡è¯†ä¸€ä¸ªHtmlæ–‡æ¡£ï¼Œé‚£ä¹ˆè¿™ä¸ªå·ç å°±æ˜¯ä¸€ä¸ªURIã€‚ è€ŒURLåˆ™é€šè¿‡æè¿°æ˜¯å“ªä¸ªä¸»æœºä¸Šå“ªä¸ªè·¯å¾„ä¸Šçš„æ–‡ä»¶æ¥å”¯ä¸€ç¡®å®šä¸€ä¸ªèµ„æºï¼Œä¹Ÿå°±æ˜¯å®šä½çš„æ–¹å¼æ¥å®žçŽ°çš„URIã€‚ å¯¹äºŽçŽ°åœ¨ç½‘å€æˆ‘æ›´å€¾å‘äºŽå«å®ƒURLï¼Œæ¯•ç«Ÿå®ƒæä¾›äº†èµ„æºçš„ä½ç½®ä¿¡æ¯ï¼Œå¦‚æžœæœ‰ä¸€å¤©ç½‘å€é€šè¿‡å·ç æ¥æ ‡è¯†å˜æˆäº†http://741236985.htmlï¼Œé‚£æ„Ÿè§‰å«æˆURIæ›´ä¸ºåˆé€‚ã€‚ HTTPè¯·æ±‚æŠ¥æ–‡ è¿”å›žç»“æžœçš„HTTPçŠ¶æ€ç  çŠ¶æ€ç çš„èŒè´£æ˜¯å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œæè¿°è¿”å›žçš„è¯·æ±‚ç»“æžœã€‚ çŠ¶æ€ç å¦‚200 OKï¼Œä»¥3ä¸ºæ•°å­—å’ŒåŽŸå› çŸ­è¯­ç»„æˆã€‚ æ•°å­—ä¸­çš„ç¬¬ä¸€ä½å®šä¹‰äº†å“åº”ç±»åˆ«ï¼ŒåŽä¸¤ä½æ— åˆ†ç±»ã€‚å“åº”ç±»åˆ«æœ‰ä»¥ä¸‹äº”ç§ï¼š ç±»åˆ« åŽŸå› çŸ­è¯­ 1XX Informational(ä¿¡æ¯æ€§çŠ¶æ€ç ) 2XX Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰ 3XX Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰ 4XX Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰ 5XX Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰ â­2XX æˆåŠŸ 200 OKï¼šè¯·æ±‚è¢«æ­£å¸¸å¤„ç† 204 No Contentï¼šä¸€èˆ¬åœ¨åªéœ€ä»Žå®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œå¯¹å®¢æˆ·ç«¯ä¸éœ€è¦å‘é€æ–°ä¿¡æ¯å†…å®¹çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ 206 Partial Contentï¼šå®¢æˆ·ç«¯è¿›è¡ŒèŒƒå›´è¯·æ±‚ â­3XX é‡å®šå‘ 301 Moved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ã€‚è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„URIï¼Œä»¥åŽåº”ä½¿ç”¨èµ„æºçŽ°åœ¨æ‰€æŒ‡çš„URIã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœå·²ç»æŠŠèµ„æºå¯¹åº”çš„URIä¿å­˜ä¸ºä¹¦ç­¾äº†ï¼Œè¿™æ—¶åº”è¯¥æŒ‰Locationé¦–éƒ¨å­—æ®µæç¤ºçš„URIé‡æ–°ä¿å­˜ã€‚ 302 Foundï¼šä¸´æ—¶æ€§é‡å®šå‘ã€‚è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„URIï¼Œå¸Œæœ›ç”¨æˆ·ï¼ˆæœ¬æ¬¡ï¼‰èƒ½ä½¿ç”¨æ–°çš„URIè®¿é—®ã€‚ å’Œ301 Moved PermanentlyçŠ¶æ€ç ç›¸ä¼¼ï¼Œä½†302çŠ¶æ€ç ä»£è¡¨çš„èµ„æºä¸æ˜¯è¢«æ°¸ä¹…ç§»åŠ¨ï¼Œåªæ˜¯ä¸´æ—¶æ€§è´¨çš„ã€‚æ¢å¥è¯è¯´ï¼Œå·²ç§»åŠ¨çš„èµ„æºå¯¹åº”çš„URIå°†æ¥è¿˜æœ‰å¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·æŠŠURIä¿å­˜æˆä¹¦ç­¾ï¼Œä½†ä¸ä¼šåƒ301çŠ¶æ€ç å‡ºçŽ°æ—¶é‚£æ ·åŽ»æ›´æ–°ä¹¦ç­¾ï¼Œè€Œæ˜¯ä»æ—§ä¿ç•™è¿”å›ž302çŠ¶æ€ç çš„é¡µé¢å¯¹åº”çš„URIï¼ˆåœ¨Chromeä¸­ï¼Œè¿˜æ˜¯ä¼šä¿å­˜ä¸ºé‡å®šå‘åŽçš„URIï¼Œä¸è§£ï¼‰ã€‚ 303 See Otherï¼šè¡¨ç¤ºç”±äºŽè¯·æ±‚å¯¹åº”çš„èµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ªURIï¼Œåº”ä½¿ç”¨GETæ–¹æ³•å®šå‘èŽ·å–è¯·æ±‚çš„èµ„æºã€‚è¿™ä¸Ž302ç±»ä¼¼ï¼Œä½†303æ˜Žç¡®è¡¨ç¤ºå®¢æˆ·ç«¯åº”å½“é‡‡ç”¨GETæ–¹æ³•èŽ·å–èµ„æºã€‚ 304 Not Modifiedï¼šè¯¥çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€é™„å¸¦æ¡ä»¶çš„è¯·æ±‚ï¼ˆæŒ‡é‡‡ç”¨GETæ–¹æ³•çš„è¯·æ±‚æŠ¥æ–‡ä¸­åŒ…å«If-Match,If-Modified-Sinceï¼ŒIf-None-Marchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Sinceä¸­ä»»ä¸€é¦–éƒ¨ã€‚ï¼‰æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å…è®¸è¯·æ±‚è®¿é—®èµ„æºï¼Œä½†å› å‘ç”Ÿè¯·æ±‚ä¸ºæ»¡è¶³æ¡ä»¶çš„æƒ…å†µåŽï¼Œç›´æŽ¥è¿”å›ž304ï¼ˆæœåŠ¡å™¨ç«¯èµ„æºæœªæ”¹å˜ï¼Œå¯ç›´æŽ¥ä½¿ç”¨å®¢æˆ·ç«¯æœªè¿‡æœŸçš„ç¼“å­˜ï¼‰ã€‚304çŠ¶æ€ç è¿”å›žæ—¶ï¼Œä¸åŒ…å«ä»»ä½•å“åº”çš„ä¸»ä½“éƒ¨åˆ†ã€‚ 304è™½è¢«åˆ’åˆ†åœ¨3XXç±»åˆ«ï¼Œä½†æ˜¯å’Œé‡å®šå‘æ²¡æœ‰å…³ç³»ã€‚ 307 Temporary Redirectï¼šä¸´æ—¶é‡å®šå‘ã€‚ä¸Ž302æœ‰ç›¸åŒå«ä¹‰ã€‚307éµå®ˆæµè§ˆå™¨æ ‡å‡†ï¼Œä¸ä¼šä»ŽPOSTå˜æˆGETã€‚ â­4XX å®¢æˆ·ç«¯é”™è¯¯ 4XXçš„å“åº”ç»“æžœè¡¨æ˜Žå®¢æˆ·ç«¯æ˜¯å‘ç”Ÿé”™è¯¯çš„åŽŸå› æ‰€åœ¨ã€‚ 400 Bad Requestï¼šè¡¨ç¤ºè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚ 401 Unauthorizedï¼šè¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰é€šè¿‡HTTPè®¤è¯ï¼ˆBASICè®¤è¯ã€DIGESTè®¤è¯ï¼‰çš„è®¤è¯ä¿¡æ¯ã€‚ 403 Forbiddenï¼šè¡¨æ˜Žå¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»äº†ã€‚æœåŠ¡å™¨ç«¯å¯åœ¨å®žä½“çš„ä¸»ä½“éƒ¨åˆ†å¯¹åŽŸå› è¿›è¡Œæè¿°ï¼ˆå¯é€‰ï¼‰ 404 Not Foundï¼šè¡¨æ˜ŽæœåŠ¡å™¨ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯æ‹’ç»è¯·æ±‚ä¸”ä¸æƒ³è¯´æ˜Žç†ç”±æ—¶æ—¶ç”¨ã€‚ â­5XX æœåŠ¡å™¨é”™è¯¯ 5XXçš„å“åº”ç»“æžœè¡¨æ˜ŽæœåŠ¡å™¨æœ¬èº«å‘ç”Ÿé”™è¯¯ã€‚ 500 Interval Server Errorï¼šè¡¨æ˜ŽæœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯Webåº”ç”¨å­˜åœ¨çš„bugæˆ–æŸäº›ä¸´æ—¶çš„æ•…éšœã€‚ 503 Service Unavailableï¼šè¡¨æ˜ŽæœåŠ¡å™¨æš‚æ—¶å¤„äºŽè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼ŒçŽ°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚å¦‚æžœäº‹å…ˆå¾—çŸ¥è§£é™¤ä»¥ä¸ŠçŠ¶å†µéœ€è¦çš„æ—¶é—´ï¼Œæœ€å¥½å†™å…¥Retry-Afteré¦–éƒ¨å­—æ®µå†è¿”å›žç»™å®¢æˆ·ç«¯ã€‚ HTTPçš„ç“¶é¢ˆ ä¸€æ¡è¿žæŽ¥ä¸Šåªå¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ˆå‰é¢è®²åˆ°ï¼ŒæŒä¹…åŒ–å¯ä¿æŒTCPè¿žæŽ¥çŠ¶æ€ï¼Œä½†ä»å®Œæˆä¸€æ¬¡è¯·æ±‚/å“åº”åŽæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡è¯·æ±‚/å“åº”ï¼Œè€Œç®¡çº¿åŒ–æ–¹å¼å¯è®©ä¸€ä¸ªTCPè¿žæŽ¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚ã€‚ï¼‰ è¯·æ±‚åªèƒ½ä»Žå®¢æˆ·ç«¯å¼€å§‹ã€‚å®¢æˆ·ç«¯ä¸å¯ä»¥æŽ¥æ”¶é™¤å“åº”ä»¥å¤–çš„æŒ‡ä»¤ è¯·æ±‚/å“åº”é¦–éƒ¨æœªç»åŽ‹ç¼©å°±å‘é€ã€‚é¦–éƒ¨ä¿¡æ¯è¶Šå¤šå»¶è¿Ÿè¶Šå¤§ å‘é€å†—é•¿(é‡å¤)çš„é¦–éƒ¨ã€‚æ¯æ¬¡äº’ç›¸å‘é€ç›¸åŒçš„é¦–éƒ¨é€ æˆçš„æµªè´¹è¾ƒå¤š SPDYä»¥ä¼šè¯å±‚çš„å½¢å¼åŠ å…¥ï¼ŒæŽ§åˆ¶å¯¹æ•°æ®çš„æµåŠ¨ï¼Œä½†è¿˜æ˜¯é‡‡ç”¨HTTPå»ºç«‹é€šä¿¡è¿žæŽ¥ã€‚å› æ­¤ï¼Œå¯ç…§å¸¸ä½¿ç”¨HTTPçš„GETå’ŒPOSTç­‰æ–¹æ³•ã€Cookieä»¥åŠHTTPæŠ¥æ–‡ç­‰ã€‚ ä½¿ç”¨ SPDYåŽï¼ŒHTTPåè®®é¢å¤–èŽ·å¾—ä»¥ä¸‹åŠŸèƒ½ã€‚ å¤šè·¯å¤ç”¨æµï¼šé€šè¿‡å•ä¸€çš„TCPè¿žæŽ¥ï¼Œå¯ä»¥æ— é™åˆ¶å¤„ç†å¤šä¸ªHTTPè¯·æ±‚ã€‚æ‰€æœ‰è¯·æ±‚çš„å¤„ç†éƒ½åœ¨ä¸€æ¡TCPè¿žæŽ¥ä¸Šå®Œæˆï¼Œå› æ­¤TCPçš„å¤„ç†æ•ˆçŽ‡å¾—åˆ°æé«˜ã€‚ èµ‹äºˆè¯·æ±‚ä¼˜å…ˆçº§ï¼šSPDYä¸ä»…å¯ä»¥æ— é™åˆ¶åœ°å¹¶å‘å¤„ç†è¯·æ±‚ï¼Œè¿˜å¯ä»¥ç»™è¯·æ±‚é€ä¸ªåˆ†é…ä¼˜å…ˆçº§é¡ºåºã€‚è¿™æ ·ä¸»è¦æ˜¯ä¸ºäº†åœ¨å‘é€å¤šä¸ªè¯·æ±‚æ—¶ï¼Œè§£å†³å› å¸¦å®½ä½Žè€Œå¯¼è‡´å“åº”å˜æ…¢çš„é—®é¢˜ã€‚ åŽ‹ç¼©HTTPé¦–éƒ¨ï¼šåŽ‹ç¼©HTTPè¯·æ±‚å’Œå“åº”çš„é¦–éƒ¨ã€‚ æŽ¨é€åŠŸèƒ½ï¼šæ”¯æŒæœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æŽ¨é€æ•°æ®çš„åŠŸèƒ½ã€‚ æœåŠ¡å™¨æç¤ºåŠŸèƒ½ï¼šæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨æç¤ºå®¢æˆ·ç«¯è¯·æ±‚æ‰€éœ€çš„èµ„æºã€‚ç”±äºŽåœ¨å®¢æˆ·ç«¯å‘çŽ°èµ„æºä¹‹å‰å°±å¯ä»¥èŽ·çŸ¥èµ„æºçš„å­˜åœ¨ï¼Œå› æ­¤åœ¨èµ„æºå·²ç¼“å­˜ç­‰æƒ…å†µä¸‹ï¼Œå¯ä»¥é¿å…å‘é€ä¸å¿…è¦çš„è¯·æ±‚ã€‚ WebSocket åˆ©ç”¨Ajaxå’ŒCometæŠ€æœ¯è¿›è¡Œé€šä¿¡å¯ä»¥æå‡Webçš„æµè§ˆé€Ÿåº¦ã€‚ä½†é—®é¢˜åœ¨äºŽé€šä¿¡è‹¥ä½¿ç”¨HTTPåè®®ï¼Œå°±æ— æ³•å½»åº•è§£å†³ç“¶é¢ˆé—®é¢˜ã€‚ WebSocketæŠ€æœ¯ä¸»è¦æ˜¯ä¸ºäº†è§£å†³Ajaxå’ŒCometé‡ŒXMLHttpRequsté™„å¸¦çš„ç¼ºé™·æ‰€å¼•èµ·çš„é—®é¢˜ã€‚ ä¸€æ—¦WebæœåŠ¡å™¨ä¸Žå®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹èµ·WebSocketåè®®çš„é€šä¿¡è¿žæŽ¥ï¼Œä¹‹åŽæ‰€æœ‰çš„é€šä¿¡éƒ½ä¾é è¿™ä¸ªä¸“ç”¨åè®®è¿›è¡Œã€‚é€šä¿¡è¿‡ç¨‹ä¸­å¯äº’ç›¸å‘é€JSONã€XMLã€HTMLæˆ–å›¾ç‰‡ç­‰ä»»æ„æ ¼å¼çš„æ•°æ®ã€‚ WebSocketçš„ä¸»è¦ç‰¹ç‚¹ï¼š æŽ¨é€åŠŸèƒ½ï¼šæ”¯æŒç”±æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æŽ¨é€æ•°æ®ã€‚ å‡å°‘é€šä¿¡é‡ï¼šå’ŒHTTPç›¸æ¯”ï¼Œä¸ä½†æ¯æ¬¡è¿žæŽ¥æ—¶çš„æ€»å¼€é”€å‡å°‘ï¼Œè€Œä¸”ç”±äºŽWebSocketçš„é¦–éƒ¨ä¿¡æ¯å¾ˆå°ï¼Œé€šä¿¡é‡ä¹Ÿç›¸åº”è¾ƒå°‘ã€‚ ä¸ºäº†å®žçŽ°WebSocketé€šä¿¡ï¼Œåœ¨HTTPè¿žæŽ¥å»ºç«‹ä¹‹åŽï¼Œéœ€è¦å®Œæˆä¸€æ¬¡â€œæ¡æ‰‹â€çš„æ­¥éª¤ã€‚ æ¡æ‰‹Â·è¯·æ±‚ï¼šä¸ºäº†å®žçŽ°WebSocketé€šä¿¡ï¼Œéœ€è¦ç”¨åˆ°HTTPçš„Upgradeé¦–éƒ¨å­—æ®µï¼Œå‘ŠçŸ¥æœåŠ¡å™¨é€šä¿¡åè®®å‘ç”Ÿæ”¹å˜ï¼Œä»¥è¾¾åˆ°æ¡æ‰‹çš„ç›®çš„ã€‚ æ¡æ‰‹Â·å“åº”ï¼šå¯¹äºŽä¹‹å‰çš„è¯·æ±‚ï¼Œè¿”å›žçŠ¶æ€ç 101 Switching Protocols çš„å“åº”ã€‚ æˆåŠŸæ¡æ‰‹ç¡®ç«‹WebSocketè¿žæŽ¥åŽï¼Œé€šä¿¡æ—¶ä¸å†ä½¿ç”¨HTTPçš„æ•°æ®å¸§ï¼Œè€Œé‡‡ç”¨WebSocketç‹¬ç«‹çš„æ•°æ®å¸§ã€‚ ç”±äºŽæ˜¯å»ºç«‹åœ¨HTTPåŸºç¡€ä¸Šçš„åè®®ï¼Œå› æ­¤è¿žæŽ¥çš„å‘èµ·æ–¹ä»æ˜¯å®¢æˆ·ç«¯ï¼Œè€Œä¸€æ—¦ç¡®ç«‹WebSocketé€šä¿¡è¿žæŽ¥ï¼Œä¸è®ºæœåŠ¡å™¨ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œä»»æ„ä¸€æ–¹éƒ½å¯ç›´æŽ¥å‘å¯¹æ–¹å‘é€æŠ¥æ–‡ã€‚ æ•´ç†è‡ªï¼šhttps://github.com/JChehe/blog/blob/master/posts/ã€Šå›¾è§£HTTPã€‹è¯»ä¹¦ç¬”è®°.md]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹]]></title>
    <url>%2F2019%2F01%2F18%2Fnetwork%2F5.TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬äº”ç¯‡æ–‡ç« ã€‚é¢è¯•è®²åˆ°TCPï¼Œé‚£ä¹ˆåŸºæœ¬éƒ½ä¼šé—®ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Œä»¥åŠæ¯”å¦‚å¯¹äºŽæ¡æ‰‹ï¼Œä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ï¼Œæœ¬ç« è¯¦ç»†æŽ¢è®¨å…¶ä¸­çš„é—¨é“ã€‚ 1.å¤ä¹  é¦–å…ˆé’ˆå¯¹httpåè®®ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å¤ä¹ ä¸€ä¸‹æœ€é‡è¦çš„ä¸œè¥¿ã€‚ HTTPåè®®å³è¶…æ–‡æœ¬ä¼ é€åè®®(Hypertext Transfer Protocol )ï¼Œæ˜¯Webè”ç½‘çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯æ‰‹æœºè”ç½‘å¸¸ç”¨çš„åè®®ä¹‹ä¸€ï¼ŒHTTPåè®®æ˜¯å»ºç«‹åœ¨TCPåè®®ä¹‹ä¸Šçš„ä¸€ç§åº”ç”¨ã€‚ åœ¨HTTP 1.0ä»¥0.9ç‰ˆæœ¬ä¸­ï¼Œå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚éƒ½è¦æ±‚å»ºç«‹ä¸€æ¬¡å•ç‹¬çš„è¿žæŽ¥ï¼Œåœ¨å¤„ç†å®Œæœ¬æ¬¡è¯·æ±‚åŽï¼Œå°±è‡ªåŠ¨é‡Šæ”¾è¿žæŽ¥ã€‚ åœ¨HTTP 1.1ä¸­åˆ™å¯ä»¥åœ¨ä¸€æ¬¡è¿žæŽ¥ä¸­å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”å¤šä¸ªè¯·æ±‚å¯ä»¥é‡å è¿›è¡Œï¼Œä¸éœ€è¦ç­‰å¾…ä¸€ä¸ªè¯·æ±‚ç»“æŸåŽå†å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚ ç”±äºŽHTTPåœ¨æ¯æ¬¡è¯·æ±‚ç»“æŸåŽéƒ½ä¼šä¸»åŠ¨é‡Šæ”¾è¿žæŽ¥ï¼Œå› æ­¤HTTPè¿žæŽ¥æ˜¯ä¸€ç§â€œçŸ­è¿žæŽ¥â€ï¼Œè¦ä¿æŒå®¢æˆ·ç«¯ç¨‹åºçš„åœ¨çº¿çŠ¶æ€ï¼Œéœ€è¦ä¸æ–­åœ°å‘æœåŠ¡å™¨å‘èµ·è¿žæŽ¥è¯·æ±‚ã€‚ é€šå¸¸çš„åšæ³•æ˜¯å³ä½¿ä¸éœ€è¦èŽ·å¾—ä»»ä½•æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¿æŒæ¯éš”ä¸€æ®µå›ºå®šçš„æ—¶é—´å‘æœåŠ¡å™¨å‘é€ä¸€æ¬¡â€œä¿æŒè¿žæŽ¥â€çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯¥è¯·æ±‚åŽå¯¹å®¢æˆ·ç«¯è¿›è¡Œå›žå¤ï¼Œè¡¨æ˜ŽçŸ¥é“ å®¢æˆ·ç«¯â€œåœ¨çº¿â€ã€‚ è‹¥æœåŠ¡å™¨é•¿æ—¶é—´æ— æ³•æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œåˆ™è®¤ä¸ºå®¢æˆ·ç«¯â€œä¸‹çº¿â€ï¼Œè‹¥å®¢æˆ·ç«¯é•¿æ—¶é—´æ— æ³•æ”¶åˆ°æœåŠ¡å™¨çš„å›žå¤ï¼Œåˆ™è®¤ä¸ºç½‘ç»œå·²ç»æ–­å¼€ã€‚ 2.SOCKETåŽŸç† 2.1 å¥—æŽ¥å­—ï¼ˆsocketï¼‰æ¦‚å¿µ åˆæ¬¡æŽ¥è§¦è¿™ä¸ªåè¯ï¼šâ€œå¥—æŽ¥å­—â€ï¼Œè¯´å®žè¯ï¼Œå¿ƒé‡Œæ˜¯è’™è”½çš„ï¼Œè¿™æ˜¯å•¥çŽ©æ„ï¼Œä½†æ˜¯å¯ä»¥åŽ»æœç´¢ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¥—æŽ¥ç®¡ï¼š æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸¤ä¸ªç®¡å­å¯èƒ½ç›´æŽ¥è¿žçš„è¯è¿žä¸èµ·æ¥ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä¸­é—´ä¸€ä¸ªä¸œè¥¿è¿žæŽ¥èµ·æ¥ã€‚ é‚£ä¹ˆï¼ŒçŽ°åœ¨å°±å¥½ç†è§£äº†ï¼Œä¸¤ä¸ªç¨‹åºè¦é€šä¿¡ï¼Œéœ€è¦çŸ¥é“å¯¹æ–¹çš„ä¸€äº›ä¿¡æ¯ï¼šè¿žæŽ¥ä½¿ç”¨çš„åè®®ï¼Œæœ¬åœ°ä¸»æœºçš„IPåœ°å€ï¼Œæœ¬åœ°è¿›ç¨‹çš„åè®®ç«¯å£ï¼Œè¿œåœ°ä¸»æœºçš„IPåœ°å€ï¼Œè¿œåœ°è¿›ç¨‹çš„åè®®ç«¯å£ã€‚ å®ƒæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒæ˜¯ç½‘ç»œé€šä¿¡è¿‡ç¨‹ä¸­ç«¯ç‚¹çš„æŠ½è±¡è¡¨ç¤ºï¼Œè¿™ä¸ªæŠ½è±¡é‡Œé¢å°±åŒ…å«äº†ç½‘ç»œé€šä¿¡å¿…é¡»çš„äº”ç§ä¿¡æ¯ï¼šè¿žæŽ¥ä½¿ç”¨çš„åè®®ï¼Œæœ¬åœ°ä¸»æœºçš„IPåœ°å€ï¼Œæœ¬åœ°è¿›ç¨‹çš„åè®®ç«¯å£ï¼Œè¿œåœ°ä¸»æœºçš„IPåœ°å€ï¼Œè¿œåœ°è¿›ç¨‹çš„åè®®ç«¯å£ã€‚ é‚£ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨å®ƒå‘¢ï¼Ÿ åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šï¼ŒTCPåè®®ä¸ŽUDPåè®®å¯ä»¥åŒæ—¶ä½¿ç”¨ç›¸åŒçš„portè€Œäº’ä¸å¹²æ‰°ã€‚ æ“ä½œç³»ç»Ÿæ ¹æ®å¥—æŽ¥å­—åœ°å€ï¼Œå¯ä»¥å†³å®šåº”è¯¥å°†æ•°æ®é€è¾¾ç‰¹å®šçš„è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚è¿™å°±åƒæ˜¯ç”µè¯ç³»ç»Ÿä¸­ï¼Œä»¥ç”µè¯å·ç åŠ ä¸Šåˆ†æœºå·ç ï¼Œæ¥å†³å®šé€šè¯å¯¹è±¡ä¸€èˆ¬ã€‚ å› ä¸ºæˆ‘ä»¬ç”µè„‘ä¸Šå¯èƒ½ä¼šè·‘å¾ˆå¤šçš„åº”ç”¨ç¨‹åºï¼ŒTCPåè®®ç«¯å£éœ€è¦ä¸ºè¿™äº›åŒæ—¶è¿è¡Œçš„ç¨‹åºæä¾›å¹¶å‘æœåŠ¡ï¼Œæˆ–è€…è¯´ï¼Œä¼ è¾“å±‚éœ€è¦ä¸ºåº”ç”¨å±‚çš„å¤šä¸ªè¿›ç¨‹æä¾›é€šä¿¡æœåŠ¡ï¼Œæ¯ä¸ªè¿›ç¨‹èµ·ä¸€ä¸ªTCPè¿žæŽ¥ï¼Œé‚£ä¹ˆè¿™å¤šä¸ªTCPè¿žæŽ¥å¯èƒ½æ˜¯é€šè¿‡åŒä¸€ä¸ª TCPåè®®ç«¯å£ä¼ è¾“æ•°æ®ã€‚ å¦‚ä½•åŒºåˆ«å“ªä¸ªè¿›ç¨‹å¯¹åº”å“ªä¸ªTCPè¿žæŽ¥å‘¢ï¼Ÿ è®¸å¤šè®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸ºåº”ç”¨ç¨‹åºä¸ŽTCPï¼IPåè®®äº¤äº’æä¾›äº†å¥—æŽ¥å­—(Socket)æŽ¥å£ã€‚åº” ç”¨å±‚å¯ä»¥å’Œä¼ è¾“å±‚é€šè¿‡SocketæŽ¥å£ï¼ŒåŒºåˆ†æ¥è‡ªä¸åŒåº”ç”¨ç¨‹åºè¿›ç¨‹æˆ–ç½‘ç»œè¿žæŽ¥çš„é€šä¿¡ï¼Œå®žçŽ°æ•°æ®ä¼ è¾“çš„å¹¶å‘æœåŠ¡ã€‚ 2.2 å»ºç«‹socketè¿žæŽ¥ å»ºç«‹Socketè¿žæŽ¥è‡³å°‘éœ€è¦ä¸€å¯¹å¥—æŽ¥å­—ï¼Œå…¶ä¸­ä¸€ä¸ªè¿è¡ŒäºŽå®¢æˆ·ç«¯ï¼Œç§°ä¸ºClientSocket ï¼Œå¦ä¸€ä¸ªè¿è¡ŒäºŽæœåŠ¡å™¨ç«¯ï¼Œç§°ä¸ºServerSocket ã€‚ å¥—æŽ¥å­—ä¹‹é—´çš„è¿žæŽ¥è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šæœåŠ¡å™¨ç›‘å¬ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¿žæŽ¥ç¡®è®¤ã€‚ æœåŠ¡å™¨ç›‘å¬ï¼šæœåŠ¡å™¨ç«¯å¥—æŽ¥å­—å¹¶ä¸å®šä½å…·ä½“çš„å®¢æˆ·ç«¯å¥—æŽ¥å­—ï¼Œè€Œæ˜¯å¤„äºŽç­‰å¾…è¿žæŽ¥çš„çŠ¶æ€ï¼Œå®žæ—¶ç›‘æŽ§ç½‘ç»œçŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿žæŽ¥è¯·æ±‚ã€‚ å®¢æˆ·ç«¯è¯·æ±‚ï¼šæŒ‡å®¢æˆ·ç«¯çš„å¥—æŽ¥å­—æå‡ºè¿žæŽ¥è¯·æ±‚ï¼Œè¦è¿žæŽ¥çš„ç›®æ ‡æ˜¯æœåŠ¡å™¨ç«¯çš„å¥—æŽ¥å­—ã€‚ä¸ºæ­¤ï¼Œå®¢æˆ·ç«¯çš„å¥—æŽ¥å­—å¿…é¡»é¦–å…ˆæè¿°å®ƒè¦è¿žæŽ¥çš„æœåŠ¡å™¨çš„å¥—æŽ¥å­—ï¼ŒæŒ‡å‡ºæœåŠ¡å™¨ç«¯å¥—æŽ¥å­—çš„åœ°å€å’Œç«¯å£å·ï¼Œç„¶åŽå°±å‘æœåŠ¡å™¨ç«¯å¥—æŽ¥å­—æå‡ºè¿žæŽ¥è¯·æ±‚ã€‚ è¿žæŽ¥ç¡®è®¤ï¼šå½“æœåŠ¡å™¨ç«¯å¥—æŽ¥å­—ç›‘å¬åˆ°æˆ–è€…è¯´æŽ¥æ”¶åˆ°å®¢æˆ·ç«¯å¥—æŽ¥å­—çš„è¿žæŽ¥è¯·æ±‚æ—¶ï¼Œå°±å“åº”å®¢æˆ·ç«¯å¥—æŽ¥å­—çš„è¯·æ±‚ï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼ŒæŠŠæœåŠ¡å™¨ç«¯å¥—æŽ¥å­—çš„æè¿°å‘ ç»™å®¢æˆ·ç«¯ï¼Œä¸€æ—¦å®¢æˆ·ç«¯ç¡®è®¤äº†æ­¤æè¿°ï¼ŒåŒæ–¹å°±æ­£å¼å»ºç«‹è¿žæŽ¥ã€‚è€ŒæœåŠ¡å™¨ç«¯å¥—æŽ¥å­—ç»§ç»­å¤„äºŽç›‘å¬çŠ¶æ€ï¼Œç»§ç»­æŽ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯å¥—æŽ¥å­—çš„è¿žæŽ¥è¯·æ±‚ã€‚ 2.3 SOCKETè¿žæŽ¥ä¸ŽTCPè¿žæŽ¥ åˆ›å»ºSocketè¿žæŽ¥æ—¶ï¼Œå¯ä»¥æŒ‡å®šä½¿ç”¨çš„ä¼ è¾“å±‚åè®®ï¼ŒSocketå¯ä»¥æ”¯æŒä¸åŒçš„ä¼ è¾“å±‚åè®®ï¼ˆTCPæˆ–UDPï¼‰ï¼Œå½“ä½¿ç”¨TCPåè®®è¿›è¡Œè¿žæŽ¥æ—¶ï¼Œè¯¥Socketè¿žæŽ¥å°±æ˜¯ä¸€ä¸ªTCPè¿žæŽ¥ã€‚ 3.TCPåŸºæœ¬å­—æ®µ TCPï¼ˆTransmission Control Protocol ä¼ è¾“æŽ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§é¢å‘è¿žæŽ¥çš„ã€å¯é çš„ã€åŸºäºŽå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚ é’ˆå¯¹åè®®ä¸­çš„å­—æ®µï¼Œæˆ‘ä»¬åªéœ€è¦äº†è§£ä¸€ä¸‹ï¼šACKã€SYNã€åºå·è¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚ ACK : ç¡®è®¤ TCPåè®®è§„å®šï¼Œåªæœ‰ACK=1æ—¶æœ‰æ•ˆï¼Œä¹Ÿè§„å®šè¿žæŽ¥å»ºç«‹åŽæ‰€æœ‰å‘é€çš„æŠ¥æ–‡çš„ACKå¿…é¡»ä¸º1 SYN ï¼š åœ¨è¿žæŽ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚ å½“SYN=1è€ŒACK=0æ—¶ï¼Œè¡¨æ˜Žè¿™æ˜¯ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ã€‚ å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿žæŽ¥ï¼Œåˆ™åº”åœ¨å“åº”æŠ¥æ–‡ä¸­ä½¿SYN=1å’ŒACK=1. å› æ­¤, SYNç½®1å°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æˆ–è¿žæŽ¥æŽ¥å—æŠ¥æ–‡ã€‚ FIN å³ç»ˆç»“çš„æ„æ€ï¼Œ ç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿žæŽ¥ã€‚ å½“ FIN = 1 æ—¶ï¼Œè¡¨æ˜Žæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿žæŽ¥ã€‚ 4.ä¸‰æ¬¡æ¡æ‰‹(é‡è¦ï¼Œç»†è¯») é¦–å…ˆï¼ŒTCPä½œä¸ºä¸€ç§å¯é ä¼ è¾“æŽ§åˆ¶åè®®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³ï¼šæ—¢è¦ä¿è¯æ•°æ®å¯é ä¼ è¾“ï¼Œåˆè¦æé«˜ä¼ è¾“çš„æ•ˆçŽ‡ï¼Œè€Œç”¨ä¸‰æ¬¡æ°æ°å¯ä»¥æ»¡è¶³ä»¥ä¸Šä¸¤æ–¹é¢çš„éœ€æ±‚ï¼ ç„¶åŽï¼Œè¦æ˜Žç¡®TCPè¿žæŽ¥æ¡æ‰‹ï¼Œæ¡çš„æ˜¯å•¥ï¼Ÿ ç­”æ¡ˆï¼šé€šä¿¡åŒæ–¹æ•°æ®åŽŸç‚¹çš„åºåˆ—å·ï¼ æˆ‘ä»¬åœ¨ä¸Šé¢ä¸€ç¯‡æ–‡ç« çŸ¥é“ï¼Œæ¶ˆæ¯çš„å®Œæ•´æ˜¯é ç»™æ¯ä¸ªæ¶ˆæ¯åŒ…æžä¸€ä¸ªç¼–å·ï¼Œä¾æ¬¡åœ°ACKç¡®è®¤ã€‚ç¡®è®¤æœºåˆ¶æ˜¯ç´¯è®¡çš„ï¼Œæ„å‘³ç€ X åºåˆ—å·ä¹‹å‰(ä¸åŒ…æ‹¬ X) åŒ…éƒ½æ˜¯è¢«ç¡®è®¤æŽ¥æ”¶åˆ°çš„ã€‚ TCPå¯é ä¼ è¾“çš„ç²¾é«“ï¼šTCPè¿žæŽ¥çš„ä¸€æ–¹Aï¼Œç”±æ“ä½œç³»ç»ŸåŠ¨æ€éšæœºé€‰å–ä¸€ä¸ª32ä½é•¿çš„åºåˆ—å·ï¼ˆInitial Sequence Numberï¼‰ã€‚ å‡è®¾Açš„åˆå§‹åºåˆ—å·ä¸º1000ï¼Œä»¥è¯¥åºåˆ—å·ä¸ºåŽŸç‚¹ï¼Œå¯¹è‡ªå·±å°†è¦å‘é€çš„æ¯ä¸ªå­—èŠ‚çš„æ•°æ®è¿›è¡Œç¼–å·ï¼Œ1001ï¼Œ1002ï¼Œ1003â€¦ï¼Œå¹¶æŠŠè‡ªå·±çš„åˆå§‹åºåˆ—å·ISNå‘Šè¯‰Bã€‚ è®©Bæœ‰ä¸€ä¸ªæ€æƒ³å‡†å¤‡ï¼Œä»€ä¹ˆæ ·ç¼–å·çš„æ•°æ®æ˜¯åˆæ³•çš„ï¼Œä»€ä¹ˆç¼–å·æ˜¯éžæ³•çš„ï¼Œæ¯”å¦‚ç¼–å·900å°±æ˜¯éžæ³•çš„ï¼ŒåŒæ—¶Bè¿˜å¯ä»¥å¯¹Aæ¯ä¸€ä¸ªç¼–å·çš„å­—èŠ‚æ•°æ®è¿›è¡Œç¡®è®¤ã€‚ å¦‚æžœAæ”¶åˆ°Bç¡®è®¤ç¼–å·ä¸º2001ï¼Œåˆ™æ„å‘³ç€å­—èŠ‚ç¼–å·ä¸º1001-2000ï¼Œå…±1000ä¸ªå­—èŠ‚å·²ç»å®‰å…¨åˆ°è¾¾ã€‚ åŒç†Bä¹Ÿæ˜¯ç±»ä¼¼çš„æ“ä½œï¼Œå‡è®¾Bçš„åˆå§‹åºåˆ—å·ISNä¸º2000ï¼Œä»¥è¯¥åºåˆ—å·ä¸ºåŽŸç‚¹ï¼Œå¯¹è‡ªå·±å°†è¦å‘é€çš„æ¯ä¸ªå­—èŠ‚çš„æ•°æ®è¿›è¡Œç¼–å·ï¼Œ2001ï¼Œ2002ï¼Œ2003â€¦ï¼Œå¹¶æŠŠè‡ªå·±çš„åˆå§‹åºåˆ—å·ISNå‘Šè¯‰Aï¼Œä»¥ä¾¿Aå¯ä»¥ç¡®è®¤Bå‘é€çš„æ¯ä¸€ä¸ªå­—èŠ‚ã€‚å¦‚æžœBæ”¶åˆ°Aç¡®è®¤ç¼–å·ä¸º4001ï¼Œåˆ™æ„å‘³ç€å­—èŠ‚ç¼–å·ä¸º2001-4000ï¼Œå…±2000ä¸ªå­—èŠ‚å·²ç»å®‰å…¨åˆ°è¾¾ã€‚ å¥½äº†ï¼Œåœ¨ç†è§£äº†æ¡æ‰‹çš„æœ¬è´¨ä¹‹åŽï¼Œä¸‹é¢å°±å¯ä»¥æ€»ç»“ä¸Šé¢å›¾çš„æ¡æ‰‹è¿‡ç¨‹äº†ã€‚ å¯¹äºŽAä¸ŽBçš„æ¡æ‰‹è¿‡ç¨‹ï¼Œå¯ä»¥æ€»ç»“ä¸ºï¼š A å‘é€åŒæ­¥ä¿¡å·SYN + A's Initial sequence numberï¼ˆä¸¢å¤±ä¼šAä¼šé‡ä¼ ï¼‰ B ç¡®è®¤æ”¶åˆ°Açš„åŒæ­¥ä¿¡å·ï¼Œå¹¶è®°å½• A's ISN åˆ°æœ¬åœ°ï¼Œå‘½å B's ACK sequence number Bå‘é€åŒæ­¥ä¿¡å·SYN + B's Initial sequence number ï¼ˆä¸¢å¤±Bä¼šå‘¨æœŸæ€§è¶…æ—¶é‡ä¼ ï¼Œç›´åˆ°æ”¶åˆ°Açš„ç¡®è®¤ï¼‰ Aç¡®è®¤æ”¶åˆ°Bçš„åŒæ­¥ä¿¡å·ï¼Œå¹¶è®°å½• B's ISN åˆ°æœ¬åœ°ï¼Œå‘½å A's ACK sequence number å¾ˆæ˜¾ç„¶2å’Œ3 è¿™ä¸¤ä¸ªæ­¥éª¤å¯ä»¥åˆå¹¶ï¼Œåªéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¯ä»¥æé«˜è¿žæŽ¥çš„é€Ÿåº¦ä¸Žæ•ˆçŽ‡ã€‚ è¿™é‡Œå°±ä¼šå¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼Œä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿ A å‘é€åŒæ­¥ä¿¡å·SYN + Aâ€™s Initial sequence number Bå‘é€åŒæ­¥ä¿¡å·SYN + Bâ€™s Initial sequence number + Bâ€™s ACK sequence number è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒAä¸ŽBå°±Açš„åˆå§‹åºåˆ—å·è¾¾æˆäº†ä¸€è‡´ï¼Œä½†æ˜¯Bæ— æ³•çŸ¥é“Aæ˜¯å¦å·²ç»æŽ¥æ”¶åˆ°è‡ªå·±çš„åŒæ­¥ä¿¡å·ï¼Œå¦‚æžœè¿™ä¸ªåŒæ­¥ä¿¡å·ä¸¢å¤±äº†ï¼ŒAå’ŒBå°±Bçš„åˆå§‹åºåˆ—å·å°†æ— æ³•è¾¾æˆä¸€è‡´ã€‚ æ‰€ä»¥Aå¿…é¡»å†ç»™Bä¸€ä¸ªç¡®è®¤ï¼Œä»¥ç¡®è®¤Aå·²ç»æŽ¥æ”¶åˆ°Bçš„åŒæ­¥ä¿¡å·ã€‚ å¦‚æžœAå‘ç»™Bçš„ç¡®è®¤ä¸¢äº†ï¼Œè¯¥å¦‚ä½•ï¼Ÿ Aä¼šè¶…æ—¶é‡ä¼ è¿™ä¸ªACKå—ï¼Ÿä¸ä¼šï¼TCPä¸ä¼šä¸ºæ²¡æœ‰æ•°æ®çš„ACKè¶…æ—¶é‡ä¼ ã€‚ é‚£è¯¥å¦‚ä½•æ˜¯å¥½ï¼ŸBå¦‚æžœæ²¡æœ‰æ”¶åˆ°Açš„ACKï¼Œä¼šè¶…æ—¶é‡ä¼ è‡ªå·±çš„SYNåŒæ­¥ä¿¡å·ï¼Œä¸€ç›´åˆ°æ”¶åˆ°Açš„ACKä¸ºæ­¢ã€‚ å†™åˆ°è¿™é‡Œï¼Œå…¶å®žæˆ‘ä»¬å·²ç»æ˜Žç™½äº†ï¼Œæ¡æ‰‹å…¶å®žå°±æ˜¯å„è‡ªç¡®è®¤å¯¹æ–¹çš„åºåˆ—å·ã€‚å› ä¸ºåŽé¢çš„æ•°æ®ç¼–å·å°±ä¼šä»¥æ­¤ä¸ºåŸºç¡€ï¼Œä»Žè€Œä¿è¯åŽç»­æ•°æ®çš„å¯é æ€§ã€‚ è°¢å¸Œä»ç‰ˆã€Šè®¡ç®—æœºç½‘ç»œã€‹ä¸­çš„ä¾‹å­æ˜¯è¿™æ ·çš„ï¼Œâ€œå·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€çš„äº§ç”Ÿåœ¨è¿™æ ·ä¸€ç§æƒ…å†µä¸‹ï¼šclientå‘å‡ºçš„ç¬¬ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µå¹¶æ²¡æœ‰ä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æŸä¸ªç½‘ç»œç»“ç‚¹é•¿æ—¶é—´çš„æ»žç•™äº†ï¼Œä»¥è‡´å»¶è¯¯åˆ°è¿žæŽ¥é‡Šæ”¾ä»¥åŽçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾serverã€‚æœ¬æ¥è¿™æ˜¯ä¸€ä¸ªæ—©å·²å¤±æ•ˆçš„æŠ¥æ–‡æ®µã€‚ä½†serveræ”¶åˆ°æ­¤å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µåŽï¼Œå°±è¯¯è®¤ä¸ºæ˜¯clientå†æ¬¡å‘å‡ºçš„ä¸€ä¸ªæ–°çš„è¿žæŽ¥è¯·æ±‚ã€‚äºŽæ˜¯å°±å‘clientå‘å‡ºç¡®è®¤æŠ¥æ–‡æ®µï¼ŒåŒæ„å»ºç«‹è¿žæŽ¥ã€‚å‡è®¾ä¸é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦serverå‘å‡ºç¡®è®¤ï¼Œæ–°çš„è¿žæŽ¥å°±å»ºç«‹äº†ã€‚ç”±äºŽçŽ°åœ¨clientå¹¶æ²¡æœ‰å‘å‡ºå»ºç«‹è¿žæŽ¥çš„è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šç†ç¬serverçš„ç¡®è®¤ï¼Œä¹Ÿä¸ä¼šå‘serverå‘é€æ•°æ®ã€‚ä½†serverå´ä»¥ä¸ºæ–°çš„è¿è¾“è¿žæŽ¥å·²ç»å»ºç«‹ï¼Œå¹¶ä¸€ç›´ç­‰å¾…clientå‘æ¥æ•°æ®ã€‚è¿™æ ·ï¼Œserverçš„å¾ˆå¤šèµ„æºå°±ç™½ç™½æµªè´¹æŽ‰äº†ã€‚é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€çš„åŠžæ³•å¯ä»¥é˜²æ­¢ä¸Šè¿°çŽ°è±¡å‘ç”Ÿã€‚ä¾‹å¦‚åˆšæ‰é‚£ç§æƒ…å†µï¼Œclientä¸ä¼šå‘serverçš„ç¡®è®¤å‘å‡ºç¡®è®¤ã€‚serverç”±äºŽæ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±çŸ¥é“clientå¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¿žæŽ¥ã€‚â€ ä½†æ˜¯æœ‰çš„äººæŒ‡å‡ºï¼Œå…¶å®žè¿™åªæ˜¯è¡¨è±¡ï¼Œæˆ–è€…è¯´å¹¶ä¸æ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„è®¾è®¡åˆè¡·ï¼Œæˆ‘è¡¨ç¤ºè®¤åŒï¼Œè¿™ä¸ªé˜²æ­¢å·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µåº”è¯¥åªæ˜¯é™„åŠ çš„ä¸€äº›å¥½å¤„ï¼Œè€Œä¸åº”è¯¥æ˜¯è§£é‡Šä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„åŽŸå› ã€‚ TCPåˆå§‹é˜¶æ®µä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŽŸå› æ€»ç»“å¦‚ä¸‹ï¼š ä¸ºäº†å®žçŽ°å¯é æ•°æ®ä¼ è¾“ï¼Œ TCP åè®®çš„é€šä¿¡åŒæ–¹ï¼Œ éƒ½å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåºåˆ—å·ï¼Œ ä»¥æ ‡è¯†å‘é€å‡ºåŽ»çš„æ•°æ®åŒ…ä¸­ï¼Œ å“ªäº›æ˜¯å·²ç»è¢«å¯¹æ–¹æ”¶åˆ°çš„ã€‚ ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹å³æ˜¯é€šä¿¡åŒæ–¹ç›¸äº’å‘ŠçŸ¥åºåˆ—å·èµ·å§‹å€¼ï¼Œ å¹¶ç¡®è®¤å¯¹æ–¹å·²ç»æ”¶åˆ°äº†åºåˆ—å·èµ·å§‹å€¼çš„å¿…ç»æ­¥éª¤ï¼Œå¦‚æžœåªæ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼Œ è‡³å¤šåªæœ‰è¿žæŽ¥å‘èµ·æ–¹çš„èµ·å§‹åºåˆ—å·èƒ½è¢«ç¡®è®¤ï¼Œ å¦ä¸€æ–¹é€‰æ‹©çš„åºåˆ—å·åˆ™å¾—ä¸åˆ°ç¡®è®¤ã€‚ 5.å››æ¬¡æŒ¥æ‰‹ æŒ¥æ‰‹è¿‡ç¨‹çš„å¤§æ¦‚è¯´æ˜Žï¼š å½“ä¸»æœºAå‘å‡ºFINæŠ¥æ–‡æ®µæ—¶ï¼Œåªæ˜¯è¡¨ç¤ºä¸»æœºAå·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä¸»æœºAå‘Šè¯‰ä¸»æœºBï¼Œå®ƒçš„æ•°æ®å·²ç»å…¨éƒ¨å‘é€å®Œæ¯•äº†ï¼› ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™ä¸»æœºAè¿˜æ˜¯å¯ä»¥æŽ¥å—æ¥è‡ªä¸»æœºBçš„æ•°æ®ï¼› å½“ä¸»æœºBè¿”å›žACKæŠ¥æ–‡æ®µæ—¶ï¼Œè¡¨ç¤ºå®ƒå·²ç»çŸ¥é“ä¸»æœºAæ²¡æœ‰æ•°æ®å‘é€äº†ï¼Œä½†æ˜¯ä¸»æœºBè¿˜æ˜¯å¯ä»¥å‘é€æ•°æ®åˆ°ä¸»æœºAçš„ï¼› å½“ä¸»æœºBä¹Ÿå‘é€äº†FINæŠ¥æ–‡æ®µæ—¶ï¼Œè¿™ä¸ªæ—¶å€™å°±è¡¨ç¤ºä¸»æœºBä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œå°±ä¼šå‘Šè¯‰ä¸»æœºAï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼› ä¸»æœºAå‘Šè¯‰ä¸»æœºBçŸ¥é“äº†ï¼Œä¸»æœºBæ”¶åˆ°è¿™ä¸ªç¡®è®¤ä¹‹åŽå°±ç«‹é©¬å…³é—­è‡ªå·±ã€‚ ä¸»æœºAç­‰å¾…2MSLä¹‹åŽä¹Ÿå…³é—­äº†è‡ªå·±ã€‚ è¯´æ˜Žå®Œäº†å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼Œä¸‹é¢ç€é‡è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä¸»æœºAè¦ç­‰å¾…2MSLä¹‹åŽæ‰å…³é—­è‡ªå·±ã€‚ é’ˆå¯¹æœ€åŽä¸€æ¡æ¶ˆæ¯ï¼Œå³ä¸»æœºAå‘é€ackåŽï¼Œä¸»æœºBæŽ¥æ”¶åˆ°æ­¤æ¶ˆæ¯ï¼Œå³è®¤ä¸ºåŒæ–¹è¾¾æˆäº†åŒæ­¥ï¼šåŒæ–¹éƒ½çŸ¥é“è¿žæŽ¥å¯ä»¥é‡Šæ”¾äº†ï¼Œæ­¤æ—¶ä¸»æœºBå¯ä»¥å®‰å…¨åœ°é‡Šæ”¾æ­¤TCPè¿žæŽ¥æ‰€å ç”¨çš„å†…å­˜èµ„æºã€ç«¯å£å·ã€‚ æ‰€ä»¥è¢«åŠ¨å…³é—­çš„ä¸»æœºBæ— éœ€ä»»ä½•wait timeï¼Œç›´æŽ¥é‡Šæ”¾èµ„æºã€‚ ä½†æ˜¯ä¸»æœºAå¹¶ä¸çŸ¥é“ä¸»æœºBæ˜¯å¦æŽ¥åˆ°è‡ªå·±çš„ACKï¼Œä¸»æœºAæ˜¯è¿™ä¹ˆæƒ³çš„ï¼š å¦‚æžœä¸»æœºBæ²¡æœ‰æ”¶åˆ°è‡ªå·±çš„ACKï¼Œä¸»æœºBä¼šè¶…æ—¶é‡ä¼ FiNï¼Œé‚£ä¹ˆä¸»æœºAå†æ¬¡æŽ¥åˆ°é‡ä¼ çš„FINï¼Œä¼šå†æ¬¡å‘é€ACK å¦‚æžœä¸»æœºBæœ‰æ”¶åˆ°è‡ªå·±çš„ACKï¼Œä¹Ÿä¸ä¼šå†å‘ä»»ä½•æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ACK æ— è®ºæ˜¯æƒ…å†µ1è¿˜æ˜¯2ï¼Œä¸»æœºAéƒ½éœ€è¦ç­‰å¾…ï¼Œè¦å–è¿™ä¸¤ç§æƒ…å†µç­‰å¾…æ—¶é—´çš„æœ€å¤§å€¼ï¼Œä»¥åº”å¯¹æœ€åçš„æƒ…å†µå‘ç”Ÿï¼Œè¿™ä¸ªæœ€åæƒ…å†µæ˜¯ï¼š ä¸»æœºBæ²¡æœ‰æ”¶åˆ°ä¸»æœºAçš„ACKï¼Œé‚£ä¹ˆè¶…æ—¶ä¹‹åŽä¸»æœºBä¼šé‡ä¼ FINï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æµªè´¹ä¸€ä¸ªä¸»æœºAå‘å‡ºACKçš„æœ€å¤§å­˜æ´»æ—¶é—´(MSL)+FINæ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´(MSL) ä¸å¯èƒ½æ—¶é—´å†å¤šäº†ï¼Œè¿™ä¸ªå·²ç»é’ˆå¯¹æœ€ç³Ÿç³•çš„çŠ¶å†µã€‚ ç­‰å¾…2MSLæ—¶é—´ï¼Œä¸»æœºAå°±å¯ä»¥æ”¾å¿ƒåœ°é‡Šæ”¾TCPå ç”¨çš„èµ„æºã€ç«¯å£å·ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨è¯¥ç«¯å£å·è¿žæŽ¥ä»»ä½•æœåŠ¡å™¨ã€‚ åœ¨ç­‰å¾…çš„æ—¶é—´å†…ï¼Œä¸»æœºBå¯ä»¥é‡è¯•å¤šæ¬¡ï¼Œå› ä¸º2MSLæ—¶é—´ä¸º240ç§’ï¼Œè¶…æ—¶é‡ä¼ åªæœ‰0.5ç§’ï¼Œ1ç§’ï¼Œ2ç§’ï¼Œ16ç§’ã€‚ å½“ä¸»æœºBé‡è¯•æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œä¸»æœºBä¼šresetè¿žæŽ¥ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯2MSLæˆ‘ä»¬å·²ç»äº†è§£äº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦ç­‰è¿™ä¸ªæ—¶é—´å‘¢ï¼Ÿ å¦‚æžœä¸ç­‰ï¼Œé‡Šæ”¾çš„ç«¯å£å¯èƒ½ä¼šé‡è¿žåˆšæ–­å¼€çš„æœåŠ¡å™¨ç«¯å£ï¼Œè¿™æ ·ä¾ç„¶å­˜æ´»åœ¨ç½‘ç»œé‡Œçš„è€çš„TCPæŠ¥æ–‡å¯èƒ½ä¸Žæ–°TCPè¿žæŽ¥æŠ¥æ–‡å†²çªï¼Œé€ æˆæ•°æ®å†²çªï¼Œä¸ºé¿å…æ­¤ç§æƒ…å†µï¼Œéœ€è¦è€å¿ƒç­‰å¾…ç½‘ç»œè€çš„TCPè¿žæŽ¥çš„æ´»è·ƒæŠ¥æ–‡å…¨éƒ¨æ­»ç¿˜ç¿˜ï¼Œ2MSLæ—¶é—´å¯ä»¥æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚ æ•´ç†è‡ªï¼š https://www.zhihu.com/question/24853633 https://www.zhihu.com/question/67013338 https://github.com/jawil/blog/issues/14 https://www.jianshu.com/p/9968b16b607e]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCPåè®®å…¥é—¨]]></title>
    <url>%2F2019%2F01%2F18%2Fnetwork%2F4.TCP%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬å››ç¯‡æ–‡ç« ã€‚é¦–å…ˆè¦æ˜Žç¡®ï¼šä¿¡é“æœ¬èº«ä¸å¯é ï¼ˆä¸¢åŒ…ã€é‡å¤åŒ…ã€å‡ºé”™ã€ä¹±åºï¼‰ï¼Œä¸å®‰å…¨ã€‚æ‰€ä»¥å¼•å‡ºäº†ä¸ƒå±‚æˆ–äº”å±‚æ¨¡åž‹æ¥ä¿è¯ã€‚å› æ­¤ï¼Œä»»ä½•ä¸€ä¸ªä¸œè¥¿çš„æå‡ºéƒ½æ˜¯ä¸ºäº†è§£å†³æŸä¸ªé—®é¢˜çš„ã€‚å­¦ä¹ è®¡ç®—æœºï¼Œä»Žä»–çš„åŽ†å²å‡ºå‘ï¼Œç†è§£ä¸ºä»€ä¹ˆä¼šæœ‰ä¸æ–­ä½Žè¿­ä»£ï¼Œå› ä¸ºæ˜¯ä¸ºäº†è§£å†³æŸä¸ªç—›ç‚¹é—®é¢˜ã€‚æ¯”å¦‚HTTPçš„å‘å±•ï¼Œä¸ºä»€ä¹ˆåœ¨HTTP1.0åŸºç¡€ä¸Šè¿˜è¦æå‡ºHTTP1.1ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æå‡ºHTTP2.0ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä»–çš„å‘å±•åŽ†å²ä¹‹åŽå°±ä¼šæ˜Žç™½äº†ã€‚åŒæ ·ï¼Œä¸‹é¢å†è¯´ä¸€è¯´ä¸ºä»€ä¹ˆè¦æœ‰TCPåè®®ï¼ŒTCPåˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚ ä¸€ã€å›žé¡¾ é¦–å…ˆç®€å•å›žé¡¾ä¸€ä¸‹ã€‚ 1.1 ç‰©ç†å±‚ ç‰©ç†å±‚æ˜¯ç›¸å½“äºŽç‰©ç†è¿žæŽ¥ï¼Œå°†0101ä»¥ç”µä¿¡å·çš„å½¢å¼ä¼ è¾“å‡ºåŽ»ã€‚ 1.2 æ•°æ®é“¾è·¯å±‚ æ•°æ®é“¾è·¯å±‚ï¼Œæœ‰ä¸€ä¸ªå«åšä»¥å¤ªç½‘åè®®ï¼Œè§„å®šäº†ç”µå­ä¿¡å·æ˜¯å¦‚ä½•ç»„æˆæ•°æ®åŒ…çš„ï¼Œè¿™ä¸ªåè®®çš„å¤´é‡Œé¢ï¼ŒåŒ…å«äº†è‡ªèº«çš„ç½‘å¡ä¿¡æ¯ï¼Œè¿˜æœ‰ç›®çš„åœ°çš„ç½‘å¡ä¿¡æ¯ï¼ˆä¸€èˆ¬æˆ‘ä»¬å¯ä»¥çŸ¥é“å¯¹æ–¹çš„IPï¼ŒIPå¯ä»¥é€šè¿‡DNSè§£æžåˆ°ï¼Œç„¶åŽæ ¹æ®ARPåè®®å°†IPè½¬æ¢ä¸ºMACåœ°å€ï¼‰ã€‚é‚£ä¹ˆï¼Œå¦‚æžœåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¹¿æ’­çš„æ–¹å¼æ‰¾åˆ°å¯¹åº”MACåœ°å€çš„ä¸»æœºã€‚â€”å³ä»¥å¤ªç½‘åè®®è§£å†³äº†å­ç½‘å†…éƒ¨çš„ç‚¹å¯¹ç‚¹é€šä¿¡ã€‚ 1.3 ç½‘ç»œå±‚ ä½†æ˜¯å‘¢ï¼Œä»¥å¤ªç½‘åè®®ä¸èƒ½è§£å†³å¤šä¸ªå±€åŸŸç½‘é€šä¿¡ï¼Œæ¯ä¸ªå±€åŸŸç½‘ä¹‹é—´ä¸æ˜¯äº’é€šçš„ï¼Œé‚£ä¹ˆä»¥å¤ªç½‘è¿™ç§å¹¿æ’­çš„æ–¹å¼ä¸å¯ç”¨ï¼Œå°±ç®—å¯ç”¨ï¼Œç½‘ç»œé‚£ä¹ˆå¤§ï¼Œé€šè¿‡å¹¿æ’­è¿›è¡Œæ‰¾ï¼Œæ˜¯ä¸€ä¸ªå¯æ€•çš„åœºæ™¯ã€‚é‚£ä¹ˆï¼ŒIPåè®®å¯ä»¥è¿žæŽ¥å¤šä¸ªå±€åŸŸç½‘ï¼Œç®€å•æ¥è¯´ï¼ŒIP åè®®å®šä¹‰äº†ä¸€å¥—è‡ªå·±çš„åœ°å€è§„åˆ™ï¼Œç§°ä¸º IP åœ°å€ã€‚ç‰©ç†å™¨ä»¶ï¼Œæ¯”å¦‚è¯´è·¯ç”±å™¨ï¼Œå°±æ˜¯åŸºäºŽIPåè®®ï¼Œé‡Œé¢ä¿å­˜ä¸€å¥—åœ°å€æŒ‡è·¯ç‰Œï¼Œæƒ³åŽ»å“ªä¸ªå±€åŸŸç½‘ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç‰Œå­æ¥æ‰¾ï¼Œç„¶åŽé€æ­¥è·¯ç”±åˆ°ç›®æ ‡å±€åŸŸç½‘ï¼Œæœ€åŽå°±å¯ä»¥æ‰¾åˆ°é‚£å°ä¸»æœºäº†ã€‚IPå±‚å°±æ˜¯å¯¹åº”äº†ç½‘ç»œå±‚ã€‚ 1.4 ä¼ è¾“å±‚ é‚£ä¹ˆï¼Œæ­¤æ—¶è§£å†³äº†å¤šä¸ªå±€åŸŸç½‘è·¯ç”±é—®é¢˜ï¼Œä¹Ÿè§£å†³äº†å±€åŸŸç½‘å†…å¯»å€é—®é¢˜ï¼Œå³æˆ‘è¿™å°ä¸»æœºå·²ç»å¯ä»¥æ‰¾åˆ°é‚£å°ä¸»æœºäº†ï¼Œä¸‹é¢è¿˜æœ‰ä»€ä¹ˆäº‹æƒ…éœ€è¦åšå‘¢ï¼Ÿæ˜¾ç„¶ï¼Œæ‰¾åˆ°ä¸»æœºè¿˜ä¸è¡Œå•Šï¼Œæ¯”å¦‚æˆ‘ç”¨å¾®ä¿¡å‘ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ‘å‘åˆ°ä½ ä¸»æœºäº†ï¼Œä½†æ˜¯ä½ ä¸»æœºä¸Šçš„å¾®ä¿¡ä¸çŸ¥é“è¿™æ¡æ¶ˆæ¯å‘ç»™ä»–äº†ï¼Œè¿™é‡Œè¯´çš„å°±æ˜¯ç«¯å£ï¼Œä¿¡æ¯è¦å‘åˆ°è¿™ä¸ªç«¯å£ä¸Šï¼Œç›‘å¬è¿™ä¸ªç«¯å£çš„ç¨‹åºæ‰ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚ 1.5 åº”ç”¨å±‚ OKï¼Œæœ€ä¸Šå±‚çš„åº”ç”¨å±‚ï¼Œå°±æ˜¯æœ€è´´è¿‘ç”¨æˆ·çš„ï¼Œä»–çš„ä¸€ç³»åˆ—åè®®åªæ˜¯ä¸ºäº†è®©ä¸¤å°ä¸»æœºä¼šäº’ç›¸éƒ½ç†è§£è€Œå·²ã€‚ äºŒã€é—®é¢˜å’Œè§£å†³ 2.1 å­˜åœ¨çš„é—®é¢˜ åœ¨æ˜Žç™½äº†è®¡ç®—æœºç½‘ç»œä¸ºä»€ä¹ˆè¦è¿™å‡ å±‚æ¨¡åž‹ä¹‹åŽï¼Œæˆ‘ä»¬å†å›žåˆ°ä¸€å¼€å§‹ï¼Œå¦‚ä½•ä¿è¯å®‰å…¨ã€å¯é ã€å®Œæ•´åœ°ä¼ è¾“ä¿¡æ¯å‘¢ï¼Ÿ å¾ˆæ˜¾ç„¶ï¼Œä¸Šé¢æåˆ°çš„ï¼Œåªæ˜¯ä¿è¯ä¿¡æ¯èƒ½æ‰¾åˆ°å¯¹æ–¹ä¸»æœºå’Œç«¯å£ï¼Œä½†æ˜¯è¿™ä¸ªä¿¡æ¯ä¸­é€”è¢«æ‹¦æˆªäº†ã€ç”šè‡³è¢«ç¯¡æ”¹äº†ã€ä¿¡æ¯å»¶è¿Ÿäº†ï¼ˆå‡ åˆ†é’Ÿæˆ–è€…å‡ ä¸ªå°æ—¶ï¼Œæˆ–è€…å‡ ä¸ªä¸–çºªï¼‰ã€ç½‘ç»œä¸é€šæˆ–è€…æŒ‚äº†ï¼Œä¿¡æ¯è‡ªå·±å¯ä¸ä¼šå‘Šè¯‰ä½ ä»–æŒ‚äº†æˆ–è€…è¦è¿Ÿåˆ°ä¸€ä¼šï¼Œå¦‚æžœæ²¡æœ‰ä¸€ä¸ªåè®®æ¥ä¿éšœå¯é æ€§ï¼Œé‚£ä¹ˆæˆ‘è¿™æ¡æ¶ˆæ¯å‘å‡ºåŽ»ï¼Œèƒ½ä¸èƒ½åˆ°ã€èƒ½ä¸èƒ½åŠæ—¶åˆ°ã€èƒ½ä¸èƒ½å®Œæ•´åˆ°ã€èƒ½ä¸èƒ½ä¸è¢«ç¯¡æ”¹åˆ°ç­‰è¿™äº›é—®é¢˜å°†ä¼šé€ æˆç¾éš¾ï¼Œç½‘ç»œä¼ è¾“ä¹Ÿå°±æ²¡æœ‰äº†æ„ä¹‰ã€‚ è®¡ç®—æœºçš„å‰è¾ˆä»¬ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—çš„æŽªæ–½æ¥å°½å¯èƒ½ä¿è¯ä¿¡æ¯èƒ½æ­£ç¡®é€è¾¾ã€‚ 2.2 æ•°æ®æ ¡éªŒ é¦–å…ˆåœ¨æ•°æ®é“¾è·¯å±‚ï¼Œå¯ä»¥é€šè¿‡å„ç§æ ¡éªŒï¼Œæ¯”å¦‚å¥‡å¶æ ¡éªŒç­‰æ‰‹æ®µæ¥åˆ¤æ–­æ•°æ®åŒ…ä¼ çš„æ˜¯å¦æ­£ç¡®ã€‚ 2.3 æ•°æ®å¯é æ€§ å¥½äº†ï¼Œè§£å†³äº†æ•°æ®æ˜¯å¦æ­£ç¡®ä¹‹åŽï¼Œä½†æ˜¯è¿˜ä¸èƒ½ä¿è¯çº¿è·¯æ˜¯å¯é çš„ï¼ŒåŠ å…¥æŸä¸ªåŒ…æ²¡å‘å‡ºåŽ»æˆ–è€…å‘é”™äº†ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªå‡ºé”™é‡ä¼ æœºåˆ¶ï¼Œä¿è¯ä¿¡æ¯ä¼ è¾“çš„å¯é æ€§ã€‚è¿™å°±å¼•å‡ºäº†TCPåè®®ã€‚ TCPï¼ˆTransmission Control Protocol ä¼ è¾“æŽ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§é¢å‘è¿žæŽ¥çš„ã€å¯é çš„ã€åŸºäºŽå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚ ä¸‹é¢æ¥çœ‹çœ‹TCPæ˜¯å¦‚ä½•è§£å†³ä¸¢åŒ…ã€é‡å¤åŒ…ã€å‡ºé”™ã€ä¹±åºç­‰ä¸å¯é çš„ä¸€äº›é—®é¢˜çš„ã€‚ ä¸‰ã€æ»‘åŠ¨çª—å£åè®®çš„æå‡º è¿™å°±å¼•å‡ºäº†TCPä¸­æœ€ç»ˆçš„ä¸€ä¸ªä¸œè¥¿ï¼šæ»‘åŠ¨çª—å£åè®®ã€‚ 3.1 æœ´ç´ çš„æ–¹æ³•æ¥ç¡®ä¿å¯é æ€§ å…ˆä»Žç®€å•çš„è§’åº¦å‡ºå‘ï¼Œè‡ªå·±æƒ³ä¸€ä¸‹ï¼Œå¦‚ä½•ä¿è¯ä¸ä¸¢åŒ…ã€ä¸ä¹±åºã€‚ æŒ‰ç…§é¡ºåºï¼Œå‘é€ä¸€ä¸ªç¡®è®¤ä¸€ä¸ªï¼Œæ˜¾ç„¶ï¼Œåžåé‡éžå¸¸ä½Žã€‚é‚£ä¹ˆï¼Œä¸€æ¬¡æ€§å‘å‡ ä¸ªåŒ…ï¼Œç„¶åŽä¸€èµ·ç¡®è®¤å‘¢ï¼Ÿ 3.2 æ”¹è¿›æ–¹æ¡ˆ é‚£ä¹ˆå°±å¼•å‡ºç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä¸€æ¬¡æ€§å‘å‡ ä¸ªåŒ…åˆé€‚å‘¢ï¼Ÿå°±è¿™å¼•å‡ºäº†æ»‘åŠ¨çª—å£ã€‚ å››ã€æ•°æ®åŒ…ç¼–å·å’Œé‡ä¼ æœºåˆ¶ 4.1 æ•°æ®åŒ…ç¼–å· åœ¨è¯´æ˜Žæ»‘åŠ¨çª—å£åŽŸç†ä¹‹å‰ï¼Œå¿…é¡»è¦è¯´ä¸€ä¸‹TCPæ•°æ®åŒ…çš„ç¼–å·SEQã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œç”±äºŽä»¥å¤ªç½‘æ•°æ®åŒ…å¤§å°é™åˆ¶ï¼Œæ‰€ä»¥æ¯ä¸ªåŒ…æ‰¿è½½çš„æ•°æ®æ˜¯æœ‰é™çš„ï¼Œå¦‚æžœå‘ä¸€ä¸ªå¾ˆå¤§çš„åŒ…ï¼Œå¿…ç„¶æ˜¯è¦æ‹†åˆ†çš„ã€‚ å‘é€çš„æ—¶å€™ï¼ŒTCP åè®®ä¸ºæ¯ä¸ªåŒ…ç¼–å·ï¼ˆsequence numberï¼Œç®€ç§° SEQï¼‰ï¼Œä»¥ä¾¿æŽ¥æ”¶çš„ä¸€æ–¹æŒ‰ç…§é¡ºåºè¿˜åŽŸã€‚ä¸‡ä¸€å‘ç”Ÿä¸¢åŒ…ï¼Œä¹Ÿå¯ä»¥çŸ¥é“ä¸¢å¤±çš„æ˜¯å“ªä¸€ä¸ªåŒ…ã€‚ ç¬¬ä¸€ä¸ªåŒ…çš„ç¼–å·æ˜¯ä¸€ä¸ªéšæœºæ•°ã€‚ä¸ºäº†ä¾¿äºŽç†è§£ï¼Œè¿™é‡Œå°±æŠŠå®ƒç§°ä¸º1å·åŒ…ã€‚å‡å®šè¿™ä¸ªåŒ…çš„è´Ÿè½½é•¿åº¦æ˜¯100å­—èŠ‚ï¼Œé‚£ä¹ˆå¯ä»¥æŽ¨ç®—å‡ºä¸‹ä¸€ä¸ªåŒ…çš„ç¼–å·åº”è¯¥æ˜¯101ã€‚è¿™å°±æ˜¯è¯´ï¼Œæ¯ä¸ªæ•°æ®åŒ…éƒ½å¯ä»¥å¾—åˆ°ä¸¤ä¸ªç¼–å·ï¼šè‡ªèº«çš„ç¼–å·ï¼Œä»¥åŠä¸‹ä¸€ä¸ªåŒ…çš„ç¼–å·ã€‚æŽ¥æ”¶æ–¹ç”±æ­¤çŸ¥é“ï¼Œåº”è¯¥æŒ‰ç…§ä»€ä¹ˆé¡ºåºå°†å®ƒä»¬è¿˜åŽŸæˆåŽŸå§‹æ–‡ä»¶ã€‚ 4.2 æ•°æ®é‡ä¼ æœºåˆ¶ TCPåè®®å°±æ˜¯æ ¹æ®è¿™äº›ç¼–å·æ¥é‡æ–°è¿˜åŽŸæ–‡ä»¶çš„ã€‚å¹¶ä¸”æŽ¥æ”¶ç«¯ä¿è¯é¡ºåºæ€§è¿”å›žACKç¡®è®¤ï¼Œæ¯”å¦‚æœ‰ä¸¤ä¸ªåŒ…å‘è¿‡åŽ»ï¼Œä¸º1å·å’Œ2å·ï¼Œ2å·æŽ¥æ”¶æˆåŠŸï¼Œä½†æ˜¯å‘çŽ°1å·åŒ…è¿˜æ²¡æŽ¥æ”¶åˆ°ï¼Œæ‰€ä»¥2å·çš„ACKæ˜¯ä¸ä¼šå‘å›žåŽ»çš„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æžœåœ¨é‡ä¼ æ—¶é—´å†…æ”¶åˆ°1å·äº†ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸¤ä¸ªåŒ…çš„ACKéƒ½è¿”å›žå›žåŽ»ï¼Œå¦‚æžœè¶…æ—¶äº†ï¼Œå°±é‡ä¼ 1å·åŒ…ã€‚çŸ¥é“1å·åŒ…æŽ¥æ”¶æˆåŠŸï¼ŒåŽç»­çš„æ‰ä¼šè¿”å›žACKã€‚ å…·ä½“æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ å‰é¢è¯´è¿‡ï¼Œæ¯ä¸€ä¸ªæ•°æ®åŒ…éƒ½å¸¦æœ‰ä¸‹ä¸€ä¸ªæ•°æ®åŒ…çš„ç¼–å·ã€‚å¦‚æžœä¸‹ä¸€ä¸ªæ•°æ®åŒ…æ²¡æœ‰æ”¶åˆ°ï¼Œé‚£ä¹ˆ ACK çš„ç¼–å·å°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒçŽ°åœ¨æ”¶åˆ°äº†4å·åŒ…ï¼Œä½†æ˜¯æ²¡æœ‰æ”¶åˆ°5å·åŒ…ã€‚ACK å°±ä¼šè®°å½•ï¼ŒæœŸå¾…æ”¶åˆ°5å·åŒ…ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œ5å·åŒ…æ”¶åˆ°äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€è½® ACK ä¼šæ›´æ–°ç¼–å·ã€‚å¦‚æžœ5å·åŒ…è¿˜æ˜¯æ²¡æ”¶åˆ°ï¼Œä½†æ˜¯æ”¶åˆ°äº†6å·åŒ…æˆ–7å·åŒ…ï¼Œé‚£ä¹ˆ ACK é‡Œé¢çš„ç¼–å·ä¸ä¼šå˜åŒ–ï¼Œæ€»æ˜¯æ˜¾ç¤º5å·åŒ…ã€‚è¿™ä¼šå¯¼è‡´å¤§é‡é‡å¤å†…å®¹çš„ ACKã€‚ å¦‚æžœå‘é€æ–¹å‘çŽ°æ”¶åˆ°ä¸‰ä¸ªè¿žç»­çš„é‡å¤ ACKï¼Œæˆ–è€…è¶…æ—¶äº†è¿˜æ²¡æœ‰æ”¶åˆ°ä»»ä½• ACKï¼Œå°±ä¼šç¡®è®¤ä¸¢åŒ…ï¼Œå³5å·åŒ…é—å¤±äº†ï¼Œä»Žè€Œå†æ¬¡å‘é€è¿™ä¸ªåŒ…ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒTCP ä¿è¯äº†ä¸ä¼šæœ‰æ•°æ®åŒ…ä¸¢å¤±ã€‚ ï¼ˆå›¾ç‰‡è¯´æ˜Žï¼šHost B æ²¡æœ‰æ”¶åˆ°100å·æ•°æ®åŒ…ï¼Œä¼šè¿žç»­å‘å‡ºç›¸åŒçš„ ACKï¼Œè§¦å‘ Host A é‡å‘100å·æ•°æ®åŒ…ã€‚ï¼‰ äº”ã€æ…¢å¯åŠ¨ ä¸‹é¢å†æ¥è¯´è¯´æ…¢å¯åŠ¨ã€‚ æœåŠ¡å™¨å‘é€æ•°æ®åŒ…ï¼Œå½“ç„¶è¶Šå¿«è¶Šå¥½ï¼Œæœ€å¥½ä¸€æ¬¡æ€§å…¨å‘å‡ºåŽ»ã€‚ä½†æ˜¯ï¼Œå‘å¾—å¤ªå¿«ï¼Œå°±æœ‰å¯èƒ½ä¸¢åŒ…ã€‚å¸¦å®½å°ã€è·¯ç”±å™¨è¿‡çƒ­ã€ç¼“å­˜æº¢å‡ºç­‰è®¸å¤šå› ç´ éƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ã€‚çº¿è·¯ä¸å¥½çš„è¯ï¼Œå‘å¾—è¶Šå¿«ï¼Œä¸¢å¾—è¶Šå¤šã€‚ æœ€ç†æƒ³çš„çŠ¶æ€æ˜¯ï¼Œåœ¨çº¿è·¯å…è®¸çš„æƒ…å†µä¸‹ï¼Œè¾¾åˆ°æœ€é«˜é€ŸçŽ‡ã€‚ä½†æ˜¯æˆ‘ä»¬æ€Žä¹ˆçŸ¥é“ï¼Œå¯¹æ–¹çº¿è·¯çš„ç†æƒ³é€ŸçŽ‡æ˜¯å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯æ…¢æ…¢è¯•ã€‚ TCP åè®®ä¸ºäº†åšåˆ°æ•ˆçŽ‡ä¸Žå¯é æ€§çš„ç»Ÿä¸€ï¼Œè®¾è®¡äº†ä¸€ä¸ªæ…¢å¯åŠ¨ï¼ˆslow startï¼‰æœºåˆ¶ã€‚å¼€å§‹çš„æ—¶å€™ï¼Œå‘é€å¾—è¾ƒæ…¢ï¼Œç„¶åŽæ ¹æ®ä¸¢åŒ…çš„æƒ…å†µï¼Œè°ƒæ•´é€ŸçŽ‡ï¼šå¦‚æžœä¸ä¸¢åŒ…ï¼Œå°±åŠ å¿«å‘é€é€Ÿåº¦ï¼›å¦‚æžœä¸¢åŒ…ï¼Œå°±é™ä½Žå‘é€é€Ÿåº¦ã€‚ Linux å†…æ ¸é‡Œé¢è®¾å®šäº†ï¼ˆå¸¸é‡TCP_INIT_CWNDï¼‰ï¼Œåˆšå¼€å§‹é€šä¿¡çš„æ—¶å€™ï¼Œå‘é€æ–¹ä¸€æ¬¡æ€§å‘é€10ä¸ªæ•°æ®åŒ…ï¼Œå³&quot;å‘é€çª—å£&quot;çš„å¤§å°ä¸º10ã€‚ç„¶åŽåœä¸‹æ¥ï¼Œç­‰å¾…æŽ¥æ”¶æ–¹çš„ç¡®è®¤ï¼Œå†ç»§ç»­å‘é€ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŽ¥æ”¶æ–¹æ¯æ”¶åˆ°ä¸¤ä¸ª TCP æ•°æ®åŒ…ï¼Œå°±è¦å‘é€ä¸€ä¸ªç¡®è®¤æ¶ˆæ¯ã€‚&quot;ç¡®è®¤&quot;çš„è‹±è¯­æ˜¯ acknowledgementï¼Œæ‰€ä»¥è¿™ä¸ªç¡®è®¤æ¶ˆæ¯å°±ç®€ç§° ACKã€‚ ACK æºå¸¦ä¸¤ä¸ªä¿¡æ¯ï¼š æœŸå¾…è¦æ”¶åˆ°ä¸‹ä¸€ä¸ªæ•°æ®åŒ…çš„ç¼–å· æŽ¥æ”¶æ–¹çš„æŽ¥æ”¶çª—å£çš„å‰©ä½™å®¹é‡ å‘é€æ–¹æœ‰äº†è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå†åŠ ä¸Šè‡ªå·±å·²ç»å‘å‡ºçš„æ•°æ®åŒ…çš„æœ€æ–°ç¼–å·ï¼Œå°±ä¼šæŽ¨æµ‹å‡ºæŽ¥æ”¶æ–¹å¤§æ¦‚çš„æŽ¥æ”¶é€Ÿåº¦ï¼Œä»Žè€Œé™ä½Žæˆ–å¢žåŠ å‘é€é€ŸçŽ‡ã€‚è¿™è¢«ç§°ä¸º&quot;å‘é€çª—å£&quot;ï¼Œè¿™ä¸ªçª—å£çš„å¤§å°æ˜¯å¯å˜çš„ã€‚ æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå‘é€å‘å’ŒæŽ¥æ”¶æ–¹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œå¯ä»¥ç†è§£ä¸ºçª—å£ã€‚æ ¹æ®æŽ¥æ”¶é€Ÿåº¦å¯ä»¥è°ƒæ•´å‘é€é€Ÿåº¦ï¼Œé€æ¸è¾¾åˆ°è¿™æ¡çº¿è·¯æœ€é«˜çš„ä¼ è¾“é€ŸçŽ‡ã€‚ okï¼Œä¸‹é¢å°±å¯ä»¥ç ”ç©¶ä¸€ä¸‹æ»‘åŠ¨çª—å£äº†ã€‚ å…­ã€æ»‘åŠ¨çª—å£åŽŸç† æ­£å¸¸æƒ…å†µä¸‹ï¼š ï¼ˆå¦‚å›¾ï¼Œ123è¡¨ç¤ºå·²ç»æ­£å¸¸å‘é€å¹¶ä¸”æ”¶åˆ°äº†ACKç¡®è®¤ã€‚4567å±žäºŽå·²å‘é€ä½†æ˜¯è¿˜æ²¡æœ‰æ”¶åˆ°ACKã€‚8910è¡¨ç¤ºå¾…å‘é€ã€‚è¿™ä¸ªçª—å£å½“å‰é•¿åº¦ä¸º7.æ­£å¸¸æƒ…å†µä¸‹ï¼Œ4å·åŒ…æ”¶åˆ°ACKï¼Œé‚£ä¹ˆçª—å£å°±ä¼šå³ç§»ä¸€æ ¼ã€‚ï¼‰ ä½†æ˜¯å¾€å¾€ä¼šå‡ºçŽ°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚5å·åŒ…è¿Ÿè¿Ÿæ”¶ä¸åˆ°ACKï¼Œåœ¨æŽ¥æ”¶ç«¯å¯èƒ½æ˜¯æ²¡æœ‰æ”¶åˆ°5å·åŒ…ï¼Œä½†æ˜¯å¯èƒ½ä¼šæ”¶åˆ°6å·åŒ…ç”šè‡³æ˜¯7ã€8å·åŒ…ï¼Œé‚£ä¹ˆæ­¤æ—¶åªèƒ½ç­‰å¾…5å·åŒ…ï¼Œå¦‚æžœ5å·åŒ…é¡ºåˆ©åˆ°è¾¾äº†ï¼Œé‚£ä¹ˆå°±æŠŠ5678å·åŒ…çš„ACKéƒ½å‘ç»™å‘é€ç«¯ï¼Œé‚£ä¹ˆå‘é€ç«¯æ»‘åŠ¨çª—å£å‘å³å³ç§»å››æ ¼ã€‚å¦‚æžœè¿Ÿè¿Ÿæ”¶ä¸åˆ°5å·åŒ…ï¼Œåªèƒ½é‡ä¼ ã€‚ ä»¥ä¸Šå°±æ˜¯å…³äºŽTCPä¸­æ¯”è¾ƒé‡è¦çš„å‡ºé”™é‡ä¼ ã€ç¼–å·ã€æ…¢å¯åŠ¨ä»¥åŠæ»‘åŠ¨çª—å£ã€‚è¿™äº›ä¿è¯äº†æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€‚ æ•´ç†è‡ªï¼šhttp://www.ruanyifeng.com/blog/2017/06/tcp-protocol.html]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[httpçš„å‰ä¸–ä»Šç”Ÿ]]></title>
    <url>%2F2019%2F01%2F17%2Fnetwork%2F3.http%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ã€‚ä½œä¸ºä¸€ä¸ªåŽç«¯æ”»åŸŽç‹®ï¼Œæ¯å¤©æ‰“äº¤é“æœ€å¤šçš„å°±æ˜¯HTTPåè®®ï¼Œåœ¨å¦‚ä»Šç«çƒ­çš„å¾®æœåŠ¡å®žçŽ°æ–¹æ¡ˆä¸­ï¼Œé™¤äº†é˜¿é‡Œçš„dubboï¼Œå°±æ˜¯spring cloudï¼Œè€Œspring cloudç›®å‰é€‚ç”¨çš„æœåŠ¡é—´é€šä¿¡æ–¹å¼ä¹Ÿå°±æ˜¯åŸºäºŽHTTP çš„ restfulæŽ¥å£æ¥å®žçŽ°ã€‚å¹¶ä¸”ä½œä¸ºæµè§ˆå™¨ä¸Šç”¨çš„æœ€å¤šçš„åè®®ï¼Œæ— è®ºæ˜¯å‰ç«¯ã€åŽç«¯è¿˜æ˜¯æµ‹è¯•éƒ½åº”è¯¥åŽ»ç†Ÿæ‚‰å®ƒï¼Œè½¯ä»¶çš„å‘å±•æ˜¯å¾ªåºæ¸è¿›çš„ï¼Œæ¯æ¬¡çš„è¿­ä»£å‡çº§éƒ½æ˜¯ä¸ºäº†è§£å†³ä¸Šä¸€ç‰ˆæœ¬çš„ç—›ç‚¹ï¼ŒHTTPåè®®çš„å‘å±•ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæœ¬ç« ç€é‡è®²è§£HTTPçš„å‰ä¸–ä»Šç”Ÿï¼Œè®©æˆ‘ä»¬æ›´åŠ äº†è§£HTTPã€‚ HTTP æ˜¯åŸºäºŽ TCP/IP åè®®çš„åº”ç”¨å±‚åè®®ã€‚å®ƒä¸æ¶‰åŠæ•°æ®åŒ…ï¼ˆpacketï¼‰ä¼ è¾“ï¼Œä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ï¼Œé»˜è®¤ä½¿ç”¨80ç«¯å£ã€‚ ä¸€ã€HTTP/0.9 1.1 ç®€ä»‹ è¿™æ˜¯ç¬¬ä¸€ä¸ªå®šç¨¿çš„HTTPåè®®ã€‚ å†…å®¹éžå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªå‘½ä»¤GET æ²¡æœ‰HEADERç­‰æè¿°æ•°æ®çš„ä¿¡æ¯ æœåŠ¡å™¨å‘é€å®Œæ¯•ï¼Œå°±å…³é—­TCPè¿žæŽ¥ï¼ˆä¸€ä¸ªHTTPè¯·æ±‚åœ¨ä¸€ä¸ªTCPè¿žæŽ¥ä¸­å®Œæˆï¼‰ 1.2 è¯·æ±‚æ ¼å¼ æ¯”å¦‚å‘èµ·ä¸€ä¸ªGETè¯·æ±‚ï¼š GET /index.html ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼ŒTCP è¿žæŽ¥ï¼ˆconnectionï¼‰å»ºç«‹åŽï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚ï¼ˆrequestï¼‰ç½‘é¡µindex.htmlã€‚ 1.3 å“åº”æ ¼å¼ åè®®è§„å®šï¼ŒæœåŠ¡å™¨åªèƒ½å›žåº”HTMLæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½å›žåº”åˆ«çš„æ ¼å¼ã€‚ 123&lt;html&gt; &lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt; æœåŠ¡å™¨å‘é€å®Œæ¯•ï¼Œå°±å…³é—­TCPè¿žæŽ¥ã€‚ äºŒã€HTTP/1.0 2.1 ç®€ä»‹ è·ŸçŽ°åœ¨æ¯”è¾ƒæ™®éé€‚ç”¨çš„1.1ç‰ˆæœ¬å·²ç»ç›¸å·®ä¸å¤šã€‚ å¢žåŠ å¾ˆå¤šå‘½ä»¤ï¼Œæ¯”å¦‚POSTã€HEADç­‰å‘½ä»¤ å¢žåŠ status code å’Œ header å¤šå­—ç¬¦é›†æ”¯æŒã€å¤šéƒ¨åˆ†å‘é€ã€æƒé™ã€ç¼“å­˜ç­‰ é¦–å…ˆï¼Œä»»ä½•æ ¼å¼çš„å†…å®¹éƒ½å¯ä»¥å‘é€ã€‚è¿™ä½¿å¾—äº’è”ç½‘ä¸ä»…å¯ä»¥ä¼ è¾“æ–‡å­—ï¼Œè¿˜èƒ½ä¼ è¾“å›¾åƒã€è§†é¢‘ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™ä¸ºäº’è”ç½‘çš„å¤§å‘å±•å¥ å®šäº†åŸºç¡€ã€‚ å…¶æ¬¡ï¼Œé™¤äº†GETå‘½ä»¤ï¼Œè¿˜å¼•å…¥äº†POSTå‘½ä»¤å’ŒHEADå‘½ä»¤ï¼Œä¸°å¯Œäº†æµè§ˆå™¨ä¸ŽæœåŠ¡å™¨çš„äº’åŠ¨æ‰‹æ®µã€‚ å†æ¬¡ï¼ŒHTTPè¯·æ±‚å’Œå›žåº”çš„æ ¼å¼ä¹Ÿå˜äº†ã€‚é™¤äº†æ•°æ®éƒ¨åˆ†ï¼Œæ¯æ¬¡é€šä¿¡éƒ½å¿…é¡»åŒ…æ‹¬å¤´ä¿¡æ¯ï¼ˆHTTP headerï¼‰ï¼Œç”¨æ¥æè¿°ä¸€äº›å…ƒæ•°æ®ã€‚ å…¶ä»–çš„æ–°å¢žåŠŸèƒ½è¿˜åŒ…æ‹¬çŠ¶æ€ç ï¼ˆstatus codeï¼‰ã€å¤šå­—ç¬¦é›†æ”¯æŒã€å¤šéƒ¨åˆ†å‘é€ï¼ˆmulti-part typeï¼‰ã€æƒé™ï¼ˆauthorizationï¼‰ã€ç¼“å­˜ï¼ˆcacheï¼‰ã€å†…å®¹ç¼–ç ï¼ˆcontent encodingï¼‰ç­‰ã€‚ 2.2 è¯·æ±‚æ ¼å¼ ä¸‹é¢æ˜¯ä¸€ä¸ª1.0ç‰ˆçš„HTTPè¯·æ±‚çš„ä¾‹å­ã€‚ 123GET / HTTP/1.0User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)Accept: */* å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ ¼å¼ä¸Ž0.9ç‰ˆæœ‰å¾ˆå¤§å˜åŒ–ã€‚ ç¬¬ä¸€è¡Œæ˜¯è¯·æ±‚å‘½ä»¤ï¼Œå¿…é¡»åœ¨å°¾éƒ¨æ·»åŠ åè®®ç‰ˆæœ¬ï¼ˆHTTP/1.0ï¼‰ã€‚åŽé¢å°±æ˜¯å¤šè¡Œå¤´ä¿¡æ¯ï¼Œæè¿°å®¢æˆ·ç«¯çš„æƒ…å†µã€‚ å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨Acceptå­—æ®µå£°æ˜Žè‡ªå·±å¯ä»¥æŽ¥å—å“ªäº›æ•°æ®æ ¼å¼ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯å£°æ˜Žè‡ªå·±å¯ä»¥æŽ¥å—ä»»ä½•æ ¼å¼çš„æ•°æ®ã€‚ 2.3 å“åº”æ ¼å¼ æœåŠ¡å™¨çš„å›žåº”å¦‚ä¸‹ï¼š 12345678910HTTP/1.0 200 OK Content-Type: text/plainContent-Length: 137582Expires: Thu, 05 Dec 1997 16:00:00 GMTLast-Modified: Wed, 5 August 1996 15:55:28 GMTServer: Apache 0.84&lt;html&gt; &lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt; å›žåº”çš„æ ¼å¼æ˜¯&quot;å¤´ä¿¡æ¯ + ä¸€ä¸ªç©ºè¡Œï¼ˆ\r\nï¼‰ + æ•°æ®&quot;ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€è¡Œæ˜¯&quot;åè®®ç‰ˆæœ¬ + çŠ¶æ€ç ï¼ˆstatus codeï¼‰ + çŠ¶æ€æè¿°&quot;ã€‚ 2.4 Content-Type å­—æ®µ å…³äºŽå­—ç¬¦çš„ç¼–ç ï¼Œ1.0ç‰ˆè§„å®šï¼Œå¤´ä¿¡æ¯å¿…é¡»æ˜¯ ASCII ç ï¼ŒåŽé¢çš„æ•°æ®å¯ä»¥æ˜¯ä»»ä½•æ ¼å¼ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨å›žåº”çš„æ—¶å€™ï¼Œå¿…é¡»å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œæ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Œè¿™å°±æ˜¯Content-Typeå­—æ®µçš„ä½œç”¨ã€‚ 2.5 ç¼ºç‚¹ æ¯ä¸ªTCPè¿žæŽ¥åªèƒ½å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚å‘é€æ•°æ®å®Œæ¯•ï¼Œè¿žæŽ¥å°±å…³é—­ï¼Œå¦‚æžœè¿˜è¦è¯·æ±‚å…¶ä»–èµ„æºï¼Œå°±å¿…é¡»å†æ–°å»ºä¸€ä¸ªè¿žæŽ¥ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰äº›æµè§ˆå™¨åœ¨è¯·æ±‚æ—¶ï¼Œç”¨äº†ä¸€ä¸ªéžæ ‡å‡†çš„Connectionå­—æ®µã€‚ Connection: keep-alive è¿™ä¸ªå­—æ®µè¦æ±‚æœåŠ¡å™¨ä¸è¦å…³é—­TCPè¿žæŽ¥ï¼Œä»¥ä¾¿å…¶ä»–è¯·æ±‚å¤ç”¨ã€‚æœåŠ¡å™¨åŒæ ·å›žåº”è¿™ä¸ªå­—æ®µã€‚ Connection: keep-alive ä¸€ä¸ªå¯ä»¥å¤ç”¨çš„TCPè¿žæŽ¥å°±å»ºç«‹äº†ï¼Œç›´åˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ä¸»åŠ¨å…³é—­è¿žæŽ¥ã€‚ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯æ ‡å‡†å­—æ®µï¼Œä¸åŒå®žçŽ°çš„è¡Œä¸ºå¯èƒ½ä¸ä¸€è‡´ï¼Œå› æ­¤ä¸æ˜¯æ ¹æœ¬çš„è§£å†³åŠžæ³•ã€‚ ä¸‰ã€HTTP/1.1 3.1 æŒä¹…è¿žæŽ¥å’Œç®¡é“æœºåˆ¶ æŒä¹…è¿žæŽ¥ï¼ˆä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä¸€ä¸ªHTTPè¯·æ±‚å°±åˆ›å»ºä¸€ä¸ªTCPè¿žæŽ¥ï¼Œè¯·æ±‚è¿”å›žä¹‹åŽå°±å…³é—­TCPè¿žæŽ¥ï¼Œç„¶è€Œå»ºç«‹ä¸€æ¬¡TCPè¿žæŽ¥çš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œæ•ˆçŽ‡ä¼šæ¯”è¾ƒä½Žï¼ŒçŽ°åœ¨å»ºç«‹ä¸€ä¸ªTCPè¿žæŽ¥åŽï¼ŒåŽé¢çš„HTTPè¯·æ±‚éƒ½å¯ä»¥å¤ç”¨è¿™ä¸ªTCPè¿žæŽ¥ï¼Œå³å…è®¸äº†åœ¨åŒä¸€ä¸ªè¿žæŽ¥é‡Œé¢å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä¼šæé«˜æ•ˆçŽ‡ï¼‰ pipelineï¼ˆè§£å†³äº†åŒä¸€ä¸ªTCPè¿žæŽ¥ä¸­å®¢æˆ·ç«¯å¯ä»¥å‘é€å¤šä¸ªHTTPè¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºŽæœåŠ¡ç«¯æ¥è¯´ï¼Œå¯¹äºŽè¿›æ¥çš„è¯·æ±‚è¦æŒ‰ç…§é¡ºåºè¿›è¡Œå†…å®¹çš„è¿”å›žï¼Œå¦‚æžœå‰ä¸€ä¸ªè¯·æ±‚å¤„ç†æ—¶é—´é•¿ï¼Œè€ŒåŽä¸€ä¸ªè¯·æ±‚å¤„ç†æ—¶é—´ç«¯ï¼Œå³ä¾¿åŽé¢ä¸€ä¸ªè¯·æ±‚å·²ç»å¤„ç†å®Œæ¯•äº†ï¼Œä¹Ÿè¦ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•è¿”å›žä»–æ‰å¯ä»¥è¿”å›žç»“æžœï¼Œè¿™ç§ä¸²è¡Œçš„æ–¹å¼æ¯”è¾ƒæ…¢ï¼‰ åœ¨1.1ç‰ˆæœ¬ä»¥å‰ï¼Œæ¯æ¬¡HTTPè¯·æ±‚ï¼Œéƒ½ä¼šé‡æ–°å»ºç«‹ä¸€æ¬¡TCPè¿žæŽ¥ï¼ŒæœåŠ¡å™¨å“åº”åŽï¼Œå°±ç«‹åˆ»å…³é—­ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå»ºç«‹TCPè¿žæŽ¥çš„æ–°å»ºæˆæœ¬å¾ˆé«˜ï¼Œå› ä¸ºéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¹¶ä¸”æœ‰ç€æ…¢å¯åŠ¨çš„ç‰¹æ€§å¯¼è‡´å‘é€é€Ÿåº¦è¾ƒæ…¢ã€‚è€Œ1.1ç‰ˆæœ¬æ·»åŠ çš„æŒä¹…è¿žæŽ¥åŠŸèƒ½å¯ä»¥è®©ä¸€æ¬¡TCPè¿žæŽ¥ä¸­å‘é€å¤šæ¡HTTPè¯·æ±‚ï¼Œå€¼å¾—ä¸€æçš„æ˜¯é»˜è®¤æ˜¯ï¼ŒæŽ§åˆ¶æŒä¹…è¿žæŽ¥çš„Connectionå­—æ®µé»˜è®¤å€¼æ˜¯keep-aliveï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯é»˜è®¤æ‰“å¼€æŒä¹…è¿žæŽ¥ï¼Œå¦‚æžœæƒ³è¦å…³é—­ï¼Œåªéœ€å°†è¯¥å­—æ®µçš„å€¼æ”¹ä¸ºcloseã€‚ Connection: close è€Œç®¡é“åŒ–åˆ™èµ‹äºˆäº†å®¢æˆ·ç«¯åœ¨ä¸€ä¸ªTCPè¿žæŽ¥ä¸­è¿žç»­å‘é€å¤šä¸ªè¯·æ±‚çš„èƒ½åŠ›ï¼Œè€Œä¸éœ€è¦ç­‰åˆ°å‰ä¸€ä¸ªè¯·æ±‚å“åº”ï¼Œè¿™å¤§å¤§æé«˜äº†æ•ˆçŽ‡ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè™½ç„¶å®¢æˆ·ç«¯å¯ä»¥è¿žç»­å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿”å›žä¾ç„¶æ˜¯æŒ‰ç…§å‘é€çš„é¡ºåºè¿”å›žã€‚ï¼ˆå¼ºè°ƒçš„æ˜¯requestä¸éœ€è¦ç­‰å¾…ä¸Šä¸€ä¸ªrequestçš„responseï¼Œå…¶å®žå‘é€çš„requestè¿˜æ˜¯æœ‰é¡ºåºçš„ï¼ŒæœåŠ¡ç«¯æŒ‰ç…§è¿™ä¸ªé¡ºåºæŽ¥æ”¶ï¼Œä¾æ¬¡è¿”å›žå“åº”ï¼‰ HTTP/1.1å…è®¸å¤šä¸ªhttpè¯·æ±‚é€šè¿‡ä¸€ä¸ªå¥—æŽ¥å­—åŒæ—¶è¢«è¾“å‡º ï¼Œè€Œä¸ç”¨ç­‰å¾…ç›¸åº”çš„å“åº”ã€‚ç„¶åŽè¯·æ±‚è€…å°±ä¼šç­‰å¾…å„è‡ªçš„å“åº”ï¼Œè¿™äº›å“åº”æ˜¯æŒ‰ç…§ä¹‹å‰è¯·æ±‚çš„é¡ºåºä¾æ¬¡åˆ°è¾¾ã€‚ï¼ˆmeï¼šæ‰€æœ‰è¯·æ±‚ä¿æŒä¸€ä¸ªFIFOçš„é˜Ÿåˆ—ï¼Œä¸€ä¸ªè¯·æ±‚å‘é€å®Œä¹‹åŽï¼Œä¸å¿…ç­‰å¾…è¿™ä¸ªè¯·æ±‚çš„å“åº”è¢«æŽ¥å—åˆ°ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°±å¯ä»¥è¢«å†æ¬¡å‘å‡ºï¼›åŒæ—¶ï¼ŒæœåŠ¡å™¨ç«¯è¿”å›žè¿™äº›è¯·æ±‚çš„å“åº”æ—¶ä¹Ÿæ˜¯æŒ‰ç…§FIFOçš„é¡ºåºï¼‰ã€‚ç®¡é“åŒ–çš„è¡¨çŽ°å¯ä»¥å¤§å¤§æé«˜é¡µé¢åŠ è½½çš„é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å»¶è¿Ÿè¿žæŽ¥ä¸­ã€‚ 3.2 Content-Length å­—æ®µ ä¸€ä¸ªTCPè¿žæŽ¥çŽ°åœ¨å¯ä»¥ä¼ é€å¤šä¸ªå›žåº”ï¼ŒåŠ¿å¿…å°±è¦æœ‰ä¸€ç§æœºåˆ¶ï¼ŒåŒºåˆ†æ•°æ®åŒ…æ˜¯å±žäºŽå“ªä¸€ä¸ªå›žåº”çš„ã€‚è¿™å°±æ˜¯Content-lengthå­—æ®µçš„ä½œç”¨ï¼Œå£°æ˜Žæœ¬æ¬¡å›žåº”çš„æ•°æ®é•¿åº¦ã€‚ Content-Length: 3495 ä¸Šé¢ä»£ç å‘Šè¯‰æµè§ˆå™¨ï¼Œæœ¬æ¬¡å›žåº”çš„é•¿åº¦æ˜¯3495ä¸ªå­—èŠ‚ï¼ŒåŽé¢çš„å­—èŠ‚å°±å±žäºŽä¸‹ä¸€ä¸ªå›žåº”äº†ã€‚ åœ¨1.0ç‰ˆä¸­ï¼ŒContent-Lengthå­—æ®µä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæµè§ˆå™¨å‘çŽ°æœåŠ¡å™¨å…³é—­äº†TCPè¿žæŽ¥ï¼Œå°±è¡¨æ˜Žæ”¶åˆ°çš„æ•°æ®åŒ…å·²ç»å…¨äº†ã€‚ 3.3 åˆ†å—ä¼ è¾“ç¼–ç  å¯¹äºŽä¸€äº›å¾ˆè€—æ—¶çš„åŠ¨æ€æ“ä½œæ¥è¯´ï¼Œè¿™æ„å‘³ç€ï¼ŒæœåŠ¡å™¨è¦ç­‰åˆ°æ‰€æœ‰æ“ä½œå®Œæˆï¼Œæ‰èƒ½å‘é€æ•°æ®ï¼Œæ˜¾ç„¶è¿™æ ·çš„æ•ˆçŽ‡ä¸é«˜ã€‚æ›´å¥½çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œäº§ç”Ÿä¸€å—æ•°æ®ï¼Œå°±å‘é€ä¸€å—ï¼Œé‡‡ç”¨&quot;æµæ¨¡å¼&quot;ï¼ˆstreamï¼‰å–ä»£&quot;ç¼“å­˜æ¨¡å¼&quot;ï¼ˆbufferï¼‰ã€‚ å› æ­¤ï¼Œ1.1ç‰ˆè§„å®šå¯ä»¥ä¸ä½¿ç”¨Content-Lengthå­—æ®µï¼Œè€Œä½¿ç”¨&quot;åˆ†å—ä¼ è¾“ç¼–ç &quot;ï¼ˆchunked transfer encodingï¼‰ã€‚åªè¦è¯·æ±‚æˆ–å›žåº”çš„å¤´ä¿¡æ¯æœ‰Transfer-Encodingå­—æ®µï¼Œå°±è¡¨æ˜Žå›žåº”å°†ç”±æ•°é‡æœªå®šçš„æ•°æ®å—ç»„æˆã€‚ Transfer-Encoding: chunked æ¯ä¸ªéžç©ºçš„æ•°æ®å—ä¹‹å‰ï¼Œä¼šæœ‰ä¸€ä¸ª16è¿›åˆ¶çš„æ•°å€¼ï¼Œè¡¨ç¤ºè¿™ä¸ªå—çš„é•¿åº¦ã€‚æœ€åŽæ˜¯ä¸€ä¸ªå¤§å°ä¸º0çš„å—ï¼Œå°±è¡¨ç¤ºæœ¬æ¬¡å›žåº”çš„æ•°æ®å‘é€å®Œäº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ 1234567891011121314151617HTTP/1.1 200 OKContent-Type: text/plainTransfer-Encoding: chunked25This is the data in the first chunk1Cand this is the second one3con8sequence0 3.3 å…¶ä»–åŠŸèƒ½ 1.1ç‰ˆè¿˜æ–°å¢žäº†è®¸å¤šåŠ¨è¯æ–¹æ³•ï¼šPUTã€PATCHã€HEADã€ OPTIONSã€DELETEã€‚ å¦å¤–ï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„å¤´ä¿¡æ¯æ–°å¢žäº†Hostå­—æ®µï¼Œç”¨æ¥æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåã€‚ Host: www.example.com æœ‰äº†Hostå­—æ®µï¼Œå°±å¯ä»¥å°†è¯·æ±‚å‘å¾€åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„ä¸åŒç½‘ç«™ï¼Œä¸ºè™šæ‹Ÿä¸»æœºçš„å…´èµ·æ‰“ä¸‹äº†åŸºç¡€ã€‚ 3.4 ç¼ºç‚¹ è™½ç„¶1.1ç‰ˆå…è®¸å¤ç”¨TCPè¿žæŽ¥ï¼Œä½†æ˜¯åŒä¸€ä¸ªTCPè¿žæŽ¥é‡Œé¢ï¼Œæ‰€æœ‰çš„æ•°æ®é€šä¿¡æ˜¯æŒ‰æ¬¡åºè¿›è¡Œçš„ã€‚æœåŠ¡å™¨åªæœ‰å¤„ç†å®Œä¸€ä¸ªå›žåº”ï¼Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€ä¸ªå›žåº”ã€‚è¦æ˜¯å‰é¢çš„å›žåº”ç‰¹åˆ«æ…¢ï¼ŒåŽé¢å°±ä¼šæœ‰è®¸å¤šè¯·æ±‚æŽ’é˜Ÿç­‰ç€ã€‚è¿™ç§°ä¸º&quot;é˜Ÿå¤´å µå¡ž&quot;ï¼ˆHead-of-line blockingï¼‰ã€‚ å››ã€SPDY åè®® 2009å¹´ï¼Œè°·æ­Œå…¬å¼€äº†è‡ªè¡Œç ”å‘çš„ SPDY åè®®ï¼Œä¸»è¦è§£å†³ HTTP/1.1 æ•ˆçŽ‡ä¸é«˜çš„é—®é¢˜ã€‚ è¿™ä¸ªåè®®åœ¨Chromeæµè§ˆå™¨ä¸Šè¯æ˜Žå¯è¡Œä»¥åŽï¼Œå°±è¢«å½“ä½œ HTTP/2 çš„åŸºç¡€ï¼Œä¸»è¦ç‰¹æ€§éƒ½åœ¨ HTTP/2 ä¹‹ä¸­å¾—åˆ°ç»§æ‰¿ã€‚ äº”ã€HTTP/2 5.1 äºŒè¿›åˆ¶åè®® HTTP/1.1 ç‰ˆçš„å¤´ä¿¡æ¯è‚¯å®šæ˜¯æ–‡æœ¬ï¼ˆASCIIç¼–ç ï¼‰ï¼Œæ•°æ®ä½“å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶ã€‚ HTTP/2 åˆ™æ˜¯ä¸€ä¸ªå½»åº•çš„äºŒè¿›åˆ¶åè®®ï¼Œå¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”ç»Ÿç§°ä¸º&quot;å¸§&quot;ï¼ˆframeï¼‰ï¼šå¤´ä¿¡æ¯å¸§å’Œæ•°æ®å¸§ã€‚ äºŒè¿›åˆ¶åè®®çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¯ä»¥å®šä¹‰é¢å¤–çš„å¸§ã€‚HTTP/2 å®šä¹‰äº†è¿‘åç§å¸§ï¼Œä¸ºå°†æ¥çš„é«˜çº§åº”ç”¨æ‰“å¥½äº†åŸºç¡€ã€‚å¦‚æžœä½¿ç”¨æ–‡æœ¬å®žçŽ°è¿™ç§åŠŸèƒ½ï¼Œè§£æžæ•°æ®å°†ä¼šå˜å¾—éžå¸¸éº»çƒ¦ï¼ŒäºŒè¿›åˆ¶è§£æžåˆ™æ–¹ä¾¿å¾—å¤šã€‚ 5.2 å¤šå·¥ HTTP/2 å¤ç”¨TCPè¿žæŽ¥ï¼Œåœ¨ä¸€ä¸ªè¿žæŽ¥é‡Œï¼Œå®¢æˆ·ç«¯å’Œæµè§ˆå™¨éƒ½å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æˆ–å›žåº”ï¼Œè€Œä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºä¸€ä¸€å¯¹åº”ï¼Œè¿™æ ·å°±é¿å…äº†&quot;é˜Ÿå¤´å µå¡ž&quot;ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªTCPè¿žæŽ¥é‡Œé¢ï¼ŒæœåŠ¡å™¨åŒæ—¶æ”¶åˆ°äº†Aè¯·æ±‚å’ŒBè¯·æ±‚ï¼ŒäºŽæ˜¯å…ˆå›žåº”Aè¯·æ±‚ï¼Œç»“æžœå‘çŽ°å¤„ç†è¿‡ç¨‹éžå¸¸è€—æ—¶ï¼ŒäºŽæ˜¯å°±å‘é€Aè¯·æ±‚å·²ç»å¤„ç†å¥½çš„éƒ¨åˆ†ï¼Œ æŽ¥ç€å›žåº”Bè¯·æ±‚ï¼Œå®ŒæˆåŽï¼Œå†å‘é€Aè¯·æ±‚å‰©ä¸‹çš„éƒ¨åˆ†ã€‚ è¿™æ ·åŒå‘çš„ã€å®žæ—¶çš„é€šä¿¡ï¼Œå°±å«åšå¤šå·¥ï¼ˆMultiplexingï¼‰ã€‚ 5.3 æ•°æ®æµ å› ä¸º HTTP/2 çš„æ•°æ®åŒ…æ˜¯ä¸æŒ‰é¡ºåºå‘é€çš„ï¼ŒåŒä¸€ä¸ªè¿žæŽ¥é‡Œé¢è¿žç»­çš„æ•°æ®åŒ…ï¼Œå¯èƒ½å±žäºŽä¸åŒçš„å›žåº”ã€‚å› æ­¤ï¼Œå¿…é¡»è¦å¯¹æ•°æ®åŒ…åšæ ‡è®°ï¼ŒæŒ‡å‡ºå®ƒå±žäºŽå“ªä¸ªå›žåº”ã€‚ HTTP/2 å°†æ¯ä¸ªè¯·æ±‚æˆ–å›žåº”çš„æ‰€æœ‰æ•°æ®åŒ…ï¼Œç§°ä¸ºä¸€ä¸ªæ•°æ®æµï¼ˆstreamï¼‰ã€‚æ¯ä¸ªæ•°æ®æµéƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–å·ã€‚æ•°æ®åŒ…å‘é€çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»æ ‡è®°æ•°æ®æµIDï¼Œç”¨æ¥åŒºåˆ†å®ƒå±žäºŽå“ªä¸ªæ•°æ®æµã€‚å¦å¤–è¿˜è§„å®šï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®æµï¼ŒIDä¸€å¾‹ä¸ºå¥‡æ•°ï¼ŒæœåŠ¡å™¨å‘å‡ºçš„ï¼ŒIDä¸ºå¶æ•°ã€‚ æ•°æ®æµå‘é€åˆ°ä¸€åŠçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥å‘é€ä¿¡å·ï¼ˆRST_STREAMå¸§ï¼‰ï¼Œå–æ¶ˆè¿™ä¸ªæ•°æ®æµã€‚1.1ç‰ˆå–æ¶ˆæ•°æ®æµçš„å”¯ä¸€æ–¹æ³•ï¼Œå°±æ˜¯å…³é—­TCPè¿žæŽ¥ã€‚è¿™å°±æ˜¯è¯´ï¼ŒHTTP/2 å¯ä»¥å–æ¶ˆæŸä¸€æ¬¡è¯·æ±‚ï¼ŒåŒæ—¶ä¿è¯TCPè¿žæŽ¥è¿˜æ‰“å¼€ç€ï¼Œå¯ä»¥è¢«å…¶ä»–è¯·æ±‚ä½¿ç”¨ã€‚ å®¢æˆ·ç«¯è¿˜å¯ä»¥æŒ‡å®šæ•°æ®æµçš„ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§è¶Šé«˜ï¼ŒæœåŠ¡å™¨å°±ä¼šè¶Šæ—©å›žåº”ã€‚ 5.4 å¤´ä¿¡æ¯åŽ‹ç¼© HTTP åè®®ä¸å¸¦æœ‰çŠ¶æ€ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œè¯·æ±‚çš„å¾ˆå¤šå­—æ®µéƒ½æ˜¯é‡å¤çš„ï¼Œæ¯”å¦‚Cookieå’ŒUser Agentï¼Œä¸€æ¨¡ä¸€æ ·çš„å†…å®¹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„å¸¦ï¼Œè¿™ä¼šæµªè´¹å¾ˆå¤šå¸¦å®½ï¼Œä¹Ÿå½±å“é€Ÿåº¦ã€‚ HTTP/2 å¯¹è¿™ä¸€ç‚¹åšäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†å¤´ä¿¡æ¯åŽ‹ç¼©æœºåˆ¶ï¼ˆheader compressionï¼‰ã€‚ä¸€æ–¹é¢ï¼Œå¤´ä¿¡æ¯ä½¿ç”¨gzipæˆ–compressåŽ‹ç¼©åŽå†å‘é€ï¼›å¦ä¸€æ–¹é¢ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤ä¸€å¼ å¤´ä¿¡æ¯è¡¨ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å…¥è¿™ä¸ªè¡¨ï¼Œç”Ÿæˆä¸€ä¸ªç´¢å¼•å·ï¼Œä»¥åŽå°±ä¸å‘é€åŒæ ·å­—æ®µäº†ï¼Œåªå‘é€ç´¢å¼•å·ï¼Œè¿™æ ·å°±æé«˜é€Ÿåº¦äº†ã€‚ 5.5 æœåŠ¡å™¨æŽ¨é€ HTTP/2 å…è®¸æœåŠ¡å™¨æœªç»è¯·æ±‚ï¼Œä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€èµ„æºï¼Œè¿™å«åšæœåŠ¡å™¨æŽ¨é€ï¼ˆserver pushï¼‰ã€‚ å¸¸è§åœºæ™¯æ˜¯å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µé‡Œé¢åŒ…å«å¾ˆå¤šé™æ€èµ„æºã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¿…é¡»æ”¶åˆ°ç½‘é¡µåŽï¼Œè§£æžHTMLæºç ï¼Œå‘çŽ°æœ‰é™æ€èµ„æºï¼Œå†å‘å‡ºé™æ€èµ„æºè¯·æ±‚ã€‚å…¶å®žï¼ŒæœåŠ¡å™¨å¯ä»¥é¢„æœŸåˆ°å®¢æˆ·ç«¯è¯·æ±‚ç½‘é¡µåŽï¼Œå¾ˆå¯èƒ½ä¼šå†è¯·æ±‚é™æ€èµ„æºï¼Œæ‰€ä»¥å°±ä¸»åŠ¨æŠŠè¿™äº›é™æ€èµ„æºéšç€ç½‘é¡µä¸€èµ·å‘ç»™å®¢æˆ·ç«¯äº†ã€‚ æ•´ç†è‡ªï¼šhttp://www.ruanyifeng.com/blog/2016/08/http.html]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Žä¸Šåˆ°ä¸‹çœ‹äº”å±‚æ¨¡åž‹]]></title>
    <url>%2F2019%2F01%2F17%2Fnetwork%2F2.%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E7%9C%8B%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬äºŒç¯‡æ–‡ç« ã€‚ç»è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„è¯¦ç»†ä»‹ç»ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸€ä¸ªæ•°æ®æ˜¯å¦‚ä½•ä»Žç‰©ç†å±‚ä¸€æ­¥ä¸€æ­¥åˆ°è¾¾åº”ç”¨å±‚çš„ï¼Œé‚£ä¹ˆæœ¬ç« ä»Žä¸Šè€Œä¸‹çš„è§’åº¦æ¥çœ‹çœ‹ä¸€æ¡è¯·æ±‚æ—¶å¦‚ä½•ä»Žæµè§ˆå™¨ä¼ é€’åˆ°æœåŠ¡å™¨å¹¶ä¸”è¿”å›žçš„ã€‚ è¿™ä¸ªè¿‡ç¨‹çœ‹çš„å°±æ˜¯ç”¨æˆ·ä»Žæµè§ˆå™¨è¾“å…¥ä¸€æ¡urlä¹‹åŽï¼Œæ˜¯å¦‚ä½•å‘é€è¿‡åŽ»çš„ã€‚ 1.ä¸Šä¸€ç¯‡æ–‡ç« çš„å°ç»“ æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œç½‘ç»œé€šä¿¡å°±æ˜¯äº¤æ¢æ•°æ®åŒ…ã€‚ç”µè„‘Aå‘ç”µè„‘Bå‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼ŒåŽè€…æ”¶åˆ°äº†ï¼Œå›žå¤ä¸€ä¸ªæ•°æ®åŒ…ï¼Œä»Žè€Œå®žçŽ°ä¸¤å°ç”µè„‘ä¹‹é—´çš„é€šä¿¡ã€‚æ•°æ®åŒ…çš„ç»“æž„ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸‹é¢è¿™æ ·ï¼š å‘é€è¿™ä¸ªåŒ…ï¼Œéœ€è¦çŸ¥é“ä¸¤ä¸ªåœ°å€ï¼š å¯¹æ–¹çš„MACåœ°å€ å¯¹æ–¹çš„IPåœ°å€ æœ‰äº†è¿™ä¸¤ä¸ªåœ°å€ï¼Œæ•°æ®åŒ…æ‰èƒ½å‡†ç¡®é€åˆ°æŽ¥æ”¶è€…æ‰‹ä¸­ã€‚ä½†æ˜¯ï¼Œå‰é¢è¯´è¿‡ï¼ŒMACåœ°å€æœ‰å±€é™æ€§ï¼Œå¦‚æžœä¸¤å°ç”µè„‘ä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œå°±æ— æ³•çŸ¥é“å¯¹æ–¹çš„MACåœ°å€ï¼Œå¿…é¡»é€šè¿‡ç½‘å…³ï¼ˆgatewayï¼‰è½¬å‘ã€‚ ä¸Šå›¾ä¸­ï¼Œ1å·ç”µè„‘è¦å‘4å·ç”µè„‘å‘é€ä¸€ä¸ªæ•°æ®åŒ…ã€‚å®ƒå…ˆåˆ¤æ–­4å·ç”µè„‘æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œç»“æžœå‘çŽ°ä¸æ˜¯ï¼ˆåŽæ–‡ä»‹ç»åˆ¤æ–­æ–¹æ³•ï¼‰ï¼ŒäºŽæ˜¯å°±æŠŠè¿™ä¸ªæ•°æ®åŒ…å‘åˆ°ç½‘å…³Aã€‚ç½‘å…³Aé€šè¿‡è·¯ç”±åè®®ï¼Œå‘çŽ°4å·ç”µè„‘ä½äºŽå­ç½‘ç»œBï¼ŒåˆæŠŠæ•°æ®åŒ…å‘ç»™ç½‘å…³Bï¼Œç½‘å…³Bå†è½¬å‘åˆ°4å·ç”µè„‘ã€‚ 1å·ç”µè„‘æŠŠæ•°æ®åŒ…å‘åˆ°ç½‘å…³Aï¼Œå¿…é¡»çŸ¥é“ç½‘å…³Açš„MACåœ°å€ã€‚ å‘é€æ•°æ®åŒ…ä¹‹å‰ï¼Œç”µè„‘å¿…é¡»åˆ¤æ–­å¯¹æ–¹æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œç„¶åŽé€‰æ‹©ç›¸åº”çš„MACåœ°å€ã€‚ æœ‰äº†ä¸€å°æ–°ç”µè„‘ä¹‹åŽï¼Œè¦æƒ³ä¸Šç½‘ï¼Œä¸€ç§æ–¹å¼æ˜¯è‡ªå·±é…ç½®é™æ€IPï¼š å¾ˆå¤šäººéƒ½æ²¡æœ‰è¿›è¡Œè¿‡è¿™ä¸ªé…ç½®ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦è¿™æ ·ã€‚ä½†æ˜¯æœ‰çš„æ—¶å€™ä¹Ÿä¼šç”¨åˆ°ï¼Œæ¯”å¦‚æˆ‘åœ¨ç”µä¿¡å®žä¹ çš„æ—¶å€™ï¼Œä»–ä»¬æ¯ä¸€ä¸ªç½‘å£æ—è¾¹éƒ½è´´ç€è¿™å››ä¸ªå‚æ•°ï¼Œä½ è”ç½‘å¿…é¡»è¦é€‚ç”¨ä»–æä¾›çš„ä¸€ç³»åˆ—åœ°å€æ‰è¡Œã€‚å…¶å®žç»è¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œé€šä¿¡çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“å¯¹æ–¹çš„IPï¼ˆARPçŸ¥é“å¯¹æ–¹çš„MACåœ°å€ï¼‰ã€å­ç½‘æŽ©ç ï¼ˆç¡®å®šæ‰€åœ¨çš„å­ç½‘ï¼‰ã€é»˜è®¤ç½‘å…³ï¼ˆä¸åœ¨ä¸€ä¸ªå­ç½‘ï¼Œè¦é€šè¿‡ç½‘å…³å–è½¬å‘ã€è·¯ç”±ï¼‰ã€DNSæœåŠ¡å™¨ï¼ˆè§£æžåŸŸåä¸ºIPåœ°å€ï¼‰ã€‚ ä½†æ˜¯ï¼Œè¿™æ ·çš„è®¾ç½®å¾ˆä¸“ä¸šï¼Œæ™®é€šç”¨æˆ·æœ›è€Œç”Ÿç•ï¼Œè€Œä¸”å¦‚æžœä¸€å°ç”µè„‘çš„IPåœ°å€ä¿æŒä¸å˜ï¼Œå…¶ä»–ç”µè„‘å°±ä¸èƒ½ä½¿ç”¨è¿™ä¸ªåœ°å€ï¼Œä¸å¤Ÿçµæ´»ã€‚å‡ºäºŽè¿™ä¸¤ä¸ªåŽŸå› ï¼Œå¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨&quot;åŠ¨æ€IPåœ°å€ä¸Šç½‘&quot;ã€‚ 2.DHCPåè®® æ‰€è°“&quot;åŠ¨æ€IPåœ°å€&quot;ï¼ŒæŒ‡è®¡ç®—æœºå¼€æœºåŽï¼Œä¼šè‡ªåŠ¨åˆ†é…åˆ°ä¸€ä¸ªIPåœ°å€ï¼Œä¸ç”¨äººä¸ºè®¾å®šã€‚å®ƒä½¿ç”¨çš„åè®®å«åšDHCPåè®®ã€‚ è¿™ä¸ªåè®®è§„å®šï¼Œæ¯ä¸€ä¸ªå­ç½‘ç»œä¸­ï¼Œæœ‰ä¸€å°è®¡ç®—æœºè´Ÿè´£ç®¡ç†æœ¬ç½‘ç»œçš„æ‰€æœ‰IPåœ°å€ï¼Œå®ƒå«åš&quot;DHCPæœåŠ¡å™¨&quot;ã€‚æ–°çš„è®¡ç®—æœºåŠ å…¥ç½‘ç»œï¼Œå¿…é¡»å‘&quot;DHCPæœåŠ¡å™¨&quot;å‘é€ä¸€ä¸ª&quot;DHCPè¯·æ±‚&quot;æ•°æ®åŒ…ï¼Œç”³è¯·IPåœ°å€å’Œç›¸å…³çš„ç½‘ç»œå‚æ•°ã€‚ å‰é¢è¯´è¿‡ï¼Œå¦‚æžœä¸¤å°è®¡ç®—æœºåœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œå¿…é¡»çŸ¥é“å¯¹æ–¹çš„MACåœ°å€å’ŒIPåœ°å€ï¼Œæ‰èƒ½å‘é€æ•°æ®åŒ…ã€‚ä½†æ˜¯ï¼Œæ–°åŠ å…¥çš„è®¡ç®—æœºä¸çŸ¥é“DHCPæœåŠ¡å™¨çš„ä¸¤ä¸ªåœ°å€ï¼Œæ€Žä¹ˆå‘é€æ•°æ®åŒ…å‘¢ï¼Ÿ DHCPåè®®åšäº†ä¸€äº›å·§å¦™çš„è§„å®šã€‚ é¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œå»ºç«‹åœ¨UDPåè®®ä¹‹ä¸Šï¼Œæ‰€ä»¥æ•´ä¸ªæ•°æ®åŒ…æ˜¯è¿™æ ·çš„ï¼š ï¼ˆ1ï¼‰æœ€å‰é¢çš„&quot;ä»¥å¤ªç½‘æ ‡å¤´&quot;ï¼Œè®¾ç½®å‘å‡ºæ–¹ï¼ˆæœ¬æœºï¼‰çš„MACåœ°å€å’ŒæŽ¥æ”¶æ–¹ï¼ˆDHCPæœåŠ¡å™¨ï¼‰çš„MACåœ°å€ã€‚å‰è€…å°±æ˜¯æœ¬æœºç½‘å¡çš„MACåœ°å€ï¼ŒåŽè€…è¿™æ—¶ä¸çŸ¥é“ï¼Œå°±å¡«å…¥ä¸€ä¸ªå¹¿æ’­åœ°å€ï¼šFF-FF-FF-FF-FF-FFã€‚ ï¼ˆ2ï¼‰åŽé¢çš„&quot;IPæ ‡å¤´&quot;ï¼Œè®¾ç½®å‘å‡ºæ–¹çš„IPåœ°å€å’ŒæŽ¥æ”¶æ–¹çš„IPåœ°å€ã€‚è¿™æ—¶ï¼Œå¯¹äºŽè¿™ä¸¤è€…ï¼Œæœ¬æœºéƒ½ä¸çŸ¥é“ã€‚äºŽæ˜¯ï¼Œå‘å‡ºæ–¹çš„IPåœ°å€å°±è®¾ä¸º0.0.0.0ï¼ŒæŽ¥æ”¶æ–¹çš„IPåœ°å€è®¾ä¸º255.255.255.255ã€‚ ï¼ˆ3ï¼‰æœ€åŽçš„&quot;UDPæ ‡å¤´&quot;ï¼Œè®¾ç½®å‘å‡ºæ–¹çš„ç«¯å£å’ŒæŽ¥æ”¶æ–¹çš„ç«¯å£ã€‚è¿™ä¸€éƒ¨åˆ†æ˜¯DHCPåè®®è§„å®šå¥½çš„ï¼Œå‘å‡ºæ–¹æ˜¯68ç«¯å£ï¼ŒæŽ¥æ”¶æ–¹æ˜¯67ç«¯å£ã€‚ è¿™ä¸ªæ•°æ®åŒ…æž„é€ å®ŒæˆåŽï¼Œå°±å¯ä»¥å‘å‡ºäº†ã€‚ä»¥å¤ªç½‘æ˜¯å¹¿æ’­å‘é€ï¼ŒåŒä¸€ä¸ªå­ç½‘ç»œçš„æ¯å°è®¡ç®—æœºéƒ½æ”¶åˆ°äº†è¿™ä¸ªåŒ…ã€‚ å› ä¸ºæŽ¥æ”¶æ–¹çš„MACåœ°å€æ˜¯FF-FF-FF-FF-FF-FFï¼Œçœ‹ä¸å‡ºæ˜¯å‘ç»™è°çš„ï¼Œæ‰€ä»¥æ¯å°æ”¶åˆ°è¿™ä¸ªåŒ…çš„è®¡ç®—æœºï¼Œè¿˜å¿…é¡»åˆ†æžè¿™ä¸ªåŒ…çš„IPåœ°å€ï¼Œæ‰èƒ½ç¡®å®šæ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„ã€‚ å½“çœ‹åˆ°å‘å‡ºæ–¹IPåœ°å€æ˜¯0.0.0.0ï¼ŒæŽ¥æ”¶æ–¹æ˜¯255.255.255.255ï¼ŒäºŽæ˜¯DHCPæœåŠ¡å™¨çŸ¥é“&quot;è¿™ä¸ªåŒ…æ˜¯å‘ç»™æˆ‘çš„&quot;ï¼Œè€Œå…¶ä»–è®¡ç®—æœºå°±å¯ä»¥ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚ æŽ¥ä¸‹æ¥ï¼ŒDHCPæœåŠ¡å™¨è¯»å‡ºè¿™ä¸ªåŒ…çš„æ•°æ®å†…å®¹ï¼Œåˆ†é…å¥½IPåœ°å€ï¼Œå‘é€å›žåŽ»ä¸€ä¸ª&quot;DHCPå“åº”&quot;æ•°æ®åŒ…ã€‚ è¿™ä¸ªå“åº”åŒ…çš„ç»“æž„ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä»¥å¤ªç½‘æ ‡å¤´çš„MACåœ°å€æ˜¯åŒæ–¹çš„ç½‘å¡åœ°å€ï¼ŒIPæ ‡å¤´çš„IPåœ°å€æ˜¯DHCPæœåŠ¡å™¨çš„IPåœ°å€ï¼ˆå‘å‡ºæ–¹ï¼‰å’Œ255.255.255.255ï¼ˆæŽ¥æ”¶æ–¹ï¼‰ï¼ŒUDPæ ‡å¤´çš„ç«¯å£æ˜¯67ï¼ˆå‘å‡ºæ–¹ï¼‰å’Œ68ï¼ˆæŽ¥æ”¶æ–¹ï¼‰ï¼Œåˆ†é…ç»™è¯·æ±‚ç«¯çš„IPåœ°å€å’Œæœ¬ç½‘ç»œçš„å…·ä½“å‚æ•°åˆ™åŒ…å«åœ¨Dataéƒ¨åˆ†ã€‚ æ–°åŠ å…¥çš„è®¡ç®—æœºæ”¶åˆ°è¿™ä¸ªå“åº”åŒ…ï¼ŒäºŽæ˜¯å°±çŸ¥é“äº†è‡ªå·±çš„IPåœ°å€ã€å­ç½‘æŽ©ç ã€ç½‘å…³åœ°å€ã€DNSæœåŠ¡å™¨ç­‰ç­‰å‚æ•°ã€‚ åŠ¨æ€æ‹¿åˆ°æœ€æ ¸å¿ƒçš„å››ä¸ªå‚æ•°ï¼šè‡ªå·±çš„IPåœ°å€ã€å­ç½‘æŽ©ç ã€ç½‘å…³åœ°å€ã€DNSæœåŠ¡å™¨ï¼Œå°±å¯ä»¥è”ç½‘äº†ã€‚ 3.è®¿é—®googleçš„è¿‡ç¨‹ æˆ‘ä»¬å‡å®šï¼Œç»è¿‡ä¸Šä¸€èŠ‚çš„æ­¥éª¤ï¼Œç”¨æˆ·è®¾ç½®å¥½äº†è‡ªå·±çš„ç½‘ç»œå‚æ•°ï¼š æœ¬æœºçš„IPåœ°å€ï¼š192.168.1.100 å­ç½‘æŽ©ç ï¼š255.255.255.0 ç½‘å…³çš„IPåœ°å€ï¼š192.168.1.1 DNSçš„IPåœ°å€ï¼š8.8.8.8 ç„¶åŽä»–æ‰“å¼€æµè§ˆå™¨ï¼Œæƒ³è¦è®¿é—®Googleï¼Œåœ¨åœ°å€æ è¾“å…¥äº†ç½‘å€ï¼šwww.google.comã€‚ è¿™æ„å‘³ç€ï¼Œæµè§ˆå™¨è¦å‘Googleå‘é€ä¸€ä¸ªç½‘é¡µè¯·æ±‚çš„æ•°æ®åŒ…ã€‚ 3.1 DNSåè®® æˆ‘ä»¬çŸ¥é“ï¼Œå‘é€æ•°æ®åŒ…ï¼Œå¿…é¡»è¦çŸ¥é“å¯¹æ–¹çš„IPåœ°å€ã€‚ä½†æ˜¯ï¼ŒçŽ°åœ¨ï¼Œæˆ‘ä»¬åªçŸ¥é“ç½‘å€www.google.comï¼Œä¸çŸ¥é“å®ƒçš„IPåœ°å€ã€‚ DNSåè®®å¯ä»¥å¸®åŠ©æˆ‘ä»¬ï¼Œå°†è¿™ä¸ªç½‘å€è½¬æ¢æˆIPåœ°å€ã€‚å·²çŸ¥DNSæœåŠ¡å™¨ä¸º8.8.8.8ï¼ŒäºŽæ˜¯æˆ‘ä»¬å‘è¿™ä¸ªåœ°å€å‘é€ä¸€ä¸ªDNSæ•°æ®åŒ…ï¼ˆ53ç«¯å£ï¼‰ã€‚ ç„¶åŽï¼ŒDNSæœåŠ¡å™¨åšå‡ºå“åº”ï¼Œå‘Šè¯‰æˆ‘ä»¬Googleçš„IPåœ°å€æ˜¯172.194.72.105ã€‚äºŽæ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯¹æ–¹çš„IPåœ°å€ã€‚ 3.2 å­ç½‘æŽ©ç  æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆ¤æ–­ï¼Œè¿™ä¸ªIPåœ°å€æ˜¯ä¸æ˜¯åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œè¿™å°±è¦ç”¨åˆ°å­ç½‘æŽ©ç ã€‚ å·²çŸ¥å­ç½‘æŽ©ç æ˜¯255.255.255.0ï¼Œæœ¬æœºç”¨å®ƒå¯¹è‡ªå·±çš„IPåœ°å€192.168.1.100ï¼Œåšä¸€ä¸ªäºŒè¿›åˆ¶çš„ANDè¿ç®—ï¼ˆä¸¤ä¸ªæ•°ä½éƒ½ä¸º1ï¼Œç»“æžœä¸º1ï¼Œå¦åˆ™ä¸º0ï¼‰ï¼Œè®¡ç®—ç»“æžœä¸º192.168.1.0ï¼›ç„¶åŽå¯¹Googleçš„IPåœ°å€172.194.72.105ä¹Ÿåšä¸€ä¸ªANDè¿ç®—ï¼Œè®¡ç®—ç»“æžœä¸º172.194.72.0ã€‚è¿™ä¸¤ä¸ªç»“æžœä¸ç›¸ç­‰ï¼Œæ‰€ä»¥ç»“è®ºæ˜¯ï¼ŒGoogleä¸Žæœ¬æœºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ å› æ­¤ï¼Œæˆ‘ä»¬è¦å‘Googleå‘é€æ•°æ®åŒ…ï¼Œå¿…é¡»é€šè¿‡ç½‘å…³192.168.1.1è½¬å‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŽ¥æ”¶æ–¹çš„MACåœ°å€å°†æ˜¯ç½‘å…³çš„MACåœ°å€ã€‚ 3.3 åº”ç”¨å±‚åè®® æµè§ˆç½‘é¡µç”¨çš„æ˜¯HTTPåè®®ï¼Œå®ƒçš„æ•´ä¸ªæ•°æ®åŒ…æž„é€ æ˜¯è¿™æ ·çš„ï¼š HTTPéƒ¨åˆ†çš„å†…å®¹ï¼Œç±»ä¼¼äºŽä¸‹é¢è¿™æ ·ï¼š 123456789 GET / HTTP/1.1 Host: www.google.com Connection: keep-alive User-Agent: Mozilla/5.0 (Windows NT 6.1) ...... Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Encoding: gzip,deflate,sdch Accept-Language: zh-CN,zh;q=0.8 Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3 Cookie: ... ... æˆ‘ä»¬å‡å®šè¿™ä¸ªéƒ¨åˆ†çš„é•¿åº¦ä¸º4960å­—èŠ‚ï¼Œå®ƒä¼šè¢«åµŒåœ¨TCPæ•°æ®åŒ…ä¹‹ä¸­ã€‚ 3.4 TCPåè®® TCPæ•°æ®åŒ…éœ€è¦è®¾ç½®ç«¯å£ï¼ŒæŽ¥æ”¶æ–¹ï¼ˆGoogleï¼‰çš„HTTPç«¯å£é»˜è®¤æ˜¯80ï¼Œå‘é€æ–¹ï¼ˆæœ¬æœºï¼‰çš„ç«¯å£æ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„1024-65535ä¹‹é—´çš„æ•´æ•°ï¼Œå‡å®šä¸º51775ã€‚ TCPæ•°æ®åŒ…çš„æ ‡å¤´é•¿åº¦ä¸º20å­—èŠ‚ï¼ŒåŠ ä¸ŠåµŒå…¥HTTPçš„æ•°æ®åŒ…ï¼Œæ€»é•¿åº¦å˜ä¸º4980å­—èŠ‚ã€‚ 3.5 IPåè®® ç„¶åŽï¼ŒTCPæ•°æ®åŒ…å†åµŒå…¥IPæ•°æ®åŒ…ã€‚IPæ•°æ®åŒ…éœ€è¦è®¾ç½®åŒæ–¹çš„IPåœ°å€ï¼Œè¿™æ˜¯å·²çŸ¥çš„ï¼Œå‘é€æ–¹æ˜¯192.168.1.100ï¼ˆæœ¬æœºï¼‰ï¼ŒæŽ¥æ”¶æ–¹æ˜¯172.194.72.105ï¼ˆGoogleï¼‰ã€‚ IPæ•°æ®åŒ…çš„æ ‡å¤´é•¿åº¦ä¸º20å­—èŠ‚ï¼ŒåŠ ä¸ŠåµŒå…¥çš„TCPæ•°æ®åŒ…ï¼Œæ€»é•¿åº¦å˜ä¸º5000å­—èŠ‚ã€‚ 3.6 ä»¥å¤ªç½‘åè®® æœ€åŽï¼ŒIPæ•°æ®åŒ…åµŒå…¥ä»¥å¤ªç½‘æ•°æ®åŒ…ã€‚ä»¥å¤ªç½‘æ•°æ®åŒ…éœ€è¦è®¾ç½®åŒæ–¹çš„MACåœ°å€ï¼Œå‘é€æ–¹ä¸ºæœ¬æœºçš„ç½‘å¡MACåœ°å€ï¼ŒæŽ¥æ”¶æ–¹ä¸ºç½‘å…³192.168.1.1çš„MACåœ°å€ï¼ˆé€šè¿‡ARPåè®®å¾—åˆ°ï¼‰ã€‚ ä»¥å¤ªç½‘æ•°æ®åŒ…çš„æ•°æ®éƒ¨åˆ†ï¼Œæœ€å¤§é•¿åº¦ä¸º1500å­—èŠ‚ï¼Œè€ŒçŽ°åœ¨çš„IPæ•°æ®åŒ…é•¿åº¦ä¸º5000å­—èŠ‚ã€‚å› æ­¤ï¼ŒIPæ•°æ®åŒ…å¿…é¡»åˆ†å‰²æˆå››ä¸ªåŒ…ã€‚å› ä¸ºæ¯ä¸ªåŒ…éƒ½æœ‰è‡ªå·±çš„IPæ ‡å¤´ï¼ˆ20å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥å››ä¸ªåŒ…çš„IPæ•°æ®åŒ…çš„é•¿åº¦åˆ†åˆ«ä¸º1500ã€1500ã€1500ã€560ã€‚ 3.7 æœåŠ¡å™¨å“åº” ç»è¿‡å¤šä¸ªç½‘å…³çš„è½¬å‘ï¼ŒGoogleçš„æœåŠ¡å™¨172.194.72.105ï¼Œæ”¶åˆ°äº†è¿™å››ä¸ªä»¥å¤ªç½‘æ•°æ®åŒ…ã€‚ æ ¹æ®IPæ ‡å¤´çš„åºå·ï¼ŒGoogleå°†å››ä¸ªåŒ…æ‹¼èµ·æ¥ï¼Œå–å‡ºå®Œæ•´çš„TCPæ•°æ®åŒ…ï¼Œç„¶åŽè¯»å‡ºé‡Œé¢çš„&quot;HTTPè¯·æ±‚&quot;ï¼ŒæŽ¥ç€åšå‡º&quot;HTTPå“åº”&quot;ï¼Œå†ç”¨TCPåè®®å‘å›žæ¥ã€‚ æœ¬æœºæ”¶åˆ°HTTPå“åº”ä»¥åŽï¼Œå°±å¯ä»¥å°†ç½‘é¡µæ˜¾ç¤ºå‡ºæ¥ï¼Œå®Œæˆä¸€æ¬¡ç½‘ç»œé€šä¿¡ã€‚ æ•´ç†è‡ªï¼šhttp://www.ruanyifeng.com/blog/2012/06/internet_protocol_suite_part_ii.html]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Žä¸‹åˆ°ä¸Šçœ‹äº”å±‚æ¨¡åž‹]]></title>
    <url>%2F2019%2F01%2F17%2Fnetwork%2F1.%E4%BB%8E%E4%B8%8B%E5%88%B0%E4%B8%8A%E7%9C%8B%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯è®¡ç®—æœºç½‘ç»œç›¸å…³çš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚è¦æƒ³äº†è§£HTTPåè®®ï¼Œå¿…ç„¶è¦ä»Žæœ€åŸºæœ¬çš„è®¡ç®—æœºç½‘ç»œçŸ¥è¯†å¼€å§‹å…¥æ‰‹ã€‚æœ¬ç¯‡æ–‡ç« ä»Žä¸‹åˆ°ä¸Šå…·ä½“ä»‹ç»äº”å±‚ç»å…¸æ¨¡åž‹ï¼Œæžé€Ÿå…¥é—¨è®¡ç®—æœºç½‘ç»œã€‚ ç»å…¸äº”å±‚æ¨¡åž‹ ä¸‹é¢æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å„å±‚åšçš„äº‹æƒ…ï¼ 1.ç‰©ç†å±‚ ç”µè„‘è¦ç»„ç½‘ï¼Œç¬¬ä¸€ä»¶äº‹è¦å¹²ä»€ä¹ˆï¼Ÿå½“ç„¶æ˜¯å…ˆæŠŠç”µè„‘è¿žèµ·æ¥ï¼Œå¯ä»¥ç”¨å…‰ç¼†ã€ç”µç¼†ã€åŒç»žçº¿ã€æ— çº¿ç”µæ³¢ç­‰æ–¹å¼ã€‚ è¿™å°±å«åš&quot;ç‰©ç†å±‚&quot;ï¼Œå®ƒå°±æ˜¯æŠŠç”µè„‘è¿žæŽ¥èµ·æ¥çš„ç‰©ç†æ‰‹æ®µã€‚å®ƒä¸»è¦è§„å®šäº†ç½‘ç»œçš„ä¸€äº›ç”µæ°”ç‰¹æ€§ï¼Œä½œç”¨æ˜¯è´Ÿè´£ä¼ é€0å’Œ1çš„ç”µä¿¡å·ã€‚ 2.æ•°æ®é“¾è·¯å±‚ å•çº¯çš„0å’Œ1æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå¿…é¡»è§„å®šè§£è¯»æ–¹å¼ï¼šå¤šå°‘ä¸ªç”µä¿¡å·ç®—ä¸€ç»„ï¼Ÿæ¯ä¸ªä¿¡å·ä½æœ‰ä½•æ„ä¹‰ï¼Ÿ è¿™å°±æ˜¯&quot;é“¾æŽ¥å±‚&quot;çš„åŠŸèƒ½ï¼Œå®ƒåœ¨&quot;å®žä½“å±‚&quot;çš„ä¸Šæ–¹ï¼Œç¡®å®šäº†0å’Œ1çš„åˆ†ç»„æ–¹å¼ã€‚ 2.1 ä»¥å¤ªç½‘åè®® æ—©æœŸçš„æ—¶å€™ï¼Œæ¯å®¶å…¬å¸éƒ½æœ‰è‡ªå·±çš„ç”µä¿¡å·åˆ†ç»„æ–¹å¼ã€‚é€æ¸åœ°ï¼Œä¸€ç§å«åš&quot;ä»¥å¤ªç½‘&quot;ï¼ˆEthernetï¼‰çš„åè®®ï¼Œå æ®äº†ä¸»å¯¼åœ°ä½ã€‚ ä»¥å¤ªç½‘è§„å®šï¼Œä¸€ç»„ç”µä¿¡å·æž„æˆä¸€ä¸ªæ•°æ®åŒ…ï¼Œå«åš&quot;å¸§&quot;ï¼ˆFrameï¼‰ã€‚æ¯ä¸€å¸§åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šæ ‡å¤´ï¼ˆHeadï¼‰å’Œæ•°æ®ï¼ˆDataï¼‰ã€‚ &quot;æ ‡å¤´&quot;åŒ…å«æ•°æ®åŒ…çš„ä¸€äº›è¯´æ˜Žé¡¹ï¼Œæ¯”å¦‚å‘é€è€…ã€æŽ¥å—è€…ã€æ•°æ®ç±»åž‹ç­‰ç­‰ï¼›&quot;æ•°æ®&quot;åˆ™æ˜¯æ•°æ®åŒ…çš„å…·ä½“å†…å®¹ã€‚ &quot;æ ‡å¤´&quot;çš„é•¿åº¦ï¼Œå›ºå®šä¸º18å­—èŠ‚ã€‚&quot;æ•°æ®&quot;çš„é•¿åº¦ï¼Œæœ€çŸ­ä¸º46å­—èŠ‚ï¼Œæœ€é•¿ä¸º1500å­—èŠ‚ã€‚å› æ­¤ï¼Œæ•´ä¸ª&quot;å¸§&quot;æœ€çŸ­ä¸º64å­—èŠ‚ï¼Œæœ€é•¿ä¸º1518å­—èŠ‚ã€‚å¦‚æžœæ•°æ®å¾ˆé•¿ï¼Œå°±å¿…é¡»åˆ†å‰²æˆå¤šä¸ªå¸§è¿›è¡Œå‘é€ã€‚ 2.2 MACåœ°å€ ä¸Šé¢æåˆ°ï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…çš„&quot;æ ‡å¤´&quot;ï¼ŒåŒ…å«äº†å‘é€è€…å’ŒæŽ¥å—è€…çš„ä¿¡æ¯ã€‚é‚£ä¹ˆï¼Œå‘é€è€…å’ŒæŽ¥å—è€…æ˜¯å¦‚ä½•æ ‡è¯†å‘¢ï¼Ÿ ä»¥å¤ªç½‘è§„å®šï¼Œè¿žå…¥ç½‘ç»œçš„æ‰€æœ‰è®¾å¤‡ï¼Œéƒ½å¿…é¡»å…·æœ‰&quot;ç½‘å¡&quot;æŽ¥å£ã€‚æ•°æ®åŒ…å¿…é¡»æ˜¯ä»Žä¸€å—ç½‘å¡ï¼Œä¼ é€åˆ°å¦ä¸€å—ç½‘å¡ã€‚ç½‘å¡çš„åœ°å€ï¼Œå°±æ˜¯æ•°æ®åŒ…çš„å‘é€åœ°å€å’ŒæŽ¥æ”¶åœ°å€ï¼Œè¿™å«åšMACåœ°å€ã€‚ æ¯å—ç½‘å¡å‡ºåŽ‚çš„æ—¶å€™ï¼Œéƒ½æœ‰ä¸€ä¸ªå…¨ä¸–ç•Œç‹¬ä¸€æ— äºŒçš„MACåœ°å€ï¼Œé•¿åº¦æ˜¯48ä¸ªäºŒè¿›åˆ¶ä½ï¼Œé€šå¸¸ç”¨12ä¸ªåå…­è¿›åˆ¶æ•°è¡¨ç¤ºã€‚ å‰6ä¸ªåå…­è¿›åˆ¶æ•°æ˜¯åŽ‚å•†ç¼–å·ï¼ŒåŽ6ä¸ªæ˜¯è¯¥åŽ‚å•†çš„ç½‘å¡æµæ°´å·ã€‚æœ‰äº†MACåœ°å€ï¼Œå°±å¯ä»¥å®šä½ç½‘å¡å’Œæ•°æ®åŒ…çš„è·¯å¾„äº†ã€‚ 2.3 å¹¿æ’­ å®šä¹‰åœ°å€åªæ˜¯ç¬¬ä¸€æ­¥ï¼ŒåŽé¢è¿˜æœ‰æ›´å¤šçš„æ­¥éª¤ã€‚ é¦–å…ˆï¼Œä¸€å—ç½‘å¡æ€Žä¹ˆä¼šçŸ¥é“å¦ä¸€å—ç½‘å¡çš„MACåœ°å€ï¼Ÿ å›žç­”æ˜¯æœ‰ä¸€ç§ARPåè®®ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸‹é¢ä»‹ç»ARPã€‚ å…¶æ¬¡ï¼Œå°±ç®—æœ‰äº†MACåœ°å€ï¼Œç³»ç»Ÿæ€Žæ ·æ‰èƒ½æŠŠæ•°æ®åŒ…å‡†ç¡®é€åˆ°æŽ¥æ”¶æ–¹ï¼Ÿ å›žç­”æ˜¯ä»¥å¤ªç½‘é‡‡ç”¨äº†ä¸€ç§å¾ˆ&quot;åŽŸå§‹&quot;çš„æ–¹å¼ï¼Œå®ƒä¸æ˜¯æŠŠæ•°æ®åŒ…å‡†ç¡®é€åˆ°æŽ¥æ”¶æ–¹ï¼Œè€Œæ˜¯å‘æœ¬ç½‘ç»œå†…æ‰€æœ‰è®¡ç®—æœºå‘é€ï¼Œè®©æ¯å°è®¡ç®—æœºè‡ªå·±åˆ¤æ–­ï¼Œæ˜¯å¦ä¸ºæŽ¥æ”¶æ–¹ã€‚ ä¸Šå›¾ä¸­ï¼Œ1å·è®¡ç®—æœºå‘2å·è®¡ç®—æœºå‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼ŒåŒä¸€ä¸ªå­ç½‘ç»œçš„3å·ã€4å·ã€5å·è®¡ç®—æœºéƒ½ä¼šæ”¶åˆ°è¿™ä¸ªåŒ…ã€‚å®ƒä»¬è¯»å–è¿™ä¸ªåŒ…çš„&quot;æ ‡å¤´&quot;ï¼Œæ‰¾åˆ°æŽ¥æ”¶æ–¹çš„MACåœ°å€ï¼Œç„¶åŽä¸Žè‡ªèº«çš„MACåœ°å€ç›¸æ¯”è¾ƒï¼Œå¦‚æžœä¸¤è€…ç›¸åŒï¼Œå°±æŽ¥å—è¿™ä¸ªåŒ…ï¼Œåšè¿›ä¸€æ­¥å¤„ç†ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚è¿™ç§å‘é€æ–¹å¼å°±å«åš&quot;å¹¿æ’­&quot;ï¼ˆbroadcastingï¼‰ã€‚ æœ‰äº†æ•°æ®åŒ…çš„å®šä¹‰ã€ç½‘å¡çš„MACåœ°å€ã€å¹¿æ’­çš„å‘é€æ–¹å¼ï¼Œ&quot;é“¾æŽ¥å±‚&quot;å°±å¯ä»¥åœ¨å¤šå°è®¡ç®—æœºä¹‹é—´ä¼ é€æ•°æ®äº†ã€‚ 3.ç½‘ç»œå±‚ ä»¥å¤ªç½‘åè®®ï¼Œä¾é MACåœ°å€å‘é€æ•°æ®ã€‚ç†è®ºä¸Šï¼Œå•å•ä¾é MACåœ°å€ï¼Œä¸Šæµ·çš„ç½‘å¡å°±å¯ä»¥æ‰¾åˆ°æ´›æ‰çŸ¶çš„ç½‘å¡äº†ï¼ŒæŠ€æœ¯ä¸Šæ˜¯å¯ä»¥å®žçŽ°çš„ã€‚ ä½†æ˜¯ï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªé‡å¤§çš„ç¼ºç‚¹ã€‚ä»¥å¤ªç½‘é‡‡ç”¨å¹¿æ’­æ–¹å¼å‘é€æ•°æ®åŒ…ï¼Œæ‰€æœ‰æˆå‘˜äººæ‰‹ä¸€&quot;åŒ…&quot;ï¼Œä¸ä»…æ•ˆçŽ‡ä½Žï¼Œè€Œä¸”å±€é™åœ¨å‘é€è€…æ‰€åœ¨çš„å­ç½‘ç»œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœä¸¤å°è®¡ç®—æœºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œå¹¿æ’­æ˜¯ä¼ ä¸è¿‡åŽ»çš„ã€‚è¿™ç§è®¾è®¡æ˜¯åˆç†çš„ï¼Œå¦åˆ™äº’è”ç½‘ä¸Šæ¯ä¸€å°è®¡ç®—æœºéƒ½ä¼šæ”¶åˆ°æ‰€æœ‰åŒ…ï¼Œé‚£ä¼šå¼•èµ·ç¾éš¾ã€‚ äº’è”ç½‘æ˜¯æ— æ•°å­ç½‘ç»œå…±åŒç»„æˆçš„ä¸€ä¸ªå·¨åž‹ç½‘ç»œï¼Œå¾ˆåƒæƒ³è±¡ä¸Šæµ·å’Œæ´›æ‰çŸ¶çš„ç”µè„‘ä¼šåœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œè¿™å‡ ä¹Žæ˜¯ä¸å¯èƒ½çš„ã€‚ å› æ­¤ï¼Œå¿…é¡»æ‰¾åˆ°ä¸€ç§æ–¹æ³•ï¼Œèƒ½å¤ŸåŒºåˆ†å“ªäº›MACåœ°å€å±žäºŽåŒä¸€ä¸ªå­ç½‘ç»œï¼Œå“ªäº›ä¸æ˜¯ã€‚å¦‚æžœæ˜¯åŒä¸€ä¸ªå­ç½‘ç»œï¼Œå°±é‡‡ç”¨å¹¿æ’­æ–¹å¼å‘é€ï¼Œå¦åˆ™å°±é‡‡ç”¨&quot;è·¯ç”±&quot;æ–¹å¼å‘é€ã€‚ï¼ˆ&quot;è·¯ç”±&quot;çš„æ„æ€ï¼Œå°±æ˜¯æŒ‡å¦‚ä½•å‘ä¸åŒçš„å­ç½‘ç»œåˆ†å‘æ•°æ®åŒ…ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¸»é¢˜ï¼Œæœ¬æ–‡ä¸æ¶‰åŠã€‚ï¼‰é—æ†¾çš„æ˜¯ï¼ŒMACåœ°å€æœ¬èº«æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚å®ƒåªä¸ŽåŽ‚å•†æœ‰å…³ï¼Œä¸Žæ‰€å¤„ç½‘ç»œæ— å…³ã€‚ è¿™å°±å¯¼è‡´äº†&quot;ç½‘ç»œå±‚&quot;çš„è¯žç”Ÿã€‚å®ƒçš„ä½œç”¨æ˜¯å¼•è¿›ä¸€å¥—æ–°çš„åœ°å€ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤ŸåŒºåˆ†ä¸åŒçš„è®¡ç®—æœºæ˜¯å¦å±žäºŽåŒä¸€ä¸ªå­ç½‘ç»œã€‚è¿™å¥—åœ°å€å°±å«åš&quot;ç½‘ç»œåœ°å€&quot;ï¼Œç®€ç§°&quot;ç½‘å€&quot;ã€‚ äºŽæ˜¯ï¼Œ&quot;ç½‘ç»œå±‚&quot;å‡ºçŽ°ä»¥åŽï¼Œæ¯å°è®¡ç®—æœºæœ‰äº†ä¸¤ç§åœ°å€ï¼Œä¸€ç§æ˜¯MACåœ°å€ï¼Œå¦ä¸€ç§æ˜¯ç½‘ç»œåœ°å€ã€‚ä¸¤ç§åœ°å€ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ï¼ŒMACåœ°å€æ˜¯ç»‘å®šåœ¨ç½‘å¡ä¸Šçš„ï¼Œç½‘ç»œåœ°å€åˆ™æ˜¯ç®¡ç†å‘˜åˆ†é…çš„ï¼Œå®ƒä»¬åªæ˜¯éšæœºç»„åˆåœ¨ä¸€èµ·ã€‚ ç½‘ç»œåœ°å€å¸®åŠ©æˆ‘ä»¬ç¡®å®šè®¡ç®—æœºæ‰€åœ¨çš„å­ç½‘ç»œï¼ŒMACåœ°å€åˆ™å°†æ•°æ®åŒ…é€åˆ°è¯¥å­ç½‘ç»œä¸­çš„ç›®æ ‡ç½‘å¡ã€‚å› æ­¤ï¼Œä»Žé€»è¾‘ä¸Šå¯ä»¥æŽ¨æ–­ï¼Œå¿…å®šæ˜¯å…ˆå¤„ç†ç½‘ç»œåœ°å€ï¼Œç„¶åŽå†å¤„ç†MACåœ°å€ã€‚ 3.1 IPåè®® è§„å®šç½‘ç»œåœ°å€çš„åè®®ï¼Œå«åšIPåè®®ã€‚å®ƒæ‰€å®šä¹‰çš„åœ°å€ï¼Œå°±è¢«ç§°ä¸ºIPåœ°å€ã€‚ ç›®å‰ï¼Œå¹¿æ³›é‡‡ç”¨çš„æ˜¯IPåè®®ç¬¬å››ç‰ˆï¼Œç®€ç§°IPv4ã€‚è¿™ä¸ªç‰ˆæœ¬è§„å®šï¼Œç½‘ç»œåœ°å€ç”±32ä¸ªäºŒè¿›åˆ¶ä½ç»„æˆã€‚ ä¹ æƒ¯ä¸Šï¼Œæˆ‘ä»¬ç”¨åˆ†æˆå››æ®µçš„åè¿›åˆ¶æ•°è¡¨ç¤ºIPåœ°å€ï¼Œä»Ž0.0.0.0ä¸€ç›´åˆ°255.255.255.255ã€‚ äº’è”ç½‘ä¸Šçš„æ¯ä¸€å°è®¡ç®—æœºï¼Œéƒ½ä¼šåˆ†é…åˆ°ä¸€ä¸ªIPåœ°å€ã€‚è¿™ä¸ªåœ°å€åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰ä¸€éƒ¨åˆ†ä»£è¡¨ç½‘ç»œï¼ŒåŽä¸€éƒ¨åˆ†ä»£è¡¨ä¸»æœºã€‚æ¯”å¦‚ï¼ŒIPåœ°å€172.16.254.1ï¼Œè¿™æ˜¯ä¸€ä¸ª32ä½çš„åœ°å€ï¼Œå‡å®šå®ƒçš„ç½‘ç»œéƒ¨åˆ†æ˜¯å‰24ä½ï¼ˆ172.16.254ï¼‰ï¼Œé‚£ä¹ˆä¸»æœºéƒ¨åˆ†å°±æ˜¯åŽ8ä½ï¼ˆæœ€åŽçš„é‚£ä¸ª1ï¼‰ã€‚å¤„äºŽåŒä¸€ä¸ªå­ç½‘ç»œçš„ç”µè„‘ï¼Œå®ƒä»¬IPåœ°å€çš„ç½‘ç»œéƒ¨åˆ†å¿…å®šæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´172.16.254.2åº”è¯¥ä¸Ž172.16.254.1å¤„åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ ä½†æ˜¯ï¼Œé—®é¢˜åœ¨äºŽå•å•ä»ŽIPåœ°å€ï¼Œæˆ‘ä»¬æ— æ³•åˆ¤æ–­ç½‘ç»œéƒ¨åˆ†ã€‚è¿˜æ˜¯ä»¥172.16.254.1ä¸ºä¾‹ï¼Œå®ƒçš„ç½‘ç»œéƒ¨åˆ†ï¼Œåˆ°åº•æ˜¯å‰24ä½ï¼Œè¿˜æ˜¯å‰16ä½ï¼Œç”šè‡³å‰28ä½ï¼Œä»ŽIPåœ°å€ä¸Šæ˜¯çœ‹ä¸å‡ºæ¥çš„ã€‚ é‚£ä¹ˆï¼Œæ€Žæ ·æ‰èƒ½ä»ŽIPåœ°å€ï¼Œåˆ¤æ–­ä¸¤å°è®¡ç®—æœºæ˜¯å¦å±žäºŽåŒä¸€ä¸ªå­ç½‘ç»œå‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ°å¦ä¸€ä¸ªå‚æ•°&quot;å­ç½‘æŽ©ç &quot;ï¼ˆsubnet maskï¼‰ã€‚ æ‰€è°“&quot;å­ç½‘æŽ©ç &quot;ï¼Œå°±æ˜¯è¡¨ç¤ºå­ç½‘ç»œç‰¹å¾çš„ä¸€ä¸ªå‚æ•°ã€‚å®ƒåœ¨å½¢å¼ä¸Šç­‰åŒäºŽIPåœ°å€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª32ä½äºŒè¿›åˆ¶æ•°å­—ï¼Œå®ƒçš„ç½‘ç»œéƒ¨åˆ†å…¨éƒ¨ä¸º1ï¼Œä¸»æœºéƒ¨åˆ†å…¨éƒ¨ä¸º0ã€‚æ¯”å¦‚ï¼ŒIPåœ°å€172.16.254.1ï¼Œå¦‚æžœå·²çŸ¥ç½‘ç»œéƒ¨åˆ†æ˜¯å‰24ä½ï¼Œä¸»æœºéƒ¨åˆ†æ˜¯åŽ8ä½ï¼Œé‚£ä¹ˆå­ç½‘ç»œæŽ©ç å°±æ˜¯11111111.11111111.11111111.00000000ï¼Œå†™æˆåè¿›åˆ¶å°±æ˜¯255.255.255.0ã€‚ çŸ¥é“&quot;å­ç½‘æŽ©ç &quot;ï¼Œæˆ‘ä»¬å°±èƒ½åˆ¤æ–­ï¼Œä»»æ„ä¸¤ä¸ªIPåœ°å€æ˜¯å¦å¤„åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚æ–¹æ³•æ˜¯å°†ä¸¤ä¸ªIPåœ°å€ä¸Žå­ç½‘æŽ©ç åˆ†åˆ«è¿›è¡ŒANDè¿ç®—ï¼ˆä¸¤ä¸ªæ•°ä½éƒ½ä¸º1ï¼Œè¿ç®—ç»“æžœä¸º1ï¼Œå¦åˆ™ä¸º0ï¼‰ï¼Œç„¶åŽæ¯”è¾ƒç»“æžœæ˜¯å¦ç›¸åŒï¼Œå¦‚æžœæ˜¯çš„è¯ï¼Œå°±è¡¨æ˜Žå®ƒä»¬åœ¨åŒä¸€ä¸ªå­ç½‘ç»œä¸­ï¼Œå¦åˆ™å°±ä¸æ˜¯ã€‚ æ¯”å¦‚ï¼Œå·²çŸ¥IPåœ°å€172.16.254.1å’Œ172.16.254.233çš„å­ç½‘æŽ©ç éƒ½æ˜¯255.255.255.0ï¼Œè¯·é—®å®ƒä»¬æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Ÿä¸¤è€…ä¸Žå­ç½‘æŽ©ç åˆ†åˆ«è¿›è¡ŒANDè¿ç®—ï¼Œç»“æžœéƒ½æ˜¯172.16.254.0ï¼Œå› æ­¤å®ƒä»¬åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ æ€»ç»“ä¸€ä¸‹ï¼ŒIPåè®®çš„ä½œç”¨ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ä¸ºæ¯ä¸€å°è®¡ç®—æœºåˆ†é…IPåœ°å€ï¼Œå¦ä¸€ä¸ªæ˜¯ç¡®å®šå“ªäº›åœ°å€åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚ 3.2 IPæ•°æ®åŒ… æ ¹æ®IPåè®®å‘é€çš„æ•°æ®ï¼Œå°±å«åšIPæ•°æ®åŒ…ã€‚ä¸éš¾æƒ³è±¡ï¼Œå…¶ä¸­å¿…å®šåŒ…æ‹¬IPåœ°å€ä¿¡æ¯ã€‚ ä½†æ˜¯å‰é¢è¯´è¿‡ï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…åªåŒ…å«MACåœ°å€ï¼Œå¹¶æ²¡æœ‰IPåœ°å€çš„æ ä½ã€‚é‚£ä¹ˆæ˜¯å¦éœ€è¦ä¿®æ”¹æ•°æ®å®šä¹‰ï¼Œå†æ·»åŠ ä¸€ä¸ªæ ä½å‘¢ï¼Ÿ å›žç­”æ˜¯ä¸éœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠIPæ•°æ®åŒ…ç›´æŽ¥æ”¾è¿›ä»¥å¤ªç½‘æ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ï¼Œå› æ­¤å®Œå…¨ä¸ç”¨ä¿®æ”¹ä»¥å¤ªç½‘çš„è§„æ ¼ã€‚è¿™å°±æ˜¯äº’è”ç½‘åˆ†å±‚ç»“æž„çš„å¥½å¤„ï¼šä¸Šå±‚çš„å˜åŠ¨å®Œå…¨ä¸æ¶‰åŠä¸‹å±‚çš„ç»“æž„ã€‚ å…·ä½“æ¥è¯´ï¼ŒIPæ•°æ®åŒ…ä¹Ÿåˆ†ä¸º&quot;æ ‡å¤´&quot;å’Œ&quot;æ•°æ®&quot;ä¸¤ä¸ªéƒ¨åˆ†ã€‚&quot;æ ‡å¤´&quot;éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬ç‰ˆæœ¬ã€é•¿åº¦ã€IPåœ°å€ç­‰ä¿¡æ¯ï¼Œ&quot;æ•°æ®&quot;éƒ¨åˆ†åˆ™æ˜¯IPæ•°æ®åŒ…çš„å…·ä½“å†…å®¹ã€‚å®ƒæ”¾è¿›ä»¥å¤ªç½‘æ•°æ®åŒ…åŽï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…å°±å˜æˆäº†ä¸‹é¢è¿™æ ·ã€‚ IPæ•°æ®åŒ…çš„&quot;æ ‡å¤´&quot;éƒ¨åˆ†çš„é•¿åº¦ä¸º20ä¸ªå­—èŠ‚ï¼Œæ•´ä¸ªæ•°æ®åŒ…çš„æ€»é•¿åº¦æœ€å¤§ä¸º65,535å­—èŠ‚ã€‚å› æ­¤ï¼Œç†è®ºä¸Šï¼Œä¸€ä¸ªIPæ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ï¼Œæœ€é•¿ä¸º65,515å­—èŠ‚ã€‚å‰é¢è¯´è¿‡ï¼Œä»¥å¤ªç½‘æ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ï¼Œæœ€é•¿åªæœ‰1500å­—èŠ‚ã€‚å› æ­¤ï¼Œå¦‚æžœIPæ•°æ®åŒ…è¶…è¿‡äº†1500å­—èŠ‚ï¼Œå®ƒå°±éœ€è¦åˆ†å‰²æˆå‡ ä¸ªä»¥å¤ªç½‘æ•°æ®åŒ…ï¼Œåˆ†å¼€å‘é€äº†ã€‚ 3.3 ARPåè®® å…³äºŽ&quot;ç½‘ç»œå±‚&quot;ï¼Œè¿˜æœ‰æœ€åŽä¸€ç‚¹éœ€è¦è¯´æ˜Žã€‚ å› ä¸ºIPæ•°æ®åŒ…æ˜¯æ”¾åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…é‡Œå‘é€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åŒæ—¶çŸ¥é“ä¸¤ä¸ªåœ°å€ï¼Œä¸€ä¸ªæ˜¯å¯¹æ–¹çš„MACåœ°å€ï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹æ–¹çš„IPåœ°å€ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹æ–¹çš„IPåœ°å€æ˜¯å·²çŸ¥çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å®ƒçš„MACåœ°å€ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œèƒ½å¤Ÿä»ŽIPåœ°å€å¾—åˆ°MACåœ°å€ã€‚ è¿™é‡Œåˆå¯ä»¥åˆ†æˆä¸¤ç§æƒ…å†µã€‚ç¬¬ä¸€ç§æƒ…å†µï¼Œå¦‚æžœä¸¤å°ä¸»æœºä¸åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œé‚£ä¹ˆäº‹å®žä¸Šæ²¡æœ‰åŠžæ³•å¾—åˆ°å¯¹æ–¹çš„MACåœ°å€ï¼Œåªèƒ½æŠŠæ•°æ®åŒ…ä¼ é€åˆ°ä¸¤ä¸ªå­ç½‘ç»œè¿žæŽ¥å¤„çš„&quot;ç½‘å…³&quot;ï¼ˆgatewayï¼‰ï¼Œè®©ç½‘å…³åŽ»å¤„ç†ã€‚ ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æžœä¸¤å°ä¸»æœºåœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ARPåè®®ï¼Œå¾—åˆ°å¯¹æ–¹çš„MACåœ°å€ã€‚ARPåè®®ä¹Ÿæ˜¯å‘å‡ºä¸€ä¸ªæ•°æ®åŒ…ï¼ˆåŒ…å«åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…ä¸­ï¼‰ï¼Œå…¶ä¸­åŒ…å«å®ƒæ‰€è¦æŸ¥è¯¢ä¸»æœºçš„IPåœ°å€ï¼Œåœ¨å¯¹æ–¹çš„MACåœ°å€è¿™ä¸€æ ï¼Œå¡«çš„æ˜¯FF:FF:FF:FF:FF:FFï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª&quot;å¹¿æ’­&quot;åœ°å€ã€‚å®ƒæ‰€åœ¨å­ç½‘ç»œçš„æ¯ä¸€å°ä¸»æœºï¼Œéƒ½ä¼šæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…ï¼Œä»Žä¸­å–å‡ºIPåœ°å€ï¼Œä¸Žè‡ªèº«çš„IPåœ°å€è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æžœä¸¤è€…ç›¸åŒï¼Œéƒ½åšå‡ºå›žå¤ï¼Œå‘å¯¹æ–¹æŠ¥å‘Šè‡ªå·±çš„MACåœ°å€ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚ æ€»ä¹‹ï¼Œæœ‰äº†ARPåè®®ä¹‹åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°åŒä¸€ä¸ªå­ç½‘ç»œå†…çš„ä¸»æœºMACåœ°å€ï¼Œå¯ä»¥æŠŠæ•°æ®åŒ…å‘é€åˆ°ä»»æ„ä¸€å°ä¸»æœºä¹‹ä¸Šäº†ã€‚ 4. ä¼ è¾“å±‚ æœ‰äº†MACåœ°å€å’ŒIPåœ°å€ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åœ¨äº’è”ç½‘ä¸Šä»»æ„ä¸¤å°ä¸»æœºä¸Šå»ºç«‹é€šä¿¡ã€‚ æŽ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼ŒåŒä¸€å°ä¸»æœºä¸Šæœ‰è®¸å¤šç¨‹åºéƒ½éœ€è¦ç”¨åˆ°ç½‘ç»œï¼Œæ¯”å¦‚ï¼Œä½ ä¸€è¾¹æµè§ˆç½‘é¡µï¼Œä¸€è¾¹ä¸Žæœ‹å‹åœ¨çº¿èŠå¤©ã€‚å½“ä¸€ä¸ªæ•°æ®åŒ…ä»Žäº’è”ç½‘ä¸Šå‘æ¥çš„æ—¶å€™ï¼Œä½ æ€Žä¹ˆçŸ¥é“ï¼Œå®ƒæ˜¯è¡¨ç¤ºç½‘é¡µçš„å†…å®¹ï¼Œè¿˜æ˜¯è¡¨ç¤ºåœ¨çº¿èŠå¤©çš„å†…å®¹ï¼Ÿ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°æ®åŒ…åˆ°åº•ä¾›å“ªä¸ªç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ä½¿ç”¨ã€‚è¿™ä¸ªå‚æ•°å°±å«åš&quot;ç«¯å£&quot;ï¼ˆportï¼‰ï¼Œå®ƒå…¶å®žæ˜¯æ¯ä¸€ä¸ªä½¿ç”¨ç½‘å¡çš„ç¨‹åºçš„ç¼–å·ã€‚æ¯ä¸ªæ•°æ®åŒ…éƒ½å‘åˆ°ä¸»æœºçš„ç‰¹å®šç«¯å£ï¼Œæ‰€ä»¥ä¸åŒçš„ç¨‹åºå°±èƒ½å–åˆ°è‡ªå·±æ‰€éœ€è¦çš„æ•°æ®ã€‚ &quot;ç«¯å£&quot;æ˜¯0åˆ°65535ä¹‹é—´çš„ä¸€ä¸ªæ•´æ•°ï¼Œæ­£å¥½16ä¸ªäºŒè¿›åˆ¶ä½ã€‚0åˆ°1023çš„ç«¯å£è¢«ç³»ç»Ÿå ç”¨ï¼Œç”¨æˆ·åªèƒ½é€‰ç”¨å¤§äºŽ1023çš„ç«¯å£ã€‚ä¸ç®¡æ˜¯æµè§ˆç½‘é¡µè¿˜æ˜¯åœ¨çº¿èŠå¤©ï¼Œåº”ç”¨ç¨‹åºä¼šéšæœºé€‰ç”¨ä¸€ä¸ªç«¯å£ï¼Œç„¶åŽä¸ŽæœåŠ¡å™¨çš„ç›¸åº”ç«¯å£è”ç³»ã€‚ &quot;ä¼ è¾“å±‚&quot;çš„åŠŸèƒ½ï¼Œå°±æ˜¯å»ºç«‹&quot;ç«¯å£åˆ°ç«¯å£&quot;çš„é€šä¿¡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œâ€œç½‘ç»œå±‚&quot;çš„åŠŸèƒ½æ˜¯å»ºç«‹&quot;ä¸»æœºåˆ°ä¸»æœº&quot;çš„é€šä¿¡ã€‚åªè¦ç¡®å®šä¸»æœºå’Œç«¯å£ï¼Œæˆ‘ä»¬å°±èƒ½å®žçŽ°ç¨‹åºä¹‹é—´çš„äº¤æµã€‚å› æ­¤ï¼ŒUnixç³»ç»Ÿå°±æŠŠä¸»æœº+ç«¯å£ï¼Œå«åš&quot;å¥—æŽ¥å­—â€ï¼ˆsocketï¼‰ã€‚æœ‰äº†å®ƒï¼Œå°±å¯ä»¥è¿›è¡Œç½‘ç»œåº”ç”¨ç¨‹åºå¼€å‘äº†ã€‚ 4.1 UDPåè®® çŽ°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®åŒ…ä¸­åŠ å…¥ç«¯å£ä¿¡æ¯ï¼Œè¿™å°±éœ€è¦æ–°çš„åè®®ã€‚æœ€ç®€å•çš„å®žçŽ°å«åšUDPåè®®ï¼Œå®ƒçš„æ ¼å¼å‡ ä¹Žå°±æ˜¯åœ¨æ•°æ®å‰é¢ï¼ŒåŠ ä¸Šç«¯å£å·ã€‚ UDPæ•°æ®åŒ…ï¼Œä¹Ÿæ˜¯ç”±&quot;æ ‡å¤´&quot;å’Œ&quot;æ•°æ®&quot;ä¸¤éƒ¨åˆ†ç»„æˆã€‚ &quot;æ ‡å¤´&quot;éƒ¨åˆ†ä¸»è¦å®šä¹‰äº†å‘å‡ºç«¯å£å’ŒæŽ¥æ”¶ç«¯å£ï¼Œ&quot;æ•°æ®&quot;éƒ¨åˆ†å°±æ˜¯å…·ä½“çš„å†…å®¹ã€‚ç„¶åŽï¼ŒæŠŠæ•´ä¸ªUDPæ•°æ®åŒ…æ”¾å…¥IPæ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ï¼Œè€Œå‰é¢è¯´è¿‡ï¼ŒIPæ•°æ®åŒ…åˆæ˜¯æ”¾åœ¨ä»¥å¤ªç½‘æ•°æ®åŒ…ä¹‹ä¸­çš„ï¼Œæ‰€ä»¥æ•´ä¸ªä»¥å¤ªç½‘æ•°æ®åŒ…çŽ°åœ¨å˜æˆäº†ä¸‹é¢è¿™æ ·ï¼š UDPæ•°æ®åŒ…éžå¸¸ç®€å•ï¼Œ&quot;æ ‡å¤´&quot;éƒ¨åˆ†ä¸€å…±åªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ€»é•¿åº¦ä¸è¶…è¿‡65,535å­—èŠ‚ï¼Œæ­£å¥½æ”¾è¿›ä¸€ä¸ªIPæ•°æ®åŒ…ã€‚ 4.2 TCPåè®® UDPåè®®çš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒç®€å•ï¼Œå®¹æ˜“å®žçŽ°ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å¯é æ€§è¾ƒå·®ï¼Œä¸€æ—¦æ•°æ®åŒ…å‘å‡ºï¼Œæ— æ³•çŸ¥é“å¯¹æ–¹æ˜¯å¦æ”¶åˆ°ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæé«˜ç½‘ç»œå¯é æ€§ï¼ŒTCPåè®®å°±è¯žç”Ÿäº†ã€‚è¿™ä¸ªåè®®éžå¸¸å¤æ‚ï¼Œä½†å¯ä»¥è¿‘ä¼¼è®¤ä¸ºï¼Œå®ƒå°±æ˜¯æœ‰ç¡®è®¤æœºåˆ¶çš„UDPåè®®ï¼Œæ¯å‘å‡ºä¸€ä¸ªæ•°æ®åŒ…éƒ½è¦æ±‚ç¡®è®¤ã€‚å¦‚æžœæœ‰ä¸€ä¸ªæ•°æ®åŒ…é—å¤±ï¼Œå°±æ”¶ä¸åˆ°ç¡®è®¤ï¼Œå‘å‡ºæ–¹å°±çŸ¥é“æœ‰å¿…è¦é‡å‘è¿™ä¸ªæ•°æ®åŒ…äº†ã€‚ å› æ­¤ï¼ŒTCPåè®®èƒ½å¤Ÿç¡®ä¿æ•°æ®ä¸ä¼šé—å¤±ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯è¿‡ç¨‹å¤æ‚ã€å®žçŽ°å›°éš¾ã€æ¶ˆè€—è¾ƒå¤šçš„èµ„æºã€‚ TCPæ•°æ®åŒ…å’ŒUDPæ•°æ®åŒ…ä¸€æ ·ï¼Œéƒ½æ˜¯å†…åµŒåœ¨IPæ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ã€‚TCPæ•°æ®åŒ…æ²¡æœ‰é•¿åº¦é™åˆ¶ï¼Œç†è®ºä¸Šå¯ä»¥æ— é™é•¿ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯ç½‘ç»œçš„æ•ˆçŽ‡ï¼Œé€šå¸¸TCPæ•°æ®åŒ…çš„é•¿åº¦ä¸ä¼šè¶…è¿‡IPæ•°æ®åŒ…çš„é•¿åº¦ï¼Œä»¥ç¡®ä¿å•ä¸ªTCPæ•°æ®åŒ…ä¸å¿…å†åˆ†å‰²ã€‚ å…³äºŽTCPç»†èŠ‚ä»¥åŽå†æŽ¢è®¨ã€‚ 5. åº”ç”¨å±‚ åº”ç”¨ç¨‹åºæ”¶åˆ°&quot;ä¼ è¾“å±‚&quot;çš„æ•°æ®ï¼ŒæŽ¥ä¸‹æ¥å°±è¦è¿›è¡Œè§£è¯»ã€‚ç”±äºŽäº’è”ç½‘æ˜¯å¼€æ”¾æž¶æž„ï¼Œæ•°æ®æ¥æºäº”èŠ±å…«é—¨ï¼Œå¿…é¡»äº‹å…ˆè§„å®šå¥½æ ¼å¼ï¼Œå¦åˆ™æ ¹æœ¬æ— æ³•è§£è¯»ã€‚ &quot;åº”ç”¨å±‚&quot;çš„ä½œç”¨ï¼Œå°±æ˜¯è§„å®šåº”ç”¨ç¨‹åºçš„æ•°æ®æ ¼å¼ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒTCPåè®®å¯ä»¥ä¸ºå„ç§å„æ ·çš„ç¨‹åºä¼ é€’æ•°æ®ï¼Œæ¯”å¦‚Emailã€WWWã€FTPç­‰ç­‰ã€‚é‚£ä¹ˆï¼Œå¿…é¡»æœ‰ä¸åŒåè®®è§„å®šç”µå­é‚®ä»¶ã€ç½‘é¡µã€FTPæ•°æ®çš„æ ¼å¼ï¼Œè¿™äº›åº”ç”¨ç¨‹åºåè®®å°±æž„æˆäº†&quot;åº”ç”¨å±‚&quot;ã€‚ è¿™æ˜¯æœ€é«˜çš„ä¸€å±‚ï¼Œç›´æŽ¥é¢å¯¹ç”¨æˆ·ã€‚å®ƒçš„æ•°æ®å°±æ”¾åœ¨TCPæ•°æ®åŒ…çš„&quot;æ•°æ®&quot;éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒçŽ°åœ¨çš„ä»¥å¤ªç½‘çš„æ•°æ®åŒ…å°±å˜æˆä¸‹é¢è¿™æ ·ã€‚ *æ³¨ï¼šUDPå¤´ä¸º8ä¸ªå­—èŠ‚ï¼ŒTCPå¤´ä¸º20ä¸ªå­—èŠ‚ æ•´ç†äºŽï¼šhttp://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œç›¸å…³</tag>
      </tags>
  </entry>
</search>
